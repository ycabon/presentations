// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(k,f,h){function l(a){return a&&"object"===typeof a&&("result"in a||"transferList"in a)}Object.defineProperty(f,"__esModule",{value:!0});(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.CONFIGURE=1]="CONFIGURE";a[a.CONFIGURED=2]="CONFIGURED";a[a.OPEN=3]="OPEN";a[a.OPENED=4]="OPENED";a[a.RESPONSE=5]="RESPONSE";a[a.INVOKE=6]="INVOKE";a[a.CANCEL=7]="CANCEL";a[a.CLOSE=8]="CLOSE";a[a.OPEN_PORT=9]="OPEN_PORT"})(f.MessageType||
(f.MessageType={}));var m=0;f.newJobId=function(){return m++};f.isTranferableResult=l;f.toInvokeError=function(a){return a?a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details,stack:a.stack}):null};f.postMessage=function(a,g,c,d){2===arguments.length||void 0===c&&void 0===d?a.postMessage(g):(h("esri-workers-supports-transfer-arraybuffer")||(d?(d=d.filter(function(a){return!(a instanceof ArrayBuffer)}),d.length||(d=null)):l(c)&&c.transferList&&(c.transferList=
c.transferList.filter(function(a){return!(a instanceof ArrayBuffer)}),c.transferList.length||(c.transferList=null))),d?(g.data=c,a.postMessage(g,d)):l(c)?(g.data=c.result,c.transferList?a.postMessage(g,c.transferList):a.postMessage(g)):(g.data=c,a.postMessage(g)))};f.receiveMessage=function(a){return a?(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null}})},"esri/core/workers/request":function(){define(["require","exports","../tsSupport/assignHelper","../Error","../global"],function(k,f,h,l,
m){Object.defineProperty(f,"__esModule",{value:!0});var a;f.execute=function(g,c){void 0===c&&(c={});var d=c.responseType;d?"json"!==d&&"text"!==d&&"blob"!==d&&"array-buffer"!==d&&(d="text"):d="json";return m.invokeStaticMessage("request",{url:g,options:c}).then(function(f){var n=f.data,m,k,b;if(n&&("json"===d||"text"===d||"blob"===d)&&(m=new Blob([n]),"json"===d||"text"===d)&&(a||(a=new FileReaderSync),k=a.readAsText(m),"json"===d)){try{b=JSON.parse(k||null)}catch(e){throw f=h({},e,{url:g,requestOptions:c}),
new l("request:server",e.message,f);}if(b.error)throw f=h({},b.error,{url:g,requestOptions:c}),new l("request:server",b.error.message,f);}switch(d){case "json":break;case "text":b=k;break;case "blob":b=m;break;default:b=n}return{data:b,requestOptions:c,ssl:f.ssl,url:g}})}})},"esri/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(k){for(var f,h=1,l=arguments.length;h<l;h++){f=arguments[h];for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(k[m]=f[m])}return k}})},
"*noref":1}});
define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(k,f,h,l,m,a){function g(a,e){a["delete"](e)}var c=a.MessageType.CLOSE,d=a.MessageType.CANCEL,t=a.MessageType.INVOKE,n=a.MessageType.RESPONSE,u=a.MessageType.OPEN_PORT,w=function(){function b(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(e){e.type===a.MessageType.CANCEL?this._cancelledJobIds.add(e.jobId):
(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))};b.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};b.prototype._process=function(){this._timer=null;for(var a=0,p=this._invokeMessages;a<p.length;a++){var b=p[a];this._cancelledJobIds.has(b.jobId)||this._invoke(b)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return b}();return function(){function b(a,b,d){this._outJobs=new Map;this._inJobs=
new Map;this._queue=new w(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=b;this._port=a;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=d}b.connect=function(a){var e=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new b(e.port1,a,e);return e.port2};b.prototype.close=function(){this._post({type:c});this._close()};b.prototype.isBusy=function(){return 0<
this._outJobs.size};b.prototype.invoke=function(e,b,f){var c=this,p=a.newJobId(),v=new h(function(){g(c._outJobs,p);c._post({type:d,jobId:p})});this._outJobs.set(p,v);this._post({type:t,jobId:p,methodName:e},b,f);return v.promise};b.prototype.openPort=function(){var e=this,b=a.newJobId(),c=new h(function(){g(e._outJobs,b);e._post({type:d,jobId:b})});this._outJobs.set(b,c);this._post({type:u,jobId:b});return c.promise};b.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",
this._onMessage);this._port.close();this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};b.prototype._onMessage=function(e){if(e=a.receiveMessage(e))switch(e.type){case n:this._onResponse(e);break;case t:this._queue.push(e);break;case d:this._onCancel(e);break;case c:this._close();break;case u:this._onOpenPort(e)}};b.prototype._onCancel=function(a){var b=this._inJobs,e=a.jobId,c=b.get(e);this._queue.push(a);c&&
(g(b,e),c.cancel())};b.prototype._onInvoke=function(b){var e=this,c=b.methodName,d=b.jobId;b=b.data;var f=this._inJobs,h=this._client,l=h[c],k;try{if(!l&&c&&-1!==c.indexOf("."))for(var r=c.split("."),q=0;q<r.length-1;q++)h=h[r[q]],l=h[r[q+1]];if("function"!==typeof l)throw new TypeError(c+" is not a function");k=l.call(h,b,this)}catch(x){this._post({type:n,jobId:d,error:a.toInvokeError(x)});return}m.isThenable(k)?(f.set(d,k),k.then(function(a){f.has(d)&&(g(f,d),e._post({type:n,jobId:d},a))}).catch(function(b){f.has(d)&&
(g(f,d),b&&"cancel"===b.dojoType||e._post({type:n,jobId:d,error:a.toInvokeError(b||{message:"Error encountered at method "+c})}))})):this._post({type:n,jobId:d},k)};b.prototype._onOpenPort=function(a){var c=new MessageChannel;new b(c.port1,this._client);this._post({type:n,jobId:a.jobId},c.port2,[c.port2])};b.prototype._onResponse=function(a){var b=a.jobId,c=a.error;a=a.data;var d=this._outJobs;if(d.has(b)){var e=d.get(b);g(d,b);c?e.reject(l.fromJSON(JSON.parse(c))):e.resolve(a)}};b.prototype._post=
function(b,c,d){return a.postMessage(this._port,b,c,d)};return b}()});