// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),function(G,B,C,H,w,u,I,v,y,J,D){function x(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=u.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function K(a,
c){var b=c&&c.resource,b=b&&b.href;return a.thumbnail&&a.thumbnail.url?w.resolve(a.thumbnail.url):b&&"object"!==c.type?w.resolve(D.getIconHref(a,c)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?J.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||E}):w.resolve(E)}function g(a,c){if(!a.material||!a.material.color)return a=Math.min(Math.max(I.defaultThematicColor.r+191.25*c,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),
f=0;3>f;f++)b[f]=Math.min(Math.max(b[f]+191.25*c,0),255);b.push(a.material.color.a);return b}function F(a){return a.outline?x(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function z(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),f="rgba(",g=0;3>g;g++)f+=Math.min(Math.max(b[g]+191.25*c,0),255)+",";f+=a.material.color.a+");";a=a.size?u.pt2px(a.size):.75;return{color:f,width:Math.min(a,80)}}function A(a,c,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,
offset:0},{color:c,offset:1}]}}function L(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&a<b}function M(a,c,b,f){var p=a&&a.type,t="object"===p,e=[];if("icon"===p)switch(c){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:x(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:x(a)});break;case "cross":e.push({shape:{type:"path",
path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:F(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:F(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},
{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:x(a)})}else if(t)switch(c){case "cone":c=g(a,0);a=g(a,-.6);a=A(c,a,f?20:b);b=v.getConeShapes(b,f);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":f=g(a,0);a=g(a,-.6);a=A(f,a,b);b=v.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:f});break;case "cube":b=v.getCubeShapes(b,f);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,
-.5)});break;case "cylinder":c=g(a,0);p=g(a,-.6);c=A(c,p,f?20:b);b=v.getCylinderShapes(b,f);e.push({shape:b[0],fill:c});e.push({shape:b[1],fill:c});e.push({shape:b[2],fill:g(a,0)});break;case "diamond":b=v.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":f=g(a,0);a=g(a,-.6);a=A(f,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});
break;case "tetrahedron":b=v.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}return e}function N(a,c){var b=c&&c.size?u.pt2px(c.size):null,g=c&&c.maxSize?u.pt2px(c.maxSize):null,p=c&&c.disableUpsampling,t=a.symbolLayers,e=[],h=0,q=0,d=t.getItemAt(t.length-1),n;d&&"icon"===d.type&&(n=d.size&&u.pt2px(d.size));t.forEach(function(d,f){if("icon"===d.type||"object"===d.type){f="icon"===d.type?d.size&&u.pt2px(d.size):0;var l=
b||f?Math.ceil(Math.min(b||f,g||120)):22,k=x(d),m=k?k.width:0;if(d&&d.resource&&d.resource.href)f=K(a,d).then(function(a){var b=d.get("material.color"),c;c="icon"===d.type?"multiply":"tint";return y.tintImageWithColor(a,l,b,c,p)}).then(function(a){var b=a.width,c=a.height;h=Math.max(h,b+2*m);q=Math.max(q,c+2*m);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),e.unshift(f);else{(k=d.get("resource.primitive"))||(k="icon"===d.type?"circle":"sphere");var r=l;"icon"===
d.type&&n&&b&&(r=f/n*l);f=c&&"tall"===c.symbolConfig||("object"===d.type?L(d):!1);h=Math.max(h,f?20:r+2*m);q=Math.max(q,r+2*m);e.unshift(w.resolve(M(d,k,r,f)))}}});return w.eachAlways(e).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&O.warn("error while building swatchInfo!",a.error)});return y.renderSymbol(b,[h,q],{node:c&&c.node,scale:!1})})}function P(a,c){var b=a.symbolLayers,f=[];a=D.isVolumetricSymbol(a);var p=c&&c.size?u.pt2px(c.size):null,t=(c&&c.maxSize?
u.pt2px(c.maxSize):null)||80,e=0,h=0,q;b.forEach(function(a,b){var c=a&&a.type,d="line"===c;if(d||"path"===c){var l=z(a,0),k=l&&l.width||0,c=[];d?(0===b&&(q=k),a=Math.min(p||k,t),a=0===b?a:p?k/q*a:a,h=Math.max(h,a),e=Math.max(e,22<a?2*a:40),l.width=a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[e,.5*h]},{command:"E",values:[]}]},stroke:l})):(b=Math.min(p||22,t),l=g(a,0),d=g(a,-.2),a=z(a,-.4),a.width=1,c.push({shape:v.shapes.pathSymbol3DLayer[0],fill:d,stroke:a}),
c.push({shape:v.shapes.pathSymbol3DLayer[1],fill:l,stroke:a}),e=h=Math.max(h,b+2));f.push(c)}});return w.resolve(y.renderSymbol(f,[e,h],{node:c&&c.node,scale:a}))}Object.defineProperty(B,"__esModule",{value:!0});var E=G.toUrl("../../images/Legend/legend3dsymboldefault.png"),O=H.getLogger("esri.symbols.support.previewSymbol3D");B.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return w.reject(new C("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var b=null;switch(a.type){case "point-3d":b=
N(a,c);break;case "line-3d":b=P(a,c);break;case "polygon-3d":case "mesh-3d":a:{b="mesh-3d"===a.type;a=a.symbolLayers;for(var f=c&&c.size?u.pt2px(c.size):null,p=c&&c.maxSize?u.pt2px(c.maxSize):null,f=f||22,t=[],e=0,h=0,q=0;q<a.length;q++){var d=a.getItemAt(q),n=d.type,m="fill"===n,r="line"===n,l="extrude"===d.type,n=[];if(b&&!m){b=void 0;break a}var k=v.shapes.fill[0];m?(r=(m=x(d))&&m.width||0,e=Math.max(e,22+r),h=Math.max(h,22+r),n.push({shape:k,fill:g(d,0),stroke:m})):r?(d=(m=z(d,0))&&m.width||0,
k={stroke:m,shape:k},e=Math.max(e,22+d),h=Math.max(h,22+d),n.push(k)):l&&(k=z(d,-.4),m=g(d,0),d=g(d,-.2),r=Math.min(f,p||120),l=v.getExtrudeSymbolShapes(r),k.width=1,n.push({shape:l[0],fill:d,stroke:k}),n.push({shape:l[1],fill:d,stroke:k}),n.push({shape:l[2],fill:m,stroke:k}),d=22*.7+.5*r,e=Math.max(e,22+2*k.width),h=Math.max(h,d+2*k.width));t.push(n)}b=w.resolve(y.renderSymbol(t,[e,h],{node:c&&c.node,scale:!1}))}}return b?b:w.reject(new C("symbolPreview: swatchInfo3D","symbol not supported."))}});