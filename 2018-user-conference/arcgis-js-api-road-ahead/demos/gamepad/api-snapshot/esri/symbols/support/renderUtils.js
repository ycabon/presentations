// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/promiseUtils ../../core/sniff".split(" "),function(H,u,z,A,B,w,C,v,D,E,x){function F(a){return a.map(function(c){return c.command+" "+c.values.join(",")}).join(" ").trim()}function G(a,c,e,l){var h=l&&l.node||document.createElement("div"),f=A.createSurface(h,c,e);null!=l.opacity&&(h.style.opacity=l.opacity.toString());try{a.forEach(function(a){var h=f.createGroup(),
d=0;a.forEach(function(a){var b=a.shape,e=a.fill,c=a.stroke;d+=c&&c.width||0;var f=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=F(b.path)),f=h.createShape(b).setFill(e).setStroke(c?c:{width:0}),"text"===b.type&&f.setFont(a.font))});var k=h.getBoundingBox();a=k.width;var r=k.height,m=-(k.x+a/2),b=-(k.y+r/2),g=f.getDimensions(),m={dx:m+g.width/2,dy:b+g.height/2},b=!1;if(l.scale&&0!==k.width&&0!==k.height){var b=k.width/k.height,n=(c>e?c:e)-2*d,p=1,t=1;isNaN(n)||(1<b?(p=n/k.width,t=n/
b/k.height):(t=n/k.height,p=n*b/k.width));h.applyTransform(B.scaleAt(p,t,g.width/2,g.height/2));b=!0}!b&&(a>c||r>e)&&(k=a/c>r/e,a=((k?c:e)-5)/(k?a:r),z.mixin(m,{xx:a,yy:a}));h.applyTransform(m)})}catch(I){return f.clear(),f.destroy(),null}return h}function y(a,c,e,l){return a?C(a,{responseType:"image",allowImageDataAccess:e}).then(function(a){a=a.data;var f=a.width,h=a.height,q=f/h,d=c;l&&(d=Math.min(d,Math.max(f,h)));return{image:e?a:null,width:1>=q?Math.ceil(d*q):d,height:1>=q?d:Math.ceil(d/q)}}).catch(function(h){if(e)return y(a,
c,!1,l);throw h;}):E.reject(new D("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(u,"__esModule",{value:!0});u.renderSymbol=function(a,c,e){var l=Math.ceil(c[0]);c=Math.ceil(c[1]);return a.some(function(a){return!!a.length})?G(a,l,c,e):null};u.tintImageWithColor=function(a,c,e,l,h){return y(a,c,!!e,h).then(function(f){var h=f.width?f.width:c,q=f.height?f.height:c,d;if(d=f.image)d=e&&"ignore"!==l?"multiply"===l&&255===e.r&&255===e.g&&255===e.b&&1===e.a?!1:!0:!1;if(d){var k=
f.image.width,r=f.image.height;(x("edge")||x("ie"))&&/\.svg$/i.test(a)&&(--k,--r);var m,b;m=Math.ceil(h);b=Math.ceil(q);d=document.createElement("canvas");d.width=m;d.height=b;d.style.width=m+"px";d.style.height=b+"px";d=d.getContext("2d");d.clearRect(0,0,m,b);d.drawImage(f.image,0,0,k,r,0,0,h,q);f=d.getImageData(0,0,h,q);k=[e.r/255,e.g/255,e.b/255,e.a];r=v.toHSV(e);for(m=0;m<f.data.length;m+=4){b=f.data;var g=m,n=k,p=r;switch(l){case "multiply":b[g+0]*=n[0];b[g+1]*=n[1];b[g+2]*=n[2];b[g+3]*=n[3];
break;default:var t=v.toHSV({r:b[g+0],g:b[g+1],b:b[g+2]});t.h=p.h;t.s=p.s;t.v=t.v/100*p.v;p=v.toRGB(t);b[g+0]=p.r;b[g+1]=p.g;b[g+2]=p.b;b[g+3]*=n[3]}}d.putImageData(f,0,0);a=d.canvas.toDataURL("image/png")}else(d=w.id&&w.id.findCredential(a))&&d.token&&(f=-1===a.indexOf("?")?"?":"\x26",a=""+a+f+"token\x3d"+d.token);return{url:a,width:h,height:q}}).catch(function(){return{url:a,width:c,height:c}})}});