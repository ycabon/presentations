// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper dojo/has ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/QueryEngine ../../../layers/graphics/controllers/support/controllerUtils ../engine/DOMContainer ../engine/webgl/rendererInfoUtils ./LayerView2D ./support/FeaturesView2D ../../layers/RefreshableLayerView".split(" "),
function(m,B,n,e,C,k,p,q,r,t,g,d,u,v,w,x,y,z,A){function f(c){return c&&null!=c._proxy}function h(c){return c&&null!=c.update}return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._handles=new t;a.container=new w;return a}n(b,c);b.prototype.highlight=function(a,b){var l=this;b=this.featuresView;var c;a instanceof p?c=[a.getAttribute(this.layer.objectIdField)]:"number"===typeof a?c=[a]:q.isCollection(a)?c=a.map(function(a){return a.getAttribute(l.layer.objectIdField)}).toArray():
Array.isArray(a)&&0<a.length&&(c="number"===typeof a[0]?a:a.map(function(a){return a.getAttribute(l.layer.objectIdField)}));return c&&c.length&&b&&null!=b.highlight?b.highlight(c):{remove:function(){}}};b.prototype.queryGraphics=function(){return this._queryEngine?this._queryEngine.queryFeatures():this._rejectQuery()};b.prototype.queryFeatures=function(a){return f(this.featuresView)?this.featuresView.queryFeatures(a):this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};b.prototype.queryObjectIds=
function(a){return f(this.featuresView)?this.featuresView.queryObjectIds(a):this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};b.prototype.queryFeatureCount=function(a){return f(this.featuresView)?this.featuresView.queryFeatureCount(a):this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};b.prototype.queryExtent=function(a){return f(this.featuresView)?this.featuresView.queryExtent(a):this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};
b.prototype.hitTest=function(a,b){return this.suspended||!this.featuresView?g.resolve():this.featuresView.hitTest(a,b)};b.prototype.update=function(a){h(this.controller)?this.controller.update(a):h(this.featuresView)&&this.featuresView.update(a)};b.prototype.attach=function(){var a=this;this._canUseWebGL()?g.create(function(a){return m(["./FeatureLayerView2DWebGL"],a)}).then(function(b){if(a.attached)return(new b({layer:a.layer,view:a.view})).when()}).then(function(b){a.featuresView=b;a.container.addChild(b.container);
b.attached=!0;b.attach()}):this.layer.createGraphicsController({layerView:this}).then(function(b){if(a.attached){a._set("controller",b);a.requestUpdate();var c=new z;c.mapView=a.view;c.graphics=b.graphics;c.layer=a.layer;c.renderer=a.layer.renderer;a._handles.add(a.layer.watch("renderer",function(){c.renderer=a.layer.renderer}));a._handles.add(a.layer.on("graphic-update",function(a){return c.graphicUpdateHandler(a)}));a.featuresView=c;a._queryEngine=new u({layer:a.layer});a._queryEngine.features=
b.graphics;a._queryEngine.objectIdField=a.layer.objectIdField;a.container.addChild(c.container)}})};b.prototype.detach=function(){this.container.removeAllChildren();this._handles.removeAll();this.featuresView&&(this.featuresView.destroy(),this.featuresView=null);this.controller&&(this.controller.destroy&&this.controller.destroy(),this._set("controller",null))};b.prototype.moveStart=function(){this.requestUpdate()};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=function(){this.requestUpdate()};
b.prototype.takeScreenshot=function(a,b){return this.featuresView.featuresView._container.takeScreenshot(a)};b.prototype.doRefresh=function(){this.updateRequested||this.suspended||this.controller&&v.isRefreshable(this.controller.activeController)&&this.controller.activeController.refresh()};b.prototype.isUpdating=function(){return null==this.featuresView||!0===this.get("controller.updating")||!0===this.featuresView.updateRequested||h(this.featuresView)&&this.featuresView.updating};b.prototype._canUseWebGL=
function(){return k("esri-featurelayer-webgl")&&k("esri-webgl")&&x.isRendererWebGLCompatible(this.layer.renderer)&&(this.layer.capabilities.query.supportsQuantization&&("polygon"!==this.layer.geometryType||this.layer.capabilities.query.supportsCentroid)||this.layer.source&&"esri.layers.graphics.sources.CSVSource"===this.layer.source.declaredClass)};b.prototype._rejectQuery=function(){return g.reject(new r("FeatureLayerView2D","Not ready to execute query"))};e([d.property({readOnly:!0})],b.prototype,
"controller",void 0);e([d.property()],b.prototype,"featuresView",void 0);e([d.property({dependsOn:["controller.updating","featuresView","featuresView.updating"]})],b.prototype,"updating",void 0);return b=e([d.subclass("esri.views.2d.layers.FeatureLayerView2D")],b)}(d.declared(y,A))});