// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(f,p,F,w,G,H,z,I,J){Object.defineProperty(p,"__esModule",{value:!0});var K=J.VertexAttrConstants;f=H.vec3d;var t=new F,g=f.create(),c=f.create(),k=f.create(),q={verticalDistanceToGround:0,terrainElevation:0};p.perVertexElevationAligner=function(A,a,l,d){t.spatialReference=l.spatialReference;
for(var m=A.getGeometryRecords(),n=m.length,B="absolute-height"!==a.mode,C=0,u=0;u<n;u++){var b=m[u].geometry,h=m[u].getShaderTransformation(),r=b.getData();c[0]=h[12];c[1]=h[13];c[2]=h[14];b.invalidateBoundingInfo();for(var h=r.getVertexAttr(),r=h[K.POSITION],b=r.data,h=h.mapPos.data,r=r.size,f=b.length/r,e=0,x=0,y=!1,D=0,E=0;E<f;E++){t.x=h[x++];t.y=h[x++];t.z=h[x++];k[0]=b[e];k[1]=b[e+1];k[2]=b[e+2];var v=w.computeElevation(l,t,a,d,B?q:null);B&&(D+=q.terrainElevation);g[0]=b[e]+c[0];g[1]=b[e+1]+
c[1];g[2]=b[e+2]+c[2];d.setAltitude(v,g);b[e]=g[0]-c[0];b[e+1]=g[1]-c[1];b[e+2]=g[2]-c[2];if(z.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)y=!0;else if(v=p.updateThresholdInMeters/d.unitInMeters,Math.abs(k[0]-b[e])>=v||Math.abs(k[1]-b[e+1])>=v||Math.abs(k[2]-b[e+2])>=v)y=!0;e+=r}C+=D/f;y&&A.geometryVertexAttrsUpdated(u)}return C/n};p.perObjectElevationAligner=function(c,a,l,d,m){var n=a.centerPointInElevationSR,f=0;m=0;if(c.metadata.usesVerticalDistanceToGround)f=w.computeElevation(l,n,a,d,q),G.updateVertexAttributeAuxpos1w(c,
q.verticalDistanceToGround),m=q.terrainElevation;else{var k="absolute-height"!==a.mode,f=w.computeElevation(l,n,a,d,k?q:null);k&&(m=q.terrainElevation)}a=c.getObjectTransformation();l=[a[12],a[13],a[14]];z.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(g[0]=n.x,g[1]=n.y,g[2]=f,I.computeLinearTransformation(n.spatialReference,g,a,d.spatialReference)&&c.setObjectTransformation(a)):d.setAltitudeOfTransformation(f,a);d=p.updateThresholdInMeters/d.unitInMeters;(Math.abs(a[12]-l[0])>=d||Math.abs(a[13]-l[1])>=
d||Math.abs(a[14]-l[2])>=d)&&c.setObjectTransformation(a);return m};p.updateThresholdInMeters=.01;p.iterativeUpdatesEnabled=!0});