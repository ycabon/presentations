// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../support/geometryUtils ../lib/Camera ../lib/gl-matrix ../lib/PerformanceTimer ../lib/Util ./Visualizer".split(" "),function(L,M,N,d,p,m,O,t,q){var f=[0,0],r=m.mat4d.create(),c=[d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create()];return function(){function a(b,g,a,c){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,
viewportRenderTimer:null};this._needsRender=!0;this._rctx=c;this._gl=c.gl;this._visualizer=new q(b,g,a,this._rctx);this._camera=new p(m.vec3.createFrom(0,100,-100),m.vec3.createFrom(0,0,0))}Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0});a.prototype.getCombinedStats=function(){var b={},g=this._visualizer.getCombinedStats(),a;for(a in g)b[a]=g[a];b.renderGeometriesTotal=this._stats.renderGeometriesTotal;
b.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(b.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(b.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(b.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var g=this._gl.getUsedTextureMemoryStats(),c;for(c in g)b["texMem type: "+c]=g[c]}return b};a.prototype.dispose=function(){this._visualizer.dispose();
this._visualizer=null};a.prototype.setLighting=function(b){this._visualizer.setLighting(b)};a.prototype.getViewParams=function(b){var a=this._visualizer.getViewParams(b);if(!b||b.frustumCullingEnabled)a.frustumCullingEnabled=this._frustumCullingEnabled;if(!b||b.maxFarNearRatio)a.maxFarNearRatio=this._maxFarNearRatio;return a};a.prototype.setViewParams=function(b){void 0!==b.frustumCullingEnabled&&(this._frustumCullingEnabled=b.frustumCullingEnabled);void 0!==b.maxFarNearRatio&&(this._maxFarNearRatio=
-1===b.maxFarNearRatio?2E4:b.maxFarNearRatio);this._visualizer.setViewParams(b);this._needsRender=!0};a.prototype.setRenderParams=function(b){this._visualizer.setRenderParams(b)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getFrustumObjects=function(){var b={},a;for(a in this._content)b[this._content[a].name]=1;return b};a.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};a.prototype.modify=function(b,a,c,d){this._visualizer.modify(b,
a,c,d);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};a.prototype.setCamera=function(b){this._camera.copyFrom(b);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(b,a,c){return this.pickRayWithBeginPoint(b,void 0,this._camera.viewMatrix,a,c)};a.prototype.pickRayWithBeginPoint=function(b,a,c,d,f){return this._visualizer.getPickRay(b,a,this._camera,c,d,f)};a.prototype.addExternalRenderer=
function(b,a){return this._visualizer.addExternalRenderer(b,a)};a.prototype.removeExternalRenderer=function(b){return this._visualizer.removeExternalRenderer(b)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(b,a){this._updateNearFar();this._visualizer.render(this._camera,b,a)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};a.prototype.needsRender=function(){return this._needsRender||
this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)f[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,f),0<this._maxFarNearRatio&&0<f[1]&&(this._camera.far=f[1],this._camera.near=Math.max(f[0],this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(b,a){m.mat4d.perspective(this._camera.fovY,this._camera.aspect,1,10,r);t.matrixToFrustumPlanes(this._camera.viewMatrix,r,c);this._stats.renderGeometriesTotal=
0;this._stats.renderGeometriesVisible=0;b=-Number.MAX_VALUE;var d=-Number.MAX_VALUE,f=c[0][0],g=c[0][1],p=c[0][2],q=c[0][3],u=c[1][0],v=c[1][1],w=c[1][2],x=c[1][3],y=c[2][0],z=c[2][1],A=c[2][2],B=c[2][3],C=c[3][0],D=c[3][1],E=c[3][2],F=c[3][3],G=c[4][0],H=c[4][1],I=c[4][2],J=c[4][3],K=c[5][3],n;for(n in this._content){var h=this._content[n];this._stats.renderGeometriesTotal++;var k=h.center,l=k[0],e=k[1],k=k[2],h=h.bsRadius;f*l+g*e+p*k+q>h||u*l+v*e+w*k+x>h||y*l+z*e+A*k+B>h||C*l+D*e+E*k+F>h||(e=G*
l+H*e+I*k,l=e+h,e=-e+h,l>b&&(b=l),e>d&&(d=e),this._stats.renderGeometriesVisible++)}n=b!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&n&&(a[0]=.99*Math.max(1-(b+J),2),a[1]=1.01*Math.max(10+(d+K),a[0]+1))};return a}()});