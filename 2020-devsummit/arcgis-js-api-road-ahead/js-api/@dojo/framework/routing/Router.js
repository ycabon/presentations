//>>built
(function(d){"object"===typeof module&&"object"===typeof module.exports?(d=d(require,exports),void 0!==d&&(module.exports=d)):"function"===typeof define&&define.amd&&define(["require","exports","tslib","../core/QueuingEvented","./history/HashHistory"],d)})(function(d,p){function u(k,d){var a=k.params,c=d.params;return Object.keys(a).every(function(b){return a[b]===c[b]})?Object.keys(c).every(function(b){return a[b]===c[b]}):!1}Object.defineProperty(p,"__esModule",{value:!0});var k=d("tslib"),w=d("../core/QueuingEvented"),
x=d("./history/HashHistory"),y=new RegExp(/^{.+}$/);d=function(d){function h(a,c){void 0===c&&(c={});var b=d.call(this)||this;b._routes=[];b._outletMap=Object.create(null);b._matchedOutlets=Object.create(null);b._currentParams={};b._currentQueryParams={};b._onChange=function(a){a=b._stripLeadingSlash(a);var c=b._matchedOutlets;b._matchedOutlets=Object.create(null);a=k.__read(a.split("?"),2);var e=a[0];b._currentQueryParams=b._getQueryParams(a[1]);var d=e.split("/"),f=b._routes.map(function(b){return{route:b,
segments:k.__spread(d),parent:void 0,params:{}}}),g,h=[];for(a=function(){var a=g.route,e=g.parent,c=g.segments,d=g.params,m=0,l="index",r=0,n=!0;if(c.length<a.segments.length)n=!1;else for(;0<c.length;){if(void 0===a.segments[m]){l="partial";break}var q=c.shift();if("__PARAM__"===a.segments[m])d[a.params[r++]]=q,b._currentParams=k.__assign({},b._currentParams,d);else if(a.segments[m]!==q){n=!1;break}m++}n&&(g.type=l,h.push({route:a,parent:e,type:l,params:d,segments:[]}),c.length&&(f=k.__spread(f,
a.children.map(function(b){return{route:b,segments:k.__spread(c),parent:g,type:l,params:k.__assign({},d)}}))))};g=f.pop();)a();a=void 0;var l=h.reduce(function(b,a){return b?b.route.score>a.route.score?b:a:a},void 0);if(l)for("partial"===l.type&&(l.type="error"),a=l.route.outlet,e=function(){var a=l.type,e=l.parent,g=l.route,d={id:g.outlet,queryParams:b._currentQueryParams,params:l.params,type:a,isError:function(){return"error"===a},isExact:function(){return"index"===a}},f=c[g.outlet];b._matchedOutlets[g.outlet]=
d;f&&u(f,d)||b.emit({type:"outlet",outlet:d,action:"enter"});l=e};l;)e();else b._matchedOutlets.errorOutlet={id:"errorOutlet",queryParams:{},params:{},isError:function(){return!0},isExact:function(){return!1},type:"error"};for(var e=Object.keys(c),r=0;r<e.length;r++){var p=e[r],v=b._matchedOutlets[p];v&&u(c[p],v)||b.emit({type:"outlet",outlet:c[p],action:"exit"})}b.emit({type:"nav",outlet:a,context:a?b._matchedOutlets[a]:void 0})};var g=c.HistoryManager,g=void 0===g?x.HashHistory:g,e=c.base;c=c.window;
b._register(a);b._history=new g({onChange:b._onChange,base:e,window:c});b._matchedOutlets.errorOutlet&&b._defaultOutlet&&(a=b.link(b._defaultOutlet))&&b.setPath(a);return b}k.__extends(h,d);h.prototype.setPath=function(a){this._history.set(a)};h.prototype.link=function(a,c){void 0===c&&(c={});var b=this._currentParams,g=this._currentQueryParams,e=this._outletMap[a];if(void 0!==e){a=e.fullPath;if(0<e.fullQueryParams.length){var d=e.fullQueryParams.reduce(function(b,a,c){return 0<c?b+"\x26"+a+"\x3d{"+
a+"}":"?"+a+"\x3d{"+a+"}"},"");a=""+a+d}c=k.__assign({},e.defaultParams,g,b,c);if(!(0===Object.keys(c).length&&0<e.fullParams.length)){b=k.__spread(e.fullParams,e.fullQueryParams);for(g=0;g<b.length;g++)if(e=b[g],c[e])a=a.replace("{"+e+"}",c[e]);else return;return this._history.prefix(a)}}};h.prototype.getOutlet=function(a){return this._matchedOutlets[a]};Object.defineProperty(h.prototype,"currentParams",{get:function(){return this._currentParams},enumerable:!0,configurable:!0});h.prototype._stripLeadingSlash=
function(a){return"/"===a[0]?a.slice(1):a};h.prototype._register=function(a,c,b){c=c?c:this._routes;for(var d=0;d<a.length;d++){var e=a[d],h=e.outlet,p=e.children,m=e.defaultRoute,m=void 0===m?!1:m,q=e.defaultParams,f=void 0===q?{}:q,e=k.__read(e.path.split("?"),2),n=e[0],e=e[1],q=[],n=this._stripLeadingSlash(n),t=n.split("/"),f={params:[],outlet:h,path:n,segments:t,defaultParams:b?k.__assign({},b.defaultParams,f):f,children:[],fullPath:b?b.fullPath+"/"+n:n,fullParams:[],fullQueryParams:[],score:b?
b.score:0};m&&(this._defaultOutlet=h);for(m=0;m<t.length;m++)n=t[m],f.score+=7,y.test(n)&&(f.score-=2,f.params.push(n.replace("{","").replace("}","")),t[m]="__PARAM__");e&&(q=e.split("\x26").map(function(a){return a.replace("{","").replace("}","")}));f.fullQueryParams=b?k.__spread(b.fullQueryParams,q):q;f.fullParams=b?k.__spread(b.fullParams,f.params):f.params;p&&0<p.length&&this._register(p,f.children,f);this._outletMap[h]=f;c.push(f)}};h.prototype._getQueryParams=function(a){var c={};if(a){a=a.split("\x26");
for(var b=0;b<a.length;b++){var d=k.__read(a[b].split("\x3d"),2);c[d[0]]=d[1]}}return c};return h}(w.default);p.Router=d;p.default=d});