//>>built
define("./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),function(b,x,G,q,y,l,z,A,t,p,B,H,u,n,v,C){b._xhrObj=v._create;var r=b.config;b.objectToQuery=q.objectToQuery;b.queryToObject=q.queryToObject;b.fieldToObject=l.fieldToObject;b.formToObject=l.toObject;b.formToQuery=l.toQuery;b.formToJson=l.toJson;b._blockAsync=!1;var e=b._contentHandlers=b.contentHandlers={text:function(a){return a.responseText},
json:function(a){return t.fromJson(a.responseText||null)},"json-comment-filtered":function(a){A.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}\x26\x26\nUse djConfig.useCommentedJson\x3dtrue to turn off this message.");a=a.responseText;var b=a.indexOf("/*"),g=a.lastIndexOf("*/");if(-1==b||-1==g)throw Error("JSON was not comment filtered");
return t.fromJson(a.substring(b+2,g))},javascript:function(a){return b.eval(a.responseText)},xml:function(a){var b=a.responseXML;b&&!b.querySelectorAll&&(b=(new DOMParser).parseFromString(a.responseText,"application/xml"));if(x("ie")&&(!b||!b.documentElement)){var g=function(a){return"MSXML"+a+".DOMDocument"},g=["Microsoft.XMLDOM",g(6),g(4),g(3),g(2)];B.some(g,function(c){try{var d=new ActiveXObject(c);d.async=!1;d.loadXML(a.responseText);b=d}catch(f){return!1}return!0})}return b},"json-comment-optional":function(a){return a.responseText&&
/^[^{\[]*\/\*/.test(a.responseText)?e["json-comment-filtered"](a):e.json(a)}};e.arraybuffer=e.blob=e.document=function(a,b){return a.response};b._ioSetArgs=function(a,c,g,D){var d={args:a,url:a.url},f=null;if(a.form){var f=y.byId(a.form),h=f.getAttributeNode("action");d.url=d.url||(h?h.value:b.doc?b.doc.URL:null);f=l.toObject(f)}h={};f&&p.mixin(h,f);a.content&&p.mixin(h,a.content);a.preventCache&&(h["dojo.preventCache"]=(new Date).valueOf());d.query=q.objectToQuery(h);d.handleAs=a.handleAs||"text";
var k=new z(function(a){a.canceled=!0;c&&c(a);var b=a.ioArgs.error;b||(b=Error("request cancelled"),b.dojoType="cancel",a.ioArgs.error=b);return b});k.addCallback(g);var e=a.load;e&&p.isFunction(e)&&k.addCallback(function(b){return e.call(a,b,d)});var m=a.error;m&&p.isFunction(m)&&k.addErrback(function(b){return m.call(a,b,d)});var n=a.handle;n&&p.isFunction(n)&&k.addBoth(function(b){return n.call(a,b,d)});k.addErrback(function(a){return D(a,k)});r.ioPublish&&b.publish&&!1!==d.args.ioPublish&&(k.addCallbacks(function(a){b.publish("/dojo/io/load",
[k,a]);return a},function(a){b.publish("/dojo/io/error",[k,a]);return a}),k.addBoth(function(a){b.publish("/dojo/io/done",[k,a]);return a}));k.ioArgs=d;return k};var E=function(a){a=e[a.ioArgs.handleAs](a.ioArgs.xhr,a.ioArgs);return void 0===a?null:a},F=function(a,b){b.ioArgs.args.failOk||console.error(a);return a},w=function(a){0>=m&&(m=0,r.ioPublish&&b.publish&&(!a||a&&!1!==a.ioArgs.args.ioPublish)&&b.publish("/dojo/io/stop"))},m=0;u.after(n,"_onAction",function(){--m});u.after(n,"_onInFlight",
w);b._ioCancelAll=n.cancelAll;b._ioNotifyStart=function(a){r.ioPublish&&b.publish&&!1!==a.ioArgs.args.ioPublish&&(m||b.publish("/dojo/io/start"),m+=1,b.publish("/dojo/io/send",[a]))};b._ioWatch=function(a,b,g,e){a.ioArgs.options=a.ioArgs.args;p.mixin(a,{response:a.ioArgs,isValid:function(c){return b(a)},isReady:function(b){return g(a)},handleResponse:function(b){return e(a)}});n(a);w(a)};b._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(-1==a.url.indexOf("?")?"?":"\x26")+a.query,a.query=null)};
b.xhr=function(a,c,g){var e,d=b._ioSetArgs(c,function(a){e&&e.cancel()},E,F),f=d.ioArgs;"postData"in c?f.query=c.postData:"putData"in c?f.query=c.putData:"rawBody"in c?f.query=c.rawBody:(2<arguments.length&&!g||-1==="POST|PUT".indexOf(a.toUpperCase()))&&b._ioAddQueryToUrl(f);var h={method:a,handleAs:{arraybuffer:1,blob:1,document:1}[c.handleAs]?c.handleAs:"text",responseType:c.responseType,timeout:c.timeout,withCredentials:c.withCredentials,ioArgs:f};"undefined"!==typeof c.headers&&(h.headers=c.headers);
"undefined"!==typeof c.contentType&&(h.headers||(h.headers={}),h.headers["Content-Type"]=c.contentType);"undefined"!==typeof f.query&&(h.data=f.query);"undefined"!==typeof c.sync&&(h.sync=c.sync);b._ioNotifyStart(d);try{e=v(f.url,h,!0)}catch(k){return d.cancel(),d}d.ioArgs.xhr=e.response.xhr;e.then(function(){d.resolve(d)}).otherwise(function(a){f.error=a;a.response&&(a.status=a.response.status,a.responseText=a.response.text,a.xhr=a.response.xhr);d.reject(a)});return d};b.xhrGet=function(a){return b.xhr("GET",
a)};b.rawXhrPost=b.xhrPost=function(a){return b.xhr("POST",a,!0)};b.rawXhrPut=b.xhrPut=function(a){return b.xhr("PUT",a,!0)};b.xhrDelete=function(a){return b.xhr("DELETE",a)};b._isDocumentOk=function(a){return C.checkStatus(a.status)};b._getText=function(a){var c;b.xhrGet({url:a,sync:!0,load:function(a){c=a}});return c};p.mixin(b.xhr,{_xhrObj:b._xhrObj,fieldToObject:l.fieldToObject,formToObject:l.toObject,objectToQuery:q.objectToQuery,formToQuery:l.toQuery,formToJson:l.toJson,queryToObject:q.queryToObject,
contentHandlers:e,_ioSetArgs:b._ioSetArgs,_ioCancelAll:b._ioCancelAll,_ioNotifyStart:b._ioNotifyStart,_ioWatch:b._ioWatch,_ioAddQueryToUrl:b._ioAddQueryToUrl,_isDocumentOk:b._isDocumentOk,_getText:b._getText,get:b.xhrGet,post:b.xhrPost,put:b.xhrPut,del:b.xhrDelete});return b.xhr});