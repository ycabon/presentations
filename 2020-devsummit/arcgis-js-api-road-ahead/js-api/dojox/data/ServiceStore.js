//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(h,g,k){return h("dojox.data.ServiceStore",g.getObject("dojox.data.ClientFilter",0)||null,{service:null,constructor:function(a){this.byId=this.fetchItemByIdentity;this._index={};a&&g.mixin(this,a);this.idAttribute=a&&a.idAttribute||this.schema&&this.schema._idAttr},schema:null,idAttribute:"id",labelAttribute:"label",syncMode:!1,estimateCountFactor:1,getSchema:function(){return this.schema},loadLazyValues:!0,getValue:function(a,
b,c){var d=a[b];return d||(b in a?d:a._loadObject?(dojox.rpc._sync=!0,arguments.callee.call(this,dojox.data.ServiceStore.prototype.loadItem({item:a})||{},b,c)):c)},getValues:function(a,b){a=this.getValue(a,b);return a instanceof Array?a:void 0===a?[]:[a]},getAttributes:function(a){var b=[],c;for(c in a)!a.hasOwnProperty(c)||"_"==c.charAt(0)&&"_"==c.charAt(1)||b.push(c);return b},hasAttribute:function(a,b){return b in a},containsValue:function(a,b,c){return-1<k.indexOf(this.getValues(a,b),c)},isItem:function(a){return"object"==
typeof a&&a&&!(a instanceof Date)},isItemLoaded:function(a){return a&&!a._loadObject},loadItem:function(a){var b;a.item._loadObject?a.item._loadObject(function(c){b=c;delete b._loadObject;var d=c instanceof Error?a.onError:a.onItem;d&&d.call(a.scope,c)}):a.onItem&&a.onItem.call(a.scope,a.item);return b},_currentId:0,_processResults:function(a,b){if(a&&"object"==typeof a){var c=a.__id;if(!c&&(c=this.idAttribute?a[this.idAttribute]:this._currentId++,void 0!==c)){var d=this._index[c];if(d){for(var e in d)delete d[e];
a=g.mixin(d,a)}a.__id=c;this._index[c]=a}for(var f in a)a[f]=this._processResults(a[f],b).items;c=a.length}return{totalCount:b.request.count==c?(b.request.start||0)+c*this.estimateCountFactor:c,items:a}},close:function(a){return a&&a.abort&&a.abort()},fetch:function(a){a=a||{};if("syncMode"in a?a.syncMode:this.syncMode)dojox.rpc._sync=!0;var b=this,c=a.scope||b,d=this.cachingFetch?this.cachingFetch(a):this._doQuery(a);d.request=a;d.addCallback(function(e){a.clientFetch&&(e=b.clientSideFetch({query:a.clientFetch,
sort:a.sort,start:a.start,count:a.count},e));var f=b._processResults(e,d);e=a.results=f.items;a.onBegin&&a.onBegin.call(c,f.totalCount,a);if(a.onItem)for(f=0;f<e.length;f++)a.onItem.call(c,e[f],a);a.onComplete&&a.onComplete.call(c,a.onItem?null:e,a);return e});d.addErrback(a.onError&&function(b){return a.onError.call(c,b,a)});a.abort=function(){d.cancel()};a.store=this;return a},_doQuery:function(a){return this.service("string"==typeof a.queryStr?a.queryStr:a.query)},getFeatures:function(){return{"dojo.data.api.Read":!0,
"dojo.data.api.Identity":!0,"dojo.data.api.Schema":this.schema}},getLabel:function(a){return this.getValue(a,this.labelAttribute)},getLabelAttributes:function(a){return[this.labelAttribute]},getIdentity:function(a){return a.__id},getIdentityAttributes:function(a){return[this.idAttribute]},fetchItemByIdentity:function(a){var b=this._index[(a._prefix||"")+a.identity];if(b){if(b._loadObject)return a.item=b,this.loadItem(a);a.onItem&&a.onItem.call(a.scope,b)}else return this.fetch({query:a.identity,onComplete:a.onItem,
onError:a.onError,scope:a.scope}).results;return b}})});