//>>built
define(["dojo","../library/icons","../util/common","../Drawing","../manager/_registry"],function(c,w,x,z,h){return c.declare("dojox.drawing.ui.Toolbar",[],{constructor:function(a,b){a.drawing?(this.drawing=this.toolDrawing=a.drawing,this.width=this.toolDrawing.width,this.height=this.toolDrawing.height,this.strSelected=a.selected,this.strTools=a.tools,this.strPlugs=a.plugs,this._mixprops(["padding","margin","size","radius"],a),this.addBack(),this.orient=a.orient?a.orient:!1):(a=c.marginBox(b),this.width=
a.w,this.height=a.h,this.strSelected=c.attr(b,"selected"),this.strTools=c.attr(b,"tools"),this.strPlugs=c.attr(b,"plugs"),this._mixprops(["padding","margin","size","radius"],b),this.toolDrawing=new z({mode:"ui"},b),this.orient=c.attr(b,"orient"));this.horizontal=this.orient?"H"==this.orient:this.width>this.height;console.log("this.hor: ",this.horizontal," orient: ",this.orient);this.toolDrawing.ready?(this.makeButtons(),!this.strSelected&&this.drawing.defaults.clickMode&&this.drawing.mouse.setCursor("default")):
c.connect(this.toolDrawing,"onSurfaceReady",this,function(){c.disconnect(a);this.drawing=h.getRegistered("drawing",c.attr(b,"drawingId"));this.makeButtons();if(!this.strSelected&&this.drawing.defaults.clickMode)var a=c.connect(this.drawing,"onSurfaceReady",this,function(){c.disconnect(a);this.drawing.mouse.setCursor("default")})})},padding:10,margin:5,size:30,radius:3,toolPlugGap:20,strSelected:"",strTools:"",strPlugs:"",makeButtons:function(){this.buttons=[];this.plugins=[];var a=this.padding,b=
this.padding,q=this.size,k=this.size,r=this.radius,n=this.margin,t={place:"BR",size:2,mult:4};if(this.strTools){var p=[],g=h.getRegistered("tool"),u={},m;for(m in g){var l=x.abbr(m);u[l]=g[m];"all"==this.strTools&&(p.push(l),l=h.getRegistered("tool",m),l.secondary&&p.push(l.secondary.name))}"all"!=this.strTools&&(g=this.strTools.split(","),c.forEach(g,function(a){a=c.trim(a);p.push(a);a=h.getRegistered("tool",u[a].name);a.secondary&&p.push(a.secondary.name)},this));c.forEach(p,function(e){e=c.trim(e);
var d=!1;if(-1<e.indexOf("Secondary")){var d=e.substring(0,e.indexOf("Secondary")),d=h.getRegistered("tool",u[d].name).secondary,f=d.label;this[e]=d.funct;d.setup&&c.hitch(this,d.setup)();f=this.toolDrawing.addUI("button",{data:{x:a,y:b,width:q,height:k/2,r:r},toolType:e,secondary:!0,text:f,shadow:t,scope:this,callback:this[e]});d.postSetup&&c.hitch(this,d.postSetup,f)();d=!0}else f=this.toolDrawing.addUI("button",{data:{x:a,y:b,width:q,height:k,r:r},toolType:e,icon:w[e],shadow:t,scope:this,callback:"onToolClick"});
h.register(f,"button");this.buttons.push(f);this.strSelected==e&&(f.select(),this.selected=f,this.drawing.setTool(f.toolType));this.horizontal?a+=k+n:b+=d?k/2+n:k+n},this)}this.horizontal?a+=this.toolPlugGap:b+=this.toolPlugGap;if(this.strPlugs){var g=[],l=h.getRegistered("plugin"),v={};for(m in l){var y=x.abbr(m);v[y]=l[m];"all"==this.strPlugs&&g.push(y)}"all"!=this.strPlugs&&(g=this.strPlugs.split(","),c.map(g,function(a){return c.trim(a)}));c.forEach(g,function(e){var d=c.trim(e);if(0!=v[e].button){var f=
this.toolDrawing.addUI("button",{data:{x:a,y:b,width:q,height:k,r:r},toolType:d,icon:w[d],shadow:t,scope:this,callback:"onPlugClick"});h.register(f,"button");this.plugins.push(f);this.horizontal?a+=k+n:b+=k+n}d={};0==v[e].button?d={name:this.drawing.stencilTypeMap[e]}:d={name:this.drawing.stencilTypeMap[e],options:{button:f}};this.drawing.addPlugin(d)},this)}c.connect(this.drawing,"onRenderStencil",this,"onRenderStencil")},onRenderStencil:function(a){this.drawing.defaults.clickMode&&(this.drawing.mouse.setCursor("default"),
this.selected&&this.selected.deselect(),this.selected=null)},addTool:function(){},addPlugin:function(){},addBack:function(){this.toolDrawing.addUI("rect",{data:{x:0,y:0,width:this.width,height:this.size+2*this.padding,fill:"#ffffff",borderWidth:0}})},onToolClick:function(a){this.drawing.defaults.clickMode&&this.drawing.mouse.setCursor("crosshair");c.forEach(this.buttons,function(b){b.id==a.id?(b.select(),this.selected=b,this.drawing.setTool(a.toolType)):b.secondary||b.deselect()},this)},onPlugClick:function(a){},
_mixprops:function(a,b){c.forEach(a,function(a){this[a]=b.tagName?null===c.attr(b,a)?this[a]:c.attr(b,a):void 0===b[a]?this[a]:b[a]},this)}})});