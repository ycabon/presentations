//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo dojo/request dojo/has".split(" "),function(e,l,h,c,k,m){return e("dojox.form.uploader._HTML5",[],{errMsg:"Error uploading files. Try checking permissions",uploadType:"html5",postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.connectForm();this.inherited(arguments);this.uploadOnSelect&&this.connect(this,"onChange",function(a){this.upload(a[0])})},_drop:function(a){c.stopEvent(a);this._files=a.dataTransfer.files;
this.onChange(this.getFileList())},upload:function(a){this.onBegin(this.getFileList());this.uploadWithFormData(a)},addDropTarget:function(a,b){b||(this.connect(a,"dragenter",c.stopEvent),this.connect(a,"dragover",c.stopEvent),this.connect(a,"dragleave",c.stopEvent));this.connect(a,"drop","_drop")},uploadWithFormData:function(a){function b(a){f._xhrProgress(a);"load"===a.type&&(f.onComplete(d.response.data),d.response.xhr.removeEventListener("load",b,!1),d.response.xhr.upload.removeEventListener("progress",
b,!1),d=null)}if(this.getUrl()){var c=new FormData,e=this._getFileFieldName();h.forEach(this._files,function(a,b){c.append(e,a)},this);if(a){a.uploadType=this.uploadType;for(var g in a)c.append(g,a[g])}var f=this,d=k(this.getUrl(),{method:"POST",data:c,handleAs:"json",uploadProgress:!0,headers:{Accept:"application/json"}},!0);d.promise.response.otherwise(function(a){console.error(a);console.error(a.response.text);f.onError(a)});d.response.xhr.addEventListener("load",b,!1);d.response.xhr.upload.addEventListener("progress",
b,!1)}else console.error("No upload url found.",this)},_xhrProgress:function(a){if(a.lengthComputable){var b={bytesLoaded:a.loaded,bytesTotal:a.total,type:a.type,timeStamp:a.timeStamp};"load"==a.type?(b.percent="100%",b.decimal=1):(b.decimal=a.loaded/a.total,b.percent=Math.ceil(a.loaded/a.total*100)+"%");this.onProgress(b)}}})});