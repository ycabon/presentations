//>>built
define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(t,m,q,p,f,r){return q("dojox.grid._Layout",null,{constructor:function(a){this.grid=a},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(a,c,b,e,f){var h=this.structure[a].cells[0],g=this.structure[c].cells[0],d=null,n=d=0;a=0;for(var k;k=h[a];a++)if(k.index==b){d=a;break}d=h.splice(d,1)[0];d.view=this.grid.views.views[c];a=0;for(k=null;k=
g[a];a++)if(k.index==e){n=a;break}f||(n+=1);g.splice(n,0,d);if(b=this.grid.getCell(this.grid.getSortIndex()))b._currentlySorted=this.grid.getSortAsc();this.cells=[];for(a=b=0;c=this.structure[a];a++)for(e=0;f=c.cells[e];e++)for(h=0;k=f[h];h++)k.index=b,this.cells.push(k),"_currentlySorted"in k&&(g=b+1,g*=k._currentlySorted?1:-1,this.grid.sortInfo=g,delete k._currentlySorted),b++;p.forEach(this.cells,function(a){var b=a.markup[2].split(" ");parseInt(b[1].substring(5))!=a.index&&(b[1]='idx\x3d"'+a.index+
'"',a.markup[2]=b.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(a,c){a=this.cells[a];if(a.hidden==c){a.hidden=!c;c=a.view;var b=c.viewWidth;b&&"auto"!=b&&(c._togglingColumn=r.getMarginBox(a.getHeaderNode()).w||0);c.update();return!0}return!1},addCellDef:function(a,c,b){var e=this,l=function(a){var b=0;1<a.colSpan?b=0:(b=a.width||e._defaultCellProps.width||e.defaultWidth,isNaN(b)||(b+="em"));return b};a={grid:this.grid,subrow:a,layoutIndex:c,index:this.cells.length};if(b&&
b instanceof m.grid.cells._Base)return c=f.clone(b),a.unitWidth=l(c._props),c=f.mixin(c,this._defaultCellProps,b._props,a);c=b.type||b.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||m.grid.cells.Cell;f.isString(c)&&(c=f.getObject(c));a.unitWidth=l(b);return new c(f.mixin({},this._defaultCellProps,b,a))},addRowDef:function(a,c){for(var b=[],e=0,f=0,h=!0,g=0,d;d=c[g];g++)d=this.addCellDef(a,g,d),b.push(d),this.cells.push(d),h&&d.relWidth?e+=d.relWidth:d.width&&(d=d.width,"string"==
typeof d&&"%"==d.slice(-1)?f+=window.parseInt(d,10):"auto"==d&&(h=!1));e&&h&&p.forEach(b,function(a){a.relWidth&&(a.width=a.unitWidth=a.relWidth/e*(100-f)+"%")});return b},addRowsDef:function(a){var c=[];if(f.isArray(a))if(f.isArrayLike(a[0]))for(var b=0,e;a&&(e=a[b]);b++)c.push(this.addRowDef(b,e));else c.push(this.addRowDef(0,a));return c},addViewDef:function(a){this._defaultCellProps=a.defaultCell||{};a.width&&"auto"==a.width&&delete a.width;return f.mixin({},a,{cells:this.addRowsDef(a.rows||a.cells)})},
setStructure:function(a){this.fieldIndex=0;this.cells=[];var c=this.structure=[];if(this.grid.rowSelector){var b={type:m._scopeName+".grid._RowSelector"};if(f.isString(this.grid.rowSelector)){var e=this.grid.rowSelector;"false"==e?b=null:"true"!=e&&(b.width=e)}else this.grid.rowSelector||(b=null);b&&c.push(this.addViewDef(b))}var l=function(a){return"name"in a||"field"in a||"get"in a},b=function(a){return f.isArray(a)&&(f.isArray(a[0])||l(a[0]))?!0:!1},e=function(a){return null!==a&&f.isObject(a)&&
("cells"in a||"rows"in a||"type"in a&&!l(a))};if(f.isArrayLike(a)){for(var h=!1,g=0,d;d=a[g];g++)if(e(d)){h=!0;break}if(h)for(g=0;d=a[g];g++)b(d)?c.push(this.addViewDef({cells:d})):e(d)&&c.push(this.addViewDef(d));else c.push(this.addViewDef({cells:a}))}else e(a)&&c.push(this.addViewDef(a));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})});