//>>built
define("dojo/_base/declare dojo/_base/array dojo/_base/lang ../_Plugin ../../_RowSelector ../../EnhancedGrid ../../cells/_base".split(" "),function(n,g,c,p,q,r){var t=c.getObject("dojox.grid.cells"),f=n("dojox.grid.enhanced.plugins.Exporter",p,{name:"exporter",constructor:function(a,b){this.grid=a;this.formatter=b&&c.isObject(b)&&b.exportFormatter;this._mixinGrid()},_mixinGrid:function(){var a=this.grid;a.exportTo=c.hitch(this,this.exportTo);a.exportGrid=c.hitch(this,this.exportGrid);a.exportSelected=
c.hitch(this,this.exportSelected);a.setExportFormatter=c.hitch(this,this.setExportFormatter)},setExportFormatter:function(a){this.formatter=a},exportGrid:function(a,b,e){c.isFunction(b)&&(e=b,b={});if(c.isString(a)&&c.isFunction(e)){b=b||{};var h=this.grid,d=this,l=this._getExportWriter(a,b.writerArgs);b=b.fetchArgs&&c.isObject(b.fetchArgs)?b.fetchArgs:{};var f=b.onComplete;if(h.store)b.onComplete=function(a,b){f&&f(a,b);e(d._goThroughGridData(a,l))},b.sort=b.sort||h.getSortProps(),h._storeLayerFetch(b);
else{a=b.start||0;b=b.count||-1;for(var m=[],k=a;k!=a+b&&k<h.rowCount;++k)m.push(h.getItem(k));e(this._goThroughGridData(m,l))}}},exportSelected:function(a,b,e){if(!c.isString(a))return"";a=this._getExportWriter(a,b);return e(this._goThroughGridData(this.grid.selection.getSelected(),a))},_buildRow:function(a,b){var e=this;g.forEach(a._views,function(c,d){a.view=c;a.viewIdx=d;b.beforeView(a)&&(g.forEach(c.structure.cells,function(c,d){a.subrow=c;a.subrowIdx=d;b.beforeSubrow(a)&&(g.forEach(c,function(c,
d){a.isHeader&&e._isSpecialCol(c)&&a.spCols.push(c.index);a.cell=c;a.cellIdx=d;b.handleCell(a)}),b.afterSubrow(a))}),b.afterView(a))})},_goThroughGridData:function(a,b){var c=this.grid,f=g.filter(c.views.views,function(a){return!(a instanceof q)}),d={grid:c,isHeader:!0,spCols:[],_views:f,colOffset:f.length<c.views.views.length?-1:0};b.beforeHeader(c)&&(this._buildRow(d,b),b.afterHeader());d.isHeader=!1;b.beforeContent(a)&&(g.forEach(a,function(a,c){d.row=a;d.rowIdx=c;b.beforeContentRow(d)&&(this._buildRow(d,
b),b.afterContentRow(d))},this),b.afterContent());return b.toString()},_isSpecialCol:function(a){return a.isRowSelector||a instanceof t.RowIndex},_getExportWriter:function(a,b){var e;e=f;if(e.writerNames){a=e.writerNames[a.toLowerCase()];if(e=c.getObject(a))return b=new e(b),b.formatter=this.formatter,b;throw Error('Please make sure class "'+a+'" is required.');}throw Error('The writer for "'+a+'" has not been registered.');}});f.registerWriter=function(a,b){f.writerNames=f.writerNames||{};f.writerNames[a]=
b};r.registerPlugin(f);return f});