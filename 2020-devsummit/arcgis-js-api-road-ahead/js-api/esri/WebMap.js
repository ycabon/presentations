// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(p,m,l){Object.defineProperty(m,"__esModule",{value:!0});m.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var b=a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&l.isMultiOriginJSONMixin(b)&&b.updateOrigin(a.propName,a.newOrigin)})}})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(p,m,l,a,b,c,d,g){var t=c.getLogger("esri.tasks.support.ProjectParameters");return function(b){function c(a){a=b.call(this,a)||this;a.geometries=null;a.outSpatialReference=null;a.transformation=null;a.transformForward=null;return a}l(c,b);Object.defineProperty(c.prototype,"outSR",{get:function(){t.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){t.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});c.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),b=this.geometries[0],d={};d.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());d.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());d.geometries=JSON.stringify({geometryType:g.getJsonType(b),geometries:a});this.transformation&&(d.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(d.transformForward=this.transformForward);return d};a([d.property()],c.prototype,"geometries",void 0);a([d.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);a([d.property({json:{read:!1}})],c.prototype,"outSR",null);a([d.property()],c.prototype,"transformation",void 0);a([d.property()],c.prototype,"transformForward",void 0);return c=a([d.subclass("esri.tasks.support.ProjectParameters")],c)}(d.declared(b.JSONSupport))})},"esri/webdoc/RangeInfo":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators".split(" "),
function(p,m,l,a,b,c,d){return function(b){function g(a){a=b.call(this,a)||this;a.activeRange=null;a.currentRangeExtent=null;a.fullRangeExtent=null;return a}l(g,b);f=g;g.prototype.clone=function(){return new f(c.clone({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))};var f;a([d.property({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],g.prototype,"activeRange",void 0);
a([d.property({type:[Number],json:{write:!0}})],g.prototype,"currentRangeExtent",void 0);a([d.property({type:[Number],json:{write:!0}})],g.prototype,"fullRangeExtent",void 0);return g=f=a([d.subclass("esri.webdoc.RangeInfo")],g)}(d.declared(b.JSONSupport))})},"esri/webdoc/Widgets":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./widgets/Range ./widgets/TimeSlider".split(" "),
function(p,m,l,a,b,c,d,g,t){return function(b){function f(a){a=b.call(this,a)||this;a.range=null;a.timeSlider=null;return a}l(f,b);k=f;f.prototype.clone=function(){return new k(c.clone({range:this.range,timeSlider:this.timeSlider}))};var k;a([d.property({type:g,json:{write:!0}})],f.prototype,"range",void 0);a([d.property({type:t,json:{write:!0}})],f.prototype,"timeSlider",void 0);return f=k=a([d.subclass("esri.webdoc.Widgets")],f)}(d.declared(b.JSONSupport))})},"esri/webdoc/widgets/Range":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,m,l,a,b,c,d){var g=new b.default({slider:"slider",picker:"picker"});return function(b){function c(a){a=b.call(this,a)||this;a.interactionMode=null;a.numStops=null;a.stopInterval=null;return a}l(c,b);n=c;c.prototype.clone=function(){return new n({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})};var n;a([d.property({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,default:null,read:{reader:g.read},write:{isRequired:!0,writer:g.write}}})],
c.prototype,"interactionMode",void 0);a([d.property({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy:function(){var a=null!=this.stopInterval;return{enabled:!a,isRequired:!a}}}}})],c.prototype,"numStops",void 0);a([d.property({type:Number,json:{write:{overridePolicy:function(){return{isRequired:null==this.numStops}}}}})],c.prototype,"stopInterval",void 0);return c=n=a([d.subclass("esri.webdoc.widgets.Range")],c)}(d.declared(c.JSONSupport))})},"esri/webdoc/widgets/TimeSlider":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../TimeExtent ../../TimeInterval ../../core/JSONSupport ../../core/lang ../../core/object ../../core/accessorSupport/decorators".split(" "),
function(p,m,l,a,b,c,d,g,t,f){return function(d){function k(a){a=d.call(this,a)||this;a.currentTimeExtent=null;a.fullTimeExtent=null;a.numStops=null;a.numThumbs=null;a.stopDelay=null;a.stopInterval=null;return a}l(k,d);n=k;k.prototype.readCurrentTimeExtent=function(a){if(a)return new b({start:null!=a[0]?new Date(a[0]):null,end:null!=a[1]?new Date(a[1]):null})};k.prototype.writeCurrentTimeExtent=function(a,b,d){a&&t.setDeepValue(d,[a.start?a.start.getTime():null,a.end?a.end.getTime():null],b)};k.prototype.readFullTimeExtent=
function(a,d){if(a=d.properties)return new b({start:null!=a.startTime?new Date(a.startTime):null,end:null!=a.endTime?new Date(a.endTime):null})};k.prototype.writeFullTimeExtent=function(a,b){if(a){b=b.properties=b.properties||{};var d=a.end;a=a.start;d&&(b.endTime=d?d.getTime():null);a&&(b.startTime=a?a.getTime():null)}};k.prototype.readStopInterval=function(a,b,d){return a?c.fromJSON({value:a.interval,unit:a.units},d):null};k.prototype.writeStopInterval=function(a,b,d,c){a&&(a=a.toJSON(c),t.setDeepValue(d,
{interval:a.value,units:a.unit},b))};k.prototype.clone=function(){return new n(g.clone({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval}))};var n;a([f.property({type:b,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],k.prototype,"currentTimeExtent",void 0);a([f.reader("currentTimeExtent")],k.prototype,"readCurrentTimeExtent",
null);a([f.writer("currentTimeExtent")],k.prototype,"writeCurrentTimeExtent",null);a([f.property({type:b,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],k.prototype,"fullTimeExtent",void 0);a([f.reader("fullTimeExtent")],k.prototype,"readFullTimeExtent",null);a([f.writer("fullTimeExtent")],k.prototype,"writeFullTimeExtent",null);a([f.property({type:Number,json:{read:{source:"properties.numberOfStops"},
write:{target:"properties.numberOfStops",overridePolicy:function(){var a=!!this.stopInterval;return{enabled:!a,isRequired:!a}}}}})],k.prototype,"numStops",void 0);a([f.property({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],k.prototype,"numThumbs",void 0);a([f.property({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],k.prototype,
"stopDelay",void 0);a([f.property({type:c,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy:function(){return{isRequired:null==this.numStops}}}}})],k.prototype,"stopInterval",void 0);a([f.reader("stopInterval")],k.prototype,"readStopInterval",null);a([f.writer("stopInterval")],k.prototype,"writeStopInterval",null);return k=n=a([f.subclass("esri.webdoc.widgets.TimeSlider")],k)}(f.declared(d.JSONSupport))})},"esri/webdoc/support/thumbnailUtils":function(){define(["require",
"exports"],function(p,m){Object.defineProperty(m,"__esModule",{value:!0});var l={width:600,height:400};m.getOptimalThumbnailSize=function(a,b){b=b||l;var c=b.width;b=b.height;var d=c/b;1.5>d?b=c/1.5:1.5<d&&(c=1.5*b);c>a.width&&(b*=a.width/c,c=a.width);b>a.height&&(c*=a.height/b,b=a.height);return{width:Math.round(c),height:Math.round(b)}}})},"esri/webmap/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(p,m,l,a,b,c,d,g){return function(b){function f(a){a=b.call(this,a)||this;a.editing=null;a.offline=null;a.viewing=null;return a}l(f,b);n=f;f.prototype.clone=function(){return new n(c.clone({editing:this.editing,offline:this.offline,viewing:this.viewing}))};var n;a([d.property({json:{write:!0}})],f.prototype,"editing",void 0);a([d.property({json:{write:!0}})],f.prototype,"offline",void 0);a([d.property({type:g,json:{write:!0}})],f.prototype,"viewing",void 0);return f=n=a([d.subclass("esri.webmap.ApplicationProperties")],
f)}(d.declared(b.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),function(p,m,l,a,b,c,d,g){return function(b){function f(a){a=b.call(this,a)||this;a.search=null;return a}l(f,b);n=f;f.prototype.clone=function(){return new n(c.clone({search:this.search}))};var n;a([d.property({type:g,
json:{write:!0}})],f.prototype,"search",void 0);return f=n=a([d.subclass("esri.webdoc.applicationProperties.Viewing")],f)}(d.declared(b.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),function(p,m,l,a,b,c,d,g,t){var f=b.ofType(t);return function(b){function c(a){a=
b.call(this,a)||this;a.addressSearchEnabled=!0;a.enabled=!0;a.hintText=null;a.layers=new f;return a}l(c,b);n=c;c.prototype.readAddressSearchEnabled=function(a){return!a};c.prototype.writeAddressSearchEnabled=function(a,b,c){b[c]=!a};c.prototype.clone=function(){return new n(d.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var n;a([g.property({type:Boolean,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},
default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);a([g.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);a([g.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);a([g.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);a([g.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);a([g.property({type:f,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,
"layers",void 0);return c=n=a([g.subclass("esri.webdoc.applicationProperties.Search")],c)}(g.declared(c.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(p,m,l,a,b,c,d,g,t){return function(b){function f(a){a=b.call(this,
a)||this;a.field=null;a.id=null;a.subLayer=null;return a}l(f,b);k=f;f.prototype.clone=function(){return new k(c.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var k;a([d.property({type:t,json:{write:{enabled:!0,isRequired:!0}}})],f.prototype,"field",void 0);a([d.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],f.prototype,"id",void 0);a([d.property({type:g.Integer,json:{write:!0}})],f.prototype,"subLayer",void 0);return f=k=a([d.subclass("esri.webdoc.applicationProperties.SearchLayer")],
f)}(d.declared(b.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(p,m,l,a,b,c,d){return function(b){function g(a){a=b.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}l(g,b);f=g;g.prototype.clone=function(){return new f({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var f;a([c.property({type:Boolean,json:{write:!0}})],g.prototype,"exactMatch",void 0);a([c.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);a([c.enumeration.serializable()(d.kebabDict)],g.prototype,"type",void 0);return g=f=a([c.subclass("esri.webdoc.applicationProperties.SearchLayerField")],g)}(c.declared(b.JSONSupport))})},"esri/webmap/Bookmark":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Identifiable ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ../webdoc/support/Thumbnail".split(" "),
function(p,m,l,a,b,c,d,g,t,f,n){return function(b){function c(a){a=b.call(this,a)||this;a.extent=null;a.name=null;a.thumbnail=new n.default;return a}l(c,b);k=c;c.prototype.castThumbnail=function(a){return"string"===typeof a?new n.default({url:a}):t.ensureType(n.default,a)};c.prototype.clone=function(){return new k(d.clone({extent:this.extent,name:this.name,thumbnail:this.thumbnail}))};var k;a([g.property({type:f,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"extent",void 0);a([g.property({type:String,
nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"name",void 0);a([g.property({type:n.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.url)}}}}})],c.prototype,"thumbnail",void 0);a([g.cast("thumbnail")],c.prototype,"castThumbnail",null);return c=k=a([g.subclass("esri.webmap.Bookmark")],c)}(g.declared(b.IdentifiableMixin(c.JSONSupport)))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,m,l,a,b,c){Object.defineProperty(m,"__esModule",{value:!0});p=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.url="";return a}l(d,b);m=d;d.prototype.clone=function(){return new m({url:this.url})};var m;a([c.property({type:String,json:{write:{isRequired:!0}}})],d.prototype,"url",void 0);return d=m=a([c.subclass("esri.webdoc.support.Thumbnail")],d)}(c.declared(b.JSONSupport));m.default=p})},"esri/webmap/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/lang ../core/accessorSupport/decorators ../geometry/SpatialReference ../webdoc/RangeInfo ./background/ColorBackground".split(" "),
function(p,m,l,a,b,c,d,g,t,f,n){return function(c){function k(a){a=c.call(this,a)||this;a.background=null;a.rangeInfo=null;a.spatialReference=null;a.viewpoint=null;return a}l(k,c);m=k;k.prototype.clone=function(){return new m(d.clone({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))};var m;a([g.property({type:n})],k.prototype,"background",void 0);a([g.property({type:f})],k.prototype,"rangeInfo",void 0);a([g.property({type:t})],
k.prototype,"spatialReference",void 0);a([g.property({type:b})],k.prototype,"viewpoint",void 0);return k=m=a([g.subclass("esri.webmap.InitialViewProperties")],k)}(g.declared(c))})},"esri/webmap/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators".split(" "),function(p,m,l,a,b,c,d,g,t){return function(b){function d(a){a=
b.call(this,a)||this;a.color=new c([0,0,0,1]);return a}l(d,b);f=d;d.prototype.clone=function(){return new f(g.clone({color:this.color}))};var f;a([t.property({type:c,json:{write:!0}})],d.prototype,"color",void 0);return d=f=a([t.subclass("esri.webmap.background.ColorBackground")],d)}(t.declared(d.JSONSupport))})},"esri/webmap/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(p,m,l,a){Object.defineProperty(m,"__esModule",{value:!0});p=function(a){function b(b,
c){return a.call(this,b,c,"webmap")||this}l(b,a);return b}(a.Version);m.Version=p;m.default=p})},"esri/core/Version":function(){define(["require","exports","./Error"],function(p,m,l){Object.defineProperty(m,"__esModule",{value:!0});p=function(){function a(a,c,d){void 0===d&&(d="");this.major=a;this.minor=c;this._context=d}a.prototype.lessThan=function(a,c){return this.major<a||a===this.major&&this.minor<c};a.prototype.since=function(a,c){return!this.lessThan(a,c)};a.prototype.validate=function(a){if(this.major!==
a.major)throw new l((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(b,c){void 0===c&&(c="");var d=b.split("."),g=d[0],d=d[1],m=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(m))throw new l((c&&c+":")+"invalid-version","Expected major version to be a number, but got '${version}'",
{version:b});if(!d||!d.match||!d.match(m))throw new l((c&&c+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:b});b=parseInt(g,10);g=parseInt(d,10);return new a(b,g,c)};return a}();m.Version=p})},"*noref":1}});
define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./core/tsSupport/paramHelper ./kernel ./Map ./Viewpoint ./core/arrayUtils ./core/Collection ./core/Error ./core/JSONSupport ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/watchUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/SpatialReference ./geometry/support/webMercatorUtils ./layers/support/arcgisLayerUrl ./portal/Portal ./portal/PortalItem ./portal/support/portalItemUtils ./tasks/support/ProjectParameters ./webdoc/RangeInfo ./webdoc/Widgets ./webdoc/support/thumbnailUtils ./webdoc/support/writeUtils ./webmap/ApplicationProperties ./webmap/Bookmark ./webmap/InitialViewProperties ./webmap/Version ./webmap/background/ColorBackground @dojo/framework/shim/Promise".split(" "),function(p,
m,l,a,b,c,d,g,t,f,n,k,N,v,F,O,P,Q,G,R,w,x,S,r,T,U,E,H,V,z,I,u,J,K,W,X,Y,Z,aa,A,B,L){var C=new B.default(2,16),M=N.ofType(aa),D=Q.getLogger("esri.WebMap"),y=new Map;y.set("image/jpeg","jpeg");y.set("image/jpg","jpg");y.set("image/png","png");y.set("image/gif","gif");var ba="NatGeo_World_Map Ocean_Basemap USA_Topo_Maps World_Imagery World_Street_Map World_Terrain_Base World_Topo_Map World_Hillshade Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Reference_Overlay Reference/World_Transportation".split(" ").map(function(a){return a.toLowerCase()});
return function(f){function e(a){a=f.call(this,a)||this;a.applicationProperties=null;a.bookmarks=new M;a.initialViewProperties=new A;a.portalItem=null;a.presentation=null;a.sourceVersion=null;a.tables=null;a.widgets=null;a.authoringApp=a.authoringAppVersion=null;a._isAuthoringAppSetByUser=a._isAuthoringAppVersionSetByUser=!1;return a}a(e,f);e.prototype.initialize=function(){this.when().catch(function(a){D.error("#load()","Failed to load web map",a)});if(this.resourceInfo){var a=void 0;try{a=this._validateJSON(this.resourceInfo)}catch(q){this.addResolvingPromise(w.reject(q));
return}this.read(a)}};Object.defineProperty(e.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringApp=function(a,q){q.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(e.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringAppVersion=
function(a,q){q.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:t.version};e.prototype.readInitialViewProperties=function(a,q){a=new A;q.background&&(a.background=L.fromJSON(q.background));q.mapRangeInfo&&(a.rangeInfo=K.fromJSON(q.mapRangeInfo));q.spatialReference&&(a.spatialReference=E.fromJSON(q.spatialReference));return a};e.prototype.writeInitialViewProperties=function(a,q,b,c){a&&((b=a.background)&&b.color&&(q.background=b.write(null,c)),a.rangeInfo&&(q.mapRangeInfo=a.rangeInfo.toJSON(c)),
a.spatialReference&&(q.spatialReference=a.spatialReference.write(null,c)))};e.prototype.writeLayers=function(a,b,c,d){var h=this;d=l({},d,{layerContainerType:"operational-layers"});a=a.map(function(a){return Y.getLayerJSON(a,h._getLayerJSONFromResourceInfo(a),d)}).filter(function(a){return!!a});b[c]=a.toArray()};e.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new B.default(parseInt(a[0],10),parseInt(b,10))};e.prototype.writeSourceVersion=function(a,b,c){b[c]=C.major+
"."+C.minor};Object.defineProperty(e.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?(this._override("thumbnailUrl",a),this._thumbnailFilename=this._generateCustomThumbnailFilename(a)):this._clearThumbnailOverride()},enumerable:!0,configurable:!0});e.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return w.resolve(this)};e.prototype.loadAll=function(){var a=this;return P.loadAll(this,function(h){h(a.ground,
a.basemap,a.layers)})};e.prototype.read=function(a,b){var h=this;b=l({},b,{origin:"web-map"});var c=this._getAuthoringPropsState(),q=arguments;U.readLoadable(this,a,function(b){return h.inherited(q,[a,b])},b);this._restoreAuthoringPropsFromState(c)};e.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var h=new v("webmap:not-loaded","Web map must be loaded before it can be serialized");D.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus);
throw h;}this._removeDanglingLayerRefs();b=l({},b,{origin:"web-map",restrictedWebMapWriting:!0});return this.inherited(arguments,[a,b])};e.prototype.save=function(a){return d(this,void 0,void 0,function(){var h,b,d;return c(this,function(c){switch(c.label){case 0:return a=a||{},this._validateItem(),[4,this._updateFromPromise];case 1:return c.sent(),[4,this.load()];case 2:return c.sent(),[4,this._loadLayerContainers()];case 3:return c.sent(),h=this.portalItem,b={origin:"web-map",messages:[],writtenProperties:[],
url:h.itemUrl&&x.urlToObject(h.itemUrl),portal:h.portal||z.getDefault()},d=this.write(null,b),this._validateJSONForWriting(b,a),[4,this._updateItemProperties(h)];case 4:return c.sent(),[4,this._updateItem(h,d,b)];case 5:return c.sent(),[4,this._updateItemThumbnail()];case 6:return c.sent(),[2,h]}})})};e.prototype.saveAs=function(a,b){return d(this,void 0,void 0,function(){var h,d,q,e;return c(this,function(c){switch(c.label){case 0:return b=b||{},h=this._getPortalItem(a),[4,this._updateFromPromise];
case 1:return c.sent(),[4,this.load()];case 2:return c.sent(),[4,this._loadLayerContainers()];case 3:return c.sent(),d={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:h.portal},q=this.write(null,d),this._validateJSONForWriting(d,b),[4,this._updateItemPropertiesForSaveAs(h)];case 4:return c.sent(),e=this._getThumbnailState(),[4,this._createItem(h,q,d,b)];case 5:return c.sent(),this._restoreThumbnailFromState(e),[4,this._updateItemThumbnail()];case 6:return c.sent(),[2,h]}})})};e.prototype.updateFrom=
function(a,b){return d(this,void 0,void 0,function(){var h,d;return c(this,function(c){switch(c.label){case 0:return this._updateFromPromise=h=this._updateFromInternal(a,b),[4,h];case 1:c.sent();if(d=h===this._updateFromPromise)this._updateFromPromise=null;return[2]}})})};e.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):w.resolve(null)};e.prototype._loadFromItem=
function(a){var h=this;return a.load().catch(function(a){throw new v("webmap:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Map"!==a.type)throw new v("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(b){h.resourceInfo=b;return h._readAndLoadFromJSON(b,{origin:"web-map",portal:a.portal||z.getDefault()})}).then(function(){return h._getInitialExtent()}).then(function(a){if(a){var b=
h.initialViewProperties?h.initialViewProperties.clone():new A;b.viewpoint=new n;b.viewpoint.targetGeometry=a;h.initialViewProperties=b}})};e.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};e.prototype._validateJSON=function(a){var h=B.default.parse(a.version||"","webmap");C.validate(h);a.version=h.major+"."+h.minor;return a};e.prototype._loadFromJSON=function(a,b){var h=this,c={context:l({},b,{layerContainerType:"operational-layers"})};
this.portalItem&&(c.context.portal=this.portalItem.portal||z.getDefault());return w.create(function(a){return p(["./portal/support/layersCreator"],a)}).then(function(b){var d=[],q=a.operationalLayers;q&&q.length&&d.push(b.populateOperationalLayers(h.layers,q,c));return w.eachAlways(d).then(function(){})})};e.prototype._getInitialExtent=function(){return d(this,void 0,void 0,function(){var a,b,d;return c(this,function(h){switch(h.label){case 0:return a=this.initialViewProperties&&this.initialViewProperties.spatialReference,
b=this.portalItem&&this.portalItem.extent,a&&b?a.isWGS84?[2,b.clone()]:a.isWebMercator?[2,H.geographicToWebMercator(b)]:[4,new Promise(function(a,h){p(["./portal/support/geometryServiceUtils"],a,h)})]:[3,2];case 1:return d=h.sent(),[2,d.create(this.portalItem).then(function(h){var c=new J;c.geometries=[b];c.outSpatialReference=a;return h.project(c)}).then(function(a){return a[0]}).catch(function(a){D.error("Error projecting item's extent:",a);return null})];case 2:return[2,null]}})})};e.prototype._getLayerJSONFromResourceInfo=
function(a){var h=this.get("resourceInfo.operationalLayers");return G.isSome(h)?k.find(h,function(h){return h.id===a.id}):null};e.prototype._removeDanglingLayerRefs=function(){var a=this,b=function(h){return!!a.allLayers.find(function(a){return a.id===h})},c=this.applicationProperties,d=c&&c.viewing&&c.viewing.search;d&&d.layers&&(d.layers=d.layers.filter(function(a){return b(a.id)}));(d=c&&c.editing&&c.editing.locationTracking)&&d.info&&!b(d.info.layerId)&&(c.editing=null);(c=this.presentation&&
this.presentation.slides)&&c.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return b(a.id)}))})};e.prototype._validateItem=function(){if(!this.portalItem)throw D.error("save: requires the portalItem property to be set"),new v("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)};e.prototype._validateItemType=function(a){if("Web Map"!==a.type)throw new v("webmap:portal-item-wrong-type",
'Portal item needs to have type "Web Map"');};e.prototype._loadLayerContainers=function(){var a=[];this.basemap&&a.push(this.basemap.load());this.ground&&a.push(this.ground.load());return w.eachAlways(a).then(function(){})};e.prototype._loadAllLayers=function(){var a=this.allLayers.map(function(a){return a.load()});return w.eachAlways(a).then(function(){})};e.prototype._validateJSONForWriting=function(a,b){a=a.messages.filter(function(a){return"error"===a.type}).map(function(a){return new v(a.name,
a.message,a.details)});b.ignoreUnsupported&&(a=a.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));if(0<a.length)throw new v("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a});};e.prototype._updateItemProperties=function(a){return d(this,void 0,void 0,function(){var b;return c(this,
function(h){switch(h.label){case 0:return b=a,[4,this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry)];case 1:return b.extent=h.sent(),[4,this._updateTypeKeywords(a)];case 2:return h.sent(),[2]}})})};e.prototype._updateItemPropertiesForSaveAs=function(a){return d(this,void 0,void 0,function(){return c(this,function(b){switch(b.label){case 0:return u.removeTypeKeyword(a,"CollectorDisabled"),u.removeTypeKeyword(a,"OfflineDisabled"),u.removeTypeKeyword(a,"Workforce Project"),[4,
this._updateItemProperties(a)];case 1:return b.sent(),[2]}})})};e.prototype._getWGS84Extent=function(a){return d(this,void 0,void 0,function(){var b,h,d,e,f;return c(this,function(c){switch(c.label){case 0:return b=a.spatialReference,b.isWGS84?[2,a.clone()]:b.isWebMercator?[2,H.webMercatorToGeographic(a)]:[4,new Promise(function(a,b){p(["./portal/support/geometryServiceUtils"],a,b)})];case 1:return h=c.sent(),[4,h.create(this.portalItem)];case 2:return d=c.sent(),e=new J,e.geometries=[a],e.outSpatialReference=
E.WGS84,[4,d.project(e)];case 3:return f=c.sent(),[2,f[0]]}})})};e.prototype._updateTypeKeywords=function(a){return d(this,void 0,void 0,function(){return c(this,function(b){switch(b.label){case 0:return u.addTypeKeyword(a,"ArcGIS API for JavaScript"),[4,this._loadAllLayers()];case 1:return b.sent(),this._evalCollectorKeyword(a),this._evalDataEditingKeyword(a),this._evalOfflineKeyword(a),a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b})),[2]}})})};e.prototype._evalCollectorKeyword=
function(a){u.hasTypeKeyword(a,"CollectorDisabled")||u.hasTypeKeyword(a,"Workforce Project")||!this._hasEditableFeatureLayer()?u.removeTypeKeyword(a,"Collector"):u.addTypeKeyword(a,"Collector")};e.prototype._evalDataEditingKeyword=function(a){this._hasEditableFeatureLayer()?u.addTypeKeyword(a,"Data Editing"):u.removeTypeKeyword(a,"Data Editing")};e.prototype._evalOfflineKeyword=function(a){!u.hasTypeKeyword(a,"OfflineDisabled")&&this._isOfflineCapableMap()?u.addTypeKeyword(a,"Offline"):u.removeTypeKeyword(a,
"Offline")};e.prototype._hasEditableFeatureLayer=function(){var a=this;return this.allLayers.some(function(b){return b.loaded&&a._isFeatureServiceLayer(b)&&b.capabilities.operations.supportsEditing&&b.editingEnabled})};e.prototype._isFeatureServiceLayer=function(a){return!("feature"!==a.type||!a.source||"feature-layer"!==a.source.type)};e.prototype._isOfflineCapableMap=function(){var a=this;return this.allLayers.every(function(b){return b.loaded&&a._isOfflineCapableLayer(b)})};e.prototype._isOfflineCapableLayer=
function(a){return this._isFeatureServiceLayer(a)&&a.capabilities.operations.supportsSync||("tile"===a.type||"vector-tile"===a.type)&&(a.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(a))&&a.spatialReference.equals(this.initialViewProperties.spatialReference)};e.prototype._isExportableAGOLTileLayer=function(a){return"tile"===a.type?V.isServerOrServicesAGOLUrl(a.url)&&ba.some(function(b){return-1<a.url.toLowerCase().indexOf("/"+b+"/")}):!1};e.prototype._updateItem=function(a,
b,e){return d(this,void 0,void 0,function(){return c(this,function(c){switch(c.label){case 0:return[4,a.update({data:b})];case 1:return c.sent(),this._syncUpInstanceWithItem(a,b,e),[2]}})})};e.prototype._createItem=function(a,b,e,f){return d(this,void 0,void 0,function(){var d,h,g;return c(this,function(c){switch(c.label){case 0:return d=this.portalItem,h=!!(d&&d.id&&d.portal.user),g=a.portal,[4,g._signIn()];case 1:return c.sent(),[4,this._canCopyItem(d,h,g)];case 2:if(!c.sent())throw new v("webmap:save-as-copy-not-allowed",
"Owner of this map does not allow others to save a copy");return[4,g.user.addItem({item:a,folder:f.folder,data:b})];case 3:return c.sent(),this.portalItem=a,this._syncUpInstanceWithItem(a,b,e),[2]}})})};e.prototype._canCopyItem=function(a,b,e){return d(this,void 0,void 0,function(){return c(this,function(c){switch(c.label){case 0:return G.isSome(a)&&a.id&&a.typeKeywords&&-1<a.typeKeywords.indexOf("useOnly")?a.portal.portalHostname!==e.portalHostname?[2,!1]:b?[3,2]:[4,a.reload()]:[3,3];case 1:c.sent(),
c.label=2;case 2:return[2,"admin"===a.itemControl||"update"===a.itemControl];case 3:return[2,!0]}})})};e.prototype._syncUpInstanceWithItem=function(a,b,c){F.JSONSupport.prototype.read.call(this,{version:b.version,authoringApp:b.authoringApp,authoringAppVersion:b.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:a.itemUrl&&x.urlToObject(a.itemUrl)});T.updateOrigins(c);this.resourceInfo=b};e.prototype._updateItemThumbnail=function(){return d(this,void 0,void 0,function(){return c(this,function(a){switch(a.label){case 0:return this.thumbnailUrl&&
this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})]:[3,2];case 1:a.sent(),this._clearThumbnailOverride(),a.label=2;case 2:return[2]}})})};e.prototype._getPortalItem=function(a){a=I.from(a);a.id&&(a=a.clone(),a.id=null);a.type||(a.type="Web Map");a.portal||(a.portal=z.getDefault());this._validateItemType(a);return a};e.prototype._updateFromInternal=function(a,b){return d(this,void 0,void 0,function(){return c(this,function(c){switch(c.label){case 0:return b=
b||{},[4,S.whenTrueOnce(a,"ready")];case 1:return c.sent(),this._updateInitialViewProperties(a,b),[4,this._updateThumbnailUrl(a,b)];case 2:return c.sent(),[2]}})})};e.prototype._updateInitialViewProperties=function(a,b){this.initialViewProperties.spatialReference=a.spatialReference.clone();b.viewpointExcluded||(this.initialViewProperties.viewpoint=new n({targetGeometry:this._getViewExtent(a)}))};e.prototype._getViewExtent=function(a){a=a.extent.clone().normalize();var b;if(1<a.length)for(var c=0;c<
a.length;c++){var d=a[c];b?d.width>b.width&&(b=d):b=d}else b=a[0];return b};e.prototype._updateThumbnailUrl=function(a,b){return d(this,void 0,void 0,function(){var d,e;return c(this,function(c){switch(c.label){case 0:if(b.thumbnailExcluded)return[2];d=X.getOptimalThumbnailSize(a,b.thumbnailSize);return[4,a.takeScreenshot({format:"png",width:d.width,height:d.height})];case 1:return e=c.sent(),this._setAutoGeneratedThumbnail(e.dataUrl),[2]}})})};e.prototype._setAutoGeneratedThumbnail=function(a){this.thumbnailUrl=
a;this._thumbnailFilename=null};e.prototype._clearThumbnailOverride=function(){this._clearOverride("thumbnailUrl");this._thumbnailFilename=null};e.prototype._generateCustomThumbnailFilename=function(a){if(x.isDataProtocol(a)){a=(a=(a=x.dataComponents(a))&&a.mediaType)&&y.get(a.toLowerCase())||null;var b="thumbnail"+Date.now();return a?b+"."+a:b}return null};e.prototype._getThumbnailState=function(){var a=this.thumbnailUrl;a&&(a=this._isOverridden("thumbnailUrl")?a:x.addQueryParameter(a,"w","8192"));
return{thumbnailUrl:a,filename:this._thumbnailFilename}};e.prototype._restoreThumbnailFromState=function(a){this.thumbnailUrl=a.thumbnailUrl;this._thumbnailFilename=a.filename};e.prototype._getAuthoringPropsState=function(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}};e.prototype._restoreAuthoringPropsFromState=function(a){a.isAuthoringAppSetByUser?
this.authoringApp=a.authoringApp:this._isAuthoringAppSetByUser=!1;a.isAuthoringAppVersionSetByUser?this.authoringAppVersion=a.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1};e.fromJSON=function(a){if(!a)throw new v("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};e.VERSION=C;b([r.property({type:Z,json:{write:!0}})],e.prototype,"applicationProperties",void 0);b([r.property({type:String,json:{write:{allowNull:!0}}})],e.prototype,"authoringApp",
null);b([r.writer("authoringApp")],e.prototype,"writeAuthoringApp",null);b([r.property({type:String,json:{write:{allowNull:!0}}})],e.prototype,"authoringAppVersion",null);b([r.writer("authoringAppVersion")],e.prototype,"writeAuthoringAppVersion",null);b([r.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],e.prototype,"basemap",void 0);b([r.property({type:M,json:{write:{overridePolicy:function(a){return{enabled:!!(a&&0<a.length)}}}}})],e.prototype,"bookmarks",void 0);b([r.property({type:A,
nonNullable:!0,json:{read:{source:["background","mapRangeInfo","spatialReference"]},write:{target:{background:{type:L},mapRangeInfo:{type:K},spatialReference:{type:E}}}}})],e.prototype,"initialViewProperties",void 0);b([r.reader("initialViewProperties")],e.prototype,"readInitialViewProperties",null);b([r.writer("initialViewProperties")],e.prototype,"writeInitialViewProperties",null);b([r.property({json:{write:{target:"operationalLayers"}}})],e.prototype,"layers",void 0);b([r.writer("layers")],e.prototype,
"writeLayers",null);b([r.property({type:I})],e.prototype,"portalItem",void 0);b([r.property({json:{write:!0}})],e.prototype,"presentation",void 0);b([r.property()],e.prototype,"resourceInfo",void 0);b([r.property({readOnly:!0,type:B.default,json:{read:{source:"version"},write:{allowNull:!0,target:"version",isRequired:!0}}})],e.prototype,"sourceVersion",void 0);b([r.reader("sourceVersion")],e.prototype,"readSourceVersion",null);b([r.writer("sourceVersion")],e.prototype,"writeSourceVersion",null);b([r.property()],
e.prototype,"tables",void 0);b([r.property({dependsOn:["portalItem.thumbnailUrl"]})],e.prototype,"thumbnailUrl",null);b([r.property({type:W,json:{write:!0}})],e.prototype,"widgets",void 0);return e=b([r.subclass("esri.WebMap")],e)}(r.declared(F.JSONSupportMixin(O.LoadableMixin(R.EsriPromiseMixin(f)))))});