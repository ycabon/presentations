// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var c=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&n.isMultiOriginJSONMixin(c)&&c.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(q,
c,n){Object.defineProperty(c,"__esModule",{value:!0});c.createCopyError=function(){return new n("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};c.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};c.createSchemaValidationError=function(f){return new n("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:f})};c.isSchemaValidationError=
function(f){return f&&"webscene:schema-validation"===f.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,c,n,f,m,h,g,k,p,a,b,d,e,l){function P(a,b,e,d){2===a.length?(u[0]=a[0],u[1]=a[1],u[2]=0,a=u):a===e&&(g.vec3.copy(u,a),a=u);return r(a,b,0,e,d,0,1)}function r(a,b,e,d,l,w,r){void 0===r&&(r=1);b=O(b,l,Y);if(f.isNone(b))return!1;if(b===C){if(a===d&&e===w)return!0;for(b=e+3*r;e<b;e++,w++)d[w]=a[e];return!0}for(r=e+3*r;e<r;e+=3,w+=3)b(a,e,d,w);return!0}function Q(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=m.getMetersPerUnitForSR(a,
1));return a.wkt===c.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===c.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function C(a,b,e,d){e[d++]=a[b++];e[d++]=a[b++];e[d]=a[b]}function V(a,b,d,l){d[l++]=T*(a[b++]/e.earthRadius);d[l++]=T*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/e.earthRadius)));d[l]=a[b]}function X(a,b,d,l){var F=.4999999*Math.PI,
F=n.clamp(R*a[b+1],-F,F),F=Math.sin(F);d[l++]=R*a[b]*e.earthRadius;d[l++]=e.halfEarthRadius*Math.log((1+F)/(1-F));d[l]=a[b+2]}function Z(a,b,e){b=Q(b,H);b=N[b][6];if(f.isNone(b))return!1;b(a,0,u,0);e!==u&&(e[0]=u[0],e[1]=u[1],2<e.length&&(e[2]=u[2]));return!0}function D(a,b){u[0]=a.x;u[1]=a.y;u[2]=a.hasZ?a.z:0;return Z(u,a.spatialReference,b)}function E(a,b,d,l){var F=e.earthRadius+a[b+2],f=R*a[b+1];a=R*a[b];b=Math.cos(f);d[l++]=Math.cos(a)*b*F;d[l++]=Math.sin(a)*b*F;d[l]=Math.sin(f)*F}function t(a,
b,d,f){var F=l.Vec3Compact.length(a,b),w=n.asinClamped(a[b+2]/(0===F?1:F));a=Math.atan2(a[b+1],a[b]);d[f++]=T*a;d[f++]=T*w;d[f]=F-e.earthRadius}function A(a,b,e,d){var l=aa,f=R*a[b],F=R*a[b+1];a=a[b+2];b=Math.sin(F);var F=Math.cos(F),w=l.a/Math.sqrt(1-l.e2*b*b);e[d++]=(w+a)*F*Math.cos(f);e[d++]=(w+a)*F*Math.sin(f);e[d++]=(w*(1-l.e2)+a)*b}function v(a,b,e,d){var l=aa,f=a[b],w=a[b+1];a=a[b+2];var F,r,c,S,P,da;b=Math.abs(a);F=f*f+w*w;r=Math.sqrt(F);c=F+a*a;S=Math.sqrt(c);f=Math.atan2(w,f);P=a*a/c;c=
F/c;w=l.a2/S;F=l.a3-l.a4/S;.3<c?(P=b/S*(1+c*(l.a1+w+P*F)/S),S=Math.asin(P),w=P*P,c=Math.sqrt(1-w)):(c=r/S*(1-P*(l.a5-w-c*F)/S),S=Math.acos(c),w=1-c*c,P=Math.sqrt(w));da=1-l.e2*w;w=l.a/Math.sqrt(da);l=l.a6*w;w=r-w*c;F=b-l*P;b=c*w+P*F;r=c*F-P*w;l=r/(l/da+b);S+=l;0>a&&(S=-S);e[d++]=T*f;e[d++]=T*S;e[d]=b+r*l/2}function O(a,b,e){void 0===e&&(e=y());return B(a,b,e).projector}function B(a,b,e){if(e.source.spatialReference===a&&e.dest.spatialReference===b)return e;var d=Q(a,e.source),l=Q(b,e.dest);0===d&&
0===l?a.equals(b)?e.projector=C:e.projector=null:e.projector=N[d][l];return e}function y(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:C}}Object.defineProperty(c,"__esModule",{value:!0});var x,z,G,K,L,I,M,J;c.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
c.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});c.canProject=function(a,b){return!!O(a,b,Y)};c.vectorToVector=P;c.pointToPoint=
function(a,b,e,d){void 0===e&&(e=b.spatialReference);void 0===d&&(d=0);u[0]=a.x;u[1]=a.y;var l=a.z;u[2]=void 0!==l?l:d;if(!r(u,a.spatialReference,0,u,e,0,1))return!1;b.x=u[0];b.y=u[1];b.spatialReference=e;void 0!==l?(b.z=u[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};c.pointToVector=function(a,b,e,d){void 0===d&&(d=0);u[0]=a.x;u[1]=a.y;var l=a.z;u[2]=void 0!==l?l:d;return r(u,a.spatialReference,0,b,e,0,1)};c.vectorToPoint=function(a,b,e,l){e instanceof p?l=l||e.spatialReference:d.isPoint(e)?(e.hasZ=
!0,l=l||e.spatialReference):(l=e,e=new p({spatialReference:l}));return r(a,b,0,u,l,0,1)?(e.x=u[0],e.y=u[1],e.z=u[2],e.spatialReference=l,e):null};c.xyzToVector=function(a,b,e,d,l,w){u[0]=a;u[1]=b;u[2]=e;return r(u,d,0,l,w,0,1)};c.bufferToBuffer=r;c.localLinearScaleFactors=function(a,b,d,l){var w=Q(b,H),f=Q(l,U);if(w===f&&0!==w||b.equals(l))return d[0]=1,d[1]=1,d[2]=1,!0;if(1===w){b=g.vec3.length(a);a=b/Math.sqrt(a[0]*a[0]+a[1]*a[1]);b/=e.earthRadius;if(3===f)return d[0]=a*b,d[1]=a*b,d[2]=1,!0;if(2===
f||5===f)return f=180/(e.earthRadius*Math.PI),d[0]=f*a*b,d[1]=f*b,d[2]=1,!0}return!1};c.computeLinearTransformation=function(a,b,e,d){var l=Q(a,H),r=Q(d,U);if(l===r&&1!==r&&(0!==l||a.equals(d)))return h.mat4.identity(e),h.mat4.translate(e,e,b),!0;if(1===r){a=N[l][6];r=N[6][r];if(f.isNone(a)||f.isNone(r))return!1;a(b,0,W,0);r(W,0,w,0);a=R*W[0];r=R*W[1];b=Math.sin(a);a=Math.cos(a);d=Math.sin(r);r=Math.cos(r);e[0]=-b;e[4]=-d*a;e[8]=r*a;e[12]=w[0];e[1]=a;e[5]=-d*b;e[9]=r*b;e[13]=w[1];e[2]=0;e[6]=r;e[10]=
d;e[14]=w[2];e[3]=0;e[7]=0;e[11]=0;e[15]=1;return!0}if(3===r&&(2===l||1===l)){a=N[l][6];if(f.isNone(a))return!1;a(b,0,W,0);b=R*W[1];X(W,0,w,0);h.mat4.identity(e);h.mat4.translate(e,e,w);b=1/Math.cos(b);h.mat4.scale(e,e,[b,b,1]);return!0}return!1};c.transformDirection=function(a,b,e,d,l){g.vec3.copy(ca,a);g.vec3.add(ba,a,b);P(ca,e,ca,l);P(ba,e,ba,l);g.vec3.subtract(d,ba,ca);g.vec3.normalize(d,d)};c.mbsToMbs=function(a,b,d,l){b=B(b,l,ea);if(b.projector===C)return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=
a[3],!0;if(f.isNone(b.projector))return!1;l=b.source;var w=b.dest;if(3===w.spatialReferenceId){b=N[l.spatialReferenceId][2];if(f.isNone(b))return!1;b(a,0,W,0);b=Math.abs(R*W[1])+Math.asin(a[3]/(e.earthRadius+a[2]));X(W,0,d,0);d[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,d,0);d[3]=a[3]*l.metersPerUnit/w.metersPerUnit;return!0};c.extentToBoundingBox=function(a,b,e){if(null==a)return!1;var d;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?
a.zmin:0;d=r(u,a.spatialReference,0,b,e,0,1);u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;d=d&&r(u,a.spatialReference,0,b,e,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return d};c.extentToBoundingRect=function(a,b,e){if(null==a)return!1;var d;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?a.zmin:
0;d=r(u,a.spatialReference,0,u,e,0,1);b[0]=u[0];b[1]=u[1];u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;d=d&&r(u,a.spatialReference,0,u,e,0,1);b[2]=u[0];b[3]=u[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return d};c.boundingRectToBoundingRect=function(a,e,d,l){if(null==a)return!1;if(e.equals(l))return b.set(d,a),!0;u[0]=a[0];u[1]=a[1];u[2]=0;if(!r(u,e,0,u,l,0,1))return!1;d[0]=u[0];d[1]=
u[1];u[0]=a[2];u[1]=a[3];u[2]=0;if(!r(u,e,0,u,l,0,1))return!1;d[2]=u[0];d[3]=u[1];return!0};(function(a){a.x2lon=function(a){return a/e.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/e.earthRadius))};a.lon2x=function(a){return a*e.earthRadius};a.lat2y=function(a){a=Math.sin(a);return e.earthRadius/2*Math.log((1+a)/(1-a))}})(c.webMercator||(c.webMercator={}));c.canProjectToWGS84ComparableLonLat=function(a){a=Q(a,H);return!!N[a][6]};c.vectorToWGS84ComparableLonLat=Z;c.pointToWGS84ComparableLonLat=
D;c.pointToWGS84ComparableLonLatPoint=function(a,b){var e=Q(b.spatialReference,U);return f.isNone(N[6][e])?!1:D(a,u)?(b.x=u[0],b.y=u[1],b.z=u[2],!0):!1};c.wgs84ComparableLonLatToECEF=function(a,b,d,l){void 0===l&&(l=0);l=e.earthRadius+l;var w=Math.cos(d);a[0]=Math.cos(b)*w*l;a[1]=Math.sin(b)*w*l;a[2]=Math.sin(d)*l};var N=(x={},x[2]=(z={},z[5]=null,z[6]=C,z[1]=E,z[0]=null,z[3]=X,z[2]=C,z[4]=A,z),x[5]=(G={},G[5]=C,G[6]=C,G[1]=E,G[0]=null,G[3]=null,G[2]=null,G[4]=A,G),x[3]=(K={},K[5]=null,K[6]=V,K[1]=
function(a,b,e,d){V(a,b,e,d);E(e,d,e,d)},K[0]=null,K[3]=C,K[2]=V,K[4]=function(a,b,e,d){V(a,b,e,d);A(e,d,e,d)},K),x[4]=(L={},L[5]=v,L[6]=v,L[1]=function(a,b,e,d){v(a,b,e,d);E(e,d,e,d)},L[0]=null,L[3]=function(a,b,e,d){v(a,b,e,d);X(e,d,e,d)},L[2]=v,L[4]=C,L),x[1]=(I={},I[5]=t,I[6]=t,I[1]=C,I[0]=null,I[3]=function(a,b,e,d){t(a,b,e,d);X(e,d,e,d)},I[2]=t,I[4]=function(a,b,e,d){t(a,b,e,d);A(e,d,e,d)},I),x[0]=(M={},M[5]=null,M[6]=null,M[1]=null,M[0]=C,M[3]=null,M[2]=null,M[4]=null,M),x[6]=(J={},J[5]=null,
J[6]=C,J[1]=E,J[0]=null,J[3]=null,J[2]=C,J[4]=A,J),x);c.getProjector=O;var H={spatialReference:null,spatialReferenceId:0},U={spatialReference:null,spatialReferenceId:0},Y=y(),ea=y(),R=n.deg2rad(1),T=n.rad2deg(1),aa={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},u=k.vec3f64.create(),W=k.vec3f64.create(),w=k.vec3f64.create(),ca=k.vec3f64.create(),ba=k.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.mat4=n})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,c,n,f){function m(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,b,d){var e=b[0],l=b[1],f=b[2],r=b[3],c=b[4],C=b[5],h=b[6],g=b[7],k=b[8],m=b[9],p=b[10],t=b[11],n=b[12],v=b[13],q=b[14];
b=b[15];var B=d[0],y=d[1],x=d[2],z=d[3];a[0]=B*e+y*c+x*k+z*n;a[1]=B*l+y*C+x*m+z*v;a[2]=B*f+y*h+x*p+z*q;a[3]=B*r+y*g+x*t+z*b;B=d[4];y=d[5];x=d[6];z=d[7];a[4]=B*e+y*c+x*k+z*n;a[5]=B*l+y*C+x*m+z*v;a[6]=B*f+y*h+x*p+z*q;a[7]=B*r+y*g+x*t+z*b;B=d[8];y=d[9];x=d[10];z=d[11];a[8]=B*e+y*c+x*k+z*n;a[9]=B*l+y*C+x*m+z*v;a[10]=B*f+y*h+x*p+z*q;a[11]=B*r+y*g+x*t+z*b;B=d[12];y=d[13];x=d[14];z=d[15];a[12]=B*e+y*c+x*k+z*n;a[13]=B*l+y*C+x*m+z*v;a[14]=B*f+y*h+x*p+z*q;a[15]=B*r+y*g+x*t+z*b;return a}function g(a,b,d){var e=
b[0],l=b[1],f=b[2],r=b[3],c=e+e,C=l+l,h=f+f;b=e*c;var g=e*C,e=e*h,k=l*C,l=l*h,f=f*h,c=r*c,C=r*C,r=r*h;a[0]=1-(k+f);a[1]=g+r;a[2]=e-C;a[3]=0;a[4]=g-r;a[5]=1-(b+f);a[6]=l+c;a[7]=0;a[8]=e+C;a[9]=l-c;a[10]=1-(b+k);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a}function k(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];a[4]=b[4]-d[4];a[5]=b[5]-d[5];a[6]=b[6]-d[6];a[7]=b[7]-d[7];a[8]=b[8]-d[8];a[9]=b[9]-d[9];a[10]=b[10]-d[10];a[11]=b[11]-d[11];a[12]=b[12]-d[12];a[13]=b[13]-
d[13];a[14]=b[14]-d[14];a[15]=b[15]-d[15];return a}Object.defineProperty(c,"__esModule",{value:!0});c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.set=function(a,b,d,e,l,f,r,c,C,h,g,k,m,p,n,A,v){a[0]=b;a[1]=d;a[2]=e;a[3]=l;a[4]=f;a[5]=r;a[6]=c;a[7]=C;a[8]=h;a[9]=g;a[10]=k;a[11]=m;a[12]=p;a[13]=n;a[14]=A;a[15]=v;return a};c.identity=m;c.transpose=
function(a,b){if(a===b){var d=b[1],e=b[2],l=b[3],f=b[6],r=b[7],c=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=f;a[11]=b[14];a[12]=l;a[13]=r;a[14]=c}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};c.invert=function(a,b){var d=b[0],e=b[1],l=b[2],f=b[3],r=b[4],c=b[5],C=b[6],h=b[7],g=b[8],k=b[9],m=b[10],p=b[11],n=b[12],A=b[13],v=b[14];
b=b[15];var q=d*c-e*r,B=d*C-l*r,y=d*h-f*r,x=e*C-l*c,z=e*h-f*c,G=l*h-f*C,K=g*A-k*n,L=g*v-m*n,I=g*b-p*n,M=k*v-m*A,J=k*b-p*A,N=m*b-p*v,H=q*N-B*J+y*M+x*I-z*L+G*K;if(!H)return null;H=1/H;a[0]=(c*N-C*J+h*M)*H;a[1]=(l*J-e*N-f*M)*H;a[2]=(A*G-v*z+b*x)*H;a[3]=(m*z-k*G-p*x)*H;a[4]=(C*I-r*N-h*L)*H;a[5]=(d*N-l*I+f*L)*H;a[6]=(v*y-n*G-b*B)*H;a[7]=(g*G-m*y+p*B)*H;a[8]=(r*J-c*I+h*K)*H;a[9]=(e*I-d*J-f*K)*H;a[10]=(n*z-A*y+b*q)*H;a[11]=(k*y-g*z-p*q)*H;a[12]=(c*L-r*M-C*K)*H;a[13]=(d*M-e*L+l*K)*H;a[14]=(A*B-n*x-v*q)*H;
a[15]=(g*x-k*B+m*q)*H;return a};c.adjoint=function(a,b){var d=b[0],e=b[1],l=b[2],f=b[3],r=b[4],c=b[5],h=b[6],g=b[7],k=b[8],m=b[9],p=b[10],n=b[11],t=b[12],q=b[13],v=b[14];b=b[15];a[0]=c*(p*b-n*v)-m*(h*b-g*v)+q*(h*n-g*p);a[1]=-(e*(p*b-n*v)-m*(l*b-f*v)+q*(l*n-f*p));a[2]=e*(h*b-g*v)-c*(l*b-f*v)+q*(l*g-f*h);a[3]=-(e*(h*n-g*p)-c*(l*n-f*p)+m*(l*g-f*h));a[4]=-(r*(p*b-n*v)-k*(h*b-g*v)+t*(h*n-g*p));a[5]=d*(p*b-n*v)-k*(l*b-f*v)+t*(l*n-f*p);a[6]=-(d*(h*b-g*v)-r*(l*b-f*v)+t*(l*g-f*h));a[7]=d*(h*n-g*p)-r*(l*n-
f*p)+k*(l*g-f*h);a[8]=r*(m*b-n*q)-k*(c*b-g*q)+t*(c*n-g*m);a[9]=-(d*(m*b-n*q)-k*(e*b-f*q)+t*(e*n-f*m));a[10]=d*(c*b-g*q)-r*(e*b-f*q)+t*(e*g-f*c);a[11]=-(d*(c*n-g*m)-r*(e*n-f*m)+k*(e*g-f*c));a[12]=-(r*(m*v-p*q)-k*(c*v-h*q)+t*(c*p-h*m));a[13]=d*(m*v-p*q)-k*(e*v-l*q)+t*(e*p-l*m);a[14]=-(d*(c*v-h*q)-r*(e*v-l*q)+t*(e*h-l*c));a[15]=d*(c*p-h*m)-r*(e*p-l*m)+k*(e*h-l*c);return a};c.determinant=function(a){var b=a[0],d=a[1],e=a[2],l=a[3],f=a[4],c=a[5],h=a[6],g=a[7],k=a[8],m=a[9],p=a[10],n=a[11],q=a[12],t=a[13],
A=a[14];a=a[15];return(b*c-d*f)*(p*a-n*A)-(b*h-e*f)*(m*a-n*t)+(b*g-l*f)*(m*A-p*t)+(d*h-e*c)*(k*a-n*q)-(d*g-l*c)*(k*A-p*q)+(e*g-l*h)*(k*t-m*q)};c.multiply=h;c.translate=function(a,b,d){var e=d[0],l=d[1];d=d[2];var f=void 0,c=void 0,h=void 0,g=void 0,k=void 0,m=void 0,p=void 0,n=void 0,q=void 0,t=void 0,A=void 0,v=void 0;b===a?(a[12]=b[0]*e+b[4]*l+b[8]*d+b[12],a[13]=b[1]*e+b[5]*l+b[9]*d+b[13],a[14]=b[2]*e+b[6]*l+b[10]*d+b[14],a[15]=b[3]*e+b[7]*l+b[11]*d+b[15]):(f=b[0],c=b[1],h=b[2],g=b[3],k=b[4],m=
b[5],p=b[6],n=b[7],q=b[8],t=b[9],A=b[10],v=b[11],a[0]=f,a[1]=c,a[2]=h,a[3]=g,a[4]=k,a[5]=m,a[6]=p,a[7]=n,a[8]=q,a[9]=t,a[10]=A,a[11]=v,a[12]=f*e+k*l+q*d+b[12],a[13]=c*e+m*l+t*d+b[13],a[14]=h*e+p*l+A*d+b[14],a[15]=g*e+n*l+v*d+b[15]);return a};c.scale=function(a,b,d){var e=d[0],l=d[1];d=d[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*l;a[5]=b[5]*l;a[6]=b[6]*l;a[7]=b[7]*l;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.rotate=
function(a,b,d,e){var l=e[0],c=e[1];e=e[2];var r=Math.sqrt(l*l+c*c+e*e),h=void 0,g=void 0,k=void 0,m=void 0,p=void 0,n=void 0,q=void 0,t=void 0,A=void 0,v=void 0,O=void 0,B=void 0,y=void 0,x=void 0,z=void 0,G=void 0,K=void 0,L=void 0,I=void 0,M=void 0,J=void 0,N=void 0,g=h=void 0;if(r<f.EPSILON)return null;r=1/r;l*=r;c*=r;e*=r;h=Math.sin(d);g=Math.cos(d);k=1-g;m=b[0];p=b[1];n=b[2];q=b[3];t=b[4];A=b[5];v=b[6];O=b[7];B=b[8];y=b[9];x=b[10];z=b[11];G=l*l*k+g;K=c*l*k+e*h;L=e*l*k-c*h;I=l*c*k-e*h;M=c*c*
k+g;J=e*c*k+l*h;N=l*e*k+c*h;h=c*e*k-l*h;g=e*e*k+g;a[0]=m*G+t*K+B*L;a[1]=p*G+A*K+y*L;a[2]=n*G+v*K+x*L;a[3]=q*G+O*K+z*L;a[4]=m*I+t*M+B*J;a[5]=p*I+A*M+y*J;a[6]=n*I+v*M+x*J;a[7]=q*I+O*M+z*J;a[8]=m*N+t*h+B*g;a[9]=p*N+A*h+y*g;a[10]=n*N+v*h+x*g;a[11]=q*N+O*h+z*g;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};c.rotateX=function(a,b,d){var e=Math.sin(d);d=Math.cos(d);var l=b[4],f=b[5],c=b[6],h=b[7],g=b[8],k=b[9],m=b[10],p=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],
a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=l*d+g*e;a[5]=f*d+k*e;a[6]=c*d+m*e;a[7]=h*d+p*e;a[8]=g*d-l*e;a[9]=k*d-f*e;a[10]=m*d-c*e;a[11]=p*d-h*e;return a};c.rotateY=function(a,b,d){var e=Math.sin(d);d=Math.cos(d);var l=b[0],f=b[1],c=b[2],h=b[3],g=b[8],k=b[9],m=b[10],p=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*d-g*e;a[1]=f*d-k*e;a[2]=c*d-m*e;a[3]=h*d-p*e;a[8]=l*e+g*d;a[9]=f*e+k*d;a[10]=c*e+m*d;a[11]=h*e+p*d;return a};c.rotateZ=function(a,
b,d){var e=Math.sin(d);d=Math.cos(d);var l=b[0],f=b[1],c=b[2],h=b[3],g=b[4],k=b[5],m=b[6],p=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*d+g*e;a[1]=f*d+k*e;a[2]=c*d+m*e;a[3]=h*d+p*e;a[4]=g*d-l*e;a[5]=k*d-f*e;a[6]=m*d-c*e;a[7]=p*d-h*e;return a};c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};c.fromScaling=function(a,
b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotation=function(a,b,d){var e=d[0],l=d[1];d=d[2];var c=Math.sqrt(e*e+l*l+d*d),h=void 0,g=void 0,k=void 0;if(c<f.EPSILON)return null;c=1/c;e*=c;l*=c;d*=c;h=Math.sin(b);g=Math.cos(b);k=1-g;a[0]=e*e*k+g;a[1]=l*e*k+d*h;a[2]=d*e*k-l*h;a[3]=0;a[4]=e*l*k-d*h;a[5]=l*l*k+g;a[6]=d*l*k+e*h;a[7]=0;a[8]=e*d*k+l*h;a[9]=l*d*k-e*h;a[10]=d*d*k+g;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};c.fromXRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=d;a[7]=0;a[8]=0;a[9]=-d;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromYRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-d;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=d;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromZRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=0;a[3]=0;a[4]=
-d;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotationTranslation=g;c.fromQuat2=function(a,b){var d=p,e=-b[0],l=-b[1],f=-b[2],c=b[3],h=b[4],k=b[5],m=b[6],n=b[7],q=e*e+l*l+f*f+c*c;0<q?(d[0]=2*(h*c+n*e+k*f-m*l)/q,d[1]=2*(k*c+n*l+m*e-h*f)/q,d[2]=2*(m*c+n*f+h*l-k*e)/q):(d[0]=2*(h*c+n*e+k*f-m*l),d[1]=2*(k*c+n*l+m*e-h*f),d[2]=2*(m*c+n*f+h*l-k*e));g(a,b,d);return a};var p=n.create();c.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};
c.getScaling=function(a,b){var d=b[0],e=b[1],l=b[2],f=b[4],c=b[5],h=b[6],g=b[8],k=b[9];b=b[10];a[0]=Math.sqrt(d*d+e*e+l*l);a[1]=Math.sqrt(f*f+c*c+h*h);a[2]=Math.sqrt(g*g+k*k+b*b);return a};c.getRotation=function(a,b){var d=b[0]+b[5]+b[10],e=0;0<d?(e=2*Math.sqrt(d+1),a[3]=.25*e,a[0]=(b[6]-b[9])/e,a[1]=(b[8]-b[2])/e,a[2]=(b[1]-b[4])/e):b[0]>b[5]&&b[0]>b[10]?(e=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/e,a[0]=.25*e,a[1]=(b[1]+b[4])/e,a[2]=(b[8]+b[2])/e):b[5]>b[10]?(e=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/e,a[0]=(b[1]+b[4])/e,a[1]=.25*e,a[2]=(b[6]+b[9])/e):(e=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/e,a[0]=(b[8]+b[2])/e,a[1]=(b[6]+b[9])/e,a[2]=.25*e);return a};c.fromRotationTranslationScale=function(a,b,d,e){var l=b[0],f=b[1],c=b[2],h=b[3],g=l+l,k=f+f,m=c+c;b=l*g;var p=l*k,l=l*m,n=f*k,f=f*m,c=c*m,g=h*g,k=h*k,h=h*m,m=e[0],q=e[1];e=e[2];a[0]=(1-(n+c))*m;a[1]=(p+h)*m;a[2]=(l-k)*m;a[3]=0;a[4]=(p-h)*q;a[5]=(1-(b+c))*q;a[6]=(f+g)*q;a[7]=0;a[8]=(l+k)*e;a[9]=(f-g)*e;a[10]=(1-(b+n))*
e;a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};c.fromRotationTranslationScaleOrigin=function(a,b,d,e,l){var f=b[0],c=b[1],h=b[2],g=b[3],k=f+f,m=c+c,p=h+h;b=f*k;var n=f*m,q=f*p,f=c*m,c=c*p,t=h*p,h=g*k,m=g*m,A=g*p,v=e[0],O=e[1],p=e[2];e=l[0];g=l[1];l=l[2];var k=(1-(f+t))*v,B=(n+A)*v,v=(q-m)*v,n=(n-A)*O,t=(1-(b+t))*O,O=(c+h)*O,q=(q+m)*p,c=(c-h)*p;b=(1-(b+f))*p;a[0]=k;a[1]=B;a[2]=v;a[3]=0;a[4]=n;a[5]=t;a[6]=O;a[7]=0;a[8]=q;a[9]=c;a[10]=b;a[11]=0;a[12]=d[0]+e-(k*e+n*g+q*l);a[13]=d[1]+g-(B*
e+t*g+c*l);a[14]=d[2]+l-(v*e+O*g+b*l);a[15]=1;return a};c.fromQuat=function(a,b){var d=b[0],e=b[1],l=b[2];b=b[3];var f=d+d,c=e+e,h=l+l,d=d*f,g=e*f,e=e*c,k=l*f,m=l*c,l=l*h,f=b*f,c=b*c;b*=h;a[0]=1-e-l;a[1]=g+b;a[2]=k-c;a[3]=0;a[4]=g-b;a[5]=1-d-l;a[6]=m+f;a[7]=0;a[8]=k+c;a[9]=m-f;a[10]=1-d-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.frustum=function(a,b,d,e,l,f,c){var h=1/(d-b),g=1/(l-e),k=1/(f-c);a[0]=2*f*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*f*g;a[6]=0;a[7]=0;a[8]=(d+b)*h;a[9]=(l+e)*g;a[10]=
(c+f)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=c*f*2*k;a[15]=0;return a};c.perspective=function(a,b,d,e,l){b=1/Math.tan(b/2);var f=void 0;a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=l&&Infinity!==l?(f=1/(e-l),a[10]=(l+e)*f,a[14]=2*l*e*f):(a[10]=-1,a[14]=-2*e);return a};c.perspectiveFromFieldOfView=function(a,b,d,e){var l=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),c=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var h=2/(c+b),g=2/(l+f);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((c-b)*h*.5);a[9]=(l-f)*g*.5;a[10]=e/(d-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*d/(d-e);a[15]=0;return a};c.ortho=function(a,b,d,e,l,f,c){var h=1/(b-d),g=1/(e-l),k=1/(f-c);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(b+d)*h;a[13]=(l+e)*g;a[14]=(c+f)*k;a[15]=1;return a};c.lookAt=function(a,b,d,e){var l=void 0,c=void 0,h=void 0,g=void 0,k=void 0,p=void 0,
n=void 0,q=void 0,D=void 0,E=void 0,t=b[0],A=b[1];b=b[2];h=e[0];g=e[1];e=e[2];n=d[0];q=d[1];d=d[2];if(Math.abs(t-n)<f.EPSILON&&Math.abs(A-q)<f.EPSILON&&Math.abs(b-d)<f.EPSILON)return m(a);n=t-n;q=A-q;D=b-d;E=1/Math.sqrt(n*n+q*q+D*D);n*=E;q*=E;D*=E;l=g*D-e*q;c=e*n-h*D;h=h*q-g*n;(E=Math.sqrt(l*l+c*c+h*h))?(E=1/E,l*=E,c*=E,h*=E):h=c=l=0;g=q*h-D*c;k=D*l-n*h;p=n*c-q*l;(E=Math.sqrt(g*g+k*k+p*p))?(E=1/E,g*=E,k*=E,p*=E):p=k=g=0;a[0]=l;a[1]=g;a[2]=n;a[3]=0;a[4]=c;a[5]=k;a[6]=q;a[7]=0;a[8]=h;a[9]=p;a[10]=D;
a[11]=0;a[12]=-(l*t+c*A+h*b);a[13]=-(g*t+k*A+p*b);a[14]=-(n*t+q*A+D*b);a[15]=1;return a};c.targetTo=function(a,b,d,e){var l=b[0],f=b[1];b=b[2];var c=e[0],h=e[1],g=e[2];e=l-d[0];var k=f-d[1];d=b-d[2];var m=e*e+k*k+d*d;0<m&&(m=1/Math.sqrt(m),e*=m,k*=m,d*=m);var p=h*d-g*k,g=g*e-c*d,c=c*k-h*e,m=p*p+g*g+c*c;0<m&&(m=1/Math.sqrt(m),p*=m,g*=m,c*=m);a[0]=p;a[1]=g;a[2]=c;a[3]=0;a[4]=k*c-d*g;a[5]=d*p-e*c;a[6]=e*g-k*p;a[7]=0;a[8]=e;a[9]=k;a[10]=d;a[11]=0;a[12]=l;a[13]=f;a[14]=b;a[15]=1;return a};c.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};c.add=function(a,b,
d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];a[4]=b[4]+d[4];a[5]=b[5]+d[5];a[6]=b[6]+d[6];a[7]=b[7]+d[7];a[8]=b[8]+d[8];a[9]=b[9]+d[9];a[10]=b[10]+d[10];a[11]=b[11]+d[11];a[12]=b[12]+d[12];a[13]=b[13]+d[13];a[14]=b[14]+d[14];a[15]=b[15]+d[15];return a};c.subtract=k;c.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*d;a[5]=b[5]*d;a[6]=b[6]*d;a[7]=b[7]*d;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12]*d;a[13]=b[13]*d;a[14]=b[14]*
d;a[15]=b[15]*d;return a};c.multiplyScalarAndAdd=function(a,b,d,e){a[0]=b[0]+d[0]*e;a[1]=b[1]+d[1]*e;a[2]=b[2]+d[2]*e;a[3]=b[3]+d[3]*e;a[4]=b[4]+d[4]*e;a[5]=b[5]+d[5]*e;a[6]=b[6]+d[6]*e;a[7]=b[7]+d[7]*e;a[8]=b[8]+d[8]*e;a[9]=b[9]+d[9]*e;a[10]=b[10]+d[10]*e;a[11]=b[11]+d[11]*e;a[12]=b[12]+d[12]*e;a[13]=b[13]+d[13]*e;a[14]=b[14]+d[14]*e;a[15]=b[15]+d[15]*e;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};c.equals=function(a,b){var d=a[0],e=a[1],l=a[2],c=a[3],h=a[4],g=a[5],k=a[6],m=a[7],p=a[8],n=a[9],q=a[10],E=a[11],t=a[12],A=a[13],v=a[14];a=a[15];var O=b[0],B=b[1],y=b[2],x=b[3],z=b[4],G=b[5],K=b[6],L=b[7],I=b[8],M=b[9],J=b[10],N=b[11],H=b[12],U=b[13],Y=b[14];b=b[15];return Math.abs(d-O)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(e-B)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&
Math.abs(l-y)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-x)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-z)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(g-G)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(k-K)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(K))&&Math.abs(m-L)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(p-I)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(n-M)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(q-
J)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(J))&&Math.abs(E-N)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(t-H)<=f.EPSILON*Math.max(1,Math.abs(t),Math.abs(H))&&Math.abs(A-U)<=f.EPSILON*Math.max(1,Math.abs(A),Math.abs(U))&&Math.abs(v-Y)<=f.EPSILON*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.mul=h;c.sub=k})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(q,c,n,f,m,h,g,k){function p(a,b,d,f){var e,l;a instanceof g&&b instanceof g&&(d=b.longitude,f=b.latitude,l=a.latitude,e=a.longitude);a=n.deg2rad(l);f=n.deg2rad(f);e=n.deg2rad(e);b=n.deg2rad(d);d=Math.sin((a-f)/2);e=Math.sin((e-b)/2);d=2*n.asinClamped(Math.sqrt(d*d+Math.cos(a)*Math.cos(f)*e*e))*c.earthRadius;return Math.round(1E4*d)/1E4}function a(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(c,"__esModule",{value:!0});c.earthRadius=f.wgs84Radius;c.halfEarthRadius=c.earthRadius/
2;c.halfEarthCircumference=Math.PI*c.earthRadius;c.earthCircumference=2*c.halfEarthCircumference;c.metersPerDegree=c.halfEarthCircumference/180;c.getGreatCircleDistance=p;c.getGreatCircleSpanAt=function(a,b,d){var e=b.spatialReference,f=new g(b.x,a.y,e),l=new g(d.x,a.y,e);b=new g(a.x,b.y,e);a=new g(a.x,d.y,e);return{lon:p(f,l),lat:p(b,a)}};c.getLonDeltaForDistance=function(a,b){b/=c.earthRadius;a=n.deg2rad(a);b=Math.sin(b/2);a=Math.cos(a);a=2*n.asinClamped(Math.sqrt(b*b/(a*a)));return n.rad2deg(a)};
c.getLatDeltaForDistance=function(a){return n.rad2deg(a/c.earthRadius)};c.getMaxCameraAltitude=function(a){a=n.deg2rad(a/2);return(1-Math.sin(a))*c.earthRadius/Math.sin(a)};c.getViewExtentDistance=function(a,b){b=n.deg2rad(b/2);return 2*n.acosClamped((Math.pow(a+c.earthRadius,2)+Math.pow(c.earthRadius,2)-Math.pow((a+c.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+c.earthRadius),2)-a*a-2*a*c.earthRadius),2))/(2*(a+c.earthRadius)*c.earthRadius))*c.earthRadius};c.computeCartesianDistance=
function(a,f){a=k.wgs84ComparableLonLatToECEF(b,a.longitude,a.latitude,a.z||0);f=k.wgs84ComparableLonLatToECEF(d,f.longitude,f.latitude,f.z||0);f=[f[0]-a[0],f[1]-a[1],f[2]-a[2]];return Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])};c.longitudeToTimezone=a;c.positionToTimezone=function(b,d){d||(d={hours:0,minutes:0,seconds:0});d.hours=a(b[0],!0);b=d.hours%1;d.hours-=b;d.minutes=60*b;b=d.minutes%1;d.minutes-=b;d.seconds=Math.round(60*b);return d};c.distanceToIdealHorizon=function(a,b){b=b||c.earthRadius;
a=m.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var b=h.vec3f64.create(),d=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});(function(c){c.length=function(f,c){var h=f[c],g=f[c+1];f=f[c+2];return Math.sqrt(h*h+g*g+f*f)};c.normalize=function(f,c){var h=f[c],g=f[c+1],k=f[c+2],h=1/Math.sqrt(h*h+g*g+k*k);f[c]*=h;f[c+1]*=h;f[c+2]*=h};c.scale=function(f,c,h){f[c]*=h;f[c+1]*=
h;f[c+2]*=h};c.add=function(f,c,h,g,k,p){void 0===p&&(p=c);k=k||f;k[p]=f[c]+h[g];k[p+1]=f[c+1]+h[g+1];k[p+2]=f[c+2]+h[g+2]};c.subtract=function(f,c,h,g,k,p){void 0===p&&(p=c);k=k||f;k[p]=f[c]-h[g];k[p+1]=f[c+1]-h[g+1];k[p+2]=f[c+2]-h[g+2]}})(c.Vec3Compact||(c.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});c.isSpatialReferenceSupported=function(c,f){return null==c?!1:"2d"===f?!0:
"local"===f?!c.isGeographic:c.isWebMercator||c.isWGS84||4490===c.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});var n={width:600,height:400};c.getOptimalThumbnailSize=function(f,c){c=c||n;var h=c.width;c=c.height;var g=h/c;1.5>g?c=h/1.5:1.5<g&&(h=1.5*c);h>f.width&&(c*=f.width/h,h=f.width);c>f.height&&(h*=f.height/c,c=f.height);return{width:Math.round(h),height:Math.round(c)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(q,c,n,f,m,h,g){return function(c){function k(a){a=c.call(this,a)||this;a.viewing=null;return a}n(k,c);a=k;k.prototype.clone=function(){return new a({viewing:this.viewing?this.viewing.clone():null})};var a;f([h.property({type:g,json:{write:!0}})],k.prototype,"viewing",void 0);return k=a=f([h.subclass("esri.webscene.ApplicationProperties")],k)}(h.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(q,c,n,f,m,h,g,k){return function(c){function a(a){a=c.call(this,a)||this;a.search=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b(h.clone({search:this.search}))};var b;f([g.property({type:k,json:{write:!0}})],a.prototype,"search",void 0);return a=b=f([g.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(g.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,c,n,f,m,h,g,k,p){var a=m.ofType(p);return function(b){function d(d){d=b.call(this,d)||this;d.addressSearchEnabled=!0;d.enabled=!0;d.hintText=null;d.layers=new a;return d}n(d,b);e=d;d.prototype.readAddressSearchEnabled=function(a){return!a};d.prototype.writeAddressSearchEnabled=function(a,b,d){b[d]=!a};d.prototype.clone=function(){return new e(g.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;f([k.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"addressSearchEnabled",void 0);f([k.reader("addressSearchEnabled")],d.prototype,"readAddressSearchEnabled",null);f([k.writer("addressSearchEnabled")],d.prototype,"writeAddressSearchEnabled",null);f([k.property({type:Boolean,json:{write:!0,default:!0}})],d.prototype,"enabled",void 0);f([k.property({type:String,json:{write:!0}})],d.prototype,"hintText",void 0);
f([k.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],d.prototype,"layers",void 0);return d=e=f([k.subclass("esri.webdoc.applicationProperties.Search")],d)}(k.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(q,c,n,f,m,h,g,k,p){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}n(b,a);d=b;b.prototype.clone=function(){return new d(h.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var d;f([g.property({type:p,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);f([g.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);f([g.property({type:k.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=d=f([g.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(g.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,c,n,f,m,h,g){return function(c){function k(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}n(k,c);a=k;k.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;f([h.property({type:Boolean,json:{write:!0}})],k.prototype,"exactMatch",void 0);f([h.property({type:String,json:{write:!0}})],k.prototype,"name",void 0);f([h.enumeration.serializable()(g.kebabDict)],k.prototype,"type",void 0);return k=a=f([h.subclass("esri.webdoc.applicationProperties.SearchLayerField")],k)}(h.declared(m.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,c,n,f,m,h,g,k,p){var a=function(a,d,e){return{enabled:!e||!e.isPresentation}};return function(b){function d(a){a=b.call(this,a)||this;a.lighting=new k;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}n(d,b);e=d;d.prototype.clone=function(){return new e(this.cloneConstructProperties())};d.prototype.cloneConstructProperties=function(){return{lighting:k.prototype.clone.call(this.lighting),background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var e;f([g.property({type:k,json:{write:!0}})],d.prototype,"lighting",void 0);f([g.property(p.backgroundProperty)],d.prototype,"background",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"atmosphereEnabled",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"starsEnabled",void 0);return d=e=f([g.subclass("esri.webscene.Environment")],d)}(g.declared(m.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,c,n,f,m,h){return function(c){function k(a){a=c.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}n(k,c);g=k;k.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};k.prototype.writeDate=function(a,b,d){b[d]=a.getTime()};k.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};k.prototype.writedirectShadowsEnabled=function(a,b,d){a&&(b[d]=a)};k.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};k.prototype.clone=function(){return new g(this.cloneConstructProperties())};k.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var g;f([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],k.prototype,"date",void 0);f([h.reader("date",["datetime"])],k.prototype,"readDate",
null);f([h.writer("date")],k.prototype,"writeDate",null);f([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],k.prototype,"directShadowsEnabled",void 0);f([h.reader("directShadowsEnabled",["directShadows"])],k.prototype,"readDirectShadowsEnabled",null);f([h.writer("directShadowsEnabled")],k.prototype,"writedirectShadowsEnabled",null);f([h.property({type:Number,json:{write:!0}})],k.prototype,"displayUTCOffset",void 0);f([h.writer("displayUTCOffset")],k.prototype,"writeDisplayUTCOffset",
null);return k=g=f([h.subclass("esri.webscene.Lighting")],k)}(h.declared(m.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q={base:n,key:"type",typeMap:{color:f}};c.backgroundProperty={types:q,json:{read:function(c){return function(f,g,k){if(!f)return f;for(var h in c.typeMap)if(f.type===h)return g=new c.typeMap[h],g.read(f,k),g}}(q),write:{overridePolicy:function(c,
f,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,h,g,k){var p=h.strict()({color:"color"});return function(a){function b(b){return a.call(this,b)||this}n(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=m({},a),delete a.type);return a};b.prototype.clone=function(){};f([k.property({type:p.apiValues,readOnly:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],b.prototype,"type",void 0);return b=f([k.subclass("esri.webscene.background.Background")],b)}(k.declared(g.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,c,n,f,m,h,g,k,p){var a=m({},k.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function d(a){a=b.call(this,a)||this;a.type="color";a.color=new h([0,0,0,1]);return a}n(d,b);e=d;d.prototype.clone=function(){return new e(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var e;f([g.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);f([g.property(a)],d.prototype,"color",void 0);return d=e=f([g.subclass("esri.webscene.background.ColorBackground")],
d)}(g.declared(p))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,c,n,f,m,h,g,k,p){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new p;b.spatialReference=null;b.viewpoint=null;return b}n(b,a);d=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var d;f([g.property({type:p,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);f([g.property({type:k})],b.prototype,"spatialReference",void 0);f([g.property({type:["local","global"]})],b.prototype,"viewingMode",
null);f([g.property({type:m,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=d=f([g.subclass("esri.webscene.InitialViewProperties")],b)}(g.declared(h))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,c,n,f,m,h,g,k,p){var a=m.ofType(p);return function(b){function d(d){d=
b.call(this,d)||this;d.slides=new a;return d}n(d,b);Object.defineProperty(d.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",h.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([k.property({type:a,nonNullable:!0,json:{write:!0}}),k.cast(h.castForReferenceSetter)],d.prototype,"slides",null);return d=f([k.subclass("esri.webscene.Presentation")],
d)}(k.declared(g.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/environment/SceneViewLighting ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(q,c,n,f,m,h,g,k,p,a,b,d,e,l,P,r,Q,C,V,X,Z,D,E,t,A,v,O,B,y,x){function z(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function G(a){if(a=z(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function K(a,b){a=b-a;a>N&&(a-=J);a<-N&&(a+=J);return a}var L=0,I=b.ofType(y.default),M=l.getLogger("esri.webscene.Slide"),J=86400,N=43200;return function(e){function c(a){a=e.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+L++;a.title=new x.default;a.description=new O.default;a.thumbnail=new t.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new A;a.visibleLayers=new I;return a}f(c,e);c.prototype.castTitle=function(a){return"string"===typeof a?new x.default({text:a}):Q.ensureType(x.default,a)};c.prototype.castDescription=function(a){return"string"===typeof a?new O.default({text:a}):Q.ensureType(O.default,a)};c.prototype.castThumbnail=function(a){return"string"===typeof a?new t.default({url:a}):
Q.ensureType(t.default,a)};c.prototype.castBasemap=function(a){return Z.ensureType(a)};Object.defineProperty(c.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",d.referenceSetter(a,this._get("visibleLayers"),I))},enumerable:!0,configurable:!0});c.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof X){var b=G(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
M.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};c.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};c.prototype._updateVisibleLayersFrom=function(a){var b=this,d=[];return P.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var e=G(b);d.push(new y.default({id:a.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(d)})};c.prototype.updateFrom=function(a,b){var d=this;b={screenshot:n({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){d.viewpoint=
a.viewpoint.clone();d.environment.lighting=v.prototype.clone.apply(a.environment.lighting);d.basemap=a.map.basemap&&a.map.basemap.clone()||null;d.ground=a.map.ground?B.default.fromGround(a.map.ground):null;return d._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){d.thumbnail=new t.default({url:a.dataUrl});return d})};c.prototype.applyTo=function(a,b){return g(this,void 0,void 0,function(){var d,e,c;return h(this,function(f){this._applyToController&&
this._applyToController.abort();this._applyToController=d=P.createAbortController();P.onAbortOrThrow(b,function(){return d.abort()});e=n({animate:!0},b,{signal:this._applyToController.signal});c=P.createDeferred(function(){return d.abort()});this._applyTo(a,e,d).then(c.resolve,c.reject);return[2,c.promise]})})};c.prototype._applyTo=function(b,d,e){return g(this,void 0,void 0,function(){var c,f=this;return h(this,function(l){switch(l.label){case 0:return[4,a.result(function(){return g(f,void 0,void 0,
function(){return h(this,function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,d)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,d)];case 2:return a.sent(),[2]}})})}())];case 1:c=l.sent();this._applyToController===e&&(this._applyToController=null);if(!1===c.ok)throw c.error;return[2,this]}})})};c.prototype._applyBasemap=function(a,b){return g(this,void 0,void 0,function(){var d;return h(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,
5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return e.sent(),[3,4];case 3:d=e.sent();if(P.isAbortError(d))throw d;return[3,4];case 4:a.map.basemap=Z.clonePreservingTiledLayers(this.basemap,a.map.basemap),e.label=5;case 5:return[2]}})})};c.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};c.prototype._allLayers=function(a){var d=new b;this._collectLayers(a,d);this._collectLayers(a.ground,d);return d};c.prototype._collectLayers=
function(a,b){var d=this;a.layers.forEach(function(a){b.add(a);a.layers&&d._collectLayers(a,b)})};c.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var d=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=d;var e=d&&d.sublayerIds,d=z(a);e&&d&&d.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};c.prototype._applyViewpoint=function(a,b){return g(this,void 0,void 0,function(){return h(this,function(d){switch(d.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2]:[3,4];case 1:return d.sent(),[2];case 2:return a.environment.lighting=this.environment.lighting.clone(),[4,a.goTo(this.viewpoint,b)];case 3:d.sent(),d.label=4;case 4:return a.viewpoint=this.viewpoint,a.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:a.environment.lighting=this.environment.lighting.clone(),d.label=6;case 6:return[2]}})})};
c.prototype._animateToLighting=function(a,b){return g(this,void 0,void 0,function(){var d,e,c,f=this;return h(this,function(l){d=null;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=a.goTo(this.viewpoint,b);P.ignoreAbortErrors(e.then(function(){a.environment.lighting=
f.environment.lighting.clone()}));c=function(){d&&d.remove();a.environment.lighting.cameraTrackingEnabled=!0};return[2,e.then(function(){a.environment.lighting=D.default.fromWebsceneLighting(f.environment.lighting);c()},function(a){c();throw a;})]})})};c.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};c.prototype._setTime=function(a,b,d){a.setTime(b);a.setUTCHours(d/3600);a.setUTCMinutes(d%3600/60);a.setUTCSeconds(d%3600%
60);return a};c.prototype._animateLightingWithCamera=function(a){var b=this,d=this._getTime(new Date(a.environment.lighting.date.toString())),e=d[0],c=d[1],d=this._getTime(this.environment.lighting.date),f=d[0],l=K(c,d[1]),h=a.renderCoordsHelper,g=V.vec3f64.create();h.toRenderCoords(a.camera.position,g);var k=V.vec3f64.create();h.toRenderCoords(this.viewpoint.camera.position,k);var m=V.vec3f64.create(),n=new Date;return a.watch("camera",function(d){h.toRenderCoords(d.position,m);var w=C.vec3.squaredDistance(g,
m),p=C.vec3.squaredDistance(k,m);d=0;0!==w+p&&(d=w/(w+p));w=e+(f-e)*d;d=E.moduloPositive(c+l*d,J);a.environment.lighting.date=b._setTime(n,w,d)})};c.createFrom=function(a,b){return(new this).updateFrom(a,b)};m([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);m([r.property({type:x.default,json:{default:function(){return new x.default({text:""})},write:{isRequired:!0}}})],c.prototype,"title",void 0);m([r.cast("title")],c.prototype,"castTitle",null);m([r.property({type:O.default,
json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],c.prototype,"description",void 0);m([r.cast("description")],c.prototype,"castDescription",null);m([r.property({type:t.default,json:{default:function(){return new t.default({url:""})},write:{isRequired:!0}}})],c.prototype,"thumbnail",void 0);m([r.cast("thumbnail")],c.prototype,"castThumbnail",null);m([r.property({type:p,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);m([r.property({type:k,json:{read:{source:"baseMap"},
write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);m([r.cast("basemap")],c.prototype,"castBasemap",null);m([r.property({type:B.default,json:{write:!0}})],c.prototype,"ground",void 0);m([r.property({type:I,json:{write:{isRequired:!0}}})],c.prototype,"visibleLayers",null);m([r.cast("visibleLayers")],c.prototype,"castVisibleLayers",null);m([r.property({type:A,json:{write:!0}})],c.prototype,"environment",void 0);return c=m([r.subclass("esri.webscene.Slide")],c)}(r.declared(e.JSONSupport))})},
"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(q,c,n,f,m,h,g,k){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(b){b=a.call(this,b)||this;b.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};b.cameraTrackingEnabled=
!0;b.ambientOcclusionEnabled=!1;var d=(new Date).getFullYear(),d=new Date("March 15, "+d+" 12:00:00 UTC");b._set("defaultDate",d);b._set("date",d);return b}n(b,a);d=b;b.fromWebsceneLighting=function(a){return new d(m({},a.cloneConstructProperties()))};Object.defineProperty(b.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});b.prototype.autoUpdate=function(a,b){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=
!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(p.target=this,p.timezoneOffset=e,this.emit("timezone-will-change",p));if(null!=a)return b!==a.getTime()};b.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),b=new d(m({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));
a&&b._set("date",b._get("defaultDate"));b.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;b.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;b.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;b.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return b};b.prototype.cloneWithWebsceneLighting=function(a){var b=this.clone();null!=a.date&&(b.date=a.date);b.directShadowsEnabled=a.directShadowsEnabled;b.displayUTCOffset=a.displayUTCOffset;return b};
b.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var d;f([g.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);f([g.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);f([g.property({type:Date})],b.prototype,"defaultDate",null);f([g.property({type:Date})],b.prototype,"date",null);return b=d=f([g.subclass("esri.views.3d.environment.SceneViewLighting")],b)}(g.declared(h.EventedMixin(k)));c.SceneViewLighting=
q;var p={target:null,timezoneOffset:0};c.default=q})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function k(){var a=null!==c&&c.apply(this,arguments)||this;a.url="";return a}n(k,c);g=k;k.prototype.clone=function(){return new g({url:this.url})};
var g;f([h.property({type:String,json:{write:{isRequired:!0}}})],k.prototype,"url",void 0);return k=g=f([h.subclass("esri.webdoc.support.Thumbnail")],k)}(h.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function k(){var a=
null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(k,c);g=k;k.prototype.clone=function(){return new g({text:this.text})};var g;f([h.property({type:String,json:{write:!0}})],k.prototype,"text",void 0);return k=g=f([h.subclass("esri.webscene.support.Description")],k)}(h.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(q,c,n,f,m,h,g,k,p){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}n(b,a);d=b;b.prototype.clone=function(){return new d({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new m;a.opacity=this.opacity;return a};b.fromGround=function(a){return new d({opacity:a.opacity})};var d;f([g.property({type:Number,json:{type:k.Integer,read:{reader:p.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=p.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=d=f([g.subclass("esri.webscene.support.SlideGround")],b)}(g.declared(h.JSONSupport));c.default=q})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(q,c,n,f,m,h,g,k){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this,a)||this;a.id="";a.sublayerIds=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:h.clone(this.sublayerIds)})};var b;f([g.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);f([g.property({type:[k.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=f([g.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(g.declared(m.JSONSupport));c.SlideVisibleLayer=q;c.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function k(){var a=null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(k,c);g=k;k.prototype.clone=function(){return new g({text:this.text})};
var g;f([h.property({type:String,json:{write:{isRequired:!0}}})],k.prototype,"text",void 0);return k=g=f([h.subclass("esri.webscene.support.Title")],k)}(h.declared(m.JSONSupport));c.default=q})},"esri/webscene/TransportationNetwork":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,h){return function(c){function k(a){return c.call(this,a)||this}n(k,c);g=k;
k.prototype.clone=function(){return new g({name:this.name,path:this.path,title:this.title})};var g;f([h.property({json:{write:!0}})],k.prototype,"name",void 0);f([h.property({json:{write:!0}})],k.prototype,"path",void 0);f([h.property({json:{write:!0}})],k.prototype,"title",void 0);return k=g=f([h.subclass("esri.webscene.TransportationNetwork")],k)}(h.declared(m.JSONSupport))})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,
c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function f(f,h){return c.call(this,f,h,"webscene")||this}n(f,c);Object.defineProperty(f.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(f.Version);c.Version=q;c.default=q})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});q=function(){function c(c,f,g){void 0===g&&(g="");this.major=c;this.minor=f;this._context=g}c.prototype.lessThan=function(c,f){return this.major<c||c===this.major&&this.minor<f};c.prototype.since=function(c,f){return!this.lessThan(c,f)};c.prototype.validate=function(c){if(this.major!==c.major)throw new n((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:c});};c.prototype.clone=function(){return new c(this.major,this.minor,this._context)};c.parse=function(f,h){void 0===h&&(h="");var g=f.split("."),k=g[0],g=g[1],m=/^\s*\d+\s*$/;if(!k||!k.match||!k.match(m))throw new n((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!g||!g.match||!g.match(m))throw new n((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:f});f=parseInt(k,10);k=parseInt(g,10);return new c(f,k,h)};return c}();c.Version=q})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version".split(" "),function(q,
c,n,f,m,h,g,k,p,a,b,d,e,l,P,r,Q,C,V,X,Z,D,E,t,A,v,O,B,y,x,z,G,K,L,I,M,J,N,H,U,Y,ea,R){var T=X.getLogger("esri.WebScene"),aa=new R.default(1,19);return function(a){function c(b){b=a.call(this,b)||this;b._handles=new l;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.transportationNetworks=null;b.presentation=new Y;b.initialViewProperties=new U;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=
null;b._isAuthoringAppSetByUser=!1;b._isAuthoringAppVersionSetByUser=!1;return b}n(c,a);c.prototype.initialize=function(){var a=this;this.when().catch(function(a){T.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(ba){this.addResolvingPromise(D.reject(ba));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};c.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};c.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};c.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};c.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};c.prototype.writeLayers=function(a,
b,c,d){var e=this,f=h({},d,{layerContainerType:"operational-layers"});a=a.map(function(a){return e.verifyWriteLayer(a,d)?a.write(null,f):null}).filter(function(a){return!!a});b[c]=a.toArray()};c.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new e("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};c.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];
return new R.default(parseInt(a[0],10),parseInt(b,10))};c.prototype.writeSourceVersion=function(a,b,c){b[c]=aa.major+"."+aa.minor};Object.defineProperty(c.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});c.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(c.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:p.version};c.prototype.writeGround=function(a,b,c,
d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};c.prototype.readInitialViewProperties=function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=H.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?y.fromJSON(c.spatialReference):y.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new U(a)};c.prototype.writeInitialViewProperties=function(a,b,c,d){a&&
(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):y.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};c.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return D.resolve(this)};c.prototype.loadAll=function(){var a=this;return V.default(this,function(b){var c=a.presentation&&
a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};c.prototype.read=function(a,b){var c=this;b=h({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,e=this._isAuthoringAppSetByUser,f=arguments;v.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);e||(this._isAuthoringAppSetByUser=!1);d||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,k=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=d.filter(function(a){return!g.some(function(b){return k(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(l)})}};c.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=Q.clone(b))};c.prototype.write=
function(a,b){if("loaded"!==this.loadStatus){var c=new e("webscene:not-loaded","Web scene must be loaded before it can be serialized");T.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=h({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};c.prototype.save=function(a){return k(this,void 0,void 0,function(){var b,c,d;return g(this,function(f){switch(f.label){case 0:if(this.portalItem)return[3,
2];T.error("save(): requires the .portalItem property to be set");return[4,D.reject(new e("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:f.sent(),f.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,D.reject(new e("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:f.sent(),f.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return f.sent(),[4,this._loadObjectsWithLayers()];
case 6:return f.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&E.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||G.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return f.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return f.sent(),A.updateOrigins(c),b?[4,b]:[3,10];case 9:f.sent(),f.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return f.sent(),[2,this.portalItem]}})})};c.prototype.saveAs=function(a,b){return k(this,void 0,void 0,function(){var c,d,f,h,k,l;return g(this,function(g){switch(g.label){case 0:if(c=K.from(a))return[3,2];T.error("saveAs(portalItem): requires a portal item parameter");return[4,D.reject(new e("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:g.sent(),g.label=2;case 2:return c.id&&(c=c.clone(),c.id=null),d=c.portal||G.getDefault(),[4,
this.load()];case 3:return g.sent(),[4,this._loadObjectsWithLayers()];case 4:return g.sent(),f=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:d,writtenProperties:[],blockedRelativeUrls:[]}),h=this.write(null,f),[4,this._verifySaveAs(h,f,b)];case 5:return g.sent(),[4,d._signIn()];case 6:return g.sent(),k=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl"),c.type="Web Scene",c.portal=d,this._updateTypeKeywords(c),[4,d.user.addItem({item:c,folder:b&&b.folder,data:h})];
case 7:return g.sent(),this.portalItem=c,r.JSONSupport.prototype.read.call(this,{version:h.version,authoringApp:h.authoringApp,authoringAppVersion:h.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:c.itemUrl&&E.urlToObject(c.itemUrl)}),A.updateOrigins(f),k&&(this.thumbnailUrl=l?E.addQueryParameter(k,"w","8192"):k),[4,this._saveThumbnail()];case 8:return g.sent(),[2,c]}})})};c.prototype._saveThumbnail=function(){return k(this,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?
[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};c.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var f=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new e(a.name,a.message,a.details)});b.blockedRelativeUrls&&(f=f.concat(b.blockedRelativeUrls.map(function(a){return new e("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));
c&&c.ignoreUnsupported&&(f=f.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(f=f.filter(function(a){return"web-document-write:property-required"!==a.name}));var g=c&&c.strictSchemaValidationEnabled;return(g?D.create(function(a){return q(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+
b.join("\n");T.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new e("webscene:schema-validation",a)})}).then(function(a){if(g&&0<a.length)throw L.createSchemaValidationError(a.concat(f));return f}):D.resolve(f)).then(function(a){if(0<a.length)return D.reject(new e("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};c.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?
D.reject(L.createCopyError()):this._verifySave(a,b,c,!0)};c.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};c.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};c.prototype.updateFrom=function(a,b){void 0===b&&(b={});return k(this,
void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:e.sent();if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};c.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return k(this,void 0,void 0,function(){return g(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=
H.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=
a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._updateFromThumbnail=function(a,b){return k(this,void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return c=J.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return d=e.sent(),this.thumbnailUrl=
d.dataUrl,[2]}})})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};c.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};c.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=
0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};c.prototype._loadFromJSON=function(a,b){var c=this,e=new d;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return D.create(function(a){return q(["./portal/support/layersCreator"],
a)})}).then(function(d){var f=c._extractOperationalLayers(a),g=f.operationalLayers,k=f.operationalElevationLayers,f=f.basemapElevationLayers,l=[],m={context:h({},b,{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||G.getDefault());if(0<f.length){var n=h({},m,{context:h({},m.context,{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push(d.populateOperationalLayers(c.ground.layers,f,n))}0<k.length&&(n=h({},m,{context:h({},
m.context,{layerContainerType:"ground"})}),n.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(d.populateOperationalLayers(e,k,n)));g&&0<g.length&&l.push(d.populateOperationalLayers(c.layers,g,m));return D.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(e)})};c.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&
a.push(b.basemap.load())});return D.eachAlways(a).then(function(){})};c.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new e("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new e("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,
{origin:"web-scene",url:E.urlToObject(a.itemUrl),portal:a.portal||G.getDefault()})})};c.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!M.isSpatialReferenceSupported(b,"global"))return D.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));
c=function(a){return!a||I.canProject(a,b)}}else{if(!M.isSpatialReferenceSupported(b,"local"))return D.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},
f=d(a.viewpoint);return f&&!c(f)?D.reject(new e("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode})):(f=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(f=d(f.viewpoint),D.reject(new e("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode}))):D.resolve()};c.prototype._validateHeightModelInfo=function(){var a=x.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?D.reject(a):D.resolve()};c.prototype._validateJSON=function(a){var b=R.default.parse(a.version||"","webscene");aa.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=y.WebMercator.toJSON());return a};c.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(c.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?E.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});c.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};c.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};c.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};c.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};c.fromJSON=function(a){if(!a)throw new e("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};c.VERSION=aa;f([t.property({type:N,json:{write:!0}})],c.prototype,"applicationProperties",void 0);f([t.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",
void 0);f([t.property({type:O,json:{read:{source:"clippingArea.geometry",reader:z.fromJSON},write:{target:"clippingArea.geometry"}}})],c.prototype,"clippingArea",void 0);f([t.writer("clippingArea")],c.prototype,"writeClippingArea",null);f([t.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],c.prototype,"clippingEnabled",void 0);f([t.reader("clippingEnabled",["clippingArea"])],c.prototype,"readClippingEnabled",null);f([t.writer("clippingEnabled")],c.prototype,"writeClippingEnabled",
null);f([t.property({type:B,json:{write:!0}})],c.prototype,"heightModelInfo",void 0);f([t.property({json:{write:{target:"operationalLayers"}}})],c.prototype,"layers",void 0);f([t.writer("layers")],c.prototype,"writeLayers",null);f([t.property({readOnly:!0,type:R.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],c.prototype,"sourceVersion",void 0);f([t.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);f([t.writer("sourceVersion")],c.prototype,
"writeSourceVersion",null);f([t.property({dependsOn:["portalItem.thumbnailUrl"]})],c.prototype,"thumbnailUrl",null);f([t.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringApp",null);f([t.writer("authoringApp")],c.prototype,"writeAuthoringApp",null);f([t.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringAppVersion",null);f([t.writer("authoringAppVersion")],c.prototype,"writeAuthoringAppVersion",null);f([t.property({json:{write:{isRequired:!0,allowNull:!0,
enabled:!0}}})],c.prototype,"ground",void 0);f([t.writer("ground")],c.prototype,"writeGround",null);f([t.property({type:d.ofType(ea),json:{write:!0}})],c.prototype,"transportationNetworks",void 0);f([t.property({type:Y,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=h({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],c.prototype,"presentation",void 0);f([t.property({type:U,nonNullable:!0,json:{default:function(){return new U({viewingMode:"global",spatialReference:y.WebMercator})}}})],
c.prototype,"initialViewProperties",void 0);f([t.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],c.prototype,"readInitialViewProperties",null);f([t.writer("initialViewProperties",{"initialState.environment":{type:H},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],c.prototype,"writeInitialViewProperties",null);f([t.property({type:K})],c.prototype,"portalItem",void 0);f([t.property()],c.prototype,
"resourceInfo",void 0);return c=f([t.subclass("esri.WebScene")],c)}(t.declared(C.LoadableMixin(Z.EsriPromiseMixin(r.JSONSupportMixin(a)))))});