// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../languageUtils ../support/FeatureSet ../support/IdSet ../support/OrderbyClause ../../../core/promiseUtils".split(" "),function(u,v,r,k,n,l,t,m){var q=function(g){function c(a){var b=g.call(this,a)||this;b._orderbyclause=null;b.declaredClass="esri.arcade.featureset.actions.OrderBy";b._maxProcessing=100;b._orderbyclause=a.orderbyclause;b._parent=a.parentfeatureset;return b}r(c,g);c.prototype._getSet=function(a){var b=this;return null===
this._wset?this._ensureLoaded().then(function(){return b._getFilteredSet("",null,null,b._orderbyclause,a)}).then(function(f){b._checkCancelled(a);b._wset=f;return b._wset}):m.resolve(this._wset)};c.prototype.manualOrderSet=function(a,b){var f=this;return this.getIdColumnDictionary(a,[],-1,b).then(function(a){f._orderbyclause.order(a);for(var b=new l([],[],!0,null),d=0;d<a.length;d++)b._known.push(a[d].id);return b})};c.prototype.getIdColumnDictionary=function(a,b,f,e){var c=this;if(f<a._known.length-
1){var d=this._maxQueryRate();if("GETPAGES"===a._known[f+1])return k.tick(this._parent._expandPagedSet(a,d,0,0,e)).then(function(){return c.getIdColumnDictionary(a,b,f,e)});for(var d=f+1,h=[];d<a._known.length&&"GETPAGES"!==a._known[d];)h.push(a._known[d]),d++;f+=h.length;return k.tick(this._parent._getFeatureBatch(h,e)).then(function(d){c._checkCancelled(e);for(var h=0;h<d.length;h++){var p=d[h];b.push({id:p.attributes[c.objectIdField],feature:p})}return c.getIdColumnDictionary(a,b,f,e)})}return 0<
a._candidates.length?k.tick(this._refineSetBlock(a,this._maxProcessingRate(),e)).then(function(){c._checkCancelled(e);return c.getIdColumnDictionary(a,b,f,e)}):m.resolve(b)};c.prototype._isInFeatureSet=function(a){return this._parent._isInFeatureSet(a)};c.prototype._getFeatures=function(a,b,c,e){return this._parent._getFeatures(a,b,c,e)};c.prototype._featureFromCache=function(a){if(void 0===this._featureCache[a]){var b=this._parent._featureFromCache(a);return void 0===b?void 0:null===b?null:this._featureCache[a]=
b}return this._featureCache[a]};c.prototype._fetchAndRefineFeatures=function(){return m.reject(Error("Fetch and Refine should not be called in this featureset"))};c.prototype._getFilteredSet=function(a,b,c,e,g){var d=this;return this._ensureLoaded().then(function(){return d._parent._getFilteredSet(a,b,c,null===e?d._orderbyclause:e,g)}).then(function(a){d._checkCancelled(g);var e;e=new l(a._candidates.slice(0),a._known.slice(0),a._ordered,d._clonePageDefinition(a.pagesDefinition));var f=!0;0<a._candidates.length&&
(f=!1);return!1===e._ordered?d.manualOrderSet(e,g).then(function(a){!1!==f||null===b&&null===c||(a=new l(a._candidates.slice(0).concat(a._known.slice(0)),[],a._ordered,d._clonePageDefinition(a.pagesDefinition)));return a}):e})};return c}(n);n._featuresetFunctions.orderBy=function(g){return""===g?this:new q({parentfeatureset:this,orderbyclause:new t(g)})};return q});