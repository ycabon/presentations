// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../tsSupport/generatorHelper ../tsSupport/awaiterHelper ../Error ../has ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(x,c,t,m,y,f,l,n,g,z){function u(){return m(this,void 0,void 0,function(){var a,b,e;return t(this,function(c){if(d)return[2,d];p=l.createAbortController();a=[];b=function(b){var e=z.create(b).then(function(a){return h[b]=a});a.push(e)};for(e=0;e<r;e++)b(e);d=l.all(a);return[2,d]})})}Object.defineProperty(c,"__esModule",{value:!0});
c.Connection=n;c.RemoteClient=g;var r=f("esri-workers-debug")?1:f("host-browser")?navigator.hardwareConcurrency-1:0;r||(r=f("safari")&&f("mac")||f("trident")?7:2);var v=0,h=[];c.initialize=function(){u()};c.openWithPorts=function(a,b){return new n(a.map(function(a){return new g(a,b,{})}))};c.open=function(a,b){void 0===b&&(b={});return m(this,void 0,void 0,function(){var e,c,d,m,q,p,w;return t(this,function(k){switch(k.label){case 0:if("string"!==typeof a)throw new y("workers:undefined-module","modulePath is missing");
e=b.signal;c=b.strategy||"distributed";f("host-webworker")&&!f("esri-workers")&&(c="local");return"local"!==c?[3,4]:[4,g.loadWorker(a)];case 1:return(d=k.sent())?[3,3]:[4,l.create(function(b){return x([a],b)})];case 2:d=k.sent(),k.label=3;case 3:return l.throwIfAborted(e),m=b.client||d,q=g.connect(d),[2,new n([new g(q,m,b)])];case 4:return[4,u()];case 5:k.sent();l.throwIfAborted(e);if("dedicated"!==c)return[3,7];p=v++;v%=r;return[4,h[p].open(a,b)];case 6:return q=k.sent(),[2,new n([new g(q,b.client,
b)])];case 7:return[4,l.all(h.map(function(c){return c.open(a,b)}))];case 8:return w=k.sent(),[2,new n(w.map(function(a){return new g(a,b.client,b)}))]}})})};c.terminate=function(){d&&(p.abort(),d=null);for(var a=0;a<h.length;a++)h[a]&&h[a].terminate();h.length=0};var d=null,p});