// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../views/support/screenshotUtils".split(" "),function(v,w,m,e,n,p,q,g,d,r,t){var h=new n.default,u=0;return function(k){function c(a){a=k.call(this,a)||this;a.wrap="repeat";return a}m(c,k);f=c;Object.defineProperty(c.prototype,
"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});c.prototype.writeData=function(a,b,c,l){a instanceof HTMLImageElement?a={type:"image-element",src:g.toJSON(a.src,l),crossOrigin:a.crossOrigin}:a instanceof HTMLCanvasElement?
(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a=a instanceof HTMLVideoElement?{type:"video-element",src:g.toJSON(a.src,l),autoplay:a.autoplay,loop:a.loop,muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload}:{type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};c.prototype.readData=function(a){switch(a.type){case "image-element":var b=new Image;b.src=a.src;b.crossOrigin=a.crossOrigin;return b;case "canvas-element":return a=
this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);case "video-element":return b=document.createElement("video"),b.src=a.src,b.crossOrigin=a.crossOrigin,b.autoplay=a.autoplay,b.loop=a.loop,b.muted=a.muted,b.preload=a.preload,b;default:p.neverReached(a)}};Object.defineProperty(c.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof
HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"contentHash",{get:function(){var a=this,b="string"===
typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",c=function(c){void 0===c&&(c="");return"d:"+c+",t:"+a.transparent+",w:"+b};if(null!=this.url)return c(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return c(this.data.src);h.has(this.data)||h.set(this.data,++u);return c(h.get(this.data))}return c()},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new f({url:this.url,
data:this.data,wrap:this.cloneWrap()})};c.prototype.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=new f({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,b);return b};c.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};c.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};
c.prototype.decodeImageData=function(a){for(var b=atob(a.data),c=new Uint8ClampedArray(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return t.wrapImageData(c,a.width,a.height)};c.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};c.from=function(a){return"string"===typeof a?new f({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new f({data:a}):r.ensureClass(f,
a)};var f;e([d.property({type:String,json:{write:g.write}})],c.prototype,"url",null);e([d.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),d.property()],c.prototype,"data",null);e([d.writer("data")],c.prototype,"writeData",null);e([d.reader("data")],c.prototype,"readData",null);e([d.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);e([d.property({json:{write:!0}})],
c.prototype,"wrap",void 0);e([d.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],c.prototype,"contentHash",null);return c=f=e([d.subclass("esri.geometry.support.MeshTexture")],c)}(d.declared(q.JSONSupport))});