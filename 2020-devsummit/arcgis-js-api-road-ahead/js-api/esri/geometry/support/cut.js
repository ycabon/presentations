// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ./aaBoundingRect ./boundsUtils ./jsonUtils ./spatialReferenceUtils".split(" "),function(F,x,y,v,z,E){function A(e){for(var a,d={rings:[]};0<e.length;){var c=e[0];a=!1;var f=c[0],h=f[0],f=f[1],b=c[c.length-1],l=b[0],b=b[1];if(h!==l||f!==b)for(var k=1;k<e.length;k++){var g=e[k],r=g[0],n=r[0],r=r[1],q=g[g.length-1],p=q[0],q=q[1];if(b===r&&l===n){for(a=1;a<g.length;a++)c.push([g[a][0],g[a][1]]);a=!0}else if(b===q&&l===p){for(a=g.length-2;0<=a;a--)c.push([g[a][0],g[a][1]]);a=!0}else if(f===
q&&h===p){for(a=0;a<g.length-1;a++)c.splice(a,0,[g[a][0],g[a][1]]);a=!0}else if(f===r&&h===n){for(a=1;a<g.length;a++)c.unshift([g[a][0],g[a][1]]);a=!0}if(a){e.splice(k,1);h=c[0];f=c[c.length-1];l=h[1];b=f[1];h[0]===f[0]&&l===b&&(e.shift(),0<v.getPointsBoundsWidth(c)&&d.rings.push(c));break}}a||(e.shift(),d.rings.push(c))}return d}function B(e,a,d){var c=e[0];e=e[1];return[d,e+(a[1]-e)/(a[0]-c)*(d-c)]}function C(e,a){e=(e+a)/(2*a);1===e%2&&e--;return Math.floor(e)}Object.defineProperty(x,"__esModule",
{value:!0});x.normalize=function(e){if(!e)return null;if(!e.spatialReference)return e;var a=E.getInfo(e.spatialReference);if(!a)return e;a=a.valid[1];if(z.isPolygon(e)){var d=e,c;e={rings:[],spatialReference:d.spatialReference};var f=v.getBoundsXY(y.create(),d),h=f[2],f=2*Math.ceil((f[0]-a)/(2*a))*a+a;if(f>h)e=d;else{var b=void 0;for(c=void 0;f<h;){var l=d,b=f,d=c=void 0,k=v.getBoundsXY(y.create(),l),g=k[0];if(k[2]<=b)c=l;else if(g>=b)d=l;else{for(var k=[],g=[],r=[],n=0,l=l.rings;n<l.length;n++){var q=
l[n],p=v.getPointsBounds(y.create(),q),m=p[0];if(p[2]<=b)k.push(q);else if(m>=b)g.push(q);else{for(var t=q[q.length-1],p=t[0]<b,m=[],w=0;w<q.length;w++){var u=q[w],x=u[0]<b;x===p?m.push(u):(t=B(t,u,b),m.push(t),p?k.push(m):g.push(m),r.push(t[1]),m=[],m.push([t[0],t[1]]),m.push(u),p=x);t=u}p?k.push(m):g.push(m)}}r.sort();for(n=0;n<r.length-1;n+=2)l=[],l.push([b,r[n]]),l.push([b,r[n+1]]),0<k.length&&k.push(l),0<g.length&&g.push(l);0<k.length&&(c=A(k));0<g.length&&(d=A(g))}c=[c,d];b=c[0];c=c[1];if(b)for(d=
0,k=b.rings;d<k.length;d++)b=k[d],e.rings.push(b);if(null==c)break;d=c;f+=2*a}if(c)for(h=0,f=c.rings;h<f.length;h++)b=f[h],e.rings.push(b)}h=0;for(f=e.rings;h<f.length;h++)for(b=f[h],c=C(v.getPointsBoundsCenterX(b),a),d=0;d<b.length;d++)b[d][0]-=2*c*a;return e}if(z.isPolyline(e)){d=e;e={paths:[],spatialReference:d.spatialReference};f=v.getBoundsXY(y.create(),d);h=f[2];f=2*Math.ceil((f[0]-a)/(2*a))*a+a;if(f>h)e=d;else{for(c=b=void 0;f<h;){n=d;b=f;k=v.getBoundsXY(D,n);g=k[0];d=c=void 0;if(k[2]<=b)c=
n;else if(g>=b)d=n;else for(c={paths:[]},d={paths:[]},k=c.paths,g=d.paths,r=0,n=n.paths;r<n.length;r++)if(l=n[r],p=v.getPointsBounds(D,l),m=p[0],p[2]<=b)k.push(l);else if(m>=b)g.push(l);else{u=l[0];p=u[0]<b;m=[];m.push(u);for(w=1;w<l.length;w++)t=l[w],q=t[0]<b,q===p?m.push(t):(u=B(u,t,b),m.push(u),p?k.push(m):g.push(m),m=[u,t],p=q),u=t;p?k.push(m):g.push(m)}c=[c,d];b=c[0];c=c[1];if(b)for(d=0,k=b.paths;d<k.length;d++)b=k[d],e.paths.push(b);if(null==c)break;d=c;f+=2*a}if(c)for(h=0,f=c.paths;h<f.length;h++)b=
f[h],e.paths.push(b)}h=0;for(f=e.paths;h<f.length;h++)for(b=f[h],c=C(v.getPointsBoundsCenterX(b),a),d=0;d<b.length;d++)b[d][0]-=2*c*a}return e};var D=y.create()});