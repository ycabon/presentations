// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/math/mat3 ./projection ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView ../../../views/3d/support/buffer/math/vec3".split(" "),function(F,p,B,q,C,u,v,w,m,x,l,n){function y(b,a,c){x.computeLinearTransformation(b.spatialReference,[b.x,b.y,b.z||0],c,x.SphericalECEFSpatialReference);
b=r(a?a.unit:null,b.spatialReference);a=b.horizontal;u.mat4.scale(c,c,[a,a,b.vertical]);return c}function z(b,a){b=b.spatialReference;return b.isWGS84||b.isWebMercator&&(!a||!1!==a.geographic)}function r(b,a){if(B.isNone(b))return D;var c=a.isWGS84?1:q.getMetersPerUnit(a);a=a.isWGS84?1:q.getMetersPerVerticalUnitForSR(a);b=q.convertUnit(1,b,"meters");return{horizontal:b*c,vertical:b*a}}Object.defineProperty(p,"__esModule",{value:!0});p.georeference=function(b,a,c){if(z(a,c)){var e=a.spatialReference,
f=y(a,c,t),k=new Float64Array(b.position.length),d;d=b.position;n.transformMat4(l.BufferViewVec3f64.fromTypedArray(k),l.BufferViewVec3f64.fromTypedArray(d),f);d=new Float64Array(d.length);d=m.projectFromECEF(k,d,e);var f=w.normalFromMat4(A,f),g;(g=b.normal)?(a=new Float32Array(g.length),n.transformMat3(l.BufferViewVec3f.fromTypedArray(a),l.BufferViewVec3f.fromTypedArray(g),f),m.projectNormalFromECEF(a,d,k,e,a),g=a):g=null;if(b=b.tangent){a=new Float32Array(b.length);n.transformMat3(l.BufferViewVec3f.fromTypedArray(a,
4*Float32Array.BYTES_PER_ELEMENT),l.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),f);for(f=3;f<a.length;f+=4)a[f]=b[f];m.projectTangentFromECEF(a,d,k,e,a);b=a}else b=null;b={position:d,normal:g,tangent:b}}else{e=new Float64Array(b.position.length);k=b.position;d=a.x;f=a.y;g=a.z||0;c=r(c?c.unit:null,a.spatialReference);a=c.horizontal;c=c.vertical;for(var h=0;h<k.length;h+=3)e[h+0]=k[h+0]*a+d,e[h+1]=k[h+1]*a+f,e[h+2]=k[h+2]*c+g;b={position:e,normal:b.normal,tangent:b.tangent}}return b};
p.ungeoreference=function(b,a,c){if(z(a,c)){var e=a.spatialReference;y(a,c,t);var f=u.mat4.invert(E,t),k=new Float64Array(b.position.length),d=m.projectToECEF(b.position,e,k),g=l.BufferViewVec3f64.fromTypedArray(d),d=new Float64Array(d.length);a=l.BufferViewVec3f64.fromTypedArray(d);n.transformMat4(a,g,f);f=w.normalFromMat4(A,f);(g=b.normal)?(g=m.projectNormalToECEF(g,b.position,k,e,new Float32Array(g.length)),a=l.BufferViewVec3f.fromTypedArray(g),n.transformMat3(a,a,f)):g=null;(a=b.tangent)?(b=m.projectTangentToECEF(a,
b.position,k,e,new Float32Array(a.length)),e=l.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),n.transformMat3(e,e,f)):b=null;b={position:d,normal:g,tangent:b}}else{e=new Float64Array(b.position.length);d=b.position;k=a.x;f=a.y;g=a.z||0;c=r(c?c.unit:null,a.spatialReference);a=c.horizontal;c=c.vertical;for(var h=0;h<d.length;h+=3)e[h+0]=(d[h+0]-k)/a,e[h+1]=(d[h+1]-f)/a,e[h+2]=(d[h+2]-g)/c;b={position:e,normal:b.normal,tangent:b.tangent}}return b};var t=v.mat4f64.create(),E=v.mat4f64.create(),
A=C.mat3f64.create(),D={horizontal:1,vertical:1}});