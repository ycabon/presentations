// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../Polygon ../Polyline ../SpatialReference ./spatialReferenceUtils ./webMercatorUtils ../../tasks/geometry/cut ../../tasks/geometry/simplify".split(" "),function(oa,w,ea,fa,ga,ha,ia,X,ja,R,C,x,S,K,ka,la){function u(a){return"polygon"===a.type?a.rings:a.paths}function t(a,c){return Math.ceil((a-c)/(2*c))}function Y(a,
c){for(var d=0,b=u(a);d<b.length;d++)for(var e=0,g=b[d];e<g.length;e++)g[e][0]+=c;return a}function H(a){for(var c=[],d=0,b=0,e=0;e<a.length;e++){for(var g=a[e],h=null,f=0;f<g.length;f++)h=g[f],c.push(h),0===f?b=d=h[0]:(d=Math.min(d,h[0]),b=Math.max(b,h[0]));h&&c.push([(d+b)/2,0])}return c}function I(a,c){if(!(a instanceof C||a instanceof R))throw ma.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new ha("straightLineDensify: the input geometry is neither polyline nor polygon");
for(var d=[],b=0,e=u(a);b<e.length;b++){var g=e[b],h=[];d.push(h);h.push([g[0][0],g[0][1]]);for(var f=0;f<g.length-1;f++){var n=g[f][0],k=g[f][1],D=g[f+1][0],E=g[f+1][1],p=Math.sqrt((D-n)*(D-n)+(E-k)*(E-k)),v=(E-k)/p,m=(D-n)/p,z=p/c;if(1<z){for(var t=1;t<=z-1;t++){var l=t*c;h.push([m*l+n,v*l+k])}p=(p+Math.floor(z-1)*c)/2;h.push([m*p+n,v*p+k])}h.push([D,E])}}return"polygon"===a.type?new R({rings:d,spatialReference:a.spatialReference}):new C({paths:d,spatialReference:a.spatialReference})}function Z(a,
c,d){c&&(a=I(a,1E6),a=K.webMercatorToGeographic(a,!0));d&&(a=Y(a,d));return a}function aa(a,c,d){if(Array.isArray(a)){var b=a[0];if(b>c){var e=t(b,c);a[0]=b+-2*e*c}else b<d&&(e=t(b,d),a[0]=b+-2*e*d)}else b=a.x,b>c?(e=t(b,c),a=a.clone().offset(-2*e*c,0)):b<d&&(e=t(b,d),a=a.clone().offset(-2*e*d,0));return a}function na(a,c){for(var d=-1,b=function(b){var e=c.cutIndexes[b],f=c.geometries[b],g=u(f);b=function(a){var b=g[a];b.some(function(c){if(180>c[0])return!0;for(var d=c=0;d<b.length;d++){var e=b[d][0];
c=e>c?e:c}c=Number(c.toFixed(9));c=-360*t(c,180);for(d=0;d<b.length;d++)e=f.getPoint(a,d),f.setPoint(a,d,e.clone().offset(c,0));return!0})};for(var k=0;k<g.length;k++)b(k);if(e===d)if("polygon"===a[0].type)for(b=0,k=u(f);b<k.length;b++)a[e]=a[e].addRing(k[b]);else{if("polyline"===a[0].type)for(b=0,k=u(f);b<k.length;b++)a[e]=a[e].addPath(k[b])}else d=e,a[e]=f},e=0;e<c.cutIndexes.length;e++)b(e);return a}function ba(a,c,d){return fa(this,void 0,void 0,function(){var b,e,g,h,f,n,k,D,E,p,v,m,z,w,l,u,
q,x,H,L,A,J,M,I,T,U,ca,da,N,F,r,y,B,G,V,O,P;return ea(this,function(W){switch(W.label){case 0:if(!Array.isArray(a))return[2,ba([a],c)];b=c?c.url:ga.geometryServiceUrl;p=0;v=[];m=[];z=0;for(w=a;z<w.length;z++)l=w[z],X.isNone(l)?m.push(l):(e||(e=l.spatialReference,g=S.getInfo(e),k=(h=e.isWebMercator)?102100:4326,f=Q[k].maxX,n=Q[k].minX,D=Q[k].plus180Line,E=Q[k].minus180Line),g?"mesh"===l.type?m.push(l):"point"===l.type?m.push(aa(l.clone(),f,n)):"multipoint"===l.type?(u=l.clone(),u.points=u.points.map(function(a){return aa(a,
f,n)}),m.push(u)):"extent"===l.type?(q=l.clone(),x=q._normalize(!1,!1,g),m.push(x.rings?new R(x):x)):l.extent?(q=l.extent,H=t(q.xmin,n),L=2*H*f,A=0===L?l.clone():Y(l.clone(),L),q.offset(L,0),q.intersects(D)&&q.xmax!==f?(p=q.xmax>p?q.xmax:p,A=Z(A,h),v.push(A),m.push("cut")):q.intersects(E)&&q.xmin!==n?(p=2*q.xmax*f>p?2*q.xmax*f:p,A=Z(A,h,360),v.push(A),m.push("cut")):m.push(A)):m.push(l.clone()):m.push(l));J=t(p,f);M=-90;I=J;for(T=new C;0<J;)U=-180+360*J,T.addPath([[U,M],[U,-1*M]]),M*=-1,J--;return 0<
v.length&&0<I?[4,ka.cut(b,v,T,d)]:[3,3];case 1:ca=W.sent();da=na(v,ca);N=[];F=[];for(r=0;r<m.length;r++)y=m[r],"cut"!==y?F.push(y):(B=da.shift(),G=a[r],X.isSome(G)&&"polygon"===G.type&&G.rings&&1<G.rings.length&&B.rings.length>=G.rings.length?(N.push(B),F.push("simplify")):F.push(h?K.geographicToWebMercator(B):B));return N.length?[4,la.simplify(b,N,d)]:[2,F];case 2:V=W.sent();O=[];for(r=0;r<F.length;r++)y=F[r],"simplify"!==y?O.push(y):O.push(h?K.geographicToWebMercator(V.shift()):V.shift());return[2,
O];case 3:P=[];for(r=0;r<m.length;r++)y=m[r],"cut"!==y?P.push(y):(B=v.shift(),P.push(!0===h?K.geographicToWebMercator(B):B));return[2,ja.resolve(P)]}})})}Object.defineProperty(w,"__esModule",{value:!0});var ma=ia.getLogger("esri.geometry.support.normalizeUtils"),Q={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new C({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator}),minus180Line:new C({paths:[[[-2.0037508342788905E7,
-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new C({paths:[[[180,-180],[180,180]]],spatialReference:x.WGS84}),minus180Line:new C({paths:[[[-180,-180],[-180,180]]],spatialReference:x.WGS84})}};w.straightLineDensify=I;w.normalizeCentralMeridian=ba;w.getDenormalizedExtent=function(a){var c;if(!a)return null;var d=a.extent;if(!d)return null;var b=a.spatialReference&&S.getInfo(a.spatialReference);if(!b)return d;
var b=b.valid,e=b[0],b=b[1],g=d.width,h=d.xmin;c=d.xmax;c=[c,h];h=c[0];c=c[1];if("extent"===a.type||0===g||g<=b||g>2*b||h<e||c>b)return d;var f;switch(a.type){case "polygon":if(1<a.rings.length)f=H(a.rings);else return d;break;case "polyline":if(1<a.paths.length)f=H(a.paths);else return d;break;case "multipoint":f=a.points}a=d.clone();for(e=0;e<f.length;e++){var n=f[e][0];0>n?(n+=b,c=Math.max(n,c)):(n-=b,h=Math.min(n,h))}a.xmin=h;a.xmax=c;return a.width<g?(a.xmin-=b,a.xmax-=b,a):d};w.normalizeMapX=
function(a,c){if(c=S.getInfo(c)){var d=c.valid;c=d[0];var d=d[1],b=d-c;if(a<c)for(;a<c;)a+=b;if(a>d)for(;a>d;)a-=b}return a}});