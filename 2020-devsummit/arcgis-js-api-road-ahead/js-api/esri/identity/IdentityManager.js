// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../config ../kernel ../request ../core/cookie ../core/Error ../core/Evented ../core/global ../core/lang ../core/object ../core/promiseUtils ../core/string ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),function(v,
y,q,e,b,l,k,h,u,m,t,Q,B,E,z,J,x,C,w,R,K,L,M,H){Object.defineProperty(y,"__esModule",{value:!0});var F={},N=function(b){var f=(new C.Url(b.owningSystemUrl)).host;b=(new C.Url(b.server)).host;var a=/.+\.arcgis\.com$/i;return a.test(f)&&a.test(b)},I=function(b,f){return!!(N(b)&&f&&f.some(function(a){return a.test(b.server)}))};v=function(k){function f(){var a=k.call(this)||this;a._portalConfig=Q.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];a._xoReqs=[];a._portals=[];
a.defaultOAuthInfo=null;a.defaultTokenValidity=60;a.dialog=null;a.formConstructor=R;a.tokenValidity=null;a.signInPage=null;a.useSignInPage=!0;a.normalizeWebTierAuth=!1;a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._agolSuffix=".arcgis.com";a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,
customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|\w+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|\w+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|\w+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",
tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/\w+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|GeoenrichmentServer|VectorTileServer|SceneServer)).*/gi;a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;
a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",function(c){a._pageShowHandler(c)});return a}e(f,k);f.prototype.registerServers=function(a){var c=this,d=this.serverInfos;d?(a=a.filter(function(a){return!c.findServerInfo(a.server)}),this.serverInfos=d.concat(a)):this.serverInfos=a;a.forEach(function(a){a.owningSystemUrl&&
c._portals.push(a.owningSystemUrl);a.hasPortal&&c._portals.push(a.server)})};f.prototype.registerOAuthInfos=function(a){var c=this,d=this.oAuthInfos;d?(a=a.filter(function(a){return!c.findOAuthInfo(a.portalUrl)}),this.oAuthInfos=d.concat(a)):this.oAuthInfos=a};f.prototype.registerToken=function(a){a=q({},a);var c=this._sanitizeUrl(a.server),d=this._isServerRsrc(c),g=this.findServerInfo(c),n=!0,r;g||(g=new H,g.server=this._getServerInstanceRoot(c),d?g.hasServer=!0:(g.tokenServiceUrl=this._getTokenSvcUrl(c),
g.hasPortal=!0),this.registerServers([g]));(r=this._findCredential(c))?(delete a.server,B.mixin(r,a),n=!1):(r=new A({userId:a.userId,server:g.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:d?"server":"portal"}),r.resources=[c],this.credentials.push(r));r.emitTokenChange(!1);n||r.refreshServerTokens()};f.prototype.toJSON=function(){return B.fixJson({serverInfos:this.serverInfos.map(function(a){return a.toJSON()}),oAuthInfos:this.oAuthInfos.map(function(a){return a.toJSON()}),credentials:this.credentials.map(function(a){return a.toJSON()})})};
f.prototype.initialize=function(a){var c=this;if(a){"string"===typeof a&&(a=JSON.parse(a));var d=a.serverInfos,g=a.oAuthInfos;a=a.credentials;if(d){var n=[];d.forEach(function(a){a.server&&a.tokenServiceUrl&&n.push(a.declaredClass?a:new H(a))});n.length&&this.registerServers(n)}if(g){var r=[];g.forEach(function(a){a.appId&&r.push(a.declaredClass?a:new M(a))});r.length&&this.registerOAuthInfos(r)}a&&a.forEach(function(a){a.server&&a.token&&a.expires&&a.expires>Date.now()&&(a=a.declaredClass?a:new A(a),
a.emitTokenChange(),c.credentials.push(a))})}};f.prototype.findServerInfo=function(a){var c;a=this._sanitizeUrl(a);for(var d=0,g=this.serverInfos;d<g.length;d++){var n=g[d];if(this._hasSameServerInstance(n.server,a)){c=n;break}}return c};f.prototype.findOAuthInfo=function(a){var c;a=this._sanitizeUrl(a);for(var d=0,g=this.oAuthInfos;d<g.length;d++){var n=g[d];if(this._hasSameServerInstance(n.portalUrl,a)){c=n;break}}return c};f.prototype.findCredential=function(a,c){var d,g;a=this._sanitizeUrl(a);
g=this._isServerRsrc(a)?"server":"portal";if(c)for(var n=0,r=this.credentials;n<r.length;n++){var b=r[n];if(this._hasSameServerInstance(b.server,a)&&c===b.userId&&b.scope===g){d=b;break}}else for(c=0,n=this.credentials;c<n.length;c++)if(b=n[c],this._hasSameServerInstance(b.server,a)&&-1!==this._getIdenticalSvcIdx(a,b)&&b.scope===g){d=b;break}return d};f.prototype.getCredential=function(a,c){var d,g,n=!0;c&&(d=!!c.token,g=c.error,n=!1!==c.prompt);c=q({},c);a=this._sanitizeUrl(a);var r=z.createAbortController(),
b=z.createResolver(function(){r.abort()});if(c.signal)z.onAbort(c.signal,function(){r.abort()});z.onAbort(r,function(){b.reject(new m("identity-manager:user-aborted","ABORTED"))});if(z.isAborted(r))return b.promise;c.signal=r.signal;var f=this._isAdminResource(a),e=d&&this._doPortalSignIn(a)?this._getEsriAuthCookie():null;if((d=d?this.findCredential(a):null)&&g&&g.details&&498===g.details.httpStatus)d.destroy(),e&&e.token===c.token&&(u.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:document.domain}),
J.endsWith(window.location.hostname,".arcgis.com")&&u.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:"arcgis.com"}));else if(e||d)return a=new m("identity-manager:not-authorized","You are currently signed in as: '"+(e&&e.email||d&&d.userId)+"'. You do not have access to this resource: "+a,{error:g}),b.reject(a),b.promise;if(g=this._findCredential(a,c))return b.resolve(g),b.promise;g=this.findServerInfo(a);if(g)!g.hasServer&&this._isServerRsrc(a)&&(g._restInfoPms=this._getTokenSvcUrl(a),
g.hasServer=!0);else{e=this._getTokenSvcUrl(a);if(!e)return a=new m("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),b.reject(a),b.promise;g=new H;g.server=this._getServerInstanceRoot(a);"string"===typeof e?(g.tokenServiceUrl=e,g.hasPortal=!0):(g._restInfoPms=e,g.hasServer=!0);this.registerServers([g])}n&&g.hasPortal&&void 0===g._selfReq&&!this._findOAuthInfo(a)&&(g._selfReq={owningTenant:c&&c.owningTenant,selfDfd:this._getPortalSelf(g.tokenServiceUrl.replace(this._rePortalTokenSvc,
"/sharing/rest/portals/self"),a)});return this._enqueue(a,g,c,b,f)};f.prototype.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};f.prototype.generateToken=function(a,c,d){var g=this._rePortalTokenSvc.test(a.tokenServiceUrl),n=new C.Url(window.location.href.toLowerCase()),
b=this._getEsriAuthCookie(),f=a.shortLivedTokenValidity,e,l,p,O,G,k,P,D;c&&(D=this.tokenValidity||f||this.defaultTokenValidity,D>f&&0<f&&(D=f));d&&(l=d.isAdmin,p=d.serverUrl,O=d.token,k=d.signal,P=d.ssl,a.customParameters=d.customParameters);l?f=a.adminTokenServiceUrl:(f=a.tokenServiceUrl,G=new C.Url(f.toLowerCase()),b&&(e=(e=b.auth_tier)&&e.toLowerCase()),("web"===e||a.webTierAuth)&&d&&d.serverUrl&&!P&&"http"===n.scheme&&(x.hasSameOrigin(n.uri,f,!0)||"https"===G.scheme&&n.host===G.host&&"7080"===
n.port&&"7443"===G.port)&&(f=f.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));d=B.mixin({query:B.mixin({request:"getToken",username:c&&c.username,password:c&&c.password,serverUrl:p,token:O,expiration:D,referer:l||g?window.location.host:null,client:l?"referer":null,f:"json"},a.customParameters),method:"post",authMode:"anonymous",useProxy:this._useProxy(a,d),signal:k},d&&d.ioArgs);g||(d.withCredentials=!1);return h(f,d).then(function(d){d=d.data;if(!d||!d.token)return new m("identity-manager:authentication-failed",
"Unable to generate token");var g=a.server;F[g]||(F[g]={});c&&(F[g][c.username]=c.password);d.validity=D;return d})};f.prototype.isBusy=function(){return!!this._busy};f.prototype.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(function(a){return a.credential})};f.prototype.checkAppAccess=function(a,c,d){var g=this,n=!1;return this.getCredential(a,{prompt:!1}).then(function(b){var f,e={f:"json"};if("portal"===b.scope)if(c&&(g._doPortalSignIn(a,!0)||d&&d.force))f=b.server+"/sharing/rest/oauth2/validateAppAccess",
e.client_id=c;else if(b.token)f=b.server+"/sharing/rest";else return{credential:b};else if(b.token)f=b.server+"/rest/services";else return{credential:b};b.token&&(e.token=b.token);return h(f,{query:e,authMode:"anonymous"}).then(function(a){if(!1===a.data.valid)throw new m("identity-manager:not-authorized","You are currently signed in as: '"+b.userId+"'.");n=!!a.data.viewOnlyUserTypeApp;return{credential:b}}).catch(function(a){if("identity-manager:not-authorized"===a.name)throw a;a=a.details&&a.details.httpStatus;
if(498===a)throw b.destroy(),new m("identity-manager:not-authenticated","User is not signed in.");if(400===a)throw new m("identity-manager:invalid-request");return{credential:b}})}).then(function(a){return{credential:a.credential,viewOnly:n}})};f.prototype.setOAuthResponseHash=function(a){var c=this._oAuthDfd;this._oAuthDfd=null;if(c&&a)if(clearInterval(this._oAuthIntervalId),"#"===a.charAt(0)&&(a=a.substring(1)),a=x.queryToObject(a),a.error){var d="access_denied"===a.error;a=new m(d?"identity-manager:user-aborted":
"identity-manager:authentication-failed",d?"ABORTED":"OAuth: "+a.error+" - "+a.error_description);c.reject(a)}else{var d=c.oinfo_._oAuthCred,g=new A({userId:a.username,server:c.sinfo_.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:d});d.storage=a.persist?window.localStorage:window.sessionStorage;d.token=g.token;d.expires=g.expires;d.userId=g.userId;d.ssl=g.ssl;d.save();c.resolve(g)}};f.prototype.setRedirectionHandler=function(a){this._redirectFunc=
a};f.prototype.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};f.prototype.setProtocolErrorHandler=function(a){this._protocolFunc=a};f.prototype.signIn=function(a,c,d){var g=this;void 0===d&&(d={});var n=z.createResolver(),b=function(){l&&l.remove();p&&p.remove();e&&e.destroy();g.dialog&&g.dialog.destroy();g.dialog=null},f=function(){b();g._oAuthDfd=null;n.reject(new m("identity-manager:user-aborted","ABORTED"))};if(d.signal)z.onAbort(d.signal,function(){f()});var e=new this.formConstructor;
e.resource=this.getResourceName(a);e.server=c.server;this.dialog=new K;this.dialog.content=e;this.dialog.open=!0;this.emit("dialog-create");var l=e.on("cancel",f),p=e.on("submit",function(a){g.generateToken(c,a,{isAdmin:d.isAdmin,signal:d.signal}).then(function(g){b();g=new A({userId:a.username,server:c.server,token:g.token,expires:null!=g.expires?Number(g.expires):null,ssl:!!g.ssl,isAdmin:d.isAdmin,validity:g.validity});n.resolve(g)}).catch(function(a){e.error=a;e.signingIn=!1})});return n.promise};
f.prototype.oAuthSignIn=function(a,c,d,g){var n=this,b=this._oAuthDfd=z.createResolver();if(g&&g.signal)z.onAbort(g.signal,function(){var a=n._oAuthDfd&&n._oAuthDfd.oAuthWin_;a&&!a.closed?a.close():n.dialog&&e()});b.resUrl_=a;b.sinfo_=c;b.oinfo_=d;g=!g||!1!==g.oAuthPopupConfirmation;if(!d.popup||!g)return this._doOAuthSignIn(a,c,d),b.promise;var f=new this.formConstructor;f.oAuthPrompt=!0;f.server=c.server;this.dialog=new K;this.dialog.content=f;this.dialog.open=!0;this.emit("dialog-create");var e=
function(){h();n._oAuthDfd=null;b.reject(new m("identity-manager:user-aborted","ABORTED"))},l=f.on("cancel",e),p=f.on("submit",function(){h();n._doOAuthSignIn(a,c,d)}),h=function(){l.remove();p.remove();f.destroy();n.dialog.destroy();n.dialog=null};return b.promise};f.prototype.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(function(a){a.destroy()});this.emit("credentials-destroy")};f.prototype._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&
(a=a.substring(1));var a=x.queryToObject(a),c=!1;a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username")?(a.state=JSON.parse(a.state),this._oAuthHash=a,c=!0):a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(c=!0));c&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};f.prototype._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new m("identity-manager:user-aborted",
"ABORTED"),this._errbackFunc(a))};f.prototype._findCredential=function(a,c){var d=this,g=-1,b,f,e,l=c&&c.token;c=c&&c.resource;var m=this._isServerRsrc(a)?"server":"portal",p=this.credentials.filter(function(c){return d._hasSameServerInstance(c.server,a)&&c.scope===m});a=c||a;if(p.length)if(1===p.length)if(c=p[0],f=(b=(e=this.findServerInfo(c.server))&&e.owningSystemUrl)&&this.findCredential(b,c.userId),g=this._getIdenticalSvcIdx(a,c),l)-1!==g&&(c.resources.splice(g,1),this._removeResource(a,f));
else return-1===g&&c.resources.push(a),this._addResource(a,f),c;else{var h,k;p.some(function(c){k=d._getIdenticalSvcIdx(a,c);return-1!==k?(h=c,f=(b=(e=d.findServerInfo(h.server))&&e.owningSystemUrl)&&d.findCredential(b,h.userId),g=k,!0):!1});if(l)h&&(h.resources.splice(g,1),this._removeResource(a,f));else if(h)return this._addResource(a,f),h}};f.prototype._findOAuthInfo=function(a){var c=this.findOAuthInfo(a);if(!c)for(var d=0,g=this.oAuthInfos;d<g.length;d++){var b=g[d];if(this._isIdProvider(b.portalUrl,
a)){c=b;break}}return c};f.prototype._addResource=function(a,c){c&&-1===this._getIdenticalSvcIdx(a,c)&&c.resources.push(a)};f.prototype._removeResource=function(a,c){var d=-1;c&&(d=this._getIdenticalSvcIdx(a,c),-1<d&&c.resources.splice(d,1))};f.prototype._useProxy=function(a,c){return c&&c.isAdmin&&!x.hasSameOrigin(a.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!x.hasSameOrigin(a.tokenServiceUrl,window.location.href)};f.prototype._getOrigin=
function(a){a=new C.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};f.prototype._getServerInstanceRoot=function(a){var c=a.toLowerCase(),d=c.indexOf(this._agsRest);-1===d&&this._isAdminResource(a)&&(d=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===d&&(d=c.indexOf("/sharing"));-1===d&&"/"===c.substr(-1)&&(d=c.length-1);return-1<d?a.substring(0,d):a};f.prototype._hasSameServerInstance=function(a,c){"/"===a.substr(-1)&&(a=a.slice(0,-1));
a=a.toLowerCase();c=this._getServerInstanceRoot(c).toLowerCase();a=this._normalizeAGOLorgDomain(a);c=this._normalizeAGOLorgDomain(c);a=a.substr(a.indexOf(":"));c=c.substr(c.indexOf(":"));return a===c};f.prototype._normalizeAGOLorgDomain=function(a){var c=/^https?:\/\/(?:cdn|\w+\.maps)\.arcgis\.com/i,d=/^https?:\/\/(?:cdndev|\w+\.mapsdevext)\.arcgis\.com/i,g=/^https?:\/\/(?:cdnqa|\w+\.mapsqa)\.arcgis\.com/i;c.test(a)?a=a.replace(c,"https://www.arcgis.com"):d.test(a)?a=a.replace(d,"https://devext.arcgis.com"):
g.test(a)&&(a=a.replace(g,"https://qaext.arcgis.com"));return a};f.prototype._sanitizeUrl=function(a){var c=(l.request.proxyUrl||"").toLowerCase(),d=c?a.toLowerCase().indexOf(c+"?"):-1;-1!==d&&(a=a.substring(d+c.length+1));a=x.normalize(a);return x.urlToObject(a).path};f.prototype._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};f.prototype._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};f.prototype._isServerRsrc=function(a){return this._isRESTService(a)||
this._isAdminResource(a)};f.prototype._isIdenticalService=function(a,c){var d;this._isRESTService(a)&&this._isRESTService(c)?(a=this._getSuffix(a).toLowerCase(),c=this._getSuffix(c).toLowerCase(),d=a===c,d||(d=/(.*)\/(MapServer|FeatureServer).*/gi,d=a.replace(d,"$1")===c.replace(d,"$1"))):this._isAdminResource(a)&&this._isAdminResource(c)?d=!0:this._isServerRsrc(a)||this._isServerRsrc(c)||!this._isPortalDomain(a)||(d=!0);return d};f.prototype._isPortalDomain=function(a){var c=this,d=new C.Url(a.toLowerCase()),
g=this._portalConfig,b=d.authority&&-1!==d.authority.indexOf(this._agolSuffix);!b&&g&&(b=this._hasSameServerInstance(this._getServerInstanceRoot(g.restBaseUrl),d.uri));b||l.portalUrl&&(b=x.hasSameOrigin(a,l.portalUrl,!0));b||(b=this._portals.some(function(a){return c._hasSameServerInstance(a,d.uri)}));return b=b||this._agsPortal.test(d.path)};f.prototype._isIdProvider=function(a,c){var d=-1,g=-1;this._gwDomains.forEach(function(b,f){-1===d&&b.regex.test(a)&&(d=f);-1===g&&b.regex.test(c)&&(g=f)});
var b=!1;if(-1<d&&-1<g)if(0===d||4===d){if(0===g||4===g)b=!0}else if(1===d){if(1===g||2===g)b=!0}else 2===d?2===g&&(b=!0):3===d&&3===g&&(b=!0);if(!b){var f=this.findServerInfo(c),e=f&&f.owningSystemUrl;e&&N(f)&&this._isPortalDomain(e)&&this._isIdProvider(a,e)&&(b=!0)}return b};f.prototype._getIdenticalSvcIdx=function(a,c){for(var d=-1,g=0;g<c.resources.length;g++)if(this._isIdenticalService(a,c.resources[g])){d=g;break}return d};f.prototype._getSuffix=function(a){return a.replace(this._regexSDirUrl,
"").replace(this._regexServerType,"$1")};f.prototype._getTokenSvcUrl=function(a){var c=this,d,g;if(this._isRESTService(a)||this._isAdminResource(a))return g=this._getServerInstanceRoot(a),d=g+"/admin/generateToken",a=g+"/rest/info",g=h(a,{query:{f:"json"}}).then(function(a){return a.data}),{adminUrl:d,promise:g};if(this._isPortalDomain(a)){var b="";this._gwDomains.some(function(c){c.regex.test(a)&&(b=c.tokenServiceUrl);return!!b});b||this._portals.some(function(d){c._hasSameServerInstance(d,a)&&(b=
d+c._gwTokenUrl);return!!b});b||(d=a.toLowerCase().indexOf("/sharing"),-1!==d&&(b=a.substring(0,d)+this._gwTokenUrl));b||(b=this._getOrigin(a)+this._gwTokenUrl);b&&(d=(new C.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===d&&(b=b.replace(/:7080/i,":7443")),b=b.replace(/http:/i,"https:"));return b}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};f.prototype._getPortalSelf=function(a,c){var d;this._gwDomains.some(function(c){c.regex.test(a)&&
(d=c.customBaseUrl);return!!d});if(d)return z.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:d,portalMode:"multitenant",supportsOAuth:!0});"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(c)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return h(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(function(a){return a.data})};f.prototype._hasPortalSession=function(){return!!this._getEsriAuthCookie()};f.prototype._getEsriAuthCookie=
function(){var a=null;if(navigator.cookieEnabled){for(var c=this._getAllCookies("esri_auth"),d=void 0,g=0;g<c.length;g++){var b=JSON.parse(c[g]);if(b.portalApp){a=b;break}d?d.push(b):d=[b]}if(!a&&d)for(c=0;c<d.length;c++)if(b=d[c],window.location.hostname===b.urlKey+"."+b.customBaseUrl){a=b;break}}a&&(b=null,a.expires&&("number"===typeof a.expires?b=a.expires:"string"===typeof a.expires&&(b=Date.parse(a.expires)),isNaN(b)&&(b=null),a.expires=b),b&&b<Date.now()&&(a=null));return a};f.prototype._getAllCookies=
function(a){var c=[];if(a=document.cookie.match(new RegExp("(?:^|; )"+J.escapeRegExpString(a)+"\x3d([^;]*)","g")))for(var d=0;d<a.length;d++){var b=a[d],f=b.indexOf("\x3d");-1<f&&(b=b.substring(f+1),c.push(decodeURIComponent(b)))}return c};f.prototype._doPortalSignIn=function(a,c){if(navigator.cookieEnabled){var d=this._getEsriAuthCookie(),b=this._portalConfig,f=window.location.href,e=this.findServerInfo(a);if((c||this.useSignInPage)&&(b||this._isPortalDomain(f)||d)&&(e?e.hasPortal||e.owningSystemUrl&&
this._isPortalDomain(e.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(f,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),a)||this._isIdProvider(b.restBaseUrl,a))||x.hasSameOrigin(f,a,!0)))return!0}return!1};f.prototype._canUsePortalSignInWorkflow=function(a){return this._doPortalSignIn(a)&&(window===window.top||this._hasPortalSession())};f.prototype._checkProtocol=function(a,c,d,b){var g=!0;b=b?c.adminTokenServiceUrl:c.tokenServiceUrl;0===b.trim().toLowerCase().indexOf("https:")&&
0!==window.location.href.toLowerCase().indexOf("https:")&&x.getProxyRule(b)&&(g=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:c}):!1,g||(a=new m("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),d(a)));return g};f.prototype._enqueue=function(a,c,d,b,f,e){b||(b=z.createResolver());b.resUrl_=a;b.sinfo_=c;b.options_=d;b.admin_=f;b.refresh_=e;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?
(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(b)):this._xoReqs.push(b):this._doSignIn(b);return b.promise};f.prototype._doSignIn=function(a){var c=this;this._busy=a;this._rejectOnPersistedPageShow=!1;var b=function(b){var d=a.options_&&a.options_.resource,g=a.resUrl_,f=a.refresh_,e=!1;-1===c.credentials.indexOf(b)&&(f&&-1!==c.credentials.indexOf(f)?(f.userId=b.userId,f.token=b.token,f.expires=b.expires,f.validity=b.validity,f.ssl=b.ssl,f.creationTime=
b.creationTime,e=!0,b=f):c.credentials.push(b));b.resources||(b.resources=[]);b.resources.push(d||g);b.scope=c._isServerRsrc(g)?"server":"portal";b.emitTokenChange();var d=c._soReqs,p={};c._soReqs=[];d.forEach(function(a){if(!c._isIdenticalService(g,a.resUrl_)){var d=c._getSuffix(a.resUrl_);p[d]||(p[d]=!0,b.resources.push(a.resUrl_))}});a.resolve(b);d.forEach(function(a){c._hasSameServerInstance(c._getServerInstanceRoot(g),a.resUrl_)?a.resolve(b):c._soReqs.push(a)});c._busy=a.resUrl_=a.sinfo_=a.refresh_=
null;e||c.emit("credential-create",{credential:b});c._soReqs.length?c._doSignIn(c._soReqs.shift()):c._xoReqs.length&&c._doSignIn(c._xoReqs.shift())},g=function(b){a.reject(b);c._busy=a.resUrl_=a.sinfo_=a.refresh_=null;c._soReqs.length?c._doSignIn(c._soReqs.shift()):c._xoReqs.length&&c._doSignIn(c._xoReqs.shift())},f=function(d,f,e,l){var h=a.sinfo_,k=!a.options_||!1!==a.options_.prompt,p=h.hasPortal&&c._findOAuthInfo(a.resUrl_);c._canUsePortalSignInWorkflow(a.resUrl_)?(d=c._getEsriAuthCookie(),p=
c._portalConfig,d?(h.webTierAuth||"web"!==(d.auth_tier&&d.auth_tier.toLowerCase())||(h.webTierAuth=!0),b(new A({userId:d.email,server:h.server,token:h.webTierAuth?null:d.token,expires:d.expires}))):k?(k="",d=window.location.href,k=c.signInPage?c.signInPage:p?p.baseUrl+p.signin:c._isIdProvider(d,a.resUrl_)?c._getOrigin(d)+"/home/signin.html":h.tokenServiceUrl.replace(c._rePortalTokenSvc,"")+"/home/signin.html",k=k.replace(/http:/i,"https:"),p&&!1===p.useSSL&&(k=k.replace(/https:/i,"http:")),0===d.toLowerCase().replace("https",
"http").indexOf(k.toLowerCase().replace("https","http"))?(h=new m("identity-manager:unexpected-error","Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+a.resUrl_),g(h)):(c._rejectOnPersistedPageShow=!0,c._redirectFunc?c._redirectFunc({signInPage:k,returnUrlParamName:"returnUrl",returnUrl:d,resourceUrl:a.resUrl_,serverInfo:h}):window.location.href=k+"?returnUrl\x3d"+encodeURIComponent(d))):(h=new m("identity-manager:not-authenticated","User is not signed in."),
g(h))):d?b(new A({userId:d,server:h.server,token:e,expires:null!=l?Number(l):null,ssl:!!f})):p?(d=p._oAuthCred,d||(f=new L(p,window.localStorage),e=new L(p,window.sessionStorage),f.isValid()&&e.isValid()?f.expires>e.expires?(d=f,e.destroy()):(d=e,f.destroy()):d=f.isValid()?f:e,p._oAuthCred=d),d.isValid()?b(new A({userId:d.userId,server:h.server,token:d.token,expires:d.expires,ssl:d.ssl,_oAuthCred:d})):c._oAuthHash&&c._oAuthHash.state.portalUrl===p.portalUrl?(k=c._oAuthHash,h=new A({userId:k.username,
server:h.server,token:k.access_token,expires:Date.now()+1E3*Number(k.expires_in),ssl:"true"===k.ssl,oAuthState:k.state,_oAuthCred:d}),d.storage=k.persist?window.localStorage:window.sessionStorage,d.token=h.token,d.expires=h.expires,d.userId=h.userId,d.ssl=h.ssl,d.save(),c._oAuthHash=null,b(h)):k?a._pendingDfd=c.oAuthSignIn(a.resUrl_,h,p,a.options_).then(b,g):(h=new m("identity-manager:not-authenticated","User is not signed in."),g(h))):k?c._checkProtocol(a.resUrl_,h,g,a.admin_)&&(k=a.options_,a.admin_&&
(k=k||{},k.isAdmin=!0),a._pendingDfd=c.signIn(a.resUrl_,h,k).then(b,g)):(h=new m("identity-manager:not-authenticated","User is not signed in."),g(h))},e=function(){var d=a.sinfo_,f=d.owningSystemUrl,e=a.options_,h,k,l,m;e&&(h=e.token,k=e.error,l=e.prompt);m=c._findCredential(f,{token:h,resource:a.resUrl_});if(!m)for(var e=0,n=c.credentials;e<n.length;e++){var r=n[e];if(c._isIdProvider(f,r.server)){m=r;break}}m?(f=c.findCredential(a.resUrl_,m.userId))?b(f):I(d,c._legacyFed)?(r=m.toJSON(),r.server=
d.server,r.resources=null,b(new A(r))):(a._pendingDfd=c.generateToken(c.findServerInfo(m.server),null,{serverUrl:a.resUrl_,token:m.token,signal:a.options_.signal,ssl:m.ssl})).then(function(c){b(new A({userId:m.userId,server:d.server,token:c.token,expires:null!=c.expires?Number(c.expires):null,ssl:!!c.ssl,isAdmin:a.admin_,validity:c.validity}))},g):(c._busy=null,h&&(a.options_.token=null),(a._pendingDfd=c.getCredential(f.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:d.owningTenant,signal:a.options_.signal,
token:h,error:k,prompt:l})).then(function(){c._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},function(a){g(a)}))};this._errbackFunc=g;var h=a.sinfo_.owningSystemUrl,l=this._isServerRsrc(a.resUrl_),k=a.sinfo_._restInfoPms;k?k.promise.then(function(d){var b=a.sinfo_;b._restInfoPms&&(b.adminTokenServiceUrl=b._restInfoPms.adminUrl,b._restInfoPms=null,b.tokenServiceUrl=E.getDeepValue("authInfo.tokenServicesUrl",d)||E.getDeepValue("authInfo.tokenServiceUrl",d)||E.getDeepValue("tokenServiceUrl",d),
b.shortLivedTokenValidity=E.getDeepValue("authInfo.shortLivedTokenValidity",d),b.currentVersion=d.currentVersion,b.owningTenant=d.owningTenant,(d=b.owningSystemUrl=d.owningSystemUrl)&&c._portals.push(d));l&&b.owningSystemUrl?e():f()},function(){a.sinfo_._restInfoPms=null;var c=new m("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");g(c)}):l&&h?e():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(function(d){var b={},g,f,e,h;d&&(g=d.user&&
d.user.username,b.username=g,b.allSSL=d.allSSL,f=d.supportsOAuth,e=d.currentVersion,"multitenant"===d.portalMode&&(h=d.customBaseUrl));a.sinfo_.webTierAuth=!!g;return g&&c.normalizeWebTierAuth?c.generateToken(a.sinfo_,null,{ssl:b.allSSL}).catch(function(){return null}).then(function(a){b.portalToken=a&&a.token;b.tokenExpiration=a&&a.expires;return b}):!g&&f&&4.4<=parseFloat(e)&&!c._canUsePortalSignInWorkflow(a.resUrl_)?c._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:h,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(function(){return null}).then(function(){return b}):
b}).catch(function(){return null}).then(function(c){a.sinfo_._selfReq=null;c?f(c.username,c.allSSL,c.portalToken,c.tokenExpiration):f()}):f()};f.prototype._generateOAuthInfo=function(a){var c=this,d,b=a.portalUrl,f=a.customBaseUrl,e=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){d=window.location.href;var k=d.indexOf("?");-1<k&&(d=d.slice(0,k));k=d.search(/\/(apps|home)\//);d=-1<k?d.slice(0,k):null}a&&d?(this._hasTestedIfAppIsOnPortal=!0,
a=h(d+"/sharing/rest",{query:{f:"json"}}).then(function(){c.defaultOAuthInfo=new M({appId:"arcgisonline",popup:!0,popupCallbackUrl:d+"/home/oauth-callback.html"})})):a=z.resolve();return a.then(function(){if(c.defaultOAuthInfo)return b=b.replace(/^http:/i,"https:"),h(b+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:e,client_id:c.defaultOAuthInfo.appId,redirect_uri:x.makeAbsolute(c.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(function(a){if(a.data.valid){var d=c.defaultOAuthInfo.clone();
d.portalUrl=a.data.urlKey&&f?"https://"+a.data.urlKey+"."+f:b;c.oAuthInfos.push(d)}})})};f.prototype._doOAuthSignIn=function(a,c,d){var b=this,f={portalUrl:d.portalUrl};!d.popup&&d.preserveUrlHash&&window.location.hash&&(f.hash=window.location.hash);f={client_id:d.appId,response_type:"token",state:JSON.stringify(f),expiration:d.expiration,locale:d.locale,redirect_uri:d.popup?x.makeAbsolute(d.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};d.forceLogin&&(f.force_login=!0);var e=d.portalUrl.replace(/^http:/i,
"https:")+"/sharing/oauth2/authorize",h=e+"?"+x.objectToQuery(f);if(d.popup){var k=window.open(h,"esriJSAPIOAuth",d.popupWindowFeatures);k?(k.focus(),this._oAuthDfd.oAuthWin_=k,this._oAuthIntervalId=setInterval(function(){if(k.closed){clearInterval(b._oAuthIntervalId);var a=b._oAuthDfd;if(a){var c=new m("identity-manager:user-aborted","ABORTED");a.reject(c)}}},500)):(a=new m("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?
this._oAuthRedirectFunc({authorizeParams:f,authorizeUrl:e,resourceUrl:a,serverInfo:c,oAuthInfo:d}):window.location.href=h};return f=b([w.subclass("esri.identity.IdentityManagerBase")],f)}(w.declared(t));y.IdentityManagerBase=v;var A=function(h){function f(a){var c=h.call(this,a)||this;c._oAuthCred=null;c.tokenRefreshBuffer=2;a&&a._oAuthCred&&(c._oAuthCred=a._oAuthCred);return c}e(f,h);f.prototype.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};
f.prototype.refreshToken=function(){var a=this,c=k.id.findServerInfo(this.server),b=c&&c.owningSystemUrl,f=!!b&&"server"===this.scope,e=f&&I(c,k.id._legacyFed),h=c.webTierAuth,l=h&&k.id.normalizeWebTierAuth,m=F[this.server],u=m&&m[this.userId],m=this.resources&&this.resources[0],p=f&&k.id.findServerInfo(b),B={username:this.userId,password:u},t;if(!h||l)if(f&&!p&&k.id.serverInfos.some(function(a){k.id._isIdProvider(b,a.server)&&(p=a);return!!p}),h=p&&k.id.findCredential(p.server,this.userId),!f||h)if(e)h.refreshToken();
else{if(f)t={serverUrl:m,token:h&&h.token,ssl:h&&h.ssl};else if(l)B=null,t={ssl:this.ssl};else if(u)this.isAdmin&&(t={isAdmin:!0});else return f=void 0,m&&(m=k.id._sanitizeUrl(m),this._enqueued=1,f=k.id._enqueue(m,c,null,null,this.isAdmin,this),f.then(function(){a._enqueued=0;a.refreshServerTokens()}).catch(function(){a._enqueued=0})),f;return k.id.generateToken(f?p:c,f?null:B,t).then(function(c){a.token=c.token;a.expires=null!=c.expires?Number(c.expires):null;a.creationTime=Date.now();a.validity=
c.validity;a.emitTokenChange();a.refreshServerTokens()}).catch(function(){})}};f.prototype.refreshServerTokens=function(){var a=this;"portal"===this.scope&&k.id.credentials.forEach(function(c){var b=k.id.findServerInfo(c.server),f=b&&b.owningSystemUrl;c!==a&&c.userId===a.userId&&f&&"server"===c.scope&&(k.id._hasSameServerInstance(a.server,f)||k.id._isIdProvider(f,a.server))&&(I(b,k.id._legacyFed)?(c.token=a.token,c.expires=a.expires,c.creationTime=a.creationTime,c.validity=a.validity,c.emitTokenChange()):
c.refreshToken())})};f.prototype.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var c=this.server&&k.id.findServerInfo(this.server),b=(c=c&&c.owningSystemUrl)&&k.id.findServerInfo(c);!1===a||c&&"portal"!==this.scope&&(!b||!b.webTierAuth||k.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};f.prototype.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;
this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var a=k.id.credentials.indexOf(this);-1<a&&k.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};f.prototype.toJSON=function(){var a=B.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),c=this.resources;c&&0<c.length&&(a.resources=c.slice());return a};f.prototype._startRefreshTimer=
function(){clearTimeout(this._refreshTimer);var a=6E4*this.tokenRefreshBuffer,c=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();0>c&&(c=0);this._refreshTimer=setTimeout(this.refreshToken.bind(this),c>a?c-a:c)};b([w.property()],f.prototype,"creationTime",void 0);b([w.property()],f.prototype,"expires",void 0);b([w.property()],f.prototype,"isAdmin",void 0);b([w.property()],f.prototype,"oAuthState",void 0);b([w.property()],f.prototype,"resources",void 0);b([w.property()],f.prototype,
"scope",void 0);b([w.property()],f.prototype,"server",void 0);b([w.property()],f.prototype,"ssl",void 0);b([w.property()],f.prototype,"token",void 0);b([w.property()],f.prototype,"tokenRefreshBuffer",void 0);b([w.property()],f.prototype,"userId",void 0);b([w.property()],f.prototype,"validity",void 0);return f=b([w.subclass("esri.identity.Credential")],f)}(w.declared(t.EventedAccessor));y.Credential=A})},"esri/core/cookie":function(){define(["require","exports"],function(v,y){Object.defineProperty(y,
"__esModule",{value:!0});y.writeCookie=function(q,e,b){void 0===b&&(b={});var l=b.expires;if("number"===typeof l){var k=new Date;k.setTime(k.getTime()+864E5*l);l=b.expires=k}"string"!==typeof l&&(b.expires=l.toUTCString());q=q+"\x3d"+encodeURIComponent(e);for(var h in b)q+="; "+h,e=b[h],!0!==e&&(q+="\x3d"+e);document.cookie=q}})},"esri/identity/IdentityForm":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./nls/identity ../core/Error ../core/accessorSupport/decorators ../intl/substitute ../widgets/Widget ../widgets/support/widget".split(" "),
function(v,y,q,e,b,l,k,h,u,m){return function(u){function t(b){b=u.call(this,b)||this;b._usernameInputNode=null;b._passwordInputNode=null;b.signingIn=!1;b.server=null;b.resource=null;b.error=null;b.oAuthPrompt=!1;return b}q(t,u);t.prototype.render=function(){var e=this.error,k=this.server,l=this.resource,t=this.signingIn,u=this.oAuthPrompt,k=m.tsx("div",{class:"esri-identity-form__group"},h.substitute(u?b.oAuthInfo:b.info,{server:/\.arcgis\.com/i.test(k)?"ArcGIS Online":k,resource:"("+(l||b.lblItem)+
")"})),l=u?null:m.tsx("div",{class:"esri-identity-form__group"},m.tsx("label",{class:"esri-identity-form__label"},b.lblUser,m.tsx("input",{value:"",required:!0,autofocus:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:m.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),u=u?null:m.tsx("div",{class:"esri-identity-form__group"},m.tsx("label",{class:"esri-identity-form__label"},b.lblPwd,m.tsx("input",{value:"",required:!0,type:"password",bind:this,afterCreate:m.storeNode,
"data-node-ref":"_passwordInputNode",class:"esri-input"}))),t=m.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},m.tsx("input",{type:"submit",disabled:!!t,value:t?b.lblSigning:b.lblOk,class:"esri-button"}),m.tsx("input",{type:"button",value:b.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),e=e?m.tsx("div",null,e.details&&e.details.httpStatus?b.invalidUser:b.noAuthService):null;return m.tsx("form",{class:"esri-identity-form",
bind:this,onsubmit:this._submit},k,e,l,u,t)};t.prototype._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};t.prototype._submit=function(b){b.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})};e([m.renderable(),
k.property()],t.prototype,"signingIn",void 0);e([m.renderable(),k.property()],t.prototype,"server",void 0);e([m.renderable(),k.property()],t.prototype,"resource",void 0);e([m.renderable(),k.property({type:l})],t.prototype,"error",void 0);e([m.renderable(),k.property()],t.prototype,"oAuthPrompt",void 0);return t=e([k.subclass("esri.identity.IdentityForm")],t)}(k.declared(u))})},"esri/identity/IdentityModal":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common ../core/accessorSupport/decorators ../widgets/Widget ../widgets/support/widget".split(" "),
function(v,y,q,e,b,l,k,h){return function(k){function m(e){e=k.call(this,e)||this;e.container=document.createElement("div");e.title=b.auth.signIn;e.content=null;e.open=!1;document.body.appendChild(e.container);return e}q(m,k);m.prototype.render=function(){var e,k=this.id,m=this.content,l=this.title,u=this.open&&!!m,m=(e={},e["esri-identity-modal--open"]=u,e["esri-identity-modal--closed"]=!u,e);e=h.tsx("button",{class:"esri-identity-modal__close-button","aria-label":b.close,bind:this,onclick:this._close},
h.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"}));var q=k+"_title",k=k+"_content",l=l?h.tsx("h1",{id:q,class:"esri-identity-modal__title"},l):null,l=u?h.tsx("div",{class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":q,"aria-describedby":k},e,l,this._renderContent(k)):null;return h.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",m)},l)};m.prototype._close=function(){this.open=!1};m.prototype._renderContent=function(b){var e=this.content;return"string"===
typeof e?h.tsx("div",{class:"esri-identity-modal__content",id:b,innerHTML:e}):h.isWidget(e)?h.tsx("div",{class:"esri-identity-modal__content",id:b},e.render()):e instanceof HTMLElement?h.tsx("div",{class:"esri-identity-modal__content",id:b,bind:e,afterCreate:this._attachToNode}):null};m.prototype._attachToNode=function(b){b.appendChild(this)};e([l.property({readOnly:!0})],m.prototype,"container",void 0);e([h.renderable(),l.property()],m.prototype,"title",void 0);e([h.renderable(),l.property()],m.prototype,
"content",void 0);e([h.renderable(),l.property()],m.prototype,"open",void 0);return m=e([l.subclass("esri.identity.IdentityModal")],m)}(l.declared(k))})},"esri/identity/OAuthCredential":function(){define(["require","exports"],function(v,y){v=function(){function q(e,b){this.userId=this.token=this.ssl=this.expires=this.storage=this.oAuthInfo=null;this.oAuthInfo=e;this.storage=b;this._init()}q.prototype.isValid=function(){var e=!1;if(this.oAuthInfo&&this.token&&this.userId){var b=Date.now();this.expires>
b&&(this.expires-b)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}return e};q.prototype.save=function(){if(this.storage){var e=this._load(),b=this.oAuthInfo;if(b&&b.authNamespace&&b.portalUrl){var l=e[b.authNamespace];l||(l=e[b.authNamespace]={});l[b.portalUrl]={expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(e))}catch(k){console.log(k)}}}};q.prototype.destroy=function(){var e=this._load(),b=this.oAuthInfo;if(b&&
b.appId&&b.portalUrl&&this.token&&this.expires>Date.now()){var l=b.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",k=new FormData;k.append("f","json");k.append("auth_token",this.token);k.append("client_id",b.appId);k.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(l,k);else{var h=new XMLHttpRequest;h.open("POST",l);h.send(k)}}if(b&&b.authNamespace&&b.portalUrl&&this.storage&&(l=e[b.authNamespace])){delete l[b.portalUrl];
try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(e))}catch(u){console.log(u)}}b&&(this.oAuthInfo=b._oAuthCred=null)};q.prototype._init=function(){var e=this._load(),b=this.oAuthInfo;b&&b.authNamespace&&b.portalUrl&&(e=e[b.authNamespace])&&(e=e[b.portalUrl])&&(this.expires=e.expires,this.ssl=e.ssl,this.token=e.token,this.userId=e.userId)};q.prototype._load=function(){var e={};if(this.storage){var b=this.storage.getItem("esriJSAPIOAuth");if(b)try{e=JSON.parse(b)}catch(l){console.log(l)}}return e};
return q}();v.prototype.declaredClass="esri.identity.OAuthCredential";return v})},"esri/identity/OAuthInfo":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(v,y,q,e,b,l){return function(b){function h(e){e=b.call(this,e)||this;e._oAuthCred=null;e.appId=null;e.authNamespace="/";e.expiration=20160;e.forceLogin=!1;e.locale=null;e.minTimeUntilExpiration=30;e.popup=!1;e.popupCallbackUrl=
"oauth-callback.html";e.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";e.portalUrl="https://www.arcgis.com";e.preserveUrlHash=!1;return e}q(h,b);k=h;h.prototype.clone=function(){return k.fromJSON(this.toJSON())};var k;e([l.property({json:{write:!0}})],h.prototype,"appId",void 0);e([l.property({json:{write:!0}})],h.prototype,"authNamespace",void 0);e([l.property({json:{write:!0}})],h.prototype,"expiration",void 0);e([l.property({json:{write:!0}})],h.prototype,"forceLogin",
void 0);e([l.property({json:{write:!0}})],h.prototype,"locale",void 0);e([l.property({json:{write:!0}})],h.prototype,"minTimeUntilExpiration",void 0);e([l.property({json:{write:!0}})],h.prototype,"popup",void 0);e([l.property({json:{write:!0}})],h.prototype,"popupCallbackUrl",void 0);e([l.property({json:{write:!0}})],h.prototype,"popupWindowFeatures",void 0);e([l.property({json:{write:!0}})],h.prototype,"portalUrl",void 0);e([l.property({json:{write:!0}})],h.prototype,"preserveUrlHash",void 0);return h=
k=e([l.subclass("esri.identity.OAuthInfo")],h)}(l.declared(b.JSONSupport))})},"esri/identity/ServerInfo":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(v,y,q,e,b,l){return function(b){function h(e){e=b.call(this,e)||this;e.adminTokenServiceUrl=null;e.currentVersion=null;e.hasPortal=null;e.hasServer=null;e.owningSystemUrl=null;e.owningTenant=null;e.server=null;e.shortLivedTokenValidity=
null;e.tokenServiceUrl=null;e.webTierAuth=null;return e}q(h,b);e([l.property({json:{write:!0}})],h.prototype,"adminTokenServiceUrl",void 0);e([l.property({json:{write:!0}})],h.prototype,"currentVersion",void 0);e([l.property({json:{write:!0}})],h.prototype,"hasPortal",void 0);e([l.property({json:{write:!0}})],h.prototype,"hasServer",void 0);e([l.property({json:{write:!0}})],h.prototype,"owningSystemUrl",void 0);e([l.property({json:{write:!0}})],h.prototype,"owningTenant",void 0);e([l.property({json:{write:!0}})],
h.prototype,"server",void 0);e([l.property({json:{write:!0}})],h.prototype,"shortLivedTokenValidity",void 0);e([l.property({json:{write:!0}})],h.prototype,"tokenServiceUrl",void 0);e([l.property({json:{write:!0}})],h.prototype,"webTierAuth",void 0);return h=e([l.subclass("esri.identity.ServerInfo")],h)}(l.declared(b.JSONSupport))})},"*now":function(v){v(['dojo/i18n!*preload*esri/identity/nls/IdentityManager*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});define("require exports ../core/tsSupport/decorateHelper ../core/tsSupport/declareExtendsHelper ../kernel ../core/accessorSupport/decorators ./IdentityManagerBase".split(" "),function(v,y,q,e,b,l,k){v=new (function(b){function h(){return null!==b&&b.apply(this,arguments)||this}e(h,b);return h=q([l.subclass("esri.identity.IdentityManager")],h)}(l.declared(k.IdentityManagerBase)));b.setId(v);return v});