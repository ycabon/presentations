// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISImageService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../geometry ../../Graphic ../../rasterRenderers ../../request ../../core/Error ../../core/jsonMap ../../core/lang ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../support/commonProperties ../support/DimensionalDefinition ../support/ExportImageServiceParameters ../support/Field ../support/FieldsIndex ../support/imageryRendererUtils ../support/MosaicRule ../support/PixelBlock ../support/RasterFunction ../support/RasterInfo ../support/RasterJobHandler ../support/rasterFormats/RasterCodec ../../renderers/support/RasterSymbolizer ../../tasks/ImageServiceIdentifyTask ../../tasks/QueryTask ../../tasks/support/FeatureSet ../../tasks/support/ImageServiceIdentifyParameters ../../tasks/support/Query".split(" "),
function(D,v,u,h,b,q,l,a,e,g,c,d,k,t,f,p,r,m,n,B,A,F,w,x,y,z,C,E,H,G,L,I,Q,J,K,R,P,S){function T(a){return a?JSON.stringify(a).match(/"rasterFunction":"(.*?")/gi).map(function(a){return a.replace('"rasterFunction":"',"").replace('"',"")}).join("/"):null}Object.defineProperty(v,"__esModule",{value:!0});var V=f.getLogger("esri.layers.mixins.ArcGISImageService"),O=k.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),M=k.strict()({esriNoDataMatchAny:"any",
esriNoDataMatchAll:"all"}),W=k.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"});v.ArcGISImageService=function(f){return function(f){function k(){var a=null!==f&&f.apply(this,arguments)||this;a._functionRasterInfos={};a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a._defaultServiceMosaicRule=null;a.rasterAttributeTableFieldPrefix="Raster.";a.adjustAspectRatio=
null;a.bandCount=null;a.bandIds=void 0;a.capabilities=null;a.compressionQuality=void 0;a.compressionTolerance=.01;a.copyright=null;a.definitionExpression=null;a.exportImageServiceParameters=null;a.rasterInfo=null;a.fields=null;a.fullExtent=null;a.hasMultidimensions=!1;a.imageMaxHeight=4100;a.imageMaxWidth=4100;a.interpolation=void 0;a.multidimensionalInfo=null;a.noData=null;a.noDataInterpretation=void 0;a.objectIdField=null;a.pixelSizeX=null;a.pixelSizeY=null;a.pixelFilter=null;a.raster=void 0;a.viewId=
void 0;a.renderer=null;a.rasterAttributeTable=null;a.rasterFunctionInfos=null;a.serviceDataType=null;a.spatialReference=null;a.pixelType=null;a.serviceRasterInfo=null;a.sourceJSON=null;a.url=null;a.version=null;return a}h(k,f);k.prototype.initialize=function(){this._set("exportImageServiceParameters",new w.ExportImageServiceParameters({layer:this}))};k.prototype.readDefaultServiceMosaicRule=function(a,c){return C.fromJSON(c)};Object.defineProperty(k.prototype,"rasterFunctionNamesIndex",{get:function(){var a=
new Map;if(!this.rasterFunctionInfos||1>this.rasterFunctionInfos.length)return a;this.rasterFunctionInfos.forEach(function(c){a.set(c.name.toLowerCase().replace(/ /gi,"_"),c.name)});return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"queryTask",{get:function(){return new K({url:this.url})},enumerable:!0,configurable:!0});k.prototype.readCapabilities=function(a){return a&&a.split(",").map(function(a){return a.trim()})};k.prototype.writeCompressionQuality=function(a,c,d){null!=
a&&"lerc"!==this.format&&(c[d]=a)};k.prototype.writeCompressionTolerance=function(a,c,d){"lerc"===this.format&&null!=a&&(c[d]=a)};Object.defineProperty(k.prototype,"fieldsIndex",{get:function(){return this.fields?new y(this.fields):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"format",{get:function(){return this._get("format")||(null!=this.pixelFilter?"lerc":"jpgpng")},set:function(a){a&&-1<"png png8 png24 png32 jpg bmp jpgpng lerc tiff".split(" ").indexOf(a.toLowerCase())&&
this._set("format",a.toLowerCase())},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"mosaicRule",{set:function(a){a&&a.mosaicMethod&&(a=C.fromJSON(u({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});k.prototype.readMosaicRule=function(a,c){return C.fromJSON(a||c.mosaicRule||c)};k.prototype.writeMosaicRule=function(a,c,d){a=this.mosaicRule;var b=this.definitionExpression;a?b&&b!==a.where&&(a=
a.clone(),a.where=b):b&&(a=new C({where:b}));this._isValidCustomizedMosaicRule(a)&&(c[d]=a.toJSON())};k.prototype.writeNoData=function(a,c,d){null!=a&&"number"===typeof a&&(c[d]=a)};k.prototype.readObjectIdField=function(a,c){a||(a=(a=c.fields.filter(function(a){return"esriFieldTypeOID"===a.type||"oid"===a.type}))&&a[0]&&a[0].name);return a};Object.defineProperty(k.prototype,"parsedUrl",{get:function(){return this.url?m.urlToObject(this.url):null},enumerable:!0,configurable:!0});k.prototype.readRenderer=
function(a,c,d){a=g.read(c&&c.layerDefinition&&c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.renderer,d)||void 0;if(null!=a)return z.isSupportedRendererType(a)||V.warn("ArcGISImageService","Imagery layer doesn't support given renderer type."),a};Object.defineProperty(k.prototype,"rasterFields",{get:function(){var a=this.rasterAttributeTableFieldPrefix||"Raster.",c=new x({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"}),d=new x({name:"Raster.ServicePixelValue",
alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),b=new x({name:"Raster.ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),f=this.fields?t.clone(this.fields):[];f.push(d);this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})&&this.fields&&0<this.fields.length&&f.push(c);10.4<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.some(function(a){return"none"===a.name.toLowerCase()})&&
f.push(b);this.rasterFunctionInfos&&this.rasterFunctionInfos.filter(function(a){return"none"!==a.name.toLowerCase()}).forEach(function(a){f.push(new x({name:"Raster.ServicePixelValue."+a.name,alias:a.name,domain:null,editable:!1,length:50,type:"string"}))});null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(f.push(new x({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),
f.push(new x({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));(c=this.rasterInfo.attributeTable&&this.rasterInfo.attributeTable.fields||null)&&0<c.length&&(c=c.filter(function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}).map(function(c){var d=t.clone(c);d.name=a+c.name;return d}),f=f.concat(c));return f},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=H.fromJSON(u({},
a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,configurable:!0});k.prototype.readRenderingRule=function(a,c){a=c.rasterFunctionInfos;return c.renderingRule||a&&a.length&&"None"!==a[0].name?H.fromJSON(c.renderingRule||{rasterFunctionInfos:c.rasterFunctionInfos}):null};k.prototype.writeRenderingRule=function(a,c,d){this._isRFTJson(a)||(c[d]=a.toJSON())};k.prototype.readSpatialReference=function(c,d){return(c=
c||d.extent.spatialReference)?a.SpatialReference.fromJSON(c):null};k.prototype.readPixelType=function(a){return W.fromJSON(a)||a};k.prototype.writePixelType=function(a,c,d){if(p.isNone(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)c[d]=W.toJSON(a)};k.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=c.hasOwnProperty("fields")||c.hasOwnProperty("timeInfo")?10:9.3);return a};k.prototype.applyFilter=function(a){var c=a;this.pixelFilter&&(c=this._clonePixelData(a),
this.pixelFilter(c));return c};k.prototype.applyRenderer=function(a,c){return l(this,void 0,void 0,function(){var d,f,b,e;return q(this,function(k){switch(k.label){case 0:d=a;if(this._isPicture()||!this.renderer||!this._symbolizer||this.pixelFilter)return[3,5];f=JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer.toJSON());b=this._rasterJobHandler.instance;if(!b)return[3,4];if(!f)return[3,2];this._cachedRendererJson=this.renderer.toJSON();this._symbolizer.bind();return[4,b.updateSymbolizer(this._symbolizer,
c)];case 1:k.sent(),k.label=2;case 2:return[4,b.symbolize(a,c)];case 3:return e=k.sent(),d={extent:a.extent,pixelBlock:e},[3,5];case 4:d={extent:a.extent,pixelBlock:this._symbolizer.symbolize(a)},k.label=5;case 5:return[2,d]}})})};k.prototype.destroy=function(){this._shutdownJobHandler()};k.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};k.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&
this._shutdownJobHandler()};k.prototype.fetchImage=function(a,c,b,f){var e=this;void 0===f&&(f={});if(null==a||null==c||null==b)return r.reject(new d("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required."));var k=this.renderer||this._symbolizer?this.generateRasterInfo(this.renderingRule,{signal:f.signal}):null;return r.when(k).then(function(d){d&&(e.rasterInfo=d);d={imageServiceParameters:e.getExportImageServiceParameters(a,
c,b,f.timeExtent),imageProps:{extent:a,width:c,height:b,format:e.format},requestAsImageElement:f.requestAsImageElement&&!e.pixelFilter||!1,signal:f.signal};return e._requestArrayBuffer(d)})};k.prototype.fetchKeyProperties=function(a){a=a&&a.renderingRule&&a.renderingRule.toJSON();return c(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return a.data})};k.prototype.fetchRasterAttributeTable=function(a){a=
a&&a.renderingRule&&a.renderingRule.toJSON();return 10.1>this.version?r.reject(new d("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):c(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return R.fromJSON(a.data)})};k.prototype.getCatalogItemRasterInfo=function(d,f){return l(this,void 0,void 0,function(){var b,e,k,g,p;return q(this,function(m){switch(m.label){case 0:return b=
c(this.parsedUrl.path+"/"+d+"/info",u({query:this._getQueryParams(),responseType:"json"},f)).then(function(a){return a.data}),e=c(this.parsedUrl.path+"/"+d+"/info/keyProperties",u({query:this._getQueryParams(),responseType:"json"},f)).then(function(a){return a.data}).catch(function(){}),[4,r.all([b,e])];case 1:k=m.sent();if(!k[0])return[2,void 0];g=a.Extent.fromJSON(k[0].extent);p=k[0].statistics?k[0].statistics.map(function(a){return{min:a[0],max:a[1],avg:a[2],stddev:a[3]}}):null;return[2,new G({bandCount:k[0].bandCount,
extent:g,spatialReference:g.sr,pixelSize:new a.Point({x:k[0].pixelSizeX,y:k[0].pixelSizeY,spatialReference:g.sr}),pixelType:k[0].pixelType.toLowerCase(),statistics:p,histograms:k[0].histograms,keyProperties:k[1]})]}})})};k.prototype.getCatalogItemICSInfo=function(d,f){return l(this,void 0,void 0,function(){var b,e,k,g,p,m,n,t,l,h,y,x,B,A,w,z,C,E,H,F,L,G,Z,v,I,J,Y,Q,K;return q(this,function(q){switch(q.label){case 0:return[4,c(this.parsedUrl.path+"/"+d+"/info/ics",u({query:this._getQueryParams(),responseType:"json"},
f))];case 1:e=(b=q.sent().data)&&b.ics;if(!e)return[2,void 0];k=10.7<=this.version?c(this.parsedUrl.path+"/"+d+"/info/icstopixel",u({query:this._getQueryParams(),responseType:"json"},f)).then(function(a){return a.data}).catch(function(){return{}}):{};g=e.extent.spatialReference;if(!g)for(p in e.geodataXform)e.geodataXform[p].spatialReference&&(g=e.geodataXform[p].spatialReference);m={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[e.extent]}),inSR:g.wkid||g,outSR:"0:"+d};
n=c(this.parsedUrl.path+"/project",u({query:this._getQueryParams(m),responseType:"json"},f)).then(function(a){return a.data});t=5;l=(e.extent.xmin+e.extent.xmax)/2;h=(e.extent.ymax-e.extent.ymin)/(t+1);y=e.extent.ymin+h;x=[];for(B=0;B<t;B++)x.push({x:l,y:y+h*B});A={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:x}),inSR:g.wkid||g,outSR:"0:"+d};w=c(this.parsedUrl.path+"/project",u({query:this._getQueryParams(A),responseType:"json"},f)).then(function(a){return a.data});return[4,
r.all([k,n,w])];case 2:z=q.sent();C=z[0].ipxf;null==C&&(E=e.geodataXform&&e.geodataXform.xf_0)&&"topup"===E.name.toLowerCase()&&(C={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:E.coefficients,cellsizeRatio:0,type:"GeometricXform"}});if(H=a.Extent.fromJSON(z[1]&&z[1].geometries&&z[1].geometries[0]))H.spatialReference=new a.SpatialReference({wkid:0,imageCoordinateSystem:e});F=z[2].geometries.filter(function(a){return null!=a});L=F.length;for(B=I=v=Z=G=0;B<L;B++)G+=
F[B].x,Z+=F[B].y,v+=F[B].x*F[B].x,I+=F[B].x*F[B].y;J=(L*I-G*Z)/(L*v-G*G);Y=0;Q=F[t-1].x>F[0].x;K=F[t-1].y>F[0].y;Infinity===J?Y=K?90:270:0===J?Y=Q?0:180:0<J?Y=Q?180*Math.atan(J)/Math.PI:180*Math.atan(J)/Math.PI+180:0>J&&(Y=K?180+180*Math.atan(J)/Math.PI:360+180*Math.atan(J)/Math.PI);return[2,{ics:e,icsToPixelTransform:C,icsExtent:H,northDirection:Y}]}})})};k.prototype.generateRasterInfo=function(a,c){return l(this,void 0,void 0,function(){var d,f;return q(this,function(b){switch(b.label){case 0:if((!a||
"none"===a.functionName.toLowerCase())&&p.isSome(this.serviceRasterInfo))return[2,this.serviceRasterInfo];d=T(a);if(this._functionRasterInfos[d])return[2,this._functionRasterInfos[d]];f=this._generateRasterInfo(a,c);this._functionRasterInfos[d]=f;b.label=1;case 1:return b.trys.push([1,3,,4]),[4,f];case 2:return[2,b.sent()];case 3:return b.sent(),this._functionRasterInfos[d]=null,[2,null];case 4:return[2]}})})};k.prototype.getExportImageServiceParameters=function(a,c,d,f){a=a.clone().shiftCentralMeridian();
var b=a.spatialReference;if(b.imageCoordinateSystem)var e=b.imageCoordinateSystem,k=e.id,e=e.referenceServiceName,b=null!=k?e?-1<this.parsedUrl.path.toLowerCase().indexOf("/"+e.toLowerCase()+"/")?"0:"+k:JSON.stringify({icsid:k,icsns:e}):"0:"+k:JSON.stringify({ics:b.imageCoordinateSystem});else b=b.wkid||JSON.stringify(b.toJSON());p.isSome(this.serviceRasterInfo)&&this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);var k=this.exportImageServiceParameters.toJSON(),
e=k.bandIds,g=k.noData,m=k.mosaicRule,n=k.renderingRule;e instanceof Array&&0<e.length&&(k.bandIds=e.join(","));g instanceof Array&&0<g.length&&(k.noData=g.join(","));var r=this.timeInfo;m&&m.multidimensionalDefinition&&f&&r&&r.startField&&(m.multidimensionalDefinition=m.multidimensionalDefinition.filter(function(a){return a.dimensionName!==r.startField}));k.mosaicRule=m&&JSON.stringify(m);k.renderingRule=n&&JSON.stringify(n);e={};if(f)if(g=f.toJSON(),f=g.start,g=g.end,f&&g&&f===g)e.time=""+f;else if(null!=
f||null!=g)e.time=(null==f?"null":f)+","+(null==g?"null":g);return u({bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:b,imageSR:b,size:c+","+d},k,e)};k.prototype.queryRasters=function(a){return this.queryTask.execute(a)};k.prototype.queryVisibleRasters=function(c,f){var b=this;if(!c)return r.reject(new d("imagery-layer: query-visible-rasters","missing query parameter"));var e=f||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};f=e.pixelSize;var k=e.returnDomainValues,
g=e.returnTopmostRaster,p=e.showNoDataRecords,m=!1,n=e=null,t=this.rasterFunctionNamesIndex;if(c.outFields&&10.4<=this.version){var h=c.outFields.filter(function(a){return-1<a.toLowerCase().indexOf("raster.servicepixelvalue")&&24<a.length}).map(function(a){a=a.slice(25);return[b._updateRenderingRulesFunctionName(a,t),a]}),e=h.map(function(a){return new H({functionName:a[0]})}),n=h.map(function(a){return a[1]}),m=c.outFields.some(function(a){return-1===a.toLowerCase().indexOf("raster.servicepixelvalue")});
0===e.length?this.renderingRule?(e.push(this.renderingRule),n.push(this.renderingRule.functionName)):e=null:this.renderingRule&&!e.some(function(a){return a.functionName===b.renderingRule.functionName})&&(e.push(this.renderingRule),n.push(this.renderingRule.functionName))}var l=!c.outSpatialReference||c.outSpatialReference.equals(this.spatialReference);f=this._getQueryParams({geometry:c.geometry,timeExtent:c.timeExtent,mosaicRule:this.exportImageServiceParameters.mosaicRule,renderingRule:10.4>this.version?
this.renderingRule:null,renderingRules:e,pixelSize:f,returnCatalogItems:m,returnGeometry:l,maxItemCount:g?1:null});delete f.f;var y=new P(f),x=new J({url:this.url}),B=this.generateRasterInfo(this.renderingRule);return r.create(function(f){B.then(function(){x.execute(y).then(function(e){var g=c.outFields;if(m&&!l&&e.catalogItems&&e.catalogItems.features&&0<e.catalogItems.features.length){var r=b.objectIdField||"ObjectId",t=e.catalogItems.features,h=t.map(function(a){return a.attributes&&a.attributes[r]}),
h=new S({objectIds:h,returnGeometry:!0,outSpatialReference:c.outSpatialReference,outFields:[r]});return b.queryRasters(h).then(function(d){d&&d.features&&0<d.features.length&&d.features.forEach(function(d){t.forEach(function(f){f.attributes[r]===d.attributes[r]&&(f.geometry=new a.Polygon(d.geometry),f.geometry.spatialReference=c.outSpatialReference)})});f(b._processVisibleRastersResponse(e,{returnDomainValues:k,templateRRFunctionNames:n,showNoDataRecords:p,templateFields:g}))}).catch(function(){throw new d("imagery-layer:query-visible-rasters",
"encountered error when querying visible rasters geometry");})}f(b._processVisibleRastersResponse(e,{returnDomainValues:k,templateRRFunctionNames:n,showNoDataRecords:p,templateFields:g}))}).catch(function(){throw new d("imagery-layer:query-visible-rasters","encountered error when querying visible rasters");})})})};k.prototype._fetchService=function(a){return l(this,void 0,void 0,function(){var d,f,b,e,k,g,m=this;return q(this,function(n){switch(n.label){case 0:return(d=this.sourceJSON)?[3,2]:[4,c(this.parsedUrl.path,
{query:this._getQueryParams(),responseType:"json",signal:a})];case 1:f=n.sent(),b=f.data,e=f.ssl,this.sourceJSON=d=b,e&&(this.url=this.url.replace(/^http:/i,"https:")),n.label=2;case 2:return this.read(d,{origin:"service",url:this.parsedUrl}),p.isSome(this.serviceRasterInfo)&&!this.rasterInfo&&(this.rasterInfo=this.serviceRasterInfo),k=p.isSome(this.serviceRasterInfo)?r.resolve(this.serviceRasterInfo):this._fetchAuxiliaryRasterInfo({serviceInfo:d,signal:a}).then(function(a){m._set("serviceRasterInfo",
a);return a}),g=this.renderingRule&&"none"!==this.renderingRule.functionName.toLowerCase()?this.generateRasterInfo(this.renderingRule,{signal:a}):null,[2,r.all([k,g]).then(function(a){a[1]?m._set("rasterInfo",a[1]):m._set("rasterInfo",a[0]);m._configDefaultRenderer();m.watch("renderer",function(){return m._configDefaultRenderer()});m.watch("renderingRule",function(a){(m.renderer||m._symbolizer||m.popupEnabled&&m.popupTemplate)&&m.generateRasterInfo(a).then(function(a){a&&(m.rasterInfo=a)})});(a=p.isSome(m.serviceRasterInfo)&&
m.serviceRasterInfo.multidimensionalInfo)&&m._updateMultidimensionalDefinition(a)})]}})})};k.prototype._initJobHandler=function(){return l(this,void 0,void 0,function(){var a,c=this;return q(this,function(d){switch(d.label){case 0:if(null!=this._rasterJobHandler.connectionPromise)return[2,this._rasterJobHandler.connectionPromise];a=new L;this._rasterJobHandler.connectionPromise=a.initialize().then(function(){c._rasterJobHandler.instance=a},function(){return null});return[4,this._rasterJobHandler.connectionPromise];
case 1:return d.sent(),[2]}})})};k.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0};k.prototype._isPicture=function(){return!this.format||-1<this.format.indexOf("jpg")||-1<this.format.indexOf("png")};k.prototype._configDefaultRenderer=function(){if(!this._isPicture()&&!this.pixelFilter){if(!this.bandIds&&3<=this.rasterInfo.bandCount){var a=
z.getDefaultBandCombination(this.rasterInfo);!a||3===this.rasterInfo.bandCount&&0===a[0]&&1===a[1]&&2===a[2]||(this.bandIds=a)}this.renderer||(this.renderer=z.createDefaultRenderer(this.rasterInfo,this.bandIds));this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=this.rasterInfo):this._symbolizer=new Q({renderer:this.renderer,rasterInfo:this.rasterInfo});this._symbolizer.bind()||(this._symbolizer=null)}};k.prototype._clonePixelData=function(a){return null==a?a:{extent:a.extent&&
a.extent.clone(),pixelBlock:a.pixelBlock&&a.pixelBlock.clone()}};k.prototype._getQueryParams=function(a){return u({raster:this.raster,viewId:this.viewId,f:"json"},a)};k.prototype._decodePixelBlock=function(a,c,d){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:a,options:c}):I.decode(a,c,d)};k.prototype._fetchAuxiliaryRasterInfo=function(f){var b=f&&f.serviceInfo;if(!b)return r.reject(new d("imagery-layer:fetch-metadata","valid serviceInfo is required"));var e=f.renderingRule?
JSON.stringify(f.renderingRule.toJSON()):null,k=f.signal;f=b.hasRasterAttributeTable&&10.1<=this.version?c(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.1<=this.version?e:null}),signal:k}).then(function(a){return R.fromJSON(a.data)}).catch(function(){return null}):!1;var g=b.hasColormap&&10.1<=this.version?c(this.parsedUrl.path+"/colormap",{query:this._getQueryParams({renderingRule:10.6<=this.version?e:null}),signal:k}).then(function(a){return a.data&&a.data.colormap}):
!1,m=b.hasHistograms&&10.1<=this.version?c(this.parsedUrl.path+"/histograms",{query:this._getQueryParams({renderingRule:10.1<=this.version?e:null}),signal:k}).then(function(a){return a.data&&a.data.histograms}):!1,e=10.3<=this.version?c(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:e}),signal:k}).then(function(a){return a.data}).catch(function(){}):!1,k=b.hasMultidimensions&&10.3<=this.version?c(this.parsedUrl.path+"/multidimensionalInfo",{query:this._getQueryParams(),
signal:k}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;return r.all([f,g,m,e,k]).then(function(c){var d=null;if(b.minValues&&b.minValues.length===b.bandCount)for(var d=[],f=0;f<b.minValues.length;f++)d.push({min:b.minValues[f],max:b.maxValues[f],avg:b.meanValues[f],stddev:b.stdvValues[f]});var f=Math.ceil((b.extent.xmax-b.extent.xmin)/b.pixelSizeX-.1),e=Math.ceil((b.extent.ymax-b.extent.ymin)/b.pixelSizeY-.1),k=a.SpatialReference.fromJSON(b.spatialReference||b.extent.spatialReference);
return new G({width:f,height:e,bandCount:b.bandCount,extent:a.Extent.fromJSON(b.extent),spatialReference:k,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,spatialReference:k}),pixelType:b.pixelType.toLowerCase(),statistics:d,attributeTable:c[0]||null,colormap:c[1]||null,histograms:c[2]||null,keyProperties:c[3]||null,multidimensionalInfo:c[4]||null})})};k.prototype._requestArrayBuffer=function(a){var f=this,b=a.imageProps,e=a.signal;if(a.requestAsImageElement&&!this.pixelFilter&&b.format&&-1<
b.format.indexOf("png"))return c(this.parsedUrl.path+"/exportImage",{responseType:"image",query:this._getQueryParams(u({f:"image"},a.imageServiceParameters)),signal:e}).then(function(a){return{imageElement:a.data,params:b}});var k=this._initJobHandler();a=c(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",query:this._getQueryParams(u({f:"image"},a.imageServiceParameters)),signal:e});return r.all([a,k]).then(function(a){a=a[0].data;var c=b.format||"jpgpng",k=c;"bsq"!==k&&"bip"!==k&&
(k=I.getFormat(a));if(!k)throw new d("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(a)));var k=-1<c.indexOf("png")&&("png"===k||"jpg"===k),g={signal:e};return k?I.decode(a,u({useCanvas:!0},b),g).then(function(a){return{pixelData:{pixelBlock:a,extent:b.extent},params:b}}):f._decodePixelBlock(a,{width:b.width,height:b.height,planes:null,pixelType:null,noDataValue:null,format:c},g).then(function(a){return{pixelData:{pixelBlock:a,extent:b.extent},
params:b}})})};k.prototype._generateRasterInfo=function(a,d){return l(this,void 0,void 0,function(){var b,f;return q(this,function(e){switch(e.label){case 0:return[4,c(this.parsedUrl.path,u({query:this._getQueryParams({renderingRule:a}),responseType:"json"},d))];case 1:return b=e.sent().data,[4,this._fetchAuxiliaryRasterInfo(u({serviceInfo:b,renderingRule:a},d))];case 2:return f=e.sent(),[2,f]}})})};k.prototype._isValidCustomizedMosaicRule=function(a){return a&&JSON.stringify(a.toJSON())!==JSON.stringify(this._defaultServiceMosaicRule&&
this._defaultServiceMosaicRule.toJSON())};k.prototype._updateMultidimensionalDefinition=function(a){if(!this._isValidCustomizedMosaicRule(this.mosaicRule)){var c=a.variables[0].dimensions;a=[];for(var d in c)if(c.hasOwnProperty(d)){var b=c[d],f=b.extent,e=!0,k=[f[0]];b.hasRanges&&!0===b.hasRanges?(e=!1,k=[b.values[0]]):"stdz"===b.name.toLowerCase()&&Math.abs(f[1])<=Math.abs(f[0])&&(k=[f[1]]);a.push(new F({variableName:"",dimensionName:c[d].name,isSlice:e,values:k}))}0<a.length&&(this.mosaicRule=this.mosaicRule||
new C,d=this.mosaicRule.multidimensionalDefinition,!d||d&&0>=d.length)&&(this.mosaicRule.multidimensionalDefinition=a)}};k.prototype._formatAttributeValue=function(a,c){if("string"===typeof a&&(c=(c=this._getFieldInfo(this.popupTemplate&&this.popupTemplate.fieldInfos,c))&&c.format)){var d=void 0,b=void 0;return-1<a.trim().indexOf(",")?(d=",",this._formatDelimitedString(a,d,d+" ",c)):-1<a.trim().indexOf(" ")?(d=b=" ",this._formatDelimitedString(a,d,b,c)):this._formatNumberFromString(a,c)}return a};
k.prototype._getFieldInfo=function(a,c){if(a&&a.length&&c){var d=c.toLowerCase(),b=void 0;a.some(function(a){return!a.fieldName||a.fieldName.toLowerCase()!==d&&a.fieldName.toLowerCase()!==d.replace(/ /g,"_")?!1:(b=a,!0)});return b}};k.prototype._formatDelimitedString=function(a,c,d,b){var f=this;return a&&c&&d&&b?a.trim().split(c).map(function(a){return f._formatNumberFromString(a,b)}).join(d):a};k.prototype._formatNumberFromString=function(a,c){if(!a||!c)return a;var d=Number(a);return isNaN(d)?
a:c.format(d)};k.prototype._processVisibleRastersResponse=function(a,c){c=c||{};var d=a.value,b=c.templateRRFunctionNames,f=c.showNoDataRecords,k=c.returnDomainValues,g=c.templateFields;c=a.processedValues;var m=a.catalogItems&&a.catalogItems.features,n=a.properties&&a.properties.Values&&a.properties.Values.map(function(a){return a.replace(/ /gi,", ")})||[],r=this.objectIdField||"ObjectId";a="string"===typeof d&&-1<d.toLowerCase().indexOf("nodata");var t=[];!d||m||a||(m={},m[r]=0,m=new e(this.fullExtent,
null,m),n=[d],m=[m]);if(!m)return[];this._updateResponseFieldNames(m,g);for(var h,l,r=0;r<m.length;r++){g=m[r];if(null!=d&&!a){h=n[r];l=this.renderingRule&&c&&0<c.length&&b&&0<b.length&&-1<b.indexOf(this.renderingRule.functionName)?c[b.indexOf(this.renderingRule.functionName)]:d;if("nodata"===h.toLowerCase()&&!f)continue;g.attributes["Raster.ItemPixelValue"]=this._formatAttributeValue(h,"Raster.ItemPixelValue");g.attributes["Raster.ServicePixelValue"]=this._formatAttributeValue(l,"Raster.ServicePixelValue");
this._updateFeatureWithMagDirValues(g,h);var y=this.fields&&0<this.fields.length;l=this.renderingRule&&p.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable?y?h:d:l;this.renderingRule||(l=y?h:d);this._updateFeatureWithRasterAttributeTableValues(g,l)}g.sourceLayer=this;k&&this._updateFeatureWithDomainValues(g);if(b&&c&&b.length===c.length)for(h=0;h<b.length;h++)y="Raster.ServicePixelValue."+b[h],g.attributes[y]=this._formatAttributeValue(c[h],y);t.push(m[r])}return t};k.prototype._updateFeatureWithRasterAttributeTableValues=
function(a,c){var d=this,b=this.rasterInfo&&this.rasterInfo.attributeTable||p.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable,f=b&&b.features;if(f){var b=b.fields,e=b.map(function(a){return a.name}).filter(function(a){return"value"===a.toLowerCase()}),k=e&&e[0];if(k){var g=f.filter(function(a){return a.attributes[k]===(null!=c?parseInt(c,10):null)});g&&g[0]&&b.forEach(function(c){var b=d.rasterAttributeTableFieldPrefix+c.name;a.attributes[b]=d._formatAttributeValue(g[0].attributes[c.name],
b)})}}};k.prototype._updateFeatureWithMagDirValues=function(c,d){if(this.pixelFilter&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)){var b=d.replace(" ",",").split(",").map(function(a){return parseFloat(a)});d=b.map(function(a){return[a]});b=b.map(function(a){return{minValue:a,maxValue:a,noDataValue:null}});d=new E({height:1,width:1,pixelType:"f32",pixels:d,statistics:b});this.pixelFilter({pixelBlock:d,extent:new a.Extent(0,
0,0,0,this.spatialReference)});c.attributes["Raster.Magnitude"]=d.pixels[0][0];c.attributes["Raster.Direction"]=d.pixels[1][0]}};k.prototype._updateFeatureWithDomainValues=function(a){var c=this.fields&&this.fields.filter(function(a){return a.domain&&"coded-value"===a.domain.type});null!=c&&c.forEach(function(c){var d=a.attributes[c.name];if(null!=d){var b=c.domain.codedValues.filter(function(a){return a.code===d})[0];b&&(a.attributes[c.name]=b.name)}})};k.prototype._updateResponseFieldNames=function(a,
c){if(c&&!(1>c.length)){var d=this.fieldsIndex;d&&a.forEach(function(a){if(a&&a.attributes)for(var b=0;b<c.length;b++){var f=c[b];if(d.has(f)){var e=d.get(f).name;e!==f&&(a.attributes[f]=a.attributes[e],delete a.attributes[e])}}})}};k.prototype._updateRenderingRulesFunctionName=function(a,c){if(a&&!(1>a.length)){if("Raw"===a)return a.replace("Raw","None");var d=a.toLowerCase().replace(/ /gi,"_");return c.has(d)?c.get(d):a}};k.prototype._isRFTJson=function(a){return a.name&&a.arguments&&a.function&&
a.hasOwnProperty("functionType")};b([n.property()],k.prototype,"_functionRasterInfos",void 0);b([n.property()],k.prototype,"_rasterJobHandler",void 0);b([n.property()],k.prototype,"_symbolizer",void 0);b([n.property()],k.prototype,"_defaultServiceMosaicRule",void 0);b([n.reader("_defaultServiceMosaicRule",["defaultMosaicMethod"])],k.prototype,"readDefaultServiceMosaicRule",null);b([n.property()],k.prototype,"_cachedRendererJson",void 0);b([n.property()],k.prototype,"rasterAttributeTableFieldPrefix",
void 0);b([n.property({readOnly:!0,dependsOn:["rasterFunctionInfos"]})],k.prototype,"rasterFunctionNamesIndex",null);b([n.property({readOnly:!0,dependsOn:["url"]})],k.prototype,"queryTask",null);b([n.property()],k.prototype,"adjustAspectRatio",void 0);b([n.property({readOnly:!0}),n.aliasOf("serviceRasterInfo.bandCount")],k.prototype,"bandCount",void 0);b([n.property({type:[B.Integer],json:{write:!0}})],k.prototype,"bandIds",void 0);b([n.property({readOnly:!0})],k.prototype,"capabilities",void 0);
b([n.reader("capabilities")],k.prototype,"readCapabilities",null);b([n.property({type:Number})],k.prototype,"compressionQuality",void 0);b([n.writer("compressionQuality")],k.prototype,"writeCompressionQuality",null);b([n.property({type:Number})],k.prototype,"compressionTolerance",void 0);b([n.writer("compressionTolerance")],k.prototype,"writeCompressionTolerance",null);b([n.property({json:{read:{source:"copyrightText"}}})],k.prototype,"copyright",void 0);b([n.property({type:String,json:{read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],k.prototype,"definitionExpression",void 0);b([n.property({readOnly:!0,constructOnly:!0})],k.prototype,"exportImageServiceParameters",void 0);b([n.property()],k.prototype,"rasterInfo",void 0);b([n.property({readOnly:!0,type:[x]})],k.prototype,"fields",void 0);b([n.property({readOnly:!0,dependsOn:["fields"]})],k.prototype,"fieldsIndex",null);b([n.property({type:String,json:{write:!0}})],k.prototype,"format",null);b([n.property({type:a.Extent})],
k.prototype,"fullExtent",void 0);b([n.property({readOnly:!0})],k.prototype,"hasMultidimensions",void 0);b([n.property({json:{read:{source:"maxImageHeight"}}})],k.prototype,"imageMaxHeight",void 0);b([n.property({json:{read:{source:"maxImageWidth"}}})],k.prototype,"imageMaxWidth",void 0);b([n.property({type:String,json:{read:{reader:O.read},write:{writer:O.write}}})],k.prototype,"interpolation",void 0);b([n.property({type:C})],k.prototype,"mosaicRule",null);b([n.reader("mosaicRule",["mosaicRule","defaultMosaicMethod"])],
k.prototype,"readMosaicRule",null);b([n.writer("mosaicRule")],k.prototype,"writeMosaicRule",null);b([n.property({readOnly:!0}),n.aliasOf("serviceRasterInfo.multidimensionalInfo")],k.prototype,"multidimensionalInfo",void 0);b([n.property()],k.prototype,"noData",void 0);b([n.writer("noData")],k.prototype,"writeNoData",null);b([n.property({type:String,json:{read:{reader:M.read},write:{writer:M.write}}})],k.prototype,"noDataInterpretation",void 0);b([n.property({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],
k.prototype,"objectIdField",void 0);b([n.reader("objectIdField")],k.prototype,"readObjectIdField",null);b([n.property({readOnly:!0,dependsOn:["url"]})],k.prototype,"parsedUrl",null);b([n.property({readOnly:!0}),n.aliasOf("serviceRasterInfo.pixelSize.x")],k.prototype,"pixelSizeX",void 0);b([n.property({readOnly:!0}),n.aliasOf("serviceRasterInfo.pixelSize.y")],k.prototype,"pixelSizeY",void 0);b([n.property({type:Function})],k.prototype,"pixelFilter",void 0);b([n.property()],k.prototype,"raster",void 0);
b([n.property()],k.prototype,"viewId",void 0);b([n.property({types:g.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],k.prototype,"renderer",void 0);b([n.reader("renderer")],k.prototype,"readRenderer",null);b([n.property(A.opacityDrawingInfo)],k.prototype,"opacity",void 0);b([n.property({readOnly:!0}),n.aliasOf("serviceRasterInfo.attributeTable")],k.prototype,"rasterAttributeTable",void 0);b([n.property({readOnly:!0,
dependsOn:["fields","rasterInfo"]})],k.prototype,"rasterFields",null);b([n.property({readOnly:!0})],k.prototype,"rasterFunctionInfos",void 0);b([n.property({type:H})],k.prototype,"renderingRule",null);b([n.reader("renderingRule",["renderingRule","rasterFunctionInfos"])],k.prototype,"readRenderingRule",null);b([n.writer("renderingRule")],k.prototype,"writeRenderingRule",null);b([n.property()],k.prototype,"serviceDataType",void 0);b([n.property({readOnly:!0,type:a.SpatialReference})],k.prototype,"spatialReference",
void 0);b([n.reader("spatialReference",["spatialReference","extent"])],k.prototype,"readSpatialReference",null);b([n.property()],k.prototype,"pixelType",void 0);b([n.reader("pixelType")],k.prototype,"readPixelType",null);b([n.writer("pixelType")],k.prototype,"writePixelType",null);b([n.property({constructOnly:!0,type:G})],k.prototype,"serviceRasterInfo",void 0);b([n.property()],k.prototype,"sourceJSON",void 0);b([n.property(A.url)],k.prototype,"url",void 0);b([n.property({readOnly:!0})],k.prototype,
"version",void 0);b([n.reader("version",["currentVersion","fields","timeInfo"])],k.prototype,"readVersion",null);return k=b([n.subclass("esri.layers.mixins.ArcGISImageService")],k)}(n.declared(f))}})},"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterShadedReliefRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),function(D,v,u,h,b,q,l,a){function e(a,d){if(!a)return null;
var c;c=a?g[a.type]||null:null;if(c)return c=new c,c.read(a,d),c;d&&d.messages&&a&&d.messages.push(new u("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:d}));return null}Object.defineProperty(v,"__esModule",{value:!0});v.ClassBreaksRenderer=h;v.RasterColormapRenderer=b;v.RasterStretchRenderer=l;v.UniqueValueRenderer=a;v.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":a,"class-breaks":h,"raster-colormap":b,"raster-stretch":l,
"raster-shaded-relief":q}};var g={uniqueValue:a,classBreaks:h,rasterStretch:l,rasterColormap:b,rasterShadedRelief:q};v.read=e;v.fromJSON=function(a,d){return e(a,d)}})},"esri/renderers/RasterColormapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),function(D,v,u,h,b,q,l,a,e){return function(b){function c(a){a=
b.call(this,a)||this;a.type="raster-colormap";return a}u(c,b);d=c;c.createFromColormap=function(c){if(!c)return null;var b=5===c[0].length;c=c.sort(function(a){return a[0]-a[1]});b=b?c.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,5),label:String(c[0])})}):c.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,4).concat([255]),label:String(c[0])})});return new d({colormapInfos:b})};c.createFromColorramp=function(a){a=e.convertColorRampToColormap(a,256);return d.createFromColormap(a)};
c.prototype.clone=function(){return new d({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};c.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,c){return a[0]-c[0]})};var d;h([l.property({type:[a],json:{write:!0}})],c.prototype,"colormapInfos",void 0);h([l.enumeration.serializable()({rasterColormap:"raster-colormap"})],c.prototype,"type",void 0);
return c=d=h([l.subclass("esri.renderers.RasterColormapRenderer")],c)}(l.declared(q.JSONSupport))})},"esri/renderers/support/ColormapInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(D,v,u,h,b,q,l,a){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.value=null;a.label=null;a.color=
null;return a}u(e,b);h([a.property({type:Number,json:{write:!0}})],e.prototype,"value",void 0);h([a.property({type:String,json:{write:!0}})],e.prototype,"label",void 0);h([a.property({type:q,json:{write:!0}})],e.prototype,"color",void 0);return e=h([a.subclass("esri.renderers.support.ColormapInfo")],e)}(a.declared(l.JSONSupport))})},"esri/renderers/support/colorRampUtils":function(){define(["require","exports","../../Color","../../core/colorUtils"],function(D,v,u,h){function b(a,b){if(!a||!b||a.length!==
b.length)return!1;for(var e=0;e<a.length;e++)if(a[e]>b[e]+2||a[e]<b[e]-2)return!1;return!0}function q(a,b,g){a=h.toLAB(a);b=h.toLAB(b);return h.toRGB({l:a.l*(1-g)+g*b.l,a:a.a*(1-g)+g*b.a,b:a.b*(1-g)+g*b.b})}function l(a,e){if(a){e=e?e:v.PREDEFINED_JSON_COLOR_RAMPS;var g=null,c;"algorithmic"===a.type?e.some(function(c){if(b(a.fromColor.toRgb(),c.fromColor)&&b(a.toColor.toRgb(),c.toColor))return g=c.id,!0}):"multipart"===a.type&&e.some(function(d){if(a.colorRamps&&d.colorRamps&&a.colorRamps.length===
d.colorRamps.length&&(c=a.colorRamps,!d.colorRamps.some(function(a,d){if(!b(c[d].fromColor.toRgb(),(new u(a.fromColor)).toRgb())||!b(c[d].toColor.toRgb(),(new u(a.toColor)).toRgb()))return!0}))){if(g)return!0;g=d.id}});return g}}Object.defineProperty(v,"__esModule",{value:!0});v.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,
254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",
fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},
{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,
245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,
186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},
{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",
fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],
toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,
255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",
type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,
204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},
{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",
type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,
0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,
153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,
255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,
147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];v.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",
blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",
distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",
partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",
purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",
slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};
v.getColorRampId=l;v.getColorRampName=function(a){return(a=l(a))?v.PREDEFINED_COLOR_RAMP_NAME_MAP[a]:null};v.convertColorRampToColormap=function(a,b){if(a&&b){for(var e="multipart"===a.type?a.colorRamps.length:1,c=[],d=[],k,t,f,p,r,m=0,n=0;n<e;n++)c[n]={start:null,end:null},c[n].start=m,c[n].end=m+1/e,m=c[n].end;e=function(e){p=e/b;c.forEach(function(c,g){p>=c.start&&p<c.end&&(r=(p-c.start)/(c.end-c.start),"multipart"===a.type?(k=new u(a.colorRamps[g].fromColor),t=new u(a.colorRamps[g].toColor)):
(k=new u(a.fromColor),t=new u(a.toColor)),f=q(k,t,r),0===e?d.push([e,k.r,k.g,k.b]):e===b-1?d.push([e,t.r,t.g,t.b]):(f=q(k,t,r),d.push([e,f.r,f.g,f.b])))})};for(n=0;n<b;n++)e(n);return d}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(D,v){function u(a,d){var c=[],b,f;if(a[0].length!==d.length)throw"dimensions do not match";var e=a.length,g=a[0].length,m=0;for(b=0;b<e;b++){for(f=m=0;f<g;f++)m+=a[b][f]*d[f];c.push(m)}return c}function h(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=
a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=u(e,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function b(a){a=u(g,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function q(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-
a[2])}}function l(a){var c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function a(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var c=a.c,e=a.h;return b(l({l:a.l,a:c*Math.cos(e),b:c*Math.sin(e)}))}if("l"in a&&"a"in a&&"b"in a)return b(l(a));if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){e=(a.h+360)%360/60;c=a.v/100*
255;a=a.s/100*c;var g=a*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:a,g:g,b:0};break;case 1:e={r:g,g:a,b:0};break;case 2:e={r:0,g:a,b:g};break;case 3:e={r:0,g:g,b:a};break;case 4:e={r:g,g:0,b:a};break;case 5:case 6:e={r:a,g:0,b:g};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+c-a);e.g=Math.round(e.g+c-a);e.b=Math.round(e.b+c-a);return e}}Object.defineProperty(v,"__esModule",{value:!0});var e=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],g=[[3.2406,-1.5372,-.4986],[-.9689,
1.8758,.0415],[.0557,-.204,1.057]];v.toRGB=a;v.toHSV=function(c){if("h"in c&&"s"in c&&"v"in c)return c;var b=a(c);c=b.r;var e=b.g,b=b.b,g=Math.max(c,e,b),f=g-Math.min(c,e,b),p;0===f?p=0:g===c?p=(e-b)/f%6:g===e?p=(b-c)/f+2:g===b&&(p=(c-e)/f+4);0>p&&(p+=6);return{h:60*p,s:100*(0===f?0:f/g),v:100/255*g}};v.toLAB=function(c){return"l"in c&&"a"in c&&"b"in c?c:q(h(a(c)))};v.toLCH=function(c){if(!("l"in c&&"c"in c&&"h"in c)){var b=q(h(a(c)));c=b.l;var e=b.a,g=b.b,b=Math.sqrt(e*e+g*g),e=Math.atan2(g,e),e=
0<e?e:e+2*Math.PI;c={l:c,c:b,h:e}}return c};v.toXYZ=function(b){return"x"in b&&"y"in b&&"z"in b?b:h(a(b))};v.darken=function(a,d){a=q(h(a));a.l*=1-d;return b(l(a))}})},"esri/renderers/RasterShadedReliefRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../tasks/support/colorRamps".split(" "),function(D,v,u,h,b,q,l,a,e){return function(b){function c(a){a=
b.call(this,a)||this;a.altitude=45;a.azimuth=315;a.colorRamp=null;a.hillshadeType="multi-directional";a.pixelSizePower=.664;a.pixelSizeFactor=.024;a.scalingType="none";a.type="raster-shaded-relief";a.zFactor=1;return a}u(c,b);d=c;c.prototype.readColorRamp=function(a){return e.fromJSON(a)};c.prototype.clone=function(){return new d({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,
colorRamp:l.clone(this.colorRamp)})};var d;h([a.property({type:Number,json:{write:!0}})],c.prototype,"altitude",void 0);h([a.property({type:Number,json:{write:!0}})],c.prototype,"azimuth",void 0);h([a.property({types:e.types,json:{write:!0}})],c.prototype,"colorRamp",void 0);h([a.reader("colorRamp")],c.prototype,"readColorRamp",null);h([a.property({type:["traditional","multi-directional"],json:{write:!0}})],c.prototype,"hillshadeType",void 0);h([a.property({type:Number,json:{write:!0}})],c.prototype,
"pixelSizePower",void 0);h([a.property({type:Number,json:{write:!0}})],c.prototype,"pixelSizeFactor",void 0);h([a.property({type:["none","adjusted"],json:{write:!0}})],c.prototype,"scalingType",void 0);h([a.enumeration.serializable()({rasterShadedRelief:"raster-shaded-relief"})],c.prototype,"type",void 0);h([a.property({type:Number,json:{write:!0}})],c.prototype,"zFactor",void 0);return c=d=h([a.subclass("esri.renderers.RasterShadedReliefRenderer")],c)}(a.declared(q.JSONSupport))})},"esri/renderers/RasterStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),
function(D,v,u,h,b,q,l,a,e,g){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.colorRamp=null;a.computeGamma=!1;a.dynamicRangeAdjustment=!1;a.gamma=[];a.maxPercent=null;a.minPercent=null;a.numberOfStandardDeviations=null;a.outputMax=null;a.outputMin=null;a.sigmoidStrengthLevel=null;a.statistics=[];a.histograms=null;a.useGamma=!1;a.stretchType="none";a.type="raster-stretch";return a}u(c,b);k=c;c.prototype.readColorRamp=function(a){if(a)return g.fromJSON(a)};c.prototype.writeStatistics=
function(a,b,c){null==a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));b[c]=a};c.prototype.readStretchType=function(a,b){a=b.stretchType;"number"===typeof a&&(a=e.stretchTypeFunctionEnum[a]);return e.stretchTypeJSONDict.read(a)};c.prototype.clone=function(){return new k({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:l.clone(this.statistics),gamma:l.clone(this.gamma),
sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:l.clone(this.colorRamp),histograms:l.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var k;h([a.property({types:g.types,json:{write:!0}})],c.prototype,"colorRamp",void 0);h([a.reader("colorRamp")],c.prototype,"readColorRamp",null);h([a.property({type:Boolean,json:{write:!0}})],c.prototype,"computeGamma",
void 0);h([a.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],c.prototype,"dynamicRangeAdjustment",void 0);h([a.property({type:[Number],json:{write:{allowNull:!0}}})],c.prototype,"gamma",void 0);h([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"maxPercent",void 0);h([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"minPercent",void 0);h([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"numberOfStandardDeviations",
void 0);h([a.property({type:Number,json:{read:{source:"max"},write:{target:"max",allowNull:!0}}})],c.prototype,"outputMax",void 0);h([a.property({type:Number,json:{read:{source:"min"},write:{target:"min",allowNull:!0}}})],c.prototype,"outputMin",void 0);h([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"sigmoidStrengthLevel",void 0);h([a.property({json:{write:{allowNull:!0}}})],c.prototype,"statistics",void 0);h([a.property()],c.prototype,"histograms",void 0);h([a.writer("statistics")],
c.prototype,"writeStatistics",null);h([a.property({type:Boolean,json:{write:!0}})],c.prototype,"useGamma",void 0);h([a.property({type:e.stretchTypeJSONDict.apiValues,json:{type:e.stretchTypeJSONDict.jsonValues,write:e.stretchTypeJSONDict.write}})],c.prototype,"stretchType",void 0);h([a.reader("stretchType",["stretchType"])],c.prototype,"readStretchType",null);h([a.enumeration.serializable()({rasterStretch:"raster-stretch"})],c.prototype,"type",void 0);return c=k=h([a.subclass("esri.renderers.RasterStretchRenderer")],
c)}(a.declared(q.JSONSupport))})},"esri/renderers/support/stretchRendererUtils":function(){define(["require","exports","../../core/jsonMap"],function(D,v,u){Object.defineProperty(v,"__esModule",{value:!0});v.stretchTypeJSONDict=new u.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});v.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",
9:"sigmoid"}})},"esri/layers/support/DimensionalDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(D,v,u,h,b,q,l,a){return function(b){function e(a){a=b.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}u(e,b);c=e;e.prototype.clone=function(){return new c({variableName:this.variableName,
dimensionName:this.dimensionName,values:q.clone(this.values),isSlice:this.isSlice})};var c;h([l.property({type:String,json:{write:!0}})],e.prototype,"variableName",void 0);h([l.property({type:String,json:{write:!0}})],e.prototype,"dimensionName",void 0);h([l.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],e.prototype,"values",void 0);h([l.property({type:Boolean,json:{write:!0}})],e.prototype,"isSlice",void 0);return e=
c=h([l.subclass("esri.layers.support.DimensionalDefinition")],e)}(l.declared(b.JSONSupport))})},"esri/layers/support/ExportImageServiceParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators ./imageryRendererUtils ./MosaicRule".split(" "),function(D,v,u,h,b,q,l,a,e,g){Object.defineProperty(v,"__esModule",{value:!0});
var c=new q.default({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),d=new q.default({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"});D=function(k){function l(){var a=null!==k&&k.apply(this,arguments)||this;a.layer=null;a.adjustAspectRatio=void 0;a.bandIds=void 0;a.compression=void 0;a.compressionQuality=void 0;a.compressionTolerance=.01;a.format=null;a.interpolation=null;a.noData=null;a.noDataInterpretation=void 0;a.pixelType=
void 0;a.lercVersion=2;return a}h(l,k);l.prototype.writeAdjustAspectRatio=function(a,b,c){10.3>this.layer.version||(b[c]=a)};l.prototype.writeCompressionQuality=function(a,b,c){this.format&&-1<this.format.toLowerCase().indexOf("jpg")&&null!=a&&(b[c]=a)};l.prototype.writeCompressionTolerance=function(a,b,c){"lerc"===this.format&&null!=a&&(b[c]=a)};l.prototype.writeLercVersion=function(a,b,c){"lerc"===this.format&&10.5<=this.layer.version&&(b[c]=a)};Object.defineProperty(l.prototype,"version",{get:function(){var a=
this.layer;a.bandIds;a.format;a.compressionQuality;a.compressionTolerance;a.interpolation;a.noData;a.noDataInterpretation;a.mosaicRule;a.renderingRule;a.adjustAspectRatio;a.pixelFilter;a.renderer;a.definitionExpression;return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"mosaicRule",{get:function(){var a=this.layer,b=a.mosaicRule,a=a.definitionExpression;b?a&&a!==b.where&&(b=b.clone(),b.where=a):a&&(b=new g({where:a}));
return b},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderingRule",{get:function(){var a=this.layer,b=a.renderingRule,c=a.pixelFilter;(!a.format||-1<a.format.indexOf("jpg")||-1<a.format.indexOf("png"))&&!c&&(b=this.combineRendererWithRenderingRule());return b},enumerable:!0,configurable:!0});l.prototype.combineRendererWithRenderingRule=function(){var a=this.layer,b=a.rasterInfo,c=a.renderingRule,d=a.renderer;return d&&e.isSupportedRendererType(d)?e.combineRenderingRules(e.convertRendererToRenderingRule(d,
{rasterAttributeTable:b.attributeTable,pixelType:b.pixelType,convertColorRampToColormap:10.6>a.version}),c):c};b([a.property()],l.prototype,"layer",void 0);b([a.property({json:{write:!0}})],l.prototype,"adjustAspectRatio",void 0);b([a.writer("adjustAspectRatio")],l.prototype,"writeAdjustAspectRatio",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.bandIds")],l.prototype,"bandIds",void 0);b([a.property({json:{write:!0}})],l.prototype,"compression",void 0);b([a.property({json:{write:!0}}),a.aliasOf("layer.compressionQuality")],
l.prototype,"compressionQuality",void 0);b([a.writer("compressionQuality")],l.prototype,"writeCompressionQuality",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.compressionTolerance")],l.prototype,"compressionTolerance",void 0);b([a.writer("compressionTolerance")],l.prototype,"writeCompressionTolerance",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.format")],l.prototype,"format",void 0);b([a.property({type:String,json:{read:{reader:c.read},write:{writer:c.write}}}),a.aliasOf("layer.interpolation")],
l.prototype,"interpolation",void 0);b([a.property({json:{write:!0}}),a.aliasOf("layer.noData")],l.prototype,"noData",void 0);b([a.property({type:String,json:{read:{reader:d.read},write:{writer:d.write}}}),a.aliasOf("layer.noDataInterpretation")],l.prototype,"noDataInterpretation",void 0);b([a.property({json:{write:!0}})],l.prototype,"pixelType",void 0);b([a.property({json:{write:!0}})],l.prototype,"lercVersion",void 0);b([a.writer("lercVersion")],l.prototype,"writeLercVersion",null);b([a.property({type:Number,
dependsOn:"layer.adjustAspectRatio layer.bandIds layer.format layer.compressionQuality layer.compressionTolerance layer.definitionExpression layer.interpolation layer.noData layer.noDataInterpretation layer.mosaicRule layer.renderingRule layer.pixelFilter layer.renderer lercVersion pixelType".split(" ")})],l.prototype,"version",null);b([a.property({dependsOn:["layer.mosaicRule","layer.definitionExpression"],json:{write:!0}})],l.prototype,"mosaicRule",null);b([a.property({dependsOn:["layer.renderingRule",
"layer.renderer","layer.rasterInfo","layer.format"],json:{write:!0}})],l.prototype,"renderingRule",null);return l=b([a.subclass("esri.layers.mixins.ExportImageServiceParameters")],l)}(a.declared(l.JSONSupport));v.ExportImageServiceParameters=D})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils".split(" "),function(D,
v,u,h,b,q,l,a){function e(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?e(b.functionArguments):a}function g(a,b){var e=[],f=[],g=[],k=[],m=b.pixelType,p=(b=b.rasterAttributeTable)&&b.features,r=d(b);if(p&&Array.isArray(p)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var d=b.symbol.color,e;d.a&&p.forEach(function(f){e=f.attributes[a.field];(e>=b.minValue&&e<b.maxValue||c===a.classBreakInfos.length-1&&e>=b.minValue)&&k.push([f.attributes[r],
d.r,d.g,d.b])})}),m=m?c(k,m):k,b=new q,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=m,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var c=a.symbol&&a.symbol.color;c.a?(0===b?e.push(a.minValue,a.maxValue+1E-6):e.push(a.minValue+1E-6,a.maxValue+1E-6),f.push(b),k.push([b,c.r,c.g,c.b])):g.push(a.minValue,a.maxValue)});m=m?c(k,m):k;b=new q;b.functionName="Remap";b.functionArguments={InputRanges:e,OutputValues:f,NoDataRanges:g};b.variableName="Raster";
var l=new q;l.functionName="Colormap";l.functionArguments={Colormap:m,Raster:b};return l}function c(a,b){(b=t[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function d(a){if(a)return(a=(a=a.fields)&&h.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function k(a,b){var e=[],f=b.pixelType,g=(b=b.rasterAttributeTable)&&b.features,k=d(b),m=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var c=b.symbol.color;
c.a&&(a.field!==k&&g?g&&g.forEach(function(d){String(d.attributes[a.field])===String(b.value)&&e.push([d.attributes[k],c.r,c.g,c.b])}):isNaN(b.value)?m=!0:e.push([b.value,c.r,c.g,c.b]))});if(m)return null;f=f&&0<e.length?c(e,f):e;b=new q;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=f;b.variableName="Raster";return b}Object.defineProperty(v,"__esModule",{value:!0});var t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},f={type:"multipart",
colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};v.isSupportedRendererType=function(a){a=a.type;return"raster-stretch"===a||"unique-value"===a||"class-breaks"===a||"raster-shaded-relief"===a};v.combineRenderingRules=function(a,c){if(!a||!c)return b.clone(a||c);a=b.clone(a);"none"!==c.functionName.toLowerCase()&&(e(a.functionArguments).Raster=c);return a};v.convertRendererToRenderingRule=function(b,e){e=e||
{};switch(b.type){case "raster-stretch":var d=new q;d.functionName="Stretch";var f=p[a.stretchTypeJSONDict.toJSON(b.stretchType)],m={StretchType:f,Statistics:b.statistics,DRA:b.dynamicRangeAdjustment,UseGamma:b.useGamma,Gamma:b.gamma,ComputeGamma:b.computeGamma};null!=b.outputMin&&(m.Min=b.outputMin);null!=b.outputMax&&(m.Max=b.outputMax);f===p.standardDeviation?(m.NumberOfStandardDeviations=b.numberOfStandardDeviations,d.outputPixelType="u8"):f===p.percentClip?(m.MinPercent=b.minPercent,m.MaxPercent=
b.maxPercent,d.outputPixelType="u8"):f===p.minMax?d.outputPixelType="u8":f===p.sigmoid&&(m.SigmoidStrengthLevel=b.sigmoidStrengthLevel);d.functionArguments=m;d.variableName="Raster";if(b.colorRamp){var f=b.colorRamp,m=new q,h=l.getColorRampName(f);m.functionArguments=h?{colorRamp:h}:!e.convertColorRampToColormap||"algorithmic"!==f.type&&"multipart"!==f.type?{colorRamp:b.colorRamp.toJSON()}:{Colormap:l.convertColorRampToColormap(f,256)};m.variableName="Raster";m.functionName="Colormap";m.functionArguments.Raster=
d;b=m}else b=d;return b;case "class-breaks":return g(b,e);case "unique-value":return k(b,e);case "raster-colormap":return(b=b.extractColormap())&&0!==b.length?(b=(e=e.pixelType)?c(b,e):b,e=new q,e.functionName="Colormap",e.functionArguments={},e.functionArguments.Colormap=b,b=e):b=void 0,b;case "raster-shaded-relief":return null}};v.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,e=a.dataType,d=a.bandCount,g=a.pixelType,k=a.colormap,p=a.statistics,m=a.histograms;b&&0<b.length&&(p=
p?b.map(function(a){return p[a]}):null,m=m?b.map(function(a){return m[a]}):null);var l;if(1===d&&k&&0<k.length)l=u.RasterColormapRenderer.createFromColormap(k);else if(1===d&&c){var h=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],r=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],t=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];a=c.fields.filter(function(a){return"value"===a.name})[0];var q=c.fields.filter(function(a){return"classname"===
a.name.toLowerCase()})[0];q||(q=c.fields.filter(function(a){return"string"===a.type})[0])||(q=a);h&&r&&t&&q&&(l=u.UniqueValueRenderer.fromJSON({field1:q.name,uniqueValueInfos:c.features.map(function(a){return{value:a.attributes[q.name],label:a.attributes[q.name],symbol:{color:[a.attributes[h.name],a.attributes[r.name],a.attributes[t.name],255],type:"esriSFS",style:"esriSFSSolid"}}})}))}l||(c=void 0,l=!1,d=b=a=void 0,"u8"===g&&"processed"===e?(c="min-max",p=p||[{min:0,max:255},{min:0,max:255},{min:0,
max:255}]):"u8"===g||"elevation"===e?(c="min-max",l=p?!1:!0):"scientific"===e?(c="min-max",l=p?!1:!0,a=f):m&&0<m.length?(c="percent-clip",d=b=.25):p?c="min-max":(c="percent-clip",l=!0),l=u.RasterStretchRenderer.fromJSON({stretchType:c,dra:l,colorRamp:a,min:0,max:255,statistics:l?null:p,histograms:l?null:m,maxPercent:b,minPercent:d}));return l}};v.getDefaultBandCombination=function(a){var b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;var c,
e,d,f,g;if(a&&a.length===b){for(var k=0;k<a.length;k++)a[k].BandName&&"red"===a[k].BandName.toLowerCase()&&(e=k),a[k].BandName&&"green"===a[k].BandName.toLowerCase()&&(d=k),a[k].BandName&&"blue"===a[k].BandName.toLowerCase()&&(f=k),a[k].BandName&&"nearinfrared"===a[k].BandName.toLowerCase()&&(g=k);void 0!==e&&void 0!==d&&void 0!==f?c=[e,d,f]:void 0!==e&&void 0!==d&&void 0!==g&&(c=[g,e,d])}!c&&3<b&&(c=[0,1,2]);return c};var p={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,
sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/SetUtils ../../core/accessorSupport/decorators".split(" "),function(D,v,u,h,b,q,l,a){var e=l.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),g=l.createSetFromValues(["Rasters"]),c=function(a){return a&&a.rasterFunction?t.fromJSON(a):a},d=function(a){return a&&a instanceof t?
a.toJSON():a},k;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=1]="GROUP";a[a.ITEM=2]="ITEM"})(k||(k={}));var t=function(b){function f(a){a=b.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;a.functionDefinition=null;a.thumbnail=null;return a}u(f,b);l=f;f.prototype.readFunctionArguments=function(a,b){a=b.arguments||b.rasterFunctionArguments;if(null==a)a=null;else{b={};for(var d=0,f=Object.keys(a);d<f.length;d++){var k=
f[d];e.has(k)?b[k]=c(a[k]):g.has(k)&&Array.isArray(a[k])?b[k]=a[k].map(c):b[k]=a[k]}a=b}return a};f.prototype.writeFunctionArguments=function(a,b,c){for(var f={},k=0,p=Object.keys(a);k<p.length;k++){var l=p[k];e.has(l)?f[l]=d(a[l]):g.has(l)&&Array.isArray(a[l])?f[l]=a[l].map(d):f[l]=d(a[l])}this.functionDefinition?b.arguments=f:b[c]=f};f.prototype.readFunctionName=function(a,b){a=b.rasterFunctionInfos;var c=b.name;return c?c:a&&a.length&&"None"!==a[0].name?a[0].name:b.rasterFunction};f.prototype.writeFunctionName=
function(a,b,c){this.functionDefinition?b.name=a:b[c]=a};f.prototype.readFunctionType=function(a){return k[a]};f.prototype.writeFunctionType=function(a,b,c){b[c]=k[a]};f.prototype.clone=function(){return new l({functionName:this.functionName,functionArguments:q.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};
var l;h([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],f.prototype,"functionArguments",void 0);h([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],f.prototype,"readFunctionArguments",null);h([a.writer("functionArguments")],f.prototype,"writeFunctionArguments",null);h([a.property({json:{type:String,write:{target:"rasterFunction"}}})],f.prototype,"functionName",void 0);h([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],f.prototype,
"readFunctionName",null);h([a.writer("functionName")],f.prototype,"writeFunctionName",null);h([a.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),a.property({json:{default:"unknown"}})],f.prototype,"outputPixelType",void 0);h([a.property({type:String,json:{read:!0,write:!0}})],f.prototype,"variableName",void 0);h([a.property({type:String,json:{read:!0,write:!0,
origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"description",void 0);h([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"functionType",void 0);h([a.reader("functionType")],f.prototype,"readFunctionType",null);h([a.writer("functionType")],f.prototype,"writeFunctionType",null);h([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"functionDefinition",void 0);h([a.property({type:String,
json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"thumbnail",void 0);return f=l=h([a.subclass("esri.layers.support.RasterFunction")],f)}(a.declared(b.JSONSupport));return t})},"esri/layers/support/MosaicRule":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../geometry/Point ./DimensionalDefinition ./RasterFunction".split(" "),
function(D,v,u,h,b,q,l,a,e,g,c){var d=b.strict()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),k=b.strict()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});return function(b){function f(a){a=b.call(this,a)||this;a.ascending=!0;a.itemRenderingRule=null;a.lockRasterIds=
null;a.method=null;a.multidimensionalDefinition=null;a.objectIds=null;a.operation=null;a.sortField=null;a.sortValue=null;a.viewpoint=null;a.where=null;return a}u(f,b);p=f;f.prototype.readAscending=function(a,b){return null!=b.ascending?b.ascending:null!=b.sortAscending?b.sortAscending:!0};f.prototype.readMethod=function(a,b){a=b.mosaicMethod||b.defaultMosaicMethod;switch(a?a.toLowerCase().replace("esrimosaic",""):""){case "byattribute":case "attribute":a="esriMosaicAttribute";break;case "lockraster":a=
"esriMosaicLockRaster";break;case "center":a="esriMosaicCenter";break;case "northwest":a="esriMosaicNorthwest";break;case "nadir":a="esriMosaicNadir";break;case "viewpoint":a="esriMosaicViewpoint";break;case "seamline":a="esriMosaicSeamline";break;case "none":a="esriMosaicNone";break;default:a="esriMosaicNone"}return k.fromJSON(a)};f.prototype.readOperation=function(a,b){a=b.mosaicOperation;b=b.mosaicOperator&&b.mosaicOperator.toLowerCase();b=a||(b?d.toJSON(b):null);return d.fromJSON(b)||"first"};
f.prototype.castSortValue=function(a){return null==a||"string"===typeof a||"number"===typeof a?a:""+a};f.prototype.clone=function(){return new p({ascending:this.ascending,itemRenderingRule:l.clone(this.itemRenderingRule),lockRasterIds:l.clone(this.lockRasterIds),method:this.method,multidimensionalDefinition:l.clone(this.multidimensionalDefinition),objectIds:l.clone(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:l.clone(this.viewpoint),where:this.where})};
var p;h([a.property({type:Boolean,json:{write:!0}})],f.prototype,"ascending",void 0);h([a.reader("ascending",["ascending","sortAscending"])],f.prototype,"readAscending",null);h([a.property({type:c,json:{write:!0}})],f.prototype,"itemRenderingRule",void 0);h([a.property({type:[Number],json:{write:{overridePolicy:function(){return{enabled:"lock-raster"===this.method}}}}})],f.prototype,"lockRasterIds",void 0);h([a.property({type:String,json:{type:k.jsonValues,write:{target:"mosaicMethod",writer:k.write}}})],
f.prototype,"method",void 0);h([a.reader("method",["mosaicMethod","defaultMosaicMethod"])],f.prototype,"readMethod",null);h([a.property({type:[g],json:{write:!0}})],f.prototype,"multidimensionalDefinition",void 0);h([a.property({type:[Number],json:{read:{source:"fids"},write:{target:"fids"}}})],f.prototype,"objectIds",void 0);h([a.property({json:{type:d.jsonValues,read:{reader:d.read},write:{target:"mosaicOperation",writer:d.write}}})],f.prototype,"operation",void 0);h([a.reader("operation",["mosaicOperation",
"mosaicOperator"])],f.prototype,"readOperation",null);h([a.property({type:String,json:{write:{overridePolicy:function(){return{enabled:"attribute"===this.method}}}}})],f.prototype,"sortField",void 0);h([a.property({type:[String,Number],json:{write:{allowNull:!0,overridePolicy:function(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],f.prototype,"sortValue",void 0);h([a.cast("sortValue")],f.prototype,"castSortValue",null);h([a.property({type:e,json:{write:!0}})],f.prototype,"viewpoint",
void 0);h([a.property({type:String,json:{write:!0}})],f.prototype,"where",void 0);return f=p=h([a.subclass("esri.layers.support.MosaicRule")],f)}(a.declared(q.JSONSupport))})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(D,v,u,h,b,q,l,a,e,g){var c=
e.getLogger("esri.layers.support.PixelBlock");return function(d){function e(a){a=d.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}u(e,d);l=e;e.createEmptyBand=function(a,b){return new (l.getPixelArrayConstructor(a))(b)};e.getPixelArrayConstructor=function(a){var c;switch(a){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;case "u16":c=Uint16Array;break;case "u32":c=Uint32Array;break;
case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array;break;default:b.neverReached(a)}return c};e.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");return a};e.prototype.getPlaneCount=
function(){return this.pixels&&this.pixels.length};e.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new q("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};e.prototype.getAsRGBA=function(){var a=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};e.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};e.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,a.mask)});var b=this.mask,c=0;if(b)for(var e=
0;e<b.length;e++)b[e]&&c++;else c=this.width*this.height;this.validPixelCount=c};e.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var c=b[0];b=b[1];for(var e=this.pixels,d=this.width*this.height,f=e.length,g,k,h,t=[],y=0;y<f;y++){h=l.createEmptyBand(a,
d);g=e[y];for(var z=0;z<d;z++)k=g[z],h[z]=k>b?b:k<c?c:k;t.push(h)}this.pixels=t;this.pixelType=a}};e.prototype.clone=function(){var b=new l({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var c,e=l.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=[];var d=this.pixels[0].slice;for(c=
0;c<this.pixels.length;c++)b.pixels[c]=d?this.pixels[c].slice(0,this.pixels[c].length):new e(this.pixels[c])}if(this.statistics)for(b.statistics=[],c=0;c<this.statistics.length;c++)b.statistics[c]=a.clone(this.statistics[c]);return b};e.prototype._fillFrom8Bit=function(a){var b=this.mask,e=this.maskIsAlpha,d=this.pixels;if(a&&d&&d.length){var f,g,k;f=g=k=d[0];3<=d.length?(g=d[1],k=d[2]):2===d.length&&(g=d[1]);a=new Uint32Array(a);d=this.width*this.height;if(f.length!==d)c.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
else if(b&&b.length===d)if(e)for(e=0;e<d;e++)b[e]&&(a[e]=b[e]<<24|k[e]<<16|g[e]<<8|f[e]);else for(e=0;e<d;e++)b[e]&&(a[e]=-16777216|k[e]<<16|g[e]<<8|f[e]);else for(e=0;e<d;e++)a[e]=-16777216|k[e]<<16|g[e]<<8|f[e]}else c.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};e.prototype._fillFromNon8Bit=function(a){var b=this.pixels,e=this.mask,d=this.statistics;if(a&&b&&b.length){var f=this.pixelType,g=1,k=0,g=1;d&&0<d.length?(k=d.map(function(a){return a.minValue}).reduce(function(a,
b){return Math.min(a,b)}),g=d.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),g=255/g):(g=255,"s8"===f?(k=-128,g=127):"u16"===f?g=65535:"s16"===f?(k=-32768,g=32767):"u32"===f?g=4294967295:"s32"===f?(k=-2147483648,g=2147483647):"f32"===f?(k=-3.4*1E39,g=3.4*1E39):"f64"===f&&(k=-Number.MAX_VALUE,g=Number.MAX_VALUE),g=255/(g-k));a=new Uint32Array(a);var f=this.width*this.height,l,h,d=l=h=b[0];if(d.length!==f)return c.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=b.length)if(l=b[1],3<=b.length&&(h=b[2]),e&&e.length===f)for(b=0;b<f;b++)e[b]&&(a[b]=-16777216|(h[b]-k)*g<<16|(l[b]-k)*g<<8|(d[b]-k)*g);else for(b=0;b<f;b++)a[b]=-16777216|(h[b]-k)*g<<16|(l[b]-k)*g<<8|(d[b]-k)*g;else if(e&&e.length===f)for(b=0;b<f;b++)l=(d[b]-k)*g,e[b]&&(a[b]=-16777216|l<<16|l<<8|l);else for(b=0;b<f;b++)l=(d[b]-k)*g,a[b]=-16777216|l<<16|l<<8|l}else c.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};e.prototype._fillFrom32Bit=function(a){var b=
this.pixels,e=this.mask;if(!a||!b||!b.length)return c.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,f,g;d=f=g=b[0];3<=b.length?(f=b[1],g=b[2]):2===b.length&&(f=b[1]);var k=this.width*this.height;if(d.length!==k)return c.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(e&&e.length===k)for(b=0;b<k;b++)a[l++]=d[b],a[l++]=f[b],a[l++]=g[b],a[l++]=e[b]&1;else for(b=0;b<k;b++)a[l++]=d[b],a[l++]=f[b],a[l++]=g[b],a[l++]=
1};e.prototype._calculateBandStatistics=function(a,b){var c=Infinity,e=-Infinity,d=a.length,f,g=0;if(b)for(f=0;f<d;f++)b[f]&&(g=a[f],c=g<c?g:c,e=g>e?g:e);else for(f=0;f<d;f++)g=a[f],c=g<c?g:c,e=g>e?g:e;return{minValue:c,maxValue:e}};var l;h([g.property({json:{write:!0}})],e.prototype,"width",void 0);h([g.property({json:{write:!0}})],e.prototype,"height",void 0);h([g.property({json:{write:!0}})],e.prototype,"pixelType",void 0);h([g.cast("pixelType")],e.prototype,"castPixelType",null);h([g.property({json:{write:!0}})],
e.prototype,"validPixelCount",void 0);h([g.property({json:{write:!0}})],e.prototype,"mask",void 0);h([g.property({json:{write:!0}})],e.prototype,"maskIsAlpha",void 0);h([g.property({json:{write:!0}})],e.prototype,"pixels",void 0);h([g.property({json:{write:!0}})],e.prototype,"statistics",void 0);return e=l=h([g.subclass("esri.layers.support.PixelBlock")],e)}(g.declared(l.JSONSupport))})},"esri/layers/support/RasterInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),
function(D,v,u,h,b,q,l,a,e){return function(g){function c(a){a=g.call(this,a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.height=null;a.width=null;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.noDataValue=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;a.storageInfo=null;return a}h(c,g);Object.defineProperty(c.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;
return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});b([l.property({type:e,json:{write:!0}})],c.prototype,"attributeTable",void 0);b([l.property({json:{write:!0}})],c.prototype,"bandCount",void 0);b([l.property({json:{write:!0}})],c.prototype,"colormap",void 0);b([l.property({type:String,readOnly:!0})],c.prototype,"dataType",null);b([l.property({type:a,json:{write:!0}})],c.prototype,"extent",void 0);b([l.property({json:{write:!0}})],c.prototype,"format",void 0);b([l.property({json:{write:!0}})],
c.prototype,"height",void 0);b([l.property({json:{write:!0}})],c.prototype,"width",void 0);b([l.property({json:{write:!0}})],c.prototype,"histograms",void 0);b([l.property({json:{write:!0}})],c.prototype,"keyProperties",void 0);b([l.property({json:{write:!0}})],c.prototype,"multidimensionalInfo",void 0);b([l.property()],c.prototype,"noDataValue",void 0);b([l.property({json:{write:!0}})],c.prototype,"pixelSize",void 0);b([l.property({json:{write:!0}})],c.prototype,"pixelType",void 0);b([l.property({json:{write:!0}})],
c.prototype,"spatialReference",void 0);b([l.property({json:{write:!0}})],c.prototype,"statistics",void 0);b([l.property({json:{write:!0}})],c.prototype,"storageInfo",void 0);return c=b([l.subclass("esri.layers.support.RasterInfo")],c)}(l.declared(q.JSONSupport))})},"esri/layers/support/RasterJobHandler":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/Error ../../core/promiseUtils ../../core/workers ./PixelBlock".split(" "),
function(D,v,u,h,b,q,l,a,e){return function(){function g(){this._workerThread=null;this._destroyed=!1}g.prototype.initialize=function(){return h(this,void 0,void 0,function(){var b;return u(this,function(c){switch(c.label){case 0:return[4,a.open("RasterWorker")];case 1:return b=c.sent(),this._destroyed?b.close():this._workerThread=b,[2]}})})};g.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};g.prototype.decode=function(a,b){return h(this,
void 0,void 0,function(){var c;return u(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new q("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",a,b)];case 1:return c=d.sent(),[2,c?new e(c):null]}})})};g.prototype.symbolize=function(a,b){return h(this,void 0,void 0,function(){var c,d;return u(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new q("raster-jobhandler:no-connection","no available worker connection");
c={extent:a.extent&&a.extent.toJSON(),pixelBlock:a.pixelBlock.toJSON(),simpleStretchParams:a.simpleStretchParams};return[4,this._workerThread.invoke("symbolize",c,b)];case 1:return d=f.sent(),[2,d?new e(d):null]}})})};g.prototype.updateSymbolizer=function(a,b){return h(this,void 0,void 0,function(){var c;return u(this,function(e){switch(e.label){case 0:if(!this._workerThread)throw new q("raster-jobhandler:no-connection","no available worker connection");c=a&&a.renderer&&"raster-stretch"===a.renderer.type&&
a.renderer.histograms;return[4,l.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:a.toJSON(),histograms:c},b))];case 1:return e.sent(),[2]}})})};g.prototype.stretch=function(a,b){return h(this,void 0,void 0,function(){var c,d;return u(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new q("raster-jobhandler:no-connection","no available worker connection");if(!a||!a.pixelBlock)return[2,null];c={srcPixelBlock:a.pixelBlock.toJSON(),stretchParams:a.stretchParams};
return[4,this._workerThread.invoke("stretch",c,b)];case 1:return d=f.sent(),[2,d?new e(d):null]}})})};g.prototype.mosaicAndTransform=function(a,d){return h(this,void 0,void 0,function(){var c,g;return u(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new q("raster-jobhandler:no-connection","no available worker connection");if(!(a&&a.srcPixelBlocks&&0<a.srcPixelBlocks.length))return[2,null];c=b({},a,{srcPixelBlocks:a.srcPixelBlocks.map(function(a){return a?a.toJSON():null})});
return[4,this._workerThread.invoke("mosaicAndTransform",c,d)];case 1:return g=f.sent(),[2,g?new e(g):null]}})})};return g}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),function(D,v,u,h,b,q,l,a,e,g,c,d,k,t){function f(a,
b){if(!x)throw new q("rasterCoded:decode","lerc decoder is not supported on big endian platform");var e=b.width,d=b.height,f=b.pixelType,g=w(f),k=g.pixelTypeCtor;b=null==b.noDataValue?g.noDataValue:b.noDataValue;for(var g=0,h,n=0,m,y=a.byteLength-10;n<y;){var p=c.decode(a,{inputOffset:n,encodedMaskData:h,returnMask:0===g?!0:!1,returnEncodedMask:0===g?!0:!1,returnFileInfo:!0,pixelType:k,noDataValue:b});if(e&&d&&(p.width!==e||p.height!==d))throw new q("rasterCoded:decode","lerc decoded result has width or height different from specified in options");
n=p.fileInfo.eofOffset;0===g&&(h=p.encodedMaskData,m=new l({width:p.width,height:p.height,pixels:[],pixelType:f,mask:p.maskData,statistics:[]}));g++;m.addData({pixels:p.pixelData,statistics:{minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue}});10<y-n&&(p=String.fromCharCode.apply(null,new Uint8Array(a,n,10)),n=-1<n+p.indexOf("CntZ")?p.indexOf("CntZ"):0)}return m}function p(a,b){if(!x)throw new q("rasterCoded:decode","lerc decoder is not supported on big endian platform");var c=0,e=
0,d=0,f,k,h,n=a.byteLength-10,m=[],p=b.width;for(b=b.height;e<n;){k=g.decode(a,{inputOffset:e,maskData:f,returnFileInfo:!0});if(p&&b&&(k.width!==p||k.height!==b))throw new q("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");e=k.fileInfo.eofOffset;0===c&&(d=k.fileInfo.numValidPixel,f=k.maskData,h=new l({width:k.width,height:k.height,pixels:[],pixelType:k.fileInfo.pixelType,mask:k.maskData,statistics:[]}));k.fileInfo.mask&&0<k.fileInfo.mask.numBytes&&
m.push(k.maskData);c++;h.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue}});10<n-e&&(k=String.fromCharCode.apply(null,new Uint8Array(a,e,10)),e+=-1<k.indexOf("Lerc")?k.indexOf("Lerc"):0)}e=c=a=0;if(1<m.length){e=h.width*h.height;f=new Uint8Array(e);f.set(m[0]);for(a=1;a<m.length;a++)for(d=m[a],c=0;c<e;c++)f[c]&=d[c];for(c=d=0;c<e;c++)d+=f[c];h.mask=f}h.validPixelCount=d;return h}function r(a){a=t.decode(a);a=new l({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),
mask:a.mask,statistics:null});a.updateStatistics();return a}function m(a){a=e.decode(a);a=new l({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function n(a,b){a=new Uint8Array(a);var c=new d(a);a=b.width;var e=b.height;b=a*e;for(var c=c.decode(),f=0,g=0,g=new Uint8Array(b),f=0;f<b;f++)g[f]=c[4*f+3];e=new l({width:a,height:e,pixels:[],pixelType:"U8",mask:g,statistics:[]});for(f=0;3>f;f++){a=new Uint8Array(b);for(g=0;g<b;g++)a[g]=
c[4*g+f];e.addData({pixels:a})}e.updateStatistics();return e}function B(c,e,d){return h(this,void 0,void 0,function(){var f,g,k,h;return u(this,function(n){switch(n.label){case 0:return f=new a,g=b({applyJpegMask:!1},e),[4,f.decode(c,g,d)];case 1:return k=n.sent(),h=new l(k),h.updateStatistics(),[2,h]}})})}function A(a){if(null==a)throw new q("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpg":137===a[0]&&80===a[1]&&78===a[2]&&
71===a[3]?b="png":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?b="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?b="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="error");return b}function F(a){var b=null;switch(a){case "lerc":b=f;break;case "lerc2":b=p;break;case "jpg":b=m;break;
case "png":b=n;break;case "bsq":case "bip":b=function(b,c){var e=w(c.pixelType).pixelTypeCtor,d=k.decode;b=d(b,{width:c.width,height:c.height,pixelType:e,format:a});c=new l({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,mask:b.mask,statistics:null});c.updateStatistics();return c};break;case "tiff":b=r;break;case "error":b=function(){throw new q("rasterCodec:decode","input data contains error");};break;default:b=function(){throw new q("rasterCodec:decode","unsupported raster format");
}}return b}function w(a){var b=null,c=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":c=Math.pow(2,8)-1;b=Uint8Array;break;case "u16":c=c||Math.pow(2,16)-1;b=Uint16Array;break;case "u32":c=c||Math.pow(2,32)-1;b=Uint32Array;break;case "s8":c=c||0-Math.pow(2,7);b=Int8Array;break;case "s16":c=c||0-Math.pow(2,15);b=Int16Array;break;case "s32":c=c||0-Math.pow(2,31);b=Int32Array;break;default:b=Float32Array}return{pixelTypeCtor:b,noDataValue:c}}var x=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}();return function(){function a(){}a.getFormat=function(a){a=A(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,c,e){return h(this,void 0,void 0,function(){var d,f,g;return u(this,function(k){switch(k.label){case 0:if(null==a)throw new q("rasterCodec:decode","missing encodeddata parameter.");if(null==c||null==c.width||null==c.height)throw new q("rasterCodec:decode","requires width and height in options parameter.");
d=c.format&&c.format.toLowerCase();if("tiff"===d&&c.customOptions)return k=t.decodeTileOrStrip(a,c.customOptions),k=new l({width:k.width,height:k.height,pixels:k.pixels,pixelType:k.pixelType.toLowerCase(),mask:k.mask,statistics:null}),k.updateStatistics(),[2,k];if(!d||"bsq"!==d&&"bip"!==d)d=A(a);return!c.useCanvas||"jpg"!==d&&"png"!==d?[3,2]:[4,B(a,c,e)];case 1:return g=k.sent(),[3,3];case 2:f=F(d);c.isPoint&&(c=b({},c),c.width++,c.height++);g=f(a,c);if(c.isPoint){var h=g,n=void 0;void 0===n&&(n=
1);if(h){var m=h.pixels,p=h.width,x=h.mask;if(m&&0!==m.length){var y=m.length,w=p-1,r=h.height-1,z=[],C,E,H,G,L,u,v=l.getPixelArrayConstructor(h.pixelType);if(0===n){for(n=0;n<y;n++){G=m[n];L=new v(w*r);for(C=0;C<r;C++)for(H=C*p,E=0;E<w;E++)L[C*w+E]=G[H+E];z.push(L)}if(x)for(u=new Uint8Array(w*r),C=0;C<r;C++)for(H=C*p,E=0;E<w;E++)u[C*w+E]=x[H+E]}else{for(n=0;n<y;n++){G=m[n];L=new v(w*r);for(C=0;C<r;C++)for(H=C*p,E=0;E<w;E++)L[C*w+E]=(G[H+E]+G[H+E+1]+G[H+p+E]+G[H+p+E+1])/4;z.push(L)}if(x)for(u=new Uint8Array(w*
r),C=0;C<r;C++)for(H=C*p,E=0;E<w;E++)u[C*w+E]=Math.min.apply(null,[x[H+E],x[H+E+1],x[H+p+E],x[H+p+E+1]])}h.width=w;h.height=r;h.mask=u;h.pixels=z}}}k.label=3;case 3:return[2,g]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),function(D,v,u,h,b,q){return function(){function l(a){a&&(this.canvas=a.canvas,this.ctx=a.ctx||a.canvas&&a.canvas.getContext("2d"))}
l.getFormat=function(a){if(!a||10>a.byteLength)return"";a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(b="png");return b};l.prototype.decode=function(a,e,g){var c=this;if(!a||10>a.byteLength)throw new u("imagecanvasdecoder: decode","required a valid encoded data as input.");var d=l.getFormat(a);if(""===d)throw new u("imagecanvasdecoder: decode","encoded data format is not a supported format (jpeg or png).");var k=e.width,t=e.height,
f=e.applyJpegMask;if(f&&(!k||!t))throw new u("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return h.create(function(p,r){var m=null;"jpeg"===d&&f&&(m=l.getMask(a,e));var n=new Blob([new Uint8Array(a)],{type:"image/"+d}),B=URL.createObjectURL(n),q=new Image,F;q.src=B;q.onload=function(){URL.revokeObjectURL(B);if(h.isAborted(g))r(b.createAbortError());else{k=q.width;t=q.height;if(c.canvas){if(c.canvas.width!==k||c.canvas.height!==t)c.canvas.width=
k,c.canvas.height=t;c.ctx.clearRect(0,0,k,t)}else c.canvas=document.createElement("canvas"),c.canvas.width=k,c.canvas.height=t,c.ctx=c.canvas.getContext("2d");c.ctx.drawImage(q,0,0);var a=c.ctx.getImageData(0,0,k,t);F=a.data;var d;if(e.renderOnCanvas){if(m)for(d=0;d<m.length;d++)F[4*d+3]=m[d]?255:0;c.ctx.putImageData(a,0,0);p(null)}else{var a=k*t,f=new Uint8Array(a),l=new Uint8Array(a),n=new Uint8Array(a);if(m)for(d=0;d<a;d++)f[d]=F[4*d],l[d]=F[4*d+1],n[d]=F[4*d+2];else for(m=new Uint8Array(a),d=
0;d<a;d++)f[d]=F[4*d],l[d]=F[4*d+1],n[d]=F[4*d+2],m[d]=F[4*d+3];p({width:k,height:t,pixels:[f,l,n],mask:m,pixelType:"u8"})}}};q.onerror=function(){URL.revokeObjectURL(B);r("cannot load image")}})};l.getMask=function(a,b){var e=null;try{var c=new Uint8Array(a);a=0;var d=c.length-2;for(a=Math.ceil(c.length/2);a<d&&(255!==c[a]||217!==c[a+1]);a++);a+=2;if(a<c.length-1)for(var k=(new q(c.subarray(a))).getBytes(),e=new Uint8Array(b.width*b.height),c=b=0;c<k.length;c++)for(d=7;0<=d;d--)e[b++]=k[c]>>d&1}catch(t){}return e};
return l}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],function(){var D=function(){function v(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}v.prototype={ensureBuffer:function(u){var h=this.buffer,b=h?h.byteLength:0;if(u<b)return h;for(var q=512;q<u;)q<<=1;u=new Uint8Array(q);for(q=0;q<b;++q)u[q]=h[q];return this.buffer=u},getByte:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(u){var h=
this.pos;if(u){this.ensureBuffer(h+u);for(u=h+u;!this.eof&&this.bufferLength<u;)this.readBlock();var b=this.bufferLength;u>b&&(u=b)}else{for(;!this.eof;)this.readBlock();u=this.bufferLength}this.pos=u;return this.buffer.subarray(h,u)},lookChar:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},
makeSubStream:function(u,h,b){for(var q=u+h;this.bufferLength<=q&&!this.eof;)this.readBlock();return new Stream(this.buffer,u,h,b)},skip:function(u){u||(u=1);this.pos+=u},reset:function(){this.pos=0}};return v}();return function(){function v(a){throw Error(a);}function u(a){var b=0,c=a[b++],e=a[b++];-1!=c&&-1!=e||v("Invalid header in flate stream");8!=(c&15)&&v("Unknown compression method in flate stream");0!=((c<<8)+e)%31&&v("Bad FCHECK in flate stream");e&32&&v("FDICT bit set in flate stream");
this.bytes=a;this.bytesPos=b;this.codeBuf=this.codeSize=0;D.call(this)}if(!self||!self.Uint32Array)return null;var h=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),q=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,
590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),l=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,
590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,
524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,
589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,
589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,
590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,
524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,
589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];u.prototype=Object.create(D.prototype);u.prototype.getBits=function(a){for(var b=this.codeSize,c=this.codeBuf,
e=this.bytes,k=this.bytesPos,l;b<a;)"undefined"==typeof(l=e[k++])&&v("Bad encoding in flate stream"),c|=l<<b,b+=8;this.codeBuf=c>>a;this.codeSize=b-=a;this.bytesPos=k;return c&(1<<a)-1};u.prototype.getCode=function(a){var b=a[0],c=a[1];a=this.codeSize;for(var e=this.codeBuf,k=this.bytes,l=this.bytesPos;a<c;){var f;"undefined"==typeof(f=k[l++])&&v("Bad encoding in flate stream");e|=f<<a;a+=8}c=b[e&(1<<c)-1];b=c>>16;c&=65535;(0==a||a<b||0==b)&&v("Bad encoding in flate stream");this.codeBuf=e>>b;this.codeSize=
a-b;this.bytesPos=l;return c};u.prototype.generateHuffmanTable=function(a){for(var b=a.length,c=0,e=0;e<b;++e)a[e]>c&&(c=a[e]);for(var k=1<<c,l=new Uint32Array(k),f=1,h=0,r=2;f<=c;++f,h<<=1,r<<=1)for(var m=0;m<b;++m)if(a[m]==f){for(var n=0,B=h,e=0;e<f;++e)n=n<<1|B&1,B>>=1;for(e=n;e<k;e+=r)l[e]=f<<16|m;++h}return[l,c]};u.prototype.readBlock=function(){function e(a,b,c,e,d){for(a=a.getBits(c)+e;0<a--;)b[p++]=d}var g=this.getBits(3);g&1&&(this.eof=!0);g>>=1;if(0==g){var c=this.bytes,d=this.bytesPos,
k;"undefined"==typeof(k=c[d++])&&v("Bad block header in flate stream");var t=k;"undefined"==typeof(k=c[d++])&&v("Bad block header in flate stream");t|=k<<8;"undefined"==typeof(k=c[d++])&&v("Bad block header in flate stream");g=k;"undefined"==typeof(k=c[d++])&&v("Bad block header in flate stream");(g|k<<8)!=(~t&65535)&&v("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;k=this.bufferLength;g=this.ensureBuffer(k+t);this.bufferLength=t=k+t;for(var f=k;f<t;++f){if("undefined"==
typeof(k=c[d++])){this.eof=!0;break}g[f]=k}this.bytesPos=d}else{if(1==g)d=l,k=a;else if(2==g){g=this.getBits(5)+257;k=this.getBits(5)+1;for(var c=this.getBits(4)+4,d=Array(h.length),p=0;p<c;)d[h[p++]]=this.getBits(3);d=this.generateHuffmanTable(d);p=c=0;k=g+k;for(t=Array(k);p<k;)f=this.getCode(d),16==f?e(this,t,2,3,c):17==f?e(this,t,3,3,c=0):18==f?e(this,t,7,11,c=0):t[p++]=c=f;d=this.generateHuffmanTable(t.slice(0,g));k=this.generateHuffmanTable(t.slice(g,k))}else v("Unknown block type in flate stream");
t=(g=this.buffer)?g.length:0;for(f=this.bufferLength;;){var r=this.getCode(d);if(256>r)f+1>=t&&(g=this.ensureBuffer(f+1),t=g.length),g[f++]=r;else{if(256==r){this.bufferLength=f;break}var r=r-257,r=b[r],m=r>>16;0<m&&(m=this.getBits(m));c=(r&65535)+m;r=this.getCode(k);r=q[r];m=r>>16;0<m&&(m=this.getBits(m));r=(r&65535)+m;f+c>=t&&(g=this.ensureBuffer(f+c),t=g.length);for(m=0;m<c;++m,++f)g[f]=g[f-r]}}}};return u}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require","exports",
"./Jpg","./Zlib"],function(D,v,u,h){return function(){function b(){}b.decode=function(b){var l=new Uint8Array(b),a=new u;a.parse(l);b=a.width;var e=a.height,g=a.numComponents,c=a.eof,a=a.getData(b,e,!0),d,k=b*e,t=0,f=0,p=0;if(c<l.length-1)for(l=(new h(l.subarray(c))).getBytes(),d=new Uint8Array(k),t=c=0;t<l.length;t++)for(p=7;0<=p;p--)d[c++]=l[t]>>p&1;l=null;if(1===g)l=[a,a,a];else{l=[];for(t=0;3>t;t++)g=new Uint8Array(k),l.push(g);for(f=p=0;f<k;f++)for(t=0;3>t;t++)l[t][f]=a[p++]}return{width:b,height:e,
pixels:l,mask:d}};return b}()})},"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var D=function(){function v(u){this.message="JPEG error: "+u}v.prototype=Error();v.prototype.name="JpegError";return v.constructor=v}();return function(){function v(){this.decodeTransform=null;this.colorTransform=-1}function u(a,b){for(var e=0,c=[],d,k,l=16;0<l&&!a[l-1];)l--;c.push({children:[],index:0});var f=c[0],h;for(d=0;d<l;d++){for(k=0;k<a[d];k++){f=c.pop();for(f.children[f.index]=b[e];0<
f.index;)f=c.pop();f.index++;for(c.push(f);c.length<=d;)c.push(h={children:[],index:0}),f.children[f.index]=h.children,f=h;e++}d+1<l&&(c.push(h={children:[],index:0}),f.children[f.index]=h.children,f=h)}return c[0].children}function h(a,b,g,c,d,k,h,f,p){function e(){if(0<H)return H--,E>>H&1;E=a[b++];if(255===E){var c=a[b++];if(c)throw new D("unexpected marker "+(E<<8|c).toString(16));}H=7;return E>>>7}function m(a){for(;;){a=a[e()];if("number"===typeof a)return a;if("object"!==typeof a)throw new D("invalid huffman sequence");
}}function n(a){for(var b=0;0<a;)b=b<<1|e(),a--;return b}function t(a){if(1===a)return 1===e()?1:-1;var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function A(a,b){var c=m(a.huffmanTableDC),c=0===c?0:t(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var e=m(a.huffmanTableAC),d=e&15,e=e>>4;if(0===d){if(15>e)break;c+=16}else c+=e,a.blockData[b+l[c]]=t(d),c++}}function F(a,b){var c=m(a.huffmanTableDC),c=0===c?0:t(c)<<p;a.blockData[b]=a.pred+=c}function w(a,b){a.blockData[b]|=e()<<p}function x(a,b){if(0<G)G--;else for(var c=
k;c<=h;){var e=m(a.huffmanTableAC),d=e&15,e=e>>4;if(0===d){if(15>e){G=n(e)+(1<<e)-1;break}c+=16}else c+=e,a.blockData[b+l[c]]=t(d)*(1<<p),c++}}function y(a,b){for(var c=k,d=0,f;c<=h;){f=l[c];switch(L){case 0:d=m(a.huffmanTableAC);f=d&15;d>>=4;if(0===f)15>d?(G=n(d)+(1<<d),L=4):(d=16,L=1);else{if(1!==f)throw new D("invalid ACn encoding");u=t(f);L=d?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=e()<<p:(d--,0===d&&(L=2===L?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=e()<<p:(a.blockData[b+
f]=u<<p,L=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=e()<<p)}c++}4===L&&(G--,0===G&&(L=0))}var z=g.mcusPerLine,C=b,E=0,H=0,G=0,L=0,u,v=c.length,J,K,R,P,S;f=g.progressive?0===k?0===f?F:w:0===f?x:y:A;var T=0;g=1===v?c[0].blocksPerLine*c[0].blocksPerColumn:z*g.mcusPerColumn;for(var V,O;T<g;){var M=d?Math.min(g-T,d):g;for(K=0;K<v;K++)c[K].pred=0;G=0;if(1===v)for(J=c[0],S=0;S<M;S++)f(J,64*((J.blocksPerLine+1)*(T/J.blocksPerLine|0)+T%J.blocksPerLine)),T++;else for(S=0;S<M;S++){for(K=0;K<v;K++)for(J=
c[K],V=J.h,O=J.v,R=0;R<O;R++)for(P=0;P<V;P++)f(J,64*((J.blocksPerLine+1)*((T/z|0)*J.v+R)+(T%z*J.h+P)));T++}H=0;(J=q(a,b))&&J.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+J.invalid),b=J.offset);J=J&&J.marker;if(!J||65280>=J)throw new D("marker was not found");if(65488<=J&&65495>=J)b+=2;else break}(J=q(a,b))&&J.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+J.invalid),b=J.offset);return b-C}function b(a,b){a=b.blocksPerLine;for(var e=b.blocksPerColumn,
c=new Int16Array(64),d=0;d<e;d++)for(var k=0;k<a;k++){var l=64*((b.blocksPerLine+1)*d+k),f=c,h=b.quantizationTable,r=b.blockData,m=void 0,n=void 0,B=void 0,q=void 0,F=void 0,w=void 0,x=void 0,y=void 0,z=void 0,C=y=void 0,E=x=n=w=void 0,H=void 0,z=void 0;if(!h)throw new D("missing required Quantization Table.");for(var G=0;64>G;G+=8)z=r[l+G],y=r[l+G+1],C=r[l+G+2],w=r[l+G+3],n=r[l+G+4],x=r[l+G+5],E=r[l+G+6],H=r[l+G+7],z*=h[G],0===(y|C|w|n|x|E|H)?(z=5793*z+512>>10,f[G]=z,f[G+1]=z,f[G+2]=z,f[G+3]=z,f[G+
4]=z,f[G+5]=z,f[G+6]=z,f[G+7]=z):(y*=h[G+1],C*=h[G+2],w*=h[G+3],n*=h[G+4],x*=h[G+5],E*=h[G+6],H*=h[G+7],m=5793*z+128>>8,n=5793*n+128>>8,B=C,q=E,F=2896*(y-H)+128>>8,y=2896*(y+H)+128>>8,w<<=4,x<<=4,m=m+n+1>>1,n=m-n,z=3784*B+1567*q+128>>8,B=1567*B-3784*q+128>>8,q=z,F=F+x+1>>1,x=F-x,y=y+w+1>>1,w=y-w,m=m+q+1>>1,q=m-q,n=n+B+1>>1,B=n-B,z=2276*F+3406*y+2048>>12,F=3406*F-2276*y+2048>>12,y=z,z=799*w+4017*x+2048>>12,w=4017*w-799*x+2048>>12,x=z,f[G]=m+y,f[G+7]=m-y,f[G+1]=n+x,f[G+6]=n-x,f[G+2]=B+w,f[G+5]=B-w,
f[G+3]=q+F,f[G+4]=q-F);for(h=0;8>h;++h)z=f[h],y=f[h+8],C=f[h+16],w=f[h+24],n=f[h+32],x=f[h+40],E=f[h+48],H=f[h+56],0===(y|C|w|n|x|E|H)?(z=5793*z+8192>>14,z=-2040>z?0:2024<=z?255:z+2056>>4,r[l+h]=z,r[l+h+8]=z,r[l+h+16]=z,r[l+h+24]=z,r[l+h+32]=z,r[l+h+40]=z,r[l+h+48]=z,r[l+h+56]=z):(m=5793*z+2048>>12,n=5793*n+2048>>12,B=C,q=E,F=2896*(y-H)+2048>>12,y=2896*(y+H)+2048>>12,m=(m+n+1>>1)+4112,n=m-n,z=3784*B+1567*q+2048>>12,B=1567*B-3784*q+2048>>12,q=z,F=F+x+1>>1,x=F-x,y=y+w+1>>1,w=y-w,m=m+q+1>>1,q=m-q,n=
n+B+1>>1,B=n-B,z=2276*F+3406*y+2048>>12,F=3406*F-2276*y+2048>>12,y=z,z=799*w+4017*x+2048>>12,w=4017*w-799*x+2048>>12,x=z,z=m+y,H=m-y,y=n+x,E=n-x,C=B+w,x=B-w,w=q+F,n=q-F,z=16>z?0:4080<=z?255:z>>4,y=16>y?0:4080<=y?255:y>>4,C=16>C?0:4080<=C?255:C>>4,w=16>w?0:4080<=w?255:w>>4,n=16>n?0:4080<=n?255:n>>4,x=16>x?0:4080<=x?255:x>>4,E=16>E?0:4080<=E?255:E>>4,H=16>H?0:4080<=H?255:H>>4,r[l+h]=z,r[l+h+8]=y,r[l+h+16]=C,r[l+h+24]=w,r[l+h+32]=n,r[l+h+40]=x,r[l+h+48]=E,r[l+h+56]=H)}return b.blockData}function q(a,
b,g){var c=a.length-1;g=g<b?g:b;if(b>=c)return null;var e=a[b]<<8|a[b+1];if(65472<=e&&65534>=e)return{invalid:null,marker:e,offset:b};for(b=a[g]<<8|a[g+1];!(65472<=b&&65534>=b);){if(++g>=c)return null;b=a[g]<<8|a[g+1]}return{invalid:e.toString(16),marker:b,offset:g}}if(!self||!self.Uint8ClampedArray)return null;var l=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,
54,47,55,62,63]);v.prototype={parse:function(a){function e(){var b=a[d]<<8|a[d+1];d+=2;return b}function g(){var b=e(),b=d+b-2,c=q(a,b,d);c&&c.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+c.invalid),b=c.offset);b=a.subarray(d,b);d+=b.length;return b}function c(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),e=0;e<a.components.length;e++){C=a.components[e];var d=Math.ceil(Math.ceil(a.samplesPerLine/8)*C.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/
8)*C.v/a.maxV);C.blockData=new Int16Array(64*c*C.v*(b*C.h+1));C.blocksPerLine=d;C.blocksPerColumn=f}a.mcusPerLine=b;a.mcusPerColumn=c}var d=0,k=null,t=null,f,p,r=[],m=[],n=[],B=e();if(65496!==B)throw new D("SOI not found");for(B=e();65497!==B;){var A,F;switch(B){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:A=g();65504===B&&74===A[0]&&70===A[1]&&73===A[2]&&70===
A[3]&&0===A[4]&&(k={version:{major:A[5],minor:A[6]},densityUnits:A[7],xDensity:A[8]<<8|A[9],yDensity:A[10]<<8|A[11],thumbWidth:A[12],thumbHeight:A[13],thumbData:A.subarray(14,14+3*A[12]*A[13])});65518===B&&65===A[0]&&100===A[1]&&111===A[2]&&98===A[3]&&101===A[4]&&(t={version:A[5]<<8|A[6],flags0:A[7]<<8|A[8],flags1:A[9]<<8|A[10],transformCode:A[11]});break;case 65499:for(var B=e()+d-2,w;d<B;){var x=a[d++],y=new Uint16Array(64);if(0===x>>4)for(A=0;64>A;A++)w=l[A],y[w]=a[d++];else if(1===x>>4)for(A=
0;64>A;A++)w=l[A],y[w]=e();else throw new D("DQT - invalid table spec");r[x&15]=y}break;case 65472:case 65473:case 65474:if(f)throw new D("Only single frame JPEGs supported");e();f={};f.extended=65473===B;f.progressive=65474===B;f.precision=a[d++];f.scanLines=e();f.samplesPerLine=e();f.components=[];f.componentIds={};A=a[d++];for(B=y=x=0;B<A;B++){w=a[d];F=a[d+1]>>4;var z=a[d+1]&15;x<F&&(x=F);y<z&&(y=z);F=f.components.push({h:F,v:z,quantizationId:a[d+2],quantizationTable:null});f.componentIds[w]=F-
1;d+=3}f.maxH=x;f.maxV=y;c(f);break;case 65476:w=e();for(B=2;B<w;){x=a[d++];y=new Uint8Array(16);for(A=F=0;16>A;A++,d++)F+=y[A]=a[d];z=new Uint8Array(F);for(A=0;A<F;A++,d++)z[A]=a[d];B+=17+F;(0===x>>4?n:m)[x&15]=u(y,z)}break;case 65501:e();p=e();break;case 65498:e();w=a[d++];A=[];for(var C,B=0;B<w;B++)x=f.componentIds[a[d++]],C=f.components[x],x=a[d++],C.huffmanTableDC=n[x>>4],C.huffmanTableAC=m[x&15],A.push(C);B=a[d++];w=a[d++];x=a[d++];B=h(a,d,f,A,p,B,w,x>>4,x&15);d+=B;break;case 65535:255!==a[d]&&
d--;break;default:if(255===a[d-3]&&192<=a[d-2]&&254>=a[d-2])d-=3;else throw new D("unknown marker "+B.toString(16));}B=e()}this.width=f.samplesPerLine;this.height=f.scanLines;this.jfif=k;this.eof=d;this.adobe=t;this.components=[];for(B=0;B<f.components.length;B++){C=f.components[B];if(k=r[C.quantizationId])C.quantizationTable=k;this.components.push({output:b(f,C),scaleX:C.h/f.maxH,scaleY:C.v/f.maxV,blocksPerLine:C.blocksPerLine,blocksPerColumn:C.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,b){var e=this.width/a,c=this.height/b,d,k,l,f,h,r,m=0,n,B=this.components.length,q=a*b*B,F=new Uint8ClampedArray(q),w=new Uint32Array(a);for(r=0;r<B;r++){d=this.components[r];k=d.scaleX*e;l=d.scaleY*c;m=r;n=d.output;f=d.blocksPerLine+1<<3;for(h=0;h<a;h++)d=0|h*k,w[h]=(d&4294967288)<<3|d&7;for(k=0;k<b;k++)for(d=0|k*l,d=f*(d&4294967288)|(d&7)<<3,h=0;h<a;h++)F[m]=n[d+w[h]],m+=B}if(b=this.decodeTransform)for(r=0;r<q;)for(a=d=0;d<B;d++,r++,a+=2)F[r]=(F[r]*b[a]>>8)+b[a+
1];return F},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,g,c,d=0,k=a.length;d<k;d+=3)b=a[d],g=a[d+1],c=a[d+2],a[d]=b-179.456+1.402*c,a[d+1]=b+135.459-.344*g-.714*c,a[d+2]=b-226.816+1.772*g;return a},_convertYcckToRgb:function(a){for(var b,g,c,d,k=0,l=0,f=a.length;l<f;l+=4)b=a[l],g=a[l+1],c=a[l+2],d=a[l+3],a[k++]=-122.67195406894+g*(-6.60635669420364E-5*
g+4.37130475926232E-4*c-5.4080610064599E-5*b+4.8449797120281E-4*d-.154362151871126)+c*(-9.57964378445773E-4*c+8.17076911346625E-4*b-.00477271405408747*d+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*d+.48357088451265)+d*(-3.36197177618394E-4*d+.484791561490776),a[k++]=107.268039397724+g*(2.19927104525741E-5*g-6.40992018297945E-4*c+6.59397001245577E-4*b+4.26105652938837E-4*d-.176491792462875)+c*(-7.78269941513683E-4*c+.00130872261408275*b+7.70482631801132E-4*d-.151051492775562)+b*(.00126935368114843*
b-.00265090189010898*d+.25802910206845)+d*(-3.18913117588328E-4*d-.213742400323665),a[k++]=-20.810012546947+g*(-5.70115196973677E-4*g-2.63409051004589E-5*c+.0020741088115012*b-.00288260236853442*d+.814272968359295)+c*(-1.53496057440975E-5*c-1.32689043961446E-4*b+5.60833691242812E-4*d-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*d+.116935020465145)+d*(-3.43531996510555E-4*d+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,g,c,d=0,k=a.length;d<k;d+=4)b=a[d],g=a[d+
1],c=a[d+2],a[d]=434.456-b-1.402*c,a[d+1]=119.541-b+.344*g+.714*c,a[d+2]=481.816-b-1.772*g;return a},_convertCmykToRgb:function(a){for(var b,g,c,d,k=0,l=1/255,f=0,h=a.length;f<h;f+=4)b=a[f]*l,g=a[f+1]*l,c=a[f+2]*l,d=a[f+3]*l,a[k++]=255+b*(-4.387332384609988*b+54.48615194189176*g+18.82290502165302*c+212.25662451639585*d-285.2331026137004)+g*(1.7149763477362134*g-5.6096736904047315*c-17.873870861415444*d-5.497006427196366)+c*(-2.5217340131683033*c-21.248923337353073*d+17.5119270841813)-d*(21.86122147463605*
d+189.48180835922747),a[k++]=255+b*(8.841041422036149*b+60.118027045597366*g+6.871425592049007*c+31.159100130055922*d-79.2970844816548)+g*(-15.310361306967817*g+17.575251261109482*c+131.35250912493976*d-190.9453302588951)+c*(4.444339102852739*c+9.8632861493405*d-24.86741582555878)-d*(20.737325471181034*d+187.80453709719578),a[k++]=255+b*(.8842522430003296*b+8.078677503112928*g+30.89978309703729*c-.23883238689178934*d-14.183576799673286)+g*(10.49593273432072*g+63.02378494754052*c+50.606957656360734*
d-112.23884253719248)+c*(.03296041114873217*c+115.60384449646641*d-193.58209356861505)-d*(22.33816807309886*d+180.12613974708367);return a},getData:function(a,b,g){if(4<this.numComponents)throw new D("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&g){g=a.length;b=new Uint8ClampedArray(3*g);for(var c=0,e=0;e<g;e++){var k=a[e];b[c++]=k;b[c++]=k;b[c++]=k}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return g?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(g)return this._convertCmykToRgb(a)}return a}};return v}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var D={unstuff:function(h,b,q,l,a,e,g,c){var d=(1<<q)-1,k=0,t,f=0,p,r;h[h.length-1]<<=8*(4*h.length-Math.ceil(q*l/8));if(a)for(t=0;t<l;t++)0===f&&(r=h[k++],f=32),f>=q?(p=r>>>f-q&d,f-=q):(f=q-f,p=(r&d)<<f&d,r=h[k++],f=32-f,p+=r>>>f),b[t]=a[p];
else for(a=Math.ceil((c-e)/g),t=0;t<l;t++)0===f&&(r=h[k++],f=32),f>=q?(p=r>>>f-q&d,f-=q):(f=q-f,p=(r&d)<<f&d,r=h[k++],f=32-f,p+=r>>>f),b[t]=p<a?e+p*g:c},unstuffLUT:function(h,b,q,l,a,e){var g=(1<<b)-1,c=0,d=0,k=0,t=k=0,f,p=[];h[h.length-1]<<=8*(4*h.length-Math.ceil(b*q/8));for(var r=Math.ceil((e-l)/a),d=0;d<q;d++)0===k&&(f=h[c++],k=32),k>=b?(t=f>>>k-b&g,k-=b):(k=b-k,t=(f&g)<<k&g,f=h[c++],k=32-k,t+=f>>>k),p[d]=t<r?l+t*a:e;p.unshift(l);return p},unstuff2:function(h,b,q,l,a,e,g,c){var d=(1<<q)-1,k=0,
t,f=0,p=0,r,m,n;if(a)for(t=0;t<l;t++)0===f&&(m=h[k++],f=32,p=0),f>=q?(r=m>>>p&d,f-=q,p+=q):(n=q-f,r=m>>>p&d,m=h[k++],f=32-n,r|=(m&(1<<n)-1)<<q-n,p=n),b[t]=a[r];else for(a=Math.ceil((c-e)/g),t=0;t<l;t++)0===f&&(m=h[k++],f=32,p=0),f>=q?(r=m>>>p&d,f-=q,p+=q):(n=q-f,r=m>>>p&d,m=h[k++],f=32-n,r|=(m&(1<<n)-1)<<q-n,p=n),b[t]=r<a?e+r*g:c;return b},unstuffLUT2:function(h,b,q,l,a,e){for(var g=(1<<b)-1,c=0,d=0,k=0,t=0,f=0,p=0,r,m=[],n=Math.ceil((e-l)/a),d=0;d<q;d++)0===t&&(r=h[c++],t=32,p=0),t>=b?(f=r>>>p&g,
t-=b,p+=b):(k=b-t,f=r>>>p&g,r=h[c++],t=32-k,f|=(r&(1<<k)-1)<<b-k,p=k),m[d]=f<n?l+f*a:e;m.unshift(l);return m},originalUnstuff:function(h,b,q,l){var a=(1<<q)-1,e=0,g,c=0,d,k;h[h.length-1]<<=8*(4*h.length-Math.ceil(q*l/8));for(g=0;g<l;g++)0===c&&(k=h[e++],c=32),c>=q?(d=k>>>c-q&a,c-=q):(c=q-c,d=(k&a)<<c&a,k=h[e++],c=32-c,d+=k>>>c),b[g]=d;return b},originalUnstuff2:function(h,b,q,l){var a=(1<<q)-1,e=0,g,c=0,d=0,k,t,f;for(g=0;g<l;g++)0===c&&(t=h[e++],c=32,d=0),c>=q?(k=t>>>d&a,c-=q,d+=q):(f=q-c,k=t>>>d&
a,t=h[e++],c=32-f,k|=(t&(1<<f)-1)<<q-f,d=f),b[g]=k;return b}},v={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(h){for(var b=65535,q=65535,l=h.length,a=Math.floor(l/2),e=0;a;){var g=359<=a?359:a,a=a-g;do b+=h[e++]<<8,q+=b+=h[e++];while(--g);b=(b&65535)+(b>>>16);q=(q&65535)+(q>>>16)}l&1&&(q+=b+=h[e]<<8);return((q&65535)+(q>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(h,b){var q=b.ptr,l=new Uint8Array(h,q,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,l);if(0!==
a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var q=q+6,l=new DataView(h,q,8),e=l.getInt32(0,!0);a.fileVersion=e;q+=4;3<=e&&(a.checksum=l.getUint32(4,!0),q+=4);l=new DataView(h,q,12);a.height=l.getUint32(0,!0);a.width=l.getUint32(4,!0);q+=8;4<=e?(a.numDims=l.getUint32(8,!0),q+=4):a.numDims=1;l=new DataView(h,q,40);a.numValidPixel=l.getUint32(0,!0);a.microBlockSize=l.getInt32(4,!0);a.blobSize=l.getInt32(8,!0);a.imageType=
l.getInt32(12,!0);a.maxZError=l.getFloat64(16,!0);a.zMin=l.getFloat64(24,!0);a.zMax=l.getFloat64(32,!0);q+=40;b.headerInfo=a;b.ptr=q;if(3<=e&&(h=this.computeChecksumFletcher32(new Uint8Array(h,q-(4<=e?52:48),a.blobSize-14)),h!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(h,b){var q=b.headerInfo,l=this.getDataTypeArray(q.imageType),a=q.numDims*this.getDataTypeSize(q.imageType),e=this.readSubArray(h,b.ptr,l,a);h=this.readSubArray(h,b.ptr+a,l,a);b.ptr+=2*a;a=!0;for(b=0;b<
q.numDims;b++)if(e[b]!==h[b]){a=!1;break}q.minValues=e;q.maxValues=h;return a},readSubArray:function(h,b,q,l){if(q===Uint8Array)h=new Uint8Array(h,b,l);else{var a=new ArrayBuffer(l);(new Uint8Array(a)).set(new Uint8Array(h,b,l));h=new q(a)}return h},readMask:function(h,b){var q=b.ptr,l=b.headerInfo,a=l.width*l.height,e=l.numValidPixel,g=new DataView(h,q,4),l={};l.numBytes=g.getUint32(0,!0);q+=4;if((0===e||a===e)&&0!==l.numBytes)throw"invalid mask";if(0===e)e=new Uint8Array(Math.ceil(a/8)),l.bitset=
e,g=new Uint8Array(a),b.pixels.resultMask=g,q+=l.numBytes;else if(0<l.numBytes){e=new Uint8Array(Math.ceil(a/8));g=new DataView(h,q,l.numBytes);h=g.getInt16(0,!0);var c=2,d=0,k=0;do{if(0<h)for(;h--;)e[d++]=g.getUint8(c++);else for(k=g.getUint8(c++),h=-h;h--;)e[d++]=k;h=g.getInt16(c,!0);c+=2}while(c<l.numBytes);if(-32768!==h||d<e.length)throw"Unexpected end of mask RLE encoding";g=new Uint8Array(a);for(c=c=h=0;c<a;c++)c&7?(h=e[c>>3],h<<=c&7):h=e[c>>3],h&128&&(g[c]=1);b.pixels.resultMask=g;l.bitset=
e;q+=l.numBytes}b.ptr=q;b.mask=l;return!0},readDataOneSweep:function(h,b,q){var l=b.ptr,a=b.headerInfo,e=a.numDims,g=a.width*a.height,a=a.numValidPixel*v.getDataTypeSize(a.imageType)*e,c=b.pixels.resultMask;if(q===Uint8Array)h=new Uint8Array(h,l,a);else{var d=new ArrayBuffer(a);(new Uint8Array(d)).set(new Uint8Array(h,l,a));h=new q(d)}if(h.length===g*e)b.pixels.resultPixels=h;else{b.pixels.resultPixels=new q(g*e);var k=d=q=0,t=0;if(1<e)for(k=0;k<e;k++)for(t=k*g,d=0;d<g;d++)c[d]&&(b.pixels.resultPixels[t+
d]=h[q++]);else for(d=0;d<g;d++)c[d]&&(b.pixels.resultPixels[d]=h[q++])}b.ptr=l+a;return!0},readHuffmanTree:function(h,b){var q=this.HUFFMAN_LUT_BITS_MAX,l=new DataView(h,b.ptr,16);b.ptr+=16;if(2>l.getInt32(0,!0))throw"unsupported Huffman version";var a=l.getInt32(4,!0),e=l.getInt32(8,!0),l=l.getInt32(12,!0);if(e>=l)return!1;var g=new Uint32Array(l-e);v.decodeBits(h,b,g);var c=[],d,k,t;for(d=e;d<l;d++)k=d-(d<a?0:a),c[k]={first:g[d-e],second:null};d=h.byteLength-b.ptr;g=new ArrayBuffer(4*Math.ceil(d/
4));(new Uint8Array(g)).set(new Uint8Array(h,b.ptr,d));h=new Uint32Array(g);b=0;var f,g=0;f=h[0];for(d=e;d<l;d++)k=d-(d<a?0:a),t=c[k].first,0<t&&(c[k].second=f<<b>>>32-t,32-b>=t?(b+=t,32===b&&(b=0,g++,f=h[g])):(b+=t-32,g++,f=h[g],c[k].second|=f>>>32-b));var p=f=0,r=new u;for(d=0;d<c.length;d++)void 0!==c[d]&&(f=Math.max(f,c[d].first));var p=f>=q?q:f,q=[],m,n;for(d=e;d<l;d++)if(k=d-(d<a?0:a),t=c[k].first,0<t)if(e=[t,k],t<=p)for(k=c[k].second<<p-t,m=1<<p-t,t=0;t<m;t++)q[k|t]=e;else for(k=c[k].second,
m=r,--t;0<=t;t--)(n=k>>>t&1)?(m.right||(m.right=new u),m=m.right):(m.left||(m.left=new u),m=m.left),0!==t||m.val||(m.val=e[1]);return{decodeLut:q,numBitsLUTQick:p,numBitsLUT:f,tree:r,stuffedData:h,srcPtr:g,bitPos:b}},readHuffman:function(h,b,q){var l=b.headerInfo,a=l.numDims,e=b.headerInfo.height,g=b.headerInfo.width,c=g*e,d=this.readHuffmanTree(h,b);h=d.decodeLut;var k=d.tree,t=d.stuffedData,f=d.srcPtr,p=d.bitPos,r=d.numBitsLUTQick,d=d.numBitsLUT,m=0===b.headerInfo.imageType?128:0,n,B,A=b.pixels.resultMask,
F,w,x,y,z,C,E=0;0<p&&(f++,p=0);var H=t[f],G=1===b.encodeMode,L=new q(c*a),u=L,v;for(v=0;v<l.numDims;v++){1<a&&(u=new q(L.buffer,c*v,c),E=0);if(b.headerInfo.numValidPixel===g*e)for(x=z=0;x<e;x++)for(y=0;y<g;y++,z++){B=0;n=F=H<<p>>>32-r;32-p<r&&(n=F|=t[f+1]>>>64-p-r);if(h[n])B=h[n][1],p+=h[n][0];else for(n=F=H<<p>>>32-d,32-p<d&&(n=F|=t[f+1]>>>64-p-d),n=k,C=0;C<d;C++)if(n=(w=F>>>d-C-1&1)?n.right:n.left,!n.left&&!n.right){B=n.val;p=p+C+1;break}32<=p&&(p-=32,f++,H=t[f]);B-=m;G?(B=0<y?B+E:0<x?B+u[z-g]:
B+E,B&=255,E=u[z]=B):u[z]=B}else for(x=z=0;x<e;x++)for(y=0;y<g;y++,z++)if(A[z]){B=0;n=F=H<<p>>>32-r;32-p<r&&(n=F|=t[f+1]>>>64-p-r);if(h[n])B=h[n][1],p+=h[n][0];else for(n=F=H<<p>>>32-d,32-p<d&&(n=F|=t[f+1]>>>64-p-d),n=k,C=0;C<d;C++)if(n=(w=F>>>d-C-1&1)?n.right:n.left,!n.left&&!n.right){B=n.val;p=p+C+1;break}32<=p&&(p-=32,f++,H=t[f]);B-=m;G?(B=0<y&&A[z-1]?B+E:0<x&&A[z-g]?B+u[z-g]:B+E,B&=255,E=u[z]=B):u[z]=B}b.ptr=b.ptr+4*(f+1)+(0<p?4:0)}b.pixels.resultPixels=L},decodeBits:function(h,b,q,l,a){var e=
b.headerInfo,g=e.fileVersion,c=0,d=new DataView(h,b.ptr,5<=h.byteLength-b.ptr?5:h.byteLength-b.ptr),k=d.getUint8(0);c++;var t=k>>6,f=0===t?4:3-t,p=0<(k&32)?!0:!1,t=k&31,k=0;if(1===f)k=d.getUint8(c),c++;else if(2===f)k=d.getUint16(c,!0),c+=2;else if(4===f)k=d.getUint32(c,!0),c+=4;else throw"Invalid valid pixel count type";var f=2*e.maxZError,r,m;a=1<e.numDims?e.maxValues[a]:e.zMax;if(p){b.counter.lut++;p=d.getUint8(c);c++;e=Math.ceil((p-1)*t/8);r=Math.ceil(e/4);r=new ArrayBuffer(4*r);m=new Uint8Array(r);
b.ptr+=c;m.set(new Uint8Array(h,b.ptr,e));c=new Uint32Array(r);b.ptr+=e;for(d=0;p-1>>>d;)d++;e=Math.ceil(k*d/8);r=Math.ceil(e/4);r=new ArrayBuffer(4*r);m=new Uint8Array(r);m.set(new Uint8Array(h,b.ptr,e));h=new Uint32Array(r);b.ptr+=e;b=3<=g?D.unstuffLUT2(c,t,p-1,l,f,a):D.unstuffLUT(c,t,p-1,l,f,a);3<=g?D.unstuff2(h,q,d,k,b):D.unstuff(h,q,d,k,b)}else b.counter.bitstuffer++,d=t,b.ptr+=c,0<d&&(e=Math.ceil(k*d/8),r=Math.ceil(e/4),r=new ArrayBuffer(4*r),m=new Uint8Array(r),m.set(new Uint8Array(h,b.ptr,
e)),h=new Uint32Array(r),b.ptr+=e,3<=g?null==l?D.originalUnstuff2(h,q,d,k):D.unstuff2(h,q,d,k,!1,l,f,a):null==l?D.originalUnstuff(h,q,d,k):D.unstuff(h,q,d,k,!1,l,f,a))},readTiles:function(h,b,q){var l=b.headerInfo,a=l.width,e=l.height,g=l.microBlockSize,c=l.imageType,d=v.getDataTypeSize(c),k=Math.ceil(a/g),t=Math.ceil(e/g);b.pixels.numBlocksY=t;b.pixels.numBlocksX=k;for(var f=b.pixels.ptr=0,p=0,r=0,m=0,n=0,B=0,A=0,u=0,w=0,x=0,y=0,z=0,C=0,A=C=A=0,E,H=new q(g*g),G=e%g||g,L=a%g||g,I=l.numDims,Q,J=b.pixels.resultMask,
K=b.pixels.resultPixels,R=5<=l.fileVersion?14:15,D=l.zMax,r=0;r<t;r++)for(n=r!==t-1?g:G,m=0;m<k;m++)for(B=m!==k-1?g:L,y=r*a*g+m*g,z=a-B,Q=0;Q<I;Q++){1<I?(C=K,y=r*a*g+m*g,K=new q(b.pixels.resultPixels.buffer,a*e*Q*d,a*e),D=l.maxValues[Q]):C=null;A=h.byteLength-b.ptr;f=new DataView(h,b.ptr,Math.min(10,A));p={};A=0;u=f.getUint8(0);A++;E=5<=l.fileVersion?u&4:0;w=u>>6&255;x=u>>2&R;if(x!==(m*g>>3&R))throw"integrity issue";if(E&&0===Q)throw"integrity issue";u&=3;if(3<u)throw b.ptr+=A,"Invalid block encoding ("+
u+")";if(2===u){if(E)if(J)for(f=0;f<n;f++)for(p=0;p<B;p++)J[y]&&(K[y]=C[y]),y++;else for(f=0;f<n;f++)for(p=0;p<B;p++)K[y]=C[y],y++;b.counter.constant++;b.ptr+=A}else if(0===u){if(E)throw"integrity issue";b.counter.uncompressed++;b.ptr+=A;C=n*B*d;A=h.byteLength-b.ptr;C=C<A?C:A;A=new ArrayBuffer(0===C%d?C:C+d-C%d);E=new Uint8Array(A);E.set(new Uint8Array(h,b.ptr,C));A=new q(A);C=0;if(J)for(f=0;f<n;f++){for(p=0;p<B;p++)J[y]&&(K[y]=A[C++]),y++;y+=z}else for(f=0;f<n;f++){for(p=0;p<B;p++)K[y++]=A[C++];
y+=z}b.ptr+=C*d}else if(w=v.getDataTypeUsed(E&&6>c?4:c,w),x=v.getOnePixel(p,A,w,f),A+=v.getDataTypeSize(w),3===u)if(b.ptr+=A,b.counter.constantoffset++,J)for(f=0;f<n;f++){for(p=0;p<B;p++)J[y]&&(K[y]=E?Math.min(D,C[y]+x):x),y++;y+=z}else for(f=0;f<n;f++){for(p=0;p<B;p++)K[y]=E?Math.min(D,C[y]+x):x,y++;y+=z}else if(b.ptr+=A,v.decodeBits(h,b,H,x,Q),A=0,E)if(J)for(f=0;f<n;f++){for(p=0;p<B;p++)J[y]&&(K[y]=H[A++]+C[y]),y++;y+=z}else for(f=0;f<n;f++){for(p=0;p<B;p++)K[y]=H[A++]+C[y],y++;y+=z}else if(J)for(f=
0;f<n;f++){for(p=0;p<B;p++)J[y]&&(K[y]=H[A++]),y++;y+=z}else for(f=0;f<n;f++){for(p=0;p<B;p++)K[y++]=H[A++];y+=z}}},formatFileInfo:function(h){return{fileIdentifierString:h.headerInfo.fileIdentifierString,fileVersion:h.headerInfo.fileVersion,imageType:h.headerInfo.imageType,height:h.headerInfo.height,width:h.headerInfo.width,numValidPixel:h.headerInfo.numValidPixel,microBlockSize:h.headerInfo.microBlockSize,blobSize:h.headerInfo.blobSize,maxZError:h.headerInfo.maxZError,pixelType:v.getPixelType(h.headerInfo.imageType),
eofOffset:h.eofOffset,mask:h.mask?{numBytes:h.mask.numBytes}:null,pixels:{numBlocksX:h.pixels.numBlocksX,numBlocksY:h.pixels.numBlocksY,maxValue:h.headerInfo.zMax,minValue:h.headerInfo.zMin,noDataValue:h.noDataValue}}},constructConstantSurface:function(h){var b=h.headerInfo.zMax,q=h.headerInfo.numDims,l=h.headerInfo.height*h.headerInfo.width,a=0,e=0,g=0,c=h.pixels.resultMask,d=h.pixels.resultPixels;if(c)if(1<q)for(a=0;a<q;a++)for(g=a*l,b=h.headerInfo.maxValues[a],e=0;e<l;e++)c[e]&&(d[g+e]=b);else for(e=
0;e<l;e++)c[e]&&(d[e]=b);else if(1<q)for(a=0;a<q;a++)for(g=a*l,b=h.headerInfo.maxValues[a],e=0;e<l;e++)d[g+e]=b;else for(e=0;e<l;e++)d[e]=b},getDataTypeArray:function(h){switch(h){case 0:h=Int8Array;break;case 1:h=Uint8Array;break;case 2:h=Int16Array;break;case 3:h=Uint16Array;break;case 4:h=Int32Array;break;case 5:h=Uint32Array;break;case 6:h=Float32Array;break;case 7:h=Float64Array;break;default:h=Float32Array}return h},getPixelType:function(h){switch(h){case 0:h="S8";break;case 1:h="U8";break;
case 2:h="S16";break;case 3:h="U16";break;case 4:h="S32";break;case 5:h="U32";break;case 6:h="F32";break;case 7:h="F64";break;default:h="F32"}return h},isValidPixelValue:function(h,b){if(null==b)return!1;switch(h){case 0:h=-128<=b&&127>=b;break;case 1:h=0<=b&&255>=b;break;case 2:h=-32768<=b&&32767>=b;break;case 3:h=0<=b&&65536>=b;break;case 4:h=-2147483648<=b&&2147483647>=b;break;case 5:h=0<=b&&4294967296>=b;break;case 6:h=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:h=4.9E-324<=
b&&1.7976931348623157E308>=b;break;default:h=!1}return h},getDataTypeSize:function(h){var b=0;switch(h){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=h}return b},getDataTypeUsed:function(h,b){var q=h;switch(h){case 2:case 4:q=h-b;break;case 3:case 5:q=h-2*b;break;case 6:q=0===b?h:1===b?2:1;break;case 7:q=0===b?h:h-2*b+1;break;default:q=h}return q},getOnePixel:function(h,b,q,l){h=0;switch(q){case 0:h=l.getInt8(b);break;case 1:h=l.getUint8(b);
break;case 2:h=l.getInt16(b,!0);break;case 3:h=l.getUint16(b,!0);break;case 4:h=l.getInt32(b,!0);break;case 5:h=l.getUInt32(b,!0);break;case 6:h=l.getFloat32(b,!0);break;case 7:h=l.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return h}},u=function(h,b,q){this.val=h;this.left=b;this.right=q};return{decode:function(h,b){b=b||{};var q=b.noDataValue,l=0,a={};a.ptr=b.inputOffset||0;a.pixels={};if(v.readHeaderInfo(h,a)){var l=a.headerInfo,e=l.fileVersion,g=v.getDataTypeArray(l.imageType);
if(5<e)throw"unsupported lerc version 2."+e;v.readMask(h,a);l.numValidPixel===l.width*l.height||a.pixels.resultMask||(a.pixels.resultMask=b.maskData);var c=l.width*l.height;a.pixels.resultPixels=new g(c*l.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==l.numValidPixel)if(l.zMax===l.zMin)v.constructConstantSurface(a);else if(4<=e&&v.checkMinMaxRanges(h,a))v.constructConstantSurface(a);else{var d=new DataView(h,a.ptr,2),k=d.getUint8(0);a.ptr++;if(k)v.readDataOneSweep(h,
a,g);else if(1<e&&1>=l.imageType&&1E-5>Math.abs(l.maxZError-.5)){d=d.getUint8(1);a.ptr++;a.encodeMode=d;if(2<d||4>e&&1<d)throw"Invalid Huffman flag "+d;d?v.readHuffman(h,a,g):v.readTiles(h,a,g)}else v.readTiles(h,a,g)}a.eofOffset=a.ptr;b.inputOffset?(h=a.headerInfo.blobSize+b.inputOffset-a.ptr,1<=Math.abs(h)&&(a.eofOffset=b.inputOffset+a.headerInfo.blobSize)):(h=a.headerInfo.blobSize-a.ptr,1<=Math.abs(h)&&(a.eofOffset=a.headerInfo.blobSize));h={width:l.width,height:l.height,pixelData:a.pixels.resultPixels,
minValue:l.zMin,maxValue:l.zMax,validPixelCount:l.numValidPixel,dimCount:l.numDims,dimStats:{minValues:l.minValues,maxValues:l.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&v.isValidPixelValue(l.imageType,q)){e=a.pixels.resultMask;for(l=0;l<c;l++)e[l]||(h.pixelData[l]=q);h.noDataValue=q}a.noDataValue=q;b.returnFileInfo&&(h.fileInfo=v.formatFileInfo(a));return h}},getBandCount:function(h){for(var b=0,q=0,l={ptr:0,pixels:{}};q<h.byteLength-58;)v.readHeaderInfo(h,l),q+=l.headerInfo.blobSize,
b++,l.ptr=q;return b}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(D){var v={};v.defaultNoDataValue=D.clampFloat32(-Infinity);v.decode=function(h,b){var q;b=b||{};var l=b.inputOffset||0,a=b.encodedMaskData||null===b.encodedMaskData,e={},g=new Uint8Array(h,l,10);e.fileIdentifierString=String.fromCharCode.apply(null,g);if("CntZImage"!=e.fileIdentifierString.trim())throw"Unexpected file identifier string: "+e.fileIdentifierString;l+=10;g=new DataView(h,
l,24);e.fileVersion=g.getInt32(0,!0);e.imageType=g.getInt32(4,!0);e.height=g.getUint32(8,!0);e.width=g.getUint32(12,!0);e.maxZError=g.getFloat64(16,!0);l+=24;if(!a)if(g=new DataView(h,l,16),e.mask={},e.mask.numBlocksY=g.getUint32(0,!0),e.mask.numBlocksX=g.getUint32(4,!0),e.mask.numBytes=g.getUint32(8,!0),e.mask.maxValue=g.getFloat32(12,!0),l+=16,0<e.mask.numBytes){var a=new Uint8Array(Math.ceil(e.width*e.height/8)),g=new DataView(h,l,e.mask.numBytes),c=g.getInt16(0,!0),d=2,k=0;do{if(0<c)for(;c--;)a[k++]=
g.getUint8(d++);else for(var t=g.getUint8(d++),c=-c;c--;)a[k++]=t;c=g.getInt16(d,!0);d+=2}while(d<e.mask.numBytes);if(-32768!==c||k<a.length)throw"Unexpected end of mask RLE encoding";e.mask.bitset=a;l+=e.mask.numBytes}else 0===(e.mask.numBytes|e.mask.numBlocksY|e.mask.maxValue)&&(a=new Uint8Array(Math.ceil(e.width*e.height/8)),e.mask.bitset=a);g=new DataView(h,l,16);e.pixels={};e.pixels.numBlocksY=g.getUint32(0,!0);e.pixels.numBlocksX=g.getUint32(4,!0);e.pixels.numBytes=g.getUint32(8,!0);e.pixels.maxValue=
g.getFloat32(12,!0);l+=16;a=e.pixels.numBlocksX;g=e.pixels.numBlocksY;a+=0<e.width%a?1:0;c=g+(0<e.height%g?1:0);e.pixels.blocks=Array(a*c);d=1E9;for(t=k=0;t<c;t++)for(var f=0;f<a;f++){var p=0,g=new DataView(h,l,Math.min(10,h.byteLength-l)),r={};e.pixels.blocks[k++]=r;var m=g.getUint8(0);p++;r.encoding=m&63;if(3<r.encoding)throw"Invalid block encoding ("+r.encoding+")";if(2===r.encoding)l++,d=Math.min(d,0);else{if(0!==m&&2!==m){m>>=6;r.offsetType=m;if(2===m)r.offset=g.getInt8(1),p++;else if(1===m)r.offset=
g.getInt16(1,!0),p+=2;else if(0===m)r.offset=g.getFloat32(1,!0),p+=4;else throw"Invalid block offset type";d=Math.min(r.offset,d);if(1===r.encoding)if(m=g.getUint8(p),p++,r.bitsPerPixel=m&63,m>>=6,r.numValidPixelsType=m,2===m)r.numValidPixels=g.getUint8(p),p++;else if(1===m)r.numValidPixels=g.getUint16(p,!0),p+=2;else if(0===m)r.numValidPixels=g.getUint32(p,!0),p+=4;else throw"Invalid valid pixel count type";}l+=p;if(3!=r.encoding)if(0===r.encoding){g=(e.pixels.numBytes-1)/4;if(g!==Math.floor(g))throw"uncompressed block has invalid length";
p=new ArrayBuffer(4*g);m=new Uint8Array(p);m.set(new Uint8Array(h,l,4*g));p=new Float32Array(p);for(m=0;m<p.length;m++)d=Math.min(d,p[m]);r.rawData=p;l+=4*g}else 1===r.encoding&&(g=Math.ceil(r.numValidPixels*r.bitsPerPixel/8),p=new ArrayBuffer(4*Math.ceil(g/4)),m=new Uint8Array(p),m.set(new Uint8Array(h,l,g)),r.stuffedData=new Uint32Array(p),l+=g)}}e.pixels.minValue=d;e.eofOffset=l;h=null!=b.noDataValue?D.clampFloat32(b.noDataValue):v.defaultNoDataValue;var a=b.encodedMaskData,r=b.returnMask,g=0,
c=e.pixels.numBlocksX,d=e.pixels.numBlocksY,k=Math.floor(e.width/c),t=Math.floor(e.height/d),f=2*e.maxZError,a=a||(e.mask?e.mask.bitset:null),n,l=new (b.pixelType||Float32Array)(e.width*e.height);r&&a&&(n=new Uint8Array(e.width*e.height));for(var r=new Float32Array(k*t),B,A,p=0;p<=d;p++)if(m=p!==d?t:e.height%d,0!==m)for(var F=0;F<=c;F++){var w=F!==c?k:e.width%c;if(0!==w){var x=p*e.width*t+F*k,y=e.width-w,z=e.pixels.blocks[g],C,E;if(2>z.encoding){if(0===z.encoding)C=z.rawData;else{C=z.stuffedData;
E=z.bitsPerPixel;B=z.numValidPixels;A=z.offset;var H=f,G=r,L=e.pixels.maxValue,I=(1<<E)-1,Q=0,J=void 0,K=0,R=void 0,P=void 0,S=Math.ceil((L-A)/H);C[C.length-1]<<=8*(4*C.length-Math.ceil(E*B/8));for(J=0;J<B;J++)0===K&&(P=C[Q++],K=32),K>=E?(R=P>>>K-E&I,K-=E):(K=E-K,R=(P&I)<<K&I,P=C[Q++],K=32-K,R+=P>>>K),G[J]=R<S?A+R*H:L;C=r}E=0}else q=2===z.encoding?0:z.offset;var T;if(a)for(A=0;A<m;A++){x&7&&(T=a[x>>3],T<<=x&7);for(B=0;B<w;B++)x&7||(T=a[x>>3]),T&128?(n&&(n[x]=1),l[x++]=2>z.encoding?C[E++]:q):(n&&(n[x]=
0),l[x++]=h),T<<=1;x+=y}else if(2>z.encoding)for(A=0;A<m;A++){for(B=0;B<w;B++)l[x++]=C[E++];x+=y}else for(A=0;A<m;A++)if(l.fill)l.fill(q,x,x+w),x+=w+y;else{for(B=0;B<w;B++)l[x++]=q;x+=y}if(1===z.encoding&&E!==z.numValidPixels)throw"Block and Mask do not match";g++}}q=n;n={width:e.width,height:e.height,pixelData:l,minValue:e.pixels.minValue,maxValue:e.pixels.maxValue,noDataValue:h};q&&(n.maskData=q);b.returnEncodedMask&&e.mask&&(n.encodedMaskData=e.mask.bitset?e.mask.bitset:null);if(b.returnFileInfo&&
(n.fileInfo=u(e),b.computeUsedBitDepths)){b=n.fileInfo;q=e.pixels.numBlocksX*e.pixels.numBlocksY;T={};for(C=0;C<q;C++)E=e.pixels.blocks[C],0===E.encoding?T.float32=!0:1===E.encoding?T[E.bitsPerPixel]=!0:T[0]=!0;e=Object.keys(T);b.bitDepths=e}return n};var u=function(h){return{fileIdentifierString:h.fileIdentifierString,fileVersion:h.fileVersion,imageType:h.imageType,height:h.height,width:h.width,maxZError:h.maxZError,eofOffset:h.eofOffset,mask:h.mask?{numBlocksX:h.mask.numBlocksX,numBlocksY:h.mask.numBlocksY,
numBytes:h.mask.numBytes,maxValue:h.mask.maxValue}:null,pixels:{numBlocksX:h.pixels.numBlocksX,numBlocksY:h.pixels.numBlocksY,numBytes:h.pixels.numBytes,maxValue:h.pixels.maxValue,minValue:h.pixels.minValue,noDataValue:this.noDataValue}}};return v})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(D){return function(v){function u(b){var a,e,g,c;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(g=null;;){a=
this.readUInt32();c=b=void 0;c=[];for(b=0;4>b;++b)c.push(String.fromCharCode(this.data[this.pos++]));b=c.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(a);break;case "fcTL":g&&this.animation.frames.push(g);this.pos+=4;g={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();a=this.readUInt16()||100;g.delay=1E3*b/a;g.disposeOp=this.data[this.pos++];g.blendOp=this.data[this.pos++];g.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,a-=4);b=(null!=g?g.data:void 0)||this.imgData;for(c=0;0<=a?c<a:c>a;0<=a?++c:--c)b.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(a);a=255-this.transparency.indexed.length;if(0<a)for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case "tEXt":c=this.read(a);a=c.indexOf(0);b=String.fromCharCode.apply(String,c.slice(0,a));this.text[b]=String.fromCharCode.apply(String,c.slice(a+1));break;case "IEND":g&&
this.animation.frames.push(g);a:{switch(this.colorType){case 0:case 3:case 4:g=1;break a;case 2:case 6:g=3;break a}g=void 0}this.colors=g;this.hasAlphaChannel=4===(e=this.colorType)||6===e;e=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*e;a:{switch(this.colors){case 1:e="DeviceGray";break a;case 3:e="DeviceRGB";break a}e=void 0}this.colorSpace=e;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=a}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var h,b,q;u.load=function(b,a,e){var g;"function"===typeof a&&(e=a);g=new XMLHttpRequest;g.open("GET",b,!0);g.responseType="arraybuffer";g.onload=function(){var b;b=new Uint8Array(g.response||g.mozResponseArrayBuffer);b=new u(b);"function"===typeof(null!=a?a.getContext:void 0)&&b.render(a);return"function"===typeof e?e(b):void 0};return g.send(null)};u.prototype.read=function(b){var a,e;e=[];for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)e.push(this.data[this.pos++]);return e};u.prototype.readUInt32=function(){var b,
a,e,g;b=this.data[this.pos++]<<24;a=this.data[this.pos++]<<16;e=this.data[this.pos++]<<8;g=this.data[this.pos++];return b|a|e|g};u.prototype.readUInt16=function(){var b,a;b=this.data[this.pos++]<<8;a=this.data[this.pos++];return b|a};u.prototype.decodePixels=function(b){var a,e,g,c,d,k,h,f,l,r,m,n,B,q,u;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new D(b);b=b.getBytes();f=this.pixelBitlength/8;n=f*this.width;l=new Uint8Array(n*this.height);k=b.length;for(e=r=m=0;r<k;){switch(b[r++]){case 0:for(c=
a=0;a<n;c=a+=1)l[e++]=b[r++];break;case 1:for(c=B=0;B<n;c=B+=1)a=b[r++],d=c<f?0:l[e-f],l[e++]=(a+d)%256;break;case 2:for(c=d=0;d<n;c=d+=1)a=b[r++],g=(c-c%f)/f,B=m&&l[(m-1)*n+g*f+c%f],l[e++]=(B+a)%256;break;case 3:for(c=u=0;u<n;c=u+=1)a=b[r++],g=(c-c%f)/f,d=c<f?0:l[e-f],B=m&&l[(m-1)*n+g*f+c%f],l[e++]=(a+Math.floor((d+B)/2))%256;break;case 4:for(c=u=0;u<n;c=u+=1)a=b[r++],g=(c-c%f)/f,d=c<f?0:l[e-f],0===m?B=q=0:(B=l[(m-1)*n+g*f+c%f],q=g&&l[(m-1)*n+(g-1)*f+c%f]),h=d+B-q,c=Math.abs(h-d),g=Math.abs(h-B),
h=Math.abs(h-q),d=c<=g&&c<=h?d:g<=h?B:q,l[e++]=(a+d)%256;break;default:throw Error("Invalid filter algorithm: "+b[r-1]);}m++}return l};u.prototype.decodePalette=function(){var b,a,e,g,c,d,k,h,f;e=this.palette;d=this.transparency.indexed||[];c=new Uint8Array((d.length||0)+e.length);a=k=b=g=0;for(h=e.length;k<h;a=k+=3)c[g++]=e[a],c[g++]=e[a+1],c[g++]=e[a+2],c[g++]=null!=(f=d[b++])?f:255;return c};u.prototype.copyToImageData=function(b,a){var e,g,c,d,k,h,f;g=this.colors;f=null;e=this.hasAlphaChannel;
this.palette.length&&(f=null!=(c=this._decodedPalette)?c:this._decodedPalette=this.decodePalette(),g=4,e=!0);b=b.data||b;h=b.length;d=f||a;c=k=0;if(1===g)for(;c<h;)g=f?4*a[c/4]:k,k=d[g++],b[c++]=k,b[c++]=k,b[c++]=k,b[c++]=e?d[g++]:this.transparency.grayscale&&this.transparency.grayscale===k?0:255,k=g;else for(;c<h;)g=f?4*a[c/4]:k,b[c++]=d[g++],b[c++]=d[g++],b[c++]=d[g++],b[c++]=e?d[g++]:this.transparency.rgb&&this.transparency.rgb[1]===d[g-3]&&this.transparency.rgb[3]===d[g-2]&&this.transparency.rgb[5]===
d[g-1]?0:255,k=g};u.prototype.decode=function(){var b;b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};q=(b=v.document&&v.document.createElement("canvas"))&&b.getContext("2d");h=function(h){q.width=h.width;q.height=h.height;q.clearRect(0,0,h.width,h.height);q.putImageData(h,0,0);h=new Image;h.src=b.toDataURL();return h};u.prototype.decodeFrames=function(b){var a,e,g,c,d,k,l;if(this.animation){k=this.animation.frames;l=[];a=c=0;for(d=k.length;c<d;a=++c)a=
k[a],e=b.createImageData(a.width,a.height),g=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(e,g),a.imageData=e,l.push(a.image=h(e));return l}};u.prototype.renderFrame=function(b,a){var e,g;g=this.animation.frames;e=g[a];g=g[a-1];0===a&&b.clearRect(0,0,this.width,this.height);1===(null!=g?g.disposeOp:void 0)?b.clearRect(g.xOffset,g.yOffset,g.width,g.height):2===(null!=g?g.disposeOp:void 0)&&b.putImageData(g.imageData,g.xOffset,g.yOffset);0===e.blendOp&&b.clearRect(e.xOffset,e.yOffset,
e.width,e.height);return b.drawImage(e.image,e.xOffset,e.yOffset)};u.prototype.animate=function(b){var a,e,g,c,d,k,h=this;e=0;k=this.animation;c=k.numFrames;g=k.frames;d=k.numPlays;return(a=function(){var f,k;f=e++%c;k=g[f];h.renderFrame(b,f);if(1<c&&e/c<d)return h.animation._timeout=setTimeout(a,k.delay)})()};u.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};u.prototype.render=function(b){var a;b._png&&b._png.stopAnimation();b._png=this;b.width=
this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);a=b.createImageData(this.width,this.height);this.copyToImageData(a,this.decodePixels());return b.putImageData(a,0,0)};return u}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define(["require","exports"],function(D,v){var u=function(h){var b=1;switch(h){case Uint8Array:case Int8Array:b=1;break;case Uint16Array:case Int16Array:b=2;break;case Uint32Array:case Int32Array:case Float32Array:b=
4;break;case Float64Array:b=8}return b};return function(){function h(){}h.decode=function(b,h){var l=h.pixelType,a=[],e=h.width*h.height,g=Math.floor(b.byteLength/(h.width*h.height*u(h.pixelType))),c=h.bandIds,d=h.format;h=c&&c.length||Math.floor(b.byteLength/(h.width*h.height*u(h.pixelType)));var k=b.byteLength-b.byteLength%(e*u(l)),t=new l(b,0,e*g),f,p,r,m;if("bip"===d)for(d=0;d<h;d++){r=new l(e);m=c?c[d]:d;for(f=0;f<e;f++)r[f]=t[f*g+m];a.push(r)}else if("bsq"===d)for(d=0;d<h;d++)m=c?c[d]:d,a.push(t.subarray(m*
e,(m+1)*e));if(k<b.byteLength-1)if(b=b.slice(k),8*b.byteLength<e)p=null;else{b=new Uint8Array(b,0,Math.ceil(e/8));l=new Uint8Array(e);for(p=h=p=c=g=0;p<b.length-1;p++)for(c=b[p],h=7;0<=h;h--)l[g++]=c>>h&1;for(h=7;g<e-1;)c=b[b.length-1],l[g++]=c>>h&1,h--;p=l}return{pixels:a,mask:p}};return h}()})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("require exports ../../../core/tsSupport/assignHelper ../rasterDatasets/byteStreamUtils ./Jpg ./TiffTags ./Zlib".split(" "),function(D,v,
u,h,b,q,l){function a(a,b){var c="unknown";3===a?c="f32":1===a?1===b?c="u1":2===b?c="u2":4===b?c="u4":8>=b?c="u8":16>=b?c="u16":32>=b&&(c="u32"):2===a&&(8>=b?c="s8":16>=b?c="s16":32>=b&&(c="s32"));return c}function e(a){var b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;default:b=Float32Array}return b}
function g(a,b){return{x:b[0]*a.x+b[1]*a.y+b[2],y:b[3]*a.x+b[4]*a.y+b[5]}}function c(a,b){return(a=a.get(b))&&a.values}function d(a,b){return(a=a.get(b))&&a.values[0]}function k(a,b,c,e,d,f){void 0===e&&(e=0);void 0===d&&(d=q.TIFF_TAGS);void 0===f&&(f=4);var g=(new DataView(a,c,2)).getUint16(0,b),k=4+2*f,h=2+g*k;if(c+h>a.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:h};var l=c+h+4<=a.byteLength?(new DataView(a,c+h,4)).getUint32(0,b):null;c+=2;for(var n=new Map,m,p,x,r,B,y,
w=0;w<g;w++){m=new DataView(a,c+k*w,k);p=m.getUint16(0,b);r=m.getUint16(2,b);x=q.getTagName(p,d);if(2===f)B=m.getUint16(4,b),y=m.getUint16(6,b);else if(4===f)B=m.getUint32(4,b),y=m.getUint32(8,b);else if(8===f)if(y=B=0,b)for(var A=0;8>A;A++)B+=m.getUint8(4+A)*Math.pow(2,8*A),y+=m.getUint8(12+A)*Math.pow(2,8*A);else for(A=0;8>A;A++)B+=m.getUint8(4+A)*Math.pow(2,8*(7-A)),y+=m.getUint8(12+A)*Math.pow(2,8*(7-A));m={id:p,type:r,valueCount:B,valueOffset:y,values:null};t(a,b,m,e);n.set(x,m)}return{success:!0,
ifd:n,nextIFD:l,requiredBufferSize:h}}function t(a,b,c,e,d){void 0===e&&(e=0);if(c.values)return!0;var f=c.type,g=c.valueCount,k=c.valueOffset,h=[],l=n[f],m=8*l,p=g*l,r=g*n[f]*8;if(32<r&&p>(d?a.byteLength:a?a.byteLength-k+e:0))return c.offlineOffsetSize=[k,p],c.values=null,!1;if(32>=r)if(b||(k>>>=32-r),1===g)h=[k];else for(a=0;a<g;a++)h.push(k<<m*a>>>32-m);else for(k-=e,d&&(k=0),m=k;m<k+p;m+=l){switch(f){case 1:g=(new DataView(a,m,1)).getUint8(0);break;case 2:g=(new DataView(a,m,1)).getUint8(0);break;
case 3:g=(new DataView(a,m,2)).getUint16(0,b);break;case 4:g=(new DataView(a,m,4)).getUint32(0,b);break;case 5:g=(new DataView(a,m,4)).getUint32(0,b)/(new DataView(a,m+4,4)).getUint32(0,b);break;case 6:g=(new DataView(a,m,1)).getInt8(0);break;case 7:g=(new DataView(a,m,1)).getUint8(0);break;case 8:g=(new DataView(a,m,2)).getInt16(0,b);break;case 9:g=(new DataView(a,m,4)).getInt32(0,b);break;case 10:g=(new DataView(a,m,4)).getInt32(0,b)/(new DataView(a,m+4,4)).getInt32(0,b);break;case 11:g=(new DataView(a,
m,4)).getFloat32(0,b);break;case 12:g=(new DataView(a,m,8)).getFloat64(0,b);break;default:g=null}h.push(g)}if(2===f){f="";k=h;h=[];for(a=0;a<k.length;a++)0===k[a]&&""!==f?(h.push(f),f=""):f+=String.fromCharCode(k[a]);""===f&&0!==h.length||h.push(f)}c.values=h;return!0}function f(b){var e=b[0],f=d(e,"TILEWIDTH"),k=d(e,"TILELENGTH"),h=d(e,"IMAGEWIDTH"),l=d(e,"IMAGELENGTH"),m=d(e,"BITSPERSAMPLE"),n=d(e,"SAMPLESPERPIXEL"),p=d(e,"SAMPLEFORMAT")||1,r=a(p,m),B=c(e,"PLANARCONFIGURATION")?2===c(e,"PLANARCONFIGURATION")[0]:
!1,t=c(e,"GDAL_NODATA"),q;null!=t&&("string"===typeof t[0]?(q=t.map(function(a){return parseFloat(a)}),q.some(function(a){return isNaN(a)})&&(q=null)):"number"===typeof t[0]&&(q=t));var w=d(e,"COMPRESSION")||1;switch(w){case 1:t="NONE";break;case 2:case 3:case 4:case 32771:t="CCITT";break;case 5:t="LZW";break;case 6:case 7:t="JPEG";break;case 32773:t="PACKBITS";break;case 8:case 32946:t="DEFLATE";break;case 34712:t="JPEG2000";break;default:t=String(w)}var A=!0,u="";1!==w&&6!==w&&8!==w&&32946!==w&&
(A=!1,u+="unsupported tag compression "+w);3<p&&(A=!1,u+="unsupported tag sampleFormat "+p);0!==m%8&&(A=!1,u+="unsupported tag bitsPerSample "+m);var m=d(e,"GEOASCIIPARAMS"),v;m&&(v=(v=m.split("|").filter(function(a){return-1<a.indexOf("ESRI PE String \x3d ")})[0])?v.replace("ESRI PE String \x3d ",""):"",v=0===v.indexOf("PROJCS")||0===v.indexOf("GEOGCS")?{wkid:null,wkt:v}:null);var m=c(e,"GEOTIEPOINTS"),p=c(e,"GEOPIXELSCALE"),w=c(e,"GEOTRANSMATRIX"),D=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:
null,e=!1;if(D){var e=2===d(D,"GTRasterTypeGeoKey"),O=d(D,"GTModelTypeGeoKey");2===O?(D=d(D,"GeographicTypeGeoKey"),1024<D&&32766>D&&(v={wkid:D})):1===O&&(D=d(D,"ProjectedCSTypeGeoKey"),1024<D&&32766>D&&(v={wkid:D}))}var M,W;p&&m&&6<=m.length?(M=[p[0],0,m[3]-m[0]*p[0],0,-Math.abs(p[1]),m[4]-m[1]*p[1]],e&&(M[2]-=.5*M[0]+.5*M[1],M[5]-=.5*M[3]+.5*M[4])):w&&16===w.length&&(M=[w[0],w[1],w[3],w[4],w[5],w[7]]);if(M){W=[{x:0,y:l},{x:0,y:0},{x:h,y:l},{x:h,y:0}];e=void 0;p=m=Number.POSITIVE_INFINITY;D=w=Number.NEGATIVE_INFINITY;
for(O=0;O<W.length;O++)e=g(W[O],M),m=e.x>m?m:e.x,w=e.x<w?w:e.x,p=e.y>p?p:e.y,D=e.y<D?D:e.y;W={xmin:m,xmax:w,ymin:p,ymax:D,spatialReference:v}}M=b.filter(function(a){return 1===d(a,"NEWSUBFILETYPE")});var N,U,X,Z;0<M.length&&(N=Math.round(Math.log(h/d(M[0],"IMAGEWIDTH"))/Math.LN2),U=Math.round(Math.log(h/d(M[M.length-1],"IMAGEWIDTH"))/Math.LN2),X=d(M[M.length-1],"TILEWIDTH"),Z=d(M[M.length-1],"TILEHEIGHT"));X=0<U?X||f:null;Z=0<U?Z||k:null;var Y;f&&(Y=[{maxCol:Math.ceil(h/f)-1,maxRow:Math.ceil(l/k)-
1,minRow:0,minCol:0}],M.forEach(function(a){Y.push({maxCol:Math.ceil(d(a,"IMAGEWIDTH")/d(a,"TILEWIDTH"))-1,maxRow:Math.ceil(d(a,"IMAGELENGTH")/d(a,"TILELENGTH"))-1,minRow:0,minCol:0})}));b=d(b[0],"GDAL_METADATA");b=F(b);return{width:h,height:l,tileWidth:f,tileHeight:k,planes:n,isBSQ:B,pixelType:r,compression:t,noData:q,isSupported:A,message:u,extent:W,firstPyramidLevel:N,maximumPyramidLevel:U,pyramidBlockWidth:X,pyramidBlockHeight:Z,tileBoundary:Y,metadata:b}}function p(a){var b=new DataView(a,0,
8),c=b.getUint16(0,!1),e=null;if(18761===c)e=!0;else if(19789===c)e=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,e))throw"unexpected tiff identifier";c=b.getUint32(4,e);b=[];do if(c=r(a,e,c),c.success)b.push(c.ifd),c=c.nextIFD;else break;while(0<c);a=f(b);return u({},a,{littleEndian:e,ifds:b})}function r(a,b,c,e,d,f){void 0===e&&(e=0);void 0===d&&(d=q.TIFF_TAGS);void 0===f&&(f=4);c=k(a,b,c,e,d,f);var g,l=c.ifd;l&&(q.ifdTags.forEach(function(c,d){l.has(d)&&(g=l.get(d),g.data=k(a,
b,g.valueOffset-e,e,c).ifd)}),l.has("GEOKEYDIRECTORY")&&(g=l.get("GEOKEYDIRECTORY"),(d=g.values)&&4<d.length&&(d=d[0]+"."+d[1]+"."+d[2],g.data=k(a,b,g.valueOffset+6-e,e,q.GEO_KEYS,2).ifd,g.data&&g.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[d]}))),l.has("XMP")&&(g=l.get("XMP"),d=g.values,"number"===typeof d[0]&&7===g.type&&(g.values=[h.bytesToUTF8(new Uint8Array(d))])));return c}Object.defineProperty(v,"__esModule",{value:!0});var m=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),n=[0,1,1,2,4,8,1,1,2,4,8,4,8],B=function(c,f,g,k,h){f=m===f;var n=d(g,"BITSPERSAMPLE"),p=d(g,"SAMPLEFORMAT")||1,n=a(p,n),p=d(g,"COMPRESSION")[0]||1;g=e(n);var r,t;1===p?(r=c.slice(k,k+h),t=new Uint8Array(r)):8===p||32946===p?(t=new Uint8Array(c,k,h),t=new l(t),c=t.getBytes(),r=new ArrayBuffer(c.length),t=new Uint8Array(r),t.set(c)):6===p&&(t=new Uint8Array(c,k,h),r=new b,r.parse(t),c=r.getData(r.width,r.height,!0),r=new ArrayBuffer(c.length),
t=new Uint8Array(r),t.set(c));if("u8"!==n&&"s8"!==n&&!f)switch(r=new ArrayBuffer(t.length),f=new Uint8Array(r),n){case "u16":case "s16":for(n=0;n<t.length;n+=2)f[n]=t[n+1],f[n+1]=t[n];break;case "u32":case "s32":case "f32":for(n=0;n<t.length;n+=4)f[n]=t[n+3],f[n+1]=t[n+2],f[n+2]=t[n+1],f[n+3]=t[n]}return new g(r)},A=function(a,b,c){if(!(a&&0<a.length&&b&&c))return null;for(var e,d,f,g=a[0].length,k=a.length,h=new Uint8Array(g),l=0;l<k;l++)if(e=a[l],d=b[l],f=c[l],0===l)for(var m=0;m<g;m++)h[m]=e[m]<
d||e[m]>f?0:1;else for(m=0;m<g;m++)h[m]&&(h[m]=e[m]<d||e[m]>f?0:1);return h},F=function(a){if(!a)return null;var b=a.match(/<Item(.*?)Item>/gi);if(!b||0===b.length)return null;a=new Map;for(var c,e,d,f,g=0;g<b.length;g++)c=b[g],e=c.slice(6,c.indexOf("\x3e")),d=c.indexOf("sample\x3d"),-1<d&&(f=c.slice(d+8,c.indexOf('"',d+8))),d=c.indexOf("name\x3d"),-1<d&&(e=c.slice(d+6,c.indexOf('"',d+6))),e&&(c=c.slice(c.indexOf("\x3e")+1,c.indexOf("\x3c/Item\x3e")).trim(),null!=f?a.has(e)?a.get(e)[f]=c:a.set(e,
[c]):a.set(e,c)),f=null;b=a.get("STATISTICS_MINIMUM");e=a.get("STATISTICS_MAXIMUM");c=a.get("STATISTICS_MEAN");d=a.get("STATISTICS_STDDEV");f=null;if(b&&e)for(f=[],g=0;g<b.length;g++)f.push({min:parseFloat(b[g]),max:parseFloat(e[g]),avg:c&&parseFloat(c[g]),stddev:d&&parseFloat(d[g])});e=a.get("BandName");c=a.get("WavelengthMin");d=a.get("WavelengthMax");b=null;if(e)for(b=[],g=0;g<e.length;g++)b.push({BandName:e[g],WavelengthMin:c&&parseFloat(c[g]),WavelengthMax:d&&parseFloat(d[g])});g=a.get("DataType");
return{statistics:f,bandProperties:b,dataType:g,rawMetadata:a}};v.parseFieldValues=t;v.getImageInfo=f;v.parseHeader=p;v.parseSignature=function(a){var b=new DataView(a,0,8),c=b.getUint16(0,!1);a=null;if(18761===c)a=!0;else if(19789===c)a=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,a))throw"unexpected tiff identifier";b=b.getUint32(4,a);return{littleEndian:a,firstIFD:b}};v.parseIFD=r;v.decodeTileOrStrip=function(a,b){var c=b.headerInfo,f=b.ifd,g=B(a,c.littleEndian,f,b.offset||0,
b.size||a.byteLength);a=c.pixelType;for(var k=c.isBSQ,h=c.planes,l=e(a),m=g.length/h,n,p=[],t=0;t<h;t++){n=new l(m);if(k)n=g.slice(m*t,m*(t+1));else for(var r=0;r<m;r++)n[r]=g[r*h+t];p.push(n)}var g=d(f,"TILEWIDTH"),f=d(f,"TILELENGTH"),k=c.noData?c.noData[0]:null,c=(h=c.metadata?c.metadata.statistics:null)?h.map(function(a){return a.min}):null,h=h?h.map(function(a){return a.max}):null,q;if(null!=k)if(q=new Uint8Array(m),1E24<Math.abs(k))for(b=0;b<m;b++)q[b]=1E-6>Math.abs((p[0][b]-k)/k)?0:1;else for(b=
0;b<m;b++)q[b]=p[0][b]===k?0:1;else c&&h&&b.applyMinMaxConstraint&&(q=A(p,c,h));return{pixelType:a,width:g,height:f,pixels:p,mask:q,noDataValue:k}};v.decode=function(a,d){d=d||p(a);var f=d.ifds,g=d.noData;if(0===f.length)throw"no valid image file directory";f=f[0];g=g?g[0]:null;if(d.tileWidth){var k=c(f,"TILEOFFSETS");if(void 0===k)f=null;else{for(var h=c(f,"TILEBYTECOUNTS"),n=d.tileWidth,t=d.tileHeight,r=d.width,q=d.height,A=d.pixelType,w=d.isBSQ,x=d.planes,u=r*q,v=c(f,"BITSPERSAMPLE")[0],F=e(A),
D=[],V=0;V<x;V++)D.push(new F(u));var O,M,W,N,U,X,Z,Y,u=Math.ceil(r/n);if(0===v%8)for(v=0;v<k.length;v++)for(O=Math.floor(v/u)*t,N=v%u*n,V=O*r+N,F=B(a,d.littleEndian,f,k[v],h[v]),X=0,U=V,N=Math.min(n,r-N),Z=Math.min(t,q-O),O=0;O<x;O++)if(Y=D[O],w)for(M=0;M<Z;M++)for(U=V+M*r,X=n*t*O+M*n,W=0;W<N;W++,U++,X++)Y[U]=F[X];else for(M=0;M<Z;M++)for(U=V+M*r,X=M*n*x+O,W=0;W<N;W++,U++,X+=x)Y[U]=F[X];f={width:r,height:q,pixelType:A,pixels:D}}}else if(t=d,D=m===t.littleEndian,u=c(f,"STRIPOFFSETS"),void 0===u)f=
null;else{d=t.width;k=t.height;h=t.pixelType;t=t.planes;r=d*k;v=c(f,"BITSPERSAMPLE")[0];q=e(h);A=new q(r*t);F=c(f,"STRIPBYTECOUNTS");V=c(f,"ROWSPERSTRIP")[0];U=c(f,"COMPRESSION")?c(f,"COMPRESSION")[0]:1;N=V;if(0===v%8)for(f=0;f<u.length;f++){X=f*V*d*t;N=(f+1)*V>k?k-f*V:V;if("u8"===h||"s8"===h||D)8===U||32946===U?(w=new Uint8Array(a,u[f],F[f]),w=new l(w),O=w.getBytes(),x=new ArrayBuffer(O.length),w=new Uint8Array(x),w.set(O),w.length!==N*d*t*v/8&&console.log("strip byte counts is different than expected")):
6===U?(w=new Uint8Array(a,u[f],F[f]),x=new b,x.parse(w),N=x.getData(x.width,x.height,!0),x=new ArrayBuffer(N.length),w=new Uint8Array(x),w.set(N)):1===U&&(F[f]!==N*d*t*v/8&&console.log("strip byte counts is different than expected"),x=a.slice(u[f],u[f]+F[f]));else switch(6===U||8===U||32946===U?(w=new Uint8Array(a,u[f],F[f]),w=new l(w),w=w.getBytes(),x=new ArrayBuffer(w.length),n=new Uint8Array(x),w.length!==N*d*t*v/8&&console.log("strip byte counts is different than expected")):1===U&&(F[f]!==N*
d*t*v/8&&console.log("strip byte counts is different than expected"),x=new ArrayBuffer(F[f]),w=new Uint8Array(a,u[f],F[f]),n=new Uint8Array(x)),h){case "u16":case "s16":for(N=0;N<w.length;N+=2)n[N]=w[N+1],n[N+1]=w[N];break;case "u32":case "s32":case "f32":for(N=0;N<w.length;N+=4)n[N]=w[N+3],n[N+1]=w[N+2],n[N+2]=w[N+1],n[N+3]=w[N]}N=new q(x);A.set(N,X)}w=[];if(1===t)w.push(A);else for(f=0;f<t;f++){n=new q(r);for(a=0;a<r;a++)n[a]=A[a*t+f];w.push(n)}f={width:d,height:k,pixelType:h,pixels:w}}if(null!==
g){f.mask=new Uint8Array(f.width*f.height);if(1E24<Math.abs(g))for(a=0;a<f.width*f.height;a++)f.mask[a]=1E-6>Math.abs((f.pixels[0][a]-g)/g)?0:1;else for(a=0;a<f.width*f.height;a++)f.mask[a]=f.pixels[0][a]===g?0:1;f.noDataValue=g}return f}})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["require","exports"],function(D,v){Object.defineProperty(v,"__esModule",{value:!0});v.bytesToUTF8=function(u,h){for(var b=0,q="",l=0,a=0,e=u.length;b<e;)if(a=u[b++],l=a>>4,8>l?l=1:15===l?
(l=4,a=(a&7)<<18|(u[b++]&63)<<12|(u[b++]&63)<<6|u[b++]&63):14===l?(l=3,a=(a&15)<<12|(u[b++]&63)<<6|u[b++]&63):(l=2,a=(a&31)<<6|u[b++]&63),0!==a||h)q+=String.fromCharCode(a);return q}})},"esri/layers/support/rasterFormats/TiffTags":function(){define(["require","exports"],function(D,v){var u=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]=
"CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";
b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]=
"INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]=
"YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[700]="XMP";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34264]="GEOTRANSMATRIX";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";b[34665]="EXIFIFD";b[34853]="GPSIFD";b[40965]="INTEROPERABILITYIFD";return b}();D=function(){var b=[].concat(u);b[36864]="ExifVersion";b[40960]="FlashpixVersion";b[40961]="ColorSpace";b[42240]=
"Gamma";b[37121]="ComponentsConfiguration";b[37122]="CompressedBitsPerPixel";b[40962]="PixelXDimension";b[40963]="PixelYDimension";b[37500]="MakerNote";b[37510]="UserComment";b[40964]="RelatedSoundFile";b[36867]="DateTimeOriginal";b[36868]="DateTimeDigitized";b[36880]="OffsetTime";b[36881]="OffsetTimeOriginal";b[36882]="OffsetTimeDigitized";b[37520]="SubSecTime";b[37521]="SubSecTimeOriginal";b[37522]="SubSecTimeDigitized";b[37888]="Temperature";b[37889]="Humidity";b[37890]="Pressure";b[37891]="WaterDepth";
b[37892]="Acceleration";b[37893]="CameraElevationAngle";b[42016]="ImageUniqueID";b[42032]="CameraOwnerName";b[42033]="BodySerialNumber";b[42034]="LensSpecification";b[42035]="LensMake";b[42036]="LensModel";b[42037]="LensSerialNumber";b[33434]="ExposureTime";b[33437]="FNumber";b[34850]="ExposureProgram";b[34852]="SpectralSensitivity";b[34855]="PhotographicSensitivity";b[34856]="OECF";b[34864]="SensitivityType";b[34865]="StandardOutputSensitivity";b[34866]="RecommendedExposureIndex";b[34867]="ISOSpeed";
b[34868]="ISOSpeedLatitudeyyy";b[34869]="ISOSpeedLatitudezzz";b[37377]="ShutterSpeedValue";b[37378]="ApertureValue";b[37379]="BrightnessValue";b[37380]="ExposureBiasValue";b[37381]="MaxApertureValue";b[37382]="SubjectDistance";b[37383]="MeteringMode";b[37384]="LightSource";b[37385]="Flash";b[37386]="FocalLength";b[37396]="SubjectArea";b[41483]="FlashEnergy";b[41484]="SpatialFrequencyResponse";b[41486]="FocalPlaneXResolution";b[41487]="FocalPlaneYResolution";b[41488]="FocalPlaneResolutionUnit";b[41492]=
"SubjectLocation";b[41493]="ExposureIndex";b[41495]="SensingMethod";b[41728]="FileSource";b[41729]="SceneType";b[41730]="CFAPattern";b[41985]="CustomRendered";b[41986]="ExposureMode";b[41987]="WhiteBalance";b[41988]="DigitalZoomRatio";b[41989]="FocalLengthIn35mmFilm";b[41990]="SceneCaptureType";b[41991]="GainControl";b[41992]="Contrast";b[41993]="Saturation";b[41994]="Sharpness";b[41995]="DeviceSettingDescription";b[41996]="SubjectDistanceRange";return b}();v=function(){var b=[];b[1024]="GTModelTypeGeoKey";
b[1025]="GTRasterTypeGeoKey";b[1026]="GTCitationGeoKey";b[2048]="GeographicTypeGeoKey";b[2049]="GeogCitationGeoKey";b[2050]="GeogGeodeticDatumGeoKey";b[2051]="GeogPrimeMeridianGeoKey";b[2052]="GeogLinearUnitsGeoKey";b[2053]="GeogLinearUnitSizeGeoKey";b[2054]="GeogAngularUnitsGeoKey";b[2055]="GeogAngularUnitSizeGeoKey";b[2056]="GeogEllipsoidGeoKey";b[2057]="GeogSemiMajorAxisGeoKey";b[2058]="GeogSemiMinorAxisGeoKey";b[2059]="GeogInvFlatteningGeoKey";b[2061]="GeogPrimeMeridianLongGeoKey";b[2060]="GeogAzimuthUnitsGeoKey";
b[3072]="ProjectedCSTypeGeoKey";b[3073]="PCSCitationGeoKey";b[3074]="ProjectionGeoKey";b[3075]="ProjCoordTransGeoKey";b[3076]="ProjLinearUnitsGeoKey";b[3077]="ProjLinearUnitSizeGeoKey";b[3078]="ProjStdParallel1GeoKey";b[3079]="ProjStdParallel2GeoKey";b[3080]="ProjNatOriginLongGeoKey";b[3081]="ProjNatOriginLatGeoKey";b[3082]="ProjFalseEastingGeoKey";b[3083]="ProjFalseNorthingGeoKey";b[3084]="ProjFalseOriginLongGeoKey";b[3085]="ProjFalseOriginLatGeoKey";b[3086]="ProjFalseOriginEastingGeoKey";b[3087]=
"ProjFalseOriginNorthingGeoKey";b[3088]="ProjCenterLongGeoKey";b[3090]="ProjCenterEastingGeoKey";b[3091]="ProjCenterNorthingGeoKey";b[3092]="ProjScaleAtNatOriginGeoKey";b[3093]="ProjScaleAtCenterGeoKey";b[3094]="ProjAzimuthAngleGeoKey";b[3095]="ProjStraightVertPoleLongGeoKey";b[4096]="VerticalCSTypeGeoKey";b[4097]="VerticalCitationGeoKey";b[4098]="VerticalDatumGeoKey";b[4099]="VerticalUnitsGeoKey";return b}();var h=new Map;h.set("EXIFIFD",D);h.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{TIFF_TAGS:u,ifdTags:h,GEO_KEYS:v,getTagName:function(b,h){h=(h||u)[b];void 0===h&&(h="unknown"+String(b));return h}}})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../rasterRenderers ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../../layers/support/rasterFunctions/surfaceUtils ../support/colorRampUtils".split(" "),
function(D,v,u,h,b,q,l,a,e,g,c,d,k,t,f){var p=g.getLogger("esri.renderers.support.RasterSymbolizer");return function(e){function g(a){return e.call(this,a)||this}h(g,e);g.prototype.readRenderer=function(b,c,e){return a.read(b,e)};g.prototype.bind=function(){this.lookup={};if(!this.renderer)return!1;var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=this._updateStretchRenderer(this.renderer);
break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer);break;case "raster-shaded-relief":a=this._updateShadedReliefRenderer(this.renderer)}return a};g.prototype.symbolize=function(a){var b=a&&a.pixelBlock;if(!this.isValidPixelBlock(b))return b;if(a.simpleStretchParams&&"raster-stretch"===this.renderer.type)return this.simpleStretch(b,a.simpleStretchParams);try{3<b.pixels.length&&(b=k.extractBands(b,[0,1,2]));var c=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":c=
this._symbolize_colormap(b);break;case "class-breaks":c=this._symbolize_classBreaks(b);break;case "raster-stretch":c=this._symbolize_stretch(b);break;case "raster-shaded-relief":var e=a.extent,c=this._symbolize_shadedRelief(b,{isGCS:e.spatialReference.isGeographic,resolution:{x:(e.xmax-e.xmin)/b.width,y:(e.ymax-e.ymin)/b.height}})}return c}catch(w){return p.error("symbolize",w.message),b}};g.prototype.simpleStretch=function(a,b){if(!this.isValidPixelBlock(a))return a;try{return 3<a.pixels.length&&
(a=k.extractBands(a,[0,1,2])),k.stretch(a,b)}catch(A){return p.error("symbolize",A.message),a}};g.prototype.generateWebGLParameters=function(a){if(-1<["unique-value","raster-colormap","class-breaks"].indexOf(this.renderer.type)){var b=this.lookup.lut;return{colormap:b.indexedColormap,colormapOffset:b.colormapOffset,type:"lut"}}var b=a.pixelBlock,c=a.isGCS;a=a.resolution;return"raster-stretch"===this.renderer.type?this.generateStretchWebGLParams(b,this.renderer):"raster-shaded-relief"===this.renderer.type?
this.generateShadedReliefWebGLParams(this.renderer,c,a):null};g.prototype._isLUTChanged=function(a){if(!this.lookup)return!0;if("colorRamp"in this.renderer){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=u({},this.renderer.toJSON());b=u({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==JSON.stringify(this.lookup.rendererJson)};g.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&
!this.bind()?a:k.colorize(a,this.lookup.lut)};g.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?k.colorize(a,this.lookup.lut):k.remapColor(a,this.lookup.lut)};g.prototype._symbolize_stretch=function(a){var b=this.rasterInfo.pixelType,c=this.renderer,e=-1<["u8","u16","s8","s16"].indexOf(b),d=c.gamma,f=c.useGamma;if(e){if(c.dynamicRangeAdjustment)e=this.getStretchCutoff(c,a),b=k.createStretchLUT(u({pixelType:b},
e,{gamma:f?d:null}));else{if(this._isLUTChanged()&&(d=this.bind(),!d))return a;b=this.lookup?this.lookup.lut:null}if(!b)return a;b=k.lookupPixels(a,b)}else e=this.getStretchCutoff(c,a),b=k.stretch(a,u({},e,{gamma:f?d:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(d=this.bind(),!d))return a;b=k.colorize(b,this.lookup.colorRampLut)}return b};g.prototype._symbolize_shadedRelief=function(a,b){var c=this.renderer;b=u({},c.toJSON(),b);a=t.hillshade(a,b);return!c.colorRamp||this._isLUTChanged(!0)&&
!this.bind()?a:(c=this.lookup?this.lookup.colorRamplut:null)?k.lookupPixels(a,c):a};g.prototype._updateUVRenderer=function(a){var b=this.rasterInfo,c=b.bandCount,e=b.attributeTable,d=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&d&&null!=d[0].min&&null!=d[0].max;if(1!==c||!e&&!b)return!1;var f=a.field;if(!f)return!1;var g=[];if(e){var h=e.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!h)return!1;e.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===
String(b.attributes[f])})[0];(c=c&&c.symbol&&c.symbol.color)&&g.push([b.attributes[h.name],c.r,c.g,c.b,1<c.a?c.a:Math.round(255*c.a)])})}else{if("Value"!==f.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=a&&a.symbol&&a.symbol.color;b&&g.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===g.length)return!1;c=k.createColormapLUT({colormap:g});this.lookup={rendererJson:a.toJSON(),lut:c};return this.canRenderInWebGL=!0};g.prototype._updateColormapRenderer=
function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=k.createColormapLUT({colormap:b});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};g.prototype._updateShadedReliefRenderer=function(a){if(a.colorRamp){var b=f.convertColorRampToColormap(a.colorRamp,256),b=k.createColormapLUT({colormap:b});this.lookup={rendererJson:a.toJSON(),colorRampLut:b}}else this.lookup=null;return this.canRenderInWebGL=!0};g.prototype._updateClassBreaksRenderer=function(a){var b=
-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),c=a.classBreakInfos;if(!c||0===c.length)return!1;var e=c.sort(function(a,b){return a.minValue-b.minValue}),c=e[e.length-1];if(!b)return b=e.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*
c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),lut:b},this.canRenderInWebGL=!1,!0;var d=[],f,g=0;e.forEach(function(a){f=Math.ceil(a.minValue);g=Math.floor(a.maxValue);for(var b=f;b<g;b++)d.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});d.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]);b=k.createColormapLUT({colormap:d,
fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};g.prototype._updateStretchRenderer=function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var c=a.gamma,e=a.useGamma,b=a.colorRamp,d=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&-1<["u8","u16","s8","s16"].indexOf(d)){var g=this.getStretchCutoff(a),
c=k.createStretchLUT(u({pixelType:d},g,{gamma:e?c:null}));this.lookup={rendererJson:a.toJSON(),lut:c}}b&&(b=f.convertColorRampToColormap(b,256),this.lookup.colorRampLut=k.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return this.canRenderInWebGL=!0};g.prototype.getStretchCutoff=function(a,b){var c,e,d=a.stretchType;a.dynamicRangeAdjustment?"min-max"===d&&b.statistics?c=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(e=k.estimateStatisticsHistograms(b),c=e.statistics,
e=e.histograms):(c=a.statistics&&0<a.statistics.length?a.statistics:this.rasterInfo.statistics,e=a.histograms||this.rasterInfo.histograms);b=c||e?(c||e).length:this.rasterInfo.bandCount;var f=[],g=[],h,l,m,n,p,t;c[0]instanceof Array||(c=c.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(d){case "min-max":for(d=0;d<b;d++)f[d]=c[d][0],g[d]=c[d][1];break;case "standard-deviation":for(d=0;d<b;d++)f[d]=c[d][2]-a.numberOfStandardDeviations*c[d][3],g[d]=c[d][2]+a.numberOfStandardDeviations*c[d][3],
f[d]<c[d][0]&&(f[d]=c[d][0]),g[d]>c[d][1]&&(g[d]=c[d][1]);break;case "percent-clip":for(d=0;d<b;d++){c=e[d];n=new Uint32Array(c.size);m=c.counts;l=0;h=(c.max-c.min)/c.size;p=-.5===c.min&&1===h?.5:0;for(t=0;t<c.size;t++)l+=m[t],n[t]=l;m=a.minPercent*l/100;for(t=0;t<c.size;t++)if(n[t]>m){f[d]=c.min+h*(t+p);break}m=(1-a.maxPercent/100)*l;for(t=c.size-2;0<=t;t--)if(n[t]<m){g[d]=c.min+h*(t+2-p);break}}break;default:for(d=0;d<b;d++)f[d]=c[d][0],g[d]=c[d][1]}return{minCutOff:f,maxCutOff:g,outMax:a.outputMax||
255,outMin:a.outputMin||0}};g.prototype.generateStretchWebGLParams=function(a,b){var c=null,e=null,d=this.lookup&&this.lookup.colorRampLut;b.colorRamp&&d&&(c=d.indexedColormap,e=d.offset);var d=b.gamma,f=b.useGamma,g=this.getStretchCutoff(b,a);b=g.minCutOff;var k=g.maxCutOff,h=g.outMin,g=g.outMax;a&&a.pixels&&2===a.pixels.length&&(a=a.clone(),a.statistics=[a.statistics[0]],a.pixels=[a.pixels[0]]);a=Math.min(3,a&&a.getPlaneCount()||this.rasterInfo.bandCount);var l=new Float32Array(a),m=null==c?255:
1,n;for(n=0;n<a;n++)l[n]=(g-h)/(k[n]-b[n])/m;var p=new Float32Array(a);if(f)for(n=0;n<a;n++)p[n]=1<d[n]?2<d[n]?6.5+Math.pow(d[n]-2,2.5):6.5+100*Math.pow(2-d[n],4):1;return{bandCount:a,outMin:h/m,outMax:g/m,minCutOff:b,maxCutOff:k,factor:l,useGamma:f,gamma:f?d:[1,1,1],gammaCorrection:f?p:[1,1,1],colormap:c,colormapOffset:e,type:"stretch"}};g.prototype.generateShadedReliefWebGLParams=function(a,b,c){var d=null,e=null,f=this.lookup&&this.lookup.colorRampLut;a.colorRamp&&f&&(d=f.indexedColormap,e=f.offset);
b=u({},a.toJSON(),{isGCS:b,resolution:c});b=t.calculateHillshadeParams(b);return u({},b,{hillshadeType:"traditional"===a.hillshadeType?0:1,type:"hillshade",colormap:d,colormapOffset:e})};g.prototype.isValidPixelBlock=function(a){return!!(a&&a.pixels&&0<a.pixels.length&&0!==a.validPixelCount)};b([c.property({types:a.rasterRendererTypes,json:{write:!0}})],g.prototype,"renderer",void 0);b([c.reader("renderer")],g.prototype,"readRenderer",null);b([c.property({type:d,json:{write:!0}})],g.prototype,"rasterInfo",
void 0);b([c.property({json:{write:!0}})],g.prototype,"lookup",void 0);b([c.property({})],g.prototype,"canRenderInWebGL",void 0);return g=b([c.subclass("esri.renderers.support.RasterSymbolizer")],g)}(c.declared(e.JSONSupport))})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(D,v,u){function h(a,b){a=Math.min(Math.max(a,-100),100);b=Math.min(Math.max(b,-100),100);var e,c,d=new Uint8Array(256);for(e=0;256>e;e++)0<a&&100>a?c=(200*e-
25500+510*b)/(2*(100-a))+128:0>=a&&-100<a?c=(200*e-25500+510*b)*(100+a)/2E4+128:100===a?(c=200*e-25500+256*(100-a)+510*b,c=0<c?255:0):-100===a&&(c=128),d[e]=255<c?255:0>c?0:c;return d}function b(a,b,g,c,d,k,h,f){return{xmin:d<=g*a?0:d<g*a+a?d-g*a:a,ymin:k<=c*b?0:k<c*b+b?k-c*b:b,xmax:d+h<=g*a?0:d+h<g*a+a?d+h-g*a:a,ymax:k+f<=c*b?0:k+f<c*b+b?k+f-c*b:b}}function q(a,e,g,c){var d=a.filter(function(a){return l(a)})[0];if(null==d)return null;var k=c?c.width:e.width;c=c?c.height:e.height;var h=d.width,f=
d.height,p=e.width/h;e=e.height/f;var r=g?g.x:0;g=g?g.y:0;var m=d.pixelType,n=u.getPixelArrayConstructor(m),q=d.pixels.length,d=[],A,v,w,x,y,z,C,E,H,G;for(y=0;y<q;y++){v=new n(k*c);for(z=0;z<e;z++)for(C=0;C<p;C++)if(w=a[z*p+C])for(A=w.pixels[y],G=b(h,f,C,z,r,g,k,c),E=G.ymin;E<G.ymax;E++)for(w=(z*f+E-g)*k+(C*h-r),x=E*h,H=G.xmin;H<G.xmax;H++)v[w+H]=A[x+H];d.push(v)}var L;if(a.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(L=new Uint8Array(k*c),z=0;z<e;z++)for(C=0;C<p;C++)if(n=(w=a[z*
p+C])?w.mask:null,G=b(h,f,C,z,r,g,k,c),n)for(E=G.ymin;E<G.ymax;E++)for(w=(z*f+E-g)*k+(C*h-r),x=E*h,H=G.xmin;H<G.xmax;H++)L[w+H]=n[x+H];else if(w)for(E=G.ymin;E<G.ymax;E++)for(w=(z*f+E-g)*k+(C*h-r),x=E*h,H=G.xmin;H<G.xmax;H++)L[w+H]=1;else for(E=G.ymin;E<G.ymax;E++)for(w=(z*f+E-g)*k+(C*h-r),x=E*h,H=G.xmin;H<G.xmax;H++)L[w+H]=0;a=new u({width:k,height:c,pixels:d,pixelType:m,mask:L});a.updateStatistics();return a}Object.defineProperty(v,"__esModule",{value:!0});var l=function(a){return a&&"esri.layers.support.PixelBlock"===
a.declaredClass&&a.pixels&&0<a.pixels.length};v.extractBands=function(a,b){if(!b||!l(a))return a;var e=a.pixels.length;return b&&b.some(function(a){return a>=e})||1===e&&1===b.length&&0===b[0]||e===b.length&&!b.some(function(a,b){return a!==b})?a:new u({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:b.map(function(b){return a.pixels[b]}),statistics:a.statistics&&b.map(function(b){return a.statistics[b]})})};v.createColormapLUT=
function(a){if(a){var b=a.colormap;if(b&&0!==b.length){var b=b.sort(function(a,b){return a[0]-b[0]}),g=0;0>b[0][0]&&(g=b[0][0]);var c=Math.max(256,b[b.length-1][0]-g+1),d=new Uint8Array(4*c),h=[],l=0,f=0,p=5===b[0].length;if(65536<c)return b.forEach(function(a){h[a[0]-g]=p?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:h,offset:g,alphaSpecified:p};if(a.fillUnspecified)for(a=b[f],l=a[0]-g;l<c;l++)d[4*l]=a[1],d[4*l+1]=a[2],d[4*l+2]=a[3],d[4*l+3]=p?a[4]:255,l===a[0]-g&&(a=f===b.length-1?a:
b[++f]);else for(l=0;l<b.length;l++)a=b[l],f=4*(a[0]-g),d[f]=a[1],d[f+1]=a[2],d[f+2]=a[3],d[f+3]=p?a[4]:255;return{indexedColormap:d,offset:g,alphaSpecified:p}}}};v.colorize=function(a,b){if(!l(a)||!b&&(b.indexedColormap||b.indexed2DColormap))return a;var e=a.clone(),c=e.pixels,d=e.mask,h=e.width*e.height;if(1!==c.length)return a;var t=b.indexedColormap;a=b.indexed2DColormap;var f=b.offset;b=b.alphaSpecified;var p=t.length-1,r=0,c=c[0],m=new Uint8Array(c.length),n=new Uint8Array(c.length),q=new Uint8Array(c.length),
u=0;if(t)if(d)for(r=0;r<h;r++)d[r]&&(u=4*(c[r]-f),u<f||u>p?d[r]=0:(m[r]=t[u],n[r]=t[u+1],q[r]=t[u+2],d[r]=t[u+3]));else{d=new Uint8Array(h);for(r=0;r<h;r++)u=4*(c[r]-f),u<f||u>p?d[r]=0:(m[r]=t[u],n[r]=t[u+1],q[r]=t[u+2],d[r]=t[u+3]);e.mask=d}else if(d)for(r=0;r<h;r++)d[r]&&(t=a[c[r]],m[r]=t[0],n[r]=t[1],q[r]=t[2],d[r]=t[3]);else{d=new Uint8Array(h);for(r=0;r<h;r++)t=a[c[r]],m[r]=t[0],n[r]=t[1],q[r]=t[2],d[r]=t[3];e.mask=d}e.pixels=[m,n,q];e.statistics=null;e.pixelType="u8";e.maskIsAlpha=b;return e};
v.estimateStatisticsHistograms=function(a){if(!l(a))return null;a.statistics||a.updateStatistics();var b=a.pixels,g=a.mask,c=a.pixelType,d=a.statistics;a=a.width*a.height;var h=b.length,t,f,p,r,m,n=[],q=[],u,v,w;for(r=0;r<h;r++){u=new Uint32Array(256);w=b[r];if("u8"===c)if(t=-.5,f=255.5,g)for(m=0;m<a;m++)g[m]&&u[w[m]]++;else for(m=0;m<a;m++)u[w[m]]++;else{t=d[r].minValue;f=d[r].maxValue;p=(f-t)/256;v=new Uint32Array(257);if(g)for(m=0;m<a;m++)g[m]&&v[Math.floor((w[m]-t)/p)]++;else for(m=0;m<a;m++)v[Math.floor((w[m]-
t)/p)]++;for(m=0;255>m;m++)u[m]=v[m];u[255]=v[255]+v[256]}n.push({min:t,max:f,size:256,counts:u});for(m=w=v=p=0;256>m;m++)p+=u[m],v+=m*u[m];v/=p;for(m=0;256>m;m++)w+=u[m]*Math.pow(m-v,2);u=Math.sqrt(w/(p-1));p=(f-t)/256;m=(v+.5)*p+t;u*=p;q.push({min:t,max:f,avg:m,stddev:u})}return{statistics:q,histograms:n}};v.createStretchLUT=function(a){var b=a.minCutOff,g=a.maxCutOff,c=a.gamma,d=a.pixelType,k=a.outMin||0,l=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(d))return null;var f=b.length,p,r=
0;"s8"===d?r=-127:"s16"===d&&(r=-32767);var m=256;-1<["u16","s16"].indexOf(d)&&(m=65536);for(var n=[],q=l-k,d=0;d<f;d++)n[d]=g[d]-b[d];p=c&&c.length>=f;var u=[];if(p)for(d=0;d<f;d++)u[d]=1<c[d]?2<c[d]?6.5+Math.pow(c[d]-2,2.5):6.5+100*Math.pow(2-c[d],4):1;var v,w=[],x,y,z;if(p)for(d=0;d<f;d++){z=[];for(p=0;p<m;p++)x=p+r,v=(x-b[d])/n[d],y=1,1<c[d]&&(y-=Math.pow(1/q,v*u[d])),z[p]=x<g[d]&&x>b[d]?Math.floor(y*q*Math.pow(v,1/c[d]))+k:x>=g[d]?l:k;w[d]=z}else for(d=0;d<f;d++){z=[];for(p=0;p<m;p++)x=p+r,z[p]=
x<=b[d]?k:x>=g[d]?l:Math.floor((x-b[d])/n[d]*q)+k;w[d]=z}if(null!=a.contrastOffset)for(a=h(a.contrastOffset,a.brightnessOffset),d=0;d<f;d++)for(z=w[d],p=0;p<m;p++)z[p]=a[z[p]];return{lut:w,offset:r}};v.createContrastBrightnessLUT=h;v.stretch=function(a,b){if(!l(a))return null;a=a.clone();var e=a.pixels,c=a.mask,d=b.minCutOff,h=b.maxCutOff,t=b.gamma,f=b.outMin||0;b=b.outMax||255;var p=a.width*a.height,r=e.length,m,n,q,u,v,w=b-f,x=[];for(m=0;m<r;m++)x[m]=h[m]-d[m];n=t&&t.length>=r;var y=[];if(n)for(m=
0;m<r;m++)y[m]=1<t[m]?2<t[m]?6.5+Math.pow(t[m]-2,2.5):6.5+100*Math.pow(2-t[m],4):1;if(n)if(null!=c)for(n=0;n<p;n++){if(c[n])for(m=0;m<r;m++)q=e[m][n],v=(q-d[m])/x[m],u=1,1<t[m]&&(u-=Math.pow(1/w,v*y[m])),e[m][n]=q<h[m]&&q>d[m]?Math.floor(u*w*Math.pow(v,1/t[m]))+f:q>=h[m]?b:f}else for(n=0;n<p;n++)for(m=0;m<r;m++)q=e[m][n],v=(q-d[m])/x[m],u=1,1<t[m]&&(u-=Math.pow(1/w,v*y[m])),e[m][n]=q<h[m]&&q>d[m]?Math.floor(u*w*Math.pow(v,1/t[m]))+f:q>=h[m]?b:f;else if(null!=c)for(n=0;n<p;n++){if(c[n])for(m=0;m<r;m++)q=
e[m][n],e[m][n]=q<h[m]&&q>d[m]?Math.floor((q-d[m])/x[m]*w)+f:q>=h[m]?b:f}else for(n=0;n<p;n++)for(m=0;m<r;m++)q=e[m][n],e[m][n]=q<h[m]&&q>d[m]?Math.floor((q-d[m])/x[m]*w)+f:q>=h[m]?b:f;a.pixelType="u8";a.updateStatistics();return a};v.lookupPixels=function(a,b){if(!l(a))return null;var e=a.pixels,c=a.mask,d=a.width*a.height,h=e.length,t=b.lut;b=b.offset;var f,p;t&&1===t[0].length&&(t=e.map(function(){return t}));var r=[],m,n,q;if(b)if(null==c)for(f=0;f<h;f++){m=e[f];n=t[f];q=new Uint8Array(d);for(p=
0;p<d;p++)q[p]=n[m[p]-b];r.push(q)}else for(f=0;f<h;f++){m=e[f];n=t[f];q=new Uint8Array(d);for(p=0;p<d;p++)c[p]&&(q[p]=n[m[p]-b]);r.push(q)}else if(null==c)for(f=0;f<h;f++){m=e[f];n=t[f];q=new Uint8Array(d);for(p=0;p<d;p++)q[p]=n[m[p]];r.push(q)}else for(f=0;f<h;f++){m=e[f];n=t[f];q=new Uint8Array(d);for(p=0;p<d;p++)c[p]&&(q[p]=n[m[p]]);r.push(q)}a=new u({width:a.width,height:a.height,pixels:r,mask:c,pixelType:"u8"});a.updateStatistics();return a};v.remapColor=function(a,b){if(!l(a))return null;a=
a.clone();var e=a.width*a.height,c=b.length,d=Math.floor(c/2),h=b[Math.floor(d)],t=a.pixels[0],f,p,q,m,n,u,v=!1,F=new Uint8Array(e),w=new Uint8Array(e),x=new Uint8Array(e),y=a.mask,z=4===b[0].mappedColor.length;y||(y=new Uint8Array(e),y.fill(z?255:1),a.mask=y);for(n=0;n<e;n++)if(y[n]){f=t[n];v=!1;u=d;p=h;q=0;for(m=c-1;1<m-q;){if(f===p.value){v=!0;break}f>p.value?q=u:m=u;u=Math.floor((q+m)/2);p=b[Math.floor(u)]}v||(f===b[q].value?(p=b[q],v=!0):f===b[m].value?(p=b[m],v=!0):f<b[q].value?(v=!1,p=null):
f>b[q].value&&(f<b[m].value?(p=b[q],v=!0):m===c-1?(v=!1,p=null):(p=b[m],v=!0)));v?(F[n]=p.mappedColor[0],w[n]=p.mappedColor[1],x[n]=p.mappedColor[2],y[n]=p.mappedColor[3]):F[n]=w[n]=x[n]=y[n]=0}a.pixels=[F,w,x];a.mask=y;a.pixelType="u8";a.maskIsAlpha=z;return a};v.getClipBounds=b;v.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var e=a.filter(function(a){return a.pixelBlock})[0];if(!e)return null;var c=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,d=(e.extent.ymax-e.extent.ymin)/
e.pixelBlock.height,h=.01*Math.min(c,d),l=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>h?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>h?a.extent.xmin-b.extent.xmin:0}),f=Math.min.apply(null,l.map(function(a){return a.extent.xmin})),p=Math.min.apply(null,l.map(function(a){return a.extent.ymin})),r=Math.max.apply(null,l.map(function(a){return a.extent.xmax})),m=Math.max.apply(null,l.map(function(a){return a.extent.ymax}));a={x:Math.round((b.xmin-f)/c),y:Math.round((m-
b.ymax)/d)};f={width:Math.round((r-f)/c),height:Math.round((m-p)/d)};c={width:Math.round((b.xmax-b.xmin)/c),height:Math.round((b.ymax-b.ymin)/d)};if(Math.round(f.width/e.pixelBlock.width)*Math.round(f.height/e.pixelBlock.height)!==l.length||0>a.x||0>a.y||f.width<c.width||f.height<c.height)return null;e=l.map(function(a){return a.pixelBlock});e=q(e,f,a,c);return{extent:b,pixelBlock:e}};v.mosaic=q;v.setValidBoundary=function(a,b,g){if(!l(a))return null;var c=a.width,d=a.height,e=b.x;b=b.y;var h=g.width+
e;g=g.height+b;if(0>e||0>b||h>c||g>d||0===e&&0===b&&h===c&&g===d)return a;a.mask||(a.mask=new Uint8Array(c*d));for(var f=a.mask,p=0;p<d;p++)for(var q=p*c,m=0;m<c;m++)f[q+m]=p<b||p>=g||m<e||m>=h?0:1;a.updateStatistics();return a};v.clip=function(a,b,g){if(!l(a))return null;var c=b.x,d=b.y,e=b.x+g.width;b=b.x+g.height;if(b===a.height&&e===a.width)return a;for(var h=a.pixels,f=a.mask,p=a.width,q=p*a.height,m=h.length,n=[],v=0;v<m;v++){for(var A=h[v],F=u.createEmptyBand(a.pixelType,q),w=0,x=d;x<=b;x++)for(var y=
x*p,z=c;z<=e;z++)F[w++]=A[y+z];n.push(F)}var C;if(f)for(C=new Uint8Array(g.width*g.height),w=0,x=d;x<=b;x++)for(y=x*p,z=c;z<=e;z++)C[w++]=f[y+z];a=new u({width:g.width,height:g.height,pixels:n,mask:C});a.updateStatistics();return a};v.approximateTransform=function(a,b,g,c){if(!l(a))return null;var d=a.pixels,e=a.mask,h=a.pixelType,f=a.width,p=a.height;a=u.getPixelArrayConstructor(h);var q=d.length,m=b.width,n=b.height;b=c.cols;var v=c.rows,A=Math.ceil(m/b),F=Math.ceil(n/v),w=!1;for(c=0;c<g.length;c+=
3)-1===g[c]&&-1===g[c+1]&&-1===g[c+2]&&(w=!0);var x,y,z,C,E,H,G,L=new Float32Array(m*n),D=new Float32Array(m*n),Q=0,J,K;for(c=0;c<F;c++)for(var R=0;R<A;R++){x=12*(c*A+R);y=g[x];z=g[x+1];C=g[x+2];E=g[x+3];H=g[x+4];G=g[x+5];for(var P=0;P<v;P++){Q=(c*v+P)*m+R*b;K=(P+.5)/v;for(var S=0;S<P;S++)J=(S+.5)/b,L[Q+S]=Math.round((y*J+z*K+C)*f-.5),D[Q+S]=Math.round((E*J+H*K+G)*p-.5)}x+=6;y=g[x];z=g[x+1];C=g[x+2];E=g[x+3];H=g[x+4];G=g[x+5];for(P=0;P<v;P++)for(Q=(c*v+P)*m+R*b,K=(P+.5)/v,S=P;S<b;S++)J=(S+.5)/b,L[Q+
S]=Math.round((y*J+z*K+C)*f-.5),D[Q+S]=Math.round((E*J+H*K+G)*p-.5)}g=function(a,b){for(var c=0;c<n;c++){x=c*m;for(var d=0;d<m;d++)a[x]=w&&(0>L[x]||0>D[x])?0:b[L[x]+D[x]*f],x++}};p=[];for(c=0;c<q;c++)b=new a(m*n),g(b,d[c]),p.push(b);d=new u({width:m,height:n,pixelType:h,pixels:p});if(e)d.mask=new Uint8Array(m*n),g(d.mask,e);else if(w)for(d.mask=new Uint8Array(m*n),c=0;c<m*n;c++)d.mask[c]=0>L[c]||0>D[c]?0:1;d.updateStatistics();return d}})},"esri/layers/support/rasterFunctions/surfaceUtils":function(){define(["require",
"exports","../PixelBlock"],function(D,v,u){function h(b){var h=b.altitude,l=b.azimuth,a=b.hillshadeType,e=b.pixelSizePower,g=b.pixelSizeFactor,c=b.scalingType,d=b.isGCS,k=b.resolution,t="multi-directional"===a?2*b.zFactor:b.zFactor,f=k.x,p=k.y;b=t/(8*f);var r=t/(8*p);d&&.001<t&&(b/=111E3,r/=111E3);"adjusted"===c&&(d?(b=111E3*f,r=111E3*p,b=(t+Math.pow(b,e)*g)/(8*b),r=(t+Math.pow(r,e)*g)/(8*r)):(b=(t+Math.pow(f,e)*g)/(8*f),r=(t+Math.pow(p,e)*g)/(8*p)));var m=(90-h)*Math.PI/180,h=Math.cos(m),n=(360-
l+90)*Math.PI/180,l=Math.sin(m)*Math.cos(n),m=Math.sin(m)*Math.sin(n),e=[315,270,225,360,180,0],g=[60,60,60,60,60,90],t=[3,5,3,2,1,4],u=t.reduce(function(a,b){return a+b}),t=t.map(function(a){return a/u}),c=[],d=[],p=[],f="multi-directional"===a?e.length:1;if("multi-directional"===a)for(var v=0;v<f;v++)h=g[v],l=e[v],m=(90-h)*Math.PI/180,h=Math.cos(m),n=(360-l+90)*Math.PI/180,l=Math.sin(m)*Math.cos(n),m=Math.sin(m)*Math.sin(n),c.push(h),d.push(l),p.push(m);return{resolution:k,factor:[b,r],sinZcosA:l,
sinZsinA:m,cosZ:h,sinZcosAs:d,sinZsinAs:p,cosZs:c,weights:t,hillshadeType:["traditional","multi-directional"].indexOf(a)}}Object.defineProperty(v,"__esModule",{value:!0});v.calculateHillshadeParams=h;v.hillshade=function(b,q){if(!(b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length))return b;var l=b.width,a=b.height,e=b.mask,g=new Uint8Array(l*a);e&&g.set(e);var c=h(q),d=c.factor,k=c.sinZcosA,t=c.sinZsinA,f=c.cosZ,p=c.sinZcosAs,r=c.sinZsinAs,m=c.cosZs,c=c.weights,n=
d[0],d=d[1];q=q.hillshadeType;for(var v=b.pixels[0],A=new Uint8Array(l*a),F,w,x,y,z,C,E,H,G=1;G<a-1;G++)for(var D=G*l,I=1;I<l-1;I++)if(e&&!e[D+I])A[D+I]=0;else{y=0;if(e&&(y=e[D-l+I-1]+e[D-l+I]+e[D-l+I+1]+e[D+I-1]+e[D+I+1]+e[D+l+I-1]+e[D+l+I]+e[D+l+I+1],7>y)){A[D+I]=0;g[D+I]=0;continue}7===y?(F=e[D-l+I-1]?v[D-l+I-1]:v[D+I],w=e[D-l+I]?v[D-l+I]:v[D+I],x=e[D-l+I+1]?v[D-l+I+1]:v[D+I],y=e[D+I-1]?v[D+I-1]:v[D+I],z=e[D+I+1]?v[D+I+1]:v[D+I],C=e[D+l+I-1]?v[D+l+I-1]:v[D+I],E=e[D+l+I]?v[D+l+I]:v[D+I],H=e[D+l+
I+1]?v[D+l+I+1]:v[D+I]):(F=v[D-l+I-1],w=v[D-l+I],x=v[D-l+I+1],y=v[D+I-1],z=v[D+I+1],C=v[D+l+I-1],E=v[D+l+I],H=v[D+l+I+1]);y=(x+z+z+H-(F+y+y+C))*n;F=(C+E+E+H-(F+w+w+x))*d;w=Math.sqrt(1+y*y+F*F);x=0;if("traditional"===q)C=255*(f+t*F-k*y)/w,0>C&&(C=0),x=C;else for(E=r.length,H=0;H<E;H++)C=255*(m[H]+r[H]*F-p[H]*y)/w,0>C&&(C=0),x+=C*c[H];A[D+I]=x}for(G=0;G<a;G++)A[G*l]=A[G*l+1],A[(G+1)*l-1]=A[(G+1)*l-2];for(G=1;G<l-1;G++)A[G]=A[G+l],A[G+(a-1)*l]=A[G+(a-2)*l];return new u({width:l,height:a,pixels:[A],mask:e?
g:null,pixelType:"u8",validPixelCount:b.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}})},"esri/tasks/ImageServiceIdentifyTask":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/maybe ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./support/ImageServiceIdentifyResult".split(" "),function(D,v,u,h,b,q,l,a,e,g,c){return function(d){function g(){return null!==
d&&d.apply(this,arguments)||this}u(g,d);g.prototype.execute=function(a,d){var f=this;return e.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(c){var e=a.toJSON();c=c&&c[0];l.isSome(c)&&(e.geometry=JSON.stringify(c.toJSON()));e=f._encode(b({f:"json"},f.parsedUrl.query,e));e=b({query:e},f.requestOptions,d);return q(f.parsedUrl.path+"/identify",e)}).then(function(a){return c.fromJSON(a.data)})};return g=h([a.subclass("esri.tasks.ImageServiceIdentifyTask")],g)}(a.declared(g))})},"esri/tasks/support/ImageServiceIdentifyResult":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ./FeatureSet".split(" "),
function(D,v,u,h,b,q,l,a){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.catalogItemVisibilities=null;a.catalogItems=null;a.location=null;a.name=null;a.objectId=null;a.processedValues=null;a.properties=null;a.value=null;return a}u(e,b);h([q.property({json:{write:!0}})],e.prototype,"catalogItemVisibilities",void 0);h([q.property({type:a,json:{write:!0}})],e.prototype,"catalogItems",void 0);h([q.property({type:l,json:{write:!0}})],e.prototype,"location",void 0);h([q.property({json:{write:!0}})],
e.prototype,"name",void 0);h([q.property({json:{write:!0}})],e.prototype,"objectId",void 0);h([q.property({json:{write:!0}})],e.prototype,"processedValues",void 0);h([q.property({json:{write:!0}})],e.prototype,"properties",void 0);h([q.property({json:{write:!0}})],e.prototype,"value",void 0);return e=h([q.subclass("esri.tasks.support.ImageServiceIdentifyResult")],e)}(q.declared(b.JSONSupport))})},"esri/tasks/support/ImageServiceIdentifyParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/jsonUtils ../../layers/support/MosaicRule ../../layers/support/RasterFunction".split(" "),
function(D,v,u,h,b,q,l,a,e,g,c,d){return function(k){function l(){var a=null!==k&&k.apply(this,arguments)||this;a.geometry=null;a.renderingRules=null;a.pixelSize=null;a.returnGeometry=!0;a.returnCatalogItems=!0;a.returnPixelValues=!0;a.maxItemCount=null;a.timeExtent=null;a.raster=void 0;a.viewId=void 0;return a}u(l,k);l.prototype.writeGeometry=function(a,b,c){null!=a&&(b.geometryType=g.getJsonType(a),b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(l.prototype,"mosaicRule",{set:function(a){a&&
a.mosaicMethod&&(a=c.fromJSON(b({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});l.prototype.writeMosaicRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(l.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=d.fromJSON(b({},a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,
configurable:!0});l.prototype.writeRenderingRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};l.prototype.writeRenderingRules=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.map(function(a){return a.toJSON()})))};l.prototype.writePixelSize=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};l.prototype.writeTimeExtent=function(a,b,c){if(null!=a){var d=a.start?a.start.getTime():null;a=a.end?a.end.getTime():null;b[c]=null!=d?null!=a?d+","+a:""+d:null}};h([a.property({json:{write:!0}})],
l.prototype,"geometry",void 0);h([a.writer("geometry")],l.prototype,"writeGeometry",null);h([a.property({type:c,json:{write:!0}})],l.prototype,"mosaicRule",null);h([a.writer("mosaicRule")],l.prototype,"writeMosaicRule",null);h([a.property({type:d,json:{write:!0}})],l.prototype,"renderingRule",null);h([a.writer("renderingRule")],l.prototype,"writeRenderingRule",null);h([a.property({type:[d],json:{write:!0}})],l.prototype,"renderingRules",void 0);h([a.writer("renderingRules")],l.prototype,"writeRenderingRules",
null);h([a.property({type:e,json:{write:!0}})],l.prototype,"pixelSize",void 0);h([a.writer("pixelSize")],l.prototype,"writePixelSize",null);h([a.property({type:Boolean,json:{write:!0}})],l.prototype,"returnGeometry",void 0);h([a.property({type:Boolean,json:{write:!0}})],l.prototype,"returnCatalogItems",void 0);h([a.property({type:Boolean,json:{write:!0}})],l.prototype,"returnPixelValues",void 0);h([a.property({type:Number,json:{write:!0}})],l.prototype,"maxItemCount",void 0);h([a.property({type:q,
json:{write:{target:"time"}}})],l.prototype,"timeExtent",void 0);h([a.writer("timeExtent")],l.prototype,"writeTimeExtent",null);h([a.property({json:{write:!0}})],l.prototype,"raster",void 0);h([a.property({json:{write:!0}})],l.prototype,"viewId",void 0);return l=h([a.subclass("esri.tasks.support.ImageServiceIdentifyParameters")],l)}(a.declared(l.JSONSupport))})},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISImageService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ../support/popupUtils".split(" "),function(D,
v,u,h,b,q,l,a,e,g,c,d,k,t,f,p,r,m,n,B,A,F){return function(f){function g(a,b){a=f.call(this,a)||this;a.legendEnabled=!0;a.isReference=null;a.operationalLayerType="ArcGISImageServiceLayer";a.popupEnabled=!0;a.popupTemplate=null;a.type="imagery";return a}u(g,f);g.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?b({url:a},c):a};g.prototype.load=function(a){var b=this,d=e.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._fetchService(d)},
function(){return b._fetchService(d)}));return c.resolve(this)};Object.defineProperty(g.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});g.prototype.createPopupTemplate=function(a){var b=this.rasterFields,c=this.title,d=new Set,e=!1,f=!1;this.capabilities&&(f=(e=this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})||this.fields&&0<this.fields.length)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType));var g=new Set;e&&(g.add("raster.itempixelvalue"),f&&g.add("raster.magnitude").add("raster.direction"));for(e=0;e<b.length;e++){var f=b[e],h=f.name.toLowerCase();g.has(h)||-1<h.indexOf("raster.servicepixelvalue.")||d.add(f.name)}return F.createPopupTemplate({fields:b,title:c,visibleFieldNames:d},a)};g.prototype.redraw=function(){this.emit("redraw")};h([d.property(A.legendEnabled)],g.prototype,"legendEnabled",void 0);h([d.property({type:["show",
"hide"]})],g.prototype,"listMode",void 0);h([d.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],g.prototype,"isReference",void 0);h([d.property({type:["ArcGISImageServiceLayer"]})],g.prototype,"operationalLayerType",void 0);h([d.property(A.popupEnabled)],g.prototype,"popupEnabled",void 0);h([d.property({type:a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],g.prototype,"popupTemplate",void 0);h([d.property({readOnly:!0,dependsOn:["fields",
"title"]})],g.prototype,"defaultPopupTemplate",null);h([d.property({readOnly:!0,json:{read:!1}})],g.prototype,"type",void 0);return g=h([d.subclass("esri.layers.ImageryLayer")],g)}(d.declared(B.TemporalLayer(m.RefreshableLayer(n.ScaleRangeLayer(p.OperationalLayer(r.PortalLayer(t.ArcGISImageService(f.ArcGISService(g.MultiOriginJSONMixin(k))))))))))});