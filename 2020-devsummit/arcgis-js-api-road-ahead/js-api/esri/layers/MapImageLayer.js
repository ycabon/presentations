// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(u,l,k){function a(b,a){a=k.getMetersPerUnitForSR(a);return b/(a*k.inchesPerMeter*96)}Object.defineProperty(l,"__esModule",{value:!0});l.getScale=function(a,f){f=f||a.extent;a=a.width;var b=k.getMetersPerUnitForSR(f&&f.spatialReference);return f&&a?f.width/a*b*k.inchesPerMeter*96:0};l.getResolutionForScale=a;l.getScaleForResolution=function(a,f){f=k.getMetersPerUnitForSR(f);return a*
f*k.inchesPerMeter*96};l.getExtentForScale=function(b,f){var d=b.extent;b=b.width;f=a(f,d.spatialReference);return d.clone().expand(f*b/d.width)}})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(u,l,k,a,b,f,d,t,q,p,n,B,g,m){Object.defineProperty(l,"__esModule",{value:!0});l.ArcGISMapService=function(d){return function(h){function d(){var a=null!==h&&h.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}k(d,h);d.prototype.readCapabilities=function(a,b){var d=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!d)return{operations:{supportsQuery:!1,
supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var m=-1!==d.indexOf("query"),y=-1!==d.indexOf("map"),e=!!b.exportTilesAllowed,d=-1!==d.indexOf("tilemap"),h="tile"!==a&&!!b.supportsDynamicLayers,E="tile"!==a&&(!b.tileInfo||h),f="tile"!==a&&(!b.tileInfo||h);return{operations:{supportsQuery:m,supportsExportMap:y,supportsExportTiles:e,supportsTileMap:d},exportMap:y?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:h,supportsSublayerVisibility:E,
supportsSublayerDefinitionExpression:f}:null,exportTiles:e?{maxExportTilesCount:+b.maxExportTilesCount}:null}};d.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};d.prototype.fetchSublayerInfo=function(a,d){return f(this,void 0,void 0,function(){return b(this,function(b){switch(b.label){case 0:return[4,this.fetchAllLayersAndTables(d)];case 1:return b.sent(),
[2,this._allLayersAndTablesMap.get(a)]}})})};d.prototype.fetchAllLayersAndTables=function(a){return f(this,void 0,void 0,function(){var d,m=this;return b(this,function(b){switch(b.label){case 0:return[4,this.load(a)];case 1:return b.sent(),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=t(p.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json"}}).then(function(a){m._allLayersAndTablesMap=new Map;for(var e=0,b=a.data.layers;e<b.length;e++){var d=b[e];m._allLayersAndTablesMap.set(d.id,
d)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:d=b.sent();q.throwIfAborted(a);if("result"in d)return[2,d.result];throw d.error;}})})};a([n.property({readOnly:!0})],d.prototype,"capabilities",void 0);a([n.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],d.prototype,"readCapabilities",null);a([n.property({json:{read:{source:"copyrightText"}}})],d.prototype,"copyright",
void 0);a([n.property({type:B})],d.prototype,"fullExtent",void 0);a([n.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],d.prototype,"id",void 0);a([n.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],d.prototype,"legendEnabled",void 0);a([n.property(m.popupEnabled)],d.prototype,"popupEnabled",void 0);a([n.property({type:g})],d.prototype,"spatialReference",void 0);a([n.property()],d.prototype,"version",
void 0);a([n.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],d.prototype,"readVersion",null);return d=a([n.subclass("esri.layers.mixins.ArcGISMapService")],d)}(n.declared(d))}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../support/Sublayer ../support/sublayerUtils".split(" "),
function(u,l,k,a,b,f,d,t,q,p,n,B,g,m){function x(a,b){var d=[],m={};if(!a)return d;a.forEach(function(a){var e=new g;e.read(a,b);m[e.id]=e;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=m[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(e)):d.unshift(e)});return d}function h(a,b){a&&a.forEach(function(a){b(a);a.sublayers&&a.sublayers.length&&h(a.sublayers,b)})}Object.defineProperty(l,"__esModule",{value:!0});var z=q.getLogger("esri.layers.TileLayer"),A=f.ofType(g);l.forEachSublayer=
h;l.SublayersOwner=function(l){return function(l){function k(){for(var a,b=[],m=0;m<arguments.length;m++)b[m]=arguments[m];var h=l.apply(this,b)||this;h.allSublayers=new d({root:h,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});h.sublayersSourceJSON=(a={},a[2]={},a[3]={},a[4]={},a[5]={},a);h.watch("sublayers",function(a,b){return h._handleSublayersChange(a,b)},!0);return h}a(k,l);k.prototype.readSublayers=function(a,b){if(b&&a){var d=this.sublayersSourceJSON,
e=n.nameToId(b.origin);2>e||(d[e]={context:b,visibleLayers:a.visibleLayers||d[e].visibleLayers,layers:a.layers||d[e].layers},2<e||(this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers),b=this.createSublayersForOrigin("web-document"),a=b.sublayers,b=b.origin,d=B.getProperties(this),d.setDefaultOrigin(b),this._set("sublayers",new A(a)),d.setDefaultOrigin("user")))}};k.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===a})};k.prototype.createServiceSublayers=
function(){return this.createSublayersForOrigin("service").sublayers};k.prototype.createSublayersForOrigin=function(a){var b="web-document"===a?n.nameToId("web-map"):n.nameToId(a),d=2;a=this.sublayersSourceJSON[2].layers;for(var f=this.sublayersSourceJSON[2].context,k=null,g=0,t=[3,4,5].filter(function(a){return a<=b});g<t.length;g++){var l=t[g],q=this.sublayersSourceJSON[l];m.isSublayerOverhaul(q.layers)&&(d=l,a=q.layers,f=q.context,q.visibleLayers&&(k={visibleLayers:q.visibleLayers,context:q.context}))}for(var p=
null,g=0,t=[3,4,5].filter(function(a){return a>d&&a<=b});g<t.length;g++){var r=this.sublayersSourceJSON[t[g]],l=r.layers,q=r.visibleLayers,r=r.context;l&&(p={layers:l,context:r});q&&(k={visibleLayers:q,context:r})}a=x(a,f);var y=new Map,I=new Set;if(p)for(f=0,g=p.layers;f<g.length;f++)t=g[f],y.set(t.id,t);if(k)for(f=0,g=k.visibleLayers;f<g.length;f++)I.add(g[f]);h(a,function(a){p&&a.read(y.get(a.id),p.context);k&&a.read({defaultVisibility:I.has(a.id)},k.context)});return{origin:n.idToName(d),sublayers:new A({items:a})}};
k.prototype.read=function(a,b){this.inherited(arguments);this.readSublayers(a,b)};k.prototype._handleSublayersChange=function(a,b){var d=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(function(a){a.parent=d;a.layer=d}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=d;a.layer=d}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(a.on("before-changes",
function(a){z.error(new t("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:d}));a.preventDefault()}),"sublayers-owner"))};b([p.property({readOnly:!0})],k.prototype,"allSublayers",void 0);b([p.property({readOnly:!0,type:f.ofType(g)})],k.prototype,"serviceSublayers",void 0);b([p.property({value:null,type:A,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],k.prototype,"sublayers",void 0);b([p.property({readOnly:!0})],k.prototype,
"sublayersSourceJSON",void 0);return k=b([p.subclass("esri.layers.mixins.SublayersOwner")],k)}(p.declared(l))}})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../geometry ../../PopupTemplate ../../renderers ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../support/popupUtils ../../tasks/support/Query".split(" "),
function(u,l,k,a,b,f,d,t,q,p,n,B,g,m,x,h,z,A,L,N,D,y,e,G,E,H,M,O,P,Q,R,r,U,I,T){function S(a){return a&&"esriSMS"===a.type}function w(a,c,b){return{ignoreOrigin:!0,enabled:b&&b.writeSublayerStructure||!1}}function F(a,c,b){return{ignoreOrigin:!0,enabled:b?b.writeSublayerStructure||this.originIdOf(c)>=E.nameToId(b.origin):!1}}var J=L.getLogger("esri.layers.support.Sublayer"),V=0,C=new Set;C.add("layer");C.add("parent");C.add("loaded");C.add("loadStatus");C.add("loadError");C.add("loadWarnings");return function(b){function c(a){a=
b.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}k(c,b);h=c;c.prototype.load=function(a){return d(this,void 0,void 0,function(){var v=this;return f(this,function(b){this.addResolvingPromise(function(){return d(v,void 0,void 0,function(){var v,b,c;return f(this,function(K){switch(K.label){case 0:if(!this.layer)throw new x("sublayer:missing-layer",
"Sublayer can't be loaded without being part of a layer",{sublayer:this});v=null;return 2<this.originIdOf("url")||r.isDataLayerSource(this.source)?[4,B(this.url,t({responseType:"json",query:{f:"json"}},a))]:[3,2];case 1:return b=K.sent(),v=b.data,[3,4];case 2:return c=this.id,this.source&&null!=this.source.mapLayerId&&(c=this.source.mapLayerId),[4,this.layer.fetchSublayerInfo(c,a)];case 3:v=K.sent(),K.label=4;case 4:return v&&(this.sourceJSON=v,this.read({layerDefinition:v},{origin:"service"})),[2]}})})}());
return[2,this]})})};c.prototype.readCapabilities=function(a,b){return{exportMap:{supportsModification:!!b.layerDefinition.canModifyLayer}}};Object.defineProperty(c.prototype,"definitionExpression",{set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fieldsIndex",{get:function(){return new P(this.fields||[])},enumerable:!0,configurable:!0});c.prototype.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;
if(b.globalIdField)return b.globalIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var v=b[a];if("esriFieldTypeGlobalID"===v.type)return v.name}};Object.defineProperty(c.prototype,"id",{get:function(){var a=this._get("id");return null==a?V++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"labelingInfo",{set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});c.prototype.writeLabelingInfo=function(a,b,c,d){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(c.prototype,"labelsVisible",{set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layer",{set:function(a){this._set("layer",
a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"listMode",{set:function(a){this._set("listMode",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"minScale",{set:function(a){this._setAndNotifyLayer("minScale",a)},enumerable:!0,configurable:!0});c.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};Object.defineProperty(c.prototype,"maxScale",
{set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});c.prototype.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};c.prototype.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}};Object.defineProperty(c.prototype,"opacity",{set:function(a){this._setAndNotifyLayer("opacity",
a)},enumerable:!0,configurable:!0});c.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};c.prototype.writeOpacity=function(a,b,c,d){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};c.prototype.writeParent=function(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1};Object.defineProperty(c.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"renderer",{set:function(a){if(a)for(var b=0,c=a.getSymbols();b<c.length;b++)if(g.isSymbol3D(c[b])){J.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});c.prototype.readRenderer=function(a,b,c){if(a=b.layerDefinition.drawingInfo.renderer||void 0)(a=U.read(a,b,c)||void 0)||J.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:c});
return a};c.prototype.writeRenderer=function(a,b,c,d){b.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};c.prototype.writeWebSceneRenderer=function(a,b,c,d){b.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};Object.defineProperty(c.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,type:r.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});c.prototype.writeSource=function(a,b){b.layerDefinition={source:r.sourceToJSON(a)}};
Object.defineProperty(c.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});c.prototype.castSublayers=function(a){return G.default(m.ofType(h),a)};c.prototype.writeSublayers=function(a,b,c){this.get("sublayers.length")&&(b[c]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};c.prototype.readTypeIdField=function(a,b){b=b.layerDefinition||b;if(a=b.typeIdField)if(b=Q.getField(b.fields,
a))return b.name;return null};Object.defineProperty(c.prototype,"url",{get:function(){var a=this.layer,b=this.source;if(!a)return null;if(r.isMapLayerSource(b))return a.parsedUrl.path+"/"+b.mapLayerId;b={layer:JSON.stringify({source:r.sourceToJSON(this.source)})};return a.parsedUrl.path+"/dynamicLayer?"+y.objectToQuery(b)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{set:function(a){this._setAndNotifyLayer("visible",
a)},enumerable:!0,configurable:!0});c.prototype.writeVisible=function(a,b,c,d){b[c]=this.getAtOrigin("defaultVisibility","service")||a};c.prototype.clone=function(){var a=H.getProperties(this).store,b=new h;H.getProperties(b).store=a.clone(C);return b};c.prototype.createPopupTemplate=function(a){return I.createPopupTemplate(this,a)};c.prototype.createQuery=function(){return new T({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};c.prototype.createFeatureLayer=function(){return d(this,
void 0,void 0,function(){var a,b,c,d,e;return f(this,function(m){switch(m.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];a=this.layer&&this.layer.parsedUrl;b=this.source;c=null;a&&(c=r.isMapLayerSource(b)?a.path+"/"+b.mapLayerId:a.path+"/dynamicLayer");return[4,D.create(function(a){return u(["../FeatureLayer"],a)})];case 1:return d=m.sent(),e=new d({url:c}),this.definitionExpression&&(e.definitionExpression=this.definitionExpression),2<this.originIdOf("labelingInfo")&&(e.labelingInfo=
z.clone(this.labelingInfo)),0<this.originIdOf("labelsVisible")&&(e.labelsVisible=this.labelsVisible),0<this.originIdOf("legendEnabled")&&(e.legendEnabled=this.legendEnabled),0<this.originIdOf("visible")&&(e.visible=this.visible),0<this.originIdOf("minScale")&&(e.minScale=this.minScale),0<this.originIdOf("maxScale")&&(e.maxScale=this.maxScale),0<this.originIdOf("opacity")&&(e.opacity=this.opacity),0<this.originIdOf("popupTemplate")&&(e.popupTemplate=z.clone(this.popupTemplate)),2<this.originIdOf("renderer")&&
(e.renderer=z.clone(this.renderer)),r.isDataLayerSource(this.source)&&(e.dynamicDataSource=z.clone(this.source)),0<this.originIdOf("title")&&(e.title=this.title),[2,e]}})})};c.prototype.getFeatureType=function(a){var b=this.typeIdField;if(!b||!a)return null;var c=a.attributes?a.attributes[b]:void 0;if(null==c)return null;var d=null;this.types.some(function(a){var b=a.id;if(null==b)return!1;b.toString()===c.toString()&&(d=a);return!!d});return d};c.prototype.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&
b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};c.prototype.queryFeatures=function(a,b){var c=this;void 0===a&&(a=this.createQuery());return D.all([D.create(function(a){return u(["../../tasks/operations/query"],a)}),D.create(function(a){return u(["../../tasks/support/FeatureSet"],a)})]).then(function(d){var e=d[0].executeQuery,m=d[1];return e(c.url,T.from(a),c.layer.spatialReference,b).then(function(a){return m.fromJSON(a.data)})}).then(function(a){a&&a.features&&
a.features.forEach(function(a){a.sourceLayer=c});return a})};c.prototype.toExportImageJSON=function(){var a=this,b={id:this.id,source:r.sourceToJSON(this.source)};this.definitionExpression&&(b.definitionExpression=this.definitionExpression);var c=["renderer","labelingInfo","opacity","labelsVisible"].reduce(function(b,c){b[c]=a.originIdOf(c);return b},{});if(Object.keys(c).some(function(a){return 2<=c[a]})){var d=b.drawingInfo={};2<=c.renderer&&(d.renderer=this.renderer?this.renderer.toJSON():null);
2<=c.labelsVisible&&(d.showLabels=this.labelsVisible);this.labelsVisible&&2<=c.labelingInfo&&(d.labelingInfo=this.labelingInfo?this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}):null,d.showLabels=!0);2<=c.opacity&&(d.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(d.renderer)}return b};c.prototype._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,function(a){a.color||"esriSMSX"!==a.style&&"esriSMSCross"!==a.style||(a.color=a.outline&&
a.outline.color?a.outline.color:[0,0,0,0])})};c.prototype._forEachSimpleMarkerSymbols=function(a,b){if(a){var c=0,d="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(;c<d.length;c++){var e=d[c];S(e.symbol)&&b(e.symbol)}"symbol"in a&&S(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&S(a.defaultSymbol)&&b(a.defaultSymbol)}};c.prototype._setAndNotifyLayer=function(a,b){var c=this.layer,d=this._get(a),e,m;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";
case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers",m="supportsModification"}e&&!1===this.get("layer.capabilities.exportMap."+e)?this._logLockedError(a,"capability not available 'layer.capabilities.exportMap."+e+"'"):m&&!1===this.get("capabilities.exportMap."+m)?this._logLockedError(a,"capability not available 'capabilities.exportMap."+m+"'"):"source"===a&&
"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),d!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a}))};c.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.removeAll());a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=
a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var b=c.get("layer.capabilities.exportMap.supportsSublayersChanges");null==b||b||(J.error(new x("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:c,layer:c.layer})),a.preventDefault())})]))};c.prototype._logLockedError=function(a,b){J.error(new x("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:b,sublayer:this,
layer:this.layer}))};c.prototype._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};var h;a([e.property({readOnly:!0})],c.prototype,"capabilities",void 0);a([e.reader("service","capabilities",["layerDefinition.canModifyLayer"])],c.prototype,"readCapabilities",null);a([e.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:F}}})],c.prototype,"definitionExpression",null);
a([e.property({type:[O],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],c.prototype,"fields",void 0);a([e.property({readOnly:!0,dependsOn:["fields"]})],c.prototype,"fieldsIndex",null);a([e.property({type:q.Extent,json:{read:{source:"layerDefinition.extent"}}})],c.prototype,"fullExtent",void 0);a([e.property({type:String})],c.prototype,"globalIdField",void 0);a([e.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],c.prototype,"readGlobalIdFieldFromService",
null);a([e.property({type:Number,json:{write:{ignoreOrigin:!0}}})],c.prototype,"id",null);a([e.property({value:null,type:[R],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:w}}})],c.prototype,"labelingInfo",null);a([e.writer("labelingInfo")],c.prototype,"writeLabelingInfo",null);a([e.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",
overridePolicy:w}}})],c.prototype,"labelsVisible",null);a([e.property({value:null})],c.prototype,"layer",null);a([e.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:F}}})],c.prototype,"legendEnabled",void 0);a([e.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],c.prototype,"listMode",null);a([e.property({type:Number,value:0,
json:{write:{enabled:!1,overridePolicy:w}}})],c.prototype,"minScale",null);a([e.reader("minScale",["minScale","layerDefinition.minScale"])],c.prototype,"readMinScale",null);a([e.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:w}}})],c.prototype,"maxScale",null);a([e.reader("maxScale",["maxScale","layerDefinition.maxScale"])],c.prototype,"readMaxScale",null);a([e.property({type:String})],c.prototype,"objectIdField",void 0);a([e.reader("service","objectIdField",["layerDefinition.objectIdField",
"layerDefinition.fields"])],c.prototype,"readObjectIdFieldFromService",null);a([e.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:w}}})],c.prototype,"opacity",null);a([e.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],c.prototype,"readOpacity",null);a([e.writer("opacity")],c.prototype,"writeOpacity",null);a([e.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0,overridePolicy:w}}})],
c.prototype,"parent",void 0);a([e.writer("parent")],c.prototype,"writeParent",null);a([e.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(a,b){return!b.disablePopup}},write:{target:"disablePopup",overridePolicy:F,writer:function(a,b,c){b[c]=!a}}}})],c.prototype,"popupEnabled",void 0);a([e.property({type:p,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:F}}})],c.prototype,"popupTemplate",void 0);a([e.property({readOnly:!0,dependsOn:["fields",
"title"]})],c.prototype,"defaultPopupTemplate",null);a([e.property({types:n.rendererTypes,value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:w}}})],c.prototype,"renderer",null);a([e.reader("renderer",["layerDefinition.drawingInfo.renderer"])],c.prototype,"readRenderer",null);a([e.writer("renderer")],c.prototype,"writeRenderer",null);a([e.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:n.webSceneRendererTypes}})],c.prototype,"writeWebSceneRenderer",
null);a([e.property({cast:r.castSource,json:{read:{source:"layerDefinition.source",reader:r.sourceFromJSON},write:{target:"layerDefinition.source",overridePolicy:w}}})],c.prototype,"source",null);a([e.writer("source")],c.prototype,"writeSource",null);a([e.property()],c.prototype,"sourceJSON",void 0);a([e.property({value:null,json:{type:[G.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:w}}})],c.prototype,"sublayers",null);a([e.cast("sublayers")],c.prototype,"castSublayers",null);
a([e.writer("sublayers")],c.prototype,"writeSublayers",null);a([e.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:F}}})],c.prototype,"title",void 0);a([e.property({type:String})],c.prototype,"typeIdField",void 0);a([e.reader("typeIdField",["layerDefinition.typeIdField"])],c.prototype,"readTypeIdField",null);a([e.property({type:[M],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],c.prototype,"types",void 0);a([e.property({type:String,
dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],c.prototype,"url",null);a([e.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:w}}})],c.prototype,"visible",null);a([e.writer("visible")],c.prototype,"writeVisible",null);return c=h=a([e.subclass("esri.layers.support.Sublayer")],c)}(e.declared(h.HandleOwnerMixin(N.MultiOriginJSONMixin(A))))})},
"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(u,l,k){function a(a,f){if(!a||!a.length)return!0;f=f.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).map(function(a){return a.id}).toArray();if(a.length>f.length)return!1;for(var b=0,k=f.length,l=0;l<a.length;l++){for(var p=a[l].id;b<k&&f[b]!==p;)b++;if(b>=k)return!1}return!0}Object.defineProperty(l,"__esModule",{value:!0});l.shouldWriteSublayerStructure=function(b,
f,d){return f.flatten(function(a){return a.sublayers}).length!==b.length||b.some(function(a){return a.originIdOf("minScale")>d||a.originIdOf("maxScale")>d||a.originIdOf("renderer")>d||a.originIdOf("labelingInfo")>d||a.originIdOf("opacity")>d||a.originIdOf("labelsVisible")>d||a.originIdOf("source")>d})?!0:!a(b,f)};l.isExportDynamic=function(b,f,d){return b.some(function(a){var b=a.source;return!(!b||b.type===k.MAPLAYER&&b.mapLayerId===a.id&&(!b.gdbVersion||b.gdbVersion===d.gdbVersion))||2<a.originIdOf("renderer")||
2<a.originIdOf("labelingInfo")||2<a.originIdOf("opacity")||2<a.originIdOf("labelsVisible")})?!0:!a(b,f)};l.isSublayerOverhaul=function(a){return!!a&&a.some(function(a){return null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale})}})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils ./timeUtils ../../views/View".split(" "),
function(u,l,k,a,b,f,d,t,q,p){Object.defineProperty(l,"__esModule",{value:!0});var n={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};u=function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;a._scale=null;a.view=null;return a}a(g,f);Object.defineProperty(g.prototype,"dynamicLayers",
{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasDynamicLayers",{get:function(){return this.layer&&t.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",
a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(n[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;var a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"visibleSublayers",{get:function(){var a=this,b=[];if(!this.layer)return b;var d=this.layer.sublayers,f=function(d){var k=a.scale,g=
0===d.minScale||k<=d.minScale,h=0===d.maxScale||k>=d.maxScale;d.visible&&(0===k||g&&h)&&(d.sublayers?d.sublayers.forEach(f):b.unshift(d))};d&&d.forEach(f);d=this._get("visibleSublayers");return!d||d.length!==b.length||d.some(function(a,d){return b[d]!==a})?b:d},enumerable:!0,configurable:!0});g.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:
a=k({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};b([d.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],g.prototype,"dynamicLayers",null);b([d.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],g.prototype,"hasDynamicLayers",null);b([d.property()],g.prototype,"layer",null);b([d.property({readOnly:!0,dependsOn:["visibleSublayers"]})],g.prototype,"layers",null);b([d.property({readOnly:!0,dependsOn:["visibleSublayers"]})],
g.prototype,"layerDefs",null);b([d.property({type:Number,dependsOn:["view.scale"]})],g.prototype,"scale",null);b([d.property(q.combinedViewLayerTimeExtentProperty)],g.prototype,"timeExtent",void 0);b([d.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],g.prototype,"version",null);b([d.property({type:p})],g.prototype,"view",void 0);b([d.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],g.prototype,
"visibleSublayers",null);return g=b([d.subclass("esri.layers.mixins.ExportImageParameters")],g)}(d.declared(f));l.ExportImageParameters=u})},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/accessorSupport/PropertyOrigin ../geometry/support/scaleUtils ./Layer ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/Sublayer ./support/sublayerUtils".split(" "),function(u,
l,k,a,b,f,d,t,q,p,n,B,g,m,x,h,z,A,L,N,D,y,e,G,E,H,M,O,P,Q,R,r){return function(e){function f(a,b){a=e.call(this,a)||this;a.alwaysRefetch=!1;a.dpi=96;a.gdbVersion=null;a.imageFormat="png24";a.imageMaxHeight=2048;a.imageMaxWidth=2048;a.imageTransparency=!0;a.labelsVisible=!1;a.isReference=null;a.operationalLayerType="ArcGISMapServiceLayer";a.sourceJSON=null;a.sublayers=null;a.type="map-image";a.url=null;return a}a(f,e);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},
b):a};f.prototype.load=function(a){var b=this,d=g.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},a).then(function(){return b._fetchService(d)}));return x.resolve(this)};f.prototype.readImageFormat=function(a,b){return(a=b.supportedImageFormatTypes)&&-1<a.indexOf("PNG32")?"png32":"png24"};f.prototype.writeSublayers=function(a,b,d,e){if(this.loaded&&a){a=a.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();
d=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){var f=A.nameToId(e.origin);3===f?(d=this.createSublayersForOrigin("service").sublayers,d=r.shouldWriteSublayerStructure(a,d,2)):3<f&&(d=this.createSublayersForOrigin("portal-item"),d=r.shouldWriteSublayerStructure(a,d.sublayers,A.nameToId(d.origin)))}var g=[],h=k({writeSublayerStructure:d},e),l=d;a.forEach(function(a){var b=a.write({},h);g.push(b);l=l||"user"===a.originOf("visible")});
g.some(function(a){return 1<Object.keys(a).length})&&(b.layers=g);l&&(b.visibleLayers=a.filter(function(a){return a.visible}).map(function(a){return a.id}))}};f.prototype.createExportImageParameters=function(a,b,d,e){var f=e&&e.pixelRatio||1;a&&10<=this.version&&(a=a.clone().shiftCentralMeridian());var g=new Q.ExportImageParameters({layer:this,scale:L.getScale({extent:a,width:b})*f}),h=g.toJSON();g.layer=null;g.destroy();var g=!e||!e.rotation||10.3>this.version?{}:{rotation:-e.rotation},l=a&&a.spatialReference,
l=l.wkid||JSON.stringify(l.toJSON());h.dpi*=f;f={};if(e&&e.timeExtent){var c=e.timeExtent.toJSON();e=c.start;c=c.end;if(e&&c&&e===c)f.time=""+e;else if(null!=e||null!=c)f.time=(null==e?"null":e)+","+(null==c?"null":c)}return k({bbox:a&&a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:l,imageSR:l,size:b+","+d},h,g,f)};f.prototype.fetchImage=function(a,b,d,e){var f={responseType:"image"};e&&e.timestamp&&(f.query={_ts:e.timestamp});e&&e.signal&&(f.signal=e.signal);var g=this.parsedUrl.path+"/export";a=
k({},this.parsedUrl.query,this.createExportImageParameters(a,b,d,e),{f:"image",_ts:this.alwaysRefetch?Date.now():null});if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return x.reject(new p("mapimagelayer:dynamiclayer-not-supported","service "+this.url+" doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.",{query:a}));f.query=f.query?k({},a,f.query):a;return q(g,f).then(function(a){return a.data}).catch(function(a){if(x.isAbortError(a))throw a;
throw new p("mapimagelayer:image-fetch-error","Unable to load image: "+g,{error:a});})};f.prototype.loadAll=function(){var a=this;return B.default(this,function(b){b(a.allSublayers)})};f.prototype._fetchService=function(a){return t(this,void 0,void 0,function(){var b,e,f;return d(this,function(d){switch(d.label){case 0:return this.sourceJSON?(this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}),[2]):[4,q(this.parsedUrl.path,{query:k({f:"json"},this.parsedUrl.query),signal:a})];case 1:b=
d.sent();e=b.data;if(f=b.ssl)this.url=this.url.replace(/^http:/i,"https:");this.sourceJSON=e;this.read(e,{origin:"service",url:this.parsedUrl});return[2]}})})};b([h.property()],f.prototype,"alwaysRefetch",void 0);b([h.property()],f.prototype,"dpi",void 0);b([h.property()],f.prototype,"gdbVersion",void 0);b([h.property({json:{read:!1,write:!1}})],f.prototype,"popupEnabled",void 0);b([h.property()],f.prototype,"imageFormat",void 0);b([h.reader("imageFormat",["supportedImageFormatTypes"])],f.prototype,
"readImageFormat",null);b([h.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],f.prototype,"imageMaxHeight",void 0);b([h.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],f.prototype,"imageMaxWidth",void 0);b([h.property()],f.prototype,"imageTransparency",void 0);b([h.property({json:{read:!1,write:!1}})],f.prototype,"labelsVisible",void 0);b([h.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],f.prototype,
"isReference",void 0);b([h.property({type:["ArcGISMapServiceLayer"]})],f.prototype,"operationalLayerType",void 0);b([h.property()],f.prototype,"sourceJSON",void 0);b([h.property({json:{write:{ignoreOrigin:!0}}})],f.prototype,"sublayers",void 0);b([h.writer("sublayers",{layers:{type:[R]},visibleLayers:{type:[z.Integer]}})],f.prototype,"writeSublayers",null);b([h.property({type:["show","hide","hide-children"]})],f.prototype,"listMode",void 0);b([h.property({json:{read:!1},readOnly:!0,value:"map-image"})],
f.prototype,"type",void 0);b([h.property(P.url)],f.prototype,"url",void 0);return f=b([h.subclass("esri.layers.MapImageLayer")],f)}(h.declared(O.TemporalLayer(H.ScaleRangeLayer(E.RefreshableLayer(M.SublayersOwner(D.ArcGISMapService(y.ArcGISService(e.OperationalLayer(G.PortalLayer(m.MultiOriginJSONMixin(n.HandleOwnerMixin(N))))))))))))});