// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/generatorHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/assignHelper ../geometry ../PopupTemplate ../renderers ../request ../core/deprecate ../core/Error ../core/global ../core/jsonMap ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/featureReductionUtils ./support/Field ./support/FieldsIndex ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ../renderers/support/styleUtils ../support/popupUtils ../symbols/support/ElevationInfo".split(" "),
function(T,U,r,d,t,u,f,g,v,l,w,m,x,y,z,A,B,C,n,c,D,E,F,G,H,I,J,K,e,h,L,M,k,N,O,P,Q,R){var p=A.getLogger("esri.layers.StreamLayer"),S=new z.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"});return function(q){function a(b){b=q.call(this,b)||this;b.copyright=null;b.definitionExpression=null;b.displayField=null;b.elevationInfo=null;b.featureReduction=null;b.fields=null;b.geometryDefinition=null;b.geometryType=null;b.labelsVisible=
!0;b.labelingInfo=null;b.legendEnabled=!0;b.objectIdField=null;b.operationalLayerType="ArcGISStreamLayer";b.popupEnabled=!0;b.popupTemplate=null;b.purgeOptions={maxObservations:1};b.screenSizePerspectiveEnabled=!0;b.sourceJSON=null;b.spatialReference=g.SpatialReference.WGS84;b.type="stream";b.url=null;return b}u(a,q);a.prototype.normalizeCtorArgs=function(b,a){return"string"===typeof b?f({url:b},a):b};a.prototype.load=function(b){var a=this;"WebSocket"in y||n.reject(new x("stream-layer:websocket-unsupported",
"WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."));var c=B.isSome(b)?b.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service"]},b).catch(function(b){return b}).then(function(){return a._fetchService(c)}));return n.resolve(this)};Object.defineProperty(a.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});a.prototype.readFeatureReduction=
function(b,a){return h.read(b,a)};a.prototype.writeWebSceneFeatureReduction=function(b,a,c,d){h.writeTarget(b,a,"layerDefinition.featureReduction",d)};Object.defineProperty(a.prototype,"fieldsIndex",{get:function(){return new M(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumTrackPoints",{get:function(){m.deprecatedProperty(p,"maximumTrackPoints",{replacement:"purgeOptions.maxObservations",version:"4.15"});return this.purgeOptions.maxObservations},set:function(b){m.deprecatedProperty(p,
"maximumTrackPoints",{replacement:"purgeOptions.maxObservations",version:"4.15"});this.purgeOptions=f({},this.purgeOptions,{maxObservations:b})},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderer",{set:function(b){k.fixRendererFields(b,this.fields);this._set("renderer",b)},enumerable:!0,configurable:!0});a.prototype.createPopupTemplate=function(b){return Q.createPopupTemplate(this,b)};a.prototype.getFieldDomain=function(b,a){if(!this.fields)return null;var c=null;this.fields.some(function(a){a.name===
b&&(c=a.domain);return!!c});return c};a.prototype.getField=function(a){return this.fieldsIndex.get(a)};a.prototype.postFeature=function(a){this.emit("post-feature",{featureString:JSON.stringify(a)})};a.prototype._fetchService=function(a){return t(this,void 0,void 0,function(){var b;return r(this,function(c){switch(c.label){case 0:return this.parsedUrl?this.sourceJSON?[3,2]:[4,w(this.parsedUrl.path,{query:f({f:"json"},this.parsedUrl.query),responseType:"json",signal:a})]:[3,3];case 1:b=c.sent().data,
this.sourceJSON=f({},b,{objectIdField:"__esri_stream_id__"}),c.label=2;case 2:this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}),c.label=3;case 3:return k.fixRendererFields(this.renderer,this.fields),k.fixTimeInfoFields(this.timeInfo,this.fields),[2,P.loadStyleRenderer(this,{origin:"service"})]}})})};d([c.property({type:String})],a.prototype,"copyright",void 0);d([c.property({readOnly:!0,dependsOn:["fields","title"]})],a.prototype,"defaultPopupTemplate",null);d([c.property({type:String})],
a.prototype,"definitionExpression",void 0);d([c.property({type:String})],a.prototype,"displayField",void 0);d([c.property({type:R})],a.prototype,"elevationInfo",void 0);d([c.reader("featureReduction",["layerDefinition.featureReduction"])],a.prototype,"readFeatureReduction",null);d([c.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:h.webSceneFeatureReductionTypes}})],a.prototype,"writeWebSceneFeatureReduction",null);d([c.property({type:[L]})],a.prototype,"fields",void 0);
d([c.property({readOnly:!0,dependsOn:["fields"]})],a.prototype,"fieldsIndex",null);d([c.property({type:g.Extent})],a.prototype,"geometryDefinition",void 0);d([c.property({type:["point","polygon","polyline","multipoint"],json:{read:{reader:S.read}}})],a.prototype,"geometryType",void 0);d([c.property(e.labelsVisible)],a.prototype,"labelsVisible",void 0);d([c.property({type:[N],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:O.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],
a.prototype,"labelingInfo",void 0);d([c.property(e.legendEnabled)],a.prototype,"legendEnabled",void 0);d([c.property({type:["show","hide"]})],a.prototype,"listMode",void 0);d([c.property({type:D.Integer})],a.prototype,"maximumTrackPoints",null);d([c.property({type:String})],a.prototype,"objectIdField",void 0);d([c.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],a.prototype,"operationalLayerType",void 0);d([c.property(e.popupEnabled)],a.prototype,"popupEnabled",void 0);d([c.property({type:v,
json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],a.prototype,"popupTemplate",void 0);d([c.property()],a.prototype,"purgeOptions",void 0);d([c.property({types:l.rendererTypes,json:{read:{source:"drawingInfo.renderer",reader:l.read},write:{target:"layerDefinition.drawingInfo.renderer"}}})],a.prototype,"renderer",null);d([c.property(e.screenSizePerspectiveEnabled)],a.prototype,"screenSizePerspectiveEnabled",void 0);d([c.property({type:g.SpatialReference,json:{origins:{service:{read:{source:"spatialReference"}}}}})],
a.prototype,"spatialReference",void 0);d([c.property()],a.prototype,"source",void 0);d([c.property({json:{read:!1}})],a.prototype,"type",void 0);d([c.property(e.url)],a.prototype,"url",void 0);return a=d([c.subclass("esri.layers.StreamLayer")],a)}(c.declared(K.TemporalLayer(J.ScaleRangeLayer(I.RefreshableLayer(F.ArcGISService(G.OperationalLayer(H.PortalLayer(C.MultiOriginJSONMixin(E)))))))))});