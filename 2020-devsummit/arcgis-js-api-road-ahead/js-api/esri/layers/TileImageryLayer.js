// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterShadedReliefRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),function(C,g,z,k,b,n,h,a){function c(a,d){if(!a)return null;var e;e=a?f[a.type]||null:null;if(e)return e=new e,e.read(a,d),e;d&&d.messages&&a&&d.messages.push(new z("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+
"' are not supported",{definition:a,context:d}));return null}Object.defineProperty(g,"__esModule",{value:!0});g.ClassBreaksRenderer=k;g.RasterColormapRenderer=b;g.RasterStretchRenderer=h;g.UniqueValueRenderer=a;g.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":a,"class-breaks":k,"raster-colormap":b,"raster-stretch":h,"raster-shaded-relief":n}};var f={uniqueValue:a,classBreaks:k,rasterStretch:h,rasterColormap:b,rasterShadedRelief:n};g.read=c;g.fromJSON=function(a,d){return c(a,d)}})},
"esri/renderers/RasterColormapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),function(C,g,z,k,b,n,h,a,c){return function(b){function e(a){a=b.call(this,a)||this;a.type="raster-colormap";return a}z(e,b);d=e;e.createFromColormap=function(e){if(!e)return null;var b=5===e[0].length;e=e.sort(function(a){return a[0]-
a[1]});b=b?e.map(function(e){return a.fromJSON({value:e[0],color:e.slice(1,5),label:String(e[0])})}):e.map(function(e){return a.fromJSON({value:e[0],color:e.slice(1,4).concat([255]),label:String(e[0])})});return new d({colormapInfos:b})};e.createFromColorramp=function(a){a=c.convertColorRampToColormap(a,256);return d.createFromColormap(a)};e.prototype.clone=function(){return new d({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};e.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,
a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,e){return a[0]-e[0]})};var d;k([h.property({type:[a],json:{write:!0}})],e.prototype,"colormapInfos",void 0);k([h.enumeration.serializable()({rasterColormap:"raster-colormap"})],e.prototype,"type",void 0);return e=d=k([h.subclass("esri.renderers.RasterColormapRenderer")],e)}(h.declared(n.JSONSupport))})},"esri/renderers/support/ColormapInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(C,g,z,k,b,n,h,a){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.value=null;a.label=null;a.color=null;return a}z(c,b);k([a.property({type:Number,json:{write:!0}})],c.prototype,"value",void 0);k([a.property({type:String,json:{write:!0}})],c.prototype,"label",void 0);k([a.property({type:n,json:{write:!0}})],c.prototype,"color",void 0);return c=k([a.subclass("esri.renderers.support.ColormapInfo")],c)}(a.declared(h.JSONSupport))})},"esri/renderers/support/colorRampUtils":function(){define(["require",
"exports","../../Color","../../core/colorUtils"],function(C,g,z,k){function b(a,b){if(!a||!b||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]>b[c]+2||a[c]<b[c]-2)return!1;return!0}function n(a,b,f){a=k.toLAB(a);b=k.toLAB(b);return k.toRGB({l:a.l*(1-f)+f*b.l,a:a.a*(1-f)+f*b.a,b:a.b*(1-f)+f*b.b})}function h(a,c){if(a){c=c?c:g.PREDEFINED_JSON_COLOR_RAMPS;var f=null,e;"algorithmic"===a.type?c.some(function(e){if(b(a.fromColor.toRgb(),e.fromColor)&&b(a.toColor.toRgb(),e.toColor))return f=
e.id,!0}):"multipart"===a.type&&c.some(function(d){if(a.colorRamps&&d.colorRamps&&a.colorRamps.length===d.colorRamps.length&&(e=a.colorRamps,!d.colorRamps.some(function(a,d){if(!b(e[d].fromColor.toRgb(),(new z(a.fromColor)).toRgb())||!b(e[d].toColor.toRgb(),(new z(a.toColor)).toRgb()))return!0}))){if(f)return!0;f=d.id}});return f}}Object.defineProperty(g,"__esModule",{value:!0});g.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,
45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},
{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",
type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,
0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,
179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,
96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,
16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",
type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",
type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,
0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",
type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,
0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,
245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,
0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,
153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,
0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,
255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];g.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",
blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",
cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",
partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",
purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",
redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",
yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};g.getColorRampId=h;g.getColorRampName=function(a){return(a=h(a))?g.PREDEFINED_COLOR_RAMP_NAME_MAP[a]:null};g.convertColorRampToColormap=function(a,b){if(a&&b){for(var c="multipart"===a.type?a.colorRamps.length:1,e=[],d=[],h,w,l,m,y,p=0,v=0;v<c;v++)e[v]={start:null,end:null},e[v].start=p,e[v].end=p+1/c,p=e[v].end;c=function(c){m=c/b;e.forEach(function(e,p){m>=e.start&&m<e.end&&(y=(m-e.start)/
(e.end-e.start),"multipart"===a.type?(h=new z(a.colorRamps[p].fromColor),w=new z(a.colorRamps[p].toColor)):(h=new z(a.fromColor),w=new z(a.toColor)),l=n(h,w,y),0===c?d.push([c,h.r,h.g,h.b]):c===b-1?d.push([c,w.r,w.g,w.b]):(l=n(h,w,y),d.push([c,l.r,l.g,l.b])))})};for(v=0;v<b;v++)c(v);return d}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(C,g){function z(a,d){var e=[],b,c;if(a[0].length!==d.length)throw"dimensions do not match";var f=a.length,y=a[0].length,p=0;for(b=0;b<
f;b++){for(c=p=0;c<y;c++)p+=a[b][c]*d[c];e.push(p)}return e}function k(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=z(c,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function b(a){a=z(f,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function n(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>
Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function h(a){var e=a.l;a=[(e+16)/116+a.a/500,(e+16)/116,(e+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function a(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var d=a.c,e=a.h;return b(h({l:a.l,a:d*Math.cos(e),b:d*Math.sin(e)}))}if("l"in a&&"a"in a&&"b"in a)return b(h(a));
if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){e=(a.h+360)%360/60;d=a.v/100*255;a=a.s/100*d;var c=a*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:a,g:c,b:0};break;case 1:e={r:c,g:a,b:0};break;case 2:e={r:0,g:a,b:c};break;case 3:e={r:0,g:c,b:a};break;case 4:e={r:c,g:0,b:a};break;case 5:case 6:e={r:a,g:0,b:c};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+d-a);e.g=Math.round(e.g+d-a);e.b=Math.round(e.b+d-a);return e}}Object.defineProperty(g,"__esModule",{value:!0});
var c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],f=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];g.toRGB=a;g.toHSV=function(b){if("h"in b&&"s"in b&&"v"in b)return b;var d=a(b);b=d.r;var e=d.g,d=d.b,c=Math.max(b,e,d),f=c-Math.min(b,e,d),m;0===f?m=0:c===b?m=(e-d)/f%6:c===e?m=(d-b)/f+2:c===d&&(m=(b-e)/f+4);0>m&&(m+=6);return{h:60*m,s:100*(0===f?0:f/c),v:100/255*c}};g.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:n(k(a(b)))};g.toLCH=function(b){if(!("l"in
b&&"c"in b&&"h"in b)){var d=n(k(a(b)));b=d.l;var c=d.a,e=d.b,d=Math.sqrt(c*c+e*e),c=Math.atan2(e,c),c=0<c?c:c+2*Math.PI;b={l:b,c:d,h:c}}return b};g.toXYZ=function(b){return"x"in b&&"y"in b&&"z"in b?b:k(a(b))};g.darken=function(a,d){a=n(k(a));a.l*=1-d;return b(h(a))}})},"esri/renderers/RasterShadedReliefRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../tasks/support/colorRamps".split(" "),
function(C,g,z,k,b,n,h,a,c){return function(b){function e(a){a=b.call(this,a)||this;a.altitude=45;a.azimuth=315;a.colorRamp=null;a.hillshadeType="multi-directional";a.pixelSizePower=.664;a.pixelSizeFactor=.024;a.scalingType="none";a.type="raster-shaded-relief";a.zFactor=1;return a}z(e,b);d=e;e.prototype.readColorRamp=function(a){return c.fromJSON(a)};e.prototype.clone=function(){return new d({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,
pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,colorRamp:h.clone(this.colorRamp)})};var d;k([a.property({type:Number,json:{write:!0}})],e.prototype,"altitude",void 0);k([a.property({type:Number,json:{write:!0}})],e.prototype,"azimuth",void 0);k([a.property({types:c.types,json:{write:!0}})],e.prototype,"colorRamp",void 0);k([a.reader("colorRamp")],e.prototype,"readColorRamp",null);k([a.property({type:["traditional","multi-directional"],json:{write:!0}})],e.prototype,"hillshadeType",
void 0);k([a.property({type:Number,json:{write:!0}})],e.prototype,"pixelSizePower",void 0);k([a.property({type:Number,json:{write:!0}})],e.prototype,"pixelSizeFactor",void 0);k([a.property({type:["none","adjusted"],json:{write:!0}})],e.prototype,"scalingType",void 0);k([a.enumeration.serializable()({rasterShadedRelief:"raster-shaded-relief"})],e.prototype,"type",void 0);k([a.property({type:Number,json:{write:!0}})],e.prototype,"zFactor",void 0);return e=d=k([a.subclass("esri.renderers.RasterShadedReliefRenderer")],
e)}(a.declared(n.JSONSupport))})},"esri/renderers/RasterStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),function(C,g,z,k,b,n,h,a,c,f){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.colorRamp=null;a.computeGamma=!1;a.dynamicRangeAdjustment=
!1;a.gamma=[];a.maxPercent=null;a.minPercent=null;a.numberOfStandardDeviations=null;a.outputMax=null;a.outputMin=null;a.sigmoidStrengthLevel=null;a.statistics=[];a.histograms=null;a.useGamma=!1;a.stretchType="none";a.type="raster-stretch";return a}z(d,b);e=d;d.prototype.readColorRamp=function(a){if(a)return f.fromJSON(a)};d.prototype.writeStatistics=function(a,b,d){null==a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));b[d]=a};d.prototype.readStretchType=
function(a,b){a=b.stretchType;"number"===typeof a&&(a=c.stretchTypeFunctionEnum[a]);return c.stretchTypeJSONDict.read(a)};d.prototype.clone=function(){return new e({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:h.clone(this.statistics),gamma:h.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,
colorRamp:h.clone(this.colorRamp),histograms:h.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var e;k([a.property({types:f.types,json:{write:!0}})],d.prototype,"colorRamp",void 0);k([a.reader("colorRamp")],d.prototype,"readColorRamp",null);k([a.property({type:Boolean,json:{write:!0}})],d.prototype,"computeGamma",void 0);k([a.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],d.prototype,"dynamicRangeAdjustment",void 0);k([a.property({type:[Number],
json:{write:{allowNull:!0}}})],d.prototype,"gamma",void 0);k([a.property({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"maxPercent",void 0);k([a.property({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"minPercent",void 0);k([a.property({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"numberOfStandardDeviations",void 0);k([a.property({type:Number,json:{read:{source:"max"},write:{target:"max",allowNull:!0}}})],d.prototype,"outputMax",void 0);k([a.property({type:Number,json:{read:{source:"min"},
write:{target:"min",allowNull:!0}}})],d.prototype,"outputMin",void 0);k([a.property({type:Number,json:{write:{allowNull:!0}}})],d.prototype,"sigmoidStrengthLevel",void 0);k([a.property({json:{write:{allowNull:!0}}})],d.prototype,"statistics",void 0);k([a.property()],d.prototype,"histograms",void 0);k([a.writer("statistics")],d.prototype,"writeStatistics",null);k([a.property({type:Boolean,json:{write:!0}})],d.prototype,"useGamma",void 0);k([a.property({type:c.stretchTypeJSONDict.apiValues,json:{type:c.stretchTypeJSONDict.jsonValues,
write:c.stretchTypeJSONDict.write}})],d.prototype,"stretchType",void 0);k([a.reader("stretchType",["stretchType"])],d.prototype,"readStretchType",null);k([a.enumeration.serializable()({rasterStretch:"raster-stretch"})],d.prototype,"type",void 0);return d=e=k([a.subclass("esri.renderers.RasterStretchRenderer")],d)}(a.declared(n.JSONSupport))})},"esri/renderers/support/stretchRendererUtils":function(){define(["require","exports","../../core/jsonMap"],function(C,g,z){Object.defineProperty(g,"__esModule",
{value:!0});g.stretchTypeJSONDict=new z.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});g.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"}})},"esri/layers/support/DimensionalDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(C,g,z,k,b,n,h,a){return function(b){function c(a){a=b.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}z(c,b);e=c;c.prototype.clone=function(){return new e({variableName:this.variableName,dimensionName:this.dimensionName,values:n.clone(this.values),isSlice:this.isSlice})};var e;k([h.property({type:String,json:{write:!0}})],c.prototype,"variableName",void 0);k([h.property({type:String,json:{write:!0}})],c.prototype,"dimensionName",void 0);k([h.property({type:a.types.array(a.types.oneOf([a.types.native(Number),
a.types.array(a.types.native(Number))])),json:{write:!0}})],c.prototype,"values",void 0);k([h.property({type:Boolean,json:{write:!0}})],c.prototype,"isSlice",void 0);return c=e=k([h.subclass("esri.layers.support.DimensionalDefinition")],c)}(h.declared(b.JSONSupport))})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils".split(" "),
function(C,g,z,k,b,n,h,a){function c(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?c(b.functionArguments):a}function f(a,b){var c=[],p=[],f=[],l=[],x=b.pixelType,u=(b=b.rasterAttributeTable)&&b.features,t=d(b);if(u&&Array.isArray(u)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var d=b.symbol.color,e;d.a&&u.forEach(function(p){e=p.attributes[a.field];(e>=b.minValue&&e<b.maxValue||c===a.classBreakInfos.length-1&&e>=b.minValue)&&l.push([p.attributes[t],
d.r,d.g,d.b])})}),x=x?e(l,x):l,b=new n,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=x,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var t=a.symbol&&a.symbol.color;t.a?(0===b?c.push(a.minValue,a.maxValue+1E-6):c.push(a.minValue+1E-6,a.maxValue+1E-6),p.push(b),l.push([b,t.r,t.g,t.b])):f.push(a.minValue,a.maxValue)});x=x?e(l,x):l;b=new n;b.functionName="Remap";b.functionArguments={InputRanges:c,OutputValues:p,NoDataRanges:f};b.variableName="Raster";
var m=new n;m.functionName="Colormap";m.functionArguments={Colormap:x,Raster:b};return m}function e(a,b){(b=w[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function d(a){if(a)return(a=(a=a.fields)&&k.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function B(a,b){var c=[],f=b.pixelType,p=(b=b.rasterAttributeTable)&&b.features,l=d(b),m=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var t=b.symbol.color;
t.a&&(a.field!==l&&p?p&&p.forEach(function(d){String(d.attributes[a.field])===String(b.value)&&c.push([d.attributes[l],t.r,t.g,t.b])}):isNaN(b.value)?m=!0:c.push([b.value,t.r,t.g,t.b]))});if(m)return null;f=f&&0<c.length?e(c,f):c;b=new n;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=f;b.variableName="Raster";return b}Object.defineProperty(g,"__esModule",{value:!0});var w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},l={type:"multipart",
colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};g.isSupportedRendererType=function(a){a=a.type;return"raster-stretch"===a||"unique-value"===a||"class-breaks"===a||"raster-shaded-relief"===a};g.combineRenderingRules=function(a,d){if(!a||!d)return b.clone(a||d);a=b.clone(a);"none"!==d.functionName.toLowerCase()&&(c(a.functionArguments).Raster=d);return a};g.convertRendererToRenderingRule=function(b,c){c=c||
{};switch(b.type){case "raster-stretch":var d=new n;d.functionName="Stretch";var p=m[a.stretchTypeJSONDict.toJSON(b.stretchType)],l={StretchType:p,Statistics:b.statistics,DRA:b.dynamicRangeAdjustment,UseGamma:b.useGamma,Gamma:b.gamma,ComputeGamma:b.computeGamma};null!=b.outputMin&&(l.Min=b.outputMin);null!=b.outputMax&&(l.Max=b.outputMax);p===m.standardDeviation?(l.NumberOfStandardDeviations=b.numberOfStandardDeviations,d.outputPixelType="u8"):p===m.percentClip?(l.MinPercent=b.minPercent,l.MaxPercent=
b.maxPercent,d.outputPixelType="u8"):p===m.minMax?d.outputPixelType="u8":p===m.sigmoid&&(l.SigmoidStrengthLevel=b.sigmoidStrengthLevel);d.functionArguments=l;d.variableName="Raster";if(b.colorRamp){var p=b.colorRamp,l=new n,y=h.getColorRampName(p);l.functionArguments=y?{colorRamp:y}:!c.convertColorRampToColormap||"algorithmic"!==p.type&&"multipart"!==p.type?{colorRamp:b.colorRamp.toJSON()}:{Colormap:h.convertColorRampToColormap(p,256)};l.variableName="Raster";l.functionName="Colormap";l.functionArguments.Raster=
d;b=l}else b=d;return b;case "class-breaks":return f(b,c);case "unique-value":return B(b,c);case "raster-colormap":return(b=b.extractColormap())&&0!==b.length?(b=(c=c.pixelType)?e(b,c):b,c=new n,c.functionName="Colormap",c.functionArguments={},c.functionArguments.Colormap=b,b=c):b=void 0,b;case "raster-shaded-relief":return null}};g.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,d=a.dataType,e=a.bandCount,f=a.pixelType,p=a.colormap,u=a.statistics,t=a.histograms;b&&0<b.length&&(u=
u?b.map(function(a){return u[a]}):null,t=t?b.map(function(a){return t[a]}):null);var m;if(1===e&&p&&0<p.length)m=z.RasterColormapRenderer.createFromColormap(p);else if(1===e&&c){var h=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],y=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],w=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];a=c.fields.filter(function(a){return"value"===a.name})[0];var k=c.fields.filter(function(a){return"classname"===
a.name.toLowerCase()})[0];k||(k=c.fields.filter(function(a){return"string"===a.type})[0])||(k=a);h&&y&&w&&k&&(m=z.UniqueValueRenderer.fromJSON({field1:k.name,uniqueValueInfos:c.features.map(function(a){return{value:a.attributes[k.name],label:a.attributes[k.name],symbol:{color:[a.attributes[h.name],a.attributes[y.name],a.attributes[w.name],255],type:"esriSFS",style:"esriSFSSolid"}}})}))}m||(c=void 0,m=!1,e=b=a=void 0,"u8"===f&&"processed"===d?(c="min-max",u=u||[{min:0,max:255},{min:0,max:255},{min:0,
max:255}]):"u8"===f||"elevation"===d?(c="min-max",m=u?!1:!0):"scientific"===d?(c="min-max",m=u?!1:!0,a=l):t&&0<t.length?(c="percent-clip",e=b=.25):u?c="min-max":(c="percent-clip",m=!0),m=z.RasterStretchRenderer.fromJSON({stretchType:c,dra:m,colorRamp:a,min:0,max:255,statistics:m?null:u,histograms:m?null:t,maxPercent:b,minPercent:e}));return m}};g.getDefaultBandCombination=function(a){var b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;var c,
d,e,f,l;if(a&&a.length===b){for(var m=0;m<a.length;m++)a[m].BandName&&"red"===a[m].BandName.toLowerCase()&&(d=m),a[m].BandName&&"green"===a[m].BandName.toLowerCase()&&(e=m),a[m].BandName&&"blue"===a[m].BandName.toLowerCase()&&(f=m),a[m].BandName&&"nearinfrared"===a[m].BandName.toLowerCase()&&(l=m);void 0!==d&&void 0!==e&&void 0!==f?c=[d,e,f]:void 0!==d&&void 0!==e&&void 0!==l&&(c=[l,d,e])}!c&&3<b&&(c=[0,1,2]);return c};var m={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,
sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/SetUtils ../../core/accessorSupport/decorators".split(" "),function(C,g,z,k,b,n,h,a){var c=h.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),f=h.createSetFromValues(["Rasters"]),e=function(a){return a&&a.rasterFunction?w.fromJSON(a):a},d=function(a){return a&&a instanceof w?
a.toJSON():a},B;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=1]="GROUP";a[a.ITEM=2]="ITEM"})(B||(B={}));var w=function(b){function m(a){a=b.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;a.functionDefinition=null;a.thumbnail=null;return a}z(m,b);l=m;m.prototype.readFunctionArguments=function(a,b){a=b.arguments||b.rasterFunctionArguments;if(null==a)a=null;else{b={};for(var d=0,m=Object.keys(a);d<m.length;d++){var l=
m[d];c.has(l)?b[l]=e(a[l]):f.has(l)&&Array.isArray(a[l])?b[l]=a[l].map(e):b[l]=a[l]}a=b}return a};m.prototype.writeFunctionArguments=function(a,b,e){for(var m={},l=0,x=Object.keys(a);l<x.length;l++){var u=x[l];c.has(u)?m[u]=d(a[u]):f.has(u)&&Array.isArray(a[u])?m[u]=a[u].map(d):m[u]=d(a[u])}this.functionDefinition?b.arguments=m:b[e]=m};m.prototype.readFunctionName=function(a,b){a=b.rasterFunctionInfos;var c=b.name;return c?c:a&&a.length&&"None"!==a[0].name?a[0].name:b.rasterFunction};m.prototype.writeFunctionName=
function(a,b,c){this.functionDefinition?b.name=a:b[c]=a};m.prototype.readFunctionType=function(a){return B[a]};m.prototype.writeFunctionType=function(a,b,c){b[c]=B[a]};m.prototype.clone=function(){return new l({functionName:this.functionName,functionArguments:n.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};
var l;k([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],m.prototype,"functionArguments",void 0);k([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],m.prototype,"readFunctionArguments",null);k([a.writer("functionArguments")],m.prototype,"writeFunctionArguments",null);k([a.property({json:{type:String,write:{target:"rasterFunction"}}})],m.prototype,"functionName",void 0);k([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],m.prototype,
"readFunctionName",null);k([a.writer("functionName")],m.prototype,"writeFunctionName",null);k([a.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),a.property({json:{default:"unknown"}})],m.prototype,"outputPixelType",void 0);k([a.property({type:String,json:{read:!0,write:!0}})],m.prototype,"variableName",void 0);k([a.property({type:String,json:{read:!0,write:!0,
origins:{"web-document":{read:!1,write:!1}}}})],m.prototype,"description",void 0);k([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],m.prototype,"functionType",void 0);k([a.reader("functionType")],m.prototype,"readFunctionType",null);k([a.writer("functionType")],m.prototype,"writeFunctionType",null);k([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],m.prototype,"functionDefinition",void 0);k([a.property({type:String,
json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],m.prototype,"thumbnail",void 0);return m=l=k([a.subclass("esri.layers.support.RasterFunction")],m)}(a.declared(b.JSONSupport));return w})},"esri/layers/support/RasterJobHandler":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/Error ../../core/promiseUtils ../../core/workers ./PixelBlock".split(" "),function(C,g,z,k,b,n,h,a,c){return function(){function f(){this._workerThread=
null;this._destroyed=!1}f.prototype.initialize=function(){return k(this,void 0,void 0,function(){var b;return z(this,function(c){switch(c.label){case 0:return[4,a.open("RasterWorker")];case 1:return b=c.sent(),this._destroyed?b.close():this._workerThread=b,[2]}})})};f.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};f.prototype.decode=function(a,b){return k(this,void 0,void 0,function(){var d;return z(this,function(e){switch(e.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection",
"no available worker connection");return[4,this._workerThread.invoke("decode",a,b)];case 1:return d=e.sent(),[2,d?new c(d):null]}})})};f.prototype.symbolize=function(a,b){return k(this,void 0,void 0,function(){var d,e;return z(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");d={extent:a.extent&&a.extent.toJSON(),pixelBlock:a.pixelBlock.toJSON(),simpleStretchParams:a.simpleStretchParams};return[4,this._workerThread.invoke("symbolize",
d,b)];case 1:return e=f.sent(),[2,e?new c(e):null]}})})};f.prototype.updateSymbolizer=function(a,b){return k(this,void 0,void 0,function(){var c;return z(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");c=a&&a.renderer&&"raster-stretch"===a.renderer.type&&a.renderer.histograms;return[4,h.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:a.toJSON(),histograms:c},b))];case 1:return d.sent(),
[2]}})})};f.prototype.stretch=function(a,b){return k(this,void 0,void 0,function(){var d,e;return z(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");if(!a||!a.pixelBlock)return[2,null];d={srcPixelBlock:a.pixelBlock.toJSON(),stretchParams:a.stretchParams};return[4,this._workerThread.invoke("stretch",d,b)];case 1:return e=f.sent(),[2,e?new c(e):null]}})})};f.prototype.mosaicAndTransform=function(a,d){return k(this,
void 0,void 0,function(){var e,f;return z(this,function(l){switch(l.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");if(!(a&&a.srcPixelBlocks&&0<a.srcPixelBlocks.length))return[2,null];e=b({},a,{srcPixelBlocks:a.srcPixelBlocks.map(function(a){return a?a.toJSON():null})});return[4,this._workerThread.invoke("mosaicAndTransform",e,d)];case 1:return f=l.sent(),[2,f?new c(f):null]}})})};return f}()})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(C,g,z,k,b,n,h,a,c,f){var e=c.getLogger("esri.layers.support.PixelBlock");return function(c){function d(a){a=c.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}z(d,c);h=d;d.createEmptyBand=function(a,b){return new (h.getPixelArrayConstructor(a))(b)};d.getPixelArrayConstructor=function(a){var c;switch(a){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;case "u16":c=Uint16Array;
break;case "u32":c=Uint32Array;break;case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array;break;default:b.neverReached(a)}return c};d.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");
return a};d.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new n("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=
function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};d.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};d.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,
a.mask)});var b=this.mask,c=0;if(b)for(var d=0;d<b.length;d++)b[d]&&c++;else c=this.width*this.height;this.validPixelCount=c};d.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var c=b[0];b=b[1];for(var d=this.pixels,e=this.width*this.height,f=d.length,
r,l,x,u=[],t=0;t<f;t++){x=h.createEmptyBand(a,e);r=d[t];for(var A=0;A<e;A++)l=r[A],x[A]=l>b?b:l<c?c:l;u.push(x)}this.pixels=u;this.pixelType=a}};d.prototype.clone=function(){var b=new h({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var c,d=h.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=
[];var e=this.pixels[0].slice;for(c=0;c<this.pixels.length;c++)b.pixels[c]=e?this.pixels[c].slice(0,this.pixels[c].length):new d(this.pixels[c])}if(this.statistics)for(b.statistics=[],c=0;c<this.statistics.length;c++)b.statistics[c]=a.clone(this.statistics[c]);return b};d.prototype._fillFrom8Bit=function(a){var b=this.mask,c=this.maskIsAlpha,d=this.pixels;if(a&&d&&d.length){var f,q,r;f=q=r=d[0];3<=d.length?(q=d[1],r=d[2]):2===d.length&&(q=d[1]);a=new Uint32Array(a);d=this.width*this.height;if(f.length!==
d)e.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===d)if(c)for(c=0;c<d;c++)b[c]&&(a[c]=b[c]<<24|r[c]<<16|q[c]<<8|f[c]);else for(c=0;c<d;c++)b[c]&&(a[c]=-16777216|r[c]<<16|q[c]<<8|f[c]);else for(c=0;c<d;c++)a[c]=-16777216|r[c]<<16|q[c]<<8|f[c]}else e.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(a){var b=this.pixels,c=this.mask,d=this.statistics;if(a&&b&&b.length){var f=this.pixelType,
q=1,r=0,q=1;d&&0<d.length?(r=d.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,b)}),q=d.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),q=255/q):(q=255,"s8"===f?(r=-128,q=127):"u16"===f?q=65535:"s16"===f?(r=-32768,q=32767):"u32"===f?q=4294967295:"s32"===f?(r=-2147483648,q=2147483647):"f32"===f?(r=-3.4*1E39,q=3.4*1E39):"f64"===f&&(r=-Number.MAX_VALUE,q=Number.MAX_VALUE),q=255/(q-r));a=new Uint32Array(a);var f=this.width*this.height,
l,x,d=l=x=b[0];if(d.length!==f)return e.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(l=b[1],3<=b.length&&(x=b[2]),c&&c.length===f)for(b=0;b<f;b++)c[b]&&(a[b]=-16777216|(x[b]-r)*q<<16|(l[b]-r)*q<<8|(d[b]-r)*q);else for(b=0;b<f;b++)a[b]=-16777216|(x[b]-r)*q<<16|(l[b]-r)*q<<8|(d[b]-r)*q;else if(c&&c.length===f)for(b=0;b<f;b++)l=(d[b]-r)*q,c[b]&&(a[b]=-16777216|l<<16|l<<8|l);else for(b=0;b<f;b++)l=(d[b]-r)*q,a[b]=-16777216|l<<16|l<<8|l}else e.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(a){var b=this.pixels,c=this.mask;if(!a||!b||!b.length)return e.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,f,q;d=f=q=b[0];3<=b.length?(f=b[1],q=b[2]):2===b.length&&(f=b[1]);var r=this.width*this.height;if(d.length!==r)return e.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(c&&c.length===r)for(b=0;b<r;b++)a[l++]=
d[b],a[l++]=f[b],a[l++]=q[b],a[l++]=c[b]&1;else for(b=0;b<r;b++)a[l++]=d[b],a[l++]=f[b],a[l++]=q[b],a[l++]=1};d.prototype._calculateBandStatistics=function(a,b){var c=Infinity,d=-Infinity,e=a.length,f,r=0;if(b)for(f=0;f<e;f++)b[f]&&(r=a[f],c=r<c?r:c,d=r>d?r:d);else for(f=0;f<e;f++)r=a[f],c=r<c?r:c,d=r>d?r:d;return{minValue:c,maxValue:d}};var h;k([f.property({json:{write:!0}})],d.prototype,"width",void 0);k([f.property({json:{write:!0}})],d.prototype,"height",void 0);k([f.property({json:{write:!0}})],
d.prototype,"pixelType",void 0);k([f.cast("pixelType")],d.prototype,"castPixelType",null);k([f.property({json:{write:!0}})],d.prototype,"validPixelCount",void 0);k([f.property({json:{write:!0}})],d.prototype,"mask",void 0);k([f.property({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0);k([f.property({json:{write:!0}})],d.prototype,"pixels",void 0);k([f.property({json:{write:!0}})],d.prototype,"statistics",void 0);return d=h=k([f.subclass("esri.layers.support.PixelBlock")],d)}(f.declared(h.JSONSupport))})},
"esri/layers/support/TileInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(C,g,z,k,b,n,h,a,c,f,
e,d,B,w,l){var m=new h.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(a){function h(b){b=a.call(this,b)||this;b.dpi=96;b.format=null;b.origin=null;b.minScale=0;b.maxScale=0;b.size=null;b.spatialReference=null;return b}k(h,a);v=h;h.create=function(a){void 0===a&&(a={size:256,spatialReference:n.SpatialReference.WebMercator});
var b=a.resolutionFactor||1,d=a.scales,e=a.size||256;a=a.spatialReference||n.SpatialReference.WebMercator;if(!B.isValid(a)){b=[];if(d)for(var f=0;f<d.length;f++){var t=d[f];b.push({level:f,scale:t,resolution:t})}else for(var h=5E-4,f=23;0<=f;f--)b.unshift({level:f,scale:h,resolution:h}),h*=2;return new v({dpi:96,lods:b,origin:new n.Point(0,0,a),size:[e,e],spatialReference:a})}var l=(f=B.getInfo(a))?new n.Point(f.origin[0],f.origin[1],a):new n.Point(0,0,a),q=1/(39.37*c.getMetersPerUnitForSR(a)*96),
m=[];if(d)for(f=0;f<d.length;f++)t=d[f],h=t*q,m.push({level:f,scale:t,resolution:h});else for(t=B.isGeographic(a)?512/e*5.916575275917094E8:256/e*5.91657527591555E8,d=Math.ceil(24/b),m.push({level:0,scale:t,resolution:t*q}),f=1;f<d;f++)t/=Math.pow(2,b),h=t*q,m.push({level:f,scale:t,resolution:h});return new v({dpi:96,lods:m,origin:l,size:[e,e],spatialReference:a})};Object.defineProperty(h.prototype,"isWrappable",{get:function(){var a=this.spatialReference,b=this.origin;if(a&&b){var c=B.getInfo(a);
return a.isWrappable&&Math.abs(c.origin[0]-b.x)<=c.dx}return!1},enumerable:!0,configurable:!0});h.prototype.readOrigin=function(a,b){return n.Point.fromJSON(z({spatialReference:b.spatialReference},a))};Object.defineProperty(h.prototype,"lods",{set:function(a){var b=this,c=0,d=0,e=[];this._levelToLOD={};a&&(c=-Infinity,d=Infinity,a.forEach(function(a){e.push(a.scale);c=a.scale>c?a.scale:c;d=a.scale<d?a.scale:d;b._levelToLOD[a.level]=a}));this._set("scales",e);this._set("minScale",c);this._set("maxScale",
d);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});h.prototype.readSize=function(a,b){return[b.cols,b.rows]};h.prototype.writeSize=function(a,b){b.cols=a[0];b.rows=a[0]};h.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};h.prototype.scaleToZoom=function(a){for(var b=this.scales,c=b.length-1,d=0;d<c;d++){var e=b[d],t=b[d+1];if(e<=a)break;
if(t===a)return d+1;if(e>a&&t<a)return d+1-(a-t)/(e-t)}return d};h.prototype.snapScale=function(a,b){void 0===b&&(b=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};h.prototype.tileAt=function(a,b,c,e){var f=this.lodAt(a);if(!f)return null;var t;if("number"===typeof b)t=b,b=c;else{if(B.equals(b.spatialReference,this.spatialReference))t=b.x,b=b.y;else{e=w.project(b,this.spatialReference);if(!e)return null;t=e.x;b=e.y}e=c}c=f.resolution*
this.size[0];f=f.resolution*this.size[1];e||(e={id:null,level:0,row:0,col:0,extent:d.create()});e.level=a;e.row=Math.floor((this.origin.y-b)/f+.001);e.col=Math.floor((t-this.origin.x)/c+.001);this.updateTileInfo(e);return e};h.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level);if(b){var c=b.resolution*this.size[0],b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=d.create());a.extent[0]=this.origin.x+a.col*c;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=
a.extent[0]+c;a.extent[3]=a.extent[1]+b}};h.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};h.prototype.getTileBounds=function(a,b){var c=this.lodAt(b.level).resolution,d=c*this.size[0],c=c*this.size[1];a[0]=this.origin.x+b.col*d;a[1]=this.origin.y-(b.row+1)*c;a[2]=a[0]+d;a[3]=a[1]+c;return a};h.prototype.lodAt=
function(a){return this._levelToLOD&&this._levelToLOD[a]||null};h.prototype.clone=function(){return v.fromJSON(this.write({}))};h.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,c=0;c<a.length;c++){var d=a[c];this._upsampleLevels[d.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};var v;b([f.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);b([f.property({type:Number,json:{write:!0}})],
h.prototype,"dpi",void 0);b([f.property({type:String,json:{read:m.read,write:m.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);b([f.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],h.prototype,"isWrappable",null);b([f.property({type:n.Point,json:{write:!0}})],h.prototype,"origin",void 0);b([f.reader("origin")],h.prototype,"readOrigin",null);b([f.property({type:[l],value:null,json:{write:!0}})],h.prototype,"lods",null);b([f.property({readOnly:!0})],h.prototype,
"minScale",void 0);b([f.property({readOnly:!0})],h.prototype,"maxScale",void 0);b([f.property({readOnly:!0})],h.prototype,"scales",void 0);b([f.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],h.prototype,"size",void 0);b([f.reader("size",["rows","cols"])],h.prototype,"readSize",null);b([f.writer("size",{cols:{type:e.Integer},rows:{type:e.Integer}})],h.prototype,"writeSize",null);b([f.property({type:n.SpatialReference,json:{write:!0}})],h.prototype,"spatialReference",
void 0);return h=v=b([f.subclass("esri.layers.support.TileInfo")],h)}(f.declared(a.JSONSupport))})},"esri/layers/support/LOD":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(C,g,z,k,b,n,h){return function(a){function b(b){b=a.call(this,b)||this;b.level=0;b.levelValue=null;b.resolution=0;b.scale=0;return b}z(b,a);f=
b;b.prototype.clone=function(){return new f({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var f;k([n.property({type:h.Integer,json:{write:!0}})],b.prototype,"level",void 0);k([n.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);k([n.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);k([n.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=f=k([n.subclass("esri.layers.support.LOD")],
b)}(n.declared(b.JSONSupport))})},"esri/layers/support/rasterDatasets/RasterFactory":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/Set ../../../core/Error ./CloudRaster ./ImageServerRaster ./MRFRaster ./TIFFRaster".split(" "),function(C,g,z,k,b,n,h,a,c,f){var e=new Map;e.set("CRF",{desc:"Cloud Raster Format",constructor:h});e.set("MRF",{desc:"Meta Raster Format",constructor:c});e.set("TIFF",{desc:"GeoTIFF",constructor:f});
e.set("RasterTileServer",{desc:"Raster Tile Server",constructor:a});return function(){function a(){}Object.defineProperty(a,"supportedFormats",{get:function(){for(var a=e.keys(),c=new b.default,d=a.next();!d.done;)c.add(d.value),d=a.next();return c},enumerable:!0,configurable:!0});a.open=function(a){return k(this,void 0,void 0,function(){var b,c,d,f,h,v,q,r,k,x;return z(this,function(l){switch(l.label){case 0:b=a.url;c=a.ioConfig;d=a.datasetFormat;null==d&&b.lastIndexOf(".")&&(d=b.slice(b.lastIndexOf(".")+
1).toUpperCase());"OVR"===d||"TIF"===d?d="TIFF":-1<b.toLowerCase().indexOf("/imageserver")&&(d="RasterTileServer");f={resolution:null,bandIds:null,sampling:null};h={url:b,datasetFormat:d,ioConfig:c||f};if(!this.supportedFormats.has(d))return[3,2];v=e.get(d).constructor;q=new v(h);return[4,q.open({signal:a.signal})];case 1:return l.sent(),[2,q];case 2:if(d)throw new n("rasterfactory:open","not a supported format "+d);r=Array.from(e.keys());k=0;x=function(){d=r[k++];if(!d)return null;v=e.get(d).constructor;
q=new v(h);return q.open({signal:a.signal}).then(function(){return q}).catch(function(){return x()})};return[2,x()]}})})};a.register=function(a,b,c){e.has(a.toUpperCase())||e.set(a.toUpperCase(),{desc:b,constructor:c})};return a}()})},"@dojo/framework/shim/Set":function(){(function(C){"object"===typeof module&&"object"===typeof module.exports?(C=C(require,exports),void 0!==C&&(module.exports=C)):"function"===typeof define&&define.amd&&define("require exports tslib ./global ./iterator ../has/has ./Symbol".split(" "),
C)})(function(C,g){Object.defineProperty(g,"__esModule",{value:!0});var z=C("tslib"),k=C("./global"),b=C("./iterator"),n=C("../has/has");C("./Symbol");g.Set=k.default.Set;n.default("es6-set")||(g.Set=(h=function(){function a(a){this._setData=[];this[Symbol.toStringTag]="Set";if(a)if(b.isArrayLike(a))for(var c=0;c<a.length;c++)this.add(a[c]);else try{for(var c=z.__values(a),e=c.next();!e.done;e=c.next())this.add(e.value)}catch(w){d={error:w}}finally{try{e&&!e.done&&(h=c.return)&&h.call(c)}finally{if(d)throw d.error;
}}var d,h}a.prototype.add=function(a){if(this.has(a))return this;this._setData.push(a);return this};a.prototype.clear=function(){this._setData.length=0};a.prototype.delete=function(a){a=this._setData.indexOf(a);if(-1===a)return!1;this._setData.splice(a,1);return!0};a.prototype.entries=function(){return new b.ShimIterator(this._setData.map(function(a){return[a,a]}))};a.prototype.forEach=function(a,b){for(var c=this.values(),d=c.next();!d.done;)a.call(b,d.value,d.value,this),d=c.next()};a.prototype.has=
function(a){return-1<this._setData.indexOf(a)};a.prototype.keys=function(){return new b.ShimIterator(this._setData)};Object.defineProperty(a.prototype,"size",{get:function(){return this._setData.length},enumerable:!0,configurable:!0});a.prototype.values=function(){return new b.ShimIterator(this._setData)};a.prototype[Symbol.iterator]=function(){return new b.ShimIterator(this._setData)};return a}(),h[Symbol.species]=h,h));g.default=g.Set;var h})},"esri/layers/support/rasterDatasets/CloudRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ../TileInfo ./BaseRaster ./DBFParser ../../../tasks/support/FeatureSet".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m,y){var p=new Map;p.set("int16","esriFieldTypeSmallInteger");p.set("int32","esriFieldTypeInteger");p.set("int64","esriFieldTypeInteger");p.set("float32","esriFieldTypeSingle");p.set("float64","esriFieldTypeDouble");p.set("text","esriFieldTypeString");return function(l){function q(){var a=null!==l&&l.apply(this,arguments)||this;a.storageInfo=null;return a}n(q,l);q.prototype.open=function(d){return b(this,void 0,void 0,function(){var b,e,f,t,h,l;return z(this,
function(u){switch(u.label){case 0:return[4,this.init()];case 1:return u.sent(),b=d?c.unwrap(d.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},b)];case 2:e=u.sent();if(!this._validateHeader(e))throw new a("cloudraster:open","Invalid or unsupported conf.json.");this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);f=this._parseHeader(e);t=f.storageInfo;h=f.rasterInfo;return"thematic"!==h.dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:l=u.sent(),h.attributeTable=
l,u.label=4;case 4:return this._set("storageInfo",t),this._set("rasterInfo",h),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}})})};q.prototype.fetchRawTile=function(a,c,d,e){void 0===e&&(e={});return b(this,void 0,void 0,function(){var b,f,h,l,u,x,m;return z(this,function(t){switch(t.label){case 0:b=this.rasterInfo.storageInfo.maximumPyramidLevel-a;if(0>b)return[2,null];f=this._buildCacheFilePath(b,c,d,e.multidimensionalDefinition);h=this._getIndexRecordFromBundle(c,d);return[4,this.request({url:f,
range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},e.signal)];case 1:l=t.sent();if(!l)return[2,null];u=new Uint8Array(l);x=this._getTileEndAndContentType(u,h);return 0===x.recordSize?[2,null]:[4,this.request({url:f,range:{from:x.position,to:x.position+x.recordSize},responseType:"array-buffer"},e.signal)];case 2:return(m=t.sent())?[2,this.decodePixelBlock(m,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,
pixelType:null})]:[2,null]}})})};q.prototype._validateHeader=function(a){var b="origin extent geodataXform LODInfos blockWidth blockHeight bandCount pixelType pixelSizeX pixelSizeY format packetSize".split(" ");return a&&"RasterInfo"===a.type&&!b.some(function(b){return!a[b]})};q.prototype._parseHeader=function(a){var b="u1 u2 u4 u8 s8 u16 s16 u32 s32 f32 f64".split(" ")[a.pixelType],c=a.bandCount,e=a.histograms,t=a.colormap,f=a.blockWidth,l=a.blockHeight,m=a.firstPyramidLevel,p=a.maximumPyramidLevel,
q=a.statistics&&a.statistics.map(function(a){return{min:a.min,max:a.max,avg:a.mean,stddev:a.standardDeviation,median:a.median,mode:a.mode}}),r=new h.SpatialReference(a.extent.spatialReference||a.geodataXform.spatialReference),k=new h.Extent({xmin:a.extent.xmin,ymin:a.extent.ymin,xmax:a.extent.xmax,ymax:a.extent.ymax,spatialReference:r}),v=new h.Point({x:a.pixelSizeX,y:a.pixelSizeY,spatialReference:r}),y=a.properties,n=a.format.toLowerCase().replace("cache/",""),g=new h.Point(a.origin.x,a.origin.y,
r),z,O,S,T;if(t&&t.colors)for(z=[],O=0;O<t.colors.length;O++)S=t.colors[O],T=t.values?t.values[O]:O,z.push([T,S&255,S<<16>>>24,S<<8>>>24,S>>>24]);t=a.LODInfos;S=[];for(O=0;O<t.levels.length;O++)S.push({level:t.levels[O],resolution:t.resolutions[O],scale:96/.0254*t.resolutions[O]});t=new w({dpi:96,lods:S,format:n,origin:g,size:[f,l],spatialReference:r});n={recordSize:8,packetSize:a.packetSize,headerSize:a.packetSize*a.packetSize*8+64};S=Math.round((k.xmax-k.xmin)/v.x);T=Math.round((k.ymax-k.ymin)/
v.y);var R=[{maxCol:Math.ceil(S/f)-1,maxRow:Math.ceil(T/l)-1,minCol:0,minRow:0}],K=2;if(0<p)for(O=0;O<p;O++)R.push({maxCol:Math.ceil(S/K/f)-1,maxRow:Math.ceil(T/K/l)-1,minCol:0,minRow:0}),K*=2;a=new d({width:S,height:T,pixelType:b,bandCount:c,extent:k,spatialReference:r,pixelSize:v,keyProperties:y,statistics:q,histograms:e,multidimensionalInfo:a.mdInfo,colormap:z,storageInfo:new B({blockWidth:f,blockHeight:l,pyramidBlockWidth:f,pyramidBlockHeight:l,origin:g,tileInfo:t,firstPyramidLevel:m,maximumPyramidLevel:p,
blockBoundary:R})});return{storageInfo:n,rasterInfo:a}};q.prototype._fetchAuxiliaryInformation=function(a){return b(this,void 0,void 0,function(){var b,c,d,e,h,l,q,r;return z(this,function(t){switch(t.label){case 0:return b=this.request({url:this.url+"/conf.vat.json",responseType:"json"},a).then(function(a){return a}).catch(function(){return null}),c=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},a).then(function(a){return a}).catch(function(){return null}),[4,f.all([b,c])];
case 1:return d=t.sent(),d[0]&&(h=d[0].fields,l=d[0].values,h&&l&&(h=h.map(function(a){return{type:"OID"===a.name?"esriFieldTypeOID":p.get(a.type),name:a.name,alias:a.alias||a.name}}),q=l.map(function(a){return{attributes:a}}),h&&l&&(e={fields:h,features:q}))),!e&&d[1]&&(r=m.parse(d[1]),e=r.recordSet),[2,y.fromJSON(e)]}})})};q.prototype._buildCacheFilePath=function(a,b,c,d){var e=this.storageInfo.packetSize;c=Math.floor(c/e)*e;b="R"+this._toHexString4(Math.floor(b/e)*e)+"C"+this._toHexString4(c);
var e="L",e=10<=a?e+a.toString():e+("0"+a.toString()),f=d&&d[0];if(!f)return this.url+"/_alllayers/"+e+"/"+b+".bundle";a=this.rasterInfo.multidimensionalInfo.variables.filter(function(a){return a.name===f.variableName})[0].dimensions[0].values.indexOf(f.values[0]).toString(16);d=4-a.length;for(c=0;c<d;c++)a="0"+a;return this.url+"/_alllayers/"+f.variableName+"/"+("S"+a)+"/"+e+"/"+b+".bundle"};q.prototype._getIndexRecordFromBundle=function(a,b){var c=this.storageInfo.packetSize;a=a%c*c+b%c;if(0>a)throw"Invalid level / row / col";
return a*this.storageInfo.recordSize+64};q.prototype._getTileEndAndContentType=function(a,b){a=a.subarray(b,b+8);b=0;var c;for(c=0;5>c;c++)b|=(a[c]&255)<<8*c;var d=b&0xffffffffff;b=0;for(c=5;8>c;c++)b|=(a[c]&255)<<8*(c-5);return{position:d,recordSize:b&0xffffffffff}};q.prototype._toHexString4=function(a){a=a.toString(16);if(4!==a.length)for(var b=4-a.length;0<b--;)a="0"+a;return a};k([e.property({readOnly:!0})],q.prototype,"storageInfo",void 0);k([e.property({type:String,json:{write:!0}})],q.prototype,
"datasetFormat",void 0);return q=k([e.subclass("esri.layers.support.rasterDatasets.CloudRaster")],q)}(e.declared(l))})},"esri/layers/support/RasterInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),function(C,g,z,k,b,n,h,a,c){return function(f){function e(a){a=f.call(this,
a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.height=null;a.width=null;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.noDataValue=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;a.storageInfo=null;return a}k(e,f);Object.defineProperty(e.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});
b([h.property({type:c,json:{write:!0}})],e.prototype,"attributeTable",void 0);b([h.property({json:{write:!0}})],e.prototype,"bandCount",void 0);b([h.property({json:{write:!0}})],e.prototype,"colormap",void 0);b([h.property({type:String,readOnly:!0})],e.prototype,"dataType",null);b([h.property({type:a,json:{write:!0}})],e.prototype,"extent",void 0);b([h.property({json:{write:!0}})],e.prototype,"format",void 0);b([h.property({json:{write:!0}})],e.prototype,"height",void 0);b([h.property({json:{write:!0}})],
e.prototype,"width",void 0);b([h.property({json:{write:!0}})],e.prototype,"histograms",void 0);b([h.property({json:{write:!0}})],e.prototype,"keyProperties",void 0);b([h.property({json:{write:!0}})],e.prototype,"multidimensionalInfo",void 0);b([h.property()],e.prototype,"noDataValue",void 0);b([h.property({json:{write:!0}})],e.prototype,"pixelSize",void 0);b([h.property({json:{write:!0}})],e.prototype,"pixelType",void 0);b([h.property({json:{write:!0}})],e.prototype,"spatialReference",void 0);b([h.property({json:{write:!0}})],
e.prototype,"statistics",void 0);b([h.property({json:{write:!0}})],e.prototype,"storageInfo",void 0);return e=b([h.subclass("esri.layers.support.RasterInfo")],e)}(h.declared(n.JSONSupport))})},"esri/layers/support/RasterStorageInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point".split(" "),function(C,g,z,k,b,n,h,a){return function(c){function f(){var a=
null!==c&&c.apply(this,arguments)||this;a.blockWidth=void 0;a.blockHeight=void 0;a.compression=null;a.origin=null;a.firstPyramidLevel=null;a.maximumPyramidLevel=null;a.pyramidScalingFactor=2;a.pyramidBlockWidth=null;a.pyramidBlockHeight=null;a.tileInfo=null;a.blockBoundary=null;return a}k(f,c);b([h.property({type:Number,json:{write:!0}})],f.prototype,"blockWidth",void 0);b([h.property({type:Number,json:{write:!0}})],f.prototype,"blockHeight",void 0);b([h.property({type:String,json:{write:!0}})],f.prototype,
"compression",void 0);b([h.property({type:a,json:{write:!0}})],f.prototype,"origin",void 0);b([h.property({type:Number,json:{write:!0}})],f.prototype,"firstPyramidLevel",void 0);b([h.property({type:Number,json:{write:!0}})],f.prototype,"maximumPyramidLevel",void 0);b([h.property()],f.prototype,"pyramidScalingFactor",void 0);b([h.property({type:Number,json:{write:!0}})],f.prototype,"pyramidBlockWidth",void 0);b([h.property({type:Number,json:{write:!0}})],f.prototype,"pyramidBlockHeight",void 0);b([h.property({json:{write:!0}})],
f.prototype,"tileInfo",void 0);b([h.property()],f.prototype,"blockBoundary",void 0);return f=b([h.subclass("esri.layers.support.RasterStorageInfo")],f)}(h.declared(n.JSONSupport))})},"esri/layers/support/rasterDatasets/BaseRaster":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../request ../../../core/Error ../../../core/JSONSupport ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/urlUtils ../../../core/accessorSupport/decorators ../commonProperties ../TileInfo ./RawBlockCache ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ../rasterFunctions/rasterProjectionHelper".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m,y,p,v,q,r,D){return function(e){function u(){var a=null!==e&&e.apply(this,arguments)||this;a.rasterJobHandler=null;a.datasetName=null;a.datasetFormat=null;a.rasterInfo=null;a.ioConfig={bandIds:null,sampling:"closest"};return a}z(u,e);u.prototype.init=function(){return n(this,void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:return a=D.load(),this.addResolvingPromise(a),[4,this.when()];case 1:return b.sent(),[2]}})})};u.prototype.normalizeCtorArgs=
function(a){a&&a.ioConfig&&(a=h({},a,{ioConfig:h({resolution:null,bandIds:null,sampling:"closest",tileInfo:p.create()},a.ioConfig)}));return a};Object.defineProperty(u.prototype,"url",{set:function(a){a=l.urlToObject(a);this._set("url",a.path)},enumerable:!0,configurable:!0});u.prototype.open=function(a){return n(this,void 0,void 0,function(){return b(this,function(a){throw new f("BaseRaster:open-not-implemented","open() is not implemented");})})};u.prototype.fetchTile=function(c,d,e,f){void 0===
f&&(f={});return n(this,void 0,void 0,function(){var t,h,l,u;return b(this,function(b){t=f.tileInfo;h=t.lodAt(c);l=new a.Point({x:h.resolution,y:h.resolution,spatialReference:t.spatialReference});u=this._getTileExtent(l,d,e,t);return[2,this.fetchPixels(u,t.size[0],t.size[1],f)]})})};u.prototype.identify=function(a,c){void 0===c&&(c={});return n(this,void 0,void 0,function(){var d,e,f,t,h,l,u,m,x,p,q,k,r,v,A;return b(this,function(b){switch(b.label){case 0:d=this.rasterInfo;e=d.spatialReference;f=
d.extent;t=c.datumTransformation;h=D.projectPoint(a,e,t);if(!f.intersects(h))return[2,{location:h,value:null}];l=0;if(!c.srcResolution)return[3,1];u=D.snapPyramid(c.srcResolution,this.rasterInfo,this.ioConfig.sampling);l=u.pyramidLevel;return[3,3];case 1:return[4,this.computeBestPyramidLevelForLocation(a,c)];case 2:l=b.sent();if(null==l)return[2,{location:h,value:null}];b.label=3;case 3:m=this.identifyPixelLocation(h,l,null);if(null===m)return[2,{location:h,value:null}];x=m.row;p=m.col;q=m.rowOffset;
k=m.colOffset;return[4,this.fetchRawTile(l,x,p,c)];case 4:r=b.sent();if(!(r.pixels&&0<r.pixels.length))return[2,{location:h,value:null}];v=q*this.rasterInfo.storageInfo.blockHeight+k;A=!r.mask||r.mask[v]?r.pixels.map(function(a){return a[v]}):null;return[2,{location:h,value:A,pyramidLevel:l}]}})})};u.prototype.fetchPixels=function(c,d,e,f){void 0===f&&(f={});return n(this,void 0,void 0,function(){var t,h,l,u,m,x,p,q,k,v,A,y,w,n,E,G,g,B,z,C,aa,Y,ba,da;return b(this,function(b){switch(b.label){case 0:t=
c.clone().normalize();c=t[0];h=this.rasterInfo.spatialReference;l=!c.spatialReference.equals(h);u=f.datumTransformation;m=new a.Point({x:(c.xmax-c.xmin)/d,y:(c.ymax-c.ymin)/e,spatialReference:c.spatialReference});x=f.srcResolution||(l?D.projectResolution(m,h,c,u):m);if(!x)return[2,null];p=D.snapPyramid(x,this.rasterInfo,this.ioConfig.sampling);q=p.pyramidLevel;k=p.pyramidResolution;if(v=p.excessiveReading)return[2,null];A=this.rasterInfo.storageInfo;y=l?D.projectExtent(c,h,u):c;w={x:Math.floor((y.xmin-
A.origin.x)/k.x+.1),y:Math.floor((A.origin.y-y.ymax)/k.y+.1)};n=Math.ceil((y.xmax-y.xmin)/k.x-.1);E=Math.ceil((y.ymax-y.ymin)/k.y-.1);return 8<n/d||8<E/e?[2,null]:[4,this.fetchRawPixels(q,w,{width:n,height:E},f)];case 1:G=b.sent();if(!G)return[2,null];g=0<q?A.pyramidBlockWidth:A.blockWidth;B=0<q?A.pyramidBlockHeight:A.blockHeight;if(z=!l&&1===G.pixelBlocks.length&&g===d&&B===e&&x.x===m.x&&x.y===m.y)return[2,{extent:c,srcExtent:y,pixelBlock:G.pixelBlocks[0],transformGrid:null}];C=D.getProjectionOffsetGrid(c,
G.extent,m,u);Y=!f.requestRawData;ba={rows:C.spacing[0],cols:C.spacing[1]};return this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:G.pixelBlocks,srcMosaicSize:G.mosaicSize,destDimension:Y?{width:d,height:e}:null,coefs:Y?C.coefficients:null,sampleSpacing:Y?ba:null},f)]:[3,3];case 2:return aa=b.sent(),[3,4];case 3:da=r.mosaic(G.pixelBlocks,G.mosaicSize),aa=Y?r.approximateTransform(da,{width:d,height:e},C.coefficients,ba):da,b.label=4;case 4:return[2,{srcExtent:y,pixelBlock:aa,
transformGrid:C,extent:c}]}})})};u.prototype.fetchRawPixels=function(c,e,f,h){return n(this,void 0,void 0,function(){var t,l,u,m,x,p,q,k,r,A,y,n,G,E,g,B,D,z,C,X,aa,Y,ba,da,ga,ha,ea,fa,ia;return b(this,function(b){switch(b.label){case 0:t=this.rasterInfo.storageInfo;l=t.origin;u=t.blockBoundary;m=0<c?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth;x=0<c?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight;p=Math.floor(e.x/m);q=
Math.floor(e.y/x);k=Math.floor((e.x+f.width-1)/m);r=Math.floor((e.y+f.height-1)/x);A=this.rasterInfo;y=A.pixelSize;n=A.spatialReference;G=u[c];if(!G)return[2,null];E=G.minRow;g=G.minCol;B=G.maxCol;D=G.maxRow;if(r<E||k<g||q>D||p>B)return[2,null];z=[];C=this.url;X=h.registryId;for(ba=q;ba<=r;ba++)for(da=p;da<=k;da++)ba>=E&&da>=g&&D>=ba&&B>=da?(aa=c+"/"+ba+"/"+da,Y=v.getBlock(C,X,aa),d.isSome(Y)||(Y=this.fetchRawTile(c,ba,da,h),v.putBlock(C,X,aa,Y)),z.push(Y)):z.push(null);return 0===z.length?[2,null]:
[4,w.all(z)];case 1:return ga=b.sent(),ha={height:(r-q+1)*m,width:(k-p+1)*x},ea=y.x*Math.pow(2,c),fa=y.y*Math.pow(2,c),ia=new a.Extent({xmin:l.x+p*m*ea,xmax:l.x+(k+1)*m*ea,ymin:l.y-(r+1)*x*fa,ymax:l.y-q*x*fa,spatialReference:n}),[2,{extent:ia,pixelBlocks:ga,mosaicSize:ha}]}})})};u.prototype.fetchRawTile=function(a,c,d,e){return n(this,void 0,void 0,function(){return b(this,function(a){throw new f("BaseRaster:read-not-implemented","fetchRawTile() is not implemented");})})};u.prototype.decodePixelBlock=
function(a,b){return this.rasterJobHandler?this.rasterJobHandler.decode({data:a,options:b}):q.decode(a,b)};u.prototype.request=function(a,d){return n(this,void 0,void 0,function(){var e,f,t,l,u,m,x;return b(this,function(b){switch(b.label){case 0:e=this.ioConfig.customFetchParameters,f=a.url,t=a.range,l=a.query,u=a.responseType,null==a.retryCount&&this.ioConfig.retryCount&&(a.retryCount=this.ioConfig.retryCount),m=t?{Range:"bytes\x3d"+t.from+"-"+t.to}:null,b.label=1;case 1:return b.trys.push([1,3,
,4]),[4,c(f,{query:h({},l,e),headers:m,responseType:u,signal:d})];case 2:return x=b.sent().data,[2,x];case 3:return b.sent(),0<a.retryCount?(a.retryCount--,[2,this.request(a,d)]):[2,null];case 4:return[2]}})})};u.prototype.getSliceIndex=function(a){var b=this.rasterInfo.multidimensionalInfo;if(!b||0===a.length)return null;for(var c=0,d=a[0].variableName,e=function(e){e=b.variables[e];var f=e.dimensions;if(e.name!==d)return c+=f.map(function(a){return a.values.length}).reduce(function(a,b){return a+
b}),"break";var t=f.map(function(a){return a.values.length}),h=f.length;e=function(b){var d=a.filter(function(a){return a.dimensionName===f[b].name})[0];if(null==d)return{value:null};d=Array.isArray(d.values[0])?d.values[0][0]:d.values[0];d=f[b].values.indexOf(d);if(-1===d)return{value:null};t.shift();c=b===h-1?c+d:c+d*t.reduce(function(a,b){return a+b})};for(var l=0;l<h;l++){var u=e(l);if("object"===typeof u)return u}},f=0;f<b.variables.length;f++){var t=e(f);if("object"===typeof t)return t.value;
if("break"===t)break}return c};u.prototype.computeBestPyramidLevelForLocation=function(a,c){void 0===c&&(c={});return n(this,void 0,void 0,function(){return b(this,function(a){return[2,0]})})};u.prototype.identifyPixelLocation=function(a,b,c){var d=this.rasterInfo,e=d.pixelSize,f=d.extent,t=this.rasterInfo.storageInfo,h=t.blockWidth,l=t.blockHeight,u=t.maximumPyramidLevel,m=t.pyramidScalingFactor,x=t.origin,t=t.blockBoundary;a=D.projectPoint(a,d.spatialReference,c);if(!f.intersects(a)||0>b||b>u)return null;
f=Math.pow(m,b);m=t[b];u=Math.max(m.minRow,Math.min(m.maxRow,(x.y-a.y)/(f*e.y)/l));e=Math.max(m.minCol,Math.min(m.maxCol,(a.x-x.x)/(f*e.x)/h));return{pyramidLevel:b,row:Math.floor(u),col:Math.floor(e),rowOffset:Math.min(l-1,Math.floor((u-Math.floor(u))*l)),colOffset:Math.min(h-1,Math.floor((e-Math.floor(e))*h)),srcLocation:a}};u.prototype._getTileExtent=function(b,c,d,e){var f=e.origin,t=e.size[0],h=e.size[1];d=f.x+d*t*b.x;c=f.y-c*h*b.y;return new a.Extent({xmin:d,xmax:d+t*b.x,ymin:c-h*b.y,ymax:c,
spatialReference:e.spatialReference})};k([m.property(y.url)],u.prototype,"url",null);k([m.property({type:String,json:{write:!0}})],u.prototype,"datasetName",void 0);k([m.property({type:String,json:{write:!0}})],u.prototype,"datasetFormat",void 0);k([m.property()],u.prototype,"rasterInfo",void 0);k([m.property()],u.prototype,"ioConfig",void 0);return u=k([m.subclass("esri.layers.support.rasterDatasets.BaseRaster")],u)}(m.declared(B.EsriPromiseMixin(e.JSONSupport)))})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["require",
"exports","../../../geometry","../rasterFunctions/rasterProjectionHelper"],function(C,g,z,k){function b(b,a){if(!n.has(b))return null;b=n.get(b);return null==b[a]?null:b[a]}Object.defineProperty(g,"__esModule",{value:!0});var n=new Map;g.register=function(b,a){a={extent:null,rasterInfo:a,cache:new Map};if(n.has(b))return b=n.get(b),b.push(a),b.length-1;n.set(b,[a]);return 0};g.unregister=function(b,a){n.has(b)&&(n.get(b)[a]=null)};g.deleteRaster=function(b){n.delete(b)};g.getBlock=function(b,a,c){if(!n.has(b))return null;
var f=n.get(b);if(null==f[a]){for(var e=0;e<f.length;e++)if(f[e].cache.has(c))return f[e].cache.get(c);return null}b=f[a].cache;if(b.has(c))return b.get(c);for(e=0;e<f.length;e++)if(e!==a&&f[e]&&f[e].cache.has(c))return a=f[e].cache.get(c),b.set(c,a),a;return null};g.putBlock=function(b,a,c,f){if(!n.has(b))return null;b=n.get(b);if(null==b[a])return null;b[a].cache.set(c,f)};g.update=function(h,a,c,f,e,d,n){void 0===n&&(n=null);h=b(h,a);a=h.extent;var w=h.cache,l=h.rasterInfo;c=c.clone().normalize()[0];
if(!a||a.xmin!==c.xmin||a.xmax!==c.xmax||a.ymin!==c.ymin||a.ymax!==c.ymax){var m=l.spatialReference;a=k.projectExtent(c,m,n);f=new z.Point({x:f,y:f,spatialReference:c.spatialReference});if(null===e&&(e=k.projectResolution(f,m,c,n),!e))return;n=k.snapPyramid(e,l,d||"closest");e=n.pyramidLevel;d=n.pyramidResolution;if(!n.excessiveReading){m=Math.floor((a.xmin-l.storageInfo.origin.x)/d.x);n=Math.floor((l.storageInfo.origin.y-a.ymax)/d.y);var y=0<e?l.storageInfo.pyramidBlockWidth:l.storageInfo.blockWidth,
p=0<e?l.storageInfo.pyramidBlockHeight:l.storageInfo.blockHeight,l=Math.floor(m/y);f=Math.floor(n/p);m=Math.floor((m+Math.ceil((a.xmax-a.xmin)/d.x-.1)-1)/y);a=Math.floor((n+Math.ceil((a.ymax-a.ymin)/d.y-.1)-1)/p);var v=new Set;for(d=f-1;d<=a+1;d++)for(n=l-1;n<=m+1;n++)v.add(e+"/"+d+"/"+n);w.forEach(function(a,b){v.has(b)||w.delete(b)});h.extent={xmin:c.xmin,ymin:c.ymin,xmax:c.xmax,ymax:c.ymax}}}}})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d){Object.defineProperty(g,"__esModule",{value:!0});var B=function(a,b){var c=(a.isWGS84||a.isWebMercator)&&(b.isWGS84||b.isWebMercator);return!(a.equals(b)||c)};g.defaultGridSpacing=32;g.load=function(){return n(this,void 0,void 0,function(){return b(this,function(a){switch(a.label){case 0:return f.isLoaded()||!f.isSupported()?[2,null]:[4,f.load()];case 1:return a.sent(),[2]}})})};g.projectResolution=function(b,e,h,k){void 0===k&&(k=null);if(b.spatialReference.equals(e))return b;
var l=B(b.spatialReference,e);if(l&&!f.isLoaded())throw new c("rasterprojectionhelper-projectResolution","projection engine is not loaded");h=h.center;b=new a.Extent({xmin:h.x-b.x/2,xmax:h.x+b.x/2,ymin:h.y-b.y/2,ymax:h.y+b.y/2,spatialReference:b.spatialReference});k=l?f.project(b,e,k):d.project(b,e);return null==k?null:new a.Point(k.xmax-k.xmin,k.ymax-k.ymin,e)};g.projectPoint=function(a,b,e){void 0===e&&(e=null);if(a.spatialReference.equals(b))return a;var h=B(a.spatialReference,b);if(h&&!f.isLoaded())throw new c("rasterprojectionhelper-projectResolution",
"projection engine is not loaded");return h?f.project(a,b,e):d.project(a,b)};g.projectExtent=function(a,b,e){void 0===e&&(e=null);if(a.spatialReference.equals(b))return a;var h=B(a.spatialReference,b);if(h&&!f.isLoaded())throw new c("rasterprojectionhelper-projectExtent","projection engine is not loaded");return h?f.project(a,b,e):d.project(a,b)};g.getProjectionOffsetGrid=function(b,h,m,k,p,v){void 0===k&&(k=null);void 0===p&&(p=!1);void 0===v&&(v=[g.defaultGridSpacing,g.defaultGridSpacing]);var l=
h.spatialReference.equals(b.spatialReference),r=B(b.spatialReference,h.spatialReference);if(r&&!f.isLoaded())throw new c("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&h&&m))return null;var y=b.xmin,x=b.ymin,u=b.xmax,t=b.ymax,A=b.spatialReference,n=h.spatialReference,w=e.getInfo(A),H=w&&w.valid[0],F=w&&w.valid[1],I=v[0]*m.x,J=v[1]*m.y,u=Math.ceil((u-y)/I-.1)+1,x=Math.ceil((t-x)/J-.1)+1,P;m=[];var L;b=!1;for(var z=0;z<u;z++){for(var W=[],N=0;N<x;N++)P=new a.Point({x:y+
I*z,y:t-J*N,spatialReference:A}),P=l?P:r?f.project(P,n,k):d.project(P,n),W.push(P),0<z&&p&&P&&L[N]&&w&&P.x<L[N].x&&(P.x+=F-H),P?(m.push((P.x-h.xmin)/(h.xmax-h.xmin)),m.push((h.ymax-P.y)/(h.ymax-h.ymin))):(m.push(NaN),m.push(NaN),b=!0);L=W}h=[Math.abs((m[0]+m[4]+m[4*u]+m[4*u+4])/4-m[2*x+2]),Math.abs((m[1]+m[5]+m[4*x+1]+m[4*x+5])/4-m[2*x+3])];k=new Float32Array((u-1)*(x-1)*12);p=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(z=0;z<u-1;z++){for(N=0;N<x-1;N++){H=
z*x*2+2*N;r=m[H];y=m[H+1];t=m[H+2];L=m[H+3];H+=2*x;A=m[H];n=m[H+1];w=m[H+2];H=m[H+3];F=0;I=12*(N*(u-1)+z);for(J=0;3>J;J++)k[I++]=p[F++]*r+p[F++]*t+p[F++]*w;for(J=F=0;3>J;J++)k[I++]=p[F++]*y+p[F++]*L+p[F++]*H;for(J=F=0;3>J;J++)k[I++]=l[F++]*r+l[F++]*A+l[F++]*w;for(J=F=0;3>J;J++)k[I++]=l[F++]*y+l[F++]*n+l[F++]*H}if(b)for(N=0;N<k.length;N++)isNaN(k[N])&&(k[N]=-1)}return{offsets:m,error:h,coefficients:k,spacing:v,size:[u-1,x-1]}};g.snapPyramid=function(b,c,d){var e=Math.log(b.x/c.pixelSize.x)/Math.LN2,
f=Math.log(b.y/c.pixelSize.y)/Math.LN2;b=c.storageInfo.maximumPyramidLevel||0;d="down"===d?Math.floor(Math.min(e,f)):"up"===d?Math.ceil(Math.max(e,f)):Math.round((e+f)/2);e=!1;0>d?d=0:d>b&&(e=d>b+3,d=b);b=Math.pow(2,d);c=new a.Point({x:b*c.pixelSize.x,y:b*c.pixelSize.y,spatialReference:c.spatialReference});return{pyramidLevel:d,pyramidResolution:c,excessiveReading:e}}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),
function(C,g,z,k,b,n){function h(d,f,h,l,m){void 0===l&&(l=null);void 0===m&&(m=!1);if(null===l){var k=n.cacheKey(f,h);void 0!==e[k]?l=e[k]:(l=a(f,h,null),null===l&&(l=new n),e[k]=l)}return c._project(d,f,h instanceof b||!1===m?h:new b(h),l,m)}function a(a,b,e){void 0===e&&(e=null);a=c._getTransformation(a,b,e);return null!==a?n.fromGE(a):null}Object.defineProperty(g,"__esModule",{value:!0});var c=null;g.isLoaded=function(){return!!c&&k.isLoaded()};g.isSupported=function(){return k.isSupported()};
var f=null;g.load=function(){return f?f:f=z.create(function(a,b){var d=k.load();C(["./geometryEngine"],function(e){c=e;d.then(function(){c._enableProjection(k);a()},function(a){b(a)})})})};g.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:h(a,a[0].spatialReference,b,c):h([a],a.spatialReference,b,c)[0]};var e={};g.projectMany=h;g.getTransformation=a;g.getTransformations=function(a,b,e){void 0===e&&(e=null);a=c._getTransformationBySuitability(a,b,e);if(null!==
a){b=[];for(e=0;e<a.length;e++)b.push(n.fromGE(a[e]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(C,g,z,k,b){function n(a){function b(a,b,c){a[b]=c(a[b])}g._pe=a;d.init();B.init();w.init();l.init();m.init();g.PeGCSExtent=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}z(b,a);b.prototype.destroy=function(){g._pe.destroy(this)};return b}(g._pe.PeGCSExtent);for(var c=
0,e=[g._pe.PeDatum,g._pe.PeGeogcs,g._pe.PeGeogtran,g._pe.PeObject,g._pe.PeParameter,g._pe.PePrimem,g._pe.PeProjcs,g._pe.PeSpheroid,g._pe.PeUnit];c<e.length;c++)a=e[c],b(a.prototype,"getName",function(a){return function(){return a.call(this,Array(d.PE_NAME_MAX))}});c=0;for(e=[g._pe.PeGeogtran,g._pe.PeProjcs];c<e.length;c++)a=e[c],b(a.prototype,"getParameters",function(a){return function(){for(var b=Array(d.PE_PARM_MAX),c=a.call(this),e=0;e<b.length;e++){var f=g._pe.getValue(c,"*");b[e]=f?g._pe.wrapPointer(f,
g._pe.PeParameter):null;c+=Int32Array.BYTES_PER_ELEMENT}return b}});b(g._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],d=a.call(this);f(c,b,d);return c}});b(g._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var b=g._pe._pe_getPeGTlistExtendedGTsSize();return function(){var c=null,d=a.call(this);if(!g._pe.compare(d,g._pe.NULL)){var c=[d],e=this.getSteps();if(1<e)for(var d=g._pe.getPointer(d),f=1;f<e;f++)c.push(g._pe.wrapPointer(d+
b*f,g._pe.PeGTlistExtendedGTs))}return c}});var h=g._pe._pe_getPeHorizonSize();a=function(a){return function(){var b=this._cache;b||(this._cache=b=new Map);if(b.has(a))return b.get(a);var c=null,d=a.call(this);if(!g._pe.compare(d,g._pe.NULL)){var c=[d],e=d.getNump();if(1<e)for(var d=g._pe.getPointer(d),f=1;f<e;f++)c.push(g._pe.wrapPointer(d+h*f,g._pe.PeHorizon))}b.set(a,c);return c}};b(g._pe.PeProjcs.prototype,"horizonGcsGenerate",a);b(g._pe.PeProjcs.prototype,"horizonPcsGenerate",a);g._pe.PeObject.prototype.toString=
function(a){void 0===a&&(a=d.PE_STR_OPTS_NONE);g._pe.ensureCache.prepare();var b=g._pe.getPointer(this),c=g._pe.ensureInt8(Array(d.PE_BUFFER_MAX));return g._pe.UTF8ToString(g._pe._pe_object_to_string_ext(b,a,c))}}function h(a){if(a){var b=g._pe.getClass(a);b&&(b=g._pe.getCache(b))&&(a=g._pe.getPointer(a))&&delete b[a]}}function a(a,b){var c=[];b=Array(b);for(var d=0;d<a;d++)c.push(g._pe.ensureInt8(b));return c}function c(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):
b=a;return b}function f(a,b,c,d){void 0===d&&(d=!1);if(d)for(d=0;d<2*b;d++)a[d]=g._pe.getValue(c+d*Float64Array.BYTES_PER_ELEMENT,"double");else{var e=0===a.length;for(d=0;d<b;d++)e&&(a[d]=Array(2)),a[d][0]=g._pe.getValue(c,"double"),a[d][1]=g._pe.getValue(c+Float64Array.BYTES_PER_ELEMENT,"double"),c+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(g,"__esModule",{value:!0});var e;g._pe=null;g.isLoaded=function(){return!!g._pe};g.isSupported=function(){return!!k("esri-wasm")};g.load=function(){return e?
e:e=b.create(function(a,b){C(["./support/pe-wasm"],function(c){c({locateFile:function(a){return C.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){n(b);a()})})})};(function(a){function b(a,b,d){g._pe.ensureCache.prepare();var e=c(d),t=d===e,e=g._pe.ensureFloat64(e);(a=g._pe._pe_geog_to_proj(g._pe.getPointer(a),b,e))&&f(d,b,e,t);return a}function e(a,b,c){return h(a,b,c,0)}function h(a,b,d,e){g._pe.ensureCache.prepare();var t=c(d),h=d===t,t=g._pe.ensureFloat64(t);(a=g._pe._pe_proj_to_geog_center(g._pe.getPointer(a),
b,t,e))&&f(d,b,t,h);return a}a.geogToProj=b;a.projGeog=function(a,c,f,h){switch(h){case d.PE_TRANSFORM_P_TO_G:return e(a,c,f);case d.PE_TRANSFORM_G_TO_P:return b(a,c,f)}return 0};a.projToGeog=e;a.projToGeogCenter=h})(g.PeCSTransformations||(g.PeCSTransformations={}));var d;(function(a){a.init=function(){a.PE_BUFFER_MAX=g._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=g._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=g._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=g._pe.PeDefs.prototype.PE_USNG_MAX;
a.PE_DD_MAX=g._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=g._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=g._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=g._pe.PeDefs.prototype.PE_UTM_MAX;a.PE_PARM_MAX=g._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=g._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=g._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=g._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=g._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=g._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
a.PE_TYPE_UNIT=g._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=g._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=g._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=g._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=g._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=g._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=g._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=g._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=g._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
a.PE_TRANSFORM_P_TO_G=g._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=g._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=g._pe.PeDefs.prototype.PE_HORIZON_RECT;a.PE_HORIZON_POLY=g._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=g._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=g._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(d=g.PeDefs||(g.PeDefs={}));(function(a){function b(a,b){var d=null,f=e[a];f||(f={},e[a]=f);f.hasOwnProperty(String(b))?d=f[b]:(a=g._pe.PeFactory.prototype.factoryByType(a,
b),g._pe.compare(a,g._pe.NULL)||(d=a,f[b]=d));return d=c(d)}function c(a){if(a){var b=a.getType();switch(b){case d.PE_TYPE_GEOGCS:a=g._pe.castObject(a,g._pe.PeGeogcs);break;case d.PE_TYPE_PROJCS:a=g._pe.castObject(a,g._pe.PeProjcs);break;case d.PE_TYPE_GEOGTRAN:a=g._pe.castObject(a,g._pe.PeGeogtran);break;default:b&d.PE_TYPE_UNIT&&(a=g._pe.castObject(a,g._pe.PeUnit))}}return a}var e={},f={};a.initialize=function(){g._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return b(d.PE_TYPE_COORDSYS,
a)};a.factoryByType=b;a.fromString=function(a,b){var d=null,e=f[a];e||(e={},f[a]=e);e.hasOwnProperty(b)?d=e[b]:(a=g._pe.PeFactory.prototype.fromString(a,b),g._pe.compare(a,g._pe.NULL)||(d=a,e[b]=d));return d=c(d)};a.geogcs=function(a){return b(d.PE_TYPE_GEOGCS,a)};a.geogtran=function(a){return b(d.PE_TYPE_GEOGTRAN,a)};a.getCode=function(a){return g._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return b(d.PE_TYPE_PROJCS,a)};a.unit=function(a){return b(d.PE_TYPE_UNIT,a)}})(g.PeFactory||(g.PeFactory=
{}));g.PeGCSExtent=null;var B;(function(a){var b;a.init=function(){a.PE_GTLIST_OPTS_COMMON=g._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;b=g._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,c,d,e,f,h){var t=null,l=new g._pe.PeInteger(h);try{var m=g._pe.PeGTlistExtended.prototype.getGTlist(a,c,d,e,f,l);if(h=l.val)if(t=[m],1<h){var u=g._pe.getPointer(m);for(a=1;a<h;a++)t.push(g._pe.wrapPointer(u+b*a,g._pe.PeGTlistExtendedEntry))}}finally{g._pe.destroy(l)}return t}})(B=g.PeGTlistExtended||
(g.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var b=0;b<a.length;b++){var c=a[b];h(c);c.getEntries().forEach(function(a){h(a);a=a.getGeogtran();h(a);a.getParameters().forEach(h);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){h(a);var b=a.getDatum();h(b);h(b.getSpheroid());h(a.getPrimem());h(a.getUnit())})})}g._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(g.PeGTlistExtendedEntry||(g.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,b,d,e,
h){g._pe.ensureCache.prepare();var l=c(d),m=d===l,l=g._pe.ensureFloat64(l),t=0;e&&(t=g._pe.ensureFloat64(e));(a=g._pe._pe_geog_to_geog(g._pe.getPointer(a),b,l,t,h))&&f(d,b,l,m);return a}})(g.PeGTTransformations||(g.PeGTTransformations={}));(function(b){function e(b,e,f,h,l,t){g._pe.ensureCache.prepare();var m,u;switch(b){case "dd":m=g._pe._pe_geog_to_dd;u=d.PE_DD_MAX;break;case "ddm":m=g._pe._pe_geog_to_ddm;u=d.PE_DDM_MAX;break;case "dms":m=g._pe._pe_geog_to_dms,u=d.PE_DMS_MAX}b=0;e&&(b=g._pe.getPointer(e));
e=c(h);e=g._pe.ensureFloat64(e);u=a(f,u);h=g._pe.ensureInt32(u);if(l=m(b,f,e,l,h))for(m=0;m<f;m++)t[m]=g._pe.UTF8ToString(u[m]);return l}function h(a,b,c,d,e){g._pe.ensureCache.prepare();var h;switch(a){case "dd":h=g._pe._pe_dd_to_geog;break;case "ddm":h=g._pe._pe_ddm_to_geog;break;case "dms":h=g._pe._pe_dms_to_geog}a=0;b&&(a=g._pe.getPointer(b));b=d.map(function(a){return g._pe.ensureString(a)});d=g._pe.ensureInt32(b);b=g._pe.ensureFloat64(Array(2*c));(h=h(a,c,d,b))&&f(e,c,b);return h}b.geog_to_dms=
function(a,b,c,d,f){return e("dms",a,b,c,d,f)};b.dms_to_geog=function(a,b,c,d){return h("dms",a,b,c,d)};b.geog_to_ddm=function(a,b,c,d,f){return e("ddm",a,b,c,d,f)};b.ddm_to_geog=function(a,b,c,d){return h("ddm",a,b,c,d)};b.geog_to_dd=function(a,b,c,d,f){return e("dd",a,b,c,d,f)};b.dd_to_geog=function(a,b,c,d){return h("dd",a,b,c,d)}})(g.PeNotationDms||(g.PeNotationDms={}));var w;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=
g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=g._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=g._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,e,f,h,l,m,u){g._pe.ensureCache.prepare();var t=0;b&&(t=g._pe.getPointer(b));b=c(f);f=g._pe.ensureFloat64(b);b=a(e,d.PE_MGRS_MAX);var k=g._pe.ensureInt32(b);if(h=g._pe._pe_geog_to_mgrs_extended(t,
e,f,h,l,m,k))for(l=0;l<e;l++)u[l]=g._pe.UTF8ToString(b[l]);return h};b.mgrs_to_geog_extended=function(a,b,c,d,e){g._pe.ensureCache.prepare();var h=0;a&&(h=g._pe.getPointer(a));a=c.map(function(a){return g._pe.ensureString(a)});c=g._pe.ensureInt32(a);a=g._pe.ensureFloat64(Array(2*b));(d=g._pe._pe_mgrs_to_geog_extended(h,b,c,d,a))&&f(e,b,a);return d}})(w=g.PeNotationMgrs||(g.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,e,f,h,l,m,u){g._pe.ensureCache.prepare();var t=0;b&&(t=g._pe.getPointer(b));
b=c(f);f=g._pe.ensureFloat64(b);b=a(e,d.PE_MGRS_MAX);var k=g._pe.ensureInt32(b);if(h=g._pe._pe_geog_to_usng(t,e,f,h,l,m,k))for(l=0;l<e;l++)u[l]=g._pe.UTF8ToString(b[l]);return h};b.usng_to_geog=function(a,b,c,d){g._pe.ensureCache.prepare();var e=0;a&&(e=g._pe.getPointer(a));a=c.map(function(a){return g._pe.ensureString(a)});c=g._pe.ensureInt32(a);a=g._pe.ensureFloat64(Array(2*b));(e=g._pe._pe_usng_to_geog(e,b,c,a))&&f(d,b,a);return e}})(g.PeNotationUsng||(g.PeNotationUsng={}));var l;(function(b){b.init=
function(){b.PE_UTM_OPTS_NONE=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,e,f,h,l){g._pe.ensureCache.prepare();var m=0;b&&(m=g._pe.getPointer(b));b=c(f);f=g._pe.ensureFloat64(b);b=a(e,d.PE_UTM_MAX);var u=g._pe.ensureInt32(b);if(h=g._pe._pe_geog_to_utm(m,e,f,h,u))for(m=0;m<e;m++)l[m]=g._pe.UTF8ToString(b[m]);return h};b.utm_to_geog=
function(a,b,c,d,e){g._pe.ensureCache.prepare();var h=0;a&&(h=g._pe.getPointer(a));a=c.map(function(a){return g._pe.ensureString(a)});c=g._pe.ensureInt32(a);a=g._pe.ensureFloat64(Array(2*b));(d=g._pe._pe_utm_to_geog(h,b,c,d,a))&&f(e,b,a);return d}})(l=g.PeNotationUtm||(g.PeNotationUtm={}));var m;(function(a){var b=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=
g._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=g._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(c,d){void 0===d&&(d=a.PE_PCSINFO_OPTION_DOMAIN);var e,f;b.has(c)&&(f=b.get(c),f[d]&&(e=f[d]));e||(e=g._pe.PePCSInfo.prototype.generate(c,d),f||(f=[],b.set(c,f)),f[d]=e);return e}})(m=g.PePCSInfo||(g.PePCSInfo={}));(function(a){a.version_string=function(){return g._pe.PeVersion.prototype.version_string()}})(g.PeVersion||(g.PeVersion={}));g._init=n})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(C,g,z){return function(){function k(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var k=0;for(b=b.steps;k<b.length;k++){var h=b[k];h instanceof z?this.steps.push(h):this.steps.push(new z({wkid:h.wkid,wkt:h.wkt,isInverse:h.isInverse}))}}}k.cacheKey=function(b,k){return[void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():"",void 0!==k.wkid&&null!==k.wkid?
k.wkid.toString():"-1",void 0!==k.wkt&&null!==k.wkt?k.wkt.toString():""].join()};k.fromGE=function(b){var n=new k,h="",a=0;for(b=b.steps;a<b.length;a++){var c=z.fromGE(b[a]);n.steps.push(c);h+=c.uid.toString()+","}n._cached_projection={};n._gtlistentry=null;n._chain=h;return n};k.prototype.getInverse=function(){var b=new k;b.steps=[];for(var n=this.steps.length-1;0<=n;n--)b.steps.push(this.steps[n].getInverse());return b};k.prototype.getGTListEntry=function(){for(var b="",k=0,h=this.steps;k<h.length;k++)b+=
h[k].uid.toString()+",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);return this._gtlistentry};k.prototype.assignCachedGe=function(b,n,h){this._cached_projection[k.cacheKey(b,n)]=h};k.prototype.getCachedGeTransformation=function(b,n){for(var h="",a=0,c=this.steps;a<c.length;a++)h+=c[a].uid.toString()+",";h!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=h);b=this._cached_projection[k.cacheKey(b,n)];return void 0===b?null:b};return k}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(C,g){var z=0;return function(){function k(b){void 0===b&&(b=null);this.uid=z++;b?(this._wkt=void 0!==b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}k.fromGE=function(b){var n=new k;n._wkt=b.wkt;n._wkid=b.wkid;n._isInverse=b.isInverse;return n};Object.defineProperty(k.prototype,"wkt",
{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=z++},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=b;this.uid=z++},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=z++},enumerable:!0,configurable:!0});k.prototype.getInverse=function(){var b=new k;b._wkt=this.wkt;b._wkid=this._wkid;
b._isInverse=!this.isInverse;return b};return k}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),function(C,g,z,k,b,n,h,a,c,f,e,d,B,w){function l(a,b){if(!u)throw new n("rasterCoded:decode","lerc decoder is not supported on big endian platform");
var c=b.width,d=b.height,f=b.pixelType,t=x(f),l=t.pixelTypeCtor;b=null==b.noDataValue?t.noDataValue:b.noDataValue;for(var t=0,m,k=0,p,q=a.byteLength-10;k<q;){var A=e.decode(a,{inputOffset:k,encodedMaskData:m,returnMask:0===t?!0:!1,returnEncodedMask:0===t?!0:!1,returnFileInfo:!0,pixelType:l,noDataValue:b});if(c&&d&&(A.width!==c||A.height!==d))throw new n("rasterCoded:decode","lerc decoded result has width or height different from specified in options");k=A.fileInfo.eofOffset;0===t&&(m=A.encodedMaskData,
p=new h({width:A.width,height:A.height,pixels:[],pixelType:f,mask:A.maskData,statistics:[]}));t++;p.addData({pixels:A.pixelData,statistics:{minValue:A.minValue,maxValue:A.maxValue,noDataValue:A.noDataValue}});10<q-k&&(A=String.fromCharCode.apply(null,new Uint8Array(a,k,10)),k=-1<k+A.indexOf("CntZ")?A.indexOf("CntZ"):0)}return p}function m(a,b){if(!u)throw new n("rasterCoded:decode","lerc decoder is not supported on big endian platform");var c=0,d=0,e=0,t,l,m,k=a.byteLength-10,x=[],p=b.width;for(b=
b.height;d<k;){l=f.decode(a,{inputOffset:d,maskData:t,returnFileInfo:!0});if(p&&b&&(l.width!==p||l.height!==b))throw new n("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");d=l.fileInfo.eofOffset;0===c&&(e=l.fileInfo.numValidPixel,t=l.maskData,m=new h({width:l.width,height:l.height,pixels:[],pixelType:l.fileInfo.pixelType,mask:l.maskData,statistics:[]}));l.fileInfo.mask&&0<l.fileInfo.mask.numBytes&&x.push(l.maskData);c++;m.addData({pixels:l.pixelData,
statistics:{minValue:l.minValue,maxValue:l.maxValue}});10<k-d&&(l=String.fromCharCode.apply(null,new Uint8Array(a,d,10)),d+=-1<l.indexOf("Lerc")?l.indexOf("Lerc"):0)}d=c=a=0;if(1<x.length){d=m.width*m.height;t=new Uint8Array(d);t.set(x[0]);for(a=1;a<x.length;a++)for(e=x[a],c=0;c<d;c++)t[c]&=e[c];for(c=e=0;c<d;c++)e+=t[c];m.mask=t}m.validPixelCount=e;return m}function y(a){a=w.decode(a);a=new h({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});
a.updateStatistics();return a}function p(a){a=c.decode(a);a=new h({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function v(a,b){a=new Uint8Array(a);var c=new d(a);a=b.width;var e=b.height;b=a*e;for(var c=c.decode(),f=0,t=0,t=new Uint8Array(b),f=0;f<b;f++)t[f]=c[4*f+3];e=new h({width:a,height:e,pixels:[],pixelType:"U8",mask:t,statistics:[]});for(f=0;3>f;f++){a=new Uint8Array(b);for(t=0;t<b;t++)a[t]=c[4*t+f];e.addData({pixels:a})}e.updateStatistics();
return e}function q(c,d,e){return k(this,void 0,void 0,function(){var f,t,l,m;return z(this,function(k){switch(k.label){case 0:return f=new a,t=b({applyJpegMask:!1},d),[4,f.decode(c,t,e)];case 1:return l=k.sent(),m=new h(l),m.updateStatistics(),[2,m]}})})}function r(a){if(null==a)throw new n("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="png":67===a[0]&&110===a[1]&&116===a[2]&&
90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?b="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?b="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="error");return b}function D(a){var b=null;switch(a){case "lerc":b=l;break;case "lerc2":b=m;break;case "jpg":b=p;break;case "png":b=v;break;case "bsq":case "bip":b=function(b,
c){var d=x(c.pixelType).pixelTypeCtor,e=B.decode;b=e(b,{width:c.width,height:c.height,pixelType:d,format:a});c=new h({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,mask:b.mask,statistics:null});c.updateStatistics();return c};break;case "tiff":b=y;break;case "error":b=function(){throw new n("rasterCodec:decode","input data contains error");};break;default:b=function(){throw new n("rasterCodec:decode","unsupported raster format");}}return b}function x(a){var b=null,c=null;switch(a?
a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":c=Math.pow(2,8)-1;b=Uint8Array;break;case "u16":c=c||Math.pow(2,16)-1;b=Uint16Array;break;case "u32":c=c||Math.pow(2,32)-1;b=Uint32Array;break;case "s8":c=c||0-Math.pow(2,7);b=Int8Array;break;case "s16":c=c||0-Math.pow(2,15);b=Int16Array;break;case "s32":c=c||0-Math.pow(2,31);b=Int32Array;break;default:b=Float32Array}return{pixelTypeCtor:b,noDataValue:c}}var u=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=
1;return 1===b[0]}();return function(){function a(){}a.getFormat=function(a){a=r(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,c,d){return k(this,void 0,void 0,function(){var e,f,l;return z(this,function(t){switch(t.label){case 0:if(null==a)throw new n("rasterCodec:decode","missing encodeddata parameter.");if(null==c||null==c.width||null==c.height)throw new n("rasterCodec:decode","requires width and height in options parameter.");e=c.format&&c.format.toLowerCase();if("tiff"===
e&&c.customOptions)return t=w.decodeTileOrStrip(a,c.customOptions),t=new h({width:t.width,height:t.height,pixels:t.pixels,pixelType:t.pixelType.toLowerCase(),mask:t.mask,statistics:null}),t.updateStatistics(),[2,t];if(!e||"bsq"!==e&&"bip"!==e)e=r(a);return!c.useCanvas||"jpg"!==e&&"png"!==e?[3,2]:[4,q(a,c,d)];case 1:return l=t.sent(),[3,3];case 2:f=D(e);c.isPoint&&(c=b({},c),c.width++,c.height++);l=f(a,c);if(c.isPoint){var m=l,k=void 0;void 0===k&&(k=1);if(m){var u=m.pixels,x=m.width,p=m.mask;if(u&&
0!==u.length){var v=u.length,g=x-1,A=m.height-1,G=[],B,y,E,H,F,I,J=h.getPixelArrayConstructor(m.pixelType);if(0===k){for(k=0;k<v;k++){H=u[k];F=new J(g*A);for(B=0;B<A;B++)for(E=B*x,y=0;y<g;y++)F[B*g+y]=H[E+y];G.push(F)}if(p)for(I=new Uint8Array(g*A),B=0;B<A;B++)for(E=B*x,y=0;y<g;y++)I[B*g+y]=p[E+y]}else{for(k=0;k<v;k++){H=u[k];F=new J(g*A);for(B=0;B<A;B++)for(E=B*x,y=0;y<g;y++)F[B*g+y]=(H[E+y]+H[E+y+1]+H[E+x+y]+H[E+x+y+1])/4;G.push(F)}if(p)for(I=new Uint8Array(g*A),B=0;B<A;B++)for(E=B*x,y=0;y<g;y++)I[B*
g+y]=Math.min.apply(null,[p[E+y],p[E+y+1],p[E+x+y],p[E+x+y+1]])}m.width=g;m.height=A;m.mask=I;m.pixels=G}}}t.label=3;case 3:return[2,l]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),function(C,g,z,k,b,n){return function(){function h(a){a&&(this.canvas=a.canvas,this.ctx=a.ctx||a.canvas&&a.canvas.getContext("2d"))}h.getFormat=function(a){if(!a||
10>a.byteLength)return"";a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(b="png");return b};h.prototype.decode=function(a,c,f){var e=this;if(!a||10>a.byteLength)throw new z("imagecanvasdecoder: decode","required a valid encoded data as input.");var d=h.getFormat(a);if(""===d)throw new z("imagecanvasdecoder: decode","encoded data format is not a supported format (jpeg or png).");var n=c.width,g=c.height,l=c.applyJpegMask;if(l&&(!n||!g))throw new z("imagecanvasdecoder: decode",
"image width and height are needed to apply jpeg mask directly to canvas");return k.create(function(m,w){var p=null;"jpeg"===d&&l&&(p=h.getMask(a,c));var v=new Blob([new Uint8Array(a)],{type:"image/"+d}),q=URL.createObjectURL(v),r=new Image,B;r.src=q;r.onload=function(){URL.revokeObjectURL(q);if(k.isAborted(f))w(b.createAbortError());else{n=r.width;g=r.height;if(e.canvas){if(e.canvas.width!==n||e.canvas.height!==g)e.canvas.width=n,e.canvas.height=g;e.ctx.clearRect(0,0,n,g)}else e.canvas=document.createElement("canvas"),
e.canvas.width=n,e.canvas.height=g,e.ctx=e.canvas.getContext("2d");e.ctx.drawImage(r,0,0);var a=e.ctx.getImageData(0,0,n,g);B=a.data;var d;if(c.renderOnCanvas){if(p)for(d=0;d<p.length;d++)B[4*d+3]=p[d]?255:0;e.ctx.putImageData(a,0,0);m(null)}else{var a=n*g,h=new Uint8Array(a),l=new Uint8Array(a),v=new Uint8Array(a);if(p)for(d=0;d<a;d++)h[d]=B[4*d],l[d]=B[4*d+1],v[d]=B[4*d+2];else for(p=new Uint8Array(a),d=0;d<a;d++)h[d]=B[4*d],l[d]=B[4*d+1],v[d]=B[4*d+2],p[d]=B[4*d+3];m({width:n,height:g,pixels:[h,
l,v],mask:p,pixelType:"u8"})}}};r.onerror=function(){URL.revokeObjectURL(q);w("cannot load image")}})};h.getMask=function(a,b){var c=null;try{var e=new Uint8Array(a);a=0;var d=e.length-2;for(a=Math.ceil(e.length/2);a<d&&(255!==e[a]||217!==e[a+1]);a++);a+=2;if(a<e.length-1)for(var h=(new n(e.subarray(a))).getBytes(),c=new Uint8Array(b.width*b.height),e=b=0;e<h.length;e++)for(d=7;0<=d;d--)c[b++]=h[e]>>d&1}catch(w){}return c};return h}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],
function(){var C=function(){function g(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}g.prototype={ensureBuffer:function(g){var k=this.buffer,b=k?k.byteLength:0;if(g<b)return k;for(var n=512;n<g;)n<<=1;g=new Uint8Array(n);for(n=0;n<b;++n)g[n]=k[n];return this.buffer=g},getByte:function(){for(var g=this.pos;this.bufferLength<=g;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(g){var k=this.pos;if(g){this.ensureBuffer(k+g);for(g=k+g;!this.eof&&
this.bufferLength<g;)this.readBlock();var b=this.bufferLength;g>b&&(g=b)}else{for(;!this.eof;)this.readBlock();g=this.bufferLength}this.pos=g;return this.buffer.subarray(k,g)},lookChar:function(){for(var g=this.pos;this.bufferLength<=g;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var g=this.pos;this.bufferLength<=g;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(g,
k,b){for(var n=g+k;this.bufferLength<=n&&!this.eof;)this.readBlock();return new Stream(this.buffer,g,k,b)},skip:function(g){g||(g=1);this.pos+=g},reset:function(){this.pos=0}};return g}();return function(){function g(a){throw Error(a);}function z(a){var b=0,c=a[b++],d=a[b++];-1!=c&&-1!=d||g("Invalid header in flate stream");8!=(c&15)&&g("Unknown compression method in flate stream");0!=((c<<8)+d)%31&&g("Bad FCHECK in flate stream");d&32&&g("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=
b;this.codeBuf=this.codeSize=0;C.call(this)}if(!self||!self.Uint32Array)return null;var k=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),n=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,
724993,727041,794625,798721,868353,876545]),h=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,
590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,
590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,
590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,
590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,
590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,
590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,
590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];z.prototype=Object.create(C.prototype);z.prototype.getBits=function(a){for(var b=this.codeSize,c=this.codeBuf,d=this.bytes,h=this.bytesPos,
k;b<a;)"undefined"==typeof(k=d[h++])&&g("Bad encoding in flate stream"),c|=k<<b,b+=8;this.codeBuf=c>>a;this.codeSize=b-=a;this.bytesPos=h;return c&(1<<a)-1};z.prototype.getCode=function(a){var b=a[0],c=a[1];a=this.codeSize;for(var d=this.codeBuf,h=this.bytes,k=this.bytesPos;a<c;){var l;"undefined"==typeof(l=h[k++])&&g("Bad encoding in flate stream");d|=l<<a;a+=8}c=b[d&(1<<c)-1];b=c>>16;c&=65535;(0==a||a<b||0==b)&&g("Bad encoding in flate stream");this.codeBuf=d>>b;this.codeSize=a-b;this.bytesPos=
k;return c};z.prototype.generateHuffmanTable=function(a){for(var b=a.length,c=0,d=0;d<b;++d)a[d]>c&&(c=a[d]);for(var h=1<<c,k=new Uint32Array(h),l=1,m=0,g=2;l<=c;++l,m<<=1,g<<=1)for(var p=0;p<b;++p)if(a[p]==l){for(var n=0,q=m,d=0;d<l;++d)n=n<<1|q&1,q>>=1;for(d=n;d<h;d+=g)k[d]=l<<16|p;++m}return[k,c]};z.prototype.readBlock=function(){function c(a,b,c,d,e){for(a=a.getBits(c)+d;0<a--;)b[m++]=e}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var e=this.bytes,d=this.bytesPos,B;"undefined"==typeof(B=
e[d++])&&g("Bad block header in flate stream");var w=B;"undefined"==typeof(B=e[d++])&&g("Bad block header in flate stream");w|=B<<8;"undefined"==typeof(B=e[d++])&&g("Bad block header in flate stream");f=B;"undefined"==typeof(B=e[d++])&&g("Bad block header in flate stream");(f|B<<8)!=(~w&65535)&&g("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;B=this.bufferLength;f=this.ensureBuffer(B+w);this.bufferLength=w=B+w;for(var l=B;l<w;++l){if("undefined"==typeof(B=e[d++])){this.eof=
!0;break}f[l]=B}this.bytesPos=d}else{if(1==f)d=h,B=a;else if(2==f){f=this.getBits(5)+257;B=this.getBits(5)+1;for(var e=this.getBits(4)+4,d=Array(k.length),m=0;m<e;)d[k[m++]]=this.getBits(3);d=this.generateHuffmanTable(d);m=e=0;B=f+B;for(w=Array(B);m<B;)l=this.getCode(d),16==l?c(this,w,2,3,e):17==l?c(this,w,3,3,e=0):18==l?c(this,w,7,11,e=0):w[m++]=e=l;d=this.generateHuffmanTable(w.slice(0,f));B=this.generateHuffmanTable(w.slice(f,B))}else g("Unknown block type in flate stream");w=(f=this.buffer)?f.length:
0;for(l=this.bufferLength;;){var y=this.getCode(d);if(256>y)l+1>=w&&(f=this.ensureBuffer(l+1),w=f.length),f[l++]=y;else{if(256==y){this.bufferLength=l;break}var y=y-257,y=b[y],p=y>>16;0<p&&(p=this.getBits(p));e=(y&65535)+p;y=this.getCode(B);y=n[y];p=y>>16;0<p&&(p=this.getBits(p));y=(y&65535)+p;l+e>=w&&(f=this.ensureBuffer(l+e),w=f.length);for(p=0;p<e;++p,++l)f[l]=f[l-y]}}}};return z}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require","exports","./Jpg","./Zlib"],function(C,
g,z,k){return function(){function b(){}b.decode=function(b){var h=new Uint8Array(b),a=new z;a.parse(h);b=a.width;var c=a.height,f=a.numComponents,e=a.eof,a=a.getData(b,c,!0),d,g=b*c,n=0,l=0,m=0;if(e<h.length-1)for(h=(new k(h.subarray(e))).getBytes(),d=new Uint8Array(g),n=e=0;n<h.length;n++)for(m=7;0<=m;m--)d[e++]=h[n]>>m&1;h=null;if(1===f)h=[a,a,a];else{h=[];for(n=0;3>n;n++)f=new Uint8Array(g),h.push(f);for(l=m=0;l<g;l++)for(n=0;3>n;n++)h[n][l]=a[m++]}return{width:b,height:c,pixels:h,mask:d}};return b}()})},
"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var C=function(){function g(g){this.message="JPEG error: "+g}g.prototype=Error();g.prototype.name="JpegError";return g.constructor=g}();return function(){function g(){this.decodeTransform=null;this.colorTransform=-1}function z(a,b){for(var c=0,e=[],d,h,k=16;0<k&&!a[k-1];)k--;e.push({children:[],index:0});var l=e[0],m;for(d=0;d<k;d++){for(h=0;h<a[d];h++){l=e.pop();for(l.children[l.index]=b[c];0<l.index;)l=e.pop();l.index++;for(e.push(l);e.length<=
d;)e.push(m={children:[],index:0}),l.children[l.index]=m.children,l=m;c++}d+1<k&&(e.push(m={children:[],index:0}),l.children[l.index]=m.children,l=m)}return e[0].children}function k(a,b,f,e,d,k,g,l,m){function c(){if(0<H)return H--,G>>H&1;G=a[b++];if(255===G){var c=a[b++];if(c)throw new C("unexpected marker "+(G<<8|c).toString(16));}H=7;return G>>>7}function p(a){for(;;){a=a[c()];if("number"===typeof a)return a;if("object"!==typeof a)throw new C("invalid huffman sequence");}}function v(a){for(var b=
0;0<a;)b=b<<1|c(),a--;return b}function q(a){if(1===a)return 1===c()?1:-1;var b=v(a);return b>=1<<a-1?b:b+(-1<<a)+1}function r(a,b){var c=p(a.huffmanTableDC),c=0===c?0:q(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var d=p(a.huffmanTableAC),e=d&15,d=d>>4;if(0===e){if(15>d)break;c+=16}else c+=d,a.blockData[b+h[c]]=q(e),c++}}function w(a,b){var c=p(a.huffmanTableDC),c=0===c?0:q(c)<<m;a.blockData[b]=a.pred+=c}function x(a,b){a.blockData[b]|=c()<<m}function u(a,b){if(0<F)F--;else for(var c=k;c<=g;){var d=
p(a.huffmanTableAC),e=d&15,d=d>>4;if(0===e){if(15>d){F=v(d)+(1<<d)-1;break}c+=16}else c+=d,a.blockData[b+h[c]]=q(e)*(1<<m),c++}}function t(a,b){for(var d=k,e=0,f;d<=g;){f=h[d];switch(I){case 0:e=p(a.huffmanTableAC);f=e&15;e>>=4;if(0===f)15>e?(F=v(e)+(1<<e),I=4):(e=16,I=1);else{if(1!==f)throw new C("invalid ACn encoding");J=q(f);I=e?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=c()<<m:(e--,0===e&&(I=2===I?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=c()<<m:(a.blockData[b+f]=
J<<m,I=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=c()<<m)}d++}4===I&&(F--,0===F&&(I=0))}var A=f.mcusPerLine,B=b,G=0,H=0,F=0,I=0,J,P=e.length,L,z,W,N,O;l=f.progressive?0===k?0===l?w:x:0===l?u:t:r;var S=0;f=1===P?e[0].blocksPerLine*e[0].blocksPerColumn:A*f.mcusPerColumn;for(var T,R;S<f;){var K=d?Math.min(f-S,d):f;for(z=0;z<P;z++)e[z].pred=0;F=0;if(1===P)for(L=e[0],O=0;O<K;O++)l(L,64*((L.blocksPerLine+1)*(S/L.blocksPerLine|0)+S%L.blocksPerLine)),S++;else for(O=0;O<K;O++){for(z=0;z<P;z++)for(L=
e[z],T=L.h,R=L.v,W=0;W<R;W++)for(N=0;N<T;N++)l(L,64*((L.blocksPerLine+1)*((S/A|0)*L.v+W)+(S%A*L.h+N)));S++}H=0;(L=n(a,b))&&L.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+L.invalid),b=L.offset);L=L&&L.marker;if(!L||65280>=L)throw new C("marker was not found");if(65488<=L&&65495>=L)b+=2;else break}(L=n(a,b))&&L.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+L.invalid),b=L.offset);return b-B}function b(a,b){a=b.blocksPerLine;for(var c=b.blocksPerColumn,
e=new Int16Array(64),d=0;d<c;d++)for(var h=0;h<a;h++){var k=64*((b.blocksPerLine+1)*d+h),l=e,m=b.quantizationTable,g=b.blockData,p=void 0,n=void 0,q=void 0,r=void 0,D=void 0,x=void 0,u=void 0,t=void 0,A=void 0,E=t=void 0,G=u=n=x=void 0,H=void 0,A=void 0;if(!m)throw new C("missing required Quantization Table.");for(var F=0;64>F;F+=8)A=g[k+F],t=g[k+F+1],E=g[k+F+2],x=g[k+F+3],n=g[k+F+4],u=g[k+F+5],G=g[k+F+6],H=g[k+F+7],A*=m[F],0===(t|E|x|n|u|G|H)?(A=5793*A+512>>10,l[F]=A,l[F+1]=A,l[F+2]=A,l[F+3]=A,l[F+
4]=A,l[F+5]=A,l[F+6]=A,l[F+7]=A):(t*=m[F+1],E*=m[F+2],x*=m[F+3],n*=m[F+4],u*=m[F+5],G*=m[F+6],H*=m[F+7],p=5793*A+128>>8,n=5793*n+128>>8,q=E,r=G,D=2896*(t-H)+128>>8,t=2896*(t+H)+128>>8,x<<=4,u<<=4,p=p+n+1>>1,n=p-n,A=3784*q+1567*r+128>>8,q=1567*q-3784*r+128>>8,r=A,D=D+u+1>>1,u=D-u,t=t+x+1>>1,x=t-x,p=p+r+1>>1,r=p-r,n=n+q+1>>1,q=n-q,A=2276*D+3406*t+2048>>12,D=3406*D-2276*t+2048>>12,t=A,A=799*x+4017*u+2048>>12,x=4017*x-799*u+2048>>12,u=A,l[F]=p+t,l[F+7]=p-t,l[F+1]=n+u,l[F+6]=n-u,l[F+2]=q+x,l[F+5]=q-x,
l[F+3]=r+D,l[F+4]=r-D);for(m=0;8>m;++m)A=l[m],t=l[m+8],E=l[m+16],x=l[m+24],n=l[m+32],u=l[m+40],G=l[m+48],H=l[m+56],0===(t|E|x|n|u|G|H)?(A=5793*A+8192>>14,A=-2040>A?0:2024<=A?255:A+2056>>4,g[k+m]=A,g[k+m+8]=A,g[k+m+16]=A,g[k+m+24]=A,g[k+m+32]=A,g[k+m+40]=A,g[k+m+48]=A,g[k+m+56]=A):(p=5793*A+2048>>12,n=5793*n+2048>>12,q=E,r=G,D=2896*(t-H)+2048>>12,t=2896*(t+H)+2048>>12,p=(p+n+1>>1)+4112,n=p-n,A=3784*q+1567*r+2048>>12,q=1567*q-3784*r+2048>>12,r=A,D=D+u+1>>1,u=D-u,t=t+x+1>>1,x=t-x,p=p+r+1>>1,r=p-r,n=
n+q+1>>1,q=n-q,A=2276*D+3406*t+2048>>12,D=3406*D-2276*t+2048>>12,t=A,A=799*x+4017*u+2048>>12,x=4017*x-799*u+2048>>12,u=A,A=p+t,H=p-t,t=n+u,G=n-u,E=q+x,u=q-x,x=r+D,n=r-D,A=16>A?0:4080<=A?255:A>>4,t=16>t?0:4080<=t?255:t>>4,E=16>E?0:4080<=E?255:E>>4,x=16>x?0:4080<=x?255:x>>4,n=16>n?0:4080<=n?255:n>>4,u=16>u?0:4080<=u?255:u>>4,G=16>G?0:4080<=G?255:G>>4,H=16>H?0:4080<=H?255:H>>4,g[k+m]=A,g[k+m+8]=t,g[k+m+16]=E,g[k+m+24]=x,g[k+m+32]=n,g[k+m+40]=u,g[k+m+48]=G,g[k+m+56]=H)}return b.blockData}function n(a,
b,f){var c=a.length-1;f=f<b?f:b;if(b>=c)return null;var d=a[b]<<8|a[b+1];if(65472<=d&&65534>=d)return{invalid:null,marker:d,offset:b};for(b=a[f]<<8|a[f+1];!(65472<=b&&65534>=b);){if(++f>=c)return null;b=a[f]<<8|a[f+1]}return{invalid:d.toString(16),marker:b,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var h=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,
54,47,55,62,63]);g.prototype={parse:function(a){function c(){var b=a[d]<<8|a[d+1];d+=2;return b}function f(){var b=c(),b=d+b-2,e=n(a,b,d);e&&e.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+e.invalid),b=e.offset);b=a.subarray(d,b);d+=b.length;return b}function e(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){E=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*E.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/
8)*E.v/a.maxV);E.blockData=new Int16Array(64*c*E.v*(b*E.h+1));E.blocksPerLine=e;E.blocksPerColumn=f}a.mcusPerLine=b;a.mcusPerColumn=c}var d=0,g=null,w=null,l,m,y=[],p=[],v=[],q=c();if(65496!==q)throw new C("SOI not found");for(q=c();65497!==q;){var r,D;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:r=f();65504===q&&74===r[0]&&70===r[1]&&73===r[2]&&70===
r[3]&&0===r[4]&&(g={version:{major:r[5],minor:r[6]},densityUnits:r[7],xDensity:r[8]<<8|r[9],yDensity:r[10]<<8|r[11],thumbWidth:r[12],thumbHeight:r[13],thumbData:r.subarray(14,14+3*r[12]*r[13])});65518===q&&65===r[0]&&100===r[1]&&111===r[2]&&98===r[3]&&101===r[4]&&(w={version:r[5]<<8|r[6],flags0:r[7]<<8|r[8],flags1:r[9]<<8|r[10],transformCode:r[11]});break;case 65499:for(var q=c()+d-2,x;d<q;){var u=a[d++],t=new Uint16Array(64);if(0===u>>4)for(r=0;64>r;r++)x=h[r],t[x]=a[d++];else if(1===u>>4)for(r=
0;64>r;r++)x=h[r],t[x]=c();else throw new C("DQT - invalid table spec");y[u&15]=t}break;case 65472:case 65473:case 65474:if(l)throw new C("Only single frame JPEGs supported");c();l={};l.extended=65473===q;l.progressive=65474===q;l.precision=a[d++];l.scanLines=c();l.samplesPerLine=c();l.components=[];l.componentIds={};r=a[d++];for(q=t=u=0;q<r;q++){x=a[d];D=a[d+1]>>4;var A=a[d+1]&15;u<D&&(u=D);t<A&&(t=A);D=l.components.push({h:D,v:A,quantizationId:a[d+2],quantizationTable:null});l.componentIds[x]=D-
1;d+=3}l.maxH=u;l.maxV=t;e(l);break;case 65476:x=c();for(q=2;q<x;){u=a[d++];t=new Uint8Array(16);for(r=D=0;16>r;r++,d++)D+=t[r]=a[d];A=new Uint8Array(D);for(r=0;r<D;r++,d++)A[r]=a[d];q+=17+D;(0===u>>4?v:p)[u&15]=z(t,A)}break;case 65501:c();m=c();break;case 65498:c();x=a[d++];r=[];for(var E,q=0;q<x;q++)u=l.componentIds[a[d++]],E=l.components[u],u=a[d++],E.huffmanTableDC=v[u>>4],E.huffmanTableAC=p[u&15],r.push(E);q=a[d++];x=a[d++];u=a[d++];q=k(a,d,l,r,m,q,x,u>>4,u&15);d+=q;break;case 65535:255!==a[d]&&
d--;break;default:if(255===a[d-3]&&192<=a[d-2]&&254>=a[d-2])d-=3;else throw new C("unknown marker "+q.toString(16));}q=c()}this.width=l.samplesPerLine;this.height=l.scanLines;this.jfif=g;this.eof=d;this.adobe=w;this.components=[];for(q=0;q<l.components.length;q++){E=l.components[q];if(g=y[E.quantizationId])E.quantizationTable=g;this.components.push({output:b(l,E),scaleX:E.h/l.maxH,scaleY:E.v/l.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,b){var c=this.width/a,e=this.height/b,d,h,k,l,m,g,n=0,v,q=this.components.length,r=a*b*q,D=new Uint8ClampedArray(r),x=new Uint32Array(a);for(g=0;g<q;g++){d=this.components[g];h=d.scaleX*c;k=d.scaleY*e;n=g;v=d.output;l=d.blocksPerLine+1<<3;for(m=0;m<a;m++)d=0|m*h,x[m]=(d&4294967288)<<3|d&7;for(h=0;h<b;h++)for(d=0|h*k,d=l*(d&4294967288)|(d&7)<<3,m=0;m<a;m++)D[n]=v[d+x[m]],n+=q}if(b=this.decodeTransform)for(g=0;g<r;)for(a=d=0;d<q;d++,g++,a+=2)D[g]=(D[g]*b[a]>>8)+b[a+
1];return D},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,f,e,d=0,h=a.length;d<h;d+=3)b=a[d],f=a[d+1],e=a[d+2],a[d]=b-179.456+1.402*e,a[d+1]=b+135.459-.344*f-.714*e,a[d+2]=b-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var b,f,e,d,h=0,k=0,l=a.length;k<l;k+=4)b=a[k],f=a[k+1],e=a[k+2],d=a[k+3],a[h++]=-122.67195406894+f*(-6.60635669420364E-5*
f+4.37130475926232E-4*e-5.4080610064599E-5*b+4.8449797120281E-4*d-.154362151871126)+e*(-9.57964378445773E-4*e+8.17076911346625E-4*b-.00477271405408747*d+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*d+.48357088451265)+d*(-3.36197177618394E-4*d+.484791561490776),a[h++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*e+6.59397001245577E-4*b+4.26105652938837E-4*d-.176491792462875)+e*(-7.78269941513683E-4*e+.00130872261408275*b+7.70482631801132E-4*d-.151051492775562)+b*(.00126935368114843*
b-.00265090189010898*d+.25802910206845)+d*(-3.18913117588328E-4*d-.213742400323665),a[h++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*e+.0020741088115012*b-.00288260236853442*d+.814272968359295)+e*(-1.53496057440975E-5*e-1.32689043961446E-4*b+5.60833691242812E-4*d-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*d+.116935020465145)+d*(-3.43531996510555E-4*d+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,f,e,d=0,h=a.length;d<h;d+=4)b=a[d],f=a[d+
1],e=a[d+2],a[d]=434.456-b-1.402*e,a[d+1]=119.541-b+.344*f+.714*e,a[d+2]=481.816-b-1.772*f;return a},_convertCmykToRgb:function(a){for(var b,f,e,d,h=0,k=1/255,l=0,m=a.length;l<m;l+=4)b=a[l]*k,f=a[l+1]*k,e=a[l+2]*k,d=a[l+3]*k,a[h++]=255+b*(-4.387332384609988*b+54.48615194189176*f+18.82290502165302*e+212.25662451639585*d-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*e-17.873870861415444*d-5.497006427196366)+e*(-2.5217340131683033*e-21.248923337353073*d+17.5119270841813)-d*(21.86122147463605*
d+189.48180835922747),a[h++]=255+b*(8.841041422036149*b+60.118027045597366*f+6.871425592049007*e+31.159100130055922*d-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*e+131.35250912493976*d-190.9453302588951)+e*(4.444339102852739*e+9.8632861493405*d-24.86741582555878)-d*(20.737325471181034*d+187.80453709719578),a[h++]=255+b*(.8842522430003296*b+8.078677503112928*f+30.89978309703729*e-.23883238689178934*d-14.183576799673286)+f*(10.49593273432072*f+63.02378494754052*e+50.606957656360734*
d-112.23884253719248)+e*(.03296041114873217*e+115.60384449646641*d-193.58209356861505)-d*(22.33816807309886*d+180.12613974708367);return a},getData:function(a,b,f){if(4<this.numComponents)throw new C("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&f){f=a.length;b=new Uint8ClampedArray(3*f);for(var c=0,d=0;d<f;d++){var h=a[d];b[c++]=h;b[c++]=h;b[c++]=h}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return f?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return g}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var C={unstuff:function(k,b,g,h,a,c,f,e){var d=(1<<g)-1,n=0,w,l=0,m,y;k[k.length-1]<<=8*(4*k.length-Math.ceil(g*h/8));if(a)for(w=0;w<h;w++)0===l&&(y=k[n++],l=32),l>=g?(m=y>>>l-g&d,l-=g):(l=g-l,m=(y&d)<<l&d,y=k[n++],l=32-l,m+=y>>>l),b[w]=a[m];
else for(a=Math.ceil((e-c)/f),w=0;w<h;w++)0===l&&(y=k[n++],l=32),l>=g?(m=y>>>l-g&d,l-=g):(l=g-l,m=(y&d)<<l&d,y=k[n++],l=32-l,m+=y>>>l),b[w]=m<a?c+m*f:e},unstuffLUT:function(k,b,g,h,a,c){var f=(1<<b)-1,e=0,d=0,n=0,w=n=0,l,m=[];k[k.length-1]<<=8*(4*k.length-Math.ceil(b*g/8));for(var y=Math.ceil((c-h)/a),d=0;d<g;d++)0===n&&(l=k[e++],n=32),n>=b?(w=l>>>n-b&f,n-=b):(n=b-n,w=(l&f)<<n&f,l=k[e++],n=32-n,w+=l>>>n),m[d]=w<y?h+w*a:c;m.unshift(h);return m},unstuff2:function(k,b,g,h,a,c,f,e){var d=(1<<g)-1,n=0,
w,l=0,m=0,y,p,v;if(a)for(w=0;w<h;w++)0===l&&(p=k[n++],l=32,m=0),l>=g?(y=p>>>m&d,l-=g,m+=g):(v=g-l,y=p>>>m&d,p=k[n++],l=32-v,y|=(p&(1<<v)-1)<<g-v,m=v),b[w]=a[y];else for(a=Math.ceil((e-c)/f),w=0;w<h;w++)0===l&&(p=k[n++],l=32,m=0),l>=g?(y=p>>>m&d,l-=g,m+=g):(v=g-l,y=p>>>m&d,p=k[n++],l=32-v,y|=(p&(1<<v)-1)<<g-v,m=v),b[w]=y<a?c+y*f:e;return b},unstuffLUT2:function(k,b,g,h,a,c){for(var f=(1<<b)-1,e=0,d=0,n=0,w=0,l=0,m=0,y,p=[],v=Math.ceil((c-h)/a),d=0;d<g;d++)0===w&&(y=k[e++],w=32,m=0),w>=b?(l=y>>>m&f,
w-=b,m+=b):(n=b-w,l=y>>>m&f,y=k[e++],w=32-n,l|=(y&(1<<n)-1)<<b-n,m=n),p[d]=l<v?h+l*a:c;p.unshift(h);return p},originalUnstuff:function(k,b,g,h){var a=(1<<g)-1,c=0,f,e=0,d,n;k[k.length-1]<<=8*(4*k.length-Math.ceil(g*h/8));for(f=0;f<h;f++)0===e&&(n=k[c++],e=32),e>=g?(d=n>>>e-g&a,e-=g):(e=g-e,d=(n&a)<<e&a,n=k[c++],e=32-e,d+=n>>>e),b[f]=d;return b},originalUnstuff2:function(k,b,g,h){var a=(1<<g)-1,c=0,f,e=0,d=0,n,w,l;for(f=0;f<h;f++)0===e&&(w=k[c++],e=32,d=0),e>=g?(n=w>>>d&a,e-=g,d+=g):(l=g-e,n=w>>>d&
a,w=k[c++],e=32-l,n|=(w&(1<<l)-1)<<g-l,d=l),b[f]=n;return b}},g={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(k){for(var b=65535,g=65535,h=k.length,a=Math.floor(h/2),c=0;a;){var f=359<=a?359:a,a=a-f;do b+=k[c++]<<8,g+=b+=k[c++];while(--f);b=(b&65535)+(b>>>16);g=(g&65535)+(g>>>16)}h&1&&(g+=b+=k[c]<<8);return((g&65535)+(g>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(k,b){var g=b.ptr,h=new Uint8Array(k,g,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,h);if(0!==
a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var g=g+6,h=new DataView(k,g,8),c=h.getInt32(0,!0);a.fileVersion=c;g+=4;3<=c&&(a.checksum=h.getUint32(4,!0),g+=4);h=new DataView(k,g,12);a.height=h.getUint32(0,!0);a.width=h.getUint32(4,!0);g+=8;4<=c?(a.numDims=h.getUint32(8,!0),g+=4):a.numDims=1;h=new DataView(k,g,40);a.numValidPixel=h.getUint32(0,!0);a.microBlockSize=h.getInt32(4,!0);a.blobSize=h.getInt32(8,!0);a.imageType=
h.getInt32(12,!0);a.maxZError=h.getFloat64(16,!0);a.zMin=h.getFloat64(24,!0);a.zMax=h.getFloat64(32,!0);g+=40;b.headerInfo=a;b.ptr=g;if(3<=c&&(k=this.computeChecksumFletcher32(new Uint8Array(k,g-(4<=c?52:48),a.blobSize-14)),k!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(k,b){var g=b.headerInfo,h=this.getDataTypeArray(g.imageType),a=g.numDims*this.getDataTypeSize(g.imageType),c=this.readSubArray(k,b.ptr,h,a);k=this.readSubArray(k,b.ptr+a,h,a);b.ptr+=2*a;a=!0;for(b=0;b<
g.numDims;b++)if(c[b]!==k[b]){a=!1;break}g.minValues=c;g.maxValues=k;return a},readSubArray:function(k,b,g,h){if(g===Uint8Array)k=new Uint8Array(k,b,h);else{var a=new ArrayBuffer(h);(new Uint8Array(a)).set(new Uint8Array(k,b,h));k=new g(a)}return k},readMask:function(k,b){var g=b.ptr,h=b.headerInfo,a=h.width*h.height,c=h.numValidPixel,f=new DataView(k,g,4),h={};h.numBytes=f.getUint32(0,!0);g+=4;if((0===c||a===c)&&0!==h.numBytes)throw"invalid mask";if(0===c)c=new Uint8Array(Math.ceil(a/8)),h.bitset=
c,f=new Uint8Array(a),b.pixels.resultMask=f,g+=h.numBytes;else if(0<h.numBytes){c=new Uint8Array(Math.ceil(a/8));f=new DataView(k,g,h.numBytes);k=f.getInt16(0,!0);var e=2,d=0,B=0;do{if(0<k)for(;k--;)c[d++]=f.getUint8(e++);else for(B=f.getUint8(e++),k=-k;k--;)c[d++]=B;k=f.getInt16(e,!0);e+=2}while(e<h.numBytes);if(-32768!==k||d<c.length)throw"Unexpected end of mask RLE encoding";f=new Uint8Array(a);for(e=e=k=0;e<a;e++)e&7?(k=c[e>>3],k<<=e&7):k=c[e>>3],k&128&&(f[e]=1);b.pixels.resultMask=f;h.bitset=
c;g+=h.numBytes}b.ptr=g;b.mask=h;return!0},readDataOneSweep:function(k,b,n){var h=b.ptr,a=b.headerInfo,c=a.numDims,f=a.width*a.height,a=a.numValidPixel*g.getDataTypeSize(a.imageType)*c,e=b.pixels.resultMask;if(n===Uint8Array)k=new Uint8Array(k,h,a);else{var d=new ArrayBuffer(a);(new Uint8Array(d)).set(new Uint8Array(k,h,a));k=new n(d)}if(k.length===f*c)b.pixels.resultPixels=k;else{b.pixels.resultPixels=new n(f*c);var B=d=n=0,w=0;if(1<c)for(B=0;B<c;B++)for(w=B*f,d=0;d<f;d++)e[d]&&(b.pixels.resultPixels[w+
d]=k[n++]);else for(d=0;d<f;d++)e[d]&&(b.pixels.resultPixels[d]=k[n++])}b.ptr=h+a;return!0},readHuffmanTree:function(k,b){var n=this.HUFFMAN_LUT_BITS_MAX,h=new DataView(k,b.ptr,16);b.ptr+=16;if(2>h.getInt32(0,!0))throw"unsupported Huffman version";var a=h.getInt32(4,!0),c=h.getInt32(8,!0),h=h.getInt32(12,!0);if(c>=h)return!1;var f=new Uint32Array(h-c);g.decodeBits(k,b,f);var e=[],d,B,w;for(d=c;d<h;d++)B=d-(d<a?0:a),e[B]={first:f[d-c],second:null};d=k.byteLength-b.ptr;f=new ArrayBuffer(4*Math.ceil(d/
4));(new Uint8Array(f)).set(new Uint8Array(k,b.ptr,d));k=new Uint32Array(f);b=0;var l,f=0;l=k[0];for(d=c;d<h;d++)B=d-(d<a?0:a),w=e[B].first,0<w&&(e[B].second=l<<b>>>32-w,32-b>=w?(b+=w,32===b&&(b=0,f++,l=k[f])):(b+=w-32,f++,l=k[f],e[B].second|=l>>>32-b));var m=l=0,y=new z;for(d=0;d<e.length;d++)void 0!==e[d]&&(l=Math.max(l,e[d].first));var m=l>=n?n:l,n=[],p,v;for(d=c;d<h;d++)if(B=d-(d<a?0:a),w=e[B].first,0<w)if(c=[w,B],w<=m)for(B=e[B].second<<m-w,p=1<<m-w,w=0;w<p;w++)n[B|w]=c;else for(B=e[B].second,
p=y,--w;0<=w;w--)(v=B>>>w&1)?(p.right||(p.right=new z),p=p.right):(p.left||(p.left=new z),p=p.left),0!==w||p.val||(p.val=c[1]);return{decodeLut:n,numBitsLUTQick:m,numBitsLUT:l,tree:y,stuffedData:k,srcPtr:f,bitPos:b}},readHuffman:function(k,b,g){var h=b.headerInfo,a=h.numDims,c=b.headerInfo.height,f=b.headerInfo.width,e=f*c,d=this.readHuffmanTree(k,b);k=d.decodeLut;var n=d.tree,w=d.stuffedData,l=d.srcPtr,m=d.bitPos,y=d.numBitsLUTQick,d=d.numBitsLUT,p=0===b.headerInfo.imageType?128:0,v,q,r=b.pixels.resultMask,
D,x,u,t,A,E,G=0;0<m&&(l++,m=0);var H=w[l],F=1===b.encodeMode,I=new g(e*a),J=I,P;for(P=0;P<h.numDims;P++){1<a&&(J=new g(I.buffer,e*P,e),G=0);if(b.headerInfo.numValidPixel===f*c)for(u=A=0;u<c;u++)for(t=0;t<f;t++,A++){q=0;v=D=H<<m>>>32-y;32-m<y&&(v=D|=w[l+1]>>>64-m-y);if(k[v])q=k[v][1],m+=k[v][0];else for(v=D=H<<m>>>32-d,32-m<d&&(v=D|=w[l+1]>>>64-m-d),v=n,E=0;E<d;E++)if(v=(x=D>>>d-E-1&1)?v.right:v.left,!v.left&&!v.right){q=v.val;m=m+E+1;break}32<=m&&(m-=32,l++,H=w[l]);q-=p;F?(q=0<t?q+G:0<u?q+J[A-f]:
q+G,q&=255,G=J[A]=q):J[A]=q}else for(u=A=0;u<c;u++)for(t=0;t<f;t++,A++)if(r[A]){q=0;v=D=H<<m>>>32-y;32-m<y&&(v=D|=w[l+1]>>>64-m-y);if(k[v])q=k[v][1],m+=k[v][0];else for(v=D=H<<m>>>32-d,32-m<d&&(v=D|=w[l+1]>>>64-m-d),v=n,E=0;E<d;E++)if(v=(x=D>>>d-E-1&1)?v.right:v.left,!v.left&&!v.right){q=v.val;m=m+E+1;break}32<=m&&(m-=32,l++,H=w[l]);q-=p;F?(q=0<t&&r[A-1]?q+G:0<u&&r[A-f]?q+J[A-f]:q+G,q&=255,G=J[A]=q):J[A]=q}b.ptr=b.ptr+4*(l+1)+(0<m?4:0)}b.pixels.resultPixels=I},decodeBits:function(k,b,g,h,a){var c=
b.headerInfo,f=c.fileVersion,e=0,d=new DataView(k,b.ptr,5<=k.byteLength-b.ptr?5:k.byteLength-b.ptr),n=d.getUint8(0);e++;var w=n>>6,l=0===w?4:3-w,m=0<(n&32)?!0:!1,w=n&31,n=0;if(1===l)n=d.getUint8(e),e++;else if(2===l)n=d.getUint16(e,!0),e+=2;else if(4===l)n=d.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";var l=2*c.maxZError,y,p;a=1<c.numDims?c.maxValues[a]:c.zMax;if(m){b.counter.lut++;m=d.getUint8(e);e++;c=Math.ceil((m-1)*w/8);y=Math.ceil(c/4);y=new ArrayBuffer(4*y);p=new Uint8Array(y);
b.ptr+=e;p.set(new Uint8Array(k,b.ptr,c));e=new Uint32Array(y);b.ptr+=c;for(d=0;m-1>>>d;)d++;c=Math.ceil(n*d/8);y=Math.ceil(c/4);y=new ArrayBuffer(4*y);p=new Uint8Array(y);p.set(new Uint8Array(k,b.ptr,c));k=new Uint32Array(y);b.ptr+=c;b=3<=f?C.unstuffLUT2(e,w,m-1,h,l,a):C.unstuffLUT(e,w,m-1,h,l,a);3<=f?C.unstuff2(k,g,d,n,b):C.unstuff(k,g,d,n,b)}else b.counter.bitstuffer++,d=w,b.ptr+=e,0<d&&(c=Math.ceil(n*d/8),y=Math.ceil(c/4),y=new ArrayBuffer(4*y),p=new Uint8Array(y),p.set(new Uint8Array(k,b.ptr,
c)),k=new Uint32Array(y),b.ptr+=c,3<=f?null==h?C.originalUnstuff2(k,g,d,n):C.unstuff2(k,g,d,n,!1,h,l,a):null==h?C.originalUnstuff(k,g,d,n):C.unstuff(k,g,d,n,!1,h,l,a))},readTiles:function(k,b,n){var h=b.headerInfo,a=h.width,c=h.height,f=h.microBlockSize,e=h.imageType,d=g.getDataTypeSize(e),B=Math.ceil(a/f),w=Math.ceil(c/f);b.pixels.numBlocksY=w;b.pixels.numBlocksX=B;for(var l=b.pixels.ptr=0,m=0,y=0,p=0,v=0,q=0,r=0,D=0,x=0,u=0,t=0,A=0,E=0,r=E=r=0,G,H=new n(f*f),F=c%f||f,I=a%f||f,J=h.numDims,P,L=b.pixels.resultMask,
z=b.pixels.resultPixels,W=5<=h.fileVersion?14:15,N=h.zMax,y=0;y<w;y++)for(v=y!==w-1?f:F,p=0;p<B;p++)for(q=p!==B-1?f:I,t=y*a*f+p*f,A=a-q,P=0;P<J;P++){1<J?(E=z,t=y*a*f+p*f,z=new n(b.pixels.resultPixels.buffer,a*c*P*d,a*c),N=h.maxValues[P]):E=null;r=k.byteLength-b.ptr;l=new DataView(k,b.ptr,Math.min(10,r));m={};r=0;D=l.getUint8(0);r++;G=5<=h.fileVersion?D&4:0;x=D>>6&255;u=D>>2&W;if(u!==(p*f>>3&W))throw"integrity issue";if(G&&0===P)throw"integrity issue";D&=3;if(3<D)throw b.ptr+=r,"Invalid block encoding ("+
D+")";if(2===D){if(G)if(L)for(l=0;l<v;l++)for(m=0;m<q;m++)L[t]&&(z[t]=E[t]),t++;else for(l=0;l<v;l++)for(m=0;m<q;m++)z[t]=E[t],t++;b.counter.constant++;b.ptr+=r}else if(0===D){if(G)throw"integrity issue";b.counter.uncompressed++;b.ptr+=r;E=v*q*d;r=k.byteLength-b.ptr;E=E<r?E:r;r=new ArrayBuffer(0===E%d?E:E+d-E%d);G=new Uint8Array(r);G.set(new Uint8Array(k,b.ptr,E));r=new n(r);E=0;if(L)for(l=0;l<v;l++){for(m=0;m<q;m++)L[t]&&(z[t]=r[E++]),t++;t+=A}else for(l=0;l<v;l++){for(m=0;m<q;m++)z[t++]=r[E++];
t+=A}b.ptr+=E*d}else if(x=g.getDataTypeUsed(G&&6>e?4:e,x),u=g.getOnePixel(m,r,x,l),r+=g.getDataTypeSize(x),3===D)if(b.ptr+=r,b.counter.constantoffset++,L)for(l=0;l<v;l++){for(m=0;m<q;m++)L[t]&&(z[t]=G?Math.min(N,E[t]+u):u),t++;t+=A}else for(l=0;l<v;l++){for(m=0;m<q;m++)z[t]=G?Math.min(N,E[t]+u):u,t++;t+=A}else if(b.ptr+=r,g.decodeBits(k,b,H,u,P),r=0,G)if(L)for(l=0;l<v;l++){for(m=0;m<q;m++)L[t]&&(z[t]=H[r++]+E[t]),t++;t+=A}else for(l=0;l<v;l++){for(m=0;m<q;m++)z[t]=H[r++]+E[t],t++;t+=A}else if(L)for(l=
0;l<v;l++){for(m=0;m<q;m++)L[t]&&(z[t]=H[r++]),t++;t+=A}else for(l=0;l<v;l++){for(m=0;m<q;m++)z[t++]=H[r++];t+=A}}},formatFileInfo:function(k){return{fileIdentifierString:k.headerInfo.fileIdentifierString,fileVersion:k.headerInfo.fileVersion,imageType:k.headerInfo.imageType,height:k.headerInfo.height,width:k.headerInfo.width,numValidPixel:k.headerInfo.numValidPixel,microBlockSize:k.headerInfo.microBlockSize,blobSize:k.headerInfo.blobSize,maxZError:k.headerInfo.maxZError,pixelType:g.getPixelType(k.headerInfo.imageType),
eofOffset:k.eofOffset,mask:k.mask?{numBytes:k.mask.numBytes}:null,pixels:{numBlocksX:k.pixels.numBlocksX,numBlocksY:k.pixels.numBlocksY,maxValue:k.headerInfo.zMax,minValue:k.headerInfo.zMin,noDataValue:k.noDataValue}}},constructConstantSurface:function(k){var b=k.headerInfo.zMax,g=k.headerInfo.numDims,h=k.headerInfo.height*k.headerInfo.width,a=0,c=0,f=0,e=k.pixels.resultMask,d=k.pixels.resultPixels;if(e)if(1<g)for(a=0;a<g;a++)for(f=a*h,b=k.headerInfo.maxValues[a],c=0;c<h;c++)e[c]&&(d[f+c]=b);else for(c=
0;c<h;c++)e[c]&&(d[c]=b);else if(1<g)for(a=0;a<g;a++)for(f=a*h,b=k.headerInfo.maxValues[a],c=0;c<h;c++)d[f+c]=b;else for(c=0;c<h;c++)d[c]=b},getDataTypeArray:function(k){switch(k){case 0:k=Int8Array;break;case 1:k=Uint8Array;break;case 2:k=Int16Array;break;case 3:k=Uint16Array;break;case 4:k=Int32Array;break;case 5:k=Uint32Array;break;case 6:k=Float32Array;break;case 7:k=Float64Array;break;default:k=Float32Array}return k},getPixelType:function(k){switch(k){case 0:k="S8";break;case 1:k="U8";break;
case 2:k="S16";break;case 3:k="U16";break;case 4:k="S32";break;case 5:k="U32";break;case 6:k="F32";break;case 7:k="F64";break;default:k="F32"}return k},isValidPixelValue:function(k,b){if(null==b)return!1;switch(k){case 0:k=-128<=b&&127>=b;break;case 1:k=0<=b&&255>=b;break;case 2:k=-32768<=b&&32767>=b;break;case 3:k=0<=b&&65536>=b;break;case 4:k=-2147483648<=b&&2147483647>=b;break;case 5:k=0<=b&&4294967296>=b;break;case 6:k=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:k=4.9E-324<=
b&&1.7976931348623157E308>=b;break;default:k=!1}return k},getDataTypeSize:function(k){var b=0;switch(k){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=k}return b},getDataTypeUsed:function(k,b){var g=k;switch(k){case 2:case 4:g=k-b;break;case 3:case 5:g=k-2*b;break;case 6:g=0===b?k:1===b?2:1;break;case 7:g=0===b?k:k-2*b+1;break;default:g=k}return g},getOnePixel:function(k,b,g,h){k=0;switch(g){case 0:k=h.getInt8(b);break;case 1:k=h.getUint8(b);
break;case 2:k=h.getInt16(b,!0);break;case 3:k=h.getUint16(b,!0);break;case 4:k=h.getInt32(b,!0);break;case 5:k=h.getUInt32(b,!0);break;case 6:k=h.getFloat32(b,!0);break;case 7:k=h.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return k}},z=function(k,b,g){this.val=k;this.left=b;this.right=g};return{decode:function(k,b){b=b||{};var n=b.noDataValue,h=0,a={};a.ptr=b.inputOffset||0;a.pixels={};if(g.readHeaderInfo(k,a)){var h=a.headerInfo,c=h.fileVersion,f=g.getDataTypeArray(h.imageType);
if(5<c)throw"unsupported lerc version 2."+c;g.readMask(k,a);h.numValidPixel===h.width*h.height||a.pixels.resultMask||(a.pixels.resultMask=b.maskData);var e=h.width*h.height;a.pixels.resultPixels=new f(e*h.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==h.numValidPixel)if(h.zMax===h.zMin)g.constructConstantSurface(a);else if(4<=c&&g.checkMinMaxRanges(k,a))g.constructConstantSurface(a);else{var d=new DataView(k,a.ptr,2),B=d.getUint8(0);a.ptr++;if(B)g.readDataOneSweep(k,
a,f);else if(1<c&&1>=h.imageType&&1E-5>Math.abs(h.maxZError-.5)){d=d.getUint8(1);a.ptr++;a.encodeMode=d;if(2<d||4>c&&1<d)throw"Invalid Huffman flag "+d;d?g.readHuffman(k,a,f):g.readTiles(k,a,f)}else g.readTiles(k,a,f)}a.eofOffset=a.ptr;b.inputOffset?(k=a.headerInfo.blobSize+b.inputOffset-a.ptr,1<=Math.abs(k)&&(a.eofOffset=b.inputOffset+a.headerInfo.blobSize)):(k=a.headerInfo.blobSize-a.ptr,1<=Math.abs(k)&&(a.eofOffset=a.headerInfo.blobSize));k={width:h.width,height:h.height,pixelData:a.pixels.resultPixels,
minValue:h.zMin,maxValue:h.zMax,validPixelCount:h.numValidPixel,dimCount:h.numDims,dimStats:{minValues:h.minValues,maxValues:h.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&g.isValidPixelValue(h.imageType,n)){c=a.pixels.resultMask;for(h=0;h<e;h++)c[h]||(k.pixelData[h]=n);k.noDataValue=n}a.noDataValue=n;b.returnFileInfo&&(k.fileInfo=g.formatFileInfo(a));return k}},getBandCount:function(k){for(var b=0,n=0,h={ptr:0,pixels:{}};n<k.byteLength-58;)g.readHeaderInfo(k,h),n+=h.headerInfo.blobSize,
b++,h.ptr=n;return b}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(C){var g={};g.defaultNoDataValue=C.clampFloat32(-Infinity);g.decode=function(k,b){var n;b=b||{};var h=b.inputOffset||0,a=b.encodedMaskData||null===b.encodedMaskData,c={},f=new Uint8Array(k,h,10);c.fileIdentifierString=String.fromCharCode.apply(null,f);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;h+=10;f=new DataView(k,
h,24);c.fileVersion=f.getInt32(0,!0);c.imageType=f.getInt32(4,!0);c.height=f.getUint32(8,!0);c.width=f.getUint32(12,!0);c.maxZError=f.getFloat64(16,!0);h+=24;if(!a)if(f=new DataView(k,h,16),c.mask={},c.mask.numBlocksY=f.getUint32(0,!0),c.mask.numBlocksX=f.getUint32(4,!0),c.mask.numBytes=f.getUint32(8,!0),c.mask.maxValue=f.getFloat32(12,!0),h+=16,0<c.mask.numBytes){var a=new Uint8Array(Math.ceil(c.width*c.height/8)),f=new DataView(k,h,c.mask.numBytes),e=f.getInt16(0,!0),d=2,B=0;do{if(0<e)for(;e--;)a[B++]=
f.getUint8(d++);else for(var w=f.getUint8(d++),e=-e;e--;)a[B++]=w;e=f.getInt16(d,!0);d+=2}while(d<c.mask.numBytes);if(-32768!==e||B<a.length)throw"Unexpected end of mask RLE encoding";c.mask.bitset=a;h+=c.mask.numBytes}else 0===(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(a=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=a);f=new DataView(k,h,16);c.pixels={};c.pixels.numBlocksY=f.getUint32(0,!0);c.pixels.numBlocksX=f.getUint32(4,!0);c.pixels.numBytes=f.getUint32(8,!0);c.pixels.maxValue=
f.getFloat32(12,!0);h+=16;a=c.pixels.numBlocksX;f=c.pixels.numBlocksY;a+=0<c.width%a?1:0;e=f+(0<c.height%f?1:0);c.pixels.blocks=Array(a*e);d=1E9;for(w=B=0;w<e;w++)for(var l=0;l<a;l++){var m=0,f=new DataView(k,h,Math.min(10,k.byteLength-h)),y={};c.pixels.blocks[B++]=y;var p=f.getUint8(0);m++;y.encoding=p&63;if(3<y.encoding)throw"Invalid block encoding ("+y.encoding+")";if(2===y.encoding)h++,d=Math.min(d,0);else{if(0!==p&&2!==p){p>>=6;y.offsetType=p;if(2===p)y.offset=f.getInt8(1),m++;else if(1===p)y.offset=
f.getInt16(1,!0),m+=2;else if(0===p)y.offset=f.getFloat32(1,!0),m+=4;else throw"Invalid block offset type";d=Math.min(y.offset,d);if(1===y.encoding)if(p=f.getUint8(m),m++,y.bitsPerPixel=p&63,p>>=6,y.numValidPixelsType=p,2===p)y.numValidPixels=f.getUint8(m),m++;else if(1===p)y.numValidPixels=f.getUint16(m,!0),m+=2;else if(0===p)y.numValidPixels=f.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";}h+=m;if(3!=y.encoding)if(0===y.encoding){f=(c.pixels.numBytes-1)/4;if(f!==Math.floor(f))throw"uncompressed block has invalid length";
m=new ArrayBuffer(4*f);p=new Uint8Array(m);p.set(new Uint8Array(k,h,4*f));m=new Float32Array(m);for(p=0;p<m.length;p++)d=Math.min(d,m[p]);y.rawData=m;h+=4*f}else 1===y.encoding&&(f=Math.ceil(y.numValidPixels*y.bitsPerPixel/8),m=new ArrayBuffer(4*Math.ceil(f/4)),p=new Uint8Array(m),p.set(new Uint8Array(k,h,f)),y.stuffedData=new Uint32Array(m),h+=f)}}c.pixels.minValue=d;c.eofOffset=h;k=null!=b.noDataValue?C.clampFloat32(b.noDataValue):g.defaultNoDataValue;var a=b.encodedMaskData,y=b.returnMask,f=0,
e=c.pixels.numBlocksX,d=c.pixels.numBlocksY,B=Math.floor(c.width/e),w=Math.floor(c.height/d),l=2*c.maxZError,a=a||(c.mask?c.mask.bitset:null),v,h=new (b.pixelType||Float32Array)(c.width*c.height);y&&a&&(v=new Uint8Array(c.width*c.height));for(var y=new Float32Array(B*w),q,r,m=0;m<=d;m++)if(p=m!==d?w:c.height%d,0!==p)for(var D=0;D<=e;D++){var x=D!==e?B:c.width%e;if(0!==x){var u=m*c.width*w+D*B,t=c.width-x,A=c.pixels.blocks[f],E,G;if(2>A.encoding){if(0===A.encoding)E=A.rawData;else{E=A.stuffedData;
G=A.bitsPerPixel;q=A.numValidPixels;r=A.offset;var H=l,F=y,I=c.pixels.maxValue,J=(1<<G)-1,P=0,L=void 0,ca=0,W=void 0,N=void 0,O=Math.ceil((I-r)/H);E[E.length-1]<<=8*(4*E.length-Math.ceil(G*q/8));for(L=0;L<q;L++)0===ca&&(N=E[P++],ca=32),ca>=G?(W=N>>>ca-G&J,ca-=G):(ca=G-ca,W=(N&J)<<ca&J,N=E[P++],ca=32-ca,W+=N>>>ca),F[L]=W<O?r+W*H:I;E=y}G=0}else n=2===A.encoding?0:A.offset;var S;if(a)for(r=0;r<p;r++){u&7&&(S=a[u>>3],S<<=u&7);for(q=0;q<x;q++)u&7||(S=a[u>>3]),S&128?(v&&(v[u]=1),h[u++]=2>A.encoding?E[G++]:
n):(v&&(v[u]=0),h[u++]=k),S<<=1;u+=t}else if(2>A.encoding)for(r=0;r<p;r++){for(q=0;q<x;q++)h[u++]=E[G++];u+=t}else for(r=0;r<p;r++)if(h.fill)h.fill(n,u,u+x),u+=x+t;else{for(q=0;q<x;q++)h[u++]=n;u+=t}if(1===A.encoding&&G!==A.numValidPixels)throw"Block and Mask do not match";f++}}n=v;v={width:c.width,height:c.height,pixelData:h,minValue:c.pixels.minValue,maxValue:c.pixels.maxValue,noDataValue:k};n&&(v.maskData=n);b.returnEncodedMask&&c.mask&&(v.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(b.returnFileInfo&&
(v.fileInfo=z(c),b.computeUsedBitDepths)){b=v.fileInfo;n=c.pixels.numBlocksX*c.pixels.numBlocksY;S={};for(E=0;E<n;E++)G=c.pixels.blocks[E],0===G.encoding?S.float32=!0:1===G.encoding?S[G.bitsPerPixel]=!0:S[0]=!0;c=Object.keys(S);b.bitDepths=c}return v};var z=function(k){return{fileIdentifierString:k.fileIdentifierString,fileVersion:k.fileVersion,imageType:k.imageType,height:k.height,width:k.width,maxZError:k.maxZError,eofOffset:k.eofOffset,mask:k.mask?{numBlocksX:k.mask.numBlocksX,numBlocksY:k.mask.numBlocksY,
numBytes:k.mask.numBytes,maxValue:k.mask.maxValue}:null,pixels:{numBlocksX:k.pixels.numBlocksX,numBlocksY:k.pixels.numBlocksY,numBytes:k.pixels.numBytes,maxValue:k.pixels.maxValue,minValue:k.pixels.minValue,noDataValue:this.noDataValue}}};return g})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(C){return function(g){function z(b){var a,c,f,e;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){a=
this.readUInt32();e=b=void 0;e=[];for(b=0;4>b;++b)e.push(String.fromCharCode(this.data[this.pos++]));b=e.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(a);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();a=this.readUInt16()||100;f.delay=1E3*b/a;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,a-=4);b=(null!=f?f.data:void 0)||this.imgData;for(e=0;0<=a?e<a:e>a;0<=a?++e:--e)b.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(a);a=255-this.transparency.indexed.length;if(0<a)for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case "tEXt":e=this.read(a);a=e.indexOf(0);b=String.fromCharCode.apply(String,e.slice(0,a));this.text[b]=String.fromCharCode.apply(String,e.slice(a+1));break;case "IEND":f&&
this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(c=this.colorType)||6===c;c=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*c;a:{switch(this.colors){case 1:c="DeviceGray";break a;case 3:c="DeviceRGB";break a}c=void 0}this.colorSpace=c;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=a}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var k,b,n;z.load=function(b,a,c){var f;"function"===typeof a&&(c=a);f=new XMLHttpRequest;f.open("GET",b,!0);f.responseType="arraybuffer";f.onload=function(){var b;b=new Uint8Array(f.response||f.mozResponseArrayBuffer);b=new z(b);"function"===typeof(null!=a?a.getContext:void 0)&&b.render(a);return"function"===typeof c?c(b):void 0};return f.send(null)};z.prototype.read=function(b){var a,c;c=[];for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)c.push(this.data[this.pos++]);return c};z.prototype.readUInt32=function(){var b,
a,c,f;b=this.data[this.pos++]<<24;a=this.data[this.pos++]<<16;c=this.data[this.pos++]<<8;f=this.data[this.pos++];return b|a|c|f};z.prototype.readUInt16=function(){var b,a;b=this.data[this.pos++]<<8;a=this.data[this.pos++];return b|a};z.prototype.decodePixels=function(b){var a,c,f,e,d,h,k,l,m,g,p,n,q,r,D;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new C(b);b=b.getBytes();l=this.pixelBitlength/8;n=l*this.width;m=new Uint8Array(n*this.height);h=b.length;for(c=g=p=0;g<h;){switch(b[g++]){case 0:for(e=
a=0;a<n;e=a+=1)m[c++]=b[g++];break;case 1:for(e=q=0;q<n;e=q+=1)a=b[g++],d=e<l?0:m[c-l],m[c++]=(a+d)%256;break;case 2:for(e=d=0;d<n;e=d+=1)a=b[g++],f=(e-e%l)/l,q=p&&m[(p-1)*n+f*l+e%l],m[c++]=(q+a)%256;break;case 3:for(e=D=0;D<n;e=D+=1)a=b[g++],f=(e-e%l)/l,d=e<l?0:m[c-l],q=p&&m[(p-1)*n+f*l+e%l],m[c++]=(a+Math.floor((d+q)/2))%256;break;case 4:for(e=D=0;D<n;e=D+=1)a=b[g++],f=(e-e%l)/l,d=e<l?0:m[c-l],0===p?q=r=0:(q=m[(p-1)*n+f*l+e%l],r=f&&m[(p-1)*n+(f-1)*l+e%l]),k=d+q-r,e=Math.abs(k-d),f=Math.abs(k-q),
k=Math.abs(k-r),d=e<=f&&e<=k?d:f<=k?q:r,m[c++]=(a+d)%256;break;default:throw Error("Invalid filter algorithm: "+b[g-1]);}p++}return m};z.prototype.decodePalette=function(){var b,a,c,f,e,d,k,g,l;c=this.palette;d=this.transparency.indexed||[];e=new Uint8Array((d.length||0)+c.length);a=k=b=f=0;for(g=c.length;k<g;a=k+=3)e[f++]=c[a],e[f++]=c[a+1],e[f++]=c[a+2],e[f++]=null!=(l=d[b++])?l:255;return e};z.prototype.copyToImageData=function(b,a){var c,f,e,d,h,k,l;f=this.colors;l=null;c=this.hasAlphaChannel;
this.palette.length&&(l=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),f=4,c=!0);b=b.data||b;k=b.length;d=l||a;e=h=0;if(1===f)for(;e<k;)f=l?4*a[e/4]:h,h=d[f++],b[e++]=h,b[e++]=h,b[e++]=h,b[e++]=c?d[f++]:this.transparency.grayscale&&this.transparency.grayscale===h?0:255,h=f;else for(;e<k;)f=l?4*a[e/4]:h,b[e++]=d[f++],b[e++]=d[f++],b[e++]=d[f++],b[e++]=c?d[f++]:this.transparency.rgb&&this.transparency.rgb[1]===d[f-3]&&this.transparency.rgb[3]===d[f-2]&&this.transparency.rgb[5]===
d[f-1]?0:255,h=f};z.prototype.decode=function(){var b;b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};n=(b=g.document&&g.document.createElement("canvas"))&&b.getContext("2d");k=function(h){n.width=h.width;n.height=h.height;n.clearRect(0,0,h.width,h.height);n.putImageData(h,0,0);h=new Image;h.src=b.toDataURL();return h};z.prototype.decodeFrames=function(b){var a,c,f,e,d,h,g;if(this.animation){h=this.animation.frames;g=[];a=e=0;for(d=h.length;e<d;a=++e)a=
h[a],c=b.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(c,f),a.imageData=c,g.push(a.image=k(c));return g}};z.prototype.renderFrame=function(b,a){var c,f;f=this.animation.frames;c=f[a];f=f[a-1];0===a&&b.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?b.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&b.putImageData(f.imageData,f.xOffset,f.yOffset);0===c.blendOp&&b.clearRect(c.xOffset,c.yOffset,
c.width,c.height);return b.drawImage(c.image,c.xOffset,c.yOffset)};z.prototype.animate=function(b){var a,c,f,e,d,h,k=this;c=0;h=this.animation;e=h.numFrames;f=h.frames;d=h.numPlays;return(a=function(){var h,g;h=c++%e;g=f[h];k.renderFrame(b,h);if(1<e&&c/e<d)return k.animation._timeout=setTimeout(a,g.delay)})()};z.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};z.prototype.render=function(b){var a;b._png&&b._png.stopAnimation();b._png=this;b.width=
this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);a=b.createImageData(this.width,this.height);this.copyToImageData(a,this.decodePixels());return b.putImageData(a,0,0)};return z}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define(["require","exports"],function(C,g){var z=function(k){var b=1;switch(k){case Uint8Array:case Int8Array:b=1;break;case Uint16Array:case Int16Array:b=2;break;case Uint32Array:case Int32Array:case Float32Array:b=
4;break;case Float64Array:b=8}return b};return function(){function k(){}k.decode=function(b,k){var h=k.pixelType,a=[],c=k.width*k.height,f=Math.floor(b.byteLength/(k.width*k.height*z(k.pixelType))),e=k.bandIds,d=k.format;k=e&&e.length||Math.floor(b.byteLength/(k.width*k.height*z(k.pixelType)));var g=b.byteLength-b.byteLength%(c*z(h)),n=new h(b,0,c*f),l,m,y,p;if("bip"===d)for(d=0;d<k;d++){y=new h(c);p=e?e[d]:d;for(l=0;l<c;l++)y[l]=n[l*f+p];a.push(y)}else if("bsq"===d)for(d=0;d<k;d++)p=e?e[d]:d,a.push(n.subarray(p*
c,(p+1)*c));if(g<b.byteLength-1)if(b=b.slice(g),8*b.byteLength<c)m=null;else{b=new Uint8Array(b,0,Math.ceil(c/8));h=new Uint8Array(c);for(m=k=m=e=f=0;m<b.length-1;m++)for(e=b[m],k=7;0<=k;k--)h[f++]=e>>k&1;for(k=7;f<c-1;)e=b[b.length-1],h[f++]=e>>k&1,k--;m=h}return{pixels:a,mask:m}};return k}()})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("require exports ../../../core/tsSupport/assignHelper ../rasterDatasets/byteStreamUtils ./Jpg ./TiffTags ./Zlib".split(" "),function(C,g,
z,k,b,n,h){function a(a,b){var c="unknown";3===a?c="f32":1===a?1===b?c="u1":2===b?c="u2":4===b?c="u4":8>=b?c="u8":16>=b?c="u16":32>=b&&(c="u32"):2===a&&(8>=b?c="s8":16>=b?c="s16":32>=b&&(c="s32"));return c}function c(a){var b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;default:b=Float32Array}return b}
function f(a,b){return{x:b[0]*a.x+b[1]*a.y+b[2],y:b[3]*a.x+b[4]*a.y+b[5]}}function e(a,b){return(a=a.get(b))&&a.values}function d(a,b){return(a=a.get(b))&&a.values[0]}function B(a,b,c,d,e,f){void 0===d&&(d=0);void 0===e&&(e=n.TIFF_TAGS);void 0===f&&(f=4);var h=(new DataView(a,c,2)).getUint16(0,b),l=4+2*f,k=2+h*l;if(c+k>a.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:k};var g=c+k+4<=a.byteLength?(new DataView(a,c+k,4)).getUint32(0,b):null;c+=2;for(var t=new Map,m,u,x,p,q,r,
A=0;A<h;A++){m=new DataView(a,c+l*A,l);u=m.getUint16(0,b);p=m.getUint16(2,b);x=n.getTagName(u,e);if(2===f)q=m.getUint16(4,b),r=m.getUint16(6,b);else if(4===f)q=m.getUint32(4,b),r=m.getUint32(8,b);else if(8===f)if(r=q=0,b)for(var v=0;8>v;v++)q+=m.getUint8(4+v)*Math.pow(2,8*v),r+=m.getUint8(12+v)*Math.pow(2,8*v);else for(v=0;8>v;v++)q+=m.getUint8(4+v)*Math.pow(2,8*(7-v)),r+=m.getUint8(12+v)*Math.pow(2,8*(7-v));m={id:u,type:p,valueCount:q,valueOffset:r,values:null};w(a,b,m,d);t.set(x,m)}return{success:!0,
ifd:t,nextIFD:g,requiredBufferSize:k}}function w(a,b,c,d,e){void 0===d&&(d=0);if(c.values)return!0;var f=c.type,h=c.valueCount,l=c.valueOffset,k=[],g=v[f],m=8*g,t=h*g,u=h*v[f]*8;if(32<u&&t>(e?a.byteLength:a?a.byteLength-l+d:0))return c.offlineOffsetSize=[l,t],c.values=null,!1;if(32>=u)if(b||(l>>>=32-u),1===h)k=[l];else for(a=0;a<h;a++)k.push(l<<m*a>>>32-m);else for(l-=d,e&&(l=0),m=l;m<l+t;m+=g){switch(f){case 1:h=(new DataView(a,m,1)).getUint8(0);break;case 2:h=(new DataView(a,m,1)).getUint8(0);break;
case 3:h=(new DataView(a,m,2)).getUint16(0,b);break;case 4:h=(new DataView(a,m,4)).getUint32(0,b);break;case 5:h=(new DataView(a,m,4)).getUint32(0,b)/(new DataView(a,m+4,4)).getUint32(0,b);break;case 6:h=(new DataView(a,m,1)).getInt8(0);break;case 7:h=(new DataView(a,m,1)).getUint8(0);break;case 8:h=(new DataView(a,m,2)).getInt16(0,b);break;case 9:h=(new DataView(a,m,4)).getInt32(0,b);break;case 10:h=(new DataView(a,m,4)).getInt32(0,b)/(new DataView(a,m+4,4)).getInt32(0,b);break;case 11:h=(new DataView(a,
m,4)).getFloat32(0,b);break;case 12:h=(new DataView(a,m,8)).getFloat64(0,b);break;default:h=null}k.push(h)}if(2===f){f="";l=k;k=[];for(a=0;a<l.length;a++)0===l[a]&&""!==f?(k.push(f),f=""):f+=String.fromCharCode(l[a]);""===f&&0!==k.length||k.push(f)}c.values=k;return!0}function l(b){var c=b[0],h=d(c,"TILEWIDTH"),l=d(c,"TILELENGTH"),k=d(c,"IMAGEWIDTH"),m=d(c,"IMAGELENGTH"),g=d(c,"BITSPERSAMPLE"),p=d(c,"SAMPLESPERPIXEL"),n=d(c,"SAMPLEFORMAT")||1,q=a(n,g),x=e(c,"PLANARCONFIGURATION")?2===e(c,"PLANARCONFIGURATION")[0]:
!1,r=e(c,"GDAL_NODATA"),v;null!=r&&("string"===typeof r[0]?(v=r.map(function(a){return parseFloat(a)}),v.some(function(a){return isNaN(a)})&&(v=null)):"number"===typeof r[0]&&(v=r));var w=d(c,"COMPRESSION")||1;switch(w){case 1:r="NONE";break;case 2:case 3:case 4:case 32771:r="CCITT";break;case 5:r="LZW";break;case 6:case 7:r="JPEG";break;case 32773:r="PACKBITS";break;case 8:case 32946:r="DEFLATE";break;case 34712:r="JPEG2000";break;default:r=String(w)}var y=!0,B="";1!==w&&6!==w&&8!==w&&32946!==w&&
(y=!1,B+="unsupported tag compression "+w);3<n&&(y=!1,B+="unsupported tag sampleFormat "+n);0!==g%8&&(y=!1,B+="unsupported tag bitsPerSample "+g);var g=d(c,"GEOASCIIPARAMS"),z;g&&(z=(z=g.split("|").filter(function(a){return-1<a.indexOf("ESRI PE String \x3d ")})[0])?z.replace("ESRI PE String \x3d ",""):"",z=0===z.indexOf("PROJCS")||0===z.indexOf("GEOGCS")?{wkid:null,wkt:z}:null);var g=e(c,"GEOTIEPOINTS"),n=e(c,"GEOPIXELSCALE"),w=e(c,"GEOTRANSMATRIX"),C=c.has("GEOKEYDIRECTORY")?c.get("GEOKEYDIRECTORY").data:
null,c=!1;if(C){var c=2===d(C,"GTRasterTypeGeoKey"),R=d(C,"GTModelTypeGeoKey");2===R?(C=d(C,"GeographicTypeGeoKey"),1024<C&&32766>C&&(z={wkid:C})):1===R&&(C=d(C,"ProjectedCSTypeGeoKey"),1024<C&&32766>C&&(z={wkid:C}))}var K,V;n&&g&&6<=g.length?(K=[n[0],0,g[3]-g[0]*n[0],0,-Math.abs(n[1]),g[4]-g[1]*n[1]],c&&(K[2]-=.5*K[0]+.5*K[1],K[5]-=.5*K[3]+.5*K[4])):w&&16===w.length&&(K=[w[0],w[1],w[3],w[4],w[5],w[7]]);if(K){V=[{x:0,y:m},{x:0,y:0},{x:k,y:m},{x:k,y:0}];c=void 0;n=g=Number.POSITIVE_INFINITY;C=w=Number.NEGATIVE_INFINITY;
for(R=0;R<V.length;R++)c=f(V[R],K),g=c.x>g?g:c.x,w=c.x<w?w:c.x,n=c.y>n?n:c.y,C=c.y<C?C:c.y;V={xmin:g,xmax:w,ymin:n,ymax:C,spatialReference:z}}K=b.filter(function(a){return 1===d(a,"NEWSUBFILETYPE")});var M,Q,U,Z;0<K.length&&(M=Math.round(Math.log(k/d(K[0],"IMAGEWIDTH"))/Math.LN2),Q=Math.round(Math.log(k/d(K[K.length-1],"IMAGEWIDTH"))/Math.LN2),U=d(K[K.length-1],"TILEWIDTH"),Z=d(K[K.length-1],"TILEHEIGHT"));U=0<Q?U||h:null;Z=0<Q?Z||l:null;var X;h&&(X=[{maxCol:Math.ceil(k/h)-1,maxRow:Math.ceil(m/l)-
1,minRow:0,minCol:0}],K.forEach(function(a){X.push({maxCol:Math.ceil(d(a,"IMAGEWIDTH")/d(a,"TILEWIDTH"))-1,maxRow:Math.ceil(d(a,"IMAGELENGTH")/d(a,"TILELENGTH"))-1,minRow:0,minCol:0})}));b=d(b[0],"GDAL_METADATA");b=D(b);return{width:k,height:m,tileWidth:h,tileHeight:l,planes:p,isBSQ:x,pixelType:q,compression:r,noData:v,isSupported:y,message:B,extent:V,firstPyramidLevel:M,maximumPyramidLevel:Q,pyramidBlockWidth:U,pyramidBlockHeight:Z,tileBoundary:X,metadata:b}}function m(a){var b=new DataView(a,0,
8),c=b.getUint16(0,!1),d=null;if(18761===c)d=!0;else if(19789===c)d=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,d))throw"unexpected tiff identifier";c=b.getUint32(4,d);b=[];do if(c=y(a,d,c),c.success)b.push(c.ifd),c=c.nextIFD;else break;while(0<c);a=l(b);return z({},a,{littleEndian:d,ifds:b})}function y(a,b,c,d,e,f){void 0===d&&(d=0);void 0===e&&(e=n.TIFF_TAGS);void 0===f&&(f=4);c=B(a,b,c,d,e,f);var h,l=c.ifd;l&&(n.ifdTags.forEach(function(c,e){l.has(e)&&(h=l.get(e),h.data=B(a,
b,h.valueOffset-d,d,c).ifd)}),l.has("GEOKEYDIRECTORY")&&(h=l.get("GEOKEYDIRECTORY"),(e=h.values)&&4<e.length&&(e=e[0]+"."+e[1]+"."+e[2],h.data=B(a,b,h.valueOffset+6-d,d,n.GEO_KEYS,2).ifd,h.data&&h.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[e]}))),l.has("XMP")&&(h=l.get("XMP"),e=h.values,"number"===typeof e[0]&&7===h.type&&(h.values=[k.bytesToUTF8(new Uint8Array(e))])));return c}Object.defineProperty(g,"__esModule",{value:!0});var p=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),v=[0,1,1,2,4,8,1,1,2,4,8,4,8],q=function(e,f,l,k,g){f=p===f;var m=d(l,"BITSPERSAMPLE"),t=d(l,"SAMPLEFORMAT")||1,m=a(t,m),t=d(l,"COMPRESSION")[0]||1;l=c(m);var n,u;1===t?(n=e.slice(k,k+g),u=new Uint8Array(n)):8===t||32946===t?(u=new Uint8Array(e,k,g),u=new h(u),e=u.getBytes(),n=new ArrayBuffer(e.length),u=new Uint8Array(n),u.set(e)):6===t&&(u=new Uint8Array(e,k,g),n=new b,n.parse(u),e=n.getData(n.width,n.height,!0),n=new ArrayBuffer(e.length),
u=new Uint8Array(n),u.set(e));if("u8"!==m&&"s8"!==m&&!f)switch(n=new ArrayBuffer(u.length),f=new Uint8Array(n),m){case "u16":case "s16":for(m=0;m<u.length;m+=2)f[m]=u[m+1],f[m+1]=u[m];break;case "u32":case "s32":case "f32":for(m=0;m<u.length;m+=4)f[m]=u[m+3],f[m+1]=u[m+2],f[m+2]=u[m+1],f[m+3]=u[m]}return new l(n)},r=function(a,b,c){if(!(a&&0<a.length&&b&&c))return null;for(var d,e,f,h=a[0].length,l=a.length,k=new Uint8Array(h),m=0;m<l;m++)if(d=a[m],e=b[m],f=c[m],0===m)for(var g=0;g<h;g++)k[g]=d[g]<
e||d[g]>f?0:1;else for(g=0;g<h;g++)k[g]&&(k[g]=d[g]<e||d[g]>f?0:1);return k},D=function(a){if(!a)return null;var b=a.match(/<Item(.*?)Item>/gi);if(!b||0===b.length)return null;a=new Map;for(var c,d,e,f,h=0;h<b.length;h++)c=b[h],d=c.slice(6,c.indexOf("\x3e")),e=c.indexOf("sample\x3d"),-1<e&&(f=c.slice(e+8,c.indexOf('"',e+8))),e=c.indexOf("name\x3d"),-1<e&&(d=c.slice(e+6,c.indexOf('"',e+6))),d&&(c=c.slice(c.indexOf("\x3e")+1,c.indexOf("\x3c/Item\x3e")).trim(),null!=f?a.has(d)?a.get(d)[f]=c:a.set(d,
[c]):a.set(d,c)),f=null;b=a.get("STATISTICS_MINIMUM");d=a.get("STATISTICS_MAXIMUM");c=a.get("STATISTICS_MEAN");e=a.get("STATISTICS_STDDEV");f=null;if(b&&d)for(f=[],h=0;h<b.length;h++)f.push({min:parseFloat(b[h]),max:parseFloat(d[h]),avg:c&&parseFloat(c[h]),stddev:e&&parseFloat(e[h])});d=a.get("BandName");c=a.get("WavelengthMin");e=a.get("WavelengthMax");b=null;if(d)for(b=[],h=0;h<d.length;h++)b.push({BandName:d[h],WavelengthMin:c&&parseFloat(c[h]),WavelengthMax:e&&parseFloat(e[h])});h=a.get("DataType");
return{statistics:f,bandProperties:b,dataType:h,rawMetadata:a}};g.parseFieldValues=w;g.getImageInfo=l;g.parseHeader=m;g.parseSignature=function(a){var b=new DataView(a,0,8),c=b.getUint16(0,!1);a=null;if(18761===c)a=!0;else if(19789===c)a=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,a))throw"unexpected tiff identifier";b=b.getUint32(4,a);return{littleEndian:a,firstIFD:b}};g.parseIFD=y;g.decodeTileOrStrip=function(a,b){var e=b.headerInfo,f=b.ifd,h=q(a,e.littleEndian,f,b.offset||0,
b.size||a.byteLength);a=e.pixelType;for(var l=e.isBSQ,k=e.planes,m=c(a),g=h.length/k,n,p=[],u=0;u<k;u++){n=new m(g);if(l)n=h.slice(g*u,g*(u+1));else for(var v=0;v<g;v++)n[v]=h[v*k+u];p.push(n)}var h=d(f,"TILEWIDTH"),f=d(f,"TILELENGTH"),l=e.noData?e.noData[0]:null,e=(k=e.metadata?e.metadata.statistics:null)?k.map(function(a){return a.min}):null,k=k?k.map(function(a){return a.max}):null,x;if(null!=l)if(x=new Uint8Array(g),1E24<Math.abs(l))for(b=0;b<g;b++)x[b]=1E-6>Math.abs((p[0][b]-l)/l)?0:1;else for(b=
0;b<g;b++)x[b]=p[0][b]===l?0:1;else e&&k&&b.applyMinMaxConstraint&&(x=r(p,e,k));return{pixelType:a,width:h,height:f,pixels:p,mask:x,noDataValue:l}};g.decode=function(a,d){d=d||m(a);var f=d.ifds,l=d.noData;if(0===f.length)throw"no valid image file directory";f=f[0];l=l?l[0]:null;if(d.tileWidth){var k=e(f,"TILEOFFSETS");if(void 0===k)f=null;else{for(var g=e(f,"TILEBYTECOUNTS"),n=d.tileWidth,r=d.tileHeight,u=d.width,v=d.height,x=d.pixelType,w=d.isBSQ,y=d.planes,B=u*v,D=e(f,"BITSPERSAMPLE")[0],z=c(x),
C=[],T=0;T<y;T++)C.push(new z(B));var R,K,V,M,Q,U,Z,X,B=Math.ceil(u/n);if(0===D%8)for(D=0;D<k.length;D++)for(R=Math.floor(D/B)*r,M=D%B*n,T=R*u+M,z=q(a,d.littleEndian,f,k[D],g[D]),U=0,Q=T,M=Math.min(n,u-M),Z=Math.min(r,v-R),R=0;R<y;R++)if(X=C[R],w)for(K=0;K<Z;K++)for(Q=T+K*u,U=n*r*R+K*n,V=0;V<M;V++,Q++,U++)X[Q]=z[U];else for(K=0;K<Z;K++)for(Q=T+K*u,U=K*n*y+R,V=0;V<M;V++,Q++,U+=y)X[Q]=z[U];f={width:u,height:v,pixelType:x,pixels:C}}}else if(r=d,C=p===r.littleEndian,B=e(f,"STRIPOFFSETS"),void 0===B)f=
null;else{d=r.width;k=r.height;g=r.pixelType;r=r.planes;u=d*k;D=e(f,"BITSPERSAMPLE")[0];v=c(g);x=new v(u*r);z=e(f,"STRIPBYTECOUNTS");T=e(f,"ROWSPERSTRIP")[0];Q=e(f,"COMPRESSION")?e(f,"COMPRESSION")[0]:1;M=T;if(0===D%8)for(f=0;f<B.length;f++){U=f*T*d*r;M=(f+1)*T>k?k-f*T:T;if("u8"===g||"s8"===g||C)8===Q||32946===Q?(w=new Uint8Array(a,B[f],z[f]),w=new h(w),R=w.getBytes(),y=new ArrayBuffer(R.length),w=new Uint8Array(y),w.set(R),w.length!==M*d*r*D/8&&console.log("strip byte counts is different than expected")):
6===Q?(w=new Uint8Array(a,B[f],z[f]),y=new b,y.parse(w),M=y.getData(y.width,y.height,!0),y=new ArrayBuffer(M.length),w=new Uint8Array(y),w.set(M)):1===Q&&(z[f]!==M*d*r*D/8&&console.log("strip byte counts is different than expected"),y=a.slice(B[f],B[f]+z[f]));else switch(6===Q||8===Q||32946===Q?(w=new Uint8Array(a,B[f],z[f]),w=new h(w),w=w.getBytes(),y=new ArrayBuffer(w.length),n=new Uint8Array(y),w.length!==M*d*r*D/8&&console.log("strip byte counts is different than expected")):1===Q&&(z[f]!==M*
d*r*D/8&&console.log("strip byte counts is different than expected"),y=new ArrayBuffer(z[f]),w=new Uint8Array(a,B[f],z[f]),n=new Uint8Array(y)),g){case "u16":case "s16":for(M=0;M<w.length;M+=2)n[M]=w[M+1],n[M+1]=w[M];break;case "u32":case "s32":case "f32":for(M=0;M<w.length;M+=4)n[M]=w[M+3],n[M+1]=w[M+2],n[M+2]=w[M+1],n[M+3]=w[M]}M=new v(y);x.set(M,U)}w=[];if(1===r)w.push(x);else for(f=0;f<r;f++){n=new v(u);for(a=0;a<u;a++)n[a]=x[a*r+f];w.push(n)}f={width:d,height:k,pixelType:g,pixels:w}}if(null!==
l){f.mask=new Uint8Array(f.width*f.height);if(1E24<Math.abs(l))for(a=0;a<f.width*f.height;a++)f.mask[a]=1E-6>Math.abs((f.pixels[0][a]-l)/l)?0:1;else for(a=0;a<f.width*f.height;a++)f.mask[a]=f.pixels[0][a]===l?0:1;f.noDataValue=l}return f}})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["require","exports"],function(C,g){Object.defineProperty(g,"__esModule",{value:!0});g.bytesToUTF8=function(g,k){for(var b=0,n="",h=0,a=0,c=g.length;b<c;)if(a=g[b++],h=a>>4,8>h?h=1:15===h?
(h=4,a=(a&7)<<18|(g[b++]&63)<<12|(g[b++]&63)<<6|g[b++]&63):14===h?(h=3,a=(a&15)<<12|(g[b++]&63)<<6|g[b++]&63):(h=2,a=(a&31)<<6|g[b++]&63),0!==a||k)n+=String.fromCharCode(a);return n}})},"esri/layers/support/rasterFormats/TiffTags":function(){define(["require","exports"],function(C,g){var z=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]=
"CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";
b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]=
"INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]=
"YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[700]="XMP";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34264]="GEOTRANSMATRIX";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";b[34665]="EXIFIFD";b[34853]="GPSIFD";b[40965]="INTEROPERABILITYIFD";return b}();C=function(){var b=[].concat(z);b[36864]="ExifVersion";b[40960]="FlashpixVersion";b[40961]="ColorSpace";b[42240]=
"Gamma";b[37121]="ComponentsConfiguration";b[37122]="CompressedBitsPerPixel";b[40962]="PixelXDimension";b[40963]="PixelYDimension";b[37500]="MakerNote";b[37510]="UserComment";b[40964]="RelatedSoundFile";b[36867]="DateTimeOriginal";b[36868]="DateTimeDigitized";b[36880]="OffsetTime";b[36881]="OffsetTimeOriginal";b[36882]="OffsetTimeDigitized";b[37520]="SubSecTime";b[37521]="SubSecTimeOriginal";b[37522]="SubSecTimeDigitized";b[37888]="Temperature";b[37889]="Humidity";b[37890]="Pressure";b[37891]="WaterDepth";
b[37892]="Acceleration";b[37893]="CameraElevationAngle";b[42016]="ImageUniqueID";b[42032]="CameraOwnerName";b[42033]="BodySerialNumber";b[42034]="LensSpecification";b[42035]="LensMake";b[42036]="LensModel";b[42037]="LensSerialNumber";b[33434]="ExposureTime";b[33437]="FNumber";b[34850]="ExposureProgram";b[34852]="SpectralSensitivity";b[34855]="PhotographicSensitivity";b[34856]="OECF";b[34864]="SensitivityType";b[34865]="StandardOutputSensitivity";b[34866]="RecommendedExposureIndex";b[34867]="ISOSpeed";
b[34868]="ISOSpeedLatitudeyyy";b[34869]="ISOSpeedLatitudezzz";b[37377]="ShutterSpeedValue";b[37378]="ApertureValue";b[37379]="BrightnessValue";b[37380]="ExposureBiasValue";b[37381]="MaxApertureValue";b[37382]="SubjectDistance";b[37383]="MeteringMode";b[37384]="LightSource";b[37385]="Flash";b[37386]="FocalLength";b[37396]="SubjectArea";b[41483]="FlashEnergy";b[41484]="SpatialFrequencyResponse";b[41486]="FocalPlaneXResolution";b[41487]="FocalPlaneYResolution";b[41488]="FocalPlaneResolutionUnit";b[41492]=
"SubjectLocation";b[41493]="ExposureIndex";b[41495]="SensingMethod";b[41728]="FileSource";b[41729]="SceneType";b[41730]="CFAPattern";b[41985]="CustomRendered";b[41986]="ExposureMode";b[41987]="WhiteBalance";b[41988]="DigitalZoomRatio";b[41989]="FocalLengthIn35mmFilm";b[41990]="SceneCaptureType";b[41991]="GainControl";b[41992]="Contrast";b[41993]="Saturation";b[41994]="Sharpness";b[41995]="DeviceSettingDescription";b[41996]="SubjectDistanceRange";return b}();g=function(){var b=[];b[1024]="GTModelTypeGeoKey";
b[1025]="GTRasterTypeGeoKey";b[1026]="GTCitationGeoKey";b[2048]="GeographicTypeGeoKey";b[2049]="GeogCitationGeoKey";b[2050]="GeogGeodeticDatumGeoKey";b[2051]="GeogPrimeMeridianGeoKey";b[2052]="GeogLinearUnitsGeoKey";b[2053]="GeogLinearUnitSizeGeoKey";b[2054]="GeogAngularUnitsGeoKey";b[2055]="GeogAngularUnitSizeGeoKey";b[2056]="GeogEllipsoidGeoKey";b[2057]="GeogSemiMajorAxisGeoKey";b[2058]="GeogSemiMinorAxisGeoKey";b[2059]="GeogInvFlatteningGeoKey";b[2061]="GeogPrimeMeridianLongGeoKey";b[2060]="GeogAzimuthUnitsGeoKey";
b[3072]="ProjectedCSTypeGeoKey";b[3073]="PCSCitationGeoKey";b[3074]="ProjectionGeoKey";b[3075]="ProjCoordTransGeoKey";b[3076]="ProjLinearUnitsGeoKey";b[3077]="ProjLinearUnitSizeGeoKey";b[3078]="ProjStdParallel1GeoKey";b[3079]="ProjStdParallel2GeoKey";b[3080]="ProjNatOriginLongGeoKey";b[3081]="ProjNatOriginLatGeoKey";b[3082]="ProjFalseEastingGeoKey";b[3083]="ProjFalseNorthingGeoKey";b[3084]="ProjFalseOriginLongGeoKey";b[3085]="ProjFalseOriginLatGeoKey";b[3086]="ProjFalseOriginEastingGeoKey";b[3087]=
"ProjFalseOriginNorthingGeoKey";b[3088]="ProjCenterLongGeoKey";b[3090]="ProjCenterEastingGeoKey";b[3091]="ProjCenterNorthingGeoKey";b[3092]="ProjScaleAtNatOriginGeoKey";b[3093]="ProjScaleAtCenterGeoKey";b[3094]="ProjAzimuthAngleGeoKey";b[3095]="ProjStraightVertPoleLongGeoKey";b[4096]="VerticalCSTypeGeoKey";b[4097]="VerticalCitationGeoKey";b[4098]="VerticalDatumGeoKey";b[4099]="VerticalUnitsGeoKey";return b}();var k=new Map;k.set("EXIFIFD",C);k.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{TIFF_TAGS:z,ifdTags:k,GEO_KEYS:g,getTagName:function(b,k){k=(k||z)[b];void 0===k&&(k="unknown"+String(b));return k}}})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(C,g,z){function k(a,b){a=Math.min(Math.max(a,-100),100);b=Math.min(Math.max(b,-100),100);var c,e,d=new Uint8Array(256);for(c=0;256>c;c++)0<a&&100>a?e=(200*c-25500+510*b)/(2*(100-a))+128:0>=a&&-100<a?e=(200*c-25500+510*b)*(100+a)/2E4+128:100===a?(e=200*c-25500+
256*(100-a)+510*b,e=0<e?255:0):-100===a&&(e=128),d[c]=255<e?255:0>e?0:e;return d}function b(a,b,f,e,d,h,k,l){return{xmin:d<=f*a?0:d<f*a+a?d-f*a:a,ymin:h<=e*b?0:h<e*b+b?h-e*b:b,xmax:d+k<=f*a?0:d+k<f*a+a?d+k-f*a:a,ymax:h+l<=e*b?0:h+l<e*b+b?h+l-e*b:b}}function n(a,c,f,e){var d=a.filter(function(a){return h(a)})[0];if(null==d)return null;var k=e?e.width:c.width;e=e?e.height:c.height;var g=d.width,l=d.height,m=c.width/g;c=c.height/l;var n=f?f.x:0;f=f?f.y:0;var p=d.pixelType,v=z.getPixelArrayConstructor(p),
q=d.pixels.length,d=[],r,D,x,u,t,A,E,G,H,F;for(t=0;t<q;t++){D=new v(k*e);for(A=0;A<c;A++)for(E=0;E<m;E++)if(x=a[A*m+E])for(r=x.pixels[t],F=b(g,l,E,A,n,f,k,e),G=F.ymin;G<F.ymax;G++)for(x=(A*l+G-f)*k+(E*g-n),u=G*g,H=F.xmin;H<F.xmax;H++)D[x+H]=r[u+H];d.push(D)}var I;if(a.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(I=new Uint8Array(k*e),A=0;A<c;A++)for(E=0;E<m;E++)if(v=(x=a[A*m+E])?x.mask:null,F=b(g,l,E,A,n,f,k,e),v)for(G=F.ymin;G<F.ymax;G++)for(x=(A*l+G-f)*k+(E*g-n),u=G*g,H=F.xmin;H<
F.xmax;H++)I[x+H]=v[u+H];else if(x)for(G=F.ymin;G<F.ymax;G++)for(x=(A*l+G-f)*k+(E*g-n),u=G*g,H=F.xmin;H<F.xmax;H++)I[x+H]=1;else for(G=F.ymin;G<F.ymax;G++)for(x=(A*l+G-f)*k+(E*g-n),u=G*g,H=F.xmin;H<F.xmax;H++)I[x+H]=0;a=new z({width:k,height:e,pixels:d,pixelType:p,mask:I});a.updateStatistics();return a}Object.defineProperty(g,"__esModule",{value:!0});var h=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};g.extractBands=function(a,b){if(!b||!h(a))return a;
var c=a.pixels.length;return b&&b.some(function(a){return a>=c})||1===c&&1===b.length&&0===b[0]||c===b.length&&!b.some(function(a,b){return a!==b})?a:new z({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:b.map(function(b){return a.pixels[b]}),statistics:a.statistics&&b.map(function(b){return a.statistics[b]})})};g.createColormapLUT=function(a){if(a){var b=a.colormap;if(b&&0!==b.length){var b=b.sort(function(a,b){return a[0]-
b[0]}),f=0;0>b[0][0]&&(f=b[0][0]);var e=Math.max(256,b[b.length-1][0]-f+1),d=new Uint8Array(4*e),h=[],k=0,l=0,g=5===b[0].length;if(65536<e)return b.forEach(function(a){h[a[0]-f]=g?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:h,offset:f,alphaSpecified:g};if(a.fillUnspecified)for(a=b[l],k=a[0]-f;k<e;k++)d[4*k]=a[1],d[4*k+1]=a[2],d[4*k+2]=a[3],d[4*k+3]=g?a[4]:255,k===a[0]-f&&(a=l===b.length-1?a:b[++l]);else for(k=0;k<b.length;k++)a=b[k],l=4*(a[0]-f),d[l]=a[1],d[l+1]=a[2],d[l+2]=a[3],d[l+
3]=g?a[4]:255;return{indexedColormap:d,offset:f,alphaSpecified:g}}}};g.colorize=function(a,b){if(!h(a)||!b&&(b.indexedColormap||b.indexed2DColormap))return a;var c=a.clone(),e=c.pixels,d=c.mask,k=c.width*c.height;if(1!==e.length)return a;var g=b.indexedColormap;a=b.indexed2DColormap;var l=b.offset;b=b.alphaSpecified;var m=g.length-1,n=0,e=e[0],p=new Uint8Array(e.length),v=new Uint8Array(e.length),q=new Uint8Array(e.length),r=0;if(g)if(d)for(n=0;n<k;n++)d[n]&&(r=4*(e[n]-l),r<l||r>m?d[n]=0:(p[n]=g[r],
v[n]=g[r+1],q[n]=g[r+2],d[n]=g[r+3]));else{d=new Uint8Array(k);for(n=0;n<k;n++)r=4*(e[n]-l),r<l||r>m?d[n]=0:(p[n]=g[r],v[n]=g[r+1],q[n]=g[r+2],d[n]=g[r+3]);c.mask=d}else if(d)for(n=0;n<k;n++)d[n]&&(g=a[e[n]],p[n]=g[0],v[n]=g[1],q[n]=g[2],d[n]=g[3]);else{d=new Uint8Array(k);for(n=0;n<k;n++)g=a[e[n]],p[n]=g[0],v[n]=g[1],q[n]=g[2],d[n]=g[3];c.mask=d}c.pixels=[p,v,q];c.statistics=null;c.pixelType="u8";c.maskIsAlpha=b;return c};g.estimateStatisticsHistograms=function(a){if(!h(a))return null;a.statistics||
a.updateStatistics();var b=a.pixels,f=a.mask,e=a.pixelType,d=a.statistics;a=a.width*a.height;var k=b.length,g,l,m,n,p,v=[],q=[],r,D,x;for(n=0;n<k;n++){r=new Uint32Array(256);x=b[n];if("u8"===e)if(g=-.5,l=255.5,f)for(p=0;p<a;p++)f[p]&&r[x[p]]++;else for(p=0;p<a;p++)r[x[p]]++;else{g=d[n].minValue;l=d[n].maxValue;m=(l-g)/256;D=new Uint32Array(257);if(f)for(p=0;p<a;p++)f[p]&&D[Math.floor((x[p]-g)/m)]++;else for(p=0;p<a;p++)D[Math.floor((x[p]-g)/m)]++;for(p=0;255>p;p++)r[p]=D[p];r[255]=D[255]+D[256]}v.push({min:g,
max:l,size:256,counts:r});for(p=x=D=m=0;256>p;p++)m+=r[p],D+=p*r[p];D/=m;for(p=0;256>p;p++)x+=r[p]*Math.pow(p-D,2);r=Math.sqrt(x/(m-1));m=(l-g)/256;p=(D+.5)*m+g;r*=m;q.push({min:g,max:l,avg:p,stddev:r})}return{statistics:q,histograms:v}};g.createStretchLUT=function(a){var b=a.minCutOff,f=a.maxCutOff,e=a.gamma,d=a.pixelType,h=a.outMin||0,g=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(d))return null;var l=b.length,m,n=0;"s8"===d?n=-127:"s16"===d&&(n=-32767);var p=256;-1<["u16","s16"].indexOf(d)&&
(p=65536);for(var v=[],q=g-h,d=0;d<l;d++)v[d]=f[d]-b[d];m=e&&e.length>=l;var r=[];if(m)for(d=0;d<l;d++)r[d]=1<e[d]?2<e[d]?6.5+Math.pow(e[d]-2,2.5):6.5+100*Math.pow(2-e[d],4):1;var D,x=[],u,t,A;if(m)for(d=0;d<l;d++){A=[];for(m=0;m<p;m++)u=m+n,D=(u-b[d])/v[d],t=1,1<e[d]&&(t-=Math.pow(1/q,D*r[d])),A[m]=u<f[d]&&u>b[d]?Math.floor(t*q*Math.pow(D,1/e[d]))+h:u>=f[d]?g:h;x[d]=A}else for(d=0;d<l;d++){A=[];for(m=0;m<p;m++)u=m+n,A[m]=u<=b[d]?h:u>=f[d]?g:Math.floor((u-b[d])/v[d]*q)+h;x[d]=A}if(null!=a.contrastOffset)for(a=
k(a.contrastOffset,a.brightnessOffset),d=0;d<l;d++)for(A=x[d],m=0;m<p;m++)A[m]=a[A[m]];return{lut:x,offset:n}};g.createContrastBrightnessLUT=k;g.stretch=function(a,b){if(!h(a))return null;a=a.clone();var c=a.pixels,e=a.mask,d=b.minCutOff,k=b.maxCutOff,g=b.gamma,l=b.outMin||0;b=b.outMax||255;var m=a.width*a.height,n=c.length,p,v,q,r,D,x=b-l,u=[];for(p=0;p<n;p++)u[p]=k[p]-d[p];v=g&&g.length>=n;var t=[];if(v)for(p=0;p<n;p++)t[p]=1<g[p]?2<g[p]?6.5+Math.pow(g[p]-2,2.5):6.5+100*Math.pow(2-g[p],4):1;if(v)if(null!=
e)for(v=0;v<m;v++){if(e[v])for(p=0;p<n;p++)q=c[p][v],D=(q-d[p])/u[p],r=1,1<g[p]&&(r-=Math.pow(1/x,D*t[p])),c[p][v]=q<k[p]&&q>d[p]?Math.floor(r*x*Math.pow(D,1/g[p]))+l:q>=k[p]?b:l}else for(v=0;v<m;v++)for(p=0;p<n;p++)q=c[p][v],D=(q-d[p])/u[p],r=1,1<g[p]&&(r-=Math.pow(1/x,D*t[p])),c[p][v]=q<k[p]&&q>d[p]?Math.floor(r*x*Math.pow(D,1/g[p]))+l:q>=k[p]?b:l;else if(null!=e)for(v=0;v<m;v++){if(e[v])for(p=0;p<n;p++)q=c[p][v],c[p][v]=q<k[p]&&q>d[p]?Math.floor((q-d[p])/u[p]*x)+l:q>=k[p]?b:l}else for(v=0;v<m;v++)for(p=
0;p<n;p++)q=c[p][v],c[p][v]=q<k[p]&&q>d[p]?Math.floor((q-d[p])/u[p]*x)+l:q>=k[p]?b:l;a.pixelType="u8";a.updateStatistics();return a};g.lookupPixels=function(a,b){if(!h(a))return null;var c=a.pixels,e=a.mask,d=a.width*a.height,k=c.length,g=b.lut;b=b.offset;var l,m;g&&1===g[0].length&&(g=c.map(function(){return g}));var n=[],p,v,q;if(b)if(null==e)for(l=0;l<k;l++){p=c[l];v=g[l];q=new Uint8Array(d);for(m=0;m<d;m++)q[m]=v[p[m]-b];n.push(q)}else for(l=0;l<k;l++){p=c[l];v=g[l];q=new Uint8Array(d);for(m=
0;m<d;m++)e[m]&&(q[m]=v[p[m]-b]);n.push(q)}else if(null==e)for(l=0;l<k;l++){p=c[l];v=g[l];q=new Uint8Array(d);for(m=0;m<d;m++)q[m]=v[p[m]];n.push(q)}else for(l=0;l<k;l++){p=c[l];v=g[l];q=new Uint8Array(d);for(m=0;m<d;m++)e[m]&&(q[m]=v[p[m]]);n.push(q)}a=new z({width:a.width,height:a.height,pixels:n,mask:e,pixelType:"u8"});a.updateStatistics();return a};g.remapColor=function(a,b){if(!h(a))return null;a=a.clone();var c=a.width*a.height,e=b.length,d=Math.floor(e/2),k=b[Math.floor(d)],g=a.pixels[0],l,
m,n,p,v,q,r=!1,D=new Uint8Array(c),x=new Uint8Array(c),u=new Uint8Array(c),t=a.mask,A=4===b[0].mappedColor.length;t||(t=new Uint8Array(c),t.fill(A?255:1),a.mask=t);for(v=0;v<c;v++)if(t[v]){l=g[v];r=!1;q=d;m=k;n=0;for(p=e-1;1<p-n;){if(l===m.value){r=!0;break}l>m.value?n=q:p=q;q=Math.floor((n+p)/2);m=b[Math.floor(q)]}r||(l===b[n].value?(m=b[n],r=!0):l===b[p].value?(m=b[p],r=!0):l<b[n].value?(r=!1,m=null):l>b[n].value&&(l<b[p].value?(m=b[n],r=!0):p===e-1?(r=!1,m=null):(m=b[p],r=!0)));r?(D[v]=m.mappedColor[0],
x[v]=m.mappedColor[1],u[v]=m.mappedColor[2],t[v]=m.mappedColor[3]):D[v]=x[v]=u[v]=t[v]=0}a.pixels=[D,x,u];a.mask=t;a.pixelType="u8";a.maskIsAlpha=A;return a};g.getClipBounds=b;g.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var c=a.filter(function(a){return a.pixelBlock})[0];if(!c)return null;var e=(c.extent.xmax-c.extent.xmin)/c.pixelBlock.width,d=(c.extent.ymax-c.extent.ymin)/c.pixelBlock.height,h=.01*Math.min(e,d),k=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>
h?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>h?a.extent.xmin-b.extent.xmin:0}),g=Math.min.apply(null,k.map(function(a){return a.extent.xmin})),m=Math.min.apply(null,k.map(function(a){return a.extent.ymin})),y=Math.max.apply(null,k.map(function(a){return a.extent.xmax})),p=Math.max.apply(null,k.map(function(a){return a.extent.ymax}));a={x:Math.round((b.xmin-g)/e),y:Math.round((p-b.ymax)/d)};g={width:Math.round((y-g)/e),height:Math.round((p-m)/d)};e={width:Math.round((b.xmax-
b.xmin)/e),height:Math.round((b.ymax-b.ymin)/d)};if(Math.round(g.width/c.pixelBlock.width)*Math.round(g.height/c.pixelBlock.height)!==k.length||0>a.x||0>a.y||g.width<e.width||g.height<e.height)return null;c=k.map(function(a){return a.pixelBlock});c=n(c,g,a,e);return{extent:b,pixelBlock:c}};g.mosaic=n;g.setValidBoundary=function(a,b,f){if(!h(a))return null;var c=a.width,d=a.height,k=b.x;b=b.y;var g=f.width+k;f=f.height+b;if(0>k||0>b||g>c||f>d||0===k&&0===b&&g===c&&f===d)return a;a.mask||(a.mask=new Uint8Array(c*
d));for(var l=a.mask,m=0;m<d;m++)for(var n=m*c,p=0;p<c;p++)l[n+p]=m<b||m>=f||p<k||p>=g?0:1;a.updateStatistics();return a};g.clip=function(a,b,f){if(!h(a))return null;var c=b.x,d=b.y,k=b.x+f.width;b=b.x+f.height;if(b===a.height&&k===a.width)return a;for(var g=a.pixels,l=a.mask,m=a.width,n=m*a.height,p=g.length,v=[],q=0;q<p;q++){for(var r=g[q],D=z.createEmptyBand(a.pixelType,n),x=0,u=d;u<=b;u++)for(var t=u*m,A=c;A<=k;A++)D[x++]=r[t+A];v.push(D)}var E;if(l)for(E=new Uint8Array(f.width*f.height),x=0,
u=d;u<=b;u++)for(t=u*m,A=c;A<=k;A++)E[x++]=l[t+A];a=new z({width:f.width,height:f.height,pixels:v,mask:E});a.updateStatistics();return a};g.approximateTransform=function(a,b,f,e){if(!h(a))return null;var c=a.pixels,k=a.mask,g=a.pixelType,l=a.width,m=a.height;a=z.getPixelArrayConstructor(g);var n=c.length,p=b.width,v=b.height;b=e.cols;var q=e.rows,r=Math.ceil(p/b),D=Math.ceil(v/q),x=!1;for(e=0;e<f.length;e+=3)-1===f[e]&&-1===f[e+1]&&-1===f[e+2]&&(x=!0);var u,t,A,E,G,H,F,I=new Float32Array(p*v),J=new Float32Array(p*
v),P=0,L,C;for(e=0;e<D;e++)for(var W=0;W<r;W++){u=12*(e*r+W);t=f[u];A=f[u+1];E=f[u+2];G=f[u+3];H=f[u+4];F=f[u+5];for(var N=0;N<q;N++){P=(e*q+N)*p+W*b;C=(N+.5)/q;for(var O=0;O<N;O++)L=(O+.5)/b,I[P+O]=Math.round((t*L+A*C+E)*l-.5),J[P+O]=Math.round((G*L+H*C+F)*m-.5)}u+=6;t=f[u];A=f[u+1];E=f[u+2];G=f[u+3];H=f[u+4];F=f[u+5];for(N=0;N<q;N++)for(P=(e*q+N)*p+W*b,C=(N+.5)/q,O=N;O<b;O++)L=(O+.5)/b,I[P+O]=Math.round((t*L+A*C+E)*l-.5),J[P+O]=Math.round((G*L+H*C+F)*m-.5)}f=function(a,b){for(var c=0;c<v;c++){u=
c*p;for(var d=0;d<p;d++)a[u]=x&&(0>I[u]||0>J[u])?0:b[I[u]+J[u]*l],u++}};m=[];for(e=0;e<n;e++)b=new a(p*v),f(b,c[e]),m.push(b);c=new z({width:p,height:v,pixelType:g,pixels:m});if(k)c.mask=new Uint8Array(p*v),f(c.mask,k);else if(x)for(c.mask=new Uint8Array(p*v),e=0;e<p*v;e++)c.mask[e]=0>I[e]||0>J[e]?0:1;c.updateStatistics();return c}})},"esri/layers/support/rasterDatasets/DBFParser":function(){define(["require","exports","./byteStreamUtils"],function(C,g,z){function k(b){var k=b.fields;b=b.records;
var h=k.some(function(a){return"oid"===a.name.toLowerCase()})?"OBJECTID":"OID",k=[{name:h,type:"esriFieldTypeOID",alias:"OID"}].concat(k.map(function(a){return{name:a.name,type:"esriFieldType"+a.typeName,alias:a.name}})),a=k.map(function(a){return a.name}),c=[],f=0,e=0;b.forEach(function(b){var d={};d[h]=f++;for(e=1;e<a.length;e++)d[a[e]]=b[e-1];c.push({attributes:d})});return{displayFieldName:"",fields:k,features:c}}return function(){function b(){}Object.defineProperty(b,"supportedVersions",{get:function(){return[5]},
enumerable:!0,configurable:!0});b.parse=function(b){var h=new DataView(b),a=h.getUint8(0)&3;if(3!==a)return{header:{version:a},recordSet:null};var c=h.getUint32(4,!0),f=h.getUint16(8,!0),e=h.getUint16(10,!0),f={version:a,recordCount:c,headerByteCount:f,recordByteCount:e},d=32,g=[],n=[];if(3===a){for(;13!==h.getUint8(d);)a=String.fromCharCode(h.getUint8(d+11)).trim(),g.push({name:z.bytesToUTF8(new Uint8Array(b,d,11)),type:a,typeName:"String Date Double Boolean String Integer".split(" ")["CDFLMN".split("").indexOf(a)],
length:h.getUint8(d+16)}),d+=32;d+=1;if(0<g.length)for(a=function(){var a=[];32===h.getUint8(d)?(d+=1,g.forEach(function(c){if("C"===c.type)a.push(z.bytesToUTF8(new Uint8Array(b,d,c.length)).trim());else if("N"===c.type)a.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(b,d,c.length)).trim(),10));else if("F"===c.type)a.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(b,d,c.length)).trim()));else if("D"===c.type){var e=String.fromCharCode.apply(null,new Uint8Array(b,d,c.length)).trim();
a.push(new Date(parseInt(e.substring(0,4),10),parseInt(e.substring(4,6),10)-1,parseInt(e.substring(6,8),10)))}d+=c.length}),n.push(a)):d+=e};n.length<c&&b.byteLength-d>e;)a()}c=k({fields:g,records:n});return{header:f,fields:g,records:n,recordSet:c}};return b}()})},"esri/layers/support/rasterDatasets/ImageServerRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../request ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ../TileInfo ../TilemapCache ./BaseRaster ../rasterFunctions/pixelUtils ../../../tasks/support/FeatureSet".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m,y,p,v,q,r){return function(h){function g(){var a=null!==h&&h.apply(this,arguments)||this;a._levelOffset=0;a._slices=null;a._tilemapCache=null;a.sourceJSON=null;return a}n(g,h);g.prototype.open=function(a){return b(this,void 0,void 0,function(){var b,d,g,h,k,l,n,r,q,u,v,x,w,D,C,T,R,K,V,M,Q,U,Z,X,aa;return z(this,function(t){switch(t.label){case 0:return[4,this.init()];case 1:t.sent();b=a&&a.signal;if(!this.sourceJSON)return[3,2];g={data:this.sourceJSON};return[3,
4];case 2:return[4,c(this.url,{responseType:"json",query:{f:"json"},signal:b})];case 3:g=t.sent(),t.label=4;case 4:d=g;d.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=h=d.data;k="jpg jpeg png png8 png24 png32 mixed".split(" ");this.tileType=h.cacheType;null===this.tileType&&(-1<k.indexOf(h.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===h.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster");if(!h||!h.tileInfo)throw new f("imageserverraster:open",
"cannot initialize tiled image service");this.datasetName=h.name;return[4,this._fetchRasterInfo({signal:b})];case 5:l=t.sent();if(e.isSome(l)){n=y.fromJSON(h.tileInfo);r=l.extent;q=l.pixelSize;u=.5/l.width*q.x;x=v=void 0;w=n.lodAt(Math.max.apply(null,n.lods.map(function(a){return a.level})));0!==h.maxScale&&("Raster"===this.tileType?(v=n.lods.filter(function(a){return a.resolution===q.x})[0])||(v=n.lods.filter(function(a){return a.resolution>q.x}).sort(function(a,b){return a.resolution>b.resolution?
1:-1})[0]):(v=n.lods.filter(function(a){return Math.abs(a.scale-h.maxScale)<u})[0])||(v=n.lods.filter(function(a){return a.scale>h.maxScale}).sort(function(a,b){return a.scale>b.scale?1:-1})[0]),q.x=q.y=v.resolution,l.width=Math.ceil((r.xmax-r.xmin)/q.x-.1),l.height=Math.ceil((r.ymax-r.ymin)/q.y-.1));v||(v=w);D=n.lodAt(Math.min.apply(null,n.lods.map(function(a){return a.level})));0!==h.minScale&&"Raster"!==this.tileType&&(x=n.lods.filter(function(a){return Math.abs(a.scale-h.minScale)<u})[0],this._levelOffset=
x.level-D.level);x||(x=D);C=Math.max(q.x,q.y);if(Math.abs(q.x-q.y)>u||!n.lods.some(function(a){return Math.abs(a.resolution-C)<u}))q.x=q.y=v.resolution,l.width=Math.ceil((r.xmax-r.xmin)/q.x-.1),l.height=Math.ceil((r.ymax-r.ymin)/q.y-.1);T=v.level-x.level;R=n.size;K=R[0];V=R[1];M=n.origin;Q=q.x;U=q.y;Z=[{minCol:Math.floor((r.xmin-M.x+.1*Q)/K/Q),maxCol:Math.floor((r.xmax-M.x-.1*Q)/K/Q),minRow:Math.floor((M.y-r.ymax+.1*U)/V/U),maxRow:Math.floor((M.y-r.ymin-.1*U)/V/U)}];if(0<T)for(X=0;X<T;X++)Q*=2,U*=
2,Z.push({minCol:Math.floor((r.xmin-M.x+.1*Q)/K/Q),maxCol:Math.floor((r.xmax-M.x-.1*Q)/K/Q),minRow:Math.floor((M.y-r.ymax+.1*U)/V/Q),maxRow:Math.floor((M.y-r.ymin-.1*U)/V/Q)});l.storageInfo=new m({blockWidth:n.size[0],blockHeight:n.size[1],pyramidBlockWidth:n.size[0],pyramidBlockHeight:n.size[1],compression:n.format,origin:n.origin,firstPyramidLevel:1,maximumPyramidLevel:T,tileInfo:n,blockBoundary:Z});this._set("rasterInfo",l)}else throw new f("image-server-raster:open","cannot initialize image service");
-1<h.capabilities.toLowerCase().indexOf("tilemap")&&(aa={tileInfo:l.storageInfo.tileInfo,parsedUrl:B.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new p.TilemapCache({layer:aa}));return[2]}})})};g.prototype.fetchRawTile=function(a,c,d,e){void 0===e&&(e={});return b(this,void 0,void 0,function(){var b,f,h,g,k,l,m,n,t,r,p,u,v,x,A,E,w,D,y,B,C,aa;return z(this,function(G){switch(G.label){case 0:return b=this.rasterInfo,f=b.storageInfo,h=b.extent,g=b.pixelSize,k=f.maximumPyramidLevel-
a+this._levelOffset,l=this.url+"/tile/"+k+"/"+c+"/"+d,m=this._slices?{sliceId:e.sliceId||0}:null,[4,this.request({url:l,query:m,responseType:"array-buffer"},e.signal)];case 1:return(n=G.sent())?[4,this.decodePixelBlock(n,{width:f.tileInfo.size[0],height:f.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:t=G.sent();r=f.blockBoundary[a];if("jpg"!==f.compression||d>r.minCol&&d<r.maxCol&&c>r.minRow&&c<r.maxRow)return[2,t];p=f.origin;u=f.blockWidth;v=f.blockHeight;
x=Math.pow(2,a);A=Math.round((h.xmin-p.x)/(g.x*x))%u;E=Math.round((h.xmax-p.x)/(g.x*x))%u;w=Math.round((p.y-h.ymax)/(g.x*x))%v;D=Math.round((p.y-h.ymin)/(g.x*x))%v;y=d===r.minCol?A:0;B=c===r.minRow?w:0;C=d===r.maxCol?E:u;aa=c===r.maxRow?D:v;q.setValidBoundary(t,{x:y,y:B},{width:C-y,height:aa-B});return[2,t]}})})};g.prototype.getSliceIndex=function(a){for(var b=0;b<this._slices.length;b++){var c=this._slices[b].multidimensionalDefinition;if(c.length===a.length&&!c.some(function(b){var c=a.filter(function(a){return b.variableName===
a.variableName&&a.dimensionName===b.dimensionName})[0];if(!c)return null;var d=Array.isArray(b.values[0])?b.values[0][0]:b.values[0],c=Array.isArray(c.values[0])?c.values[0][0]:c.values[0];return d!==c}))return b}return null};g.prototype.computeBestPyramidLevelForLocation=function(a,c){void 0===c&&(c={});return b(this,void 0,void 0,function(){var b,d,e,f,h,g;return z(this,function(k){switch(k.label){case 0:if(!this._tilemapCache)return[2,0];b=this.identifyPixelLocation(a,0,c.datumTransformation);
if(null===b)return[2,null];d=0;e=this.rasterInfo.storageInfo.maximumPyramidLevel;f=e-d+this._levelOffset;h=b.srcLocation;k.label=1;case 1:if(!(0<=f))return[3,6];k.label=2;case 2:return k.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(f,b.row,b.col,c)];case 3:return g=k.sent(),"available"===g?[3,6]:[3,5];case 4:return k.sent(),[3,5];case 5:return f--,d++,b=this.identifyPixelLocation(h,d,c.datumTransformation),null===b?[2,null]:[3,1];case 6:return-1===f||null==b?[2,null]:[2,d]}})})};g.prototype._fetchRasterInfo=
function(e){return b(this,void 0,void 0,function(){var b,f,h,g,k,m,n,p,q,v,u,x,w=this;return z(this,function(t){b=this.sourceJSON;f=Math.ceil((b.extent.xmax-b.extent.xmin)/b.pixelSizeX-.1);h=Math.ceil((b.extent.ymax-b.extent.ymin)/b.pixelSizeY-.1);g=a.SpatialReference.fromJSON(b.spatialReference||b.extent.spatialReference);if("Map"===this.tileType)return[2,new l({width:f,height:h,bandCount:3,extent:a.Extent.fromJSON(b.extent),spatialReference:g,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,
spatialReference:g}),pixelType:"u8",statistics:null})];k=e.slice;m=e.signal;n=b.hasRasterAttributeTable?c(this.url+"/rasterAttributeTable",{query:{slice:k,f:"json"},signal:m}).then(function(a){return r.fromJSON(a.data)}).catch(function(){return null}):!1;p=b.hasColormap?c(this.url+"/colormap",{query:{slice:k,f:"json"},signal:m}).then(function(a){return a.data&&a.data.colormap}):!1;q=b.hasHistograms?c(this.url+"/histograms",{query:{slice:k,f:"json"},signal:m}).then(function(a){return a.data&&a.data.histograms}):
!1;v=c(this.url+"/keyProperties",{query:{f:"json"},signal:m}).then(function(a){return a.data}).catch(function(){});u=b.hasMultidimensions?c(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:m}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;x=b.hasMultidimensions?c(this.url+"/slices",{query:{f:"json"},signal:m}).then(function(a){return a.data&&a.data.slices}).catch(function(){}):!1;return[2,d.all([n,p,q,v,u,x]).then(function(c){var d=null;if(b.minValues&&b.minValues.length===
b.bandCount)for(var d=[],e=0;e<b.minValues.length;e++)d.push({min:b.minValues[e],max:b.maxValues[e],avg:b.meanValues[e],stddev:b.stdvValues[e]});w._slices=c[5]||null;return new l({width:f,height:h,bandCount:b.bandCount,extent:a.Extent.fromJSON(b.extent),spatialReference:g,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,spatialReference:g}),pixelType:b.pixelType.toLowerCase(),statistics:d,attributeTable:c[0]||null,colormap:c[1]||null,histograms:c[2]||null,keyProperties:c[3]||null,multidimensionalInfo:c[4]||
null})})]})})};k([w.property({type:String,json:{write:!0}})],g.prototype,"datasetFormat",void 0);k([w.property()],g.prototype,"sourceJSON",void 0);k([w.property()],g.prototype,"tileType",void 0);return g=k([w.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],g)}(w.declared(v))})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m,y,p,v,q){Object.defineProperty(g,"__esModule",{value:!0});g.TILEMAP_SIZE_EXP=5;var r=d.getLogger("esri.layers.support.TilemapCache");C=function(c){function d(b){b=c.call(this,b)||this;b._handles=new e;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=a;b._prefetchingEnabled=!0;return b}k(d,c);u=d;d.prototype.initialize=function(){var a=this;this._tilemapCache=new B(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),p.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};d.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};d.prototype.castLevels=function(a){return 2>=a?(r.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(d.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
d.prototype.fetchTilemap=function(a,b,c,d){var e=this;if(!this._availableLevels[a])return l.reject(new f("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var h=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,c,h))return l.resolve(a);var g=d&&d.signal;d=z({},d,{signal:null});return l.create(function(a,b){l.onAbort(g,function(){return b(l.createAbortError())});var c=q.tilemapDefinitionId(h),f=e._pendingTilemapRequests[c];if(!f){var f=q.Tilemap.fromDefinition(h,
d).then(function(a){e._tilemapCache.put(c,a,a.byteSize);return a}),k=function(){return delete e._pendingTilemapRequests[c]};e._pendingTilemapRequests[c]=f;f.then(k,k)}f.then(a,b)})};d.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,c,this._tmpTilemapDefinition))?a.getAvailability(b,c):"unknown":"unavailable"};d.prototype.getAvailabilityUpsample=function(a,b,c,d){d.level=a;d.row=b;d.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,
d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};d.prototype.fetchAvailability=function(a,b,c,d){return this._availableLevels[a]?this.fetchTilemap(a,b,c,d).catch(function(a){return a}).then(function(d){if(d instanceof q.Tilemap)return d=d.getAvailability(b,c),"unavailable"===d?l.reject(new f("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:c})):d;if(l.isAbortError(d))throw d;return"unknown"}):l.reject(new f("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};d.prototype.fetchAvailabilityUpsample=function(a,b,c,d,e){var f=this;d.level=a;d.row=b;d.col=c;var h=this.layer.tileInfo;h.updateTileInfo(d);var g=this.fetchAvailability(a,b,c,e).catch(function(a){if(l.isAbortError(a))throw a;if(h.upsampleTile(d))return f.fetchAvailabilityUpsample(d.level,d.row,d.col,d);throw a;});this._fetchAvailabilityUpsamplePrefetch(d.id,a,b,c,e,g);return g};d.prototype._fetchAvailabilityUpsamplePrefetch=function(a,b,c,d,e,f){return h(this,
void 0,void 0,function(){var h,g,k,r,p,q,t,v,x,A;return n(this,function(n){switch(n.label){case 0:if(!this._prefetchingEnabled)return[2];h="prefetch-"+a;if(this._handles.has(h))return[2];g=l.createAbortController();f.then(function(){return g.abort()},function(){return g.abort()});k=!1;r={remove:function(){k||(k=!0,g.abort())}};this._handles.add(r,h);n.label=1;case 1:return n.trys.push([1,3,,4]),[4,m.waitTicks(10,g.signal)];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:k||(k=!0,
this._handles.remove(h));if(l.isAborted(g))return[2];p={id:a,level:b,row:c,col:d};q=z({},e,{signal:g.signal});t=this.layer.tileInfo;v=function(a){var b=x.fetchAvailability(p.level,p.row,p.col,q);u._prefetches.push(b);a=function(){u._prefetches.removeUnordered(b)};b.then(a,a)};x=this;for(A=0;u._prefetches.length<u._maxPrefetch&&t.upsampleTile(p);++A)v(A);return[2]}})})};d.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:a.path,query:b?y.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};d.prototype._tilemapFromCache=function(a,b,c,d){a=this._getTilemapDefinition(a,b,c,d);a=q.tilemapDefinitionId(a);return this._tilemapCache.get(a)};d.prototype._getTilemapDefinition=function(a,b,c,d){d.level=a;a=a>g.TILEMAP_SIZE_EXP;d.row=a?b-b%this.size:b;d.col=a?c-c%this.size:c;return d};
d.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};Object.defineProperty(d.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,c,d){return!!a._tilemapFromCache(b,c,d,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var u;d._maxPrefetch=4;d._prefetches=new w({initialSize:u._maxPrefetch});
b([v.property({constructOnly:!0,type:Number})],d.prototype,"levels",void 0);b([v.cast("levels")],d.prototype,"castLevels",null);b([v.property({readOnly:!0,dependsOn:["levels"],type:Number})],d.prototype,"size",null);b([v.property({constructOnly:!0,type:Number})],d.prototype,"cacheByteSize",void 0);b([v.property({constructOnly:!0})],d.prototype,"layer",void 0);b([v.property({constructOnly:!0})],d.prototype,"request",void 0);return d=u=b([v.subclass("esri.layers.support.TilemapCache")],d)}(v.declared(c));
g.TilemapCache=C})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(C,g,z,k,b,n,h){function a(a){var b;"vector-tile"===a.service.type?b=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(b=a.service.tileServers,b=(b&&b.length?b[a.row%b.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&
(b=b+"?"+a);return b}Object.defineProperty(g,"__esModule",{value:!0});C=function(){function c(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}c.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var d=this._tileAvailabilityBitSet;return 0>b||b>d.length?"unknown":d[b]&1<<a%8?"available":"unavailable"};c.prototype._updateFromData=
function(a){for(var b=!0,d=!0,c=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),f=0,h=0;h<a.length;h++){var g=h%8;a[h]?(d=!1,c[f]|=1<<g):b=!1;7===g&&++f}d?this._allAvailability="unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=c,this.byteSize+=c.length)};c.fromDefinition=function(f,e){var d=f.service.request||k,h=f.row,g=f.col,l=f.width,m=f.height,y={query:{f:"json"}};e=e?z({},y,e):y;return d(a(f),e).then(function(a){return a.data}).catch(function(a){if(a&&
a.details&&422===a.details.httpStatus)return{location:{top:h,left:g,width:l,height:m},valid:!0,data:b.constant(l*m,0)};throw a;}).then(function(a){if(a.location&&(a.location.top!==h||a.location.left!==g||a.location.width!==l||a.location.height!==m))throw new n("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:h,left:g,width:l,height:m}});return c.fromJSON(a)})};c.fromJSON=function(a){c.validateJSON(a);var b=new c;b.location=Object.freeze(h.clone(a.location));
b._updateFromData(a.data);return Object.freeze(b)};c.validateJSON=function(a){if(!a||!a.location)throw new n("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new n("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new n("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new n("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new n("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return c}();g.Tilemap=C;g.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};g.tilemapDefinitionUrl=a;g.default=C})},"esri/layers/support/rasterDatasets/MRFRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../PixelBlock ../RasterInfo ../RasterStorageInfo ./BaseRaster ./xmlUtilities".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m){var y=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),p=new Map;p.set("Int8","s8");p.set("UInt8","u8");p.set("Int16","s16");p.set("UInt16","u16");p.set("Int32","s32");p.set("UInt32","u32");p.set("Float32","f32");p.set("Float64","f32");p.set("Double64","f32");var v=new Map;v.set("lerc",".lrc");v.set("none",".til");v.set("deflate",".pzp");v.set("jpeg",".jzp");return function(g){function l(){var a=null!==g&&
g.apply(this,arguments)||this;a._files=null;a._storageIndex=null;return a}n(l,g);l.prototype.open=function(a){return b(this,void 0,void 0,function(){var b,d,e,f,h,g,k,l,m,n,r,p,q,v,w,D,y,B,C,K,V;return z(this,function(t){switch(t.label){case 0:return[4,this.init()];case 1:return t.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),b=a?c.unwrap(a.signal):null,[4,this.request({url:this.url,responseType:"xml"},b)];case 2:return d=t.sent(),e=this._parseHeader(d),f=e.rasterInfo,h=e.files,
this._set("rasterInfo",f),this._files=h,[4,this.request({url:h.index,responseType:"array-buffer"},b)];case 3:g=t.sent();this._storageIndex=this._parseIndex(g);k=0;l=-1;r=this.rasterInfo.storageInfo;p=r.blockWidth;q=r.blockHeight;v=r.compression;w=this.rasterInfo.storageInfo.pyramidScalingFactor;D=this.rasterInfo;y=D.width;B=D.height;C=D.bandCount;K=[];for(V="none"===v?1:C;k<this._storageIndex.length;)l++,m=Math.ceil(y/p/Math.pow(w,l)),n=Math.ceil(B/q/Math.pow(w,l)),k+=m*n*V*4,K.push({maxRow:n,maxCol:m,
minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=K;0<l&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=l);return[2]}})})};l.prototype.fetchRawTile=function(a,c,e,h){void 0===h&&(h={});return b(this,void 0,void 0,function(){var b,g,k,l,m,n,r,p,q,v,t,u,x,w,D,y,B,C,M,Q,U,Z,X,aa,Y,ba;return z(this,function(A){switch(A.label){case 0:b=this.rasterInfo.storageInfo;g=b.blockWidth;k=b.blockHeight;l=b.blockBoundary;m=b.compression;n=l[a];if(!n||
n.maxRow<c||n.maxCol<e||n.minRow>c||n.minCol>e)return[2,null];r=this.rasterInfo;p=r.bandCount;q=r.pixelType;v=this._getTileLocation(a,c,e);t=v.ranges;u=v.actualTileWidth;x=v.actualTileHeight;if(!t||0===t.length)return[2,null];if(0===t[0].from&&0===t[0].to)return w=new Uint8Array(g*k),[2,new d({width:g,height:k,pixels:null,mask:w,validPixelCount:0})];D=this.ioConfig.bandIds;y="none"===m?1:p;B=[];for(C=C=0;C<y;C++)(!D||-1<D.indexOf[C])&&B.push(this.request({url:this._files.data,range:{from:t[C].from,
to:t[C].to},responseType:"array-buffer"},h.signal));return[4,f.all(B)];case 1:M=A.sent();Q=M.map(function(a){return a.byteLength}).reduce(function(a,b){return a+b});U=new Uint8Array(Q);for(C=Z=0;C<y;C++)U.set(new Uint8Array(M[C]),Z),Z+=M[C].byteLength;X="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip";return[4,this.decodePixelBlock(U.buffer,{width:g,height:k,format:X,pixelType:q})];case 2:aa=A.sent();ba=Y=0;if(u!==g||x!==k)if(w=aa.mask)for(C=0;C<k;C++)for(ba=C*g,Y=C<x?u:0;Y<g;Y++)w[ba+
Y]=0;else for(w=new Uint8Array(g*k),aa.mask=w,C=0;C<x;C++)for(ba=C*g,Y=0;Y<u;Y++)w[ba+Y]=1;return[2,aa]}})})};l.prototype._parseIndex=function(a){if(0<a.byteLength%16)throw"invalid array buffer must be multiples of 16";var b,d,c,e,f;if(y){b=new Uint8Array(a);c=new ArrayBuffer(a.byteLength);d=new Uint8Array(c);for(e=0;e<a.byteLength/4;e++)for(f=0;4>f;f++)d[4*e+f]=b[4*e+3-f];a=new Uint32Array(c)}else a=new Uint32Array(a);return a};l.prototype._getTileLocation=function(a,b,d){var c=this.rasterInfo.storageInfo,
e=c.blockWidth,f=c.blockHeight,h=c.pyramidScalingFactor,g=this.rasterInfo,k=g.width,l=g.height,g=g.bandCount,c="none"===c.compression?1:g,m,n,r=0,p=0;for(n=0;n<a;n++)p=Math.pow(h,n),g=Math.ceil(k/e/p),m=Math.ceil(l/f/p),r+=g*m;p=Math.pow(h,a);g=Math.ceil(k/e/p);m=Math.ceil(l/f/p);r=4*(r+(b*g+d))*c;a=this._storageIndex.subarray(r,r+4*c);n=h=0;for(var r=[],q=0;q<c;q++)h=a[4*q+0]*Math.pow(2,32)+a[4*q+1],n=h+a[4*q+2]*Math.pow(2,32)+a[4*q+3],r.push({from:h,to:n});return{ranges:r,actualTileWidth:d<g-1?
e:Math.ceil(k/p)-e*(g-1),actualTileHeight:b<m-1?f:Math.ceil(l/p)-f*(m-1)}};l.prototype._parseHeader=function(b){var c=m.getElement(b,"MRF_META/Raster");if(!c)throw new a("mrf:open","not a valid MRF format");var d=m.getElement(c,"Size"),e=parseInt(d.getAttribute("x"),10),f=parseInt(d.getAttribute("y"),10),g=parseInt(d.getAttribute("c"),10),d=(m.getElementValue(c,"Compression")||"none").toLowerCase(),k=["none","lerc"];if(!d||-1===k.indexOf(d))throw new a("mrf:open","currently does not support compression "+
d);var l=m.getElementValue(c,"DataType")||"UInt8",k=p.get(l);if(null==k)throw new a("mrf:open","currently does not support pixel type "+l);var n=m.getElement(c,"PageSize"),l=parseInt(n.getAttribute("x"),10),n=parseInt(n.getAttribute("y"),10),c=m.getElement(c,"DataValues"),r;c&&(c=c.getAttribute("NoData"),null!=c&&(r=c.trim().split(" ").map(function(a){return parseFloat(a)})));if(m.getElement(b,"MRF_META/CachedSource"))throw new a("mrf:open","currently does not support MRF referencing other data files");
var q=m.getElement(b,"MRF_META/GeoTags"),y=m.getElement(q,"BoundingBox");if(null==y)throw new a("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var c=parseFloat(y.getAttribute("minx")),z=parseFloat(y.getAttribute("miny")),D=parseFloat(y.getAttribute("maxx")),C=parseFloat(y.getAttribute("maxy")),N=m.getElementValue(q,"Projection"),q=m.getElementValue(b,"datafile"),y=m.getElementValue(b,"IndexFile"),O;"LOCAL_CS[]"!==N&&(O=new h.SpatialReference({wkt:N}));N=new h.Extent(c,z,D,C);N.spatialReference=
O;b=m.getElement(b,"MRF_META/Rsets");b=parseInt(b&&b.getAttribute("scale")||"2",10);b=new w({origin:new h.Point({x:N.xmin,y:N.ymax,spatialReference:O}),blockWidth:l,blockHeight:n,pyramidBlockWidth:l,pyramidBlockHeight:n,compression:d,pyramidScalingFactor:b});l=new h.Point({x:(D-c)/e,y:(C-z)/f,spatialReference:O});e=new B({width:e,height:f,extent:N,spatialReference:O,bandCount:g,pixelType:k,pixelSize:l,noDataValue:r,storageInfo:b});f={mrf:this.url,index:y||this.url.replace(".mrf",".idx"),data:q||this.url.replace(".mrf",
v.get(d))};return{rasterInfo:e,files:f}};k([e.property()],l.prototype,"_files",void 0);k([e.property()],l.prototype,"_storageIndex",void 0);k([e.property({type:String,json:{write:!0}})],l.prototype,"datasetFormat",void 0);return l=k([e.subclass("esri.layers.support.rasterIO.MRFRaster")],l)}(e.declared(l))})},"esri/layers/support/rasterDatasets/xmlUtilities":function(){define(["require","exports"],function(C,g){function z(b,g){if(!b||!g)return[];var h=g;-1<g.indexOf("/")?(h=g.slice(0,g.indexOf("/")),
g=g.slice(g.indexOf("/")+1)):g="";b=g?k(b,h).getElementsByTagNameNS("*",g):b.getElementsByTagNameNS("*",h);if(!b||0===b.length)return[];g=[];for(h=0;h<b.length;h++)g.push(b[h]||b.item[h]);return g}function k(b,g){if(!b||!g)return null;var h=g;-1<g.indexOf("/")?(h=g.slice(0,g.indexOf("/")),g=g.slice(g.indexOf("/")+1)):g="";b=z(b,h);return 0<b.length?g?k(b[0],g):b[0]:null}Object.defineProperty(g,"__esModule",{value:!0});g.getElements=z;g.getElement=k;g.getElementValue=function(b,g){if(b=k(b,g))if(b=
b.textContent||b.nodeValue||b.innerText)return b.trim();return null};g.getElementValues=function(b,g){b=z(b,g);g=[];for(var h,a=0;a<b.length;a++)if(h=b[a].textContent||b[a].nodeValue||b[a].innerText)h=h.trim(),""!==h&&g.push(h);return g}})},"esri/layers/support/rasterDatasets/TIFFRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ./BaseRaster ../rasterFormats/TiffDecoder ../rasterFormats/TiffTags".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l,m){var y=function(a,b){return(a=a.get(b))&&a.values},p=function(a,b){return(a=a.get(b))&&a.values[0]};return function(g){function q(){var a=null!==g&&g.apply(this,arguments)||this;a._files=null;a._headerInfo=null;a._bufferSize=1048576;return a}n(q,g);q.prototype.open=function(e){return b(this,void 0,void 0,function(){var b,g,k,m,n,r,p,q,v,w,y,C,L,ca,W,N,O,S,T,R,K,V,M,Q,U,Z,X;return z(this,function(t){switch(t.label){case 0:return[4,this.init()];case 1:return t.sent(),
b=e?f.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},b)];case 2:g=t.sent();if(!g)throw new c("tiffraster:open","failed to open url "+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);k=l.parseSignature(g);m=k.littleEndian;n=k.firstIFD;r=[];return[4,this.readIFDs(r,g,m,n,0,4,b)];case 3:t.sent();p=l.getImageInfo(r);q=p.width;v=p.height;w=p.tileWidth;y=p.tileHeight;C=p.planes;L=p.pixelType;ca=p.compression;W=p.firstPyramidLevel;
N=p.maximumPyramidLevel;O=p.pyramidBlockWidth;S=p.pyramidBlockHeight;T=p.tileBoundary;R=p.metadata;K=a.Extent.fromJSON(p.extent);V=K.spatialReference;M=K?new a.Point({x:K.xmin,y:K.ymax,spatialReference:V}):new a.Point({x:0,y:0});Q=new B({blockWidth:w,blockHeight:y,pyramidBlockWidth:O,pyramidBlockHeight:S,compression:ca,origin:M,firstPyramidLevel:W,maximumPyramidLevel:N,blockBoundary:T});U=new a.Point({x:(K.xmax-K.xmin)/q,y:(K.ymax-K.ymin)/v,spatialReference:V});Z=R?{BandProperties:R.bandProperties,
DataType:R.dataType}:null;X=new d({width:q,height:v,bandCount:C,pixelType:L,compression:ca,pixelSize:U,storageInfo:Q,spatialReference:V,keyProperties:Z,extent:K,statistics:R?R.statistics:null});this._set("rasterInfo",X);this._headerInfo=h({littleEndian:m,ifds:r},p);if(!this._headerInfo.isSupported)throw new c("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}})})};q.prototype.fetchRawTile=function(a,c,d,e){void 0===e&&(e={});return b(this,void 0,void 0,function(){var b,
f,g,h,k,l,m,n,p,r,q,v,u,x,w;return z(this,function(t){switch(t.label){case 0:if(!this._headerInfo&&this._headerInfo.isSupported)return[2,null];b=this.rasterInfo.storageInfo.blockBoundary;f=0<a?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth;g=0<a?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight;h=b[a];if(!h||h.maxRow<c||h.maxCol<d||h.minRow>c||h.minCol>d)return[2,null];k=this.getTileLocation(a,c,d);if(!k)return[2,null];l=k.range;
m=k.actualTileWidth;n=k.actualTileHeight;p=k.ifd;return[4,this.request({url:this.url,range:l,responseType:"array-buffer"},e.signal)];case 1:return r=t.sent(),[4,this.decodePixelBlock(r,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:p,offset:0,size:0},width:f,height:g,planes:null,pixelType:null})];case 2:q=t.sent();if(m!==f||n!==g)if(w=q.mask)for(v=0;v<g;v++)for(x=v*f,u=v<n?m:0;u<f;u++)w[x+u]=0;else for(w=new Uint8Array(f*g),q.mask=w,v=0;v<n;v++)for(x=v*f,u=0;u<m;u++)w[x+u]=1;return[2,
q]}})})};q.prototype.readIFDs=function(a,c,d,e,f,g,h){void 0===g&&(g=4);return b(this,void 0,void 0,function(){var b;return z(this,function(k){switch(k.label){case 0:return e?e>=c.byteLength||0>e?[4,this.request({url:this.url,range:{from:e+f,to:e+f+this._bufferSize},responseType:"array-buffer"},h)]:[3,2]:[2,null];case 1:c=k.sent(),f=e+f,e=0,k.label=2;case 2:return[4,this.readIFD(c,d,e,f,m.TIFF_TAGS,g,h)];case 3:return b=k.sent(),a.push(b.ifd),b.nextIFD?[4,this.readIFDs(a,c,d,b.nextIFD-f,f,g,h)]:[2,
null];case 4:return k.sent(),[2]}})})};q.prototype.readIFD=function(a,c,d,e,f,g,h){void 0===f&&(f=m.TIFF_TAGS);void 0===g&&(g=4);return b(this,void 0,void 0,function(){var b,k,n,p,r,q,v,t,u;return z(this,function(x){switch(x.label){case 0:if(!a)return[2,null];b=l.parseIFD(a,c,d,e,f,g);if(!b.success)return[3,5];k=[];b.ifd.forEach(function(a){a.values||k.push(a)});if(!(0<k.length))return[3,2];n=k.map(function(a){return a.offlineOffsetSize});p=Math.min.apply(null,n.map(function(a){return a[0]}));r=Math.min.apply(null,
n.map(function(a){return a[0]+a[1]}));return r-p<=this._bufferSize?[4,this.request({url:this.url,range:{from:p,to:p+this._bufferSize},responseType:"array-buffer"},h)]:[3,2];case 1:a=x.sent(),e=p,k.forEach(function(b){return l.parseFieldValues(a,c,b,e)}),x.label=2;case 2:if(!b.ifd.has("GEOKEYDIRECTORY"))return[3,4];q=b.ifd.get("GEOKEYDIRECTORY");v=q.values;if(!(v&&4<v.length))return[3,4];t=v[0]+"."+v[1]+"."+v[2];return[4,this.readIFD(a,c,q.valueOffset+6-e,e,m.GEO_KEYS,2,h)];case 3:u=x.sent(),q.data=
u.ifd,q.data&&q.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[t]}),x.label=4;case 4:return[2,b];case 5:return b.requiredBufferSize&&b.requiredBufferSize!==a.byteLength?[4,this.request({url:this.url,range:{from:e,to:e+b.requiredBufferSize+4},responseType:"array-buffer"},h)]:[3,7];case 6:return a=x.sent(),a.byteLength<b.requiredBufferSize?[2,null]:[2,this.readIFD(a,c,0,e,m.TIFF_TAGS,4,h)];case 7:return[2]}})})};q.prototype.getTileLocation=function(a,b,c){var d=this.rasterInfo.storageInfo,
e=d.firstPyramidLevel,f=d.blockBoundary,g=0===a?0:a-(e-1);a=this._headerInfo.ifds[g];if(!a)return null;d=y(a,"TILEOFFSETS");if(void 0===d)return null;var e=y(a,"TILEBYTECOUNTS"),g=f[g],h=g.minRow,k=g.minCol,f=g.maxRow,g=g.maxCol;if(b>f||c>g||b<h||c<k)return null;var h=p(a,"IMAGEWIDTH"),k=p(a,"IMAGELENGTH"),l=p(a,"TILEWIDTH"),m=p(a,"TILELENGTH"),n=b*(g+1)+c,d=d[n],e=e[n];return null==d||null==e?null:{range:{from:d,to:d+e-1},ifd:a,actualTileWidth:c===g?h%l:l,actualTileHeight:b===f?k%m:m}};k([e.property()],
q.prototype,"_files",void 0);k([e.property()],q.prototype,"_headerInfo",void 0);k([e.property()],q.prototype,"_bufferSize",void 0);k([e.property({type:String,json:{write:!0}})],q.prototype,"datasetFormat",void 0);return q=k([e.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],q)}(e.declared(w))})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../rasterRenderers ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../../layers/support/rasterFunctions/surfaceUtils ../support/colorRampUtils".split(" "),
function(C,g,z,k,b,n,h,a,c,f,e,d,B,w,l){var m=f.getLogger("esri.renderers.support.RasterSymbolizer");return function(c){function f(a){return c.call(this,a)||this}k(f,c);f.prototype.readRenderer=function(b,c,d){return a.read(b,d)};f.prototype.bind=function(){this.lookup={};if(!this.renderer)return!1;var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=this._updateStretchRenderer(this.renderer);
break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer);break;case "raster-shaded-relief":a=this._updateShadedReliefRenderer(this.renderer)}return a};f.prototype.symbolize=function(a){var b=a&&a.pixelBlock;if(!this.isValidPixelBlock(b))return b;if(a.simpleStretchParams&&"raster-stretch"===this.renderer.type)return this.simpleStretch(b,a.simpleStretchParams);try{3<b.pixels.length&&(b=B.extractBands(b,[0,1,2]));var c=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":c=
this._symbolize_colormap(b);break;case "class-breaks":c=this._symbolize_classBreaks(b);break;case "raster-stretch":c=this._symbolize_stretch(b);break;case "raster-shaded-relief":var d=a.extent,c=this._symbolize_shadedRelief(b,{isGCS:d.spatialReference.isGeographic,resolution:{x:(d.xmax-d.xmin)/b.width,y:(d.ymax-d.ymin)/b.height}})}return c}catch(x){return m.error("symbolize",x.message),b}};f.prototype.simpleStretch=function(a,b){if(!this.isValidPixelBlock(a))return a;try{return 3<a.pixels.length&&
(a=B.extractBands(a,[0,1,2])),B.stretch(a,b)}catch(r){return m.error("symbolize",r.message),a}};f.prototype.generateWebGLParameters=function(a){if(-1<["unique-value","raster-colormap","class-breaks"].indexOf(this.renderer.type)){var b=this.lookup.lut;return{colormap:b.indexedColormap,colormapOffset:b.colormapOffset,type:"lut"}}var b=a.pixelBlock,c=a.isGCS;a=a.resolution;return"raster-stretch"===this.renderer.type?this.generateStretchWebGLParams(b,this.renderer):"raster-shaded-relief"===this.renderer.type?
this.generateShadedReliefWebGLParams(this.renderer,c,a):null};f.prototype._isLUTChanged=function(a){if(!this.lookup)return!0;if("colorRamp"in this.renderer){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=z({},this.renderer.toJSON());b=z({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==JSON.stringify(this.lookup.rendererJson)};f.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&
!this.bind()?a:B.colorize(a,this.lookup.lut)};f.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?B.colorize(a,this.lookup.lut):B.remapColor(a,this.lookup.lut)};f.prototype._symbolize_stretch=function(a){var b=this.rasterInfo.pixelType,c=this.renderer,d=-1<["u8","u16","s8","s16"].indexOf(b),e=c.gamma,f=c.useGamma;if(d){if(c.dynamicRangeAdjustment)d=this.getStretchCutoff(c,a),b=B.createStretchLUT(z({pixelType:b},
d,{gamma:f?e:null}));else{if(this._isLUTChanged()&&(e=this.bind(),!e))return a;b=this.lookup?this.lookup.lut:null}if(!b)return a;b=B.lookupPixels(a,b)}else d=this.getStretchCutoff(c,a),b=B.stretch(a,z({},d,{gamma:f?e:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(e=this.bind(),!e))return a;b=B.colorize(b,this.lookup.colorRampLut)}return b};f.prototype._symbolize_shadedRelief=function(a,b){var c=this.renderer;b=z({},c.toJSON(),b);a=w.hillshade(a,b);return!c.colorRamp||this._isLUTChanged(!0)&&
!this.bind()?a:(c=this.lookup?this.lookup.colorRamplut:null)?B.lookupPixels(a,c):a};f.prototype._updateUVRenderer=function(a){var b=this.rasterInfo,c=b.bandCount,d=b.attributeTable,e=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&e&&null!=e[0].min&&null!=e[0].max;if(1!==c||!d&&!b)return!1;var f=a.field;if(!f)return!1;var g=[];if(d){var h=d.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!h)return!1;d.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===
String(b.attributes[f])})[0];(c=c&&c.symbol&&c.symbol.color)&&g.push([b.attributes[h.name],c.r,c.g,c.b,1<c.a?c.a:Math.round(255*c.a)])})}else{if("Value"!==f.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=a&&a.symbol&&a.symbol.color;b&&g.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===g.length)return!1;c=B.createColormapLUT({colormap:g});this.lookup={rendererJson:a.toJSON(),lut:c};return this.canRenderInWebGL=!0};f.prototype._updateColormapRenderer=
function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=B.createColormapLUT({colormap:b});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};f.prototype._updateShadedReliefRenderer=function(a){if(a.colorRamp){var b=l.convertColorRampToColormap(a.colorRamp,256),b=B.createColormapLUT({colormap:b});this.lookup={rendererJson:a.toJSON(),colorRampLut:b}}else this.lookup=null;return this.canRenderInWebGL=!0};f.prototype._updateClassBreaksRenderer=function(a){var b=
-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),c=a.classBreakInfos;if(!c||0===c.length)return!1;var d=c.sort(function(a,b){return a.minValue-b.minValue}),c=d[d.length-1];if(!b)return b=d.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*
c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),lut:b},this.canRenderInWebGL=!1,!0;var e=[],f,g=0;d.forEach(function(a){f=Math.ceil(a.minValue);g=Math.floor(a.maxValue);for(var b=f;b<g;b++)e.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});e.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]);b=B.createColormapLUT({colormap:e,
fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};f.prototype._updateStretchRenderer=function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var c=a.gamma,d=a.useGamma,b=a.colorRamp,e=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&-1<["u8","u16","s8","s16"].indexOf(e)){var f=this.getStretchCutoff(a),
c=B.createStretchLUT(z({pixelType:e},f,{gamma:d?c:null}));this.lookup={rendererJson:a.toJSON(),lut:c}}b&&(b=l.convertColorRampToColormap(b,256),this.lookup.colorRampLut=B.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return this.canRenderInWebGL=!0};f.prototype.getStretchCutoff=function(a,b){var c,d,e=a.stretchType;a.dynamicRangeAdjustment?"min-max"===e&&b.statistics?c=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(d=B.estimateStatisticsHistograms(b),c=d.statistics,
d=d.histograms):(c=a.statistics&&0<a.statistics.length?a.statistics:this.rasterInfo.statistics,d=a.histograms||this.rasterInfo.histograms);b=c||d?(c||d).length:this.rasterInfo.bandCount;var f=[],g=[],h,k,l,m,n,p;c[0]instanceof Array||(c=c.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(e){case "min-max":for(e=0;e<b;e++)f[e]=c[e][0],g[e]=c[e][1];break;case "standard-deviation":for(e=0;e<b;e++)f[e]=c[e][2]-a.numberOfStandardDeviations*c[e][3],g[e]=c[e][2]+a.numberOfStandardDeviations*c[e][3],
f[e]<c[e][0]&&(f[e]=c[e][0]),g[e]>c[e][1]&&(g[e]=c[e][1]);break;case "percent-clip":for(e=0;e<b;e++){c=d[e];m=new Uint32Array(c.size);l=c.counts;k=0;h=(c.max-c.min)/c.size;n=-.5===c.min&&1===h?.5:0;for(p=0;p<c.size;p++)k+=l[p],m[p]=k;l=a.minPercent*k/100;for(p=0;p<c.size;p++)if(m[p]>l){f[e]=c.min+h*(p+n);break}l=(1-a.maxPercent/100)*k;for(p=c.size-2;0<=p;p--)if(m[p]<l){g[e]=c.min+h*(p+2-n);break}}break;default:for(e=0;e<b;e++)f[e]=c[e][0],g[e]=c[e][1]}return{minCutOff:f,maxCutOff:g,outMax:a.outputMax||
255,outMin:a.outputMin||0}};f.prototype.generateStretchWebGLParams=function(a,b){var c=null,d=null,e=this.lookup&&this.lookup.colorRampLut;b.colorRamp&&e&&(c=e.indexedColormap,d=e.offset);var e=b.gamma,f=b.useGamma,g=this.getStretchCutoff(b,a);b=g.minCutOff;var h=g.maxCutOff,k=g.outMin,g=g.outMax;a&&a.pixels&&2===a.pixels.length&&(a=a.clone(),a.statistics=[a.statistics[0]],a.pixels=[a.pixels[0]]);a=Math.min(3,a&&a.getPlaneCount()||this.rasterInfo.bandCount);var l=new Float32Array(a),m=null==c?255:
1,n;for(n=0;n<a;n++)l[n]=(g-k)/(h[n]-b[n])/m;var p=new Float32Array(a);if(f)for(n=0;n<a;n++)p[n]=1<e[n]?2<e[n]?6.5+Math.pow(e[n]-2,2.5):6.5+100*Math.pow(2-e[n],4):1;return{bandCount:a,outMin:k/m,outMax:g/m,minCutOff:b,maxCutOff:h,factor:l,useGamma:f,gamma:f?e:[1,1,1],gammaCorrection:f?p:[1,1,1],colormap:c,colormapOffset:d,type:"stretch"}};f.prototype.generateShadedReliefWebGLParams=function(a,b,c){var d=null,e=null,f=this.lookup&&this.lookup.colorRampLut;a.colorRamp&&f&&(d=f.indexedColormap,e=f.offset);
b=z({},a.toJSON(),{isGCS:b,resolution:c});b=w.calculateHillshadeParams(b);return z({},b,{hillshadeType:"traditional"===a.hillshadeType?0:1,type:"hillshade",colormap:d,colormapOffset:e})};f.prototype.isValidPixelBlock=function(a){return!!(a&&a.pixels&&0<a.pixels.length&&0!==a.validPixelCount)};b([e.property({types:a.rasterRendererTypes,json:{write:!0}})],f.prototype,"renderer",void 0);b([e.reader("renderer")],f.prototype,"readRenderer",null);b([e.property({type:d,json:{write:!0}})],f.prototype,"rasterInfo",
void 0);b([e.property({json:{write:!0}})],f.prototype,"lookup",void 0);b([e.property({})],f.prototype,"canRenderInWebGL",void 0);return f=b([e.subclass("esri.renderers.support.RasterSymbolizer")],f)}(e.declared(c.JSONSupport))})},"esri/layers/support/rasterFunctions/surfaceUtils":function(){define(["require","exports","../PixelBlock"],function(C,g,z){function k(b){var g=b.altitude,h=b.azimuth,a=b.hillshadeType,c=b.pixelSizePower,f=b.pixelSizeFactor,e=b.scalingType,d=b.isGCS,k=b.resolution,w="multi-directional"===
a?2*b.zFactor:b.zFactor,l=k.x,m=k.y;b=w/(8*l);var y=w/(8*m);d&&.001<w&&(b/=111E3,y/=111E3);"adjusted"===e&&(d?(b=111E3*l,y=111E3*m,b=(w+Math.pow(b,c)*f)/(8*b),y=(w+Math.pow(y,c)*f)/(8*y)):(b=(w+Math.pow(l,c)*f)/(8*l),y=(w+Math.pow(m,c)*f)/(8*m)));var p=(90-g)*Math.PI/180,g=Math.cos(p),v=(360-h+90)*Math.PI/180,h=Math.sin(p)*Math.cos(v),p=Math.sin(p)*Math.sin(v),c=[315,270,225,360,180,0],f=[60,60,60,60,60,90],w=[3,5,3,2,1,4],q=w.reduce(function(a,b){return a+b}),w=w.map(function(a){return a/q}),e=[],
d=[],m=[],l="multi-directional"===a?c.length:1;if("multi-directional"===a)for(var r=0;r<l;r++)g=f[r],h=c[r],p=(90-g)*Math.PI/180,g=Math.cos(p),v=(360-h+90)*Math.PI/180,h=Math.sin(p)*Math.cos(v),p=Math.sin(p)*Math.sin(v),e.push(g),d.push(h),m.push(p);return{resolution:k,factor:[b,y],sinZcosA:h,sinZsinA:p,cosZ:g,sinZcosAs:d,sinZsinAs:m,cosZs:e,weights:w,hillshadeType:["traditional","multi-directional"].indexOf(a)}}Object.defineProperty(g,"__esModule",{value:!0});g.calculateHillshadeParams=k;g.hillshade=
function(b,g){if(!(b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length))return b;var h=b.width,a=b.height,c=b.mask,f=new Uint8Array(h*a);c&&f.set(c);var e=k(g),d=e.factor,n=e.sinZcosA,w=e.sinZsinA,l=e.cosZ,m=e.sinZcosAs,y=e.sinZsinAs,p=e.cosZs,e=e.weights,v=d[0],d=d[1];g=g.hillshadeType;for(var q=b.pixels[0],r=new Uint8Array(h*a),C,x,u,t,A,E,G,H,F=1;F<a-1;F++)for(var I=F*h,J=1;J<h-1;J++)if(c&&!c[I+J])r[I+J]=0;else{t=0;if(c&&(t=c[I-h+J-1]+c[I-h+J]+c[I-h+J+1]+c[I+J-1]+
c[I+J+1]+c[I+h+J-1]+c[I+h+J]+c[I+h+J+1],7>t)){r[I+J]=0;f[I+J]=0;continue}7===t?(C=c[I-h+J-1]?q[I-h+J-1]:q[I+J],x=c[I-h+J]?q[I-h+J]:q[I+J],u=c[I-h+J+1]?q[I-h+J+1]:q[I+J],t=c[I+J-1]?q[I+J-1]:q[I+J],A=c[I+J+1]?q[I+J+1]:q[I+J],E=c[I+h+J-1]?q[I+h+J-1]:q[I+J],G=c[I+h+J]?q[I+h+J]:q[I+J],H=c[I+h+J+1]?q[I+h+J+1]:q[I+J]):(C=q[I-h+J-1],x=q[I-h+J],u=q[I-h+J+1],t=q[I+J-1],A=q[I+J+1],E=q[I+h+J-1],G=q[I+h+J],H=q[I+h+J+1]);t=(u+A+A+H-(C+t+t+E))*v;C=(E+G+G+H-(C+x+x+u))*d;x=Math.sqrt(1+t*t+C*C);u=0;if("traditional"===
g)E=255*(l+w*C-n*t)/x,0>E&&(E=0),u=E;else for(G=y.length,H=0;H<G;H++)E=255*(p[H]+y[H]*C-m[H]*t)/x,0>E&&(E=0),u+=E*e[H];r[I+J]=u}for(F=0;F<a;F++)r[F*h]=r[F*h+1],r[(F+1)*h-1]=r[(F+1)*h-2];for(F=1;F<h-1;F++)r[F]=r[F+h],r[F+(a-1)*h]=r[F+(a-2)*h];return new z({width:h,height:a,pixels:[r],mask:c?f:null,pixelType:"u8",validPixelCount:b.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}})},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../geometry ../PopupTemplate ../rasterRenderers ../core/Error ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/commonProperties ./support/DimensionalDefinition ./support/Field ./support/imageryRendererUtils ./support/RasterJobHandler ./support/TileInfo ./support/rasterDatasets/RasterFactory ../renderers/support/RasterSymbolizer ../support/popupUtils".split(" "),function(C,
g,z,k,b,n,h,a,c,f,e,d,B,w,l,m,y,p,v,q,r,D,x,u,t,A,E,G,H,F){return function(g){function p(a,b){a=g.call(this,a)||this;a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a.bandIds=null;a.fullExtent=null;a.interpolation="nearest";a.isReference=null;a.listMode="show";a.raster=null;a.rasterInfo=null;a.spatialReference=null;a.tileInfo=null;a.title=null;a.type="imagery-tile";a.url=null;a.operationalLayerType="ArcGISTiledImageServiceLayer";a.popupEnabled=!0;a.popupTemplate=
null;a.renderer=null;return a}k(p,g);p.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?z({url:a},b):a};p.prototype.load=function(a){var b=this,c=d.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._openRaster(c)},function(){return b._openRaster(c)}));return w.resolve(this)};Object.defineProperty(p.prototype,"multidimensionalDefinition",{set:function(a){this.raster&&(this._sliceId=this.raster.getSliceIndex(a));
this._set("multidimensionalDefinition",a)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fields",{get:function(){return[new u({name:"Raster.PixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]},enumerable:!0,configurable:!0});p.prototype.readRenderer=function(a,b,c){a=f.read(b&&b.layerDefinition&&b.layerDefinition.drawingInfo&&
b.layerDefinition.drawingInfo.renderer,c)||void 0;if(null!=a)return a};p.prototype.createPopupTemplate=function(a){return F.createPopupTemplate(this,a)};p.prototype.updateRenderer=function(){return h(this,void 0,void 0,function(){var a;return n(this,function(b){if(JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer))return[2];this._cachedRendererJson=this.renderer.toJSON();a=this._rasterJobHandler.instance;if(!a)return[2];this._symbolizer.renderer=this.renderer;this._symbolizer.bind();
return[2,a.updateSymbolizer(this._symbolizer)]})})};p.prototype.applyRenderer=function(a,b){return h(this,void 0,void 0,function(){var c,d,e;return n(this,function(f){switch(f.label){case 0:c=a&&a.pixelBlock;if(!(c&&c.pixels&&0<c.pixels.length))return[2,null];this.updateRenderer();return(e=this._rasterJobHandler.instance)?[4,e.symbolize(z({},a,{simpleStretchParams:b}))]:[3,2];case 1:return d=f.sent(),[3,3];case 2:d=this._symbolizer.symbolize(z({},a,{simpleStretchParams:b})),f.label=3;case 3:return[2,
d]}})})};p.prototype.fetchTile=function(a,b,c,d){void 0===d&&(d={});return h(this,void 0,void 0,function(){var e;return n(this,function(f){switch(f.label){case 0:return[4,this._initJobHandler()];case 1:return f.sent(),this.multidimensionalDefinition&&(e=this._sliceId,d=z({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e},d)),[2,this.raster.fetchTile(a,b,c,d)]}})})};p.prototype.fetchPixels=function(a,b,c,d){return h(this,void 0,void 0,function(){var e;return n(this,function(f){switch(f.label){case 0:return[4,
this._initJobHandler()];case 1:return f.sent(),this.multidimensionalDefinition&&(e=this._sliceId,d=z({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e},d)),[2,this.raster.fetchPixels(a,b,c,d)]}})})};p.prototype.identify=function(a,b){void 0===b&&(b={});return this.raster.identify(a,b)};p.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};p.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&
this._shutdownJobHandler()};p.prototype._initJobHandler=function(){var a=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var b=new A;this._rasterJobHandler.connectionPromise=b.initialize().then(function(){a._rasterJobHandler.instance=b;a.raster.rasterJobHandler=b}).catch(function(){return null});return this._rasterJobHandler.connectionPromise};p.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();
this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0;this.raster.rasterJobHandler=null};p.prototype._openRaster=function(a){return h(this,void 0,void 0,function(){var b,c,d,f,g,h,k,l,m,p,q;return n(this,function(n){switch(n.label){case 0:return[4,G.open(this.raster||{url:this.url,signal:a})];case 1:b=n.sent();this.url||(this.url=b.url);this.raster=b;c=b.rasterInfo;if(!c)throw new e("tile-imagery-layer:load","cannot load resources on "+
this.url);d=c.spatialReference;f=c.pixelSize;g=c.storageInfo;h=g.tileInfo;if(!h){k=[];l=g.maximumPyramidLevel||0;m=Math.max(f.x,f.y);p=1/.0254*96*m;for(q=0;q<=l;q++)k.push({level:l-q,resolution:m,scale:p}),m*=2,p*=2;h=new E({origin:g.origin,size:[g.blockWidth,g.blockHeight],spatialReference:d,lods:k});g.tileInfo=h}null==this.title&&(this.title=this.raster.datasetName);c.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition));this._configDefaultRenderer();
return[2,b]}})})};p.prototype._configDefaultSlice=function(){var a=this.raster.rasterInfo.multidimensionalInfo.variables[0],b=[];a.dimensions.forEach(function(c){b.push(new x({variableName:a.name,dimensionName:c.name,values:c.values[0],isSlice:!0}))});this.multidimensionalDefinition=b};p.prototype._configDefaultRenderer=function(){var a=this.raster.rasterInfo,b=a.pixelType;this.bandIds||(this.bandIds=t.getDefaultBandCombination(a));this.renderer||(this.renderer=t.createDefaultRenderer(a,this.bandIds));
"u8"===b&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]);this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=a):this._symbolizer=new H({renderer:this.renderer,rasterInfo:a});this._symbolizer.bind()||(this._symbolizer=null)};b([l.property()],p.prototype,"_cachedRendererJson",
void 0);b([l.property()],p.prototype,"_sliceId",void 0);b([l.property()],p.prototype,"_rasterJobHandler",void 0);b([l.property()],p.prototype,"_symbolizer",void 0);b([l.property({type:[m.Integer],json:{write:!0}})],p.prototype,"bandIds",void 0);b([l.property({type:a.Extent}),l.aliasOf("rasterInfo.extent")],p.prototype,"fullExtent",void 0);b([l.property({type:String,json:{write:!0}})],p.prototype,"interpolation",void 0);b([l.property({type:Boolean,json:{read:!1}})],p.prototype,"isReference",void 0);
b([l.property({type:["show","hide"]})],p.prototype,"listMode",void 0);b([l.property({type:[x]})],p.prototype,"multidimensionalDefinition",null);b([l.property()],p.prototype,"raster",void 0);b([l.property({readOnly:!0}),l.aliasOf("raster.rasterInfo")],p.prototype,"rasterInfo",void 0);b([l.property({type:a.SpatialReference}),l.aliasOf("rasterInfo.spatialReference")],p.prototype,"spatialReference",void 0);b([l.property({type:E,dependsOn:["rasterInfo"]}),l.aliasOf("rasterInfo.storageInfo.tileInfo")],
p.prototype,"tileInfo",void 0);b([l.property()],p.prototype,"title",void 0);b([l.property({readOnly:!0,json:{read:!1}})],p.prototype,"type",void 0);b([l.property(D.url)],p.prototype,"url",void 0);b([l.property({type:["ArcGISTiledImageServiceLayer"]})],p.prototype,"operationalLayerType",void 0);b([l.property(D.popupEnabled)],p.prototype,"popupEnabled",void 0);b([l.property({type:c,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],p.prototype,"popupTemplate",void 0);b([l.property({readOnly:!0,
dependsOn:["title"]})],p.prototype,"defaultPopupTemplate",null);b([l.property({readOnly:!0,type:[u]})],p.prototype,"fields",null);b([l.property({types:f.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],p.prototype,"renderer",void 0);b([l.reader("renderer")],p.prototype,"readRenderer",null);return p=b([l.subclass("esri.layers.TileImageryLayer")],p)}(l.declared(r.ScaleRangeLayer(q.RefreshableLayer(p.OperationalLayer(v.PortalLayer(B.MultiOriginJSONMixin(y)))))))});