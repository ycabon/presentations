// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/has","../../../core/libs/rbush/rbush","@dojo/framework/shim/Promise"],function(e,f,g,h){Object.defineProperty(f,"__esModule",{value:!0});var d={minX:0,minY:0,maxX:0,maxY:0};e=function(){function b(){var a=this;this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=h(9,g("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._loadIndex=function(){if(a._indexInvalid){var c=
Array(a._idByBounds.size),k=0;a._idByBounds.forEach(function(a,b){c[k++]=b});a._indexInvalid=!1;a._index.clear();a._index.load(c)}else a._boundsToLoad.length&&(a._index.load(a._boundsToLoad.filter(function(c){return a._idByBounds.has(c)})),a._boundsToLoad.length=0)}}b.prototype.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};b.prototype.delete=function(a){var c=this._boundsById.get(a);this._boundsById.delete(a);
c&&(this._idByBounds.delete(c),this._indexInvalid||this._index.remove(c))};b.prototype.forEachInBounds=function(a,c){this._loadIndex();var b=0,e=this._index;d.minX=a[0];d.minY=a[1];d.maxX=a[2];d.maxY=a[3];for(a=e.search(d);b<a.length;b++)c(this._idByBounds.get(a[b]))};b.prototype.get=function(a){return this._boundsById.get(a)};b.prototype.has=function(a){return this._boundsById.has(a)};b.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};
b.prototype.set=function(a,c){if(!this._indexInvalid){var b=this._boundsById.get(a);b&&(this._index.remove(b),this._idByBounds.delete(b))}this._boundsById.set(a,c);c&&(this._idByBounds.set(c,a),this._indexInvalid||this._boundsToLoad.push(c))};return b}();f.BoundsStore=e});