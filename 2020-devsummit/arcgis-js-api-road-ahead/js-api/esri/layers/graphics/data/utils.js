// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),function(N,l,p,n,A,B,C,D,E,F,G,
q,H,g,r,t,I){function x(a,b,f,e,d){void 0===e&&(e=a.hasZ);void 0===d&&(d=a.hasM);var h=a.hasZ&&e,k=a.hasM&&d;return f?(a=g.quantizeOptimizedGeometry(u,b,a.hasZ,a.hasM,"esriGeometryPoint",f,e,d),g.convertToPoint(a,h,k)):g.convertToPoint(b,h,k)}function v(a,b,f){return n(this,void 0,void 0,function(){var e,d,h,k,c,g;return p(this,function(m){switch(m.label){case 0:if(!a)return[2,null];e=a.where;a.where=e=e&&e.trim();if(!e||/^1 *= *1$/.test(e)||b&&b===e)a.where=null;return a.geometry?[4,J(a)]:[2,a];
case 1:return d=m.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&(h=a.geometry.spatialReference,d=E.getGeometryExtent(d),d.spatialReference=h),a.geometry=d,[4,t.checkProjectionSupport(d.spatialReference,f)];case 2:return m.sent(),[4,G.normalizeCentralMeridian(F.fromJSON(d))];case 3:k=m.sent()[0];if(B.isNone(k))throw l.QUERY_ENGINE_EMPTY_RESULT;c=k.toJSON();return[4,t.project(c,c.spatialReference,f)];case 4:g=m.sent();if(!g)throw l.QUERY_ENGINE_EMPTY_RESULT;g.spatialReference=
f;a.geometry=g;return[2,a]}})})}function J(a){return n(this,void 0,void 0,function(){var b,f,e,d,h,k,c,g,l,n;return p(this,function(m){switch(m.label){case 0:b=a.geometry;f=a.distance;e=a.units;if(null==f)return[2,C.resolve(b)];d=b.spatialReference;h=e&&K.fromJSON(e)||D.getUnitString(d);k=d&&(q.isGeographic(d)||q.isWebMercator(d));if(!k)return[3,1];g=b;return[3,3];case 1:return[4,t.checkProjectionSupport(d,q.WGS84).then(function(){return t.project(b,q.WGS84)})];case 2:g=m.sent(),m.label=3;case 3:return c=
g,[4,I.getGeodesicBufferOperator()];case 4:return l=m.sent(),n=l(c,f,h),[2,n?n.toJSON():null]}})})}Object.defineProperty(l,"__esModule",{value:!0});var K=new A.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});l.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var y=new r.default,L=new r.default,u=new r.default,w={esriGeometryPoint:g.convertToPoint,
esriGeometryPolyline:g.convertToPolyline,esriGeometryPolygon:g.convertToPolygon,esriGeometryMultipoint:g.convertToMultipoint};l.transformCentroid=x;l.getCentroid=function(a,b,f){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=H.getCentroidOptimizedGeometry(new r.default,b.geometry,a.hasZ,a.hasM));return x(a,b.centroid,f)};l.getGeometry=function(a,b,f,e,d,h){void 0===d&&(d=a.hasZ);void 0===h&&(h=a.hasM);var k=a.hasZ&&d,c=a.hasM&&h;b=b?"coords"in
b?b:b.geometry:null;if(!b)return null;if(f)return f=g.generalizeOptimizedGeometry(L,b,a.hasZ,a.hasM,a.geometryType,f,d,h),e&&(f=g.quantizeOptimizedGeometry(u,f,k,c,a.geometryType,e)),w[a.geometryType](f,k,c);if(e)return f=g.quantizeOptimizedGeometry(u,b,a.hasZ,a.hasM,a.geometryType,e,d,h),w[a.geometryType](f,k,c);g.removeZMValues(y,b,a.hasZ,a.hasM,d,h);return w[a.geometryType](y,k,c)};l.normalizeQuery=function(a,b,f){return n(this,void 0,void 0,function(){var e,d,h,k,c;return p(this,function(g){e=
a.outFields;d=a.orderByFields;h=a.groupByFieldsForStatistics;k=a.outStatistics;if(e)for(c=0;c<e.length;c++)e[c]=e[c].trim();if(d)for(c=0;c<d.length;c++)d[c]=d[c].trim();if(h)for(c=0;c<h.length;c++)h[c]=h[c].trim();if(k)for(c=0;c<k.length;c++)k[c].onStatisticField&&(k[c].onStatisticField=k[c].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,v(a,b,f)]})})};l.normalizeFilter=function(a,b,f){return n(this,void 0,void 0,function(){return p(this,function(e){return[2,
v(a,b,f)]})})};l.normalizeQueryLike=v;l.cleanFromGeometryEngine=function(a){return a&&z in a?JSON.parse(JSON.stringify(a,M)):a};var z="_geVersion",M=function(a,b){return a!==z?b:void 0}});