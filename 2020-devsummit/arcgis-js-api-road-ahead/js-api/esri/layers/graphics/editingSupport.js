// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Graphic ../../core/Collection ../../core/Error ../../core/lang ../../core/promiseUtils ../../core/urlUtils ../../geometry/support/normalizeUtils".split(" "),function(E,p,n,m,w,x,q,e,y,t,z,A){function B(a,c,d){return m(this,void 0,void 0,function(){var h,f;return n(this,function(b){switch(b.label){case 0:return[4,a.load()];case 1:b.sent();h=a.source;if(!h||null==h.applyEdits)return[2,
t.reject(new e(a.type+"-layer:no-editing-support","Layer source does not support applyEdits capability",{layer:a}))];if(!a.editingEnabled)throw new e(a.type+"-layer:editing-disabled","Editing is disabled for layer",{layer:a});return[4,C(a,c,d)];case 2:return f=b.sent(),f.addFeatures.length||f.updateFeatures.length||f.deleteFeatures.length||f.addAttachments.length||f.updateAttachments.length||f.deleteAttachments.length?[2,h.applyEdits(f,d)]:[2,{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],
addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}]}})})}function C(a,c,d){return m(this,void 0,void 0,function(){var h,f,b,g;return n(this,function(k){h=c&&(c.addFeatures||c.updateFeatures||c.deleteFeatures);f=c&&(c.addAttachments||c.updateAttachments||c.deleteAttachments);if(!c||!h&&!f)throw new e(a.type+"-layer:missing-parameters","'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");
if(!a.capabilities.data.isVersioned&&d&&d.gdbVersion)throw new e(a.type+"-layer:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!a.capabilities.editing.supportsRollbackOnFailure&&d&&d.rollbackOnFailureEnabled)throw new e(a.type+"-layer:invalid-parameter","This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");if(!a.capabilities.editing.supportsGlobalId&&
d&&d.globalIdUsed)throw new e(a.type+"-layer:invalid-parameter","This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!a.capabilities.editing.supportsGlobalId&&f)throw new e(a.type+"-layer:invalid-parameter","'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((!d||!d.globalIdUsed)&&f)throw new e(a.type+"-layer:invalid-parameter","When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true");
b=w({},c);b.addFeatures=q.isCollection(b.addFeatures)?b.addFeatures.toArray():b.addFeatures||[];b.updateFeatures=q.isCollection(b.updateFeatures)?b.updateFeatures.toArray():b.updateFeatures||[];b.deleteFeatures=q.isCollection(b.deleteFeatures)?b.deleteFeatures.toArray():b.deleteFeatures||[];b.addAttachments=b.addAttachments||[];b.updateAttachments=b.updateAttachments||[];b.deleteAttachments=b.deleteAttachments||[];b.addFeatures=b.addFeatures.map(u);b.updateFeatures=b.updateFeatures.map(u);g=d&&d.globalIdUsed;
b.addFeatures.forEach(function(b){return r(b,a,g)});b.updateFeatures.forEach(function(b){return r(b,a,g)});b.deleteFeatures.forEach(function(b){return r(b,a,g)});b.addAttachments.forEach(function(b){return v(b,a)});b.updateAttachments.forEach(function(b){return v(b,a)});return[2,D(b)]})})}function r(a,c,d){if(d){if("attributes"in a&&!a.attributes[c.globalIdField])throw new e(c.type+"-layer:invalid-parameter","Feature should have 'globalId' when 'globalIdUsed' is true");if(!("attributes"in a||a.globalId))throw new e(c.type+
"-layer:invalid-parameter","'globalId' of the feature should be passed when 'globalIdUsed' is true");}}function v(a,c){var d=a.feature;a=a.attachment;if(!d||"attributes"in d&&!d.attributes[c.globalIdField])throw new e(c.type+"-layer:invalid-parameter","Attachment should have reference to a feature with 'globalId'");if(!("attributes"in d||d.globalId))throw new e(c.type+"-layer:invalid-parameter","Attachment should have reference to 'globalId' of the parent feature");if(!a.globalId)throw new e(c.type+
"-layer:invalid-parameter","Attachment should have 'globalId'");if(!a.data&&!a.uploadId)throw new e(c.type+"-layer:invalid-parameter","Attachment should have 'data' or 'uploadId'");if(!(a.data instanceof File&&a.data.name||a.name))throw new e(c.type+"-layer:invalid-parameter","'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!c.capabilities.editing.supportsUploadWithItemId&&a.uploadId)throw new e(c.type+"-layer:invalid-parameter","This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");
if("string"===typeof a.data&&(d=z.dataComponents(a.data))&&!d.isBase64)throw new e(c.type+"-layer:invalid-parameter","Attachment 'data' should be a Blob, File or Base64 encoded string");}function D(a){return m(this,void 0,void 0,function(){var c,d,e,f,b,g;return n(this,function(k){switch(k.label){case 0:return c=a.addFeatures,d=a.updateFeatures,e=c.concat(d).map(function(a){return a.geometry}),[4,A.normalizeCentralMeridian(e)];case 1:return f=k.sent(),b=c.length,g=d.length,f.slice(0,b).forEach(function(b,
c){a.addFeatures[c].geometry=b}),f.slice(b,b+g).forEach(function(b,c){a.updateFeatures[c].geometry=b}),[2,a]}})})}function u(a){var c=new x;a.attributes||(a.attributes={});c.geometry=a.geometry;c.attributes=a.attributes;return c}Object.defineProperty(p,"__esModule",{value:!0});p.isEditableLayer=function(a){return!0===a.get("capabilities.operations.supportsEditing")};p.applyEdits=function(a,c,d){return m(this,void 0,void 0,function(){var e,f,b,g,k,l,m;return n(this,function(h){switch(h.label){case 0:b=
{edits:c,result:t.create(function(a,b){e=a;f=b})},a.emit("apply-edits",b),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,B(a,c,d)];case 2:return g=h.sent(),k=function(a){return a.filter(function(a){return!a.error}).map(y.clone)},l={addedFeatures:k(g.addFeatureResults),updatedFeatures:k(g.updateFeatureResults),deletedFeatures:k(g.deleteFeatureResults),addedAttachments:k(g.addAttachmentResults),updatedAttachments:k(g.updateAttachmentResults),deletedAttachments:k(g.deleteAttachmentResults)},(l.addedFeatures.length||
l.updatedFeatures.length||l.deletedFeatures.length||l.addedAttachments.length||l.updatedAttachments.length||l.deletedAttachments.length)&&a.emit("edits",l),e(l),[2,g];case 3:throw m=h.sent(),f(m),m;case 4:return[2]}})})}});