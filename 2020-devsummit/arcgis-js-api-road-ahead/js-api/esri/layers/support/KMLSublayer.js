// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../geometry ../../core/Collection ../../core/Evented ../../core/JSONSupport ../../core/Loadable ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./kmlUtils".split(" "),function(w,x,n,d,y,h,k,p,q,r,t,u,l,c,m,f){return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||
this;a._sublayersHandles=null;a.description=null;a.id=null;a.networkLink=null;a.title=null;a.sourceJSON=null;a.fullExtent=null;return a}n(b,g);e=b;b.prototype.initialize=function(){var a=this;l.whenOnce(this,"networkLink").then(function(){return l.whenTrueOnce(a,"visible")}).then(function(){return a.load()})};b.prototype.load=function(a){var b=this;if(this.networkLink)return a=t.isSome(a)?a.signal:null,a=this._fetchService(this._get("networkLink").href,a).then(function(a){var v=f.computeExtent(a.sublayers);
b.fullExtent=h.Extent.fromJSON(v);b.sourceJSON=a;a=m.default(k.ofType(e),f.sublayersFromJSON(e,a));b.sublayers?b.sublayers.addMany(a):b.sublayers=a;b.layer.emit("sublayer-update");b.layer&&b.layer.notifyChange("visibleSublayers")}),this.addResolvingPromise(a),u.resolve(this)};Object.defineProperty(b.prototype,"sublayers",{set:function(a){var b=this,c=this._get("sublayers");c&&(c.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=
null);a&&(a.forEach(function(a){a.parent=b;a.layer=b.layer}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=b;a.layer=b.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]);this._set("sublayers",a)},enumerable:!0,configurable:!0});b.prototype.castSublayers=function(a){return m.default(k.ofType(e),a)};Object.defineProperty(b.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._get("visible")!==a&&(this._set("visible",
a),this.layer&&this.layer.notifyChange("visibleSublayers"))},enumerable:!0,configurable:!0});b.prototype.readVisible=function(a,b){return!!b.visibility};Object.defineProperty(b.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},enumerable:!0,configurable:!0});b.prototype._fetchService=function(a,b){return f.fetchService(a,this.layer.outSpatialReference,this.layer.refreshInterval,b).then(function(a){return f.parseKML(a.data)})};
var e;d([c.property()],b.prototype,"description",void 0);d([c.property()],b.prototype,"id",void 0);d([c.property({readOnly:!0,value:null})],b.prototype,"networkLink",void 0);d([c.property({json:{write:{allowNull:!0}}})],b.prototype,"parent",void 0);d([c.property({value:null,json:{write:{allowNull:!0}}})],b.prototype,"sublayers",null);d([c.cast("sublayers")],b.prototype,"castSublayers",null);d([c.property({value:null,json:{read:{source:"name"}}})],b.prototype,"title",void 0);d([c.property({value:!0})],
b.prototype,"visible",null);d([c.reader("visible",["visibility"])],b.prototype,"readVisible",null);d([c.property()],b.prototype,"sourceJSON",void 0);d([c.property({value:null})],b.prototype,"layer",null);d([c.property({type:h.Extent})],b.prototype,"fullExtent",void 0);return b=e=d([c.subclass("esri.layers.support.KMLSublayer")],b)}(c.declared(p.EventedMixin(q.JSONSupportMixin(r))))});