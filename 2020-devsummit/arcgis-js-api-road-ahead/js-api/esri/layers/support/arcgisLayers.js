// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ./arcgisLayerUrl ./lazyLayerLoader @dojo/framework/shim/Promise".split(" "),function(r,g,p,d,e,t,u,v,w){function x(b,a){return b.sublayerIds.map(function(c){return new b.Constructor(p({},a,{layerId:c,sublayerTitleMode:"service-name"}))})}function y(b){return e(this,void 0,void 0,function(){var a,c,l,f,e,q,h,m,n,g;return d(this,function(d){switch(d.label){case 0:a=
v.parse(b);if(!a)throw new u("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:b});c=a.serverType;l=a.sublayer;e={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(c){case "MapServer":f=null!=l?"FeatureLayer":z(b).then(function(a){return a?"TileLayer":"MapImageLayer"});break;case "ImageServer":f=k(b).then(function(a){var b=a.tileInfo&&a.tileInfo.format;return a.tileInfo?b&&"LERC"===b.toUpperCase()&&a.cacheType&&"elevation"===
a.cacheType.toLowerCase()?"ElevationLayer":"TileLayer":"ImageryLayer"});break;case "SceneServer":f=k(a.url.path).then(function(a){var b={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return a&&Array.isArray(a.layers)&&0<a.layers.length&&(a=a.layers[0].layerType,null!=b[a])?b[a]:"SceneLayer"});break;default:f=e[c]}q={FeatureLayer:!0,SceneLayer:!0};h={parsedUrl:a,Constructor:null,sublayerIds:null};return[4,
f];case 1:return m=d.sent(),q[m]&&null==l?[4,A(b)]:[3,3];case 2:n=d.sent(),1!==n.length&&(h.sublayerIds=n),d.label=3;case 3:return g=h,[4,B(m)];case 4:return g.Constructor=d.sent(),[2,h]}})})}function A(b){return e(this,void 0,void 0,function(){var a;return d(this,function(c){switch(c.label){case 0:return[4,k(b)];case 1:return(a=c.sent())&&Array.isArray(a.layers)?[2,a.layers.map(function(a){return a.id}).reverse()]:[2,[]]}})})}function B(b){return e(this,void 0,void 0,function(){var a;return d(this,
function(c){a=w.layerLookupMap[b];return[2,a()]})})}function z(b){return e(this,void 0,void 0,function(){var a;return d(this,function(c){switch(c.label){case 0:return[4,k(b)];case 1:return a=c.sent(),[2,a.tileInfo]}})})}function k(b){return e(this,void 0,void 0,function(){var a;return d(this,function(c){switch(c.label){case 0:return[4,t(b,{responseType:"json",query:{f:"json"}})];case 1:return a=c.sent(),[2,a.data]}})})}Object.defineProperty(g,"__esModule",{value:!0});g.fromUrl=function(b){return e(this,
void 0,void 0,function(){var a,c,e,f;return d(this,function(d){switch(d.label){case 0:return[4,y(b.url)];case 1:return a=d.sent(),c=p({},b.properties,{url:b.url}),a.sublayerIds?[4,new Promise(function(a,b){r(["../GroupLayer"],a,b)})]:[2,new a.Constructor(c)];case 2:return e=d.sent(),f=new e({title:a.parsedUrl.title}),x(a,c).forEach(function(a){return f.add(a)}),[2,f]}})})}});