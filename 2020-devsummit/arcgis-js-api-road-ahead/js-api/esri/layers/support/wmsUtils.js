// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(J,m,G,H,w,r){function t(a){return I.some(function(b){var c=b[1];return a>=b[0]&&a<=c})}function z(a){var b=[];a.forEach(function(a){b.push(a);a.sublayers&&a.sublayers.length&&(b=b.concat(z(a.sublayers)),delete a.sublayers)});return b}function k(a,b){return(a=b&&b.getElementsByTagName(a))&&0<a.length?a[0]:null}function l(a,b,c){return(a=k(a,b))?a.textContent:c}function n(a,
b,c){if(!a)return null;var d=parseFloat(a.getAttribute("minx")),g=parseFloat(a.getAttribute("miny")),e=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));c?(c=isNaN(g)?-Number.MAX_VALUE:g,d=isNaN(d)?-Number.MAX_VALUE:d,g=isNaN(a)?Number.MAX_VALUE:a,e=isNaN(e)?Number.MAX_VALUE:e):(c=isNaN(d)?-Number.MAX_VALUE:d,d=isNaN(g)?-Number.MAX_VALUE:g,g=isNaN(e)?Number.MAX_VALUE:e,e=isNaN(a)?Number.MAX_VALUE:a);b=new r({wkid:b});return new w({xmin:c,ymin:d,xmax:g,ymax:e,spatialReference:b})}
function A(a,b){a=k(b,a);if(a=k("DCPType",a))if(a=k("HTTP",a))if(a=k("Get",a)){var c;if(c=(a=k("OnlineResource",a))?a.getAttribute("xlink:href"):null){c.indexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));a=["service","request"];b=[];c=H.urlToObject(c);for(var d in c.query)c.query.hasOwnProperty(d)&&-1===a.indexOf(d.toLowerCase())&&b.push(d+"\x3d"+c.query[d]);return c.path+(b.length?"?"+b.join("\x26"):"")}}return null}function B(a,b){var c=a.getElementsByTagName("Operation");if(!c||!c.length)return a=
k(b,a).getElementsByTagName("Format"),Array.prototype.slice.call(a).map(function(a){return a.textContent});var d=[];Array.prototype.slice.call(c).forEach(function(a){a.getAttribute("name")===b&&(a=a.getElementsByTagName("Format"),Array.prototype.slice.call(a).forEach(function(a){d.push(a.textContent)}))});return d}function u(a,b,c){a:{for(var d=0;d<a.childNodes.length;d++){var g=a.childNodes[d];if(g.nodeType===Node.ELEMENT_NODE&&g.nodeName===b){a=g;break a}}a=null}if(!a)return c;a=a.textContent;if(null==
a||""===a)return c;a=Number(a);return isNaN(a)?c:a}function x(a,b){if(!a)return null;var c={id:C++,fullExtents:[],parentLayerId:null,queryable:"1"===a.getAttribute("queryable"),spatialReferences:[],sublayers:null},d=k("LatLonBoundingBox",a),g=k("EX_GeographicBoundingBox",a),e=null;d&&(e=n(d,4326));g&&(e=new w(0,0,0,0,new r({wkid:4326})),e.xmin=parseFloat(l("westBoundLongitude",g,0)),e.ymin=parseFloat(l("southBoundLatitude",g,0)),e.xmax=parseFloat(l("eastBoundLongitude",g,0)),e.ymax=parseFloat(l("northBoundLatitude",
g,0)));d||g||(e=new w(-180,-90,180,90,new r({wkid:4326})));c.minScale=u(a,"MaxScaleDenominator",0);c.maxScale=u(a,"MinScaleDenominator",0);var m=-1<["1.0.0","1.1.0","1.1.1"].indexOf(b)?"SRS":"CRS";Array.prototype.slice.call(a.childNodes).forEach(function(a){if("Name"===a.nodeName)c.name=a.textContent||"";else if("Title"===a.nodeName)c.title=a.textContent||"";else if("Abstract"===a.nodeName)c.description=a.textContent||"";else if("BoundingBox"===a.nodeName){var d=a.getAttribute(m);if(d&&0===d.indexOf("EPSG:")){var f=
parseInt(d.substring(5),10);0===f||isNaN(f)||e||(e="1.3.0"===b?n(a,f,t(f)):n(a,f))}(f=d&&d.indexOf(":"))&&-1<f&&(f=parseInt(d.substring(f+1,d.length),10),0===f||isNaN(f)||(f=p[f]?p[f]:f),a="1.3.0"===b?n(a,f,t(f)):n(a,f),c.fullExtents.push(a))}else if(a.nodeName===m)a.textContent.split(" ").forEach(function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(p[a]&&(a=p[a]),-1===c.spatialReferences.indexOf(a)&&c.spatialReferences.push(a))});else if("Style"!==a.nodeName||
c.legendURL)"Layer"===a.nodeName&&(a=x(a,b))&&(a.parentLayerId=c.id,c.sublayers||(c.sublayers=[]),c.sublayers.push(a));else if(a=k("LegendURL",a))if(a=k("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href")});c.extent=e&&e.toJSON();return c}Object.defineProperty(m,"__esModule",{value:!0});var I=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,
2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],p={84:4326,83:4269,27:4267},C;m.parseCapabilities=
function(a){if(a){C=-1;"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));var b=a.documentElement;if("ServiceExceptionReport"===b.nodeName){var c=Array.prototype.slice.call(b.childNodes).map(function(a){return a.textContent}).join("\r\n");throw new G("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",c);}var d=k("Layer",b);if(d){var g="WMS_Capabilities"===b.nodeName||"WMT_MS_Capabilities"===b.nodeName?b.getAttribute("version"):
"1.3.0",e=k("Service",b);a=l("Title",e,"")||l("Name",e,"");var m=l("AccessConstraints",e,""),n=l("Abstract",e,""),p=parseInt(l("MaxWidth",e,5E3),10),e=parseInt(l("MaxHeight",e,5E3),10),f=k("Capability",b),r=B(b,"GetMap"),t=A(b,"GetMap"),h=x(d,g),y=0,u;Array.prototype.slice.call(f.childNodes).forEach(function(a){"Layer"===a.nodeName&&(0===y?u=a:(1===y&&h.name&&(h.name="",h.sublayers.push(x(u,g))),h.sublayers.push(x(a,g))),y++)});if(!h)return null;var q,v,d=h.fullExtents;(f=h.sublayers)||(f=[]);0===
f.length&&f.push(h);q=h.extent;q||(q=new w(f[0].extent),h.extent=q.toJSON(),q=h.extent);v=h.spatialReferences;if(!v.length&&0<f.length){var D=function(a){var b=[];a.sublayers.forEach(function(a){!b.length&&a.spatialReferences.length&&(b=a.spatialReferences||D(a))});return b};f.forEach(function(a){v.length||(v=a.spatialReferences||D(a))})}var E=A(b,"GetFeatureInfo");E&&(b=B(b,"GetFeatureInfo"),-1<b.indexOf("text/html")?c="text/html":-1<b.indexOf("text/plain")&&(c="text/plain"));if(!c){var F=function(a){a&&
(a.queryable=!1,a.sublayers&&a.sublayers.forEach(function(a){F(a)}))};F(h)}b=z(f);return{copyright:m,description:n,extent:q,fullExtents:d,featureInfoFormat:c,featureInfoUrl:E,mapUrl:t,maxImageWidth:p,maxImageHeight:e,maxScale:h.maxScale||0,minScale:h.minScale||0,layers:b,spatialReferences:v,supportedImageFormatTypes:r,title:a,version:g}}}};m.coordsReversed=t;m.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&a.queryable}).map(function(a){return a.name}).join(","):
""}});