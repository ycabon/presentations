// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../kernel ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/maybe ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ./Portal ./PortalRating".split(" "),function(u,A,v,e,m,w,n,x,f,y,h,k,p,d,z,q,r,l){return function(t){function b(a){a=t.call(this,a)||this;a.access=null;a.accessInformation=
null;a.applicationProxies=null;a.avgRating=null;a.categories=null;a.created=null;a.culture=null;a.description=null;a.extent=null;a.groupCategories=null;a.id=null;a.itemControl=null;a.licenseInfo=null;a.modified=null;a.name=null;a.numComments=null;a.numRatings=null;a.numViews=null;a.owner=null;a.ownerFolder=null;a.portal=null;a.screenshots=null;a.size=null;a.snippet=null;a.sourceJSON=null;a.tags=null;a.title=null;a.type=null;a.typeKeywords=null;a.url=null;return a}v(b,t);g=b;b.from=function(a){return z.ensureClass(g,
a)};Object.defineProperty(b.prototype,"displayName",{get:function(){var a=this.type,c=this.typeKeywords||[],b=a;"Feature Service"===a||"Feature Collection"===a?b=-1<c.indexOf("Table")?"Table":-1<c.indexOf("Route Layer")?"Route Layer":-1<c.indexOf("Markup")?"Markup":"Feature Layer":"Image Service"===a?b=-1<c.indexOf("Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?b="Scene Layer":"Scene Package"===a?b="Scene Layer Package":"Stream Service"===a?b="Feature Layer":"Geoprocessing Service"===
a&&this.portal&&this.portal.isPortal?b=-1<c.indexOf("Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===a?b="Locator":"Microsoft Powerpoint"===a?b="Microsoft PowerPoint":"GeoJson"===a?b="GeoJSON":"Globe Service"===a?b="Globe Layer":"Vector Tile Service"===a?b="Tile Layer":"netCDF"===a?b="NetCDF":"Map Service"===a?b=-1===c.indexOf("Spatiotemporal")&&(-1<c.indexOf("Hosted Service")||-1<c.indexOf("Tiled"))&&-1===c.indexOf("Relational")?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?
b=a.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===a?b="Big Data File Share":"Compact Tile Package"===a&&(b="Tile Package (tpkx)");return b},enumerable:!0,configurable:!0});b.prototype.readExtent=function(a){return a&&a.length?new q(a[0][0],a[0][1],a[1][0],a[1][1]):null};Object.defineProperty(b.prototype,"iconUrl",{get:function(){var a=this.type&&this.type.toLowerCase()||"",c=this.typeKeywords||[],b=!1,d=!1,e=!1,f=!1,g=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||
"wms"===a||"wmts"===a||"wfs"===a?(b=-1<c.indexOf("Hosted Service"),"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(d=-1<c.indexOf("Table"),e=-1<c.indexOf("Route Layer"),f=-1<c.indexOf("Markup"),a=(g=-1!==c.indexOf("Spatiotemporal"))&&d?"spatiotemporaltable":d?"table":e?"routelayer":f?"markup":g?"spatiotemporal":b?"featureshosted":"features"):a="map service"===a||"wms"===a||"wmts"===a?b||-1<c.indexOf("Tiled")||"wmts"===a?"maptiles":"mapimages":"scene service"===a?-1<c.indexOf("Line")?
"sceneweblayerline":-1<c.indexOf("3DObject")?"sceneweblayermultipatch":-1<c.indexOf("Point")?"sceneweblayerpoint":-1<c.indexOf("IntegratedMesh")?"sceneweblayermesh":-1<c.indexOf("PointCloud")?"sceneweblayerpointcloud":-1<c.indexOf("Polygon")?"sceneweblayerpolygon":-1<c.indexOf("Building")?"sceneweblayerbuilding":"sceneweblayer":"image service"===a?-1<c.indexOf("Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===
a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===a?-1<c.indexOf("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<c.indexOf("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===
a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<c.indexOf("ArcGIS Pro")||"explorer map"===a&&c.indexOf("Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netcdf"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===
a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===
a&&-1<c.indexOf("Explorer Mapping Application")||-1<c.indexOf("Document")?"datafilesgray":"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"mobile scene package"===a?"mobilescenepackage":"tile package"===a||"compact tile package"===
a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?"insightspage":"insights theme"===a?"insightstheme":"hub initiative"===a?"hubinitiative":"hubpage"===a?"hubpage":"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":
"image collection"===a?"imagecollection":"style"===a?"style":"desktop style"===a?"desktopstyle":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===a?"vectortilepackage":"ortho mapping project"===a?"orthomappingproject":"ortho mapping template"===a?"orthomappingtemplate":"solution"===a?"solutions":"geopackage"===a?"geopackage":"deep learning package"===a?"deeplearningpackage":"real time analytic"===a?"realtimeanalytics":"big data analytic"===
a?"bigdataanalytics":"feed"===a?"feed":"excalibur imagery project"===a?"excaliburimageryproject":"notebook"===a?"notebook":"storymap"===a?"storymap":"survey123 add in"===a?"survey123addin":"mission"===a?"mission":"quickcapture project"===a?"quickcaptureproject":"pro report"===a?"proreport":"urban model"===a?"urbanmodel":"web experience"===a?"experiencebuilder":"web experience template"===a?"webexperiencetemplate":"workflow"===a?"workflow":"insights script"===a?"insightsscript":"kernel gateway connection"===
a?"kernelgatewayconnection":"hub initiative template"===a?"hubinitiativetemplate":"maps";return a?u.toUrl("../images/portal/"+a+"16.png"):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isLayer",{get:function(){return-1<"Map Service;Feature Service;Feature Collection;Scene Service;Image Service;Stream Service;Vector Tile Service;WMTS;WMS".split(";").indexOf(this.type)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"itemUrl",{get:function(){var a=this.get("portal.restUrl");
return a?a+"/content/items/"+this.id:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"itemCdnUrl",{get:function(){var a=this.itemUrl;if(a){var c=w.id;c&&c.findCredential(a)||(a=c._normalizeAGOLorgDomain(a),a=a.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),a=a.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),a=a.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com"))}return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"thumbnailUrl",{get:function(){var a=this.itemUrl,c=this.thumbnail;return a&&c?this.portal._normalizeUrl(a+"/info/"+c+"?f\x3djson"):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"userItemUrl",{get:function(){var a=this.get("portal.restUrl");if(!a)return null;var c=this.owner||this.get("portal.user.username");return c?a+"/content/users/"+(this.ownerFolder?c+"/"+this.ownerFolder:c)+"/items/"+this.id:null},enumerable:!0,configurable:!0});b.prototype.load=function(a){var c=this;
this.portal||(this.portal=r.getDefault());var b=this.portal.load(a).then(function(){return c.sourceJSON?c.sourceJSON:c.id&&c.itemUrl?c.portal._request(c.itemCdnUrl,{signal:h.isSome(a)?a.signal:null}):{}}).then(function(a){c.sourceJSON=a;c.read(a)});this.addResolvingPromise(b);return k.resolve(this)};b.prototype.addRating=function(a){var c={method:"post",query:{}};a instanceof l&&(a=a.rating);isNaN(a)||"number"!==typeof a||(c.query.rating=a);return this.portal._request(this.itemUrl+"/addRating",c).then(function(){return new l({rating:a,
created:new Date})})};b.prototype.clone=function(){var a={access:this.access,accessInformation:this.accessInformation,applicationProxies:f.clone(this.applicationProxies),avgRating:this.avgRating,categories:f.clone(this.categories),created:f.clone(this.created),culture:this.culture,description:this.description,extent:f.clone(this.extent),groupCategories:f.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:f.clone(this.modified),name:this.name,
numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:f.clone(this.screenshots),size:this.size,snippet:this.snippet,tags:f.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:f.clone(this.typeKeywords),url:this.url};this.loaded&&(a.loadStatus="loaded");return(new g({sourceJSON:this.sourceJSON})).set(a)};b.prototype.createPostQuery=function(){var a=this.toJSON(),
c;for(c in a)"tags"===c&&null!==a[c]&&(a[c]=a[c].join(", ")),"typeKeywords"===c&&null!==a[c]&&(a[c]=a[c].join(", ")),"extent"===c&&a[c]&&(a[c]=JSON.stringify(a[c]));return a};b.prototype.deleteRating=function(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(function(){})};b.prototype.fetchData=function(a,c){void 0===a&&(a="json");return this.portal._request(this.itemCdnUrl+"/data",m({responseType:a},c))};b.prototype.fetchRating=function(a){return this.portal._request(this.itemUrl+
"/rating",a).then(function(a){return null!=a.rating?(a.created=new Date(a.created),new l(a)):null})};b.prototype.fetchRelatedItems=function(a,c){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",m({query:a},c),"PortalItem")};b.prototype.getThumbnailUrl=function(a){var c=this.thumbnailUrl;c&&a&&(c+="\x26w\x3d"+a);return c};b.prototype.reload=function(){var a=this;return this.portal._request(this.itemUrl,{cacheBust:!0}).then(function(c){a.sourceJSON=c;a.read(c);return a})};b.prototype.update=
function(a){var c=this;return this.id?this.load().then(function(){return c.portal._signIn()}).then(function(){var b=a&&a.data,d={method:"post"};d.query=c.createPostQuery();for(var e in d.query)null===d.query[e]&&(d.query[e]="");d.query.clearEmptyFields=!0;null!=b&&("string"===typeof b?d.query.text=b:"object"===typeof b&&(d.query.text=JSON.stringify(b)));return c.portal._request(c.userItemUrl+"/update",d).then(function(){return c.reload()})}):k.reject(new n("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))};
b.prototype.updateThumbnail=function(a){var c=this;return this.id?this.load().then(function(){return c.portal._signIn()}).then(function(){var b=a.thumbnail,d=a.filename,e={method:"post"};if("string"===typeof b)p.isDataProtocol(b)?e.query={data:b}:e.query={url:p.makeAbsolute(b)},h.isSome(d)&&(e.query.filename=d);else{var f=new FormData;h.isSome(d)?f.append("file",b,d):f.append("file",b);e.body=f}return c.portal._request(c.userItemUrl+"/updateThumbnail",e).then(function(){return c.reload()})}):k.reject(new n("portal:item-does-not-exist",
"The item does not exist yet and cannot be updated"))};b.prototype.toJSON=function(){var a=this.extent,a={created:this.created&&this.created.getTime(),description:this.description,extent:a&&[[a.xmin,a.ymin],[a.xmax,a.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return f.fixJson(a)};
b.fromJSON=function(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");return new g({sourceJSON:a})};b.prototype._getPostQuery=function(){var a=this.toJSON(),b;for(b in a)"tags"===b&&null!==a[b]&&(a[b]=a[b].join(", ")),"typeKeywords"===b&&null!==a[b]&&(a[b]=a[b].join(", ")),"extent"===b&&a[b]&&(a[b]=JSON.stringify(a[b]));return a};var g;e([d.property()],b.prototype,"access",void 0);e([d.property()],b.prototype,"accessInformation",void 0);e([d.property({json:{read:{source:"appProxies"}}})],
b.prototype,"applicationProxies",void 0);e([d.property()],b.prototype,"avgRating",void 0);e([d.property()],b.prototype,"categories",void 0);e([d.property({type:Date})],b.prototype,"created",void 0);e([d.property()],b.prototype,"culture",void 0);e([d.property()],b.prototype,"description",void 0);e([d.property({dependsOn:["type","typeKeywords"],readOnly:!0})],b.prototype,"displayName",null);e([d.property({type:q})],b.prototype,"extent",void 0);e([d.reader("extent")],b.prototype,"readExtent",null);e([d.property()],
b.prototype,"groupCategories",void 0);e([d.property({dependsOn:["type","typeKeywords"],readOnly:!0})],b.prototype,"iconUrl",null);e([d.property()],b.prototype,"id",void 0);e([d.property({dependsOn:["type"],readOnly:!0})],b.prototype,"isLayer",null);e([d.property()],b.prototype,"itemControl",void 0);e([d.property({dependsOn:["portal.restUrl","id"],readOnly:!0})],b.prototype,"itemUrl",null);e([d.property()],b.prototype,"licenseInfo",void 0);e([d.property({type:Date})],b.prototype,"modified",void 0);
e([d.property()],b.prototype,"name",void 0);e([d.property()],b.prototype,"numComments",void 0);e([d.property()],b.prototype,"numRatings",void 0);e([d.property()],b.prototype,"numViews",void 0);e([d.property()],b.prototype,"owner",void 0);e([d.property()],b.prototype,"ownerFolder",void 0);e([d.property({type:r})],b.prototype,"portal",void 0);e([d.property()],b.prototype,"screenshots",void 0);e([d.property()],b.prototype,"size",void 0);e([d.property()],b.prototype,"snippet",void 0);e([d.property()],
b.prototype,"sourceJSON",void 0);e([d.property()],b.prototype,"tags",void 0);e([d.property()],b.prototype,"thumbnail",void 0);e([d.property({dependsOn:["itemUrl","thumbnail","portal.credential.token"],readOnly:!0})],b.prototype,"thumbnailUrl",null);e([d.property()],b.prototype,"title",void 0);e([d.property()],b.prototype,"type",void 0);e([d.property()],b.prototype,"typeKeywords",void 0);e([d.property()],b.prototype,"url",void 0);e([d.property({dependsOn:["portal.restUrl","portal.user.username","owner",
"ownerFolder","id"],readOnly:!0})],b.prototype,"userItemUrl",null);return b=g=e([d.subclass("esri.portal.PortalItem")],b)}(d.declared(x.JSONSupportMixin(y)))});