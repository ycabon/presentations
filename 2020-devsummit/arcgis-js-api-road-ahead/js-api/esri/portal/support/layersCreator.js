// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Collection ../../core/has ../../core/promiseUtils ../../layers/support/lazyLayerLoader ../PortalItem ./featureCollectionUtils ./portalLayers ../../renderers/support/styleUtils".split(" "),function(M,q,n,l,y,N,z,k,A,r,B,C){function D(a,d,c){return l(this,void 0,void 0,function(){var b;return n(this,function(e){switch(e.label){case 0:return b=new a,b.read(d,c.context),"group"===b.type&&t(d)?[4,
E(b,d,c.context)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,C.loadStyleRenderer(b,c.context)];case 3:return e.sent(),[2,b]}})})}function u(a,d){return l(this,void 0,void 0,function(){var c;return n(this,function(b){switch(b.label){case 0:return[4,F(a,d)];case 1:return c=b.sent(),[2,D(c,a,d)]}})})}function F(a,d){return l(this,void 0,void 0,function(){var c,b,e,h,f,m,p,v,w;return n(this,function(g){switch(g.label){case 0:c=d.context;switch(c.origin){case "web-scene":switch(c.layerContainerType){case "basemap":g=
G;break;case "ground":g=H;break;default:g=I}break;default:switch(c.layerContainerType){case "basemap":g=J;break;default:g=K}}b=g;e=a.layerType||a.type;!e&&d&&d.defaultLayerType&&(e=d.defaultLayerType);f=(h=b[e])?k.layerLookupMap[h]:k.layerLookupMap.UnknownLayer;m=c&&c.portal;if("Feature Collection"!==a.type)return[3,4];if(!a.itemId)return[3,3];p=new A({id:a.itemId,portal:m});return[4,p.load()];case 1:return g.sent(),[4,B.selectLayerClassPath(p)];case 2:v=g.sent(),w=v.className||"UnknownLayer",f=k.layerLookupMap[w],
g.label=3;case 3:return[3,8];case 4:return"ArcGISFeatureLayer"!==e?[3,8]:[4,r.isMapNotesLayer(a,m)];case 5:if(!g.sent())return[3,6];f=k.layerLookupMap.MapNotesLayer;return[3,8];case 6:return[4,r.isRouteLayer(a,m)];case 7:g.sent()?f=k.layerLookupMap.RouteLayer:t(a)&&(f=k.layerLookupMap.GroupLayer),g.label=8;case 8:return a.wmtsInfo&&(f=k.layerLookupMap.WMTSLayer),[2,f()]}})})}function t(a){if("ArcGISFeatureLayer"!==a.layerType||"Feature Collection"===a.type)return!1;a=a.featureCollection;return!!(a&&
a.layers&&1<a.layers.length)}function L(a,d,c){return l(this,void 0,void 0,function(){var b,e,h;return n(this,function(f){switch(f.label){case 0:return b=new y,e=x(b,Array.isArray(d.layers)?d.layers:[],c),[4,a];case 1:return h=f.sent(),[4,e];case 2:return f.sent(),"group"===h.type?(h.layers.addMany(b),[2,h]):[2,void 0]}})})}function E(a,d,c){return l(this,void 0,void 0,function(){var b,e,h,f,m;return n(this,function(p){switch(p.label){case 0:return b=k.layerLookupMap.FeatureLayer,[4,b()];case 1:return e=
p.sent(),h=d.featureCollection,f=h.showLegend,m=h.layers.map(function(a){var b=new e;b.read(a,c);null!=f&&b.read({showLegend:f},c);return b}),a.layers.addMany(m),[2]}})})}function x(a,d,c){return l(this,void 0,void 0,function(){var b,e,h,f,m,p,k,l,g;return n(this,function(n){switch(n.label){case 0:if(!d)return[2];b=[];e=0;for(h=d;e<h.length;e++)f=h[e],m=u(f,c),"GroupLayer"===f.layerType?b.push(L(m,f,c)):b.push(m);return[4,z.eachAlways(b)];case 1:p=n.sent();k=0;for(l=p;k<l.length;k++)g=l[k],!g.value||
c.filter&&!c.filter(g.value)||a.add(g.value);return[2]}})})}Object.defineProperty(q,"__esModule",{value:!0});var I={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",
GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer"},H={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},G={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",
ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},K={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",
KML:"KMLLayer",WFS:"UnsupportedLayer",WMS:"WMSLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",DefaultTileLayer:"TileLayer"},J={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",
BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};q.createLayer=u;q.populateOperationalLayers=function(a,d,c){return l(this,void 0,void 0,function(){return n(this,function(b){return[2,x(a,d,c)]})})}});