// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Collection ../../core/Error ../../core/promiseUtils ../../layers/support/lazyLayerLoader ../PortalItem ./portalItemUtils".split(" "),function(E,f,k,r,t,u,v,w,g,x,l,m){function n(a){switch(a.type){case "Map Service":return y(a);case "Feature Service":return z(a);case "Feature Collection":return A(a);case "Scene Service":return B(a);case "Image Service":return C(a);
case "Stream Service":return{className:"StreamLayer"};case "Vector Tile Service":return{className:"VectorTileLayer"};case "KML":return{className:"KMLLayer"};case "WMTS":return{className:"WMTSLayer"};case "WMS":return{className:"WMSLayer"};default:return g.reject(new w("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type}))}}function D(a){return(0,x.layerLookupMap[a.className])().then(function(b){return{constructor:b,properties:a.properties}})}function y(a){return p(a).then(function(a){return a?
{className:"TileLayer"}:{className:"MapImageLayer"}})}function z(a){return q(a).then(function(a){if("object"===typeof a){var b={};null!=a.id&&(b.layerId=a.id);return{className:"FeatureLayer",properties:b}}return{className:"GroupLayer"}})}function B(a){return q(a).then(function(b){if("object"===typeof b){var d={},c=void 0;null!=b.id?(d.layerId=b.id,c=a.url+"/layers/"+b.id):c=a.url;if(Array.isArray(a.typeKeywords)&&0<a.typeKeywords.length){b={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",
Point:"SceneLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};for(var e=0,f=Object.keys(b);e<f.length;e++){var g=f[e];if(-1!==a.typeKeywords.indexOf(g))return{className:b[g]}}}return h(c).then(function(a){var b="SceneLayer",c={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};a&&a.layerType&&c[a.layerType]&&(b=c[a.layerType]);return{className:b,properties:d}})}return{className:"GroupLayer"}})}
function A(a){return t(this,void 0,void 0,function(){var b,d,c;return r(this,function(e){switch(e.label){case 0:return[4,a.load()];case 1:return e.sent(),(b=m.hasTypeKeyword(a,"Map Notes"))?[2,{className:"MapNotesLayer"}]:(d=m.hasTypeKeyword(a,"Route Layer"))?[2,{className:"RouteLayer"}]:[4,a.fetchData()];case 2:return(c=e.sent())&&Array.isArray(c.layers)&&1===c.layers.length?[2,{className:"FeatureLayer"}]:[2,{className:"GroupLayer"}]}})})}function C(a){return p(a).then(function(b){var d=new v(a.typeKeywords);
return b?d.find(function(a){return"elevation 3d layer"===a.toLowerCase()})?{className:"ElevationLayer"}:{className:"TileLayer"}:{className:"ImageryLayer"}})}function p(a){return h(a.url).then(function(a){return a.tileInfo})}function q(a){return!a.url||a.url.match(/\/\d+$/)?g.resolve({}):a.load().then(function(){return a.fetchData()}).then(function(b){return b&&Array.isArray(b.layers)?1===b.layers.length?{id:b.layers[0].id}:!1:h(a.url).then(function(a){return a&&Array.isArray(a.layers)?1===a.layers.length?
{id:a.layers[0].id}:!1:{}})})}function h(a){return u(a,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(f,"__esModule",{value:!0});f.fromItem=function(a){!a.portalItem||a.portalItem instanceof l||a.portalItem.constructor&&a.portalItem.constructor._meta||(a=k({},a,{portalItem:new l(a.portalItem)}));return a.portalItem.load().then(n).then(D).then(function(b){var d=k({portalItem:a.portalItem},b.properties);return g.resolve(new b.constructor(d))})};f.selectLayerClassPath=
n});