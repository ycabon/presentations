// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../.. ../../../Color ../../../core/Error ../../../core/maybe ./support/utils ../statistics/heatmapStatistics ../support/utils ../symbology/heatmap ../../support/HeatmapColorStop".split(" "),function(M,r,G,n,h,H,F,t,p,z,I,q,A,x){function J(b){return h(this,void 0,void 0,function(){var a,d,e,f,c,g,k,u,v,w;return n(this,function(l){switch(l.label){case 0:if(!(b&&
b.layer&&b.view))throw new t("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");a=b.blurRadius;d=b.minRatio;e=b.maxRatio;f=b.fadeToTransparent;c=G({},b);c.blurRadius=null==a?10:a;c.minRatio=null==d?.01:d;c.maxRatio=null==e?1:e;c.fadeToTransparent=null==f?!0:f;g=[0,2,1];k=q.createLayerAdapter(c.layer,g);c.layer=k;if(!k)throw new t("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+q.getLayerTypeLabels(g).join(", "));u=p.isSome(c.signal)?{signal:c.signal}:
null;return[4,k.load(u)];case 1:return l.sent(),[4,q.getFieldsList({field:c.field})];case 2:v=l.sent();if(w=z.verifyBasicFieldValidity(k,v,"heatmap-renderer:invalid-parameters"))throw w;return[2,c]}})})}function K(b){return h(this,void 0,void 0,function(){var a,d,e,f,c;return n(this,function(g){switch(g.label){case 0:return a=b.scheme,e=d=null,[4,z.getBasemapInfo(b.basemap,b.view)];case 1:f=g.sent();d=p.isSome(f.basemapId)?f.basemapId:null;e=p.isSome(f.basemapTheme)?f.basemapTheme:null;if(a)return[2,
{scheme:A.cloneScheme(a),basemapId:d,basemapTheme:e}];if(c=A.getSchemes({basemap:d,basemapTheme:e}))a=c.primaryScheme,d=c.basemapId,e=c.basemapTheme;return[2,{scheme:a,basemapId:d,basemapTheme:e}]}})})}function L(b,a){return h(this,void 0,void 0,function(){var d,e,f,c,g,k,u,v,w,l,h,p,q,y,B,r,C,t,m,D,E;return n(this,function(n){switch(n.label){case 0:return d=b.fieldOffset,e=a.field,f=a.basemap,c=a.blurRadius,g=a.minRatio,k=a.maxRatio,u=a.fadeToTransparent,v=a.heatmapScheme,w=a.view,[4,K({basemap:f,
scheme:v,view:w})];case 1:return l=n.sent(),h=l.scheme,p=l.basemapId,q=l.basemapTheme,y=h.colors,B=y.length,C=(r=!b.count)?[0,100]:[b.min,b.max],t=(k-g)/(B-1),m=y[0],D=[new x.HeatmapColorStop({ratio:0,color:new F([m.r,m.g,m.b,0])}),new x.HeatmapColorStop({ratio:.01,color:new F([m.r,m.g,m.b,0])}),new x.HeatmapColorStop({ratio:u?g:.01,color:m})],z.createColors(y,B).forEach(function(a,b){D.push(new x.HeatmapColorStop({ratio:g+t*b,color:a}))}),E=new H.HeatmapRenderer({blurRadius:c,colorStops:D,field:e,
minPixelIntensity:C[0],maxPixelIntensity:C[1]}),null!=d&&(E.fieldOffset=d),[2,{renderer:E,statistics:b,defaultValuesUsed:r,scheme:A.cloneScheme(h),basemapId:p,basemapTheme:q}]}})})}Object.defineProperty(r,"__esModule",{value:!0});r.createRenderer=function(b){return h(this,void 0,void 0,function(){var a,d,e;return n(this,function(f){switch(f.label){case 0:return[4,J(b)];case 1:a=f.sent();if(!a.statistics)return[3,2];e=a.statistics;return[3,4];case 2:return[4,I({layer:a.layer,field:a.field,fieldOffset:a.fieldOffset,
blurRadius:a.blurRadius,view:a.view,signal:a.signal})];case 3:e=f.sent(),f.label=4;case 4:return d=e,[2,L(d,a)]}})})}});