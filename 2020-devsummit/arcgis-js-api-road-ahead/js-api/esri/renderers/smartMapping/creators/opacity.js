// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ./support/utils ../statistics/summaryStatistics ../support/utils ../../support/AuthoringInfo ../../support/AuthoringInfoVisualVariable ../../visualVariables/OpacityVariable".split(" "),function(A,n,r,p,q,k,t,u,l,v,m,w,x,y){function z(d){return q(this,void 0,void 0,function(){var a,h,c,b,e,f;return p(this,
function(g){switch(g.label){case 0:if(!(d&&d.layer&&(d.field||d.valueExpression||d.sqlExpression)))throw new k("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(d.valueExpression&&!d.view)throw new k("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");a=r({},d);h=[0,2,1,3];c=m.createLayerAdapter(a.layer,h);a.layer=c;if(!c)throw new k("opacity-visual-variable:invalid-parameters",
"'layer' must be one of these types: "+m.getLayerTypeLabels(h).join(", "));b=t.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(b)];case 1:return g.sent(),[4,m.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:e=g.sent();if(f=l.verifyBasicFieldValidity(c,e,"opacity-visual-variable:invalid-parameters"))throw f;return[2,a]}})})}Object.defineProperty(n,"__esModule",{value:!0});n.createVisualVariable=function(d){return q(this,void 0,
void 0,function(){var a,h;return p(this,function(c){switch(c.label){case 0:return[4,z(d)];case 1:a=c.sent();h=null;if(!a.statistics)return[3,2];h=a.statistics;return[3,4];case 2:return[4,v({layer:a.layer,field:a.field,valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,normalizationType:a.normalizationField?"field":void 0,normalizationField:a.normalizationField,minValue:a.minValue,maxValue:a.maxValue,view:a.view,signal:a.signal})];case 3:h=c.sent(),c.label=4;case 4:c=
h;var b=a,e=b.layer,f=b.field,e=(e=f&&"function"!==typeof f?e.getField(f):null)&&"date"===e.type,g=l.createStopValues(c),g=(e=l.getDefaultDataRange(c,e,!0))||[g[0],g[4]],f=new y({field:f,valueExpression:b.valueExpression,valueExpressionTitle:b.valueExpressionTitle,normalizationField:b.normalizationField,stops:[{value:g[0],opacity:.3},{value:g[1],opacity:1}],legendOptions:b.legendOptions}),b=new x({type:"opacity",minSliderValue:null!=b.minValue?b.minValue:c.min,maxSliderValue:null!=b.maxValue?b.maxValue:
c.max}),b=new w({visualVariables:[b]});return[2,u.resolve({visualVariable:f,statistics:c,defaultValuesUsed:!!e,authoringInfo:b})]}})})}});