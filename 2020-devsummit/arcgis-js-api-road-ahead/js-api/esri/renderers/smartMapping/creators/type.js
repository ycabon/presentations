// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper dojo/i18n!../../nls/smartMapping ../.. ../../../pointCloudRenderers ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ./support/utils ../heuristics/outline ../heuristics/sizeRange ../statistics/uniqueValues ../support/utils ../symbology/type ../../support/LegendOptions ../../support/utils".split(" "),function(ca,w,E,q,m,Q,R,
y,k,K,u,S,l,T,U,L,p,F,V,G){function W(d){return m(this,void 0,void 0,function(){var a,b,c,e,f,g,h;return q(this,function(v){switch(v.label){case 0:if(!d||!d.layer||!d.field&&!d.valueExpression)throw new k("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(d.valueExpression&&!d.view)throw new k("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=E({},d);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?
10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.sortEnabled=null==a.sortEnabled?!0:a.sortEnabled;a.statistics=K.clone(a.statistics);b=[0,2,1,3];c=p.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new k("type-renderer:invalid-parameters","'layer' must be one of these types: "+p.getLayerTypeLabels(b).join(", "));e=u.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(e)];case 1:v.sent();f=c.geometryType;a.outlineOptimizationEnabled=
"polygon"===f?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===f||"multipoint"===f||"polyline"===f?a.sizeOptimizationEnabled:!1;if("mesh"===f)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==f)throw new k("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new k("type-renderer:invalid-parameters",
"'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}return[4,p.getFieldsList({field:a.field,valueExpression:a.valueExpression})];case 2:g=v.sent();if(h=l.verifyBasicFieldValidity(c,g,"type-renderer:invalid-parameters"))throw h;return[2,a]}})})}function X(d){return m(this,void 0,void 0,function(){var a,b,c,e,f,g;return q(this,function(h){switch(h.label){case 0:if(!(d&&d.layer&&d.field))throw new k("type-point-cloud-class-renderer:missing-parameters",
"'layer' and 'field' parameters are required");a=E({},d);a.statistics=K.clone(a.statistics);b=[4];c=p.createLayerAdapter(a.layer,b);a.layer=c;a.density=a.density||25;a.size=a.size||"100%";if(!l.isValidPointSize(a.size))throw new k("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");if(!c)throw new k("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+p.getLayerTypeLabels(b).join(", "));e=
u.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(e)];case 1:return h.sent(),[4,p.getFieldsList({field:a.field})];case 2:f=h.sent();if(g=l.verifyBasicFieldValidity(c,f,"type-point-cloud-class-renderer:invalid-parameters"))throw g;return[2,a]}})})}function M(d){return m(this,void 0,void 0,function(){var a,b,c,e,f;return q(this,function(g){switch(g.label){case 0:return a=d.typeScheme,c=b=null,[4,l.getBasemapInfo(d.basemap,d.view)];case 1:e=g.sent();b=u.isSome(e.basemapId)?e.basemapId:null;c=
u.isSome(e.basemapTheme)?e.basemapTheme:null;if(a)return[2,{scheme:F.cloneScheme(a),basemapId:b,basemapTheme:c}];if(f=F.getSchemes({basemap:b,basemapTheme:c,geometryType:d.geometryType,theme:d.theme,worldScale:d.worldScale,view:d.view}))a=f.primaryScheme,b=f.basemapId,c=f.basemapTheme;return[2,{scheme:a,basemapId:b,basemapTheme:c}]}})})}function N(d,a){return d.label<a.label?-1:d.label>a.label?1:0}function O(d,a){return d.value<a.value?-1:d.value>a.value?1:0}function Y(d,a){var b=a.count-d.count;
0===b&&(b=N(d,a));return b}function Z(d,a){var b=a.count-d.count;0===b&&(b=O(d,a));return b}function P(d,a,b){var c;"count"===a?(c=Z,b&&b.codedValues&&(c=Y)):"value"===a&&(c=O,b&&b.codedValues&&(c=N));c&&d.sort(c)}function aa(d,a,b,c){return m(this,void 0,void 0,function(){var e,f,g,h,v,B,t,C,k,n,m,p,x,u,w,y,D,z,A,r,H,I,J;return q(this,function(q){switch(q.label){case 0:return e=d.uniqueValueInfos,f=a.layer,v=(h=(g=a.field)?f.getField(g):null)?f.getFieldDomain(h.name):null,B=-1===a.numTypes?e.length:
a.numTypes,t=f.geometryType,[4,M({basemap:a.basemap,geometryType:t,typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view})];case 1:C=q.sent();k=C.scheme;n=new R.UniqueValueRenderer({field:g});m=-1;x={value:null,domain:v,fieldInfo:h};e.forEach(function(a,b){x.value=a.value;a.label=G.createUniqueValueLabel(x);null===a.value&&(m=b)});-1<m&&(p=e.splice(m,1)[0]);!1!==a.sortEnabled&&P(e,a.sortBy,v);h&&"date"===h.type&&(u=e.filter(function(a,b){return b<B}),w=u.map(function(a){return a.value}),
x.dateFormatInterval=G.calculateDateFormatInterval(w));y=b&&b.opacity;D=l.createColors(k.colors,e.length);z=l.getSymbolSizeFromScheme(k,t);A=l.getSymbolOutlineFromScheme(k,t,y);e.forEach(function(b,c){x.value=b.value;b.label=G.createUniqueValueLabel(x);b.symbol=l.createSymbol(t,{type:a.symbolType,color:D[c],size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.valueExpression&&(n.valueExpression=a.valueExpression,n.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&
(n.legendOptions=new V.LegendOptions(a.legendOptions));D=l.createColors(k.colors,B);for(r=0;r<B;r++)(H=e[r])&&n.addUniqueValueInfo({value:H.value,label:H.label,symbol:l.createSymbol(t,{type:a.symbolType,color:D[r],size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.defaultSymbolEnabled&&(n.defaultSymbol=l.createSymbol(t,{type:a.symbolType,color:k.noDataColor,size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),n.defaultLabel=Q.other);p&&(p.symbol=
l.createSymbol(t,{type:a.symbolType,color:k.noDataColor,size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),e.push(p));I=[];J=n.uniqueValueInfos.length===e.length?-1:n.uniqueValueInfos.length;if(-1<J)for(r=J;r<e.length;r++)I.push(E({},e[r]));b&&b.visualVariables&&b.visualVariables.length&&(n.visualVariables=b.visualVariables.map(function(a){return a.clone()}));c&&c.minSize&&(n.visualVariables?n.visualVariables.push(c.minSize):n.visualVariables=[c.minSize]);return[2,{renderer:n,
uniqueValueInfos:e,excludedUniqueValueInfos:I,typeScheme:F.cloneScheme(k),basemapId:C.basemapId,basemapTheme:C.basemapTheme}]}})})}function ba(d,a){return m(this,void 0,void 0,function(){var b,c,e,f,g;return q(this,function(h){switch(h.label){case 0:return b=d.uniqueValueInfos,[4,M({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:a})];case 1:return e=(c=h.sent())&&c.scheme,g=(f="point-cloud-class"===e.theme)?e.colors:l.createColors(e.colors,b.length),P(b,"value"),[2,b.map(function(a,
b){var c=a.value,d=null;f?(d=g[c])||(d=g[g.length-1]):d=g[b];return{values:[c],color:d,label:a.label}})]}})})}Object.defineProperty(w,"__esModule",{value:!0});w.createRenderer=function(d){return m(this,void 0,void 0,function(){var a,b,c,e,f,g,h,k,l;return q(this,function(m){switch(m.label){case 0:return[4,W(d)];case 1:return a=m.sent(),b=a.layer,c=a.view,e=a.signal,f={layer:b,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:c,signal:e},[4,S.all([null!=
a.statistics?a.statistics:L(f),a.outlineOptimizationEnabled?T({layer:b,view:c,signal:e}):null,a.sizeOptimizationEnabled?U({layer:b,view:c,signal:e}):null])];case 2:return g=m.sent(),h=g[0],k=g[1],l=g[2],[2,aa(h,a,k,l)]}})})};w.createPCClassRenderer=function(d){return m(this,void 0,void 0,function(){var a,b,c,e,f,g;return q(this,function(h){switch(h.label){case 0:return[4,X(d)];case 1:a=h.sent();if(null==a.statistics)return[3,2];c=a.statistics;return[3,4];case 2:return[4,L({layer:a.layer,field:a.field,
signal:a.signal})];case 3:c=h.sent(),h.label=4;case 4:return b=c,f=y.PointCloudUniqueValueRenderer.bind,g={field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:l.getPointSizeAlgorithm(a.size)},[4,ba(b,a.typeScheme)];case 5:return e=new (f.apply(y.PointCloudUniqueValueRenderer,[void 0,(g.colorUniqueValueInfos=h.sent(),g)])),[2,{renderer:e}]}})})}});