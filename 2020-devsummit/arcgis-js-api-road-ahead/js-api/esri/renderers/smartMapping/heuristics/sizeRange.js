// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/restHelper ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/screenUtils ../../../geometry/support/scaleUtils ./scaleRange ../support/utils ../../visualVariables/SizeVariable".split(" "),function(K,L,n,q,u,v,w,k,x,e,y,z,r,m){function A(a){return q(this,void 0,void 0,function(){var b,c,d,f,g,h,p,l;return n(this,
function(e){switch(e.label){case 0:b=a.view;if(!(a&&b&&a.layer))throw new k("size-range:missing-parameters","'view' and 'layer' parameters are required");c=[0,2,3,1];d=a.layer;f=v(a,["layer"]);g=r.createLayerAdapter(d,c);h=u({layerAdapter:g},f);if(!g)throw new k("size-range:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));return[4,b.when()];case 1:return e.sent(),p=x.isSome(h.signal)?{signal:h.signal}:null,[4,g.load(p)];case 2:e.sent();l=g.geometryType;
if("point"!==l&&"multipoint"!==l&&"polyline"!==l&&"polygon"!==l)throw new k("size-range:not-supported","sizeRange is not supported for geometryType: "+l);return[2,h]}})})}function t(a,b){a=a.view;var c=b.minScale||1E8;b=a.constraints&&"effectiveLODs"in a.constraints&&a.constraints.effectiveLODs||B;a=[];for(var d in b)if(!(b[d].scale>c)){c=Number(d);d=0;for(c=[c-3,c,c+3,c+6];d<c.length;d++){var f=c[d];-1<f&&f<b.length&&a.push(b[f].scale)}break}return a.sort(function(a,c){return a-c})}function C(a,
b){var c=a.view,d=a.layerAdapter,f=d.fullExtent;a=d.minScale||1128.497176;var d=d.maxScale||5.91657527591555E8,g=b.minScale||0;b=b.maxScale||0;c=f?y.getScale(c,f):0;c=c<a&&c>d?c:0;return{scales:[a,d,g,b,c].map(Math.round).sort(function(a,c){return a-c}).filter(function(a,c,b){return!!a&&b.indexOf(a)===c}).filter(function(a,c,b){return c?5<Math.abs(a-b[c-1]):!0}),fullExtentScale:c}}function D(a,b){a=t(a,{minScale:b.minScale,maxScale:b.maxScale});if(!a.length)throw new k("scale-range:insufficient-info",
"not enough scale values");return{minSize:new m({valueExpression:"$view.scale",stops:a.map(function(a,b){return{value:a,size:e.px2pt(E[b])}})}),maxSize:new m({valueExpression:"$view.scale",stops:a.map(function(a,b){return{value:a,size:e.px2pt(F[b])}})})}}function G(a,b){a=t(a,{minScale:b.minScale,maxScale:b.maxScale});if(!a.length)throw new k("scale-range:insufficient-info","not enough scale values");return{minSize:new m({valueExpression:"$view.scale",stops:a.map(function(a,b){return{value:a,size:e.px2pt(H[b])}})}),
maxSize:new m({valueExpression:"$view.scale",stops:a.map(function(a,b){return{value:a,size:e.px2pt(I[b])}})})}}function J(a,b){var c=b.spatialStatistics,d=b.minScale;b=b.maxScale;if(!("avgSize"in c&&c.avgSize))throw new k("size-range:insufficient-info","average polygon size is invalid");var f=c.avgSize,c=a.view,g=c.resolution/c.scale;a=C(a,{minScale:d,maxScale:b});var h=a.scales,p=a.fullExtentScale,l=[],n=[];h.forEach(function(a,b){var c;c=Math.ceil(Math.ceil(f/(g*a))/4);4>c?c=4:16<c&&(c=16);var d=
5*c,d=50>d?50:d,k=h.indexOf(p);b=-1<k&&b>k?2:1;l.push({value:a,size:e.px2pt(c/b)});n.push({value:a,size:e.px2pt(d/b)})});a=new m({valueExpression:"$view.scale",stops:l});d=new m({valueExpression:"$view.scale",stops:n});return{minSize:a,maxSize:d}}var E=[10,8,4,2],F=[100,100,60,30],H=[2,1,.75,.5],I=[32,18,12,6],B=[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8},{level:1,resolution:78271.51696399994,scale:2.95828763795777E8},{level:2,resolution:39135.75848200009,scale:1.47914381897889E8},
{level:3,resolution:19567.87924099992,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,
scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];return function(a){return q(this,
void 0,void 0,function(){var b,c,d,f,g,h;return n(this,function(e){switch(e.label){case 0:return[4,A(a)];case 1:return b=e.sent(),c=b.view,d=b.layerAdapter,f=b.signal,[4,z({layer:d,view:c,signal:f})];case 2:g=e.sent();h=d.geometryType;switch(h){case "point":case "multipoint":return[2,D(b,g)];case "polyline":return[2,G(b,g)];case "polygon":return[2,J(b,g)];case "mesh":case "multipatch":break;default:w.neverReached(h)}return[2,null]}})})}});