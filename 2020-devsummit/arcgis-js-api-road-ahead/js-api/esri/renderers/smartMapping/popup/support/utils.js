// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports dojo/i18n!../../../nls/smartMapping ../../../../core/arrayUtils ../../../../intl/substitute ../../../../layers/support/fieldUtils ../../../../popup/content ../../../../popup/ExpressionInfo ../../../../popup/FieldInfo ../../../support/utils ../../../visualVariables/support/visualVariableUtils".split(" "),function(B,b,p,l,q,w,r,x,t,y,z){function u(a){return"hasVisualVariables"in a&&a.hasVisualVariables()?a.visualVariables.filter(function(a){return z.viewScaleRE.test(a.valueExpression)||
"target"in a&&"outline"===a.target?!1:!0}):[]}function v(a,e){var g=null;"popupTemplate"in a&&a.popupTemplate&&(g=a.popupTemplate.fieldInfos);var f=a.getField(e.field),h=null;g&&g.some(function(a){return a&&a.fieldName.toLowerCase()===f.name.toLowerCase()?(h=a.clone(),!0):!1});h||(a=-1<w.numericTypes.indexOf(f.type),h=new t({fieldName:f.name,isEditable:f.editable,visible:!0,format:a?{places:2,digitSeparator:!0}:null}));h.label||(h.label=f.alias);return h}function m(a){var e=a.expression,g=a.title;
a=a.returnType;return new x({name:"expr"+A++,expression:e,title:g,returnType:a})}function n(a){return new t({fieldName:"expression/"+a.name,visible:!0,format:"number"===a.returnType?{places:2,digitSeparator:!0}:null})}Object.defineProperty(b,"__esModule",{value:!0});var A=0;b.getPrimaryVisualVariables=u;b.getFieldInfo=v;b.getExpressionInfo=m;b.getFieldInfoFromExpressionInfo=n;b.getFieldAndExpressionInfos=function(a){var e=a.layer,g=a.normFieldExpressionTemplate,f=[],h=[],b=0;for(a=y.getAttributes(a.renderer,
u);b<a.length;b++){var d=a[b];if("field"===d.type)f.push(v(e,d));else if("normalized-field"===d.type){var c=e.getField(d.field),k=e.getField(d.normalizationField),d='\n      $feature["'+c.name+'"];\n      $feature["'+k.name+'"];\n      '+("percentage"===g?'($feature["'+c.name+'"] / $feature["'+k.name+'"]) * 100;':'$feature["'+c.name+'"] / $feature["'+k.name+'"];')+"\n      ",c="percentage"===g?q.substitute(p.normFieldLabelAsPercent,{expression1:c.alias,expression2:k.alias}):q.substitute(p.normFieldLabel,
{expression1:c.alias,expression2:k.alias}),c=m({type:"expression",expression:d,title:c,returnType:"number"});f.push(n(c));h.push(c)}else"expression"===d.type&&(c=m(d),f.push(n(c)),h.push(c))}return{fieldInfos:l.unique(f,function(a,c){return a.fieldName===c.fieldName}),expressionInfos:l.unique(h,function(a,c){return a.expression===c.expression})}};b.getContentFromFieldInfos=function(a,e){var g=e.fieldInfos,f=e.expressionInfos;if(2<g.length)return[new r.FieldsContent({fieldInfos:g})];var h=[];e=function(d){var c=
d.fieldName;d=d.label;if(!d){var b=a.getField(c);if(b)d=b.alias||c;else if(f){var e=c.split("expression/")[1];(b=f[l.findIndex(f,function(a){return a.name===e})])&&(d=b.title||b.name)}}h.push(new r.TextContent({text:"The value of \x3cb\x3e"+d+"\x3c/b\x3e is \x3cb\x3e{"+c+"}\x3c/b\x3e."}))};for(var b=0;b<g.length;b++)e(g[b]);return h};b.hasNormalizedField=function(a){return"normalizationField"in a&&a.normalizationField?!0:"hasVisualVariables"in a&&a.hasVisualVariables()&&a.visualVariables.some(function(a){return!!("normalizationField"in
a&&a.normalizationField)})}});