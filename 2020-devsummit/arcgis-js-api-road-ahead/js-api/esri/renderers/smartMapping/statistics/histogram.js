// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/restHelper ../../../core/Error ../../../core/maybe ../../../layers/support/fieldUtils ./support/utils ../support/utils".split(" "),function(D,E,z,p,e,q,c,A,r,t,g){function B(b){return e(this,void 0,void 0,function(){var k,u,f,d,a,e,v,l,h,m,w,x,y;return p(this,function(n){switch(n.label){case 0:if(!(b&&b.layer&&(b.field||b.valueExpression||
b.sqlExpression)))throw new c("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(b.valueExpression&&!b.sqlExpression&&!b.view)throw new c("histogram:missing-parameters","View is required when 'valueExpression' is specified");k=[0,2,1,3,4];u=b.layer;f=q(b,["layer"]);d=g.createLayerAdapter(u,k);a=z({layerAdapter:d},f);a.normalizationType=g.getNormalizationType(a);if(!d)throw new c("histogram:invalid-parameters","'layer' must be one of these types: "+
g.getLayerTypeLabels(k).join(", "));e=A.isSome(a.signal)?{signal:a.signal}:null;return[4,d.load(e)];case 1:return n.sent(),v=a.valueExpression||a.sqlExpression,h=(l=a.field)?d.getField(l):null,m=!a.classificationMethod||"equal-interval"===a.classificationMethod,[4,g.getFieldsList({field:l,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:w=n.sent();if(x=t.verifyBasicFieldValidity(d,w,"histogram:invalid-parameters"))throw x;if(h){if(y=t.verifyFieldType(d,h,"histogram:invalid-parameters",
C))throw y;if(r.isDateField(h)){if(a.normalizationType)throw new c("histogram:invalid-parameters","Normalization is not allowed for date fields");if(!m)throw new c("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields");}}else if(v){if(a.normalizationType)throw new c("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!m)throw new c("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified");
}return[2,a]}})})}var C=["date"].concat(r.numericTypes);return function(b){return e(this,void 0,void 0,function(){var c,e,f;return p(this,function(d){switch(d.label){case 0:return[4,B(b)];case 1:return c=d.sent(),e=c.layerAdapter,f=q(c,["layerAdapter"]),[2,e.histogram(f)]}})})}});