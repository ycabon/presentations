// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/restHelper ../../../core/Error ../../../core/maybe ../../../layers/support/fieldUtils ./support/utils ../support/utils".split(" "),function(D,E,z,n,d,p,e,A,q,r,g){function B(b){return d(this,void 0,void 0,function(){var f,t,u,c,a,d,k,l,v,h,w,x,y;return n(this,function(m){switch(m.label){case 0:if(!(b&&b.layer&&(b.field||b.valueExpression||
b.sqlExpression)))throw new e("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(b.valueExpression&&!b.sqlExpression&&!b.view)throw new e("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");f=[0,2,1,3,4];t=b.layer;u=p(b,["layer"]);c=g.createLayerAdapter(t,f);a=z({layerAdapter:c},u);a.normalizationType=g.getNormalizationType(a);if(!c)throw new e("summary-statistics:invalid-parameters",
"'layer' must be one of these types: "+g.getLayerTypeLabels(f).join(", "));d=A.isSome(a.signal)?{signal:a.signal}:null;return[4,c.load(d)];case 1:return m.sent(),k=a.field,l=a.normalizationType,v=a.valueExpression||a.sqlExpression,h=k?c.getField(k):null,[4,g.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 2:w=m.sent();if(x=r.verifyBasicFieldValidity(c,w,"summary-statistics:invalid-parameters"))throw x;if(h){if(y=r.verifyFieldType(c,h,
"summary-statistics:invalid-parameters",C))throw y;if(q.isDateField(h)&&l)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed for date fields");}else if(v&&l)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");return[2,a]}})})}var C=q.numericTypes.concat(["date"]);return function(b){return d(this,void 0,void 0,function(){var f,d,e;return n(this,function(c){switch(c.label){case 0:return[4,
B(b)];case 1:return f=c.sent(),d=f.layerAdapter,e=p(f,["layerAdapter"]),[2,d.summaryStatistics(e)]}})})}});