// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/global","../../core/mathUtils"],function(z,h,r,t){function l(b,a,c,e,d){b=new Uint32Array(b*b);a="buffer"in a?a:new Float64Array(a);c="buffer"in c?new Uint32Array(c.buffer):new Uint32Array((new Uint8Array(c)).buffer);d=c.length/(d-e);for(var f=0;f<a.length;f++)b[f]=c[t.clamp(Math.floor((a[f]-e)*d),0,c.length-1)];return b.buffer}function v(b){for(var a=Math.round(3*b),c=2*b*b,e=new Float64Array(2*a+1),d=0;d<=e.length;d++)e[d]=Math.exp(-Math.pow(d-a,2)/c)/Math.sqrt(2*
Math.PI)*(b/2);return e}function w(b,a){return"function"===typeof b?b:b?"string"===typeof a?function(a){return-1*+a[b]}:function(c){return+c[b]+a}:function(){return 1}}Object.defineProperty(h,"__esModule",{value:!0});h.generateGradient=function(){if(!("document"in r))return function(){return null};var b=document.createElement("canvas"),a=b.getContext("2d");b.height=512;b.width=1;return function(c){a.clearRect(0,0,1,b.height);var e=a.createLinearGradient(0,0,0,b.height),d=0;for(c=c.colorStops;d<c.length;d++){var f=
c[d],g=f.color;e.addColorStop(Math.max(f.ratio,.001),"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")")}a.fillStyle=e;a.fillRect(0,0,1,b.height);return a.getImageData(0,0,1,b.height).data}}();h.calculateHeatmapIntensityInfo=function(b,a,c,e){var d=a.blurRadius,f=a.fieldOffset,g=a.field;a=new Float64Array(c*e);for(var h=v(d),d=Math.round(3*d),u=Number.NEGATIVE_INFINITY,m,f=w(g,f),g=0;g<b.length;g++){var q=b[g],k=q.geometry,l=k.x-d,x=k.y-d,r=Math.max(0,l);m=Math.max(0,x);for(var t=Math.min(e,k.y+d),k=
Math.min(c,k.x+d),q=+f(q.attributes),n=m;n<t;n++)for(var y=h[n-x],p=r;p<k;p++)m=a[n*c+p]+=y*h[p-l]*q,m>u&&(u=m)}return{matrix:a.buffer,max:u}};h.drawHeatmap=function(b,a,c,e,d,f){b.canvas.width=b.canvas.height=a;b.clearRect(0,0,a,a);var g=b.getImageData(0,0,a,a);c&&e&&g.data.set(new Uint8ClampedArray(l(a,c,e,d,f)));b.putImageData(g,0,0)};h.createHeatmapImageData=l;h.createKernel=v;h.createValueFunction=w});