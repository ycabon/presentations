// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../core/arrayUtils ../../core/Logger ../../core/unitUtils ../../intl/date ./numberUtils ../visualVariables/support/ColorStop".split(" "),function(B,g,C,w,x,e,m,k,y){function u(a,d,c){var b="";0===d?b=p.lt+" ":d===c&&(b=p.gt+" ");return b+a}function q(a){var d=a.minValue,c=a.maxValue,b=a.isFirstBreak?"":p.gt+" ";a="percent-of-total"===a.normalizationType?p.pct:"";d=null==d?"":k.format(d);c=null==c?"":k.format(c);return b+d+a+" "+p.ld+" "+
c+a}function r(a,d){return"normalizationField"in a&&a.normalizationField?{type:"normalized-field",field:a.field,normalizationField:a.normalizationField}:"field"in a&&a.field?{type:"field",field:a.field}:"valueExpression"in a&&a.valueExpression?{type:"expression",expression:a.valueExpression,title:a.valueExpressionTitle,returnType:d}:null}Object.defineProperty(g,"__esModule",{value:!0});var v=x.getLogger("esri.renderers.support.utils"),p={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},
z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},A={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};g.meterIn={inches:e.convertUnit(1,"meters","inches"),feet:e.convertUnit(1,"meters","feet"),"us-feet":e.convertUnit(1,"meters","us-feet"),yards:e.convertUnit(1,"meters","yards"),miles:e.convertUnit(1,"meters",
"miles"),"nautical-miles":e.convertUnit(1,"meters","nautical-miles"),millimeters:e.convertUnit(1,"meters","millimeters"),centimeters:e.convertUnit(1,"meters","centimeters"),decimeters:e.convertUnit(1,"meters","decimeters"),meters:e.convertUnit(1,"meters","meters"),kilometers:e.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/e.lengthToDegrees(1,"meters")};g.timelineDateFormatOptions=m.convertDateFormatToIntlOptions("short-date");g.createColorStops=function(a){var d=a.values,c=a.colors,b=a.labelIndexes,
t=a.isDate,f=a.dateFormatOptions;return d.map(function(a,e){var h=null;if(!b||-1<b.indexOf(e)){var n=void 0;(n=t?m.formatDate(a,f):k.format(a))&&(h=u(n,e,d.length-1))}return new y({value:a,color:c[e],label:h})})};g.updateColorStops=function(a){var d=a.stops,c=a.changes,b=a.isDate,t=a.dateFormatOptions,f=d.map(function(a){return a.value});a=[];for(var h=0;h<c.length;h++){var e=c[h];a.push(e.index);f[e.index]=e.value}var g=k.round(f,{indexes:a});d.forEach(function(a,c){a.value=f[c];if(null!=a.label){var h=
void 0,e=null;(h=b?m.formatDate(g[c],t):k.format(g[c]))&&(e=u(h,c,d.length-1));a.label=e}})};g.createClassBreakLabel=q;g.setLabelsForClassBreaks=function(a){var d=a.classBreakInfos,c=a.normalizationType,b=[];if(d&&d.length)if("standard-deviation"===a.classificationMethod)v.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");else if(a.round){b.push(d[0].minValue);for(a=0;a<d.length;a++)b.push(d[a].maxValue);b=k.round(b);d.forEach(function(a,
f){a.label=q({minValue:0===f?b[0]:b[f],maxValue:b[f+1],isFirstBreak:0===f,normalizationType:c})})}else d.forEach(function(a,b){a.label=q({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:c})})};g.updateClassBreak=function(a){if("standard-deviation"===a.classificationMethod)v.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.");else{var d=a.classBreaks,c=a.change,b=c.index,c=c.value,e=d.length,f=-1,h=-1;0===b?f=b:
b===e?h=b-1:(h=b-1,f=b);a=a.normalizationType;b=null;-1<f&&f<e&&(b=d[f],b.minValue=c,b.label=q({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===f,normalizationType:a}));-1<h&&h<e&&(b=d[h],b.maxValue=c,b.label=q({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===h,normalizationType:a}))}};g.calculateDateFormatInterval=function(a){a=a.map(function(a){return new Date(a)});for(var d=a.length,c=Infinity,b=null,e=0;e<d-1;e++){for(var f=a[e],h=[],g=Infinity,k=null,n=e+1;n<d;n++){var l=a[n],
l=f.getFullYear()!==l.getFullYear()&&"year"||f.getMonth()!==l.getMonth()&&"month"||f.getDate()!==l.getDate()&&"day"||f.getHours()!==l.getHours()&&"hour"||f.getMinutes()!==l.getMinutes()&&"minute"||f.getSeconds()!==l.getSeconds()&&"second"||"millisecond",m=z[l];m<g&&(g=m,k=l);h.push(l)}g<c&&(c=g,b=k)}return b};g.createUniqueValueLabel=function(a){var d=a.value,c=a.domain,b=a.fieldInfo;a=a.dateFormatInterval;var e=String(d);(c=c&&"codedValues"in c&&c.codedValues?c.getName(d):null)?e=c:"number"===typeof d&&
(e=b&&"date"===b.type?m.formatDate(d,a&&m.convertDateFormatToIntlOptions(A[a])):k.format(d));return e};g.getAttributes=function(a,d){var c=[];if("class-breaks"===a.type||"heatmap"===a.type)c.push(r(a,"number"));else if("unique-value"===a.type){var b=a.uniqueValueInfos[0],e=null;b&&b.value&&(b=typeof a.uniqueValueInfos[0].value,"string"===b||"number"===b)&&(e=b);c.push(r(a,e));[a.field2,a.field3].forEach(function(a){return a&&c.push({type:"field",field:a})})}else"dot-density"===a.type&&a.attributes.forEach(function(a){return c.push(r(a,
"number"))});(a=d?d(a):"visualVariables"in a?a.visualVariables:null)&&a.forEach(function(a){return c.push(r(a,"number"))});return w.unique(c.filter(Boolean),function(a,b){return"field"===a.type&&"field"===b.type?a.field===b.field:"normalized-field"===a.type&&"normalized-field"===b.type?a.field===b.field&&a.normalizationField===b.normalizationField:"expression"===a.type&&"expression"===b.type?a.expression===b.expression:!1})}});