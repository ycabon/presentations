// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Error ../../core/jsonMap ../../core/Logger ../../core/screenUtils ../../core/accessorSupport/decorators ./VisualVariable ./support/SizeStop ./support/SizeVariableLegendOptions ./support/sizeVariableUtils ./support/visualVariableUtils".split(" "),function(A,B,q,d,r,t,m,u,v,c,w,x,y,e,z){function n(c){if(null!=c){if("string"===typeof c||"number"===typeof c)return v.toPt(c);
if("size"===c.type){if(e.isSizeVariable(c))return c;c=r({},c);delete c.type;return new f(c)}}}function p(c,b,d){if("object"!==typeof c)return c;b=new f;b.read(c,d);return b}var g=u.getLogger("esri.renderers.visualVariables.SizeVariable"),h=new m.default({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),l=new m.default({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",
decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"}),f=function(f){function b(a){a=f.call(this,a)||this;a.axis=null;a.legendOptions=null;a.normalizationField=null;a.scaleBy=null;a.target=null;a.type="size";a.useSymbolValue=null;a.valueExpression=null;a.valueRepresentation=null;a.valueUnit=null;return a}q(b,f);k=b;Object.defineProperty(b.prototype,"cache",{get:function(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,
isScaleDriven:z.viewScaleRE.test(this.valueExpression)}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"expression",{set:function(a){g.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'.");"view.scale"===a?(this.valueExpression="$view.scale",this._set("expression",a)):this._set("expression",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"index",{set:function(a){e.isSizeVariable(this.maxSize)&&
(this.maxSize.index="visualVariables["+a+"].maxSize");e.isSizeVariable(this.minSize)&&(this.minSize.index="visualVariables["+a+"].minSize");this._set("index",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inputValueType",{get:function(){return e.getInputValueType(this)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxDataValue",{set:function(a){a&&this.stops&&(g.warn("cannot set maxDataValue when stops is not null."),a=null);this._set("maxDataValue",a)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxSize",{set:function(a){a&&this.stops&&(g.warn("cannot set maxSize when stops is not null."),a=null);this._set("maxSize",a)},enumerable:!0,configurable:!0});b.prototype.castMaxSize=function(a){return n(a)};b.prototype.readMaxSize=function(a,b,c){return p(a,b,c)};Object.defineProperty(b.prototype,"minDataValue",{set:function(a){a&&this.stops&&(g.warn("cannot set minDataValue when stops is not null."),a=null);this._set("minDataValue",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minSize",{set:function(a){a&&this.stops&&(g.warn("cannot set minSize when stops is not null."),a=null);this._set("minSize",a)},enumerable:!0,configurable:!0});b.prototype.castMinSize=function(a){return n(a)};b.prototype.readMinSize=function(a,b,c){return p(a,b,c)};Object.defineProperty(b.prototype,"arcadeRequired",{get:function(){return this.valueExpression?!0:this.minSize&&"object"===typeof this.minSize&&this.minSize.arcadeRequired||
this.maxSize&&"object"===typeof this.maxSize&&this.maxSize.arcadeRequired},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stops",{set:function(a){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?a&&Array.isArray(a)&&(a=a.filter(function(a){return!!a}),a.sort(function(a,b){return a.value-b.value})):a&&(g.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),a=null);this._set("stops",a)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"transformationType",{get:function(){return e.getTransformationType(this,this.inputValueType)},enumerable:!0,configurable:!0});b.prototype.readValueExpression=function(a,b){return a||b.expression&&"$view.scale"};b.prototype.writeValueExpressionWebScene=function(a,b,c,d){"$view.scale"===a?d&&d.messages&&(a=this.index,d.messages.push(new t("property:unsupported",this.type+"VisualVariable.valueExpression \x3d '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",
{instance:this,propertyName:("string"===typeof a?a:"visualVariables["+a+"]")+".valueExpression",context:d}))):b[c]=a};b.prototype.readValueUnit=function(a){return a?l.read(a):null};b.prototype.clone=function(){return new k({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:e.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:e.isSizeVariable(this.minSize)?
this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(function(a){return a.clone()}),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})};b.prototype.flipSizes=function(){if("clamped-linear"===this.transformationType){var a=this.minSize;this.minSize=this.maxSize;this.maxSize=a;return this}if("stops"===this.transformationType)for(var a=
this.stops,b=a.map(function(a){return a.size}).reverse(),c=a.length,d=0;d<c;d++)a[d].size=b[d];return this};b.prototype.getAttributeHash=function(){return this.inherited(arguments)+"-"+this.target+"-"+this.normalizationField};b.prototype._interpolateData=function(){return this.stops&&this.stops.map(function(a){return a.value||0})};var k;d([c.property({readOnly:!0,dependsOn:["valueExpression","stops"]})],b.prototype,"cache",null);d([c.property({type:h.apiValues,json:{type:h.jsonValues,origins:{"web-map":{read:!1}},
read:h.read,write:h.write}})],b.prototype,"axis",void 0);d([c.property({type:String,value:null,json:{read:!1}})],b.prototype,"expression",null);d([c.property()],b.prototype,"index",null);d([c.property({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],b.prototype,"inputValueType",null);d([c.property({type:y,json:{write:!0}})],b.prototype,"legendOptions",void 0);d([c.property({type:Number,value:null,json:{write:!0}})],b.prototype,"maxDataValue",null);d([c.property({type:Number,value:null,
json:{write:!0}})],b.prototype,"maxSize",null);d([c.cast("maxSize")],b.prototype,"castMaxSize",null);d([c.reader("maxSize")],b.prototype,"readMaxSize",null);d([c.property({type:Number,value:null,json:{write:!0}})],b.prototype,"minDataValue",null);d([c.property({type:Number,value:null,json:{write:!0}})],b.prototype,"minSize",null);d([c.cast("minSize")],b.prototype,"castMinSize",null);d([c.reader("minSize")],b.prototype,"readMinSize",null);d([c.property({type:String,json:{write:!0}})],b.prototype,"normalizationField",
void 0);d([c.property({readOnly:!0,dependsOn:["valueExpression","minSize.arcadeRequired","maxSize.arcadeRequired"]})],b.prototype,"arcadeRequired",null);d([c.property({type:String})],b.prototype,"scaleBy",void 0);d([c.property({type:[x],value:null,json:{write:!0}})],b.prototype,"stops",null);d([c.property({type:["outline"],json:{write:!0}})],b.prototype,"target",void 0);d([c.property({type:String,readOnly:!0,dependsOn:"minDataValue maxDataValue minSize maxSize valueUnit inputValueType stops".split(" ")})],
b.prototype,"transformationType",null);d([c.property({type:["size"],json:{type:["sizeInfo"]}})],b.prototype,"type",void 0);d([c.property({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],b.prototype,"useSymbolValue",void 0);d([c.property({type:String,json:{write:!0}})],b.prototype,"valueExpression",void 0);d([c.reader("valueExpression",["valueExpression","expression"])],b.prototype,"readValueExpression",null);d([c.writer("web-scene","valueExpression")],b.prototype,"writeValueExpressionWebScene",
null);d([c.property({type:["radius","diameter","area","width","distance"],json:{write:!0}})],b.prototype,"valueRepresentation",void 0);d([c.property({type:l.apiValues,json:{write:l.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],b.prototype,"valueUnit",void 0);d([c.reader("valueUnit")],b.prototype,"readValueUnit",null);return b=k=d([c.subclass("esri.renderers.visualVariables.SizeVariable")],b)}(c.declared(w));return f});