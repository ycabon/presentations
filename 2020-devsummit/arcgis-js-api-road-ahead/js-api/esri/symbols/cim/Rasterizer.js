// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(m,n,h,p,q){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function k(){}k.prototype.dispose=function(){this._rasterizationCanvas=null};k.prototype.rasterizeJSONResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return b=h.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[b[1],
b[2]],image:new Uint32Array(b[0].buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===a.type||"esriSLS"===a.type)return b=h.SymbolHelper.rasterizeSimpleLine(a.style,a.cap),{size:[b[1],b[2]],image:new Uint32Array(b[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var c;a="simple-marker"===a.type||"esriSMS"===a.type?h.CIMSymbolHelper.fromSimpleMarker(a):a;if((c=p.getSDFInfo(a))&&!b)return b=p.buildSDF(c),(a=b[0])?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0,
anchorX:0,anchorY:0}:null;b=h.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a,!b);a=b[0];c=b[3];var e=b[4];return a?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:c,anchorY:e}:null};k.prototype.rasterizeImageResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var c=this._rasterizationCanvas.getContext("2d");a instanceof
ImageData?c.putImageData(a,0,0):(a.setAttribute("width",a.width.toString()),a.setAttribute("height",a.height.toString()),c.drawImage(a,0,0,a.width,a.height));c=c.getImageData(0,0,a.width,a.height);c=new Uint8Array(c.data);if(b)for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var l=f.oldColor,g=l[0],h=l[1],k=l[2],l=l[3],d=f.newColor,f=d[0],m=d[1],n=d[2],p=d[3];if(g!==f||h!==m||k!==n||l!==p)for(d=0;d<c.length;d+=4)g===c[d]&&h===c[d+1]&&
k===c[d+2]&&l===c[d+3]&&(c[d]=f,c[d+1]=m,c[d+2]=n,c[d+3]=p)}}for(d=0;d<c.length;d+=4)b=c[d+3]/255,c[d]*=b,c[d+1]*=b,c[d+2]*=b;b=a.width;e=a.height;g=c;if(512<=b||512<=e)g=a.width/a.height,1<g?(b=512,e=Math.round(512/g)):(e=512,b=Math.round(512*g)),g=new Uint8Array(4*b*e),q.resampleHermite(c,a.width,a.height,new Uint8ClampedArray(g.buffer),b,e,!1);return{size:[b,e],image:new Uint32Array(g.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return k}();n.default=m});