// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(G,v,D,E,F){function A(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return A(a[0]);case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)break;var b=a[0];if(!b)break;a=b.geometry;if(!a)break;b=b.symbol;if(!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==b.type)break;return{geom:a,asFill:"CIMPolygonSymbol"===b.type};case "sdf":return{geom:a.geom,
asFill:a.asFill}}return null}function C(a){for(var b=Infinity,c=-Infinity,g=Infinity,t=-Infinity,e=0;e<a.length;e++)for(var p=0,f=a[e];p<f.length;p++){var k=f[p];k[0]<b&&(b=k[0]);k[0]>c&&(c=k[0]);k[1]<g&&(g=k[1]);k[1]>t&&(t=k[1])}return[b,g,c,t]}Object.defineProperty(v,"__esModule",{value:!0});v.getSDFInfo=A;v.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};v.getExtent=
function(a){return a?a.rings?C(a.rings):a.paths?C(a.paths):D.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};v.getSDFMetrics=function(a,b,c,g,t){var e=a[0],p=a[1],f=a[2];a=a[3];if(f<e||a<p)return[0,0,0];var k=f-e,d=a-p,f=Math.floor(31.5);a=(128-2*(f+1))/Math.max(k,d);var k=Math.round(k*a),d=Math.round(d*a)+2*f,l=1;b&&(l=d/a/(b.ymax-b.ymin));var m=0,h=0;g&&(t?b&&c&&0<b.ymax-b.ymin&&(m=g.x/((b.xmax-b.xmin)/(b.ymax-b.ymin)*c),h=g.y/c):(m=g.x,h=g.y));m=.5*(b.xmax+b.xmin)+m*(b.xmax-b.xmin);h=.5*(b.ymax+
b.ymin)+h*(b.ymax-b.ymin);m=(m-e)*a+f;h=(h-p)*a+f;return[l,m/(k+2*f)-.5,-(h/d-.5)]};v.buildSDF=function(a){var b,c=a.geom;b=c?c.rings?c.rings:c.paths?c.paths:void 0!==c.xmin&&void 0!==c.ymin&&void 0!==c.xmax&&void 0!==c.ymax?[[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]:null:null;var g,c=Infinity,t=-Infinity,e=Infinity,p=-Infinity;for(g=0;g<b.length;g++)for(var f=0,k=b[g];f<k.length;f++){var d=k[f];d[0]<c&&(c=d[0]);d[0]>t&&(t=d[0]);d[1]<e&&(e=d[1]);d[1]>p&&(p=
d[1])}g=new F.default(c,e,t-c,p-e);e=Math.floor(31.5);f=(128-2*(e+1))/Math.max(g.width,g.height);c=Math.round(g.width*f)+2*e;t=Math.round(g.height*f)+2*e;p=[];for(k=0;k<b.length;k++){var l=b[k];if(l&&1<l.length){for(var d=[],m=0;m<l.length;m++){var h=l[m],n=h[0],h=h[1],n=n-g.x,h=h-g.y,n=n*f,h=h*f,n=n+(e-.5),h=h+(e-.5);d.push([n,h])}a.asFill&&(m=d.length-1,d[0][0]===d[m][0]&&d[0][1]===d[m][1]||d.push(d[0]));p.push(d)}}g=c*t;b=Array(g);k=e*e+1;for(f=0;f<g;++f)b[f]=k;for(k=0;k<p.length;k++)for(d=p[k],
m=d.length,f=1;f<m;++f){var l=d[f-1],n=d[f],r=void 0,h=void 0;l[0]<n[0]?(r=l[0],h=n[0]):(r=n[0],h=l[0]);var q=void 0,u=void 0;l[1]<n[1]?(q=l[1],u=n[1]):(q=n[1],u=l[1]);var w=Math.floor(r)-e,h=Math.floor(h)+e,q=Math.floor(q)-e,u=Math.floor(u)+e;0>w&&(w=0);h>c&&(h=c);0>q&&(q=0);u>t&&(u=t);for(var r=n[0]-l[0],v=n[1]-l[1],A=r*r+v*v;w<h;w++)for(var z=q;z<u;z++){var x=(w-l[0])*r+(z-l[1])*v,y=void 0,B=void 0;0>x?(y=l[0],B=l[1]):x>A?(y=n[0],B=n[1]):(x/=A,y=l[0]+x*r,B=l[1]+x*v);x=(w-y)*(w-y)+(z-B)*(z-B);y=
(t-z-1)*c+w;x<b[y]&&(b[y]=x)}}for(f=0;f<g;++f)b[f]=Math.sqrt(b[f]);if(a.asFill)for(a=0;a<p.length;a++)for(g=p[a],f=g.length,k=1;k<f;++k)for(d=g[k-1],m=g[k],n=l=void 0,d[0]<m[0]?(l=d[0],n=m[0]):(l=m[0],n=d[0]),h=q=void 0,d[1]<m[1]?(q=d[1],h=m[1]):(q=m[1],h=d[1]),l=Math.floor(l),n=Math.floor(n)+1,q=Math.floor(q),h=Math.floor(h)+1,l<e&&(l=e),n>c-e&&(n=c-e),q<e&&(q=e),h>t-e&&(h=t-e);q<h;++q)if(d[1]>q!==m[1]>q){u=(t-q-1)*c;for(r=l;r<n;++r)r<(m[0]-d[0])*(q-d[1])/(m[1]-d[1])+d[0]&&(b[u+r]=-b[u+r]);for(r=
e;r<l;++r)b[u+r]=-b[u+r]}e*=2;p=b.length;a=new Uint8Array(4*p);for(g=0;g<p;++g)E.packFloatRGBA(.5-b[g]/e,a,4*g);return[a,c,t]}});