// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/assignHelper ../../request ../../core/Logger ../../core/promiseUtils ../cim/cimAnalyzer".split(" "),function(z,f,g,h,q,r,t,u,v){function l(a,c){return g(this,void 0,void 0,function(){var b,d;return h(this,function(e){switch(e.label){case 0:if(a.data||!a.styleUrl||!a.styleName)return[2,a];b=a.styleName;d=a;return[4,w(b,a.styleUrl,c)];case 1:return d.data=e.sent(),[2,a]}})})}function w(a,
c,b){return g(this,void 0,void 0,function(){var d,e;return h(this,function(g){if(k.has(a))return[2,k.get(a).then(function(a){return f.makeSymbolRef(a.data)})];try{return d=c+"/resources/styles/cim/"+a+".json",e=r(d,q({responseType:"json",query:{f:"json"}},b)),k.set(a,e),[2,e.then(function(a){return f.makeSymbolRef(a.data)})]}catch(x){return y.error("error requesting "+a+", reason is "+x.message),k.has(a)&&k.delete(a),[2,null]}})})}var m=this;Object.defineProperty(f,"__esModule",{value:!0});var y=
t.getLogger("esri/symbols/support/cimSymbolUtils"),n=function(){function a(a,b){this.layers=a;this.data=b}Object.defineProperty(a.prototype,"type",{get:function(){return"expanded-cim"},enumerable:!0,configurable:!0});a.prototype.hash=function(){for(var a="",b=0,d=this.layers;b<d.length;b++)a+=d[b].templateHash;return a};return a}();f.expandSymbols=function(a,c,b,d){return g(m,void 0,void 0,function(){return h(this,function(e){return[2,u.all(a.map(function(a){return f.expandSymbol(a,c,b,d)}))]})})};
var p=function(a,c,b){return g(m,void 0,void 0,function(){var d;return h(this,function(e){switch(e.label){case 0:return d=n.bind,[4,v.analyzeCIMSymbol(a.data,c&&"dictionary"===c.type?c.fieldMap:null,b)];case 1:return[2,new (d.apply(n,[void 0,e.sent(),a.data]))]}})})};f.expandSymbol=function(a,c,b,d){return g(m,void 0,void 0,function(){var e,f;return h(this,function(g){switch(g.label){case 0:if(!a)return[2,null];if("cim"!==a.type)return[3,2];e=p;return[4,l(a,d)];case 1:return[2,e.apply(void 0,[g.sent(),
c,b])];case 2:if("web-style"!==a.type)return[3,4];f=p;return[4,a.fetchCIMSymbol(d)];case 3:return[2,f.apply(void 0,[g.sent(),c,b])];case 4:return[2,a]}})})};f.fetchSymbol=function(a,c){return g(this,void 0,void 0,function(){return h(this,function(b){return a?"cim"===a.type?[2,l(a,c)]:"web-style"===a.type?[2,a.fetchCIMSymbol(c)]:[2,a]:[2,null]})})};f.fetchCIMData=l;f.makeSymbolRef=function(a,c){return null===a?null:"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a,primitiveOverrides:c}};
var k=new Map});