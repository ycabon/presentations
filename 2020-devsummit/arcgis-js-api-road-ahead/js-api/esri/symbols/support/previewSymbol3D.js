// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../core/colorUtils ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(N,B,F,G,H,I,O,t,v,u,P,Q,R,p,z,S,J){function y(b){var a=b.outline,c=t.isSome(b.material)?b.material.color:null,c=t.isSome(c)?c.toRgba().toString():null;if(t.isNone(a))return"fill"===
b.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;b=u.pt2px(a.size)||0;return{color:"rgba("+(t.isSome(a.color)?a.color.toRgba():"255,255,255,1")+")",width:Math.min(b,80)}}function T(b,a){var c=a&&a.resource,c=c&&c.href;return b.thumbnail&&b.thumbnail.url?v.resolve(b.thumbnail.url):c&&"object"!==a.type?v.resolve(J.getIconHref(b,a)):b.styleOrigin&&(b.styleOrigin.styleName||b.styleOrigin.styleUrl)?S.resolveWebStyleSymbol(b.styleOrigin,{portal:b.styleOrigin.portal},"webRef").catch(function(a){return a}).then(function(a){return a&&
a.thumbnail&&a.thumbnail.url||K}):v.resolve(K)}function C(b,a){void 0===a&&(a=1);var c=b.a;b=G.toHSV(b);a=G.toRGB({h:b.h,s:b.s/a,v:100-(100-b.v)/a});return[a.r,a.g,a.b,c]}function w(b,a){return Math.round(Math.min(Math.max(b+191.25*a,0),255))}function D(b){return"water"===b.type?t.isNone(b.color)?null:b.color:t.isNone(b.material)||t.isNone(b.material.color)?null:b.material.color}function f(b,a){void 0===a&&(a=0);b=D(b);if(!b)return a=w(P.defaultThematicColor.r,a),[a,a,a,100];b=b.toRgba();for(var c=
0;3>c;c++)b[c]=w(b[c],a);return b}function L(b){return b.outline?y(b):{color:"rgba(0, 0, 0, 1)",width:1.5}}function M(b,a){b=D(b);if(!b)return null;var c;c="rgba("+(w(b.r,a)+",");c+=w(b.g,a)+",";c+=w(b.b,a)+",";return c+b.a+");"}function E(b,a){a=M(b,a);if(!a)return{};b=Math.min(b.size?u.pt2px(b.size):.75,80);return{color:a,width:b}}function A(b,a,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:b,offset:0},{color:a,offset:1}]}}function U(b){var a=b.depth,
c=b.height;return(b=b.width)&&a&&c&&b===a&&b<c}function V(b,a,c){var d=[];if(!b)return d;switch(b.type){case "icon":var m=b.resource&&b.resource.primitive||Q.defaultPrimitive;switch(m){case "circle":d.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:f(b,0),stroke:y(b)});break;case "square":d.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:f(b,0),stroke:y(b)});break;case "triangle":d.push({shape:{type:"path",
path:[{command:"M",values:[0,a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:f(b,0),stroke:y(b)});break;case "cross":d.push({shape:{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[.5*a,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[a,.5*a]}]},stroke:L(b)});break;case "x":d.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,a]},{command:"M",values:[a,0]},{command:"L",values:[0,a]}]},stroke:L(b)});
break;case "kite":d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*a]},{command:"L",values:[.5*a,a]},{command:"Z",values:[]}]},fill:f(b,0),stroke:y(b)});break;default:H.neverReached(m)}break;case "object":switch(m=b.resource&&b.resource.primitive||R.defaultPrimitive,m){case "cone":m=f(b,0);b=f(b,-.6);b=A(m,b,c?20:a);a=p.getConeShapes(a,c);d.push({shape:a[0],fill:b});d.push({shape:a[1],fill:b});break;case "inverted-cone":c=f(b,0);
b=f(b,-.6);b=A(c,b,a);a=p.getInvertedConeShapes(a);d.push({shape:a[0],fill:b});d.push({shape:a[1],fill:c});break;case "cube":a=p.getCubeShapes(a,c);d.push({shape:a[0],fill:f(b,0)});d.push({shape:a[1],fill:f(b,-.3)});d.push({shape:a[2],fill:f(b,-.5)});break;case "cylinder":var m=f(b,0),W=f(b,-.6),m=A(m,W,c?20:a);a=p.getCylinderShapes(a,c);d.push({shape:a[0],fill:m});d.push({shape:a[1],fill:m});d.push({shape:a[2],fill:f(b,0)});break;case "diamond":a=p.getDiamondShapes(a);d.push({shape:a[0],fill:f(b,
-.3)});d.push({shape:a[1],fill:f(b,0)});d.push({shape:a[2],fill:f(b,-.3)});d.push({shape:a[3],fill:f(b,-.7)});break;case "sphere":c=f(b,0);b=f(b,-.6);b=A(c,b);b.x1=0;b.y1=0;b.x2=.25*a;b.y2=.25*a;d.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:b});break;case "tetrahedron":a=p.getTetrahedronShapes(a);d.push({shape:a[0],fill:f(b,-.3)});d.push({shape:a[1],fill:f(b,0)});d.push({shape:a[2],fill:f(b,-.6)});break;default:H.neverReached(m)}}return d}function X(b,a){var c=a&&a.size?u.pt2px(a.size):null,
d=a&&a.maxSize?u.pt2px(a.maxSize):null,f=a&&a.disableUpsampling,p=b.symbolLayers,n=[],l=0,q=0,r=p.getItemAt(p.length-1),h;r&&"icon"===r.type&&(h=r.size&&u.pt2px(r.size));p.forEach(function(k){if("icon"===k.type||"object"===k.type){var e="icon"===k.type?k.size&&u.pt2px(k.size):0,r=c||e?Math.ceil(Math.min(c||e,d||120)):22;if(k&&k.resource&&k.resource.href){var g=T(b,k).then(function(a){var b=k.get("material.color"),c;c="icon"===k.type?"multiply":"tint";return z.tintImageWithColor(a,r,b,c,f)}).then(function(a){var b=
a.width,c=a.height;l=Math.max(l,b);q=Math.max(q,c);return[{shape:{type:"image",x:0,y:0,width:b,height:c,src:a.url},fill:null,stroke:null}]});n.push(g)}else g=r,"icon"===k.type&&h&&c&&(g=e/h*r),e=a&&"tall"===a.symbolConfig||("object"===k.type?U(k):!1),l=Math.max(l,e?20:g),q=Math.max(q,g),n.push(v.resolve(V(k,g,e)))}});return v.eachAlways(n).then(function(b){var c=[];b.forEach(function(a){a.value?c.push(a.value):a.error&&Y.warn("error while building swatchInfo!",a.error)});return z.renderSymbol(c,[l,
q],{node:a&&a.node,scale:!1,opacity:a&&a.opacity})})}function Z(b,a){var c=b.symbolLayers,d=[];b=J.isVolumetricSymbol(b);var m=a&&a.size?u.pt2px(a.size):null,t=(a&&a.maxSize?u.pt2px(a.maxSize):null)||80,n=0,l=0,q;c.forEach(function(a,b){if(a&&("line"===a.type||"path"===a.type)){var c=[];switch(a.type){case "line":var e=E(a,0),h=e&&e.width||0;0===b&&(q=h);var g=Math.min(m||h,t);b=0===b?g:m?h/q*g:g;l=Math.max(l,b);n=Math.max(n,20<b?2*b:40);e.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,
.5*l]},{command:"L",values:[n,.5*l]}]},stroke:e});break;case "path":b=Math.min(m||22,t);h=f(a,0);g=f(a,-.2);e=(e=M(a,-.4))?{color:e,width:1}:{};if("quad"===a.profile){var r=a.width||a.size;a=a.height||a.size;a=p.getPathSymbolShapes(r&&a?r/a:1);e=F({},e,{join:"bevel"});c.push({shape:a[0],fill:g,stroke:e});c.push({shape:a[1],fill:g,stroke:e});c.push({shape:a[2],fill:h,stroke:e})}else c.push({shape:p.shapes.pathSymbol3DLayer[0],fill:g,stroke:e}),c.push({shape:p.shapes.pathSymbol3DLayer[1],fill:h,stroke:e});
n=l=Math.max(l,b)}d.push(c)}});return v.resolve(z.renderSymbol(d,[n,l],{node:a&&a.node,scale:b,opacity:a&&a.opacity}))}Object.defineProperty(B,"__esModule",{value:!0});var K=N.toUrl("../../images/Legend/legend3dsymboldefault.png"),Y=O.getLogger("esri.symbols.support.previewSymbol3D");B.getSymbolLayerFill=f;B.previewSymbol3D=function(b,a){if(0===b.symbolLayers.length)return v.reject(new I("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var c=null;switch(b.type){case "point-3d":c=
X(b,a);break;case "line-3d":c=Z(b,a);break;case "polygon-3d":case "mesh-3d":c="mesh-3d"===b.type;b=b.symbolLayers;for(var d=a&&a.size?u.pt2px(a.size):null,m=a&&a.maxSize?u.pt2px(a.maxSize):null,d=d||22,t=[],n=0,l=0,q=!1,r=0;r<b.length;r++){var h=b.getItemAt(r),k=[];if(!c||"fill"===h.type){var e=p.shapes.fill[0];switch(h.type){case "fill":var x=y(h),g=Math.min(d,m||120),n=Math.max(n,g),l=Math.max(l,g),q=!0;k.push({shape:e,fill:f(h,0),stroke:x});break;case "line":e={stroke:E(h,0),shape:e};n=Math.max(n,
22);l=Math.max(l,22);k.push(e);break;case "extrude":var x=F({join:"round"},E(h,-.4)),e=f(h,0),h=f(h,-.2),g=Math.min(d,m||120),w=p.getExtrudeSymbolShapes(g);x.width=1;k.push({shape:w[0],fill:h,stroke:x});k.push({shape:w[1],fill:h,stroke:x});k.push({shape:w[2],fill:e,stroke:x});e=22*.7+.5*g;n=Math.max(n,22);l=Math.max(l,e);break;case "water":q=D(h),e=C(q),h=C(q,2),x=C(q,3),g=p.getWaterSymbolShapes(),q=!0,k.push({shape:g[0],fill:e}),k.push({shape:g[1],fill:h}),k.push({shape:g[2],fill:x}),g=Math.min(d,
m||120),n=Math.max(n,g),l=Math.max(l,g)}t.push(k)}}c=v.resolve(z.renderSymbol(t,[n,l],{node:a&&a.node,scale:q,opacity:a&&a.opacity}))}return c?c:v.reject(new I("symbolPreview: swatchInfo3D","symbol not supported."))}});