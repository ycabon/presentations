// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../request ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../portal/Portal ../../portal/PortalQueryParams ../../support/featureFlags ./jsonUtils ./StyleOrigin ./Thumbnail".split(" "),function(M,c,A,B,C,p,l,q,g,D,E,F,t,u,v){function G(a,b){return r(a,b).then(function(b){return{data:b.data,baseUrl:g.removeFile(a),styleUrl:a}})}function H(a,b,e){b=b.portal||D.getDefault();var d,
n=b.url+" - "+(b.user&&b.user.username)+" - "+a;f[n]||(f[n]=I(a,b,e).then(function(a){d=a;return a.fetchData()}).then(function(b){return{data:b,baseUrl:d.itemUrl,styleName:a}}));return f[n]}function I(a,b,e){return b.load(e).then(function(){var d=new E({disableExtraQuery:!0,query:"owner:"+k+" AND type:"+w+' AND typekeywords:"'+a+'"'});return b.queryItems(d,e)}).then(function(b){b=b.results;var d=null,g=a.toLowerCase();if(b&&Array.isArray(b))for(var m=0;m<b.length;m++){var h=b[m];if(h.typeKeywords.some(function(a){return a.toLowerCase()===
g})&&h.type===w&&h.owner===k){d=h;break}}if(!d)throw new l("symbolstyleutils:style-not-found","The style '"+a+"' could not be found",{styleName:a});return d.load(e)})}function x(a,b,e){return a.styleUrl?G(a.styleUrl,e):a.styleName?H(a.styleName,b,e):q.reject(new l("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function y(a,b,e,d,n){for(var c=a.data,m={portal:e.portal,url:g.urlToObject(a.baseUrl),origin:"portal-item"},h=function(c){if(c.name!==
b)return"continue";var f=g.fromJSON(J(c,d),m),h=c.thumbnail&&c.thumbnail.href,k=c.thumbnail&&c.thumbnail.imageData;p.isDevEnvironment()&&(f=p.adjustStaticAGOUrl(f),h=p.adjustStaticAGOUrl(h));var l={portal:e.portal,url:g.urlToObject(g.removeFile(f)),origin:"portal-item"};return{value:r(f,n).then(function(c){c="cimRef"===d?z(c.data):c.data;if((c=t.fromJSON(c,l))&&C.isSymbol3D(c)){if(h){var f=g.fromJSON(h,m);c.thumbnail=new v.default({url:f})}else k&&(c.thumbnail=new v.default({url:"data:image/png;base64,"+
k}));a.styleUrl?c.styleOrigin=new u({portal:e.portal,styleUrl:a.styleUrl,name:b}):a.styleName&&(c.styleOrigin=new u({portal:e.portal,styleName:a.styleName,name:b}))}return c})}},f=0,c=c.items;f<c.length;f++){var k=h(c[f]);if("object"===typeof k)return k.value}return q.reject(new l("symbolstyleutils:symbol-name-not-found","The symbol name '"+b+"' could not be found",{symbolName:b}))}function z(a){return null===a||"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a}}function J(a,b){if("cimRef"===
b)return a.cimRef;if(a.formatInfos&&!F.enableWebStyleForceWOSR()){b=0;for(var c=a.formatInfos;b<c.length;b++){var d=c[b];if("gltf"===d.type)return d.href}}return a.webRef}function K(a,b,c){var d=L.replace(/\{SymbolName\}/gi,a.name);return r(d,c).then(function(a){a=z(a.data);return t.fromJSON(a,{portal:b.portal,url:g.urlToObject(g.removeFile(d)),origin:"portal-item"})})}function r(a,b){b=A({responseType:"json",query:{f:"json"}},b);return B(g.normalize(a),b)}Object.defineProperty(c,"__esModule",{value:!0});
var f={};c.fetchStyle=x;c.resolveWebStyleSymbol=function(a,b,c,d){return a.name?a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName?K(a,b,d):x(a,b,d).then(function(e){return y(e,a.name,b,c,d)}):q.reject(new l("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};c.fetchSymbolFromStyle=y;c.styleNameFromItem=function(a){var b=0;for(a=a.typeKeywords;b<a.length;b++){var c=a[b];if(/^Esri.*Style$/.test(c)&&"Esri Style"!==c)return c}};var k="esri_en",w="Style",
L="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f\x3djson"});