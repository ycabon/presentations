// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/promiseUtils ../core/accessorSupport/decorators ../layers/support/layerSourceUtils ../renderers/support/jsonUtils ./QueryTask ./Task ./support/Query ./support/StatisticDefinition".split(" "),function(w,x,h,m,f,n,p,d,q,r,t,u,v,k){return function(l){function c(a){a=l.call(this,a)||this;a._field=null;a.checkValueRange=null;a.gdbVersion=null;a.source=null;return a}
m(c,l);Object.defineProperty(c.prototype,"parsedUrl",{get:function(){var a=this._parseUrl(this.url);a.path+="/generateRenderer";return a},enumerable:!0,configurable:!0});c.prototype.execute=function(a,c){var e=this,b=a.classificationDefinition;a=h({},a.toJSON(),{f:"json"});this._field="esri.tasks.support.ClassBreaksDefinition"===b.declaredClass?b.classificationField:b.attributeField;this.source&&(b={source:q.sourceToJSON(this.source)},a.layer=JSON.stringify(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);
a.classificationDef&&(a.classificationDef=JSON.stringify(a.classificationDef));b={query:a};if(this.requestOptions||c)b=h({},this.requestOptions,c,b);return n(this.parsedUrl.path,b).then(function(a){return e._handleExecuteResponse(a)})};c.prototype._handleExecuteResponse=function(a){var c=this,e=a&&a.data;if(e){if(!this.checkValueRange)return a=this._processRendererJSON(e),p.resolve(a);a=new t(this.url);var b=new k({statisticType:"min",onStatisticField:this._field}),g=new k({statisticType:"max",onStatisticField:this._field}),
b=new v({outStatistics:[b,g]});return a.execute(b).then(function(a){a=a.features[0].attributes;var b=null,g=null,d;for(d in a)0===d.toLowerCase().indexOf("min")?b=a[d]:g=a[d];return c._processRendererJSON(e,b,g)})}};c.prototype._processRendererJSON=function(a,c,e){if("classBreaks"===a.type){var b=r.fromJSON(a);return{classBreaks:b.classBreakInfos.map(function(a,d){0===d&&void 0!==c&&null!==c&&(a.minValue=c);d===b.classBreakInfos.length-1&&void 0!==e&&null!==e&&(a.maxValue=e);return{minValue:a.minValue,
maxValue:a.maxValue,label:a.label}}),normalizationTotal:b.normalizationTotal}}return{uniqueValues:a.uniqueValueInfos.map(function(b,d){0===d&&void 0!==c&&null!==c&&(b.value=c);d===a.uniqueValueInfos.length-1&&void 0!==e&&null!==e&&(b.value=e);return{count:b.count,value:b.value,label:b.label}})}};f([d.property()],c.prototype,"checkValueRange",void 0);f([d.property()],c.prototype,"gdbVersion",void 0);f([d.property()],c.prototype,"source",void 0);f([d.property({readOnly:!0,dependsOn:["url"]})],c.prototype,
"parsedUrl",null);return c=f([d.subclass("esri.tasks.GenerateRendererTask")],c)}(d.declared(u))});