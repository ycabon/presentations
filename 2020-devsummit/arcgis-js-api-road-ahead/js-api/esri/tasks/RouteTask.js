// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/decorateHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/assignHelper ../request ../core/promiseUtils ../core/queryUtils ../core/string ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./mixins/NAServiceDescription ./support/RouteResultsContainer".split(" "),function(E,F,t,u,n,v,w,x,y,p,z,A,B,C){var D=x.createQueryParamsHelper({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},
impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:function(m){return m.outSpatialReference.wkid}},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});return function(m){function l(a){return m.call(this,a)||this}u(l,m);l.prototype.solve=function(a,e){var b=this,f=[],d=[],k={},g={};a.stops&&a.stops.features&&this._collectGeometries(a.stops.features,d,"stops.features",
k);a.pointBarriers&&a.pointBarriers.features&&this._collectGeometries(a.pointBarriers.features,d,"pointBarriers.features",k);a.polylineBarriers&&a.polylineBarriers.features&&this._collectGeometries(a.polylineBarriers.features,d,"polylineBarriers.features",k);a.polygonBarriers&&a.polygonBarriers.features&&this._collectGeometries(a.polygonBarriers.features,d,"polygonBarriers.features",k);return z.normalizeCentralMeridian(d).then(function(a){for(var c in k){var e=k[c];f.push(c);g[c]=a.slice(e[0],e[1])}return b._isInputGeometryZAware(g,
f)?b.getServiceDescription():w.resolve({dontCheck:!0})}).then(function(c){("dontCheck"in c?c.dontCheck:c.hasZ)||b._dropZValuesOffInputGeometry(g,f);c=function(c){g[c].forEach(function(b,d){a.get(c)[d].geometry=b})};for(var d in g)c(d);d={query:n({},b.parsedUrl.query,{f:"json"},D.toQueryParams(a))};if(b.requestOptions||e)d=n({},b.requestOptions,e,d);c=b.parsedUrl.path;c=y.endsWith(c,"/solve")?c:c+"/solve";return v(c,d)}).then(function(a){return b._handleSolveResponse(a)})};l.prototype._collectGeometries=
function(a,e,b,f){f[b]=[e.length,e.length+a.length];a.forEach(function(a){e.push(a.geometry)})};l.prototype._handleSolveResponse=function(a){var e=[],b=[],f=a.data;a=f.directions;var d=f.routes,k=void 0===d?{}:d,d=k.features,d=void 0===d?[]:d,k=k.spatialReference,g=f.stops,c=void 0===g?{}:g,g=c.features,g=void 0===g?[]:g,l=c.spatialReference,c=f.barriers,m=f.polygonBarriers,q=f.polylineBarriers,f=f.messages,n=!0,h,p,r=d&&(void 0===k?null:k)||g&&(void 0===l?null:l)||c&&c.spatialReference||m&&m.spatialReference||
q&&q.spatialReference;(void 0===a?[]:a).forEach(function(a){e.push(h=a.routeName);b[h]={directions:a}});d.forEach(function(a){-1===e.indexOf(h=a.attributes.Name)&&(e.push(h),b[h]={});a.geometry&&(a.geometry.spatialReference=r);b[h].route=a});g.forEach(function(a){p=a.attributes;-1===e.indexOf(h=p.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(e.push(h),b[h]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==h&&(n=!1);a.geometry&&(a.geometry.spatialReference=r);null==b[h].stops&&(b[h].stops=[]);b[h].stops.push(a)});
0<g.length&&!0===n&&(b[e[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],e.splice(e.indexOf("esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));a=e.map(function(a){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;return b[a]});return C.fromJSON({routeResults:a,pointBarriers:c,polygonBarriers:m,polylineBarriers:q,messages:f})};return l=t([p.subclass("esri.tasks.RouteTask")],l)}(p.declared(B.NAServiceDescriptionMixin(A)))});