// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/maybe ../../core/object ../../core/urlUtils ../../core/accessorSupport/decorators ../Task".split(" "),function(q,l,r,w,h,k,t,x,z,A,B,m,C){function D(a){return k(this,void 0,void 0,function(){var d,b,g,c;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t(a+
("/"===a[a.length-1]?"":"/")+"retrieveTravelModes",{query:{f:"json"}})];case 1:return d=e.sent().data,b=d.supportedTravelModes,g=d.defaultTravelMode,[2,{supportedTravelModes:b,defaultTravelMode:g}];case 2:throw c=e.sent(),new x("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:c});case 3:return[2]}})})}function E(a){return k(this,void 0,void 0,function(){var d,b,g,c,e,f,n,v,y,u,l,p,k,m,q,r;return h(this,function(h){switch(h.label){case 0:return[4,
t(a.substring(0,a.indexOf("/rest/")+6)+"info",{query:{f:"json"}})];case 1:d=h.sent().data;if(!d||!d.owningSystemUrl)return[2,{supportedTravelModes:[],defaultTravelMode:null}];a=d.owningSystemUrl;return[4,t(a+("/"===a[a.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json"}})];case 2:b=h.sent().data;g=A.getDeepValue("helperServices.routingUtilities.url",b);if(!g)return[2,{supportedTravelModes:[],defaultTravelMode:null}];c=B.urlToObject(a);e=/\/solveClosestFacility$/.test(c.path)?"Route":/\/solveClosestFacility$/.test(c.path)?
"ClosestFacility":"ServiceAreas";return[4,t(g+("/"===g[g.length-1]?"":"/")+"GetTravelModes/execute",{query:{f:"json",serviceName:e}})];case 3:f=h.sent();n=[];v=null;if(f&&f.data&&f.data.results&&f.data.results.length)for(y=f.data.results,u=0,l=y;u<l.length;u++)if(p=l[u],"supportedTravelModes"===p.paramName){if(p.value&&p.value.features)for(k=0,m=p.value.features;k<m.length;k++)if(q=m[k].attributes)r=JSON.parse(q.TravelMode),n.push(r)}else"defaultTravelMode"===p.paramName&&(v=p.value);return[2,{supportedTravelModes:n,
defaultTravelMode:v}]}})})}Object.defineProperty(l,"__esModule",{value:!0});l.NAServiceDescriptionMixin=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}w(b,a);b.prototype.getServiceDescription=function(){return k(this,void 0,void 0,function(){return h(this,function(a){this._serviceDescriptionPromise||(this._serviceDescriptionPromise=this._fetchServiceDescription());return[2,this._serviceDescriptionPromise]})})};b.prototype._fetchServiceDescription=function(){return k(this,
void 0,void 0,function(){var a,c,e,f,n,b,d;return h(this,function(g){switch(g.label){case 0:if(!this.url||!this.parsedUrl)throw new x("network-service:missing-url","Url to Network service is missing");a=this.url;return[4,t(a,{query:{f:"json"}})];case 1:c=g.sent().data;c.supportedTravelModes||(c.supportedTravelModes=[]);for(e=0;e<c.supportedTravelModes.length;e++)c.supportedTravelModes[e].id||(c.supportedTravelModes[e].id=c.supportedTravelModes[e].itemId);f=10.4<=c.currentVersion?D(a):E(a);return[4,
f];case 2:return n=g.sent(),b=n.defaultTravelMode,d=n.supportedTravelModes,c.defaultTravelMode=b,c.supportedTravelModes=d,[2,c]}})})};b.prototype._isInputGeometryZAware=function(a,c){for(var e=0;e<c.length;e++){var f=a[c[e]];if(f&&f.length)for(var b=0;b<f.length;b++){var d=f[b];if(z.isSome(d)&&d.hasZ)return!0}}return!1};b.prototype._dropZValuesOffInputGeometry=function(a,c){for(var e=0;e<c.length;e++){var b=a[c[e]];if(b&&b.length)for(var d=0;d<b.length;d++)b[d].z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")};
return b=r([m.subclass("esri.tasks.mixins.NAServiceDescription")],b)}(m.declared(a))};q=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}w(d,a);return d=r([m.subclass("esri.tasks.mixins.NAServiceDescription")],d)}(m.declared(l.NAServiceDescriptionMixin(C)));l.NAServiceDescription=q});