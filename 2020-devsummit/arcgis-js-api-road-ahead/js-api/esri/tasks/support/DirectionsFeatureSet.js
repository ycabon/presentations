// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Graphic ../../core/maybe ../../core/accessorSupport/decorators ./FeatureSet".split(" "),function(w,x,u,d,k,n,p,c,v){return function(r){function b(a){a=r.call(this,a)||this;a.extent=null;a.features=null;a.geometryType="polyline";a.routeId=null;a.routeName=null;a.totalDriveTime=null;a.totalLength=null;a.totalTime=null;return a}u(b,r);b.prototype.readFeatures=function(a,b){var c=
this;(a||[]).forEach(function(a){c._decompressFeatureGeometry(a,b.summary.envelope.spatialReference)});var d=k.SpatialReference.fromJSON(b.spatialReference);return a.map(function(a){var b=n.fromJSON(a),c=a.geometry&&a.geometry.spatialReference;b.geometry&&!c&&(p.unwrap(b.geometry).spatialReference=d);b.strings=a.strings;b.events=(a.events||[]).map(function(b){var c=new n({geometry:new k.Point({x:b.point.x,y:b.point.y,z:b.point.z,hasZ:void 0!==b.point.z,spatialReference:a.geometry&&a.geometry.spatialReference}),
attributes:{ETA:b.ETA,arriveTimeUTC:b.arriveTimeUTC}});c.strings=b.strings;return c});return b})};Object.defineProperty(b.prototype,"mergedGeometry",{get:function(){if(!this.features)return null;var a=this.features.map(function(a){return p.unwrap(a.geometry)}),b=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(a,b)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"strings",{get:function(){return this.features.map(function(a){return a.strings})},enumerable:!0,
configurable:!0});b.prototype._decompressFeatureGeometry=function(a,b){a.geometry=this._decompressGeometry(a.compressedGeometry,b)};b.prototype._decompressGeometry=function(a,b){var c=0,d=0,m=0,t=0,k=[],f,g,q,n,p,e=0,h=0,l=0;(a=a.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(a=[]);0===parseInt(a[e],32)?(e=2,f=parseInt(a[e],32),e++,q=parseInt(a[e],32),e++,f&1&&(h=a.indexOf("|")+1,n=parseInt(a[h],32),h++),f&2&&(l=a.indexOf("|",h)+1,p=parseInt(a[l],32),l++)):(q=parseInt(a[e],32),e++);for(;e<a.length&&"|"!==a[e];)f=
parseInt(a[e],32)+c,e++,c=f,g=parseInt(a[e],32)+d,e++,d=g,f=[f/q,g/q],h&&(g=parseInt(a[h],32)+m,h++,m=g,f.push(g/n)),l&&(g=parseInt(a[l],32)+t,l++,t=g,f.push(g/p)),k.push(f);return{paths:[k],hasZ:0<h,hasM:0<l,spatialReference:b}};b.prototype._mergePolylinesToSinglePath=function(a,b){var c=[];(a||[]).forEach(function(a){a.paths.forEach(function(a){c=c.concat(a)})});var d=[],m=[0,0];c.forEach(function(a){if(a[0]!==m[0]||a[1]!==m[1])d.push(a),m=a});return new k.Polyline({paths:[d]},b)};d([c.property({type:k.Extent,
json:{read:{source:"summary.envelope"}}})],b.prototype,"extent",void 0);d([c.property()],b.prototype,"features",void 0);d([c.reader("features")],b.prototype,"readFeatures",null);d([c.property()],b.prototype,"geometryType",void 0);d([c.property({readOnly:!0,dependsOn:["features","extent.spatialReference"]})],b.prototype,"mergedGeometry",null);d([c.property()],b.prototype,"routeId",void 0);d([c.property()],b.prototype,"routeName",void 0);d([c.property({value:null,readOnly:!0,dependsOn:["features"]})],
b.prototype,"strings",null);d([c.property({json:{read:{source:"summary.totalDriveTime"}}})],b.prototype,"totalDriveTime",void 0);d([c.property({json:{read:{source:"summary.totalLength"}}})],b.prototype,"totalLength",void 0);d([c.property({json:{read:{source:"summary.totalTime"}}})],b.prototype,"totalTime",void 0);return b=d([c.subclass("esri.tasks.support.DirectionsFeatureSet")],b)}(c.declared(v))});