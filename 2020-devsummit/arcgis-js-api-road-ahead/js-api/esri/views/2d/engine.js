// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/views/2d/engine/Bitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(a,c,f,g,e,b,m,k,d){function l(d){var b=document.createElement("canvas");b.width=d.width;b.height=d.height;d.render(b.getContext("2d"));return b}function q(d,b,a){var c={target:3553,pixelFormat:6408,
internalFormat:6408,dataType:5121,wrapMode:33071};b&&a&&(c.width=b,c.height=a);return new m.Texture(d,c)}function v(d){p.has(d)&&(x.splice(x.indexOf(d),1),p.delete(d))}Object.defineProperty(c,"__esModule",{value:!0});var x=[],p=new Set;a=function(a){function c(d,b){void 0===d&&(d=null);void 0===b&&(b=function(){return null});var c=a.call(this)||this;c.stencilRef=0;c.coordScale=[1,1];c._height=void 0;c.pixelRatio=1;c.resolution=0;c.rotation=0;c._source=null;c._width=void 0;c.x=0;c.y=0;c.transforms=
{dvs:e.mat3f32.create()};c.source=d;c.requestRender=b;return c}f(c,a);Object.defineProperty(c.prototype,"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(d){this._height=d},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"source",{get:function(){return this._source},
set:function(d){this._source=d;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(d){this._width=d},enumerable:!0,configurable:!0});c.prototype.attach=function(){this.updateTexture();return!0};c.prototype.detach=function(){this._texture.dispose();this._texture=null;v(this)};c.prototype.invalidateTexture=function(){this.attached?this.updateTexture():v(this)};c.prototype.setTransform=function(d){var a=g.mat3.identity(this.transforms.dvs),c=d.toScreenNoRotation([0,0],this.x,this.y),h=this.resolution/
this.pixelRatio/d.resolution,l=h*this.width,h=h*this.height,e=Math.PI*this.rotation/180;g.mat3.translate(a,a,b.vec2f32.fromValues(c[0],c[1]));g.mat3.translate(a,a,b.vec2f32.fromValues(l/2,h/2));g.mat3.rotate(a,a,-e);g.mat3.translate(a,a,b.vec2f32.fromValues(-l/2,-h/2));g.mat3.scaleByVec2(a,a,b.vec2f32.fromValues(l,h));g.mat3.multiply(this.transforms.dvs,d.displayViewMat3,a)};c.prototype.updateTexture=function(){this._texture||(this._texture=this.source?q(this.stage.context,this.sourceWidth,this.sourceHeight):
q(this.stage.context));var b=this.source;b?(this._texture.resize(this.sourceWidth,this.sourceHeight),b&&"render"in b?b instanceof d.default?(b=b.getRenderedRasterPixels(),this._texture.setData(b.renderedRasterPixels)):this._texture.setData(l(b)):!b||"render"in b||this._texture.setData(b),this.ready(),this.requestRender()):this._texture.setData(null)};c.prototype.setSamplingProfile=function(d){this._texture&&(d.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(d.samplingMode))};
c.prototype.bind=function(d){this._texture&&this.stage.context.bindTexture(this._texture,d)};return c}(k.DisplayObject);c.Bitmap=a})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._isReady=!1;b._opacity=1;b.renderRequested=
!1;b._visible=!0;return b}f(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(b){this._attached!==b&&((this._attached=b)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},
set:function(b){this._opacity!==b&&(this._opacity=b,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(b){this._visible!==b&&(this._visible=b,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(){this.ready();return!0};b.prototype.setTransform=function(b){};b.prototype.detach=function(){};b.prototype.processRender=function(b){this.visible&&this.attached&&(this._renderRequestedCalled=
!1,this.doRender(b),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};b.prototype.requestRender=function(){var b=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestRender();b!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};b.prototype.doRender=function(b){};b.prototype.ready=function(){this._isReady=!0;
this.emit("isReady")};return b}(g);c.DisplayObject=a})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,c,b){this.pixelBlock=a;this.extent=c;this.originalPixelBlock=b}Object.defineProperty(a.prototype,"width",{get:function(){return this.pixelBlock?this.pixelBlock.width:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.pixelBlock?
this.pixelBlock.height:0},enumerable:!0,configurable:!0});a.prototype.render=function(a){var c=this.pixelBlock;if(c){var b=this.filter({pixelBlock:c}),c=b.pixelBlock.getAsRGBA(),b=a.createImageData(b.pixelBlock.width,b.pixelBlock.height);b.data.set(c);a.putImageData(b,0,0)}};a.prototype.getRenderedRasterPixels=function(){var a=this.filter({pixelBlock:this.pixelBlock});return{width:a.pixelBlock.width,height:a.pixelBlock.height,renderedRasterPixels:new Uint8Array(a.pixelBlock.getAsRGBA().buffer)}};
return a}();c.default=a})},"esri/views/2d/engine/BitmapContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../engine ./webgl/WGLContainer".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});a=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.prototype.prepareRenderPasses=function(d){var a=this,c=d.registerRenderPass({name:"bitmap",brushes:[e.brushes.Bitmap],target:function(){return a.children}});
return b.prototype.prepareRenderPasses.call(this,d).concat([c])};return a}(b.default);c.BitmapContainer=a})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(d){var b=a.call(this)||this;b.name=b.constructor.name;
b._lastTime=null;b.setClips(d);return b}f(c,a);c.prototype.setClips=function(d){var b=this;e.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(d){return d.destroy()}),this._clippingInfos=null);e.isSome(d)&&d.length&&(this._clippingInfos=d.items.map(function(d){return k.default.fromClipArea(b,d)}));this.requestRender()};c.prototype.doRender=function(b){this.attachChildren();this.detachChildren();var a=this.createRenderParams(b),c=a.context,l=a.painter,e=a.globalOpacity,f=a.profiler,
e={opacity:a.drawPhase===d.WGLDrawPhase.LABEL?1:e*this.opacity,blendOption:{mode:this.blendMode},postProcessingEffects:null};if(this.postProcessingEffects&&this.postProcessingEffects.length){e.postProcessingEffects=[];for(var k=0,q=this.postProcessingEffects;k<q.length;k++)e.postProcessingEffects.push({effect:q[k]})}f.recordContainerStart(this.name);l.beforeRenderLayer(c,this._clippingInfos?255:0,e);this.updateTransforms(b.state);this.renderChildren(a);l.compositeLayer(a,e);f.recordContainerEnd()};
c.prototype.renderChildren=function(d){e.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(this.stage.painter));for(var b=0,a=this._renderPasses;b<a.length;b++)a[b].render(d)};c.prototype.createRenderParams=function(d){var b=Date.now(),a=(e.isSome(this._lastTime)?b-this._lastTime:0)/1E3;this._lastTime=b;return g({},d,{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,
timeDelta:a,timeline:this.stage.timeline})};c.prototype.prepareRenderPasses=function(a){var c=this;return[a.registerRenderPass({name:"clip",brushes:[b.brushes.Clip],target:function(){return c._clippingInfos},drawPhase:d.WGLDrawPhase.MAP|d.WGLDrawPhase.LABEL|d.WGLDrawPhase.LABEL_ALPHA|d.WGLDrawPhase.DEBUG})]};c.prototype.updateTransforms=function(d){for(var b=0,a=this.children;b<a.length;b++)a[b].setTransform(d)};return c}(m.Container);c.default=a})},"esri/views/2d/engine/Container":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","./DisplayObject"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._childrenSet=new Set;b._childrenToAttach=[];b._childrenToDetach=[];b._blendMode=null;b._postProcessingEffects=null;b.children=[];return b}f(b,a);Object.defineProperty(b.prototype,"blendMode",{get:function(){return this._blendMode},set:function(a){if(this._blendMode!==a){this._blendMode=a;for(var c=
0,d=this.children;c<d.length;c++){var l=d[c];l instanceof b&&(l.blendMode=a)}this.requestRender()}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numChildren",{get:function(){return this.children.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"postProcessingEffects",{get:function(){return this._postProcessingEffects},set:function(a){if(a&&0<a.length){this._postProcessingEffects=Array(a.length);for(var c=0;c<a.length;c++)this._postProcessingEffects[c]=
a[c]}else this._postProcessingEffects=null;for(var c=0,d=this.children;c<d.length;c++){var l=d[c];l instanceof b&&(l.postProcessingEffects=a)}this.requestRender()},enumerable:!0,configurable:!0});b.prototype.detach=function(){for(var b=0,a=this.children.concat(this._childrenToDetach);b<a.length;b++){var d=a[b];d.attached&&(this.detachChild(d),d.attached=!1,d.parent=null)}};b.prototype.doRender=function(b){var a=b.globalOpacity;b.globalOpacity*=this.opacity;this.attachChildren();this.detachChildren();
this.renderChildren(b);b.globalOpacity=a};b.prototype.addChild=function(b){return this.addChildAt(b,this.children.length)};b.prototype.addChildAt=function(a,c){void 0===c&&(c=this.numChildren);if(!a||this.contains(a))return a;var d=a.parent;d&&d!==this&&d.removeChild(a);c>=this.numChildren?this.children.push(a):this.children.splice(c,0,a);this._childrenSet.add(a);c=this._childrenToDetach.indexOf(a);-1<c&&this._childrenToDetach.splice(c,1);a instanceof b&&(a.blendMode=this.blendMode);this._childrenToAttach.push(a);
this.requestRender();return a};b.prototype.contains=function(b){return this._childrenSet.has(b)};b.prototype.getChildIndex=function(b){return this.children.indexOf(b)};b.prototype.getChildAt=function(b){return 0>b||b>this.children.length?null:this.children[b]};b.prototype.removeAllChildren=function(){for(var b=this.numChildren;b--;)this.removeChildAt(0)};b.prototype.removeChild=function(b){return this.contains(b)?this.removeChildAt(this.getChildIndex(b)):b};b.prototype.removeChildAt=function(b){if(0>
b||b>=this.children.length)return null;b=this.children.splice(b,1)[0];this._childrenSet["delete"](b);if(b.attached)this._childrenToDetach.push(b);else{var a=this._childrenToAttach.indexOf(b);-1<a&&this._childrenToAttach.splice(a,1)}return b};b.prototype.setChildIndex=function(b,a){var d=this.getChildIndex(b);-1<d&&(this.children.splice(d,1),this.children.splice(a,0,b))};b.prototype.sortChildren=function(b){return this.children.sort(b)};b.prototype.attachChildren=function(){var b=this._childrenToAttach;
if(0!==b.length)for(var a=0,d=!1;!d;)d=b[a],d.parent=this,d.stage=this.stage,this.attachChild(d)?(d.attached=!0,b.splice(a,1)):++a,d=b.length===a};b.prototype.detachChildren=function(){for(var b=this._childrenToDetach;0<b.length;){var a=b.shift();this.detachChild(a);a.attached=!1;a.parent=null;a.stage=null}};b.prototype.renderChildren=function(b){for(var a=this.children,d=a.length,c=0;c<d;c++)a[c].processRender(b)};b.prototype.attachChild=function(b){return b.attach()};b.prototype.detachChild=function(b){b.detach()};
return b}(g.DisplayObject);c.Container=a})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});var l=e.getLogger("esri.views.2d.engine.webgl.ClippingInfo");a=function(a){function c(d,b){var c=a.call(this)||this;c._cache=
{};c.parent=d;c._handle=b.watch("version",function(){return c._invalidate()});c._clip=b;c.attach();c.attached=!0;return c}f(c,a);c.fromClipArea=function(d,b){return new c(d,b)};c.prototype._destroyGL=function(){b.isSome(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null);b.isSome(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)};c.prototype.destroy=function(){this._destroyGL();this._handle.remove()};c.prototype.doRender=function(){};c.prototype.getVAO=function(a,
c,l,e){var f=c.size,q=f[0],f=f[1];if("geometry"===this._clip.type||this._lastWidth!==q||this._lastHeight!==f)this._lastWidth=q,this._lastHeight=f,this._destroyGL();b.isNone(this._cache.vao)&&(c=this._createMesh(c,this._clip),q=c.getIndexBuffer(a),f=c.getVertexBuffers(a),this._cache.mesh=c,this._cache.vao=new d(a,l,e,f,q));return this._cache.vao};c.prototype._invalidate=function(){this._destroyGL();this.requestRender()};c.prototype._createScreenRect=function(d,b){var a=d.size;d=a[0];var a=a[1],c="string"===
typeof b.left?parseFloat(b.left)/100*d:b.left,l="string"===typeof b.right?parseFloat(b.right)/100*d:b.right,e="string"===typeof b.top?parseFloat(b.top)/100*a:b.top;b="string"===typeof b.bottom?parseFloat(b.bottom)/100*a:b.bottom;return{x:c,y:e,width:Math.max(d-l-c,0),height:Math.max(a-b-e,0)}};c.prototype._createMesh=function(d,b){switch(b.type){case "rect":return k.default.fromRect(this._createScreenRect(d,b));case "path":return k.default.fromPath(b);case "geometry":return k.default.fromGeometry(d,
b);default:return l.error(new g("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),k.default.fromRect({x:0,y:0,width:1,height:1})}};return c}(m.DisplayObject);c.default=a})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x){Object.defineProperty(c,"__esModule",{value:!0});var p=e.getLogger("esri.views.2d.engine.webgl.Mesh2D"),z=function(d,b){var a=d.coords;d=d.lengths;for(var c=[],h=0,l=0;h<d.length;l+=d[h],h+=1){for(var e=l,f=[];h<d.length-1;h+=1,l+=d[h]){for(var q=l+d[h],k=0,v=1;v<d[h+1];v++)k+=(a[2*(q+v)]-a[2*(q+v-1)])*(a[2*(q+v)+1]+a[2*(q+v-1)+1]);if(!(b?0<k:0>k))break;f.push(l+d[h]-e)}k=a.slice(2*e,2*(l+d[h]));q=0;for(f=m(k,f,2);q<f.length;q++)c.push(f[q]+e)}return c};a=function(){function a(d,
b,a,h){void 0===h&&(h=!1);this._cache={};this.vertices=d;this.indices=b;this.primitiveType=a;this.isMapSpace=h}a.fromRect=function(d){var b=d.x,c=d.y;return a.fromScreenExtent({xmin:b,ymin:c,xmax:b+d.width,ymax:c+d.height})};a.fromPath=function(d){var b=l.convertFromNestedArray(new q.default,d.path,!1,!1);d=b.coords;for(var b=new Uint32Array(z(b,!0)),c=new Uint32Array(d.length/2),h=0;h<c.length;h++)c[h]=v.i1616to32(Math.floor(d[2*h]),Math.floor(d[2*h+1]));return new a({geometry:c},b,4)};a.fromGeometry=
function(d,b){var c=b.geometry.type;switch(c){case "polygon":return a.fromPolygon(d,b.geometry);case "extent":return a.fromMapExtent(d,b.geometry);default:return p.error(new g("mapview-bad-type","Unable to create a mesh from type "+c,b)),a.fromRect({x:0,y:0,width:1,height:1})}};a.fromPolygon=function(b,c){var e=l.convertFromPolygon(new q.default,c,!1,!1);c=e.coords;for(var e=new Uint32Array(z(e,!1)),h=new Uint32Array(c.length/2),f=d.vec2f64.create(),t=d.vec2f64.create(),p=0;p<h.length;p++)k.vec2.set(f,
c[2*p],c[2*p+1]),b.toScreen(t,f),h[p]=v.i1616to32(Math.floor(t[0]),Math.floor(t[1]));return new a({geometry:h},e,4,!0)};a.fromScreenExtent=function(d){var b=d.xmin,c=d.xmax,h=d.ymin;d=d.ymax;b={geometry:new Uint32Array([v.i1616to32(b,h),v.i1616to32(c,h),v.i1616to32(b,d),v.i1616to32(b,d),v.i1616to32(c,h),v.i1616to32(c,d)])};c=new Uint32Array([0,1,2,3,4,5]);return new a(b,c,4)};a.fromMapExtent=function(d,b){var c=d.toScreen([0,0],[b.xmin,b.ymin]),h=c[0],c=c[1];b=d.toScreen([0,0],[b.xmax,b.ymax]);d=
b[0];b=b[1];h={geometry:new Uint32Array([v.i1616to32(h,c),v.i1616to32(d,c),v.i1616to32(h,b),v.i1616to32(h,b),v.i1616to32(d,c),v.i1616to32(d,b)])};c=new Uint32Array([0,1,2,3,4,5]);return new a(h,c,4)};a.prototype.destroy=function(){b.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var d in this._cache.vertexBuffers)b.isSome(this._cache.vertexBuffers[d])&&this._cache.vertexBuffers[d].dispose()};Object.defineProperty(a.prototype,"elementType",{get:function(){var d;a:switch(this.indices.BYTES_PER_ELEMENT){case 1:d=
5121;break a;case 2:d=5123;break a;case 4:d=5125;break a;default:throw new g("Cannot get DataType of array");}return d},enumerable:!0,configurable:!0});a.prototype.getIndexBuffer=function(d,b){void 0===b&&(b=35044);this._cache.indexBuffer||(this._cache.indexBuffer=x.createIndex(d,b,this.indices));return this._cache.indexBuffer};a.prototype.getVertexBuffers=function(d,b){var a=this;void 0===b&&(b=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(function(c,
l){var h;return f({},c,(h={},h[l]=x.createVertex(d,b,a.vertices[l]),h))},{}));return this._cache.vertexBuffers};return a}();c.default=a})},"esri/core/libs/earcut/earcut":function(){define([],function(){function a(a,l,e){e=e||2;var h=l&&l.length,q=h?l[0]*e:a.length,k=c(a,0,q,e,!0),t=[];if(!k||k.next===k.prev)return t;var v,p,n,x;if(h){var y=e,h=[],r,u,w;x=0;for(r=l.length;x<r;x++)u=l[x]*y,w=x<r-1?l[x+1]*y:a.length,u=c(a,u,w,y,!1),u===u.next&&(u.steiner=!0),h.push(d(u));h.sort(b);for(x=0;x<h.length;x++){l=
h[x];y=k;if(y=m(l,y))l=z(y,l),f(l,l.next);k=f(k,k.next)}}if(a.length>80*e){v=n=a[0];p=h=a[1];for(y=e;y<q;y+=e)x=a[y],l=a[y+1],x<v&&(v=x),l<p&&(p=l),x>n&&(n=x),l>h&&(h=l);n=Math.max(n-v,h-p);n=0!==n?1/n:0}g(k,t,e,v,p,n);return t}function c(d,b,a,c,l){var h;if(l===0<u(d,b,a,c))for(l=b;l<a;l+=c)h=r(l,d[l],d[l+1],h);else for(l=a-c;l>=b;l-=c)h=r(l,d[l],d[l+1],h);h&&v(h,h.next)&&(w(h),h=h.next);return h}function f(d,b){if(!d)return d;b||(b=d);var a;do if(a=!1,d.steiner||!v(d,d.next)&&0!==q(d.prev,d,d.next))d=
d.next;else{w(d);d=b=d.prev;if(d===d.next)break;a=!0}while(a||d!==b);return b}function g(d,b,a,c,n,m,r){if(d){if(!r&&m){var h=d,t=h;do null===t.z&&(t.z=k(t.x,t.y,c,n,m)),t.prevZ=t.prev,t=t.nextZ=t.next;while(t!==h);t.prevZ.nextZ=null;t.prevZ=null;var h=t,y,u,A,C,B,D,L=1;do{t=h;A=h=null;for(C=0;t;){C++;u=t;for(y=B=0;y<L&&(B++,u=u.nextZ,u);y++);for(D=L;0<B||0<D&&u;)0!==B&&(0===D||!u||t.z<=u.z)?(y=t,t=t.nextZ,B--):(y=u,u=u.nextZ,D--),A?A.nextZ=y:h=y,y.prevZ=A,A=y;t=u}A.nextZ=null;L*=2}while(1<C)}for(h=
d;d.prev!==d.next;){t=d.prev;u=d.next;if(m)A=e(d,c,n,m);else a:if(A=d,C=A.prev,B=A,L=A.next,0<=q(C,B,L))A=!1;else{D=y=A.next.next;for(var J=0;y!==A.prev&&(0===J||y!==D);){J++;if(l(C.x,C.y,B.x,B.y,L.x,L.y,y.x,y.y)&&0<=q(y.prev,y,y.next)){A=!1;break a}y=y.next}A=!0}if(A)b.push(t.i/a),b.push(d.i/a),b.push(u.i/a),w(d),h=d=u.next;else if(d=u,d===h){if(!r)g(f(d),b,a,c,n,m,1);else if(1===r){r=b;h=a;t=d;do u=t.prev,A=t.next.next,!v(u,A)&&x(u,t,t.next,A)&&p(u,A)&&p(A,u)&&(r.push(u.i/h),r.push(t.i/h),r.push(A.i/
h),w(t),w(t.next),t=d=A),t=t.next;while(t!==d);d=t;g(d,b,a,c,n,m,2)}else if(2===r)a:{r=d;do{for(h=r.next.next;h!==r.prev;){if(t=r.i!==h.i){t=r;u=h;A=void 0;if(A=t.next.i!==u.i&&t.prev.i!==u.i){A=void 0;b:{A=t;do{if(A.i!==t.i&&A.next.i!==t.i&&A.i!==u.i&&A.next.i!==u.i&&x(A,A.next,t,u)){A=!0;break b}A=A.next}while(A!==t);A=!1}A=!A}C=void 0;if(C=A&&p(t,u)&&p(u,t)){A=t;C=!1;B=(t.x+u.x)/2;u=(t.y+u.y)/2;do A.y>u!==A.next.y>u&&A.next.y!==A.y&&B<(A.next.x-A.x)*(u-A.y)/(A.next.y-A.y)+A.x&&(C=!C),A=A.next;
while(A!==t)}t=C}if(t){d=z(r,h);r=f(r,r.next);d=f(d,d.next);g(r,b,a,c,n,m);g(d,b,a,c,n,m);break a}h=h.next}r=r.next}while(r!==d)}break}}}}function e(d,b,a,c){var h=d.prev,e=d.next;if(0<=q(h,d,e))return!1;var f=h.x>d.x?h.x>e.x?h.x:e.x:d.x>e.x?d.x:e.x,t=h.y>d.y?h.y>e.y?h.y:e.y:d.y>e.y?d.y:e.y,v=k(h.x<d.x?h.x<e.x?h.x:e.x:d.x<e.x?d.x:e.x,h.y<d.y?h.y<e.y?h.y:e.y:d.y<e.y?d.y:e.y,b,a,c);b=k(f,t,b,a,c);a=d.prevZ;for(c=d.nextZ;a&&a.z>=v&&c&&c.z<=b;){if(a!==d.prev&&a!==d.next&&l(h.x,h.y,d.x,d.y,e.x,e.y,a.x,
a.y)&&0<=q(a.prev,a,a.next))return!1;a=a.prevZ;if(c!==d.prev&&c!==d.next&&l(h.x,h.y,d.x,d.y,e.x,e.y,c.x,c.y)&&0<=q(c.prev,c,c.next))return!1;c=c.nextZ}for(;a&&a.z>=v;){if(a!==d.prev&&a!==d.next&&l(h.x,h.y,d.x,d.y,e.x,e.y,a.x,a.y)&&0<=q(a.prev,a,a.next))return!1;a=a.prevZ}for(;c&&c.z<=b;){if(c!==d.prev&&c!==d.next&&l(h.x,h.y,d.x,d.y,e.x,e.y,c.x,c.y)&&0<=q(c.prev,c,c.next))return!1;c=c.nextZ}return!0}function b(d,b){return d.x-b.x}function m(d,b){var a=b,c=d.x,h=d.y,e=-Infinity,f;do{if(h<=a.y&&h>=a.next.y&&
a.next.y!==a.y){var q=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(q<=c&&q>e){e=q;if(q===c){if(h===a.y)return a;if(h===a.next.y)return a.next}f=a.x<a.next.x?a:a.next}}a=a.next}while(a!==b);if(!f)return null;if(c===e)return f.prev;b=f;for(var q=f.x,k=f.y,v=Infinity,n,a=f.next;a!==b;)c>=a.x&&a.x>=q&&c!==a.x&&l(h<k?c:e,h,q,k,h<k?e:c,h,a.x,a.y)&&(n=Math.abs(h-a.y)/(c-a.x),(n<v||n===v&&a.x>f.x)&&p(a,d)&&(f=a,v=n)),a=a.next;return f}function k(d,b,a,c,l){d=32767*(d-a)*l;b=32767*(b-c)*l;d=(d|d<<8)&16711935;
d=(d|d<<4)&252645135;d=(d|d<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(d|d<<1)&1431655765|((b|b<<1)&1431655765)<<1}function d(d){var b=d,a=d;do{if(b.x<a.x||b.x===a.x&&b.y<a.y)a=b;b=b.next}while(b!==d);return a}function l(d,b,a,c,l,e,f,q){return 0<=(l-f)*(b-q)-(d-f)*(e-q)&&0<=(d-f)*(c-q)-(a-f)*(b-q)&&0<=(a-f)*(e-q)-(l-f)*(c-q)}function q(d,b,a){return(b.y-d.y)*(a.x-b.x)-(b.x-d.x)*(a.y-b.y)}function v(d,b){return d.x===b.x&&d.y===b.y}function x(d,b,a,c){return v(d,
b)&&v(a,c)||v(d,c)&&v(a,b)?!0:0<q(d,b,a)!==0<q(d,b,c)&&0<q(a,c,d)!==0<q(a,c,b)}function p(d,b){return 0>q(d.prev,d,d.next)?0<=q(d,b,d.next)&&0<=q(d,d.prev,b):0>q(d,b,d.prev)||0>q(d,d.next,b)}function z(d,b){var a=new n(d.i,d.x,d.y),c=new n(b.i,b.x,b.y),h=d.next,l=b.prev;d.next=b;b.prev=d;a.next=h;h.prev=a;c.next=a;a.prev=c;l.next=c;c.prev=l;return c}function r(d,b,a,c){d=new n(d,b,a);c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d);return d}function w(d){d.next.prev=d.prev;d.prev.next=
d.next;d.prevZ&&(d.prevZ.nextZ=d.nextZ);d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function n(d,b,a){this.i=d;this.x=b;this.y=a;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function u(d,b,a,c){for(var h=0,l=a-c;b<a;b+=c)h+=(d[l]-d[b])*(d[b+1]+d[l+1]),l=b;return h}a.deviation=function(d,b,a,c){var h=b&&b.length,l=Math.abs(u(d,0,h?b[0]*a:d.length,a));if(h)for(var h=0,e=b.length;h<e;h++)l-=Math.abs(u(d,b[h]*a,h<e-1?b[h+1]*a:d.length,a));for(h=b=0;h<c.length;h+=3){var e=c[h]*a,f=c[h+1]*
a,q=c[h+2]*a;b+=Math.abs((d[e]-d[q])*(d[f+1]-d[e+1])-(d[e]-d[f])*(d[q+1]-d[e+1]))}return 0===l&&0===b?0:Math.abs((b-l)/l)};a.flatten=function(d){for(var b=d[0][0].length,a={vertices:[],holes:[],dimensions:b},c=0,h=0;h<d.length;h++){for(var l=0;l<d[h].length;l++)for(var e=0;e<b;e++)a.vertices.push(d[h][l][e]);0<h&&(c+=d[h-1].length,a.holes.push(c))}return a};return a})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(a,c){function f(b,a,c){return Math.round(Math.max(Math.min(b,
c),a))}Object.defineProperty(c,"__esModule",{value:!0});var g=new Float32Array(1),e=new Uint32Array(g.buffer);c.i8=function(b){return f(b,-128,127)};c.i16=function(b){return f(b,-32768,32767)};c.i32=function(b){return f(b,-2147483648,2147483647)};c.u8=function(b){return f(b,0,255)};c.u16=function(b){return f(b,0,65535)};c.u32=function(b){return f(b,0,4294967295)};c.toUint32=function(b){g[0]=b;return e[0]};c.toFloat32=function(b){e[0]=b;return g[0]};c.u32to4Xu8=function(b){return[b&255,(b&65280)>>>
8,(b&16711680)>>>16,(b&4278190080)>>>24]};c.i1616to32=function(b,a){return 65535&b|a<<16};c.i8888to32=function(b,a,c,d){return b&255|(a&255)<<8|(c&255)<<16|d<<24};c.i8816to32=function(b,a,c){return b&255|(a&255)<<8|c<<16};c.numTo32=function(b){return b|0}})},"esri/views/2d/engine/webgl/enums":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});(function(a){a[a.FILL=0]="FILL";a[a.LINE=1]="LINE";a[a.MARKER=2]="MARKER";a[a.TEXT=3]="TEXT";a[a.LABEL=4]=
"LABEL"})(c.WGLGeometryType||(c.WGLGeometryType={}));(function(a){a[a.SUCCEEDED=0]="SUCCEEDED";a[a.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(c.WGLGeometryTransactionStatus||(c.WGLGeometryTransactionStatus={}));(function(a){a[a.NONE=0]="NONE";a[a.MAP=1]="MAP";a[a.LABEL=2]="LABEL";a[a.LABEL_ALPHA=4]="LABEL_ALPHA";a[a.HITTEST=8]="HITTEST";a[a.HIGHLIGHT=16]="HIGHLIGHT";a[a.CLIP=32]="CLIP";a[a.DEBUG=64]="DEBUG";a[a.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(c.WGLDrawPhase||(c.WGLDrawPhase={}));(function(a){a[a.SIZE=
0]="SIZE";a[a.COLOR=1]="COLOR";a[a.OPACITY=2]="OPACITY";a[a.ROTATION=3]="ROTATION"})(c.VVType||(c.VVType={}));(function(a){a[a.NONE=0]="NONE";a[a.OPACITY=1]="OPACITY";a[a.COLOR=2]="COLOR";a[a.ROTATION=4]="ROTATION";a[a.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";a[a.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";a[a.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";a[a.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(c.WGLVVFlag||(c.WGLVVFlag={}));(function(a){a[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";a[a.SCALE_TARGETS_OUTLINE=
256]="SCALE_TARGETS_OUTLINE";a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(c.WGLVVTarget||(c.WGLVVTarget={}));(function(a){a[a.SPRITE=0]="SPRITE";a[a.GLYPH=1]="GLYPH"})(c.MosaicType||(c.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Bitmap ./webgl/TiledDisplayObject".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,
"__esModule",{value:!0});a=function(b){function a(d,a,c,f){void 0===f&&(f=null);var l=b.call(this,d,a,c,c)||this;d=l.requestRender.bind(l);l.bitmap=new e.Bitmap(f,d);l.bitmap.coordScale=c;l.bitmap.once("isReady",function(){return l.ready()});return l}f(a,b);Object.defineProperty(a.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(d){this.bitmap.stencilRef=d},enumerable:!0,configurable:!0});a.prototype.setTransform=function(d,a){b.prototype.setTransform.call(this,d,
a);this.bitmap.transforms.dvs=this.transforms.dvs};a.prototype.attach=function(){this.bitmap.stage=this.stage;var d=this.bitmap.attach();d&&(this.bitmap.attached=!0);return d};a.prototype.detach=function(){this.bitmap.detach()};return a}(b.TiledDisplayObject);c.BitmapTile=a})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(d){function a(a,c,l,e){void 0===e&&(e=l);var q=d.call(this)||this;q.transforms={dvs:b.mat3f32.create(),tileMat3:b.mat3f32.create()};q.triangleCount=0;q.key=k.pool.acquire(a);q.bounds=c;q.size=l;q.coordRange=e;return q}f(a,d);a.prototype.destroy=function(){k.pool.release(this.key);this.key=null;this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(a.prototype,"coords",{get:function(){return this._coords},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bounds",{get:function(){return this._bounds},set:function(d){this._coords=[d[0],d[3]];this._bounds=d},enumerable:!0,configurable:!0});a.prototype.setTransform=function(d,b){b/=d.resolution*d.pixelRatio;var a=this.transforms.tileMat3,c=d.toScreenNoRotation([0,0],this.coords);e.mat3.set(a,this.size[0]/this.coordRange[0]*b,0,0,0,this.size[1]/this.coordRange[1]*b,0,c[0],c[1],1);e.mat3.multiply(this.transforms.dvs,d.displayViewMat3,a)};
return a}(m.DisplayObject);c.TiledDisplayObject=a})},"esri/views/2d/engine/webgl/TileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ./enums ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});c.sortByLevel=function(d,b){return 0!==d.key.level-b.key.level?d.key.level-b.key.level:0!==d.key.row-b.key.row?d.key.row-b.key.row:
d.key.col-b.key.col};a=function(d){function b(b,a){a=d.call(this,a)||this;a._tileInfoView=b;return a}f(b,d);b.prototype.renderChildren=function(b){this.sortChildren(c.sortByLevel);this.setStencilReference();d.prototype.renderChildren.call(this,b)};b.prototype.createRenderParams=function(b){var a=b.state;return g({},d.prototype.createRenderParams.call(this,b),{requiredLevel:this._tileInfoView.getClosestInfoForScale(a.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(a.scale)})};b.prototype.prepareRenderPasses=
function(b){var a=this,c=b.registerRenderPass({name:"stencil",brushes:[k.default],drawPhase:e.WGLDrawPhase.DEBUG|e.WGLDrawPhase.MAP,target:function(){return a.children}}),l=b.registerRenderPass({name:"tileInfo",brushes:[m.default],drawPhase:e.WGLDrawPhase.DEBUG,target:function(){return a.children},has:"esri-tiles-debug"});return d.prototype.prepareRenderPasses.call(this,b).concat([c,l])};b.prototype.updateTransforms=function(d){for(var b=0,a=this.children;b<a.length;b++){var c=a[b],e=this._tileInfoView.getTileResolution(c.key);
c.setTransform(d,e)}};b.prototype.setStencilReference=function(){for(var d=1,b=0,a=this.children;b<a.length;b++)a[b].stencilRef=d++};return b}(b.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",
{value:!0});a=function(d){function b(){var b=null!==d&&d.apply(this,arguments)||this;b._color=g.vec4f32.fromValues(1,0,0,1);return b}f(b,d);b.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),
this._tileInfoVertexArrayObject=null);this._canvas=null};b.prototype.prepareState=function(d){d=d.context;d.setBlendingEnabled(!0);d.setBlendFunctionSeparate(1,771,1,771);d.setColorMask(!0,!0,!0,!0);d.setStencilWriteMask(0);d.setStencilTestEnabled(!1)};b.prototype.draw=function(d,b){d=d.context;if(b.isReady){this._loadWGLResources(d);d.bindVAO(this._outlineVertexArrayObject);d.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",
b.coordRange[0],b.coordRange[1]);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);d.drawArrays(3,0,4);d.bindVAO();var a=this._getTexture(d,b);a&&(d.bindVAO(this._tileInfoVertexArrayObject),d.bindProgram(this._tileInfoProgram),d.bindTexture(a,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",b.coordRange[0]/b.size[0],b.coordRange[1]/
b.size[1]),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",a.descriptor.width,a.descriptor.height),d.drawArrays(5,0,4),d.bindVAO())}};b.prototype._loadWGLResources=function(d){if(!this._outlineProgram||!this._tileInfoProgram){var b=e.createProgram(d,m.background),a=e.createProgram(d,k.tileInfo),c={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},l=new Int8Array([0,0,1,0,1,1,0,1]),l=e.BufferObject.createVertex(d,
35044,l),l=new e.VertexArrayObject(d,m.background.attributes,c,{geometry:l}),f=new Int8Array([0,0,1,0,0,1,1,1]),f=e.BufferObject.createVertex(d,35044,f);d=new e.VertexArrayObject(d,k.tileInfo.attributes,c,{geometry:f});this._outlineProgram=b;this._tileInfoProgram=a;this._outlineVertexArrayObject=l;this._tileInfoVertexArrayObject=d}};b.prototype._getTexture=function(d,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),
this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var a=b.triangleCount,c=b.key.id;0<b.triangleCount&&(c+=", "+a);var l=this._canvas,f=l.getContext("2d");f.font="24px sans-serif";f.textAlign="left";f.textBaseline="top";f.clearRect(0,0,300,32);1E5<a?(f.fillStyle="red",f.fillRect(0,0,300,32),f.fillStyle="black"):(f.clearRect(0,0,300,32),f.fillStyle="blue");f.fillText(c,0,0);b.texture=new e.Texture(d,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,wrapMode:33071},l);return b.texture};return b}(b.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this.name=this.constructor.name||"UnnamedBrush"}a.prototype.prepareState=function(a,c,b){};a.prototype.draw=function(a,c,b){};a.prototype.drawMany=function(a,c,b){for(var e=0;e<c.length;e++)this.draw(a,c[e],b)};return a}();
c.default=a})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.background={name:"background",shaders:{vertexShader:f.resolveIncludes("background/background.vert"),fragmentShader:f.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","../../../../../webgl",
"./shaderRepository"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});var e=new f.ShaderCompiler(function(b){var a=g;b.split("/").forEach(function(b){a&&(a=a[b])});return a});c.resolveIncludes=function(b){return e.resolveIncludes(b)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(a,c){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},
bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b \x3d 1.0 / 6.0;\n  float v2 \x3d v * v;\n  float v3 \x3d v2 * v;\n  float w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 \x3d b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w \x3d computeWeights(v);\n  float g0 \x3d w.x + w.y;\n  float g1 \x3d w.z + w.w;\n  float h0 \x3d 1.0 - (w.y / g0) + v;\n  float h1 \x3d 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\n  vec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\n  vec2 texel \x3d coords * texSize - 0.5;\n  vec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 \x3d coords + hgX.x * eX;\n  vec2 coords00 \x3d coords - hgX.y * eX;\n  vec2 coords11 \x3d coords10 + hgY.x * eY;\n  vec2 coords01 \x3d coords00 + hgY.x * eY;\n  coords10 \x3d coords10 - hgY.y * eY;\n  coords00 \x3d coords00 - hgY.y * eY;\n  vec4 color00 \x3d texture2D(sampler, coords00);\n  vec4 color10 \x3d texture2D(sampler, coords10);\n  vec4 color01 \x3d texture2D(sampler, coords01);\n  vec4 color11 \x3d texture2D(sampler, coords11);\n  color00 \x3d mix(color00, color01, hgY.z);\n  color10 \x3d mix(color10, color11, hgY.z);\n  color00 \x3d mix(color00, color10, hgX.z);\n  return color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart \x3d floor(coords * texSize);\n  vec2 coord0 \x3d texelStart / texSize;\n  vec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 \x3d texture2D(sampler, coord0);\n  vec4 color1 \x3d texture2D(sampler, coord1);\n  vec4 color2 \x3d texture2D(sampler, coord2);\n  vec4 color3 \x3d texture2D(sampler, coord3);\n  vec2 blend \x3d fract(coords * texSize);\n  vec4 color01 \x3d mix(color0, color1, blend.x);\n  vec4 color23 \x3d mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize \x3d 1.0 / texSize;\n  vec2 texel \x3d coords * texSize;\n  vec2 texel_i \x3d floor(texel);\n  vec2 texel_frac \x3d fract(texel);\n  vec4 colorP \x3d texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 \x3d vec4(colorP);\n  vec4 colorP2 \x3d vec4(colorP);\n  vec4 colorP3 \x3d vec4(colorP);\n  vec4 colorP4 \x3d vec4(colorP);\n  vec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\n    colorP1 \x3d colorA;\n  }\n  if (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\n    colorP2 \x3d colorB;\n  }\n  if (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\n    colorP3 \x3d colorC;\n  }\n  if (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\n    colorP4 \x3d colorD;\n  }\n  vec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\n  float flags \x3d data0.r * 255.0;\n  float groupMinZoom \x3d data0.g * 255.0;\n  float isVisible \x3d getFilterBit(flags, 0);\n  float wouldClip \x3d step(groupMinZoom, u_zoomLevel);\n  float direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState \x3d vec4(texel + direction * dt);\n  gl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  highp vec4 texel \x3d unpackLocalIdTexel(id);\n  highp float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256 + int(texel.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getFilterBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\n#include \x3cmaterials/effects.glsl\x3e\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor \x3d getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision highp float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef PATTERN\nmat3 getPatternMatrix() {\n  mat3 patternMatrix \x3d mat3(1.0);\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\n  return patternMatrix;\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color     \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity   \x3d getOpacity(a_bitSet, 1);\n  v_id        \x3d norm(a_id);\n  v_pos       \x3d u_dvsMat3 * vec3(a_pos, 1.);\n  v_flags     \x3d getFilterFlags();\n#ifdef PATTERN\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\n  v_tileTextureCoord \x3d (getPatternMatrix() * vec3(a_pos + symbolOffset, 1.0)).xy;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},
icon:{"common.glsl":"uniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying highp float v_filters;\nvarying lowp float v_opacity;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  vec2 v_size \x3d v_sizeTex.xy;\n  vec2 v_tex  \x3d v_sizeTex.zw;\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 256.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 256.0;\n  float a_bitSet \x3d a_bitSetAndDistRatio.z;\n  vec2 v_size \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 256.0, a_bitSet);\n  vec2 v_tex      \x3d a_texCoords / u_mosaicSize;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity(a_bitSet, 1);\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos, 1.0) + getOffset(a_offset, a_bitSet);\n  v_sizeTex  \x3d vec4(v_size.xy, v_tex.xy);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"precision mediump float;\n#include \x3cmaterials/label/common.glsl\x3e\nuniform mediump vec2 u_screenSize;\nuniform highp float u_pixelRatio;\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\n  gl_FragColor \x3d v_animation.r * sdfAlpha * v_color;\n}",
"label.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_zoomRangeAndEmpty;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/label/common.glsl\x3e\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_zoomRangeAndEmpty.x;\n  float a_minZoom       \x3d max(groupMinZoom, glyphMinZoom);\n  float a_maxZoom       \x3d a_zoomRangeAndEmpty.y;\n  vec2  a_placementDir  \x3d a_refSymbolAndPlacementOffset.zw - 1.0;\n  float a_refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize        \x3d a_texAndSize.z;\n  float isHalo          \x3d mod(a_pos, 2.0).x;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float z            \x3d getZ(a_minZoom, a_maxZoom, a_refSymbolAndPlacementOffset.x);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  v_color     \x3d a_color;\n  v_tex       \x3d a_texAndSize.xy / u_mosaicSize;\n  v_animation \x3d pow(getAnimationState(), vec4(2.0));\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texAndSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.106 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + PLACEMENT_PADDING);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\nvarying highp vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity(a_bitSet, 0);\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  #ifdef HIGHLIGHT\n    glyphEdgeDistance /\x3d 2.0;\n  #endif\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_opacity;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio \x3d baseSize / referenceSize;\n   baseSize \x3d ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet    \x3d a_aux.w;\n  float a_fontSize  \x3d a_texFontSize.z;\n  vec2  a_offset    \x3d a_vertexOffset * OFFSET_PRECISION;\n  float a_isHalo    \x3d getBit(a_pos.x, 0);\n  vec3  in_pos      \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float fontSize    \x3d getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor \x3d fontSize / a_fontSize;\n  float fontScale   \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset      \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  v_color   \x3d a_isHalo * a_color + (1.0 - a_isHalo) * getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 0);\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texFontSize.xy / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + u_displayMat3 * offset;\n  v_edgeDistanceOffset \x3d a_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nhighp vec4 unpackLocalIdTexel(in highp vec4 bitset) {\n  float isAggregate \x3d getBit(bitset.a, 7);\n  return (1.0 - isAggregate) * bitset + isAggregate * (vec4(bitset.rgba) - vec4(0.0, 0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData2(a_id);\n#else\n  vec4 data0 \x3d getAttributeData2(a_id);\n  vec4 data1 \x3d getAttributeData3(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity(in float a_bitSet, in int index) {\n#ifdef VV_OPACITY\n  float isOpacityLocked \x3d getBit(a_bitSet, index);\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY], isOpacityLocked);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(VV_ADATA[ATTR_VV_ROTATION]);\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue, float isOpacityLocked) {\n  if (isNan(opacityValue) || isOpacityLocked \x3d\x3d 1.0) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  float outSize \x3d getVVStopsSize(vvSize, size);\n  return isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_isFloatTexture;\nuniform bool u_flipY;\nuniform bool u_applyTransform;\nuniform float u_opacity;\nuniform int u_resampling;\n#include \x3craster/common/projection.glsl\x3e\nvec2 getPixelLocation(vec2 coords) {\n  vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n  if (!u_applyTransform) {\n    return targetLocation;\n  }\n  return projectPixelLocation(targetLocation);\n}\nbool isOutside(vec2 coords){\n   if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n     return true;\n   } else {\n     return false;\n   }\n}\nvec4 getPixel(vec2 pixelLocation) {\n  return texture2D(u_image, pixelLocation);\n}",
"contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\n  vec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\n  float maxI \x3d 255.0;\n  float mid \x3d 128.0;\n  float c \x3d u_contrastOffset;\n  float b \x3d u_brightnessOffset;\n  vec4 v;\n  if (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n  } else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n  } else if (c \x3d\x3d 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\n    v \x3d (sign(v) + 1.0) / 2.0;\n  } else if (c \x3d\x3d -100.0) {\n    v \x3d vec4(mid, mid, mid, currentPixel.a);\n  }\n  return vec4(v.r / 255.0, v.g / 255.0, v.b / 255.0, currentPixel.a);\n}",
"projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n  vec2 index_image \x3d floor(coords * u_targetImageSize);\n  vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n  vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n  vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n  vec2 srcLocation;\n  vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n  if (pos.s \x3c\x3d pos.t) {\n    vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n    vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n  } else {\n    vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n    vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n  }\n  return srcLocation;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform bool u_applyColormap;\n#include \x3craster/lut/colorize.glsl\x3e\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n  if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n    return 0.0;\n  }\n  else {\n    return e;\n  }\n}\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  if (currentPixel.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec2 axy \x3d vec2(-1.0, -1.0);\n  vec2 bxy \x3d vec2(0.0, -1.0);\n  vec2 cxy \x3d vec2(1.0, -1.0);\n  vec2 dxy \x3d vec2(-1.0, 0.0);\n  vec2 fxy \x3d vec2(1.0, 0.0);\n  vec2 gxy \x3d vec2(-1.0, 1.0);\n  vec2 hxy \x3d vec2(0.0, 1.0);\n  vec2 ixy \x3d vec2(1.0, 1.0);\n  vec2 onePixel \x3d 1.0 / u_srcImageSize;\n  if (pixelLocation.s \x3c onePixel.s) {\n    axy[0] \x3d 1.0;\n    dxy[0] \x3d 1.0;\n    gxy[0] \x3d 1.0;\n  }\n  if (pixelLocation.t \x3c onePixel.t) {\n    axy[1] \x3d 1.0;\n    bxy[1] \x3d 1.0;\n    cxy[1] \x3d 1.0;\n  }\n  if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n    cxy[0] \x3d -1.0;\n    fxy[0] \x3d -1.0;\n    ixy[0] \x3d -1.0;\n  }\n  if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n    gxy[1] \x3d -1.0;\n    hxy[1] \x3d -1.0;\n    ixy[1] \x3d -1.0;\n  }\n  vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n  vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n  vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n  vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n  vec4 ve \x3d texture2D(u_image, pixelLocation);\n  vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n  vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n  vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n  vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n  float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n  float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n  float s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n  float hillshade \x3d 0.0;\n  if (u_hillshadeType \x3d\x3d 0){\n\t   float cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\n     float z \x3d (u_cosZ + cosDelta) / s2;\n     if (z \x3c 0.0)  z \x3d 0.0;\n\t   hillshade \x3d z;\n  } else {\n\t  for (int k \x3d 0; k \x3c 6; k++) {\n\t\t float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n\t\t float z \x3d (u_cosZs[k] + cosDelta) / s2;\n\t\t if (z \x3c 0.0) z \x3d 0.0;\n     hillshade \x3d hillshade + z * u_weights[k];\n\t\t if (k \x3d\x3d 5) break;\n    }\n  }\n  float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n  if (u_applyColormap) {\n    gl_FragColor \x3d colorize(vec4(hillshade, hillshade, hillshade, alpha), false);\n  } else {\n    hillshade *\x3d alpha;\n    gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n  }\n}",
"hillshade.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, bool isFloat) {\n  float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n  vec4 result;\n  if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n    result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n  } else {\n    vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n    vec4 color \x3d texture2D(u_colormap, clrPosition);\n    result \x3d vec4(color.rgb, color.a * u_opacity);\n  }\n  return result;\n}",
"lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  gl_FragColor \x3d colorize(currentPixel, true);\n}","lut.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nuniform bool u_applyColormap;\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n  if (val \x3e\x3d maxCutOff) {\n    return maxOutput;\n  } else if (val \x3c\x3d minCutOff) {\n    return minOutput;\n  }\n  float stretchedVal;\n  if (useGamma) {\n  \tfloat tempf \x3d 1.0;\n\t  float outRange \x3d maxOutput - minOutput;\n\t  float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n\t  if (gamma \x3e 1.0) {\n      tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n    }\n    stretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n  } else {\n    stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n  }\n  return stretchedVal;\n}\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  if (currentPixel.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  if (u_bandCount \x3d\x3d 1) {\n    float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    if (u_applyColormap) {\n      gl_FragColor \x3d colorize(vec4(grayVal, grayVal, grayVal, currentPixel.a), true);\n    } else {\n      gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n    }\n  } else {\n    float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n    float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n    gl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n  }\n}",
"stretch.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}",
"tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},
"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.tileInfo={name:"tileInfo",shaders:{vertexShader:f.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:f.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});a=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d._color=g.vec4f32.fromValues(1,0,0,1);d._initialized=!1;return d}f(d,b);d.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};d.prototype.prepareState=function(d,b){d=d.context;d.setDepthWriteEnabled(!1);
d.setDepthTestEnabled(!1);d.setStencilTestEnabled(!0);d.setBlendingEnabled(!1);d.setColorMask(!1,!1,!1,!1);d.setStencilOp(7680,7680,7681);d.setStencilWriteMask(255);d.setStencilFunctionSeparate(1032,516,b.stencilRef,255)};d.prototype.draw=function(d,b){d=d.context;this._initialized||this._initialize(d);d.bindVAO(this._solidVertexArrayObject);d.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._solidProgram.setUniform2fv("u_coord_range",b.coordRange);
this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);d.drawArrays(5,0,4);d.bindVAO()};d.prototype._initialize=function(d){if(this._initialized)return!0;var b=e.createProgram(d,m.background);if(!b)return!1;var a=new Int8Array([0,0,1,0,0,1,1,1]),a=e.BufferObject.createVertex(d,35044,a);d=new e.VertexArrayObject(d,m.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:a});this._solidProgram=
b;this._solidVertexArrayObject=d;return this._initialized=!0};return d}(b.default);c.default=a})},"esri/views/2d/engine/RasterTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./RasterBitmap ./webgl/TiledDisplayObject".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});a=function(b){function a(d,a,c,f){void 0===f&&(f=null);var l=b.call(this,d,a,c)||this;d=l.requestRender.bind(l);l.bitmap=new e.RasterBitmap(f,
null,null,d);l.bitmap.coordScale=c;l.bitmap.once("isReady",function(){return l.ready()});return l}f(a,b);Object.defineProperty(a.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(d){this.bitmap.stencilRef=d},enumerable:!0,configurable:!0});a.prototype.setTransform=function(d,a){b.prototype.setTransform.call(this,d,a);this.bitmap.transforms.dvs=this.transforms.dvs};a.prototype.attach=function(){this.bitmap.stage=this.stage;var d=this.bitmap.attach();d&&(this.bitmap.attached=
!0);return d};a.prototype.detach=function(){this.bitmap.detach()};return a}(b.TiledDisplayObject);c.RasterTile=a})},"esri/views/2d/engine/RasterBitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../../layers/support/rasterFunctions/pixelUtils ./DisplayObject ./webgl/WGLRasterUtils".split(" "),function(a,c,f,g,e,b,m,
k,d,l){function q(d){x.has(d)&&(v.splice(v.indexOf(d),1),x.delete(d))}Object.defineProperty(c,"__esModule",{value:!0});var v=[],x=new Set,p={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};a=function(d){function a(a,c,e,h){void 0===a&&(a=null);void 0===c&&(c=null);void 0===e&&(e=null);void 0===h&&(h=function(){return null});var l=d.call(this)||this;
l.stencilRef=0;l.coordScale=[1,1];l._symbolizerParameters=null;l.height=null;l.pixelRatio=1;l.resolution=0;l.rotation=0;l._source=null;l.rawPixelData=null;l._suspended=!1;l._bandIds=null;l._interpolation=null;l._transformGrid=null;l.width=null;l.x=0;l.y=0;l.transforms={dvs:b.mat3f32.create()};l.source=a;l.transformGrid=c;l.interpolation=e;l.requestRender=h;return l}f(a,d);Object.defineProperty(a.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||p},set:function(d){this._symbolizerParameters=
d},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"source",{get:function(){return this._source},set:function(d){this._source=d;this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"suspended",{get:function(){return this._suspended},set:function(d){this._suspended&&!d&&this.attached&&(this.ready(),this.requestRender());this._suspended=d},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"bandIds",{get:function(){return this._bandIds},set:function(d){this.attached&&this._updateRasterTexture(d);this._bandIds=d},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"interpolation",{get:function(){return this._interpolation},set:function(d){this._interpolation=d;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===d?9729:9728)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(d){this._transformGrid=
d;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null)},enumerable:!0,configurable:!0});a.prototype.attach=function(){this.updateTexture();return!0};a.prototype.detach=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);q(this)};a.prototype.invalidateTexture=
function(){this.attached?this.updateTexture():q(this)};a.prototype.setTransform=function(d){var b=e.mat3.identity(this.transforms.dvs),a=d.toScreenNoRotation([0,0],this.x,this.y),c=this.resolution/this.pixelRatio/d.resolution,l=c*this.width,c=c*this.height,f=Math.PI*this.rotation/180;e.mat3.translate(b,b,m.vec2f32.fromValues(a[0],a[1]));e.mat3.translate(b,b,m.vec2f32.fromValues(l/2,c/2));e.mat3.rotate(b,b,-f);e.mat3.translate(b,b,m.vec2f32.fromValues(-l/2,-c/2));e.mat3.scaleByVec2(b,b,m.vec2f32.fromValues(l,
c));e.mat3.multiply(this.transforms.dvs,d.displayViewMat3,b)};a.prototype.updateTexture=function(){var d=this.stage.context,b=this.source,b=b&&b.pixels&&0<b.pixels.length;!this._rasterTexture&&b&&this._updateRasterTexture(this.bandIds);this._rasterTexture&&b&&(this._updateColormapTexture(),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=l.createTransformTexture(d,this.transformGrid)));this._rasterTexture&&!b&&this._rasterTexture.setData(null);this.suspended||(this.ready(),
this.requestRender())};a.prototype.getUniforms=function(){var d=this.source,b=this.transformGrid,a;switch(this.symbolizerParameters.type){case "lut":a=this._getColormapUniforms();break;case "stretch":a=this._getStretchUniforms();break;case "hillshade":a=this._getShadedReliefUniforms()}d=g({},a,{u_srcImageSize:[d.width,d.height],u_resampling:"nearest",u_flipY:!0,u_applyTransform:b?!0:!1,u_dvsMat3:this.transforms.dvs});this.transformGrid&&(d.u_transformSpacing=b.spacing,d.u_transformGridSize=b.size,
d.u_targetImageSize=new Float32Array([this.width,this.height]));return d};a.prototype.getTextures=function(){if(!this._rasterTexture)return null;var d=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),d.push("u_transformGrid"));this._rasterTexture&&(b.push(this._rasterTexture),d.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),d.push("u_colormap"));return{names:d,textures:b}};a.prototype._getColormapUniforms=function(){var d=this.symbolizerParameters;return{u_colormapOffset:d.colormapOffset||
0,u_colormapMaxIndex:d.colormap.length/4-1,u_isFloatTexture:!1}};a.prototype._getStretchUniforms=function(){var d=this.symbolizerParameters,b={u_bandCount:d.bandCount,u_minOutput:d.outMin,u_maxOutput:d.outMax,u_minCutOff:d.minCutOff,u_maxCutOff:d.maxCutOff,u_factor:d.factor,u_useGamma:d.useGamma,u_gamma:d.gamma,u_gammaCorrection:d.gammaCorrection,u_contrast:d.contrast,u_brightness:d.brightness};d.colormap&&(b.u_colormapOffset=d.colormapOffset||0,b.u_colormapMaxIndex=d.colormap.length/4-1,b.u_isFloatTexture=
!1,b.u_applyColormap=!0);return b};a.prototype._getShadedReliefUniforms=function(){var d=this.symbolizerParameters,b={u_hillshadeType:d.hillshadeType,u_sinZcosA:d.sinZcosA,u_sinZsinA:d.sinZsinA,u_cosZ:d.cosZ,u_sinZcosAs:d.sinZcosAs,u_sinZsinAs:d.sinZsinAs,u_cosZs:d.cosZs,u_weights:d.weights,u_factor:d.factor,u_applyColormap:!1};d.colormap&&(b.u_colormapOffset=d.colormapOffset||0,b.u_colormapMaxIndex=d.colormap.length/4-1,b.u_isFloatTexture=!1,b.u_applyColormap=!0);return b};a.prototype._updateRasterTexture=
function(d){var b=this.source?k.extractBands(this.source,d):null;if(b&&b.pixels&&0<b.pixels.length){d=null==d&&null==this.bandIds||d&&this.bandIds&&d.join("")===this.bandIds.join("");if(this._rasterTexture){if(d)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=l.createRasterTexture(this.stage.context,b,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};a.prototype._updateColormapTexture=function(){var d=
this._colormap,b=this.symbolizerParameters.colormap;if(b){var a=this.stage.context;if(!d)this._colormapTexture=l.createColormapTexture(a,b),this._colormap=b;else if(b.length!==d.length||b.some(function(b,a){return b!==d[a]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=l.createColormapTexture(a,b),this._colormap=b}else this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null};return a}(d.DisplayObject);
c.RasterBitmap=a})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(a,c,f){function g(b,d){b=Math.min(Math.max(b,-100),100);d=Math.min(Math.max(d,-100),100);var a,c,e=new Uint8Array(256);for(a=0;256>a;a++)0<b&&100>b?c=(200*a-25500+510*d)/(2*(100-b))+128:0>=b&&-100<b?c=(200*a-25500+510*d)*(100+b)/2E4+128:100===b?(c=200*a-25500+256*(100-b)+510*d,c=0<c?255:0):-100===b&&(c=128),e[a]=255<c?255:0>c?0:c;return e}function e(b,d,a,c,e,f,p,g){return{xmin:e<=
a*b?0:e<a*b+b?e-a*b:b,ymin:f<=c*d?0:f<c*d+d?f-c*d:d,xmax:e+p<=a*b?0:e+p<a*b+b?e+p-a*b:b,ymax:f+g<=c*d?0:f+g<c*d+d?f+g-c*d:d}}function b(b,d,a,c){var l=b.filter(function(d){return m(d)})[0];if(null==l)return null;var k=c?c.width:d.width;c=c?c.height:d.height;var q=l.width,g=l.height,r=d.width/q;d=d.height/g;var w=a?a.x:0;a=a?a.y:0;var n=l.pixelType,u=f.getPixelArrayConstructor(n),h=l.pixels.length,l=[],y,t,A,B,C,D,K,E,I,G;for(C=0;C<h;C++){t=new u(k*c);for(D=0;D<d;D++)for(K=0;K<r;K++)if(A=b[D*r+K])for(y=
A.pixels[C],G=e(q,g,K,D,w,a,k,c),E=G.ymin;E<G.ymax;E++)for(A=(D*g+E-a)*k+(K*q-w),B=E*q,I=G.xmin;I<G.xmax;I++)t[A+I]=y[B+I];l.push(t)}var N;if(b.some(function(d){return null==d||d.mask&&0<d.mask.length}))for(N=new Uint8Array(k*c),D=0;D<d;D++)for(K=0;K<r;K++)if(u=(A=b[D*r+K])?A.mask:null,G=e(q,g,K,D,w,a,k,c),u)for(E=G.ymin;E<G.ymax;E++)for(A=(D*g+E-a)*k+(K*q-w),B=E*q,I=G.xmin;I<G.xmax;I++)N[A+I]=u[B+I];else if(A)for(E=G.ymin;E<G.ymax;E++)for(A=(D*g+E-a)*k+(K*q-w),B=E*q,I=G.xmin;I<G.xmax;I++)N[A+I]=
1;else for(E=G.ymin;E<G.ymax;E++)for(A=(D*g+E-a)*k+(K*q-w),B=E*q,I=G.xmin;I<G.xmax;I++)N[A+I]=0;b=new f({width:k,height:c,pixels:l,pixelType:n,mask:N});b.updateStatistics();return b}Object.defineProperty(c,"__esModule",{value:!0});var m=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};c.extractBands=function(b,d){if(!d||!m(b))return b;var a=b.pixels.length;return d&&d.some(function(d){return d>=a})||1===a&&1===d.length&&0===d[0]||a===d.length&&
!d.some(function(d,b){return d!==b})?b:new f({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:d.map(function(d){return b.pixels[d]}),statistics:b.statistics&&d.map(function(d){return b.statistics[d]})})};c.createColormapLUT=function(b){if(b){var d=b.colormap;if(d&&0!==d.length){var d=d.sort(function(d,b){return d[0]-b[0]}),a=0;0>d[0][0]&&(a=d[0][0]);var c=Math.max(256,d[d.length-1][0]-a+1),e=new Uint8Array(4*c),f=[],
k=0,g=0,m=5===d[0].length;if(65536<c)return d.forEach(function(d){f[d[0]-a]=m?d.slice(1):d.slice(1).concat([255])}),{indexed2DColormap:f,offset:a,alphaSpecified:m};if(b.fillUnspecified)for(b=d[g],k=b[0]-a;k<c;k++)e[4*k]=b[1],e[4*k+1]=b[2],e[4*k+2]=b[3],e[4*k+3]=m?b[4]:255,k===b[0]-a&&(b=g===d.length-1?b:d[++g]);else for(k=0;k<d.length;k++)b=d[k],g=4*(b[0]-a),e[g]=b[1],e[g+1]=b[2],e[g+2]=b[3],e[g+3]=m?b[4]:255;return{indexedColormap:e,offset:a,alphaSpecified:m}}}};c.colorize=function(b,d){if(!m(b)||
!d&&(d.indexedColormap||d.indexed2DColormap))return b;var a=b.clone(),c=a.pixels,e=a.mask,f=a.width*a.height;if(1!==c.length)return b;var k=d.indexedColormap;b=d.indexed2DColormap;var g=d.offset;d=d.alphaSpecified;var r=k.length-1,w=0,c=c[0],n=new Uint8Array(c.length),u=new Uint8Array(c.length),h=new Uint8Array(c.length),y=0;if(k)if(e)for(w=0;w<f;w++)e[w]&&(y=4*(c[w]-g),y<g||y>r?e[w]=0:(n[w]=k[y],u[w]=k[y+1],h[w]=k[y+2],e[w]=k[y+3]));else{e=new Uint8Array(f);for(w=0;w<f;w++)y=4*(c[w]-g),y<g||y>r?
e[w]=0:(n[w]=k[y],u[w]=k[y+1],h[w]=k[y+2],e[w]=k[y+3]);a.mask=e}else if(e)for(w=0;w<f;w++)e[w]&&(k=b[c[w]],n[w]=k[0],u[w]=k[1],h[w]=k[2],e[w]=k[3]);else{e=new Uint8Array(f);for(w=0;w<f;w++)k=b[c[w]],n[w]=k[0],u[w]=k[1],h[w]=k[2],e[w]=k[3];a.mask=e}a.pixels=[n,u,h];a.statistics=null;a.pixelType="u8";a.maskIsAlpha=d;return a};c.estimateStatisticsHistograms=function(b){if(!m(b))return null;b.statistics||b.updateStatistics();var d=b.pixels,a=b.mask,c=b.pixelType,e=b.statistics;b=b.width*b.height;var f=
d.length,k,g,r,w,n,u=[],h=[],y,t,A;for(w=0;w<f;w++){y=new Uint32Array(256);A=d[w];if("u8"===c)if(k=-.5,g=255.5,a)for(n=0;n<b;n++)a[n]&&y[A[n]]++;else for(n=0;n<b;n++)y[A[n]]++;else{k=e[w].minValue;g=e[w].maxValue;r=(g-k)/256;t=new Uint32Array(257);if(a)for(n=0;n<b;n++)a[n]&&t[Math.floor((A[n]-k)/r)]++;else for(n=0;n<b;n++)t[Math.floor((A[n]-k)/r)]++;for(n=0;255>n;n++)y[n]=t[n];y[255]=t[255]+t[256]}u.push({min:k,max:g,size:256,counts:y});for(n=A=t=r=0;256>n;n++)r+=y[n],t+=n*y[n];t/=r;for(n=0;256>n;n++)A+=
y[n]*Math.pow(n-t,2);y=Math.sqrt(A/(r-1));r=(g-k)/256;n=(t+.5)*r+k;y*=r;h.push({min:k,max:g,avg:n,stddev:y})}return{statistics:h,histograms:u}};c.createStretchLUT=function(b){var d=b.minCutOff,a=b.maxCutOff,c=b.gamma,e=b.pixelType,f=b.outMin||0,k=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(e))return null;var m=d.length,r,w=0;"s8"===e?w=-127:"s16"===e&&(w=-32767);var n=256;-1<["u16","s16"].indexOf(e)&&(n=65536);for(var u=[],h=k-f,e=0;e<m;e++)u[e]=a[e]-d[e];r=c&&c.length>=m;var y=[];if(r)for(e=
0;e<m;e++)y[e]=1<c[e]?2<c[e]?6.5+Math.pow(c[e]-2,2.5):6.5+100*Math.pow(2-c[e],4):1;var t,A=[],B,C,D;if(r)for(e=0;e<m;e++){D=[];for(r=0;r<n;r++)B=r+w,t=(B-d[e])/u[e],C=1,1<c[e]&&(C-=Math.pow(1/h,t*y[e])),D[r]=B<a[e]&&B>d[e]?Math.floor(C*h*Math.pow(t,1/c[e]))+f:B>=a[e]?k:f;A[e]=D}else for(e=0;e<m;e++){D=[];for(r=0;r<n;r++)B=r+w,D[r]=B<=d[e]?f:B>=a[e]?k:Math.floor((B-d[e])/u[e]*h)+f;A[e]=D}if(null!=b.contrastOffset)for(b=g(b.contrastOffset,b.brightnessOffset),e=0;e<m;e++)for(D=A[e],r=0;r<n;r++)D[r]=
b[D[r]];return{lut:A,offset:w}};c.createContrastBrightnessLUT=g;c.stretch=function(b,d){if(!m(b))return null;b=b.clone();var a=b.pixels,c=b.mask,e=d.minCutOff,f=d.maxCutOff,k=d.gamma,g=d.outMin||0;d=d.outMax||255;var r=b.width*b.height,w=a.length,n,u,h,y,t,A=d-g,B=[];for(n=0;n<w;n++)B[n]=f[n]-e[n];u=k&&k.length>=w;var C=[];if(u)for(n=0;n<w;n++)C[n]=1<k[n]?2<k[n]?6.5+Math.pow(k[n]-2,2.5):6.5+100*Math.pow(2-k[n],4):1;if(u)if(null!=c)for(u=0;u<r;u++){if(c[u])for(n=0;n<w;n++)h=a[n][u],t=(h-e[n])/B[n],
y=1,1<k[n]&&(y-=Math.pow(1/A,t*C[n])),a[n][u]=h<f[n]&&h>e[n]?Math.floor(y*A*Math.pow(t,1/k[n]))+g:h>=f[n]?d:g}else for(u=0;u<r;u++)for(n=0;n<w;n++)h=a[n][u],t=(h-e[n])/B[n],y=1,1<k[n]&&(y-=Math.pow(1/A,t*C[n])),a[n][u]=h<f[n]&&h>e[n]?Math.floor(y*A*Math.pow(t,1/k[n]))+g:h>=f[n]?d:g;else if(null!=c)for(u=0;u<r;u++){if(c[u])for(n=0;n<w;n++)h=a[n][u],a[n][u]=h<f[n]&&h>e[n]?Math.floor((h-e[n])/B[n]*A)+g:h>=f[n]?d:g}else for(u=0;u<r;u++)for(n=0;n<w;n++)h=a[n][u],a[n][u]=h<f[n]&&h>e[n]?Math.floor((h-e[n])/
B[n]*A)+g:h>=f[n]?d:g;b.pixelType="u8";b.updateStatistics();return b};c.lookupPixels=function(b,d){if(!m(b))return null;var a=b.pixels,c=b.mask,e=b.width*b.height,k=a.length,g=d.lut;d=d.offset;var z,r;g&&1===g[0].length&&(g=a.map(function(){return g}));var w=[],n,u,h;if(d)if(null==c)for(z=0;z<k;z++){n=a[z];u=g[z];h=new Uint8Array(e);for(r=0;r<e;r++)h[r]=u[n[r]-d];w.push(h)}else for(z=0;z<k;z++){n=a[z];u=g[z];h=new Uint8Array(e);for(r=0;r<e;r++)c[r]&&(h[r]=u[n[r]-d]);w.push(h)}else if(null==c)for(z=
0;z<k;z++){n=a[z];u=g[z];h=new Uint8Array(e);for(r=0;r<e;r++)h[r]=u[n[r]];w.push(h)}else for(z=0;z<k;z++){n=a[z];u=g[z];h=new Uint8Array(e);for(r=0;r<e;r++)c[r]&&(h[r]=u[n[r]]);w.push(h)}b=new f({width:b.width,height:b.height,pixels:w,mask:c,pixelType:"u8"});b.updateStatistics();return b};c.remapColor=function(b,d){if(!m(b))return null;b=b.clone();var a=b.width*b.height,c=d.length,e=Math.floor(c/2),f=d[Math.floor(e)],k=b.pixels[0],g,r,w,n,u,h,y=!1,t=new Uint8Array(a),A=new Uint8Array(a),B=new Uint8Array(a),
C=b.mask,D=4===d[0].mappedColor.length;C||(C=new Uint8Array(a),C.fill(D?255:1),b.mask=C);for(u=0;u<a;u++)if(C[u]){g=k[u];y=!1;h=e;r=f;w=0;for(n=c-1;1<n-w;){if(g===r.value){y=!0;break}g>r.value?w=h:n=h;h=Math.floor((w+n)/2);r=d[Math.floor(h)]}y||(g===d[w].value?(r=d[w],y=!0):g===d[n].value?(r=d[n],y=!0):g<d[w].value?(y=!1,r=null):g>d[w].value&&(g<d[n].value?(r=d[w],y=!0):n===c-1?(y=!1,r=null):(r=d[n],y=!0)));y?(t[u]=r.mappedColor[0],A[u]=r.mappedColor[1],B[u]=r.mappedColor[2],C[u]=r.mappedColor[3]):
t[u]=A[u]=B[u]=C[u]=0}b.pixels=[t,A,B];b.mask=C;b.pixelType="u8";b.maskIsAlpha=D;return b};c.getClipBounds=e;c.mosaicPixelData=function(a,d){if(!a||0===a.length)return null;var c=a.filter(function(d){return d.pixelBlock})[0];if(!c)return null;var e=(c.extent.xmax-c.extent.xmin)/c.pixelBlock.width,f=(c.extent.ymax-c.extent.ymin)/c.pixelBlock.height,k=.01*Math.min(e,f),g=a.sort(function(d,b){return Math.abs(d.extent.ymax-b.extent.ymax)>k?b.extent.ymax-d.extent.ymax:Math.abs(d.extent.xmin-b.extent.xmin)>
k?d.extent.xmin-b.extent.xmin:0}),m=Math.min.apply(null,g.map(function(d){return d.extent.xmin})),r=Math.min.apply(null,g.map(function(d){return d.extent.ymin})),w=Math.max.apply(null,g.map(function(d){return d.extent.xmax})),n=Math.max.apply(null,g.map(function(d){return d.extent.ymax}));a={x:Math.round((d.xmin-m)/e),y:Math.round((n-d.ymax)/f)};m={width:Math.round((w-m)/e),height:Math.round((n-r)/f)};e={width:Math.round((d.xmax-d.xmin)/e),height:Math.round((d.ymax-d.ymin)/f)};if(Math.round(m.width/
c.pixelBlock.width)*Math.round(m.height/c.pixelBlock.height)!==g.length||0>a.x||0>a.y||m.width<e.width||m.height<e.height)return null;c=g.map(function(d){return d.pixelBlock});c=b(c,m,a,e);return{extent:d,pixelBlock:c}};c.mosaic=b;c.setValidBoundary=function(b,d,a){if(!m(b))return null;var c=b.width,e=b.height,f=d.x;d=d.y;var l=a.width+f;a=a.height+d;if(0>f||0>d||l>c||a>e||0===f&&0===d&&l===c&&a===e)return b;b.mask||(b.mask=new Uint8Array(c*e));for(var k=b.mask,g=0;g<e;g++)for(var w=g*c,n=0;n<c;n++)k[w+
n]=g<d||g>=a||n<f||n>=l?0:1;b.updateStatistics();return b};c.clip=function(b,d,a){if(!m(b))return null;var c=d.x,e=d.y,l=d.x+a.width;d=d.x+a.height;if(d===b.height&&l===b.width)return b;for(var k=b.pixels,g=b.mask,r=b.width,w=r*b.height,n=k.length,u=[],h=0;h<n;h++){for(var y=k[h],t=f.createEmptyBand(b.pixelType,w),A=0,B=e;B<=d;B++)for(var C=B*r,D=c;D<=l;D++)t[A++]=y[C+D];u.push(t)}var K;if(g)for(K=new Uint8Array(a.width*a.height),A=0,B=e;B<=d;B++)for(C=B*r,D=c;D<=l;D++)K[A++]=g[C+D];b=new f({width:a.width,
height:a.height,pixels:u,mask:K});b.updateStatistics();return b};c.approximateTransform=function(b,d,a,c){if(!m(b))return null;var e=b.pixels,l=b.mask,k=b.pixelType,q=b.width,g=b.height;b=f.getPixelArrayConstructor(k);var w=e.length,n=d.width,u=d.height;d=c.cols;var h=c.rows,y=Math.ceil(n/d),t=Math.ceil(u/h),A=!1;for(c=0;c<a.length;c+=3)-1===a[c]&&-1===a[c+1]&&-1===a[c+2]&&(A=!0);var B,C,D,K,E,I,G,N=new Float32Array(n*u),F=new Float32Array(n*u),H=0,M,L;for(c=0;c<t;c++)for(var J=0;J<y;J++){B=12*(c*
y+J);C=a[B];D=a[B+1];K=a[B+2];E=a[B+3];I=a[B+4];G=a[B+5];for(var O=0;O<h;O++){H=(c*h+O)*n+J*d;L=(O+.5)/h;for(var Q=0;Q<O;Q++)M=(Q+.5)/d,N[H+Q]=Math.round((C*M+D*L+K)*q-.5),F[H+Q]=Math.round((E*M+I*L+G)*g-.5)}B+=6;C=a[B];D=a[B+1];K=a[B+2];E=a[B+3];I=a[B+4];G=a[B+5];for(O=0;O<h;O++)for(H=(c*h+O)*n+J*d,L=(O+.5)/h,Q=O;Q<d;Q++)M=(Q+.5)/d,N[H+Q]=Math.round((C*M+D*L+K)*q-.5),F[H+Q]=Math.round((E*M+I*L+G)*g-.5)}a=function(d,b){for(var a=0;a<u;a++){B=a*n;for(var c=0;c<n;c++)d[B]=A&&(0>N[B]||0>F[B])?0:b[N[B]+
F[B]*q],B++}};g=[];for(c=0;c<w;c++)d=new b(n*u),a(d,e[c]),g.push(d);e=new f({width:n,height:u,pixelType:k,pixels:g});if(l)e.mask=new Uint8Array(n*u),a(e.mask,l);else if(A)for(e.mask=new Uint8Array(n*u),c=0;c<n*u;c++)e.mask[c]=0>N[c]||0>F[c]?0:1;e.updateStatistics();return e}})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(a,c,f,g,e,b,m,k,d,l){var q=d.getLogger("esri.layers.support.PixelBlock");return function(d){function a(b){b=d.call(this,b)||this;b.width=null;b.height=null;b.pixelType="f32";b.validPixelCount=null;b.mask=null;b.maskIsAlpha=!1;b.pixels=null;b.statistics=null;return b}f(a,d);c=a;a.createEmptyBand=function(b,d){return new (c.getPixelArrayConstructor(b))(d)};a.getPixelArrayConstructor=function(b){var d;switch(b){case "u1":case "u2":case "u4":case "u8":d=Uint8Array;break;case "u16":d=Uint16Array;
break;case "u32":d=Uint32Array;break;case "s8":d=Int8Array;break;case "s16":d=Int16Array;break;case "s32":d=Int32Array;break;case "u32":d=Uint32Array;break;case "f32":d=Float32Array;break;case "f64":d=Float64Array;break;case "c64":case "c128":case "unknown":d=Float32Array;break;default:e.neverReached(b)}return d};a.prototype.castPixelType=function(d){if(!d)return"f32";d=d.toLowerCase();-1<["u1","u2","u4"].indexOf(d)?d="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(d)&&(d="f32");
return d};a.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};a.prototype.addData=function(d){if(!d.pixels||d.pixels.length!==this.width*this.height)throw new b("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(d.pixels);this.statistics.push(d.statistics||{minValue:null,maxValue:null})};a.prototype.getAsRGBA=
function(){var d=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)};a.prototype.getAsRGBAFloat=function(){var d=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(d);return d};a.prototype.updateStatistics=function(){var d=this;this.statistics=this.pixels.map(function(b){return d._calculateBandStatistics(b,
d.mask)});var b=this.mask,a=0;if(b)for(var c=0;c<b.length;c++)b[c]&&a++;else a=this.width*this.height;this.validPixelCount=a};a.prototype.clamp=function(d){if(d&&"f64"!==d&&"f32"!==d){var b;switch(d){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var a=b[0];b=b[1];for(var e=this.pixels,f=this.width*this.height,h=e.length,
l,k,q,g=[],m=0;m<h;m++){q=c.createEmptyBand(d,f);l=e[m];for(var p=0;p<f;p++)k=l[p],q[p]=k>b?b:k<a?a:k;g.push(q)}this.pixels=g;this.pixelType=d}};a.prototype.clone=function(){var d=new c({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(d.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,a=c.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){d.pixels=
[];var e=this.pixels[0].slice;for(b=0;b<this.pixels.length;b++)d.pixels[b]=e?this.pixels[b].slice(0,this.pixels[b].length):new a(this.pixels[b])}if(this.statistics)for(d.statistics=[],b=0;b<this.statistics.length;b++)d.statistics[b]=k.clone(this.statistics[b]);return d};a.prototype._fillFrom8Bit=function(d){var b=this.mask,a=this.maskIsAlpha,c=this.pixels;if(d&&c&&c.length){var e,h,f;e=h=f=c[0];3<=c.length?(h=c[1],f=c[2]):2===c.length&&(h=c[1]);d=new Uint32Array(d);c=this.width*this.height;if(e.length!==
c)q.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===c)if(a)for(a=0;a<c;a++)b[a]&&(d[a]=b[a]<<24|f[a]<<16|h[a]<<8|e[a]);else for(a=0;a<c;a++)b[a]&&(d[a]=-16777216|f[a]<<16|h[a]<<8|e[a]);else for(a=0;a<c;a++)d[a]=-16777216|f[a]<<16|h[a]<<8|e[a]}else q.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};a.prototype._fillFromNon8Bit=function(d){var b=this.pixels,a=this.mask,c=this.statistics;if(d&&b&&b.length){var e=this.pixelType,
h=1,f=0,h=1;c&&0<c.length?(f=c.map(function(b){return b.minValue}).reduce(function(b,d){return Math.min(b,d)}),h=c.map(function(b){return b.maxValue-b.minValue}).reduce(function(b,d){return Math.max(b,d)}),h=255/h):(h=255,"s8"===e?(f=-128,h=127):"u16"===e?h=65535:"s16"===e?(f=-32768,h=32767):"u32"===e?h=4294967295:"s32"===e?(f=-2147483648,h=2147483647):"f32"===e?(f=-3.4*1E39,h=3.4*1E39):"f64"===e&&(f=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-f));d=new Uint32Array(d);var e=this.width*this.height,
l,k,c=l=k=b[0];if(c.length!==e)return q.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(l=b[1],3<=b.length&&(k=b[2]),a&&a.length===e)for(b=0;b<e;b++)a[b]&&(d[b]=-16777216|(k[b]-f)*h<<16|(l[b]-f)*h<<8|(c[b]-f)*h);else for(b=0;b<e;b++)d[b]=-16777216|(k[b]-f)*h<<16|(l[b]-f)*h<<8|(c[b]-f)*h;else if(a&&a.length===e)for(b=0;b<e;b++)l=(c[b]-f)*h,a[b]&&(d[b]=-16777216|l<<16|l<<8|l);else for(b=0;b<e;b++)l=(c[b]-f)*h,d[b]=-16777216|l<<16|l<<8|l}else q.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};a.prototype._fillFrom32Bit=function(b){var d=this.pixels,a=this.mask;if(!b||!d||!d.length)return q.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var c,e,h;c=e=h=d[0];3<=d.length?(e=d[1],h=d[2]):2===d.length&&(e=d[1]);var f=this.width*this.height;if(c.length!==f)return q.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(a&&a.length===f)for(d=0;d<f;d++)b[l++]=
c[d],b[l++]=e[d],b[l++]=h[d],b[l++]=a[d]&1;else for(d=0;d<f;d++)b[l++]=c[d],b[l++]=e[d],b[l++]=h[d],b[l++]=1};a.prototype._calculateBandStatistics=function(b,d){var a=Infinity,c=-Infinity,e=b.length,h,f=0;if(d)for(h=0;h<e;h++)d[h]&&(f=b[h],a=f<a?f:a,c=f>c?f:c);else for(h=0;h<e;h++)f=b[h],a=f<a?f:a,c=f>c?f:c;return{minValue:a,maxValue:c}};var c;g([l.property({json:{write:!0}})],a.prototype,"width",void 0);g([l.property({json:{write:!0}})],a.prototype,"height",void 0);g([l.property({json:{write:!0}})],
a.prototype,"pixelType",void 0);g([l.cast("pixelType")],a.prototype,"castPixelType",null);g([l.property({json:{write:!0}})],a.prototype,"validPixelCount",void 0);g([l.property({json:{write:!0}})],a.prototype,"mask",void 0);g([l.property({json:{write:!0}})],a.prototype,"maskIsAlpha",void 0);g([l.property({json:{write:!0}})],a.prototype,"pixels",void 0);g([l.property({json:{write:!0}})],a.prototype,"statistics",void 0);return a=c=g([l.subclass("esri.layers.support.PixelBlock")],a)}(l.declared(m.JSONSupport))})},
"esri/views/2d/engine/webgl/WGLRasterUtils":function(){define(["require","exports","../../../webgl"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.createRasterTexture=function(a,c,b,m){void 0===b&&(b="nearest");void 0===m&&(m=!1);var e=!(m&&"u8"===c.pixelType);m=e?5126:5121;e=null==c.pixels||0===c.pixels.length?null:e?c.getAsRGBAFloat():c.getAsRGBA();return new f.Texture(a,{width:c.width,height:c.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===
b?9729:9728,dataType:m,wrapMode:33071,flipped:!1},e)};c.createFrameBuffer=function(a,c,b,m){m=new f.Texture(a,{width:c,height:b,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:m?5121:5126,wrapMode:33071,flipped:!1});return new f.FramebufferObject(a,{colorTarget:0,depthStencilTarget:3,width:c,height:b},m)};c.createTransformTexture=function(a,c){for(var b=4*c.size[0],e=c.size[1],k={width:b,height:e,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,
wrapMode:33071,flipped:!1},b=new Float32Array(b*e*4),d=e=0;d<c.coefficients.length;d++)b[e++]=c.coefficients[d],2===d%3&&(b[e++]=1);return new f.Texture(a,k,b)};c.createColormapTexture=function(a,c){return new f.Texture(a,{width:c.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},c)};c.getUniformInfos=function(a,c){a=a.gl;c=c.glName;for(var b=a.getProgramParameter(c,a.ACTIVE_UNIFORMS),e=new Map,f,d=0;d<b;d++)(f=a.getActiveUniform(c,
d))&&e.set(f.name,{location:a.getUniformLocation(c,f.name),info:f});return e};c.setUniforms=function(a,c,b,f){Object.keys(f).forEach(function(e){var d=b.get(e)||b.get(e+"[0]");if(d){var l=f[e];if(null!==d&&null!=l){var k=a.gl,d=d.info;switch(d.type){case k.FLOAT:1<d.size?c.setUniform1fv(e,l):c.setUniform1f(e,l);break;case k.FLOAT_VEC2:c.setUniform2fv(e,l);break;case k.FLOAT_VEC3:c.setUniform3fv(e,l);break;case k.FLOAT_VEC4:c.setUniform4fv(e,l);break;case k.FLOAT_MAT3:c.setUniformMatrix3fv(e,l);break;
case k.FLOAT_MAT4:c.setUniformMatrix4fv(e,l);break;case k.INT:case k.BOOL:1<d.size?c.setUniform1iv(e,l):c.setUniform1i(e,l);break;case k.INT_VEC2:case k.BOOL_VEC2:c.setUniform2iv(e,l);break;case k.INT_VEC3:case k.BOOL_VEC3:c.setUniform3iv(e,l);break;case k.INT_VEC4:case k.BOOL_VEC4:c.setUniform4iv(e,l)}}}})};c.setTextures=function(a,c,b,f){b.length===f.length&&(f.some(function(b){return null==b})||b.some(function(b){return null==b})||b.forEach(function(b,d){c.setUniform1i(b,d);a.bindTexture(f[d],
d)}))}})},"esri/views/2d/engine/RasterTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});a=function(d){function a(){return null!==d&&d.apply(this,arguments)||this}f(a,d);a.prototype.createTile=function(b){var d=this._tileInfoView.getTileBounds(e.create(),
b);return new m.RasterTile(b,d,this._tileInfoView.tileInfo.size)};a.prototype.destroyTile=function(){};a.prototype.prepareRenderPasses=function(a){var c=this,e=a.registerRenderPass({name:"bitmap (tile)",brushes:[b.brushes.Raster],target:function(){return c.children.map(function(b){return b.bitmap})},drawPhase:k.WGLDrawPhase.MAP});return d.prototype.prepareRenderPasses.call(this,a).concat([e])};a.prototype.doRender=function(b){this.visible&&b.drawPhase===k.WGLDrawPhase.MAP&&d.prototype.doRender.call(this,
b)};return a}(d.default);c.RasterTileContainer=a})},"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/events ../../../core/has ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/BitBlitRenderer ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/Profiler ./webgl/WebGLDriverTest ./webgl/shaders/StencilPrograms ../support/Timeline ../../support/screenshotUtils".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u,h,y,t,A,B,C,D){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(c,h){var f=a.call(this)||this;f._renderParameters={drawPhase:0,state:f.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};f._clipData=new Float32Array(8);f._upperLeft=z.vec2f64.create();f._upperRight=z.vec2f64.create();f._lowerLeft=z.vec2f64.create();f._lowerRight=z.vec2f64.create();f._mat2=x.mat2df64.create();f._clipRendererInitialized=!1;f._supersampleScreenshots=
!0;f.dataUploadCounter=0;f.stage=f;f._stationary=!0;f.attached=!0;var l=h.canvas,l=void 0===l?document.createElement("canvas"):l,k=h.alpha,q=h.stencil,g=h.renderContext,p=h.supersampleScreenshots,p=void 0===p?!0:p,n=h.contextOptions,n=void 0===n?{}:n;f._canvas=l;k=r.createContextOrErrorHTML(l,{alpha:void 0===k?!0:k,antialias:!1,depth:!0,stencil:void 0===q?!0:q},void 0===g?"webgl":g);f.context=new r.RenderingContext(k,n);f.painter=new y.default(f.context,f);f._taskHandle=d.addFrameTask({render:function(){return f.renderFrame()}});
f._taskHandle.pause();f._supersampleScreenshots=p;f._lostWebGLContextHandle=b.on(l,"webglcontextlost",function(){f.emit("webgl-error",{error:new e("webgl-context-lost")})});m("esri-2d-profiler")&&(f._debugOutput=document.createElement("div"),f._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),c.appendChild(f._debugOutput));l.setAttribute("style","width: 100%; height:100%; display:block;");f.profiler=new t.Profiler(f.context,f._debugOutput);f.renderingOptions=
h.renderingOptions;f.timeline=h.timeline||new C.Timeline;f.driverTestResult=A.testWebGLDriver(f.context);c.appendChild(l);return f}f(c,a);c.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&
(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput);this.painter.dispose();this.context.dispose();this._canvas=null};Object.defineProperty(c.prototype,"background",{get:function(){return this._background},
set:function(b){this._background=b;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(b){var d=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null);if(this._highlightOptions=b)this._highlightOptionsHandle=l.init(this._highlightOptions,"version",function(){d.painter.setHighlightOptions(b);d.requestRender()})},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"renderingOptions",{get:function(){return this._renderingOptions},set:function(b){this._renderingOptions=b;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(b){this._state=b;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stationary",{get:function(){return this._stationary},set:function(b){this._stationary!==b&&(this._stationary=
b,this.requestRender())},enumerable:!0,configurable:!0});c.prototype.requestRender=function(){this._lastRenderRequestTime=Date.now();this._taskHandle&&this._taskHandle.resume()};c.prototype.renderFrame=function(){Date.now()-this._lastRenderRequestTime>=u.MAX_ANIMATION_TIME_MS&&this._taskHandle.pause();this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this.processRender(this._renderParameters)};
c.prototype.renderChildren=function(b){var d=this.context,a=this.children,a=b.children?b.children:a;this.profiler.recordStart("drawLayers");this.dataUploadCounter=0;this.beforeRenderChildren(b);b.drawPhase=h.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(d);for(var c=0;c<a.length;c++){var e=a[c];e.attached&&e.processRender(b)}this.painter.renderLayers(d);b.drawPhase=h.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(d);for(c=0;c<a.length;c++)e=a[c],e.attached&&e.processRender(b);this.painter.renderLayers(d);
if(m("esri-tiles-debug")){b.drawPhase=h.WGLDrawPhase.DEBUG;this.painter.beforeRenderLayers(d);for(c=0;c<a.length;c++)e=a[c],e.attached&&e.processRender(b);this.painter.renderLayers(d)}this.profiler.recordEnd("drawLayers");this.afterRenderChildren()};c.prototype.beforeRenderChildren=function(b){var d=this.context,a=b.state,c=b.pixelRatio;if(this.painter){d.enforceState();var e=a.size;b=a.rotation;var f=Math.round(e[0]*c),e=Math.round(e[1]*c);this._boundFBO=d.getBoundFramebufferObject();if(a.spatialReference&&
(a.spatialReference._isWrappable?a.spatialReference._isWrappable():a.spatialReference.isWrappable)){var h=q.common.toRadian(b),l=Math.abs(Math.cos(h)),k=Math.abs(Math.sin(h)),t=Math.round(a.worldScreenWidth);if(Math.round(f*l+e*k)<=t)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===f&&this._clipFBO.height===e||(this._clipFBO=new r.FramebufferObject(d,{colorTarget:0,depthStencilTarget:3,width:f,height:e}));var g=(this.state.padding.left-this.state.padding.right)/2,m=(this.state.padding.bottom-
this.state.padding.top)/2,n=.5*f,u=.5*e,a=1/f,x=1/e,c=.5*t*c,y=.5*(f*k+e*l),f=this._upperLeft,l=this._upperRight,k=this._lowerLeft,t=this._lowerRight;p.vec2.set(f,-c,-y);p.vec2.set(l,c,-y);p.vec2.set(k,-c,y);p.vec2.set(t,c,y);v.mat2d.identity(this._mat2);v.mat2d.translate(this._mat2,this._mat2,[n+g,u+m]);0!==b&&v.mat2d.rotate(this._mat2,this._mat2,h);p.vec2.transformMat2d(f,f,this._mat2);p.vec2.transformMat2d(l,l,this._mat2);p.vec2.transformMat2d(k,k,this._mat2);p.vec2.transformMat2d(t,t,this._mat2);
b=this._clipData;b.set([2*k[0]*a-1,2*(e-k[1])*x-1,2*t[0]*a-1,2*(e-t[1])*x-1,2*f[0]*a-1,2*(e-f[1])*x-1,2*l[0]*a-1,2*(e-l[1])*x-1]);this._clipRendererInitialized||this._initializeClipRenderer(d);this._clipVBO.setData(b);this._boundFBO=d.getBoundFramebufferObject();d.bindFramebuffer(this._clipFBO);d.setDepthWriteEnabled(!0);d.setStencilWriteMask(255);d.setClearColor(0,0,0,0);d.setClearDepth(1);d.setClearStencil(0);d.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT|d.gl.STENCIL_BUFFER_BIT);d.setDepthWriteEnabled(!1);
this._clipFrame=!0}}else this._clipFrame=!1}};c.prototype.afterRenderChildren=function(){var b=this.context;b.logIno();this._clipFrame&&this._clipRendererInitialized&&(b.bindFramebuffer(this._boundFBO),this._boundFBO=null,b.bindVAO(this._clipVAO),b.bindProgram(this._clipStencilProgram),b.setDepthWriteEnabled(!1),b.setDepthTestEnabled(!1),b.setStencilTestEnabled(!0),b.setBlendingEnabled(!1),b.setColorMask(!1,!1,!1,!1),b.setStencilOp(7680,7680,7681),b.setStencilWriteMask(255),b.setStencilFunction(519,
1,255),b.drawElements(4,6,5123,0),b.bindVAO(),b.setColorMask(!0,!0,!0,!0),b.setBlendingEnabled(!0),b.setStencilFunction(514,1,255),this._blitRenderer.render(b,this._clipFBO.colorTexture,9728,1),b.setStencilTestEnabled(!1))};c.prototype.doRender=function(b){var d=this.context,c=b.state,e=b.pixelRatio;this._resizeCanvas(b);this.context.enforceState();d.setViewport(0,0,e*c.size[0],e*c.size[1]);d.setDepthWriteEnabled(!0);d.setStencilWriteMask(255);this.background&&this.background.color?(c=this.background.color,
d.setClearColor(c.r/255,c.g/255,c.b/255,c.a)):d.setClearColor(0,0,0,0);d.setClearDepth(1);d.setClearStencil(0);d.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT|d.gl.STENCIL_BUFFER_BIT);d.setDepthWriteEnabled(!1);a.prototype.doRender.call(this,b)};c.prototype.takeScreenshot=function(b,d){var a=D.screenshotSuperSampleSettings(b,this._supersampleScreenshots,this._state.padding),c=a.framebufferWidth,e=a.framebufferHeight,f=this.context,h=b.layers,l={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),
pixelRatio:a.pixelRatio};if(null!=b.rotation){var t=l.state.viewpoint;t.rotation=b.rotation;l.state.viewpoint=t}0<h.length&&(l.children=[],h.forEach(function(b){var a=d.find(function(d){return d.layer.id===b.id});a&&"container"in a&&a.container&&a.attached&&l.children.push(a.container)}));var q=new r.FramebufferObject(f,{colorTarget:0,depthStencilTarget:3,width:c,height:e}),h=f.getBoundFramebufferObject(),t=f.getViewport();f.bindFramebuffer(q);f.setViewport(0,0,c,e);c=f.gl;!b.ignoreBackground&&this.background&&
this.background.color?(e=this.background.color,f.setClearColor(e.r/255,e.g/255,e.b/255,e.a)):f.setClearColor(0,0,0,0);f.setClearDepth(1);f.setClearStencil(0);f.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);this.renderChildren(l);a=this._readbackScreenshot(a);f.bindFramebuffer(h);f.setViewport(t.x,t.y,t.width,t.height);this.requestRender();f=this._ensureScreenshotEncodeCanvas();b=D.encodeResult(a,b,f,{flipY:!0,premultipliedAlpha:!0});return k.resolve(b)};c.prototype._ensureScreenshotEncodeCanvas=
function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};c.prototype._readbackScreenshot=function(b){var d=b.framebufferWidth,a=b.framebufferHeight,c=b.region;b=b.resample;var e=this.context.gl;if(b){var f=D.createEmptyImageData(d,a,this._ensureScreenshotEncodeCanvas());e.readPixels(0,0,d,a,6408,5121,new Uint8Array(f.data.buffer));d=D.createEmptyImageData(c.width,c.height,this._ensureScreenshotEncodeCanvas());return D.resampleHermite(f,
d,!0,b.region.x,a-(b.region.y+b.region.height),b.region.width,b.region.height)}f=D.createEmptyImageData(c.width,c.height,this._ensureScreenshotEncodeCanvas());e.readPixels(c.x,a-(c.y+c.height),c.width,c.height,6408,5121,new Uint8Array(f.data.buffer));return f};c.prototype._resizeCanvas=function(b){var d=this._canvas,a=d.style,c=b.state.size,e=b.pixelRatio;b=c[0];var c=c[1],f=Math.round(b*e),e=Math.round(c*e);if(d.width!==f||d.height!==e)d.width=f,d.height=e;a.width=b+"px";a.height=c+"px"};c.prototype._initializeClipRenderer=
function(b){if(this._clipRendererInitialized)return!0;this._blitRenderer=new n.BitBlitRenderer;var d=B.stencil.attributes,a=r.createProgram(b,B.stencil);if(!a)return!1;var c=r.BufferObject.createVertex(b,35040,32),e=new Uint16Array([0,1,2,2,1,3]),e=r.BufferObject.createIndex(b,35044,e);b=new r.VertexArrayObject(b,d,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:c},e);this._clipStencilProgram=a;this._clipVBO=c;this._clipVAO=b;return this._clipRendererInitialized=
!0};return c}(w.Container);c.Stage=a})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._initialized=!1}a.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(b,a,c,d){b&&
(this._initialized||this._initialize(b),b.setBlendFunctionSeparate(1,771,1,771),b.bindVAO(this._vertexArrayObject),b.bindProgram(this._program),a.setSamplingMode(c),b.bindTexture(a,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",d),b.drawArrays(5,0,4),b.bindVAO())};a.prototype._initialize=function(b){if(this._initialized)return!0;var a=g.bitBlit.attributes,c=f.createProgram(b,g.bitBlit);if(!c)return!1;var d=new Int8Array(16);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=1;d[5]=
-1;d[6]=1;d[7]=0;d[8]=-1;d[9]=1;d[10]=0;d[11]=1;d[12]=1;d[13]=1;d[14]=1;d[15]=1;b=new f.VertexArrayObject(b,a,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:f.BufferObject.createVertex(b,35044,d)});this._program=c;this._vertexArrayObject=b;return this._initialized=!0};return a}();c.BitBlitRenderer=a})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require",
"exports","./sources/resolver"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.bitBlit={name:"bitBlit",shaders:{vertexShader:f.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:f.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.WEBGL_MAX_STOPS=8;c.WEBGL_MAX_INNER_STOPS=c.WEBGL_MAX_STOPS-2;c.NAN_MAGIC_NUMBER=
1E-30;c.EXTRUDE_SCALE=64;c.PICTURE_FILL_COLOR=4294967295;c.TILE_SIZE=512;c.RASTER_TILE_SIZE=256;c.ANGLE_FACTOR_256=256/360;c.DEBUG_LABELS=!1;c.COLLISION_BUCKET_SIZE=128;c.DOT_DENSITY_MAX_FIELDS=8;c.COLLISION_MAX_ZOOM_DELTA=3;c.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;c.COLLISION_BOX_PADDING=16;c.COLLISION_TILE_BOX_SIZE=c.TILE_SIZE/c.COLLISION_BUCKET_SIZE;c.COLLISION_PLACEMENT_PADDING=8;c.HEURISTIC_GLYPHS_PER_LINE=50;c.HEURISTIC_GLYPHS_PER_FEATURE=10;c.GLYPH_SIZE=24;c.TEXT_LINE_HEIGHT=1.2*c.GLYPH_SIZE;
c.TEXT_MAX_WIDTH=10*c.GLYPH_SIZE;c.TEXT_SPACING=0;c.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};c.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;c.TEXTURE_BINDING_SPRITE_ATLAS=0;c.TEXTURE_BINDING_GLYPH_ATLAS=0;c.TEXTURE_BINDING_BITMAP=0;c.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;c.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;c.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;c.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;c.TEXTURE_BINDING_HIGHLIGHT_0=5;c.TEXTURE_BINDING_HIGHLIGHT_1=6;c.TEXTURE_BINDING_RENDERER_0=
5;c.TEXTURE_BINDING_RENDERER_1=6;c.ATTRIBUTE_DATA_FILTER_FLAGS=0;c.ATTRIBUTE_DATA_ANIMATION=1;c.ATTRIBUTE_DATA_VV=2;c.ATTRIBUTE_DATA_DD0=3;c.ATTRIBUTE_DATA_DD1=3;c.MAX_FILTERS=2;c.HIGHLIGHT_FLAG=1;c.FILTER_FLAG_0=2;c.EFFECT_FLAG_0=4;c.THIN_LINE_THRESHOLD=2.5;c.HITTEST_SEARCH_SIZE=24;c.MAX_ANIMATION_TIME_MS=2E3;c.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;c.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;c.VTL_HIGH_RES_CUTOFF=1.15;c.MAX_GPU_UPLOADS_PER_FRAME=2})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ../../engine ../vectorTiles/shaders/ProgramCache ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./effects/AnimationEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/blendEffects/BlendEffectMultiply ./effects/blendEffects/BlendEffectNormal ./effects/postProcessingEffects/PostProcessingEffectUnrealBloom ./painter/RenderPass".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n){function u(b){var d=b.blendOption,a=b.postProcessingEffects;return 1!==b.opacity||g.isSome(d.mode)||void 0!==a}Object.defineProperty(c,"__esModule",{value:!0});a=function(){return function(){}}();c.PainterOptions=a;a=function(){function a(d,a){this.context=d;this._blitRenderer=new k.BitBlitRenderer;this._brushCache=new Map;this._vtlProgramCache=null;this.brushNameToCtor={marker:b.brushes.Marker,line:b.brushes.Line,fill:b.brushes.Fill,text:b.brushes.Text,
label:b.brushes.Label,clip:b.brushes.Clip,stencil:b.brushes.Stencil,bitmap:b.brushes.Bitmap,tileInfo:b.brushes.TileInfo,vtlBackground:b.brushes.VTLBackground,vtlFill:b.brushes.VTLFill,vtlLine:b.brushes.VTLLine,vtlCircle:b.brushes.VTLCircle,vtlSymbol:b.brushes.VTLSymbol};this.blendModeToBlendEffect={normal:new r.BlendEffectNormal,multiply:new z.BlendEffectMultiply,screen:null,overlay:null,darken:null,lighten:null,"color-dodge":null,"color-burn":null,"hard-light":null,"soft-light":null,difference:null,
exclusion:null,hue:null,saturation:null,color:null,luminosity:null};this._effectNameToLayerPostProcessingEffect={antialiasing:null,bloom:null,"edge-detect":null,"edge-enhance":null,emboss:null,"gaussian-blur":null,grayscale:null,"high-pass":null,"unreal-bloom":new w.PostProcessingEffectUnrealBloom,unsharpen:null};this.effects={highlight:new x.default,hittest:new p.HittestEffect,integrate:new v.AnimationEffect};this.materialManager=new l(d);this._vtlProgramCache=new m.default(d);this.textureManager=
new q(a)}a.prototype.getFbos=function(b,d){if(b!==this._lastWidth||d!==this._lastHeight){this._lastWidth=b;this._lastHeight=d;if(this._fbos)for(var a in this._fbos)this._fbos[a].dispose();a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:b,height:d};var c={colorTarget:0,depthStencilTarget:3};b=new e.Renderbuffer(this.context,{width:b,height:d,internalFormat:34041});this._fbos={output:new e.FramebufferObject(this.context,c,a,b),blend:new e.FramebufferObject(this.context,
c,a,b),effect0:new e.FramebufferObject(this.context,c,a,b)}}return this._fbos};a.prototype.beforeRenderLayers=function(b){var d=b.getViewport(),d=this.getFbos(d.width,d.height);this._prevFBO=b.getBoundFramebufferObject();b.bindFramebuffer(d.output);b.setDepthWriteEnabled(!0);b.setClearColor(0,0,0,0);b.setClearDepth(1);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT);b.setDepthWriteEnabled(!1)};a.prototype.beforeRenderLayer=function(b,d,a){u(a)?(b.bindFramebuffer(this._fbos.blend),b.setClearColor(0,
0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT)):b.bindFramebuffer(this._fbos.output);b.setDepthWriteEnabled(!1);b.setDepthTestEnabled(!1);b.setStencilTestEnabled(!0);b.setClearStencil(d);b.setStencilWriteMask(255);b.clear(b.gl.STENCIL_BUFFER_BIT)};a.prototype.compositeLayer=function(b,d){var a=b.context,c=d.opacity;if(u(d)){var e=this.getPostProcessingEffects(d);if(g.isSome(e)&&e.length)for(var f=0;f<e.length;f++){var h=e[f],l=h.effect,h=h.options;a.bindFramebuffer(this._fbos.blend);l.draw(b,this._fbos.blend,
h)}a.bindFramebuffer(this._fbos.output);a.setStencilTestEnabled(!1);a.setStencilWriteMask(0);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);this.getBlendEffect(d).draw(b,this._fbos.blend.colorTexture,9728,c)}};a.prototype.renderLayers=function(b){b.bindFramebuffer(this._prevFBO);this._fbos&&(b.setStencilTestEnabled(!1),b.setStencilWriteMask(0),b.setBlendingEnabled(!0),b.setBlendFunctionSeparate(1,771,1,771),b.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(b,
this._fbos.output.colorTexture,9728,1))};a.prototype.getBlendEffect=function(b){b=b.blendOption;return g.isSome(b.mode)?this.blendModeToBlendEffect[b.mode]:this.blendModeToBlendEffect.normal};a.prototype.getPostProcessingEffects=function(b){b=b.postProcessingEffects;if(g.isSome(b)&&0<b.length){for(var d=[],a=0;a<b.length;a++){var c=b[a],e=this._effectNameToLayerPostProcessingEffect[c.effect];e&&d.push({effect:e,options:c.options})}return d}return null};a.prototype.dispose=function(){this.materialManager.dispose();
this.textureManager.dispose();this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null);this._brushCache&&(this._brushCache.forEach(function(b){return b.dispose()}),this._brushCache.clear(),this._brushCache=null);if(this._fbos)for(var b in this._fbos)this._fbos[b]&&this._fbos[b].dispose();if(this.effects)for(var d in this.effects)this.effects[d]&&this.effects[d].dispose();this._prevFBO=null};a.prototype.getGeometryBrush=
function(a){var c;a=(c={},c[d.WGLGeometryType.FILL]=b.brushes.Fill,c[d.WGLGeometryType.LINE]=b.brushes.Line,c[d.WGLGeometryType.MARKER]=b.brushes.Marker,c[d.WGLGeometryType.TEXT]=b.brushes.Text,c)[a];c=this._brushCache.get(a);void 0===c&&(c=new a,this._brushCache.set(a,c));return this._brushCache.get(a)};a.prototype.renderObject=function(b,d,a,c){a=this.brushNameToCtor[a];if(!a)return null;var e=this._brushCache.get(a);void 0===e&&(e=new a,this._brushCache.set(a,e));e.prepareState(b,d,c);e.draw(b,
d,c)};a.prototype.renderObjects=function(b,d,a,c){a=this.brushNameToCtor[a];if(!a)return null;var e=this._brushCache.get(a);void 0===e&&(e=new a,this._brushCache.set(a,e));e.drawMany(b,d,c)};a.prototype.getVectorTileProgramCach=function(){return this._vtlProgramCache};a.prototype.registerRenderPass=function(b){var d=this,a=b.brushes.map(function(b){d._brushCache.has(b)||d._brushCache.set(b,new b);return d._brushCache.get(b)});return new n.default(a,b)};a.prototype.setHighlightOptions=function(b){this.effects.highlight.setHighlightOptions(b)};
return a}();c.default=a})},"esri/views/2d/engine/vectorTiles/shaders/ProgramCache":function(){define(["require","exports","../../../../webgl","./Programs"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(b){this._cache=Array(8);for(var a=0;8>a;a++)this._cache[a]={};this._programRepo=new f.ProgramCache(b)}a.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)};a.prototype.getProgram=function(b,a,c){var d=this._cache[b];
d[a]||(b=this._programRepo.getProgram(this._getProgramTemplate(b),c),d[a]=b);return d[a]};a.prototype.getProgramAttributes=function(b){switch(b){case 0:return g.background.attributes;case 5:return g.circle.attributes;case 1:return g.fill.attributes;case 4:return g.icon.attributes;case 3:return g.line.attributes;case 2:return g.outline.attributes;case 6:return g.text.attributes;default:return null}};a.prototype._getProgramTemplate=function(b){switch(b){case 0:return g.background;case 5:return g.circle;
case 1:return g.fill;case 4:return g.icon;case 3:return g.line;case 2:return g.outline;case 6:return g.text;default:return null}};return a}();c.default=a})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});c.background={name:"background",shaders:function(b){return{vertexShader:f.glslifyDefineMap({ID:b.id,PATTERN:b.pattern})+g.resolveIncludes("background/background.vert"),
fragmentShader:f.glslifyDefineMap({ID:b.id,PATTERN:b.pattern})+g.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};c.circle={name:"circle",shaders:function(b){return{vertexShader:f.glslifyDefineMap({ID:b.id})+g.resolveIncludes("circle/circle.vert"),fragmentShader:f.glslifyDefineMap({ID:b.id})+g.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var e=function(b){return f.glslifyDefineMap({ID:b.id,DD:b.dd,PATTERN:b.pattern})};c.fill=
{name:"fill",shaders:function(b){return{vertexShader:e(b)+g.resolveIncludes("fill/fill.vert"),fragmentShader:e(b)+g.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};c.outline={name:"outline",shaders:function(b){return{vertexShader:f.glslifyDefineMap({ID:b.id,DD:b.dd})+g.resolveIncludes("outline/outline.vert"),fragmentShader:f.glslifyDefineMap({ID:b.id,DD:b.dd})+g.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};c.icon={name:"icon",
shaders:function(b){return{vertexShader:f.glslifyDefineMap({ID:b.id,DD:b.dd,SDF:b.sdf})+g.resolveIncludes("icon/icon.vert"),fragmentShader:f.glslifyDefineMap({ID:b.id,DD:b.dd,SDF:b.sdf})+g.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};var b=function(b){return f.glslifyDefineMap({ID:b.id,DD:b.dd,PATTERN:b.pattern})};c.line={name:"line",shaders:function(a){return{vertexShader:b(a)+g.resolveIncludes("line/line.vert"),fragmentShader:b(a)+
g.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};c.text={name:"text",shaders:function(b){return{vertexShader:f.glslifyDefineMap({ID:b.id,DD:b.dd})+g.resolveIncludes("text/text.vert"),fragmentShader:f.glslifyDefineMap({ID:b.id,DD:b.dd})+g.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}}})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["require",
"exports","../../../../../webgl","./shaderRepository"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});var e=new f.ShaderCompiler(function(b){var a=g;b.split("/").forEach(function(b){a&&(a=a[b])});return a});c.resolveIncludes=function(b){return e.resolveIncludes(b)}})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(["require","exports"],function(a,c){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n#else\n  gl_FragColor \x3d u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist \x3d length(v_offset);\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision \x3d 0.25;\nconst float blurPrecision \x3d 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color \x3d a_color * u_color;\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\n  v_radius \x3d a_data[2] * u_radius;\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset \x3d offset;\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_color[3] * color;\n#else\n  gl_FragColor \x3d v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio \x3d 0.248062016;\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * sofetEdgeRatio * size;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle         \x3d a_levelInfo[1];\n  mediump float a_minLevel      \x3d a_levelInfo[2];\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\n  v_size \x3d abs(offset);\n#ifdef SDF\n  offset \x3d (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size \x3d a_size * u_size;\n#else\n  mediump float icon_size \x3d u_size;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(icon_size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n  v_transparency *\x3d v_color.w;\n}"},
line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio \x3d 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d alpha * v_color[3] * color;\n#else\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\n  alpha *\x3d dashAlpha;\n  gl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth \x3d a_width * u_width;\n#else\n  v_lineHalfWidth \x3d u_width;\n#endif\n  v_lineHalfWidth +\x3d u_antialiasing;\n  v_lineHalfWidth *\x3d 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray \x3d u_dasharray * a_width;\n#else\n  v_dasharray \x3d u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist \x3d v_lineHalfWidth * scale * a_offsetAndNormal.xy;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) +  u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\n  v_blur \x3d u_blur + u_antialiasing;\n  #ifdef DD\n    v_color \x3d a_color * u_color;\n  #else\n    v_color \x3d u_color;\n  #endif\n  #ifdef ID\n    v_id \x3d u_id / 255.0;\n  #endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d abs(v_normal.y);\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_normal \x3d a_xnormal;\n  mediump vec2 dist \x3d u_outline_width * scale * a_offset;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo \x3e 0.5)\n  {\n    v_color \x3d u_color;\n  }\n  else\n  {\n    v_color \x3d a_color * u_color;\n  }\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef DD\n  v_size \x3d a_size * u_size;\n#else\n  v_size \x3d u_size;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * v_size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),function(a,
c,f,g,e,b,m){var k=function(d){return d===b.WGLDrawPhase.HITTEST||d===b.WGLDrawPhase.LABEL_ALPHA},d=function(d,a,c,e){e=e.reduce(function(b,a){var c;return f({},b,(c={},c[a]=d.driverTestResult[a],c))},{});a=f({},a.getVariation(),d.rendererInfo.getVariation(),{highlight:d.drawPhase===b.WGLDrawPhase.HIGHLIGHT,id:k(d.drawPhase)},e);if(g.isSome(c))for(e=0;e<c.length;e++)a[c[e]]=!0;return a};return function(){function a(b){this._programByKey=new Map;this._programCache=new e.ProgramCache(b)}a.prototype.dispose=
function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(b,d,a,c){void 0===a&&(a=[]);void 0===c&&(c=[]);var e=d.path+a.join(".")+c.join(".");if(this._programByKey.has(e))return this._programByKey.get(e);c=c.reduce(function(d,a){var c;return f({},d,(c={},c[a]=b.driverTestResult[a],c))},{});a=f({},a.reduce(function(b,d){var a;return f({},b,(a={},a[d]=!0,a))},{}),c);d=this._programCache.getProgram(m.createProgramTemplate(d.path,d.attributes),a);if(!d)throw Error("Unable to get program for key: ${key}");
this._programByKey.set(e,d);return d};a.prototype.getMaterialProgram=function(a,c,e,f,l,r){void 0===r&&(r=["ignoresSamplerPrecision"]);var q,p=r;q=a.rendererInfo;var v=a.drawPhase,p=c.getVariationHash()+"-"+p.join(".")+"-",v=(k(v)?1:0)|(v===b.WGLDrawPhase.HIGHLIGHT?2:0);q=p+v+"-"+q.getVariationHash()+"-"+(g.isSome(l)&&l.join("."));if(this._programByKey.has(q))return this._programByKey.get(q);a=d(a,c,l,r);e=this._programCache.getProgram(m.createProgramTemplate(e,f),a);if(!e)throw Error("Unable to get program for key: ${key}");
this._programByKey.set(q,e);return e};return a}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});var e=function(b){var a={},c;for(c in b){for(var d=c,e=void 0,e=""+d[0].toUpperCase(),g=1;g<d.length;g++){var v=d[g];v===v.toUpperCase()?(e+="_",e+=v):e+=v.toUpperCase()}a[e]=b[c]}return f.glslifyDefineMap(a)};c.createProgramTemplate=function(b,a){var c=
b+b.substring(b.lastIndexOf("/"));return{name:name,attributes:a,shaders:function(b){return{vertexShader:e(b)+g.resolveIncludes(c+".vert"),fragmentShader:e(b)+g.resolveIncludes(c+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./animatedFormats/apng ./animatedFormats/gif ./util/Result ./util/symbolUtils".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u,h,y,t,A,B,C){function D(b){return g(this,void 0,void 0,function(){var d,a;return e(this,function(c){switch(c.label){case 0:d=window.URL.createObjectURL(b),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,m(d,{responseType:"image"})];case 2:return a=c.sent().data,window.URL.revokeObjectURL(d),[2,a];case 3:return c.sent(),window.URL.revokeObjectURL(d),[2,new k("mapview-invalid-resource","Could not fetch requested resource at "+d)];case 4:return[2]}})})}
function K(b,d){return g(this,void 0,void 0,function(){var a,c,h,g,q,t,p,n,v;return e(this,function(e){switch(e.label){case 0:a=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;if(-1===a.indexOf(";base64,"))return[3,1];h=a.indexOf(";base64,")+8;g=a.substring(h);q=atob(g);t=new Uint8Array(q.length);for(p=0;p<q.length;p++)t[p]=q.charCodeAt(p);c=t.buffer;return[3,4];case 1:return e.trys.push([1,3,,4]),[4,m(a,f({responseType:"array-buffer"},d))];case 2:return c=n=e.sent().data,[3,4];case 3:return v=
e.sent(),l.isAbortError(v)?[3,4]:[2,new k("mapview-invalid-resource","Could not fetch requested resource at "+a)];case 4:return[2,c]}})})}var E=x.vec2f32.create(),I=d.getLogger("esri.views.2d.engine.webgl.TextureManager"),G=function(){function b(b,d,a){this.mosaicType=b;this.page=d;this.sdf=a}b.fromMosaic=function(d,a){return new b(d,a.page,a.sdf)};return b}();return function(){function d(d){this._invalidFontsMap=new Map;this._sdfConverter=new h.default(126);this._bindingInfos=[];this._hashToBindingIndex=
new Map;this._rasterizer=new p.default;this._spriteMosaic=new y(d,2048,2048,500);this._glyphSource=new u(b.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new n(1024,1024,this._glyphSource)}Object.defineProperty(d.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();
this._rasterizer.dispose();this._rasterizer=this._glyphMosaic=this._spriteMosaic=null};d.prototype._hashMosaic=function(b,d){return 1|b<<1|(d.sdf?1:0)<<2|d.page<<3};d.prototype._setTextureBinding=function(b,d){var a=this._hashMosaic(b,d);this._hashToBindingIndex.has(a)||(b=G.fromMosaic(b,d),this._hashToBindingIndex.set(a,this._bindingInfos.length+1),this._bindingInfos.push(b));d.textureBinding=this._hashToBindingIndex.get(a)};d.prototype.rasterizeItem=function(b,d,a){var c=this;void 0===d&&(d=null);
return b?b.type&&-1!==b.type.toLowerCase().indexOf("3d")?(I.error(new k("mapview-invalid-type","MapView does not support 3d symbol type: "+b.type,b)),l.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!b.type||"text"!==b.type&&"esriTS"!==b.type&&"CIMTextSymbol"!==b.type?this._rasterizeSpriteSymbol(b,a).then(function(b){B.ok(b)&&b&&c._setTextureBinding(r.MosaicType.SPRITE,b);return{spriteMosaicItem:b}}):this._rasterizeTextSymbol(b,d,a).then(function(b){b.forEach(function(b){return c._setTextureBinding(r.MosaicType.GLYPH,
b)});return{glyphMosaicItems:b}}):(I.error(new k("mapview-null-resource","Unable to rasterize null resource")),l.resolve(null))};d.prototype.bindTextures=function(b,d,a,c){void 0===c&&(c=1);if(0!==a.textureBinding){var e=this._bindingInfos[a.textureBinding-1];a=e.page;switch(e.mosaicType){case r.MosaicType.SPRITE:e=this.sprites.getWidth(a)/c;c=this.sprites.getHeight(a)/c;c=v.vec2.set(E,e,c);this._bindSpritePage(b,a,z.TEXTURE_BINDING_SPRITE_ATLAS,9729);d.setUniform1i("u_texture",z.TEXTURE_BINDING_SPRITE_ATLAS);
d.setUniform2fv("u_mosaicSize",c);break;case r.MosaicType.GLYPH:e=this.glyphs.width/c;c=this.glyphs.height/c;c=v.vec2.set(E,e,c);this._bindGlyphsPage(b,a,z.TEXTURE_BINDING_GLYPH_ATLAS);d.setUniform1i("u_texture",z.TEXTURE_BINDING_GLYPH_ATLAS);d.setUniform2fv("u_mosaicSize",c);break;default:I.error("mapview-texture-manager","Cannot handle unknown type "+e.mosaicType)}}};d.prototype._bindSpritePage=function(b,d,a,c){c||(c=9729);this._spriteMosaic.bind(b,c,d,a)};d.prototype._bindGlyphsPage=function(b,
d,a){this._glyphMosaic.bind(b,9729,d,a)};d.prototype._rasterizeTextSymbol=function(b,d,a){var c=this,e=w.getFullyQualifiedFontName(b.font);b=this._invalidFontsMap.has(e);return this._glyphMosaic.getGlyphItems(b?"arial-unicode-ms-regular":e,d,a).catch(function(){I.error(new k("mapview-invalid-resource","Couldn't find font "+e+". Falling back to Arial Unicode MS Regular"));c._invalidFontsMap.set(e,!0);return c._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",d,a)})};d.prototype._rasterizeSpriteSymbol=
function(b,d){return g(this,void 0,void 0,function(){var a,c,f,h,l,g;return e(this,function(e){e="CIMSolidStroke"===b.type||"CIMSolidFill"===b.type?!0:b&&(C.isFillSymbol(b)||C.isLineSymbol(b))&&"style"in b&&("solid"===b.style||"esriSFSSolid"===b.style||"esriSLSSolid"===b.style||"none"===b.style||"esriSFSNull"===b.style||"esriSLSNull"===b.style);if(e)return[2,null];a=C.keyFromSymbol(b);return this._spriteMosaic.has(a)?[2,this._spriteMosaic.getSpriteItem(a)]:"simple-marker"!==b.type&&"esriSMS"!==b.type||
!b.path?b.url||b.imageData?[2,this._handleImage(b,a,d)]:(c=this._rasterizer.rasterizeJSONResource(b))?(f=c.size,h=c.image,l=c.sdf,g=c.simplePattern,[2,this._addItemToMosaic(a,f,{type:"static",data:h},!C.isMarkerSymbol(b),l,g)]):[2,new k("TextureManager","unrecognized or null rasterized image")]:[2,this._handleSVG(b,a,d)]})})};d.prototype._handleSVG=function(b,d,a){return g(this,void 0,void 0,function(){var c,f;return e(this,function(e){switch(e.label){case 0:return c=[126,126],[4,this._sdfConverter.draw(b.path,
a)];case 1:return f=e.sent(),[2,this._addItemToMosaic(d,c,{type:"static",data:new Uint32Array(f.buffer)},!1,!0,!0)]}})})};d.prototype._handleGIFOrPNG=function(b,d,a){return g(this,void 0,void 0,function(){var c,f,h,g,q,p,n,v,m,u,x,r;return e(this,function(e){switch(e.label){case 0:return[4,K(b,a)];case 1:c=e.sent();if(!B.ok(c))return[3,10];f=A.isGIF(c);h=t.isPNG(c);if(!f&&!h)return[2,new k("mapview-invalid-resource","Image data is neither GIF nor PNG!")];g=void 0;e.label=2;case 2:return e.trys.push([2,
7,,8]),f&&A.isAnimatedGIF(c)?[4,A.default.create(c,a)]:[3,4];case 3:return g=e.sent(),[3,6];case 4:return h&&t.isAnimatedPNG(c)?[4,t.default.create(c,a)]:[3,6];case 5:g=e.sent(),e.label=6;case 6:return[3,8];case 7:return q=e.sent(),l.isAbortError(q)?[3,8]:[2,new k("mapview-invalid-resource","Could not fetch requested resource!")];case 8:if(g&&B.ok(g))return[2,this._addItemToMosaic(d,[g.width,g.height],{type:"animated",data:g},!C.isMarkerSymbol(b),!1,!1)];p=f?"image/gif":"image/png";n=new Blob([c],
{type:p});return[4,D(n)];case 9:if((v=e.sent())&&v instanceof HTMLImageElement)return m=this._rasterizer.rasterizeImageResource(v,b.colorSubstitutions),u=m.size,x=m.sdf,r=m.image,[2,this._addItemToMosaic(d,u,{type:"static",data:r},!C.isMarkerSymbol(b),x,!1)];e.label=10;case 10:return[2,new k("mapview-invalid-resource","Could not handle resource!")]}})})};d.prototype._handleImage=function(b,d,a){return g(this,void 0,void 0,function(){var c,h,g,t,p,n,v;return e(this,function(e){switch(e.label){case 0:var u;
(u=b.url&&-1!==b.url.indexOf(".gif")||b.contentType&&"image/gif"===b.contentType||b.imageData&&-1!==b.imageData.indexOf("data:image/gif"))||(u=b.url&&-1!==b.url.indexOf(".png")||b.contentType&&"image/png"===b.contentType||b.imageData&&-1!==b.imageData.indexOf("data:image/png"));if(u)return[2,this._handleGIFOrPNG(b,d,a)];c=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,m(c,f({responseType:"image"},a))];case 2:return h=e.sent().data,-1!==
c.indexOf("data:image/svg+xml")&&(h.width=q.pt2px(b.width),h.height=q.pt2px(b.height)),g=this._rasterizer.rasterizeImageResource(h,b.colorSubstitutions),t=g.size,p=g.sdf,n=g.image,[2,this._addItemToMosaic(d,t,{type:"static",data:n},!C.isMarkerSymbol(b),p,!1)];case 3:return v=e.sent(),l.isAbortError(v)?[3,4]:[2,new k("mapview-invalid-resource","Could not fetch requested resource at "+c)];case 4:return[2,void 0]}})})};d.prototype._addItemToMosaic=function(b,d,a,c,e,f){return this._spriteMosaic.addSpriteItem(b,
d,a,c,e,f)};return d}()})},"esri/symbols/cim/Rasterizer":function(){define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(a,c,f,g,e){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function b(){}b.prototype.dispose=function(){this._rasterizationCanvas=null};b.prototype.rasterizeJSONResource=function(b,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===b.type||"esriSFS"===b.type)return a=f.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,
b.style),{size:[a[1],a[2]],image:new Uint32Array(a[0].buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===b.type||"esriSLS"===b.type)return a=f.SymbolHelper.rasterizeSimpleLine(b.style,b.cap),{size:[a[1],a[2]],image:new Uint32Array(a[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var d;b="simple-marker"===b.type||"esriSMS"===b.type?f.CIMSymbolHelper.fromSimpleMarker(b):b;if((d=g.getSDFInfo(b))&&!a)return a=g.buildSDF(d),(b=a[0])?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),
sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null;a=f.CIMSymbolHelper.rasterize(this._rasterizationCanvas,b,!a);b=a[0];d=a[3];var c=a[4];return b?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1,anchorX:d,anchorY:c}:null};b.prototype.rasterizeImageResource=function(b,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=b.width;this._rasterizationCanvas.height=b.height;var d=this._rasterizationCanvas.getContext("2d");
b instanceof ImageData?d.putImageData(b,0,0):(b.setAttribute("width",b.width.toString()),b.setAttribute("height",b.height.toString()),d.drawImage(b,0,0,b.width,b.height));d=d.getImageData(0,0,b.width,b.height);d=new Uint8Array(d.data);if(a)for(var c=0;c<a.length;c++){var f=a[c];if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var g=f.oldColor,k=g[0],p=g[1],m=g[2],g=g[3],r=f.newColor,f=r[0],w=r[1],n=r[2],u=r[3];if(k!==f||p!==w||m!==n||g!==u)for(r=0;r<d.length;r+=4)k===d[r]&&
p===d[r+1]&&m===d[r+2]&&g===d[r+3]&&(d[r]=f,d[r+1]=w,d[r+2]=n,d[r+3]=u)}}for(r=0;r<d.length;r+=4)a=d[r+3]/255,d[r]*=a,d[r+1]*=a,d[r+2]*=a;a=b.width;c=b.height;k=d;if(512<=a||512<=c)k=b.width/b.height,1<k?(a=512,c=Math.round(512/k)):(c=512,a=Math.round(512*k)),k=new Uint8Array(4*a*c),e.resampleHermite(d,b.width,b.height,new Uint8ClampedArray(k.buffer),a,c,!1);return{size:[a,c],image:new Uint32Array(k.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return b}();c.default=a})},"esri/symbols/cim/utils":function(){define(["require",
"exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.evaluateValueOrFunction=function(a,c,e,b){return"function"===typeof a?a(c,e,b):a};c.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};c.resampleHermite=function(a,c,e,b,m,k,d){void 0===d&&(d=!0);var f=c/m;e/=k;for(var g=Math.ceil(f/2),v=Math.ceil(e/2),x=0;x<k;x++)for(var p=0;p<m;p++){for(var z=4*(p+(d?k-x-1:x)*m),r=0,w=0,n=0,u=0,h=0,y=0,t=0,A=(x+.5)*e,B=Math.floor(x*e);B<(x+1)*e;B++)for(var C=Math.abs(A-(B+.5))/v,D=(p+.5)*
f,C=C*C,K=Math.floor(p*f);K<(p+1)*f;K++){var E=Math.abs(D-(K+.5))/g,r=Math.sqrt(C+E*E);-1<=r&&1>=r&&(r=2*r*r*r-3*r*r+1,0<r&&(E=4*(K+B*c),t+=r*a[E+3],n+=r,255>a[E+3]&&(r=r*a[E+3]/250),u+=r*a[E],h+=r*a[E+1],y+=r*a[E+2],w+=r))}b[z]=u/w;b[z+1]=h/w;b[z+2]=y/w;b[z+3]=t/n}}})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(a,c){function f(a){a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";
case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}Object.defineProperty(c,"__esModule",{value:!0});c.getFullyQualifiedFontName=function(a){var c;a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":c="-bold";break a}c=""}var b;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":b="-italic";break a}b=""}c+=b;return f(a.family)+(0<c.length?c:"-regular")};c.getFontDecorationTop=function(a){switch(a){case "underline":return-26;
case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),function(a,c,f,g,e,b,m){return function(){function a(b,a,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=b;this.height=a;this._glyphSource=c;this._binPack=new m(b-
4,a-4);this._glyphData.push(new Uint8Array(b*a));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}a.prototype.getGlyphItems=function(b,a,c){for(var d=this,e=[],f=this._glyphSource,l=new Set,k=1/256,q=0;q<a.length;q++)l.add(Math.floor(a[q]*k));var n=[];l.forEach(function(a){if(256>=a){var e=b+a;d._rangePromises.has(e)?n.push(d._rangePromises.get(e)):(a=f.getRange(b,a,c).then(function(){d._rangePromises["delete"](e)}).catch(function(b){d._rangePromises["delete"](e);if(!g.isAbortError(b))throw Error("Unable to query resource");
}),d._rangePromises.set(e,a),n.push(a))}});return g.all(n).then(function(){var c,h=d._glyphIndex[b];h||(h={},d._glyphIndex[b]=h);for(var l=0;l<a.length;l++){c=a[l];var g=h[c];if(g)e[c]={sdf:!0,rect:g.rect,metrics:g.metrics,page:g.page};else if((g=f.getGlyph(b,c))&&g.metrics){var k=d._recordGlyph(g);h[c]={rect:k,metrics:g.metrics,tileIDs:null,page:d._currentPage};e[c]={sdf:!0,rect:k,metrics:g.metrics,page:d._currentPage};d._dirties[d._currentPage]=!0}}return e})};a.prototype._recordGlyph=function(d){var a=
d.metrics;if(0===a.width)a=new b.default(0,0,0,0);else{var c=a.width+6,e=a.height+6,f=c%4?4-c%4:4,g=e%4?4-e%4:4;1===f&&(f=5);1===g&&(g=5);a=this._binPack.allocate(c+f,e+g);a.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new m(this.width-4,this.height-4),a=this._binPack.allocate(c+f,e+g));f=this._glyphData[this._currentPage];
d=d.bitmap;var k=g=void 0;if(d)for(var r=0;r<e;r++)for(var g=c*r,k=this.width*(a.y+r+1)+a.x,w=0;w<c;w++)f[k+w+1]=d[g+w]}return a};a.prototype._addDecorationGlyph=function(){for(var b=[117,149,181,207,207,181,149,117],a=[],c=0;c<b.length;c++)for(var e=b[c],f=0;11>f;f++)a.push(e);b={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(a)};this._recordGlyph(b)};a.prototype.bind=function(b,a,c,f){this._textures[c]||(this._textures[c]=new e.Texture(b,{pixelFormat:6406,dataType:5121,
width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var d=this._textures[c];d.setSamplingMode(a);this._dirties[c]&&d.setData(this._glyphData[c]);b.bindTexture(d,f);this._dirties[c]=!1};a.prototype.dispose=function(){this._binPack=null;for(var b=0,a=this._textures;b<a.length;b++){var c=a[b];c&&c.dispose()}this._textures.length=0;this._glyphData.length=0};return a}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,
"__esModule",{value:!0});a=function(){function a(a,c,b,f){void 0===a&&(a=0);void 0===c&&(c=0);void 0===b&&(b=0);void 0===f&&(f=0);this.x=a;this.y=c;this.width=b;this.height=f}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});a.prototype.union=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height)};return a}();c.default=a})},
"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(a,c,f){return function(){function a(a,b){this._height=this._width=0;this._free=[];this._width=a;this._height=b;this._free.push(new f.default(0,0,a,b))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,
b){if(a>this._width||b>this._height)return new f.default;for(var c=null,e=-1,d=0;d<this._free.length;++d){var l=this._free[d];a<=l.width&&b<=l.height&&(null===c||l.y<=c.y&&l.x<=c.x)&&(c=l,e=d)}if(null===c)return new f.default;this._free.splice(e,1);c.width<c.height?(c.width>a&&this._free.push(new f.default(c.x+a,c.y,c.width-a,b)),c.height>b&&this._free.push(new f.default(c.x,c.y+b,c.width,c.height-b))):(c.width>a&&this._free.push(new f.default(c.x+a,c.y,c.width-a,c.height)),c.height>b&&this._free.push(new f.default(c.x,
c.y+b,a,c.height-b)));return new f.default(c.x,c.y,a,b)};a.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else if(a.x===c.x&&a.width===c.width&&a.y+a.height===c.y)c.y=a.y,c.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};
return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(a,c,f,g,e,b){var m=function(){function b(b){this._metrics=[];for(this._bitmaps=[];b.next();)switch(b.tag()){case 1:for(var d=b.getMessage();d.next();)switch(d.tag()){case 3:for(var a=d.getMessage(),c=void 0,e=void 0,f=void 0,l=void 0,g=void 0,k=void 0,u=void 0;a.next();)switch(a.tag()){case 1:c=
a.getUInt32();break;case 2:e=a.getBytes();break;case 3:f=a.getUInt32();break;case 4:l=a.getUInt32();break;case 5:g=a.getSInt32();break;case 6:k=a.getSInt32();break;case 7:u=a.getUInt32();break;default:a.skip()}a.release();c&&(this._metrics[c]={width:f,height:l,left:g,top:k,advance:u},this._bitmaps[c]=e);break;default:d.skip()}d.release();break;default:b.skip()}}b.prototype.getMetrics=function(b){return this._metrics[b]};b.prototype.getBitmap=function(b){return this._bitmaps[b]};return b}(),k=function(){function b(){this._ranges=
[]}b.prototype.getRange=function(b){return this._ranges[b]};b.prototype.addRange=function(b,d){this._ranges[b]=d};return b}();return function(){function d(b){this._glyphInfo={};this._baseURL=b}d.prototype.getRange=function(d,a,c){var l=this._getFontStack(d);if(l.getRange(a))return b.resolve();var k=256*a,q=k+255;d=this._baseURL.replace("{fontstack}",d).replace("{range}",k+"-"+q);return g(d,f({responseType:"array-buffer"},c)).then(function(b){l.addRange(a,new m(new e(new Uint8Array(b.data),new DataView(b.data))))})};
d.prototype.getGlyph=function(b,d){if(b=this._getFontStack(b)){var a=Math.floor(d/256);if(!(256<a)&&(b=b.getRange(a)))return{metrics:b.getMetrics(d),bitmap:b.getBitmap(d)}}};d.prototype._getFontStack=function(b){var d=this._glyphInfo[b];d||(d=this._glyphInfo[b]=new k);return d};return d}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(a,c,f,g,e){Object.defineProperty(c,
"__esModule",{value:!0});a=function(){function b(b){this.size=b;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=b;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b)}b.prototype.draw=function(b,a,d){var c=this;void 0===d&&(d=31);this._initSVG();var k=this._createSVGString(b);return f.create(function(b,
f){var l=new Image;l.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);l.onload=function(){c.context.clearRect(0,0,c.size,c.size);c.context.drawImage(l,0,0,c.size,c.size);for(var a=c.context.getImageData(0,0,c.size,c.size),f=new Uint8Array(c.size*c.size*4),g=0;g<c.size*c.size;g++){var k=a.data[4*g+3]/255;c._gridOuter[g]=1===k?0:0===k?1E20:Math.pow(Math.max(0,.5-k),2);c._gridInner[g]=1===k?1E20:0===k?0:Math.pow(Math.max(0,k-.5),2)}c._edt(c._gridOuter,c.size,c.size);c._edt(c._gridInner,
c.size,c.size);for(g=0;g<c.size*c.size;g++)e.packFloatRGBA(.5-(c._gridOuter[g]-c._gridInner[g])/(2*d),f,4*g);b(f)};var q=a&&a.signal;if(q)g.onAbort(q,function(){return f(g.createAbortError())})})};b.prototype._initSVG=function(){if(!this._svg){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");b.setAttribute("aria-hidden","true");b.setAttribute("role","presentation");document.body.appendChild(b);
this._svg=b}};b.prototype._createSVGString=function(b){var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",b);this._svg.appendChild(a);b=a.getBBox();var d=b.width/b.height,c=this.size/2,e,f,g;1<d?(f=e=c/b.width,g=this.size/4,d=c-1/d*c/2):(e=f=c/b.height,g=c-c*d/2,d=this.size/4);a.setAttribute("style","transform: matrix("+e+", 0, 0, "+f+", "+(-b.x*e+g)+", "+(-b.y*f+d)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+
this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(a);return b};b.prototype._edt=function(b,a,d){for(var c=this._f,e=this._d,f=this._v,g=this._z,k=0;k<a;k++){for(var m=0;m<d;m++)c[m]=b[m*a+k];this._edt1d(c,e,f,g,d);for(m=0;m<d;m++)b[m*a+k]=e[m]}for(m=0;m<d;m++){for(k=0;k<a;k++)c[k]=b[m*a+k];this._edt1d(c,e,f,g,a);for(k=0;k<a;k++)b[m*a+k]=Math.sqrt(e[k])}};b.prototype._edt1d=function(b,a,d,c,e){d[0]=0;c[0]=-1E20;c[1]=1E20;for(var f=1,l=0;f<e;f++){for(var g=(b[f]+f*f-(b[d[l]]+d[l]*d[l]))/(2*f-
2*d[l]);g<=c[l];)l--,g=(b[f]+f*f-(b[d[l]]+d[l]*d[l]))/(2*f-2*d[l]);l++;d[l]=f;c[l]=g;c[l+1]=1E20}for(l=f=0;f<e;f++){for(;c[l+1]<f;)l++;a[f]=(f-d[l])*(f-d[l])+b[d[l]]}};return b}();c.default=a})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require","exports"],function(a,c){function f(b){return b-Math.floor(b)}Object.defineProperty(c,"__esModule",{value:!0});var g=[1,256,65536,16777216],e=[1/256,1/65536,1/16777216,1/4294967296],b=function(b,a){void 0===a&&(a=0);for(var d=0,c=0;4>c;c++)d+=
b[a+c]*e[c];return d}(new Uint8ClampedArray([255,255,255,255]));c.packFloatRGBA=function(a,c,d){void 0===d&&(d=0);a=0>a?0:a>b?b:a;for(var e=0;4>e;e++)c[d+e]=Math.floor(256*f(a*g[e]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),function(a,c,f,g,e,b,m,k,d){function l(b){return b&&"static"===b.type}return function(){function a(b,
a,c,e){void 0===e&&(e=0);this._mosaicPages=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=g("fix-sprite-locations");this._testId=g("test-id");this._pageHeight=this._pageWidth=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;this._requestRender=b;0<e&&(this._maxItemSize=e);this.pixelRatio=window.devicePixelRatio||
1;if(this._fixSpriteLocationsTable){b=[];for(var f in this._fixSpriteLocationsTable[this._testId])a=this._fixSpriteLocationsTable[this._testId][f],b[a.page]=a.pageSize;for(f=0;f<b.length;f++)a=b[f],this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(a[0]*a[1])},size:[a[0],a[1]],dirty:!0,texture:void 0})}this._binPack=new d(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},
size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}a.prototype.getWidth=function(b){return b>=this._mosaicPages.length?-1:this._mosaicPages[b].size[0]};a.prototype.getHeight=function(b){return b>=this._mosaicPages.length?-1:this._mosaicPages[b].size[1]};a.prototype.getPageTexture=function(b){return b<this._mosaicPages.length?this._mosaicPages[b].texture:null};a.prototype.has=function(b){return this._mosaicRects.has(b)};Object.defineProperty(a.prototype,"itemCount",{get:function(){return this._mosaicRects.size},
enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(b){return this._mosaicRects.get(b)};a.prototype.addSpriteItem=function(b,d,a,c,e,f){var g;if(this._mosaicRects.has(b))return this._mosaicRects.get(b);var q,h;l(a)?this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][b]?(g=this._fixSpriteLocationsTable[this._testId][b],q=g.rect,h=g.page,g=g.pageSize):(g=this._allocateImage(d[0],d[1]),q=g[0],h=g[1],g=g[2]):(q=new k.default(0,
0,d[0],d[1]),h=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:a,size:d,dirty:!0,texture:void 0}));if(0>=q.width||0>=q.height)return null;f={rect:q,width:d[0],height:d[1],sdf:e,simplePattern:f,pixelRatio:1,page:h};this._mosaicRects.set(b,f);l(a)&&this._copy({rect:q,spriteSize:d,spriteData:a.data,page:h,pageSize:g,repeat:c,sdf:e});return f};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=function(){var b=this._spriteCopyQueue.pop();
b&&this._copy(b)};a.prototype.getSpriteItems=function(b){for(var d={},a=0;a<b.length;a++){var c=b[a];d[c]=this.getSpriteItem(c)}return d};a.prototype.getMosaicItemPosition=function(b){var d=(b=this.getSpriteItem(b))&&b.rect;if(!d)return null;d.width=b.width;d.height=b.height;var a=this._mosaicPages[b.page];return{size:[b.width,b.height],tl:[(d.x+1)/a[0],(d.y+1)/a[1]],br:[(d.x+1+b.width)/a[0],(d.y+1+b.height)/a[1]],page:b.page}};a.prototype.bind=function(d,a,c,f){void 0===c&&(c=0);void 0===f&&(f=0);
c=this._mosaicPages[c];var g=c.mosaicsData,k=c.texture;k||(k=c.size,k=l(g)?new b.Texture(d,{pixelFormat:6408,dataType:5121,width:k[0],height:k[1]},new Uint8Array(g.data.buffer)):new b.Texture(d,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:k[0],height:k[1]},null),c.texture=k);k.setSamplingMode(a);l(g)?(d.bindTexture(k,f),c.dirty&&(k.setData(new Uint8Array(g.data.buffer)),k.generateMipmap())):(a=g.data,g=a.bindFrame(d,k,f),e.isSome(this._requestRender)&&g&&0<a.frameCount&&
this._requestRender.requestRender(),a.bindFrame(d,k,f));c.dirty=!1};a._copyBits=function(b,d,a,c,e,f,l,g,h,k,t){var q=c*d+a;l=g*f+l;if(t)for(l-=f,t=-1;t<=k;t++,q=((t+k)%k+c)*d+a,l+=f)for(g=-1;g<=h;g++)e[l+g]=b[q+(g+h)%h];else for(t=0;t<k;t++){for(g=0;g<h;g++)e[l+g]=b[q+g];q+=d;l+=f}};a.prototype._copy=function(b){if(!(b.page>=this._mosaicPages.length)){var d=this._mosaicPages[b.page],c=d.mosaicsData;if(!l(d.mosaicsData))throw new f("mapview-invalid-resource","unsuitable data type!");var e=b.spriteData;
(c=c.data)&&e||console.error("Source or target images are uninitialized!");a._copyBits(e,b.spriteSize[0],0,0,c,b.pageSize[0],b.rect.x+1,b.rect.y+1,b.spriteSize[0],b.spriteSize[1],b.repeat);d.dirty=!0}};a.prototype._allocateImage=function(b,a){b+=2;a+=2;var c=Math.max(b,a);if(this._maxItemSize&&this._maxItemSize<c){var c=Math.pow(2,Math.ceil(m.log2(b))),e=Math.pow(2,Math.ceil(m.log2(a)));b=new k.default(0,0,b,a);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(c*e)},size:[c,
e],dirty:!0,texture:void 0});return[b,this._mosaicPages.length-1,[c,e]]}c=this._binPack.allocate(b,a);return 0>=c.width?(c=this._mosaicPages[this._currentPage],!c.dirty&&l(c.mosaicsData)&&(c.mosaicsData=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new d(this._pageWidth,this._pageHeight),this._allocateImage(b,
a)):[c,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;for(var b=0,d=this._mosaicPages;b<d.length;b++){var a=d[b],c=a.texture;c&&c.dispose();a=a.mosaicsData;l(a)||a.data.pause()}this._mosaicPages=null;this._mosaicRects.clear()};return a}()})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(a,c){function f(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(c,"__esModule",{value:!0});c.C_INFINITY=Number.POSITIVE_INFINITY;
c.C_PI=Math.PI;c.C_2PI=2*c.C_PI;c.C_PI_BY_2=c.C_PI/2;c.C_RAD_TO_256=128/c.C_PI;c.C_256_TO_RAD=c.C_PI/128;c.C_DEG_TO_256=256/360;c.C_DEG_TO_RAD=c.C_PI/180;c.C_SQRT2=1.414213562;c.C_SQRT2_INV=1/c.C_SQRT2;var g=1/Math.LN2;c.positiveMod=f;c.radToByte=function(a){return f(a*c.C_RAD_TO_256,256)};c.degToByte=function(a){return f(a*c.C_DEG_TO_256,256)};c.log2=function(a){return Math.log(a)*g};c.sqr=function(a){return a*a};c.interpolate=function(a,b,c){return a*(1-c)+b*c};c.between=function(a,b,c){return a>=
b&&a<=c||a>=c&&a<=b}})},"esri/views/2d/engine/webgl/animatedFormats/apng":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/promiseUtils".split(" "),function(a,c,f,g,e,b,m){function k(b){var d=b.constructor===Uint8Array?b:new Uint8Array(b);return u.some(function(b,a){return b!==d[a]})?!1:!0}function d(b,d){var a=new Uint8Array(d);if(u.some(function(b,
d){return b!==a[d]}))return w;var c=!1;l(a,function(b){return!(c="acTL"===b)});if(!c)return n;var e=[],f=[],g=null,k=null,t=0;l(a,function(d,a,c,l){var q=new DataView(a.buffer);switch(d){case "IHDR":g=a.subarray(c+8,c+8+l);b.width=q.getUint32(c+8);b.height=q.getUint32(c+12);break;case "acTL":b.numPlays=q.getUint32(c+8+4);break;case "fcTL":k&&(b.frames.push(k),t++);k=new h;k.width=q.getUint32(c+8+4);k.height=q.getUint32(c+8+8);k.left=q.getUint32(c+8+12);k.top=q.getUint32(c+8+16);d=q.getUint16(c+8+
20);a=q.getUint16(c+8+22);0===a&&(a=100);k.delay=1E3*d/a;10>=k.delay&&(k.delay=100);b.playTime+=k.delay;k.disposeOp=q.getUint8(c+8+24);k.blendOp=q.getUint8(c+8+25);k.dataParts=[];0===t&&2===k.disposeOp&&(k.disposeOp=1);break;case "fdAT":k&&k.dataParts.push(a.subarray(c+8+4,c+8+l));break;case "IDAT":k&&k.dataParts.push(a.subarray(c+8,c+8+l));break;case "IEND":f.push(v(a,c,12+l));break;default:e.push(v(a,c,12+l))}});if(0===b.frames.length)return n;b.frameCount=b.frames.length;var q=new Blob(e),m=new Blob(f);
b.frames.forEach(function(b){var d=[];d.push(u);g.set(p(b.width),0);g.set(p(b.height),4);d.push(x("IHDR",g));d.push(q);b.dataParts.forEach(function(b){return d.push(x("IDAT",b))});d.push(m);b.data=new Blob(d,{type:"image/png"});delete b.dataParts;d=null});return b}function l(b,d){var a=new DataView(b.buffer),c=8,e,f,h;do f=a.getUint32(c),e=c+4,e=Array.prototype.slice.call(b.subarray(e,e+4)),e=String.fromCharCode.apply(String,e),h=d(e,b,c,f),c+=12+f;while(!1!==h&&"IEND"!==e&&c<b.length)}function q(b){for(var d=
new Uint8Array(b.length),a=0;a<b.length;a++)d[a]=b.charCodeAt(a);return d}function v(b,d,a){var c=new Uint8Array(a);c.set(b.subarray(d,d+a));return c}function x(b,d){var a=b.length+d.length,c=new Uint8Array(a+8),e=new DataView(c.buffer);e.setUint32(0,d.length);c.set(q(b),4);c.set(d,8);var f=4,h=a;void 0===f&&(f=0);void 0===h&&(h=c.length-f);b=-1;d=f;for(f+=h;d<f;d++)b=b>>>8^z[(b^c[d])&255];e.setUint32(a+4,b^-1);return c}function p(b){return new Uint8Array([b>>>24&255,b>>>16&255,b>>>8&255,b&255])}
Object.defineProperty(c,"__esModule",{value:!0});var z=new Uint32Array(256);for(a=0;256>a;a++){e=a;for(var r=0;8>r;r++)e=0!==(e&1)?3988292384^e>>>1:e>>>1;z[a]=e}var w=new b("Not a PNG"),n=new b("Not an animated PNG"),u=new Uint8Array([137,80,78,71,13,10,26,10]);c.isPNG=k;c.getPNGSize=function(b){b=new Uint8Array(b);var d,a;l(b,function(b,c,e){c=new DataView(c.buffer);"IHDR"===b&&(d=c.getUint32(e+8),a=c.getUint32(e+12))});return[d,a]};c.isAnimatedPNG=function(b){b=new Uint8Array(b);if(!k(b))return!1;
var d=!1;l(b,function(b){return!(d="acTL"===b)});return d};a=function(){function a(){this.playTime=this.numPlays=this.height=this.width=0;this.frames=[];this.playing=this.paused=!1;this.playSpeed=1;this.currentFrameNumber=0;this._lastUsedFrame=-1}a.create=function(d,c){return g(this,void 0,void 0,function(){var e,h;return f(this,function(f){switch(f.label){case 0:e=new a,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,e._load(d,c)];case 2:return f.sent(),[3,4];case 3:return h=f.sent(),m.isAbortError(h)?
[3,4]:[2,new b("invalid-resource","Could not load PNG: "+h.message)];case 4:return[2,e]}})})};a.prototype.play=function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};a.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};a.prototype.togglePlay=function(){this.paused||!this.playing?this.play():this.pause()};a.prototype.bindFrame=function(b,d,a){b.bindTexture(d,a);b=this.frameChanged();if(!b)return!1;a=this.currentFrame;var c=a.frameData,e=d.descriptor;
(a.left||a.top||a.width!==e.width||a.height!==e.height)&&d.setData(null);d.updateData(0,a.left,a.top,a.width,a.height,c);this.updateUsedFrame();return b};a.prototype.frameChanged=function(){return this._lastUsedFrame!==this.currentFrameNumber};a.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};a.prototype._load=function(a,c){return g(this,void 0,void 0,function(){var c,e,h=this;return f(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);c=d(this,a);if(c!==
this)return[2,c];this._resizeCanvas=document.createElement("canvas");this._resizeCanvas.width=this.width;this._resizeCanvas.height=this.height;return[4,m.all(this.frames.map(function(b){return b.createImage(h._resizeCanvas)}))];case 1:return f.sent(),[3,3];case 2:return e=f.sent(),m.isAbortError(e)?[3,3]:[2,new b("invalid-resource","Could not parse PNG")];case 3:return this.play(),[2]}})})};a.prototype._play=function(){var b=this,d;if(0===this.playSpeed)this.pause();else{0>this.playSpeed?(--this.currentFrameNumber,
0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),d=this.currentFrameNumber,--d,0>d&&(d=this.frames.length-1),d=1*-this.frames[d].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,d=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);var a=this.frames[this.currentFrameNumber];this.currentFrame={frameData:a.imageData,top:a.top,left:a.left,width:a.width,height:a.height};this.timerID=window.setTimeout(function(){return b._play()},
d)}};return a}();c.default=a;var h=function(){function b(){this.blendOp=this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageData=this.data=null}b.prototype.createImage=function(b){return g(this,void 0,void 0,function(){var d=this;return f(this,function(a){return null!==this.imageData?[2]:[2,m.create(function(a,c){var e=URL.createObjectURL(d.data),f=document.createElement("img");f.onload=function(){URL.revokeObjectURL(e);var c;b.width=f.width;b.height=f.height;c=b.getContext("2d");
c.drawImage(f,0,0,f.width,f.height);c=c.getImageData(0,0,f.width,f.height);c=new Uint8Array(c.data);for(var h,l=0;l<c.length;l+=4)h=c[l+3]/255,c[l]*=h,c[l+1]*=h,c[l+2]*=h;c=new ImageData(new Uint8ClampedArray(c.buffer),f.width,f.height);d.imageData=c;a()};f.onerror=function(){URL.revokeObjectURL(e);d.imageData=null;c(Error("Image creation error"))};f.src=e})]})})};return b}()})},"esri/views/2d/engine/webgl/animatedFormats/gif":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/promiseUtils".split(" "),
function(a,c,f,g,e,b,m){function k(b){if(!b||0===b.byteLength)return!1;b=b.constructor===Uint8Array?b:new Uint8Array(b);return 71===b[0]&&73===b[1]&&70===b[2]&&56===b[3]}Object.defineProperty(c,"__esModule",{value:!0});c.isGIF=k;c.getGIFSize=function(b){var d=new Uint8ClampedArray(b),a=6;b=d[a++]+(d[a++]<<8);d=d[a++]+(d[a++]<<8);return[b,d]};c.isAnimatedGIF=function(b){if(!b||0===b.byteLength)return!1;b=new Uint8Array(b);if(!k(b))return!1;for(var d=0,a=0,c=b.length-9;a<c&&(0!==b[a]||33!==b[a+1]||
249!==b[a+2]||4!==b[a+3]||0!==b[a+8]||44!==b[a+9]&&33!==b[a+9]||(d++,!(1<d)));++a);return 1<d};a=function(){function a(){this.playing=this.paused=!1;this.waitTillDone=!0;this.firstFrameOnly=this.loading=!1;this.frames=[];this.comment="";this.frameCount=this.currentFrameNumber=this.length=0;this.playSpeed=1;this.lastFrame=null;this.playOnLoad=!0;this.complete=!1;this.interlaceOffsets=[0,4,2,1];this.interlaceSteps=[8,8,4,2];this._lastUsedFrame=-1}a.create=function(d,c){return g(this,void 0,void 0,function(){var e,
g;return f(this,function(f){switch(f.label){case 0:e=new a,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,e._load(d,c)];case 2:return f.sent(),[3,4];case 3:return g=f.sent(),m.isAbortError(g)?[3,4]:[2,new b("invalid-resource","Could not load PNG: "+g.message)];case 4:return[2,e]}})})};a.prototype.play=function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};a.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};a.prototype.togglePlay=function(){this.paused||
!this.playing?this.play():this.pause()};a.prototype.bindFrame=function(b,d,a){b.bindTexture(d,a);if(b=this.frameChanged())a=this.currentFrame,d.updateData(0,0,0,a.width,a.height,a.frameData),this.updateUsedFrame();return b};a.prototype.seekFrame=function(b){clearTimeout(this.timerID);this.currentFrameNumber=b%this.frames.length;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};a.prototype.seek=function(b){clearTimeout(this.timerID);0>b&&(b=0);b=1E3*b%this.length;for(var d=
0;b>this.frames[d].time+this.frames[d].delay&&d<this.frames.length;)d+=1;this.currentFrameNumber=d;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};a.prototype.frameChanged=function(){return this._lastUsedFrame!==this.currentFrameNumber};a.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};a.prototype._load=function(d,a){return g(this,void 0,void 0,function(){var c;return f(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),
this.loading=!0,[4,this._parse(d,a)];case 1:return e.sent(),this.loading=!1,this.play(),[3,3];case 2:return c=e.sent(),m.isAbortError(c)?[3,3]:[2,new b("invalid-resource","Could not parse gif!")];case 3:return[2]}})})};a.prototype._parse=function(b,a){var c=this,e=new d(b);e.pos+=6;this.width=e.data[e.pos++]+(e.data[e.pos++]<<8);this.height=e.data[e.pos++]+(e.data[e.pos++]<<8);b=e.data[e.pos++];this.globalColourCount=1<<(b&7)+1;e.pos++;e.pos++;b&128&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,
e));return m.create(function(b,d){setTimeout(function(){return c._parseBlock(e,b,d,a)},0)})};a.prototype._parseBlock=function(b,d,a,c){return g(this,void 0,void 0,function(){var e,g=this;return f(this,function(f){if(c&&c.signal&&m.isAborted(c.signal))return a(m.createAbortError()),[2];e=b.data[b.pos++];if(44===e){if(this._parseImg(b),this.firstFrameOnly)return this._finishedLoading(),d(),[2]}else{if(59===e)return this._finishedLoading(),d(),[2];this._parseExt(b)}if("function"===typeof this.onprogress)this.onprogress({bytesRead:b.pos,
totalBytes:b.data.length,frame:this.frames.length});setTimeout(function(){return g._parseBlock(b,d,a,c)},0);return[2]})})};a.prototype._parseColourTable=function(b,d){for(var a=[],c=0;c<b;c++)a.push([d.data[d.pos++],d.data[d.pos++],d.data[d.pos++]]);return a};a.prototype._parseImg=function(b){var d={};this.frames.push(d);d.disposalMethod=this.disposalMethod;d.time=this.length;d.delay=10*this.delayTime;this.length+=d.delay;d.transparencyIndex=this.transparencyGiven?this.transparencyIndex:void 0;d.leftPos=
b.data[b.pos++]+(b.data[b.pos++]<<8);d.topPos=b.data[b.pos++]+(b.data[b.pos++]<<8);d.width=b.data[b.pos++]+(b.data[b.pos++]<<8);d.height=b.data[b.pos++]+(b.data[b.pos++]<<8);var a=b.data[b.pos++];d.localColourTableFlag=a&128?!0:!1;d.localColourTableFlag&&(d.localColourTable=this._parseColourTable(1<<(a&7)+1,b));this.pixelBufSize!==d.width*d.height&&(this.pixelBuf=new Uint8Array(d.width*d.height),this.pixelBufSize=d.width*d.height);this._lzwDecode(b.data[b.pos++],b.readSubBlocksB());if(a&64){d.interlaced=
!0;b=d.width;a=this.pixelBufSize/b;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);for(var c=0,e=0;4>e;e++)for(var f=this.interlaceOffsets[e];f<a;f+=this.interlaceSteps[e])this.deinterlaceBuf.set(this.pixelBuf.subarray(c,c+b),f*b),c+=b}else d.interlaced=!1;this._processFrame(d)};a.prototype._lzwDecode=function(b,d){var a,c,e,f,g,l,k,h,q,t;e=c=0;var m=[];f=1<<b;g=f+1;l=b+1;for(t=!1;!t;){h=k;for(a=k=0;a<l;a++)d[e>>
3]&1<<(e&7)&&(k|=1<<a),e++;if(k===f){m=[];l=b+1;for(a=0;a<f;a++)m[a]=[a];m[f]=[];m[g]=null}else{if(k===g){t=!0;break}k>=m.length?m.push(m[h].concat(m[h][0])):h!==f&&m.push(m[h].concat(m[k][0]));h=m[k];q=h.length;for(a=0;a<q;a++)this.pixelBuf[c++]=h[a];m.length===1<<l&&12>l&&l++}}};a.prototype._processFrame=function(b){b.image=document.createElement("canvas");b.image.width=this.width;b.image.height=this.height;b.ctx=b.image.getContext("2d");var d=b.localColourTableFlag?b.localColourTable:this.globalColourTable;
null===this.lastFrame&&(this.lastFrame=b);var a=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod?!0:!1;a||b.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);for(var c=b.ctx.getImageData(b.leftPos,b.topPos,b.width,b.height),e=b.transparencyIndex,f=c.data,g=b.interlaced?this.deinterlaceBuf:this.pixelBuf,l=g.length,k=0,h,q,t=0;t<l;t++)h=g[t],q=d[h],e!==h?(f[k++]=q[0],f[k++]=q[1],f[k++]=q[2],f[k++]=255):(a&&(f[k+3]=0),k+=4);b.ctx.putImageData(c,b.leftPos,b.topPos);this.lastFrame=
b};a.prototype._parseExt=function(b){var d=b.data[b.pos++];249===d?this._parseGCExt(b):254===d?this.comment+=b.readSubBlocks():255===d?this._parseAppExt(b):(1===d&&(b.pos+=13),b.readSubBlocks())};a.prototype._parseAppExt=function(b){b.pos+=1;"NETSCAPE"===b.getString(8)?b.pos+=8:(b.pos+=3,b.readSubBlocks())};a.prototype._parseGCExt=function(b){var d;b.pos++;d=b.data[b.pos++];this.disposalMethod=(d&28)>>2;this.transparencyGiven=d&1?!0:!1;this.delayTime=b.data[b.pos++]+(b.data[b.pos++]<<8);this.transparencyIndex=
b.data[b.pos++];b.pos++};a.prototype._finishedLoading=function(){this.loading=!1;this.frameCount=this.frames.length;this.lastFrame=null;this.complete=!0;this.deinterlaceBuf=this.pixelBufSize=this.deinterlaceBuf=this.pixelBuf=this.waitTillDone=this.transparencyIndex=this.delayTime=this.transparencyGiven=this.disposalMethod=void 0;this.currentFrameNumber=0;0<this.frames.length&&this._setCurrentFrame(0);this.playOnLoad&&this.play()};a.prototype._play=function(){var b=this,d;0===this.playSpeed?this.pause():
(0>this.playSpeed?(--this.currentFrameNumber,0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),d=this.currentFrameNumber,--d,0>d&&(d=this.frames.length-1),d=1*-this.frames[d].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,d=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout(function(){return b._play()},d))};a.prototype._setCurrentFrame=function(b){this.currentFrame=
{frameData:this.frames[b].image,top:0,left:0,width:this.width,height:this.height}};return a}();c.default=a;var d=function(){function b(b){this.pos=0;this.data=new Uint8ClampedArray(b);this.len=this.data.length}b.prototype.getString=function(b){for(var d="";b--;)d+=String.fromCharCode(this.data[this.pos++]);return d};b.prototype.readSubBlocks=function(){var b,d,a="";do for(d=b=this.data[this.pos++];d--;)a+=String.fromCharCode(this.data[this.pos++]);while(0!==b&&this.pos<this.len);return a};b.prototype.readSubBlocksB=
function(){var b,d,a=[];do for(d=b=this.data[this.pos++];d--;)a.push(this.data[this.pos++]);while(0!==b&&this.pos<this.len);return a};return b}()})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.ok=function(a,c){return a&&"name"in a?(c&&c.error(new f(a.name,a.message,a.details)),!1):!0}})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["require","exports"],
function(a,c){function f(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function g(a){if(a=f(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0;case "CIMPictureMarker":return!0}return!1}Object.defineProperty(c,"__esModule",{value:!0});c.keyFromSymbol=
function(a){if(a.type){switch(f(a.type)){case "simple-marker":return a.path?"simple-marker"+a.style+a.path:"simple-marker"+a.style;case "simple-line":return"simple-line"+a.style+a.cap;case "simple-fill":return"simple-fill"+a.style}if(a.mosaicHash)return a.mosaicHash;if(g(a))return a.imageData?a.imageData:a.url+(""+a.width+a.height)}return JSON.stringify(a)};c.normalizeSymbolType=f;c.isMarkerSymbol=function(a){if(a=f(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0;
case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!0}return!1}};c.isFillSymbol=function(a){if(a=f(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}};c.isLineSymbol=function(a){if(a=f(a.type)){switch(a){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}};c.isPictureSymbol=g;c.isTextSymbol=function(a){if(a=f(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}}})},
"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.defines=[];b._desc={path:"fx/integrate",attributes:{a_position:0}};return b}f(d,a);d.prototype.dispose=function(){this._quad&&this._quad.dispose()};
d.prototype.bind=function(){};d.prototype.unbind=function(){};d.prototype.draw=function(a,d){if(d.size){var c=a.context,f=a.renderingOptions;this._quad||(this._quad=new b(c,[0,0,1,0,0,1,1,1]));var l=c.getBoundFramebufferObject(),k=c.getViewport(),q=k.x,m=k.y,n=k.width,k=k.height;d.bindTextures(c);var u=d.getBlock(e.ATTRIBUTE_DATA_ANIMATION);if(!g.isNone(u)){var h=u.getFBO(c),u=u.getFBO(c,1);c.setViewport(0,0,d.size,d.size);this._computeDelta(a,u,f.labelsAnimationTime);this._updateAnimationState(a,
u,h);c.bindFramebuffer(l);c.setViewport(q,m,n,k)}}};d.prototype._computeDelta=function(b,a,d){var c=b.context,f=b.displayLevel,g=b.painter.materialManager.getProgram(b,this._desc,["delta"]);c.bindFramebuffer(a);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(g);g.setUniform1i("u_maskTexture",e.TEXTURE_BINDING_ATTRIBUTE_DATA_0);g.setUniform1i("u_sourceTexture",e.TEXTURE_BINDING_ATTRIBUTE_DATA_1);g.setUniform1f("u_timeDelta",b.timeDelta);g.setUniform1f("u_animationTime",d/1E3);
g.setUniform1f("u_zoomLevel",Math.round(10*f));this._quad.draw()};d.prototype._updateAnimationState=function(b,a,d){var c=b.context;b=b.painter.materialManager.getProgram(b,this._desc,["update"]);c.bindTexture(a.colorTexture,1);c.bindProgram(b);b.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(d);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()};return d}(m.Effect);c.AnimationEffect=a})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports",
"../../../../core/tsSupport/declareExtendsHelper","../../../webgl"],function(a,c,f,g){return function(){function a(b,a){this.rctx=b;this._vertexBuffer=g.BufferObject.createVertex(b,35044,new Uint16Array(a));this._vao=new g.VertexArrayObject(b,{a_position:0},{geometry:[{name:"a_position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};a.prototype.dispose=function(){this._vao.dispose(!1);
this._vertexBuffer.dispose()};a.prototype.draw=function(){this.rctx.bindVAO(this._vao);this.rctx.drawArrays(5,0,4)};return a}()})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){return function(){this.name=this.constructor.name}}();c.Effect=a})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/has ../BitBlitRenderer ../effects/Effect ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),
function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.defines=["highlight"];a._hlRenderer=new k.default;a._hlGradient=new m.default;a._width=void 0;a._height=void 0;a._hlSurfaces=new d.default;a._adjustedWidth=void 0;a._adjustedHeight=void 0;a._blitRenderer=new e.BitBlitRenderer;return a}f(a,b);a.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();
this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};a.prototype.bind=function(b){var a=b.context,d=b.painter,c=a.getViewport(),e=c.width,c=c.height,d=d.getFbos(e,c).effect0;this.setup(b,e,c);a.bindFramebuffer(d);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};a.prototype.unbind=function(){};a.prototype.setup=function(b,a,d){b=b.context;this._width=a;this._height=d;var c=a%4,e=d%4;a+=2>c?-c:4-c;d+=2>e?-e:4-e;this._adjustedWidth=a;this._adjustedHeight=d;this._boundFBO=b.getBoundFramebufferObject();
a=Math.round(.75*a);d=Math.round(.75*d);this._hlRenderer.setup(b,a,d);this._hlSurfaces.setup(b,a,d)};a.prototype.draw=function(b){b=b.context;var a=b.getBoundFramebufferObject();b.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight);b.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);b.setStencilTestEnabled(!1);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(b,a.colorTexture,9728,1);b.setStencilTestEnabled(!1);b.setBlendingEnabled(!1);b.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);
b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(b,this._hlSurfaces.sharedBlur1Tex);b.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(b,this._hlSurfaces.sharedBlur2Tex);b.bindFramebuffer(this._boundFBO);b.setBlendingEnabled(!0);b.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(b,this._hlSurfaces.sharedBlur1Tex,this._hlGradient);this._boundFBO=null};a.prototype.setHighlightOptions=
function(b){this._hlGradient.setHighlightOptions(b)};return a}(b.Effect);c.default=a})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),function(a,c,f,g,e,b){function m(a,d){d.fillColor[0]=a.color.r/255;d.fillColor[1]=a.color.g/255;d.fillColor[2]=a.color.b/255;d.fillColor[3]=a.color.a;a.haloColor?(d.outlineColor[0]=a.haloColor.r/255,d.outlineColor[1]=a.haloColor.g/
255,d.outlineColor[2]=a.haloColor.b/255,d.outlineColor[3]=a.haloColor.a):(d.outlineColor[0]=d.fillColor[0],d.outlineColor[1]=d.fillColor[1],d.outlineColor[2]=d.fillColor[2],d.outlineColor[3]=d.fillColor[3]);d.fillColor[3]*=a.fillOpacity;d.outlineColor[3]*=a.haloOpacity;d.fillColor[0]*=d.fillColor[3];d.fillColor[1]*=d.fillColor[3];d.fillColor[2]*=d.fillColor[3];d.outlineColor[0]*=d.outlineColor[3];d.outlineColor[1]*=d.outlineColor[3];d.outlineColor[2]*=d.outlineColor[3];d.outlineWidth=b.HIGHLIGHT_SIZING.outlineWidth;
d.outerHaloWidth=b.HIGHLIGHT_SIZING.outerHaloWidth;d.innerHaloWidth=b.HIGHLIGHT_SIZING.innerHaloWidth;d.outlinePosition=b.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(c,"__esModule",{value:!0});var k=f.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),d=[0,0,0,0];a=function(){function a(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:b.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:b.HIGHLIGHT_SIZING.outlineWidth,
innerHaloWidth:b.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:b.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*b.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}a.prototype.setHighlightOptions=function(a){function c(b,a,d){h[0]=(1-d)*b[0]+d*a[0];h[1]=(1-d)*b[1]+d*a[1];h[2]=(1-d)*b[2]+d*a[2];h[3]=(1-d)*b[3]+d*a[3]}var e,f=this._convertedHighlightOptions;m(a,f);a=f.outlinePosition-f.outlineWidth/2-f.outerHaloWidth;var g=f.outlinePosition-f.outlineWidth/2,l=
f.outlinePosition+f.outlineWidth/2,q=f.outlinePosition+f.outlineWidth/2+f.innerHaloWidth,n=Math.sqrt(Math.PI/2)*b.SIGMAS[3],u=Math.abs(a)>n?Math.round(10*(Math.abs(a)-n))/10:0,n=Math.abs(q)>n?Math.round(10*(Math.abs(q)-n))/10:0;u&&!n?k.error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&n?k.error("The inner rim of the highlight is "+n+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
u&&n&&k.error("The highlight is "+Math.max(u,n)+"px away from the edge of the feature; consider reducing some width values.");for(var h=[void 0,void 0,void 0,void 0],u=this.texelData,n=0;n<b.SHADE_TEXTURE_SIZE;++n)e=a+n/(b.SHADE_TEXTURE_SIZE-1)*(q-a),e<a?(h[4*n+0]=0,h[4*n+1]=0,h[4*n+2]=0,h[4*n+3]=0):e<g?c(d,f.outlineColor,(e-a)/(g-a)):e<l?(e=f.outlineColor,h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=e[3]):e<q?c(f.outlineColor,f.fillColor,(e-l)/(q-l)):(e=f.fillColor,h[4*n+0]=e[0],h[4*n+1]=e[1],h[4*n+2]=e[2],
h[4*n+3]=e[3]),u[4*n+0]=255*h[0],u[4*n+1]=255*h[1],u[4*n+2]=255*h[2],u[4*n+3]=255*h[3];this.minMaxDistance[0]=a;this.minMaxDistance[1]=q;this.shadeTexChanged=!0};a.prototype.applyHighlightOptions=function(a,d){this.shadeTex||(this.shadeTex=new g.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:b.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,b.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);a.bindTexture(this.shadeTex,
e.TEXTURE_BINDING_HIGHLIGHT_1);d.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};a.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return a}();c.default=a})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.SIGMAS=[void 0,void 0,void 0,1];c.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];c.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.SHADE_TEXTURE_SIZE=256;c.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=
function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};a.prototype.preBlur=function(b,a){b.bindTexture(a,g.TEXTURE_BINDING_HIGHLIGHT_0);b.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",e.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
b.bindVAO(this._resources.quadVAO);b.drawArrays(5,0,4);b.bindVAO()};a.prototype.finalBlur=function(b,a){b.bindTexture(a,g.TEXTURE_BINDING_HIGHLIGHT_0);b.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",e.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);b.bindVAO(this._resources.quadVAO);b.drawArrays(5,0,4);b.bindVAO()};a.prototype.renderHighlight=function(b,a,c){b.bindTexture(a,
g.TEXTURE_BINDING_HIGHLIGHT_0);b.bindProgram(this._resources.highlightProgram);c.applyHighlightOptions(b,this._resources.highlightProgram);b.bindVAO(this._resources.quadVAO);b.setBlendingEnabled(!0);b.setBlendFunction(1,771);b.drawArrays(5,0,4);b.bindVAO()};a.prototype._initialize=function(a,d,c){this._width=d;this._height=c;d=new f.BufferObject(a,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);c=new f.VertexArrayObject(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",
count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d});var k=f.createProgram(a,b.highlight);a=f.createProgram(a,b.blur);k.setUniform1i("u_texture",g.TEXTURE_BINDING_HIGHLIGHT_0);k.setUniform1i("u_shade",g.TEXTURE_BINDING_HIGHLIGHT_1);k.setUniform4fv("u_sigmas",e.SIGMAS);a.setUniform1i("u_texture",g.TEXTURE_BINDING_HIGHLIGHT_0);a.setUniform4fv("u_sigmas",e.SIGMAS);this._resources={quadGeometry:d,quadVAO:c,highlightProgram:k,
blurProgram:a}};a.prototype.setup=function(b,a,c){this._resources?(this._width=a,this._height=c):this._initialize(b,a,c)};return a}();c.default=a})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.highlight={name:"highlight",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),fragmentShader:f.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,
a_texcoord:1}};c.blur={name:"blur",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),fragmentShader:f.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl"],function(a,c,f){function g(a,b,c){b=new f.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:b,height:c,samplingMode:9729});a=new f.FramebufferObject(a,
{colorTarget:0,depthStencilTarget:2},b);return[b,a]}Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=function(b,a,c){this._width=a;this._height=c;var d=g(b,a,c),e=
d[0],d=d[1];b=g(b,a,c);this._resources={sharedBlur1Tex:e,sharedBlur1Fbo:d,sharedBlur2Tex:b[0],sharedBlur2Fbo:b[1]}};a.prototype.setup=function(b,a,c){!this._resources||this._width===a&&this._height===c||this.dispose();this._resources||this._initialize(b,a,c)};Object.defineProperty(a.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return a}();c.default=a})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d.name=d.constructor.name;d.defines=["id"];d._buf=new Uint8Array(4*b.HITTEST_SEARCH_SIZE*b.HITTEST_SEARCH_SIZE);d._buf32=new Uint32Array(d._buf.buffer);return d}f(d,a);d.prototype.dispose=function(){e.isSome(this._fbo)&&this._fbo.dispose()};d.prototype.bind=function(b){var a=b.context;b=b.painter;var d=a.getViewport();b=b.getFbos(d.width,d.height).effect0;
a.bindFramebuffer(b);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};d.prototype.unbind=function(){};d.prototype.draw=function(a,d,c){var e=this,f=a.context,k=a.state,l=a.pixelRatio;void 0===c&&(c=b.HITTEST_SEARCH_SIZE);var m=f.getBoundFramebufferObject(),n=k.size[1],u=c/2,h=c/2;d.forEach(function(b,a){var f=new Map;m.readPixels(Math.floor((a[0]-c/2)*l),Math.floor((n-a[1]-c/2)*l),c,c,6408,5121,e._buf);for(var k=0;k<e._buf32.length;k++){var t=e._buf32[k];if(4294967295!==t&&0!==t){var p=k%
c,q=c-Math.floor(k/c),p=(u-p)*(u-p)+(h-q)*(h-q),q=f.has(t)?f.get(t):4294967295;f.set(t,Math.min(p,q))}}f=g.pairsOfMap(f).sort(function(b,a){return b[1]-a[1]}).map(function(b){return b[0]});b.resolve(f);d.delete(a)})};return d}(m.Effect);c.HittestEffect=a})},"esri/views/2d/engine/webgl/effects/blendEffects/BlendEffectMultiply":function(){define(["require","exports","../../../../../webgl"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._size=[0,0]}a.prototype.dispose=
function(){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null);this._mutiplyProgram&&(this._mutiplyProgram.dispose(),this._mutiplyProgram=null);this._quadVAO&&this._quadVAO.dispose(!0)};a.prototype.draw=function(a,b,c,f){var d=a.context,e=a.state.size,g=d.gl;this._setupShader(d);this._createOrResizeTexture(a);a=this._backBufferTexture;d.bindTexture(a,0);g.copyTexImage2D(g.TEXTURE_2D,0,g.RGBA,0,0,e[0],e[1],0);d.setStencilTestEnabled(!1);d.setStencilWriteMask(0);
d.setBlendingEnabled(!0);d.setDepthTestEnabled(!1);d.setDepthWriteEnabled(!1);d.bindVAO(this._quadVAO);e=this._mutiplyProgram;d.bindProgram(e);a.setSamplingMode(c);d.bindTexture(a,0);e.setUniform1i("u_backbufferTexture",0);b.setSamplingMode(c);d.bindTexture(b,1);e.setUniform1i("u_layerTexture",1);e.setUniform1f("u_opacity",f);d.setBlendFunction(1,0);d.drawArrays(5,0,4);d.bindVAO(null);d.setBlendFunction(1,771)};a.prototype._setupShader=function(a){if(!this._mutiplyProgram){var b={a_pos:0,a_uv:1},
c=new f.Program(a,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n      precision mediump float;\n\n      uniform sampler2D u_backbufferTexture;\n      uniform sampler2D u_layerTexture;\n      uniform float u_opacity;\n\n      const vec4 white \x3d vec4(1.0, 1.0, 1.0, 1.0);\n\n      varying vec2 v_uv;\n      void main() {\n        vec4 backbufferColor \x3d texture2D(u_backbufferTexture, v_uv);\n        vec4 layerColor \x3d u_opacity * texture2D(u_layerTexture, v_uv);\n\n        vec4 tmpComposition \x3d vec4(layerColor.rgb + (1.0 - layerColor.a) * white.rgb, 1.0);\n\n        gl_FragColor \x3d backbufferColor * tmpComposition;\n      }",
b),e=new Int8Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,-1,1,0]);this._quadVAO=new f.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_uv",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:f.BufferObject.createVertex(a,35044,e)});this._mutiplyProgram=c}};a.prototype._createOrResizeTexture=function(a){var b=a.context;a=a.state.size;if(null===this._backBufferTexture||a[0]!==this._size[0]||a[1]!==this._size[1])this._backBufferTexture?
this._backBufferTexture.resize(a[0],a[1]):this._backBufferTexture=new f.Texture(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:a[0],height:a[1]})};return a}();c.BlendEffectMultiply=a})},"esri/views/2d/engine/webgl/effects/blendEffects/BlendEffectNormal":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../webgl ../../shaders/BitBlitPrograms".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,
"__esModule",{value:!0});var m=g.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffectNormal");a=function(){function a(){}a.prototype.dispose=function(b){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.draw=function(b,a,c,e){if(b=b.context)this._setupShader(b),b.setBlendFunctionSeparate(1,771,1,771),b.bindVAO(this._vertexArrayObject),b.bindProgram(this._program),a.setSamplingMode(c),
b.bindTexture(a,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",e),b.drawArrays(5,0,4),b.bindVAO()};a.prototype._setupShader=function(a){if(!this._program){var d=e.createProgram(a,b.bitBlit);if(d){var c=new Int8Array(16);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=1;c[5]=-1;c[6]=1;c[7]=0;c[8]=-1;c[9]=1;c[10]=0;c[11]=1;c[12]=1;c[13]=1;c[14]=1;c[15]=1;a=new e.VertexArrayObject(a,b.bitBlit.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},
{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:e.BufferObject.createVertex(a,35044,c)});this._program=d;this._vertexArrayObject=a}else m.error(new f("mapview-normalBlendEffect","Error creating shader program"))}};return a}();c.BlendEffectNormal=a})},"esri/views/2d/engine/webgl/effects/postProcessingEffects/PostProcessingEffectUnrealBloom":function(){define(["require","exports","../../../../../webgl"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});
var g=[1,0],e=[0,1],b=[1,.8,.6,.4,.2],m=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];a=function(){function a(){this._gaussianBlurPrograms=Array(5);this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0]}a.prototype.dispose=function(b){this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null);this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null);this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=
null);if(this._mipsFBOs){for(b=0;b<this._nMips;b++)this._mipsFBOs[b]&&(this._mipsFBOs[b].horizontal.dispose(),this._mipsFBOs[b].vertical.dispose());this._mipsFBOs=null}this._luminosityHighPassProgram&&(this._luminosityHighPassProgram.dispose(),this._luminosityHighPassProgram=null);if(this._gaussianBlurPrograms){b=0;for(var a=this._gaussianBlurPrograms;b<a.length;b++){var d=a[b];d&&d.dispose()}this._gaussianBlurPrograms=null}this._compositionProgram&&(this._compositionProgram.dispose(),this._compositionProgram=
null);this._blitProgram&&(this._blitProgram.dispose(),this._blitProgram=null)};a.prototype.draw=function(a,c,f){var d=a.context,k=a.state.size,l=d.gl,q=f&&f.stength||1.5,r=f&&f.radius||0;f=f&&f.threshold||0;this._setupShaders(d);this._createOrResizeResources(a);d.setBlendingEnabled(!0);d.setBlendFunction(1,771);d.setStencilWriteMask(0);d.bindVAO(this._quadVAO);d.bindFramebuffer(this._intensityFBO);a=this._luminosityHighPassProgram;d.bindProgram(a);d.bindTexture(c.colorTexture,0);a.setUniform1i("u_texture",
0);a.setUniform3fv("u_defaultColor",[0,0,0]);a.setUniform1f("u_defaultOpacity",0);a.setUniform1f("u_luminosityThreshold",f);a.setUniform1f("u_smoothWidth",.01);d.setViewport(0,0,Math.round(k[0]/2),Math.round(k[1]/2));d.setClearColor(0,0,0,0);d.clear(l.COLOR_BUFFER_BIT);d.drawArrays(l.TRIANGLE_STRIP,0,4);d.setBlendingEnabled(!1);a=[Math.round(k[0]/2),Math.round(k[1]/2)];f=this._intensityFBO.colorTexture;for(var w=0;w<this._nMips;w++){var n=this._gaussianBlurPrograms[w];d.bindProgram(n);d.bindTexture(f,
w+1);n.setUniform1i("u_colorTexture",w+1);n.setUniform2fv("u_texSize",a);n.setUniform2fv("u_direction",g);d.setViewport(0,0,a[0],a[1]);var u=this._mipsFBOs[w];d.bindFramebuffer(u.horizontal);d.setClearColor(0,0,0,0);d.clear(l.COLOR_BUFFER_BIT);d.drawArrays(l.TRIANGLE_STRIP,0,4);f=u.horizontal.colorTexture;d.bindFramebuffer(u.vertical);d.bindTexture(f,w+1);n.setUniform2fv("u_direction",e);d.setClearColor(0,0,0,0);d.clear(l.COLOR_BUFFER_BIT);d.drawArrays(l.TRIANGLE_STRIP,0,4);f=u.vertical.colorTexture;
a[0]=Math.round(a[0]/2);a[1]=Math.round(a[1]/2)}d.setViewport(0,0,k[0],k[1]);k=this._compositionProgram;d.bindFramebuffer(this._compositeFBO);d.bindProgram(k);k.setUniform1f("u_bloomStrength",q);k.setUniform1f("u_bloomRadius",r);k.setUniform1fv("u_bloomFactors",b);k.setUniform3fv("u_bloomTintColors",m);d.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);k.setUniform1i("u_blurTexture1",1);d.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);k.setUniform1i("u_blurTexture2",2);d.bindTexture(this._mipsFBOs[2].vertical.colorTexture,
3);k.setUniform1i("u_blurTexture3",3);d.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);k.setUniform1i("u_blurTexture4",4);d.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);k.setUniform1i("u_blurTexture5",5);d.setClearColor(0,0,0,0);d.clear(l.COLOR_BUFFER_BIT);d.drawArrays(l.TRIANGLE_STRIP,0,4);d.bindFramebuffer(c);d.setStencilWriteMask(0);d.setStencilTestEnabled(!1);d.setDepthWriteEnabled(!1);d.setDepthTestEnabled(!1);d.setBlendingEnabled(!0);c=this._blitProgram;d.bindProgram(c);d.bindTexture(this._compositeFBO.colorTexture,
6);c.setUniform1i("u_texture",6);d.setBlendFunction(1,1);d.drawArrays(l.TRIANGLE_STRIP,0,4);d.setBlendFunction(1,771);d.bindVAO(null)};a.prototype._setupShaders=function(b){if(!this._luminosityHighPassProgram){var a={a_pos:0,a_uv:1},d=new f.Program(b,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n      precision mediump float;\n\n      uniform sampler2D u_texture;\n      uniform vec3 u_defaultColor;\n      uniform float u_defaultOpacity;\n      uniform float u_luminosityThreshold;\n      uniform float u_smoothWidth;\n\n      varying vec2 v_uv;\n\n      void main() {\n        vec4 texel \x3d texture2D(u_texture, v_uv);\n        vec3 luma \x3d vec3(0.299, 0.587, 0.114);\n        float v \x3d dot(texel.xyz, luma);\n        vec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\n        float alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\n\n        gl_FragColor \x3d mix(outputColor, texel, alpha);\n      }\n    ",
a),c=new f.Program(b,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n      precision mediump float;\n\n      #define NUM_MIPS 5\n\n      varying vec2 v_uv;\n      uniform sampler2D u_blurTexture1;\n      uniform sampler2D u_blurTexture2;\n      uniform sampler2D u_blurTexture3;\n      uniform sampler2D u_blurTexture4;\n      uniform sampler2D u_blurTexture5;\n      uniform float u_bloomStrength;\n      uniform float u_bloomRadius;\n      uniform float u_bloomFactors[NUM_MIPS];\n      uniform vec3 u_bloomTintColors[NUM_MIPS];\n\n      float lerpBloomFactor(const in float factor) {\n        float mirrorFactor \x3d 1.2 - factor;\n        return mix(factor, mirrorFactor, u_bloomRadius);\n      }\n\n      void main() {\n        gl_FragColor \x3d u_bloomStrength * (\n          lerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\n          lerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\n          lerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\n          lerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\n          lerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n        );\n      }",
a),e=new f.Program(b,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n      precision mediump float;\n\n      uniform sampler2D u_texture;\n\n      varying vec2 v_uv;\n      void main() {\n        gl_FragColor \x3d texture2D(u_texture, v_uv);\n      }",a);this._setupGaussianBlurShaders(b);var g=new Int8Array([-1,1,0,1,1,
1,1,1,-1,-1,0,0,1,-1,1,0]);this._quadVAO=new f.VertexArrayObject(b,a,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_uv",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:f.BufferObject.createVertex(b,35044,g)});this._blitProgram=e;this._compositionProgram=c;this._luminosityHighPassProgram=d}};a.prototype._setupGaussianBlurShaders=function(b){for(var a={a_pos:0,a_uv:1},d=0;d<this._nMips;d++){var c=this._kernelSizeArray[d];this._gaussianBlurPrograms[d]=
new f.Program(b,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n    precision mediump float;\n\n    uniform sampler2D u_colorTexture;\n    uniform vec2 u_texSize;\n    uniform vec2 u_direction;\n\n    varying vec2 v_uv;\n\n    float gaussianPdf(in float x, in float sigma) {\n        return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n    }\n\n    #define KERNEL_RADIUS "+
c+"\n    #define SIGMA "+c+"\n\n    void main() {\n      vec2 invSize \x3d 1.0 / u_texSize;\n      float fSigma \x3d float(SIGMA);\n      float weightSum \x3d gaussianPdf(0.0, fSigma);\n      vec3 pixelColorSum \x3d texture2D(u_colorTexture, v_uv).rgb * weightSum;\n\n      for (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\n        float x \x3d float(i);\n        float w \x3d gaussianPdf(x, fSigma);\n        vec2 uvOffset \x3d u_direction * invSize * x;\n        vec3 sample1 \x3d texture2D( u_colorTexture, v_uv + uvOffset).rgb;\n        vec3 sample2 \x3d texture2D( u_colorTexture, v_uv - uvOffset).rgb;\n        pixelColorSum +\x3d (sample1 + sample2) * w;\n        weightSum +\x3d 2.0 * w;\n      }\n\n      gl_FragColor \x3d vec4(pixelColorSum /weightSum, 0.0);\n    }",
a)}};a.prototype._createOrResizeResources=function(b){var a=b.context,d=b.state.size;if(!this._compositeFBO||this._size[0]!==d[0]||this._size[1]!==d[1])for(this._size[0]=d[0],this._size[1]=d[1],b=[d[0]/2,d[1]/2],this._compositeFBO?this._compositeFBO.resize(d[0],d[1]):this._compositeFBO=new f.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0,width:d[0],height:d[1]}),this._intensityFBO?this._intensityFBO.resize(b[0],b[1]):this._intensityFBO=new f.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0,
width:b[0],height:b[1]}),d=0;d<this._nMips;d++)this._mipsFBOs[d]?(this._mipsFBOs[d].horizontal.resize(b[0],b[1]),this._mipsFBOs[d].vertical.resize(b[0],b[1])):this._mipsFBOs[d]={horizontal:new f.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0,width:b[0],height:b[1]}),vertical:new f.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0,width:b[0],height:b[1]})},b[0]/=2,b[1]/=2};return a}();c.PostProcessingEffectUnrealBloom=a})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define("require exports @dojo/framework/shim/iterator ../../../../../core/has ../../../../../core/maybe ../enums".split(" "),
function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,d){this.brushes=a;this.name=d.name;this.drawPhase=d.drawPhase||b.WGLDrawPhase.MAP;this._targetFn=d.target;this.effects=d.effects||[];this.has=d.has}a.prototype.render=function(b){var a=b.context,c=b.profiler,e=this._targetFn(),f=this.drawPhase&b.drawPhase;c.recordPassStart(this.name);if(f&&(!this.has||g(this.has))){this._doRender(b,e);c.recordPassEnd();for(var f=0,k=this.effects;f<k.length;f++){var p=
k[f];if(p.enable()){var m=p.apply;c.recordPassStart(this.name+"."+m.name);c.recordBrushStart(m.name);var p=p.args&&p.args(),r=a.getViewport(),w=r.x,n=r.y,u=r.width,r=r.height,h=a.getBoundFramebufferObject();m.bind(b,p);this._doRender(b,e,m.defines);m.draw(b,p);m.unbind(b,p);a.bindFramebuffer(h);a.setViewport(w,n,u,r);c.recordBrushEnd();c.recordPassEnd()}}}};a.prototype._doRender=function(b,a,c){if(!e.isNone(a))if(f.isArrayLike(a))for(var d=0;d<a.length;d++){var g=a[d];if(g.isReady&&g.visible)for(var k=
0,l=this.brushes;k<l.length;k++){var m=l[k];b.profiler.recordBrushStart(m.name);m.prepareState(b,g,c);m.draw(b,g,c);b.profiler.recordBrushEnd()}}else for(d=0,g=this.brushes;d<g.length;d++)m=g[d],b.profiler.recordBrushStart(m.name),m.prepareState(b,a,c),m.draw(b,a,c),b.profiler.recordBrushEnd()};return a}();c.default=a})},"esri/views/2d/engine/webgl/Profiler":function(){define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=e("esri-2d-profiler");a=function(){function a(b,a){var d=this;this._events=new g;this._entries=new Map;this._timings=new f.default(10);if(k){this._ext=m.load(b.gl,{});this._debugOutput=a;var c=b.gl;if(this.enableCommandLogging){b=function(b){if("function"===typeof c[b]){var a=c[b],e=-1!==b.indexOf("draw");c[b]=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];d._events.emit("command",{container:d._currentContainer,
pass:d._currentPass,brush:d._currentBrush,method:b,args:f,isDrawCommand:e});d._currentSummary&&(d._currentSummary.commands++,e&&d._currentSummary.drawCommands++);return a.apply(c,f)}}};for(var e in c)b(e)}}}Object.defineProperty(a.prototype,"enableCommandLogging",{get:function(){return!("object"===typeof k&&k.disableCommands)},enumerable:!0,configurable:!0});a.prototype.recordContainerStart=function(b){k&&(this._currentContainer=b)};a.prototype.recordContainerEnd=function(){k&&(this._currentContainer=
null)};a.prototype.recordPassStart=function(b){k&&(this._currentPass=b,this._initSummary())};a.prototype.recordPassEnd=function(){k&&(this._currentPass=null,this._emitSummary())};a.prototype.recordBrushStart=function(b){k&&(this._currentBrush=b)};a.prototype.recordBrushEnd=function(){k&&(this._currentBrush=null)};a.prototype.recordStart=function(a){if(k&&b.isSome(this._ext)){if(this._entries.has(a)){var d=this._entries.get(a),c=this._ext.resultAvailable(d.query),e=this._ext.disjoint();if(c&&!e){c=
this._ext.getResult(d.query)/1E6;e=0;if(b.isSome(this._timings.enqueue(c))){for(var e=this._timings.entries,f=e.length,g=0,l=0;l<e.length;l++)g+=e[l];e=g/f}c=c.toFixed(2);e=e?e.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+a+", "+c+" ms ("+e+" last 10 avg)\n"+d.commandsLen+" Commands ("+d.drawCommands+" draw)"),console.log("RenderPass breakdown: "),console.table(d.summaries),console.log("Commands: ",d.commands),console.groupEnd()):console.log("Frame report for "+
a+", "+c+" ms ("+e+" last 10 avg)");this._debugOutput.innerHTML=c+" ("+e+")"}c=0;for(d=d.handles;c<d.length;c++)d[c].remove();this._entries.delete(a)}var m={name:a,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(m.handles.push(this._events.on("command",function(b){m.commandsLen++;m.commands.push(b);b.isDrawCommand&&m.drawCommands++})),m.handles.push(this._events.on("summary",function(b){delete b.target;m.summaries.push(b)})));
this._ext.beginTimeElapsed(m.query);this._entries.set(a,m)}};a.prototype.recordEnd=function(a){k&&b.isSome(this._ext)&&this._entries.has(a)&&this._ext.endTimeElapsed()};a.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};a.prototype._emitSummary=function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return a}();c.Profiler=a})},"esri/core/CircularArray":function(){define(["require",
"exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a){void 0===a&&(a=Number.POSITIVE_INFINITY);this._start=this.size=0;this.maxSize=a;this._buffer=isFinite(a)?Array(a):[]}Object.defineProperty(a.prototype,"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0});a.prototype.enqueue=function(a){if(this.size===this.maxSize){var c=this._buffer[this._start];this._buffer[this._start]=a;this._start=(this._start+1)%this.maxSize;return c}isFinite(this.maxSize)?
this._buffer[(this._start+this.size++)%this.maxSize]=a:this._buffer[this._start+this.size++]=a;return null};a.prototype.dequeue=function(){if(0===this.size)return null;var a=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return a};return a}();c.default=a})},"esri/views/2d/engine/webgl/WebGLDriverTest":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(a,
c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});var m=f.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),k=function(){function b(b){this._ignoresSamplerPrecision=null;this._context=b}Object.defineProperty(b.prototype,"ignoresSamplerPrecision",{get:function(){g.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=c.testSamplerPrecision(this._context));return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return b}();c.testWebGLDriver=function(b){return new k(b)};
c.testSamplerPrecision=function(a){var d=new e.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),c=new Uint8Array(4),f=new b(a,[0,0,1,0,0,1,1,1]),g=new e.Program(a,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),k=new e.Texture(a,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));g.setUniform1i("u_texture",0);a.bindTexture(k,0);a.bindFramebuffer(d);a.bindProgram(g);var z=a.getViewport(),k=z.x,r=z.y,w=z.width,z=z.height;a.setViewport(0,0,1,1);f.draw();a.setViewport(k,r,w,z);d.readPixels(0,0,1,1,6408,5121,c);g.dispose();f.dispose();
d.dispose();(a=255!==c[0]||255!==c[1]||255!==c[2]||255!==c[3])&&m.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+c[0]+"."+c[1]+"."+c[2]+"."+c[3]+"]");return a}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});c.stencil={name:"stencil",shaders:{vertexShader:f.resolveIncludes("stencil/stencil.vert"),fragmentShader:f.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug ../../../webgl/FramebufferObject".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p){Object.defineProperty(c,"__esModule",{value:!0});var z=m.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),r=x.createDebugLogger(x.DEBUG_ATTR_UPDATES,z),w=function(){function a(b,a,d){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;var c=b.buffer,e=b.pixelType;b=b.textureOnly;var f=v.getPixelArrayCtor(e);this.shared=d;this.pixelType=e;this.size=a;this.textureOnly=b;b||(this.data=new f(k.expect(c)));this._resetRange()}a.prototype.destroy=
function(){k.andThen(this._texture,function(b){return b.dispose()});var b=function(b){k.andThen(a._fbos[b],function(a){"0"===b&&a.detachColorTexture();a.dispose()});a._fbos[b]=null},a=this,d;for(d in this._fbos)b(d);this._texture=null};Object.defineProperty(a.prototype,"_textureDesc",{get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}},enumerable:!0,configurable:!0});a.prototype.setData=function(b,a,d){b&=2147483647;
var c=k.expect(this.data);a=b*this.texelSize+a;!c||a>=c.length||(c[a]=d,this.dirtyStart=Math.min(this.dirtyStart,b),this.dirtyEnd=Math.max(this.dirtyEnd,b))};a.prototype.getData=function(b,a){if(k.isNone(this.data))return null;b=(b&2147483647)*this.texelSize+a;return!this.data||b>=this.data.length?null:this.data[b]};a.prototype.getTexture=function(b){var a=this;return k.unwrapOr(this._texture,function(){return a._initTexture(b)})};a.prototype.getFBO=function(b,a){void 0===a&&(a=0);if(k.isNone(this._fbos[a])){var d=
0===a?this.getTexture(b):this._textureDesc;this._fbos[a]=new p(b,{colorTarget:0,depthStencilTarget:0},d)}return this._fbos[a]};Object.defineProperty(a.prototype,"locked",{get:function(){return 5121===this.pixelType&&this.shared&&!this.textureOnly&&b("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1},enumerable:!0,configurable:!0});a.prototype.updateTexture=function(b){if(!this.locked)try{var a=this.dirtyStart,d=this.dirtyEnd;if(!(a>d)){this._resetRange();var c=k.expect(this.data).buffer,
f=this.getTexture(b),g=(a-a%this.size)/this.size,l=(d-d%this.size)/this.size,n=g*this.size*4,u=4*(this.size+l*this.size)-n,m=v.getPixelArrayCtor(this.pixelType),p=m.BYTES_PER_ELEMENT;try{new m(c,n*p,u)}catch(F){console.debug(F)}var r=new m(c,n*p,u),q=this.size;b=l-g+1;b>this.size?z.error(new e("mapview-webgl","Out-of-bounds index when updating AttributeData")):f.updateData(0,0,g,q,b,r)}}catch(F){console.debug(F)}};a.prototype.update=function(b){var a=b.data,d=b.start,c=b.end;if(k.isSome(a))for(var e=
this.data,f=d*this.texelSize,g=0;g<a.length;g++)b.layout&1<<g%this.texelSize&&(e[f+g]=a[g]);this.dirtyStart=Math.min(this.dirtyStart,d);this.dirtyEnd=Math.max(this.dirtyEnd,c)};a.prototype.resize=function(b,a){var d=this.size;this.size=a;this.textureOnly?d!==this.size&&(this._lastTexture=this._texture,this._texture=null):(a=v.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new a(k.expect(b.buffer)))};a.prototype._resetRange=function(){this.dirtyStart=2147483647;this.dirtyEnd=0};a.prototype._initTexture=
function(b){var a=new l.Texture(b,this._textureDesc,k.unwrapOr(this.data,void 0));if(k.isSome(this._lastTexture)&&this._fbos[0]){var d=this._lastTexture.descriptor.width,c=this._lastTexture.descriptor.height,e=this._lastTexture.descriptor.dataType,f=this._lastTexture.descriptor.pixelFormat,g=this.getFBO(b),n=v.getPixelBytes(e),m=v.getPixelArrayCtor(e),n=new ArrayBuffer(d*c*n*this.texelSize),m=new m(n),n=b.getBoundFramebufferObject(),p=b.getViewport(),u=p.x,r=p.y,q=p.width,p=p.height;b.bindFramebuffer(g);
g.readPixels(0,0,d,c,f,e,m);a.updateData(0,0,0,2*d,c/2,m);b.setViewport(u,r,q,p);b.bindFramebuffer(n)}this.destroy();return this._texture=a};return a}();a=function(){function b(){this._locked=this._forceNextUpload=this._initialized=!1}b.prototype.initialize=function(b){var a=b.blocks,d=b.shared,c=b.size;this.shared=d;this.size=c;r("Initializing AttributeStoreView",b);if(k.isNone(this._data))this._data=k.mapMany(a,function(b){return new w(b,c,d)});else for(b=0;b<this._data.length;b++){var e=this._data[b],
f=a[b];k.isSome(f)&&(k.isNone(e)?this._data[b]=new w(f,c,d):e.resize(f,c))}this._initialized=!0};b.prototype.destroy=function(){k.andThen(this._data,function(b){return k.mapMany(b,function(b){return b.destroy()})});k.andThen(this._defaultTexture,function(b){return b.dispose()})};b.prototype.getBlock=function(b){return k.isNone(this._data)?null:this._data[b]};b.prototype.setLabelMinZoom=function(b,a){this.setData(b,0,1,a)};b.prototype.getLabelMinZoom=function(b){return this.getData(b,0,1,255)};b.prototype.getFilterFlags=
function(b){return this.getData(b,0,0,0)};b.prototype.getVVSize=function(b){return this.getData(b,q.ATTRIBUTE_DATA_VV,0,0)};b.prototype.getData=function(b,a,d,c){if(!this._data)return 0;a=k.expect(this._data)[a];if(k.isNone(a))return 0;b=a.getData(b,d);return k.isSome(b)?b:c};b.prototype.setData=function(b,a,d,c){a=k.expect(this._data)[a];k.expect(a).setData(b,d,c)};b.prototype.lockTextureUpload=function(){this._locked=!0};b.prototype.unlockTextureUpload=function(){this._locked=!1};b.prototype.forceTextureUpload=
function(){this._forceNextUpload=!0};b.prototype.requestUpdate=function(b){return g(this,void 0,void 0,function(){var a;return f(this,function(c){if(this._pendingAttributeUpdate)return z.error(new e("mapview-webgl","Tried to update attribute data with a pending update")),[2];a=d.createResolver();r("AttributeStoreView Update Requested",b);this._pendingAttributeUpdate={data:b,resolver:a};return[2,a.promise]})})};b.prototype.update=function(){if(this._initialized&&k.isSome(this._pendingAttributeUpdate)){for(var b=
this._pendingAttributeUpdate,a=b.data,b=b.resolver,d=k.expect(this._data),c=function(b){var c=a.blocks[b];k.andThen(d[b],function(a){return k.andThen(c,function(d){r("Updating block "+b,d);a.update(d)})})},e=0;e<a.blocks.length;e++)c(e);this._pendingAttributeUpdate=null;b()}};b.prototype.bindTextures=function(b){this.update();var a=this._getDefaultTexture(b);if(this._initialized){var d=k.expect(this._data);if(!this._locked||this._forceNextUpload)k.forEachSome(d,function(a){return a.updateTexture(b)}),
this._forceNextUpload=!1;b.bindTexture(k.mapOr(d[0],a,function(a){return a.getTexture(b)}),q.TEXTURE_BINDING_ATTRIBUTE_DATA_0);b.bindTexture(k.mapOr(d[1],a,function(a){return a.getTexture(b)}),q.TEXTURE_BINDING_ATTRIBUTE_DATA_1);b.bindTexture(k.mapOr(d[2],a,function(a){return a.getTexture(b)}),q.TEXTURE_BINDING_ATTRIBUTE_DATA_2);b.bindTexture(k.mapOr(d[3],a,function(a){return a.getTexture(b)}),q.TEXTURE_BINDING_ATTRIBUTE_DATA_3)}else b.bindTexture(a,q.TEXTURE_BINDING_ATTRIBUTE_DATA_0),b.bindTexture(a,
q.TEXTURE_BINDING_ATTRIBUTE_DATA_1),b.bindTexture(a,q.TEXTURE_BINDING_ATTRIBUTE_DATA_2),b.bindTexture(a,q.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};b.prototype._getDefaultTexture=function(b){k.isNone(this._defaultTexture)&&(this._defaultTexture=new l.Texture(b,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return b}();c.AttributeStoreView=a})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v){function x(b){for(var a={},d=0;d<b.length;d++){var c=b[d];a[c.name]=c.strideInBytes}return a}function p(b){switch(b){case q.WGLGeometryType.MARKER:return y;case q.WGLGeometryType.FILL:return t;case q.WGLGeometryType.LINE:return A;case q.WGLGeometryType.TEXT:return B;case q.WGLGeometryType.LABEL:return C}return null}function z(b){switch(b%4){case 0:case 2:return 4;case 1:case 3:return 1}}function r(b){return"string"===typeof b}function w(b){switch(b){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function n(b){var a={},d=function(d){var c=0;a[d]=b[d].map(function(b){var a=f({},b,{normalized:b.normalized||!1,divisor:b.divisor||0,offset:c,stride:0});c+=b.count*w(b.type);return a});a[d].forEach(function(b){return b.stride=c})},c;for(c in b)d(c);return a}Object.defineProperty(c,"__esModule",{value:!0});var u,h=e.getLogger("esri.views.2d.engine.webgl.Utils");c.C_VBO_GEOMETRY="geometry";c.C_VBO_PERINSTANCE="per_instance";c.C_VBO_PERINSTANCE_VV=
"per_instance_vv";c.C_ICON_VERTEX_DEF=[{name:c.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];c.C_FILL_VERTEX_DEF=[{name:c.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];c.C_FILL_VERTEX_DEF_DD=[{name:c.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];c.C_LINE_VERTEX_DEF=[{name:c.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];c.C_TEXT_VERTEX_DEF=[{name:c.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];c.C_LABEL_VERTEX_DEF=[{name:c.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];c.C_ICON_STRIDE_SPEC=x(c.C_ICON_VERTEX_DEF);
c.C_FILL_STRIDE_SPEC=x(c.C_FILL_VERTEX_DEF);c.C_FILL_STRIDE_SPEC_DD=x(c.C_FILL_VERTEX_DEF_DD);c.C_LINE_STRIDE_SPEC=x(c.C_LINE_VERTEX_DEF);c.C_TEXT_STRIDE_SPEC=x(c.C_TEXT_VERTEX_DEF);c.C_LABEL_STRIDE_SPEC=x(c.C_LABEL_VERTEX_DEF);c.getStrides=function(b,a){switch(b){case q.WGLGeometryType.MARKER:return c.C_ICON_STRIDE_SPEC;case q.WGLGeometryType.FILL:return a?c.C_FILL_STRIDE_SPEC_DD:c.C_FILL_STRIDE_SPEC;case q.WGLGeometryType.LINE:return c.C_LINE_STRIDE_SPEC;case q.WGLGeometryType.TEXT:return c.C_TEXT_STRIDE_SPEC;
case q.WGLGeometryType.LABEL:return c.C_LABEL_STRIDE_SPEC}return null};var y=[c.C_VBO_GEOMETRY],t=[c.C_VBO_GEOMETRY],A=[c.C_VBO_GEOMETRY],B=[c.C_VBO_GEOMETRY],C=[c.C_VBO_GEOMETRY];c.getNamedBuffers=p;c.strideToPackingFactor=z;c.allocateTypedArrayBuffer=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(Math.floor(b*a/4));case 1:case 3:return new Uint8Array(b*a)}};c.allocateTypedArrayBufferwithData=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(b);case 1:case 3:return new Uint8Array(b)}};
c.getTextProperties=function(b){return v.TextProperties.pool.acquire(b.color?l.copyAndPremultiply(b.color):[255,255,255,255],b.haloColor?l.copyAndPremultiply(b.haloColor):[255,255,255,255],m.pt2px(b.haloSize),m.pt2px(b.font.size),b.angle*Math.PI/180,b.xoffset/b.font.size,b.yoffset/b.font.size,"left"===b.horizontalAlignment?0:"right"===b.horizontalAlignment?1:.5,"top"===b.verticalAlignment?0:"bottom"===b.verticalAlignment?1:.5)};c.isDefined=function(b){return null!=b};c.isNumber=function(b){return"number"===
typeof b};c.isString=r;c.isStringOrNull=function(b){return null==b||r(b)};c.getCapType=function(b,a){switch(b){case "butt":return k.CapType.BUTT;case "round":return a?k.CapType.SQUARE:k.CapType.ROUND;case "square":return k.CapType.SQUARE;default:return h.error(new g("mapview-invalid-type","Cap type "+b+" is not a valid option. Defaulting to round")),k.CapType.ROUND}};c.getJoinType=function(b){switch(b){case "miter":return k.JoinType.MITER;case "bevel":return k.JoinType.BEVEL;case "round":return k.JoinType.ROUND;
default:return h.error(new g("mapview-invalid-type","Join type "+b+" is not a valid option. Defaulting to round")),k.JoinType.ROUND}};c.getVVType=function(b){switch(b){case "opacity":return q.VVType.OPACITY;case "color":return q.VVType.COLOR;case "rotation":return q.VVType.ROTATION;case "size":return q.VVType.SIZE;default:return h.error("Cannot interpret unknown vv: "+b),null}};c.getTransformParams=function(b){return{transform:b.transform,hasZ:b.hasZ,hasM:b.hasM}};c.copyMeshData=function(b,a,d,c,
e,f,h){for(var g in f)for(var k=f[g].stride,l=z(k),t=f[g].data,n=d[g].data,m=k*e.vertexCount/l,p=k*b/l,l=k*e.vertexFrom/l,k=0;k<m;++k)n[k+p]=t[k+l];d=e.indexCount;for(k=0;k<d;++k)c[k+a]=h[k+e.indexFrom]-e.vertexFrom+b};c.C_VBO_INFO=(u={},u[c.C_VBO_GEOMETRY]=35044,u);c.createGeometryData=function(b,a){for(var d=[],c=0;5>c;++c){for(var e={},f=0,h=p(c);f<h.length;f++){var g=h[f];e[g]={data:a(c,g)}}d.push({data:b(c),buffers:e})}return d};c.createTextureFromTexelData=function(a,c){var e,f;b.isPowerOfTwo(c.width)&&
b.isPowerOfTwo(c.height)?(e=!0,f=9987):(e=!1,f=9729);return new d.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:e,samplingMode:f,wrapMode:33071,flipped:!0},c)};c.geometryToMappedGeometry=function(b){return{vertexFrom:void 0,vertexTo:void 0,geometry:b}};c.getBytes=w;c.getPixelBytes=function(b){switch(b){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:h.error(new g("webgl-utils","Unable to handle type "+b))}};c.getPixelArrayCtor=function(b){switch(b){case 5121:return Uint8Array;
case 32819:return Uint16Array;case 5126:return Float32Array;default:h.error(new g("webgl-utils","Unable to handle type "+b))}};var D=new Map;c.createProgramDescriptor=function(b,a){if(!D.has(b)){var d=n(a),c={},e;for(e in d){var f=d[e];c[e]=f.length?f[0].stride:0}e={};for(var h in a)for(var f=0,g=a[h];f<g.length;f++){var k=g[f];e[k.name]=k.location}D.set(b,{strides:c,bufferLayouts:d,attributes:e})}return D.get(b)}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],
function(a,c,f){function g(b,a){Array.isArray(a)?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=a.r,b[1]=a.g,b[2]=a.b,b[3]=a.a);return b}function e(b,a,d){void 0===a&&(a=0);void 0===d&&(d=!1);var c=b[a+3];b[a+0]*=c;b[a+1]*=c;b[a+2]*=c;d||(b[a+3]*=255);return b}Object.defineProperty(c,"__esModule",{value:!0});c.white=[255,255,255,1];var b=[0,0,0,0];c.premultiplyAlpha=e;c.copyAndPremultiply=function(b){return e(g([],b))};c.premultiplyAlphaUint32=function(a){e(g(b,a));return f.i8888to32(b[0],b[1],b[2],
b[3])};c.premultiplyAlphaRGBA=function(b){if(!b)return 0;var a=b.a;return f.i8888to32(b.r*a,b.g*a,b.b*a,255*a)}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,b,c,f,d,
g,q,v,x){this.color=a;this.haloColor=b;this.haloSize=c;this.size=f;this.angle=d;this.offsetX=g;this.offsetY=q;this.hAnchor=v;this.vAnchor=x};a.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new f(a);return a}();c.TextProperties=a})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require",
"exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.createDebugLogger=function(a,c){return a&&function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c.warn.apply(c,["DEBUG:"].concat(a))}||function(){return null}};c.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a){this._bucketSize=
a;this._rowsLength=f.TILE_SIZE/a;this._colsLength=f.TILE_SIZE/a;this._grid=this._initGrid()}a.prototype.checkOverlap=function(a,b){a=Math.floor(a/this._bucketSize);b=Math.floor(b/this._bucketSize);return 0>a||a>=this._rowsLength||0>b||b>=this._colsLength?!0:this._grid[b][a]};a.prototype.markUsed=function(a,b){this._grid[Math.floor(b/this._bucketSize)][Math.floor(a/this._bucketSize)]=!0};a.prototype.reset=function(){this._grid=this._initGrid()};a.prototype._initGrid=function(){for(var a=[],b=0;b<this._rowsLength;b++)a.push(Array(this._colsLength));
return a};return a}();c.CollisionGrid=a})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/MapUtils ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo".split(" "),function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});var l=m.TILE_SIZE/m.COLLISION_BUCKET_SIZE,q=g.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");
a=function(){function a(b){this._layers=new Map;this._collisionBuckets=new Map;this._didError=!1;this._tilingScheme=b}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){return e.valuesOfMap(this._layers)},enumerable:!0,configurable:!0});a.prototype.registerLayerView=function(b,a){if(!this._layers.has(b)){var c=d.default.create(b,a,this.collisionInfos,this._tilingScheme);this._layers.set(b,c);this._collisionBuckets.forEach(function(b){return b.onRegisterLayer(c.index)})}};a.prototype.unregisterLayerView=
function(b){var a=this;if(this._layers.has(b)){var c=this._layers.get(b);d.default.delete(c.index,this.collisionInfos);this._layers.delete(b);this._collisionBuckets.forEach(function(b,d){var e=b.getTile(c.index);e&&(b.onUnregisterLayer(c.index),b.canDelete()&&a._collisionBuckets.delete(d),e.reference&&(e.reference.isDirty=!1))})}};a.prototype.addTile=function(b,a){var d=a.key.id;this._layers.has(b)&&(this._collisionBuckets.has(d)||this._collisionBuckets.set(d,new k.default(a.key,this._layers.size)),
b=this._getIndex(b),this._collisionBuckets.get(d).getTile(b).reference=a)};a.prototype.removeTile=function(b,a){this._layers.has(b)&&this._collisionBuckets.has(a)&&(b=this._getIndex(b),a=this._collisionBuckets.get(a).getTile(b),a.dirty=!1,a.reference=null)};a.prototype.run=function(b,a){var c=e.valuesOfMap(this._collisionBuckets).sort(function(b,a){return b.key.compareRowMajor(a.key)}),g=!0,k=b.renderingOptions.labelCollisionsEnabled&&!this._didError,l=this.collisionInfos;try{for(var p=0;p<c.length;p++)for(var h=
c[p],g=g||h.isDirty,m=0;m<this._layers.size;m++){var t=d.default.find(m,l);h.computeNeighbors(this._collisionBuckets);h.reset(b,g,t)}for(b=0;b<this._layers.size;b++)for(t=d.default.find(b,l),g=0,p=c;g<p.length;g++)h=p[g],this._run(k,h,t,a)}catch(A){q.error(new f("mapview-labeling","Encountered an error during decluttering. Disabling collisions",A)),this._didError=!0}for(a=0;a<c.length;a++)h=c[a],h.ready()};a.prototype._run=function(b,a,d,c){var e=a.getReference(d.index);e&&e.hasData&&(e.key.level!==
c?this._resetLabelsMinZoom(a,d):this._runVisibility(b,a,e,d,c))};a.prototype._resetLabelsMinZoom=function(b,a){if(b&&"polyline"!==a.geometryType&&(b=b.getReference(a.index))&&b.hasData){a=a.layerView.tileRenderer.featuresView.attributeView;var d=0;for(b=b.displayObjects;d<b.length;d++)a.setLabelMinZoom(b[d].id,255)}};a.prototype._checkLabelsVisible=function(b,a){var d=!a.effect||a.effect.excludedLabelsVisible||!!(b&m.EFFECT_FLAG_0);return(!a.filter||!!(b&m.FILTER_FLAG_0))&&d};a.prototype._runVisibility=
function(b,a,d,c,e){var f=c.layerView.tileRenderer.featuresView.attributeView,g=0;for(d=d.displayObjects.sort(function(b,a){b=f.getLabelMinZoom(b.id);a=f.getLabelMinZoom(a.id);return b-a});g<d.length;g++){var h=d[g];if(h.metrics.length){var k="polyline"===c.geometryType?0:10*(e-1),l=f.getFilterFlags(h.id),m=this._checkLabelsVisible(l,c.layerView);if(b)for(var p=0;p<h.metrics.length;p++)l=h.metrics[p],l=m?-1!==l.minZoom?l.minZoom:this._computeLabelVisibility(h,l,c.index,a,l.baseZoom,e):255,k=Math.max(l,
k);f.setLabelMinZoom(h.id,k);m=0;for(h=h.metrics;m<h.length;m++)l=h[m],l.minZoom=k}}};a.prototype._computeLabelVisibility=function(b,a,d,c,e,f){for(var g=a.xBucket,h=a.yBucket,k=a.xOverflow,t=a.yOverflow,n=g-k,g=g+k+1,k=h+t+1,h=h-t;h<k;h++)for(t=n;t<g;t++)if(!(t<-l||h<-l||t>l||h>l))for(var m=0;m<=d;m++){var p=this._getRelativeSubBucket(m,c,t,h);if(p)for(var r=0;r<p.length;r++){var q=p[r];q.id!==b.id&&(q=this._compareLabels(a,q,e,f),e=Math.max(q,e))}}return e};a.prototype._compareLabels=function(a,
d,c,e){if(-1===d.minZoom||d.minZoom>10*(e+1))return c;a=a.findCollisionDelta(d);e=b.clamp(Math.floor(10*(a+e)),0,255);return d.minZoom>=e?c:Math.max(c,e)};a.prototype._getNeighboringTile=function(b,a,d,c){return(a=a.neighbors[3*(1+c)+(1+d)])&&a.getTile(b)};a.prototype._getRelativeSubBucket=function(a,d,c,e){var f=b.sign(Math.floor(c/4)),g=b.sign(Math.floor(e/4));return(a=this._getNeighboringTile(a,d,f,g))&&a.reference&&a.index&&a.reference.hasData?a.index[e-4*g][c-4*f]:null};a.prototype._getIndex=
function(b){return this._layers.get(b).index};return a}();c.CollisionEngine=a})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(b,a){this.neighbors=Array(9);this._tiles=Array(a);for(var c=0;c<a;c++)this._tiles[c]=new g.default;this.key=b}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var b=0,a=this._tiles;b<
a.length;b++)if(a[b].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});a.prototype.getTile=function(b){return this._tiles[b]};a.prototype.getReference=function(b){return(b=this._tiles[b])&&b.reference};a.prototype.onRegisterLayer=function(b){this.invalidateRange(b);this._add(b)};a.prototype.onUnregisterLayer=function(b){this.invalidateRange(b);this._remove(b)};a.prototype.onLabelsRendered=
function(){};a.prototype.invalidateRange=function(b){for(;b<this._tiles.length;b++)this._tiles[b].dirty=!0};a.prototype.add=function(b){this._add(b)};a.prototype.remove=function(b){this._remove(b)};a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var b=0,a=this._tiles;b<a.length;b++)a[b].dirty=!1};a.prototype.computeNeighbors=function(b){this.neighbors[0]=this._getNeighbor(b,-1,-1);this.neighbors[1]=this._getNeighbor(b,0,-1);this.neighbors[2]=this._getNeighbor(b,
1,-1);this.neighbors[3]=this._getNeighbor(b,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(b,1,0);this.neighbors[6]=this._getNeighbor(b,-1,1);this.neighbors[7]=this._getNeighbor(b,0,1);this.neighbors[8]=this._getNeighbor(b,1,1)};a.prototype.reset=function(b,a,c){for(var d=0,e=this._tiles;d<e.length;d++){var f=e[d];f&&f.reset(b,a,c)}};a.prototype._add=function(b){var a=[];if(b>=this._tiles.length)this._tiles.push(new g.default);else{for(var c=0;c<this._tiles.length;c++)c===b&&a.push(new g.default),
a.push(this._tiles[c]);this._tiles=a}};a.prototype._remove=function(b){for(var a=[],c=0;c<this._tiles.length;c++)c!==b&&a.push(this._tiles[c]);this._tiles=a};a.prototype._getNeighbor=function(b,a,c){var d=this.key;a=f.TileKey.getId(d.level,d.row+c,d.col+a,d.world);return b.has(a)?b.get(a):null};return a}();c.default=a})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(a,c,f){Object.defineProperty(c,
"__esModule",{value:!0});a=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(a){this.reference&&this.reference.hasData&&(a||this.reference.isDirty)&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"reference",
{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,b,c){a=a.state;var e=c.layerView.tileRenderer,d=this.reference;if(!d||!d.hasData)return!1;b&&(d.isDirty=!0);b=d.transforms.labelMat2d;for(var g=b[4],m=b[5],v=0,x=d.displayObjects;v<x.length;v++)for(var p=x[v],z=e.featuresView.attributeView,z=c.hasVV()?z.getVVSize(p.id):0,r=0,p=p.metrics;r<p.length;r++){var w=p[r];c.hasVV()&&w.computeOffset(z,c.vvEval);var n=w.bounds.center,
u=w.bounds.centerT;d.isDirty&&(w.minZoom=-1);var h=f.vec2.copy(u,w.anchor);a.rotation?f.vec2.transformMat2d(h,h,b):(u[0]=h[0]+g,u[1]=h[1]+m);f.vec2.add(u,h,n);u[0]+=w.offsetX;u[1]+=w.offsetY;if(w.boxes)for(n=0,u=w.boxes;n<u.length;n++){var h=u[n],y=h.centerT;f.vec2.add(y,w.anchor,h.center);a.rotation?f.vec2.transformMat2d(y,y,b):(y[0]+=g,y[1]+=m)}}return!0};return a}();c.default=a})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),
function(a,c,f,g,e,b){function m(a){return function(d){return e.pt2px(b.getSizeForValueSimple(d,a))}}function k(b){if(!b)return null;for(var a=0;a<b.length;a++){var d=b[a];if("size"===d.type)return m(d)}return null}Object.defineProperty(c,"__esModule",{value:!0});var d=function(b,a){return b.order-a.order},l=function(b,a){return b.index-a.index},q=f.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");c.createLabelVVEvaluator=k;a=function(){function b(b,a,d,c){var e=this;this._vvHandle=
null;var f=b.layer,l=f.geometryType,h=f.labelingInfo,m=f.renderer;this.vvEval=k("visualVariables"in m&&m.visualVariables);this._vvHandle=f.watch("visualVariables",function(b){e.vvEval=k(b)});f=h.map(function(b){var a=!!b.maxScale,d=!!b.minScale&&c.scaleToZoom(b.minScale)||0;b=a&&c.scaleToZoom(b.maxScale)||255;return{minZoom:g.clamp(Math.floor(10*d),0,255),maxZoom:g.clamp(Math.floor(10*b),0,255)}});this.layerView=b;this.geometryType=l;this.index=a;this.order=d;this.zoomRanges=f;this.layerView=b}b.prototype.hasVV=
function(){return!!this.vvEval};b.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};b.prototype.destroy=function(){this._vvHandle.remove()};b.create=function(a,c,e,f){e=e.sort(d);for(var g=!1,k=-1,l=0;l<e.length;l++){var h=e[l];!g&&h.order>c&&(k=h.index,g=!0);g&&h.index++}g||(k=e.length);return new b(a,k,c,f)};b.delete=function(b,a){for(var d=a.sort(l),c=b+1;c<d.length;c++)a[c].index--;a[b].destroy();a.splice(b,1)};b.find=function(b,a){for(var d=0;d<a.length;d++){var c=a[d];
if(c.index===b)return c}q.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return b}();c.default=a})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../renderers/support/utils"],function(a,c,f,g){function e(a,c){switch(c.transformationType){case "additive":var d=b(c.minSize,a);return a+(d||c.minDataValue);case "constant":return d=(d=c.stops)&&d.length&&d[0].size,
null==d&&(d=c.minSize),b(d,a);case "clamped-linear":var d=(a-c.minDataValue)/(c.maxDataValue-c.minDataValue),e=b(c.minSize,a),l=b(c.maxSize,a);a=a<=c.minDataValue?e:a>=c.maxDataValue?l:e+d*(l-e);return a;case "proportional":return d=a/c.minDataValue,e=b(c.minSize,a),a=b(c.maxSize,a),f.clamp(d*e,e,a);case "stops":return e=m(a,c.cache.ipData),l=e[0],d=e[1],e=e[2],l===d?a=b(c.stops[l].size,a):(l=b(c.stops[l].size,a),a=b(c.stops[d].size,a),a=l+(a-l)*e),a;case "real-world-size":d=g.meterIn[c.valueUnit];
e=b(c.minSize,a);l=b(c.maxSize,a);c=c.valueRepresentation;var p=null,p="area"===c?2*Math.sqrt(a/k)/d:"radius"===c||"distance"===c?2*a/d:a/d;return f.clamp(p,e,l);case "identity":return a;case "unknown":return null}}function b(b,a){return"number"===typeof b?b:e(a,b)}function m(b,a){if(a){var d=0,c=a.length-1;a.some(function(a,e){if(b<a)return c=e,!0;d=e;return!1});return[d,c,(b-a[d])/(a[c]-a[d])]}}Object.defineProperty(c,"__esModule",{value:!0});var k=Math.PI;c.getSizeForValueSimple=e})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require",
"exports","../../../../../core/Error","../../../../../core/Logger"],function(a,c,f,g){function e(b){return"esri.views.2d.layers.FeatureLayerView2D"===b.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===b.declaredClass}Object.defineProperty(c,"__esModule",{value:!0});var b=g.getLogger("esri.views.2d.engine.collisions.LayerViewSorter");a=function(){function a(b,a){this.registerLayer=b;this.unregisterLayer=a;this._layerViewState=new Map}a.prototype.findIndex=function(b){return b.view.allLayerViews.findIndex(function(a){return a.uid===
b.uid})};a.prototype.update=function(a){for(var d=a.added,c=0,g=a.removed;c<g.length;c++)a=g[c],e(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(c=0;c<d.length;c++){a=d[c];if(g=e(a))a:if(a.layer&&a.layer.renderer)switch(a.layer.renderer.type){case "class-breaks":case "simple":case "unique-value":case "dictionary":g=!0;break a;default:b.error(new f("mapview-labeling","Renderer of type "+a.layer.renderer.type+" does not currently support labeling")),g=!1}else g=!1;g&&!this._layerViewState.has(a)&&
this._createState(a)}this._recomputeOrder()};a.prototype.destroy=function(){this._layerViewState.forEach(function(b){return b.handle.remove()})};a.prototype._createState=function(b){var a={priority:-1,handle:null};a.handle=b.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(b,a);return a};a.prototype._deleteState=function(b){if(this._layerViewState.has(b)){var a=this._layerViewState.get(b);a.handle.remove();-1!==a.priority&&this.unregisterLayer(b);this._layerViewState.delete(b)}};
a.prototype._recomputeOrder=function(){var b=this;this._layerViewState.forEach(function(a,c){var d=c.view.map.allLayers.findIndex(function(b){return b.uid===c.layer.uid}),e=c.layer,d=e.visible&&e.labelsVisible&&e.labelingInfo?4294967295-d:-1;d!==a.priority&&(a.priority=d,b.unregisterLayer(c),-1!==d&&b.registerLayer(c,d))})};return a}();c.LayerViewSorter=a})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});
a=function(){function a(a,c){this.x=a;this.y=c}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,c){return a===this.x&&c===this.y};a.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};a.prototype.setCoords=function(a,c){this.x=a;this.y=c};a.prototype.normalize=function(){var a=this.x,c=this.y,a=Math.sqrt(a*a+c*c);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,c){this.x+=
a;this.y+=c};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,c){this.x=a.x+c.x;this.y=a.y+c.y};a.prototype.assignSub=function(a,c){this.x=a.x-c.x;this.y=a.y-c.y};a.prototype.rotate=function(a,c){var b=this.x,e=this.y;this.x=b*a-e*c;this.y=b*c+e*a};a.prototype.scale=function(a){this.x*=a;this.y*=a};a.prototype.length=function(){var a=this.x,c=this.y;return Math.sqrt(a*a+c*c)};a.distance=function(a,c){var b=c.x-a.x;a=c.y-a.y;return Math.sqrt(b*b+a*a)};a.add=function(c,
e){return new a(c.x+e.x,c.y+e.y)};a.sub=function(c,e){return new a(c.x-e.x,c.y-e.y)};return a}();c.Point=a})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.getXAnchorDirection=function(a){switch(a){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}};c.getYAnchorDirection=function(a){switch(a){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}};
c.getJustification=function(a){switch(a){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../definitions ../VertexStream ./WGLBrush".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});var m={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],
samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}};a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._desc={path:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}};return a}f(a,b);a.prototype.dispose=function(){this._quad&&this._quad.dispose()};a.prototype.prepareState=function(b,a){b=b.context;b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(1,771,1,771);b.setColorMask(!0,!0,!0,!0);b.setStencilWriteMask(0);b.setStencilTestEnabled(!0);b.setStencilFunction(514,
a.stencilRef,255)};a.prototype.draw=function(b,a){var d=b.context,c=b.renderingOptions,f=b.painter;if(a.source){b.timeline.begin(this.name);this._quad||(this._quad=new e(d,[0,0,1,0,0,1,1,1]));if("dynamic"===c.samplingMode)var c=b.state,k=a.resolution/a.pixelRatio/c.resolution,l=Math.round(b.pixelRatio)!==b.pixelRatio,c=c.rotation||1.05<k||.95>k||l||a.isSourceScaled||a.rotation?m.bilinear:m.nearest;else c=m[c.samplingMode];f=f.materialManager.getProgram(b,this._desc,c.defines);a.setSamplingProfile(c);
a.bind(g.TEXTURE_BINDING_BITMAP);d.bindProgram(f);f.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);f.setUniform1i("u_texture",g.TEXTURE_BINDING_BITMAP);f.setUniform2fv("u_coordScale",a.coordScale);this._quad.draw();b.timeline.end(this.name)}};return a}(b.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/programUtils".split(" "),
function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._color=g.vec4f32.fromValues(0,1,0,1);return a}f(a,b);a.prototype.dispose=function(){this._program&&this._program.dispose()};a.prototype.prepareState=function(b){b=b.context;b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);b.setFaceCullingEnabled(!1);b.setColorMask(!1,!1,!1,!1);b.setStencilOp(7680,7680,7681);b.setStencilWriteMask(255);b.setStencilFunction(519,
0,255)};a.prototype.draw=function(b,a){var d=b.context;b=b.state;this._program||(this._program=k.createProgram(d,m.background));var c=this._program,f=e.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]});a=a.getVAO(d,b,f.attributes,f.bufferLayouts);d.bindProgram(this._program);c.setUniform2fv("u_coord_range",[1,1]);c.setUniform4fv("u_color",this._color);c.setUniformMatrix3fv("u_dvsMat3",b.displayMat3);d.bindVAO(a);d.drawElements(4,a.indexBuffer.size,5125,0);d.bindVAO()};
return a}(b.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/BrushRasterBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../VertexStream ../WGLRasterUtils ./WGLBrush".split(" "),function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b._desc={lut:{path:"raster/lut",attributes:{a_position:0,a_texcoord:1}},stretch:{path:"raster/stretch",
attributes:{a_position:0,a_texcoord:1}},hillshade:{path:"raster/hillshade",attributes:{a_position:0,a_texcoord:1}}};return b}f(d,a);d.prototype.dispose=function(){this._quad&&this._quad.dispose()};d.prototype.prepareState=function(b,a){b=b.context;b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(1,771,1,771);b.setColorMask(!0,!0,!0,!0);b.setStencilWriteMask(0);b.setStencilTestEnabled(!0);b.setStencilFunction(514,a.stencilRef,255)};d.prototype.draw=function(a,d){var c=a.context,f=a.painter;if(d.source&&
!d.suspended){a.timeline.begin(this.name);this._quad||(this._quad=new e(c,[0,0,1,0,0,1,1,1]));f=f.materialManager.getProgram(a,this._desc[d.symbolizerParameters.type]);c.bindProgram(f);var k=b.getUniformInfos(c,f),l=d.getTextures();b.setTextures(c,f,l.names,l.textures);l=d.getUniforms();d=g({u_opacity:d.opacity,u_coordScale:d.coordScale},l);d.u_flipY=!1;b.setUniforms(c,f,k,d);this._quad.draw();a.timeline.end(this.name)}};return d}(m.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../vectorTiles/shaders/Programs ../definitions ../enums ../number ./WGLBrush".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._color=e.vec4f32.fromValues(1,0,0,1);b._patternMatrix=g.mat3f32.create();b._programOptions={id:!1,pattern:!1};return b}f(c,a);c.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};c.prototype.drawMany=function(b,a){var c=b.context,e=b.styleLayerId;this._loadWGLResources(c);
var f=b.displayLevel,g=b.styleLayer,h=b.painter.getVectorTileProgramCach(),m=g.getPaintValue("background-color",f),t=g.getPaintValue("background-opacity",f),p=g.getPaintValue("background-pattern",f),q=void 0!==p,z=m[3]*t,x=b.spriteMosaic,v,E=(window.devicePixelRatio|1)>k.VTL_HIGH_RES_CUTOFF?2:1;b=b.drawPhase===d.WGLDrawPhase.HITTEST;var I=this._programOptions;I.id=b;I.pattern=q;h=h.getProgram(0,(b?1:0)<<1|(q?1:0),I);c.bindVAO(this._vao);c.bindProgram(h);if(q){v=x.getMosaicItemPosition(p,!0);if(!v)return;
h.setUniform1f("u_opacity",t);h.setUniform2f("u_pattern_tl",v.tl[0],v.tl[1]);h.setUniform2f("u_pattern_br",v.br[0],v.br[1]);h.setUniform1i("u_texture",k.VTL_TEXTURE_BINDING_UNIT_SPRITES);x.bind(c,9729,v.page,k.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=z*m[0],this._color[1]=z*m[1],this._color[2]=z*m[2],this._color[3]=z,h.setUniform4fv("u_color",this._color);h.setUniform1f("u_depth",g.z||0);b&&(e=l.u32to4Xu8(e),h.setUniform4f("u_id",e[0],e[1],e[2],e[3]));for(e=0;e<a.length;e++)g=a[e],h.setUniform1f("u_coord_range",
g.coordRange[0]),h.setUniformMatrix3fv("u_dvsMat3",g.transforms.dvs),q&&(m=E*g.size[0]*Math.max(Math.pow(2,Math.round(f)-g.key.level),1),t=m/v.size[1],this._patternMatrix[0]=m/v.size[0],this._patternMatrix[4]=t,h.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),c.setStencilFunction(514,g.stencilRef,255),c.drawArrays(5,0,4)};c.prototype._loadWGLResources=function(a){if(!this._program||!this._vao){var d=b.createProgram(a,m.background);if(d){var c=new Int8Array([0,0,1,0,0,1,1,1]),c=b.BufferObject.createVertex(a,
35044,c);a=new b.VertexArrayObject(a,m.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:c});this._program=d;this._vao=a}}};return c}(q.default);c.WGLBrushVTLBackground=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../enums ../number ./WGLBrush".split(" "),function(a,c,f,g,e,
b,m,k){Object.defineProperty(c,"__esModule",{value:!0});var d=[1,1,1,1];a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._color=g.vec4f32.create();b._strokeColor=g.vec4f32.create();b._programOptions={id:!1};b._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},
{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return b}f(c,a);c.prototype.dispose=function(){};c.prototype.drawMany=function(a,c){var e=a.context,f=a.state,g=a.drawPhase,k=a.styleLayerId,l=a.displayLevel,u=a.styleLayer;a=a.painter.getVectorTileProgramCach();var h=u.hasDataDrivenRadius?1:u.getPaintValue("circle-radius",l),q=u.hasDataDrivenColor?d:u.getPaintValue("circle-color",l),t=u.hasDataDrivenOpacity?1:u.getPaintValue("circle-opacity",l),x=u.hasDataDrivenStrokeWidth?
1:u.getPaintValue("circle-stroke-width",l),v=u.hasDataDrivenStrokeColor?d:u.getPaintValue("circle-stroke-color",l),C=u.hasDataDrivenStrokeOpacity?1:u.getPaintValue("circle-stroke-opacity",l),D=u.hasDataDrivenBlur?0:u.getPaintValue("circle-blur",l),t=t*q[3];this._color[0]=t*q[0];this._color[1]=t*q[1];this._color[2]=t*q[2];this._color[3]=t;t=C*v[3];this._strokeColor[0]=t*v[0];this._strokeColor[1]=t*v[1];this._strokeColor[2]=t*v[2];this._strokeColor[3]=t;q=u.getPaintValue("circle-translate",l);l=u.getPaintValue("circle-translate-anchor",
l);v=g===b.WGLDrawPhase.HITTEST;g=this._programOptions;g.id=v;g=a.getProgram(5,v?1:0,g);e.bindProgram(g);g.setUniformMatrix3fv("u_displayMat3",1===l?f.displayMat3:f.displayViewMat3);g.setUniform2fv("u_circleTranslation",q);g.setUniform1f("u_depth",u.z);g.setUniform1f("u_radius",h);g.setUniform4fv("u_color",this._color);g.setUniform1f("u_blur",D);g.setUniform1f("u_stroke_width",x);g.setUniform4fv("u_stroke_color",this._strokeColor);g.setUniform1f("u_antialiasingWidth",1.2);v&&(f=m.u32to4Xu8(k),g.setUniform4f("u_id",
f[0],f[1],f[2],f[3]));for(f=0;f<c.length;f++)if(u=c[f],u.layerData[k]&&(h=u.layerData[k],x=this._getCircleVAO(e,u,a)))e.bindVAO(x),g.setUniformMatrix3fv("u_dvsMat3",u.transforms.dvs),e.setStencilFunction(514,u.stencilRef,255),e.drawElements(4,h.triangleElementCount,5125,12*h.triangleElementStart),u.triangleCount+=h.triangleElementCount/3};c.prototype._getCircleVAO=function(b,a,d){if(a.circleVertexArrayObject)return a.circleVertexArrayObject;var c=a.circleVertexBuffer,f=a.circleIndexBuffer;if(!c||
!f)return null;a.circleVertexArrayObject=new e.VertexArrayObject(b,d.getProgramAttributes(5),this._vertexAttributes,{geometry:c},f);return a.circleVertexArrayObject};return c}(k.default);c.WGLBrushVTLCircle=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),
function(a,c,f,g,e,b,m,k,d,l){Object.defineProperty(c,"__esModule",{value:!0});var q=1/65536,v=[1,1,1,1];a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};b._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};b._outlineVertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};b._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,
divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};b._color=e.vec4f32.create();b._outlineColor=e.vec4f32.create();b._fillProgramOptions={id:!1,dd:!1,pattern:!1};b._outlineProgramOptions={id:!1,dd:!1};b._patternMatrix=g.mat3f32.create();return b}f(c,a);c.prototype.dispose=function(){};c.prototype.drawMany=function(b,a){var c=b.displayLevel,e=b.drawPhase,f=b.renderPass,h=b.styleLayerId,g=b.styleLayer,l=g.getPaintValue("fill-pattern",c),m=g.hasDataDrivenColor?
v:g.getPaintValue("fill-color",c),p=g.hasDataDrivenOpacity?1:g.getPaintValue("fill-opacity",c),r=p*m[3],q=void 0!==l||1>r||g.hasDataDrivenFill;if(!q||"opaque"!==f){this._color[0]=r*m[0];this._color[1]=r*m[1];this._color[2]=r*m[2];this._color[3]=r;var x;e===k.WGLDrawPhase.HITTEST&&(x=d.u32to4Xu8(h));e=g.getPaintValue("fill-translate",c);c=g.getPaintValue("fill-translate-anchor",c);this._drawFill(b,h,g,a,e,c,l,q,x);this._drawOutline(b,h,g,a,e,c,l,x,p)}};c.prototype._drawFill=function(b,a,d,c,e,f,g,
l,p){var h=b.context,t=b.displayLevel,n=b.drawPhase,u=b.renderPass,r=b.spriteMosaic,w=b.state;if(l||"translucent"!==u){l=void 0!==g;var u=b.pixelRatio>m.VTL_HIGH_RES_CUTOFF?2:1,y=d.hasDataDrivenFill;b=b.painter.getVectorTileProgramCach();var x,z=n===k.WGLDrawPhase.HITTEST,n=this._fillProgramOptions;n.id=z;n.dd=y;n.pattern=l;n=b.getProgram(1,(z?1:0)<<2|(y?1:0)<<1|(l?1:0),n);h.bindProgram(n);if(l){x=r.getMosaicItemPosition(g,!0);if(!x){h.bindProgram();return}n.setUniform2f("u_pattern_tl",x.tl[0],x.tl[1]);
n.setUniform2f("u_pattern_br",x.br[0],x.br[1]);n.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES);r.bind(h,9729,x.page,m.VTL_TEXTURE_BINDING_UNIT_SPRITES)}n.setUniformMatrix3fv("u_displayMat3",1===f?w.displayMat3:w.displayViewMat3);n.setUniform2fv("u_fillTranslation",e);n.setUniform1f("u_depth",d.z+q);n.setUniform4fv("u_color",this._color);z&&n.setUniform4f("u_id",p[0],p[1],p[2],p[3]);for(d=0;d<c.length;d++)if(e=c[d],e.layerData[a]&&(g=this._getFillVAO(h,e,y,b)))f=e.layerData[a],h.bindVAO(g),
n.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),l&&(g=e.coordRange[0]/(u*e.size[0]*Math.max(Math.pow(2,Math.round(t)-e.key.level),1)),p=1/(x.size[1]*g),this._patternMatrix[0]=1/(x.size[0]*g),this._patternMatrix[4]=p,n.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),h.setStencilFunction(514,e.stencilRef,255),h.drawElements(4,f.triangleElementCount,5125,12*f.triangleElementStart),e.triangleCount+=f.triangleElementCount/3}};c.prototype._drawOutline=function(b,a,d,c,e,f,g,l,m){var h=
b.context,t=b.displayLevel,n=b.drawPhase,p=b.pixelRatio,u=b.state;if("opaque"!==b.renderPass&&(g=void 0!==g,d.getPaintValue("fill-antialias",t)&&!g||d.hasDataDrivenOutlineColor)){b=b.painter.getVectorTileProgramCach();g=d.hasDataDrivenOutline;if(d.outlineUsesFillColor){if(1!==this._color[3])return;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else t=d.hasDataDrivenOutlineColor?v:d.getPaintValue("fill-outline-color",
t),m*=t[3],this._outlineColor[0]=m*t[0],this._outlineColor[1]=m*t[1],this._outlineColor[2]=m*t[2],this._outlineColor[3]=m;p=.75/p;m=n===k.WGLDrawPhase.HITTEST;n=this._outlineProgramOptions;n.id=m;n.dd=g;n=b.getProgram(2,(m?1:0)<<1|(g?1:0),n);h.bindProgram(n);n.setUniformMatrix3fv("u_displayMat3",1===f?u.displayMat3:u.displayViewMat3);n.setUniform2fv("u_fillTranslation",e);n.setUniform1f("u_depth",d.z+q);n.setUniform1f("u_outline_width",p);n.setUniform4fv("u_color",this._outlineColor);m&&n.setUniform4f("u_id",
l[0],l[1],l[2],l[3]);for(d=0;d<c.length;d++)if(e=c[d],e.layerData[a]){f=e.layerData[a];l=this._getOutlineVAO(h,e,g,b);if(!l)break;h.bindVAO(l);n.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs);h.setStencilFunction(514,e.stencilRef,255);h.drawElements(4,f.outlineElementCount,5125,12*f.outlineElementStart);e.triangleCount+=f.outlineElementCount/3}}};c.prototype._getFillVAO=function(a,d,c,e){if(c){if(d.fillDDVertexArrayObject)return d.fillDDVertexArrayObject;c=d.fillDDVertexBuffer;var f=d.fillIndexBuffer;
if(!c||!f)return null;d.fillDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:c},f);return d.fillDDVertexArrayObject}if(d.fillVertexArrayObject)return d.fillVertexArrayObject;c=d.fillVertexBuffer;f=d.fillIndexBuffer;if(!c||!f)return null;d.fillVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(1),this._fillVertexAttributes,{geometry:c},f);return d.fillVertexArrayObject};c.prototype._getOutlineVAO=function(a,d,c,e){if(c){if(d.outlineDDVertexArrayObject)return d.outlineDDVertexArrayObject;
c=d.outlineDDVertexBuffer;var f=d.outlineIndexBuffer;if(!c||!f)return null;d.outlineDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:c},f);return d.outlineDDVertexArrayObject}if(d.outlineVertexArrayObject)return d.outlineVertexArrayObject;c=d.outlineVertexBuffer;f=d.outlineIndexBuffer;if(!c||!f)return null;d.outlineVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:c},f);return d.outlineVertexArrayObject};
return c}(l.default);c.WGLBrushVTLFill=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),function(a,c,f,g,e,b,m,k,d,l){Object.defineProperty(c,"__esModule",{value:!0});c.C_DEG_TO_RAD=Math.PI/180;var q=[1,1,1,1];a=function(a){function c(){var b=null!==
a&&a.apply(this,arguments)||this;b._color=e.vec4f32.create();b._dashArray=g.vec2f32.create();b._programOptions={id:!1,dd:!1,pattern:!1};b._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};b._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,
normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return b}f(c,a);c.prototype.dispose=function(){};c.prototype.drawMany=function(b,a){var c=b.context,e=b.displayLevel,f=b.state,g=b.drawPhase,
h=b.styleLayerId,l=b.styleLayer,t=b.painter.getVectorTileProgramCach(),p=l.getPaintValue("line-translate",e),x=l.getPaintValue("line-translate-anchor",e),C=l.getPaintValue("line-pattern",e),v=void 0!==C,z=1/b.pixelRatio,E=l.getPaintValue("line-blur",e),I=l.hasDataDrivenColor?q:l.getPaintValue("line-color",e),G=l.hasDataDrivenOpacity?1:l.getPaintValue("line-opacity",e),N=l.hasDataDrivenWidth?1:l.getPaintValue("line-width",e),G=G*I[3];this._color[0]=G*I[0];this._color[1]=G*I[1];this._color[2]=G*I[2];
this._color[3]=G;var I=l.hasDataDrivenLine,G=g===k.WGLDrawPhase.HITTEST,F;G&&(F=d.u32to4Xu8(h));g=this._programOptions;g.id=G;g.dd=I;g.pattern=v;g=t.getProgram(3,(G?1:0)<<2|(I?1:0)<<1|(v?1:0),g);c.bindProgram(g);g.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3);g.setUniformMatrix3fv("u_displayMat3",1===x?f.displayMat3:f.displayViewMat3);g.setUniform2fv("u_lineTranslation",p);g.setUniform1f("u_depth",l.z);g.setUniform1f("u_blur",E);g.setUniform1f("u_antialiasing",z);g.setUniform4fv("u_color",
this._color);g.setUniform1f("u_width",N);G&&g.setUniform4f("u_id",F[0],F[1],F[2],F[3]);if(v){if(b=b.spriteMosaic,C=b.getMosaicItemPosition(C,!0))b.bind(c,9729,C.page,m.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.setUniform2f("u_pattern_tl",C.tl[0],C.br[1]),g.setUniform2f("u_pattern_br",C.br[0],C.tl[1]),g.setUniform2f("u_spriteSize",8*C.size[0],C.size[1]),g.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else C=l.getPaintValue("line-dasharray",e),2>C.length&&(C=[1,-1]),this._dashArray[0]=8*C[0],
this._dashArray[1]=8*C[1],g.setUniform2fv("u_dasharray",this._dashArray);for(C=0;C<a.length;C++)if(b=a[C],b.layerData[h]&&(e=b.layerData[h],f=this._getLineVAO(c,b,I,t)))c.bindVAO(f),g.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),c.setStencilFunction(514,b.stencilRef,255),c.drawElements(4,e.triangleElementCount,5125,12*e.triangleElementStart),b.triangleCount+=e.triangleElementCount/3};c.prototype._getLineVAO=function(a,d,c,e){if(c){if(d.lineDDVertexArrayObject)return d.lineDDVertexArrayObject;
c=d.lineDDVertexBuffer;var f=d.lineIndexBuffer;if(!c||!f)return null;d.lineDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(3),this._vertexAttributesDD,{geometry:c},f);return d.lineDDVertexArrayObject}if(d.lineVertexArrayObject)return d.lineVertexArrayObject;c=d.lineVertexBuffer;f=d.lineIndexBuffer;if(!c||!f)return null;d.lineVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(3),this._vertexAttributes,{geometry:c},f);return d.lineVertexArrayObject};return c}(l.default);
c.WGLBrushVTLLine=a})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../GeometryUtils ../number ./WGLBrush".split(" "),function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});var v=1/65536,x=[1,1,1,1];a=function(a){function c(){var b=null!==a&&a.apply(this,
arguments)||this;b._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};b._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",
count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};b._iconProgramOptions={id:!1,dd:!1,sdf:!1};b._sdfProgramOptions={id:!1,dd:!1};b._spritesTextureSize=g.vec2f32.create();b._haloColor=
e.vec4f32.create();b._sdfColor=e.vec4f32.create();b._color=e.vec4f32.create();return b}f(c,a);c.prototype.dispose=function(){};c.prototype.drawMany=function(b,a){var d=b.drawPhase,c=b.styleLayerId,e=b.styleLayer,f=b.fadeRecorder.getFadeValues(),g;d===k.WGLDrawPhase.HITTEST&&(g=l.u32to4Xu8(c));this._drawIcons(b,e,a,f,g);this._drawText(b,e,a,f,g)};c.prototype._drawIcons=function(b,a,c,e,f){for(var h=this,g=b.context,l=b.displayLevel,n=b.drawPhase,p=b.painter,u=b.state,q=b.styleLayerId,r,w=!1,v=0;v<
c.length;v++){var z=c[v];if(z.layerData[q]&&(r=z.layerData[q],0<r.iconPerPageElementsMap.size)){w=!0;break}}if(w){var z=a.hasDataDrivenIconSize?1:a.getLayoutValue("icon-size",l),F=a.hasDataDrivenIconColor?x:a.getPaintValue("icon-color",l),H=a.hasDataDrivenIconOpacity?1:a.getPaintValue("icon-opacity",l),w=a.getPaintValue("icon-translate",l),v=a.getPaintValue("icon-translate-anchor",l),M=p.getVectorTileProgramCach(),p=F[3]*H;this._color[0]=p*F[0];this._color[1]=p*F[1];this._color[2]=p*F[2];this._color[3]=
p;p=a.getLayoutValue("icon-rotation-alignment",l);2===p&&(p=1===a.getLayoutValue("symbol-placement",l)?0:1);var F=r.isSDF,L=a.hasDataDrivenIcon,n=n===k.WGLDrawPhase.HITTEST,H=this._iconProgramOptions;H.id=n;H.dd=L;H.sdf=F;var J=M.getProgram(4,(n?1:0)<<2|(L?1:0)<<1|(F?1:0),H);g.bindProgram(J);F&&(F=a.getPaintValue("icon-halo-color",l),H=a.getPaintValue("icon-halo-width",l),J.setUniform4f("u_outlineColor",F[0],F[1],F[2],F[3]),J.setUniform1f("u_outlineSize",H));J.setUniformMatrix3fv("u_displayViewMat3",
0===p?u.displayViewMat3:u.displayMat3);J.setUniformMatrix3fv("u_displayMat3",1===v?u.displayMat3:u.displayViewMat3);J.setUniform2fv("u_iconTranslation",w);J.setUniform1f("u_depth",a.z);J.setUniform1f("u_mapRotation",d.degToByte(u.rotation));J.setUniform1f("u_keepUpright",0);J.setUniform1f("u_level",10*l);J.setUniform1f("u_fadeSpeed",10*e.fadeSpeed);J.setUniform1f("u_minfadeLevel",10*e.minfadeLevel);J.setUniform1f("u_maxfadeLevel",10*e.maxfadeLevel);J.setUniform1f("u_fadeChange",10*(l+e.fadeChange));
J.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES);J.setUniform1f("u_size",z);J.setUniform4fv("u_color",this._color);n&&J.setUniform4fv("u_id",f);a=function(a){if(!a.layerData[q])return"continue";r=a.layerData[q];if(0===r.iconPerPageElementsMap.size)return"continue";var d=O._getIconVAO(g,a,L,M);if(!d)return"continue";g.bindVAO(d);J.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);r.iconPerPageElementsMap.forEach(function(d,c){h._renderIconRange(b,J,d,c,a)})};var O=this;for(e=0;e<c.length;e++)z=
c[e],a(z)}};c.prototype._renderIconRange=function(b,a,d,c,e){var f=b.context,h=b.hasClipping,g=b.requiredLevel;b=b.spriteMosaic;this._spritesTextureSize[0]=b.getWidth(c)/4;this._spritesTextureSize[1]=b.getHeight(c)/4;a.setUniform2fv("u_mosaicSize",this._spritesTextureSize);b.bind(f,9729,c,m.VTL_TEXTURE_BINDING_UNIT_SPRITES);a=!0;g!==e.key.level||h?f.setStencilFunction(514,e.stencilRef,255):a=!1;f.setStencilTestEnabled(a);f.drawElements(4,d[1],5125,12*d[0]);e.triangleCount+=d[1]/3};c.prototype._drawText=
function(b,a,c,e,f){for(var h=this,l=b.context,n=b.displayLevel,p=b.drawPhase,u=b.glyphMosaic,q=b.hasClipping,r=b.painter,w=b.pixelRatio,z=b.requiredLevel,G=b.state,N=b.styleLayerId,F,H=!1,M=0;M<c.length;M++)if(b=c[M],b.layerData[N]&&(F=b.layerData[N],0<F.glyphPerPageElementsMap.size)){H=!0;break}if(H){b=a.getLayoutValue("text-rotation-alignment",n);2===b&&(b=1===a.getLayoutValue("symbol-placement",n)?0:1);var H=0===b,H=a.getLayoutValue("text-keep-upright",n)&&H,p=p===k.WGLDrawPhase.HITTEST,w=.8*
3/w,M=a.hasDataDrivenTextSize?1:a.getLayoutValue("text-size",n),L=a.hasDataDrivenTextColor?x:a.getPaintValue("text-color",n),J=a.hasDataDrivenTextOpacity?1:a.getPaintValue("text-opacity",n),O=a.getPaintValue("text-halo-color",n),Q=a.getPaintValue("text-halo-width",n),R=3*a.getPaintValue("text-halo-blur",n),U=3*Q,T=r.getVectorTileProgramCach(),r=L[3]*J;this._sdfColor[0]=r*L[0];this._sdfColor[1]=r*L[1];this._sdfColor[2]=r*L[2];this._sdfColor[3]=r;r=O[3]*J;this._haloColor[0]=r*O[0];this._haloColor[1]=
r*O[1];this._haloColor[2]=r*O[2];this._haloColor[3]=r;this._glyphTextureSize||(this._glyphTextureSize=g.vec2f32.fromValues(u.width/4,u.height/4));var r=a.getPaintValue("text-translate",n),L=a.getPaintValue("text-translate-anchor",n),S=a.hasDataDrivenText,J=this._sdfProgramOptions;J.id=p;J.dd=S;var P=T.getProgram(6,(p?1:0)<<1|(S?1:0),J);l.bindProgram(P);P.setUniformMatrix3fv("u_displayViewMat3",0===b?G.displayViewMat3:G.displayMat3);P.setUniformMatrix3fv("u_displayMat3",1===L?G.displayMat3:G.displayViewMat3);
P.setUniform2fv("u_textTranslation",r);P.setUniform1f("u_depth",a.z+v);P.setUniform2fv("u_mosaicSize",this._glyphTextureSize);P.setUniform1f("u_mapRotation",d.degToByte(G.rotation));P.setUniform1f("u_keepUpright",H?1:0);P.setUniform1f("u_level",10*n);P.setUniform1f("u_fadeSpeed",10*e.fadeSpeed);P.setUniform1f("u_minfadeLevel",10*e.minfadeLevel);P.setUniform1f("u_maxfadeLevel",10*e.maxfadeLevel);P.setUniform1f("u_fadeChange",10*(n+e.fadeChange));P.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_GLYPHS);
P.setUniform1f("u_size",M);P.setUniform1f("u_antialiasingWidth",w);p&&P.setUniform4f("u_id",f[0],f[1],f[2],f[3]);a=function(b){if(!b.layerData[N])return"continue";F=b.layerData[N];if(0===F.glyphPerPageElementsMap.size)return"continue";var a=V._getSDFVAO(l,b,S,T);if(!a)return"continue";l.bindVAO(a);P.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);a=!0;z!==b.key.level||q?l.setStencilFunction(514,b.stencilRef,255):a=!1;l.setStencilTestEnabled(a);F.glyphPerPageElementsMap.forEach(function(a,d){h._renderGlyphRange(l,
a,d,u,P,O[3],Q,R,U,b)})};var V=this;for(e=0;e<c.length;e++)b=c[e],a(b)}};c.prototype._renderGlyphRange=function(b,a,d,c,e,f,g,k,l,p){c.bind(b,9729,d,m.VTL_TEXTURE_BINDING_UNIT_GLYPHS);0<f&&0<g&&(e.setUniform4fv("u_color",this._haloColor),e.setUniform1f("u_halo",1),e.setUniform1f("u_edgeDistance",l),e.setUniform1f("u_edgeBlur",k),b.drawElements(4,a[1],5125,12*a[0]),p.triangleCount+=a[1]/3);0<this._sdfColor[3]&&(e.setUniform4fv("u_color",this._sdfColor),e.setUniform1f("u_halo",0),e.setUniform1f("u_edgeDistance",
0),e.setUniform1f("u_edgeBlur",0),b.drawElements(4,a[1],5125,12*a[0]),p.triangleCount+=a[1]/3)};c.prototype._getIconVAO=function(a,d,c,e){if(c){if(d.iconDDVertexArrayObject)return d.iconDDVertexArrayObject;c=d.iconDDVertexBuffer;var f=d.iconIndexBuffer;if(!c||!f)return null;d.iconDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(4),this._vertexAttributesDD,{geometry:c},f);return d.iconDDVertexArrayObject}if(d.iconVertexArrayObject)return d.iconVertexArrayObject;c=d.iconVertexBuffer;
f=d.iconIndexBuffer;if(!c||!f)return null;d.iconVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(4),this._vertexAttributes,{geometry:c},f);return d.iconVertexArrayObject};c.prototype._getSDFVAO=function(a,d,c,e){if(c){if(d.textDDVertexArrayObject)return d.textDDVertexArrayObject;c=d.textDDVertexBuffer;var f=d.textIndexBuffer;if(!c||!f)return null;d.textDDVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(6),this._vertexAttributesDD,{geometry:c},f);return d.textDDVertexArrayObject}if(d.textVertexArrayObject)return d.textVertexArrayObject;
c=d.textVertexBuffer;f=d.textIndexBuffer;if(!c||!f)return null;d.textVertexArrayObject=new b.VertexArrayObject(a,e.getProgramAttributes(6),this._vertexAttributes,{geometry:c},f);return d.textVertexArrayObject};return c}(q.default);c.WGLBrushVTLSymbol=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../definitions ./WGLBrush".split(" "),function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",
{value:!0});a=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.prototype.prepareState=function(b,a,c){b=b.context;c=c&&-1!==c.indexOf("id");b.setBlendingEnabled(!c);b.setBlendFunctionSeparate(1,771,1,771);b.setColorMask(!0,!0,!0,!0);b.setStencilWriteMask(0);b.setStencilTestEnabled(!0);b.setStencilFunction(514,a.stencilRef,255)};a.prototype.draw=function(b,a,c){var d=this;if(a.isReady&&a.hasData){a.commitChanges();var e=this.getGeometryType(),f=a.getDisplayList(),g=
a.getGeometry(e);g&&f&&(b.timeline.begin(this.name),f.byType(e,function(e){d.drawGeometry(b,a,e,g,c)}),b.timeline.end(this.name))}};a.prototype._getVAO=function(b,a,c,e){e.vao||(e.vao=new g.VertexArrayObject(b,c,a,e.vertexBufferMap,e.indexBuffer));return e.vao};a.prototype._setSharedUniforms=function(b,a,c){b.setUniform1f("u_pixelRatio",a.pixelRatio);b.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);b.setUniformMatrix3fv("u_displayViewMat3",a.state.displayViewMat3);b.setUniformMatrix4fv("u_insideEffectMat4",
a.rendererInfo.insideEffect);b.setUniformMatrix4fv("u_outsideEffectMat4",a.rendererInfo.outsideEffect);b.setUniform1fv("u_insideOpacities",a.rendererInfo.insideOpacities);b.setUniform1fv("u_outsideOpacities",a.rendererInfo.outsideOpacities);b.setUniform1i("u_attributeTextureSize",a.attributeView.size);b.setUniform1i("u_attributeData0",e.TEXTURE_BINDING_ATTRIBUTE_DATA_0);b.setUniform1i("u_attributeData1",e.TEXTURE_BINDING_ATTRIBUTE_DATA_1);b.setUniform1i("u_attributeData2",e.TEXTURE_BINDING_ATTRIBUTE_DATA_2);
b.setUniform1i("u_attributeData3",e.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};return a}(b.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});
a=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([m.TEXTURE_BINDING_RENDERER_0,m.TEXTURE_BINDING_RENDERER_1]);return b}f(c,a);c.prototype.dispose=function(){this._disposeTextures()};c.prototype.getGeometryType=function(){return k.WGLGeometryType.FILL};c.prototype.drawGeometry=function(b,a,c,e,f){var g=b.context,h=b.painter,k=b.rendererInfo,l=b.requiredLevel,n=c.indexCount,p=c.indexFrom;c=q.FillMaterialKey.load(c.materialKey);
var r=d.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(c.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],c.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),w=r.bufferLayouts,r=r.attributes;
f=h.materialManager.getMaterialProgram(b,c,"materials/fill",r,f);e=this._getVAO(g,w,r,e);g.bindProgram(f);g.bindVAO(e);this._setSharedUniforms(f,b,a);c.textureBinding&&(h.textureManager.bindTextures(g,f,c),h=1/Math.pow(2,l-a.key.level)/b.pixelRatio,f.setUniform1f("u_zoomFactor",h));c.vvColor&&(f.setUniform1fv("u_vvColorValues",k.vvColorValues),f.setUniform4fv("u_vvColors",k.vvColors));c.vvOpacity&&(f.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),f.setUniform1fv("u_vvOpacities",k.vvOpacities));
c.dotDensity&&(c=m.TILE_SIZE/k.ddDotSize,e=c*window.devicePixelRatio*c*window.devicePixelRatio,h=1/Math.pow(2,l-a.key.level),a=1/h*(1/h),b=k.ddDotScale?b.state.scale/k.ddDotScale:1,f.setUniform1f("u_tileZoomFactor",h),f.setUniform1f("u_tileDotsOverArea",e/(m.TILE_SIZE*window.devicePixelRatio*m.TILE_SIZE*window.devicePixelRatio)),f.setUniformMatrix4fv("u_dotColors",k.ddColors),f.setUniform4fv("u_isActive",k.ddActiveDots),f.setUniform4fv("u_dotBackgroundColor",k.ddBackgroundColor),f.setUniform1f("u_dotValue",
Math.max(1,k.ddDotValue*b*a)),this._bindDotDensityTextures(g,f,k,c));g.drawElements(4,n,5125,4*p);g.bindVAO(null)};c.prototype._disposeTextures=function(){if(this._dotTextures){for(var b=0;b<this._dotTextures.length;b++)this._dotTextures[b].dispose();this._dotTextures=null}};c.prototype._bindDotDensityTextures=function(b,a,d,c){d=this._createDotDensityTextures(b,c,d.ddSeed);a.setUniform1iv("u_dotTextures",this._dotSamplers);for(a=0;a<d.length;a++)b.bindTexture(d[a],this._dotSamplers[a])};c.prototype._createDotDensityTextures=
function(b,a,d){if(this._dotTextureSize!==a||this._seed!==d)this._disposeTextures(),this._dotTextureSize=a,this._seed=d;null===this._dotTextures&&(d=new e(d),this._dotTextures=[this._allocDotDensityTexture(b,a,d),this._allocDotDensityTexture(b,a,d)]);return this._dotTextures};c.prototype._allocDotDensityTexture=function(a,d,c){for(var e=new Float32Array(d*d*4),f=0;f<e.length;f++)e[f]=c.getFloat();return new b.Texture(a,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:d,height:d},
e)};return c}(l.default);c.default=a})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(a,c,f,g,e,b,m,k,d,l){Object.defineProperty(c,"__esModule",{value:!0});c.createMaterialKey=function(b,a,d,c){if(m.isSome(a)){a:{if("heatmap"===
a.type)throw Error("Symbol processor does not support heatmap renderer");switch(b){case k.WGLGeometryType.FILL:b=p.from(a);break a;case k.WGLGeometryType.LINE:b=r.from(a,d);break a;case k.WGLGeometryType.MARKER:if("dot-density"===a.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");b=z.from(a);break a;case k.WGLGeometryType.TEXT:if("dot-density"===a.type)throw Error("Dot Density renderer does not support Text GeometryTypes");b=w.from(a);break a;case k.WGLGeometryType.LABEL:if("dot-density"===
a.type)throw Error("Dot Density renderer does not support Label GeometryTypes");b=n.from(a,c);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+b);}}return b}switch(b){case k.WGLGeometryType.FILL:return p.from(null);case k.WGLGeometryType.LINE:return r.from(null,d);case k.WGLGeometryType.MARKER:return z.from(null);case k.WGLGeometryType.TEXT:return w.from(null);case k.WGLGeometryType.LABEL:return n.from(null,c);default:throw Error("Unable to createMaterialKey for unknown geometryType "+
b);}};a=function(){function a(b){this._data=0;this._data=b}a.load=function(b){var a=this.shared;a.data=b;return a};Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(b){this._data=b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.bits(8,11)},set:function(b){this.setBits(b,8,11)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mapAligned",{get:function(){return!!this.bit(20)},set:function(b){this.setBit(20,
b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sdf",{get:function(){return!!this.bit(11)},set:function(b){this.setBit(11,b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pattern",{get:function(){return!!this.bit(12)},set:function(b){this.setBit(12,b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this.bits(0,8)},set:function(b){this.setBits(b,0,8)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"geometryTypeString",{get:function(){switch(this.geometryType){case k.WGLGeometryType.FILL:return"fill";case k.WGLGeometryType.MARKER:return"marker";case k.WGLGeometryType.LINE:return"line";case k.WGLGeometryType.TEXT:return"text";case k.WGLGeometryType.LABEL:return"label";default:throw new b("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});a.prototype.setBit=function(b,a){b=1<<b;this._data=a?this._data|b:this._data&~b};a.prototype.bit=function(b){return(this._data&
1<<b)>>b};a.prototype.setBits=function(b,a,d){for(var c=0;a<d;a++,c++)this.setBit(a,0!==(b&1<<c))};a.prototype.bits=function(b,a){for(var d=0,c=0;b<a;b++,c++)d|=this.bit(b)<<c;return d};a.prototype.hasVV=function(){return!1};a.prototype.setVV=function(b,a){};a.prototype.getVariation=function(){var b={},a;for(a in this)"boolean"===typeof this[a]&&(b[a]=this[a]);return b};a.prototype.getVariationHash=function(){return this._data&~(7&this.textureBinding)};a.shared=new a(0);return a}();c.MaterialKeyBase=
a;g=function(b){return function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);Object.defineProperty(a.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(16)},set:function(b){this.setBit(16,b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(17)},set:function(b){this.setBit(17,b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vvSizeFieldStops",{get:function(){return 0!==
this.bit(18)},set:function(b){this.setBit(18,b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(19)},set:function(b){this.setBit(19,b)},enumerable:!0,configurable:!0});a.prototype.hasVV=function(){return b.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};a.prototype.setVV=function(a,d){b.prototype.setVV.call(this,a,d);a&=l.getSizeFlagsMask(a,d);this.vvSizeMinMaxValue=
!!(a&k.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(a&k.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(a&k.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(a&k.WGLVVFlag.SIZE_SCALE_STOPS)};return a}(b)};var q=function(b){return function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);Object.defineProperty(a.prototype,"vvRotation",{get:function(){return 0!==this.bit(15)},set:function(b){this.setBit(15,b)},enumerable:!0,configurable:!0});a.prototype.hasVV=function(){return b.prototype.hasVV.call(this)||
this.vvRotation};a.prototype.setVV=function(a,d){b.prototype.setVV.call(this,a,d);this.vvRotation=!d&&!!(a&k.WGLVVFlag.ROTATION)};return a}(b)},v=function(b){return function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);Object.defineProperty(a.prototype,"vvColor",{get:function(){return 0!==this.bit(13)},set:function(b){this.setBit(13,b)},enumerable:!0,configurable:!0});a.prototype.hasVV=function(){return b.prototype.hasVV.call(this)||this.vvColor};a.prototype.setVV=function(a,
d){b.prototype.setVV.call(this,a,d);this.vvColor=!d&&!!(a&k.WGLVVFlag.COLOR)};return a}(b)},x=function(b){return function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);Object.defineProperty(a.prototype,"vvOpacity",{get:function(){return 0!==this.bit(14)},set:function(b){this.setBit(14,b)},enumerable:!0,configurable:!0});a.prototype.hasVV=function(){return b.prototype.hasVV.call(this)||this.vvOpacity};a.prototype.setVV=function(a,d){b.prototype.setVV.call(this,a,d);this.vvOpacity=
!d&&!!(a&k.WGLVVFlag.OPACITY)};return a}(b)},p=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.load=function(b){var a=this.shared;a.data=b;return a};a.from=function(b){var a=this.load(0);a.geometryType=k.WGLGeometryType.FILL;m.isSome(b)&&(b instanceof e.DotDensityRenderer?a.dotDensity=!0:(b=l.getVVFlags(b.visualVariables),a.setVV(b,!1)));return a.data};a.prototype.getVariation=function(){return b.prototype.getVariation.call(this)};Object.defineProperty(a.prototype,
"dotDensity",{get:function(){return!!this.bit(15)},set:function(b){this.setBit(15,b)},enumerable:!0,configurable:!0});a.shared=new a(0);return a}(v(x(a)));c.FillMaterialKey=p;var z=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.load=function(b){var a=this.shared;a.data=b;return a};a.from=function(b){var a=this.load(0);a.geometryType=k.WGLGeometryType.MARKER;m.isSome(b)&&(b=l.getVVFlags(b.visualVariables),a.setVV(b,!1));return a.data};a.prototype.getVariation=function(){return b.prototype.getVariation.call(this)};
a.shared=new a(0);return a}(v(x(q(g(a)))));c.MarkerMaterialKey=z;var r=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.load=function(b){var a=this.shared;a.data=b;return a};a.from=function(b,a){var d=this.load(0);d.geometryType=k.WGLGeometryType.LINE;m.isSome(b)&&(b=l.getVVFlags(b.visualVariables),d.setVV(b,a));return d.data};a.prototype.getVariation=function(){return b.prototype.getVariation.call(this)};a.shared=new a(0);return a}(v(x(g(a))));c.LineMaterialKey=r;
var w=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}f(a,b);a.load=function(b){var a=this.shared;a.data=b;return a};a.from=function(b){var a=this.load(0);a.geometryType=k.WGLGeometryType.TEXT;m.isSome(b)&&(b=l.getVVFlags(b.visualVariables),a.setVV(b,!1));return a.data};a.prototype.getVariation=function(){return b.prototype.getVariation.call(this)};a.shared=new a(0);return a}(v(x(q(g(a)))));c.TextMaterialKey=w;var n=function(b){function a(){return null!==b&&b.apply(this,arguments)||
this}f(a,b);a.load=function(b){var a=this.shared;a.data=b;return a};a.from=function(b,a){var c=this.load(0);c.geometryType=k.WGLGeometryType.LABEL;m.isSome(b)&&(b=l.getVVFlags(b.visualVariables),c.setVV(b,!1));c.mapAligned=!!d.isMapAligned(a.labelPlacement);return c.data};a.prototype.getVariation=function(){return b.prototype.getVariation.call(this)};a.shared=new a(0);return a}(g(a));c.LabelMaterialKey=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../vectorTiles/GeometryUtils ../../color ../../definitions ../../enums ../../number ../../TextShaping ../../collisions/Metric ../../materialKey/MaterialKey ./GlyphGroup ./util ./WGLTextTemplate".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u,h,y,t){function A(b){switch(b){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:E("Found invalid placement type "+
b)}}Object.defineProperty(c,"__esModule",{value:!0});var B=e.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),C=q.vec2f32.create(),D=d.mat2df32.create(),K={xOffset:0,yOffset:0,width:0,height:0},E=function(b,a){void 0===a&&(a="mapview-labeling");return B.error(new g(a,b))};c.isMapAligned=function(b){switch(b){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};a=function(a){function d(d,c,e,f){e=a.call(this,d,e.font.size,e.haloSize||0,e.color&&x.premultiplyAlphaRGBA(e.color)||
0,e.haloColor&&x.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id)||this;e._refTemplate=K;e.geometryType=z.WGLGeometryType.LABEL;var g=c.symbol,h;h=!!c.minScale&&f.scaleToZoom(c.minScale)||0;h=b.clamp(h,0,25.5);f=!!c.maxScale&&f.scaleToZoom(c.maxScale)||255;f=b.clamp(f,0,25.5);var k=A(c.labelPlacement),l=k[0],k=k[1];e._justify=(-1*l+1)/2;e._xAlignD=l;e._yAlignD=k;e._xPlacementD=l;e._yPlacementD=k;e._minZoom=h;e._maxZoom=
f;d=u.LabelMaterialKey.load(u.createMaterialKey(e.geometryType,d,!1,c));d.sdf=!0;e._materialKey=d.data;d=g.font.decoration.toLowerCase();"underline"===d?e._decorationTop=6:"line-through"===d&&(e._decorationTop=-5);return e}f(d,a);d.fromLabelClass=function(b,a,c){return new d(b,a,a.symbol,c)};d.prototype.bindTextInfo=function(b,a,d){b=this._computeShaping(b,this._justify).getShaping(a,d);isNaN(this._decorationTop)||w.TextShaping.addDecoration(b,this._decorationTop);this._shapedGlyphs=b;this._shapedBox=
w.TextShaping.getBox(b)};d.prototype._computeShaping=function(b,a){return new w.TextShaping([b],p.TEXT_MAX_WIDTH,p.TEXT_LINE_HEIGHT,p.TEXT_SPACING,[0,0],.5,.5,a)};Object.defineProperty(d.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0});d.prototype.bindReferenceTemplate=function(b){this._refTemplate=b||K};d.prototype._placeGlyphs=function(b,a,d,c){var e=this._size,f=this._haloSize,g=this._shapedBox,h=this._shapedGlyphs,k=this._computeGlyphTransform(g);if("esriGeometryPolyline"!==
b)for(var l=0;l<d.length;l++)for(var t=d[l],n=0,p=h;n<p.length;n++){var q=p[n];t.place(q,b,a,k,this._materialKey,e,f,g,c,this._minZoom,this._maxZoom)}else for(l=0;l<d.length;l++)for(var t=d[l],n=q=t.order,p=n-(n-1)/2-1,u=p-(p-1)/2-1,r=u-(u-1)/2-1,q=-1===q?0:n%2?p%2?u%2?r%2?0:c-3.1:c-2.1:c-1.1:c-.1,n=Math.max(c+m.log2((this._shapedBox.width*this._scale+48)/t.pathLen),Math.max(q,this._minZoom)),p=0,u=h;p<u.length;p++)q=u[p],t.place(q,b,a,k,this._materialKey,e,f,g,c,n,this._maxZoom)};d.prototype.writeMesh=
function(b,a,d,c,e,f,g){var h=this,k=this._computeAnchors(d,e),l=r.i8888to32(0,0,0,this._bitset);if(k.length&&this._shapedGlyphs.length)if(this._placeGlyphs(d,e,k,f),e=u.LabelMaterialKey.load(this._materialKey),"esriGeometryPolyline"!==d){d=k[0];f=this._computeGlyphTransform(this._shapedBox);f=this._createBounds(this._shapedBox,f);var t=d.glyphs.get(0),m=t[0],q=m.anchorX,w=m.anchorY,x=Math.floor(10*m.minZoom),m=Math.floor(10*m.maxZoom),v=b.length;t.forEach(function(b){b.minZoom=25.5;b.maxZoom=25.5});
v=new n.default(c,{from:v,count:b.length-v},q,w,x);q=Math.floor(q/p.COLLISION_BUCKET_SIZE);w=Math.floor(w/p.COLLISION_BUCKET_SIZE);q>=p.COLLISION_TILE_BOX_SIZE||w>=p.COLLISION_TILE_BOX_SIZE||0>q||0>w||(this._writeVertices(b,a,c,t,l,x,m),t=Math.max(this._refTemplate.height,this._refTemplate.width),e.vvSizeFieldStops||e.vvSizeMinMaxValue||e.vvSizeScaleStops||e.vvSizeUnitValue?v.setVV(t,this._xPlacementD,this._yPlacementD):(v.offsetX=(t/2+p.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,v.offsetY=(t/
2+p.COLLISION_PLACEMENT_PADDING)*this._yPlacementD),v.bounds=f,g.push(v),d.clear())}else{e=function(d){var e=k[d],f=e.x,t=e.y;d=b.length;var m=new n.default(c,{from:d,count:-1},f,t,25.5);e.glyphs.forEach(function(d){for(var g=0;g<d.length;g++){var k=d[g];k.minZoom=Math.max(e.minZoom,k.minZoom);if(k.bounds){var n=k.anchorY-t;k.bounds.center[0]+=k.anchorX-f;k.bounds.center[1]+=n;m.add(k.bounds)}}m.bounds&&h._writeHalos(b,a,c,d,l)});e.glyphs.forEach(function(d){m.bounds&&h._writeText(b,a,c,d,l)});m.range.count=
b.length-d;m.bounds&&g.push(m);e.clear()};for(d=0;d<k.length;d++)e(d);this._computedGlyphs=[]}};d.prototype._outsideTile=function(b,a){return 0>b||512<=b||0>a||512<=a};d.prototype._smoothVertices=function(b,a){if(!(0>=a)){var d=b.length;if(!(3>d)){var c=[],e=0;c.push(0);for(var f=1;f<d;f++)e+=y.dist(b[f],b[f-1]),c.push(e);a=Math.min(a,.2*e);e=[];e.push(b[0][0]);e.push(b[0][1]);var g=b[d-1][0],h=b[d-1][1],f=y.sub([0,0],b[0],b[1]);y.normalize(f);b[0][0]+=a*f[0];b[0][1]+=a*f[1];y.sub(f,b[d-1],b[d-2]);
y.normalize(f);b[d-1][0]+=a*f[0];b[d-1][1]+=a*f[1];for(f=1;f<d;f++)c[f]+=a;c[d-1]+=a;for(var k=.5*a,f=1;f<d-1;f++){for(var l=0,t=0,n=0,m=f-1;0<=m&&!(c[m+1]<c[f]-k);m--){var p=k+c[m+1]-c[f],q=c[m+1]-c[m],u=c[f]-c[m]<k?1:p/q;if(1E-6>Math.abs(u))break;var r=u*u,w=u*p-.5*r*q,x=u*q/a,v=b[m+1],C=b[m][0]-v[0],z=b[m][1]-v[1],l=l+x/w*(v[0]*u*p+.5*r*(p*C-q*v[0])-r*u*q*C/3),t=t+x/w*(v[1]*u*p+.5*r*(p*z-q*v[1])-r*u*q*z/3),n=n+x}for(m=f+1;m<d&&!(c[m-1]>c[f]+k);m++){p=k-c[m-1]+c[f];q=c[m]-c[m-1];u=c[m]-c[f]<k?1:
p/q;if(1E-6>Math.abs(u))break;r=u*u;w=u*p-.5*r*q;x=u*q/a;v=b[m-1];C=b[m][0]-v[0];z=b[m][1]-v[1];l+=x/w*(v[0]*u*p+.5*r*(p*C-q*v[0])-r*u*q*C/3);t+=x/w*(v[1]*u*p+.5*r*(p*z-q*v[1])-r*u*q*z/3);n+=x}e.push(l/n);e.push(t/n)}e.push(g);e.push(h);for(m=f=0;f<d;f++)b[f][0]=e[m++],b[f][1]=e[m++]}}};d.prototype._computeLineAnchors=function(b,a,d){a=a.paths;var c=this._scale*this._shapedBox.width;d=c/2+d;for(var c=c/2+16,e=this._shapedBox.width*this._scale,f=0;f<a.length;f++){var g=a[f],k=[];k.push(g[0]);for(var l=
1;l<g.length;l++){var t=k[l-1],n=t[0],t=t[1],n=n+g[l][0],t=t+g[l][1];k.push([n,t])}this._smoothVertices(k,e);g=[];g.push(k[0]);for(l=1;l<k.length;l++){var t=k[l-1],m=k[l],n=Math.round(m[0]-t[0]),t=Math.round(m[1]-t[1]);g.push([n,t])}a[f]=g;k=this._getPathLength(g);if(!(k<2*c))for(var l=k/2,p=0,m=g[0][0],q=g[0][1],u=1;u<g.length;u++){var n=g[u][0],t=g[u][1],r=Math.sqrt(n*n+t*t),p=p+r;if(0<=p-l){var w=p-l,x=r-w,v=x/r,C=m+n*v,y=q+t*v;this._outsideTile(C,y)||(p=new h.default(C,y,v,f,u,m,q,r,k,-1),b.push(p));
for(var z=-1,y=0,y=x-d;0<=y;y-=d){var v=y/r,C=m+n*v,A=q+t*v;z++;this._outsideTile(C,A)||(p=new h.default(C,A,v,f,u,m,q,r,k,z),b.push(p))}p=y+d;y=r-w;v=m;C=q;for(A=u-1;0!==A;A--){var B=g[A][0],D=g[A][1],E=Math.sqrt(B*B+D*D);if(p+E>=d){for(var I=p=d-p;I<E;I+=d){var K=I/E,G=v-B*K,F=C-D*K;z++;(p=I+y+c<l)&&!this._outsideTile(G,F)&&(p=new h.default(G,F,1-K,f,A,v-B,C-D,E,k,z),b.push(p))}p=E-(I-d)}else p+=E;y+=E;v-=B;C-=D}z=-1;for(y=x+d;y<=r;y+=d)v=y/r,C=m+n*v,x=q+t*v,z++,this._outsideTile(C,x)||(p=new h.default(C,
x,v,f,u,m,q,r,k,z),b.push(p));v=m+n;C=q+t;p=r-(y-d);y=w;for(A=u+1;A<g.length;A++){n=g[A][0];t=g[A][1];m=Math.sqrt(n*n+t*t);if(p+m>=d){for(q=p=d-p;q<m;q+=d)u=q/m,r=v+n*u,w=C+t*u,z++,(p=q+y+c<l)&&!this._outsideTile(r,w)&&(p=new h.default(r,w,u,f,A,v,C,m,k,z),b.push(p));p=m-(q-d)}else p+=m;y+=m;v+=n;C+=t}break}m+=n;q+=t}}return b};d.prototype._computeAnchors=function(b,a){var d=[];switch(b){case "esriGeometryPoint":return a=a.geometry,b=a.x,a=a.y,b=new h.default(b,a),d.push(b),d;case "esriGeometryPolygon":if(a.centroid)return a=
a.centroid,b=a.x,a=a.y,b=new h.default(b,a),d.push(b),d;E("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(d,a.geometry,376);default:return E("Unable to handle geometryType: "+b),d}};d.prototype._getPathLength=function(b){for(var a=0,d=1;d<b.length;d++)var c=b[d][0],e=b[d][1],a=a+Math.sqrt(c*c+e*e);return a};d.prototype._computeGlyphTransform=function(b){var a=this._scale,d=this._angle*v.C_DEG_TO_RAD,c=b.width/2,e=b.height/2,
c=this._xAlignD*c*a+(this._xOffset+this._refTemplate.xOffset)+(b.x+c);b=this._yAlignD*e*a-(this._yOffset+this._refTemplate.yOffset)-(b.y+e);e=k.mat2d.identity(D);k.mat2d.translate(e,e,l.vec2.set(C,c,b));k.mat2d.scale(e,e,l.vec2.set(C,a,a));k.mat2d.rotate(e,e,d);return e};d.prototype._writeVertex=function(b,a,d,c,e,f,g,h,k){a=a.get("geometry");g=Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255);var l=this._xPlacementD+1,t=this._yPlacementD+1;h=r.i8888to32(h,k,0,0);
this._refSymbolAndPlacementOffset=r.i8888to32(f.angle,g,l,t);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetUpperLeft);a.push(f.texFontSizeUpperLeft);a.push(this._refSymbolAndPlacementOffset);a.push(h);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetUpperRight);a.push(f.texFontSizeUpperRight);a.push(this._refSymbolAndPlacementOffset);a.push(h);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetLowerLeft);a.push(f.texFontSizeLowerLeft);a.push(this._refSymbolAndPlacementOffset);a.push(h);a.push(c);
a.push(d);a.push(e);a.push(f.vertexOffsetLowerRight);a.push(f.texFontSizeLowerRight);a.push(this._refSymbolAndPlacementOffset);a.push(h);b.vertexCount+=4};return d}(t.default);c.default=a})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(a,c){function f(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(c,"__esModule",{value:!0});c.C_INFINITY=Number.POSITIVE_INFINITY;c.C_PI=Math.PI;c.C_2PI=2*c.C_PI;c.C_PI_BY_2=c.C_PI/2;c.C_RAD_TO_256=128/c.C_PI;c.C_256_TO_RAD=
c.C_PI/128;c.C_DEG_TO_256=256/360;c.C_DEG_TO_RAD=c.C_PI/180;c.C_SQRT2=1.414213562;c.C_SQRT2_INV=1/c.C_SQRT2;var g=1/Math.LN2;c.positiveMod=f;c.radToByte=function(a){return f(a*c.C_RAD_TO_256,256)};c.degToByte=function(a){return f(a*c.C_DEG_TO_256,256)};c.log2=function(a){return Math.log(a)*g};c.sqr=function(a){return a*a};c.interpolate=function(a,b,c){return a*(1-c)+b*c};c.between=function(a,b,c){return a>=b&&a<=c||a>=c&&a<=b}})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require",
"exports","./Rect"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,b,c,f,d,g,q,v){this._glyphItems=a;this._maxWidth=b;this._lineHeight=c;this._letterSpacing=f;this._offset=d;this._hAnchor=g;this._vAnchor=q;this._justify=v}a.prototype.getShaping=function(a,b){for(var c=this._letterSpacing,e=this._lineHeight,d=this._justify,f=this._maxWidth,g=[],v=0,x=0,p=0,z=0,r=-1,w=0,n=-1,u=a.length,h=0;h<u;h++){var y=a.charCodeAt(h);if(10===y){if(h!==u-1){if(r>=z){var v=
g[r],t=v.x+v.glyphMosaicItem.metrics.advance,w=Math.max(t,w);d&&this._applyJustification(g,z,r);z=g.length}x=b?x-e:x+e;v=0;++p}}else{for(var t=void 0,A=0,B=this._glyphItems;A<B.length&&!(t=B[A][y]);A++);if(t){g.push({codePoint:y,x:v,y:x,glyphMosaicItem:t});v+=t.metrics.advance+c;if(0<f&&v>f&&0<=n){A=n+1;t=g[A].x;w=Math.max(t,w);for(B=A;B<g.length;B++)g[B].y=b?g[B].y-e:g[B].y+e,g[B].x-=t;d&&this._applyJustification(g,z,n);x=b?x-e:x+e;v-=t;++p;z=A;n=-1}++r;32===y&&(n=g.length-1)}}}r>=z&&(v=g[r],w=Math.max(w,
v.x+v.glyphMosaicItem.metrics.advance),d&&this._applyJustification(g,z,r));if(0<g.length)for(a=(d-this._hAnchor)*w,c=(-this._vAnchor*(p+1)+.5)*e,b&&p&&(c+=p*e),a+=this._offset[0],c+=this._offset[1],b=0;b<g.length;b++)e=g[b],e.x+=a,e.y+=c;return g};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,c=Infinity,e=0,d=0,f=0;f<a.length;f++)var g=a[f],v=g.glyphMosaicItem.metrics,x=v.height,p=g.x,g=g.y-(x-Math.abs(v.top)),v=p+v.width+v.left,x=g+x,b=Math.min(b,p),e=Math.max(e,v),c=Math.min(c,
g),d=Math.max(d,x);return{x:b,y:c,width:e-b,height:d-c}};a.addDecoration=function(a,b){var c=a.length;if(0!==c){for(var e=a[0].x+a[0].glyphMosaicItem.metrics.left,d=a[0].y,g=1;g<c;g++){var q=a[g];if(q.y!==d){var v=a[g-1].x+a[g-1].glyphMosaicItem.metrics.left+a[g-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:d+b-3,glyphMosaicItem:{sdf:!0,rect:new f.default(4,0,4,8),metrics:{width:v-e,height:8,left:0,top:0,advance:0},page:0}});d=q.y;e=q.x+q.glyphMosaicItem.metrics.left}}c=a[c-1].x+a[c-
1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:d+b-3,glyphMosaicItem:{sdf:!0,rect:new f.default(4,0,4,8),metrics:{width:c-e,height:8,left:0,top:0,advance:0},page:0}})}};a.prototype._applyJustification=function(a,b,c){for(var e=a[c],e=(e.x+e.glyphMosaicItem.metrics.advance)*this._justify;b<=c;b++)a[b].x-=e};return a}();c.TextShaping=a})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=f.getLogger("esri/views/2d/engine/webgl/collisions/Metric");a=function(){function a(b,a,d,c,e){this.id=b;this.range=a;this.boxes=null;this.minZoom=-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=g.vec2f32.fromValues(d,c);this.baseZoom=e}a.prototype.add=function(b){this.bounds?(this.boxes?this.boxes.push(b):(this.boxes=[this.bounds,b],this.bounds=this.bounds.clone()),this.bounds.extend(b)):
this.bounds=b};a.prototype.computeIndex=function(){var b=this.bounds,a=this.anchor[0],d=this.anchor[1],c=Math.floor(a/e.COLLISION_BUCKET_SIZE),f=Math.floor(d/e.COLLISION_BUCKET_SIZE),g=0;if(c>e.COLLISION_TILE_BOX_SIZE||f>e.COLLISION_TILE_BOX_SIZE)f=c=e.COLLISION_TILE_BOX_SIZE,g=1;if(0>c||0>f)f=c=0,g=1;b=2*Math.max(b.halfWidth+Math.abs(b.center[0]),b.halfHeight+Math.abs(b.center[1]));a%=e.COLLISION_BUCKET_SIZE;d%=e.COLLISION_BUCKET_SIZE;this.xBucket=c;this.yBucket=f;this.xOverflow=Math.ceil(Math.abs((b-
a)/e.COLLISION_BUCKET_SIZE))+g;this.yOverflow=Math.ceil(Math.abs((b-d)/e.COLLISION_BUCKET_SIZE))+g};a.prototype.findCollisionDelta=function(b){var a=this.bounds.findCollisionDelta(b.bounds),d=this.boxes&&this.boxes.length,c=b.boxes&&b.boxes.length;return Math.abs(a)>e.COLLISION_MAX_ZOOM_DELTA||!d&&!c?a:d&&c?this._boxesToBoxes(b):d?this._boxesToBox(b):this._boxToBoxes(b)};a.prototype.computeOffset=function(b,a){a||k.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+
a);var d=this.size;this.hasVV&&(b=a(b),d=isNaN(b)||null==b||Infinity===b?this.size:b);this.offsetX=this.directionX*(d/2+e.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(d/2+e.COLLISION_PLACEMENT_PADDING)};a.prototype.setVV=function(b,a,d){this.hasVV=!0;this.size=b;this.directionX=a;this.directionY=d};a.prototype.clone=function(){var b=new a(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);b.minZoom=this.minZoom;this.bounds&&(b.bounds=this.bounds.clone());this.boxes&&(b.boxes=
this.boxes.map(function(b){return b.clone()}));b.xBucket=this.xBucket;b.yBucket=this.yBucket;b.xOverflow=this.xOverflow;b.yOverflow=this.yOverflow;b.hasVV=this.hasVV;b.size=this.size;b.directionX=this.directionX;b.directionY=this.directionY;b.offsetX=this.offsetX;b.offsetY=this.offsetY;return b};a.prototype._boxToBoxes=function(b){var a=-Infinity,d=0;for(b=b.boxes;d<b.length;d++)var c=this.bounds.findCollisionDelta(b[d]),a=Math.max(c,a);return a};a.prototype._boxesToBox=function(b){for(var a=this.boxes[0].findCollisionDelta(b.bounds),
d=1;d<this.boxes.length;d++)var c=this.boxes[d].findCollisionDelta(b.bounds),a=Math.max(c,a);return a};a.prototype._boxesToBoxes=function(b){for(var a=-Infinity,d=0;d<this.boxes.length;d++)for(var c=this.boxes[d],e=0,f=b.boxes;e<f.length;e++)var g=c.findCollisionDelta(f[e]),a=Math.max(g,a);return a};a.prototype.serialize=function(b){b.push(this.id);this.bounds.serialize(b);b.push(this.range.from);b.push(this.range.count);b.push(this.anchor[0]);b.push(this.anchor[1]);b.push(this.baseZoom);b.push(this.hasVV?
1:0);b.push(this.size);b.push(this.directionX);b.push(this.directionY);b.push(this.offsetX);b.push(this.offsetY);m.serializeList(b,this.boxes);return b};a.deserialize=function(d){var c=d.readInt32(),e=b.default.deserialize(d),f=d.readInt32(),g=d.readInt32(),k={from:f,count:g},l=d.readInt32(),w=d.readInt32(),n=d.readInt32(),f=d.readInt32(),g=d.readInt32(),u=d.readInt32(),h=d.readInt32(),y=d.readInt32(),t=d.readInt32();d=m.deserializeList(d,b.default);c=new a(c,k,l,w,n);c.bounds=e;c.boxes=d;c.computeIndex();
f&&c.setVV(g,u,h);c.offsetX=y;c.offsetY=t;return c};return a}();c.default=a})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/vec2f32"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(b,a,c,d){this.center=g.vec2f32.fromValues(b,a);this.centerT=g.vec2f32.create();this.halfWidth=c/2;this.halfHeight=d/2;this.width=c;this.height=d}Object.defineProperty(a.prototype,
"x",{get:function(){return this.center[0]},set:function(b){this.center[0]=b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},set:function(b){this.center[1]=b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"trX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(b){b.writeF32(this.center[0]);b.writeF32(this.center[1]);b.push(this.width);b.push(this.height);return b};a.prototype.findCollisionDelta=
function(b){return f.log2(Math.min((b.halfWidth+this.halfWidth)/Math.abs(b.centerT[0]-this.centerT[0]),(b.halfHeight+this.halfHeight)/Math.abs(b.centerT[1]-this.centerT[1])))};a.prototype.extend=function(b){var a=Math.min(this.blX,b.blX),c=Math.min(this.blY,b.blY),d=Math.max(this.trY,b.trY);this.width=Math.max(this.trX,b.trX)-a;this.height=d-c;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=a+this.halfWidth;this.y=c+this.halfHeight};a.deserialize=function(b){var c=b.readF32(),e=b.readF32(),
d=b.readInt32();b=b.readInt32();return new a(c,e,d,b)};return a}();c.default=a})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.serializeList=function(a,c){if(null===c)a.push(0);else{a.push(c.length);for(var e=0;e<c.length;e++)c[e].serialize(a);return a}};c.deserializeList=function(a,c,e){for(var b=a.readInt32(),b=Array(b),f=0;f<b.length;f++)b[f]=c.deserialize(a,e);return b}})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../definitions ../../materialKey/MaterialKey ./ComputedGlyph ./util".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});var v=g.getLogger("esri.views.2d.engine.webgl.GlyphGroup");a=function(){function a(b,a,d,c,e,f,g,k,l,m){void 0===d&&(d=0);void 0===c&&(c=-1);void 0===e&&(e=-1);void 0===f&&(f=-1);void 0===g&&(g=-1);void 0===k&&(k=-1);void 0===l&&(l=0);void 0===m&&(m=-1);this.x=b;this.y=a;this.t=d;this.i=c;this.j=e;this.segmentPosX=f;this.segmentPosY=g;this.segmentLen=k;this.pathLen=l;this.order=m;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(a.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});a.prototype.add=function(b,a){var d=this._glyphs.get(a);d?d.push(b):this._glyphs.set(a,[b])};a.prototype.clear=function(){this._glyphs.clear()};a.prototype.place=function(b,a,c,e,g,k,h,m,t,q,x){var n=b.x,p=b.y,u=b.codePoint,r=b.glyphMosaicItem;g=d.MaterialKeyBase.load(g);g.textureBinding=b.glyphMosaicItem.textureBinding;switch(a){case "esriGeometryPoint":case "esriGeometryPolygon":b=l.default.from(n,p,this.x,this.y,-1,q,
x,r,u,g.data,e,k,h);this.add(b,0);break;case "esriGeometryPolyline":a=c.geometry;this._placeGlyphAlongLine(b,g.data,a,e,m,k,h,t,q,x,-1);this._placeGlyphAlongLine(b,g.data,a,e,m,k,h,t,q,x,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":b=void 0,void 0===b&&(b="mapview-labeling"),v.error(new f(b,"Cannot place for unsupported geometryType: "+a))}};a.prototype._findLabelTheta=function(b,a,d,c){a*=c;b=Math.acos((0*a+-1*c*-b)/(1*d));0<a&&(b=2*Math.PI-b);return b};a.prototype._placeGlyphAlongLine=
function(a,d,c,f,g,u,h,x,t,v,B){c=c.paths[this.i];var n=c[this.j],p=n[0],r=n[1],n=a.x,w=a.y,y=a.glyphMosaicItem,z=a.codePoint,A=a.glyphMosaicItem.metrics,A=(a.x+A.left+A.width/2)*u/24;a=B*e.sign(A)||1;var A=Math.abs(A),F=q.len(p,r),H=this._findLabelTheta(p,r,F,B),M=(a+1)/2,F=-a*(-1*M+this.t)*F,L=b.mat2d.rotate(m.mat2df32.create(),f,-H),J=48<g.height;g=0===F?v:Math.max(Math.max(x+e.log2(Math.abs(A/F)),0),t);J&&(g=t);v=l.default.from(n,w,this.x,this.y,H,g,v,y,z,d,L,u,h,J||g<=x&&v>=x&&1===B);this.add(v,
this.j);if(!J)for(v=this.segmentPosX+M*p,p=this.segmentPosY+M*r,L=g,r=this.j+a;0<r&&r<c.length;r+=a){var O=v,Q=p,M=c[r];g=M[0];var M=M[1],R=q.len(g,M),J=this._findLabelTheta(g,M,R,B),J=b.mat2d.rotate(m.mat2df32.create(),f,-J),O=O+-a*g/R*F,Q=Q+-a*M/R*F,F=F+R,R=L-.1,L=0===F?R:Math.max(Math.max(x+e.log2(Math.abs(A/F)),0),t),J=l.default.from(n,w,O,Q,H,L,R,y,z,d,J,u,h,L<=x&&R>=x&&1===B);this.add(J,r);if(L<x-k.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(L,this.minZoom);break}v+=a*g;p+=a*M}};return a}();
c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../number ../../collisions/BoundingBox".split(" "),function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=g.vec2f32.create();a=function(){function a(b,a,d,c,e,f,g,k,n,m,h,y,t,A,B){this.anchorX=b;this.anchorY=a;this.angle=d;this.bounds=c;this.minZoom=e;this.maxZoom=
f;this.materialKey=g;this.vertexOffsetUpperLeft=k;this.vertexOffsetUpperRight=n;this.vertexOffsetLowerLeft=m;this.vertexOffsetLowerRight=h;this.texFontSizeUpperLeft=y;this.texFontSizeUpperRight=t;this.texFontSizeLowerLeft=A;this.texFontSizeLowerRight=B}a.from=function(d,c,g,x,p,z,r,w,n,u,h,y,t,A,B){void 0===A&&(A=!1);void 0===B&&(B=!1);var l=w.rect,q=w.metrics;p=-1===p?255:Math.floor(180*p/Math.PI/360*254);var v=Math.round(l.x/4),E=Math.round(l.y/4);w=v+Math.round(l.width/4);var I=E+Math.round(l.height/
4),G=-24-q.top,N=q.left,F=-q.top,H=l.width,l=l.height;n||(B||(G=0),N=4,H=q.width);d+=N;n=B?c+F:c+G;H=d+H;G=n;c=d;F=n+l;l=H;B=F;var N=c+q.width,M=F-q.height,L=q.width*y/24,q=q.height*y/24;h&&(f.vec2.transformMat2d(k,f.vec2.set(k,d,n),h),d=k[0],n=k[1],f.vec2.transformMat2d(k,f.vec2.set(k,H,G),h),H=k[0],G=k[1],f.vec2.transformMat2d(k,f.vec2.set(k,c,F),h),c=k[0],F=k[1],f.vec2.transformMat2d(k,f.vec2.set(k,l,B),h),l=k[0],B=k[1],f.vec2.transformMat2d(k,f.vec2.set(k,N,M),h),N=k[0],M=k[1]);h=A?new m.default(N,
M,L+e.COLLISION_BOX_PADDING,q+e.COLLISION_BOX_PADDING):null;A=b.i1616to32(8*d,8*n);q=b.i1616to32(8*H,8*G);d=b.i1616to32(8*c,8*F);c=b.i1616to32(8*l,8*B);l=b.i8888to32(v,E,y,t);E=b.i8888to32(w,E,y,t);v=b.i8888to32(v,I,y,t);y=b.i8888to32(w,I,y,t);return new a(g|0,x|0,p,h,z,r,u,A,q,d,c,l,E,v,y)};return a}();c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(a,c){function f(a,c){return Math.sqrt(a*a+c*c)}Object.defineProperty(c,"__esModule",
{value:!0});c.sub=function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];return a};c.len=f;c.normalize=function(a){var c=f(a[0],a[1]);a[0]/=c;a[1]/=c};c.dist=function(a,c){return f(a[0]-c[0],a[1]-c[1])};c.isFunction=function(a){return"function"===typeof a};c.getLimitCosine=function(a){return 1/Math.max(a,1)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(b,d,c,f,l,q,h,x,t,v,B,C,D){var n=a.call(this)||this;n._xOffset=g.pt2px(B);n._yOffset=g.pt2px(C);n._decorationTop=m.getFontDecorationTop(x);n._color=f;n._haloColor=l;n._haloSize=Math.min(Math.floor(5*g.pt2px(g.toPt(c))),127);n._size=Math.min(Math.round(g.pt2px(d)),127);d=Math.min(Math.round(g.pt2px(d)),127);n._referenceSize=Math.round(Math.sqrt(256*d));n._scale=n._size/24;n._angle=v;n._justify=
e.getJustification(q||"center");n._xAlignD=e.getXAnchorDirection(q||"center");n._yAlignD=-e.getYAnchorDirection(h||"baseline");n._baseline="baseline"===(h||"baseline");n._bitset=t?1:0;b=k.MaterialKeyBase.load(k.createMaterialKey(n.geometryType,b,!1));b.sdf=!0;n._materialKey=b.data;n.symbolId=D;return n}f(d,a);d.fromText=function(a,c,e){a=new d(a,c.font.size,c.haloSize||0,c.color&&b.premultiplyAlphaRGBA(c.color)||0,c.haloColor&&b.premultiplyAlphaRGBA(c.haloColor)||0,c.horizontalAlignment,c.verticalAlignment,
c.font.decoration,!1,c.angle||0,c.xoffset,c.yoffset,c.id);c=q.bidiText(c.text);a.bindTextInfo(e,c[0],c[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};d.fromCIMText=function(a,c,e){var f=c.scaleFactor||1;a=new d(a,c.size*c.sizeRatio*f,c.outlineSize*c.sizeRatio,b.premultiplyAlphaRGBA(c.color),b.premultiplyAlphaRGBA(c.outlineColor),c.horizontalAlignment,c.verticalAlignment,c.decoration,c.colorLocked,c.angle,c.offsetX*c.sizeRatio*f,c.offsetY*c.sizeRatio*f,c.materialHash);c=q.bidiText(c.text);
a.bindTextInfo(e,c[0],c[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};return d}(d.default(l.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../enums ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ../../materialKey/MaterialKey ./ComputedGlyph".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w){Object.defineProperty(c,"__esModule",{value:!0});var n=e.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),u=Math.PI/180,h=m.mat2df32.create(),y=d.vec2f32.create();c.default=function(a){return function(a){function c(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];b=a.apply(this,b)||this;b.geometryType=q.WGLGeometryType.TEXT;return b}f(c,a);c.prototype.bindTextInfo=function(b,a,d){b=this._computeShaping(b,this._justify).getShaping(a,d);
isNaN(this._decorationTop)||x.TextShaping.addDecoration(b,this._decorationTop);this._shapedGlyphs=b;this._shapedBox=x.TextShaping.getBox(b)};c.prototype.writeMesh=function(b,a,d,c,e){var f=this._computedGlyphs;if(f){var h=v.i8888to32(0,0,this._referenceSize,this._bitset);switch(d){case "esriGeometryPoint":e=e.geometry;d=e.x;e=e.y;for(var k=0;k<f.length;k++){var l=f[k];l.anchorX=d;l.anchorY=e}this._writeVertices(b,a,c,f,h,0,0);break;case "esriGeometryPolygon":if(e.centroid){e=e.centroid;d=e.x;e=e.y;
for(k=0;k<f.length;k++)l=f[k],l.anchorX=d,l.anchorY=e;this._writeVertices(b,a,c,f,h,0,0);break}case "esriGeometryMultipoint":for(var k=e.geometry.points,t=e=d=0;t<k.length;t++){l=k[t];d+=l[0];e+=l[1];for(var m=0,p=f;m<p.length;m++)l=p[m],l.anchorX=d,l.anchorY=e;this._writeVertices(b,a,c,f,h,0,0)}break;default:b=void 0,void 0===b&&(b="mapview-processing"),n.error(new g(b,"Unable to handle geometryType: "+d))}}};c.prototype._computeGlyphs=function(b,a){if(b&&0!==b.length){var d=Array(b.length);a=this._computeGlyphTransform(a);
for(var c=r.MaterialKeyBase.load(this._materialKey),e=0;e<b.length;e++){var f=b[e],g=f.x,h=f.y,k=f.codePoint,f=f.glyphMosaicItem;c.textureBinding=f.textureBinding;d[e]=w.default.from(g,h,0,0,-1,0,25,f,k,c.data,a,this._size,this._haloSize,!1,!0)}this._computedGlyphs=d}};c.prototype._createBounds=function(b,a){var c=b.width/2,e=b.height/2,f=a[4],g=a[5],h;if(this._angle){b=d.vec2f32.fromValues(-c,-e);h=d.vec2f32.fromValues(c,-e);var t=d.vec2f32.fromValues(-c,e),n=d.vec2f32.fromValues(c,e);k.vec2.transformMat2d(b,
b,a);k.vec2.transformMat2d(h,h,a);k.vec2.transformMat2d(t,t,a);k.vec2.transformMat2d(n,n,a);a=e=Infinity;var m=0,p=c=0;for(b=[b,h,t,n];p<b.length;p++)h=b[p],e=Math.min(h[0],e),m=Math.max(h[0],m),a=Math.min(h[1],a),c=Math.max(h[1],c);h=m-e;b=c-a}else h=b.width*this._scale,b=b.height*this._scale;return new z.default(f,g,h+l.COLLISION_BOX_PADDING,b+l.COLLISION_BOX_PADDING)};c.prototype._computeShaping=function(b,a){return new x.TextShaping([b],512,l.TEXT_LINE_HEIGHT,l.TEXT_SPACING,[0,.5*-l.TEXT_LINE_HEIGHT],
.5*(1-this._xAlignD),0,a)};c.prototype._computeGlyphTransform=function(a){var d=this._scale,c=this._angle*u,e=b.mat2d.identity(h);b.mat2d.rotate(e,e,c);b.mat2d.translate(e,e,k.vec2.set(y,this._xOffset,-this._yOffset));b.mat2d.scale(e,e,k.vec2.set(y,d,d));b.mat2d.translate(e,e,k.vec2.set(y,-4,-4-(this._baseline?25:a.y+(1-this._yAlignD)*a.height*.5)));return e};c.prototype._writeVertices=function(b,a,d,c,e,f,g){this._writeHalos(b,a,d,c,e,f,g);this._writeText(b,a,d,c,e,f,g)};c.prototype._writeHalos=
function(b,a,d,c,e,f,g){var h=a.indexVector,k=a.getVector("geometry").vertexCount,l=0;if(this._haloSize)for(var t=0;t<c.length;t++,l+=4){var n=c[t],m=v.i1616to32(2*n.anchorX+1,2*n.anchorY),q=null==f?Math.floor(10*n.minZoom):f,u=null==g?Math.floor(10*n.maxZoom):g,r=new p(d,this.geometryType,n.materialKey,q,u);r.vertexFrom=k+l;r.indexFrom=h.length;this._writeVertex(r,a,d,m,this._haloColor,n,e,q,u);this._writeIndices(r,h,k+l);b.push(r)}};c.prototype._writeText=function(b,a,d,c,e,f,g){for(var h=a.indexVector,
k=a.getVector("geometry").vertexCount,l=0,t=0;t<c.length;t++,l+=4){var n=c[t],m=v.i1616to32(2*n.anchorX,2*n.anchorY),q=null==f?Math.floor(10*n.minZoom):f,u=null==g?Math.floor(10*n.maxZoom):g,r=new p(d,this.geometryType,n.materialKey,q,u);r.vertexFrom=k+l;r.indexFrom=h.length;this._writeVertex(r,a,d,m,this._color,n,e,q,u);this._writeIndices(r,h,k+l);b.push(r)}};c.prototype._writeVertex=function(b,a,d,c,e,f,g,h,k){a=a.get("geometry");a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetUpperLeft);a.push(f.texFontSizeUpperLeft);
a.push(g);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetUpperRight);a.push(f.texFontSizeUpperRight);a.push(g);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetLowerLeft);a.push(f.texFontSizeLowerLeft);a.push(g);a.push(c);a.push(d);a.push(e);a.push(f.vertexOffsetLowerRight);a.push(f.texFontSizeLowerRight);a.push(g);b.vertexCount+=4};c.prototype._writeIndices=function(b,a,d){a.push(d+0);a.push(d+1);a.push(d+2);a.push(d+1);a.push(d+3);a.push(d+2);b.indexCount+=6};return c}(a)}})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require",
"exports","./Rect"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,b,c,f,d,g,q,v){this._glyphItems=a;this._maxWidth=b;this._lineHeight=c;this._letterSpacing=f;this._offset=d;this._hAnchor=g;this._vAnchor=q;this._justify=v}a.prototype.getShaping=function(a,b){for(var c=this._letterSpacing,e=this._lineHeight,d=this._justify,f=this._maxWidth,g=[],v=0,x=0,p=0,z=0,r=-1,w=0,n=-1,u=a.length,h=0;h<u;h++){var y=a.charCodeAt(h);if(10===y){if(h!==u-1){if(r>=z){var v=
g[r],t=v.x+v.glyphMosaicItem.metrics.advance,w=Math.max(t,w);d&&this._applyJustification(g,z,r);z=g.length}x=b?x-e:x+e;v=0;++p}}else{for(var t=void 0,A=0,B=this._glyphItems;A<B.length&&!(t=B[A][y]);A++);if(t){g.push({codePoint:y,x:v,y:x,glyphMosaicItem:t});v+=t.metrics.advance+c;if(0<f&&v>f&&0<=n){A=n+1;t=g[A].x;w=Math.max(t,w);for(B=A;B<g.length;B++)g[B].y=b?g[B].y-e:g[B].y+e,g[B].x-=t;d&&this._applyJustification(g,z,n);x=b?x-e:x+e;v-=t;++p;z=A;n=-1}++r;32===y&&(n=g.length-1)}}}r>=z&&(v=g[r],w=Math.max(w,
v.x+v.glyphMosaicItem.metrics.advance),d&&this._applyJustification(g,z,r));if(0<g.length)for(a=(d-this._hAnchor)*w,c=(-this._vAnchor*(p+1)+.5)*e,b&&p&&(c+=p*e),a+=this._offset[0],c+=this._offset[1],b=0;b<g.length;b++)e=g[b],e.x+=a,e.y+=c;return g};a.prototype.getEstimatedShaping=function(a,b,c){for(var e=this._letterSpacing,d=this._lineHeight,f=this._justify,g=this._maxWidth,m=[],x=0,p=0,z=0,r=0,w=-1,n=0,u=-1,h=a.length,y=0;y<h;y++){var t=a.charCodeAt(y);if(10===t){if(y!==h-1){if(w>=r){var x=m[w],
A=x.x+x.glyphMosaicItem.metrics.advance,n=Math.max(A,n);f&&this._applyJustification(m,r,w);r=m.length}p=b?p-d:p+d;x=0;++z}}else{A=c;m.push({codePoint:t,x:x,y:p,glyphMosaicItem:A});x+=A.metrics.advance+e;if(0<g&&x>g&&0<=u){for(var B=u+1,A=m[B].x,n=Math.max(A,n),C=B;C<m.length;C++)m[C].y=b?m[C].y-d:m[C].y+d,m[C].x-=A;f&&this._applyJustification(m,r,u);p=b?p-d:p+d;x-=A;++z;r=B;u=-1}++w;32===t&&(u=m.length-1)}}w>=r&&(x=m[w],n=Math.max(n,x.x+x.glyphMosaicItem.metrics.advance),f&&this._applyJustification(m,
r,w));if(0<m.length)for(a=(f-this._hAnchor)*n,c=(-this._vAnchor*(z+1)+.5)*d,b&&z&&(c+=z*d),a+=this._offset[0],c+=this._offset[1],b=0;b<m.length;b++)d=m[b],d.x+=a,d.y+=c;return m};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,c=Infinity,e=-Infinity,d=-Infinity,f=0;f<a.length;f++)var g=a[f],v=g.glyphMosaicItem.metrics,x=g.x+v.left,g=g.y-v.top,p=x+v.width,v=g+v.height,b=Math.min(b,x),e=Math.max(e,p),c=Math.min(c,g),d=Math.max(d,v);return{x:b,y:c,width:e-b,height:d-c}};a.addDecoration=
function(a,b){var c=a.length;if(0!==c){for(var e=a[0].x+a[0].glyphMosaicItem.metrics.left,d=a[0].y,g=1;g<c;g++){var q=a[g];if(q.y!==d){var v=a[g-1].x+a[g-1].glyphMosaicItem.metrics.left+a[g-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:d,glyphMosaicItem:{sdf:!0,rect:new f.default(4,0,4,8),metrics:{width:v-e,height:2,left:0,top:b,advance:0},page:0}});d=q.y;e=q.x+q.glyphMosaicItem.metrics.left}}c=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,
x:e,y:d,glyphMosaicItem:{sdf:!0,rect:new f.default(4,0,4,8),metrics:{width:c-e,height:2,left:0,top:b,advance:0},page:0}})}};a.prototype._applyJustification=function(a,b,c){for(var f=a[c],f=(f.x+f.glyphMosaicItem.metrics.advance)*this._justify;b<=c;b++)a[b].x-=f};return a}();c.TextShaping=a})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require","exports","./MeshData","./Utils"],function(a,c,f,g){return function(){function a(b,a,c,d,f){void 0===d&&(d=0);void 0===f&&(f=0);this.id=
b;this.geometryType=a;this.materialKey=c;this.minZoom=d;this.maxZoom=f;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});a.prototype.clone=function(){return this.copy()};a.prototype.copy=function(){var b=new a(this.id,this.geometryType,this.materialKey);b.vertexFrom=this.vertexFrom;
b.vertexCount=this.vertexCount;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;b.zOrder=this.zOrder;b.symbolLevel=this.symbolLevel;b.meshData=this.meshData;b.minZoom=this.minZoom;b.maxZoom=this.maxZoom;return b};a.prototype.setMeshDataFromBuffers=function(b,a,c){var d=new f,e;for(e in a){for(var k=a[e].stride,m=a[e].data,x=[],p=g.strideToPackingFactor(k),z=0;z<k*b.vertexCount/p;++z)x[z]=m[z+k*b.vertexFrom/p];d.vertexData.set(e,x)}for(z=d.indexData.length=0;z<b.indexCount;++z)d.indexData[z]=
c[z+b.indexFrom]-b.vertexFrom;d.vertexCount=b.vertexCount;this.meshData=d};a.prototype.readMeshDataFromBuffers=function(b,a){this.meshData?this.meshData.clear():this.meshData=new f;for(var c in b){for(var d=b[c].stride,e=b[c].data,m=[],v=g.strideToPackingFactor(d),x=0;x<d*this.vertexCount/v;++x)m[x]=e[x+d*this.vertexFrom/v];this.meshData.vertexData.set(c,m)}for(x=this.meshData.indexData.length=0;x<this.indexCount;++x)this.meshData.indexData[x]=a[x+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=
this.vertexCount};a.prototype.writeMeshDataToBuffers=function(b,a,c,d){for(var f in a)for(var e=a[f].stride,k=this.meshData.vertexData.get(f),m=a[f].data,p=g.strideToPackingFactor(e),z=0;z<e*this.meshData.vertexCount/p;++z)m[z+e*b/p]=k[z];for(z=0;z<this.meshData.indexData.length;++z)d[z+c]=this.meshData.indexData[z]+b;this.vertexFrom=b;this.vertexCount=this.meshData.vertexCount;this.indexFrom=c;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(b,a,c){for(var d=0,
f=0,e=0;e<b.length;e++){var g=b[e];g.writeMeshDataToBuffers(d,a,f,c);d+=g.vertexCount;f+=g.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(b){b.push(this.geometryType);b.push(this.materialKey);b.push(this.symbolLevel);b.push(this.zOrder);b.push(this.vertexFrom);b.push(this.vertexCount);b.push(this.indexFrom);b.push(this.indexCount);b.push(this.minZoom);b.push(this.maxZoom);return b};
a.deserialize=function(b,c){var f=b.readInt32(),d=b.readInt32();c=new a(c.id,f,d);c.symbolLevel=b.readInt32();c.zOrder=b.readInt32();c.vertexFrom=b.readInt32();c.vertexCount=b.readInt32();c.indexFrom=b.readInt32();c.indexCount=b.readInt32();c.minZoom=b.readInt32();c.maxZoom=b.readInt32();return c};return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(a,c){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=
function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};a.prototype.update=function(a,c,b){for(var f in a)this.vertexData.set(f,a[f]);for(f in this.vertexData)null===a[f]&&this.vertexData.delete(f);this.vertexCount=c;this.indexData=b};return a}()})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){}
a.prototype.writeMesh=function(a,b,c,f,d){};a.prototype.bindFeature=function(a,b,c){};return a}();c.default=a})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","../../../../../core/BidiEngine"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});var g=new f.default;c.bidiText=function(a){if(!g.hasBidiChar(a))return[a,!1];var b;b="rtl"===g.checkContextual(a)?"IDNNN":"ICNNN";return[g.bidiTransform(a,b,"VLYSN"),!0]}})},"esri/core/BidiEngine":function(){define(["require",
"exports","./bidiEngineTables"],function(a,c,f){function g(a,d,c,f,h){var l=a;void 0===d&&(d=h.defInFormat);void 0===c&&(c=h.defOutFormat);void 0===f&&(f=h.defSwap);if(d!==c){var t=d.substring(0,1),n=c.substring(0,1),m;m=d.substring(1,4);var p=c.substring(1,4);"C"===m.charAt(0)&&(m=e(l),m="ltr"===m||"rtl"===m?m.toUpperCase():"L"===d.charAt(2)?"LTR":"RTL",d=t+m);"C"===p.charAt(0)&&(m=e(l),"rtl"===m?p="RTL":"ltr"===m?(l=l.split(""),l.reverse(),m=e(l.join("")),p=m.toUpperCase()):p="L"===c.charAt(2)?
"LTR":"RTL",c=n+p)}if(d===c)return a;n=d.substring(0,1);l=d.substring(1,4);t=c.substring(0,1);p=c.substring(1,4);h.inFormat=d;h.outFormat=c;h.swap=f;if("L"===n&&"VLTR"===c){if("LTR"===l)return h.dir=B,b(a,h);if("RTL"===l)return h.dir=C,b(a,h)}if("V"===n&&"V"===t)return h.dir="RTL"===l?C:B,k(a,h);if("L"===n&&"VRTL"===c)return h.dir="LTR"===l?B:C,a=b(a,h),k(a);if("VLTR"===d&&"LLTR"===c)return h.dir=B,b(a,h);if("V"===n&&"L"===t&&l!==p)return a=k(a),"RTL"===l?g(a,"LLTR","VLTR",f,h):g(a,"LRTL","VRTL",
f,h);if("VRTL"===d&&"LRTL"===c)return g(a,"LRTL","VRTL",f,h);"L"===n&&"L"===t&&(d=h.swap,h.swap=d.substr(0,1)+"N","RTL"===l?(h.dir=C,a=b(a,h),h.swap="N"+d.substr(1,2),h.dir=B,a=b(a,h)):(h.dir=B,a=b(a,h),h.swap="N"+d.substr(1,2),a=g(a,"VLTR","LRTL",h.swap,h)));return a}function e(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}function b(a,b){a=a.split("");var d=[];m(a,d,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,
2))for(var c=0;c<a.length;c++)if(1===d[c]){var e=c,g;b:{g=a[c];for(var k=void 0,l=0,t=f.SwapTable.length-1;l<=t;)if(k=Math.floor((l+t)/2),g<f.SwapTable[k][0])t=k-1;else if(g>f.SwapTable[k][0])l=k+1;else{g=f.SwapTable[k][1];break b}}a[e]=g}q(2,a,d,b);q(1,a,d,b);h=d;return a.join("")}function m(a,b,d){var c=a.length,e=d.dir?f.impTabRtl:f.impTabLtr,g=null,h=null,k=null,g=0,h=h=null,l=-1,n=h=null,m=[],p=[];d.hiLevel=d.dir;d.lastArabic=!1;d.hasUbatAl=!1;d.hasUbatB=!1;d.hasUbatS=!1;for(h=0;h<c;h++){var n=
h,k=a[h].charCodeAt(0),u=f.MasterTable[k>>8];m[n]=u<f.TBBASE?u:f.UnicodeTable[u-f.TBBASE][k&255]}for(n=0;n<c;n++){p[n]=h=v(a,m,p,n,d);g=e[g][h];h=g&240;g&=15;b[n]=k=e[g][t];if(0<h){if(16===h)for(h=l;h<n;h++)b[h]=1;l=-1}if(h=e[g][A])-1===l&&(l=n);else if(-1<l){for(h=l;h<n;h++)b[h]=k;l=-1}m[n]===f.UBAT_B&&(b[n]=0);d.hiLevel|=k}if(d.hasUbatS)for(a=0;a<c;a++)if(m[a]===f.UBAT_S)for(b[a]=d.dir,e=a-1;0<=e;e--)if(m[e]===f.UBAT_WS)b[e]=d.dir;else break}function k(a,b){a=a.split("");if(b){var d=[];m(a,d,b);
h=d}a.reverse();n.reverse();return a.join("")}function d(a){for(var b=0;b<f.ArabicAlefBetIntervalsBegine.length;b++)if(a>=f.ArabicAlefBetIntervalsBegine[b]&&a<=f.ArabicAlefBetIntervalsEnd[b])return!0;return!1}function l(a,b,c,f){for(;b*c<f&&p(a[b]);)b+=c;return b*c<f&&d(a[b])?!0:!1}function q(a,b,d,c){if(!(c.hiLevel<a))if(1!==a||c.dir!==C||c.hasUbatB){c=b.length;for(var f=0,e,g,h;f<c;){if(d[f]>=a){for(e=f+1;e<c&&d[e]>=a;)e++;for(g=e-1;f<g;f++,g--)h=b[f],b[f]=b[g],b[g]=h,h=n[f],n[f]=n[g],n[g]=h;f=
e}f++}}else b.reverse(),n.reverse()}function v(a,b,d,c,e){return{UBAT_L:function(){e.lastArabic=!1;return f.UBAT_L},UBAT_R:function(){e.lastArabic=!1;return f.UBAT_R},UBAT_ON:function(){return f.UBAT_ON},UBAT_AN:function(){return f.UBAT_AN},UBAT_EN:function(){return e.lastArabic?f.UBAT_AN:f.UBAT_EN},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return f.UBAT_R},UBAT_WS:function(){return f.UBAT_ON},UBAT_CS:function(){var a,g;if(1>c||c+1>=b.length||(a=d[c-1])!==f.UBAT_EN&&a!==f.UBAT_AN||(g=b[c+
1])!==f.UBAT_EN&&g!==f.UBAT_AN)return f.UBAT_ON;e.lastArabic&&(g=f.UBAT_AN);return g===a?g:f.UBAT_ON},UBAT_ES:function(){return(0<c?d[c-1]:f.UBAT_B)===f.UBAT_EN&&c+1<b.length&&b[c+1]===f.UBAT_EN?f.UBAT_EN:f.UBAT_ON},UBAT_ET:function(){if(0<c&&d[c-1]===f.UBAT_EN)return f.UBAT_EN;if(e.lastArabic)return f.UBAT_ON;for(var a=c+1,g=b.length;a<g&&b[a]===f.UBAT_ET;)a++;return a<g&&b[a]===f.UBAT_EN?f.UBAT_EN:f.UBAT_ON},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var g=b.length,h=c+1;h<g&&b[h]===f.UBAT_NSM;)h++;
if(h<g&&(g=a[c].charCodeAt[0],h=b[h],(1425<=g&&2303>=g||64286===g)&&(h===f.UBAT_R||h===f.UBAT_AL)))return f.UBAT_R}return 1>c||b[c-1]===f.UBAT_B?f.UBAT_ON:d[c-1]},UBAT_B:function(){e.lastArabic=!0;e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return f.UBAT_ON},UBAT_LRE:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_RLE:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_LRO:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_RLO:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_PDF:function(){e.lastArabic=
!1;return f.UBAT_ON},UBAT_BN:function(){return f.UBAT_ON}}[f.TYPES_NAMES[b[c]]]()}function x(a,b){for(var d=0;d<f.BaseForm.length;d++)if(a===f.BaseForm[d])return b[d];return a}function p(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function z(a){return"L"===a?"LTR":"R"===a?"RTL":"C"===a?"CLR":"D"===a?"CRL":""}function r(a,b){for(var d=0;d<f.AlefTable.length;d++)if(a===f.AlefTable[d])return b[d];return a}function w(a,b,d,c){for(var f=0;f<a.length;f++)if(a[f]>b||!d&&a[f]===b)a[f]+=c}Object.defineProperty(c,
"__esModule",{value:!0});a=function(){function a(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}a.prototype.bidiTransform=function(a,b,c){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var e=this.sourceToTarget,k=this.targetToSource,t=a.length;n=[];h=[];for(var m=0;m<t;m++)e[m]=m,k[m]=m,n[m]=m;if(!this.checkParameters(b,c))return a;b=this.inputFormat;c=this.outputFormat;var e=a,e=y,m=z(b.charAt(1)),k=z(c.charAt(1)),q=
"I"===b.charAt(0)?"L":b.charAt(0),t="I"===c.charAt(0)?"L":c.charAt(0),m=q+m,k=t+k,t=b.charAt(2)+c.charAt(2);e.defInFormat=m;e.defOutFormat=k;e.defSwap=t;a=g(a,m,k,t,e);e=!1;if("R"===c.charAt(1))e=!0;else if("C"===c.charAt(1)||"D"===c.charAt(1))e="rtl"===this.checkContextual(a);k=this.sourceToTarget=n;t=Array(k.length);for(m=0;m<k.length;m++)t[k[m]]=m;u=this.targetToSource=t;if(b.charAt(3)===c.charAt(3))e=a;else if("S"===c.charAt(3))if(b=e,c=!0,0===a.length)e="";else{void 0===b&&(b=!0);void 0===c&&
(c=!0);a=String(a);a=a.split("");var v=0,k=1,e=a.length;b||(v=a.length-1,k=-1,e=1);for(var t=e,m=c,C=0,e=[],q=0;v*k<t;v+=k)if(d(a[v])||p(a[v])){var A;if(A="\u0644"===a[v])b:{for(var B=a,D=v+k,K=k,E=t;D*K<E&&p(B[D]);)D+=K;A=" ";if(D*K<E)for(A=B[D],B=0;B<f.AlefTable.length;B++)if(f.AlefTable[B]===A){A=!0;break b}A=!1}if(A){a[v]=0===C?r(a[v+k],f.LamAlefInialTableFE):r(a[v+k],f.LamAlefMedialTableFE);v+=k;C=a;A=v;B=k;for(D=t;A*B<D&&p(C[A]);)A+=B;A*B<D&&(C[A]=" ");m&&(e[q]=v,q++);C=0}else{A=a[v];if(1===
C){B=v;if(l(a,v+k,k,t))b:for(D=a[v],K=0;K<f.BaseForm.length;K++){if(D===f.BaseForm[K]){D=f.MedialForm[K];break b}}else D=x(a[v],f.FinalForm);a[B]=D}else!0===l(a,v+k,k,t)?a[v]=x(a[v],f.InitialForm):a[v]=x(a[v],f.IsolatedForm);p(A)||(C=1);b:{for(B=0;B<f.StandAlonForm.length;B++)if(f.StandAlonForm[B]===A){A=!0;break b}A=!1}!0===A&&(C=0)}}else C=0;k="";for(t=0;t<a.length;t++){if(m=c){b:{for(m=0;m<e.length;m++)if(e[m]===t)break b;m=-1}m=-1<m}m?(w(u,t,!b,-1),n.splice(t,1)):k+=a[t]}e=k}else if(b=a,c=e,a=
!0,0===b.length)e="";else for(void 0===a&&(a=!0),void 0===c&&(c=!0),b=String(b),e="",k=b.split(""),t=0;t<b.length;t++)m=!1,"\ufe70"<=k[t]&&"\ufeff">k[t]?(q=b.charCodeAt(t),"\ufef5"<=k[t]&&"\ufefc">=k[t]?(c?(0<t&&a&&" "===k[t-1]?e=e.substring(0,e.length-1)+"\u0644":(e+="\u0644",m=!0),e+=f.AlefTable[(q-65269)/2]):(e+=f.AlefTable[(q-65269)/2],e+="\u0644",t+1<b.length&&a&&" "===k[t+1]?t++:m=!0),m&&(w(u,t,!0,1),n.splice(t,0,n[t]))):e+=f.FETo06Table[q-65136]):e+=k[t];this.sourceToTarget=n;this.targetToSource=
u;this.levels=h;return e};a.prototype._inputFormatSetter=function(a){if(!D.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a};a.prototype._outputFormatSetter=function(a){if(!D.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a};a.prototype.checkParameters=function(a,b){a?this._inputFormatSetter(a):a=this.inputFormat;b?this._outputFormatSetter(b):b=this.outputFormat;return a===b?!1:!0};a.prototype.checkContextual=
function(a){a=e(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(G){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a};a.prototype.hasBidiChar=function(a){return K.test(a)};return a}();c.default=a;var n=[],u=[],h=[],y={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},t=5,A=6,B=0,C=1,D=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,K=/[\u0591-\u06ff\ufb1d-\ufefc]/})},
"esri/core/bidiEngineTables":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});c.SwapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a",
"\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];c.AlefTable=["\u0622","\u0623","\u0625","\u0627"];c.LamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];c.LamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];c.BaseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");
c.IsolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");c.FinalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");
c.MedialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");c.InitialForm="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");
c.StandAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");c.FETo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
c.ArabicAlefBetIntervalsBegine=["\u0621","\u0641"];c.ArabicAlefBetIntervalsEnd=["\u063a","\u064a"];c.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];c.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];c.UBAT_L=0;c.UBAT_R=1;c.UBAT_EN=2;c.UBAT_AN=3;c.UBAT_ON=4;c.UBAT_B=5;c.UBAT_S=6;c.UBAT_AL=7;c.UBAT_WS=8;c.UBAT_CS=9;c.UBAT_ES=10;c.UBAT_ET=11;c.UBAT_NSM=12;c.UBAT_LRE=13;c.UBAT_RLE=14;c.UBAT_PDF=15;c.UBAT_LRO=16;
c.UBAT_RLO=17;c.UBAT_BN=18;c.TYPES_NAMES="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");c.TBBASE=100;a=c.UBAT_L;var f=c.UBAT_R,g=c.UBAT_EN,e=c.UBAT_AN,b=c.UBAT_ON,m=c.UBAT_B,k=c.UBAT_S,d=c.UBAT_AL,l=c.UBAT_WS,q=c.UBAT_CS,v=c.UBAT_ES,x=c.UBAT_ET,p=c.UBAT_NSM,z=c.UBAT_LRE,r=c.UBAT_RLE,w=c.UBAT_PDF,n=c.UBAT_LRO,u=c.UBAT_RLO,h=c.UBAT_BN;c.MasterTable=[c.TBBASE+0,a,a,a,a,c.TBBASE+1,c.TBBASE+
2,c.TBBASE+3,f,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,c.TBBASE+4,b,b,b,a,b,a,b,a,b,b,b,a,a,b,b,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,b,b,a,a,b,b,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,
a,a,a,c.TBBASE+5,d,d,c.TBBASE+6,c.TBBASE+7];c.UnicodeTable=[[h,h,h,h,h,h,h,h,h,k,m,k,l,m,h,h,h,h,h,h,h,h,h,h,h,h,h,h,m,m,m,k,l,b,b,x,x,x,b,b,b,b,b,v,q,v,q,q,g,g,g,g,g,g,g,g,g,g,q,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,h,h,h,h,h,h,m,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,h,q,b,x,x,x,x,b,b,b,b,a,b,b,h,b,b,x,x,g,g,b,a,b,b,b,g,a,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,a,a,a,a,a,a,a,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,a,b,b,b,b,b,b,b,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,f,p,f,p,p,f,p,p,f,p,b,b,b,b,b,b,b,b,f,f,f,f,f,f,
f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,b,b,b,b,b,f,f,f,f,f,b,b,b,b,b,b,b,b,b,b,b],[e,e,e,e,b,b,b,b,d,x,x,d,q,d,b,b,p,p,p,p,p,p,p,p,p,p,p,d,b,b,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,e,e,e,e,e,e,e,e,e,e,x,e,e,d,d,d,p,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,
d,d,d,d,d,d,p,p,p,p,p,p,p,e,b,p,p,p,p,p,p,d,d,p,p,b,p,p,p,p,d,d,g,g,g,g,g,g,g,g,g,g,d,d,d,d,d,d],[d,d,d,d,d,d,d,d,d,d,d,d,d,d,b,d,d,p,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,b,b,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,p,p,p,p,p,p,p,p,p,p,p,d,b,b,b,b,b,b,b,b,b,b,b,b,b,b,f,f,f,f,f,f,f,f,f,f,
f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,p,p,p,p,p,p,p,p,p,f,f,b,b,b,b,f,b,b,b,b,b],[l,l,l,l,l,l,l,l,l,l,l,h,h,h,a,f,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,l,m,z,r,w,n,u,q,x,x,x,x,x,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,l,h,h,h,h,h,b,b,b,b,b,h,h,h,h,h,h,g,a,b,b,g,g,g,g,g,g,v,v,b,b,b,a,g,g,g,g,g,g,g,g,g,g,v,v,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,b,b,b,b,b,b,b,b,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,b,b,b,b,b,f,p,f,f,f,f,f,f,f,f,f,f,v,f,f,f,f,f,f,f,f,f,f,f,f,f,b,f,f,f,f,f,b,f,b,f,f,b,f,f,b,f,f,f,f,f,f,f,f,f,f,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,
d,d,d,d,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d],[p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,p,p,p,p,p,p,p,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,b,q,b,b,q,b,b,b,b,b,b,b,b,b,x,b,b,v,v,b,b,b,b,b,x,x,b,b,b,b,b,d,d,d,d,d,b,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,
d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,b,b,h],[b,b,b,x,x,x,b,b,b,b,b,v,q,v,q,q,g,g,g,g,g,g,g,g,g,g,q,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,a,a,a,a,a,a,b,b,a,a,a,a,a,a,b,b,a,a,a,a,a,a,b,b,a,a,a,b,b,b,x,x,b,b,b,x,x,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]]})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(a,c,f,g){function e(a,b){void 0===b&&(b=!1);var d=f.WGLVVFlag.SIZE_FIELD_STOPS|f.WGLVVFlag.SIZE_MINMAX_VALUE|f.WGLVVFlag.SIZE_SCALE_STOPS|f.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(f.WGLVVTarget.FIELD_TARGETS_OUTLINE|
f.WGLVVTarget.MINMAX_TARGETS_OUTLINE|f.WGLVVTarget.SCALE_TARGETS_OUTLINE|f.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?d&a:d&~a}function b(a){var b=e(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|f.WGLVVFlag.ROTATION|b)}Object.defineProperty(c,"__esModule",{value:!0});c.getVVFlags=function(a){if(!a)return f.WGLVVFlag.NONE;for(var b=0,d=0;d<a.length;d++){var c=a[d];if("size"===c.type){var e=g.getTypeOfSizeVisualVariable(c),b=b|e;"outline"===c.target&&(b|=e<<4)}else"color"===c.type?b|=f.WGLVVFlag.COLOR:
"opacity"===c.type?b|=f.WGLVVFlag.OPACITY:"rotation"===c.type&&(b|=f.WGLVVFlag.ROTATION)}return b};c.getSizeFlagsMask=e;c.getMarkerVVFlags=b;c.getFillVVFlags=function(a){return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY)};c.getLineVVFlags=function(a,b){if(b)return b=e(a,!0),a&b;b=e(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|b)};c.getTextVVFlags=function(a){return b(a)};c.getLabelVVFlags=function(a){var b=e(a,!1);return a&b}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),
function(a,c,f,g,e,b){Object.defineProperty(c,"__esModule",{value:!0});var m=g.getLogger("esri.views.2d.engine.webgl");c.getTypeOfSizeVisualVariable=function(a){if(b.isNumber(a.minDataValue)&&b.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize)return e.WGLVVFlag.SIZE_MINMAX_VALUE;if((a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops))return e.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||
a.valueExpression&&"$view.scale"!==a.valueExpression)&&(Array.isArray(a.stops)||"levels"in a&&a.levels))return e.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit)return e.WGLVVFlag.SIZE_UNIT_VALUE;m.error(new f("mapview-bad-type","Found invalid size VisualVariable",a));return e.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}f(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return e.WGLGeometryType.LABEL};d.prototype.drawGeometry=function(a,d,c,e,f){var g=a.context,l=a.painter,n=a.state,m=a.rendererInfo,h=c.indexCount,p=c.indexFrom;c=k.LabelMaterialKey.load(c.materialKey);var t=c.mapAligned?1:0;if(t||!(1<=Math.abs(d.key.level-Math.round(100*a.displayLevel)/
100))){var q=b.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_zoomRangeAndEmpty",count:4,type:5121}]}),x=q.bufferLayouts,q=q.attributes;f=l.materialManager.getMaterialProgram(a,
c,"materials/label",q,f);e=this._getVAO(g,x,q,e);a.context.setStencilFunction(514,0,255);g.bindProgram(f);g.bindVAO(e);this._setSharedUniforms(f,a,d);l.textureManager.bindTextures(g,f,c,4);l=1===t?n.displayViewMat3:n.displayMat3;c.vvSizeMinMaxValue&&f.setUniform4fv("u_vvSizeMinMaxValue",m.vvSizeMinMaxValue);c.vvSizeScaleStops&&f.setUniform1f("u_vvSizeScaleStopsValue",m.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(d=m.getSizeVVFieldStops(d.key.level),f.setUniform1fv("u_vvSizeFieldStopsValues",d.values),
f.setUniform1fv("u_vvSizeFieldStopsSizes",d.sizes));c.vvSizeUnitValue&&f.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",m.vvSizeUnitValueToPixelsRatio);f.setUniform1f("u_mapRotation",Math.floor(n.rotation/360*254));f.setUniform1f("u_mapAligned",t);f.setUniformMatrix3fv("u_displayMat3",l);f.setUniform1f("u_opacity",1);f.setUniform1f("u_zoomLevel",Math.round(10*a.displayLevel));f.setUniform2fv("u_screenSize",a.state.size);g.drawElements(4,h,5125,4*p);g.bindVAO(null);g.setStencilTestEnabled(!0);
g.setBlendingEnabled(!0)}};return d}(m.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}f(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=
function(){return e.WGLGeometryType.LINE};d.prototype.drawGeometry=function(a,d,c,f,e){var g=a.context,l=a.painter,n=a.rendererInfo,m=a.requiredLevel,h=c.indexFrom,p=c.indexCount;c=k.LineMaterialKey.load(c.materialKey);var t=b.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",
count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),q=t.bufferLayouts,t=t.attributes;e=l.materialManager.getMaterialProgram(a,c,"materials/line",t,e);f=this._getVAO(g,q,t,f);q=1/a.pixelRatio;g.bindProgram(e);g.bindVAO(f);this._setSharedUniforms(e,a,d);c.textureBinding&&l.textureManager.bindTextures(g,e,c);e.setUniform1f("u_zoomFactor",Math.pow(2,m-d.key.level)/a.pixelRatio);e.setUniform1f("u_blur",
0+q);e.setUniform1f("u_antialiasing",q);c.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",n.vvSizeMinMaxValue);c.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",n.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(a=n.getSizeVVFieldStops(d.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",a.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));c.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",n.vvSizeUnitValueToPixelsRatio);c.vvColor&&(e.setUniform1fv("u_vvColorValues",
n.vvColorValues),e.setUniform4fv("u_vvColors",n.vvColors));c.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("u_vvOpacities",n.vvOpacities));g.setFaceCullingEnabled(!0);g.setFrontFace(2305);g.setCullFace(1029);g.drawElements(4,p,5125,4*h);g.setFaceCullingEnabled(!1);g.bindVAO(null)};return d}(m.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}f(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return b.WGLGeometryType.MARKER};c.prototype.drawGeometry=function(a,b,c,e,f){var g=a.context,k=a.painter,l=a.rendererInfo,h=a.state,p=c.indexCount,t=c.indexFrom;c=d.MarkerMaterialKey.load(c.materialKey);var q=m.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),r=q.bufferLayouts,q=q.attributes;f=k.materialManager.getMaterialProgram(a,c,"materials/icon",
q,f);e=this._getVAO(g,r,q,e);g.bindProgram(f);g.bindVAO(e);c.textureBinding&&k.textureManager.bindTextures(g,f,c,1);this._setSharedUniforms(f,a,b);f.setUniformMatrix3fv("u_displayMat3",c.vvRotation?h.displayViewMat3:h.displayMat3);c.vvSizeMinMaxValue&&f.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);c.vvSizeScaleStops&&f.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(a=l.getSizeVVFieldStops(b.key.level),f.setUniform1fv("u_vvSizeFieldStopsValues",a.values),
f.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));c.vvSizeUnitValue&&f.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);c.vvColor&&(f.setUniform1fv("u_vvColorValues",l.vvColorValues),f.setUniform4fv("u_vvColors",l.vvColors));c.vvOpacity&&(f.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),f.setUniform1fv("u_vvOpacities",l.vvOpacities));c.vvRotation&&f.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?0:1);g.drawElements(4,
p,5125,4*t);g.bindVAO(null)};return c}(k.default);c.default=a})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}f(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=
function(){return e.WGLGeometryType.TEXT};d.prototype.drawGeometry=function(a,d,c,f,e){var g=a.context,l=a.painter,n=a.rendererInfo,m=a.state,h=c.indexCount,p=c.indexFrom;c=k.TextMaterialKey.load(c.materialKey);var t=b.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texFontSize",count:4,
type:5121},{location:5,name:"a_aux",count:4,type:5120}]}),q=t.bufferLayouts,t=t.attributes;e=l.materialManager.getMaterialProgram(a,c,"materials/text",t,e);f=this._getVAO(g,q,t,f);g.bindProgram(e);g.bindVAO(f);this._setSharedUniforms(e,a,d);l.textureManager.bindTextures(g,e,c,4);e.setUniformMatrix3fv("u_displayMat3",m.displayMat3);c.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",n.vvSizeMinMaxValue);c.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",n.vvSizeScaleStopsValue);c.vvSizeFieldStops&&
(a=n.getSizeVVFieldStops(d.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",a.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));c.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",n.vvSizeUnitValueToPixelsRatio);c.vvColor&&(e.setUniform1fv("u_vvColorValues",n.vvColorValues),e.setUniform4fv("u_vvColors",n.vvColors));c.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),e.setUniform1fv("u_vvOpacities",n.vvOpacities));c.vvRotation&&e.setUniform1f("u_vvRotationType",
"geographic"===n.vvMaterialParameters.vvRotationType?0:1);g.drawElements(4,h,5125,4*p);g.bindVAO(null)};return d}(m.default);c.default=a})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(a,c,f,g,e){Object.defineProperty(c,"__esModule",{value:!0});var b=function(){return function(a,b,c){this.ratio=a;this.x=b;this.y=c}}();a=function(){function a(a,b,c,e,g){void 0===e&&(e=8);void 0===g&&(g=8);this.lines=[];this.starts=
[];this.pixelRatio=e;this.pixelMargin=g;this.tileSize=f.TILE_SIZE*e;this.dz=a;this.yPos=b;this.xPos=c}a.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,
b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new g.Point(a,b);this._firstPt=new g.Point(a,b);this._dist=0};a.prototype.lineTo=function(a,c){var d=this._isIn(a,c),e=new g.Point(a,c),f=g.Point.distance(this._prevPt,e),k,l,m;if(d)this._prevIsIn?this._lineTo(a,c,!0):(k=this._prevPt,l=e,a=this._intersect(l,k),this.start=this._dist+f*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,k=e,a=this._intersect(l,
k),this._lineTo(a.x,a.y,!0),this._lineTo(k.x,k.y,!1);else{var w=this._prevPt;if(!(w.x<=this.xmin&&e.x<=this.xmin||w.x>=this.xmax&&e.x>=this.xmax||w.y<=this.ymin&&e.y<=this.ymin||w.y>=this.ymax&&e.y>=this.ymax)){a=[];if(w.x<this.xmin&&e.x>this.xmin||w.x>this.xmin&&e.x<this.xmin)c=(this.xmin-w.x)/(e.x-w.x),m=w.y+c*(e.y-w.y),m<=this.ymin?l=!1:m>=this.ymax?l=!0:a.push(new b(c,this.xmin,m));if(w.x<this.xmax&&e.x>this.xmax||w.x>this.xmax&&e.x<this.xmax)c=(this.xmax-w.x)/(e.x-w.x),m=w.y+c*(e.y-w.y),m<=this.ymin?
l=!1:m>=this.ymax?l=!0:a.push(new b(c,this.xmax,m));if(w.y<this.ymin&&e.y>this.ymin||w.y>this.ymin&&e.y<this.ymin)c=(this.ymin-w.y)/(e.y-w.y),m=w.x+c*(e.x-w.x),m<=this.xmin?k=!1:m>=this.xmax?k=!0:a.push(new b(c,m,this.ymin));if(w.y<this.ymax&&e.y>this.ymax||w.y>this.ymax&&e.y<this.ymax)c=(this.ymax-w.y)/(e.y-w.y),m=w.x+c*(e.x-w.x),m<=this.xmin?k=!1:m>=this.xmax?k=!0:a.push(new b(c,m,this.ymax));if(0===a.length)k?l?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):l?this._lineTo(this.xmin,
this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+f*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+f*a[0].ratio,k=0;k<a.length;k++)this._lineTo(a[k].x,a[k].y,!0)}this._lineTo(e.x,e.y,!1)}this._dist+=f;this._prevIsIn=d;this._prevPt=e};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=
a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&m.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;
for(var c=[],e=0;e<b;e++)c.push({line:a[e],start:this.starts[e]||0});return c};a.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};a.prototype._intersect=function(a,b){var c,d,e;if(b.x>=this.xmin&&b.x<=this.xmax)d=b.y<=this.ymin?this.ymin:this.ymax,e=(d-a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),d=a.y+e*(b.y-a.y);else{d=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?
this.xmin:this.xmax;var f=(c-a.x)/(b.x-a.x),k=(d-a.y)/(b.y-a.y);f<k?(e=f,d=a.y+f*(b.y-a.y)):(e=k,c=a.x+k*(b.x-a.x))}this._r=e;return new g.Point(c,d)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};
a.prototype._moveTo=function(a,b,c){3!==this.type?c&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new g.Point(a,b))):(c||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new g.Point(a,b)),this._is_v=this._is_h=!1)};a.prototype._lineTo=
function(a,b,c){if(3!==this.type)if(c){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(c=this.line[this.line.length-1],c.equals(a,b)))return;this.line.push(new g.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(c||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-
(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){c=this.line[this.line.length-1];var d=c.x===a,e=c.y===b;d&&e||(this._is_h&&d?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(c=this.line[this.line.length-2],this._is_h=c.x===a,this._is_v=c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):this._is_v&&e?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?
this._is_v=this._is_h=!1:(c=this.line[this.line.length-2],this._is_h=c.x===a,this._is_v=c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):(this.line.push(new g.Point(a,b)),this._is_h=d,this._is_v=e))}else this.line.push(new g.Point(a,b))};return a}();c.TileClipper=a;a=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);
this.line=[];var c=this._ratio;this.line.push(new g.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.lineTo=function(a,b){var c=this._ratio;this.line.push(new g.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&m.simplify(4096,64,this.lines);return this.lines};return a}();c.SimpleBuilder=
a;var m=function(){function a(){}a.simplify=function(b,c,e){if(e){var d=-c,f=b+c,g=-c,k=b+c;b=[];c=[];for(var m=e.length,l=0;l<m;++l){var n=e[l];if(n&&!(2>n.length))for(var u=n[0],h=void 0,q=n.length,t=1;t<q;++t)h=n[t],u.x===h.x&&(u.x<=d&&(u.y>h.y?(b.push(l),b.push(t),b.push(0),b.push(-1)):(c.push(l),c.push(t),c.push(0),c.push(-1))),u.x>=f&&(u.y<h.y?(b.push(l),b.push(t),b.push(1),b.push(-1)):(c.push(l),c.push(t),c.push(1),c.push(-1)))),u.y===h.y&&(u.y<=g&&(u.x<h.x?(b.push(l),b.push(t),b.push(2),b.push(-1)):
(c.push(l),c.push(t),c.push(2),c.push(-1))),u.y>=k&&(u.x>h.x?(b.push(l),b.push(t),b.push(3),b.push(-1)):(c.push(l),c.push(t),c.push(3),c.push(-1)))),u=h}0!==b.length&&0!==c.length&&(a.fillParent(e,c,b),a.fillParent(e,b,c),d=[],a.calcDeltas(d,c,b),a.calcDeltas(d,b,c),a.addDeltas(d,e))}};a.fillParent=function(a,b,c){for(var d=c.length,f=b.length,g=0;g<f;g+=4){for(var k=b[g],m=b[g+1],l=b[g+2],n=a[k][m-1],k=a[k][m],m=8092,u=-1,h=0;h<d;h+=4)if(c[h+2]===l){var q=c[h],t=c[h+1],A=a[q][t-1],q=a[q][t];switch(l){case 0:case 1:e.between(n.y,
A.y,q.y)&&e.between(k.y,A.y,q.y)&&(A=Math.abs(q.y-A.y),A<m&&(m=A,u=h));break;case 2:case 3:e.between(n.x,A.x,q.x)&&e.between(k.x,A.x,q.x)&&(A=Math.abs(q.x-A.x),A<m&&(m=A,u=h))}}b[g+3]=u}};a.calcDeltas=function(b,c,e){for(var d=c.length,f=0;f<d;f+=4){var g=a.calcDelta(f,c,e,[]);b.push(c[f]);b.push(c[f+1]);b.push(c[f+2]);b.push(g)}};a.calcDelta=function(b,c,e,f){b=c[b+3];if(-1===b)return 0;var d=f.length;if(1<d&&f[d-2]===b)return 0;f.push(b);return a.calcDelta(b,e,c,f)+1};a.addDeltas=function(a,b){for(var c=
a.length,d=0,e=0;e<c;e+=4){var f=a[e+3];f>d&&(d=f)}for(e=0;e<c;e+=4){var g=b[a[e]],k=a[e+1],f=d-a[e+3];switch(a[e+2]){case 0:g[k-1].x-=f;g[k].x-=f;1===k&&(g[g.length-1].x-=f);k===g.length-1&&(g[0].x-=f);break;case 1:g[k-1].x+=f;g[k].x+=f;1===k&&(g[g.length-1].x+=f);k===g.length-1&&(g[0].x+=f);break;case 2:g[k-1].y-=f;g[k].y-=f;1===k&&(g[g.length-1].y-=f);k===g.length-1&&(g[0].y-=f);break;case 3:g[k-1].y+=f,g[k].y+=f,1===k&&(g[g.length-1].y+=f),k===g.length-1&&(g[0].y+=f)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require",
"exports","../../../../symbols/cim/enums","./mesh/templates/util"],function(a,c,f,g){function e(){if(h.cosine<v.innerBisectorAutoSplitThreshold){h.splitInner=!0;h.gapInner=!0;var a=Math.max(v.innerBisectorAutoSplitThreshold,h.cosine),a=Math.sqrt(1-a*a)/a;h.leftInner.x=h.nextNormal.x+h.sign*a*h.outbound.x;h.leftInner.y=h.nextNormal.y+h.sign*a*h.outbound.y;h.rightInner.x=h.prevNormal.x-h.sign*a*h.inbound.x;h.rightInner.y=h.prevNormal.y-h.sign*a*h.inbound.y}else v.enableInnerBisectorSplit&&(h.splitInner=
!0,h.gapInner=!1,h.leftInner.x=h.rightInner.x=h.bisector.x/h.cosine,h.leftInner.y=h.rightInner.y=h.bisector.y/h.cosine);h.cosine<v.outerBisectorAutoSplitThreshold?(h.splitOuter=!0,h.gapOuter=!0,a=Math.max(v.outerBisectorAutoSplitThreshold,h.cosine),a=Math.sqrt(1-a*a)/a,h.leftOuter.x=h.prevNormal.x-h.sign*a*h.inbound.x,h.leftOuter.y=h.prevNormal.y-h.sign*a*h.inbound.y,h.rightOuter.x=h.nextNormal.x+h.sign*a*h.outbound.x,h.rightOuter.y=h.nextNormal.y+h.sign*a*h.outbound.y):v.enableOuterBisectorSplit&&
(h.splitOuter=!0,h.gapOuter=!1,h.leftOuter.x=h.rightOuter.x=h.bisector.x/h.cosine,h.leftOuter.y=h.rightOuter.y=h.bisector.y/h.cosine)}function b(){if(w)h.distance=0,w=h.isCap=h.isFirstVertex=h.isLastVertex=!1;else{if(0===z)if(h.isFirstVertex=0===p,u=q[p],0===p){if(z=0,h.closed){h.inbound.x=u.x-q[q.length-2].x;h.inbound.y=u.y-q[q.length-2].y;var a=Math.sqrt(h.inbound.x*h.inbound.x+h.inbound.y*h.inbound.y);h.inbound.x/=a;h.inbound.y/=a}}else h.inbound.x=u.x-n.x,h.inbound.y=u.y-n.y,z=Math.sqrt(h.inbound.x*
h.inbound.x+h.inbound.y*h.inbound.y),h.inbound.x/=z,h.inbound.y/=z;h.distance+z-r<=v.wrapDistance?(p<q.length-1?(h.outbound.x=q[p+1].x-u.x,h.outbound.y=q[p+1].y-u.y,a=Math.sqrt(h.outbound.x*h.outbound.x+h.outbound.y*h.outbound.y),h.outbound.x/=a,h.outbound.y/=a):h.closed?(h.outbound.x=q[1].x-u.x,h.outbound.y=q[1].y-u.y,a=Math.sqrt(h.outbound.x*h.outbound.x+h.outbound.y*h.outbound.y),h.outbound.x/=a,h.outbound.y/=a):(h.outbound.x=h.inbound.x,h.outbound.y=h.inbound.y),0!==p||h.closed||(h.inbound.x=
h.outbound.x,h.inbound.y=h.outbound.y),++p,h.isLastVertex=p===q.length,h.isCap=!h.closed&&(h.isFirstVertex||h.isLastVertex),h.distance+=z-r,r=z=0,w=h.distance+z-r===v.wrapDistance,h.currentVertex.x=u.x,h.currentVertex.y=u.y,n=u,u=null):(h.outbound.x=h.inbound.x,h.outbound.y=h.inbound.y,r+=v.wrapDistance-h.distance,h.distance=v.wrapDistance,w=!0,a=r/z,h.currentVertex.x=(1-a)*n.x+a*u.x,h.currentVertex.y=(1-a)*n.y+a*u.y)}}function m(){h.prevNormal.x=-h.inbound.y;h.prevNormal.y=h.inbound.x;h.nextNormal.x=
-h.outbound.y;h.nextNormal.y=h.outbound.x}function k(){m();h.bisector.x=h.prevNormal.x+h.nextNormal.x;h.bisector.y=h.prevNormal.y+h.nextNormal.y;var a=Math.sqrt(h.bisector.x*h.bisector.x+h.bisector.y*h.bisector.y);.001>a?(h.bisector.x=void 0,h.bisector.y=void 0,h.cosine=0,h.sign=void 0):(h.bisector.x/=a,h.bisector.y/=a,h.cosine=h.bisector.x*h.nextNormal.x+h.bisector.y*h.nextNormal.y,h.sign=0<=h.prevNormal.x*h.nextNormal.y-h.prevNormal.y*h.nextNormal.x?1:-1)}function d(a){x.vertex(h);1===a?(h.leftEntry0=
h.entry0,h.leftEntry1=h.entry1,h.leftEntry2=h.entry2,h.leftExit0=h.exit0,h.leftExit1=h.exit1,h.leftExit2=h.exit2):2===a&&(h.rightEntry0=h.entry0,h.rightEntry1=h.entry1,h.rightEntry2=h.entry2,h.rightExit0=h.exit0,h.rightExit1=h.exit1,h.rightExit2=h.exit2)}function l(a){x.vertex(h);1===a?(h.leftEntry0=h.entry0,h.leftEntry2=h.entry2,h.leftExit0=h.exit0,h.leftExit2=h.exit2):2===a&&(h.rightEntry0=h.entry0,h.rightEntry2=h.entry2,h.rightExit0=h.exit0,h.rightExit2=h.exit2)}Object.defineProperty(c,"__esModule",
{value:!0});a=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();c.TessellationState=a;c.tessellate=
function(a,c,e){v.trackDistance=null!=c.trackDistance?c.trackDistance:!1;v.wrapDistance=null!=c.wrapDistance?c.wrapDistance:65535;v.thin=null!=c.thin?c.thin:!1;v.initialDistance=null!=c.initialDistance?c.initialDistance:0;v.enableOuterBisectorSplit=null!=c.enableOuterBisectorSplit?c.enableOuterBisectorSplit:!1;v.outerBisectorAutoSplitThreshold=null!=c.outerBisectorAutoSplitThreshold?c.outerBisectorAutoSplitThreshold:0;v.enableInnerBisectorSplit=null!=c.enableOuterBisectorSplit?c.enableOuterBisectorSplit:
!1;v.innerBisectorAutoSplitThreshold=null!=c.innerBisectorAutoSplitThreshold?c.innerBisectorAutoSplitThreshold:0;q=a;x=e;r=z=p=0;w=!1;u=n=null;h.currentVertex.x=null;h.currentVertex.y=null;h.distance=v.initialDistance;a=q[0];c=q[q.length-1];h.canSplit=!1;h.closed=a.x===c.x&&a.y===c.y;if(!(2>q.length||2===q.length&&h.closed))if(v.thin)if(v.trackDistance)for(b(),m(),l(1);z-r>v.wrapDistance||p<q.length;)b(),m(),l(2),x.bridge(h),h.leftExit0=h.rightExit0,h.leftExit2=h.rightExit2;else for(;p<q.length;)0<
p&&(h.inbound.x=h.outbound.x,h.inbound.y=h.outbound.y),p<q.length-1?(h.outbound.x=q[p+1].x-q[p].x,h.outbound.y=q[p+1].y-q[p].y,a=Math.sqrt(h.outbound.x*h.outbound.x+h.outbound.y*h.outbound.y),h.distance+=a,h.outbound.x/=a,h.outbound.y/=a):(h.outbound.x=h.inbound.x,h.outbound.y=h.inbound.y),0===p&&(h.inbound.x=h.outbound.x,h.inbound.y=h.outbound.y),h.currentVertex.x=q[p].x,h.currentVertex.y=q[p].y,h.prevNormal.x=-h.inbound.y,h.prevNormal.y=h.inbound.x,h.nextNormal.x=-h.outbound.y,h.nextNormal.y=h.outbound.x,
0===p?(x.vertex(h),h.leftEntry0=h.entry0,h.leftEntry2=h.entry2,h.leftExit0=h.exit0,h.leftExit2=h.exit2):(x.vertex(h),h.rightEntry0=h.entry0,h.rightEntry2=h.entry2,h.rightExit0=h.exit0,h.rightExit2=h.exit2,x.bridge(h),h.leftExit0=h.rightExit0,h.leftExit2=h.rightExit2),++p;else{if(v.enableOuterBisectorSplit||0<v.outerBisectorAutoSplitThreshold||v.enableInnerBisectorSplit||0<v.innerBisectorAutoSplitThreshold)for(h.canSplit=!0,b(),k(),h.splitInner=h.gapInner=h.splitOuter=h.gapOuter=!1,d(1),h.closure0=
h.leftEntry0,h.closure1=h.leftEntry1,h.closure2=h.leftEntry2;z-r>v.wrapDistance||p<q.length-1||p<q.length&&(!h.closed||v.trackDistance);)b(),k(),h.splitInner=h.gapInner=h.splitOuter=h.gapOuter=!1,d(2),x.bridge(h),h.leftExit0=h.rightExit0,h.leftExit1=h.rightExit1,h.leftExit2=h.rightExit2;else for(b(),k(),d(1),h.closure0=h.leftEntry0,h.closure1=h.leftEntry1,h.closure2=h.leftEntry2;z-r>v.wrapDistance||p<q.length-1||p<q.length&&(!h.closed||v.trackDistance);)b(),k(),d(2),x.bridge(h),h.leftExit0=h.rightExit0,
h.leftExit1=h.rightExit1,h.leftExit2=h.rightExit2;h.closed&&!v.trackDistance&&(h.rightEntry0=h.closure0,h.rightEntry1=h.closure1,h.rightEntry2=h.closure2,x.bridge(h),h.leftExit0=h.rightExit0,h.leftExit1=h.rightExit1,h.leftExit2=h.rightExit2)}};c.cleanup=function(){x=q=null};c.splitVertex=e;var q,v={},x,p=void 0,z,r,w,n,u,h=new a;a=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=f.CapType.BUTT;this.joinType=f.JoinType.MITER;this.miterLimitCosine=g.getLimitCosine(2);
this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=this.textured=!1}a.prototype.vertex=function(a){var b=this.joinType===f.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,c=a.isCap&&this.capType!==f.CapType.BUTT,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(e(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/
a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,
a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=
this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&this.joinType!==
f.JoinType.ROUND)this.writeTriangle(b,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&this.capType===f.CapType.ROUND||d&&this.joinType===f.JoinType.ROUND){var g=d=c=void 0,h=void 0,k=void 0,n=void 0;if(a.isCap){var m=Math.PI,k=Math.ceil(m/this.radsPerSlice),n=m/k;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,g=a.entry0,h=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,g=a.exit2,h=a.exit0)}else m=2*Math.acos(a.cosine),k=Math.ceil(m/this.radsPerSlice),n=m/k,c=0<a.sign?
-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,g=0<a.sign?a.entry2:a.exit0,h=0<a.sign?a.exit2:a.entry0;for(var m=Math.cos(n),n=Math.sin(n),l=n*c+m*d,c=m*c-n*d,d=l,p,l=void 0,u=0;u<k;++u)p=l,u<k-1&&(l=a.isCap?this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===u?g:p,b,u===k-1?h:l),p=n*c+m*d,c=m*c-n*d,d=p}else c&&this.capType===
f.CapType.SQUARE&&(c=a.isFirstVertex?1:-1,g=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,-c,-1,a.distance),g=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),g=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),0<c?(this.writeTriangle(b,a.entry2,g),this.writeTriangle(b,g,d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,g,a.exit2),this.writeTriangle(b,d,g),this.writeTriangle(b,a.exit0,d)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?
a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();c.StandardTessellationCallbacks=a;a=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,
a.rightEntry2,a.leftExit2)};return a}();c.ThinTessellationCallbacks=a})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=b.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");c.createMatcher=
function(a,b,c){return g(this,void 0,void 0,function(){return f(this,function(d){if(!c)return[2,new m.GraphicMatcher(a)];switch(c.type){case "simple":case "dot-density":return[2,m.FeatureMatcher.fromBasicRenderer(c,a,b)];case "unique-value":return[2,m.MapMatcher.fromUVRenderer(c,a,b)];case "class-breaks":return[2,m.IntervalMatcher.fromCBRenderer(c,a,b)];case "dictionary":return[2,m.DictionaryMatcher.fromDictionaryRenderer(c,a,b)];default:return k.error(new e("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),
[2,null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/support/cimSymbolUtils ../../../arcade/utils".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x){function p(a,b){return e(this,void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return c=a||1,"number"===typeof c?[2,function(a,b,d){return c}]:[4,q.createRendererExpression(c,b.spatialReference,b.fields)];case 1:return d=e.sent(),[2,function(a,c,e){return x.callWithFeature(d,a,{$view:e},b.geometryType,c)||1}]}})})}Object.defineProperty(c,"__esModule",{value:!0});var z=k.getLogger("esri/views/2d/engine/webgl/util/Matcher");a=function(){function a(){this._defaultResult=
null}a.fromBasicRenderer=function(b,c,d){return e(this,void 0,void 0,function(){var e,f,k;return g(this,function(g){switch(g.label){case 0:return[4,v.expandSymbols(b.getSymbols(),b,d)];case 1:return e=g.sent(),f=new a,e.length?[4,c.createTemplateGroup(e[0],null,b)]:[3,3];case 2:k=g.sent(),f.setDefault(k),g.label=3;case 3:return[2,f]}})})};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=
function(a,b,c,d,e){return this.getDefault()};a.prototype.analyze=function(a,b,c,d,f){return e(this,void 0,void 0,function(){return g(this,function(a){return[2]})})};return a}();c.FeatureMatcher=a;k=function(a){function b(b,c,d,e){var f=a.call(this)||this;f._intervals=[];f._isMaxInclusive=c;e?f._getValue=x.callWithFeature.bind(null,e):b&&b.length?"function"===typeof b?(f._field=null,f._getValue=b):(f._field=b,f._normalizationInfo=d,f._getValue=f._getValueFromField.bind(f)):f._field=null;return f}
f(b,a);b.fromCBRenderer=function(a,c,d){return e(this,void 0,void 0,function(){var f,h,k,n,m,p,u,w,r,x,z,F,H,M=this;return g(this,function(t){switch(t.label){case 0:return f=a.isMaxInclusive,h=a.normalizationField,k=a.normalizationTotal,n=a.normalizationType,m=a.field,p={normalizationField:h,normalizationTotal:k,normalizationType:n},(r=u=a.valueExpression)?[4,q.createRendererExpression(u,d.spatialReference,d.fields)]:[3,2];case 1:r=t.sent(),t.label=2;case 2:return w=r,x=new b(m,f,p,w),[4,v.expandSymbol(a.backgroundFillSymbol,
a,d)];case 3:return z=t.sent(),[4,l.all(a.classBreakInfos.map(function(b){return e(M,void 0,void 0,function(){var e,f,h;return g(this,function(g){switch(g.label){case 0:return[4,v.expandSymbol(b.symbol,a,d)];case 1:return e=g.sent(),[4,c.createTemplateGroup(e,z,a)];case 2:return f=g.sent(),h={min:b.minValue,max:b.maxValue},x.add(h,f),[2]}})})}))];case 4:return t.sent(),[4,v.expandSymbol(a.defaultSymbol,a,d)];case 5:return(F=t.sent())?[4,c.createTemplateGroup(F,z,a)]:[3,7];case 6:H=t.sent(),x.setDefault(H),
t.label=7;case 7:return[2,x]}})})};b.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};b.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++)if(d=this._intervals[b],
c=d.interval,d=d.result,e=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&e)return d;return this.getDefault()};b.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};b.prototype._getValueFromField=function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;var c=this._normalizationInfo,d=c.normalizationField,e=c.normalizationTotal,c=c.normalizationType;a=!!d&&a.attributes[d];if(c)switch(c){case "field":return(a||
void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/e*100;default:z.error("Found unknown normalization type: "+c)}else z.error("Normalization is required, but no type was set!")};return b}(a);c.IntervalMatcher=k;k=function(a){function b(b,c,d){var e=a.call(this)||this;e._nullResult=null;e._resultsMap=new Map;d?e._getValue=x.callWithFeature.bind(null,d):b&&b.length?"function"===typeof b[0]?(e._fields=null,e._getValue=b[0]):(e._fields=b,e._seperator=c||"",e._getValue=
e._getValueFromFields.bind(e)):e._fields=null;return e}f(b,a);b.fromUVRenderer=function(a,c,d){return e(this,void 0,void 0,function(){var f,h,k,m,n,p,u,r,w,x,z=this;return g(this,function(t){switch(t.label){case 0:return f=a.uniqueValueInfos,h=a.fieldDelimiter,k=[a.field],m=a.valueExpression,a.field2&&k.push(a.field2),a.field3&&k.push(a.field3),[4,v.expandSymbol(a.backgroundFillSymbol,a,d)];case 1:return n=t.sent(),(u=m)?[4,q.createRendererExpression(m,d.spatialReference,d.fields)]:[3,3];case 2:u=
t.sent(),t.label=3;case 3:return p=u,r=new b(k,h,p),[4,l.all(f.map(function(b){return e(z,void 0,void 0,function(){var e,f;return g(this,function(g){switch(g.label){case 0:return[4,v.expandSymbol(b.symbol,a,d)];case 1:return e=g.sent(),[4,c.createTemplateGroup(e,n,a)];case 2:return f=g.sent(),"\x3cNull\x3e"===b.value?r.setNullResult(f):r.add(b.value,f),[2]}})})}))];case 4:return t.sent(),[4,v.expandSymbol(a.defaultSymbol,a,d)];case 5:return(w=t.sent())?[4,c.createTemplateGroup(a.defaultSymbol,n,a)]:
[3,7];case 6:x=t.sent(),r.setDefault(x),t.label=7;case 7:return[2,r]}})})};b.prototype.setNullResult=function(a){this._nullResult=a};b.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(null!==this._nullResult&&(null==a||""===a||"\x3cNull\x3e"===a))return this._nullResult;if(!a&&null==
a)return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=function(a){for(var b=[],c=0,d=this._fields;c<d.length;c++)b.push(a.attributes[d[c]]);return b.join(this._seperator)};return b}(a);c.MapMatcher=k;k=function(a){function c(b,c,d,e){var f=a.call(this)||this;f._fidToAttributeHash=new Map;f._attributeHashToGroup=new Map;f._renderer=b;f._fieldMap=b.fieldMap;f._templates=c;f._info=d;f._scaleFn=e;return f}f(c,
a);c.fromDictionaryRenderer=function(a,b,d){return e(this,void 0,void 0,function(){var e;return g(this,function(f){switch(f.label){case 0:return a.fetchResources({spatialReference:d.spatialReference,fields:d.fields}),[4,p(a.scaleExpression,d)];case 1:return e=f.sent(),[2,new c(a,b,d,e)]}})})};c.prototype._analyzeFeature=function(a,c,d,f,k){return e(this,void 0,void 0,function(){var e,h,l,n,p,u,t,q,r,w,x,y;return g(this,function(g){switch(g.label){case 0:e=a.attributes[c];h=this._fidToAttributeHash.get(e);
l=this._hashAttributes(a);if(h===l)return[2];this._fidToAttributeHash.set(e,l);if(n=this._attributeHashToGroup.has(l))return[3,5];p=b({},f,{spatialReference:this._info.spatialReference,abortOptions:k,fields:this._info.fields});return[4,this._scaleFn(a,d,f)];case 1:return u=g.sent(),[4,this._renderer.getSymbolAsync(a,p)];case 2:return t=g.sent(),[4,v.expandSymbol(t,this._renderer,this._info,k)];case 3:q=g.sent();if("expanded-cim"!==q.type)return z.error(new m("mapview-bad-type","Found unexpected type "+
q.type+" in dictionary response")),[2];r=0;for(w=q.layers;r<w.length;r++)x=w[r],x.scaleFactor=u,x.templateHash+="-"+u;return[4,this._templates.createTemplateGroup(q,null,this._renderer)];case 4:y=g.sent(),this._attributeHashToGroup.set(l,y),g.label=5;case 5:return[2]}})})};c.prototype.analyze=function(a,b,c,d,f){return e(this,void 0,void 0,function(){var e,h=this;return g(this,function(g){switch(g.label){case 0:return e=b.map(function(b){return h._analyzeFeature(b,a,c,d,f)}),[4,l.all(e)];case 1:return g.sent(),
[2]}})})};c.prototype.match=function(a,b){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};c.prototype._hashAttributes=function(a){var b="",c;for(c in this._fieldMap)b+=". "+a.attributes[this._fieldMap[c]];return b};return c}(a);c.DictionaryMatcher=k;a=function(a){function b(b){var c=a.call(this)||this;c._templates=b;return c}f(b,a);b.prototype.match=function(a,b){return d.isNone(b.symbol)?0:b.groupId?b.groupId:this._templates.createTemplateGroup(b.symbol,
null,null)};return b}(a);c.GraphicMatcher=a})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u,h,y){Object.defineProperty(c,"__esModule",{value:!0});var t=k.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),A={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};a=function(){function a(a,b,c,e,f,g){this._isDD=!1;this._labelsDebugTemplate=
null;this._isDD=d.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._templateStore=e;this._setLabelTemplates(f,c,g)}a.prototype.update=function(a,b,c){this._isDD=d.isSome(b)&&"dot-density"===b.type;this._setLabelTemplates(a,b,c)};a.prototype._setLabelTemplates=function(a,b,c){a&&this._validateLabelingInfo(a)&&(this._labelTemplates=a.map(function(a){return n.default.fromLabelClass(b,a,c)}))};Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},
enumerable:!0,configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?x.HEURISTIC_GLYPHS_PER_LINE:x.HEURISTIC_GLYPHS_PER_FEATURE;b[p.WGLGeometryType.MARKER]=new w.VertexVectors(p.WGLGeometryType.MARKER,a);b[p.WGLGeometryType.FILL]=new w.VertexVectors(p.WGLGeometryType.FILL,a,this._isDD);b[p.WGLGeometryType.LINE]=new w.VertexVectors(p.WGLGeometryType.LINE,a);b[p.WGLGeometryType.TEXT]=
new w.VertexVectors(p.WGLGeometryType.TEXT,a);b[p.WGLGeometryType.LABEL]=new w.VertexVectors(p.WGLGeometryType.LABEL,c?d:0);return new r.MeshData([],b)};a.prototype.analyze=function(a,b,c,f,h){return e(this,void 0,void 0,function(){var e,k,m,n,p,u,q,t,r;return g(this,function(g){switch(g.label){case 0:return e=a,l.isAborted(h)?[2,[]]:d.isSome(b)?[4,b.analyze(this._idField,a,c,f,h)]:[3,2];case 1:g.sent(),g.label=2;case 2:k=0;for(m=e;k<m.length;k++){n=m[k];p=n.groupId;if(null==p||-1===p)p=b.match(this._idField,
n,this._geometryType,c,f);if(y.isDynamicId(p))for(u=this._templateStore.getDynamicTemplateGroup(p),q=0,t=u;q<t.length;q++)(r=t[q])&&r.analyze&&r.analyze(this._templateStore,n,c,f);n.groupId=p}return[2,this._templateStore.finalize(h).then(function(){return e})]}})})};a.prototype.write=function(a,b,c,d,e,f,g){var h=this._templateStore.getTemplateGroup(b.groupId),k=b.localId;if(null!=k){var m=new z(k),l=!!f&&!!this._labelTemplates&&f.has(k);if(y.isDynamicId(b.groupId))for(var n=0;n<h.length;n++){var p=
h[n];p.bindFeature(b,c,d)}if(h&&(b.geometry||b.centroid)){d=m.displayRecords;p=b.insertAfter;void 0!==p&&(m.insertAfter=p);(c=this._geometryType)||(c=null!=b.centroid?"esriGeometryPolygon":q.getJsonType(b.geometry));for(n=0;n<h.length;n++){var p=h[n],u=a.get(p.geometryType);p.writeMesh(d,u,c,k,b)}l&&(h=this._getLabelReference(h),f=f.get(k),this._writeLabelMesh(m,a,k,b,g,f,h,e,c));a.pushDisplayObject(m)}}};a.prototype._hasBadLabelClass=function(a,c){var d=a.labelPlacement,e=A[c];if(!a.symbol)return t.warn("No LabelClass symbol specified."),
!0;if(!e)return t.error(new b("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+c+" is not supported")),!0;e.some(function(a){return a===d})||(e=e[0],d&&t.warn("Found invalid label placement type "+d+" for "+c+". Defaulting to "+e),a.labelPlacement=e);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,b._geometryType)})};a.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=
a[b];if(c instanceof h.default)return c}return null};a.prototype._writeLabelMesh=function(a,b,c,d,e,f,g,h,k){for(var m=a.displayRecords,l=[],n=0;n<f.length;n++){var p=f[n],u=p.text,q=p.rtl,p=this._labelTemplates[p.id],t=b.get(p.geometryType),r=e.get(p.symbolId).glyphMosaicItems;p.bindReferenceTemplate(g);p.bindTextInfo(r,u,q);p.writeMesh(m,t,k,c,d,h,l)}a.metrics=l;x.DEBUG_LABELS&&this._debugLabels(a,b)};a.prototype._debugLabels=function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var f=
a[e],g=0,h=f.boxes?f.boxes.concat([f.bounds]):[f.bounds];g<h.length;g++){var k=h[g],k={geometry:{paths:[[[f.anchor[0]+f.offsetX+k.center[0]-k.width/2,f.anchor[1]+f.offsetY+k.center[1]+k.height/2],[0,-k.height],[k.width,0],[0,k.height],[-k.width,0]]]},attributes:{}},m=this._getLabelDebugTemplate(),l=b.get(m.geometryType);m.writeMesh(c,l,"esriGeometryPolyline",d,k)}};a.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());
return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new v({style:"solid",width:1,color:[255,0,0,1]});return u.default.fromSimpleLine(null,!1,a,null,!1)};return a}();c.WGLMeshFactory=a})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(a,c,f,g,e){return function(){function a(a){this.insertAfter=null;this.id=a;this.displayRecords=[];this.metrics=
[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.clone=function(){var b=new a(this.id);b.displayRecords=this.displayRecords.map(function(a){return a.clone()});b.metrics=this.metrics.map(function(a){return a.clone()});b.insertAfter=this.insertAfter;return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=function(a){a.push(this.id);e.serializeList(a,this.metrics);
e.serializeList(a,this.displayRecords);return a};a.deserialize=function(b){var c=b.readInt32(),d=new a(c),c={id:c},m=e.deserializeList(b,g.default);m.length&&(d.metrics=m);d.displayRecords=e.deserializeList(b,f,c);return d};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,c){this.displayObjects=a;this.vertexVectorsMap=
c}Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};a.prototype.encode=function(a,c){var b=f.serializeList(new g.default(Uint32Array,
this._guessSize()),this.displayObjects).buffer(),d={};c.push(b);for(var e=0;e<this.vertexVectorsMap.length;e++){var m=this.vertexVectorsMap[e];d[e]={};m.transfer(d[e],c)}a.displayObjects=b;a.vertexBuffersMap=d;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,c=Math.min(a.length,4),e=0,d=0;d<c;d++)e=Math.max(e,a[d].displayRecords.length);return 2*(12*a.length+a.length*e*40)};return a}();c.MeshData=
a})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a,c){this._pos=0;c=c?this._roundToNearest(c,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(c);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});a.prototype._roundToNearest=function(a,c){a=Math.round(a);return a+(c-a%c)};
a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=this._roundToNearest(1.5*(this._array.byteLength+a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var c=new this._ctor(a);c.set(this._buffer,0);this._array=a;this._buffer=c}};a.prototype.writeF32=function(a){this._ensureSize(1);var c=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return c};a.prototype.push=function(a){this._ensureSize(1);var c=this._pos;this._buffer[this._pos++]=
a;return c};a.prototype.writeRegion=function(a){this._ensureSize(a.length);var c=this._pos;this._buffer.set(a,this._pos);this._pos+=a.length;return c};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.seek=function(a){this._pos=a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();c.default=a})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils","./VertexBuffer","../util/Writer"],
function(a,c,f,g,e){Object.defineProperty(c,"__esModule",{value:!0});var b=function(){function a(a,b){this.data=a;this.stride=b}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,b){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;b.push(c)};return a}();c.default=b;a=function(){function a(a,c,g){void 0===g&&(g=!1);this.geometryType=a;this.indexVector=
new e.default(Uint32Array,c);this.namedVectors={};a=f.getStrides(a,g);for(var d in a){g=a[d];var k=void 0;switch(g%4){case 0:case 2:k=new e.default(Uint32Array,g/4*c);break;case 1:case 3:k=new e.default(Uint8Array,g*c)}this.namedVectors[d]=new b(k,g)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.getVector=function(a){return this.namedVectors[a]};a.prototype.transfer=function(a,b){var c=this.indexVector.buffer(),d={};b.push(c);for(var e in this.namedVectors){var f=this.namedVectors[e];
d[e]={};f.transfer(d[e],b)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=d;this.destroy()};a.prototype.intoBuffers=function(){var a=g.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();c.VertexVectors=a})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,
c,e){this.data=a;this.stride=c;this.vertexCount=e}a.decode=function(b){var c=f.allocateTypedArrayBufferwithData(b.data,b.stride);return new a(c,b.stride,b.vertexCount)};a.fromVertexVector=function(b){var c=f.allocateTypedArrayBufferwithData(b.data.buffer(),b.stride);return new a(c,b.stride,b.vertexCount)};return a}();c.default=g;a=function(){function a(a,c,e){this.geometryType=a;this.indexBuffer=new Uint32Array(c);this.namedBuffers=e}a.decode=function(b){var c=b.geometryType,e=b.indexBuffer,d={},
f;for(f in b.namedBuffers)d[f]=g.decode(b.namedBuffers[f]);return new a(c,e,d)};a.fromVertexVectors=function(b){var c=b.geometryType,e=b.indexVector.buffer(),d={},f;for(f in b.namedVectors)d[f]=g.fromVertexVector(b.namedVectors[f]);return new a(c,e,d)};return a}();c.VertexBuffers=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x){Object.defineProperty(c,"__esModule",{value:!0});var p=g.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");a=function(a){function c(b,c,d,e,f,g,k,m,p,r,x,v,z,G,N,F){var h=a.call(this)||this;b=l.LineMaterialKey.load(l.createMaterialKey(h.geometryType,b,z));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);h._capType=e;h._joinType=f;h._miterLimitCosine=q.getLimitCosine(g);h.tessellationProperties._fillColor=k;h.tessellationProperties._tl=m;h.tessellationProperties._br=
p;h._hasPattern=r;h._isDashed=x;h._joinOnUTurn=F;h._isColorLocked=v;h._isOutline=z;h._zOrder=N;h._materialKey=b.data;h.tessellationProperties._bitset=v?1:0;h.tessellationProperties._halfWidth=.5*d;h.tessellationProperties._halfReferenceWidth=.5*G;h._initializeTessellator(!1);return h}f(c,a);c.fromCIMLine=function(a,d,f,g,l){var h=d.color,n=d.scaleFactor||1,p=d.isDashed,u=d.cap;p&&u===b.CapType.ROUND&&(u=b.CapType.SQUARE);var q=d.join,n=e.pt2px(d.width)*n,r=e.pt2px(d.referenceWidth),w=e.pt2px(d.miterLimit),
h=h&&m.premultiplyAlphaRGBA(h)||0;if(!f)return new c(a,f,n,u,q,w,h,0,0,!1,p,d.colorLocked,g,r,d.zOrder,l);var x=f.rect,v=x.x+1+f.width,y=x.y+1+f.height,x=k.i1616to32(x.x+1,x.y+1),v=k.i1616to32(v,y);return new c(a,f,n,u,q,w,h,x,v,!0,p,d.colorLocked,g,r,d.zOrder,l)};c.fromSimpleLine=function(a,b,f,g,l){var h=f.color,n="solid"!==f.style&&"none"!==f.style,p=d.getCapType(f.cap||"round",n),u=d.getJoinType(f.join||"round"),h=h&&"none"!==f.style&&m.premultiplyAlphaRGBA(h)||0;"none"===f.style&&(h=0);var q=
e.pt2px(f.width);f=f.miterLimit;if(!g)return new c(a,g,q,p,u,f,h,0,0,!1,n,!1,b,q,0,l);var r=g.rect,w=r.x+1+g.width,x=r.y+1+g.height,r=k.i1616to32(r.x+1,r.y+1),w=k.i1616to32(w,x);return new c(a,g,q,p,u,f,h,r,w,!0,n,!1,b,q,0,l)};c.fromPictureLineSymbol=function(a,b,c,d){p.error("PictureLineSymbol support does not exist!");return null};return c}(v.default(x.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v){Object.defineProperty(c,"__esModule",{value:!0});var x=e.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),p=b.TILE_SIZE+16,z=1/3.8,r=new d.TileClipper(0,0,0,1,16);r.setExtent(b.TILE_SIZE);var w=new Uint32Array(9),n=new Uint32Array(36),u=new Uint32Array(3),h=new Uint32Array(6),y=function(a){return function(b){b.entry0=a.offset+a.vertexCount++;var c=k.i1616to32(b.distance,31*a._halfWidth),d=k.i8888to32(Math.round(31*b.prevNormal.x),Math.round(31*b.prevNormal.y),
Math.round(0),Math.round(-31)),e=k.i8888to32(0,0,0,a._bitset);n[0]=k.i1616to32(b.currentVertex.x,b.currentVertex.y);n[1]=a.id;n[2]=a._fillColor;n[3]=d;n[4]=c;n[5]=a._tl;n[6]=a._br;n[7]=e;n[8]=k.i1616to32(31*a._halfReferenceWidth,0);b.entry2=a.offset+a.vertexCount++;c=k.i1616to32(b.distance,31*a._halfWidth);d=k.i8888to32(Math.round(31*-b.prevNormal.x),Math.round(31*-b.prevNormal.y),Math.round(0),Math.round(31));e=k.i8888to32(0,0,0,a._bitset);n[9]=k.i1616to32(b.currentVertex.x,b.currentVertex.y);n[10]=
a.id;n[11]=a._fillColor;n[12]=d;n[13]=c;n[14]=a._tl;n[15]=a._br;n[16]=e;n[17]=k.i1616to32(31*a._halfReferenceWidth,0);b.exit0=a.offset+a.vertexCount++;c=k.i1616to32(b.distance,31*a._halfWidth);d=k.i8888to32(Math.round(31*b.nextNormal.x),Math.round(31*b.nextNormal.y),Math.round(0),Math.round(-31));e=k.i8888to32(0,0,0,a._bitset);n[18]=k.i1616to32(b.currentVertex.x,b.currentVertex.y);n[19]=a.id;n[20]=a._fillColor;n[21]=d;n[22]=c;n[23]=a._tl;n[24]=a._br;n[25]=e;n[26]=k.i1616to32(31*a._halfReferenceWidth,
0);b.exit2=a.offset+a.vertexCount++;c=k.i1616to32(b.distance,31*a._halfWidth);d=k.i8888to32(Math.round(31*-b.nextNormal.x),Math.round(31*-b.nextNormal.y),Math.round(0),Math.round(31));e=k.i8888to32(0,0,0,a._bitset);n[27]=k.i1616to32(b.currentVertex.x,b.currentVertex.y);n[28]=a.id;n[29]=a._fillColor;n[30]=d;n[31]=c;n[32]=a._tl;n[33]=a._br;n[34]=e;n[35]=k.i1616to32(31*a._halfReferenceWidth,0);a.geometryBuf.writeRegion(n)}},t=function(a){return function(b){h[0]=b.leftExit0;h[1]=b.rightEntry0;h[2]=b.leftExit2;
h[3]=b.rightEntry0;h[4]=b.rightEntry2;h[5]=b.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(h)}},A=function(a){return function(b,c,d,e,f,g,h,m,l){l=k.i1616to32(l,31*a._halfWidth);f=k.i8888to32(Math.round(31*f),Math.round(31*g),Math.round(31*h),Math.round(31*m));d=k.i8888to32(31*d,31*e,0,a._bitset);w[0]=k.i1616to32(b,c);w[1]=a.id;w[2]=a._fillColor;w[3]=f;w[4]=l;w[5]=a._tl;w[6]=a._br;w[7]=d;w[8]=k.i1616to32(31*a._halfReferenceWidth,0);a.geometryBuf.writeRegion(w);return a.offset+a.vertexCount++}},
B=function(a){return function(b,c,d){u[0]=b;u[1]=c;u[2]=d;a.indexCount+=3;a.indexBuf.writeRegion(u)}};c.default=function(a){return function(a){function c(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};b._tessellationOptions={};b.geometryType=m.WGLGeometryType.LINE;
return b}f(c,a);c.prototype.writeMesh=function(a,b,c,d,e){var f=b.indexVector,g=b.get("geometry"),h=new q(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;h.vertexFrom=b;h.indexFrom=f.length;switch(c){case "esriGeometryPolyline":c=this._clipLines(e.geometry.paths);if(0===c.length)break;this._write(h,f,g,b,d,c);a.push(h);break;case "esriGeometryPolygon":c=this._clipLines(e.geometry.rings);if(0===c.length)break;this._write(h,f,g,b,d,c);a.push(h);break;default:x.error("Unable to handle geometryType: "+
c)}};c.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];r.reset(2);var g=f[0],h=g[0],g=g[1];if(c)r.moveTo(h,g);else{if(-16>h||h>p||-16>g||g>p){c=!0;continue}e.push({x:h,y:g})}for(var k=!1,m=f.length,l=1;l<m;++l)if(h+=f[l][0],g+=f[l][1],c)r.lineTo(h,g);else{if(-16>h||h>p||-16>g||g>p){k=!0;break}e.push({x:h,y:g})}if(k)c=!0;else{if(c){if(e=r.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};c.prototype._write=function(a,
b,c,d,e,f){this.tessellationProperties.id=e;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=c;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=d;for(b=0;b<f.length;b++)c=f[b],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof l.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=
this._joinType),l.tessellate(d,this._tessellationOptions,this._tessellationCallbacks),l.cleanup());a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;a.zOrder=this._zOrder};c.prototype._initializeTessellator=function(a){var c=v.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<b.THIN_LINE_THRESHOLD/2&&!(c.vvSizeFieldStops||
c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=z;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=z;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:y(this.tessellationProperties),bridge:t(this.tessellationProperties)}:
(a=new l.StandardTessellationCallbacks(A(this.tessellationProperties),B(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a)};return c}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(c,e,f,g,n,q,r,w,v,z,I,G,N,F,H,M,L,J,O){var h=a.call(this)||this;h.height=r;h.width=q;h.xOffset=e*O;h.yOffset=f*O;e=d.vec2f32.create();f=m.mat2df32.create();I=(F===l.Alignment.MAP?1:0)|(I?1:0)<<1|(N?1:0)<<2|(G?1:0)<<3;G=H&&H.sdf;b.mat2d.translate(f,f,d.vec2f32.fromValues(h.xOffset,-h.yOffset));g&&b.mat2d.rotate(f,f,3.14159265359/180*g);c=p.MarkerMaterialKey.load(p.createMaterialKey(h.geometryType,
c,!1));c.sdf=G;c.pattern=!0;c.textureBinding=H.textureBinding;h._materialKey=c.data;h._fillColor=n;h._outlineColor=v;h._sizeOutlineWidth=x.i8888to32(Math.round(Math.sqrt(256*q)),Math.round(Math.sqrt(256*r)),Math.round(Math.sqrt(256*z)),Math.round(Math.sqrt(256*w)));n=H.rect.x;w=H.rect.y;v=n+H.rect.width;z=w+H.rect.height;M=.5-((.5+M)*H.width+1)/H.rect.width;L=.5-((.5+L)*H.height+1)/H.rect.height;c=Math.round(Math.min(64*J,255));q*=H.rect.width/H.width*J*O;r*=H.rect.height/H.height*J*O;H=(M-.5)*q;
L=(L-.5)*r;h._bitestAndDistRatio=x.i8888to32(0,0,I,c);k.vec2.set(e,H,L);k.vec2.transformMat2d(e,e,f);h._offsetUpperLeft=x.i1616to32(16*e[0],16*e[1]);h._texUpperLeft=x.i1616to32(n,w);k.vec2.set(e,H+q,L);k.vec2.transformMat2d(e,e,f);h._offsetUpperRight=x.i1616to32(16*e[0],16*e[1]);h._texUpperRight=x.i1616to32(v,w);k.vec2.set(e,H,L+r);k.vec2.transformMat2d(e,e,f);h._offsetBottomLeft=x.i1616to32(16*e[0],16*e[1]);h._texBottomLeft=x.i1616to32(n,z);k.vec2.set(e,H+q,L+r);k.vec2.transformMat2d(e,e,f);h._offsetBottomRight=
x.i1616to32(16*e[0],16*e[1]);h._texBottomRight=x.i1616to32(v,z);return h}f(c,a);c.fromCIMMarker=function(a,b,d){var f=b.size,h=(d&&d.width||1)/(d&&d.height||1)*b.scaleX,k=b.scaleSymbolsProportionally&&b.frameHeight?f/b.frameHeight:1,m=q.premultiplyAlphaRGBA(b.color),n=q.premultiplyAlphaRGBA(b.outlineColor),p=e.pt2px(f),u=p*h,r=e.pt2px(b.offsetX||0),w=e.pt2px(b.offsetY||0),k=e.pt2px(b.outlineWidth||0)*k,x=b.alignment||l.Alignment.SCREEN,v=e.pt2px(b.referenceSize),y=b.rotation||0;b.rotateClockwise||
(y=-y);var z=0,L=0,J=b.anchorPoint;J&&(b.isAbsoluteAnchorPoint?f&&(z=-J.x/(f*h),L=J.y/f):(z=J.x,L=J.y));return new c(a,r,w,y,m,u,p,v,n,k,b.colorLocked,b.scaleSymbolsProportionally,!1,x,d,z,L,b.sizeRatio,g.unwrapOr(b.scaleFactor,1))};c.fromPictureMarker=function(a,b,d){var f=Math.round(e.pt2px(b.width)),g=Math.round(e.pt2px(b.height)),h=v.PICTURE_FILL_COLOR,k=Math.round(e.pt2px(b.xoffset||0)),m=Math.round(e.pt2px(b.yoffset||0));return new c(a,k,m,b.angle,h,f,g,g,0,0,!1,!1,!1,l.Alignment.SCREEN,d,0,
0,1,1)};c.fromSimpleMarker=function(a,b,d){var f=q.premultiplyAlphaRGBA(b.color),g=Math.round(e.pt2px(b.size)),h=Math.round(e.pt2px(b.xoffset||0)),k=Math.round(e.pt2px(b.yoffset||0)),m=b.style,n=b.outline,p=(n&&n.color&&q.premultiplyAlphaRGBA(n.color))|0,n=(n&&n.width&&Math.round(e.pt2px(n.width)))|0;return new c(a,h,k,b.angle,f,g,g,g,p,n,!1,!1,"cross"===m||"x"===m,l.Alignment.SCREEN,d,0,0,1.96875,1)};return c}(z.default(r.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../enums ../../number ../../WGLDisplayRecord".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=g.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase");c.default=function(a){return function(a){function c(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.xOffset=0;b.yOffset=0;b.width=0;b.height=0;b.geometryType=e.WGLGeometryType.MARKER;return b}f(c,a);c.prototype.writeMesh=function(a,b,c,d,e){var f=b.indexVector,g=b.get("geometry"),l=new m(d,this.geometryType,this._materialKey);
b=b.getVector("geometry").vertexCount;a.push(l);l.vertexFrom=b;l.indexFrom=f.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(l,g,d,this._getPos(a,c));this._writeIndices(l,f,b);break;case "esriGeometryPolyline":this._writeMany(l,f,g,b,d,e.geometry.paths[0]);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(l,g,d,this._getPos(a,c)),this._writeIndices(l,f,b)):k.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(l,f,g,b,d,e.geometry.points);break;default:k.error("Unable to handle geometryType: "+c)}};c.prototype._getPos=function(a,c){return b.i1616to32(a,c)};c.prototype._writeMany=function(a,b,c,d,e,f){for(var g=0,k=0,h=0,m=0;m<f.length;m++){var l=f[m],p=l[0],l=l[1],q=this._getPos(p+g,l+k);this._writeVertices(a,c,e,q);this._writeIndices(a,b,d+h);g+=p;k+=l;h+=4}};c.prototype._writeVertices=function(a,b,c,d){b.push(d);b.push(this._offsetUpperLeft);b.push(this._texUpperLeft);
b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);b.push(this._texUpperRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);
b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};c.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return c}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaults ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n){function u(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function h(a){return!!(a&1)}Object.defineProperty(c,"__esModule",{value:!0});var y=b.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),t=[];c.isDynamicId=h;a=function(){function a(a,b){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new w.default;this._fetchResource=a;this._joinOnUTurn=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c){this._initErrorTemplates();var d=a.hash();if(this._symbolToTemplate.has(d))return this._symbolToTemplate.get(d);var e=[];b&&this._createMeshTemplates(e,b,c,!0);this._createMeshTemplates(e,a,c,!1);a=this._createGroupId("expanded-cim"===a.type);this._idToTemplateGroup.set(a,e);this._symbolToTemplate.set(d,a);return a};a.prototype.getCIMMosaicItem=function(a,
b){var c=this,d=this._createTemplateId(),e=m.create(function(a){return c._idToResolver.set(d,a)});this._fetchQueue.push({symbol:a,id:d,glyphIds:b});return e};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):t};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return t;h(a)||y.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.finalize=
function(a){return this._fetchQueue.length||this._lock.isHeld()?w.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):m.resolve()};a.prototype._initErrorTemplates=function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],k.errorPolygonSymbol2D,null,!1),marker:this._createMeshTemplates([],k.errorPointSymbol2D,null,!1),line:this._createMeshTemplates([],k.errorPolylineSymbol2D,null,!1)})};a.prototype._fetchAllQueuedResources=function(a){var b=this;if(!this._fetchQueue.length)return m.resolve();
var c=this._fetchQueue,d=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return m.all(d).then(function(){return b._fetchResource(c,a).then(function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.id,d=d.mosaicItem;b._idToResolver.get(e)(d);b._idToResolver.delete(e)}})}).catch(function(a){m.isAbortError(a)?b._fetchQueue=b._fetchQueue.concat(c):y.error(new e("mapview-template-store","Unable to fetch requested texture resources",a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<
1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._getCodepoints=function(a){a=r.bidiText(a.text)[0];for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),e=m.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),id:c,glyphIds:d});return e};a.prototype._createSMS=function(a,b){return f(this,
void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,y)?[2,p.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return f(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,y)?[2,p.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};
a.prototype._createSFS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return g(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,n.ok(d,y)?[2,v.default.fromSimpleFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createPFS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return g(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,
n.ok(d,y)?[2,v.default.fromPictureFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return g(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,n.ok(d,y)?[2,x.default.fromSimpleLine(b,c,e,d,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b){return f(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,
this._getMosaicItem(a)];case 1:return c=d.sent().glyphMosaicItems,[2,z.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,b){return f(this,void 0,void 0,function(){var c,d,e,f,h,k;return g(this,function(g){switch(g.label){case 0:if("function"===typeof a.materialHash)return[2,m.resolve(q.default.fromCIMText(b,a))];c=[];if(d=a.text)for(e=d.length,f=0;f<e;f++)h=d.charCodeAt(f),c.push(h);a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim,c)];case 1:return k=g.sent().glyphMosaicItems,
n.ok(k,y)?[2,z.default.fromCIMText(b,a,k)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return f(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,y)?[2,v.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return f(this,void 0,void 0,function(){var c;return g(this,function(e){switch(e.label){case 0:if("function"===
typeof a.materialHash)return[2,m.resolve(d.default.fromCIMLine(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return c=e.sent().spriteMosaicItem,n.ok(c,y)?[2,x.default.fromCIMLine(b,a,c,!1,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,b){return f(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:if("function"===typeof a.materialHash)return[2,m.resolve(l.default.fromCIMMarker(b,a))];a.cim.mosaicHash=
a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,n.ok(c,y)?[2,p.default.fromCIMMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return f(this,void 0,void 0,function(){var c,d,e=this;return g(this,function(f){c=a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,
b);break;case "text":d=this._createCIMText(a,b)}d.then(function(a){return e._cimTemplateCache.set(c,a)});return[2,d]})})};a.prototype._createMeshTemplates=function(a,b,c,d){if(-1!==b.type.indexOf("3d"))return y.error("3D symbols are not supported with MapView"),a;switch(b.type){case "cim":return y.error(new e("mapview-bad-type","Found a cim type not yet expanded")),a;case "expanded-cim":d=0;for(b=b.layers;d<b.length;d++)u(a,this._createCIM(b[d],c));return a;case "simple-marker":return u(a,this._createSMS(b,
c));case "picture-marker":return u(a,this._createPMS(b,c));case "simple-fill":return u(a,this._createSFS(b,c,d)),b.outline&&u(a,this._createSLS(b.outline,c,!0)),a;case "picture-fill":return u(a,this._createPFS(b,c,d)),b.outline&&u(a,this._createSLS(b.outline,c,!0)),a;case "simple-line":return u(a,this._createSLS(b,c,!1));case "text":return u(a,this._createTS(b,c));default:return y.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),a}};return a}();c.WGLTemplateStore=
a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(a,c,f,g,e,b,m,k,d,l,q){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(b,c){var d=a.call(this,c)||this;d._cimLineLayer=c;var f=0;k.isFunction(c.width)||
(f=.5*g.pt2px(c.width));d._dynamicPropertyMap.set("_halfWidth",function(a,b,d){return k.isFunction(c.width)?.5*g.pt2px(c.width(a,b,d)):f});k.isFunction(c.cap)?d._dynamicPropertyMap.set("_capType",c.cap):d._capType=c.cap;k.isFunction(c.join)?d._dynamicPropertyMap.set("_joinType",c.join):d._joinType=c.join;if(k.isFunction(c.color))d._dynamicPropertyMap.set("_fillColor",function(a,b,d){return(a=c.color(a,b,d))&&e.premultiplyAlphaRGBA(a)||0});else{var l=c.color;d._fillColor=l&&e.premultiplyAlphaRGBA(l)||
0}k.isFunction(c.miterLimit)?d._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,d){return k.getLimitCosine(c.miterLimit(a,b,d))}):d._miterLimitCosine=k.getLimitCosine(c.miterLimit);d._scaleFactor=c.scaleFactor||1;d._isDashed=c.isDashed;d.tessellationProperties._bitset=c.colorLocked?1:0;d._materialKey=m.createMaterialKey(d.geometryType,b,c.isOutline);d._initializeTessellator(!0);return d}f(c,a);c.fromCIMLine=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(a,c,d){var e=this;
this._dynamicPropertyMap.forEach(function(b,f){e[f]=b(a,c,d)});this._halfWidth*=this._scaleFactor;var f=this._materialCache,g=this._cimLineLayer.materialHash,g=g(a,c,d),g=f.get(g),f=null;g&&q.ok(g.spriteMosaicItem)&&(f=g.spriteMosaicItem);if(f){this._hasPattern=!0;var g=f.rect,h=g.x+1+f.width,k=g.y+1+f.height;this.tessellationProperties._tl=b.i1616to32(g.x+1,g.y+1);this.tessellationProperties._br=b.i1616to32(h,k)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=
0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;g=m.LineMaterialKey.load(this._materialKey);f&&(g.sdf=f.sdf,g.pattern=!0,g.textureBinding=f.textureBinding);this._materialKey=g.data};return c}(d.default(l.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),
function(a,c,f,g,e,b,m){Object.defineProperty(c,"__esModule",{value:!0});var k=g.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");a=function(a){function c(b){var c=a.call(this)||this;c._ongoingMaterialRequestMap=new Map;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=b;return c}f(c,a);c.prototype.analyze=function(a,c,d,f){var g=this,m=this._materialCache,l=this._cimLayer.materialHash;if(!l)return k.error("A Dynamic mesh template must have a material hash value or function!"),
e.reject(null);var n="function"===typeof l?l(c,d,f):l;if(m.has(n))return a=m.get(n),e.resolve(a);if(this._ongoingMaterialRequestMap.has(n))return this._ongoingMaterialRequestMap.get(n);c=b.analyzeCIMResource(this._cimLayer.cim,this._cimLayer.materialOverrides);c.mosaicHash=n;a=a.getCIMMosaicItem(c).then(function(a){g._ongoingMaterialRequestMap.delete(n);m.set(n,a);return a}).catch(function(a){g._ongoingMaterialRequestMap.delete(n);k.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(n,
a);return a};return c}(m.default);c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u){Object.defineProperty(c,"__esModule",{value:!0});var h=3.14159265359/180,y=q.vec2f32.create(),t=d.mat2df32.create(),A=e.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");a=function(a){function c(c,d){var e=a.call(this,d)||this;e._cimMarkerLayer=d;r.isFunction(d.color)?e._dynamicPropertyMap.set("_fillColor",function(a,b,c){return x.premultiplyAlphaRGBA(d.color(a,b,c))}):e._fillColor=x.premultiplyAlphaRGBA(d.color);r.isFunction(d.outlineColor)?
e._dynamicPropertyMap.set("_outlineColor",function(a,b,c){return x.premultiplyAlphaRGBA(d.outlineColor(a,b,c))}):e._outlineColor=x.premultiplyAlphaRGBA(d.outlineColor);r.isFunction(d.size)?e._dynamicPropertyMap.set("_size",function(a,b,c){return m.pt2px(d.size(a,b,c))}):e._size=m.pt2px(d.size);r.isFunction(d.scaleX)?e._dynamicPropertyMap.set("_scaleX",d.scaleX):e._scaleX=d.scaleX;r.isFunction(d.offsetX)?e._dynamicPropertyMap.set("xOffset",function(a,b,c){return m.pt2px(d.offsetX(a,b,c))}):e.xOffset=
m.pt2px(d.offsetX);r.isFunction(d.offsetY)?e._dynamicPropertyMap.set("yOffset",function(a,b,c){return m.pt2px(d.offsetY(a,b,c))}):e.yOffset=m.pt2px(d.offsetY);r.isFunction(d.outlineWidth)?e._dynamicPropertyMap.set("_outlineWidth",function(a,b,c){return m.pt2px(d.outlineWidth(a,b,c))}):e._outlineWidth=m.pt2px(d.outlineWidth);r.isFunction(d.rotation)?e._dynamicPropertyMap.set("_angle",d.rotation):e._angle=d.rotation;e._scaleFactor=b.unwrapOr(d.scaleFactor,1);e._bitSet=(d.alignment===v.Alignment.MAP?
1:0)|(d.colorLocked?1:0)<<1|(d.scaleSymbolsProportionally?1:0)<<3;e._materialKey=z.createMaterialKey(e.geometryType,c,!1);return e}f(c,a);c.fromCIMMarker=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,f){d[f]=e(a,b,c)});var e=this._cimMarkerLayer.materialHash,e="function"===typeof e?e(a,b,c):e;if((e=this._materialCache.get(e))&&u.ok(e.spriteMosaicItem)&&e.spriteMosaicItem){var e=e.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,
n=e.width/e.height*this._scaleX,r=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,w=this._size,x=w*n,v=this.xOffset*this._scaleFactor,B=this.yOffset*this._scaleFactor,C=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/m.pt2px(this._cimMarkerLayer.frameHeight):1,D=this._outlineWidth*C,K=m.pt2px(this._cimMarkerLayer.referenceSize),E=0,C=0,S=this._cimMarkerLayer.anchorPoint;S&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(E=-S.x/(this._size*
n),C=S.y/this._size):(E=S.x,C=S.y));this._sizeOutlineWidth=p.i8888to32(Math.round(Math.sqrt(256*x)),Math.round(Math.sqrt(256*w)),Math.round(Math.sqrt(256*D)),Math.round(Math.sqrt(256*K)));k.mat2d.identity(t);k.mat2d.translate(t,t,q.vec2f32.fromValues(v,-B));r&&k.mat2d.rotate(t,t,h*r);n=e.rect.x;r=e.rect.y;v=n+e.rect.width;B=r+e.rect.height;E=.5-((.5+E)*e.width+1)/e.rect.width;C=.5-((.5+C)*e.height+1)/e.rect.height;x=x*f*this._scaleFactor;w=w*f*this._scaleFactor;f=Math.round(64*f);x*=e.rect.width/
e.width;w*=e.rect.height/e.height;E=(E-.5)*x;C=(C-.5)*w;this._bitestAndDistRatio=p.i8888to32(0,0,this._bitSet,f);l.vec2.set(y,E,C);l.vec2.transformMat2d(y,y,t);this._offsetUpperLeft=p.i1616to32(16*y[0],16*y[1]);this._texUpperLeft=p.i1616to32(n,r);l.vec2.set(y,E+x,C);l.vec2.transformMat2d(y,y,t);this._offsetUpperRight=p.i1616to32(16*y[0],16*y[1]);this._texUpperRight=p.i1616to32(v,r);l.vec2.set(y,E,C+w);l.vec2.transformMat2d(y,y,t);this._offsetBottomLeft=p.i1616to32(16*y[0],16*y[1]);this._texBottomLeft=
p.i1616to32(n,B);l.vec2.set(y,E+x,C+w);l.vec2.transformMat2d(y,y,t);this._offsetBottomRight=p.i1616to32(16*y[0],16*y[1]);this._texBottomRight=p.i1616to32(v,B);w=z.MarkerMaterialKey.load(this._materialKey);w.sdf=e.sdf;w.pattern=!0;w.textureBinding=e.textureBinding;this._materialKey=w.data}else A.error(new g("mapview-cim","Encountered an error when binding feature"))};return c}(w.default(n.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../util/BidiText".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v){Object.defineProperty(c,"__esModule",{value:!0});var x=new Set;a=function(a){function c(c,e){var f=a.call(this,e)||this;f._horizontalAlignment="center";f._verticalAlignment="middle";f._glyphs=[];var l=e.scaleFactor||1;f._cimTextLayer=e;d.isFunction(e.color)?f._dynamicPropertyMap.set("_color",function(a,c,d){return b.premultiplyAlphaRGBA(e.color(a,c,d))}):f._color=b.premultiplyAlphaRGBA(e.color);d.isFunction(e.color)?f._dynamicPropertyMap.set("_haloColor",function(a,
c,d){return b.premultiplyAlphaRGBA(e.outlineColor(a,c,d))}):f._haloColor=b.premultiplyAlphaRGBA(e.outlineColor);var h;d.isFunction(e.size)||(h=Math.min(Math.round(g.pt2px(e.size*e.sizeRatio)),127));f._dynamicPropertyMap.set("_size",function(a,b,c){return d.isFunction(e.size)?Math.min(Math.round(g.pt2px(e.size(a,b,c)*e.sizeRatio)),127):h});d.isFunction(e.outlineSize)?f._dynamicPropertyMap.set("_haloSize",function(a,b,c){return Math.min(Math.floor(5*g.pt2px(e.outlineSize(a,b,c)*e.sizeRatio)),127)}):
f._haloSize=Math.min(Math.floor(5*g.pt2px(e.outlineSize*e.sizeRatio)),127);var p;d.isFunction(e.offsetX)||(p=Math.round(g.pt2px(e.offsetX*e.sizeRatio)));f._dynamicPropertyMap.set("_xOffset",function(a,b,c){return d.isFunction(e.offsetX)?Math.round(g.pt2px(e.offsetX(a,b,c)*e.sizeRatio)):p});var q;d.isFunction(e.offsetY)||(q=Math.round(g.pt2px(e.offsetY*e.sizeRatio)));f._dynamicPropertyMap.set("_yOffset",function(a,b,c){return d.isFunction(e.offsetY)?Math.round(g.pt2px(e.offsetY(a,b,c)*e.sizeRatio)):
q});d.isFunction(e.decoration)?f._dynamicPropertyMap.set("_decorationTop",function(a,b,c){return m.getFontDecorationTop(e.decoration(a,b,c))}):f._decorationTop=m.getFontDecorationTop(e.decoration);d.isFunction(e.angle)?f._dynamicPropertyMap.set("_angle",e.angle):f._angle=e.angle;d.isFunction(e.horizontalAlignment)?f._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):f._horizontalAlignment=e.horizontalAlignment;d.isFunction(e.verticalAlignment)?f._dynamicPropertyMap.set("_verticalAlignment",
e.verticalAlignment):f._verticalAlignment=e.verticalAlignment;f._scaleFactor=l;d.isFunction(e.text)?f._dynamicPropertyMap.set("_text",e.text):f._text=e.text;l=Math.min(Math.round(g.pt2px(e.referenceSize*e.sizeRatio)),127);f._referenceSize=Math.round(Math.sqrt(256*l));f._materialKey=k.createMaterialKey(f.geometryType,c,!1);c=k.TextMaterialKey.load(f._materialKey);c.sdf=!0;f._bitset=e.colorLocked?1:0;f._materialKey=c.data;return f}f(c,a);c.fromCIMText=function(a,b){return new c(a,b)};c.prototype.analyze=
function(a,b,c,d){var e=this._cimTextLayer;b="string"===typeof e.text?e.text:"function"===typeof e.text?e.text(b,c,d):"";var f=this._glyphs;x.clear();for(c=0;c<b.length;c++)x.add(b.charCodeAt(c));var g=[];x.forEach(function(a){if(f.length<a||void 0===f[a])g[a]=a});return a.getCIMMosaicItem(e.cim,g).then(function(a){if(a.glyphMosaicItems&&0<a.glyphMosaicItems.length)for(var b=a.glyphMosaicItems,c=0;c<b.length;c++)void 0!==b[c]&&(f[c]=b[c]);return a})};c.prototype.bindFeature=function(a,b,c){var d=
this;this._dynamicPropertyMap.forEach(function(e,f){d[f]=e(a,b,c)});if(this._text&&0!==this._text.length){this._size*=this._scaleFactor;this._scale=this._size/24;this._xOffset*=this._scaleFactor;this._yOffset*=this._scaleFactor;this._justify=e.getJustification(this._horizontalAlignment||"center");this._xAlignD=e.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=-e.getYAnchorDirection(this._verticalAlignment||"baseline");this._baseline="baseline"===(this._verticalAlignment||"baseline");
for(var f=this._glyphs,g=v.bidiText(this._text),k=g[0],g=g[1],m=[],l=0;l<k.length;l++)m[k.charCodeAt(l)]=f[k.charCodeAt(l)];this.bindTextInfo(m,k,g);this._computeGlyphs(this._shapedGlyphs,this._shapedBox)}else this._shapedBox=this._shapedGlyphs=this._computedGlyphs=null};return c}(l.default(q.default));c.default=a})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x,p,z,r){Object.defineProperty(c,"__esModule",{value:!0});var w=g.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),n=[],u=[];a=function(a){function c(b,c,e,f,g,h,k,m,n){var q=a.call(this)||this;q.fillColor=e;q.tl=f;q.br=g;q.aux1=h;q.aux2=k;q.aux3=m;q.isBFS=n;q.geometryType=l.WGLGeometryType.FILL;q.forceLibtess=!1;b=p.FillMaterialKey.load(p.createMaterialKey(q.geometryType,b,!1));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);
q._materialKey=b.data;q._tesselator=new z.default;q._tileClipper=new v.TileClipper(0,0,0,1,8);q._tileClipper.setExtent(d.TILE_SIZE);return q}f(c,a);c.fromCIMFill=function(a,d,f,g){void 0===g&&(g=!1);var h=d.color,h=h&&k.premultiplyAlphaRGBA(h)||0,m=q.i8888to32(0,0,0,d.colorLocked?1:0);if(!f)return new c(a,null,h,0,0,0,0,m,g);var m=f.rect,l=f.width,n=f.height,p=m.x+1,u=m.y+1,t=p+l,r=u+n,m=e.nextHighestPowerOfTwo(b.pt2px(d.height||0));255<m?m=255:0>=m&&(m=e.nextHighestPowerOfTwo(r-u));l=e.nextHighestPowerOfTwo(b.pt2px(d.height/
n*l||0));255<l?l=255:0>=l&&(l=e.nextHighestPowerOfTwo(t-p));n=b.pt2px(d.offsetX||0)+128;255<n&&(n=255);var w=b.pt2px(-d.offsetY||0)+128;255<w&&(w=255);d=d.scaleX||1;p=q.i1616to32(p,u);t=q.i1616to32(t,r);m=q.i8888to32(l,m,n,w);d=q.i1616to32(128*d,128);return new c(a,f,h,p,t,m,d,0,g)};c.fromSimpleFill=function(a,b,d,f){void 0===f&&(f=!1);var g=b.color;b=g&&"none"!==b.style&&k.premultiplyAlphaRGBA(g)||0;g=q.i8888to32(0,0,0,f?255:0);if(!d)return new c(a,null,b,0,0,0,0,g,f);var h=d.rect,m=h.x+1,l=h.y+
1,n=h.x+1+d.width,p=h.y+1+d.height,h=q.i1616to32(m,l),u=q.i1616to32(n,p),m=q.i8888to32(e.nextHighestPowerOfTwo(n-m),e.nextHighestPowerOfTwo(p-l),0,0),l=q.i1616to32(128,128);return new c(a,d,b,h,u,m,l,g,f)};c.fromPictureFill=function(a,f,g,h){void 0===h&&(h=!1);var k=d.PICTURE_FILL_COLOR,m=g.rect,l=m.x+1,n=m.y+1,m=l+g.width,p=n+g.height,l=q.i1616to32(l,n),m=q.i1616to32(m,p),p=e.nextHighestPowerOfTwo(b.pt2px(f.width));255<p&&(p=255);n=e.nextHighestPowerOfTwo(b.pt2px(f.height));255<n&&(n=255);var u=
b.pt2px(f.xoffset)+128;255<u&&(u=255);var t=b.pt2px(-f.yoffset)+128;255<t&&(t=255);p=q.i8888to32(p,n,u,t);f=q.i1616to32(128*f.xscale,128*f.yscale);n=q.i8888to32(0,0,0,h?255:0);return new c(a,g,k,l,m,p,f,n,h)};c.prototype.writeMesh=function(a,b,c,d,e){n.length=0;if("esriGeometryPolygon"!==c)"esriGeometryPolyline"!==c&&w.error("Unable to handle geometryType: "+c);else{var f=e.geometry;c=p.FillMaterialKey.load(this._materialKey);var g=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){for(var f=
f.rings,h=0,k=0;k<f.length;k++)for(var m=f[k],l=m[0],q=l[0],l=l[1],u=1;u<m.length;u++)var t=m[u],r=q+t[0],t=l+t[1],h=h-(r-q)*(t+l)/2,q=r,l=t;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,b,d,g,e,c,f):this._writeMeshEarcut(a,b,d,g,e,c,f)||this._writeMeshLibtess(a,b,d,g,e,c,f)}};c.prototype._isClippingRequired=function(a){var b=d.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var e=a[c],f=e.length;if(!(3>f)){var g=e[0][0],h=e[0][1];if(-8>g||g>b||-8>h||h>b)return!0;for(var k=1;k<f;++k)if(g+=
e[k][0],h+=e[k][1],-8>g||g>b||-8>h||h>b)return!0}}return!1};c.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};c.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g){if(d&&d.length){var h=[],k=b.indexVector;b=b.getVector("geometry");
var m=new x(c,this.geometryType,this._materialKey),l=b.vertexCount;m.vertexFrom=l;m.indexFrom=k.length;this._tesselator.beginPolygon(n,h);for(var p=0;p<d.length;p++){var q=d[p];if(!(3>q.length)){this._tesselator.beginContour();var u=void 0,r=void 0;e?(u=q[0].x,r=q[0].y):(u=q[0][0],r=q[0][1]);var t=[u,r,0];this._tesselator.addVertex(t,t);for(t=1;t<q.length-1;t++){var w=void 0,v=void 0;e?(u=q[t].x,r=q[t].y):(w=q[t][0],v=q[t][1],u+=w,r+=v);w=[u,r,0];this._tesselator.addVertex(w,w)}this._tesselator.endContour()}}this._tesselator.endPolygon();
this._writeVerticesLibTess(m,b,c,n,f,g);this._writeIndicesLibTess(m,k,l,h);0<m.indexCount&&a.push(m)}};c.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g){if(d&&d.length){var h=b.indexVector;b=b.getVector("geometry");var k=new x(c,this.geometryType,this._materialKey),m=h.length,l=b.data.length;k.vertexFrom=b.vertexCount;k.indexFrom=h.length;for(var p=0,q=0,r=0;r<d.length;r++){var t=d[r],w=q,v=void 0,y=void 0;e?(v=t[0].x,y=t[0].y):(v=t[0][0],y=t[0][1]);n[q++]=v;n[q++]=y;for(var z=0,A=1;A<t.length;++A){var B=
void 0,C=void 0;e?(B=v,C=y,v=t[A].x,y=t[A].y,B=v-B,C=y-C):(B=t[A][0],C=t[A][1],v+=B,y+=C);z-=B*(y+y-C);n[q++]=v;n[q++]=y}if(0<z){if(0<w-p){if(!this._write(k,h,b,c,n,u,p,w,f,g))return h.seek(m),b.data.seek(l),n.length=u.length=0,!1;p=w}u.length=0}else 0>z?0<w-p?u.push(.5*(w-p)):q=w:q=w}if(0<q-p&&!this._write(k,h,b,c,n,u,p,q,f,g))return h.seek(m),b.data.seek(l),n.length=u.length=0,!1;n.length=u.length=0;a.push(k);return!0}};c.prototype._write=function(a,b,c,d,e,f,g,h,k,l){e=e.slice(g,h);g=m(e,f,2);
if(m.deviation(e,f,2,g))return!1;if(g.length)return f=c.vertexCount,this._writeVertices(a,c,d,e,k,l),this._writeIndices(a,b,f,g),!0};c.prototype._writeVertices=function(a,b,c,d,e,f){for(var g=0;g<d.length;g+=2){var h=q.i1616to32(d[g],d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};c.prototype._writeIndices=function(a,
b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};c.prototype._writeVerticesLibTess=function(a,b,c,d,e,f){for(var g=0;g<d.length;g+=2){var h=q.i1616to32(d[g],d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};c.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=
0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return c}(r.default);c.default=a})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});var e=f.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");a=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new g.GluTesselator;
this.glu.gluTessCallback(g.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));
this.glu.gluTessProperty(g.gluEnum.GLU_TESS_WINDING_RULE,g.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};
a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){e.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(){};return a}();c.default=a})},"esri/core/libs/libtess/libtess":function(){define([],function(){var a={DEBUG:!1,assert:function(c,f){if(a.DEBUG&&!c)throw Error("Assertion failed"+
(f?": "+f:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,
GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,
GLU_INVALID_VALUE:100901},geom:{}};a.geom.vertEq=function(a,f){return a.s===f.s&&a.t===f.t};a.geom.vertLeq=function(a,f){return a.s<f.s||a.s===f.s&&a.t<=f.t};a.geom.edgeEval=function(c,f,g){a.assert(a.geom.vertLeq(c,f)&&a.geom.vertLeq(f,g));var e=f.s-c.s,b=g.s-f.s;return 0<e+b?e<b?f.t-c.t+e/(e+b)*(c.t-g.t):f.t-g.t+b/(e+b)*(g.t-c.t):0};a.geom.edgeSign=function(c,f,g){a.assert(a.geom.vertLeq(c,f)&&a.geom.vertLeq(f,g));var e=f.s-c.s,b=g.s-f.s;return 0<e+b?(f.t-g.t)*e+(f.t-c.t)*b:0};a.geom.transLeq=function(a,
f){return a.t<f.t||a.t===f.t&&a.s<=f.s};a.geom.transEval=function(c,f,g){a.assert(a.geom.transLeq(c,f)&&a.geom.transLeq(f,g));var e=f.t-c.t,b=g.t-f.t;return 0<e+b?e<b?f.s-c.s+e/(e+b)*(c.s-g.s):f.s-g.s+b/(e+b)*(g.s-c.s):0};a.geom.transSign=function(c,f,g){a.assert(a.geom.transLeq(c,f)&&a.geom.transLeq(f,g));var e=f.t-c.t,b=g.t-f.t;return 0<e+b?(f.s-g.s)*e+(f.s-c.s)*b:0};a.geom.edgeGoesLeft=function(c){return a.geom.vertLeq(c.dst(),c.org)};a.geom.edgeGoesRight=function(c){return a.geom.vertLeq(c.org,
c.dst())};a.geom.vertL1dist=function(a,f){return Math.abs(a.s-f.s)+Math.abs(a.t-f.t)};a.geom.vertCCW=function(a,f,g){return 0<=a.s*(f.t-g.t)+f.s*(g.t-a.t)+g.s*(a.t-f.t)};a.geom.interpolate_=function(a,f,g,e){a=0>a?0:a;g=0>g?0:g;return a<=g?0===g?(f+e)/2:f+a/(a+g)*(e-f):e+g/(a+g)*(f-e)};a.geom.edgeIntersect=function(c,f,g,e,b){var m,k;a.geom.vertLeq(c,f)||(m=c,c=f,f=m);a.geom.vertLeq(g,e)||(m=g,g=e,e=m);a.geom.vertLeq(c,g)||(m=c,c=g,g=m,m=f,f=e,e=m);a.geom.vertLeq(g,f)?a.geom.vertLeq(f,e)?(m=a.geom.edgeEval(c,
g,f),k=a.geom.edgeEval(g,f,e),0>m+k&&(m=-m,k=-k),b.s=a.geom.interpolate_(m,g.s,k,f.s)):(m=a.geom.edgeSign(c,g,f),k=-a.geom.edgeSign(c,e,f),0>m+k&&(m=-m,k=-k),b.s=a.geom.interpolate_(m,g.s,k,e.s)):b.s=(g.s+f.s)/2;a.geom.transLeq(c,f)||(m=c,c=f,f=m);a.geom.transLeq(g,e)||(m=g,g=e,e=m);a.geom.transLeq(c,g)||(m=c,c=g,g=m,m=f,f=e,e=m);a.geom.transLeq(g,f)?a.geom.transLeq(f,e)?(m=a.geom.transEval(c,g,f),k=a.geom.transEval(g,f,e),0>m+k&&(m=-m,k=-k),b.t=a.geom.interpolate_(m,g.t,k,f.t)):(m=a.geom.transSign(c,
g,f),k=-a.geom.transSign(c,e,f),0>m+k&&(m=-m,k=-k),b.t=a.geom.interpolate_(m,g.t,k,e.t)):b.t=(g.t+f.t)/2};a.mesh={};a.mesh.makeEdge=function(c){var f=a.mesh.makeEdgePair_(c.eHead);a.mesh.makeVertex_(f,c.vHead);a.mesh.makeVertex_(f.sym,c.vHead);a.mesh.makeFace_(f,c.fHead);return f};a.mesh.meshSplice=function(c,f){var g=!1,e=!1;c!==f&&(f.org!==c.org&&(e=!0,a.mesh.killVertex_(f.org,c.org)),f.lFace!==c.lFace&&(g=!0,a.mesh.killFace_(f.lFace,c.lFace)),a.mesh.splice_(f,c),e||(a.mesh.makeVertex_(f,c.org),
c.org.anEdge=c),g||(a.mesh.makeFace_(f,c.lFace),c.lFace.anEdge=c))};a.mesh.deleteEdge=function(c){var f=c.sym,g=!1;c.lFace!==c.rFace()&&(g=!0,a.mesh.killFace_(c.lFace,c.rFace()));c.oNext===c?a.mesh.killVertex_(c.org,null):(c.rFace().anEdge=c.oPrev(),c.org.anEdge=c.oNext,a.mesh.splice_(c,c.oPrev()),g||a.mesh.makeFace_(c,c.lFace));f.oNext===f?(a.mesh.killVertex_(f.org,null),a.mesh.killFace_(f.lFace,null)):(c.lFace.anEdge=f.oPrev(),f.org.anEdge=f.oNext,a.mesh.splice_(f,f.oPrev()));a.mesh.killEdge_(c)};
a.mesh.addEdgeVertex=function(c){var f=a.mesh.makeEdgePair_(c),g=f.sym;a.mesh.splice_(f,c.lNext);f.org=c.dst();a.mesh.makeVertex_(g,f.org);f.lFace=g.lFace=c.lFace;return f};a.mesh.splitEdge=function(c){var f=a.mesh.addEdgeVertex(c).sym;a.mesh.splice_(c.sym,c.sym.oPrev());a.mesh.splice_(c.sym,f);c.sym.org=f.org;f.dst().anEdge=f.sym;f.sym.lFace=c.rFace();f.winding=c.winding;f.sym.winding=c.sym.winding;return f};a.mesh.connect=function(c,f){var g=!1,e=a.mesh.makeEdgePair_(c),b=e.sym;f.lFace!==c.lFace&&
(g=!0,a.mesh.killFace_(f.lFace,c.lFace));a.mesh.splice_(e,c.lNext);a.mesh.splice_(b,f);e.org=c.dst();b.org=f.org;e.lFace=b.lFace=c.lFace;c.lFace.anEdge=b;g||a.mesh.makeFace_(e,c.lFace);return e};a.mesh.zapFace=function(c){var f=c.anEdge,g=f.lNext,e;do if(e=g,g=e.lNext,e.lFace=null,null===e.rFace()){e.oNext===e?a.mesh.killVertex_(e.org,null):(e.org.anEdge=e.oNext,a.mesh.splice_(e,e.oPrev()));var b=e.sym;b.oNext===b?a.mesh.killVertex_(b.org,null):(b.org.anEdge=b.oNext,a.mesh.splice_(b,b.oPrev()));a.mesh.killEdge_(e)}while(e!==
f);f=c.prev;c=c.next;c.prev=f;f.next=c};a.mesh.meshUnion=function(a,f){var c=a.fHead,e=a.vHead,b=a.eHead,m=f.fHead,k=f.vHead;f=f.eHead;m.next!==m&&(c.prev.next=m.next,m.next.prev=c.prev,m.prev.next=c,c.prev=m.prev);k.next!==k&&(e.prev.next=k.next,k.next.prev=e.prev,k.prev.next=e,e.prev=k.prev);f.next!==f&&(b.sym.next.sym.next=f.next,f.next.sym.next=b.sym.next,f.sym.next.sym.next=b,b.sym.next=f.sym.next);return a};a.mesh.deleteMesh=function(a){};a.mesh.makeEdgePair_=function(c){var f=new a.GluHalfEdge,
g=new a.GluHalfEdge,e=c.sym.next;g.next=e;e.sym.next=f;f.next=c;c.sym.next=g;f.sym=g;f.oNext=f;f.lNext=g;g.sym=f;g.oNext=g;return g.lNext=f};a.mesh.splice_=function(a,f){var c=a.oNext,e=f.oNext;c.sym.lNext=f;e.sym.lNext=a;a.oNext=e;f.oNext=c};a.mesh.makeVertex_=function(c,f){var g=f.prev,e=new a.GluVertex(f,g);g.next=e;f.prev=e;f=e.anEdge=c;do f.org=e,f=f.oNext;while(f!==c)};a.mesh.makeFace_=function(c,f){var g=f.prev,e=new a.GluFace(f,g);g.next=e;f.prev=e;e.anEdge=c;e.inside=f.inside;f=c;do f.lFace=
e,f=f.lNext;while(f!==c)};a.mesh.killEdge_=function(a){var c=a.next;a=a.sym.next;c.sym.next=a;a.sym.next=c};a.mesh.killVertex_=function(a,f){var c=a.anEdge,e=c;do e.org=f,e=e.oNext;while(e!==c);f=a.prev;a=a.next;a.prev=f;f.next=a};a.mesh.killFace_=function(a,f){var c=a.anEdge,e=c;do e.lFace=f,e=e.lNext;while(e!==c);f=a.prev;a=a.next;a.prev=f;f.next=a};a.normal={};a.normal.S_UNIT_X_=1;a.normal.S_UNIT_Y_=0;a.normal.projectPolygon=function(c,f,g,e){var b=!1,m=[f,g,e];0===f&&0===g&&0===e&&(a.normal.computeNormal_(c,
m),b=!0);g=a.normal.longAxis_(m);f=c.mesh.vHead;if(a.TRUE_PROJECT){a.normal.normalize_(m);e=[0,0,0];var k=[0,0,0];e[g]=0;e[(g+1)%3]=a.normal.S_UNIT_X_;e[(g+2)%3]=a.normal.S_UNIT_Y_;g=a.normal.dot_(e,m);e[0]-=g*m[0];e[1]-=g*m[1];e[2]-=g*m[2];a.normal.normalize_(e);k[0]=m[1]*e[2]-m[2]*e[1];k[1]=m[2]*e[0]-m[0]*e[2];k[2]=m[0]*e[1]-m[1]*e[0];a.normal.normalize_(k);for(m=f.next;m!==f;m=m.next)m.s=a.normal.dot_(m.coords,e),m.t=a.normal.dot_(m.coords,k)}else for(e=(g+1)%3,k=(g+2)%3,g=0<m[g]?1:-1,m=f.next;m!==
f;m=m.next)m.s=m.coords[e],m.t=g*m.coords[k];b&&a.normal.checkOrientation_(c)};a.normal.dot_=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]};a.normal.normalize_=function(c){var f=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];a.assert(0<f);f=Math.sqrt(f);c[0]/=f;c[1]/=f;c[2]/=f};a.normal.longAxis_=function(a){var c=0;Math.abs(a[1])>Math.abs(a[0])&&(c=1);Math.abs(a[2])>Math.abs(a[c])&&(c=2);return c};a.normal.computeNormal_=function(c,f){var g=[-2*a.GLU_TESS_MAX_COORD,-2*a.GLU_TESS_MAX_COORD,-2*a.GLU_TESS_MAX_COORD],
e=[2*a.GLU_TESS_MAX_COORD,2*a.GLU_TESS_MAX_COORD,2*a.GLU_TESS_MAX_COORD],b=[],m=[],k;c=c.mesh.vHead;for(k=c.next;k!==c;k=k.next)for(var d=0;3>d;++d){var l=k.coords[d];l<e[d]&&(e[d]=l,m[d]=k);l>g[d]&&(g[d]=l,b[d]=k)}k=0;g[1]-e[1]>g[0]-e[0]&&(k=1);g[2]-e[2]>g[k]-e[k]&&(k=2);if(e[k]>=g[k])f[0]=0,f[1]=0,f[2]=1;else{g=0;e=m[k];b=b[k];m=[0,0,0];e=[e.coords[0]-b.coords[0],e.coords[1]-b.coords[1],e.coords[2]-b.coords[2]];d=[0,0,0];for(k=c.next;k!==c;k=k.next)d[0]=k.coords[0]-b.coords[0],d[1]=k.coords[1]-
b.coords[1],d[2]=k.coords[2]-b.coords[2],m[0]=e[1]*d[2]-e[2]*d[1],m[1]=e[2]*d[0]-e[0]*d[2],m[2]=e[0]*d[1]-e[1]*d[0],l=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],l>g&&(g=l,f[0]=m[0],f[1]=m[1],f[2]=m[2]);0>=g&&(f[0]=f[1]=f[2]=0,f[a.normal.longAxis_(e)]=1)}};a.normal.checkOrientation_=function(a){for(var c=0,g=a.mesh.fHead,e=g.next;e!==g;e=e.next){var b=e.anEdge;if(!(0>=b.winding)){do c+=(b.org.s-b.dst().s)*(b.org.t+b.dst().t),b=b.lNext;while(b!==e.anEdge)}}if(0>c)for(a=a.mesh.vHead,c=a.next;c!==a;c=c.next)c.t=-c.t};
a.render={};a.render.renderMesh=function(c,f,g){for(var e=!1,b=-1,m=f.fHead.prev;m!==f.fHead;m=m.prev)if(m.inside){e||(c.callBeginCallback(a.primitiveType.GL_TRIANGLES),e=!0);var k=m.anEdge;a.assert(k.lNext.lNext.lNext===k,"renderMesh called with non-triangulated mesh");do{if(g){var d=k.rFace().inside?0:1;b!==d&&(b=d,c.callEdgeFlagCallback(!!b))}c.callVertexCallback(k.org.data);k=k.lNext}while(k!==m.anEdge)}e&&c.callEndCallback()};a.render.renderBoundary=function(c,f){for(var g=f.fHead.next;g!==f.fHead;g=
g.next)if(g.inside){c.callBeginCallback(a.primitiveType.GL_LINE_LOOP);var e=g.anEdge;do c.callVertexCallback(e.org.data),e=e.lNext;while(e!==g.anEdge);c.callEndCallback()}};a.sweep={};a.sweep.SENTINEL_COORD_=4*a.GLU_TESS_MAX_COORD;a.sweep.TOLERANCE_NONZERO_=!1;a.sweep.computeInterior=function(c){c.fatalError=!1;a.sweep.removeDegenerateEdges_(c);a.sweep.initPriorityQ_(c);a.sweep.initEdgeDict_(c);for(var f;null!==(f=c.pq.extractMin());){for(;;){var g=c.pq.minimum();if(null===g||!a.geom.vertEq(g,f))break;
g=c.pq.extractMin();a.sweep.spliceMergeVertices_(c,f.anEdge,g.anEdge)}a.sweep.sweepEvent_(c,f)}f=c.dict.getMin().getKey();c.event=f.eUp.org;a.sweep.doneEdgeDict_(c);a.sweep.donePriorityQ_(c);a.sweep.removeDegenerateFaces_(c.mesh);c.mesh.checkMesh()};a.sweep.addWinding_=function(a,f){a.winding+=f.winding;a.sym.winding+=f.sym.winding};a.sweep.edgeLeq_=function(c,f,g){c=c.event;f=f.eUp;g=g.eUp;if(f.dst()===c)return g.dst()===c?a.geom.vertLeq(f.org,g.org)?0>=a.geom.edgeSign(g.dst(),f.org,g.org):0<=a.geom.edgeSign(f.dst(),
g.org,f.org):0>=a.geom.edgeSign(g.dst(),c,g.org);if(g.dst()===c)return 0<=a.geom.edgeSign(f.dst(),c,f.org);f=a.geom.edgeEval(f.dst(),c,f.org);c=a.geom.edgeEval(g.dst(),c,g.org);return f>=c};a.sweep.deleteRegion_=function(c,f){f.fixUpperEdge&&a.assert(0===f.eUp.winding);f.eUp.activeRegion=null;c.dict.deleteNode(f.nodeUp);f.nodeUp=null};a.sweep.fixUpperEdge_=function(c,f){a.assert(c.fixUpperEdge);a.mesh.deleteEdge(c.eUp);c.fixUpperEdge=!1;c.eUp=f;f.activeRegion=c};a.sweep.topLeftRegion_=function(c){var f=
c.eUp.org;do c=c.regionAbove();while(c.eUp.org===f);c.fixUpperEdge&&(f=a.mesh.connect(c.regionBelow().eUp.sym,c.eUp.lNext),a.sweep.fixUpperEdge_(c,f),c=c.regionAbove());return c};a.sweep.topRightRegion_=function(a){var c=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===c);return a};a.sweep.addRegionBelow_=function(c,f,g){var e=new a.ActiveRegion;e.eUp=g;e.nodeUp=c.dict.insertBefore(f.nodeUp,e);return g.activeRegion=e};a.sweep.isWindingInside_=function(c,f){switch(c.windingRule){case a.windingRule.GLU_TESS_WINDING_ODD:return 0!==
(f&1);case a.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==f;case a.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<f;case a.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>f;case a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=f||-2>=f}a.assert(!1);return!1};a.sweep.computeWinding_=function(c,f){f.windingNumber=f.regionAbove().windingNumber+f.eUp.winding;f.inside=a.sweep.isWindingInside_(c,f.windingNumber)};a.sweep.finishRegion_=function(c,f){var g=f.eUp,e=g.lFace;e.inside=f.inside;e.anEdge=
g;a.sweep.deleteRegion_(c,f)};a.sweep.finishLeftRegions_=function(c,f,g){var e=f;for(f=f.eUp;e!==g;){e.fixUpperEdge=!1;var b=e.regionBelow(),m=b.eUp;if(m.org!==f.org){if(!b.fixUpperEdge){a.sweep.finishRegion_(c,e);break}m=a.mesh.connect(f.lPrev(),m.sym);a.sweep.fixUpperEdge_(b,m)}f.oNext!==m&&(a.mesh.meshSplice(m.oPrev(),m),a.mesh.meshSplice(f,m));a.sweep.finishRegion_(c,e);f=b.eUp;e=b}return f};a.sweep.addRightEdges_=function(c,f,g,e,b,m){var k=!0;do a.assert(a.geom.vertLeq(g.org,g.dst())),a.sweep.addRegionBelow_(c,
f,g.sym),g=g.oNext;while(g!==e);for(null===b&&(b=f.regionBelow().eUp.rPrev());;){e=f.regionBelow();g=e.eUp.sym;if(g.org!==b.org)break;g.oNext!==b&&(a.mesh.meshSplice(g.oPrev(),g),a.mesh.meshSplice(b.oPrev(),g));e.windingNumber=f.windingNumber-g.winding;e.inside=a.sweep.isWindingInside_(c,e.windingNumber);f.dirty=!0;!k&&a.sweep.checkForRightSplice_(c,f)&&(a.sweep.addWinding_(g,b),a.sweep.deleteRegion_(c,f),a.mesh.deleteEdge(b));k=!1;f=e;b=g}f.dirty=!0;a.assert(f.windingNumber-g.winding===e.windingNumber);
m&&a.sweep.walkDirtyRegions_(c,f)};a.sweep.callCombine_=function(c,f,g,e,b){var m=[f.coords[0],f.coords[1],f.coords[2]];f.data=null;f.data=c.callCombineCallback(m,g,e);null===f.data&&(b?c.fatalError||(c.callErrorCallback(a.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),c.fatalError=!0):f.data=g[0])};a.sweep.spliceMergeVertices_=function(c,f,g){var e=[null,null,null,null];e[0]=f.org.data;e[1]=g.org.data;a.sweep.callCombine_(c,f.org,e,[.5,.5,0,0],!1);a.mesh.meshSplice(f,g)};a.sweep.vertexWeights_=function(c,
f,g,e,b){var m=a.geom.vertL1dist(f,c),k=a.geom.vertL1dist(g,c),d=b+1;e[b]=.5*k/(m+k);e[d]=.5*m/(m+k);c.coords[0]+=e[b]*f.coords[0]+e[d]*g.coords[0];c.coords[1]+=e[b]*f.coords[1]+e[d]*g.coords[1];c.coords[2]+=e[b]*f.coords[2]+e[d]*g.coords[2]};a.sweep.getIntersectData_=function(c,f,g,e,b,m){var k=[0,0,0,0],d=[g.data,e.data,b.data,m.data];f.coords[0]=f.coords[1]=f.coords[2]=0;a.sweep.vertexWeights_(f,g,e,k,0);a.sweep.vertexWeights_(f,b,m,k,2);a.sweep.callCombine_(c,f,d,k,!0)};a.sweep.checkForRightSplice_=
function(c,f){var g=f.regionBelow(),e=f.eUp,b=g.eUp;if(a.geom.vertLeq(e.org,b.org)){if(0<a.geom.edgeSign(b.dst(),e.org,b.org))return!1;a.geom.vertEq(e.org,b.org)?e.org!==b.org&&(c.pq.remove(e.org.pqHandle),a.sweep.spliceMergeVertices_(c,b.oPrev(),e)):(a.mesh.splitEdge(b.sym),a.mesh.meshSplice(e,b.oPrev()),f.dirty=g.dirty=!0)}else{if(0>a.geom.edgeSign(e.dst(),b.org,e.org))return!1;f.regionAbove().dirty=f.dirty=!0;a.mesh.splitEdge(e.sym);a.mesh.meshSplice(b.oPrev(),e)}return!0};a.sweep.checkForLeftSplice_=
function(c,f){var g=f.regionBelow();c=f.eUp;var e=g.eUp;a.assert(!a.geom.vertEq(c.dst(),e.dst()));if(a.geom.vertLeq(c.dst(),e.dst())){if(0>a.geom.edgeSign(c.dst(),e.dst(),c.org))return!1;f.regionAbove().dirty=f.dirty=!0;g=a.mesh.splitEdge(c);a.mesh.meshSplice(e.sym,g);g.lFace.inside=f.inside}else{if(0<a.geom.edgeSign(e.dst(),c.dst(),e.org))return!1;f.dirty=g.dirty=!0;g=a.mesh.splitEdge(e);a.mesh.meshSplice(c.lNext,e.sym);g.rFace().inside=f.inside}return!0};a.sweep.checkForIntersect_=function(c,f){var g=
f.regionBelow(),e=f.eUp,b=g.eUp,m=e.org,k=b.org,d=e.dst(),l=b.dst(),q=new a.GluVertex;a.assert(!a.geom.vertEq(l,d));a.assert(0>=a.geom.edgeSign(d,c.event,m));a.assert(0<=a.geom.edgeSign(l,c.event,k));a.assert(m!==c.event&&k!==c.event);a.assert(!f.fixUpperEdge&&!g.fixUpperEdge);if(m===k||Math.min(m.t,d.t)>Math.max(k.t,l.t))return!1;if(a.geom.vertLeq(m,k)){if(0<a.geom.edgeSign(l,m,k))return!1}else if(0>a.geom.edgeSign(d,k,m))return!1;a.geom.edgeIntersect(d,m,l,k,q);a.assert(Math.min(m.t,d.t)<=q.t);
a.assert(q.t<=Math.max(k.t,l.t));a.assert(Math.min(l.s,d.s)<=q.s);a.assert(q.s<=Math.max(k.s,m.s));a.geom.vertLeq(q,c.event)&&(q.s=c.event.s,q.t=c.event.t);var v=a.geom.vertLeq(m,k)?m:k;a.geom.vertLeq(v,q)&&(q.s=v.s,q.t=v.t);if(a.geom.vertEq(q,m)||a.geom.vertEq(q,k))return a.sweep.checkForRightSplice_(c,f),!1;if(!a.geom.vertEq(d,c.event)&&0<=a.geom.edgeSign(d,c.event,q)||!a.geom.vertEq(l,c.event)&&0>=a.geom.edgeSign(l,c.event,q)){if(l===c.event)return a.mesh.splitEdge(e.sym),a.mesh.meshSplice(b.sym,
e),f=a.sweep.topLeftRegion_(f),e=f.regionBelow().eUp,a.sweep.finishLeftRegions_(c,f.regionBelow(),g),a.sweep.addRightEdges_(c,f,e.oPrev(),e,e,!0),!0;if(d===c.event)return a.mesh.splitEdge(b.sym),a.mesh.meshSplice(e.lNext,b.oPrev()),g=f,f=a.sweep.topRightRegion_(f),m=f.regionBelow().eUp.rPrev(),g.eUp=b.oPrev(),b=a.sweep.finishLeftRegions_(c,g,null),a.sweep.addRightEdges_(c,f,b.oNext,e.rPrev(),m,!0),!0;0<=a.geom.edgeSign(d,c.event,q)&&(f.regionAbove().dirty=f.dirty=!0,a.mesh.splitEdge(e.sym),e.org.s=
c.event.s,e.org.t=c.event.t);0>=a.geom.edgeSign(l,c.event,q)&&(f.dirty=g.dirty=!0,a.mesh.splitEdge(b.sym),b.org.s=c.event.s,b.org.t=c.event.t);return!1}a.mesh.splitEdge(e.sym);a.mesh.splitEdge(b.sym);a.mesh.meshSplice(b.oPrev(),e);e.org.s=q.s;e.org.t=q.t;e.org.pqHandle=c.pq.insert(e.org);a.sweep.getIntersectData_(c,e.org,m,d,k,l);f.regionAbove().dirty=f.dirty=g.dirty=!0;return!1};a.sweep.walkDirtyRegions_=function(c,f){for(var g=f.regionBelow();;){for(;g.dirty;)f=g,g=g.regionBelow();if(!f.dirty&&
(g=f,f=f.regionAbove(),null===f||!f.dirty))break;f.dirty=!1;var e=f.eUp,b=g.eUp;e.dst()!==b.dst()&&a.sweep.checkForLeftSplice_(c,f)&&(g.fixUpperEdge?(a.sweep.deleteRegion_(c,g),a.mesh.deleteEdge(b),g=f.regionBelow(),b=g.eUp):f.fixUpperEdge&&(a.sweep.deleteRegion_(c,f),a.mesh.deleteEdge(e),f=g.regionAbove(),e=f.eUp));if(e.org!==b.org)if(e.dst()===b.dst()||f.fixUpperEdge||g.fixUpperEdge||e.dst()!==c.event&&b.dst()!==c.event)a.sweep.checkForRightSplice_(c,f);else if(a.sweep.checkForIntersect_(c,f))break;
e.org===b.org&&e.dst()===b.dst()&&(a.sweep.addWinding_(b,e),a.sweep.deleteRegion_(c,f),a.mesh.deleteEdge(e),f=g.regionAbove())}};a.sweep.connectRightVertex_=function(c,f,g){var e=g.oNext,b=f.regionBelow(),m=f.eUp,k=b.eUp,d=!1;m.dst()!==k.dst()&&a.sweep.checkForIntersect_(c,f);a.geom.vertEq(m.org,c.event)&&(a.mesh.meshSplice(e.oPrev(),m),f=a.sweep.topLeftRegion_(f),e=f.regionBelow().eUp,a.sweep.finishLeftRegions_(c,f.regionBelow(),b),d=!0);a.geom.vertEq(k.org,c.event)&&(a.mesh.meshSplice(g,k.oPrev()),
g=a.sweep.finishLeftRegions_(c,b,null),d=!0);d?a.sweep.addRightEdges_(c,f,g.oNext,e,e,!0):(e=a.geom.vertLeq(k.org,m.org)?k.oPrev():m,e=a.mesh.connect(g.lPrev(),e),a.sweep.addRightEdges_(c,f,e,e.oNext,e.oNext,!1),e.sym.activeRegion.fixUpperEdge=!0,a.sweep.walkDirtyRegions_(c,f))};a.sweep.connectLeftDegenerate_=function(c,f,g){var e=f.eUp;if(a.geom.vertEq(e.org,g))a.assert(a.sweep.TOLERANCE_NONZERO_),a.sweep.TOLERANCE_NONZERO_&&a.sweep.spliceMergeVertices_(c,e,g.anEdge);else if(a.geom.vertEq(e.dst(),
g)){if(a.assert(a.sweep.TOLERANCE_NONZERO_),a.sweep.TOLERANCE_NONZERO_){f=a.sweep.topRightRegion_(f);var e=f.regionBelow(),b=e.eUp.sym,m=b.oNext,k=m;e.fixUpperEdge&&(a.assert(m!==b),a.sweep.deleteRegion_(c,e),a.mesh.deleteEdge(b),b=m.oPrev());a.mesh.meshSplice(g.anEdge,b);a.geom.edgeGoesLeft(m)||(m=null);a.sweep.addRightEdges_(c,f,b.oNext,k,m,!0)}}else a.mesh.splitEdge(e.sym),f.fixUpperEdge&&(a.mesh.deleteEdge(e.oNext),f.fixUpperEdge=!1),a.mesh.meshSplice(g.anEdge,e),a.sweep.sweepEvent_(c,g)};a.sweep.connectLeftVertex_=
function(c,f){var g=new a.ActiveRegion;g.eUp=f.anEdge.sym;var g=c.dict.search(g).getKey(),e=g.regionBelow(),b=g.eUp,m=e.eUp;0===a.geom.edgeSign(b.dst(),f,b.org)?a.sweep.connectLeftDegenerate_(c,g,f):(e=a.geom.vertLeq(m.dst(),b.dst())?g:e,g.inside||e.fixUpperEdge?(b=e===g?a.mesh.connect(f.anEdge.sym,b.lNext):a.mesh.connect(m.dNext(),f.anEdge).sym,e.fixUpperEdge?a.sweep.fixUpperEdge_(e,b):a.sweep.computeWinding_(c,a.sweep.addRegionBelow_(c,g,b)),a.sweep.sweepEvent_(c,f)):a.sweep.addRightEdges_(c,g,
f.anEdge,f.anEdge,null,!0))};a.sweep.sweepEvent_=function(c,f){c.event=f;for(var g=f.anEdge;null===g.activeRegion;)if(g=g.oNext,g===f.anEdge){a.sweep.connectLeftVertex_(c,f);return}f=a.sweep.topLeftRegion_(g.activeRegion);var e=f.regionBelow(),g=e.eUp,e=a.sweep.finishLeftRegions_(c,e,null);e.oNext===g?a.sweep.connectRightVertex_(c,f,e):a.sweep.addRightEdges_(c,f,e.oNext,g,g,!0)};a.sweep.addSentinel_=function(c,f){var g=new a.ActiveRegion,e=a.mesh.makeEdge(c.mesh);e.org.s=a.sweep.SENTINEL_COORD_;e.org.t=
f;e.dst().s=-a.sweep.SENTINEL_COORD_;e.dst().t=f;c.event=e.dst();g.eUp=e;g.windingNumber=0;g.inside=!1;g.fixUpperEdge=!1;g.sentinel=!0;g.dirty=!1;g.nodeUp=c.dict.insert(g)};a.sweep.initEdgeDict_=function(c){c.dict=new a.Dict(c,a.sweep.edgeLeq_);a.sweep.addSentinel_(c,-a.sweep.SENTINEL_COORD_);a.sweep.addSentinel_(c,a.sweep.SENTINEL_COORD_)};a.sweep.doneEdgeDict_=function(c){for(var f=0,g;null!==(g=c.dict.getMin().getKey());)g.sentinel||(a.assert(g.fixUpperEdge),a.assert(1===++f)),a.assert(0===g.windingNumber),
a.sweep.deleteRegion_(c,g);c.dict=null};a.sweep.removeDegenerateEdges_=function(c){for(var f=c.mesh.eHead,g,e=f.next;e!==f;e=g){g=e.next;var b=e.lNext;a.geom.vertEq(e.org,e.dst())&&e.lNext.lNext!==e&&(a.sweep.spliceMergeVertices_(c,b,e),a.mesh.deleteEdge(e),e=b,b=e.lNext);if(b.lNext===e){if(b!==e){if(b===g||b===g.sym)g=g.next;a.mesh.deleteEdge(b)}if(e===g||e===g.sym)g=g.next;a.mesh.deleteEdge(e)}}};a.sweep.initPriorityQ_=function(c){var f=new a.PriorityQ;c.pq=f;c=c.mesh.vHead;var g;for(g=c.next;g!==
c;g=g.next)g.pqHandle=f.insert(g);f.init()};a.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};a.sweep.removeDegenerateFaces_=function(c){for(var f,g=c.fHead.next;g!==c.fHead;g=f)f=g.next,g=g.anEdge,a.assert(g.lNext!==g),g.lNext.lNext===g&&(a.sweep.addWinding_(g.oNext,g),a.mesh.deleteEdge(g))};a.tessmono={};a.tessmono.tessellateMonoRegion_=function(c){c=c.anEdge;for(a.assert(c.lNext!==c&&c.lNext.lNext!==c);a.geom.vertLeq(c.dst(),c.org);c=c.lPrev());for(;a.geom.vertLeq(c.org,c.dst());c=c.lNext);
for(var f=c.lPrev(),g;c.lNext!==f;)if(a.geom.vertLeq(c.dst(),f.org)){for(;f.lNext!==c&&(a.geom.edgeGoesLeft(f.lNext)||0>=a.geom.edgeSign(f.org,f.dst(),f.lNext.dst()));)g=a.mesh.connect(f.lNext,f),f=g.sym;f=f.lPrev()}else{for(;f.lNext!==c&&(a.geom.edgeGoesRight(c.lPrev())||0<=a.geom.edgeSign(c.dst(),c.org,c.lPrev().org));)g=a.mesh.connect(c,c.lPrev()),c=g.sym;c=c.lNext}for(a.assert(f.lNext!==c);f.lNext.lNext!==c;)g=a.mesh.connect(f.lNext,f),f=g.sym};a.tessmono.tessellateInterior=function(c){for(var f,
g=c.fHead.next;g!==c.fHead;g=f)f=g.next,g.inside&&a.tessmono.tessellateMonoRegion_(g)};a.tessmono.discardExterior=function(c){for(var f,g=c.fHead.next;g!==c.fHead;g=f)f=g.next,g.inside||a.mesh.zapFace(g)};a.tessmono.setWindingNumber=function(c,f,g){for(var e,b=c.eHead.next;b!==c.eHead;b=e)e=b.next,b.rFace().inside!==b.lFace.inside?b.winding=b.lFace.inside?f:-f:g?a.mesh.deleteEdge(b):b.winding=0};a.Dict=function(c,f){this.head_=new a.DictNode;this.frame_=c;this.leq_=f};a.Dict.prototype.deleteDict_=
function(){};a.Dict.prototype.insertBefore=function(c,f){do c=c.prev;while(null!==c.key&&!this.leq_(this.frame_,c.key,f));f=new a.DictNode(f,c.next,c);c.next.prev=f;return c.next=f};a.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};a.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};a.Dict.prototype.search=function(a){var c=this.head_;do c=c.next;while(null!==c.key&&!this.leq_(this.frame_,a,c.key));return c};a.Dict.prototype.getMin=function(){return this.head_.next};
a.Dict.prototype.getMax=function(){return this.head_.prev};a.DictNode=function(a,f,g){this.key=a||null;this.next=f||this;this.prev=g||this};a.DictNode.prototype.getKey=function(){return this.key};a.DictNode.prototype.getSuccessor=function(){return this.next};a.DictNode.prototype.getPredecessor=function(){return this.prev};a.GluTesselator=function(){this.state_=a.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=a.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};a.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};a.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(a.GluTesselator.tessState_.T_DORMANT)};a.GluTesselator.prototype.gluTessProperty=function(c,f){switch(c){case a.gluEnum.GLU_TESS_TOLERANCE:return;
case a.gluEnum.GLU_TESS_WINDING_RULE:switch(f){case a.windingRule.GLU_TESS_WINDING_ODD:case a.windingRule.GLU_TESS_WINDING_NONZERO:case a.windingRule.GLU_TESS_WINDING_POSITIVE:case a.windingRule.GLU_TESS_WINDING_NEGATIVE:case a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=f;return}break;case a.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!f;return;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(a.gluEnum.GLU_INVALID_VALUE)};a.GluTesselator.prototype.gluGetTessProperty=
function(c){switch(c){case a.gluEnum.GLU_TESS_TOLERANCE:return 0;case a.gluEnum.GLU_TESS_WINDING_RULE:return c=this.windingRule,a.assert(c===a.windingRule.GLU_TESS_WINDING_ODD||c===a.windingRule.GLU_TESS_WINDING_NONZERO||c===a.windingRule.GLU_TESS_WINDING_POSITIVE||c===a.windingRule.GLU_TESS_WINDING_NEGATIVE||c===a.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),c;case a.gluEnum.GLU_TESS_BOUNDARY_ONLY:return a.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM)}return!1};
a.GluTesselator.prototype.gluTessNormal=function(a,f,g){this.normal_[0]=a;this.normal_[1]=f;this.normal_[2]=g};a.GluTesselator.prototype.gluTessCallback=function(c,f){f=f?f:null;switch(c){case a.gluEnum.GLU_TESS_BEGIN:case a.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=f;break;case a.gluEnum.GLU_TESS_EDGE_FLAG:case a.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=f;break;case a.gluEnum.GLU_TESS_VERTEX:case a.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=f;break;case a.gluEnum.GLU_TESS_END:case a.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
f;break;case a.gluEnum.GLU_TESS_ERROR:case a.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=f;break;case a.gluEnum.GLU_TESS_COMBINE:case a.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=f;break;case a.gluEnum.GLU_TESS_MESH:this.meshCallback_=f;break;default:this.callErrorCallback(a.gluEnum.GLU_INVALID_ENUM)}};a.GluTesselator.prototype.gluTessVertex=function(c,f){var g=!1,e=[0,0,0];this.requireState_(a.GluTesselator.tessState_.T_IN_CONTOUR);for(var b=0;3>b;++b){var m=c[b];m<-a.GLU_TESS_MAX_COORD&&
(m=-a.GLU_TESS_MAX_COORD,g=!0);m>a.GLU_TESS_MAX_COORD&&(m=a.GLU_TESS_MAX_COORD,g=!0);e[b]=m}g&&this.callErrorCallback(a.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(e,f)};a.GluTesselator.prototype.gluTessBeginPolygon=function(c){this.requireState_(a.GluTesselator.tessState_.T_DORMANT);this.state_=a.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new a.GluMesh;this.polygonData_=c};a.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=a.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};a.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=a.GluTesselator.tessState_.T_IN_POLYGON};a.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(a.GluTesselator.tessState_.T_IN_POLYGON);this.state_=a.GluTesselator.tessState_.T_DORMANT;a.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);a.sweep.computeInterior(this);
if(!this.fatalError){var c=this.mesh;this.boundaryOnly_?a.tessmono.setWindingNumber(c,1,!0):a.tessmono.tessellateInterior(c);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?a.render.renderBoundary(this,this.mesh):a.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){a.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}a.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};a.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};a.GluTesselator.prototype.gotoState_=function(c){for(;this.state_!==c;)if(this.state_<c)switch(this.state_){case a.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case a.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case a.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case a.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(a.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};a.GluTesselator.prototype.addVertex_=function(c,f){var g=this.lastEdge_;null===g?(g=a.mesh.makeEdge(this.mesh),a.mesh.meshSplice(g,g.sym)):(a.mesh.splitEdge(g),g=g.lNext);g.org.data=f;g.org.coords[0]=c[0];g.org.coords[1]=c[1];g.org.coords[2]=c[2];g.winding=1;g.sym.winding=-1;this.lastEdge_=g};a.GluTesselator.prototype.callBeginCallback=
function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callEdgeFlagCallback=function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};a.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};a.GluTesselator.prototype.callCombineCallback=function(a,f,g){return this.combineCallback_?
this.combineCallback_(a,f,g,this.polygonData_)||null:null};a.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};a.GluFace=function(a,f){this.next=a||this;this.prev=f||this;this.anEdge=null;this.inside=!1};a.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};a.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};a.GluHalfEdge.prototype.dst=function(){return this.sym.org};
a.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};a.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};a.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};a.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};a.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};a.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};a.GluMesh=function(){this.vHead=new a.GluVertex;this.fHead=new a.GluFace;this.eHead=new a.GluHalfEdge;this.eHeadSym=
new a.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};a.GluMesh.prototype.checkMesh=function(){if(a.DEBUG){var c=this.fHead,f=this.vHead,g=this.eHead,e,b;for(e=e=c;(b=e.next)!==c;e=b){a.assert(b.prev===e);e=b.anEdge;do a.assert(e.sym!==e),a.assert(e.sym.sym===e),a.assert(e.lNext.oNext.sym===e),a.assert(e.oNext.sym.lNext===e),a.assert(e.lFace===b),e=e.lNext;while(e!==b.anEdge)}a.assert(b.prev===e&&null===b.anEdge);for(e=e=f;(c=e.next)!==f;e=c){a.assert(c.prev===e);e=c.anEdge;
do a.assert(e.sym!==e),a.assert(e.sym.sym===e),a.assert(e.lNext.oNext.sym===e),a.assert(e.oNext.sym.lNext===e),a.assert(e.org===c),e=e.oNext;while(e!==c.anEdge)}a.assert(c.prev===e&&null===c.anEdge&&null===c.data);for(f=f=g;(e=f.next)!==g;f=e)a.assert(e.sym.next===f.sym),a.assert(e.sym!==e),a.assert(e.sym.sym===e),a.assert(null!==e.org),a.assert(null!==e.dst()),a.assert(e.lNext.oNext.sym===e),a.assert(e.oNext.sym.lNext===e);a.assert(e.sym.next===f.sym&&e.sym===this.eHeadSym&&e.sym.sym===e&&null===
e.org&&null===e.dst()&&null===e.lFace&&null===e.rFace())}};a.GluVertex=function(a,f){this.next=a||this;this.prev=f||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};a.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new a.PriorityQHeap};a.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};a.PriorityQ.prototype.init=function(){this.order_=[];for(var c=0;c<this.size_;c++)this.order_[c]=c;
c=function(c){return function(e,b){return a.geom.vertLeq(c[e],c[b])?1:-1}}(this.verts_);this.order_.sort(c);this.initialized_=!0;this.heap_.init();if(a.DEBUG)for(var f=0+this.size_-1,c=0;c<f;++c)a.assert(a.geom.vertLeq(this.verts_[this.order_[c+1]],this.verts_[this.order_[c]]))};a.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var c=this.size_++;this.verts_[c]=a;return-(c+1)};a.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var c=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(a.geom.vertLeq(f,c))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return c};a.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var c=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(a.geom.vertLeq(f,c))return f}return c};a.PriorityQ.prototype.remove=function(c){if(0<=
c)this.heap_.remove(c);else for(c=-(c+1),a.assert(c<this.verts_.length&&null!==this.verts_[c]),this.verts_[c]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};a.PriorityQHeap=function(){this.heap_=a.PriorityQHeap.reallocNumeric_([0],a.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=a.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};a.PriorityQHeap.INIT_SIZE_=32;a.PriorityQHeap.reallocNumeric_=
function(a,f){for(var c=Array(f),e=0;e<a.length;e++)c[e]=a[e];for(;e<f;e++)c[e]=0;return c};a.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);this.initialized_=!0};a.PriorityQHeap.prototype.insert=function(c){var f=++this.size_;2*f>this.max_&&(this.max_*=2,this.handles_=a.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var g;0===this.freeList_?g=f:(g=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[g]=c;this.handles_[g]=f;
this.heap_[f]=g;this.initialized_&&this.floatUp_(f);return g};a.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};a.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};a.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,f=this.verts_,g=this.handles_,e=a[1],b=f[e];0<this.size_&&(a[1]=a[this.size_],g[a[1]]=1,f[e]=null,g[e]=this.freeList_,this.freeList_=e,0<--this.size_&&this.floatDown_(1));return b};a.PriorityQHeap.prototype.remove=function(c){var f=
this.heap_,g=this.verts_,e=this.handles_;a.assert(1<=c&&c<=this.max_&&null!==g[c]);var b=e[c];f[b]=f[this.size_];e[f[b]]=b;b<=--this.size_&&(1>=b?this.floatDown_(b):a.geom.vertLeq(g[f[b>>1]],g[f[b]])?this.floatDown_(b):this.floatUp_(b));g[c]=null;e[c]=this.freeList_;this.freeList_=c};a.PriorityQHeap.prototype.floatDown_=function(c){for(var f=this.heap_,g=this.verts_,e=this.handles_,b=f[c];;){var m=c<<1;m<this.size_&&a.geom.vertLeq(g[f[m+1]],g[f[m]])&&(m+=1);a.assert(m<=this.max_);var k=f[m];if(m>
this.size_||a.geom.vertLeq(g[b],g[k])){f[c]=b;e[b]=c;break}f[c]=k;e[k]=c;c=m}};a.PriorityQHeap.prototype.floatUp_=function(c){for(var f=this.heap_,g=this.verts_,e=this.handles_,b=f[c];;){var m=c>>1,k=f[m];if(0===m||a.geom.vertLeq(g[k],g[b])){f[c]=b;e[b]=c;break}f[c]=k;e[k]=c;c=m}};a.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};a.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
a.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return a})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(a,c,f){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;return this._resolver?this._resolver.promise.then(function(){return a.acquire()}):
(this._resolver=f.createResolver(),f.resolve())};a.prototype.release=function(){var a=this._resolver;this._resolver=null;a.resolve()};return a}();c.default=a;c.withLock=function(a,c,b){return a.acquire().then(function(){return c(b)}).then(function(){return a.release()}).catch(function(b){a.release();throw b;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x){Object.defineProperty(c,"__esModule",{value:!0});var p=new f.default,z=new f.default;a=function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){p.reset();for(var c=e.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),d=0;d<c.length;d++)for(var f=c[d],h=0,k=f;h<k.length;h++){var l=k[h];l&&p.needMore(l.geometryType,l.meshData?l.meshData.vertexCount:l.vertexCount,l.meshData?l.meshData.indexData.length:l.indexCount)}h=
c.length;d=new g;for(k=0;k<h;++k){d.geometries[k].indexBuffer=new Uint32Array(Math.round(1.15*p.indicesFor(k)));var l=[],q;for(q in this.tileBufferData.geometries[k].vertexBuffer)l.push(this.tileBufferData.geometries[k].vertexBuffer[q].stride);var l=a._computeVertexAlignment(l),f=Math.round(1.15*p.verticesFor(k)),l=a._align(f,l),r;for(r in this.tileBufferData.geometries[k].vertexBuffer)f=this.tileBufferData.geometries[k].vertexBuffer[r].stride,d.geometries[k].vertexBuffer[r]={stride:f,data:m.allocateTypedArrayBuffer(l,
f)}}z.reset();this.tileDisplayData.displayList.clear();for(k=0;k<h;++k){f=c[k];q=0;for(r=f;q<r.length;q++){l=r[q];if(l.meshData)l.writeMeshDataToBuffers(z.verticesFor(k),d.geometries[k].vertexBuffer,z.indicesFor(k),d.geometries[k].indexBuffer),l.meshData=null;else{var v=this.tileBufferData.geometries[k].vertexBuffer,x=this.tileBufferData.geometries[k].indexBuffer,K=d.geometries[k].vertexBuffer,E=d.geometries[k].indexBuffer,I=z.verticesFor(k),G=z.indicesFor(k);b.copyMeshData(I,G,K,E,l,v,x);l.vertexFrom=
I;l.indexFrom=G}z.needMore(k,l.vertexCount,l.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(f)}if(this.tileDisplayData.displayList.unified)for(c=0,h=this.tileDisplayData.displayObjects;c<h.length;c++)this.tileDisplayData.displayList.addToList(h[c].displayRecords);this.tileBufferData=d};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=
c.vertexBuffer[d].stride}return a};a.prototype.clone=function(){var b=new a;b.tileBufferData=this.tileBufferData.clone();b.tileDisplayData=this.tileDisplayData.clone();return b};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new x.default(Int32Array,
this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};a.decode=function(b){var c=v.deserializeList(new q.default(b.displayObjects),k),d={},e;for(e in b.vertexBuffersMap)d[e]=l.VertexBuffers.decode(b.vertexBuffersMap[e]);return a.fromMeshData({displayObjects:c,vertexBuffersMap:d})};a.fromMeshData=function(b){var c=new a,d=new e.default,f=new g;d.displayObjects=b.displayObjects;for(var k in b.vertexBuffersMap){var l=b.vertexBuffersMap[k];f.geometries[k].indexBuffer=
l.indexBuffer;f.geometries[k].vertexBuffer=l.namedBuffers}c.tileDisplayData=d;c.tileBufferData=f;return c};a.bind=function(b,c){var d=new a;d.tileDisplayData=b;d.tileBufferData=c;return d};a.create=function(b,c){var f=new a;f.tileDisplayData=new e.default;f.tileDisplayData.displayObjects=b;for(var h=[0,0,0,0,0],k=[0,0,0,0,0],l=[[],[],[],[],[]],n=0;n<b.length;n++)for(var p=0,q=b[n].displayRecords;p<q.length;p++){var r=q[p];l[r.geometryType].push(r);h[r.geometryType]+=r.meshData.vertexCount;k[r.geometryType]+=
r.meshData.indexData.length}b=new g;c=[c.fill||{},c.line||{},c.icon||{},c.text||{},c.label||{}];for(n=0;5>n;n++){var p=new Uint32Array(k[n]),q=c[n],r=h[n],w={},v=void 0;for(v in q){var x={data:m.allocateTypedArrayBuffer(r,q[v]),stride:q[v]};w[v]=x}q=w;d.writeAllMeshDataToBuffers(l[n],q,p);b.geometries[n]={indexBuffer:p,vertexBuffer:q}}f.tileBufferData=b;return f};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=
a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return a}();c.TileData=a})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._byGeometryType=null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?
this._byGeometryType[a].vertices:0};a.prototype.indicesFor=function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,c,b){if(c||b)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=c,a.indices+=b};return a}();c.default=a})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports",
"./Utils"],function(a,c,f){return function(){function a(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}a.prototype.clone=function(){for(var c=new a,b=0;b<this.geometries.length;b++){var f=this.geometries[b],g=c.geometries[b];g.indexBuffer=f.indexBuffer.slice();g.vertexBuffer={};for(var d in f.vertexBuffer){var l=f.vertexBuffer[d],q=l.stride;
g.vertexBuffer[d]={data:l.data.slice(),stride:q}}}return c};a.deserialize=function(c){for(var b=new a,e=0;5>e;++e){b.geometries[e].indexBuffer=new Uint32Array(c.geometries[e].indexBuffer);b.geometries[e].vertexBuffer={};for(var g in c.geometries[e].vertexBuffer)b.geometries[e].vertexBuffer[g]={data:f.allocateTypedArrayBufferwithData(c.geometries[e].vertexBuffer[g].data,c.geometries[e].vertexBuffer[g].stride),stride:c.geometries[e].vertexBuffer[g].stride}}return b};a.prototype.serialize=function(){for(var a=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},b=0;5>b;++b)for(var c in this.geometries[b].vertexBuffer)a.geometries[b].vertexBuffer[c]={data:this.geometries[b].vertexBuffer[c].data.buffer,stride:this.geometries[b].vertexBuffer[c].stride};
return a};a.prototype.getBuffers=function(){for(var a=[],b=0;5>b;++b){a.push(this.geometries[b].indexBuffer.buffer);for(var c in this.geometries[b].vertexBuffer)a.push(this.geometries[b].vertexBuffer[c].data.buffer)}return a};return a}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(a,c,f,g,e){function b(a){for(var b=[[],[],[],[],[]],c=0;c<a.length;c++)for(var e=0,f=a[c].displayRecords;e<
f.length;e++){var g=f[e];b[g.geometryType].push(g)}return b}Object.defineProperty(c,"__esModule",{value:!0});c.groupRecordsByGeometryType=b;a=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var c=b[a];this._displayObjectRegistry.set(c.id,c)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new f(a);if(a){a=0;for(var c=this.displayObjects;a<c.length;a++)for(var e=0,g=c[a].displayRecords;e<g.length;e++)this._displayList.addToList(g[e])}else for(a=b(this.displayObjects),c=a.length,e=0;e<c;++e)this._displayList.addToList(a[e])};a.prototype.clone=function(){var b=new a;this.displayObjects&&(b.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return b};a.prototype.serialize=function(a){e.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),c=new Map,e=0;e<b.length;++e){var f=g.deserialize(a);b[e]=f;c.set(f.id,f)}this.displayObjects=b;this._displayList=null;this._displayObjectRegistry=c};a.deserialize=function(b){var c=new a;c._deserializeObjects(b);return c};return a}();c.default=a})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(a,c,f,g,e){function b(a,b,c){for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(d)):a.push.apply(a,d)}var m=g.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");a=new Map;a.set(e.WGLDrawPhase.MAP,[e.WGLGeometryType.FILL,e.WGLGeometryType.LINE,e.WGLGeometryType.MARKER,e.WGLGeometryType.TEXT]);a.set(e.WGLDrawPhase.LABEL,[e.WGLGeometryType.LABEL]);a.set(e.WGLDrawPhase.LABEL_ALPHA,
[e.WGLGeometryType.LABEL]);a=function(){function a(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b,c){if(this.unified)for(var d=0,e=this.symbolLevels;d<e.length;d++)for(var f=0,g=e[d].zLevels;f<g.length;f++){var h=g[f].geometryDPInfo,k;for(k in h)if(h[k])for(var l=0,m=h[k];l<m.length;l++){var p=m[l],q=a.painter.getGeometryBrush(p.geometryType),x=b.getGeometry(p.geometryType);q.prepareState(a,b);q.drawGeometry(a,b,p,x,c)}}};Object.defineProperty(a.prototype,
"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<
d.length;c++)for(var e=0,f=d[c].zLevels;e<f.length;e++){var g=f[e].geometryDPInfo,h=this.getDPInfoType(a);if(g[h])for(var k=0,g=g[h];k<g.length;k++)b(g[k])}};a.prototype.clone=function(){for(var b=new a(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)b.symbolLevels.push(d[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,e=0;e<c;++e){var f=b[e];if(f.geometryType===a.geometryType&&
d>f.indexFrom&&d<=f.indexFrom+f.indexCount)return d<f.indexFrom+f.indexCount&&(a=new k,a.geometryType=f.geometryType,a.materialKey=f.materialKey,a.indexFrom=d,a.indexCount=f.indexFrom+f.indexCount-d,b.splice(e+1,0,a),f.indexCount=d-f.indexFrom),e}};a.prototype._addToList=function(a,c){var d=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);c=null!=c?c:d.length-1;var e=0<=c&&c<d.length?d[c]:null;null===e||e.materialKey!==a.materialKey||e.indexFrom+e.indexCount!==a.indexFrom||this.unified&&
e.geometryType!==a.geometryType?(e=new k,e.indexFrom=a.indexFrom,e.indexCount=a.indexCount,e.materialKey=a.materialKey,e.geometryType=a.geometryType,b(d,c+1,0,e)):e.indexCount+=a.indexCount};a.prototype._removeFromList=function(a){for(var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),d=c.length,e=void 0,f=0;f<d;++f){var g=c[f];if(a.indexFrom+a.indexCount>g.indexFrom&&a.indexFrom<g.indexFrom+g.indexCount&&(!this.unified||g.geometryType===a.geometryType)){e=f;break}}if(void 0!==e){g=
c[e];if(a.indexFrom===g.indexFrom)return g.indexCount-=a.indexCount,g.indexFrom+=a.indexCount,0===g.indexCount&&b(c,e,1),e-1;if(a.indexFrom+a.indexCount===g.indexFrom+g.indexCount)return g.indexCount-=a.indexCount,0===g.indexCount?(b(c,e,1),e-1):e;var d=g.indexFrom,f=a.indexFrom-g.indexFrom,l=a.indexCount;a=g.indexFrom+g.indexCount-(a.indexFrom+a.indexCount);g.indexCount=f;var h=new k;h.geometryType=g.geometryType;h.materialKey=g.materialKey;h.indexFrom=d+f+l;h.indexCount=a;b(c,e+1,0,h);return e}return null};
a.prototype._getDisplayList=function(a,b,c){for(var f,g=this.symbolLevels.length,k=0;k<g;k++)if(this.symbolLevels[k].symbolLevel===a){f=this.symbolLevels[k];break}f||(f=new q,f.symbolLevel=a,this.symbolLevels.push(f));var m;a=f.zLevels.length;for(g=0;g<a;g++)if(f.zLevels[g].zLevel===b){m=f.zLevels[g];break}m||(m=new l,m.geometryDPInfo=new d,m.zLevel=b,f.zLevels.push(m));var h;if(this.unified)m.geometryDPInfo.unified||(m.geometryDPInfo.unified=[]),h=m.geometryDPInfo.unified;else switch(c){case e.WGLGeometryType.FILL:m.geometryDPInfo.fill||
(m.geometryDPInfo.fill=[]);h=m.geometryDPInfo.fill;break;case e.WGLGeometryType.LINE:m.geometryDPInfo.line||(m.geometryDPInfo.line=[]);h=m.geometryDPInfo.line;break;case e.WGLGeometryType.MARKER:m.geometryDPInfo.marker||(m.geometryDPInfo.marker=[]);h=m.geometryDPInfo.marker;break;case e.WGLGeometryType.TEXT:m.geometryDPInfo.text||(m.geometryDPInfo.text=[]);h=m.geometryDPInfo.text;break;case e.WGLGeometryType.LABEL:m.geometryDPInfo.label||(m.geometryDPInfo.label=[]);h=m.geometryDPInfo.label;break;
default:console.error("Trying to add a record with geometry type '"+c+"'.")}return h};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case e.WGLGeometryType.FILL:return"fill";case e.WGLGeometryType.LINE:return"line";case e.WGLGeometryType.MARKER:return"marker";case e.WGLGeometryType.TEXT:return"text";case e.WGLGeometryType.LABEL:return"label";default:m.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var k=function(){function a(){this.materialKey=
null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),d=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&
this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),l=function(){function a(){this.geometryDPInfo=new d}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),q=function(){function a(){this.zLevels=[]}a.prototype.clone=
function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());return b};return a}();return a})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};
a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();c.default=a})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(a,c,f,g,e,b,m,k,d,l,q,v){function x(a,b){var c=b.length;
if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function p(a,c,d){void 0===d&&(d=0);if(b.isNone(c))a[d+0]=0,a[d+1]=0,a[d+2]=0,a[d+3]=0;else{var e=c.g,f=c.b,g=c.a;a[d+0]=c.r*g/255;a[d+1]=e*g/255;a[d+2]=f*g/255;a[d+3]=g}}Object.defineProperty(c,"__esModule",{value:!0});var z=function(a,b,c){for(var d=c*=16,e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},r=d.mat4f32.create();
a=function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*q.MAX_FILTERS);this.insideOpacity=1;this.outsideEffect=new Float32Array(16*q.MAX_FILTERS);this.outsideOpacity=
1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<q.MAX_FILTERS;a++)z(this.insideEffect,r,a),z(this.outsideEffect,r,a)}Object.defineProperty(a.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});a.prototype.getSizeVVFieldStops=function(a){var c=this._vvSizeFieldStops;switch(c.type){case "static":return c;case "level-dependent":return b.unwrapOr(c.levels[a],function(){var d=Infinity,e=0,f;for(f in c.levels){var g=parseFloat(f),k=Math.abs(a-g);k<d&&(d=k,e=g)}if(Infinity===d)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};
d=Math.pow(2,(a-e)/2);e=b.expect(c.levels[e]);f=new Float32Array(e.values);f[2]*=d;f[3]*=d;return{sizes:b.unwrap(e.sizes),values:f}})}};Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.update=function(a){b.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,a)};a.prototype.setInfo=function(a,c,d){var e=this;b.isSome(d)?(d.forEach(function(a,b){return e._updateEffects(b,a)}),this.effectCount=
d.length):this.effectCount=0;this._vvInfo=c;switch(a.type){case "dot-density":this._updateDotDensityInfo(a)}};a.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:e("esri-webgl-texture-float")}};a.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};a.prototype._updateEffects=function(a,c){a+=1;if(b.isSome(c)&&c.filter&&
c.filter.enabled){this.outsideLabelsVisible=c.excludedLabelsVisible;var d=c.parsedIncludedEffect;c=c.parsedExcludedEffect;b.isSome(d)?(z(this.insideEffect,d.getColorMatrix(),a),this.insideOpacity=d.getOpacity()):(z(this.insideEffect,r,a),this.insideOpacity=1);b.isSome(c)?(z(this.outsideEffect,c.getColorMatrix(),a),this.outsideOpacity=c.getOpacity()):(z(this.outsideEffect,r,a),this.outsideOpacity=1)}else z(this.insideEffect,r,a),z(this.outsideEffect,r,a),this.outsideOpacity=this.insideOpacity=1};a.prototype._updateVisualVariables=
function(a,b){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(a){var d=a.size;if(d){c.vvSizeEnabled=!0;if(d.minMaxValue){var e=d.minMaxValue,f=void 0,g=void 0;v.isDefined(e.minSize)&&v.isDefined(e.maxSize)&&(v.isNumber(e.minSize)&&v.isNumber(e.maxSize)?(f=m.pt2px(e.minSize),g=m.pt2px(e.maxSize)):(g=b.scale,f=m.pt2px(x(g,e.minSize.stops)),g=m.pt2px(x(g,e.maxSize.stops))));this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,
f,g])}d.scaleStops&&(this.vvSizeScaleStopsValue=m.pt2px(x(b.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=k.getMetersPerUnitForSR(b.spatialReference)/l.meterIn[d.unitValue.unit]/b.resolution);d.fieldStops&&(this._vvSizeFieldStops=d.fieldStops)}if(b=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)c.vvRotationEnabled=
!0,c.vvRotationType=a.type}};a.prototype._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var c=0;c<q.DOT_DENSITY_MAX_FIELDS;c++){var d=c>=b.length?new g([0,0,0,0]):b[c].color;p(this.ddColors,d,4*c)}for(c=0;8>c;c++)this.ddActiveDots[c]=c<a.attributes.length?1:0;p(this.ddBackgroundColor,a.backgroundColor)};return a}();c.WGLRendererInfo=a})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./definitions ./DirtyMap ./DisplayRecordStore ./Fader ./TiledDisplayObject ./WGLBuffers".split(" "),
function(a,c,f,g,e,b,m,k,d,l,q,v,x){Object.defineProperty(c,"__esModule",{value:!0});var p=new Set;a=function(a){function c(b,c,f){void 0===f&&(f=!1);b=a.call(this,b,c,[k.TILE_SIZE,k.TILE_SIZE])||this;b._data=null;b._displayList=null;b._wglBuffers=null;b._dirtyMap=new d.default;b._labelIndex=null;b._dirty=!0;b.fader=new q.default;b._ensureCorrectZOrder=f;b.transforms.labelMat2d=e.mat2df32.create();return b}f(c,a);c.prototype.destroy=function(){this.clear()};Object.defineProperty(c.prototype,"displayObjects",
{get:function(){return this._data.tileDisplayData.displayObjects},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"labelIndex",{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});c.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};c.prototype.getDisplayList=function(){return this._data&&this._displayList};Object.defineProperty(c.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});c.prototype.setTransform=function(c,d){a.prototype.setTransform.call(this,
c,d);var e=this.transforms.labelMat2d;d=c.getScreenTransform(e,d);var f=m.vec2f32.create();b.vec2.transformMat2d(f,this.coords,d);g.mat2d.identity(e);g.mat2d.translate(e,e,f);g.mat2d.multiply(e,c.viewMat2d,e)};c.prototype.setData=function(a,b,c){var e=a.addOrUpdate,f=a.remove;!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:f},b,c):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new d.default,
this._dispRecStore=l.default.fromTileData(e,this._dirtyMap),this._data=e,this._readyTileIfNoLabels(b,c),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):(this.clear(),this.ready());this.emit("change")};c.prototype.commitChanges=function(){this.fader.step()||this.requestRender();this._wglBuffers||(this._wglBuffers=new x.default(this.stage.context));this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap);this._displayList=this._data.tileDisplayData.displayList.clone();
this._dirtyMap.markAllClean()};c.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)};c.prototype.attach=function(){return!0};c.prototype._readyTileIfNoLabels=function(a,b){a&&this._rebuildLabelIndex();this.isDirty=a&&b?!0:!1};c.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=l.default.fromTileData(this._data,this._dirtyMap));
this._readyTileIfNoLabels(b,c);this.requestRender()};c.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<d.length;c++)this._insertIntoLabelIndex(d[c])};c.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};c.prototype._initLabelIndex=function(){for(var a=[],b=0;b<k.TILE_SIZE/k.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<k.TILE_SIZE/
k.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};c.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var f=c[e];null!=f.insertAfter&&d.push(f.id)}for(f=0;f<d.length;f++){var g=d[f];if(e=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var k=0,l=e.displayRecords;k<l.length;k++)this._dispRecStore.delete(l[k]);
this._data.tileDisplayData.displayObjectRegistry.delete(g);e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,1)}}for(d=0;d<c.length;d++){f=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(f.id);g=void 0;if(e){k=e.displayRecords;e.set(f);e.displayRecords=k;k=e.displayRecords.length;for(l=0;l<k;++l){var m=e.displayRecords[l],q=f.displayRecords[l];if(l>=f.displayRecords.length||m.geometryType!==q.geometryType||m.symbolLevel!==q.symbolLevel||
m.zOrder!==q.zOrder||m.materialKey!==q.materialKey)this._dispRecStore.delete(e.displayRecords[l]),l<f.displayRecords.length&&(e.displayRecords[l]=void 0)}e.displayRecords.length=f.displayRecords.length;e.metrics=f.metrics}else if(e=f.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,e),l=void 0,m=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(g={},0<=e.insertAfter?(k=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(l=m.indexOf(k)+
1,l<m.length?m.splice(l,0,e):(m.push(e),l=m.length)):(m.push(e),l=m.length):(m.unshift(e),l=0)):(m.push(e),l=m.length),g){q=void 0;if(this._data.tileDisplayData.displayList.unified)q=0<f.displayRecords.length?1:0;else{p.clear();for(var q=0,r=f.displayRecords;q<r.length;q++)k=this._data.tileDisplayData.displayList.getDPInfoType(r[q].geometryType),p.add(k);q=p.size}r=0;for(--l;0<=l&&r<q;--l)for(var v=m[l].displayRecords.length-1;0<=v&&r<q;--v){var x=m[l].displayRecords[v],k=this._data.tileDisplayData.displayList.getDPInfoType(x.geometryType);
g[k]||(g[k]=x,++r)}}r=f.displayRecords.length;for(l=0;l<r;++l){q=f.displayRecords[l];(m=e.displayRecords[l])?(m.meshData=q.meshData,m.materialKey=q.materialKey):(m=q.copy(),m.vertexFrom=void 0,m.indexFrom=void 0,e.displayRecords[l]=m);var v=q.geometryType,k=this._data.tileDisplayData.displayList.getDPInfoType(v),x=a.addOrUpdate.tileBufferData.geometries[v],v=x.vertexBuffer,x=x.indexBuffer,w=void 0;g&&(w=g[k]?this._data.tileDisplayData.displayList.splitAfter(g[k]):-1);b=this._dispRecStore.setMeshData(m,
q,v,x,w)&&b;g&&null!=m.indexFrom&&null!=m.indexFrom&&(g[k]=m)}}return b};return c}(v.TiledDisplayObject);c.WGLTile=a})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(a,c,f){function g(a,b,c){if(!a.allDirty)if(null!=a.from&&null!=a.count){var e=Math.min(a.from,b);b=Math.max(a.from+a.count,b+c)-e;a.from=e;a.count=b}else a.from=b,a.count=c}Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){this._dirties=f.createGeometryData(function(){return{indices:{from:null,
count:null,allDirty:!1}}},function(){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.hasDirty=function(){for(var a=0,c=this._dirties;a<c.length;a++){var e=c[a];if(null!==e.data.indices.count||e.data.indices.allDirty)return!0}return!1};a.prototype.markAllClean=function(){for(var a=0,c=this._dirties;a<c.length;a++){var e=c[a];e.data.indices.from=null;e.data.indices.count=null;e.data.indices.allDirty=!1;for(var d in e.buffers)e.buffers[d].data.vertices.from=null,e.buffers[d].data.vertices.count=
null,e.buffers[d].data.vertices.allDirty=!1}};a.prototype.markAllDirty=function(){for(var a=0,c=this._dirties;a<c.length;a++){var e=c[a];e.data.indices.allDirty=!0;for(var d in e.buffers)e.buffers[d].data.vertices.allDirty=!0}};a.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var c=this._dirties[b],d={},e;for(e in c.buffers){var f=c.buffers[e].data.vertices;if(f.allDirty||null!=f.from&&null!=f.count&&0<f.count)d[e]=f}c=c.data.indices;f=void 0;f=c.allDirty||null!=c.from&&null!=
c.count&&0<c.count?{indices:c,vertices:d}:{indices:null,vertices:d};(f.indices||0<Object.keys(f).length)&&a(f,b)}};a.prototype.markDirtyIndices=function(a,c,e){g(this._dirties[a].data.indices,c,e)};a.prototype.markDirtyVertices=function(a,c,e,d){g(this._dirties[a].buffers[c].data.vertices,e,d)};return a}();c.default=a})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(a,c,f,g,e){function b(a){a=a.getStrides();
for(var b={},c=0;c<a.length;c++)b[m[c]]=a[c];return b}Object.defineProperty(c,"__esModule",{value:!0});var m=["FILL","LINE","MARKER","TEXT","LABEL"];a=function(){function a(a,b,c,f){this._strides=a;this._displayList=b;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=c;for(var d in a){this._freeListsAndStorage[d]={vtxFreeList:f?new g.FreeList(f):null,idxFreeList:f?new g.FreeList(f):null,vertexBuffers:{},indexBuffer:f?new Uint32Array(f):null};for(var k in a[d])this._freeListsAndStorage[d].vertexBuffers[k]=
{data:f?e.allocateTypedArrayBuffer(f,a[d][k]):null,stride:a[d][k]}}}a.fromTileData=function(c,f){var d=b(c),k=[0,0,0,0,0],l=[0,0,0,0,0],p=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){p.push(a)});for(var z=0;z<p.length;z++)for(var r=0,w=p[z].displayRecords;r<w.length;r++){var n=w[r];k[n.geometryType]=Math.max(k[n.geometryType],n.vertexFrom+n.vertexCount);l[n.geometryType]=Math.max(l[n.geometryType],n.indexFrom+n.indexCount)}f=new a(d,c.tileDisplayData.displayList,f,null);for(d=0;d<
c.tileBufferData.geometries.length;++d){var z=k[d],w=l[d],n=c.tileBufferData.geometries[d],r=f._storageFor(m[d]),u=c.tileBufferData.geometries[d].indexBuffer;r.indexBuffer=u;r.idxFreeList=new g.FreeList(u.length);r.idxFreeList.allocate(w);var w=void 0,h;for(h in n.vertexBuffer)n=c.tileBufferData.geometries[d].vertexBuffer[h],r.vertexBuffers[h].data=n.data,r.vertexBuffers[h].stride=n.stride,u=e.strideToPackingFactor(n.stride),n=n.data.length*u/n.stride,w||(w=n);r.vtxFreeList=new g.FreeList(w);r.vtxFreeList.allocate(z)}return f};
a.prototype.delete=function(a){var b=m[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};a.prototype.setMeshData=function(a,b,c,f,g){var d=m[a.geometryType];a.meshData=null;var k=void 0,l=void 0;void 0===a.vertexFrom?(l=b.vertexCount,k=this._allocateVertices(d,l)):b.vertexCount>a.vertexCount?(this._freeVertices(d,a.vertexFrom,a.vertexCount),l=b.vertexCount,k=this._allocateVertices(d,
l)):b.vertexCount===a.vertexCount?(k=a.vertexFrom,l=a.vertexCount):(this._freeVertices(d,a.vertexFrom+b.vertexCount,a.vertexCount-b.vertexCount),k=a.vertexFrom,l=b.vertexCount);var q=!0,n=void 0,u=void 0,h=void 0;void 0===a.indexFrom?(n=g,h=b.indexCount,u=this._allocateIndices(d,h)):b.indexCount>a.indexCount?(n=this._displayList.removeFromList(a),this._freeIndices(d,a.indexFrom,a.indexCount),h=b.indexCount,u=this._allocateIndices(d,h)):b.indexCount===a.indexCount?(q=!1,u=a.indexFrom,h=a.indexCount):
(n=this._displayList.removeFromList(a),this._freeIndices(d,a.indexFrom+b.indexCount,a.indexCount-b.indexCount),u=a.indexFrom,h=b.indexCount);if(-1!==k&&-1!==u){g=this._storageFor(d);e.copyMeshData(k,u,g.vertexBuffers,g.indexBuffer,b,c,f);a.vertexFrom=k;a.indexFrom=u;a.vertexCount=b.vertexCount;a.indexCount=b.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var v in c)this._dirtyMap.markDirtyVertices(a.geometryType,v,a.vertexFrom,a.vertexCount)}q&&
this._displayList.addToList(a,n);return!0}-1!==k&&this._freeVertices(d,k,l);-1!==u&&this._freeIndices(d,u,h);a.setMeshDataFromBuffers(b,c,f);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};a.prototype._freeVertices=function(a,b,c){this._storageFor(a).vtxFreeList.free(b,c)};a.prototype._freeIndices=function(a,b,c){this._storageFor(a).idxFreeList.free(b,
c)};a.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};a.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=function(a,b){return this._strides[a][b]};return a}();c.default=a})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a){this._largestRange=
null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.rangeResized=function(a,b){if(a===this._largestRange)a.count<b&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var b=
this._parent._freeHead,c=null;null!==b;)b.count>=a&&(!c||b.count-a<c.count-a)&&(c=b),b=b.next;return c};a.prototype.findAdjacentRanges=function(a,b){for(var c=!0,e=!1,d=null,f=this._parent._freeHead;c&&!e;){var g=null!==f?f.from:this._parent._size;a>=(null!==d?d.from+d.count:0)&&a+b<=g?(c=!1,e=!0):null!==f?(d=f,f=f.next):c=!1}return[d,f]};a.prototype._updateLargestRange=function(){for(var a=null,b=this._parent._freeHead;null!==b;){if(!a||b.count>a.count)a=b;b=b.next}this._largestRange=a};return a}();
a=function(){function a(a,b){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=b||new f(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(c){var b=this._bookKeeper.findBestRange(c);if(null===b)return-1;var e=b.from,f=b.count;b.from+=c;b.count-=c;this._bookKeeper.rangeResized(b,e,f);this._allocated+=c;0===b.count&&(c=null!==b.prev?this._freeHead:b.next,a._removeRange(b),this._freeHead=c);return e};
a.prototype.free=function(c,b){var e=this._bookKeeper.findAdjacentRanges(c,b),f=e[0],e=e[1];c={from:c,count:b,prev:f,next:e};null!==f&&(f.next=c);null!==e&&(e.prev=c);this._bookKeeper.rangeCreated(c);this._allocated-=b;if(null!==e&&c.from+c.count===e.from){b=c.from;var d=c.count;a._fuse(c,e);a._removeRange(e);this._bookKeeper.rangeResized(c,b,d);this._bookKeeper.rangeResized(e,void 0,0)}null!==f&&f.from+f.count===c.from&&(b=f.from,d=f.count,a._fuse(f,c),a._removeRange(c),this._bookKeeper.rangeResized(f,
b,d),this._bookKeeper.rangeResized(c,void 0,0));this._freeHead=null!==c.prev?this._freeHead:c};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,b){a.count+=b.count;a.next=b.next;b.from+=b.count;b.count=
0;null!==b.next&&(b.next.prev=a)};return a}();c.FreeList=a})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(a,c){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=
0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();c.default=a})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","../../../webgl","./Utils"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(a){this.geometryMap=
g.createGeometryData(function(){return{indexBuffer:f.BufferObject.createIndex(a,35044),vao:null}},function(b,c){return{vertexBuffer:f.BufferObject.createVertex(a,g.C_VBO_INFO[c])}})}a.prototype.dispose=function(){for(var a=0;5>a;a++){var c=this.geometryMap[a];if(c){c.data.vao&&c.data.vao.dispose(!1);c.data.indexBuffer&&c.data.indexBuffer.dispose();for(var e in c.buffers)c.buffers[e]&&c.buffers[e].data.vertexBuffer.dispose()}}};a.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var c in b.buffers)a[c]=
b.buffers[c].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};a.prototype.has=function(a){return null!=this.geometryMap[a]};a.prototype.upload=function(a,c){var b=this;c.forEach(function(c,e){b._upload(c,e,a)})};a.prototype._upload=function(a,c,e){a.indices&&(a.indices.allDirty?this._uploadIndices(e,c):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(e,c,a.indices.from,a.indices.count));if(a.vertices){a=
a.vertices;for(var b in a){var f=a[b];f.allDirty?this._uploadVertices(e,c,b):null!=f.from&&null!=f.count&&this._uploadVertices(e,c,b,f.from,f.count)}}};a.prototype._uploadVertices=function(a,c,e,d,f){var b=this.geometryMap[c];b&&(c=a.geometries[c].vertexBuffer[e])&&(a=c.stride,c=c.data.buffer,b.buffers[e]&&0<c.byteLength&&(null!=d&&null!=f?b.buffers[e].data.vertexBuffer.setSubData(c,d*a,d*a,(d+f)*a):b.buffers[e].data.vertexBuffer.setData(c)))};a.prototype._uploadIndices=function(a,c,e,d){var b=this.geometryMap[c];
b&&(a=a.geometries[c].indexBuffer.buffer,b.data.indexBuffer&&0<a.byteLength&&(null!=e&&null!=d?b.data.indexBuffer.setSubData(a,4*e,4*e,4*(e+d)):b.data.indexBuffer.setData(a)))};return a}();c.default=a})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(a,c,f,g){Object.defineProperty(c,"__esModule",{value:!0});c.magnifier={name:"magnifier",shaders:{vertexShader:g.resolveIncludes("magnifier/magnifier.vert"),
fragmentShader:g.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};c.createMagnifierProgram=function(a){return f.createProgram(a,c.magnifier)}})},"esri/views/2d/engine/BitmapTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./BitmapTile ./webgl/enums ./webgl/TileContainer".split(" "),function(a,c,f,g,e,b,m,k,d){Object.defineProperty(c,"__esModule",{value:!0});
a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}f(c,a);c.prototype.createTile=function(a){var b=this._tileInfoView.getTileBounds(e.create(),a);return new m.BitmapTile(a,b,this._tileInfoView.tileInfo.size)};c.prototype.destroyTile=function(){};c.prototype.prepareRenderPasses=function(c){var d=this,e=c.registerRenderPass({name:"bitmap (tile)",brushes:[b.brushes.Bitmap],target:function(){return d.children.map(function(a){return a.bitmap})},drawPhase:k.WGLDrawPhase.MAP});return a.prototype.prepareRenderPasses.call(this,
c).concat([e])};c.prototype.doRender=function(b){this.visible&&b.drawPhase===k.WGLDrawPhase.MAP&&a.prototype.doRender.call(this,b)};return c}(d.default);c.BitmapTileContainer=a})},"esri/views/2d/engine/LevelDependentSizeVariable":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../renderers/visualVariables/SizeVariable ../../../renderers/visualVariables/support/sizeVariableUtils".split(" "),
function(a,c,f,g,e,b,m,k){Object.defineProperty(c,"__esModule",{value:!0});a=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}g(c,a);d=c;c.prototype.writeLevels=function(a,b,c){for(var d in a){b.stops=this.levels[d];break}};c.prototype.clone=function(){return new d({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:k.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,
minDataValue:this.minDataValue,minSize:k.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(function(a){return a.clone()}),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:e.clone(this.levels)})};var d;f([b.property()],c.prototype,"levels",void 0);f([b.writer("levels")],
c.prototype,"writeLevels",null);return c=d=f([b.subclass("esri.views.2d.engine.LevelDependentSizeVariable")],c)}(b.declared(m));c.LevelDependentSizeVariable=a})},"*noref":1}});
define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/webgl/TileContainer ./engine/DisplayObject ./engine/RasterTile ./engine/RasterTileContainer ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/brushes/BrushBitmap ./engine/webgl/brushes/BrushClip ./engine/webgl/brushes/BrushRasterBitmap ./engine/webgl/brushes/WGLBrushInfo ./engine/webgl/brushes/WGLBrushStencil ./engine/webgl/brushes/WGLBrushVTLBackground ./engine/webgl/brushes/WGLBrushVTLCircle ./engine/webgl/brushes/WGLBrushVTLFill ./engine/webgl/brushes/WGLBrushVTLLine ./engine/webgl/brushes/WGLBrushVTLSymbol ./engine/webgl/brushes/WGLGeometryBrush ./engine/webgl/brushes/WGLGeometryBrushFill ./engine/webgl/brushes/WGLGeometryBrushLabel ./engine/webgl/brushes/WGLGeometryBrushLine ./engine/webgl/brushes/WGLGeometryBrushMarker ./engine/webgl/brushes/WGLGeometryBrushText ./engine/webgl/util/debug ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TextShaping ./engine/webgl/TextShapingNew ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util ./engine/webgl/painter/RenderPass ./engine/webgl/TiledDisplayObject ./engine/BitmapTileContainer ./engine/LevelDependentSizeVariable".split(" "),function(a,
c,f,g,e,b,m,k,d,l,q,v,x,p,z,r,w,n,u,h,y,t,A,B,C,D,K,E,I,G,N,F,H,M,L,J,O,Q,R,U,T,S,P,V,Y,W,Z,aa,ba,ca,da,ea,fa,ga,ha,ia,X,ja,ka,la,ma,na,oa,pa){Object.defineProperty(c,"__esModule",{value:!0});c.Bitmap=f.Bitmap;c.BitmapContainer=g.BitmapContainer;c.BitmapTile=e.BitmapTile;c.Container=b.Container;c.TileContainer=m.default;c.DisplayObject=k.DisplayObject;c.RasterTile=d.RasterTile;c.RasterTileContainer=l.RasterTileContainer;c.Stage=q.Stage;c.AttributeStoreView=v.AttributeStoreView;c.CollisionGrid=x.CollisionGrid;
c.CollisionEngine=p.CollisionEngine;c.LayerViewSorter=z.LayerViewSorter;c.Point=r.Point;c.alignmentUtils=w;c.color=n;c.definitions=u;c.enums=h;c.fontUtils=y;c.Utils=t;c.debug=R;c.TileClipper=U.TileClipper;c.SimpleBuilder=U.SimpleBuilder;c.tessellate=T.tessellate;c.TessellationState=T.TessellationState;c.splitVertex=T.splitVertex;c.createMatcher=S.createMatcher;c.WGLMeshFactory=P.WGLMeshFactory;c.MeshData=V.MeshData;c.WGLTemplateStore=Y.WGLTemplateStore;c.Painter=W.default;c.PainterOptions=W.PainterOptions;
c.TextShaping=Z.TextShaping;c.TextShapingNew=aa.TextShaping;c.TileData=ba.TileData;c.bidiText=ca.bidiText;c.FeatureMatcher=da.FeatureMatcher;c.getVVFlags=ea.getVVFlags;c.getTypeOfSizeVisualVariable=fa.getTypeOfSizeVisualVariable;c.WGLRendererInfo=ga.WGLRendererInfo;c.WGLTile=ha.WGLTile;c.BitBlitRenderer=ia.BitBlitRenderer;c.createMagnifierProgram=X.createMagnifierProgram;c.magnifier=X.magnifier;c.CIMSymbolHelper=ja.CIMSymbolHelper;c.Rect=ka.default;c.getLimitCosine=la.getLimitCosine;a=c.brushes||
(c.brushes={});a.Geometry=H.default;a.Marker=O.default;a.Line=J.default;a.Fill=M.default;a.Text=Q.default;a.Label=L.default;a.Clip=B.default;a.Stencil=K.default;a.Bitmap=A.default;a.Raster=C.default;a.TileInfo=D.default;a.VTLBackground=E.WGLBrushVTLBackground;a.VTLFill=G.WGLBrushVTLFill;a.VTLLine=N.WGLBrushVTLLine;a.VTLCircle=I.WGLBrushVTLCircle;a.VTLSymbol=F.WGLBrushVTLSymbol;c.RenderPass=ma.default;c.TiledDisplayObject=na.TiledDisplayObject;c.BitmapTileContainer=oa.BitmapTileContainer;c.LevelDependentSizeVariable=
pa.LevelDependentSizeVariable});