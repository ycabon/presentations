// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../request ../../../../core/has ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(r,t,m,u,n,p){var e=function(){function b(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var d=a.getMessage();d.next();)switch(d.tag()){case 3:for(var c=d.getMessage(),b=void 0,f=void 0,g=void 0,e=void 0,h=void 0,k=void 0,l=void 0;c.next();)switch(c.tag()){case 1:b=c.getUInt32();break;case 2:f=c.getBytes();break;case 3:g=c.getUInt32();
break;case 4:e=c.getUInt32();break;case 5:h=c.getSInt32();break;case 6:k=c.getSInt32();break;case 7:l=c.getUInt32();break;default:c.skip()}c.release();b&&(this._metrics[b]={width:g,height:e,left:h,top:k,advance:l},this._bitmaps[b]=f);break;default:d.skip()}d.release();break;default:a.skip()}}b.prototype.getMetrics=function(a){return this._metrics[a]};b.prototype.getBitmap=function(a){return this._bitmaps[a]};return b}(),q=function(){function b(){this._ranges=[]}b.prototype.getRange=function(a){return this._ranges[a]};
b.prototype.addRange=function(a,d){this._ranges[a]=d};return b}();return function(){function b(a){this._glyphInfo={};this._baseURL=a}b.prototype.getRange=function(a,d){var c=this._getFontStack(a);if(c.getRange(d))return p.resolve();var b=256*d,f=b+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",b+"-"+f);return m(a,{responseType:"array-buffer"}).then(function(a){c.addRange(d,new e(new n(new Uint8Array(a.data),new DataView(a.data))))}).catch(function(){c.addRange(d,new e)})};b.prototype.getGlyph=
function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};b.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new q);return b};return b}()});