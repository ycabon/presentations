// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../engine","./FadeRecorder","./shaders/ProgramCache"],function(h,k,g,l,m){Object.defineProperty(k,"__esModule",{value:!0});h=function(){function b(c,f){this.spriteMosaic=c;this.glyphMosaic=f;this._brushCache=new Map;this.fadeRecorder=new l.FadeRecorder(300,!0);this.brushNameToCtor={vtlBackground:g.brushes.VTLBackground,vtlFill:g.brushes.VTLFill,vtlLine:g.brushes.VTLLine,vtlCircle:g.brushes.VTLCircle,vtlSymbol:g.brushes.VTLSymbol}}b.prototype.dispose=function(){this._brushCache&&
(this._brushCache.forEach(function(c){return c.dispose()}),this._brushCache=null);this._programCache&&(this._programCache.dispose(),this._programCache=null)};b.prototype.setContext=function(c){this._programCache||(this._programCache=new m.default(c))};b.prototype.drawTile=function(c,f,e){var n=this,a=c.context,d=c.fadeRecorder,b=e.layers;0<e.backgroundBucketIds.length&&(c.renderPass="background",e.backgroundBucketIds.forEach(function(a){return n._renderStyleLayer(a,c,f,e,!0)}));d.recordLevel(c.displayLevel);
f.commitChanges();a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setDepthFunction(515);c.renderPass="opaque";for(d=b.length-1;0<=d;d--)this._renderStyleLayer(d,c,f,e,!1);a.setDepthWriteEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);c.renderPass="translucent";for(d=0;d<b.length;d++)this._renderStyleLayer(d,c,f,e,!1);a.setDepthTestEnabled(!1);c.renderPass="symbol";for(d=0;d<b.length;d++)this._renderStyleLayer(d,c,f,e,!1);a.bindVAO()};b.prototype._renderStyleLayer=
function(c,f,e,b,a){void 0===a&&(a=!1);if(a||e.layerData[c])if(a=f.renderPass,b=b.layers[c],void 0!==b){var d;switch(b.type){case 0:if("background"!==a)return;d="vtlBackground";break;case 1:if("opaque"!==a&&"translucent"!==f.renderPass)return;d="vtlFill";break;case 2:if("translucent"!==a)return;d="vtlLine";break;case 4:if("symbol"!==a)return;d="vtlCircle";break;case 3:if("symbol"!==a)return;d="vtlSymbol"}a=f.displayLevel;void 0!==b.minzoom&&b.minzoom>a+1E-6||void 0!==b.maxzoom&&b.maxzoom<=a-1E-6||
(f.styleLayerId=c,f.styleLayer=b,this.drawWithBrush(f,e,d))}};b.prototype.drawWithBrush=function(c,b,e){this._brushCache.has(e)||this._brushCache.set(e,new this.brushNameToCtor[e]);this._brushCache.get(e).drawMany(c,[b])};b.prototype.getVectorTileProgramCach=function(){return this._programCache};return b}();k.default=h});