// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),function(t,u,e,m,q,g,n){var p=function(a){return a===g.WGLDrawPhase.HITTEST||a===g.WGLDrawPhase.LABEL_ALPHA},r=function(a,d,b,c){c=c.reduce(function(c,d){var b;return e({},c,(b={},b[d]=a.driverTestResult[d],b))},{});d=e({},d.getVariation(),a.rendererInfo.getVariation(),{highlight:a.drawPhase===g.WGLDrawPhase.HIGHLIGHT,id:p(a.drawPhase)},c);if(m.isSome(b))for(c=
0;c<b.length;c++)d[b[c]]=!0;return d};return function(){function a(d){this._programByKey=new Map;this._programCache=new q.ProgramCache(d)}a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(d,b,c,a){void 0===c&&(c=[]);void 0===a&&(a=[]);var f=b.path+c.join(".")+a.join(".");if(this._programByKey.has(f))return this._programByKey.get(f);a=a.reduce(function(c,a){var b;return e({},c,(b={},b[a]=d.driverTestResult[a],b))},{});c=e({},c.reduce(function(c,
a){var b;return e({},c,(b={},b[a]=!0,b))},{}),a);b=this._programCache.getProgram(n.createProgramTemplate(b.path,b.attributes),c);if(!b)throw Error("Unable to get program for key: ${key}");this._programByKey.set(f,b);return b};a.prototype.getMaterialProgram=function(a,b,c,e,f,h){void 0===h&&(h=["ignoresSamplerPrecision"]);var d,l=h;d=a.rendererInfo;var k=a.drawPhase,l=b.getVariationHash()+"-"+l.join(".")+"-",k=(p(k)?1:0)|(k===g.WGLDrawPhase.HIGHLIGHT?2:0);d=l+k+"-"+d.getVariationHash()+"-"+(m.isSome(f)&&
f.join("."));if(this._programByKey.has(d))return this._programByKey.get(d);a=r(a,b,f,h);c=this._programCache.getProgram(n.createProgramTemplate(c,e),a);if(!c)throw Error("Unable to get program for key: ${key}");this._programByKey.set(d,c);return c};return a}()});