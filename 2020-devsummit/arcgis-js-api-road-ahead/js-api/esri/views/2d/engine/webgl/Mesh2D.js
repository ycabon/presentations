// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),function(n,p,z,q,A,r,B,C,t,u,v,f,w){Object.defineProperty(p,"__esModule",{value:!0});var D=A.getLogger("esri.views.2d.engine.webgl.Mesh2D"),
y=function(e,b){var a=e.coords;e=e.lengths;for(var c=[],d=0,f=0;d<e.length;f+=e[d],d+=1){for(var k=f,g=[];d<e.length-1;d+=1,f+=e[d]){for(var h=f+e[d],m=0,l=1;l<e[d+1];l++)m+=(a[2*(h+l)]-a[2*(h+l-1)])*(a[2*(h+l)+1]+a[2*(h+l-1)+1]);if(!(b?0<m:0>m))break;g.push(f+e[d]-k)}m=a.slice(2*k,2*(f+e[d]));h=0;for(g=B(m,g,2);h<g.length;h++)c.push(g[h]+k)}return c};n=function(){function e(b,a,c,d){void 0===d&&(d=!1);this._cache={};this.vertices=b;this.indices=a;this.primitiveType=c;this.isMapSpace=d}e.fromRect=
function(b){var a=b.x,c=b.y;return e.fromScreenExtent({xmin:a,ymin:c,xmax:a+b.width,ymax:c+b.height})};e.fromPath=function(b){var a=u.convertFromNestedArray(new v.default,b.path,!1,!1);b=a.coords;for(var a=new Uint32Array(y(a,!0)),c=new Uint32Array(b.length/2),d=0;d<c.length;d++)c[d]=f.i1616to32(Math.floor(b[2*d]),Math.floor(b[2*d+1]));return new e({geometry:c},a,4)};e.fromGeometry=function(b,a){var c=a.geometry.type;switch(c){case "polygon":return e.fromPolygon(b,a.geometry);case "extent":return e.fromMapExtent(b,
a.geometry);default:return D.error(q("mapview-bad-type","Unable to create a mesh from type "+c,a)),e.fromRect({x:0,y:0,width:1,height:1})}};e.fromPolygon=function(b,a){var c=u.convertFromPolygon(new v.default,a,!1,!1);a=c.coords;for(var c=new Uint32Array(y(c,!1)),d=new Uint32Array(a.length/2),x=t.vec2f64.create(),k=t.vec2f64.create(),g=0;g<d.length;g++)C.vec2.set(x,a[2*g],a[2*g+1]),b.toScreen(k,x),d[g]=f.i1616to32(Math.floor(k[0]),Math.floor(k[1]));return new e({geometry:d},c,4,!0)};e.fromScreenExtent=
function(b){var a=b.xmin,c=b.xmax,d=b.ymin;b=b.ymax;a={geometry:new Uint32Array([f.i1616to32(a,d),f.i1616to32(c,d),f.i1616to32(a,b),f.i1616to32(a,b),f.i1616to32(c,d),f.i1616to32(c,b)])};c=new Uint32Array([0,1,2,3,4,5]);return new e(a,c,4)};e.fromMapExtent=function(b,a){var c=b.toScreen([0,0],[a.xmin,a.ymin]),d=c[0],c=c[1];a=b.toScreen([0,0],[a.xmax,a.ymax]);b=a[0];a=a[1];d={geometry:new Uint32Array([f.i1616to32(d,c),f.i1616to32(b,c),f.i1616to32(d,a),f.i1616to32(d,a),f.i1616to32(b,c),f.i1616to32(b,
a)])};c=new Uint32Array([0,1,2,3,4,5]);return new e(d,c,4)};e.prototype.destroy=function(){r.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var b in this._cache.vertexBuffers)r.isSome(this._cache.vertexBuffers[b])&&this._cache.vertexBuffers[b].dispose()};Object.defineProperty(e.prototype,"elementType",{get:function(){var b;a:switch(this.indices.BYTES_PER_ELEMENT){case 1:b=5121;break a;case 2:b=5123;break a;case 4:b=5125;break a;default:throw q("Cannot get DataType of array");
}return b},enumerable:!0,configurable:!0});e.prototype.getIndexBuffer=function(b,a){void 0===a&&(a=35044);this._cache.indexBuffer||(this._cache.indexBuffer=w.createIndex(b,a,this.indices));return this._cache.indexBuffer};e.prototype.getVertexBuffers=function(b,a){var c=this;void 0===a&&(a=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(function(d,e){var f;return z({},d,(f={},f[e]=w.createVertex(b,a,c.vertices[e]),f))},{}));return this._cache.vertexBuffers};
return e}();p.default=n});