// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","./Rect"],function(A,B,C){Object.defineProperty(B,"__esModule",{value:!0});A=function(){function z(c,d,f,e,g,k,b,a){this._glyphItems=c;this._maxWidth=d;this._lineHeight=f;this._letterSpacing=e;this._offset=g;this._hAnchor=k;this._vAnchor=b;this._justify=a}z.prototype.getShaping=function(c,d){for(var f=this._letterSpacing,e=this._lineHeight,g=this._justify,k=this._maxWidth,b=[],a=0,h=0,m=0,t=0,n=-1,p=0,u=-1,w=c.length,x=0;x<w;x++){var v=c.charCodeAt(x);if(10===v){if(x!==
w-1){if(n>=t){var a=b[n],q=a.x+a.glyphMosaicItem.metrics.advance,p=Math.max(q,p);g&&this._applyJustification(b,t,n);t=b.length}h=d?h-e:h+e;a=0;++m}}else{for(var q=void 0,l=0,r=this._glyphItems;l<r.length&&!(q=r[l][v]);l++);if(q){b.push({codePoint:v,x:a,y:h,glyphMosaicItem:q});a+=q.metrics.advance+f;if(0<k&&a>k&&0<=u){l=u+1;q=b[l].x;p=Math.max(q,p);for(r=l;r<b.length;r++)b[r].y=d?b[r].y-e:b[r].y+e,b[r].x-=q;g&&this._applyJustification(b,t,u);h=d?h-e:h+e;a-=q;++m;t=l;u=-1}++n;32===v&&(u=b.length-1)}}}n>=
t&&(a=b[n],p=Math.max(p,a.x+a.glyphMosaicItem.metrics.advance),g&&this._applyJustification(b,t,n));if(0<b.length)for(c=(g-this._hAnchor)*p,f=(-this._vAnchor*(m+1)+.5)*e,d&&m&&(f+=m*e),c+=this._offset[0],f+=this._offset[1],d=0;d<b.length;d++)e=b[d],e.x+=c,e.y+=f;return b};z.prototype.getEstimatedShaping=function(c,d,f){for(var e=this._letterSpacing,g=this._lineHeight,k=this._justify,b=this._maxWidth,a=[],h=0,m=0,t=0,n=0,p=-1,u=0,w=-1,x=c.length,v=0;v<x;v++){var q=c.charCodeAt(v);if(10===q){if(v!==
x-1){if(p>=n){var h=a[p],l=h.x+h.glyphMosaicItem.metrics.advance,u=Math.max(l,u);k&&this._applyJustification(a,n,p);n=a.length}m=d?m-g:m+g;h=0;++t}}else{l=f;a.push({codePoint:q,x:h,y:m,glyphMosaicItem:l});h+=l.metrics.advance+e;if(0<b&&h>b&&0<=w){for(var r=w+1,l=a[r].x,u=Math.max(l,u),y=r;y<a.length;y++)a[y].y=d?a[y].y-g:a[y].y+g,a[y].x-=l;k&&this._applyJustification(a,n,w);m=d?m-g:m+g;h-=l;++t;n=r;w=-1}++p;32===q&&(w=a.length-1)}}p>=n&&(h=a[p],u=Math.max(u,h.x+h.glyphMosaicItem.metrics.advance),
k&&this._applyJustification(a,n,p));if(0<a.length)for(c=(k-this._hAnchor)*u,f=(-this._vAnchor*(t+1)+.5)*g,d&&t&&(f+=t*g),c+=this._offset[0],f+=this._offset[1],d=0;d<a.length;d++)g=a[d],g.x+=c,g.y+=f;return a};z.getBox=function(c){if(!c.length)return null;for(var d=Infinity,f=Infinity,e=-Infinity,g=-Infinity,k=0;k<c.length;k++)var b=c[k],a=b.glyphMosaicItem.metrics,h=b.x+a.left,b=b.y-a.top,m=h+a.width,a=b+a.height,d=Math.min(d,h),e=Math.max(e,m),f=Math.min(f,b),g=Math.max(g,a);return{x:d,y:f,width:e-
d,height:g-f}};z.addDecoration=function(c,d){var f=c.length;if(0!==f){for(var e=c[0].x+c[0].glyphMosaicItem.metrics.left,g=c[0].y,k=1;k<f;k++){var b=c[k];if(b.y!==g){var a=c[k-1].x+c[k-1].glyphMosaicItem.metrics.left+c[k-1].glyphMosaicItem.metrics.width;c.push({codePoint:0,x:e,y:g,glyphMosaicItem:{sdf:!0,rect:new C.default(4,0,4,8),metrics:{width:a-e,height:2,left:0,top:d,advance:0},page:0}});g=b.y;e=b.x+b.glyphMosaicItem.metrics.left}}f=c[f-1].x+c[f-1].glyphMosaicItem.metrics.left+c[f-1].glyphMosaicItem.metrics.width;
c.push({codePoint:0,x:e,y:g,glyphMosaicItem:{sdf:!0,rect:new C.default(4,0,4,8),metrics:{width:f-e,height:2,left:0,top:d,advance:0},page:0}})}};z.prototype._applyJustification=function(c,d,f){for(var e=c[f],e=(e.x+e.glyphMosaicItem.metrics.advance)*this._justify;d<=f;d++)c[d].x-=e};return z}();B.TextShaping=A});