// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),function(L,a,A,m,B,t,u,d,C,v,c,D){function k(b){for(var a={},h=0;h<b.length;h++){var f=b[h];a[f.name]=f.strideInBytes}return a}function w(b){switch(b){case c.WGLGeometryType.MARKER:return E;case c.WGLGeometryType.FILL:return F;case c.WGLGeometryType.LINE:return G;
case c.WGLGeometryType.TEXT:return H;case c.WGLGeometryType.LABEL:return I}return null}function x(b){switch(b%4){case 0:case 2:return 4;case 1:case 3:return 1}}function y(b){return"string"===typeof b}function z(b){switch(b){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function J(b){var a={},h=function(e){var h=0;a[e]=b[e].map(function(b){var a=A({},b,{normalized:b.normalized||!1,divisor:b.divisor||0,offset:h,stride:0});h+=b.count*z(b.type);return a});
a[e].forEach(function(b){return b.stride=h})},f;for(f in b)h(f);return a}Object.defineProperty(a,"__esModule",{value:!0});var q,l=B.getLogger("esri.views.2d.engine.webgl.Utils");a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF_DD=[{name:a.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];
a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];a.C_ICON_STRIDE_SPEC=k(a.C_ICON_VERTEX_DEF);a.C_FILL_STRIDE_SPEC=k(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_DD=k(a.C_FILL_VERTEX_DEF_DD);a.C_LINE_STRIDE_SPEC=k(a.C_LINE_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC=k(a.C_TEXT_VERTEX_DEF);a.C_LABEL_STRIDE_SPEC=k(a.C_LABEL_VERTEX_DEF);a.getStrides=
function(b,e){switch(b){case c.WGLGeometryType.MARKER:return a.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return e?a.C_FILL_STRIDE_SPEC_DD:a.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return a.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return a.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};var E=[a.C_VBO_GEOMETRY],F=[a.C_VBO_GEOMETRY],G=[a.C_VBO_GEOMETRY],H=[a.C_VBO_GEOMETRY],I=[a.C_VBO_GEOMETRY];a.getNamedBuffers=w;a.strideToPackingFactor=x;
a.allocateTypedArrayBuffer=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(Math.floor(b*a/4));case 1:case 3:return new Uint8Array(b*a)}};a.allocateTypedArrayBufferwithData=function(b,a){switch(a%4){case 0:case 2:return new Uint32Array(b);case 1:case 3:return new Uint8Array(b)}};a.getTextProperties=function(b){return D.TextProperties.pool.acquire(b.color?v.copyAndPremultiply(b.color):[255,255,255,255],b.haloColor?v.copyAndPremultiply(b.haloColor):[255,255,255,255],u.pt2px(b.haloSize),
u.pt2px(b.font.size),b.angle*Math.PI/180,b.xoffset/b.font.size,b.yoffset/b.font.size,"left"===b.horizontalAlignment?0:"right"===b.horizontalAlignment?1:.5,"top"===b.verticalAlignment?0:"bottom"===b.verticalAlignment?1:.5)};a.isDefined=function(b){return null!=b};a.isNumber=function(b){return"number"===typeof b};a.isString=y;a.isStringOrNull=function(b){return null==b||y(b)};a.getCapType=function(b,a){switch(b){case "butt":return d.CapType.BUTT;case "round":return a?d.CapType.SQUARE:d.CapType.ROUND;
case "square":return d.CapType.SQUARE;default:return l.error(new m("mapview-invalid-type","Cap type "+b+" is not a valid option. Defaulting to round")),d.CapType.ROUND}};a.getJoinType=function(b){switch(b){case "miter":return d.JoinType.MITER;case "bevel":return d.JoinType.BEVEL;case "round":return d.JoinType.ROUND;default:return l.error(new m("mapview-invalid-type","Join type "+b+" is not a valid option. Defaulting to round")),d.JoinType.ROUND}};a.getVVType=function(b){switch(b){case "opacity":return c.VVType.OPACITY;
case "color":return c.VVType.COLOR;case "rotation":return c.VVType.ROTATION;case "size":return c.VVType.SIZE;default:return l.error("Cannot interpret unknown vv: "+b),null}};a.getTransformParams=function(b){return{transform:b.transform,hasZ:b.hasZ,hasM:b.hasM}};a.copyMeshData=function(b,a,h,f,n,c,d){for(var e in c)for(var g=c[e].stride,p=x(g),k=c[e].data,l=h[e].data,m=g*n.vertexCount/p,K=g*b/p,p=g*n.vertexFrom/p,g=0;g<m;++g)l[g+K]=k[g+p];h=n.indexCount;for(g=0;g<h;++g)f[g+a]=d[g+n.indexFrom]-n.vertexFrom+
b};a.C_VBO_INFO=(q={},q[a.C_VBO_GEOMETRY]=35044,q);a.createGeometryData=function(b,a){for(var h=[],f=0;5>f;++f){for(var c={},e=0,d=w(f);e<d.length;e++){var k=d[e];c[k]={data:a(f,k)}}h.push({data:b(f),buffers:c})}return h};a.createTextureFromTexelData=function(a,c){var b,f;t.isPowerOfTwo(c.width)&&t.isPowerOfTwo(c.height)?(b=!0,f=9987):(b=!1,f=9729);return new C.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:b,samplingMode:f,wrapMode:33071,flipped:!0},c)};a.geometryToMappedGeometry=
function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};a.getBytes=z;a.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:l.error(new m("webgl-utils","Unable to handle type "+a))}};a.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:l.error(new m("webgl-utils","Unable to handle type "+a))}};var r=new Map;a.createProgramDescriptor=function(a,c){if(!r.has(a)){var b=
J(c),f={},d;for(d in b){var e=b[d];f[d]=e.length?e[0].stride:0}d={};for(var k in c)for(var e=0,l=c[k];e<l.length;e++){var g=l[e];d[g.name]=g.location}r.set(a,{strides:f,bufferLayouts:b,attributes:d})}return r.get(a)}});