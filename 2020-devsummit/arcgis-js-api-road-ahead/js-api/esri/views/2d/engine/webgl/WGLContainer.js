// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),function(d,g,k,l,e,m,n,p,h){Object.defineProperty(g,"__esModule",{value:!0});d=function(d){function b(c){var a=d.call(this)||this;a.name=a.constructor.name;a._lastTime=null;a.setClips(c);return a}k(b,d);b.prototype.setClips=function(c){var a=this;e.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(a){return a.destroy()}),
this._clippingInfos=null);e.isSome(c)&&c.length&&(this._clippingInfos=c.items.map(function(c){return p.default.fromClipArea(a,c)}));this.requestRender()};b.prototype.doRender=function(c){this.attachChildren();this.detachChildren();var a=this.createRenderParams(c),q=a.context,b=a.painter,f=a.globalOpacity,d=a.profiler,f={opacity:a.drawPhase===h.WGLDrawPhase.LABEL?1:f*this.opacity,blendOption:{mode:this.blendMode},postProcessingEffects:null};if(this.postProcessingEffects&&this.postProcessingEffects.length){f.postProcessingEffects=
[];for(var e=0,g=this.postProcessingEffects;e<g.length;e++)f.postProcessingEffects.push({effect:g[e]})}d.recordContainerStart(this.name);b.beforeRenderLayer(q,this._clippingInfos?255:0,f);this.updateTransforms(c.state);this.renderChildren(a);b.compositeLayer(a,f);d.recordContainerEnd()};b.prototype.renderChildren=function(c){e.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(this.stage.painter));for(var a=0,b=this._renderPasses;a<b.length;a++)b[a].render(c)};b.prototype.createRenderParams=
function(c){var a=Date.now(),b=(e.isSome(this._lastTime)?a-this._lastTime:0)/1E3;this._lastTime=a;return l({},c,{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,timeDelta:b,timeline:this.stage.timeline})};b.prototype.prepareRenderPasses=function(c){var a=this;return[c.registerRenderPass({name:"clip",brushes:[m.brushes.Clip],target:function(){return a._clippingInfos},drawPhase:h.WGLDrawPhase.MAP|
h.WGLDrawPhase.LABEL|h.WGLDrawPhase.LABEL_ALPHA|h.WGLDrawPhase.DEBUG})]};b.prototype.updateTransforms=function(c){for(var a=0,b=this.children;a<b.length;a++)b[a].setTransform(c)};return b}(n.Container);g.default=d});