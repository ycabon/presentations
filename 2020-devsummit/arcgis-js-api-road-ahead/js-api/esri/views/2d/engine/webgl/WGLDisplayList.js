// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(h,w,x,r,e){function m(b,a,f){for(var p=[],c=3;c<arguments.length;c++)p[c-3]=arguments[c];a<b.length?b.splice.apply(b,[a,f].concat(p)):b.push.apply(b,p)}var t=r.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");h=new Map;h.set(e.WGLDrawPhase.MAP,[e.WGLGeometryType.FILL,e.WGLGeometryType.LINE,e.WGLGeometryType.MARKER,e.WGLGeometryType.TEXT]);h.set(e.WGLDrawPhase.LABEL,[e.WGLGeometryType.LABEL]);
h.set(e.WGLDrawPhase.LABEL_ALPHA,[e.WGLGeometryType.LABEL]);h=function(){function b(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}b.prototype.replay=function(a,f,p){if(this.unified)for(var c=0,b=this.symbolLevels;c<b.length;c++)for(var d=0,g=b[c].zLevels;d<g.length;d++){var k=g[d].geometryDPInfo,e;for(e in k)if(k[e])for(var h=0,m=k[e];h<m.length;h++){var n=m[h],q=a.painter.getGeometryBrush(n.geometryType),r=f.getGeometry(n.geometryType);q.prepareState(a,f);q.drawGeometry(a,f,n,r,p)}}};
Object.defineProperty(b.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this.symbolLevels.length=0};b.prototype.addToList=function(a,f){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._addToList(a[b],f);else this._addToList(a,f)};b.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var f=null,b=0;b<a.length;b++)f=this._removeFromList(a[b]);return f};b.prototype.byType=function(a,
f){for(var b=0,c=this.symbolLevels;b<c.length;b++)for(var l=0,d=c[b].zLevels;l<d.length;l++){var g=d[l].geometryDPInfo,e=this.getDPInfoType(a);if(g[e])for(var h=0,g=g[e];h<g.length;h++)f(g[h])}};b.prototype.clone=function(){for(var a=new b(this.unified),f=0,e=this.symbolLevels;f<e.length;f++)a.symbolLevels.push(e[f].clone());return a};b.prototype.splitAfter=function(a){for(var f=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=f.length,c=a.indexFrom+a.indexCount,e=0;e<b;++e){var d=f[e];
if(d.geometryType===a.geometryType&&c>d.indexFrom&&c<=d.indexFrom+d.indexCount)return c<d.indexFrom+d.indexCount&&(a=new n,a.geometryType=d.geometryType,a.materialKey=d.materialKey,a.indexFrom=c,a.indexCount=d.indexFrom+d.indexCount-c,f.splice(e+1,0,a),d.indexCount=c-d.indexFrom),e}};b.prototype._addToList=function(a,f){var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);f=null!=f?f:b.length-1;var c=0<=f&&f<b.length?b[f]:null;null===c||c.materialKey!==a.materialKey||c.indexFrom+c.indexCount!==
a.indexFrom||this.unified&&c.geometryType!==a.geometryType?(c=new n,c.indexFrom=a.indexFrom,c.indexCount=a.indexCount,c.materialKey=a.materialKey,c.geometryType=a.geometryType,m(b,f+1,0,c)):c.indexCount+=a.indexCount};b.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),e=b.length,c=void 0,l=0;l<e;++l){var d=b[l];if(a.indexFrom+a.indexCount>d.indexFrom&&a.indexFrom<d.indexFrom+d.indexCount&&(!this.unified||d.geometryType===a.geometryType)){c=
l;break}}if(void 0!==c){d=b[c];if(a.indexFrom===d.indexFrom)return d.indexCount-=a.indexCount,d.indexFrom+=a.indexCount,0===d.indexCount&&m(b,c,1),c-1;if(a.indexFrom+a.indexCount===d.indexFrom+d.indexCount)return d.indexCount-=a.indexCount,0===d.indexCount?(m(b,c,1),c-1):c;var e=d.indexFrom,l=a.indexFrom-d.indexFrom,g=a.indexCount;a=d.indexFrom+d.indexCount-(a.indexFrom+a.indexCount);d.indexCount=l;var k=new n;k.geometryType=d.geometryType;k.materialKey=d.materialKey;k.indexFrom=e+l+g;k.indexCount=
a;m(b,c+1,0,k);return c}return null};b.prototype._getDisplayList=function(a,b,h){for(var c,f=this.symbolLevels.length,d=0;d<f;d++)if(this.symbolLevels[d].symbolLevel===a){c=this.symbolLevels[d];break}c||(c=new u,c.symbolLevel=a,this.symbolLevels.push(c));var g;a=c.zLevels.length;for(f=0;f<a;f++)if(c.zLevels[f].zLevel===b){g=c.zLevels[f];break}g||(g=new v,g.geometryDPInfo=new q,g.zLevel=b,c.zLevels.push(g));var k;if(this.unified)g.geometryDPInfo.unified||(g.geometryDPInfo.unified=[]),k=g.geometryDPInfo.unified;
else switch(h){case e.WGLGeometryType.FILL:g.geometryDPInfo.fill||(g.geometryDPInfo.fill=[]);k=g.geometryDPInfo.fill;break;case e.WGLGeometryType.LINE:g.geometryDPInfo.line||(g.geometryDPInfo.line=[]);k=g.geometryDPInfo.line;break;case e.WGLGeometryType.MARKER:g.geometryDPInfo.marker||(g.geometryDPInfo.marker=[]);k=g.geometryDPInfo.marker;break;case e.WGLGeometryType.TEXT:g.geometryDPInfo.text||(g.geometryDPInfo.text=[]);k=g.geometryDPInfo.text;break;case e.WGLGeometryType.LABEL:g.geometryDPInfo.label||
(g.geometryDPInfo.label=[]);k=g.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+h+"'.")}return k};b.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case e.WGLGeometryType.FILL:return"fill";case e.WGLGeometryType.LINE:return"line";case e.WGLGeometryType.MARKER:return"marker";case e.WGLGeometryType.TEXT:return"text";case e.WGLGeometryType.LABEL:return"label";default:t.error("DisplayList: Tried to convert unknown geometryType: "+
a)}};return b}();var n=function(){function b(){this.materialKey=null;this.indexCount=this.indexFrom=0}b.prototype.clone=function(){var a=new b;a.geometryType=this.geometryType;a.materialKey=this.materialKey;a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;return a};return b}(),q=function(){function b(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}b.prototype.clone=function(){var a=new b;a.fill=this.fill&&this.fill.map(function(a){return a.clone()});a.line=this.line&&
this.line.map(function(a){return a.clone()});a.marker=this.marker&&this.marker.map(function(a){return a.clone()});a.text=this.text&&this.text.map(function(a){return a.clone()});a.label=this.label&&this.label.map(function(a){return a.clone()});a.unified=this.unified&&this.unified.map(function(a){return a.clone()});return a};return b}(),v=function(){function b(){this.geometryDPInfo=new q}b.prototype.clone=function(){var a=new b;a.zLevel=this.zLevel;a.geometryDPInfo=this.geometryDPInfo.clone();return a};
return b}(),u=function(){function b(){this.zLevels=[]}b.prototype.clone=function(){var a=new b;a.symbolLevel=this.symbolLevel;for(var f=0,e=this.zLevels;f<e.length;f++)a.zLevels.push(e[f].clone());return a};return b}();return h});