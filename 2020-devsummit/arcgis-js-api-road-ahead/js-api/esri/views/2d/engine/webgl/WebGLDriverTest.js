// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(q,c,e,f,g,m){Object.defineProperty(c,"__esModule",{value:!0});var n=e.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),p=function(){function a(a){this._ignoresSamplerPrecision=null;this._context=a}Object.defineProperty(a.prototype,"ignoresSamplerPrecision",{get:function(){f.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=c.testSamplerPrecision(this._context));
return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return a}();c.testWebGLDriver=function(a){return new p(a)};c.testSamplerPrecision=function(a){var c=new g.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),b=new Uint8Array(4),l=new m(a,[0,0,1,0,0,1,1,1]),h=new g.Program(a,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),k=new g.Texture(a,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));h.setUniform1i("u_texture",0);a.bindTexture(k,0);a.bindFramebuffer(c);a.bindProgram(h);var d=a.getViewport(),k=d.x,e=d.y,f=d.width,d=d.height;a.setViewport(0,0,1,1);l.draw();a.setViewport(k,e,f,d);c.readPixels(0,0,1,1,6408,5121,b);h.dispose();l.dispose();
c.dispose();(a=255!==b[0]||255!==b[1]||255!==b[2]||255!==b[3])&&n.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+b[0]+"."+b[1]+"."+b[2]+"."+b[3]+"]");return a}});