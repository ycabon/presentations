// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../vectorTiles/shaders/Programs ../definitions ../enums ../number ./WGLBrush".split(" "),function(m,v,x,y,z,k,w,t,A,B,C){Object.defineProperty(v,"__esModule",{value:!0});m=function(l){function c(){var a=null!==l&&l.apply(this,arguments)||this;a._color=z.vec4f32.fromValues(1,0,0,1);a._patternMatrix=y.mat3f32.create();a._programOptions=
{id:!1,pattern:!1};return a}x(c,l);c.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};c.prototype.drawMany=function(a,c){var d=a.context,e=a.styleLayerId;this._loadWGLResources(d);var n=a.displayLevel,f=a.styleLayer,b=a.painter.getVectorTileProgramCach(),h=f.getPaintValue("background-color",n),p=f.getPaintValue("background-opacity",n),k=f.getPaintValue("background-pattern",n),q=void 0!==k,r=h[3]*p,l=a.spriteMosaic,
g,m=(window.devicePixelRatio|1)>t.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===A.WGLDrawPhase.HITTEST;var u=this._programOptions;u.id=a;u.pattern=q;b=b.getProgram(0,(a?1:0)<<1|(q?1:0),u);d.bindVAO(this._vao);d.bindProgram(b);if(q){g=l.getMosaicItemPosition(k,!0);if(!g)return;b.setUniform1f("u_opacity",p);b.setUniform2f("u_pattern_tl",g.tl[0],g.tl[1]);b.setUniform2f("u_pattern_br",g.br[0],g.br[1]);b.setUniform1i("u_texture",t.VTL_TEXTURE_BINDING_UNIT_SPRITES);l.bind(d,9729,g.page,t.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=
r*h[0],this._color[1]=r*h[1],this._color[2]=r*h[2],this._color[3]=r,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",f.z||0);a&&(e=B.u32to4Xu8(e),b.setUniform4f("u_id",e[0],e[1],e[2],e[3]));for(e=0;e<c.length;e++)f=c[e],b.setUniform1f("u_coord_range",f.coordRange[0]),b.setUniformMatrix3fv("u_dvsMat3",f.transforms.dvs),q&&(h=m*f.size[0]*Math.max(Math.pow(2,Math.round(n)-f.key.level),1),p=h/g.size[1],this._patternMatrix[0]=h/g.size[0],this._patternMatrix[4]=p,b.setUniformMatrix3fv("u_pattern_matrix",
this._patternMatrix)),d.setStencilFunction(514,f.stencilRef,255),d.drawArrays(5,0,4)};c.prototype._loadWGLResources=function(a){if(!this._program||!this._vao){var c=k.createProgram(a,w.background);if(c){var d=new Int8Array([0,0,1,0,0,1,1,1]),d=k.BufferObject.createVertex(a,35044,d);a=new k.VertexArrayObject(a,w.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:d});this._program=c;this._vao=a}}};return c}(C.default);v.WGLBrushVTLBackground=
m});