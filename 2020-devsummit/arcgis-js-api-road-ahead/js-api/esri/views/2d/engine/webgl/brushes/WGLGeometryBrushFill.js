// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,p,q,y,r,t,k,u,v,w,x){Object.defineProperty(p,"__esModule",{value:!0});n=function(h){function c(){var b=null!==h&&h.apply(this,arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([k.TEXTURE_BINDING_RENDERER_0,
k.TEXTURE_BINDING_RENDERER_1]);return b}q(c,h);c.prototype.dispose=function(){this._disposeTextures()};c.prototype.getGeometryType=function(){return u.WGLGeometryType.FILL};c.prototype.drawGeometry=function(b,d,a,l,e){var c=b.context,g=b.painter,f=b.rendererInfo,h=b.requiredLevel,n=a.indexCount,p=a.indexFrom;a=x.FillMaterialKey.load(a.materialKey);var m=v.createProgramDescriptor(a.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(a.dotDensity?
[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],a.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),q=m.bufferLayouts,m=m.attributes;e=g.materialManager.getMaterialProgram(b,a,"materials/fill",m,e);l=this._getVAO(c,q,m,l);c.bindProgram(e);c.bindVAO(l);this._setSharedUniforms(e,b,d);
a.textureBinding&&(g.textureManager.bindTextures(c,e,a),g=1/Math.pow(2,h-d.key.level)/b.pixelRatio,e.setUniform1f("u_zoomFactor",g));a.vvColor&&(e.setUniform1fv("u_vvColorValues",f.vvColorValues),e.setUniform4fv("u_vvColors",f.vvColors));a.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",f.vvOpacityValues),e.setUniform1fv("u_vvOpacities",f.vvOpacities));a.dotDensity&&(a=k.TILE_SIZE/f.ddDotSize,l=a*window.devicePixelRatio*a*window.devicePixelRatio,g=1/Math.pow(2,h-d.key.level),d=1/g*(1/g),b=f.ddDotScale?
b.state.scale/f.ddDotScale:1,e.setUniform1f("u_tileZoomFactor",g),e.setUniform1f("u_tileDotsOverArea",l/(k.TILE_SIZE*window.devicePixelRatio*k.TILE_SIZE*window.devicePixelRatio)),e.setUniformMatrix4fv("u_dotColors",f.ddColors),e.setUniform4fv("u_isActive",f.ddActiveDots),e.setUniform4fv("u_dotBackgroundColor",f.ddBackgroundColor),e.setUniform1f("u_dotValue",Math.max(1,f.ddDotValue*b*d)),this._bindDotDensityTextures(c,e,f,a));c.drawElements(4,n,5125,4*p);c.bindVAO(null)};c.prototype._disposeTextures=
function(){if(this._dotTextures){for(var b=0;b<this._dotTextures.length;b++)this._dotTextures[b].dispose();this._dotTextures=null}};c.prototype._bindDotDensityTextures=function(b,d,a,c){a=this._createDotDensityTextures(b,c,a.ddSeed);d.setUniform1iv("u_dotTextures",this._dotSamplers);for(d=0;d<a.length;d++)b.bindTexture(a[d],this._dotSamplers[d])};c.prototype._createDotDensityTextures=function(b,d,a){if(this._dotTextureSize!==d||this._seed!==a)this._disposeTextures(),this._dotTextureSize=d,this._seed=
a;null===this._dotTextures&&(a=new r(a),this._dotTextures=[this._allocDotDensityTexture(b,d,a),this._allocDotDensityTexture(b,d,a)]);return this._dotTextures};c.prototype._allocDotDensityTexture=function(b,d,a){for(var c=new Float32Array(d*d*4),e=0;e<c.length;e++)c[e]=a.getFloat();return new t.Texture(b,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:d,height:d},c)};return c}(w.default);p.default=n});