// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../core/Error","../../../../../core/Logger"],function(f,g,k,l){function h(c){return"esri.views.2d.layers.FeatureLayerView2D"===c.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===c.declaredClass}Object.defineProperty(g,"__esModule",{value:!0});var m=l.getLogger("esri.views.2d.engine.collisions.LayerViewSorter");f=function(){function c(a,b){this.registerLayer=a;this.unregisterLayer=b;this._layerViewState=new Map}c.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(b){return b.uid===
a.uid})};c.prototype.update=function(a){for(var b=a.added,e=0,d=a.removed;e<d.length;e++)a=d[e],h(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(e=0;e<b.length;e++){a=b[e];if(d=h(a))a:if(a.layer&&a.layer.renderer)switch(a.layer.renderer.type){case "class-breaks":case "simple":case "unique-value":case "dictionary":d=!0;break a;default:m.error(new k("mapview-labeling","Renderer of type "+a.layer.renderer.type+" does not currently support labeling")),d=!1}else d=!1;d&&!this._layerViewState.has(a)&&
this._createState(a)}this._recomputeOrder()};c.prototype.destroy=function(){this._layerViewState.forEach(function(a){return a.handle.remove()})};c.prototype._createState=function(a){var b={priority:-1,handle:null};b.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,b);return b};c.prototype._deleteState=function(a){if(this._layerViewState.has(a)){var b=this._layerViewState.get(a);b.handle.remove();-1!==b.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};
c.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(b,e){var d=e.view.map.allLayers.findIndex(function(a){return a.uid===e.layer.uid}),c=e.layer,d=c.visible&&c.labelsVisible&&c.labelingInfo?4294967295-d:-1;d!==b.priority&&(b.priority=d,a.unregisterLayer(e),-1!==d&&a.registerLayer(e,d))})};return c}();g.LayerViewSorter=f});