// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),function(d,h,n,u,p,q,v){Object.defineProperty(h,"__esModule",{value:!0});d=function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._buf=new Uint8Array(4*q.HITTEST_SEARCH_SIZE*q.HITTEST_SEARCH_SIZE);a._buf32=new Uint32Array(a._buf.buffer);return a}n(c,e);c.prototype.dispose=function(){p.isSome(this._fbo)&&
this._fbo.dispose()};c.prototype.bind=function(a){var f=a.context;a=a.painter;var b=f.getViewport();a=a.getFbos(b.width,b.height).effect0;f.bindFramebuffer(a);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT)};c.prototype.unbind=function(){};c.prototype.draw=function(a,f,b){var c=this,e=a.context,d=a.state,h=a.pixelRatio;void 0===b&&(b=q.HITTEST_SEARCH_SIZE);var n=e.getBoundFramebufferObject(),p=d.size[1],r=b/2,t=b/2;f.forEach(function(a,e){var g=new Map;n.readPixels(Math.floor((e[0]-b/2)*h),
Math.floor((p-e[1]-b/2)*h),b,b,6408,5121,c._buf);for(var k=0;k<c._buf32.length;k++){var l=c._buf32[k];if(4294967295!==l&&0!==l){var d=k%b,m=b-Math.floor(k/b),d=(r-d)*(r-d)+(t-m)*(t-m),m=g.has(l)?g.get(l):4294967295;g.set(l,Math.min(d,m))}}g=u.pairsOfMap(g).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});a.resolve(g);f.delete(e)})};return c}(v.Effect);h.HittestEffect=d});