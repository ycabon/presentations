// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../webgl"],function(f,g,e){Object.defineProperty(g,"__esModule",{value:!0});f=function(){function c(){this._size=[0,0]}c.prototype.dispose=function(){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null);this._mutiplyProgram&&(this._mutiplyProgram.dispose(),this._mutiplyProgram=null);this._quadVAO&&this._quadVAO.dispose(!0)};c.prototype.draw=function(a,k,c,e){var b=a.context,d=a.state.size,h=b.gl;this._setupShader(b);this._createOrResizeTexture(a);
a=this._backBufferTexture;b.bindTexture(a,0);h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,d[0],d[1],0);b.setStencilTestEnabled(!1);b.setStencilWriteMask(0);b.setBlendingEnabled(!0);b.setDepthTestEnabled(!1);b.setDepthWriteEnabled(!1);b.bindVAO(this._quadVAO);d=this._mutiplyProgram;b.bindProgram(d);a.setSamplingMode(c);b.bindTexture(a,0);d.setUniform1i("u_backbufferTexture",0);k.setSamplingMode(c);b.bindTexture(k,1);d.setUniform1i("u_layerTexture",1);d.setUniform1f("u_opacity",e);b.setBlendFunction(1,
0);b.drawArrays(5,0,4);b.bindVAO(null);b.setBlendFunction(1,771)};c.prototype._setupShader=function(a){if(!this._mutiplyProgram){var c={a_pos:0,a_uv:1},f=new e.Program(a,"\n      precision mediump float;\n\n      attribute vec2 a_pos;\n      attribute vec2 a_uv;\n\n      varying vec2 v_uv;\n      void main() {\n        v_uv \x3d a_uv;\n        gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n      }","\n      precision mediump float;\n\n      uniform sampler2D u_backbufferTexture;\n      uniform sampler2D u_layerTexture;\n      uniform float u_opacity;\n\n      const vec4 white \x3d vec4(1.0, 1.0, 1.0, 1.0);\n\n      varying vec2 v_uv;\n      void main() {\n        vec4 backbufferColor \x3d texture2D(u_backbufferTexture, v_uv);\n        vec4 layerColor \x3d u_opacity * texture2D(u_layerTexture, v_uv);\n\n        vec4 tmpComposition \x3d vec4(layerColor.rgb + (1.0 - layerColor.a) * white.rgb, 1.0);\n\n        gl_FragColor \x3d backbufferColor * tmpComposition;\n      }",
c),g=new Int8Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,-1,1,0]);this._quadVAO=new e.VertexArrayObject(a,c,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_uv",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:e.BufferObject.createVertex(a,35044,g)});this._mutiplyProgram=f}};c.prototype._createOrResizeTexture=function(a){var c=a.context;a=a.state.size;if(null===this._backBufferTexture||a[0]!==this._size[0]||a[1]!==this._size[1])this._backBufferTexture?
this._backBufferTexture.resize(a[0],a[1]):this._backBufferTexture=new e.Texture(c,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:a[0],height:a[1]})};return c}();g.BlendEffectMultiply=f});