// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),function(L,w,y,M,z,v,A,d,B,m,C,D){Object.defineProperty(w,"__esModule",{value:!0});var E=z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),r=v.TILE_SIZE+16,x=1/3.8,q=new B.TileClipper(0,0,0,1,16);q.setExtent(v.TILE_SIZE);
var g=new Uint32Array(9),a=new Uint32Array(36),t=new Uint32Array(3),k=new Uint32Array(6),F=function(b){return function(c){c.entry0=b.offset+b.vertexCount++;var n=d.i1616to32(c.distance,31*b._halfWidth),e=d.i8888to32(Math.round(31*c.prevNormal.x),Math.round(31*c.prevNormal.y),Math.round(0),Math.round(-31)),f=d.i8888to32(0,0,0,b._bitset);a[0]=d.i1616to32(c.currentVertex.x,c.currentVertex.y);a[1]=b.id;a[2]=b._fillColor;a[3]=e;a[4]=n;a[5]=b._tl;a[6]=b._br;a[7]=f;a[8]=d.i1616to32(31*b._halfReferenceWidth,
0);c.entry2=b.offset+b.vertexCount++;n=d.i1616to32(c.distance,31*b._halfWidth);e=d.i8888to32(Math.round(31*-c.prevNormal.x),Math.round(31*-c.prevNormal.y),Math.round(0),Math.round(31));f=d.i8888to32(0,0,0,b._bitset);a[9]=d.i1616to32(c.currentVertex.x,c.currentVertex.y);a[10]=b.id;a[11]=b._fillColor;a[12]=e;a[13]=n;a[14]=b._tl;a[15]=b._br;a[16]=f;a[17]=d.i1616to32(31*b._halfReferenceWidth,0);c.exit0=b.offset+b.vertexCount++;n=d.i1616to32(c.distance,31*b._halfWidth);e=d.i8888to32(Math.round(31*c.nextNormal.x),
Math.round(31*c.nextNormal.y),Math.round(0),Math.round(-31));f=d.i8888to32(0,0,0,b._bitset);a[18]=d.i1616to32(c.currentVertex.x,c.currentVertex.y);a[19]=b.id;a[20]=b._fillColor;a[21]=e;a[22]=n;a[23]=b._tl;a[24]=b._br;a[25]=f;a[26]=d.i1616to32(31*b._halfReferenceWidth,0);c.exit2=b.offset+b.vertexCount++;n=d.i1616to32(c.distance,31*b._halfWidth);e=d.i8888to32(Math.round(31*-c.nextNormal.x),Math.round(31*-c.nextNormal.y),Math.round(0),Math.round(31));f=d.i8888to32(0,0,0,b._bitset);a[27]=d.i1616to32(c.currentVertex.x,
c.currentVertex.y);a[28]=b.id;a[29]=b._fillColor;a[30]=e;a[31]=n;a[32]=b._tl;a[33]=b._br;a[34]=f;a[35]=d.i1616to32(31*b._halfReferenceWidth,0);b.geometryBuf.writeRegion(a)}},G=function(b){return function(c){k[0]=c.leftExit0;k[1]=c.rightEntry0;k[2]=c.leftExit2;k[3]=c.rightEntry0;k[4]=c.rightEntry2;k[5]=c.leftExit2;b.indexCount+=6;b.indexBuf.writeRegion(k)}},J=function(b){return function(c,a,e,f,l,H,u,I,h){h=d.i1616to32(h,31*b._halfWidth);l=d.i8888to32(Math.round(31*l),Math.round(31*H),Math.round(31*
u),Math.round(31*I));e=d.i8888to32(31*e,31*f,0,b._bitset);g[0]=d.i1616to32(c,a);g[1]=b.id;g[2]=b._fillColor;g[3]=l;g[4]=h;g[5]=b._tl;g[6]=b._br;g[7]=e;g[8]=d.i1616to32(31*b._halfReferenceWidth,0);b.geometryBuf.writeRegion(g);return b.offset+b.vertexCount++}},K=function(b){return function(a,d,e){t[0]=a;t[1]=d;t[2]=e;b.indexCount+=3;b.indexBuf.writeRegion(t)}};w.default=function(b){return function(b){function a(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];a=b.apply(this,a)||this;a.tessellationProperties=
{_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};a._tessellationOptions={};a.geometryType=A.WGLGeometryType.LINE;return a}y(a,b);a.prototype.writeMesh=function(b,a,c,d,u){var f=a.indexVector,e=a.get("geometry"),l=new C(d,this.geometryType,this._materialKey);a=a.getVector("geometry").vertexCount;l.vertexFrom=a;l.indexFrom=f.length;switch(c){case "esriGeometryPolyline":c=this._clipLines(u.geometry.paths);
if(0===c.length)break;this._write(l,f,e,a,d,c);b.push(l);break;case "esriGeometryPolygon":c=this._clipLines(u.geometry.rings);if(0===c.length)break;this._write(l,f,e,a,d,c);b.push(l);break;default:E.error("Unable to handle geometryType: "+c)}};a.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],g=a[d];q.reset(2);var h=g[0],p=h[0],h=h[1];if(c)q.moveTo(p,h);else{if(-16>p||p>r||-16>h||h>r){c=!0;continue}e.push({x:p,y:h})}for(var k=!1,n=g.length,m=1;m<n;++m)if(p+=g[m][0],h+=
g[m][1],c)q.lineTo(p,h);else{if(-16>p||p>r||-16>h||h>r){k=!0;break}e.push({x:p,y:h})}if(k)c=!0;else{if(c){if(e=q.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};a.prototype._write=function(b,a,c,d,g,k){this.tessellationProperties.id=g;this.tessellationProperties.indexBuf=a;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=c;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=d;for(a=0;a<
k.length;a++)c=k[a],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof m.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),m.tessellate(d,this._tessellationOptions,this._tessellationCallbacks),m.cleanup());b.vertexCount=this.tessellationProperties.vertexCount;b.indexCount=this.tessellationProperties.indexCount;b.zOrder=this._zOrder};a.prototype._initializeTessellator=
function(a){var b=D.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<v.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=x;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;
this._tessellationOptions.innerBisectorAutoSplitThreshold=x;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:F(this.tessellationProperties),bridge:G(this.tessellationProperties)}:(a=new m.StandardTessellationCallbacks(J(this.tessellationProperties),K(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,
this._tessellationCallbacks=a)};return a}(b)}});