// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/scheduling ../../../../core/watchUtils ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),function(g,h,l,m,n,p,k,q,f){Object.defineProperty(h,"__esModule",{value:!0});g=function(e){function c(b){var a=e.call(this,!0)||this;a.view=b;a.frameTask=null;a.watchHandles=new m;a.currentDevice=null;a.transformation={translation:[0,0,0],heading:0,tilt:0};
a.handle=a.registerIncoming("gamepad",function(b){return a.handleEvent(b)});a.handle.pause();return a}l(c,e);c.prototype.onInstall=function(b){var a=this;e.prototype.onInstall.call(this,b);this.watchHandles.add([p.init(this.view.navigation.gamepad,"enabled",function(b){b?(a.handle.resume(),a.frameTask||(a.frameTask=n.addFrameTask({update:function(b){return a.frameUpdate(b.deltaTime)}}))):(a.handle.pause(),a.frameTask&&(a.frameTask.remove(),a.frameTask=null))})])};c.prototype.onUninstall=function(){this.watchHandles.removeAll();
this.frameTask&&(this.frameTask.remove(),this.frameTask=null);e.prototype.onUninstall.call(this)};c.prototype.handleEvent=function(b){var a=this.view.navigation.gamepad.device;a&&b.data.device!==a||this.currentDevice&&this.currentDevice!==b.data.device||("end"===b.data.action?(this.currentDevice=null,f.resetTransformation(this.transformation)):(this.currentDevice=b.data.device,f.extractTransformation(b.data,this.view.navigation.gamepad,this.transformation)))};c.prototype.frameUpdate=function(b){var a=
this.transformation;if(!f.isZeroTransformation(a)){var c=this.view.viewpoint.clone(),d=r*this.view.navigation.gamepad.velocityFactor*b;k.translateBy(c,c,[a.translation[0]*d,-a.translation[1]*d]);d=this.view.size;k.scaleAndRotateBy(c,c,1+a.translation[2]*t*b,this.view.constraints.rotationEnabled?-a.heading*u*b:0,[d[0]/2,d[1]],d);b=this.view.constraints.constrain(c,this.view.viewpoint);this.view.viewpoint=b}};return c}(q.InputHandler);h.GamepadNavigation=g;var u=.06,r=.7,t=6E-4});