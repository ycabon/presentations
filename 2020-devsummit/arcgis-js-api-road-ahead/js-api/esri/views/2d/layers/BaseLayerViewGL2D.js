// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/accessorSupport/decorators ../../../core/libs/earcut/earcut ../../../geometry/support/aaBoundingRect ../../../geometry/support/coordsUtils ../../../layers/graphics/data/projectionSupport ../tiling ../engine/webgl/TurboLine ./LayerView2D ./graphics/graphicsUtils ./support/DisplayGL ./support/util ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(P,Q,D,v,q,k,r,E,F,G,z,H,A,I,J,K,B,L,M){var y=new Set,w=[],x=[],N=function(){return function(q,b,d,a,c,e,l,f,h){void 0===f&&(f=[0,0]);void 0===h&&(h=F.create());this.id=q;this.level=b;this.row=d;this.col=a;this.world=c;this.resolution=e;this.scale=l;this.coords=f;this.bounds=h}}(),O={trackDistance:!0,wrapDistance:1E11,thin:!1,initialDistance:0,enableOuterBisectorSplit:!0,outerBisectorAutoSplitThreshold:1/3.8,enableInnerBisectorSplit:!0,innerBisectorAutoSplitThreshold:1/3.8};return function(C){function b(d){d=
C.call(this,d)||this;d._tileMap=new Map;d.container=new K.default(d);d.layer=null;d.tiles=[];d._renderTarget={framebufferObject:null,viewport:[0,0,0,0]};return d}D(b,C);Object.defineProperty(b.prototype,"_tileInfoView",{get:function(){var d=this.layer&&this.layer.tileInfo;return d?new H.TileInfoView(d):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"context",{get:function(){return this.container&&this.container.stage&&this.container.stage.context.gl},enumerable:!0,configurable:!0});
b.prototype.attach=function(){};b.prototype.detach=function(){};b.prototype.requestRender=function(){this.container.requestRender()};b.prototype.doRefresh=function(){return k(this,void 0,void 0,function(){return q(this,function(d){return[2]})})};b.prototype.isUpdating=function(){return!1};b.prototype.update=function(d){var a=this._tileInfoView,c=this.tiles;if(a){a=a.getTileCoverage(d.state,0);d=a.spans;var a=a.lodInfo,e=a.level;if(d.length)for(var b=0;b<d.length;b++)for(var f=d[b],h=f.row,p=f.colTo,
f=f.colFrom;f<=p;f++){var g=a.normalizeCol(f),n=a.getWorldForColumn(f),m=e+"/"+h+"/"+g+"/"+n;this._tileMap.has(m)||(g=new N(m,e,h,g,n,a.resolution,a.scale),a.getTileCoords(g.coords,g,!1),a.getTileBounds(g.bounds,g,!0),this._tileMap.set(m,g),c.push(g),w.push(g));y.add(m)}}for(d=c.length-1;0<=d;d--)g=c[d],y.has(g.id)||(c.splice(d,1),x.push(g),this._tileMap.delete(g.id));if(w.length||x.length)this.tilesChanged(w,x),w.length=x.length=0;y.clear();this.requestRender()};b.prototype.moveStart=function(){};
b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=function(){};b.prototype.bindRenderTarget=function(){this.context.bindFramebuffer(this.context.FRAMEBUFFER,this._renderTarget.framebufferObject);this.context.viewport(this._renderTarget.viewport[0],this._renderTarget.viewport[1],this._renderTarget.viewport[2],this._renderTarget.viewport[3])};b.prototype.getRenderTarget=function(){return this._renderTarget};b.prototype.tessellateExtent=function(d){return k(this,void 0,void 0,
function(){var a,c,e;return q(this,function(b){switch(b.label){case 0:return a={vertices:[],indices:[]},[4,this._projectAndNormalizeGeometry(d)];case 1:return c=b.sent(),e=a.vertices.length,a.vertices.push({x:c.xmin,y:c.ymin,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:0,distance:0}),a.vertices.push({x:c.xmax,y:c.ymin,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:0,distance:0}),a.vertices.push({x:c.xmin,y:c.ymax,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:1,distance:0}),a.vertices.push({x:c.xmax,y:c.ymax,
xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:1,distance:0}),a.indices.push(e+0,e+1,e+2,e+1,e+3,e+2),[2,a]}})})};b.prototype.tessellatePoint=function(d,a){return k(this,void 0,void 0,function(){var c;return q(this,function(e){switch(e.label){case 0:return[4,this._projectAndNormalizeGeometry(d)];case 1:return c=e.sent(),[2,this._tessellatePoints([c],a)]}})})};b.prototype.tessellateMultipoint=function(d,a){return k(this,void 0,void 0,function(){var c,e;return q(this,function(b){switch(b.label){case 0:return[4,
this._projectAndNormalizeGeometry(d)];case 1:return c=b.sent(),e=c.points.map(function(a){return{x:a[0],y:a[1],spatialReference:c.spatialReference}}),[2,this._tessellatePoints(e,a)]}})})};b.prototype._tessellatePoints=function(d,a){return k(this,void 0,void 0,function(){var c,e,b,f,h;return q(this,function(l){c={vertices:[],indices:[]};e=0;for(b=d;e<b.length;e++)f=b[e],h=c.vertices.length,c.vertices.push({x:f.x,y:f.y,xOffset:a.x,yOffset:a.y+a.height,uTexcoord:0,vTexcoord:0,distance:0}),c.vertices.push({x:f.x,
y:f.y,xOffset:a.x+a.width,yOffset:a.y+a.height,uTexcoord:1,vTexcoord:0,distance:0}),c.vertices.push({x:f.x,y:f.y,xOffset:a.x,yOffset:a.y,uTexcoord:0,vTexcoord:1,distance:0}),c.vertices.push({x:f.x,y:f.y,xOffset:a.x+a.width,yOffset:a.y,uTexcoord:1,vTexcoord:1,distance:0}),c.indices.push(h+0,h+1,h+2,h+1,h+3,h+2);return[2,c]})})};b.prototype.tessellatePolyline=function(d,a){return k(this,void 0,void 0,function(){var c,b,l,f,h,p,g,n,m,k,t,u;return q(this,function(e){switch(e.label){case 0:return c={vertices:[],
indices:[]},[4,this._projectAndNormalizeGeometry(d)];case 1:b=e.sent();l=b.paths;if(!l||!l.length)return[2,c];h=new A.StandardTessellationCallbacks(function(b,d,e,h,g,l,m,p,n){e=c.vertices.length;c.vertices.push({x:b,y:-d,xOffset:g*a/2,yOffset:l*a/2,uTexcoord:n/f,vTexcoord:(p+1)/2,distance:n});return e},function(a,b,d){c.indices.push(a,b,d)});p=0;for(g=l;p<g.length;p++){n=g[p];f=0;for(m=1;m<n.length;++m)k=n[m][0]-n[m-1][0],t=n[m][1]-n[m-1][1],f+=Math.sqrt(k*k+t*t);u=n.map(function(a){return{x:a[0],
y:-a[1]}});A.tessellate(u,O,h)}return[2,c]}})})};b.prototype.tessellatePolygon=function(b){return k(this,void 0,void 0,function(){var a,c,d,l,f,h,p,g,n,m,k,t,u,r=this;return q(this,function(e){switch(e.label){case 0:return a={vertices:[],indices:[]},[4,this._projectAndNormalizeGeometry(b)];case 1:c=e.sent();d=c.rings;if(!d||!d.length)return[2,a];G.closeRings(c);l=0;for(f=c.rings;l<f.length;l++)for(h=f[l],p=0,g=h;p<g.length;p++)n=g[p],n[1]=-n[1];k=m=Infinity;u=t=-Infinity;B.analyzeRings(c.rings,function(){},
function(a,b,c){for(;a<b;a+=2)m=Math.min(m,c[a]),k=Math.min(k,c[a+1]),t=Math.max(t,c[a]),u=Math.max(u,c[a+1])});B.analyzeRings(c.rings,function(){},function(c,b,d,e){r._invokeEarcut(a,c,b,d,e,[m,k,t,u])});return[2,a]}})})};b.prototype._invokeEarcut=function(b,a,c,e,l,f){a=e.slice(a,c);l=E(a,l,2);c=b.vertices.length;for(e=0;e<a.length;e+=2){var d=a[e],k=a[e+1];b.vertices.push({x:d,y:-k,xOffset:0,yOffset:0,uTexcoord:(d-f[0])/(f[2]-f[0]),vTexcoord:1-(k-f[1])/(f[3]-f[1]),distance:0})}for(e=0;e<l.length;++e)b.indices.push(c+
l[e])};b.prototype._projectAndNormalizeGeometry=function(b){return k(this,void 0,void 0,function(){var a,c;return q(this,function(d){switch(d.label){case 0:return[4,z.checkProjectionSupport(b.spatialReference,this.view.spatialReference)];case 1:return d.sent(),a=J.normalizeCentralMeridian(b),c=z.project(a,b.spatialReference,this.view.spatialReference),[2,c]}})})};v([r.property({dependsOn:["layer.loaded"]})],b.prototype,"_tileInfoView",null);v([r.property()],b.prototype,"container",void 0);v([r.property()],
b.prototype,"layer",void 0);v([r.property({dependsOn:["container.stage"]})],b.prototype,"context",null);return b=v([r.subclass("esri.views.2d.layers.BaseLayerViewGL2D")],b)}(r.declared(M.RefreshableLayerView(I.LayerView2D(L))))});