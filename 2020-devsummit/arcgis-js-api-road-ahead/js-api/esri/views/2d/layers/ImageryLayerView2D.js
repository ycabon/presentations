// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapContainer".split(" "),function(r,g,h,d,b,f){Object.defineProperty(g,"__esModule",{value:!0});g.BitmapLayerView2D=function(c){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.container=new f.BitmapContainer(c.clips);return c}d(c,a);c.prototype.initialize=
function(){var a=this;this.handles.add(this.clips.on("change",function(){return a.container.setClips(a.clips)}))};return c=h([b.subclass("esri.views.2d.layers.BitmapLayerView2D")],c)}(b.declared(c))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(r,g,h,d,b,f,c,a,n,k,v,p){Object.defineProperty(g,"__esModule",{value:!0});var w=b.ofType({key:"type",base:n,typeMap:{rect:k,path:p,geometry:v}});g.LayerView2D=function(b){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.clips=new w;a.moving=!1;a.attached=!1;a.blendMode=null;a.lastUpdateId=-1;a.postProcessingEffects=null;a.updateRequested=!1;return a}h(e,b);e.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var d=
function(){return a.notifyChange("rendering")};this.handles.add([c.init(this,"suspended",function(c){a.container&&(a.container.visible=!c);a.view&&!c&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),c.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),c.init(this,["blendMode","container"],function(){a.container&&(a.container.blendMode=a.blendMode)},!0),c.init(this,["postProcessingEffects","container"],function(){a.container&&(a.container.postProcessingEffects=
a.postProcessingEffects)},!0),c.on(this,"container","post-render",d),c.on(this,"container","will-render",d)])};e.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(e.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});e.prototype.isVisibleAtScale=function(a){var c=!0,d=this.layer,b=d.minScale,d=d.maxScale;if(null!=b&&null!=d){var c=!b,e=!d;!c&&a<=b&&(c=!0);!e&&a>=d&&(e=!0);c=c&&e}return c};e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};e.prototype.processUpdate=function(a){this.isFulfilled()&&
!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};e.prototype.isUpdating=function(){return!1};e.prototype.isRendering=function(){return!1};e.prototype.canResume=function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};d([a.property({type:w,set:function(a){a=f.referenceSetter(a,this._get("clips"),w);this._set("clips",a)}})],e.prototype,"clips",void 0);
d([a.property()],e.prototype,"moving",void 0);d([a.property({dependsOn:["attached","suspended","moving"]})],e.prototype,"rendering",null);d([a.property()],e.prototype,"attached",void 0);d([a.property()],e.prototype,"blendMode",void 0);d([a.property()],e.prototype,"container",void 0);d([a.property()],e.prototype,"postProcessingEffects",void 0);d([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],e.prototype,"suspended",void 0);d([a.property({readOnly:!0})],e.prototype,"updateParameters",
void 0);d([a.property()],e.prototype,"updateRequested",void 0);d([a.property({dependsOn:["updateRequested","attached","suspended"]})],e.prototype,"updating",null);d([a.property()],e.prototype,"view",void 0);return e=d([a.subclass("esri.views.2d.layers.LayerView2D")],e)}(a.declared(b))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(r,g,h,d,b,f){return function(c){function a(){return null!==c&&c.apply(this,arguments)||this}d(a,c);return a=h([f.subclass("esri.views.layers.support.ClipArea")],a)}(f.declared(b.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(r,g,h,d,b,f){return function(c){function a(){var a=null!==c&&c.apply(this,
arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}d(a,c);f=a;a.prototype.clone=function(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var f;h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",
void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);h([b.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=f=h([b.subclass("esri.views.layers.support.ClipRect")],a)}(b.declared(f))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(r,g,h,d,b,f,c,a,n){var k={base:c,key:"type",typeMap:{extent:b.Extent,polygon:b.Polygon}};return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}d(b,c);n=b;Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new n({geometry:this.geometry.clone()})};var n;h([f.property({types:k,json:{read:a.fromJSON,write:!0}})],b.prototype,
"geometry",void 0);h([f.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=n=h([f.subclass("esri.views.layers.support.Geometry")],b)}(f.declared(n))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(r,g,h,d,b,f){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;
a.type="path";a.path=[];return a}d(a,c);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});h([b.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);h([b.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=h([b.subclass("esri.views.layers.support.Path")],a)}(b.declared(f))})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(r,g,h,d,b,f,c,a,n,k,v,p,w,t,z,e,A,B){var q=p.create(),u=[0,0],x=new B(0,0,0,0);return function(a){function m(c){var l=a.call(this,c)||this;l._imagePromise=null;l.hidpi=!1;l.imageMaxWidth=2048;l.imageMaxHeight=2048;l.imageRotationSupported=!1;l.imageNormalizationSupported=!1;l.update=n.debounce(function(a,c){return b(l,void 0,void 0,function(){var b,l,f,m,C,n,k,h,y,g=this;return d(this,function(d){b=a.state;l=w.getInfo(b.spatialReference);f=this.hidpi?a.pixelRatio:1;if(!a.stationary||this.destroyed)return[2];
this.imageRotationSupported?(u[0]=b.size[0],u[1]=b.size[1]):e.getOuterSize(u,b);m=Math.floor(u[0]*f)>this.imageMaxWidth||Math.floor(u[1]*f)>this.imageMaxHeight;C=l&&(b.extent.xmin<l.valid[0]||b.extent.xmax>l.valid[1]);n=!this.imageNormalizationSupported&&C;k=!m&&!n;h=this.imageRotationSupported?b.rotation:0;k?this._imagePromise=this._singleExport(b,u,h,f,c):(y=Math.min(this.imageMaxWidth,this.imageMaxHeight),n&&(y=Math.min(b.worldScreenWidth,y)),this._imagePromise=this._tiledExport(b,y,h,f,c));return[2,
this._imagePromise.then(function(a){g._imagePromise=null;var c=g.container.children.slice();g.container.removeAllChildren();a.forEach(g.container.addChild,g.container);g.disposeSource&&c.forEach(function(a){g.disposeSource(a.source)},g)}).catch(function(a){g._imagePromise=null;throw a;})]})})},5E3);return l}f(m,a);m.prototype.destroy=function(){};Object.defineProperty(m.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});m.prototype.updateExports=
function(a){for(var c=0,b=this.container.children;c<b.length;c++){var l=b[c];if(!l.visible||!l.attached)break;a(l)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(l.invalidateTexture(),l.requestRender())}};m.prototype._export=function(a,c,b,d,f,e){var l=this;return n.resolve().then(function(){return l.fetchSource(a,Math.floor(c*f),Math.floor(b*f),{rotation:d,pixelRatio:f,signal:e})}).then(function(b){b=new z.Bitmap(b);b.x=a.xmin;b.y=a.ymax;b.resolution=a.width/c;b.rotation=
d;b.pixelRatio=f;return b})};m.prototype._singleExport=function(a,c,b,d,f){e.getBBox(q,a.center,a.resolution,c);a=new v(q[0],q[1],q[2],q[3],a.spatialReference);return this._export(a,c[0],c[1],b,d,f).then(function(a){return[a]})};m.prototype._tiledExport=function(a,c,b,d,f){var l=this,e=t.create({size:c,spatialReference:a.spatialReference,scales:[a.scale]}),m=new A(e),e=m.getTileCoverage(a);if(!e)return null;var g=[];e.forEach(function(e,n,k,h){x.set(e,n,k,h);m.getTileBounds(q,x);e=new v(q[0],q[1],
q[2],q[3],a.spatialReference);g.push(l._export(e,c,c,b,d,f))});return n.all(g)};c([k.property()],m.prototype,"_imagePromise",void 0);c([k.property()],m.prototype,"container",void 0);c([k.property()],m.prototype,"disposeSource",void 0);c([k.property()],m.prototype,"fetchSource",void 0);c([k.property()],m.prototype,"hidpi",void 0);c([k.property()],m.prototype,"imageMaxWidth",void 0);c([k.property()],m.prototype,"imageMaxHeight",void 0);c([k.property()],m.prototype,"imageRotationSupported",void 0);c([k.property()],
m.prototype,"imageNormalizationSupported",void 0);c([k.property()],m.prototype,"requestUpdate",void 0);c([k.property({dependsOn:["_imagePromise"]})],m.prototype,"updating",null);return m=c([k.subclass("esri.views.2d.layers.support.ExportStrategy")],m)}(k.declared(a))})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});var h=Math.PI/180;g.snapToPixel=function(d,b,f){var c=f.resolution;f=f.size;d[0]=c*(Math.round(b[0]/
c)+f[0]%2*.5);d[1]=c*(Math.round(b[1]/c)+f[1]%2*.5);return d};g.getOuterSize=function(d,b){var f=b.rotation*h,c=Math.abs(Math.cos(f)),f=Math.abs(Math.sin(f)),a=b.size;b=a[0];a=a[1];d[0]=Math.round(a*f+b*c);d[1]=Math.round(a*c+b*f);return d};g.getBBox=function(d,b,f,c){var a=b[0];b=b[1];var g=c[0];c=c[1];f*=.5;d[0]=a-f*g;d[1]=b-f*c;d[2]=a+f*g;d[3]=b+f*c;return d};g.bboxIntersects=function(d,b){var f=d[1],c=d[2],a=d[3],g=b[0],k=b[1],h=b[3];return!(d[0]>b[2]||c<g||f>h||a<k)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),
function(r,g,h,d,b,f,c,a,n,k,v,p,w,t){Object.defineProperty(g,"__esModule",{value:!0});g.ImageryLayerView=function(g){return function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;a.view=null;return a}h(g,e);g.prototype.fetchPopupFeatures=function(d,e){return f(this,void 0,void 0,function(){var f,g,h,m,l,k,p,y,q,r,D;return b(this,function(b){switch(b.label){case 0:f=this.layer;if(!d)return[2,n.reject(new c("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}))];
g=f.popupEnabled;h=t.getFetchPopupTemplate(f,e);if(!g||!a.isSome(h))throw new c("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:g,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return m=b.sent(),l=new w,l.geometry=d,l.outFields=m,l.outSpatialReference=d.spatialReference,k=this.view.resolution,p="2d"===this.view.type?new v(k,k,this.view.spatialReference):new v(.5*k,.5*k,this.view.spatialReference),y=h.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},q=y.returnTopmostRaster,r=y.showNoDataRecords,D={returnDomainValues:!0,returnTopmostRaster:q,pixelSize:p,showNoDataRecords:r},[2,f.queryVisibleRasters(l,D).then(function(a){return a})]}})})};d([k.property()],g.prototype,"layer",void 0);d([k.property()],g.prototype,"view",void 0);d([k.property(p.combinedViewLayerTimeExtentProperty)],g.prototype,"timeExtent",void 0);return g=d([k.subclass("esri.views.layers.ImageryLayerView")],g)}(k.declared(g))}})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(r,g,h,d,b,f,c){Object.defineProperty(g,"__esModule",{value:!0});g.getRequiredFields=function(a,g){void 0===g&&(g=a.popupTemplate);return d(this,void 0,void 0,function(){var d,n,p,r,t,z,e,A,B,q,u,x;return h(this,function(h){switch(h.label){case 0:return f.isSome(g)?[4,g.getRequiredFields(a.fields)]:[2,[]];case 1:d=h.sent();n=g.lastEditInfoEnabled;p=a.objectIdField;r=a.typeIdField;t=a.globalIdField;z=a.relationships;if(b.includes(d,"*"))return[2,["*"]];A=c.fixFields;B=[a.fields];u=(q=d).concat;
return(x=n)?[4,c.getFeatureEditFields(a)]:[3,3];case 2:x=h.sent(),h.label=3;case 3:return e=A.apply(void 0,B.concat([u.apply(q,[x||null])])),r&&e.push(r),e&&p&&c.hasField(a.fields,p)&&-1===e.indexOf(p)&&e.push(p),e&&t&&c.hasField(a.fields,t)&&-1===e.indexOf(t)&&e.push(t),z&&z.forEach(function(b){b=b.keyField;e&&b&&c.hasField(a.fields,b)&&-1===e.indexOf(b)&&e.push(b)}),[2,e]}})})};g.getFetchPopupTemplate=function(a,b){return a.popupTemplate?a.popupTemplate:f.isSome(b)&&b.defaultPopupTemplateEnabled&&
f.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine/ImageryBitmapSource ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(r,
g,h,d,b,f,c,a,n,k,v,p,w,t,z,e,A,B,q,u){var x=a.getLogger("esri.views.2d.layers.ImageryLayerView2D");return function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b._exportImageVersion=-1;return b}h(e,a);Object.defineProperty(e.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=w.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});e.prototype.hitTest=function(a,b){if(this.suspended)return n.resolve(null);a=this.view.toMap(k.createScreenPoint(a,b));return n.resolve(new c({attributes:{},geometry:a}))};e.prototype.update=function(a){this.strategy.update(a).catch(function(a){n.isAbortError(a)||x.error(a)})};
e.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();this.strategy=new A({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([v.init(this,"layer.exportImageServiceParameters.version",function(b){a._exportImageVersion!==
b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(c){var d=b.source;d.pixelBlock=c.pixelBlock;d.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update")};e.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.strategy.destroy();this.container.removeAllChildren();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};e.prototype.moveStart=function(){};e.prototype.viewChange=function(){};e.prototype.moveEnd=function(){this.requestUpdate()};e.prototype.doRefresh=function(){return f(this,void 0,void 0,function(){return b(this,function(a){this.requestUpdate();return[2]})})};e.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};e.prototype.fetchImage=
function(a,b,c,d){var e=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");d=d||{};d.timeExtent=this.timeExtent;d.requestAsImageElement=!0;return this.layer.fetchImage(a,b,c,d).then(function(a){return a.imageElement?a.imageElement:e.layer.applyRenderer(a.pixelData,{signal:d.signal}).then(function(b){b=new t.default(b.pixelBlock,b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return e.layer.applyFilter(a)};return b})})};d([p.property({dependsOn:["updating"]})],
e.prototype,"pixelData",null);d([p.property()],e.prototype,"strategy",void 0);d([p.property({dependsOn:["strategy.updating"]})],e.prototype,"updating",void 0);return e=d([p.subclass("esri.views.2d.layers.ImageryLayerView2D")],e)}(p.declared(B.ImageryLayerView(u.RefreshableLayerView(z.BitmapLayerView2D(e.LayerView2D(q))))))});