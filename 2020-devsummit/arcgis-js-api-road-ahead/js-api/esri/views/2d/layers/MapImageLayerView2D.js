// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/LayerView ../../layers/MapImageLayerView ../../layers/RefreshableLayerView ../../support/drapedUtils".split(" "),
function(A,B,g,h,d,k,l,m,n,p,c,q,r,t,u,v,w,x,y){var z=m.getLogger("esri.views.2d.layers.MapImageLayerView2D");return function(f){function a(){var a=null!==f&&f.apply(this,arguments)||this;a._exportImageParameters=null;a._exportImageVersion=-1;return a}h(a,f);a.prototype.hitTest=function(){return null};a.prototype.update=function(a){this.strategy.update(a).catch(function(a){n.isAbortError(a)||z.error(a)})};a.prototype.attach=function(){var a=this,b=this.layer,c=b.imageMaxWidth,d=b.imageMaxHeight,e=
b.version,b=10.3<=e,e=10<=e;this.strategy=new u({container:this.container,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:c,imageMaxHeight:d,imageRotationSupported:b,imageNormalizationSupported:e,hidpi:!0});this._exportImageParameters=new q.ExportImageParameters({view:this.view,layer:this.layer});this.handles.add(p.init(this._exportImageParameters,"version",function(b){a._exportImageVersion!==b&&(a._exportImageVersion=b,a.requestUpdate())}),"mapimagelayerview-update")};
a.prototype.detach=function(){this.strategy.destroy();this.handles.remove("mapimagelayerview-update");this._exportImageParameters.layer=null;this._exportImageParameters.destroy();this._exportImageParameters=null;this._exportImageVersion=-1;this.container.removeAllChildren()};a.prototype.moveStart=function(){};a.prototype.viewChange=function(){};a.prototype.moveEnd=function(){this.requestUpdate()};a.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return y.createQueryGeometry(a,b,this.view)};
a.prototype.doRefresh=function(){return l(this,void 0,void 0,function(){return k(this,function(a){this.requestUpdate();return[2]})})};a.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};a.prototype.fetchImage=function(a,b,c,d){return this.layer.fetchImage(a,b,c,g({timeExtent:this._exportImageParameters.timeExtent,timestamp:this.refreshTimestamp},d))};d([c.property()],a.prototype,"strategy",void 0);d([c.property({dependsOn:["strategy.updating"]})],
a.prototype,"updating",void 0);return a=d([c.subclass("esri.views.2d.layers.MapImageLayerView2D")],a)}(c.declared(w.MapImageLayerView(x.RefreshableLayerView(r.BitmapLayerView2D(t.LayerView2D(v))))))});