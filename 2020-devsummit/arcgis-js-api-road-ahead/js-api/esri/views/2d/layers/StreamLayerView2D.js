// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet ./FeatureLayerView2D ./support/util".split(" "),function(w,x,l,e,m,n,p,q,f,d,r,t,u){function v(c,a){if(f.isNone(c)&&f.isNone(a))return null;var b={};f.isSome(a)&&(b.geometry=
a.toJSON());f.isSome(c)&&(b.where=c);return b}return function(c){function a(){var b=null!==c&&c.apply(this,arguments)||this;b._enabledDataReceived=!1;b.errorString=null;b.connectionStatus="disconnected";return b}l(a,c);a.prototype.initialize=function(){var b=this;this.handles.add(this.layer.on("post-feature",function(a){b._proxy.postFeature(a.featureString)}))};a.prototype.destroy=function(){this.connectionStatus="disconnected"};Object.defineProperty(a.prototype,"connectionError",{get:function(){if(this.errorString)return new q("stream-controller",
this.errorString)},enumerable:!0,configurable:!0});a.prototype.on=function(b,a){"data-received"===b&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",!0));var g=this.inherited(arguments,[b,a]),h=this;return{remove:function(){g.remove();h.hasEventListener("data-received")||h._proxy.enableEvent("data-received",!1)}}};a.prototype.queryLatestObservations=function(b,a){var g=this;return this._proxy.queryLatestObservations(this._cleanUpQuery(b),a).then(function(b){b=r.fromJSON(b);b.features.forEach(function(b){b.layer=
g.layer;b.sourceLayer=g.layer});return b})};a.prototype._createClientOptions=function(){var b=this,a=this.inherited(arguments);return m({},a,{setProperty:function(a){b.set(a.propertyName,a.value)}})};a.prototype._createTileRendererHash=function(){var b=this.inherited(arguments),a=this.layer,c=JSON.stringify(a.geometryDefinition)+"."+a.definitionExpression;return b+"."+c+"."+(a.purgeOptions&&a.purgeOptions.age+"."+a.purgeOptions.displayCount)};a.prototype._createServiceOptions=function(){return p(this,
void 0,void 0,function(){var b,a,c,d,e,f,k;return n(this,function(g){b=this.layer;a=b.objectIdField;c=b.source;d=b.fields.map(function(a){return a.toJSON()});e=u.toJSONGeometryType(b.geometryType);f=b.timeInfo&&b.timeInfo.toJSON()||null;k=b.spatialReference?b.spatialReference.toJSON():null;return[2,{type:"stream",fields:d,geometryType:e,objectIdField:a,timeInfo:f,source:JSON.stringify(c),url:this.layer.parsedUrl,serviceFilter:v(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions,
enableDataReceived:this._enabledDataReceived,spatialReference:k}]})})};e([d.property()],a.prototype,"errorString",void 0);e([d.property({dependsOn:["errorString"],readOnly:!0})],a.prototype,"connectionError",null);e([d.property()],a.prototype,"connectionStatus",void 0);return a=e([d.subclass("esri.views.2d.layers.StreamLayerView2D")],a)}(d.declared(t))});