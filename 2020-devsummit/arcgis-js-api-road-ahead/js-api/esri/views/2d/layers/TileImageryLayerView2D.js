// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(w,a,p,l,g,d,c,e,k){function r(a,b){var f;if(!b)return null;if("x"in b){var n={x:0,y:0};a=a(b.x,b.y,t);n.x=a[0];n.y=a[1];null!=b.z&&(n.z=b.z);
null!=b.m&&(n.m=b.m);return n}if("xmin"in b)return n={xmin:0,ymin:0,xmax:0,ymax:0},f=a(b.xmin,b.ymin,t),n.xmin=f[0],n.ymin=f[1],a=a(b.xmax,b.ymax,t),n.xmax=a[0],n.ymax=a[1],b.hasZ&&(n.zmin=b.zmin,n.zmax=b.zmax,n.hasZ=!0),b.hasM&&(n.mmin=b.mmin,n.mmax=b.mmax,n.hasM=!0),n;if("rings"in b)return{rings:v(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:v(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:m(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function v(a,b){for(var f=[],
n=0;n<a.length;n++)f.push(m(a[n],b));return f}function m(a,b){for(var f=[],n=0;n<a.length;n++){var q=a[n],c=b(q[0],q[1],[0,0]);f.push(c);2<q.length&&c.push(q[2]);3<q.length&&c.push(q[3])}return f}function u(a,b){return!e.isValid(a)||!e.isValid(b)||e.equals(a,b)||k.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var t=[0,0];a.doesBrowserSupportProjection=function(a,b){return u(a,b)?c.isSupported():!0};a.checkProjectionSupport=function(a,b){return l(this,void 0,void 0,function(){var f,
n,q;return p(this,function(E){if(!b)return[2];if(Array.isArray(a)){f=0;for(n=a;f<n.length;f++)if(q=n[f],u(q.geometry&&q.geometry.spatialReference,b)){if(c.isSupported())return[2,c.load()];throw new g("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});}return[2]}if(!u(a,b))return[2];if(c.isSupported())return[2,c.load()];throw new g("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});})})};
var x=r.bind(null,k.lngLatToXY),h=r.bind(null,k.xyToLngLat);a.project=function(a,b,E){if(!a)return a;E||(E=b,b=a.spatialReference);return e.isValid(b)&&e.isValid(E)&&!e.equals(b,E)?k.canProject(b,E)?e.isWebMercator(E)?x(a):h(a):c.projectMany([a],b,E,null,!0)[0]:a};var b=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,f){return l(this,void 0,void 0,function(){var q,c=this;return p(this,function(n){a&&a.length&&b&&f&&!e.equals(b,
f)||d.resolve(a);q={geometries:a,inSpatialReference:b,outSpatialReference:f,resolve:null};this._jobs.push(q);return[2,d.create(function(a){q.resolve=a;null===c._timer&&(c._timer=setTimeout(c._process,10))})]})})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,f=a.inSpatialReference,q=a.outSpatialReference,a=a.resolve;k.canProject(f,q)?e.isWebMercator(q)?a(b.map(x)):a(b.map(h)):a(c.projectMany(b,f,q,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}};return a}());a.projectMany=function(a,c,e){return l(this,void 0,void 0,function(){return p(this,function(f){return[2,b.push(a,c,e)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(w,a,p,l,g,d){function c(a,c,t,x,h){void 0===x&&(x=null);void 0===h&&(h=!1);if(null===x){var b=d.cacheKey(c,t);void 0!==v[b]?x=v[b]:(x=e(c,t,null),null===x&&(x=new d),v[b]=x)}return k._project(a,
c,t instanceof g||!1===h?t:new g(t),x,h)}function e(a,c,e){void 0===e&&(e=null);a=k._getTransformation(a,c,e);return null!==a?d.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var k=null;a.isLoaded=function(){return!!k&&l.isLoaded()};a.isSupported=function(){return l.isSupported()};var r=null;a.load=function(){return r?r:r=p.create(function(a,c){var e=l.load();w(["./geometryEngine"],function(d){k=d;e.then(function(){k._enableProjection(l);a()},function(a){c(a)})})})};a.project=function(a,
e,d){void 0===d&&(d=null);return a instanceof Array?0===a.length?[]:c(a,a[0].spatialReference,e,d):c([a],a.spatialReference,e,d)[0]};var v={};a.projectMany=c;a.getTransformation=e;a.getTransformations=function(a,c,e){void 0===e&&(e=null);a=k._getTransformationBySuitability(a,c,e);if(null!==a){c=[];for(e=0;e<a.length;e++)c.push(d.fromGE(a[e]));return c}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(w,
a,p,l,g){function d(b){function f(a,b,c){a[b]=c(a[b])}a._pe=b;m.init();u.init();t.init();x.init();h.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}p(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var c=0,e=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];c<e.length;c++)b=e[c],f(b.prototype,"getName",function(a){return function(){return a.call(this,
Array(m.PE_NAME_MAX))}});c=0;for(e=[a._pe.PeGeogtran,a._pe.PeProjcs];c<e.length;c++)b=e[c],f(b.prototype,"getParameters",function(b){return function(){for(var c=Array(m.PE_PARM_MAX),f=b.call(this),e=0;e<c.length;e++){var q=a._pe.getValue(f,"*");c[e]=q?a._pe.wrapPointer(q,a._pe.PeParameter):null;f+=Int32Array.BYTES_PER_ELEMENT}return c}});f(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],f=a.call(this);r(c,b,f);return c}});f(a._pe.PeGTlistExtendedEntry.prototype,
"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var f=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var f=[e],q=this.getSteps();if(1<q)for(var e=a._pe.getPointer(e),n=1;n<q;n++)f.push(a._pe.wrapPointer(e+c*n,a._pe.PeGTlistExtendedGTs))}return f}});var n=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var f=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var f=[e],
q=e.getNump();if(1<q)for(var e=a._pe.getPointer(e),d=1;d<q;d++)f.push(a._pe.wrapPointer(e+n*d,a._pe.PeHorizon))}c.set(b,f);return f}};f(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);f(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=m.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),f=a._pe.ensureInt8(Array(m.PE_BUFFER_MAX));return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,f))}}function c(b){if(b){var c=
a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function e(b,c){var e=[];c=Array(c);for(var f=0;f<b;f++)e.push(a._pe.ensureInt8(c));return e}function k(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function r(b,c,e,d){void 0===d&&(d=!1);if(d)for(d=0;d<2*c;d++)b[d]=a._pe.getValue(e+d*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===b.length;for(d=0;d<c;d++)f&&(b[d]=Array(2)),b[d][0]=a._pe.getValue(e,"double"),b[d][1]=
a._pe.getValue(e+Float64Array.BYTES_PER_ELEMENT,"double"),e+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var v;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!l("esri-wasm")};a.load=function(){return v?v:v=g.create(function(a,c){w(["./support/pe-wasm"],function(b){b({locateFile:function(a){return w.toUrl("./support/"+a)},onAbort:function(a){c(Error(a))}}).then(function(b){d(b);a()})})})};(function(b){function c(b,c,e){a._pe.ensureCache.prepare();
var f=k(e),d=e===f,f=a._pe.ensureFloat64(f);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,f))&&r(e,c,f,d);return b}function e(a,b,c){return d(a,b,c,0)}function d(b,c,e,f){a._pe.ensureCache.prepare();var d=k(e),q=e===d,d=a._pe.ensureFloat64(d);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,d,f))&&r(e,c,d,q);return b}b.geogToProj=c;b.projGeog=function(a,b,f,d){switch(d){case m.PE_TRANSFORM_P_TO_G:return e(a,b,f);case m.PE_TRANSFORM_G_TO_P:return c(a,b,f)}return 0};b.projToGeog=e;b.projToGeogCenter=
d})(a.PeCSTransformations||(a.PeCSTransformations={}));var m;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;
b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;
b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;
b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(m=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var f=null,q=d[b];q||(q={},d[b]=q);q.hasOwnProperty(String(c))?f=q[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(f=b,q[c]=f));return f=e(f)}function e(b){if(b){var c=b.getType();switch(c){case m.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case m.PE_TYPE_PROJCS:b=a._pe.castObject(b,
a._pe.PeProjcs);break;case m.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&m.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var d={},n={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(m.PE_TYPE_COORDSYS,a)};b.factoryByType=c;b.fromString=function(b,c){var f=null,d=n[b];d||(d={},n[b]=d);d.hasOwnProperty(c)?f=d[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(f=b,d[c]=f));return f=
e(f)};b.geogcs=function(a){return c(m.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(m.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(m.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(m.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var u;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=
function(b,e,f,d,g,h){var n=null,q=new a._pe.PeInteger(h);try{var k=a._pe.PeGTlistExtended.prototype.getGTlist(b,e,f,d,g,q);if(h=q.val)if(n=[k],1<h){var t=a._pe.getPointer(k);for(b=1;b<h;b++)n.push(a._pe.wrapPointer(t+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(q)}return n}})(u=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var e=0;e<b.length;e++){var d=b[e];c(d);d.getEntries().forEach(function(a){c(a);a=a.getGeogtran();c(a);a.getParameters().forEach(c);
[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){c(a);var b=a.getDatum();c(b);c(b.getSpheroid());c(a.getPrimem());c(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,e,d,h){a._pe.ensureCache.prepare();var f=k(e),n=e===f,f=a._pe.ensureFloat64(f),g=0;d&&(g=a._pe.ensureFloat64(d));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,f,g,h))&&r(e,c,f,n);return b}})(a.PeGTTransformations||
(a.PeGTTransformations={}));(function(b){function c(b,c,d,f,h,g){a._pe.ensureCache.prepare();var n,q;switch(b){case "dd":n=a._pe._pe_geog_to_dd;q=m.PE_DD_MAX;break;case "ddm":n=a._pe._pe_geog_to_ddm;q=m.PE_DDM_MAX;break;case "dms":n=a._pe._pe_geog_to_dms,q=m.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=k(f);c=a._pe.ensureFloat64(c);q=e(d,q);f=a._pe.ensureInt32(q);if(h=n(b,d,c,h,f))for(n=0;n<d;n++)g[n]=a._pe.UTF8ToString(q[n]);return h}function d(b,c,e,d,f){a._pe.ensureCache.prepare();var h;switch(b){case "dd":h=
a._pe._pe_dd_to_geog;break;case "ddm":h=a._pe._pe_ddm_to_geog;break;case "dms":h=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*e));(h=h(b,e,d,c))&&r(f,e,c);return h}b.geog_to_dms=function(a,b,e,d,f){return c("dms",a,b,e,d,f)};b.dms_to_geog=function(a,b,c,e){return d("dms",a,b,c,e)};b.geog_to_ddm=function(a,b,e,d,f){return c("ddm",a,b,e,d,f)};b.ddm_to_geog=function(a,b,c,e){return d("ddm",
a,b,c,e)};b.geog_to_dd=function(a,b,e,d,f){return c("dd",a,b,e,d,f)};b.dd_to_geog=function(a,b,c,e){return d("dd",a,b,c,e)}})(a.PeNotationDms||(a.PeNotationDms={}));var t;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=
a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,d,h,g,t,r){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=k(d);d=a._pe.ensureFloat64(b);b=e(c,m.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(h=a._pe._pe_geog_to_mgrs_extended(f,c,d,h,g,t,n))for(g=0;g<c;g++)r[g]=a._pe.UTF8ToString(b[g]);return h};b.mgrs_to_geog_extended=function(b,c,e,d,h){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});
e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(d=a._pe._pe_mgrs_to_geog_extended(f,c,e,d,b))&&r(h,c,b);return d}})(t=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,d,h,g,t,r){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=k(d);d=a._pe.ensureFloat64(b);b=e(c,m.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(h=a._pe._pe_geog_to_usng(f,c,d,h,g,t,n))for(g=0;g<c;g++)r[g]=a._pe.UTF8ToString(b[g]);return h};b.usng_to_geog=function(b,c,e,d){a._pe.ensureCache.prepare();
var f=0;b&&(f=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(f=a._pe._pe_usng_to_geog(f,c,e,b))&&r(d,c,b);return f}})(a.PeNotationUsng||(a.PeNotationUsng={}));var x;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,d,h,g){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=k(d);d=a._pe.ensureFloat64(b);b=e(c,m.PE_UTM_MAX);var t=a._pe.ensureInt32(b);if(h=a._pe._pe_geog_to_utm(f,c,d,h,t))for(f=0;f<c;f++)g[f]=a._pe.UTF8ToString(b[f]);return h};b.utm_to_geog=function(b,c,e,d,h){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(d=a._pe._pe_utm_to_geog(f,c,e,d,b))&&r(h,c,b);return d}})(x=
a.PeNotationUtm||(a.PeNotationUtm={}));var h;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(e,d){void 0===d&&(d=b.PE_PCSINFO_OPTION_DOMAIN);var f,h;c.has(e)&&(h=c.get(e),h[d]&&(f=h[d]));f||(f=a._pe.PePCSInfo.prototype.generate(e,
d),h||(h=[],c.set(e,h)),h[d]=f);return f}})(h=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=d})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(w,a,p){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var d=0;for(a=a.steps;d<
a.length;d++){var c=a[d];c instanceof p?this.steps.push(c):this.steps.push(new p({wkid:c.wkid,wkt:c.wkt,isInverse:c.isInverse}))}}}a.cacheKey=function(a,d){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==d.wkid&&null!==d.wkid?d.wkid.toString():"-1",void 0!==d.wkt&&null!==d.wkt?d.wkt.toString():""].join()};a.fromGE=function(g){var d=new a,c="",e=0;for(g=g.steps;e<g.length;e++){var k=p.fromGE(g[e]);d.steps.push(k);c+=k.uid.toString()+
","}d._cached_projection={};d._gtlistentry=null;d._chain=c;return d};a.prototype.getInverse=function(){var g=new a;g.steps=[];for(var d=this.steps.length-1;0<=d;d--)g.steps.push(this.steps[d].getInverse());return g};a.prototype.getGTListEntry=function(){for(var a="",d=0,c=this.steps;d<c.length;d++)a+=c[d].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(g,d,c){this._cached_projection[a.cacheKey(g,
d)]=c};a.prototype.getCachedGeTransformation=function(g,d){for(var c="",e=0,k=this.steps;e<k.length;e++)c+=k[e].uid.toString()+",";c!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=c);g=this._cached_projection[a.cacheKey(g,d)];return void 0===g?null:g};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(w,a){var p=0;return function(){function a(a){void 0===a&&(a=null);this.uid=p++;a?(this._wkt=void 0!==
a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(g){var d=new a;d._wkt=g.wkt;d._wkid=g.wkid;d._isInverse=g.isInverse;return d};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=
a;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=p++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var g=new a;g._wkt=this.wkt;g._wkid=this._wkid;g._isInverse=!this.isInverse;return g};return a}()})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["require","exports","../../../geometry","../rasterFunctions/rasterProjectionHelper"],
function(w,a,p,l){function g(a,e){if(!d.has(a))return null;a=d.get(a);return null==a[e]?null:a[e]}Object.defineProperty(a,"__esModule",{value:!0});var d=new Map;a.register=function(a,e){e={extent:null,rasterInfo:e,cache:new Map};if(d.has(a))return a=d.get(a),a.push(e),a.length-1;d.set(a,[e]);return 0};a.unregister=function(a,e){d.has(a)&&(d.get(a)[e]=null)};a.deleteRaster=function(a){d.delete(a)};a.getBlock=function(a,e,k){if(!d.has(a))return null;var c=d.get(a);if(null==c[e]){for(var g=0;g<c.length;g++)if(c[g].cache.has(k))return c[g].cache.get(k);
return null}a=c[e].cache;if(a.has(k))return a.get(k);for(g=0;g<c.length;g++)if(g!==e&&c[g]&&c[g].cache.has(k))return e=c[g].cache.get(k),a.set(k,e),e;return null};a.putBlock=function(a,e,g,r){if(!d.has(a))return null;a=d.get(a);if(null==a[e])return null;a[e].cache.set(g,r)};a.update=function(a,e,d,r,v,m,u){void 0===u&&(u=null);a=g(a,e);e=a.extent;var c=a.cache,k=a.rasterInfo;d=d.clone().normalize()[0];if(!e||e.xmin!==d.xmin||e.xmax!==d.xmax||e.ymin!==d.ymin||e.ymax!==d.ymax){var h=k.spatialReference;
e=l.projectExtent(d,h,u);r=new p.Point({x:r,y:r,spatialReference:d.spatialReference});if(null===v&&(v=l.projectResolution(r,h,d,u),!v))return;u=l.snapPyramid(v,k,m||"closest");v=u.pyramidLevel;m=u.pyramidResolution;if(!u.excessiveReading){h=Math.floor((e.xmin-k.storageInfo.origin.x)/m.x);u=Math.floor((k.storageInfo.origin.y-e.ymax)/m.y);var b=0<v?k.storageInfo.pyramidBlockWidth:k.storageInfo.blockWidth,f=0<v?k.storageInfo.pyramidBlockHeight:k.storageInfo.blockHeight,k=Math.floor(h/b);r=Math.floor(u/
f);h=Math.floor((h+Math.ceil((e.xmax-e.xmin)/m.x-.1)-1)/b);e=Math.floor((u+Math.ceil((e.ymax-e.ymin)/m.y-.1)-1)/f);var F=new Set;for(m=r-1;m<=e+1;m++)for(u=k-1;u<=h+1;u++)F.add(v+"/"+m+"/"+u);c.forEach(function(a,b){F.has(b)||c.delete(b)});a.extent={xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax}}}}})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(w,a,p,l,g,d,c,e,k,r,v,m){Object.defineProperty(a,"__esModule",{value:!0});var u=function(a,c){var d=(a.isWGS84||a.isWebMercator)&&(c.isWGS84||c.isWebMercator);return!(a.equals(c)||d)};a.defaultGridSpacing=32;a.load=function(){return d(this,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return r.isLoaded()||!r.isSupported()?[2,null]:[4,r.load()];case 1:return a.sent(),[2]}})})};a.projectResolution=function(a,c,d,b){void 0===b&&(b=null);if(a.spatialReference.equals(c))return a;
var f=u(a.spatialReference,c);if(f&&!r.isLoaded())throw new k("rasterprojectionhelper-projectResolution","projection engine is not loaded");d=d.center;a=new e.Extent({xmin:d.x-a.x/2,xmax:d.x+a.x/2,ymin:d.y-a.y/2,ymax:d.y+a.y/2,spatialReference:a.spatialReference});b=f?r.project(a,c,b):m.project(a,c);return null==b?null:new e.Point(b.xmax-b.xmin,b.ymax-b.ymin,c)};a.projectPoint=function(a,c,d){void 0===d&&(d=null);if(a.spatialReference.equals(c))return a;var b=u(a.spatialReference,c);if(b&&!r.isLoaded())throw new k("rasterprojectionhelper-projectResolution",
"projection engine is not loaded");return b?r.project(a,c,d):m.project(a,c)};a.projectExtent=function(a,c,d){void 0===d&&(d=null);if(a.spatialReference.equals(c))return a;var b=u(a.spatialReference,c);if(b&&!r.isLoaded())throw new k("rasterprojectionhelper-projectExtent","projection engine is not loaded");return b?r.project(a,c,d):m.project(a,c)};a.getProjectionOffsetGrid=function(c,d,h,b,f,g){void 0===b&&(b=null);void 0===f&&(f=!1);void 0===g&&(g=[a.defaultGridSpacing,a.defaultGridSpacing]);var t=
d.spatialReference.equals(c.spatialReference),n=u(c.spatialReference,d.spatialReference);if(n&&!r.isLoaded())throw new k("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(c&&d&&h))return null;var q=c.xmin,l=c.ymin,p=c.xmax,x=c.ymax,w=c.spatialReference,F=d.spatialReference,D=v.getInfo(w),A=D&&D.valid[0],y=D&&D.valid[1],G=g[0]*h.x,B=g[1]*h.y,p=Math.ceil((p-q)/G-.1)+1,l=Math.ceil((x-l)/B-.1)+1,z;h=[];var I;c=!1;for(var H=0;H<p;H++){for(var L=[],C=0;C<l;C++)z=new e.Point({x:q+
G*H,y:x-B*C,spatialReference:w}),z=t?z:n?r.project(z,F,b):m.project(z,F),L.push(z),0<H&&f&&z&&I[C]&&D&&z.x<I[C].x&&(z.x+=y-A),z?(h.push((z.x-d.xmin)/(d.xmax-d.xmin)),h.push((d.ymax-z.y)/(d.ymax-d.ymin))):(h.push(NaN),h.push(NaN),c=!0);I=L}d=[Math.abs((h[0]+h[4]+h[4*p]+h[4*p+4])/4-h[2*l+2]),Math.abs((h[1]+h[5]+h[4*l+1]+h[4*l+5])/4-h[2*l+3])];b=new Float32Array((p-1)*(l-1)*12);f=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);t=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(H=0;H<p-1;H++){for(C=0;C<l-1;C++){A=
H*l*2+2*C;n=h[A];q=h[A+1];x=h[A+2];I=h[A+3];A+=2*l;w=h[A];F=h[A+1];D=h[A+2];A=h[A+3];y=0;G=12*(C*(p-1)+H);for(B=0;3>B;B++)b[G++]=f[y++]*n+f[y++]*x+f[y++]*D;for(B=y=0;3>B;B++)b[G++]=f[y++]*q+f[y++]*I+f[y++]*A;for(B=y=0;3>B;B++)b[G++]=t[y++]*n+t[y++]*w+t[y++]*D;for(B=y=0;3>B;B++)b[G++]=t[y++]*q+t[y++]*F+t[y++]*A}if(c)for(C=0;C<b.length;C++)isNaN(b[C])&&(b[C]=-1)}return{offsets:h,error:d,coefficients:b,spacing:g,size:[p-1,l-1]}};a.snapPyramid=function(a,c,d){var b=Math.log(a.x/c.pixelSize.x)/Math.LN2,
f=Math.log(a.y/c.pixelSize.y)/Math.LN2;a=c.storageInfo.maximumPyramidLevel||0;d="down"===d?Math.floor(Math.min(b,f)):"up"===d?Math.ceil(Math.max(b,f)):Math.round((b+f)/2);b=!1;0>d?d=0:d>a&&(b=d>a+3,d=a);a=Math.pow(2,d);c=new e.Point({x:a*c.pixelSize.x,y:a*c.pixelSize.y,spatialReference:c.spatialReference});return{pyramidLevel:d,pyramidResolution:c,excessiveReading:b}}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(w,a,p,l,g,d,c,e,k,r,v,m){Object.defineProperty(a,"__esModule",{value:!0});var u=g.ofType({key:"type",base:k,typeMap:{rect:r,path:m,geometry:v}});a.LayerView2D=function(a){return function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.clips=new u;b.moving=!1;b.attached=!1;b.blendMode=null;b.lastUpdateId=-1;b.postProcessingEffects=null;b.updateRequested=!1;return b}p(h,a);h.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var d=
function(){return a.notifyChange("rendering")};this.handles.add([c.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),c.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),c.init(this,["blendMode","container"],function(){a.container&&(a.container.blendMode=a.blendMode)},!0),c.init(this,["postProcessingEffects","container"],function(){a.container&&(a.container.postProcessingEffects=
a.postProcessingEffects)},!0),c.on(this,"container","post-render",d),c.on(this,"container","will-render",d)])};h.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(h.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});h.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,e=!c;!b&&a<=d&&(b=!0);!e&&a>=c&&(e=!0);b=b&&e}return b};h.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};h.prototype.processUpdate=function(a){this.isFulfilled()&&
!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};h.prototype.isUpdating=function(){return!1};h.prototype.isRendering=function(){return!1};h.prototype.canResume=function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};l([e.property({type:u,set:function(a){a=d.referenceSetter(a,this._get("clips"),u);this._set("clips",a)}})],h.prototype,"clips",void 0);
l([e.property()],h.prototype,"moving",void 0);l([e.property({dependsOn:["attached","suspended","moving"]})],h.prototype,"rendering",null);l([e.property()],h.prototype,"attached",void 0);l([e.property()],h.prototype,"blendMode",void 0);l([e.property()],h.prototype,"container",void 0);l([e.property()],h.prototype,"postProcessingEffects",void 0);l([e.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],h.prototype,"suspended",void 0);l([e.property({readOnly:!0})],h.prototype,"updateParameters",
void 0);l([e.property()],h.prototype,"updateRequested",void 0);l([e.property({dependsOn:["updateRequested","attached","suspended"]})],h.prototype,"updating",null);l([e.property()],h.prototype,"view",void 0);return h=l([e.subclass("esri.views.2d.layers.LayerView2D")],h)}(e.declared(a))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(w,a,p,l,g,d){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}l(c,a);return c=p([d.subclass("esri.views.layers.support.ClipArea")],c)}(d.declared(g.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(w,a,p,l,g,d){return function(a){function c(){var c=null!==a&&a.apply(this,
arguments)||this;c.type="rect";c.left=null;c.right=null;c.top=null;c.bottom=null;return c}l(c,a);d=c;c.prototype.clone=function(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var d;p([g.property({type:[Number,String],json:{write:!0}})],c.prototype,"left",void 0);p([g.property({type:[Number,String],json:{write:!0}})],c.prototype,"right",
void 0);p([g.property({type:[Number,String],json:{write:!0}})],c.prototype,"top",void 0);p([g.property({type:[Number,String],json:{write:!0}})],c.prototype,"bottom",void 0);p([g.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],c.prototype,"version",null);return c=d=p([g.subclass("esri.views.layers.support.ClipRect")],c)}(g.declared(d))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(w,a,p,l,g,d,c,e,k){var r={base:c,key:"type",typeMap:{extent:g.Extent,polygon:g.Polygon}};return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.type="geometry";c.geometry=null;return c}l(c,a);g=c;Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new g({geometry:this.geometry.clone()})};var g;p([d.property({types:r,json:{read:e.fromJSON,write:!0}})],c.prototype,
"geometry",void 0);p([d.property({readOnly:!0,dependsOn:["geometry"]})],c.prototype,"version",null);return c=g=p([d.subclass("esri.views.layers.support.Geometry")],c)}(d.declared(k))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(w,a,p,l,g,d){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;
c.type="path";c.path=[];return c}l(c,a);Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});p([g.property({type:[[[Number]]],json:{write:!0}})],c.prototype,"path",void 0);p([g.property({readOnly:!0,dependsOn:["path"]})],c.prototype,"version",null);return c=p([g.subclass("esri.views.layers.support.Path")],c)}(g.declared(d))})},"esri/views/layers/TileImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/accessorSupport/decorators".split(" "),
function(w,a,p,l,g,d,c,e){Object.defineProperty(a,"__esModule",{value:!0});a.TileImageryLayerView=function(a){return function(a){function k(){var c=null!==a&&a.apply(this,arguments)||this;c.layer=null;c.view=null;c.datumTransformation=null;return c}p(k,a);Object.defineProperty(k.prototype,"hasTilingEffects",{get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment},enumerable:!0,configurable:!0});k.prototype.fetchPopupFeatures=
function(a,e){return d(this,void 0,void 0,function(){return g(this,function(a){throw new c("rasterlayerview:fetchpopupfeatures","not implemented");})})};l([e.property()],k.prototype,"layer",void 0);l([e.property()],k.prototype,"view",void 0);l([e.property({readOnly:!0,dependsOn:["layer.renderer"]})],k.prototype,"hasTilingEffects",null);return k=l([e.subclass("esri.views.layers.TileImageryLayerView")],k)}(e.declared(a))}})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(w,a,p,l,g,d){function c(a,c,d,e){void 0===e&&(e=new p.Extent);var k;if("2d"===d.type)k=c*d.resolution;else if("3d"===d.type){var l=d.basemapTerrain,r=l.overlayManager,r=r?r.overlayPixelSizeInMapUnits(a):1;k=l&&!l.spatialReference.equals(d.spatialReference)?g.getMetersPerUnitForSR(l.spatialReference)/g.getMetersPerUnitForSR(d.spatialReference):c*r}c=a.x-k;l=a.y-k;r=a.x+k;a=a.y+k;d=d.spatialReference;e.xmin=Math.min(c,r);e.ymin=Math.min(l,a);e.xmax=Math.max(c,r);e.ymax=Math.max(l,a);e.spatialReference=
d;return e}Object.defineProperty(a,"__esModule",{value:!0});a.createQueryGeometry=c;a.intersectsDrapedGeometry=function(a,g,p){a=p.toMap(a);if(l.isNone(a))return null;var k=d.calculateTolerance();return c(a,k,p,e).intersects(g)?a:null};var e=new p.Extent})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(w,a){function p(a,c){return c&&c.xoffset?Math.max(a,Math.abs(c.xoffset)):c&&c.yoffset?Math.max(a,Math.abs(c.yoffset)):a}function l(a,c){if("number"===
typeof a)return a;if(a&&a.stops&&a.stops.length){a=a.stops;for(var d=c=0,g=0;g<a.length;g++){var l=a[g].size;"number"===typeof l&&(c+=l,d++)}return c/d}return c}function g(a,c){if(!c)return a;c=c.filter(function(a){return"size"===a.type}).map(function(c){var d=c.minSize;return(l(c.maxSize,a)+l(d,a))/2});var d=0,g=c.length;if(0===g)return a;for(var p=0;p<g;p++)d+=c[p];return Math.max(Math.floor(d/g),a)}Object.defineProperty(a,"__esModule",{value:!0});a.calculateTolerance=function(a){var c=a&&a.renderer;
a="touch"===(a&&a.event&&a.event.pointerType)?9:6;if(!c)return a;a="visualVariables"in c?g(a,c.visualVariables):a;if("simple"===c.type)return p(a,c.symbol);if("unique-value"===c.type){var d=a;c.uniqueValueInfos.forEach(function(a){d=p(d,a.symbol)});return d}if("class-breaks"===c.type){var k=a;c.classBreakInfos.forEach(function(a){k=p(k,a.symbol)});return k}return a}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/data/projectionSupport ../../../layers/support/PixelBlock ../../../layers/support/TileInfo ../../../layers/support/rasterDatasets/RawBlockCache ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ../engine ./LayerView2D ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/TileImageryLayerView ../../support/drapedUtils".split(" "),function(w,
a,p,l,g,d,c,e,k,r,v,m,u,t,x,h,b,f,F,E,n,q,J,K,M,N,O,D,A,y,G,B){var z=m.getLogger("esri.views.2d.layers.TileImageryLayerView2D"),I=[0,0];return function(a){function m(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new r;b._tileStrategy=null;b._tileInfoView=null;b._fetchQueue=null;b._blockCacheRegistryUrl=null;b._blockCacheRegistryId=null;b._tileInfo=null;b._fullExtent=null;b._bitmapView=null;b._emptyTilePixelBlock=null;b._previousSrcResolution=null;b._needBlockCacheUpdate=!1;b._globalSymbolizerParams=
null;b._abortController=null;b._globalUpdateRequested=!1;b._isGCS=!1;b.useWebGLForProcessing=null;b.container=new K.Container;b.datumTransformation=null;b.layer=null;b._redrawDebounced=t.debounce(function(a){return b._redrawImage(a)},2E3);return b}p(m,a);m.prototype.initialize=function(){var a=this.layer.tileInfo,b;a&&a.spatialReference||(b=new k("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));a=this.view.spatialReference;f.doesBrowserSupportProjection(a,
this.layer.spatialReference)?(this._fullExtent=J.projectExtent(this.layer.fullExtent,a,this.datumTransformation),null==this._fullExtent&&(b=new k("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}))):b=new k("layerview:projection-not-supported","The layer requires projection engine, which is not supported in current browser",{layer:this.layer});b&&this.addResolvingPromise(t.reject(b))};Object.defineProperty(m.prototype,"useProgressiveUpdate",
{get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(a){var b=this;this._tileStrategy&&this.useProgressiveUpdate!==a&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new D({cachePolicy:a?"keep":"purge",resampling:!1,acquireTile:function(a){return b.acquireTile(a)},releaseTile:function(a){return b.releaseTile(a)},cacheSize:a?40:0,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",a),this.requestUpdate())},
enumerable:!0,configurable:!0});m.prototype.hitTest=function(a,b){if(this.suspended)return t.resolve(null);a=this.view.toMap(x.createScreenPoint(a,b));return t.resolve(new e({attributes:{},geometry:a}))};m.prototype.update=function(a){this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();var b=!this.useProgressiveUpdate||this._needBlockCacheUpdate;if(this.layer.raster&&b){var b=a.state.extent,d=this._previousViewResolution===a.state.resolution?
this._previousSrcResolution:J.projectResolution(new c.Point({x:a.state.resolution,y:a.state.resolution,spatialReference:this.view.spatialReference}),this.layer.spatialReference,this._fullExtent,this.datumTransformation);n.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,b.toJSON?b:c.Extent.fromJSON(b),a.state.resolution,d,this.layer.raster.ioConfig.sampling);this._previousViewResolution=a.state.resolution;this._previousSrcResolution=d;this._needBlockCacheUpdate=!1}this.notifyChange("updating")};
m.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();null==this.useWebGLForProcessing&&(this.useWebGLForProcessing=this.layer._symbolizer.canRenderInWebGL);v("esri-webgl-texture-float")&&v("esri-webgl-color-buffer-float")||(this.useWebGLForProcessing=!1);this.useWebGLForProcessing&&(this.container.stage.context.gl.getExtension("WEBGL_color_buffer_float"),this.container.stage.context.gl.getExtension("OES_texture_float"));this._tileInfo=this._createTileInfo();this._tileInfoView=
new N(this._tileInfo,this._fullExtent);this._fetchQueue=new O({tileInfoView:this._tileInfoView,concurrency:10,process:function(b,c){return a.fetchTile(b,c)}});this._tileStrategy=new D({cachePolicy:this.useProgressiveUpdate?"keep":"purge",resampling:!1,acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView});this._bitmapView=new K.RasterTileContainer(this._tileInfoView,this.clips);this.container.addChild(this._bitmapView);
this._handles.add([h.watch(this,["layer.interpolation","layer.bandIds","layer.renderer"],function(){return a._redrawDebounced().catch(function(a){t.isAbortError(a)||z.error(a)})}),h.watch(this,["layer.multidimensionalDefinition"],this.refreshDebounced),this.clips.on("change",function(){a._bitmapView.setClips(a.clips)})]);this._updateBlockCacheRegistry()};m.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();
this._fetchQueue=this._tileStrategy=this._tileInfoView=null;n.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};m.prototype.moveStart=function(){this.requestUpdate()};m.prototype.viewChange=function(){this.requestUpdate()};m.prototype.moveEnd=function(){var a=this;if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=t.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(function(){a._globalUpdateRequested=
!1;a.requestUpdate()});this.requestUpdate()};m.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return B.createQueryGeometry(a,b,this.view)};m.prototype.doRefresh=function(){return d(this,void 0,void 0,function(){var a=this;return g(this,function(b){if(this.updateRequested||this.suspended)return[2];this._updateBlockCacheRegistry();this._fetchQueue.reset();this._tileStrategy.tiles.forEach(function(b){return a._enqueueTileFetch(b)});this.notifyChange("updating");return[2]})})};m.prototype.isUpdating=
function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};m.prototype.acquireTile=function(a){var b;a=this._bitmapView.createTile(a);var c=a.bitmap;b=this._tileInfoView.getTileCoords(I,a.key);c.x=b[0];c.y=b[1];c.resolution=this._tileInfoView.getTileResolution(a.key);b=this._tileInfoView.tileInfo.size;c.width=b[0];c.height=b[1];this._enqueueTileFetch(a);this.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;return a};
m.prototype.releaseTile=function(a){var b=this;this._fetchQueue.abort(a.key.id);this._bitmapView.removeChild(a);a.once("detach",function(){a.destroy();b.requestUpdate()});this.requestUpdate()};m.prototype.fetchTile=function(a,b){return d(this,void 0,void 0,function(){var c,d,e,f;return g(this,function(g){switch(g.label){case 0:c=!u.isNone(b)&&b.signal,d={tileInfo:this._tileInfo,signal:u.unwrap(c),registryId:this._blockCacheRegistryId,requestRawData:this.useWebGLForProcessing,srcResolution:this._previousSrcResolution,
datumTransformation:this.datumTransformation},g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.layer.fetchTile(a.level,a.row,a.col,d)];case 2:return e=g.sent(),null===e?[2,null]:[2,e];case 3:f=g.sent();if(!t.isAbortError(f))return[2,null];throw f;case 4:return[2]}})})};m.prototype._createTileInfo=function(){var a=this.view.spatialReference;this._isGCS=a.isGeographic;var b=new c.Point({x:this._fullExtent.xmin,y:this._fullExtent.ymax,spatialReference:a}),a=E.create({spatialReference:a,size:512});
if(0===a.origin.x||a.origin.x>b.x)a.origin=b;return a};m.prototype._enqueueTileFetch=function(a,b){return d(this,void 0,void 0,function(){var b,c,d,e,f,h,k,l,m,n,p=this;return g(this,function(g){switch(g.label){case 0:if(this._fetchQueue.has(a.key.id))return[2];g.label=1;case 1:return g.trys.push([1,13,,14]),[4,this._fetchQueue.push(a.key)];case 2:b=g.sent();c=this.layer;d=c.bandIds;e=c.interpolation;f=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(!this._globalUpdateRequested||
this.moving||0!==this._fetchQueue.length)return[3,7];f=!1;g.label=3;case 3:return g.trys.push([3,5,,6]),[4,this._redrawImage(this._abortController&&this._abortController.signal)];case 4:return g.sent(),[3,6];case 5:return h=g.sent(),t.isAbortError(h)&&z.error(h),[3,6];case 6:this._globalUpdateRequested=!1,g.label=7;case 7:if(!b||!b.pixelBlock)return[3,11];if(this.useWebGLForProcessing)return[3,9];k={extent:b.extent,pixelBlock:b.pixelBlock};return[4,this.layer.applyRenderer(k,this.hasTilingEffects?
this._globalSymbolizerParams:null)];case 8:return l=g.sent(),a.bitmap.rawPixelData=k,a.bitmap.source=l,[3,10];case 9:a.bitmap.source=b.pixelBlock,g.label=10;case 10:return a.bitmap.symbolizerParameters=this.useWebGLForProcessing?this._globalSymbolizerParams||this.layer._symbolizer.generateWebGLParameters({pixelBlock:q.extractBands(b.pixelBlock,d),isGCS:this._isGCS,resolution:{x:this._previousViewResolution,y:this._previousViewResolution}}):null,!a.bitmap.transformGrid&&this.useWebGLForProcessing&&
(a.bitmap.transformGrid=b.transformGrid),[3,12];case 11:m=this._createEmptyTilePixelBlock(),a.bitmap.source=m,a.bitmap.symbolizerParameters=this.useWebGLForProcessing?this.layer._symbolizer.generateWebGLParameters({pixelBlock:m,isGCS:this._isGCS,resolution:{x:this._previousViewResolution,y:this._previousViewResolution}}):null,a.bitmap.transformGrid=null,g.label=12;case 12:return a.bitmap.bandIds=d,a.bitmap.width=this._tileInfoView.tileInfo.size[0],a.bitmap.height=this._tileInfoView.tileInfo.size[1],
a.bitmap.interpolation=e,a.bitmap.suspended=f,a.attached&&a.bitmap.updateTexture(),a.once("attach",function(){return p.requestUpdate()}),this._bitmapView.addChild(a),[3,14];case 13:return n=g.sent(),t.isAbortError(n)||z.error(n),[3,14];case 14:return this.requestUpdate(),[2]}})})};m.prototype._redrawImage=function(a){return d(this,void 0,void 0,function(){var b,c,e,f,h=this;return g(this,function(k){switch(k.label){case 0:return this.layer.updateRenderer(),this.hasTilingEffects?[4,this._updateGlobalSymbolizerParams(a)]:
[3,2];case 1:return k.sent(),[3,3];case 2:this._globalSymbolizerParams=null,k.label=3;case 3:return b=this.layer,c=b.bandIds,e=b.interpolation,f=this._bitmapView.children.map(function(a){return d(h,void 0,void 0,function(){var b;return g(this,function(d){switch(d.label){case 0:if(this.useWebGLForProcessing)return[3,2];b=a.bitmap;return[4,this.layer.applyRenderer(a.bitmap.rawPixelData,this.hasTilingEffects?this._globalSymbolizerParams:null)];case 1:b.source=d.sent(),d.label=2;case 2:return a.bitmap.symbolizerParameters=
this.useWebGLForProcessing?this._globalSymbolizerParams||this.layer._symbolizer.generateWebGLParameters({pixelBlock:q.extractBands(a.bitmap.source,c),isGCS:this._isGCS,resolution:{x:this._previousViewResolution,y:this._previousViewResolution}}):null,a.bitmap.bandIds=c,a.bitmap.interpolation=e,a.bitmap.suspended=!1,[2]}})})}),[4,t.eachAlways(f)];case 4:return k.sent(),this.container.requestRender(),[2]}})})};m.prototype._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){var a=this._tileInfoView.tileInfo.size[0],
b=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new F({width:a,height:b,pixels:[new Uint8Array(a*b)],mask:new Uint8Array(a*b),pixelType:"u8"})}return this._emptyTilePixelBlock};m.prototype._updateGlobalSymbolizerParams=function(a){return d(this,void 0,void 0,function(){var b,c,d;return g(this,function(e){switch(e.label){case 0:return b={srcResolution:this._previousSrcResolution,registryId:this._blockCacheRegistryId,signal:a},[4,this.layer.fetchPixels(this.view.extent,this.view.width,
this.view.height,b)];case 1:c=e.sent();if(!c||!c.pixelBlock)return[2];d=this.layer._symbolizer.generateWebGLParameters({pixelBlock:q.extractBands(c.pixelBlock,this.layer.bandIds),isGCS:this._isGCS,resolution:{x:this._previousViewResolution,y:this._previousViewResolution}});!this.useWebGLForProcessing&&d&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(d.factor=d.factor.map(function(a){return 255*a}),d.outMin=Math.round(255*d.outMin),d.outMax=Math.round(255*d.outMax));this._globalSymbolizerParams=
d;return[2]}})})};m.prototype._updateBlockCacheRegistry=function(){var a=this.layer,b=a.url,c=a.rasterInfo,d=a.multidimensionalDefinition,a=a.raster,b=d&&c&&c.multidimensionalInfo?b+"?sliceId\x3d"+a.getSliceIndex(d):b;b!==this._blockCacheRegistryUrl&&(null==this._blockCacheRegistryUrl&&n.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=n.register(b,this.layer.raster.rasterInfo),this._blockCacheRegistryUrl=b)};l([b.property()],m.prototype,"useProgressiveUpdate",
null);return m=l([b.subclass("esri.views.2d.layers.TileImageryLayerView2D")],m)}(b.declared(G.TileImageryLayerView(y.RefreshableLayerView(M.LayerView2D(A)))))});