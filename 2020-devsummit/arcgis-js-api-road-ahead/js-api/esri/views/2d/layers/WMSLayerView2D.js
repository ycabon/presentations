// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../layers/support/ExportWMSImageParameters ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/WMSLayerView".split(" "),
function(F,G,p,q,c,r,t,u,v,b,w,x,y,z,A,B,C,D){var E=u.getLogger("esri.views.2d.layers.WMSLayerView2D");return function(d){function a(){return null!==d&&d.apply(this,arguments)||this}q(a,d);a.prototype.hitTest=function(){return null};a.prototype.update=function(a){this.strategy.update(a).catch(function(a){v.isAbortError(a)||E.error(a)})};a.prototype.attach=function(){var a=this,e=this.layer,k=this.view,b=e.imageMaxHeight,f=e.imageMaxWidth;this.strategy=new A({container:this.container,fetchSource:this.fetchImage.bind(this),
requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:b,imageMaxWidth:f,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1});this._exportWMSImageParameters=new x({layer:e,view:k});this.handles.add(this._exportWMSImageParameters.watch("version",function(h){a._exportImageVersion!==h&&(a._exportImageVersion=h,a.requestUpdate())}),"wms")};a.prototype.detach=function(){this.handles.remove("wms");this.container.removeAllChildren();this.strategy.destroy();this._exportWMSImageParameters.layer=
null;this._exportWMSImageParameters.destroy();this._exportWMSImageParameters=null;this.container.removeAllChildren()};a.prototype.moveStart=function(){};a.prototype.viewChange=function(){};a.prototype.moveEnd=function(){this.requestUpdate()};a.prototype.canResume=function(){var a=this.inherited(arguments);return a?this.layer.supportsSpatialReference(this.view.spatialReference):a};a.prototype.createFetchPopupFeaturesQuery=function(a){var e=a.x,b=a.y,h=this.view.spatialReference,f=null,c=0,d=0;this.container.children.some(function(a){var k=
a.width,m=a.height,g=a.resolution,l=a.x;a=a.y;var n=l+g*k,g=a-g*m;return e>=l&&e<=n&&b<=a&&b>=g?(f=new w({xmin:l,ymin:g,xmax:n,ymax:a,spatialReference:h}),c=k,d=m,!0):!1});a=f.width/c;return{extent:f,width:c,height:d,x:Math.round((e-f.xmin)/a),y:Math.round((f.ymax-b)/a)}};a.prototype.doRefresh=function(){return t(this,void 0,void 0,function(){return r(this,function(a){this.requestUpdate();return[2]})})};a.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};
a.prototype.fetchImage=function(a,b,c,d){return this.layer.fetchImage(a,b,c,p({timestamp:this.refreshTimestamp},d))};c([b.property()],a.prototype,"strategy",void 0);c([b.property({dependsOn:["view.spatialReference","layer.spatialReferences"]})],a.prototype,"suspended",void 0);c([b.property({dependsOn:["strategy.updating"]})],a.prototype,"updating",void 0);return a=c([b.subclass("esri.views.2d.layers.WMSLayerView2D")],a)}(b.declared(D.WMSLayerView(C.RefreshableLayerView(y.BitmapLayerView2D(z.LayerView2D(B))))))});