// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../../core/tsSupport/generatorHelper","../../../../../../core/tsSupport/awaiterHelper","../../../../../../core/promiseUtils"],function(b,c,f,g,e){Object.defineProperty(c,"__esModule",{value:!0});b=function(){function a(){this._action=null;this._queue=[];this._abortController=e.createAbortController();this._refs=1}a.prototype.up=function(){this._refs++};a.prototype.down=function(){this._refs--;return 0===this._refs};a.prototype.clear=function(){this._abortController.abort();
this._abortController=e.createAbortController()};a.prototype.destroy=function(){this._queue.length=0;this._action&&(this._action=null)};a.prototype.enqueue=function(a){this._action?this._queue.push(a):this._setAction(a)};a.prototype.flush=function(){return g(this,void 0,void 0,function(){var a,b,d;return f(this,function(c){a=this._action;if(!a)return[2];b=this._abortController.signal;d=this._queue.reduce(function(a,c){return a.then(function(){return c(b)})},a);this._action=d.then(this._handleNext.bind(this));
this._queue.length=0;return[2,d]})})};a.prototype.hasAction=function(){return!!this._action};a.prototype._setAction=function(a){this._action=a(this._abortController.signal).then(this._handleNext.bind(this))};a.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null};return a}();c.default=b});