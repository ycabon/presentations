// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../core/mathUtils"],function(h,d,p,k){function l(a,b,f,g,c){a=new Uint32Array(a*a);b="buffer"in b?b:new Float64Array(b);f="buffer"in f?new Uint32Array(f.buffer):new Uint32Array((new Uint8Array(f)).buffer);c=f.length/(c-g);for(var e=0;e<b.length;e++)a[e]=f[k.clamp(Math.floor((b[e]-g)*c),0,f.length-1)];return a.buffer}function n(a){for(var b=Math.round(3*a),f=2*a*a,g=new Float64Array(2*
b+1),c=0;c<=g.length;c++)g[c]=Math.exp(-Math.pow(c-b,2)/f)/Math.sqrt(2*Math.PI)*(a/2);return g}function u(a,b){return"function"===typeof a?a:a?"string"===typeof b?function(b){return-1*+b[a]}:function(f){return+f[a]+b}:function(){return 1}}Object.defineProperty(d,"__esModule",{value:!0});d.generateGradient=function(){if(!("document"in p))return function(){return null};var a=document.createElement("canvas"),b=a.getContext("2d");a.height=512;a.width=1;return function(f){b.clearRect(0,0,1,a.height);var g=
b.createLinearGradient(0,0,0,a.height),c=0;for(f=f.colorStops;c<f.length;c++){var e=f[c],m=e.color;g.addColorStop(Math.max(e.ratio,.001),"rgba("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+")")}b.fillStyle=g;b.fillRect(0,0,1,a.height);return b.getImageData(0,0,1,a.height).data}}();d.calculateHeatmapIntensityInfo=function(a,b,f,g){var c=b.blurRadius,e=b.fieldOffset,m=b.field;b=new Float64Array(f*g);for(var d=n(c),c=Math.round(3*c),k=Number.NEGATIVE_INFINITY,q,e=u(m,e),m=0;m<a.length;m++){var h=a[m],l=h.geometry,
p=l.x-c,v=l.y-c,w=Math.max(0,p);q=Math.max(0,v);for(var x=Math.min(g,l.y+c),l=Math.min(f,l.x+c),h=+e(h.attributes),r=q;r<x;r++)for(var y=d[r-v],t=w;t<l;t++)q=b[r*f+t]+=y*d[t-p]*h,q>k&&(k=q)}return{matrix:b.buffer,max:k}};d.drawHeatmap=function(a,b,f,g,c,e){a.canvas.width=a.canvas.height=b;a.clearRect(0,0,b,b);var m=a.getImageData(0,0,b,b);f&&g&&m.data.set(new Uint8ClampedArray(l(b,f,g,c,e)));a.putImageData(m,0,0)};d.createHeatmapImageData=l;d.createKernel=n;d.createValueFunction=u})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(h,d,p,k,l,n){Object.defineProperty(d,"__esModule",{value:!0});h=function(d){function a(a){a=d.call(this,a)||this;a.tiles=new Map;return a}p(a,d);a.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});a.prototype.acquireTile=function(a){var b=this,d=this.createTile(a);d.once("isReady",function(){return b.notifyChange("updating")});
this.tiles.set(a.id,d);return d};a.prototype.lockAttributeTextureUpload=function(){};a.prototype.unlockAttributeTextureUpload=function(){};a.prototype.forceAttributeTextureUpload=function(){};a.prototype.forEachTile=function(a){this.tiles.forEach(a)};a.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};a.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(b){a=a&&b.isReady});return!a};a.prototype.setHighlight=function(){};a.prototype.invalidateLabels=
function(){};a.prototype.requestUpdate=function(){this.layerView.requestUpdate()};k([n.property()],a.prototype,"layer",void 0);k([n.property()],a.prototype,"layerView",void 0);k([n.property()],a.prototype,"tileInfoView",void 0);k([n.property()],a.prototype,"updating",null);return a=k([n.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],a)}(n.declared(l.HandleOwner));d.default=h})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["require",
"exports","../../../../../../renderers/support/heatmapUtils"],function(h,d,p){Object.defineProperty(d,"__esModule",{value:!0});h=function(){function d(){this.gradient=null;this.width=this.height=512}d.prototype.render=function(d){p.drawHeatmap(d,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)};return d}();d.HeatmapSource=h})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(h,d,p,k,l,n,u,a,b,f){Object.defineProperty(d,"__esModule",{value:!0});h=function(b){function c(e){var c=b.call(this,e)||this;c._intensityInfo={minPixelIntensity:0,
maxPixelIntensity:0};c.featuresView={attributeView:{initialize:function(){},requestUpdate:function(){}},requestRender:function(){}};var d=e.layerView.clips;c._container=new a.BitmapTileContainer(e.tileInfoView,e.layerView.clips);c.handles.add([d.on("change",function(){return c._container.setClips(d)})]);return c}k(c,b);c.prototype.createTile=function(a){var b=this._container.createTile(a);this.tileInfoView.getTileCoords(b.bitmap,a);b.bitmap.resolution=this.tileInfoView.getTileResolution(a);return b};
c.prototype.onConfigUpdate=function(){var a=this,b=this.layer.renderer;if("heatmap"===b.type){var c=b.minPixelIntensity,d=b.maxPixelIntensity;this._intensityInfo.minPixelIntensity=c;this._intensityInfo.maxPixelIntensity=d;this._gradient=u.generateGradient(b.toJSON());this.tiles.forEach(function(b){var e=b.bitmap.source;e&&(e.minPixelIntensity=c,e.maxPixelIntensity=d,e.gradient=a._gradient,b.bitmap.invalidateTexture())})}};c.prototype.hitTest=function(){return l.resolve([])};c.prototype.install=function(a){a.addChild(this._container)};
c.prototype.uninstall=function(a){this._container.removeAllChildren();a.removeChild(this._container)};c.prototype.disposeTile=function(a){this._container.removeChild(a);a.destroy()};c.prototype.supportsRenderer=function(a){return a&&"heatmap"===a.type};c.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b){a=a.intensityInfo;var c=this._intensityInfo,d=c.minPixelIntensity,c=c.maxPixelIntensity,e=b.bitmap.source||new f.HeatmapSource;e.intensities=a&&a.matrix||null;e.minPixelIntensity=
d;e.maxPixelIntensity=c;e.gradient=this._gradient;b.bitmap.source=e;this._container.addChild(b);this.requestUpdate()}};c.prototype.onTileError=function(a){console.error(a)};return c=p([n.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],c)}(n.declared(b.default));d.default=h});