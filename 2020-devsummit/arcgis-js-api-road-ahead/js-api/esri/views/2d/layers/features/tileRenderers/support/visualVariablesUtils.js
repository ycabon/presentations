// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/assignHelper ../../../../../../core/screenUtils ../../../../engine ../../../../engine/webgl/definitions ../../../../../3d/layers/support/FastSymbolUpdates".split(" "),function(w,f,r,m,h,t,u){function p(a){return{value:a.value,size:m.toPt(a.size)}}function k(a){return a.map(function(a){return p(a)})}function n(a){return"string"===typeof a||"number"===typeof a?m.toPt(a):{type:"size",expression:a.expression,stops:k(a.stops)}}function v(a){var d=
{values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(h.Utils.isString(a.field))if(a.stops){if(8<a.stops.length)return null;var c=a.stops;for(a=0;8>a;++a){var g=c[Math.min(a,c.length-1)];d.values[a]=g.value;d.opacities[a]=g.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)d.values[a]=Infinity,d.opacities[a]=c;else return null;return d}Object.defineProperty(f,"__esModule",{value:!0});var l=h.enums.WGLVVFlag;f.getVisualVariableSizeValueRepresentationRatio=
function(a,d){if(!a||!d)return a;switch(d){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};f.stopToSizeStop=p;f.normalizeSizeStops=k;f.normalizeSizeElement=n;f.getVisualVariablesFields=function(a){var d=a&&0<a.length?{}:null;d&&a.forEach(function(a){var c=a.type;a.field&&(d[c]=a.field)});return d};var q=function(a){var d=[],c=[];a=k(a);for(var g=a.length,b=0;6>b;b++){var e=a[Math.min(b,g-1)];d.push(e.value);c.push(null==e.size?t.NAN_MAGIC_NUMBER:m.pt2px(e.size))}return{values:new Float32Array(d),
sizes:new Float32Array(c)}};f.convertVisualVariables=function(a){var d=a&&0<a.length?{}:null,c=d?{}:null;if(!d)return{vvFields:d,vvRanges:c};for(var g=0;g<a.length;g++){var b=a[g],e=b.type;b.field&&(d[e]=b.field);if("size"===e)switch(c.size||(c.size={}),h.getTypeOfSizeVisualVariable(b)){case l.SIZE_MINMAX_VALUE:c.size.minMaxValue={minDataValue:b.minDataValue,maxDataValue:b.maxDataValue,minSize:n(b.minSize),maxSize:n(b.maxSize)};break;case l.SIZE_SCALE_STOPS:c.size.scaleStops={stops:k(b.stops)};break;
case l.SIZE_FIELD_STOPS:if(b.levels){var e={},f;for(f in b.levels)e[f]=q(b.levels[f]);c.size.fieldStops={type:"level-dependent",levels:e}}else c.size.fieldStops=r({type:"static"},q(b.stops));break;case l.SIZE_UNIT_VALUE:c.size.unitValue={unit:b.valueUnit,valueRepresentation:b.valueRepresentation}}else if("color"===e)for(b=u.convertVisualVariables([b],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),c.color=b.color,b=0;32>b;b+=4)h.color.premultiplyAlpha(c.color.colors,b,!0);else"opacity"===
e?c.opacity=v(b):"rotation"===e&&(c.rotation={type:b.rotationType})}return{vvFields:d,vvRanges:c}}});