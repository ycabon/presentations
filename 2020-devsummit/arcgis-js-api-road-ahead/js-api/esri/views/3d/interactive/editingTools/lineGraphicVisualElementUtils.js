// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/elevationInfoUtils ./ManipulatorState ./settings ../visualElements/LaserlineVisualElement ../visualElements/LineVisualElement ../visualElements/OutlineVisualElement ../../layers/graphics/GraphicState ../../support/projectionUtils".split(" "),
function(S,v,T,U,c,G,q,H,I,w,C,J,b,D,K,L,M,N){function O(a,k,m){var g=a.graphic,f=new L.OutlineVisualElement({view:a.view,geometry:x(g)?g.geometry:null,elevationInfo:C.getGraphicEffectiveElevationInfo(g),attached:!1});a=function(){f.attached=k.displaying&&b.settings.visualElements.lineGraphics.outlineEnabled};m.push(b.settings.visualElements.lineGraphics.outline.bindStyle(f),k.watch("displaying",a),b.settings.visualElements.lineGraphics.watch("outlineEnabled",a),k.watch("isDraped",function(a){return f.isDraped=
a}),k.on("changed",function(){return f.geometry=x(g)?g.geometry:null}),c.destroyHandle(f));a();return f}function P(a,k,m,g){var f=a.graphic,n=a.view,r=C.getGraphicEffectiveElevationInfo(f),v="on-the-ground"===r.mode||!r.offset&&"absolute-height"!==r.mode,e=new J.ManipulatorState,l=new K.LineVisualElement({view:n,infinite:b.settings.visualElements.zVerticalLine.infiniteType,attached:!1}),r=G.deg2rad(b.settings.visualElements.heightPlaneAngleCutoff),p=new D.LaserlineVisualElement({view:n,attached:!1,
angleCutoff:r}),t=new D.LaserlineVisualElement({view:n,attached:!1,angleCutoff:r}),E=Q(),y=b.settings.visualElements.lineGraphics.shadowStyle.bindStyle(k),z=b.settings.visualElements.pointGraphics.shadowStyle.bindStyle(l),A=b.settings.visualElements.heightPlane.bindStyle(t),B=b.settings.visualElements.heightBox.bindStyle(p),h=function(){e.update(a);E.update(e);l.infinite=b.settings.visualElements.zVerticalLine.infiniteType;if(m.displaying&&(!v||!m.isDraped&&x(f)&&f.geometry.hasZ)){var d=!1;switch(b.settings.visualElements.lineGraphics.shadowEnabled){case "always":d=
!0;break;case "grab-xy":d=!!(e.grabbingState&4)}e.grabbingState&4?y.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):y.updateGlobalAlpha(1);k.laserlineEnabled=d;d=!1;switch(b.settings.visualElements.pointGraphics.shadowEnabled){case "always":d=!0;break;case "grab-xy":d=!!(e.grabbingState&4)}e.grabbingState&4?z.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):z.updateGlobalAlpha(1);d||b.settings.visualElements.zVerticalLine.enabled?(l.laserlineEnabled=d,d=
1===e.numSelected?e.firstSelected:1<e.numSelected&&q.isSome(e.firstGrabbedXY)?e.firstGrabbedXY:null,q.isSome(d)?(b.settings.visualElements.zVerticalLine.infinite&&(l.worldDownAtLocation=d.renderLocation),l.attached=!0):l.attached=!1):l.attached=!1;d=!1;switch(b.settings.visualElements.heightPlane.enabled){case "always":d=!0;break;case "grab-z":d=!!(e.grabbingState&2)}e.grabbingState&2?A.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):A.updateGlobalAlpha(1);d&&1===e.numSelected&&
q.isSome(e.firstSelected)?(t.heightPlane=e.firstSelected.renderLocation,t.attached=!0):t.attached=!1;var d=!1,g=a.view,h=w.empty(R);e.grabbingState&2?B.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):B.updateGlobalAlpha(1);if(k.calculateMapBounds(h)){var c=w.height(h),c=1E-9>c?0:c;switch((c?b.settings.visualElements.heightBox:b.settings.visualElements.heightPlane).enabled){case "always":d=!0;break;case "grab-z":d=!!(e.grabbingState&2)}d?(N.vectorToVector(h,g.spatialReference,
F,g.renderCoordsHelper.spatialReference),p.heightPlane=F,p.heightPlaneHeight=c,p.attached=!0):p.attached=!1}else p.attached=!1}else k.laserlineEnabled=!1,l.attached=!1,t.attached=!1,p.attached=!1};g.push(y,H.init(b.settings.visualElements.lineGraphics,"shadowEnabled",h),m.on("changed",h),m.watch("displaying",h),b.settings.visualElements.zVerticalLine.bindStyle(l),b.settings.visualElements.zVerticalLine.watch(["enabled","infinite"],h),z,b.settings.visualElements.pointGraphics.watch("shadowEnabled",
h),b.settings.zManipulator.watch("enabled",h),B,b.settings.visualElements.heightBox.watch("enabled",h),A,b.settings.visualElements.heightPlane.watch("enabled",h),c.destroyHandle(l),c.destroyHandle(t),c.destroyHandle(p),E);var u=[],n=function(){c.handlesGroup(u).remove();u.length=0;a.forEachManipulator(function(a){return u.push(a.events.on("grab-changed",h))});a.forEachManipulator(function(a){return u.push(a.events.on("select-changed",h))});h()};n();g.push(a.onManipulatorsChanged(n),c.refHandle(function(){return c.handlesGroup(u)}))}
function Q(){var a=null;return{remove:c.refHandle(function(){return a}).remove,update:function(k){var c=!1;switch(b.settings.zManipulator.enabled){case "always":c=!0;break;case "not-grab-z":c=!k.grabbingState}c&&q.isSome(a)?(a.remove(),a=null):!c&&q.isNone(a)&&q.isSome(k.zManipulator)&&(a=k.zManipulator.disableDisplay())}}}function x(a){return q.isSome(a.geometry)&&("polygon"===a.geometry.type||"polyline"===a.geometry.type)}Object.defineProperty(v,"__esModule",{value:!0});v.createVisualElements=function(a){var b=
a.view,m=a.graphic,g=new M.GraphicState({graphic:m}),f=[],n=O(a,g,f);P(a,n,g,f);f.push(b.maskOccludee(m));f.push(b.trackGraphicState(g));return c.handlesGroup(f)};var R=w.create(),F=I.vec3f64.create()});