// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../Color ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../support/elevationInfoUtils ../../Manipulator3D ../manipulatorDragUtils ../settings ./config ./Manipulation ./moveUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial".split(" "),
function(h,n,H,r,I,J,t,u,v,w,x,d,y,m,p,z,A,l,B,k,C,D,f,E,q,F){Object.defineProperty(n,"__esModule",{value:!0});h=function(h){function c(a){var b=h.call(this)||this;b._handles=new v;b._arrowManipulatorInfos=[];b._opaqueMaterial=b.createMaterial();b._transparentMaterial=b.createMaterial(.5);b._angle=0;b._scale=1;b._radius=k.DISC_RADIUS;b._updateAfterDrag=!1;b.events=new u;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulators();b.forEachManipulator(function(a){return b._tool.manipulators.add(a)});
return b}r(c,h);Object.defineProperty(c.prototype,"orthogonalAvailable",{set:function(a){this._arrowManipulatorInfos[1].manipulator.available=a;this._arrowManipulatorInfos[3].manipulator.available=a},enumerable:!0,configurable:!0});c.prototype.destroy=function(){var a=this;this.forEachManipulator(function(b){a._tool.manipulators.remove(b);b.destroy()});this._handles.removeAll();this._view=this._tool=null;this._arrowManipulatorInfos.length=0};c.prototype.forEachManipulator=function(a){this._arrowManipulatorInfos.map(function(b){return a(b.manipulator,
1)})};c.prototype.createGraphicDragPipeline=function(a,b){var c=this,g=a.graphic,e=z.getGraphicEffectiveElevationInfo(g),d=x.expect(g.geometry).spatialReference;return D.createGraphicMoveDragPipeline(a,b,function(a){return c.createDragPipeline(a,e,d)})};c.prototype.createDragPipeline=function(a,b,c){var d=this;return w.handlesGroup(this._arrowManipulatorInfos.map(function(e,G){return l.createManipulatorDragEventPipeline(e.manipulator,function(e,g,f,h){g=g.next(l.screenToMapXYAtLocation(d._view,e.elevationAlignedLocation,
b,c)).next(l.constrainToMapAxis(e.location,d.angle+(G+1)*Math.PI*.5)).next(l.addScreenDelta());a(e,g,f,h)})}))};Object.defineProperty(c.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayScale",{get:function(){return this._scale},set:function(a){this._scale=a;this._updateManipulatorTransform()},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius!==a&&(this._radius=a,this._updateManipulators())},enumerable:!0,configurable:!0});c.prototype._updateManipulators=function(){for(var a=0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],a)};c.prototype._updateArrowManipulator=function(a,b){var c=a.manipulator;a=a.transform;var g=this._radius/k.DISC_RADIUS,e=k.DISC_TRANSLATE_ARROW_SIZE*g,h=
Math.sqrt(e*e*3/4),e=q.createExtrudedTriangle(h,e/2,e/2,k.DISC_HEIGHT);q.transformInPlace(e,d.mat4.fromTranslation(f.sm4d.get(),m.vec3.set(f.sv3d.get(),0,-h/3,0)));e=new E(e,"move-xy-axis-arrow");c.renderObjects=[{geometry:e,material:this._opaqueMaterial,stateMask:2},{geometry:e,material:this._transparentMaterial,stateMask:1}];c.radius=h/3*2.4;c=d.mat4.identity(f.sm4d.get());d.mat4.fromZRotation(c,b*Math.PI/2);b=d.mat4.identity(f.sm4d.get());d.mat4.fromTranslation(b,m.vec3.set(f.sv3d.get(),0,k.DISC_TRANSLATE_ARROW_OFFSET*
g,0));d.mat4.multiply(a,c,b)};c.prototype._createManipulators=function(){for(var a=0;4>a;a++){var b=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(b)}this._updateManipulatorTransform()};c.prototype._updateManipulatorTransform=function(){var a=this.angle,b=d.mat4.identity(f.sm4d.get());d.mat4.rotate(b,b,a,p.vec3f64.fromValues(0,0,1));var c=d.mat4.fromScaling(f.sm4d.get(),m.vec3.set(f.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),a=d.mat4.identity(f.sm4d.get());
d.mat4.multiply(a,c,b);b=0;for(c=this._arrowManipulatorInfos;b<c.length;b++){var g=c[b],e=d.mat4.multiply(f.sm4d.get(),a,g.transform);g.manipulator.modelTransform=e}};c.prototype._createArrowManipulator=function(a){var b=this,c=new A.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:p.vec3f64.fromValues(0,0,1)}}),d={manipulator:c,transform:y.mat4f64.create()};this._updateArrowManipulator(d,a);this._handles.add(c.events.on("drag",
function(a){b._updateAfterDrag&&"end"===a.action&&!b.dragging&&(b._updateManipulatorTransform(),b._updateAfterDrag=!1)}));return d};c.prototype.createMaterial=function(a){void 0===a&&(a=1);var b=t.toUnitRGBA(B.colors.main);b[3]*=a;a=new F({color:b,transparent:1!==a,cullFace:2},"graphic-transform");a.renderOccluded=2;return a};Object.defineProperty(c.prototype,"test",{get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map(function(a){return a.manipulator})}},enumerable:!0,configurable:!0});
return c}(C.Manipulation);n.MoveXYAxisManipulation=h});