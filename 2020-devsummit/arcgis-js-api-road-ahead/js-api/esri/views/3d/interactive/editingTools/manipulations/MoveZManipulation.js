// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/colorUtils ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../manipulatorDragUtils ../settings ./Manipulation ./moveUtils ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil".split(" "),
function(e,q,M,B,N,O,C,D,E,F,G,u,H,k,h,I,r,m,c,J,K,w,x){Object.defineProperty(q,"__esModule",{value:!0});e=function(e){function f(b){var a=e.call(this)||this;a._handles=new E;a.events=new D;a._tool=b.tool;a._view=b.view;a.createManipulator();a.forEachManipulator(function(b){return a._tool.manipulators.add(b)});return a}B(f,e);f.prototype.destroy=function(){var b=this;this._handles.destroy();this.forEachManipulator(function(a){b._tool.manipulators.remove(a);a.destroy()})};f.prototype.forEachManipulator=
function(b){b(this._manipulator,0)};f.prototype.createGraphicDragPipeline=function(b,a){var k=this,c=G.expect(b.graphic.geometry).spatialReference;return K.createGraphicMoveDragPipeline(b,a,function(a){return k.createDragPipeline(a,c)})};f.prototype.createDragPipeline=function(b,a){var k=this._view;return m.createManipulatorDragEventPipeline(this._manipulator,function(c,h,d,l){h=h.next(m.screenToZConstrained(k,c.renderLocation,a)).next(m.addScreenDelta());b(c,h,d,l)})};f.prototype.createManipulator=
function(){var b=this,a=c.settings.zManipulator.height,f=c.settings.zManipulator.coneHeight,e=c.settings.zManipulator.coneWidth,m=c.settings.zManipulator.width,d=[h.vec3f64.fromValues(0,0,0),h.vec3f64.fromValues(0,0,a)],d=new w(x.createTubeGeometry(d,m/2,16,!1),"move-z"),l=x.createConeGeometry(f,e/2,16,!1),l=new w(l),f=[h.vec3f64.fromValues(0,0,0),h.vec3f64.fromValues(0,0,a+f)],t=function(b){var g=H.mat4f64.create();u.mat4.translate(g,g,[0,0,a]);u.mat4.rotateX(g,g,Math.PI/2);b&&(b=1+2*b/e,u.mat4.scale(g,
g,[b,b,b]));return g}(0),n=function(b,a){a=C.darken(c.settings.zManipulator.color,a);return[a.r/255,a.g/255,a.b/255,c.settings.zManipulator.color.a*b]},q=r.createManipulatorMaterial(n(1,.25),1),y=r.createManipulatorMaterial(n(1,0),1),z=r.createManipulatorMaterial(n(.7,0),c.settings.zManipulator.occludedFlag),n=r.createManipulatorMaterial(n(.85,0),c.settings.zManipulator.occludedFlag),v=new I.Manipulator3D({view:this._view,renderObjects:[{geometry:l,transform:t,material:q,stateMask:1},{geometry:d,
material:q,stateMask:1},{geometry:l,transform:t,material:y,stateMask:2},{geometry:d,material:y,stateMask:2},{geometry:l,transform:t,material:z,stateMask:1},{geometry:d,material:z,stateMask:1},{geometry:l,transform:t,material:n,stateMask:2},{geometry:d,material:n,stateMask:2}],collisionType:{type:"line",paths:[f]},autoScaleRenderObjects:!1,worldSized:!1,radius:m/2+2,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});v.applyObjectTransform=function(a){var g=
b._view.state.camera,c=A;b._view.renderCoordsHelper.toRenderCoords(v.elevationAlignedLocation,c);var f=k.vec3.dist(g.eye,c),h=g.computeRenderPixelSizeAtDist(f),e=k.vec3.subtract(p,c,g.eye);k.vec3.normalize(e,e);var d=L;b._view.renderCoordsHelper.worldUpAtPosition(A,d);c=Math.abs(k.vec3.dot(e,d));e=k.vec3.cross(p,e,d);d=k.vec3.cross(p,e,d);c=F.clamp(c,.01,1);g=1-Math.sqrt(1-c*c)/c/g.fullWidth;k.vec3.scale(d,k.vec3.normalize(d,d),(1/g-1)*f+h*m);a[12]-=p[0];a[13]-=p[1];a[14]-=p[2]};this._manipulator=
v};return f}(J.Manipulation);q.MoveZManipulation=e;var A=h.vec3f64.create(),p=h.vec3f64.create(),L=h.vec3f64.create()});