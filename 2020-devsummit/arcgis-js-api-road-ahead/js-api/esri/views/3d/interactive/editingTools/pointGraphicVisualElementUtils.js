// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/compilerUtils ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./ManipulatorState ./settings ../visualElements/LaserlineVisualElement ../visualElements/LineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/GraphicState ../../support/projectionUtils".split(" "),
function(T,C,U,V,G,h,H,q,I,y,J,D,K,b,E,L,M,N,z){function O(a,e,c,f){var d=a.view,F=a.graphic,g=new L.LineVisualElement({view:d,infinite:b.settings.visualElements.zVerticalLine.infiniteType,attached:!1}),w=new E.LaserlineVisualElement({view:d,intersectsLineInfinite:!0,attached:!1}),t=H.deg2rad(b.settings.visualElements.heightPlaneAngleCutoff),u=new E.LaserlineVisualElement({view:d,attached:!1,angleCutoff:t}),r=null,t=D.getGraphicEffectiveElevationInfo(a.graphic),v="on-the-ground"===t.mode||!t.offset&&
"absolute-height"!==t.mode,k=new K.ManipulatorState,A=b.settings.visualElements.heightPlane.bindStyle(u),B=b.settings.visualElements.pointGraphics.shadowStyle.bindStyle(w),p=function(){k.update(a);var c=!1;g.infinite=b.settings.visualElements.zVerticalLine.infiniteType;if(!v)switch(b.settings.visualElements.pointGraphics.shadowEnabled){case "always":c=!0;break;case "grab-xy":c=!!(k.grabbingState&4)}var n=!1;switch(b.settings.zManipulator.enabled){case "always":n=!0;break;case "not-grab-z":n=!k.grabbingState}n&&
q.isSome(r)?(r.remove(),r=null):!n&&q.isNone(r)&&q.isSome(k.zManipulator)&&(r=k.zManipulator.disableDisplay());n=!0;!v&&x(F)&&z.pointToVector(F.geometry,l,d.renderCoordsHelper.spatialReference)?(g.worldDownAtLocation=l,w.intersectsWorldUpAtLocation=l):n=!1;var m=y.empty(P),h=!1;if(!v)switch(b.settings.visualElements.heightPlane.enabled){case "always":h=!0;break;case "grab-z":h=!!(k.grabbingState&2)}k.grabbingState&2?A.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):A.updateGlobalAlpha(1);
h&&e.displaying&&f.calculateMapBounds(m)&&z.vectorToVector(y.getMin(m,l),d.spatialReference,l,d.renderCoordsHelper.spatialReference)?(u.heightPlane=l,u.attached=!0):u.attached=!1;m=!1;switch(b.settings.visualElements.zVerticalLine.enabled){case "never":m=!1;break;case "always":m=!0;break;case "grab":m=!!(k.grabbingState&1);break;case "grab-xy":m=!!(k.grabbingState&4);break;case "grab-z":m=!!(k.grabbingState&2);break;default:G.neverReached(b.settings.visualElements.zVerticalLine.enabled)}k.grabbingState&
4?B.updateGlobalAlpha(b.settings.visualElements.laserlineAlphaMultiplier):B.updateGlobalAlpha(1);w.attached=n&&e.displaying&&!v&&c;g.attached=n&&e.displaying&&!v&&c&&m};c.push(b.settings.zManipulator.watch("enabled",p),b.settings.visualElements.pointGraphics.watch("shadowEnabled",p),b.settings.visualElements.zVerticalLine.bindStyle(g),b.settings.visualElements.zVerticalLine.watch(["enabled","infinite"],p),B,e.watch(["displaying","isDraped"],p),e.on("changed",p),h.refHandle(function(){return r}),A);
a.forEachManipulator(function(a){c.push(a.events.on("grab-changed",p))});c.push(h.destroyHandle(w));c.push(h.destroyHandle(g));c.push(h.destroyHandle(u));p()}function Q(a,e,c,f){var d=function(){e.attached=c.displaying&&b.settings.visualElements.pointGraphics.outlineEnabled};R(a,e,c,f);f.push(b.settings.visualElements.pointGraphics.outline.bindStyle(e),c.watch("displaying",d),b.settings.visualElements.pointGraphics.watch("outlineEnabled",d));d()}function R(a,b,c,f){var d=a.view,e=a.graphic,g=null,
l=function(){q.isSome(g)&&(g.remove(),g=null);c.isDraped&&x(e)&&(g=S(d,e.geometry,function(){b.geometry=e.geometry}))};a=function(){l();b.geometry=x(e)?e.geometry:null};f.push(c.on("changed",a),h.makeHandle(function(){q.isSome(g)&&g.remove()}));a()}function S(a,b,c){z.pointToVector(b,l,a.elevationProvider.spatialReference);var e=l[0],d=l[1];return a.elevationProvider.on("elevation-change",function(a){J.containsXY(a.extent,e,d)&&c()})}function x(a){return q.isSome(a.geometry)&&"point"===a.geometry.type}
Object.defineProperty(C,"__esModule",{value:!0});C.createVisualElements=function(a){var b=a.view,c=new N.GraphicState({graphic:a.graphic}),f=[],d=a.graphic,d=new M.PointVisualElement({view:a.view,geometry:x(d)?d.geometry:null,elevationInfo:D.getGraphicEffectiveElevationInfo(d),attached:!1});Q(a,d,c,f);f.push(h.destroyHandle(d));O(a,c,f,d);f.push(b.trackGraphicState(c));return h.handlesGroup(f)};var l=I.vec3f64.create(),P=y.create()});