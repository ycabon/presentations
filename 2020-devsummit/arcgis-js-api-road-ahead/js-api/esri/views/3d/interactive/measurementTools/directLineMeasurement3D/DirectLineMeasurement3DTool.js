// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/restHelper ../../../../../geometry ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../layers/graphics/dehydratedFeatures ./DirectLineMeasurement3DModel ./DirectLineMeasurement3DView ../../../../interactive/InteractiveToolBase".split(" "),
function(e,w,n,d,p,q,r,f,k,t,c,l,u,h,v){e=function(e){function a(b){var a=e.call(this,b)||this;a._handles=new r;a._cachedPickRequest=new h.PickRequest;a._cachedPickResult=new h.PickResult;a._isAnyPointerDown=!1;a.deferCreation=!0;a.startManipulator=null;a.endManipulator=null;a.model=new u({sceneView:b.view});return a}n(a,e);a.prototype.normalizeCtorArgs=function(a){return p(a,["view"])};a.prototype.initialize=function(){var a=this;this._view=new h(this.model);var g=t.init(this,"state",function(b){"ready"!==
b&&a.create();"measured"===b&&a.complete()},!0);this._handles.add(g);var g=this._view.createManipulators(),c=g.start,d=g.end;c.events.on("drag",function(){var b=c.mapPoint,d=c.surfaceType;f.isSome(b)&&f.isSome(d)&&(b=l.clonePoint(b,m),a.model.startPoint=b,a.model.startPointSurfaceLocation=a._surfaceLocation(b,d))});d.events.on("drag",function(){var b=d.mapPoint,c=d.surfaceType;f.isSome(b)&&f.isSome(c)&&(b=l.clonePoint(b,m),a.model.endPoint=b,a.model.endPointSurfaceLocation=a._surfaceLocation(b,c))});
[c,d].forEach(function(b){a._handles.add([b.watch("grabbing",function(){var b=c.grabbing||d.grabbing;b&&"measured"===a.model.state&&(a.model.state="editing");b||(a.model.finishMeasurement(),"editing"===a.model.state&&(a.model.state="measured"))},!0)])});this.manipulators.add(c);this.manipulators.add(d);this.startManipulator=c;this.endManipulator=d};a.prototype.destroy=function(){this._view.destroy();this._view=null;this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"state",
{get:function(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"creating",{get:function(){return"initial"===this.model.state||"drawing"===this.model.state},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cursor",{get:function(){return!this.model.active||
"drawing"!==this.model.state&&"initial"!==this.model.state?null:"crosshair"},enumerable:!0,configurable:!0});a.prototype.activate=function(){this.model.active=!0};a.prototype.deactivate=function(){this.model.active=!1};a.prototype.onDetach=function(){this.model.reset()};a.prototype.onShow=function(){this._view.show();this._updateManipulatorVisibility()};a.prototype.onHide=function(){this._view.hide()};a.prototype.onInputEvent=function(a){switch(a.type){case "immediate-click":this._handleImmediateClick(a);
break;case "pointer-move":this._handlePointerMove(a);break;case "pointer-down":this._handlePointerDown();break;case "pointer-up":this._handlePointerUp()}this._updateManipulatorVisibility()};a.prototype._handlePointerMove=function(a){this._clearCachedPickRequest();var b=k.createScreenPointFromEvent(a);"mouse"===a.pointerType&&(this._hoverAt(b),"drawing"===this.model.state&&(this.endManipulator.events.emit("drag",{action:"update",start:null,screenPoint:b}),a.stopPropagation()))};a.prototype._handlePointerDown=
function(){this._isAnyPointerDown=!0};a.prototype._handlePointerUp=function(){this._isAnyPointerDown=!1};a.prototype._handleImmediateClick=function(a){this._clearCachedPickRequest();if("mouse"!==a.pointerType||0===a.button){var b=k.createScreenPointFromEvent(a),c=!1;if(this.model.active)switch(this.model.state){case "initial":this.startManipulator.events.emit("drag",{action:"start",start:b,screenPoint:b});null!=this.startManipulator.surfaceType&&(this.startManipulator.interactive=!1,this.endManipulator.interactive=
!1,this.model.state="drawing",c=!0);break;case "drawing":this.endManipulator.events.emit("drag",{action:"update",start:null,screenPoint:b}),null!=this.endManipulator.surfaceType&&(this.startManipulator.interactive=!0,this.endManipulator.interactive=!0,this.model.finishMeasurement(),c=!0)}c&&a.stopPropagation();"mouse"===a.pointerType&&this._hoverAt(b)}};a.prototype._hoverAt=function(a){var b=this._isAnyPointerDown&&"drawing"!==this.model.state&&"editing"!==this.model.state;this._view.requiresCursorPoint&&
!b?(a=this._pick(a),a.mapPoint&&(this.model.cursorPoint=a.mapPoint)):this.model.cursorPoint=null};a.prototype._pick=function(a){var b=this._cachedPickRequest.screenPoint;if(b&&b.x===a.x&&b.y===a.y)return this._cachedPickResult;this._cachedPickRequest.screenPoint=a;return this._cachedPickResult=this._view.pick(this._cachedPickRequest)};a.prototype._clearCachedPickRequest=function(){this._cachedPickRequest.screenPoint=null};a.prototype._surfaceLocation=function(a,c){return"ground"===c?"on-the-surface":
a.z>=this._view.getElevation(a)?"above-the-surface":"below-the-surface"};a.prototype._updateManipulatorVisibility=function(){this.startManipulator.visible=null!=this.model.startPoint;this.endManipulator.visible=null!=this.model.endPoint};d([c.property({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],a.prototype,"state",null);d([c.property({dependsOn:["model.state"],readOnly:!0})],a.prototype,"creating",null);d([c.property({dependsOn:["view.type"],readOnly:!0})],a.prototype,"isSupported",
null);d([c.property({dependsOn:["model.active","model.state"],readOnly:!0})],a.prototype,"cursor",null);d([c.property({constructOnly:!0})],a.prototype,"model",void 0);d([c.aliasOf("model.sceneView")],a.prototype,"view",void 0);d([c.aliasOf("model.mode")],a.prototype,"mode",void 0);d([c.aliasOf("model.unit")],a.prototype,"unit",void 0);d([c.aliasOf("model.directDistance")],a.prototype,"directDistance",void 0);d([c.aliasOf("model.validMeasurement")],a.prototype,"validMeasurement",void 0);d([c.aliasOf("model.horizontalDistance")],
a.prototype,"horizontalDistance",void 0);d([c.aliasOf("model.verticalDistance")],a.prototype,"verticalDistance",void 0);d([c.aliasOf("model.geodesicDistance")],a.prototype,"geodesicDistance",void 0);d([c.aliasOf("model.geodesicAngle")],a.prototype,"geodesicAngle",void 0);d([c.aliasOf("model.triangleView")],a.prototype,"triangleView",void 0);return a=d([c.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],a)}(c.declared(v.InteractiveToolBase));
var m=new q.Point;return e});