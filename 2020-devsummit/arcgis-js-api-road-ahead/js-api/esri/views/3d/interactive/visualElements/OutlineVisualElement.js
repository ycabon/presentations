// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../geometry/support/aaBoundingBox ./DrapedVisualElementResources ./LaserlineVisualElement ./VisualElementResources ../../layers/graphics/ElevationContext ../../layers/graphics/lineUtils ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(p,q,D,E,g,u,k,n,l,v,w,x,y,m,z,A,B,r){Object.defineProperty(q,"__esModule",{value:!0});p=function(){function b(a){var b=this;this.view=null;this._isDraped=!1;this._geometry=null;this._width=1;this._color=n.vec4f32.fromValues(1,0,1,1);this._innerWidth=1;this._innerColor=n.vec4f32.fromValues(1,1,1,1);this._stippleOffColor=this._stipplePattern=null;this._falloff=0;this._laserlineStyle=this._elevationInfo=null;this._laserlineEnabled=!1;this._occludedMode=8;this.resources=new x.VisualElementResources({view:a.view,
createResources:function(a){return b.createResources(a)},recreateGeometry:function(a,c){a.geometries.length=0;b.recreateGeometry(c,a.material,a.geometries);return a.geometries}});this.drapedResources=new v.DrapedVisualElementResources({view:a.view,createResources:function(){return b.createDrapedResources()},recreateGeometry:function(a){return a.geometries=b.createRenderGeometriesDraped(a.material)}});var d=!0;this._laserline=new w.LaserlineVisualElement({view:a.view});for(var c in a)c in this?"attached"===
c?d=a[c]:this[c]=a[c]:console.error("Cannot set unknown property",c);this.attached=d}b.prototype.destroy=function(){this.resources.destroy();this.drapedResources.destroy();this._laserline.destroy()};Object.defineProperty(b.prototype,"isDraped",{get:function(){return this._isDraped},set:function(a){a!==this._isDraped&&(this._isDraped=a,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"laserlineAttached",
{get:function(){return this.attached&&!this.hidden&&g.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hidden",{get:function(){return this.resources.hidden},set:function(a){this.resources.hidden=a;this.drapedResources.hidden=a;this._laserline.attached=this.laserlineAttached},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"attached",{get:function(){return this.resources.attached||this.drapedResources.attached},
set:function(a){this.updateAttached(a)},enumerable:!0,configurable:!0});b.prototype.updateAttached=function(a){this.resources.attached=!this.isDraped&&a;this.drapedResources.attached=this.isDraped&&a;this._laserline.attached=this.laserlineAttached};Object.defineProperty(b.prototype,"geometry",{get:function(){return this._geometry},set:function(a){this._geometry=a;this.resources.recreateGeometry();this.drapedResources.recreateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"width",{get:function(){return this._width},set:function(a){a!==this._width&&(this._width=a,this.updateMaterial())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"color",{get:function(){return this._color},set:function(a){k.vec4.exactEquals(a,this._color)||(k.vec4.copy(this._color,a),this.updateMaterial())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"innerWidth",{get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=
a,this.updateMaterial())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"innerColor",{get:function(){return this._innerColor},set:function(a){k.vec4.exactEquals(a,this._innerColor)||(k.vec4.copy(this._innerColor,a),this.updateMaterial())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stipplePattern",{get:function(){return this._stipplePattern},set:function(a){var b=g.isSome(a)!==g.isSome(this._stipplePattern);this._stipplePattern=a;b?this.resources.recreate():
this.updateMaterial()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stippleOffColor",{get:function(){return this._stippleOffColor},set:function(a){a&&this._stippleOffColor&&k.vec4.exactEquals(a,this._stippleOffColor)||(this._stippleOffColor=a?n.vec4f32.clone(a):null,this.updateMaterial())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"falloff",{get:function(){return this._falloff},set:function(a){a!==this._falloff&&(this._falloff=a,this.updateMaterial())},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationInfo",{get:function(){return this._elevationInfo},set:function(a){this._elevationInfo=a;this.resources.recreateGeometry()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"laserlineStyle",{get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;this._laserline.attached=this.laserlineAttached;g.isSome(a)&&(this._laserline.style=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"laserlineEnabled",{get:function(){return this._laserlineEnabled},set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this.laserlineAttached)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"occludedMode",{get:function(){return this._occludedMode},set:function(a){a!==this._occludedMode&&(this._occludedMode=a,g.isSome(this.resources.resources)&&(this.resources.resources.material.renderOccluded=a),g.isSome(this.drapedResources.resources)&&
(this.drapedResources.resources.material.renderOccluded=a))},enumerable:!0,configurable:!0});b.prototype.updateMaterial=function(){g.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters);g.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)};Object.defineProperty(b.prototype,"isClosed",{get:function(){return g.isSome(this.geometry)&&"polygon"===this.geometry.type},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"materialParameters",{get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0}},enumerable:!0,configurable:!0});b.prototype.recreateGeometry=function(a,b,d){for(var c=0,t=this.createRenderGeometries();c<t.length;c++){var f=
t[c];a.addGeometry(f,b);d.push(f)}};b.prototype.createResources=function(a){var b=new r(this.materialParameters,"lineVisualElement");b.renderOccluded=8;var d=[];this.recreateGeometry(a,b,d);return{material:b,geometries:d,forEach:function(a){a(b);d.forEach(a)}}};b.prototype.createDrapedResources=function(){var a=new r(this.materialParameters,"lineVisualElement");a.renderOccluded=4;var b=this.createRenderGeometriesDraped(a);return{material:a,geometries:b}};b.prototype.createRenderGeometriesDraped=function(a){var b=
this.geometry;if(g.isNone(b))return[];for(var d=[],c=0,b=m.geometryToRenderInfoDraped(b,this.view.basemapTerrain.spatialReference).lines;c<b.length;c++){var h=b[c].position,f=new B(m.createGeometryData({attributeData:{position:h},removeDuplicateStartEnd:this.isClosed?1:0}));f.material=a;var e=l.empty(C);l.expandWithBuffer(e,h);u.vec3.set(f.center,.5*(e[0]+e[3]),.5*(e[1]+e[4]),0);f.bsRadius=.5*Math.sqrt((e[3]-e[0])*(e[3]-e[0])+(e[4]-e[1])*(e[4]-e[1]));d.push(f)}return d};b.prototype.calculateMapBounds=
function(a){if(g.isNone(this.resources.resources))return!1;for(var b=this.view.renderCoordsHelper,d=0,c=this.resources.resources.geometries;d<c.length;d++){var h=c[d].data.getAttribute("position"),f=h.data,e=new Float64Array(f.length);z.bufferToBuffer(h.data,b.spatialReference,0,e,this.view.spatialReference,0,f.length/3);l.expandWithBuffer(a,e)}return!0};b.prototype.createRenderGeometries=function(){var a=this.geometry;if(g.isNone(a))return[];for(var b=[],d=[],c=0,a=m.geometryToRenderInfo(a,this.view.elevationProvider,
this.view.renderCoordsHelper,y.fromElevationInfo(this.elevationInfo)).lines;c<a.length;c++){var h=a[c],f=h.position,h=m.createGeometryData({attributeData:{position:f,mapPosition:h.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0});b.push(new A(h,"geometryOutlineVisualElement"));d.push(f)}this._laserline.pathVerticalPlane=d;return b};return b}();q.OutlineVisualElement=p;var C=l.create()});