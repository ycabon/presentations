// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,h,n,d,p){Object.defineProperty(h,"__esModule",{value:!0});a=function(){function c(){this.extents=new n({allocator:function(b){return b||d.create()}});this.tempExtent=d.create();this.dirty=!1}Object.defineProperty(c.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0});c.prototype.clear=function(){this.extents.clear()};
c.prototype.add=function(b){this.contains(b)||(this.removeContained(b),d.set(this.extents.pushNew(),b),this.dirty=!0)};c.prototype.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};c.prototype.merge=function(b){this.mergeTight(b);return b.hasProgressed};c.prototype.mergeTight=function(b){var c=this;void 0===b&&(b=p.noBudget);for(var e=this.extents,l=new Set,a=0;a!==e.length;){e.sort(function(b,c){return b[0]-c[0]});a=e.length;l.clear();for(var h=function(a){if(b.done)return{value:void 0};
var f=e.getItemAt(a);for(a+=1;a<e.length;++a){var k=e.getItemAt(a);if(k[0]>=f[2])break;l.add(k)}l.forEach(function(a){if(f!==a)if(a[2]<=f[0])l.delete(a);else{var k=d.area(f),h=d.area(a),g=c.tempExtent;d.expand(f,a,g);k+=h;.05>(d.area(g)-k)/k&&(d.set(f,g),l.delete(a),e.remove(a),b.madeProgress())}});l.add(f)},g=0;g<e.length;++g){var m=h(g);if("object"===typeof m)return m.value}}this.dirty=!1};c.prototype.contains=function(b){return this.extents.some(function(a){return d.contains(a,b)})};c.prototype.removeContained=
function(a){this.extents.filterInPlace(function(b){return!d.contains(a,b)})};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{containsPoint:function(b){return a.extents.some(function(a){return d.containsPoint(a,b)})}}},enumerable:!0,configurable:!0});return c}();h.ExtentSet=a});