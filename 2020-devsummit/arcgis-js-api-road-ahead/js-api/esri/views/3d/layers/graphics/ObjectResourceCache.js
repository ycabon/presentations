// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Handles ../../../../core/handleUtils ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(f,e,t,u,l,m,h,n,p,q){Object.defineProperty(e,"__esModule",{value:!0});f=function(){function b(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new l}b.prototype.loadGLTF=function(c,a){return this.fromCache(this.gltfCache,
"gltf:"+c,function(){return p.load(new n.DefaultLoadingContext(a.streamDataRequester),c,a)},a)};b.prototype.loadWOSR=function(c,a){return this.fromCache(this.wosrCache,"wosr:"+c+":"+a.disableTextures,function(){return q.load(c,a)},a)};b.prototype.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};b.prototype.fromCache=function(c,a,b,f){var k=this;return h.create(function(e,g){h.onAbort(f,g);var d=c.get(a);if(d)return k.evictHandles.remove(a),d.refCount++,
d.item.then(e,g);d={refCount:1,item:b().then(function(b){b.remove=function(){return k.remove(c,a)};return b})};c.set(a,d);return d.item.then(e,g)})};b.prototype.remove=function(c,a){var b=c.get(a);b&&(b.refCount--,0===b.refCount&&this.evictHandles.add(m.timeoutHandle(function(){return c.delete(a)},r),a))};return b}();e.ObjectResourceCache=f;var r=1E4});