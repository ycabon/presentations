// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(E,m,w,A,B,C,q,D){function x(a){var b=0,e=0;for(a=a?a:[];e<a.length;e++)b|=1<<a[e];return b}function y(a,b){for(var e=0;e<a.length;e++){var g=a[e];if(g.name===b&&null!=g.attributeValues&&"UInt8"===g.attributeValues.valueType&&3===g.attributeValues.valuesPerElement)return{name:b,
storageInfo:g,useElevation:!1}}return null}function n(a,b){for(var e=0;e<a.length;e++){var g=a[e];if(g.name===b)return a="embedded-elevation"===g.encoding,{name:b,storageInfo:a?null:g,useElevation:a}}return"elevation"===b.toLowerCase()?{name:b,storageInfo:null,useElevation:!0}:null}function z(a,b){for(var e=new Float64Array(b),g=0;g<b;g++)e[g]=a[3*g+2];return e}function v(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>
4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(m,"__esModule",{value:!0});m.getRendererInfo=function(a){var b=a.renderer,e=b&&b.type,g=b&&a.renderer.toJSON()||null,c=null,h=!1;"point-cloud-unique-value"===e?c=n(a.attributeStorageInfo,b.field):"point-cloud-stretch"===e?c=n(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===e?c=n(a.attributeStorageInfo,b.field):(c="point-cloud-rgb"===e?y(a.attributeStorageInfo,b.field):
y(a.attributeStorageInfo,"RGB"),h=null!=c);e=null;b&&b.colorModulation&&(e=n(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:g,isRGBRenderer:h,primaryAttribute:c,modulationAttribute:e}};m.getFilterInfo=function(a){var b=a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:n(a.attributeStorageInfo,b.field)}}):[]};m.evaluateRenderer=function(a,b,e,g){var c=a.rendererJSON,h=a.isRGBRenderer,l=a=null;if(b&&h)a=b;else if(b&&"pointCloudUniqueValueRenderer"===
c.type){var l=C.fromJSON(c),d=l.colorUniqueValueInfos;a=new Uint8Array(3*g);h=v(l.fieldTransformType);for(c=0;c<g;c++)for(var k=h?h(b[c]):b[c],k=k+"",f=0;f<d.length;f++)if(0<=d[f].values.indexOf(k)){a[3*c]=d[f].color.r;a[3*c+1]=d[f].color.g;a[3*c+2]=d[f].color.b;break}}else if(b&&"pointCloudStretchRenderer"===c.type)for(l=B.fromJSON(c),d=l.stops,a=new Uint8Array(3*g),h=v(l.fieldTransformType),c=0;c<g;c++)if(k=h?h(b[c]):b[c],f=d.length-1,k<d[0].value)a[3*c]=d[0].color.r,a[3*c+1]=d[0].color.g,a[3*c+
2]=d[0].color.b;else if(k>=d[f].value)a[3*c]=d[f].color.r,a[3*c+1]=d[f].color.g,a[3*c+2]=d[f].color.b;else for(f=1;f<d.length;f++){if(k<d[f].value){k=(k-d[f-1].value)/(d[f].value-d[f-1].value);a[3*c]=d[f].color.r*k+d[f-1].color.r*(1-k);a[3*c+1]=d[f].color.g*k+d[f-1].color.g*(1-k);a[3*c+2]=d[f].color.b*k+d[f-1].color.b*(1-k);break}}else if(b&&"pointCloudClassBreaksRenderer"===c.type)for(l=A.fromJSON(c),d=l.colorClassBreakInfos,a=new Uint8Array(3*g),h=v(l.fieldTransformType),c=0;c<g;c++)for(k=h?h(b[c]):
b[c],f=0;f<d.length;f++){if(k>=d[f].minValue&&k<=d[f].maxValue){a[3*c]=d[f].color.r;a[3*c+1]=d[f].color.g;a[3*c+2]=d[f].color.b;break}}else for(a=new Uint8Array(3*g),c=0;c<a.length;c++)a[c]=255;if(e&&l&&l.colorModulation)for(b=l.colorModulation.minValue,l=l.colorModulation.maxValue,c=0;c<g;c++)k=e[c],h=k>=l?1:k<=b?.3:.3+.7*(k-b)/(l-b),a[3*c]*=h,a[3*c+1]*=h,a[3*c+2]*=h;return a};m.filterInPlace=function(a,b,e,g,c){for(var h=a.length/3,l=0,d=0;d<h;d++){for(var k=!0,f=0;f<g.length&&k;f++){var m=g[f].filterJSON,
p=c[f].values[d];switch(m.type){case "pointCloudValueFilter":var n="exclude"===m.mode;-1!==m.values.indexOf(p)===n&&(k=!1);break;case "pointCloudBitfieldFilter":n=x(m.requiredSetBits);m=x(m.requiredClearBits);if((p&n)!==n||0!==(p&m))k=!1;break;case "pointCloudReturnFilter":for(var r=p&15,t=p>>>4&15,p=1<t,n=1===r,r=r===t,t=!1,q=0,m=m.includedReturns;q<m.length;q++){var u=m[q];if("last"===u&&r||"firstOfMany"===u&&n&&p||"lastOfMany"===u&&r&&p||"single"===u&&!p){t=!0;break}}t||(k=!1)}}k&&(e[l]=d,a[3*
l]=a[3*d],a[3*l+1]=a[3*d+1],a[3*l+2]=a[3*d+2],b[3*l]=b[3*d],b[3*l+1]=b[3*d+1],b[3*l+2]=b[3*d+2],l++)}return l};m.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};m.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};m.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1};m.getAttributeInfo=n;m.elevationFromPositions=z;m.getAttributeValues=function(a,b,e){return w.isSome(a)&&
a.attributeInfo.useElevation?z(b,e):w.isSome(a)?q.readBinaryAttribute(a.attributeInfo.storageInfo,a.buffer,e):null};m.readGeometry=function(a,b){if(null==a.encoding||""===a.encoding){a=q.createGeometryIndexFromSchema(b,a);b=q.createTypedView(b,a.vertexAttributes.position);var e=a.header.fields;a=[e.offsetX,e.offsetY,e.offsetZ];for(var e=[e.scaleX,e.scaleY,e.scaleZ],g=b.length/3,c=new Float64Array(3*g),h=0;h<g;h++)c[3*h]=b[3*h]*e[0]+a[0],c[3*h+1]=b[3*h+1]*e[1]+a[1],c[3*h+2]=b[3*h+2]*e[2]+a[2];return c}if("lepcc-xyz"===
a.encoding)return D.decodeXYZ(b).result}});