// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(A,a,w,x,t,d,e,y,l,z,u,v,m){Object.defineProperty(a,"__esModule",
{value:!0});a.PopupSceneLayerView=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}w(b,a);b.prototype._validateFetchPopupFeatures=function(a){var c=this.layer;if(!c.popupEnabled)return new e("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:c});if(!m.getFetchPopupTemplate(c,a))return new e("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:c})};b.prototype.prepareFetchPopupFeatures=function(a){return d(this,
void 0,void 0,function(){return t(this,function(a){return[2]})})};b.prototype.fetchPopupFeatures=function(a,c){return d(this,void 0,void 0,function(){var a,b,g,f,n,d,e,p,h,q,k;return t(this,function(r){switch(r.label){case 0:if(a=this._validateFetchPopupFeatures(c))return[2,l.reject(a)];b=y.isSome(c)?c.clientGraphics:null;if(!b||0===b.length)return[2,l.resolve([])];g=[];f=[];d=v.unpackFieldNames;e=[this.layer.fields];return[4,m.getRequiredFields(this.layer,m.getFetchPopupTemplate(this.layer,c))];
case 1:return n=d.apply(void 0,e.concat([r.sent()])),[4,this.prepareFetchPopupFeatures(n)];case 2:r.sent();p=new Set;h=0;for(q=b;h<q.length;h++)k=q[h],v.populateMissingFields(n,k,p)?f.push(k):g.push(k);return 0===f.length?[2,l.resolve(g)]:[2,this.whenGraphicAttributes(f,z.valuesOfSet(p)).catch(function(){return f}).then(function(a){return g.concat(a)})]}})})};return b=x([u.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],b)}(u.declared(a))}});