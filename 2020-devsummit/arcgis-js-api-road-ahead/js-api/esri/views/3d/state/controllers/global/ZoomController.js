// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(c,n,q,r,t,p,e,k,l,u,g,m){Object.defineProperty(n,"__esModule",{value:!0});c=function(c){function h(b,
d){var a=c.call(this)||this;a.view=b;a.intersectionHelper=d;a.pickPoint=k.vec3f64.create();a.tmpP0=p.vec2f64.create();a.panAxisAngle=m.axisAngle.create();a.tmpRayDir=k.vec3f64.create();a.targetOnSphere=k.vec3f64.create();a.dragBeginPoint=r.createScreenPointArray();a.normalizedAnchorPoint=p.vec2f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.sphere=m.sphere.create();a.hasPickPoint=!1;return a}q(h,
c);h.prototype.begin=function(b){this.active&&(t.vec2.copy(this.dragBeginPoint,b),g.normalizeCoordinate(this.beginCamera,b,this.normalizedAnchorPoint),b=g.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,b,!1),this.hasPickPoint=!!b.scenePickPoint,this.pickPoint=b.scenePickPoint,this.sphere=b.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};h.prototype.update=function(b){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;
this.currentCamera.up=this.beginCamera.up;e.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var d=e.vec3.length(this.tmpRayDir);g.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var a=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),f=d*Math.pow(2,a),c=this.view.state.constraints.minimumPoiDistance;0>a&&f<c&&(f=c);1E-6>Math.abs(d-f)||(this.hasPickPoint&&f<d&&(a=1-(1-f/d)*(1-this.sphere.radius/e.vec3.length(this.currentCamera.center)),e.vec3.scale(this.currentCamera.center,
this.currentCamera.center,a)),e.vec3.scale(this.tmpRayDir,this.tmpRayDir,-f/d),e.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),l.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(g.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),m.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,
this.panAxisAngle),g.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),l.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};h.prototype.end=function(){this.active&&this.finishController()};return h}(u.InteractiveController);n.ZoomController=c});