// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),function(c,l,q,d,k,m,r,t,n,p,u,v){Object.defineProperty(l,"__esModule",{value:!0});c=function(c){function h(b,
a){a=c.call(this,b.state,b.sceneIntersectionHelper,a)||this;a.view=b;a.zoomLocation=k.vec3f64.create();a.tmpCamera=new p.default;a.tmpViewDir=k.vec3f64.create();a.targetOnSphere=k.vec3f64.create();a.tmpCenter=k.vec3f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new p.default,interactionDirection:null,tiltMode:0};a.sphere=n.sphere.create();a.intersector=new u.Intersector(b.viewingMode);return a}q(h,c);h.prototype.zoomStep=function(b,a){if(this.active){var g=
this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(g.camera):this.animation.cameraAt(1,e);e=!1;0<b&&this.intersectionHelper.intersectScreen(a,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(g.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:
d.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,a);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:v.outExpo}};h.prototype.updateCamera=function(b,a,g,e){this.sphere.radius=d.vec3.length(g);d.vec3.subtract(this.tmpViewDir,b.center,b.eye);var f=d.vec3.length(this.tmpViewDir),c=f*a;1>=a&&4>c&&(c=4,a=c/f);1E-6>Math.abs(f-c)||(f=d.vec3.length(b.center),this.sphere.radius!==
f&&d.vec3.scale(b.center,b.center,(this.sphere.radius+a*(f-this.sphere.radius))/f),d.vec3.scale(this.tmpViewDir,this.tmpViewDir,-a),d.vec3.add(b.eye,b.center,this.tmpViewDir),m.applyAll(this.view,b,this.constraintOptions),1E-12<d.vec3.squaredDistance(g,b.center)&&n.sphere.intersectScreen(this.sphere,b,e,this.targetOnSphere)&&t.panToPosition(this.sphere,b,g,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),m.applySurfaceCollisionConstraint(this.view,b))};return h}(r.PointToPointAnimationController);
l.ZoomStepController=c});