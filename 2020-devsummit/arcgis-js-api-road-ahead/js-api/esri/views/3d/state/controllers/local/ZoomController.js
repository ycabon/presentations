// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(c,k,q,r,t,l,m,b,d,n,u,h,p){Object.defineProperty(k,"__esModule",
{value:!0});c=function(c){function g(b,e){var a=c.call(this)||this;a.view=b;a.intersectionHelper=e;a.tmpP=d.vec3f64.create();a.tmpN=d.vec3f64.create();a.tmpP0=m.vec2f64.create();a.tmpPoi=d.vec3f64.create();a.tmpRayDir=d.vec3f64.create();a.dragBeginPoint=t.createScreenPointArray();a.normalizedAnchorPoint=m.vec2f64.create();a.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:d.vec3f64.create(),tiltMode:0};a.plane=p.plane.create();
return a}q(g,c);g.prototype.begin=function(f){this.active&&(l.vec2.copy(this.dragBeginPoint,f),h.normalizeCoordinate(this.beginCamera,f,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(f,this.tmpP),b.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),b.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&b.vec3.negate(this.tmpN,this.tmpN),p.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};g.prototype.update=function(f){if(this.active){h.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||b.vec3.copy(this.tmpPoi,this.currentCamera.center);h.normalizeCoordinate(this.currentCamera,f,this.tmpP0);var e=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);l.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);b.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var a=b.vec3.length(this.tmpRayDir),c=a*(1-e);b.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);b.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,r.sign(e)/a);var d=this.view.state.constraints.minimumPoiDistance;0<=e&&c<d&&(c=d,e=-(c-a)/a);1E-6>Math.abs(a-c)||(b.vec3.scale(this.tmpRayDir,this.tmpRayDir,e),b.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),b.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,e),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(this.dragBeginPoint,f),n.applyAll(this.view,this.currentCamera,this.constraintOptions))}};g.prototype.end=function(){this.active&&this.finishController()};return g}(u.InteractiveController);k.ZoomController=c});