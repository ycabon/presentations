// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../webgl-engine/lib/Util"],function(e,f,g){Object.defineProperty(f,"__esModule",{value:!0});e=function(){function c(a,b,c,h){var d=this;this._workerFunc=a;this._callbackFunc=b;this._maxTotalNumWorkers=c;this._type2id=new Map;this._tasks=[];this._typeNumWorkers=[];this._typeWorkerQuota=[];this._typeStatistics=[];this._totalNumWorkers=0;h.forEach(function(a,b){d._type2id.set(b,d._tasks.length);d._tasks.push([]);d._typeNumWorkers.push(0);d._typeStatistics.push({requests:0,
size:0,duration:0,speed:0});d._typeWorkerQuota.push(a)})}Object.defineProperty(c.prototype,"numTypes",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!0,configurable:!0});c.prototype.push=function(a){var b=this,c=this._type2id.get(a.clientType);this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[c]++,this._totalNumWorkers++,this._workerFunc(a,
function(a,c){return b._taskCallback(a,c)})):this._tasks[c].push(a)};c.prototype.getStatsForType=function(a){a=this._type2id.get(a);return{quota:this._typeWorkerQuota[a],workers:this._typeNumWorkers[a],queueSize:this._tasks[a].length,requestStats:this._typeStatistics[a]}};c.prototype.cancel=function(a){this._taskFinished(a);a._cancelledInQueue=!0};c.prototype.clear=function(){for(var a=0;a<this._tasks.length;a++)this._tasks[a]=[]};c.prototype._taskFinished=function(a){var b=this._type2id.get(a.clientType);
this._typeNumWorkers[b]--;this._totalNumWorkers--;this._typeStatistics[b].requests++;this._typeStatistics[b].size+=a.size||0;this._typeStatistics[b].duration+=a.duration||0;this._typeStatistics[b].speed=0<this._typeStatistics[b].duration?this._typeStatistics[b].size/this._typeStatistics[b].duration:0;g.assert(0<=this._typeNumWorkers[b]);this._next()};c.prototype._next=function(){for(var a=0;a<this.numTypes;++a){if(this._typeNumWorkers[a]<this._typeWorkerQuota[a]&&this._processQueue(a))return;++a}for(a=
0;a<this.numTypes&&!this._processQueue(a);++a);};c.prototype._processQueue=function(a){for(var b=this;0<this._tasks[a].length;)if(this._workerFunc(this._tasks[a].shift(),function(a,c){return b._taskCallback(a,c)}))return this._typeNumWorkers[a]++,this._totalNumWorkers++,!0;return!1};c.prototype._taskCallback=function(a,b){a._cancelledInQueue||(this._callbackFunc(a,b),this._taskFinished(a))};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{set workerFunc(b){a._workerFunc=
b}}},enumerable:!0,configurable:!0});return c}();f.AsyncWorkerQueue=e});