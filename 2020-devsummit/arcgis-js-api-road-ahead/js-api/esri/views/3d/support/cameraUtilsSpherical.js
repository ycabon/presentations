// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(M,k,m,v,H,g,w,I,J,K,B,C,D){function E(d,a,c,f){void 0===f&&(f=B.createDirectionUp());g.vec3.cross(t,d,F);0===g.vec3.dot(t,t)&&g.vec3.cross(t,
d,G);v.mat4.identity(n);v.mat4.rotate(n,n,-m.deg2rad(a),d);v.mat4.rotate(n,n,-m.deg2rad(c),t);a=f.up;c=f.direction;g.vec3.cross(a,t,d);g.vec3.normalize(a,a);g.vec3.transformMat4(a,a,n);g.vec3.normalize(c,d);g.vec3.negate(c,c);g.vec3.transformMat4(c,c,n);return f}function z(d){var a=d[1];d[1]=-d[2];d[2]=a}function A(d,a){a=E(a,d.heading,d.tilt);d.up=a.up;return d}Object.defineProperty(k,"__esModule",{value:!0});var F=w.vec3f64.fromValues(0,0,1),G=g.vec3.normalize(w.vec3f64.create(),w.vec3f64.fromValues(1,
1,1)),L=new D.Cyclical(-180,180),n=H.mat4f64.create(),t=w.vec3f64.create(),p=w.vec3f64.create();k.headingTiltToDirectionUp=E;k.directionToHeadingTilt=function(d,a,c,f){var b=t;g.vec3.normalize(b,d);g.vec3.cross(p,b,F);0===g.vec3.dot(p,p)&&g.vec3.cross(p,b,G);g.vec3.cross(p,p,b);return B.directionToHeadingTilt(a,c,f,b,p)};k.eyeForCenterWithHeadingTilt=function(d,a,c,f){var b={eye:w.vec3f64.create(),up:null,tilt:f,heading:c},l=t;l[0]=d[0];l[1]=d[2];l[2]=-d[1];c=m.deg2rad(c);var e=m.deg2rad(f);f=Math.sin(c);
c=Math.cos(c);var h=Math.sin(e),y=Math.cos(e),x=g.vec3.length(l);if(1E-8>Math.abs(e))e=a+x;else var q=x/h,k=m.asinClamped(a/q),e=q*Math.sin(Math.PI-e-k);var y=y*a,q=a*a*h*h,k=c*c*q,n=e-y,p=n*n,r=k*(k+p-l[1]*l[1]);if(0>r)return g.vec3.scale(b.eye,l,e/x),b.tilt=0,b;var u=Math.sqrt(r),v=l[1]*n,r=k+p,u=0<c?-u+v:u+v;if(1E-8>Math.abs(r))return 1E-8>x?(b.eye[0]=0,b.eye[1]=0,b.eye[2]=a):g.vec3.scale(b.eye,l,e/x),b.tilt=0,z(b.eye),A(b,d);b.eye[1]=u/r;a*=h;u=b.eye[1]*b.eye[1];h=1-u;r=Math.sqrt(h);q=k*u+f*f*
q-2*c*a*b.eye[1]*r*n+h*p;if(1E-8>Math.abs(q))return g.vec3.scale(b.eye,l,e/x),b.tilt=0,z(b.eye),A(b,d);b.eye[0]=(h*(e*l[0]-y*l[0])-a*r*(l[0]*b.eye[1]*c+l[2]*f))/q;b.eye[2]=(h*(e*l[2]-y*l[2])-a*r*(l[2]*b.eye[1]*c-l[0]*f))/q;g.vec3.scale(b.eye,b.eye,e);z(b.eye);return A(b,d)};k.lookAtTiltToEyeTilt=function(d,a,c){a=g.vec3.length(a);c=m.asinClamped(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-d))/Math.sin(d)));return m.rad2deg(d-c)};k.eyeTiltToLookAtTilt=function(d,a,c){d=m.deg2rad(d);a=g.vec3.length(a);
return m.asinClamped(c/(a/Math.sin(d)))+d};k.toExtent=function(d,a,c,f,b){function g(a){var b=Math.PI/2;a=D.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var e;e=a.latitude;a=a.longitude;var h=C.getLonDeltaForDistance(e,c)/2;c=a-h;a+=h;e=m.deg2rad(e);h=C.earthRadius;e=(1+Math.sin(e))/(1-Math.sin(e));var k=(e+1)*Math.tan(f/h/2);e=1.5*Math.PI-2*Math.atan(.5*(k+Math.sqrt(4*e+k*k)));f=e+f/h;e=g(e);f=g(f);f<e&&(h=f,f=e,e=h);e=Math.max(m.rad2deg(e),-90);f=Math.min(m.rad2deg(f),90);a=L.monotonic(c,
a);180<a-c&&(h=(a-c-180)/2,c+=h,a-=h);h=d.spatialReference&&d.spatialReference.isGeographic?d.spatialReference:J.WGS84;b?(b.xmin=c,b.ymin=e,b.xmax=a,b.ymax=f,b.spatialReference=h):b=new I(c,e,a,f,h);d.spatialReference&&d.spatialReference.isWebMercator&&K.geographicToWebMercator(b,!1,b);return b}});