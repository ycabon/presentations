// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),function(y,d,v,B,r,z,C,m,
A,t,D,E,F,G,w){function x(a,b,c){return{center:t.vec3f64.clone(a),halfSize:A.vec3f32.clone(b),quaternion:z.quatf32.clone(c)}}function k(a,b){var c=w.plane.signedDistance(b,a.center);a=u(a,b);return c>a?1:c<-a?-1:0}function u(a,b){r.quat.conjugate(n,a.quaternion);m.vec3.transformQuat(e,b,n);a=a.halfSize;return Math.abs(e[0]*a[0])+Math.abs(e[1]*a[1])+Math.abs(e[2]*a[2])}Object.defineProperty(d,"__esModule",{value:!0});var n=C.quatf64.create(),e=t.vec3f64.create(),H=t.vec3f64.create(),p=E.vec4f64.create(),
q=B.mat3f64.create();y=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:t.vec3f64.createView(this.buffer,56*b+0),halfSize:A.vec3f32.createView(this.buffer,56*b+24),quaternion:z.quatf32.createView(this.buffer,56*b+36)}}}();d.ObbArray=y;d.create=x;d.clone=function(a){return x(a.center,a.halfSize,a.quaternion)};d.set=function(a,b){m.vec3.copy(b.center,a.center);m.vec3.copy(b.halfSize,a.halfSize);r.quat.copy(b.quaternion,a.quaternion)};
d.compute=function(a,b){b||(b=x([0,0,0],[-1,-1,-1],[0,0,0,1]));G.computeOBB(a,b);return b};d.intersectPlane=k;d.toAaBoundingBox=function(a,b){b||(b=F.create());var c=v.mat3.fromQuat(q,a.quaternion),e=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),d=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-e;b[1]=a.center[1]-
d;b[2]=a.center[2]-c;b[3]=a.center[0]+e;b[4]=a.center[1]+d;b[5]=a.center[2]+c;return b};d.minimumDistancePlane=function(a,b){var c=w.plane.signedDistance(b,a.center);a=u(a,b);return c-a};d.maximumDistancePlane=function(a,b){var c=w.plane.signedDistance(b,a.center);a=u(a,b);return c+a};d.isVisible=function(a,b){return 0>=k(a,b.planes[0])&&0>=k(a,b.planes[1])&&0>=k(a,b.planes[2])&&0>=k(a,b.planes[3])&&0>=k(a,b.planes[4])&&0>=k(a,b.planes[5])};d.intersectLine=function(a,b,c,d){void 0===d&&(d=0);r.quat.conjugate(n,
a.quaternion);m.vec3.subtract(e,b,a.center);b=m.vec3.transformQuat(e,e,n);c=m.vec3.transformQuat(H,c,n);for(var h=-Infinity,f=Infinity,g=0;3>g;g++)if(1E-6<Math.abs(c[g]))var l=(d+a.halfSize[g]-b[g])/c[g],k=(-d-a.halfSize[g]-b[g])/c[g],h=Math.max(h,Math.min(l,k)),f=Math.min(f,Math.max(l,k));else if(b[g]>a.halfSize[g]+d||b[g]<-a.halfSize[g]-d)return!1;return h<=f};d.projectedArea=function(a,b,c,d,k){r.quat.conjugate(n,a.quaternion);m.vec3.sub(e,b,a.center);m.vec3.transformQuat(e,e,n);var f=e[0]<-a.halfSize[0]?
-1:e[0]>a.halfSize[0]?1:0,g=e[1]<-a.halfSize[1]?-1:e[1]>a.halfSize[1]?1:0,l=e[2]<-a.halfSize[2]?-1:e[2]>a.halfSize[2]?1:0;b=Math.abs(f)+Math.abs(g)+Math.abs(l);if(0===b)return Infinity;b=1===b?4:6;g=6*(f+3*g+9*l+13);v.mat3.fromQuat(q,a.quaternion);v.mat3.scale(q,q,a.halfSize);for(f=0;f<b;f++)l=I[g+f],m.vec3.set(e,((l&1)<<1)-1,(l&2)-1,((l&4)>>1)-1),m.vec3.transformMat3(e,e,q),m.vec3.add(p,a.center,e),p[3]=1,D.vec4.transformMat4(p,p,c),l=1/Math.max(1E-6,p[3]),h[2*f]=p[0]*l,h[2*f+1]=p[1]*l;a=2*b-2;c=
h[0]*(h[3]-h[a+1])+h[a]*(h[1]-h[a-1]);for(f=2;f<a;f+=2)c+=h[f]*(h[f+3]-h[f-1]);return Math.abs(c)*d*k*.125};var h=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],I=function(){var a=new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);c([0,0,0,0,0,0]);c([1,3,7,
5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}();d.projectedRadius=u});