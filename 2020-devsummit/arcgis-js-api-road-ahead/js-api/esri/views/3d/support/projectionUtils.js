// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),function(ja,e,O,C,ea,H,E,I,X,Y,fa,ga,g,ha){function T(a,b,c,f){2===a.length?(d[0]=a[0],d[1]=
a[1],d[2]=0,a=d):a===c&&(E.vec3.copy(d,a),a=d);return h(a,b,0,c,f,0,1)}function h(a,b,c,f,d,k,q){void 0===q&&(q=1);b=U(b,d,Z);if(C.isNone(b))return!1;if(b===l){if(a===f&&c===k)return!0;for(b=c+3*q;c<b;c++,k++)f[k]=a[c];return!0}for(q=c+3*q;c<q;c+=3,k+=3)b(a,c,f,k);return!0}function t(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=ea.getMetersPerUnitForSR(a,1));return a.wkt===e.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=
1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===e.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function l(a,b,c,f){c[f++]=a[b++];c[f++]=a[b++];c[f]=a[b]}function P(a,b,c,f){c[f++]=F*(a[b++]/g.earthRadius);c[f++]=F*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/g.earthRadius)));c[f]=a[b]}function J(a,b,c,f){var d=.4999999*Math.PI,d=O.clamp(n*a[b+1],-d,d),d=Math.sin(d);c[f++]=n*a[b]*g.earthRadius;c[f++]=
g.halfEarthRadius*Math.log((1+d)/(1-d));c[f]=a[b+2]}function aa(a,b,c){b=t(b,Q);b=D[b][6];if(C.isNone(b))return!1;b(a,0,d,0);c!==d&&(c[0]=d[0],c[1]=d[1],2<c.length&&(c[2]=d[2]));return!0}function ba(a,b){d[0]=a.x;d[1]=a.y;d[2]=a.hasZ?a.z:0;return aa(d,a.spatialReference,b)}function K(a,b,c,f){var d=g.earthRadius+a[b+2],k=n*a[b+1];a=n*a[b];b=Math.cos(k);c[f++]=Math.cos(a)*b*d;c[f++]=Math.sin(a)*b*d;c[f]=Math.sin(k)*d}function L(a,b,c,f){var d=ha.Vec3Compact.length(a,b),k=O.asinClamped(a[b+2]/(0===
d?1:d));a=Math.atan2(a[b+1],a[b]);c[f++]=F*a;c[f++]=F*k;c[f]=d-g.earthRadius}function M(a,b,c,f){var d=ca,k=n*a[b],q=n*a[b+1];a=a[b+2];b=Math.sin(q);var q=Math.cos(q),e=d.a/Math.sqrt(1-d.e2*b*b);c[f++]=(e+a)*q*Math.cos(k);c[f++]=(e+a)*q*Math.sin(k);c[f++]=(e*(1-d.e2)+a)*b}function N(a,b,c,f){var d=ca,k=a[b],e=a[b+1];a=a[b+2];var g,l,m,p,h,n;b=Math.abs(a);g=k*k+e*e;l=Math.sqrt(g);m=g+a*a;p=Math.sqrt(m);k=Math.atan2(e,k);h=a*a/m;m=g/m;e=d.a2/p;g=d.a3-d.a4/p;.3<m?(h=b/p*(1+m*(d.a1+e+h*g)/p),p=Math.asin(h),
e=h*h,m=Math.sqrt(1-e)):(m=l/p*(1-h*(d.a5-e-m*g)/p),p=Math.acos(m),e=1-m*m,h=Math.sqrt(e));n=1-d.e2*e;e=d.a/Math.sqrt(n);d=d.a6*e;e=l-e*m;g=b-d*h;b=m*e+h*g;l=m*g-h*e;d=l/(d/n+b);p+=d;0>a&&(p=-p);c[f++]=F*k;c[f++]=F*p;c[f]=b+l*d/2}function U(a,b,c){void 0===c&&(c=V());return da(a,b,c).projector}function da(a,b,c){if(c.source.spatialReference===a&&c.dest.spatialReference===b)return c;var f=t(a,c.source),d=t(b,c.dest);0===f&&0===d?a.equals(b)?c.projector=l:c.projector=null:c.projector=D[f][d];return c}
function V(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:l}}Object.defineProperty(e,"__esModule",{value:!0});var u,v,w,x,y,z,A,B;e.SphericalECEFSpatialReference=new Y({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
e.WGS84ECEFSpatialReference=new Y({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});e.canProject=function(a,b){return!!U(a,b,Z)};e.vectorToVector=T;e.pointToPoint=
function(a,b,c,f){void 0===c&&(c=b.spatialReference);void 0===f&&(f=0);d[0]=a.x;d[1]=a.y;var e=a.z;d[2]=void 0!==e?e:f;if(!h(d,a.spatialReference,0,d,c,0,1))return!1;b.x=d[0];b.y=d[1];b.spatialReference=c;void 0!==e?(b.z=d[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};e.pointToVector=function(a,b,c,f){void 0===f&&(f=0);d[0]=a.x;d[1]=a.y;var e=a.z;d[2]=void 0!==e?e:f;return h(d,a.spatialReference,0,b,c,0,1)};e.vectorToPoint=function(a,b,c,f){c instanceof X?f=f||c.spatialReference:ga.isPoint(c)?(c.hasZ=
!0,f=f||c.spatialReference):(f=c,c=new X({spatialReference:f}));return h(a,b,0,d,f,0,1)?(c.x=d[0],c.y=d[1],c.z=d[2],c.spatialReference=f,c):null};e.xyzToVector=function(a,b,c,f,e,k){d[0]=a;d[1]=b;d[2]=c;return h(d,f,0,e,k,0,1)};e.bufferToBuffer=h;e.localLinearScaleFactors=function(a,b,c,f){var d=t(b,Q),e=t(f,W);if(d===e&&0!==d||b.equals(f))return c[0]=1,c[1]=1,c[2]=1,!0;if(1===d){b=E.vec3.length(a);a=b/Math.sqrt(a[0]*a[0]+a[1]*a[1]);b/=g.earthRadius;if(3===e)return c[0]=a*b,c[1]=a*b,c[2]=1,!0;if(2===
e||5===e)return e=180/(g.earthRadius*Math.PI),c[0]=e*a*b,c[1]=e*b,c[2]=1,!0}return!1};e.computeLinearTransformation=function(a,b,c,f){var d=t(a,Q),e=t(f,W);if(d===e&&1!==e&&(0!==d||a.equals(f)))return H.mat4.identity(c),H.mat4.translate(c,c,b),!0;if(1===e){a=D[d][6];e=D[6][e];if(C.isNone(a)||C.isNone(e))return!1;a(b,0,r,0);e(r,0,G,0);a=n*r[0];e=n*r[1];b=Math.sin(a);a=Math.cos(a);f=Math.sin(e);e=Math.cos(e);c[0]=-b;c[4]=-f*a;c[8]=e*a;c[12]=G[0];c[1]=a;c[5]=-f*b;c[9]=e*b;c[13]=G[1];c[2]=0;c[6]=e;c[10]=
f;c[14]=G[2];c[3]=0;c[7]=0;c[11]=0;c[15]=1;return!0}if(3===e&&(2===d||1===d)){a=D[d][6];if(C.isNone(a))return!1;a(b,0,r,0);b=n*r[1];J(r,0,G,0);H.mat4.identity(c);H.mat4.translate(c,c,G);b=1/Math.cos(b);H.mat4.scale(c,c,[b,b,1]);return!0}return!1};e.transformDirection=function(a,b,c,d,e){E.vec3.copy(R,a);E.vec3.add(S,a,b);T(R,c,R,e);T(S,c,S,e);E.vec3.subtract(d,S,R);E.vec3.normalize(d,d)};e.mbsToMbs=function(a,b,c,d){b=da(b,d,ia);if(b.projector===l)return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;
if(C.isNone(b.projector))return!1;d=b.source;var f=b.dest;if(3===f.spatialReferenceId){b=D[d.spatialReferenceId][2];if(C.isNone(b))return!1;b(a,0,r,0);b=Math.abs(n*r[1])+Math.asin(a[3]/(g.earthRadius+a[2]));J(r,0,c,0);c[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,c,0);c[3]=a[3]*d.metersPerUnit/f.metersPerUnit;return!0};e.extentToBoundingBox=function(a,b,c){if(null==a)return!1;var f;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;
f=h(d,a.spatialReference,0,b,c,0,1);d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;f=f&&h(d,a.spatialReference,0,b,c,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return f};e.extentToBoundingRect=function(a,b,c){if(null==a)return!1;var f;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;f=h(d,
a.spatialReference,0,d,c,0,1);b[0]=d[0];b[1]=d[1];d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;f=f&&h(d,a.spatialReference,0,d,c,0,1);b[2]=d[0];b[3]=d[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return f};e.boundingRectToBoundingRect=function(a,b,c,f){if(null==a)return!1;if(b.equals(f))return fa.set(c,a),!0;d[0]=a[0];d[1]=a[1];d[2]=0;if(!h(d,b,0,d,f,0,1))return!1;c[0]=d[0];c[1]=d[1];
d[0]=a[2];d[1]=a[3];d[2]=0;if(!h(d,b,0,d,f,0,1))return!1;c[2]=d[0];c[3]=d[1];return!0};(function(a){a.x2lon=function(a){return a/g.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/g.earthRadius))};a.lon2x=function(a){return a*g.earthRadius};a.lat2y=function(a){a=Math.sin(a);return g.earthRadius/2*Math.log((1+a)/(1-a))}})(e.webMercator||(e.webMercator={}));e.canProjectToWGS84ComparableLonLat=function(a){a=t(a,Q);return!!D[a][6]};e.vectorToWGS84ComparableLonLat=aa;e.pointToWGS84ComparableLonLat=
ba;e.pointToWGS84ComparableLonLatPoint=function(a,b){var c=t(b.spatialReference,W);return C.isNone(D[6][c])?!1:ba(a,d)?(b.x=d[0],b.y=d[1],b.z=d[2],!0):!1};e.wgs84ComparableLonLatToECEF=function(a,b,c,d){void 0===d&&(d=0);d=g.earthRadius+d;var f=Math.cos(c);a[0]=Math.cos(b)*f*d;a[1]=Math.sin(b)*f*d;a[2]=Math.sin(c)*d};var D=(u={},u[2]=(v={},v[5]=null,v[6]=l,v[1]=K,v[0]=null,v[3]=J,v[2]=l,v[4]=M,v),u[5]=(w={},w[5]=l,w[6]=l,w[1]=K,w[0]=null,w[3]=null,w[2]=null,w[4]=M,w),u[3]=(x={},x[5]=null,x[6]=P,x[1]=
function(a,b,c,d){P(a,b,c,d);K(c,d,c,d)},x[0]=null,x[3]=l,x[2]=P,x[4]=function(a,b,c,d){P(a,b,c,d);M(c,d,c,d)},x),u[4]=(y={},y[5]=N,y[6]=N,y[1]=function(a,b,c,d){N(a,b,c,d);K(c,d,c,d)},y[0]=null,y[3]=function(a,b,c,d){N(a,b,c,d);J(c,d,c,d)},y[2]=N,y[4]=l,y),u[1]=(z={},z[5]=L,z[6]=L,z[1]=l,z[0]=null,z[3]=function(a,b,c,d){L(a,b,c,d);J(c,d,c,d)},z[2]=L,z[4]=function(a,b,c,d){L(a,b,c,d);M(c,d,c,d)},z),u[0]=(A={},A[5]=null,A[6]=null,A[1]=null,A[0]=l,A[3]=null,A[2]=null,A[4]=null,A),u[6]=(B={},B[5]=null,
B[6]=l,B[1]=K,B[0]=null,B[3]=null,B[2]=l,B[4]=M,B),u);e.getProjector=U;var Q={spatialReference:null,spatialReferenceId:0},W={spatialReference:null,spatialReferenceId:0},Z=V(),ia=V(),n=O.deg2rad(1),F=O.rad2deg(1),ca={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},d=I.vec3f64.create(),r=I.vec3f64.create(),G=I.vec3f64.create(),R=I.vec3f64.create(),S=I.vec3f64.create()});