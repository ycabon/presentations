// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),function(P,p,y,r,L,u,w,v){function l(g,e,k,h){for(var a=[],c=0;c<k.length;c++)a[c]=(h[c]-k[c])*g/e+k[c];return a}Object.defineProperty(p,"__esModule",{value:!0});p.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},
global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};p.computeColorAndIntensity=function(g,e){var k,h,a,c,d=e[2],m=M;u.vec3.set(m.ambient.color,1,1,1);m.ambient.intensity=p.settings.global.ambient;u.vec3.set(m.diffuse.color,1,1,1);m.diffuse.intensity=p.settings.global.diffuse;d=(Math.abs(d)-p.settings.local.altitude)/(p.settings.global.altitude-p.settings.local.altitude);d=y.clamp(d,0,1);m.globalFactor=
d;e=v.getTimes(g,e[1],e[0]);if(1>d){a=g.valueOf();var n,f;e.polarException===v.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=a-36E5*(g.getHours()+48)-6E4*g.getMinutes(),f=n+432E6):e.polarException===v.POLAR_EXCEPTION.POLAR_NIGHT?(n=a-2,f=a-1):(n=e.sunrise.valueOf(),f=e.sunset.valueOf());var t=f-n;c=n+t/2;h=t/4;k=c-h;h=c+h;var b=.06*t,t=n-b/2;n+=b/2;var x=f-b/2,r=f+b/2;f=p.settings.local;var F=[.01,f.ambientAtNight],G=[.8,.8,1],H=[.01,.01,.01],z=[f.diffuseAtTwilight,f.ambientAtTwilight],A=[1,.75,.75],B=[.8,.8,1],
C=[.9*f.diffuseAtNoon,f.ambientAtNoon],D=[1,.98,.98],E=[.98,.98,1],I=[f.diffuseAtNoon,f.ambientAtNoon],J=[1,1,1],K=[1,1,1];f=[0,0];var q=[0,0,0],b=[0,0,0];a<t||a>r?(f=F,q=H,b=G):a<n?(b=n-t,f=l(a-t,b,F,z),q=l(a-t,b,H,A),b=l(a-t,b,G,B)):a<k?(b=k-n,f=l(a-n,b,z,C),q=l(a-n,b,A,D),b=l(a-n,b,B,E)):a<c?(b=c-k,f=l(a-k,b,C,I),q=l(a-k,b,D,J),b=l(a-k,b,E,K)):a<h?(b=h-c,f=l(a-c,b,I,C),q=l(a-c,b,J,D),b=l(a-c,b,K,E)):a<x?(b=x-h,f=l(a-h,b,C,z),q=l(a-h,b,D,A),b=l(a-h,b,E,B)):a<r&&(b=r-x,f=l(a-x,b,z,F),q=l(a-x,b,A,
H),b=l(a-x,b,B,G));a=f[0];c=w.vec3f64.fromValues(q[0],q[1],q[2]);k=f[1];h=w.vec3f64.fromValues(b[0],b[1],b[2]);u.vec3.lerp(m.ambient.color,h,m.ambient.color,d);m.ambient.intensity=y.lerp(k,m.ambient.intensity,d);u.vec3.lerp(m.diffuse.color,c,m.diffuse.color,d);m.diffuse.intensity=y.lerp(a,m.diffuse.intensity,d)}d=g.valueOf();e.polarException===v.POLAR_EXCEPTION.MIDNIGHT_SUN?(g=d-36E5*(g.getHours()+48)-6E4*g.getMinutes(),e=g+432E6):e.polarException===v.POLAR_EXCEPTION.POLAR_NIGHT?(g=d-2,e=d-1):(g=
e.sunrise.valueOf(),e=e.sunset.valueOf());g=1-y.clamp(Math.abs(d-(g+(e-g)/2))/432E5,0,1);m.noonFactor=g;return m};p.computeDirection=function(g,e,k,h){h||(h=w.vec3f64.create());var a=N,c=r.mat4.identity(O);if("global"===k)v.getPosition(g,0,0,a),u.vec3.set(h,0,0,-1),r.mat4.rotateX(c,c,-a.azimuth),r.mat4.rotateY(c,c,-a.altitude);else{var d=p.settings.planarDirection;k=d.globalAngles;d=(Math.abs(e[2])-d.localAltitude)/(d.globalAltitude-d.localAltitude);d=y.clamp(d,0,1);1>d?(v.getPosition(g,e[1],e[0],
a),a.azimuth=(1-d)*a.azimuth+d*k.azimuth,a.altitude=(1-d)*a.altitude+d*k.altitude):(a.azimuth=k.azimuth,a.altitude=k.altitude);u.vec3.set(h,0,-1,0);r.mat4.rotateZ(c,c,-a.azimuth);r.mat4.rotateX(c,c,-a.altitude)}u.vec3.transformMat4(h,h,c);return h};p.computeShadowsEnabled=function(g,e){return"global"===e?!0:Math.abs(g[2])<p.settings.planarDirection.localAltitude};var O=L.mat4f64.create(),N={azimuth:0,altitude:0},M={ambient:{color:w.vec3f64.create(),intensity:0},diffuse:{color:w.vec3f64.create(),intensity:0,
direction:w.vec3f64.create()},globalFactor:0,noonFactor:0}});