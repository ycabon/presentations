// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),function(g,h,k,d,l,r,t,c,f,m,u,n,v){function p(b,a){b&&!b.spatialReference.equals(a)&&(b=m.canProject(b.spatialReference,
a)?m.project(b,a):null);return b}Object.defineProperty(h,"__esModule",{value:!0});g=function(b){function a(a){a=b.call(this,a)||this;a._handles=new r;return a}k(a,b);a.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};a.prototype.destroy=function(){this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});a.prototype._computeStencilEnabledExtents=function(a,b){var q=[],c=0;for(a=a.items;c<a.length;c++){var e=a[c].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=p(e.fullExtent,b),null!=e&&q.push(f.fromExtent(e)))}return q};d([c.property({readOnly:!0})],a.prototype,"layerViewsExtent",null);d([c.property({readOnly:!0,
dependsOn:["spatialReference","tilingScheme"]})],a.prototype,"tiledLayersExtent",null);d([c.property({readOnly:!0,dependsOn:["spatialReference"]})],a.prototype,"stencilEnabledExtents",null);d([c.property()],a.prototype,"spatialReference",null);d([c.property()],a.prototype,"tilingScheme",null);d([c.property()],a.prototype,"defaultTiledLayersExtent",void 0);d([c.property({constructOnly:!0})],a.prototype,"layers",void 0);d([c.property({constructOnly:!0})],a.prototype,"layerViews",void 0);return a=d([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],
a)}(c.declared(l));l=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}k(a,b);a.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};a.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};a.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?n.WEBMERCATOR_WORLD_EXTENT:n.GEOGRAPHIC_WORLD_EXTENT};d([c.property({dependsOn:["spatialReference"]})],a.prototype,"layerViewsExtent",void 0);return a=d([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],
a)}(c.declared(g));h.SurfaceExtentHelperGlobal=l;g=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}k(a,b);a.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};a.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=
a[c],this._handles.add(t.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};a.prototype._computeLayerViewsExtent=function(){var a=f.empty(),c=this.spatialReference;this.layerViews.forEach(function(b){b.isResolved()&&(b=b.fullExtentInLocalViewSpatialReference||b.layer.fullExtent,(b=p(b,c))&&f.expand(a,b))});var b=f.allFinite(a)?a:null,d=this._get("layerViewsExtent");return f.equals(b,d)?d:b};a.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;
var b=this.spatialReference,c=f.empty();this.layers.forEach(function(d){if(d.loaded&&u.isTiledLayer(d)){var e=v.getTiledLayerInfo(d,b,"local");d=e.tileInfo;e=e.fullExtent;d&&a.compatibleWith(d)&&e&&e.spatialReference.equals(b)&&f.expand(c,e)}});this.defaultTiledLayersExtent&&f.expand(c,this.defaultTiledLayersExtent);var d=f.allFinite(c)?c:null,e=this._get("tiledLayersExtent");return f.equals(d,e)?e:d};return a=d([c.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],a)}(c.declared(g));h.SurfaceExtentHelperLocal=
g});