// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/PooledArray"],function(g,c,k){function l(a){return a?a[0]+"/"+a[1]+"/"+a[2]:"null"}function h(a,b){b(a);if(!a.isLeaf){var e=0;for(a=a.children;e<a.length;e++)h(a[e],b)}}function m(a,b,e){a=a.screenDepth;b=b.screenDepth;return a<b?-e:a>b?e:0}Object.defineProperty(c,"__esModule",{value:!0});g=function(){function a(){this.q=new k;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},
enumerable:!0,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};return a}();c.IteratorPreorder=g;g=function(){function a(){this.q=new k}Object.defineProperty(a.prototype,"done",{get:function(){return 0===
this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();c.IteratorPostorder=g;c.lij2str=l;c.tile2str=function(a){return a?l(a.lij):"null"};c.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var e=0;e<a.length;e++)h(a[e],b);else h(a,b)};c.fallsWithinLayer=function(a,b,e){if(!b)return!1;
var d=b.fullExtent,f=a.extent;if(e){if(f[0]<d.xmin||f[1]<d.ymin||f[2]>d.xmax||f[3]>d.ymax)return!1}else if(d.xmin>f[2]||d.ymin>f[3]||d.xmax<f[0]||d.ymax<f[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};c.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};c.getRootTile=function(a){for(;a.parent;)a=a.parent;return a};c.nextTileInAncestry=function(a,b){var e=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>
e,f=0;a.lij[1]>>e&1&&(f+=2);d&1&&(f+=1);return b.children[f]};c.sortTiles=function(a,b){b.sort(function(b,d){return m(b,d,a)})};c.compareTiles=m;c.computeUpsampleInfo=function(a,b,e){for(var d=1,f=0,c=0;a!==b;)if(d*=.5,f*=.5,c*=.5,a.lij[2]&1&&(f+=.5),0===(a.lij[1]&1)&&(c+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");e.init(b,f,c,d)};c.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var e=a[b],d=e.parent;if(d)for(var f=0;4>f;f++){var c=d.children[f];if(c&&
c!==e&&c.visible)return!0}}return!1};c.tilesAreRelated=function(a,b){if(!a||!b)return!1;var c=a[0]<b[0],d=c?a:b;a=c?b:a;b=a[0]-d[0];if(0===b)return!1;b=1<<b;return Math.floor(a[1]/b)===d[1]&&Math.floor(a[2]/b)===d[2]}});