// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/quat ../../../../../core/libs/gl-matrix-2/quatf64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/orientedBoundingBox ../../../support/geometryUtils/plane ../../lib/depthRange".split(" "),function(S,B,y,C,L,M,N,h,p,D,E,l){function z(b,c,a){return h.vec3.set(b,c.data[a+
0],c.data[a+1],c.data[a+2])}function f(b,c){b.push(c[0]);b.push(c[1]);b.push(c[2])}function O(b,c,a,d){M.quat.conjugate(F,b.quaternion);h.vec3.sub(e,c,b.center);h.vec3.transformQuat(e,e,F);var v=8*((e[0]<-b.halfSize[0]?-1:e[0]>b.halfSize[0]?1:0)+3*(e[1]<-b.halfSize[1]?-1:e[1]>b.halfSize[1]?1:0)+9*(e[2]<-b.halfSize[2]?-1:e[2]>b.halfSize[2]?1:0)+13);c=G[v];if(0===c)return c;C.mat3.fromQuat(k,b.quaternion);C.mat3.scale(k,k,b.halfSize);var n=function(a,c){c=G[v+c+1];h.vec3.set(a,((c&1)<<1)-1,(c&2)-1,
((c&4)>>1)-1);h.vec3.transformMat3(a,a,k);return h.vec3.add(a,b.center,a)};a.length=0;f(a,n(A,0));f(a,n(H,1));f(a,n(e,2));f(a,n(I,3));d(a);if(1===c)return c;a.length=0;f(a,A);f(a,I);f(a,n(e,4));f(a,n(J,5));d(a);if(2===c)return c;a.length=0;f(a,A);f(a,J);f(a,n(e,6));f(a,H);d(a);return c}function P(b,c){for(var a=0,d=0;d<K;d++){var f=D.intersectPlane(b,c[d]);if(0<f)return-1;0===f&&(a|=1<<d)}return a}Object.defineProperty(B,"__esModule",{value:!0});B.computeDepthRange=function(b,c){var a=l.empty(),n=
b.eye,v=b.viewForward,p=b.frustum.planes;for(b=0;b<c.length;b++){var g=c[b].obb,q=h.vec3.dot(h.vec3.sub(e,g.center,n),v),m=D.projectedRadius(g,v);if(!l.within(a,q-m)||!l.within(a,q+m))if(g=P(g,p),-1!==g)if(0===g)r.far=q+m,r.near=q-m,l.union(a,r);else{var k=t.pushNew();k.near=q-m;k.far=q+m;k.mask=g;k.object=c[b]}}c=function(b){var c=t.data[b];if(l.within(a,c.near)&&l.within(a,c.far))return"continue";r.far=c.far;r.near=Infinity;0===O(c.object.obb,n,Q,function(a){for(var b=R,e=0;e<K&&0<a.length;e++)if(0!==
(c.mask&1<<e)){var k=p[e],l=a,g=b;g.length=0;var q=l.length-3;z(d,l,q);var m=E.signedDistance(k,d);0>=m&&(g.push(d[0]),g.push(d[1]),g.push(d[2]));var t=0,w=m;for(t;t<q;t+=3){z(u,l,t);var x=E.signedDistance(k,u);0>w*x&&(h.vec3.lerp(d,u,d,x/(x-w)),f(g,d));0>=x&&f(g,u);w=x;h.vec3.copy(d,u)}0>w*m&&(z(u,l,q),h.vec3.lerp(d,u,d,m/(m-w)),f(g,d));k=a;a=b;b=k}for(b=0;b<a.length;b+=3)h.vec3.set(d,a.data[b+0],a.data[b+1],a.data[b+2]),e=h.vec3.dot(h.vec3.sub(d,d,n),v),r.near=Math.min(r.near,e)})&&(r.near=0);l.union(a,
r)};for(b=0;b<t.length;b++)c(b);t.length=0;return a};var t=new y({allocator:function(b){return b||{near:Infinity,far:-Infinity,mask:0,object:null}},deallocator:function(b){b.object=null;return b}}),r=l.empty(),d=p.vec3f64.create(),u=p.vec3f64.create(),Q=new y({deallocator:null}),R=new y({deallocator:null}),G=function(){var b=new Int8Array(216),c=0,a=function(a){for(var d=0;d<a.length;d++)b[c+d]=a[d];c+=8};a([3,0,6,2,3,1,5,4]);a([2,0,2,3,1,5,4,0]);a([3,1,0,2,3,7,5,4]);a([2,0,1,3,2,6,4,0]);a([1,0,1,
3,2,0,0,0]);a([2,1,5,7,3,2,0,0]);a([3,2,0,1,3,7,6,4]);a([2,2,0,1,3,7,6,0]);a([3,3,0,1,5,7,6,2]);a([2,0,1,5,4,6,2,0]);a([1,0,1,5,4,0,0,0]);a([2,1,3,7,5,4,0,0]);a([1,0,2,6,4,0,0,0]);a([0,0,0,0,0,0,0,0]);a([1,1,3,7,5,0,0,0]);a([2,2,3,7,6,4,0,0]);a([1,2,3,7,6,0,0,0]);a([2,3,1,5,7,6,2,0]);a([3,4,0,1,5,7,6,2]);a([2,5,7,6,4,0,1,0]);a([3,5,0,1,3,7,6,4]);a([2,4,5,7,6,2,0,0]);a([1,4,5,7,6,0,0,0]);a([2,5,1,3,7,6,4,0]);a([3,6,0,2,3,7,5,4]);a([2,6,2,3,7,5,4,0]);a([3,7,6,2,3,1,5,4]);return b}(),K=4,k=L.mat3f64.create(),
F=N.quatf64.create(),e=p.vec3f64.create(),A=p.vec3f64.create(),H=p.vec3f64.create(),I=p.vec3f64.create(),J=p.vec3f64.create()});