// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/assignHelper ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./shader/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/StencilUtils ../../../../../webgl/Program ../../../../../webgl/renderState".split(" "),
function(q,f,k,m,g,h,r,t,u,v,n,w,x,y,z,A,e,p,B,l){Object.defineProperty(f,"__esModule",{value:!0});f.TextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0:2,OVERLAY1:3,SSAO:6,SHADOW_MAP:7};k=function(e){function c(){return null!==e&&e.apply(this,arguments)||this}m(c,e);c.prototype.bindPass=function(a,b){var d=this.program;n.VertexPosition.bindViewProjTransform(d,b.viewTransform);v.Slice.bindUniforms(this.program,this.configuration,b.slicePlane);0===
b.identifier&&(d.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",b.transformNormal_ViewFromGlobal),1===b.subPass&&d.setUniform2fv("uCameraNearFar",b.cameraNearFar),0===b.subPass&&(b.ambientOcclusionEnabled&&b.ambientOcclusion.bind(d,f.TextureUnits.SSAO),b.shadowsEnabled&&b.shadowMap.bind(d,f.TextureUnits.SHADOW_MAP),b.lighting.setUniforms(this.program,b.integratedMesh)));1===b.identifier&&this.program.setUniform2fv("uCameraNearFar",b.cameraNearFar);2===b.identifier&&w.OutputHighlight.bindOutputHighlight(a,
this.program,b)};c.prototype.bindDraw=function(a,b){n.VertexPosition.bindModelTransform(this.program,a);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",a.transformNormal_GlobalFromModel);if(b.isIntegratedMesh){var d=b.overlayTexScale;b=b.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[a.toMapSpace[0]*d[0]+b[0],a.toMapSpace[1]*d[1]+b[1],a.toMapSpace[0]*d[2]+b[2],a.toMapSpace[1]*d[3]+b[3]]);this.program.setUniform4fv("overlayTexScale",[a.toMapSpace[2]*d[0],a.toMapSpace[3]*
d[1],a.toMapSpace[2]*d[2],a.toMapSpace[3]*d[3]])}};c.prototype.bindMaterial=function(a,b,d){var c=this.program;c.setUniform4fv("uBaseColor",b.baseColor);c.setUniform1f("uObjectOpacity",b.objectOpacity);c.setUniform1f("textureAlphaCutoff",b.alphaCutoff);1===b.componentParameters.type?b.componentParameters.texture.bind(c,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:f.TextureUnits.COMPONENT_COLOR}):(c.setUniform4fv("uExternalColor",b.componentParameters.externalColor),c.setUniform1i("uExternalColorMixMode",
b.componentParameters.externalColorMixMode));h.isSome(b.baseColorTexture)&&b.baseColorTexture.bind(a,c,"uBaseColorTexture",f.TextureUnits.DIFFUSE,"uBaseColorTextureSize");0===this.configuration.output&&(x.PhysicallyBasedRenderingParameters.bindUniforms(this.program,b),h.isSome(b.metallicRoughnessTexture)&&b.metallicRoughnessTexture.bind(a,c,"texMetallicRoughness",f.TextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),h.isSome(b.emissionTexture)&&b.emissionTexture.bind(a,c,"texEmission",f.TextureUnits.EMISSION,
"texEmissionSize"),h.isSome(b.occlusionTexture)&&b.occlusionTexture.bind(a,c,"texOcclusion",f.TextureUnits.OCCLUSION,"texOcclusionSize"),h.isSome(b.normalTexture)&&b.normalTexture.bind(a,c,"normalTexture",f.TextureUnits.NORMAL,"normalTextureSize"));b.isIntegratedMesh&&(0===d.identifier&&0===d.subPass?(a.bindTexture(h.unwrap(b.overlayColorInner),f.TextureUnits.OVERLAY0),a.bindTexture(h.unwrap(b.overlayColorOuter),f.TextureUnits.OVERLAY1)):2===d.identifier&&(a.bindTexture(h.unwrap(b.overlayHighlightInner),
f.TextureUnits.OVERLAY0),a.bindTexture(h.unwrap(b.overlayHighlightOuter),f.TextureUnits.OVERLAY1)),c.setUniform1i("ovInnerColorTex",f.TextureUnits.OVERLAY0),c.setUniform1i("ovOuterColorTex",f.TextureUnits.OVERLAY1),c.setUniform1f("overlayOpacity",1))};c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,d=b.build({output:d.output,normalType:0!==d.integratedMeshMode?2:d.hasNormals?1:3,attributeColor:d.hasVertexColors,attributeTextureCoordinates:d.vertexTextureCoordinates,
componentData:d.componentData,alphaDiscardMode:d.alphaDiscardMode,baseColorTexture:d.baseColorTexture,doubleSidedMode:d.doubleSidedMode,receiveAmbientOcclusion:d.receiveAmbientOcclusion,receiveShadows:d.receiveShadows,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:a.viewingMode,vertexDiscardMode:d.vertexDiscardMode,pbrMode:d.usePBR?1:0,hasMetalnessAndRoughnessTexture:d.hasMetalnessAndRoughnessTexture,hasEmissionTexture:d.hasEmissionTexture,
hasOcclusionTexture:d.hasOcclusionTexture,hasNormalTexture:d.hasNormalTexture,vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:y.doublePrecisionRequiresObfuscation(a.rctx),overlayEnabled:2===d.integratedMeshMode});return new B(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),b.attributeLocations)};c.prototype.initializePipeline=function(){var a=this.configuration,b=0!==a.integratedMeshMode;return l.makePipelineState({blending:0===
a.output&&a.blendingEnabled?C:null,culling:D[a.cullFace],depthTest:{func:513},depthWrite:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams,stencilWrite:b||a.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:b?p.replaceBitWhenDepthTestPasses(1):a.sceneHasOcludees?p.stencilBaseAllZerosParams:null,polygonOffset:a.polygonOffsetEnabled?E:null})};c.shader=new z.ReloadableShaderModule(u,"./shader/ComponentShader.glsl",q);return c}(A.ShaderTechnique);f.ComponentTechnique=k;var C=l.separateBlendingParams(770,
1,771,771),E={factor:2,units:2},D=[null,{face:1028,mode:2305},{face:1029,mode:2305}];k=function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.transformNormal_GlobalFromModel=r.mat3f64.create();a.toMapSpace=t.vec4f64.create();return a}m(c,e);return c}(n.VertexPosition.ModelTransform);f.ComponentDrawParameters=k;k=function(f){function c(){var a=null!==f&&f.apply(this,arguments)||this;a.output=0;a.hasVertexColors=!1;a.hasNormals=!1;a.vertexTextureCoordinates=0;a.componentData=0;a.slicePlaneEnabled=
!1;a.cullFace=2;a.baseColorTexture=!1;a.receiveAmbientOcclusion=!0;a.receiveShadows=!0;a.vertexDiscardMode=0;a.doubleSidedMode=2;a.blendingEnabled=!0;a.alphaDiscardMode=1;a.integratedMeshMode=0;a.overlayEnabled=!1;a.polygonOffsetEnabled=!1;a.usePBR=!1;a.hasMetalnessAndRoughnessTexture=!1;a.hasEmissionTexture=!1;a.hasOcclusionTexture=!1;a.hasNormalTexture=!1;a.sceneHasOcludees=!1;return a}m(c,f);g([e.parameter({count:7})],c.prototype,"output",void 0);g([e.parameter()],c.prototype,"hasVertexColors",
void 0);g([e.parameter()],c.prototype,"hasNormals",void 0);g([e.parameter({count:3})],c.prototype,"vertexTextureCoordinates",void 0);g([e.parameter({count:2})],c.prototype,"componentData",void 0);g([e.parameter()],c.prototype,"slicePlaneEnabled",void 0);g([e.parameter({count:3})],c.prototype,"cullFace",void 0);g([e.parameter()],c.prototype,"baseColorTexture",void 0);g([e.parameter()],c.prototype,"receiveAmbientOcclusion",void 0);g([e.parameter()],c.prototype,"receiveShadows",void 0);g([e.parameter({count:3})],
c.prototype,"vertexDiscardMode",void 0);g([e.parameter({count:3})],c.prototype,"doubleSidedMode",void 0);g([e.parameter()],c.prototype,"blendingEnabled",void 0);g([e.parameter({count:4})],c.prototype,"alphaDiscardMode",void 0);g([e.parameter({count:3})],c.prototype,"integratedMeshMode",void 0);g([e.parameter()],c.prototype,"overlayEnabled",void 0);g([e.parameter()],c.prototype,"polygonOffsetEnabled",void 0);g([e.parameter()],c.prototype,"usePBR",void 0);g([e.parameter()],c.prototype,"hasMetalnessAndRoughnessTexture",
void 0);g([e.parameter()],c.prototype,"hasEmissionTexture",void 0);g([e.parameter()],c.prototype,"hasOcclusionTexture",void 0);g([e.parameter()],c.prototype,"hasNormalTexture",void 0);g([e.parameter()],c.prototype,"sceneHasOcludees",void 0);return c}(e.ShaderTechniqueConfiguration);f.ComponentTechniqueConfiguration=k});