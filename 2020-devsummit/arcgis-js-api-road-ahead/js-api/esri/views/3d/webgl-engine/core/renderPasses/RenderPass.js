// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../core/PooledArray"],function(l,q,r){Object.defineProperty(q,"__esModule",{value:!0});l=function(){function d(e,a,f){void 0===f&&(f=0);this._rctx=e;this._techniqueRepository=a;this._sorting=f;this._draws=new r({initialSize:32,allocator:function(a){return a||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=
new Map}d.prototype.submitDraw=function(e,a,f,d,k){var g=this._draws.pushNew();g.geometry=a;g.geometryRanges=f;g.material=e;g.bindDrawParams=d;g.depthSquaredHint=k;g.indexType=a.indexed?a.vao.indexBuffer.indexType:0};d.prototype.dispatch=function(e){var a=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();for(var f=null,d={repository:this._techniqueRepository},l=this._draws.length,g=0;g<l;g++){var b=this._draws.data[g],m=b.geometry,
c=b.material.getTechnique(d,e,m.parameters);this._passBoundTechniques.has(c)||(c.bindPass(a,e),this._passBoundTechniques.add(c));a.bindVAO(m.vao);c!==f&&(a.bindProgram(c.program),a.setPipelineState(c.pipeline),f=c);this._previouslyBoundMaterials.get(c)!==b.material&&(c.bindMaterial(a,b.material,e),this._previouslyBoundMaterials.set(c,b.material));this._previouslyBoundDraw.get(c)!==b.bindDrawParams&&(c.bindDraw(b.bindDrawParams,b.material,e),this._previouslyBoundMaterials.set(c,b.material));if(0!==
b.indexType)for(var c=k.get(b.indexType),h=0;h<b.geometryRanges.length;h+=2){var n=b.geometryRanges[h],p=b.geometryRanges[h+1];a.drawElements(m.primitiveType,p,b.indexType,n*c)}else for(h=0;h<b.geometryRanges.length;h+=2)n=b.geometryRanges[h],p=b.geometryRanges[h+1],a.drawArrays(m.primitiveType,n,p)}};d.prototype.prepareSubmit=function(){this._draws.clear()};d.prototype.finishSubmit=function(){var d=0===this._sorting?1:-1;this._draws.sort(function(a,f){var e=d*(a.depthSquaredHint-f.depthSquaredHint);
return 0!==e?e:a.geometry.vao.size-f.geometry.vao.size})};Object.defineProperty(d.prototype,"count",{get:function(){return this._draws.length},enumerable:!0,configurable:!0});return d}();q.RenderPass=l;var k=new Map;k.set(5121,1);k.set(5123,2);k.set(5125,4)});