// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(v,g,d,t,e){function h(a,f){var b=a.vertex.code;f.verticalOffsetEnabled?(a.vertex.uniforms.add("verticalOffset","vec4"),f.screenSizePerspectiveEnabled&&(a.include(t.ScreenSizePerspective),a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),b.add(e.glsl(k||(k=d(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),0===f.viewingMode?e.glsl(l||(l=d(["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"],
["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"]))):e.glsl(m||(m=d(["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"]))),f.screenSizePerspectiveEnabled?e.glsl(n||(n=d(["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):
e.glsl(p||(p=d(["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"],["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"])))))):b.add(e.glsl(q||(q=d(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function r(a,f,b,c){void 0===c&&(c=u);c.screenLength=a.screenLength;c.perDistance=Math.tan(.5*f)/(.5*b);c.minWorldLength=a.minWorldLength;
c.maxWorldLength=a.maxWorldLength;return c}Object.defineProperty(g,"__esModule",{value:!0});g.VerticalOffset=h;(function(a){a.bindUniforms=function(a,b,c){b.verticalOffset&&(b=r(b.verticalOffset,c.fovY,c.viewport[3]),a.setUniform4f("verticalOffset",b.screenLength*(c.pixelRatio||1),b.perDistance,b.minWorldLength,b.maxWorldLength))}})(h=g.VerticalOffset||(g.VerticalOffset={}));g.calculateVerticalOffsetFactors=r;var u={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0},l,m,n,p,k,q});