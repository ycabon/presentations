// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/maybe ../../../../../core/promiseUtils".split(" "),function(g,h,k,l,m,n){Object.defineProperty(h,"__esModule",{value:!0});g=function(){function d(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}Object.defineProperty(d.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0});d.prototype.acquire=function(a,c){var b=c.key,f=this._perConstructorInstances.get(a);f||(f=new Map,this._perConstructorInstances.set(a,f));var e=f.get(b);void 0===e?(e={technique:new a(this._context,c),refCount:1,refZeroFrame:0},f.set(b,e)):e.refCount+=1;return e.technique};d.prototype.acquireAndReleaseExisting=function(a,c,b){return m.isNone(b)?this.acquire(a,
c):c.key===b.key&&b instanceof a?b:(this.release(b),this.acquire(a,c))};d.prototype.release=function(a){a=this._perConstructorInstances.get(a.constructor).get(a.key);--a.refCount;0===a.refCount&&(a.refZeroFrame=this._frameCounter)};d.prototype.frameUpdate=function(){var a=this;this._frameCounter++;this._perConstructorInstances.forEach(function(c,b){c.forEach(function(b,e){0===b.refCount&&b.refZeroFrame+a._keepAliveFrameCount<a._frameCounter&&(b.technique.dispose(),c.delete(e))});0===c.size&&a._perConstructorInstances.delete(b)})};
d.prototype.getProgramsUsingUniform=function(a){return this._context.commonUniformStore.getPrograms(a)};d.prototype.hotReload=function(){return k(this,void 0,void 0,function(){var a,c=this;return l(this,function(b){switch(b.label){case 0:return a=[],this._perConstructorInstances.forEach(function(b,e){a.push(function(a,b){return k(c,void 0,void 0,function(){var c,e=this;return l(this,function(d){switch(d.label){case 0:return(c=b.shader)?[4,c.reload()]:[3,2];case 1:d.sent(),a.forEach(function(a){a.technique.reload(e._context)}),
d.label=2;case 2:return[2]}})})}(b,e))}),[4,n.all(a)];case 1:return b.sent(),[2]}})})};return d}();h.ShaderTechniqueRepository=g});