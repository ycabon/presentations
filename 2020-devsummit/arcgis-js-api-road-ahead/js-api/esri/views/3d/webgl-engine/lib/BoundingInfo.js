// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(m,z,y,t,r,n){m=function(){function g(c,h,k,b){this.primitiveIndices=c;this._numIndexPerPrimitive=h;this.indices=k;this._position=b;this.center=r.vec3f64.create();n.assert(1<=c.length);n.assert(0===k.length%this._numIndexPerPrimitive);n.assert(k.length>=c.length*this._numIndexPerPrimitive);n.assert(3===this._position.size||4===this._position.size);
b=this._position;h=b.data;var a=b.offsetIdx,e=b.strideIdx;b=0;var p=c.length,d=a+e*k[this._numIndexPerPrimitive*c[b]];g.tmpIndices.clear();g.tmpIndices.push(d);this.bbMin=r.vec3f64.fromValues(h[d],h[d+1],h[d+2]);for(this.bbMax=r.vec3f64.clone(this.bbMin);b<p;++b)for(var l=this._numIndexPerPrimitive*c[b],q=0;q<this._numIndexPerPrimitive;++q){d=a+e*k[l+q];g.tmpIndices.push(d);var f=h[d];this.bbMin[0]=Math.min(f,this.bbMin[0]);this.bbMax[0]=Math.max(f,this.bbMax[0]);f=h[d+1];this.bbMin[1]=Math.min(f,
this.bbMin[1]);this.bbMax[1]=Math.max(f,this.bbMax[1]);f=h[d+2];this.bbMin[2]=Math.min(f,this.bbMin[2]);this.bbMax[2]=Math.max(f,this.bbMax[2])}t.vec3.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(b=0;b<g.tmpIndices.length;++b)d=g.tmpIndices.data[b],k=h[d]-this.center[0],a=h[d+1]-this.center[1],d=h[d+2]-this.center[2],e=k*k+a*a+d*d,e<=c||(e=Math.sqrt(e),
p=.5*(e-this.bsRadius),this.bsRadius+=p,c=this.bsRadius*this.bsRadius,e=p/e,this.center[0]+=k*e,this.center[1]+=a*e,this.center[2]+=d*e);g.tmpIndices.clear()}g.prototype.getCenter=function(){return this.center};g.prototype.getBSRadius=function(){return this.bsRadius};g.prototype.getBBMin=function(){return this.bbMin};g.prototype.getBBMax=function(){return this.bbMax};g.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};g.prototype.getIndices=function(){return this.indices};g.prototype.getPosition=
function(){return this._position};g.prototype.getChildren=function(){if(this._children)return this._children;if(1<t.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var c=t.vec3.lerp(r.vec3f64.create(),this.bbMin,this.bbMax,.5),h=this.primitiveIndices.length,k=new Uint8Array(h),b=Array(8),a=0;8>a;++a)b[a]=0;for(var a=this._position,e=a.data,p=a.offsetIdx,d=a.strideIdx,a=0;a<h;++a){for(var l=0,q=this._numIndexPerPrimitive*this.primitiveIndices[a],f=p+d*this.indices[q],m=e[f],n=e[f+1],u=e[f+2],v=1;v<
this._numIndexPerPrimitive;++v){var f=p+d*this.indices[q+v],w=e[f],x=e[f+1],f=e[f+2];w<m&&(m=w);x<n&&(n=x);f<u&&(u=f)}m<c[0]&&(l|=1);n<c[1]&&(l|=2);u<c[2]&&(l|=4);k[a]=l;++b[l]}for(a=c=0;8>a;++a)0<b[a]&&++c;if(2>c)return;c=Array(8);for(a=0;8>a;++a)c[a]=0<b[a]?new Uint32Array(b[a]):void 0;for(a=0;8>a;++a)b[a]=0;for(a=0;a<h;++a)l=k[a],c[l][b[l]++]=this.primitiveIndices[a];this._children=Array(8);for(a=0;8>a;++a)void 0!==c[a]&&(this._children[a]=new g(c[a],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};
return g}();(m||(m={})).tmpIndices=new y({deallocator:null});return m});