// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(l,e,D,u){function w(a,b,c,d){if(c>=b)return a;null==a&&(a=n());var m=a.data,e=8*m.BYTES_PER_ELEMENT,g=c/e|0,k=c-e*g,f=m;d=d===a.isVisibleBit;c<f.length*e||!d||(c=Math.max(g+1,Math.ceil(1.5*f.length)),c=Math.min(c,((b-1)/e|0)+1),m=new Uint32Array(c),m.set(f));g<m.length&&(m[g]=m[g]&~(1<<k)|(d?1:0)<<k);a.data=m;return a}function x(a,b){if(null==a)return!0;var c=a.isVisibleBit,d=a.data,e=8*d.BYTES_PER_ELEMENT;
return b<d.length*e?y(c,d,b,e):!a.isVisibleBit}function z(a){return u.isSome(a.component)?a.component:-1}function A(a,b,c,d){x(b,d)&&B(a,c[d],c[d+1]-1)}function B(a,b,c){var d=0<a.length?a[a.length-1]:null;(d?d[1]:-1)>=b||a.push([b,c])}function n(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function v(a,b){return!C(a,b,!1)}function C(a,b,c){a=a||E;var d=a.data;a=c===a.isVisibleBit;c=p(b);if(0===d.length||0===c)return!a;var e=8*d.BYTES_PER_ELEMENT;if(d.length*e<c&&!a)return!0;
var h=r[e];b=r[0];for(var g=0;g<d.length-1;g++)if(!a&&d[g]!==h||a&&d[g]!==b)return!0;h=d.length-1;c=r[(c-1)%e+1];return!a&&(d[h]&c)!==c||a&&(d[h]&c)!==b}function t(a){return 0<a.length}function y(a,b,c,d){var e=c/d|0;return 0!==(b[e]&1<<c-e*d)===a}function p(a){return Math.max(0,a.length-1)}Object.defineProperty(e,"__esModule",{value:!0});e.updateVisibility=function(a,b,c,d){return w(a,p(b),c,d)};e.updateVisibilityWithCount=w;e.getVisibility=x;e.hideAllComponents=function(a){if(null==a)return n(!1);
a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0;return a};e.unhideAllComponents=function(a){if(null==a)return null;a.isVisibleBit=!1;for(var b=0;b<a.data.length;b++)a.data[b]=0;return a};e.generateVisibleIndexRanges=function(a,b){var c;if(a)if(t(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var d=a.isVisibleBit,e=a.data,h=8*e.BYTES_PER_ELEMENT,g=e.length*h,k=p(b),f=!1,q=0;q<g&&q<k;q++){var l=y(d,e,q,h);if(l!==f){var n=b[q];l?c.push([n,0]):
(f=c[c.length-1],f[1]=n-1);f=l}}a=!a.isVisibleBit;k>g&&a&&!f?c.push([b[g],b[k]-1]):f&&(f=c[c.length-1],f[1]=b[a?k:Math.min(k,g)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};e.addOccludee=function(a,b){a=a||[];a.push({id:b});return a};e.removeOccludee=function(a,b){if(!a)return a;a=a.filter(function(a){return a.id!==b});return 0===a.length?null:a};e.addHighlight=function(a,b,c){a=a||[];b={component:b,id:c};a.push(b);c=z(b);for(var d=a.length-1;0<d&&c<z(a[d-1]);)b=[a[d],a[d-1]],a[d-1]=
b[0],a[d]=b[1],--d;return a};e.removeHighlight=function(a,b){if(!a)return a;a=a.filter(function(a){return a.id!==b});return 0===a.length?null:a};e.generateHighlightedIndexRanges=function(a,b,c){if(!b)return null;if(!t(c))return a&&a.isVisibleBit?null:b.map(function(a){return null});for(var d=c[0],e=c[c.length-1]-1,h=[],g=v(a,c),k=0;k<b.length;++k){var f=b[k].component;if(u.isSome(f))A(h,a,c,f);else if(g)B(h,d,e);else for(f=0;f<p(c);++f)A(h,a,c,f)}return 0<h.length?h:null};e.hasHighlights=function(a,
b,c){if(!b)return!1;if(!t(c))return a&&a.isVisibleBit?!1:0<b.length;a=v(a,c);for(var d=0;d<b.length;d++)if(u.isSome(b[d].component)||a||0<p(c))return!0;return!1};e.defaultVisibilities=n;e.isAllVisible=v;e.isAllHidden=function(a,b){return!C(a,b,!0)};var E=n();e.createOffsets=function(a){return a instanceof Uint32Array?a:new Uint32Array(a)};e.hasComponents=t;var r=[];for(l=0;65>l;l++)r.push(Math.pow(2,l)-1);e.componentCount=p;e.componentFind=function(a,b){a=D.binaryIndexOf(a,b,!0);return 0<=a?a:null}});