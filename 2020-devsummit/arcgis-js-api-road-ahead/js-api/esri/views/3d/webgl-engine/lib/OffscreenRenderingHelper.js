// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","./RenderTargetHelper","./Util"],function(m,n,f,h){var k=[0,0,0,0],l=[0,1,0,1];return function(){function b(a,b){this._rctx=a;this._compositingHelper=b;this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};a=this.renderTargetHelper=new f.RenderTargetHelper(this._rctx);this.mainColor=a.registerColorTarget({name:"mainColor"});this.mainDepth=a.registerDepthTarget({name:"mainDepth"});this.linearDepth=a.registerColorTarget({name:"linearDepth",
samplingMode:9728});this.normal=a.registerColorTarget({name:"normal"});this.highlight=a.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=a.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=a.registerColorTarget({name:"tmpColor"});this.tmpDepth=a.registerDepthTarget({name:"tmpDepth"})}Object.defineProperty(b.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.dimensions.height},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tmpColorTexture",
{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mainColorTexture",{get:function(){return this.getColorTexture(this.mainColor)},enumerable:!0,configurable:!0});b.prototype.initializeFrame=function(a){h.assert(this.enabled);var b=this._rctx;this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.bindTarget(this.mainColor,this.mainDepth);b.setClearStencil(0);a=this._background.color;b.setClearColor(a[0]*
a[3],a[1]*a[3],a[2]*a[3],a[3]);b.clearSafe(17664)};b.prototype.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};b.prototype.renderAndComposite=function(a,b){this.renderToTargets(a,this.tmpColor,this.mainDepth,k);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),b)};b.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,l)};b.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this;this.renderToTargets(function(){a._compositingHelper.compositeSpecial(a.getColorTexture(a.tmpColor),
2)},this.hudVisibility,this.mainDepth)};b.prototype.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};b.prototype.compositeOccludedOntoMain=function(a){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,a)};b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};b.prototype.renderDepthDetached=function(a){var b=this.bindTarget(this.mainColor);
a(b);this.bindTarget(this.mainColor,this.mainDepth)};b.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};b.prototype.enable=function(){this.enabled||(this._enabled=!0)};b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource())};b.prototype.renderToTargets=function(a,b,c,d,f,e){var g=this._rctx;b=this.bindTarget(b,c);c=0;d&&(g.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),c|=16384);f&&(c|=256);e&&(c|=1024);
g.clearSafe(c,!0===e?255:!1===e?0:e);a(b);g.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return b};b.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a);return a};b.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};b.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return b}()});