// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../webgl ./doublePrecisionUtils ./Util".split(" "),function(t,g,h,p,m,q,r){function k(a,e){var l=new m.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),b=m.BufferObject.createVertex(a,35044,new Uint16Array([0,0,1,0,0,1,1,1])),g=new m.VertexArrayObject(a,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,
offset:0,stride:4,normalized:!1}]},{geometry:b}),h=p.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),k=p.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);a.bindFramebuffer(l);e=new m.Program(a,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+(e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n    vec3 e \x3d dpMinusFrc(t1, hiA);\n    vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d hiA + hiB;\n    vec3 e \x3d t1 - hiA;\n    vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val \x3d dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color \x3d float2rgba(val.z / 25.0);\n\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var c=new Float32Array(6);q.encodeDoubleArray(h,c,3);var d=new Float32Array(6);q.encodeDoubleArray(k,d,3);a.bindProgram(e);e.setUniform3f("u_highA",c[0],c[2],c[4]);e.setUniform3f("u_lowA",c[1],c[3],c[5]);e.setUniform3f("u_highB",d[0],d[2],d[4]);e.setUniform3f("u_lowB",d[1],d[3],d[5]);var f=a.getViewport(),c=f.x,d=f.y,n=f.width,f=f.height;a.setViewport(0,0,1,1);a.bindVAO(g);
a.drawArrays(5,0,4);a.setViewport(c,d,n,f);a=new Uint8Array(4);l.readPixels(0,0,1,1,6408,5121,a);e.dispose();g.dispose(!1);b.dispose();l.dispose();l=(h[2]-k[2])/25;b=r.unpackFloatRGBA(a);return Math.abs(l-b)}Object.defineProperty(g,"__esModule",{value:!0});var n=function(){function a(a){this.context=a;this._doublePrecisionRequiresObfuscation=null}Object.defineProperty(a.prototype,"doublePrecisionRequiresObfuscation",{get:function(){if(h.isNone(this._doublePrecisionRequiresObfuscation)){var a=k(this.context,
!1),b=k(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==a&&(0===b||5<a/b)}return this._doublePrecisionRequiresObfuscation},enumerable:!0,configurable:!0});return a}(),b=null;g.testWebGLDriver=function(a){if(h.isNone(b)||b.context!==a)b=new n(a);return b}});