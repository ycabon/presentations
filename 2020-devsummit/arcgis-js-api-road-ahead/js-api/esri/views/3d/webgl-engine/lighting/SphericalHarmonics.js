// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(D,g,y,p,z,k,m){function q(c){return(c+1)*(c+1)}function u(c){return y.clamp(Math.floor(Math.sqrt(c)-1),0,2)}function r(c,b,a){var e=c[0],f=c[1];c=c[2];a=a||[];a.length=q(b);0<=b&&(a[0]=.28209479177);1<=b&&(a[1]=.4886025119*e,a[2]=.4886025119*c,a[3]=.4886025119*f);2<=b&&(a[4]=1.09254843059*e*f,a[5]=1.09254843059*
f*c,a[6]=.31539156525*(3*c*c-1),a[7]=1.09254843059*e*c,a[8]=.54627421529*(e*e-f*f));return a}function v(c,b){c=q(c);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=c;for(var a=0;a<c;a++)b.r[a]=b.g[a]=b.b[a]=0;return b}function w(c,b){for(var a=u(b.r.length),e=0;e<c.length;e++){var f=c[e];p.vec3.negate(t,f.direction);r(t,a,h);k.elementwiseProduct(h,n);k.scalarProduct(h,f.intensity[0],l);k.add(b.r,l);k.scalarProduct(h,f.intensity[1],l);k.add(b.g,l);k.scalarProduct(h,f.intensity[2],l);k.add(b.b,
l)}return b}function x(c,b){r(t,0,h);for(var a=0;a<c.length;a++){var e=c[a];b.r[0]+=h[0]*n[0]*e.intensity[0]*4*Math.PI;b.g[0]+=h[0]*n[0]*e.intensity[1]*4*Math.PI;b.b[0]+=h[0]*n[0]*e.intensity[2]*4*Math.PI}return b}Object.defineProperty(g,"__esModule",{value:!0});g.numberOfCoefficients=q;g.numberOfCoefficientsInBand=function(c){return 2*c+1};g.orderFromNumberOfCoefficients=u;g.computeCoefficients=r;g.initSHCoefficients=v;g.projectFillLights=w;g.projectAmbientLights=x;g.combineLights=function(c,b,a){v(b,
a.sphericalHarmonics.sh);p.vec3.set(a.main.intensity,0,0,0);var e=!1,f=A,g=B;b=C;f.length=0;g.length=0;for(var h=b.length=0;h<c.length;h++){var d=c[h];d instanceof m.MainLight&&!e?(p.vec3.copy(a.main.direction,d.direction),a.main.intensity[0]=d.intensity[0],a.main.intensity[1]=d.intensity[1],a.main.intensity[2]=d.intensity[2],a.main.castShadows=d.castShadows,e=!0):d instanceof m.MainLight||d instanceof m.FillLight?f.push(d):d instanceof m.AmbientLight?g.push(d):d instanceof m.SphericalHarmonicsLight&&
b.push(d)}w(f,a.sphericalHarmonics.sh);x(g,a.sphericalHarmonics.sh);for(c=0;c<b.length;c++)d=b[c],k.add(a.sphericalHarmonics.sh.r,d.sh.r),k.add(a.sphericalHarmonics.sh.g,d.sh.g),k.add(a.sphericalHarmonics.sh.b,d.sh.b)};var A=[],B=[],C=[],h=[0],l=[0],t=z.vec3f64.create(),n=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]});