// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/MeasurementArrowTechnique".split(" "),function(m,I,n,b,c,A,B,C,g,p,D,q){m=function(b){function a(d,a){a=b.call(this,a)||this;a.techniqueConfig=new q.MeasurementArrowTechniqueConfiguration;a.params=p.copyParameters(d,
E);return a}n(a,b);a.prototype.getTechniqueConfig=function(){this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;return this.techniqueConfig};a.prototype.dispose=function(){};a.prototype.setParameterValues=function(a){p.updateParameters(this.params,a)&&this.parametersChanged()};a.prototype.getParameters=function(){return this.params};a.prototype.getPassParameters=function(){return this.params};a.prototype.intersect=function(){};a.prototype.createBufferWriter=function(){return new F};
a.prototype.createRenderer=function(a,b){return new D(a,b,this)};a.prototype.getGLMaterial=function(a){return 0===a.output?new G(a):void 0};return a}(C.Material);var G=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}n(a,b);a.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(q.MeasurementArrowTechnique,this.material.getTechniqueConfig(),this.technique)};a.prototype.beginSlot=function(a){return 3===a};a.prototype.bind=function(a){a.bindProgram(this.technique.program);
this.technique.bindPass(a,this.material.getPassParameters())};return a}(B.GLMaterial),E={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},H=A.newLayout().vec3f(g.VertexAttrConstants.POSITION).vec3f(g.VertexAttrConstants.NORMAL).vec2f(g.VertexAttrConstants.UV0).f32(g.VertexAttrConstants.AUXPOS1),h=c.vec3f64.create(),r=c.vec3f64.create(),v=c.vec3f64.create(),k=c.vec3f64.create(),w=c.vec3f64.create(),F=function(){function c(){this.vertexBufferLayout=
H}c.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};c.prototype.elementCount=function(a){return 2*(a.indices[g.VertexAttrConstants.POSITION].length/2+1)};c.prototype.write=function(a,d,c,m){var l=d.vertexAttr[g.VertexAttrConstants.POSITION].data,z=d.vertexAttr[g.VertexAttrConstants.NORMAL].data,t=l.length/3;(d=d&&d.indices&&d.indices.position)&&d.length!==2*(t-1)&&console.warn("MeasurementArrowMaterial does not support indices");d=a.transformation;for(var n=a.invTranspTransformation,
p=c.position,q=c.normal,x=c.uv0,f=a=0;f<t;++f){var e=3*f;b.vec3.set(h,l[e],l[e+1],l[e+2]);f<t-1&&(e=3*(f+1),b.vec3.set(r,l[e],l[e+1],l[e+2]),b.vec3.set(w,z[e],z[e+1],z[e+2]),b.vec3.normalize(w,w),b.vec3.subtract(v,r,h),b.vec3.normalize(v,v),b.vec3.cross(k,w,v),b.vec3.normalize(k,k));e=b.vec3.distance(h,r);d&&n&&(b.vec3.transformMat4(h,h,d),b.vec3.transformMat4(r,r,d),b.vec3.transformMat4(k,k,n));var u=m+2*f,y=u+1;p.setVec(u,h);p.setVec(y,h);q.setVec(u,k);q.setVec(y,k);x.set(u,0,a);x.set(u,1,-1);x.set(y,
0,a);x.set(y,1,1);f<t-1&&(a+=e)}c=c.auxpos1;for(f=0;f<2*t;++f)c.set(m+f,a)};return c}();return m});