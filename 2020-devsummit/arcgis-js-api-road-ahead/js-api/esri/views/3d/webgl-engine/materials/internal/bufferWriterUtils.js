// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(H,q,t,m){function E(l,f,a,c,e){var g=a.typedBuffer;a=a.typedBufferStride;var h=l.length;c*=a;if(null==e||1===e)for(var d=0;d<h;++d){var b=2*l[d];g[c]=f[b];g[c+1]=f[b+1];c+=a}else for(d=0;d<h;++d)for(var b=2*l[d],k=0;k<e;++k)g[c]=f[b],g[c+1]=f[b+1],c+=a}function C(l,f,a,c,e){var g=a.typedBuffer;a=a.typedBufferStride;var h=l.length;c*=a;if(null==e||1===e)for(var d=0;d<h;++d){var b=3*l[d];g[c]=f[b];g[c+1]=f[b+
1];g[c+2]=f[b+2];c+=a}else for(d=0;d<h;++d)for(var b=3*l[d],k=0;k<e;++k)g[c]=f[b],g[c+1]=f[b+1],g[c+2]=f[b+2],c+=a}function z(l,f,a,c,e){var g=a.typedBuffer;a=a.typedBufferStride;var h=l.length;c*=a;if(null==e||1===e)for(var d=0;d<h;++d){var b=4*l[d];g[c]=f[b];g[c+1]=f[b+1];g[c+2]=f[b+2];g[c+3]=f[b+3];c+=a}else for(d=0;d<h;++d)for(var b=4*l[d],k=0;k<e;++k)g[c]=f[b],g[c+1]=f[b+1],g[c+2]=f[b+2],g[c+3]=f[b+3],c+=a}function F(l,f,a,c,e,g){if(a){var h=c.typedBuffer;c=c.typedBufferStride;var d=l.length;
e*=c;if(null==g||1===g)for(var b=0;b<d;++b){var k=3*l[b],v=f[k],p=f[k+1],m=f[k+2];h[e]=a[0]*v+a[4]*p+a[8]*m+a[12];h[e+1]=a[1]*v+a[5]*p+a[9]*m+a[13];h[e+2]=a[2]*v+a[6]*p+a[10]*m+a[14];e+=c}else for(b=0;b<d;++b)for(var k=3*l[b],v=f[k],p=f[k+1],m=f[k+2],k=a[0]*v+a[4]*p+a[8]*m+a[12],q=a[1]*v+a[5]*p+a[9]*m+a[13],v=a[2]*v+a[6]*p+a[10]*m+a[14],p=0;p<g;++p)h[e]=k,h[e+1]=q,h[e+2]=v,e+=c}else C(l,f,c,e,g)}function G(l,f,a,c,e,g){if(a){var h=c.typedBuffer;c=c.typedBufferStride;var d=l.length,b=a[0],k=a[1],m=
a[2],p=a[4],q=a[5],t=a[6],A=a[8],B=a[9];a=a[10];var z=1E-5<Math.abs(1-b*b+p*p+A*A)||1E-5<Math.abs(1-k*k+q*q+B*B)||1E-5<Math.abs(1-m*m+t*t+a*a);e*=c;if(null==g||1===g)for(var x=0;x<d;++x){var r=3*l[x],n=f[r],u=f[r+1],y=f[r+2];g=b*n+p*u+A*y;var r=k*n+q*u+B*y,w=m*n+t*u+a*y;z&&(n=g*g+r*r+w*w,.999999>n&&1E-6<n&&(n=Math.sqrt(n),g/=n,r/=n,w/=n));h[e+0]=g;h[e+1]=r;h[e+2]=w;e+=c}else for(x=0;x<d;++x)for(r=3*l[x],n=f[r],u=f[r+1],y=f[r+2],r=b*n+p*u+A*y,w=k*n+q*u+B*y,u=m*n+t*u+a*y,z&&(n=r*r+w*w+u*u,.999999>n&&
1E-6<n&&(n=Math.sqrt(n),r/=n,w/=n,u/=n)),n=0;n<g;++n)h[e+0]=r,h[e+1]=w,h[e+2]=u,e+=c}else C(l,f,c,e,g)}function D(l,f,a,c,e,g){var h=c.typedBuffer;c=c.typedBufferStride;var d=l.length;e*=c;if(null==g||1===g)if(4===a)for(a=0;a<d;++a){var b=4*l[a];h[e]=f[b];h[e+1]=f[b+1];h[e+2]=f[b+2];h[e+3]=f[b+3];e+=c}else{if(3===a)for(a=0;a<d;++a)b=3*l[a],h[e]=f[b],h[e+1]=f[b+1],h[e+2]=f[b+2],h[e+3]=255,e+=c}else if(4===a)for(a=0;a<d;++a)for(var b=4*l[a],k=0;k<g;++k)h[e]=f[b],h[e+1]=f[b+1],h[e+2]=f[b+2],h[e+3]=f[b+
3],e+=c;else if(3===a)for(a=0;a<d;++a)for(b=3*l[a],k=0;k<g;++k)h[e]=f[b],h[e+1]=f[b+1],h[e+2]=f[b+2],h[e+3]=255,e+=c}Object.defineProperty(q,"__esModule",{value:!0});q.writeBufferVec2=E;q.writeBufferVec3=C;q.writeBufferVec4=z;q.writeBufferMat3f=function(l,f,a,c){var e=a.typedBuffer;a=a.typedBufferStride;var g=l.length;c*=a;for(var h=0;h<g;++h){for(var d=9*l[h],b=0;9>b;++b)e[c+b]=f[d+b];c+=a}};q.writeBufferMat4f=function(l,f,a,c){var e=a.typedBuffer;a=a.typedBufferStride;var g=l.length;c*=a;for(var h=
0;h<g;++h){for(var d=16*l[h],b=0;16>b;++b)e[c+b]=f[d+b];c+=a}};q.writePosition=F;q.writeNormal=G;q.writeColor=D;q.writeMultipliedColor=function(l,f,a,c,e,g,h){var d=e.typedBuffer;e=e.typedBufferStride;var b=l.length;g*=e;if(null==h||1===h)if(4===a)for(a=0;a<b;++a){var k=4*l[a];d[g]=f[k]*c[0];d[g+1]=f[k+1]*c[1];d[g+2]=f[k+2]*c[2];d[g+3]=f[k+3]*c[3];g+=e}else{if(3===a){var m=255*c[3];for(a=0;a<b;++a)k=3*l[a],d[g]=f[k]*c[0],d[g+1]=f[k+1]*c[1],d[g+2]=f[k+2]*c[2],d[g+3]=m,g+=e}}else if(4===a)for(a=0;a<
b;++a)for(var k=4*l[a],p=0;p<h;++p)d[g]=f[k]*c[0],d[g+1]=f[k+1]*c[1],d[g+2]=f[k+2]*c[2],d[g+3]=f[k+3]*c[3],g+=e;else if(3===a)for(m=255*c[3],a=0;a<b;++a)for(k=3*l[a],p=0;p<h;++p)d[g]=f[k]*c[0],d[g+1]=f[k+1]*c[1],d[g+2]=f[k+2]*c[2],d[g+3]=m,g+=e};q.writeDefaultAttributes=function(l,f,a,c,e,g){var h=0;for(f=f.fieldNames;h<f.length;h++){var d=f[h],b=l.vertexAttr[d],k=l.indices[d];if(b&&k)switch(d){case m.VertexAttrConstants.POSITION:m.assert(3===b.size);(d=e.getField(d,t.BufferViewVec3f))&&F(k,b.data,
a,d,g);break;case m.VertexAttrConstants.NORMAL:m.assert(3===b.size);(d=e.getField(d,t.BufferViewVec3f))&&G(k,b.data,c,d,g);break;case m.VertexAttrConstants.UV0:m.assert(2===b.size);(d=e.getField(d,t.BufferViewVec2f))&&E(k,b.data,d,g);break;case m.VertexAttrConstants.REGION:m.assert(4===b.size);(d=e.getField(d,t.BufferViewVec4u16))&&z(k,b.data,d,g);break;case m.VertexAttrConstants.COLOR:m.assert(3===b.size||4===b.size);(d=e.getField(d,t.BufferViewVec4u8))&&D(k,b.data,b.size,d,g);break;case m.VertexAttrConstants.SYMBOLCOLOR:m.assert(3===
b.size||4===b.size);(d=e.getField(d,t.BufferViewVec4u8))&&D(k,b.data,b.size,d,g);break;case m.VertexAttrConstants.TANGENT:m.assert(4===b.size),(d=e.getField(d,t.BufferViewVec4f))&&z(k,b.data,d,g)}}}});