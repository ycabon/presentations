// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,k,l,e,g,m,p,q,r,t,u,b,v,h,w,x,f){Object.defineProperty(k,"__esModule",{value:!0});g=function(b){function a(d,a){a=b.call(this,d,a)||this;a.stipplePattern=null;a.stippleTextureBind=null;a.stippleTextureRepository=d.stippleTextureRepository;return a}l(a,b);a.prototype.initializeProgram=function(d){var b=a.shader.get(),c=this.configuration,b=b.build({output:c.output,attributeColor:c.vertexColors,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:c.stippleEnabled,stippleOffColorEnabled:c.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:c.stippleIntegerRepeatsEnabled});return new x(d.rctx,b.generateSource("vertex"),b.generateSource("fragment"),v.Default3D)};a.prototype.dispose=function(){b.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};a.prototype.bindPass=function(d,a,b){if(this.stipplePattern!==a.stipplePattern){var c=
a.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,c);this.stipplePattern=c}this.configuration.stippleEnabled&&(c=m.isSome(this.stippleTextureBind)?this.stippleTextureBind(d,0)*b.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/c),this.program.setUniform2f("ndcToPixel",b.viewport[2]/2,b.viewport[3]/2));0===this.configuration.output?(this.program.setUniform4fv("constantColor",a.color),
this.program.setUniform1f("alphaCoverage",Math.min(1,a.width*b.pixelRatio)),this.configuration.stippleOffColorEnabled&&(d=m.expect(a.stippleOffColor),this.program.setUniform4f("stippleOffColor",d[0],d[1],d[2],3<d.length?d[3]:1))):r.OutputHighlight.bindOutputHighlight(d,this.program,b)};a.prototype.bindDraw=function(a){q.Transform.bindUniforms(this.program,a);p.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};a.prototype.initializePipeline=function(){var a=this.configuration,b=f.separateBlendingParams(770,
1,771,771),c=function(b,d,c){void 0===d&&(d=null);void 0===c&&(c=null);return f.makePipelineState({blending:d,depthTest:h.depthCompareLess,depthWrite:c,colorWrite:f.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?b?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null})};return 0===a.output?(this._occludeeState=c(!0,a.transparent||a.stippleEnabled?b:null,f.defaultDepthWriteParams),c(!1,a.transparent||a.stippleEnabled?b:null,f.defaultDepthWriteParams)):
c(!1)};Object.defineProperty(a.prototype,"primitiveType",{get:function(){return 1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0});a.shader=new t.ReloadableShaderModule(w,"./NativeLine.glsl",n);return a}(u.ShaderTechnique);k.NativeLineTechnique=g;g=function(f){function a(){var a=null!==f&&f.apply(this,arguments)||this;a.output=0;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.vertexColors=
!1;a.transparent=!1;a.stippleEnabled=!1;a.stippleOffColorEnabled=!1;a.stippleIntegerRepeatsEnabled=!1;a.sceneHasOcludees=!1;return a}l(a,f);e([b.parameter({count:7})],a.prototype,"output",void 0);e([b.parameter()],a.prototype,"slicePlaneEnabled",void 0);e([b.parameter()],a.prototype,"sliceHighlightDisabled",void 0);e([b.parameter()],a.prototype,"vertexColors",void 0);e([b.parameter()],a.prototype,"transparent",void 0);e([b.parameter()],a.prototype,"stippleEnabled",void 0);e([b.parameter()],a.prototype,
"stippleOffColorEnabled",void 0);e([b.parameter()],a.prototype,"stippleIntegerRepeatsEnabled",void 0);e([b.parameter()],a.prototype,"sceneHasOcludees",void 0);return a}(b.ShaderTechniqueConfiguration);k.NativeLineTechniqueConfiguration=g});