// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Handles ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ./DrawAction ./input/Keys ../input/InputManager ../input/recognizers/PointerClickHoldAndDrag".split(" "),function(u,v,l,h,m,f,k,g,n,p,e,q){var r=function(){function d(b,a,c){this.view=b;this.native=a;this.coordinates=c;this.defaultPrevented=!1;this.type="cursor-update"}d.prototype.preventDefault=function(){this.defaultPrevented=
!0};return d}(),t=function(){function d(b,a){this.native=b;this.coordinates=a;this.defaultPrevented=!1;this.type="draw-complete"}d.prototype.preventDefault=function(){this.defaultPrevented=!0};return d}();return function(d){function b(a){a=d.call(this,a)||this;a._clickDelay=q.DefaultParameters.maximumClickDelay;a._cursorMoved=!1;a._cursorScreenPoint=null;a._pointerDownEvent=null;a._viewHandles=new m;a.coordinates=[];a.view=null;return a}l(b,d);b.prototype.initialize=function(){this._addViewHandles()};
b.prototype.destroy=function(){this._removeViewHandles();this._viewHandles.destroy();this.emit("destroy")};b.prototype.complete=function(){if(this._cursorScreenPoint){var a=this.getCoordsFromScreenPoint(this._cursorScreenPoint);f.isSome(a)&&(this._set("coordinates",a),this._completeDrawing())}};b.prototype._addViewHandles=function(){var a=this;this._removeViewHandles();this._viewHandles.add([this.view.on("click",function(c){c.stopPropagation();var b=a.getCoordsFromScreenPoint(c.screenPoint);f.isSome(b)&&
(a._set("coordinates",b),a._drawCompleteHandler(c))},e.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(b){a._pointerDownEvent=b;a._cursorMoved=!1},e.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(b){a._cursorMoved=!0;a._cursorScreenPoint=k.createScreenPointFromEvent(b);a._cursorUpdateHandler(b)},e.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(b){if(a._pointerDownEvent&&!a._cursorMoved&&b.timestamp-a._pointerDownEvent.timestamp>a._clickDelay){a._cursorScreenPoint=
k.createScreenPointFromEvent(b);var c=a.getCoordsFromScreenPoint(a._cursorScreenPoint);f.isSome(c)&&(a._set("coordinates",c),a._drawCompleteHandler(b))}},e.ViewEventPriorities.TOOL),this.view.on("key-down",function(b){if(b.key===p.KEYS.drawCompleteKey&&a._cursorScreenPoint){var c=a.getCoordsFromScreenPoint(a._cursorScreenPoint);f.isSome(c)&&(a._set("coordinates",c),a._drawCompleteHandler(b))}},e.ViewEventPriorities.TOOL)])};b.prototype._removeViewHandles=function(){this._viewHandles.removeAll()};
b.prototype._updateCursor=function(a,b){this.emit("cursor-update",new r(this.view,b,a))};b.prototype._completeDrawing=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;a=new t(a,this.coordinates);this.emit("draw-complete",a);a.defaultPrevented||this._removeViewHandles()};b.prototype._cursorUpdateHandler=function(a){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),a.native)};b.prototype._drawCompleteHandler=function(a){this._completeDrawing(a.native)};h([g.property({readOnly:!0})],
b.prototype,"coordinates",void 0);h([g.property()],b.prototype,"view",void 0);return b=h([g.subclass("esri.views.draw.PointDrawAction")],b)}(g.declared(n))});