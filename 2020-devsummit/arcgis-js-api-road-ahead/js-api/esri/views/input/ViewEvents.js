// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/compilerUtils ../../core/mathUtils ../../core/screenUtils ./InputHandler ./InputManager".split(" "),function(r,l,w,x,y,t,z,A){function u(e){return!!v[e]}function B(e){for(var c=0;c<e.length;c++)if(!u(e[c]))return!1;return!0}Object.defineProperty(l,"__esModule",{value:!0});l.eventTypes="click double-click immediate-click immediate-double-click hold drag key-down key-up pointer-down pointer-move pointer-up pointer-drag mouse-wheel pointer-enter pointer-leave gamepad focus blur".split(" ");
var v={};l.eventTypes.forEach(function(e){v[e]=!0});r=function(){function e(c){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=c;this.inputManager=null}e.prototype.connect=function(c){var a=this;c&&this.disconnect();this.inputManager=c;this.handlers.forEach(function(b,f){return a.inputManager.installHandlers(f,[b.handler],b.priority)})};e.prototype.disconnect=function(){var c=this;this.inputManager&&this.handlers.forEach(function(a,b){return c.inputManager.uninstallHandlers(b)});
this.inputManager=null};e.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};e.prototype.on=function(c,a,b,f){var g=this,d=Array.isArray(c)?c:c.split(",");if(!B(d))return d.some(u)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;var h;Array.isArray(a)?c=a:(h=a,c=[]);"function"===typeof b?h=b:f=b;f=null!=f?f:A.ViewEventPriorities.DEFAULT;var k=this.createUniqueGroupName();b=new C(this.view,d,c,
h);this.handlers.set(k,{handler:b,priority:f});for(h=0;h<d.length;h++)c=d[h],a=this.handlerCounts.get(c)||0,this.handlerCounts.set(c,a+1);this.inputManager&&this.inputManager.installHandlers(k,[b],f);return{remove:function(){return g.removeHandler(k,d)}}};e.prototype.hasHandler=function(c){return!!this.handlerCounts.get(c)};e.prototype.removeHandler=function(c,a){if(this.handlers.has(c)){this.handlers.delete(c);for(var b=0;b<a.length;b++){var f=a[b],g=this.handlerCounts.get(f);void 0===g?console.error("Trying to remove handler for event that has no handlers registered: ",
f):1===g?this.handlerCounts.delete(f):this.handlerCounts.set(f,g-1)}}this.inputManager&&this.inputManager.uninstallHandlers(c)};e.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return e}();l.ViewEvents=r;var C=function(e){function c(a,b,f,c){var d=e.call(this,!0)||this;d.view=a;for(a=0;a<b.length;a++){var g=b[a];switch(g){case "click":d.registerIncoming("click",f,function(a){return c(d.wrapClick(a))});break;case "double-click":d.registerIncoming("double-click",
f,function(a){return c(d.wrapDoubleClick(a))});break;case "immediate-click":d.registerIncoming("immediate-click",f,function(a){return c(d.wrapImmediateClick(a))});break;case "immediate-double-click":d.registerIncoming("immediate-double-click",f,function(a){return c(d.wrapImmediateDoubleClick(a))});break;case "hold":d.registerIncoming("hold",f,function(a){return c(d.wrapHold(a))});break;case "drag":d.registerIncoming("drag",f,function(a){(a=d.wrapDrag(a))&&c(a)});break;case "key-down":d.registerIncoming("key-down",
f,function(a){return c(d.wrapKeyDown(a))});break;case "key-up":d.registerIncoming("key-up",f,function(a){return c(d.wrapKeyUp(a))});break;case "pointer-down":d.registerIncoming("pointer-down",f,function(a){return c(d.wrapPointer(a,"pointer-down"))});break;case "pointer-move":d.registerIncoming("pointer-move",f,function(a){return c(d.wrapPointer(a,"pointer-move"))});break;case "pointer-up":d.registerIncoming("pointer-up",f,function(a){return c(d.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":d.registerIncoming("pointer-drag",
f,function(a){return c(d.wrapPointerDrag(a))});break;case "mouse-wheel":d.registerIncoming("mouse-wheel",f,function(a){return c(d.wrapMouseWheel(a))});break;case "pointer-enter":d.registerIncoming("pointer-enter",f,function(a){return c(d.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":d.registerIncoming("pointer-leave",f,function(a){return c(d.wrapPointer(a,"pointer-leave"))});break;case "gamepad":d.registerIncoming("gamepad",f,function(a){c(d.wrapGamepad(a))});break;case "focus":d.registerIncoming("focus",
f,function(a){c(d.wrapFocus(a))});break;case "blur":d.registerIncoming("blur",f,function(a){c(d.wrapBlur(a))});break;default:x.neverReached(g)}}return d}w(c,e);c.prototype.wrapFocus=function(a){return{type:"focus",timestamp:a.timestamp,native:a.data.native,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapBlur=function(a){return{type:"blur",timestamp:a.timestamp,native:a.data.native,cancelable:a.cancelable,
stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapClick=function(a){var b=a.data,c=b.pointerType,g=b.button,d=b.buttons,h=b.x,e=b.y,l=b.native,b=b.eventId,m=a.cancelable,n=a.timestamp,p=t.createScreenPoint(h,e),q=this.getMapPoint(h,e);return{type:"click",pointerType:c,button:g,buttons:d,x:h,y:e,native:l,timestamp:n,screenPoint:p,mapPoint:q,eventId:b,cancelable:m,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};
c.prototype.wrapDoubleClick=function(a){var b=a.data,c=b.x,g=b.y,d=b.eventId,e=a.cancelable;return{type:"double-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:g,native:b.native,timestamp:a.timestamp,mapPoint:this.getMapPoint(c,g),eventId:d,cancelable:e,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,g=b.y,d=b.native,e=b.eventId,k=a.cancelable;return{type:"immediate-click",
pointerId:d.pointerId,pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:g,native:d,timestamp:a.timestamp,mapPoint:this.getMapPoint(c,g),eventId:e,cancelable:k,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapImmediateDoubleClick=function(a){var b=a.data,c=b.x,g=b.y,d=b.native,e=b.eventId,k=a.cancelable;return{type:"immediate-double-click",pointerId:d.pointerId,pointerType:b.pointerType,button:b.button,buttons:b.buttons,
x:c,y:g,native:d,timestamp:a.timestamp,mapPoint:this.getMapPoint(c,g),eventId:e,cancelable:k,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapHold=function(a){var b=a.data,c=b.x,e=b.y,d=a.cancelable;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:e,native:b.native,timestamp:a.timestamp,mapPoint:this.getMapPoint(c,e),cancelable:d,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};
c.prototype.getMapPoint=function(a,b){return this.view.toMap(t.createScreenPoint(a,b),{exclude:[]})};c.prototype.wrapDrag=function(a){var b=a.data,c=b.center,e=c.x,c=c.y,d=b.action,h=b.pointerType,k=b.button;"start"===d&&(this.latestDragStart=b);if(this.latestDragStart){var l=b.pointer.native,m=b.buttons,n=a.cancelable,p=a.timestamp,q={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===d&&(this.latestDragStart=void 0);return{type:"drag",action:d,x:e,y:c,origin:q,pointerType:h,
button:k,buttons:m,radius:b.radius,angle:y.rad2deg(b.angle),native:l,timestamp:p,cancelable:n,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}}};c.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapKeyUp=function(a){var b=
a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapPointer=function(a,b){var c=a.data,e=c.native;return{type:b,x:c.x,y:c.y,pointerId:e.pointerId,pointerType:e.pointerType,button:c.button,buttons:c.buttons,native:e,timestamp:a.timestamp,eventId:c.eventId,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},
preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:a.data.startEvent.native.pointerId,pointerType:a.data.startEvent.native.pointerType,button:a.data.startEvent.button,buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:b.native,timestamp:a.timestamp,eventId:b.eventId,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},
preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,cancelable:a.cancelable,stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};c.prototype.wrapGamepad=function(a){var b=a.data,c=b.state;return{type:"gamepad",device:b.device,timestamp:a.timestamp,action:b.action,buttons:c.buttons,axes:c.axes,cancelable:a.cancelable,
stopPropagation:function(){return a.stopPropagation()},preventDefault:function(){return a.preventDefault()}}};return c}(z.InputHandler)});