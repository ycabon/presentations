// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),function(l,f,n,p,k,q,r){function m(c){var e=[];c.forEach(function(b){e.push(p.createScreenPoint(b.event.x,b.event.y))});return r.fitCircleLSQ(e)}function g(c){var e=m(c),b=0;c.forEach(function(a){for(var d=h(a,e),d=d-a.lastAngle;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=a.lastAngle+d;a.lastAngle=d;b+=d-a.initialAngle});b/=c.size||
1;return{angle:b,radius:e.radius,center:e.center}}function t(c){var e=new Map;c.forEach(function(b,a){return e.set(a,b.event)});return e}function h(c,e){c=c.event;return Math.atan2(c.y-e.center.y,c.x-e.center.x)}Object.defineProperty(f,"__esModule",{value:!0});l=function(c){function e(b){var a=c.call(this,!1)||this;a.navigationTouch=b;a.startStateModifiers=new Set;a.activePointerMap=new Map;a.isDragging=!1;a.isCurrentDragSuppressed=!1;a.drag=a.registerOutgoing("drag");a.registerIncoming("pointer-drag",
a.handlePointerDrag.bind(a));a.registerIncoming("pointer-up",a.handlePointerUpAndPointerLost.bind(a));a.registerIncoming("pointer-capture-lost",a.handlePointerUpAndPointerLost.bind(a));a.registerIncoming("pointer-cancel",a.handlePointerUpAndPointerLost.bind(a));return a}n(e,c);e.prototype.createPayload=function(b,a,d,c){return{action:b,pointerType:this.pointerType,button:this.mouseButton,buttons:a.buttons,timestamp:c,pointers:t(this.activePointerMap),pointer:a,angle:d.angle,radius:d.radius,center:d.center}};
e.prototype.addPointer=function(b){var a=b.native.pointerId,d=g(this.activePointerMap).angle;b={event:b,initialAngle:0,lastAngle:0};this.activePointerMap.set(a,b);a=h(b,m(this.activePointerMap));b.initialAngle=a;b.lastAngle=a;this.updatePointerAngles(d)};e.prototype.updatePointer=function(b){if(!b||null!=b.x||null!=b.y){var a=this.activePointerMap.get(b.native.pointerId);a?a.event=b:this.addPointer(b)}};e.prototype.removePointer=function(b){var a=g(this.activePointerMap).angle;this.activePointerMap.delete(b);
this.updatePointerAngles(a)};e.prototype.updatePointerAngles=function(b){var a=g(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=h(d,a)-b;d.lastAngle=h(d,a)-b})};e.prototype.emitEvent=function(b,a,d){var c=g(this.activePointerMap);this.drag.emit(this.createPayload(b,a,c,d),void 0,this.startStateModifiers)};e.prototype.handlePointerUpAndPointerLost=function(b){var a=b.data.native.pointerId,d=k.Milliseconds(b.timestamp);this.activePointerMap.get(a)&&(1===this.activePointerMap.size?
(this.updatePointer(b.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",b.data,d),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(a)):(this.removePointer(a),this.emitEvent("removed",b.data,k.Milliseconds(b.timestamp))))};e.prototype.handlePointerDrag=function(b){var a=b.data,d=a.currentEvent,c=k.Milliseconds(b.timestamp);switch(a.action){case "start":case "update":this.isDragging?this.activePointerMap.has(d.native.pointerId)?(this.updatePointer(d),!this.isCurrentDragSuppressed&&
this.emitEvent("update",d,c)):(this.addPointer(d),this.emitEvent("added",d,c),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(d),this.pointerType=b.data.startEvent.pointerType,this.mouseButton=b.data.startEvent.button,this.startStateModifiers=b.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",d,c))}};Object.defineProperty(e.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&
"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!0,configurable:!0});return e}(q.InputHandler);f.Drag=l;(function(c){c[c.Left=0]="Left";c[c.Middle=1]="Middle";c[c.Right=2]="Right";c[c.Back=3]="Back";c[c.Forward=4]="Forward";c[c.Undefined=-1]="Undefined"})(f.Button||(f.Button={}))});