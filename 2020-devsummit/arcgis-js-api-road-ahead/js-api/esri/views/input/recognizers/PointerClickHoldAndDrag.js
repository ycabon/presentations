// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(l,g,m,n,p,q){Object.defineProperty(g,"__esModule",{value:!0});g.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};l=function(h){function e(d,f,c,k,a,e){void 0===d&&(d=g.DefaultParameters.maximumClickDelay);void 0===f&&(f=g.DefaultParameters.movementUntilMouseDrag);void 0===c&&(c=g.DefaultParameters.movementUntilPenDrag);
void 0===k&&(k=g.DefaultParameters.movementUntilTouchDrag);void 0===a&&(a=g.DefaultParameters.holdDelay);void 0===e&&(e=n.default);var b=h.call(this,!1)||this;b.maximumClickDelay=d;b.movementUntilMouseDrag=f;b.movementUntilPenDrag=c;b.movementUntilTouchDrag=k;b.holdDelay=a;b._clock=e;b._pointerState=new Map;b._pointerDrag=b.registerOutgoing("pointer-drag");b._immediateClick=b.registerOutgoing("immediate-click");b._pointerHold=b.registerOutgoing("hold");b.registerIncoming("pointer-down",b._handlePointerDown.bind(b));
b.registerIncoming("pointer-up",function(a){b._handlePointerLoss(a,"pointer-up")});b.registerIncoming("pointer-capture-lost",function(a){b._handlePointerLoss(a,"pointer-capture-lost")});b.registerIncoming("pointer-cancel",function(a){b._handlePointerLoss(a,"pointer-cancel")});b._moveHandle=b.registerIncoming("pointer-move",b._handlePointerMove.bind(b));b._moveHandle.pause();return b}m(e,h);e.prototype.onUninstall=function(){this._pointerState.forEach(function(d){null!=d.holdTimeout&&(d.holdTimeout.remove(),
d.holdTimeout=null)});h.prototype.onUninstall.call(this)};e.prototype._handlePointerDown=function(d){var f=this,c=d.data,e=c.native.pointerId,a=null;0===this._pointerState.size&&(a=this._clock.setTimeout(function(){var a=f._pointerState.get(e);a&&(a.isDragging||(f._pointerHold.emit(a.previousEvent,void 0,d.modifiers),a.holdEmitted=!0),a.holdTimeout=null)},this.holdDelay));a={startEvent:c,previousEvent:c,startTimestamp:d.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:a,modifiers:new Set};
this._pointerState.set(e,a);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(d)};e.prototype._createPointerDragData=function(d,f,c){return{action:d,startEvent:f.startEvent,previousEvent:f.previousEvent,currentEvent:c}};e.prototype._handlePointerMove=function(d){var f=d.data,c=this._pointerState.get(f.native.pointerId);if(c){if(c.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",c,f),void 0,c.modifiers);else{var e=q.euclideanDistance(f,
c.startEvent),a=this._getDragThreshold(f.native.pointerType);e>a&&this.startDragging(d)}c.previousEvent=f}};e.prototype._getDragThreshold=function(d){switch(d){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};e.prototype.startDragging=function(d){var f=this,c=d.data,e=c.native.pointerId;this._pointerState.forEach(function(a){null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null);a.isDragging||(a.modifiers=
d.modifiers,a.isDragging=!0,e===a.startEvent.native.pointerId?f._pointerDrag.emit(f._createPointerDragData("start",a,c)):f._pointerDrag.emit(f._createPointerDragData("start",a,a.previousEvent),d.timestamp))})};e.prototype._handlePointerLoss=function(d,f){var c=d.data,e=c.native.pointerId,a=this._pointerState.get(e);a&&(null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null),a.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",a,"pointer-up"===f?c:a.previousEvent),void 0,
a.modifiers):"pointer-up"===f&&a.downButton===c.native.button&&d.timestamp-a.startTimestamp<=this.maximumClickDelay&&!a.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(e),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return e}(p.InputHandler);g.PointerClickHoldAndDrag=l});