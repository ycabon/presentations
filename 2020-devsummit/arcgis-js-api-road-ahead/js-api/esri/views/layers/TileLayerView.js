// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils".split(" "),function(p,b,g,e,l,m,n,q,h,c,r){Object.defineProperty(b,"__esModule",{value:!0});b.TileLayerView=function(b){return function(b){function d(){return null!==b&&b.apply(this,arguments)||
this}g(d,b);d.prototype.fetchPopupFeatures=function(b,d){return m(this,void 0,void 0,function(){var f,c,e,g=this;return l(this,function(p){f=this.layer;if(!b)return[2,h.reject(new n("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}))];if("tile"!==f.type)return[2,h.reject(new n("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:f.type}))];c=this.get("view.scale");e=f.allSublayers.toArray().filter(function(a){var b=0===a.minScale||c<=a.minScale,d=0===a.maxScale||
c>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&d});return[2,h.eachAlways(e.map(function(a){return m(g,void 0,void 0,function(){var c,e,f,g,h;return l(this,function(k){switch(k.label){case 0:return c=a.createQuery(),e=q.isSome(d)?d.event:null,f=r.calculateTolerance({renderer:a.renderer,event:e}),c.geometry=this.createFetchPopupFeaturesQueryGeometry(b,f),g=c,[4,a.popupTemplate.getRequiredFields()];case 1:return g.outFields=k.sent(),[4,a.queryFeatures(c)];case 2:return h=k.sent(),
[2,h.features]}})})})).then(function(a){return[].concat.apply([],a.map(function(a){return a.value}).filter(Boolean))})]})})};e([c.property()],d.prototype,"layer",void 0);return d=e([c.subclass("esri.layers.mixins.TileLayerView")],d)}(c.declared(b))}});