// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators ../../libs/maquette/index ../support/WatchUpdatingTracking".split(" "),function(q,r,l,e,m,n,d,k,p){return function(h){function c(){var a=null!==h&&h.apply(this,arguments)||this;a.items=new n;a._watchUpdatingTracking=new p.WatchUpdatingTracking;a._callbacks=new Map;a._projector=k.createProjector();a._hiddenProjector=k.createProjector();
return a}l(c,h);Object.defineProperty(c.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";this._set("surface",b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(this.items,function(b){b.added.map(function(b){var c=
function(){return b.render()};a._callbacks.set(b,c);a._projector.append(a.surface,c)});b.removed.map(function(b){var c=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(c.domNode);a._callbacks.delete(b)})})};c.prototype.addItem=function(a){this.items.add(a)};c.prototype.removeItem=function(a){this.items.remove(a)};c.prototype.destroy=function(){this.items.removeAll();this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};c.prototype.render=function(){this._projector.renderNow()};
c.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,c=this._hiddenProjector,d=null,e=function(){return d=a.render()};c.append(b,e);c.renderNow();var f={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var g=d.domNode.getBoundingClientRect();f.left=g.left;f.top=g.top;f.right=g.right;f.bottom=g.bottom}for(c.detach(e);b.firstChild;)b.removeChild(b.firstChild);return f};c.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,
b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};Object.defineProperty(c.prototype,"hasVisibleItems",{get:function(){return this.items.some(function(a){return a.visible})},enumerable:!0,configurable:!0});c.prototype.renderCanvas=function(a){if(this.items.some(function(a){return a.visible})){var b=a.getContext("2d");b.save();b.font="10px "+getComputedStyle(this.surface).fontFamily;this.items.forEach(function(a){b.save();a.renderCanvas(b);b.restore()});b.restore()}};
e([d.property({readOnly:!0})],c.prototype,"surface",void 0);e([d.property({readOnly:!0})],c.prototype,"items",void 0);e([d.property({readOnly:!0,dependsOn:["items.length"]})],c.prototype,"needsRender",null);e([d.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);e([d.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],c.prototype,"updating",void 0);return c=e([d.subclass("esri.views.overlay.ViewOverlay")],c)}(d.declared(m))});