// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(l,m,n,h,k){function g(c,b){if(h.isNone(c)||c.length!==b.length)return!0;for(var a=0;a<c.length;++a)if(c[a]!==b[a])return!0;return!1}return function(){function c(b,a,d,e,f){void 0===f&&(f={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1=
{};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};b||console.error("RenderingContext isn't initialized!");0===a.length&&console.error("Shaders source should not be empty!");this._context=b;this._vertexShaderSource=a;this._fragmentShaderSource=d;if(Array.isArray(f))for(b=0;b<f.length;b++)this._defines[f[b]]="1";else this._defines=f;this._id=c._nextId++;this._locations=e}Object.defineProperty(c.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});c.prototype.getDefine=function(b){return this._defines[b]};c.prototype.dispose=function(){if(this._context){var b=this._context.gl;this._vShader&&(b.deleteShader(this._vShader),this._vShader=null);this._fShader&&
(b.deleteShader(this._fShader),this._fShader=null);this._glName&&(b.deleteProgram(this._glName),this._glName=null);this._context=null}};c.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var b=this._context.gl,a=b.createProgram();b.attachShader(a,this._vShader);b.attachShader(a,this._fShader);for(var d in this._locations)b.bindAttribLocation(a,this._locations[d],
d);b.linkProgram(a);this._glName=a;this._initialized=!0}};c.prototype.getUniformLocation=function(b){this.initialize();void 0===this._nameToUniformLocation[b]&&(this._nameToUniformLocation[b]=this._context.gl.getUniformLocation(this._glName,b));return this._nameToUniformLocation[b]};c.prototype.hasUniform=function(b){return null!==this.getUniformLocation(b)};c.prototype.getAttribLocation=function(b){this.initialize();void 0===this._nameToAttribLocation[b]&&(this._nameToAttribLocation[b]=this._context.gl.getAttribLocation(this._glName,
b));return this._nameToAttribLocation[b]};c.prototype.setUniform1i=function(b,a){var d=this._nameToUniform1[b];if(void 0===d||a!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(b),a),this._nameToUniform1[b]=a};c.prototype.setUniform1iv=function(b,a){var d=this._nameToUniform1v[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(b),a),void 0===d?this._nameToUniform1v[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform2iv=
function(b,a){var d=this._nameToUniform2[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(b),a),void 0===d?this._nameToUniform2[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform3iv=function(b,a){var d=this._nameToUniform3[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(b),a),void 0===d?this._nameToUniform3[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform4iv=function(b,a){var d=
this._nameToUniform4[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(b),a),void 0===d?this._nameToUniform4[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform1f=function(b,a){var d=this._nameToUniform1[b];if(void 0===d||a!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(b),a),this._nameToUniform1[b]=a};c.prototype.setUniform1fv=function(b,a){var d=this._nameToUniform1v[b];g(d,a)&&(this._context.bindProgram(this),
this._context.gl.uniform1fv(this.getUniformLocation(b),a),void 0===d?this._nameToUniform1v[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform2f=function(b,a,d){var e=this._nameToUniform2[b];if(void 0===e||a!==e[0]||d!==e[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(b),a,d),void 0===e?this._nameToUniform2[b]=[a,d]:(e[0]=a,e[1]=d)};c.prototype.setUniform2fv=function(b,a){var d=this._nameToUniform2[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(b),
a),void 0===d?this._nameToUniform2[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform3f=function(b,a,d,e){var c=this._nameToUniform3[b];if(void 0===c||a!==c[0]||d!==c[1]||e!==c[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(b),a,d,e),void 0===c?this._nameToUniform3[b]=[a,d,e]:(c[0]=a,c[1]=d,c[2]=e)};c.prototype.setUniform3fv=function(b,a){var d=this._nameToUniform3[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),
a),void 0===d?this._nameToUniform3[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniform4f=function(b,a,d,c,f){var e=this._nameToUniform4[b];if(void 0===e||a!==e[0]||d!==e[1]||c!==e[2]||f!==e[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(b),a,d,c,f),void 0===e?this._nameToUniform4[b]=[a,d,c,f]:(e[0]=a,e[1]=d,e[2]=c,e[3]=f)};c.prototype.setUniform4fv=function(b,a){var d=this._nameToUniform4[b];g(d,a)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),
a),void 0===d?this._nameToUniform4[b]=c._arrayCopy(a):c._arrayAssign(a,d))};c.prototype.setUniformMatrix3fv=function(b,a,d){void 0===d&&(d=!1);var e=this._nameToUniformMatrix3[b],f;f=h.isNone(e)?!0:9!==e.length?g(e,a):9!==e.length||e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||e[4]!==a[4]||e[5]!==a[5]||e[6]!==a[6]||e[7]!==a[7]||e[8]!==a[8];f&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),d,a),void 0===e?this._nameToUniformMatrix3[b]=c._arrayCopy(a):
c._arrayAssign(a,e))};c.prototype.setUniformMatrix4fv=function(b,a,d){void 0===d&&(d=!1);var e=this._nameToUniformMatrix4[b],f;f=h.isNone(e)?!0:16!==e.length?g(e,a):16!==e.length||e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||e[4]!==a[4]||e[5]!==a[5]||e[6]!==a[6]||e[7]!==a[7]||e[8]!==a[8]||e[9]!==a[9]||e[10]!==a[10]||e[11]!==a[11]||e[12]!==a[12]||e[13]!==a[13]||e[14]!==a[14]||e[15]!==a[15];f&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),d,a),
void 0===e?this._nameToUniformMatrix4[b]=c._arrayCopy(a):c._arrayAssign(a,e))};c.prototype.assertCompatibleVertexAttributeLocations=function(b){(b=b.locations===this.locations)||console.error("VertexAttributeLocations are incompatible");return b};c._padToThree=function(b){var a=b.toString();1E3>b&&(a=("  "+b).slice(-3));return a};c.prototype._addLineNumbers=function(b){var a=2;return b.replace(/\n/g,function(){return"\n"+c._padToThree(a++)+":"})};c.prototype._loadShader=function(b){var a=35633===
b,d=a?this._vertexShaderSource:this._fragmentShaderSource,c;c="";for(var f in this._defines)c+="#define "+f+" "+this._defines[f]+"\n";c+=d;"webgl2"===this._context.contextVersion&&(c=k.transpileShader(c,a?"vertex":"fragment"));f=this._context.gl;b=f.createShader(b);f.shaderSource(b,c);f.compileShader(b);f.getShaderParameter(b,f.COMPILE_STATUS)||(console.error("Compile error in ".concat(a?"vertex":"fragment"," shader")),console.error(f.getShaderInfoLog(b)),console.error(this._addLineNumbers(c)),"webgl2"===
this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(d)));return b};c._arrayCopy=function(b){for(var a=[],c=0;c<b.length;++c)a.push(b[c]);return a};c._arrayAssign=function(b,a){for(var c=0;c<b.length;++c)a[c]=b[c]};c._nextId=0;return c}()});