// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Basemap ../../Ground ../../WebScene ../../core/compilerUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/extensions/serializableProperty/type ../../layers/GroupLayer ../../layers/KMLLayer ../../layers/mixins/OperationalLayer ./utils".split(" "),function(aa,E,f,g,F,L,M,w,z,N,G,O,H,P){function y(a,b,c){return g(this,void 0,void 0,function(){var d;return f(this,function(e){switch(e.label){case 0:d=
b.typeName;switch(d){case "array":return[3,1];case "union":return[3,3];case "json":return[3,5];case "native":return[3,7];case "enum":return[3,9]}return[3,11];case 1:return[4,Q(a,b,c)];case 2:return e.sent(),[3,12];case 3:return[4,R(a,b,c)];case 4:return e.sent(),[3,12];case 5:return[4,I(a,b,c)];case 6:return e.sent(),[3,12];case 7:return[4,S(a,b,c)];case 8:return e.sent(),[3,12];case 9:return[4,T(a,b,c)];case 10:return e.sent(),[3,12];case 11:w.neverReached(b),e.label=12;case 12:return[2]}})})}function S(a,
b,c){return g(this,void 0,void 0,function(){return f(this,function(d){c.addProperty({name:a,type:r(b),default:b.default});return[2]})})}function U(a){a=a.slice();a.sort();return a}function T(a,b,c){return g(this,void 0,void 0,function(){var d;return f(this,function(e){d=b.values.slice();b.nullable&&d.push(null);c.currentClass&&c.currentClass.typeValue&&"type"===a?c.addProperty({name:a,type:"string",enum:'"'+c.currentClass.typeValue+'"'}):c.addProperty({name:a,type:r(b),enum:U(d).map(function(a){return"string"===
typeof a?'"'+a+'"':""+a}).join("|"),default:b.default});return[2]})})}function Q(a,b,c){return g(this,void 0,void 0,function(){return f(this,function(d){switch(d.label){case 0:return[4,y(a+"[]",b.elementType,c)];case 1:return d.sent(),[2]}})})}function R(a,b,c){return g(this,void 0,void 0,function(){var d,e,n,h,k,l;return f(this,function(p){switch(p.label){case 0:d=[],e=0,n=b.types,p.label=1;case 1:if(!(e<n.length))return[3,5];h=n[e];if("native"!==h.type.typeName&&b.key)return[3,2];d.push(h.type);
return[3,4];case 2:var m=h.type;p=h.value;if("json"===m.typeName){var f=(m=(m=m.type.__accessorMetadata__)&&m.properties&&m.properties&&m.properties.type)&&t(m),g=(f=f&&f.type)||m&&m.type;g&&Array.isArray(g)&&1===g.length&&"string"===typeof g[0]&&(p=f?g[0]:A(m,g[0]))}k=a+"\x3c"+p+"\x3e";return[4,y(k,h.type,c)];case 3:p.sent(),p.label=4;case 4:return e++,[3,1];case 5:return d.length&&(l=d.map(r),b.nullable&&l.push("null"),l.sort(),c.addProperty({type:l.join("|"),name:a,default:b.default})),[2]}})})}
function J(a,b){return g(this,void 0,void 0,function(){return f(this,function(c){return a.type===M&&"layers"===b?[2,v("web-scene/operational-layers")]:a.type!==F||"baseLayers"!==b&&"baseMapLayers"!==b?a.type===F&&"elevationLayers"===b||a.type===L&&"layers"===b?[2,v("web-scene/ground")]:a.type===G&&"layers"===b?[2,v("web-scene/operational-layers",function(a){return a!==G})]:[2,null]:[2,v("web-scene/basemap")]})})}function V(a,b,c){return g(this,void 0,void 0,function(){var d;return f(this,function(e){switch(e.label){case 0:return[4,
J(a,b)];case 1:if(d=e.sent())return[2,d];e=t(c);if(e.types)e=u(e.types);else if(!e.type&&c.types)e=u(c.types);else{e=B;var n=t(c),h=C(c),k=q(n&&n.type||c.type);n&&void 0!==n.default&&"function"!==typeof n.default&&(k.default=A(c,n.default));h.allowNull&&(k.nullable=!0);e=e(k)}return[2,e]}})})}function I(a,b,c){return g(this,void 0,void 0,function(){var d,e,n,h,k,l,p,m,g,q,r,t,v,u,x,w;return f(this,function(f){switch(f.label){case 0:d=b.type.__accessorMetadata__;e=b.type.prototype.declaredClass.replace(/\./g,
"/");n=d&&d.properties;if(!n)return a&&c.addProperty({name:a,type:"unknown"}),[2,null];h=e;k=null;if(l=a&&a.match(/<([^>]+)>$/))h+="--"+l[1],k=l[1];if((p=c.seen.get(h))&&a)return c.addProperty({name:a,type:p}),[2,p];m={type:b.type,name:e,id:h,properties:[]};a&&(c.addProperty({name:a,type:m}),m.typeValue=k);c.push(a,m);g=[];for(q in n)g.push(q);r=0;f.label=1;case 1:if(!(r<g.length))return[3,7];t=g[r];v=n[t];u=C(v);if(!u||!u.enabled)return[3,6];x=u.target;return"string"!==typeof x&&null!=x?[3,4]:[4,
V(b,t,v)];case 2:return(w=f.sent())?[4,y("string"===typeof x?x:t,w,c)]:[3,6];case 3:return f.sent(),[3,6];case 4:return[4,W(b,x,c)];case 5:f.sent(),f.label=6;case 6:return r++,[3,1];case 7:return[2,c.pop()]}})})}function W(a,b,c){return g(this,void 0,void 0,function(){var d,e,g,h,k,l;return f(this,function(f){switch(f.label){case 0:d=[];for(e in b)d.push(e);g=0;f.label=1;case 1:if(!(g<d.length))return[3,5];h=d[g];return[4,J(a,h)];case 2:return k=f.sent(),k||(l=b[h],k=l.types?u(l.types):q(l.type),
k.default=l.default,k=B(k)),[4,y(h,k,c)];case 3:f.sent(),f.label=4;case 4:return g++,[3,1];case 5:return[2]}})})}function v(a,b){return g(this,void 0,void 0,function(){var c,d,e,g,h,k,l,p;return f(this,function(f){switch(f.label){case 0:c=H.supportedTypes[a];d={typeName:"union",key:"layerType",types:[]};e=[];for(g in c)e.push(g);h=0;f.label=1;case 1:if(!(h<e.length))return[3,4];k=e[h];return[4,H.typeModuleMap[k]()];case 2:l=f.sent();if(!l||b&&!b(l)||l===O)return[3,3];d.types.push({type:{typeName:"json",
type:l},value:k});f.label=3;case 3:return h++,[3,1];case 4:if(0===d.types.length)return[2,null];p={typeName:"array",elementType:1===d.types.length?d.types[0].type:d};return[2,p]}})})}function r(a){switch(a.typeName){case "array":return r(a.elementType)+"[]";case "union":var b=a.types.map(function(a){return r(a.type)});a.nullable&&b.push("null");b.sort();return""+b.join(" | ");case "native":switch(a.type){case Number:return"number";case z.Integer:return"integer";case String:return"string";case Boolean:return"boolean";
case Object:return"object";default:return"unknown"}case "json":return a.type.prototype.declaredClass;case "enum":return"string";default:w.neverReached(a)}}function X(a){a=a.prototype.itemType&&a.prototype.itemType.Type;if(!a)return{typeName:"array",elementType:{typeName:"native",type:null}};if("function"===typeof a)return{typeName:"array",elementType:q(a)};if(a.typeMap){var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:q(d),value:D(d)?null:c})}return{typeName:"array",elementType:{typeName:"union",
key:"string"===typeof a.key?a.key:"type",types:b}}}}function Y(a){if("json"!==a.typeName)return null;var b=(a=a.type.__accessorMetadata__)&&a.properties&&a.properties.type,c=(a=(a=b&&t(b))&&a.type)||b&&b.type;return c&&Array.isArray(c)&&"string"===typeof c[0]?a?a:b.type.map(function(a){return A(b,a)}):null}function B(a){if("array"===a.typeName)return a.elementType=B(a.elementType),a;var b=Y(a);return b?{typeName:"union",key:"type",types:b.map(function(b){return{value:b,type:a}})}:a}function u(a){if(Array.isArray(a))return{typeName:"array",
elementType:u(a[0])};var b=[],c;for(c in a.typeMap){var d=a.typeMap[c];b.push({type:q(d),value:D(d)?null:c})}return{typeName:"union",key:"string"===typeof a.key?a.key:"type",types:b}}function A(a,b){a=C(a);var c=a.writer;return null!=c&&c.name&&-1!==c.name.indexOf("JSONMapWrite")?(c={value:""},a.writer(b,c,"value"),c.value):b}function q(a){return a?z.isLongFormType(a)?K(a):Array.isArray(a)?"string"===typeof a[0]||"number"===typeof a[0]?{typeName:"enum",values:a}:1<a.length?{typeName:"union",key:null,
types:a.map(function(a){return{type:q(a),value:null}})}:{typeName:"array",elementType:q(a[0])}:N.isCollection(a)?X(a):D(a)?{typeName:"native",type:a}:Z(a)?{typeName:"json",type:a}:{typeName:"native",type:null}:{typeName:"native",type:null}}function K(a){switch(a.type){case "native":return{typeName:"native",type:a.value};case "array":return{typeName:"array",elementType:q(a.value)};case "one-of":return{typeName:"union",key:null,types:a.values.map(function(a){return{type:K(a),value:null}})};default:w.neverReached(a)}}
function Z(a){return(a=a._meta&&a._meta.bases)?a.some(function(a){return a&&a.prototype&&("esri.core.JSONSupport"===a.prototype.declaredClass||"esri.core.MultiOriginJSONSupport"===a.prototype.declaredClass)}):!1}function D(a){return a===String||a===Boolean||a===Number||a===z.Integer||a===Object}function t(a){if(!a.json)return null;var b=a.json.origins;a=a.json;var c=b&&b["web-document"];return b&&b["web-scene"]||c||a||null}function C(a){if(!a.json)return null;var b=a.json.origins;a=a.json.write;var c=
b&&b["web-document"]&&b["web-document"].write;return b&&b["web-scene"]&&b["web-scene"].write||c||a||null}Object.defineProperty(E,"__esModule",{value:!0});E.scan=function(a){return g(this,void 0,void 0,function(){var b;return f(this,function(c){b=new P.ScanContext;return[2,I(null,{typeName:"json",type:a},b)]})})}});