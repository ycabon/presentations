// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/Evented ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../LayerList/ListItem".split(" "),function(u,v,p,e,q,r,t,h,f,l){var k=q.ofType(l);return function(m){function b(a){a=m.call(this,a)||this;a.baseItems=new k;a.basemapTitle=null;a.baseListItemCreatedFunction=null;a.referenceListItemCreatedFunction=null;a.referenceItems=new k;a.view=
null;a._compileBaseList=a._compileBaseList.bind(a);a._compileReferenceList=a._compileReferenceList.bind(a);return a}p(b,m);b.prototype.initialize=function(){var a=this;this.handles.add(h.init(this,["view.map.basemap","view","view.ready","view.basemapView"],function(){return a._watchBasemapLayers()}),"view")};b.prototype.destroy=function(){this.view=null;this.baseItems.removeAll();this.referenceItems.removeAll()};Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?
"ready":this.get("view")?"loading":"disabled"},enumerable:!0,configurable:!0});b.prototype.triggerAction=function(a,c){a&&this.emit("trigger-action",{action:a,item:c})};b.prototype.transferListItem=function(a){var c=a.listItem,d=a.from,g=a.to;a=a.newIndex;var b=this.referenceItems,f=this.baseItems,n=c.layer,e=this.get("view.map.basemap.baseLayers"),h=this.get("view.map.basemap.referenceLayers");if(e&&h&&d!==g){var k="reference"===g?b:f,l="reference"===d?h:e,g="reference"===g?h:e;("reference"===d?
b:f).remove(c);l.remove(n);k.add(c,a);g.add(n,a)}};b.prototype._createItemChangeHandles=function(a){var c=a.items,d=a.key,g=a.callback;a=this.handles;a.remove(d);g();c&&a.add(c.on("change",function(){return g()}),d)};b.prototype._watchItemProperties=function(a){var c=this,d=a.item,g=a.type;this.handles.add([d.children.on("change",function(){c._modifyListItemChildren({type:g,childItems:d.children})})],"children-change-"+d.uid)};b.prototype._modifyListItemChildren=function(a){var c=this,d=a.type;a.childItems.forEach(function(a){return c._modifyListItem({type:d,
item:a})})};b.prototype._modifyListItem=function(a){var c=a.item;a=a.type;var d={item:c};"base"===a&&"function"===typeof this.baseListItemCreatedFunction&&this.baseListItemCreatedFunction.call(null,d);"reference"===a&&"function"===typeof this.referenceListItemCreatedFunction&&this.referenceListItemCreatedFunction.call(null,d);this._modifyListItemChildren({type:a,childItems:c.children})};b.prototype._createListItem=function(a){var c=a.type;a=new l({layer:a.layer,view:this.view});this._watchItemProperties({type:c,
item:a});return a};b.prototype._watchLayersListMode=function(a){var c=a.layers,d=a.key,b=a.callback,e=this.handles;e.remove(d);c&&c.forEach(function(a){e.add(h.watch(a,"listMode",function(){return b()}),d)})};b.prototype._compileListItems=function(a){var c=a.layers,d=a.items,b=a.type;this._watchLayersListMode({layers:c,key:a.key,callback:a.callback});this._createNewItems({type:b,items:d,layers:c});this._modifyOrRemoveItems({type:b,items:d,layers:c});this._sortItems(d,c)};b.prototype._compileReferenceList=
function(){var a=this.referenceItems,c=this.get("view.map.basemap.referenceLayers");this._compileListItems({type:"reference",layers:c,items:a,key:"base-layers-list-mode",callback:this._compileReferenceList})};b.prototype._compileBaseList=function(){var a=this.baseItems,c=this.get("view.map.basemap.baseLayers");this._compileListItems({type:"base",layers:c,items:a,key:"reference-layers-list-mode",callback:this._compileBaseList})};b.prototype._compileLists=function(){this._compileReferenceList();this._compileBaseList()};
b.prototype._createNewItems=function(a){var c=this,b=a.items,g=a.layers,e=a.type;g&&g.forEach(function(a){b.find(function(b){return b.layer===a})||b.add(c._createListItem({type:e,layer:a}))})};b.prototype._modifyOrRemoveItems=function(a){var b=this,d=a.items,g=a.layers,e=a.type,f=this.handles;d&&d.forEach(function(a){a&&(g.find(function(b){return a.layer===b})?b._modifyListItem({type:e,item:a}):(f.remove("children-change-"+a.uid),d.remove(a)))})};b.prototype._sortItems=function(a,b){a&&a.sort(function(a,
c){a=b.indexOf(a.layer);c=b.indexOf(c.layer);return a>c?-1:a<c?1:0})};b.prototype._watchBasemapLayers=function(){var a=this,b=this.handles,d=this.view;b.remove(["base-layers","reference-layers","basemap","base-layer-views","reference-layer-views"]);this._compileLists();d&&d.ready&&b.add([h.init(this,"view.map.basemap.baseLayers",function(b){return a._createItemChangeHandles({items:b,key:"base-layers",callback:a._compileBaseList})}),h.init(this,"view.map.basemap.referenceLayers",function(b){return a._createItemChangeHandles({items:b,
key:"reference-layers",callback:a._compileReferenceList})}),h.init(this,"view.basemapView.baseLayerViews",function(b){return a._createItemChangeHandles({items:b,key:"base-layer-views",callback:a._compileBaseList})}),h.init(this,"view.basemapView.referenceLayerViews",function(b){return a._createItemChangeHandles({items:b,key:"reference-layer-views",callback:a._compileReferenceList})}),h.init(this,"baseListItemCreatedFunction",function(){return a._compileBaseList()}),h.init(this,"referenceListItemCreatedFunction",
function(){return a._compileReferenceList()})],"basemap")};e([f.property({type:k})],b.prototype,"baseItems",void 0);e([f.aliasOf("view.map.basemap.title")],b.prototype,"basemapTitle",void 0);e([f.property()],b.prototype,"baseListItemCreatedFunction",void 0);e([f.property()],b.prototype,"referenceListItemCreatedFunction",void 0);e([f.property({type:k})],b.prototype,"referenceItems",void 0);e([f.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);e([f.property()],b.prototype,
"view",void 0);e([f.property()],b.prototype,"transferListItem",null);return b=e([f.subclass("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],b)}(f.declared(t.HandleOwnerMixin(r.EventedAccessor)))});