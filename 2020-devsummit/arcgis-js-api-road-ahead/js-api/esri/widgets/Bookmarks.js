// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/i18n!../nls/common dojo/i18n!./Bookmarks/nls/Bookmarks ../core/events ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../libs/sortablejs/Sortable ./Widget ./Bookmarks/BookmarksViewModel ./support/widget".split(" "),function(y,z,r,e,m,h,g,t,u,l,d,v,w,n,c){var p={addBookmark:!0,thumbnail:!0};return function(q){function b(a){a=q.call(this,a)||this;
a._handles=new u;a._addInputNode=null;a._editInputNode=null;a._addBookmarkButtonNode=null;a._focusAddBookmarkButton=!1;a._focusEditInputBox=!1;a._focusAddInputBox=!1;a._addBookmark=!1;a._editBookmark=null;a._invalidEntry=!1;a._creatingBookmark=!1;a._sortable=null;a._sortableNode=null;a._focusSortUid=null;a._selectedSortUid=null;a._sortableSavedItems=null;a.bookmarkCreationOptions=null;a.bookmarks=null;a.disabled=!1;a.editingEnabled=!1;a.goToOverride=null;a.iconClass="esri-icon-bookmark";a.label=g.widgetLabel;
a.view=null;a.viewModel=new n;a.visibleElements=m({},p);return a}r(b,q);b.prototype.postInitialize=function(){var a=this;this.own([l.init(this,"viewModel.bookmarks",function(){return a._bookmarksInitialized()}),l.init(this,"editingEnabled",function(){return a._toggleSorting()})])};b.prototype.destroy=function(){this._destroySortable();this._handles.destroy();this._handles=null};b.prototype.castVisibleElements=function(a){return m({},p,a)};b.prototype.endAddBookmark=function(){this._creatingBookmark=
this._addBookmark=this._invalidEntry=!1;this.scheduleRender()};b.prototype.goTo=function(a){return this.viewModel.goTo(a)};b.prototype.render=function(){var a,f="loading"===this.viewModel.state?this._renderLoading():this._renderBookmarks();return c.tsx("div",{class:this.classes("esri-bookmarks esri-widget--panel","esri-widget",(a={},a["esri-widget--disabled"]=this.disabled,a))},f)};b.prototype.startAddBookmark=function(){this._editBookmark=null;this._focusAddInputBox=this._addBookmark=!0;this.scheduleRender()};
b.prototype._renderLoading=function(){return c.tsx("div",{class:"esri-bookmarks__loader-container",key:"loader"},c.tsx("div",{class:"esri-bookmarks__loader"}))};b.prototype._renderNoBookmarksContainer=function(){return c.tsx("div",{class:"esri-widget__content--empty",key:"no-bookmarks"},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-widget__no-bookmark-icon","esri-icon-bookmark")}),c.tsx("h1",{class:this.classes("esri-widget__heading","esri-bookmarks__no-bookmarks-heading")},g.noBookmarksHeading),
c.tsx("p",{class:"esri-bookmarks__no-bookmarks-description"},g.noBookmarksDescription))};b.prototype._renderAddBookmarkLoading=function(){return c.tsx("div",{key:"adding-bookmark",class:"esri-bookmarks__adding-bookmark"},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-loading-indicator","esri-rotating")}),g.addingBookmark)};b.prototype._renderBookmarkItems=function(a){var f=this;return a?a.map(function(a){return f.editingEnabled&&f._editBookmark&&a&&f._editBookmark===a?f._renderEditingBookmark(a):
f._renderBookmark(a)}).toArray():null};b.prototype._renderBookmarksContainer=function(a){var f,b=this.editingEnabled&&!this._addBookmark?this._renderAddBookmarkButton():null,x=this.editingEnabled?this._creatingBookmark?this._renderAddBookmarkLoading():this._addBookmark?this._renderAddingBookmark():null:null;return[c.tsx("ul",{key:"bookmark-list","aria-label":g.widgetLabel,class:this.classes("esri-bookmarks__list",(f={},f["esri-bookmarks__list--sortable"]=this.editingEnabled,f)),afterCreate:this._sortNodeCreated,
afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this},this._renderBookmarkItems(a)),b,x]};b.prototype._dragHandleBlur=function(){this._selectedSortUid=null;this.scheduleRender()};b.prototype._dragHandleKeydown=function(a){a.stopPropagation();var f=this._sortableSavedItems,b=t.eventKey(a);if(-1!=="ArrowDown;ArrowUp;Escape;Tab; ;Enter".split(";").indexOf(b)){var c=this._sortable,k=this._selectedSortUid,d=c.toArray();a=a.target.getAttribute("data-bookmark-uid");var e=d.indexOf(a);
" "===b||"Enter"===b?(this._selectedSortUid=(c=k&&k===a)?null:a,this._sortableSavedItems=c?null:this._sortable.toArray(),this.scheduleRender()):"Tab"===b?(this._selectedSortUid=null,this.scheduleRender()):"Escape"===b&&f?(this._selectedSortUid=null,this._updateSortItems(f,c,a),this.scheduleRender()):-1!==e&&k&&(f="ArrowUp"===b?e-1:e+1,f>=d.length||-1>=f||(d.splice(f,0,d.splice(e,1)[0]),this._updateSortItems(d,c,a)))}};b.prototype._updateSortItems=function(a,f,b){f.sort(a);this._sortBookmarks(f);this._selectedSortUid=
this._focusSortUid=b};b.prototype._focusDragHandle=function(a){var b=this._focusSortUid;a&&b&&a.getAttribute("data-bookmark-uid")===b&&(a.focus(),this._focusSortUid=null)};b.prototype._toggleSorting=function(){var a=this,b=this._sortable,c=this._sortableNode,d=this.editingEnabled;if(c)if(b)b.option("disabled",!d);else{var e=v.create(c,{dataIdAttr:"data-bookmark-uid",handle:".esri-bookmarks_bookmark-drag-handle",group:"bookmarks",disabled:!d,onSort:function(){return a._sortBookmarks(e)}});this._sortable=
e}};b.prototype._sortNodeCreated=function(a){this._sortableNode=a;this._toggleSorting()};b.prototype._sortBookmarks=function(a){var b=this.viewModel.bookmarks;if(b){var c=a.toArray();b.sort(function(a,b){a=c.indexOf(a.uid);b=c.indexOf(b.uid);return a>b?1:a<b?-1:0})}};b.prototype._renderAddBookmarkButton=function(){return this.visibleElements.addBookmark?c.tsx("div",{key:"add-bookmark-item",class:"esri-bookmarks__add-bookmark"},c.tsx("button",{class:this.classes("esri-button","esri-button--tertiary",
"esri-bookmarks__add-bookmark-button"),onclick:this.startAddBookmark,afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,"data-node-ref":"_addBookmarkButtonNode",bind:this},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-bookmarks__add-bookmark-icon","esri-icon-plus")}),g.addBookmark)):null};b.prototype._renderBookmarks=function(){var a=this.viewModel.bookmarks,b=a&&a.filter(Boolean),b=(a=b&&b.length)||this.editingEnabled?this._renderBookmarksContainer(b):
null;return[a?null:this._renderNoBookmarksContainer(),b]};b.prototype._renderBookmark=function(a){var b,d,e=this.viewModel.activeBookmark,k=a.thumbnail,g=a.name||h.untitled,e=(b={},b["esri-bookmarks__bookmark--active"]=e===a,b);b=k&&k.url||"";b=this.visibleElements.thumbnail&&b?c.tsx("img",{src:b,alt:"",class:"esri-bookmarks__image"}):c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-bookmarks__bookmark-icon","esri-icon-bookmark")});b=c.tsx("div",{class:"esri-bookmarks__bookmark-image-container"},
b);var k=this.editingEnabled?c.tsx("div",{key:"edit-container"},c.tsx("button",{title:h.edit,"aria-label":h.edit,"data-bookmark":a,onclick:this._showEditBookmarkForm,bind:this,class:"esri-bookmarks__bookmark-edit-button"},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-edit"}))):null,l=(d={},d["data-bookmark-uid"]=a.uid,d);d=this.editingEnabled?c.tsx("div",m({role:"button",tabIndex:0,key:"drag-handle",bind:this,class:"esri-bookmarks_bookmark-drag-handle",onkeydown:this._dragHandleKeydown,afterCreate:this._focusDragHandle,
afterUpdate:this._focusDragHandle,onblur:this._dragHandleBlur,"aria-pressed":this._selectedSortUid===a.uid?"true":"false","aria-label":h.dragHandleLabel,title:h.dragHandleTitle},l),c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-bookmarks_bookmark-drag-handle-icon","esri-icon-handle-vertical")})):null;return c.tsx("li",m({key:a,class:this.classes("esri-bookmarks__bookmark",e)},l),d,c.tsx("button",{key:"bookmark-button",class:"esri-bookmarks__bookmark-button",bind:this,"data-bookmark":a,
onclick:this._goToBookmark},b,c.tsx("span",{class:"esri-bookmarks__bookmark-name"},g)),k)};b.prototype._renderEditingBookmark=function(a){var b,d=(b={},b["data-bookmark-uid"]=a.uid,b);return c.tsx("li",m({key:"edit-bookmark-form",class:"esri-bookmarks__authoring-card"},d),c.tsx("form",{class:"esri-bookmarks__authoring-form",onsubmit:this._editBookmarkSubmit,bind:this},c.tsx("label",{class:"esri-bookmarks__authoring-label"},g.title,c.tsx("input",{required:!0,bind:this,class:this.classes("esri-input",
this._invalidEntry?"esri-bookmarks__authoring-input--invalid":null),type:"text",value:a.name,afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,"data-bookmark":a,"data-node-ref":"_editInputNode",placeholder:g.addPlaceholder})),c.tsx("div",{class:"esri-bookmarks__authoring-actions"},c.tsx("input",{type:"button",value:h.delete,class:this.classes("esri-button","esri-button--tertiary","esri-bookmarks__authoring-delete-button"),"data-bookmark":a,onclick:this._deleteBookmark,bind:this}),
c.tsx("input",{type:"button",value:h.cancel,class:this.classes("esri-button","esri-button--tertiary"),onclick:this._closeEditBookmarkForm,bind:this}),c.tsx("input",{class:"esri-button",type:"submit",value:h.save}))))};b.prototype._renderAddingBookmark=function(){return c.tsx("div",{key:"add-bookmark-form",class:"esri-bookmarks__authoring-card"},c.tsx("form",{class:"esri-bookmarks__authoring-form",onsubmit:this._addBookmarkSubmit,bind:this},c.tsx("label",{class:"esri-bookmarks__authoring-label"},g.title,
c.tsx("input",{required:!0,bind:this,class:this.classes("esri-input",this._invalidEntry?"esri-bookmarks__authoring-input--invalid":null),type:"text",afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,"data-node-ref":"_addInputNode",value:"",placeholder:g.addPlaceholder})),c.tsx("div",{class:this.classes("esri-bookmarks__authoring-actions")},c.tsx("input",{type:"button",value:h.cancel,class:this.classes("esri-button","esri-button--tertiary","esri-bookmarks__authoring-cancel-button"),onclick:this._endAddBookmark.bind(this),
bind:this}),c.tsx("input",{class:"esri-button",type:"submit",value:h.add}))))};b.prototype._destroySortable=function(){var a=this._sortable;a&&a.destroy();this._sortable=null};b.prototype._endAddBookmark=function(){this._focusAddBookmarkButton=!0;this.endAddBookmark()};b.prototype._bookmarksInitialized=function(){var a=this,b=this._handles;b.remove("bookmarks-init");b.add(l.on(this,"viewModel.bookmarks","change",function(){return a._bookmarksChanged()}),"bookmarks-init")};b.prototype._bookmarksChanged=
function(){var a=this,b=this.viewModel.bookmarks,c=this._handles;c.remove("bookmarks-change");b=b.map(function(b){return l.watch(b,["active","name","thumbnail.url"],function(){return a.scheduleRender()})});c.add(b,"bookmarks-change");this.scheduleRender()};b.prototype._showEditBookmarkForm=function(a){a=a.currentTarget["data-bookmark"];this._addBookmark=!1;this._focusEditInputBox=!0;this._editBookmark=a;this.scheduleRender()};b.prototype._closeEditBookmarkForm=function(){this._invalidEntry=!1;this._editBookmark=
null;this.scheduleRender()};b.prototype._addBookmarkSubmit=function(a){var b=this;a.preventDefault();a=this._addInputNode;var c=this.bookmarkCreationOptions,d=a&&a.value.trim();d?(this._creatingBookmark=!0,this.scheduleRender(),this.viewModel.createBookmark(c).then(function(a){a.name=d;b.viewModel.bookmarks.add(a);b._endAddBookmark()})):(this._invalidEntry=!0,this.scheduleRender())};b.prototype._editBookmarkSubmit=function(a){a.preventDefault();var b=this._editInputNode;a=this._editBookmark;(b=b&&
b.value.trim())?(a.name=b,this._closeEditBookmarkForm()):(this._invalidEntry=!0,this.scheduleRender())};b.prototype._storeAddBookmarkButton=function(a){this._addBookmarkButtonNode=a;this._focusAddBookmark()};b.prototype._storeEditInput=function(a){this._editInputNode=a;this._focusEditInput()};b.prototype._storeAddInput=function(a){this._addInputNode=a;this._focusAddInput()};b.prototype._focusAddInput=function(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())};
b.prototype._focusAddBookmark=function(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())};b.prototype._focusEditInput=function(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())};b.prototype._deleteBookmark=function(a){this.viewModel.bookmarks.remove(a.currentTarget["data-bookmark"])};b.prototype._goToBookmark=function(a){a=a.currentTarget["data-bookmark"];this.endAddBookmark();
this._closeEditBookmarkForm();this.viewModel.goTo(a)};e([d.property()],b.prototype,"bookmarkCreationOptions",void 0);e([d.aliasOf("viewModel.bookmarks")],b.prototype,"bookmarks",void 0);e([c.renderable(),d.property()],b.prototype,"disabled",void 0);e([c.renderable(),d.property()],b.prototype,"editingEnabled",void 0);e([d.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);e([d.property()],b.prototype,"iconClass",void 0);e([d.property()],b.prototype,"label",void 0);e([d.aliasOf("viewModel.view")],
b.prototype,"view",void 0);e([d.property({type:n}),c.renderable(["activeBookmark","state","bookmarks"]),c.vmEvent(["select-bookmark"])],b.prototype,"viewModel",void 0);e([d.property(),c.renderable()],b.prototype,"visibleElements",void 0);e([d.cast("visibleElements")],b.prototype,"castVisibleElements",null);e([d.property()],b.prototype,"endAddBookmark",null);e([d.property()],b.prototype,"startAddBookmark",null);return b=e([d.subclass("esri.widgets.Bookmarks")],b)}(d.declared(w))});