// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common dojo/i18n!./CoordinateConversion/nls/CoordinateConversion ../core/events ../core/global ../core/Logger ../core/accessorSupport/decorators ./Widget ./CoordinateConversion/CoordinateConversionViewModel ./CoordinateConversion/support/Conversion ./support/widget".split(" "),function(x,y,t,d,l,e,u,m,v,h,w,n,p,c){var q=v.getLogger("esri.widgets.CoordinateConversion");return function(r){function b(a){a=
r.call(this,a)||this;a._popupMessage=null;a._popupId=null;a._coordinateInput=null;a._badInput=!1;a._goToEnabled=!1;a._conversionFormat=null;a._settingsFormat=null;a._previewConversion=null;a._expanded=!1;a._popupVisible=!1;a._settingsVisible=!1;a._inputVisible=!1;a.conversions=null;a.currentLocation=null;a.formats=null;a.goToOverride=null;a.label=e.widgetLabel;a.mode=null;a.orientation="auto";a.requestDelay=null;a.view=null;a.viewModel=new n;return a}t(b,r);Object.defineProperty(b.prototype,"multipleConversions",
{get:function(){var a=this._get("multipleConversions");return"boolean"===typeof a?a:!0},set:function(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",a)},enumerable:!0,configurable:!0});b.prototype.reverseConvert=function(a,k){return this.viewModel.reverseConvert(a,k)};b.prototype.render=function(){var a,k=this.get("viewModel.state"),b="disabled"===k?c.tsx("div",{key:"esri-coordinate__no-basemap"},e.noBasemap):null,g=!b&&this._inputVisible?
this._renderInputForm():null,f=!b&&this._settingsVisible?this._renderSettings():null,d=b||g||f?null:this._renderConversionsView(),h=this._popupVisible?this._renderPopup():null,k=(a={},a["esri-coordinate-conversion--capture-mode"]="capture"===this.mode,a["esri-disabled"]="loading"===k,a["esri-coordinate-conversion--no-basemap"]="disabled"===k,a);return c.tsx("div",{class:this.classes("esri-coordinate-conversion esri-widget",k)},h,b,d,f,g)};b.prototype._addConversion=function(a){a=a.target;var k=a["data-index"],
c=new p({format:a.options[a.options.selectedIndex]["data-format"]});a.options.selectedIndex=0;0<=k&&this.conversions.removeAt(k);this.conversions.add(c,k)};b.prototype._findSettingsFormat=function(){return this._settingsFormat||this.conversions.reduceRight(function(a,c){c=c.format;return c.get("hasDisplayProperties")?c:a},null)||this.formats.find(function(a){return a.hasDisplayProperties})};b.prototype._hidePopup=function(){this._popupId&&(clearTimeout(this._popupId),this._popupId=null);this._popupVisible=
!1;this._popupMessage=null;this.scheduleRender()};b.prototype._onConvertComplete=function(){this._inputVisible=!1;this._coordinateInput.value=""};b.prototype._onCopy=function(a){var c=a.currentTarget["data-conversion"].displayCoordinate;"clipboardData"in m?m.clipboardData.setData("text",c):a.clipboardData.setData("text/plain",c);this._showPopup(e.copySuccessMessage);a.preventDefault()};b.prototype._processUserInput=function(a){var c=this;a=u.eventKey(a);var b=this.viewModel;"Enter"!==a&&a?this._badInput&&
(this._badInput=!1):this._reverseConvert(this._coordinateInput.value,this._coordinateInput["data-format"]).then(function(a){"capture"===c.mode?b.resume():c.mode="capture";c.currentLocation=a;b.setLocation(a);c._onConvertComplete()}).catch(function(a){q.error(a);c._showPopup(e.invalidCoordinate);c._badInput=!0})};b.prototype._reverseConvert=function(a,c){var b=this,k=this.viewModel;return c.reverseConvert(a).then(function(a){b._goToEnabled&&k.goToLocation(a).catch(function(a){q.warn(a);b._showPopup(e.locationOffBasemap)});
return a})};b.prototype._setInputFormat=function(a){a=a.target;this._conversionFormat=a[a.options.selectedIndex]["data-format"]};b.prototype._setPreviewConversion=function(){var a=this._findSettingsFormat(),c=this.viewModel;if(a){var b=this.conversions.find(function(c){return c.format===a});this._previewConversion=new p({format:a,position:{location:this.currentLocation,coordinate:b&&b.position.coordinate}});this._previewConversion.position.coordinate||c.previewConversion(this._previewConversion)}};
b.prototype._setSettingsFormat=function(a){a=a.target;this._settingsFormat=a[a.options.selectedIndex]["data-format"];this._setPreviewConversion()};b.prototype._showPopup=function(a,c){var b=this;void 0===c&&(c=2500);this._popupMessage=a;this._popupVisible?clearTimeout(this._popupId):this._popupVisible=!0;this.scheduleRender();this._popupId=setTimeout(function(){b._popupId=null;b._hidePopup()},c)};b.prototype._toggleGoTo=function(){this._goToEnabled=!this._goToEnabled};b.prototype._updateCurrentPattern=
function(a){a.stopPropagation();a=a.target;var c=this._findSettingsFormat();c&&(c.currentPattern=a.value)};b.prototype._renderConversion=function(a,b){var k=this.id+"__list-item-"+b,g=a.format.name+" "+e.conversionOutputSuffix,f=0===b,d=f||this._expanded,h=f?this._renderFirstConversion(a):this._renderTools(b,a,k),f=f&&!a.displayCoordinate?e.noLocation:a.displayCoordinate,f=c.tsx("div",{"aria-label":f,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabindex:"0",title:f},
f),l=this._renderOptions(this.formats.filter(function(c){return c!==a.format}));return d?c.tsx("li",{"aria-label":g,class:"esri-coordinate-conversion__row",id:k,key:a,role:"group",title:g,tabindex:"0"},c.tsx("select",{"aria-controls":k,"aria-label":e.selectFormat,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),bind:this,"data-index":b,onchange:this._addConversion,title:e.selectFormat},c.tsx("option",{"aria-label":a.format.name,selected:!0,title:a.format.name},a.format.name.toUpperCase()),
l),f,h):null};b.prototype._renderCopyButton=function(a){return c.tsx("li",{"aria-label":l.copy,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-conversion":a,onclick:this._copyCoordinateOutput,onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:l.copy},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-duplicate"}))};b.prototype._renderFirstConversion=function(a){var b,d=this.id,g=(b={},b["esri-icon-down"]=!this._expanded,
b["esri-icon-up"]=this._expanded,b);b="live"===this.mode?e.captureMode:e.liveMode;var f=this._expanded?l.collapse:l.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):null;d=this.multipleConversions?c.tsx("li",{"aria-controls":d+"__esri-coordinate-conversion__conversion-list","aria-label":f,bind:this,class:"esri-widget--button",key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabindex:"0",title:f},c.tsx("span",
{"aria-hidden":"true",class:this.classes(g)})):c.tsx("li",{"aria-label":b,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:b},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"}));return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},a,d)};b.prototype._renderInputForm=function(){var a,b=this._conversionFormat||
this.conversions.getItemAt(0).format,d=this.formats.findIndex(function(a){return a.name===b.name}),g=this.id,f=g+"__esri-coordinate-conversion__input-coordinate",g=g+"__esri-coordinate-conversion__input-coordinate__header",d=this._renderOptions(this.formats,!0,d),h=(a={},a["esri-coordinate-conversion__input-coordinate--rejected"]=this._badInput,a);return c.tsx("div",{"aria-labelledby":g,class:"esri-coordinate-conversion__input-form",key:"esri-coordinate-conversion__input-form",role:"search"},c.tsx("div",
{class:"esri-coordinate-conversion__heading"},c.tsx("div",{"aria-label":l.back,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:l.back},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-left-arrow"})),c.tsx("h4",{class:"esri-widget__heading",id:g},e.inputCoordTitle)),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},c.tsx("select",{"aria-controls":f,
"aria-label":e.selectFormat,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),onchange:this._setInputFormat,title:e.selectFormat},d),c.tsx("input",{afterCreate:c.storeNode,"aria-labelledby":g,"aria-required":"true",bind:this,class:this.classes("esri-coordinate-conversion__input-coordinate","esri-input",h),"data-format":b,"data-node-ref":"_coordinateInput",id:f,onkeydown:this._processUserInput,placeholder:e.inputCoordTitle,role:"textbox",spellcheck:!1,title:e.inputCoordTitle,
type:"text"})),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},c.tsx("label",{"aria-label":e.goTo},c.tsx("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:e.goTo,type:"checkbox"}),e.goTo),c.tsx("button",{"aria-label":e.convert,bind:this,class:this.classes("esri-coordinate-conversion__button","esri-button"),onclick:this._processUserInput,title:e.convert,type:"button"},e.convert)))};b.prototype._renderConversionsView=function(){var a=this,b,d=this.id+"__esri-coordinate-conversion__conversion-list",
g=this._renderPrimaryTools(),f=this._renderOptions(this.formats),h=this.conversions.map(function(c,b){return a._renderConversion(c,b)}).toArray(),g=this._expanded?c.tsx("div",{class:"esri-coordinate-conversion__row"},c.tsx("select",{"aria-controls":d,"aria-label":e.addConversion,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-primary"),onchange:this._addConversion,title:e.addConversion},c.tsx("option",{disabled:!0,selected:!0,value:""},e.addConversion),f),g):null,f=
(b={},b["esri-coordinate-conversion__conversions-view--expanded"]=this._expanded,b["esri-coordinate-conversion__conversions-view--expand-up"]="expand-up"===this.orientation,b["esri-coordinate-conversion__conversions-view--expand-down"]="expand-down"===this.orientation,b);return c.tsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",f),key:"esri-coordinate-conversion__main-view"},c.tsx("ul",{"aria-expanded":this._expanded?"true":"false",class:"esri-coordinate-conversion__conversion-list",
id:d},h),g)};b.prototype._renderOptions=function(a,b,e){var d=this,f=this.conversions.getItemAt(0);return a.map(function(a,k){var g=b||!f?!1:f.format.name===a.name||d.conversions.map(function(a){return a.format.name}).includes(a.name);return c.tsx("option",{"aria-label":a.name,"data-format":a,disabled:g,key:a.name,selected:k===e,value:a.name},a.name.toUpperCase())}).toArray()};b.prototype._renderPopup=function(){return c.tsx("div",{class:"esri-coordinate-conversion__popup",role:"alert"},this._popupMessage)};
b.prototype._renderPrimaryTools=function(){var a="live"===this.mode?e.captureMode:e.liveMode;return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},c.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:e.inputCoordTitle},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-edit"})),c.tsx("li",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),onclick:this._toggleMode,
onkeydown:this._toggleMode,role:"button",tabindex:"0",title:a},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"})),c.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:e.settingsTitle},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-settings2"})))};b.prototype._renderSettings=function(){var a=this.id,b=a+"__esri-coordinate-conversion__pattern-input",d=a+"__esri-coordinate-conversion__pattern-input__header",
a=a+"__esri-coordinate-conversion__preview-coordinate",g=this.formats.filter(function(a){return a.hasDisplayProperties}),f=this._findSettingsFormat(),h=g.indexOf(f),g=this._renderOptions(g,!0,h),f=f.get("currentPattern");return c.tsx("div",{"aria-labelledby":d,class:"esri-coordinate__settings",key:"esri-coordinate-conversion__settings"},c.tsx("div",{class:"esri-coordinate-conversion__heading"},c.tsx("div",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),
onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:l.back},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-left-arrow"})),c.tsx("h4",{class:"esri-widget__heading",id:d},e.settingsTitle)),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},c.tsx("label",{for:b},e.changeCoordinateDisplay),c.tsx("select",{"aria-label":e.selectFormat,class:"esri-select",bind:this,onchange:this._setSettingsFormat,title:e.selectFormat},g),c.tsx("div",
{class:"esri-coordinate-conversion__settings-group-horizontal"},c.tsx("input",{"aria-controls":a,bind:this,class:this.classes("esri-coordinate-conversion__pattern-input","esri-input"),id:b,oninput:this._updateCurrentPattern,spellcheck:!1,title:e.changeCoordinateDisplay,type:"text",value:f}),c.tsx("div",{"aria-controls":b,bind:this,class:"esri-widget--button",onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabindex:"0",title:e.defaultPattern},c.tsx("span",{"aria-hidden":"true",
class:"esri-icon-refresh"})))),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},c.tsx("label",null,l.preview,c.tsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabindex:"0"},this._previewConversion.displayCoordinate))))};b.prototype._renderTools=function(a,b,d){b=b.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(b):null;return c.tsx("ul",{class:"esri-coordinate-conversion__tools",role:"listitem"},b,c.tsx("li",{"aria-controls":d,"aria-label":e.removeConversion,
bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-index":a,key:d+"__esri-widget--button",onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",title:e.removeConversion},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})))};b.prototype._copyCoordinateOutput=function(a){a=a.target;if(!("createTextRange"in document.body)){var b=window.getSelection(),c=document.createRange();c.selectNodeContents(a);b.removeAllRanges();
b.addRange(c)}document.execCommand("copy")};b.prototype._removeConversion=function(a){this.conversions.removeAt(a.currentTarget["data-index"])};b.prototype._setDefaultPattern=function(a){a.stopPropagation();if(a=this._findSettingsFormat())a.currentPattern=a.get("defaultPattern")};b.prototype._toggleExpand=function(){this._expanded=!this._expanded};b.prototype._toggleInputVisibility=function(){this._inputVisible=!this._inputVisible;this._popupVisible&&this._hidePopup();this._inputVisible?this.viewModel.pause():
this.viewModel.resume()};b.prototype._toggleMode=function(){this.mode="live"===this.mode?"capture":"live"};b.prototype._toggleSettingsVisibility=function(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()};d([h.aliasOf("viewModel.conversions")],b.prototype,"conversions",void 0);d([h.aliasOf("viewModel.currentLocation"),c.renderable()],b.prototype,"currentLocation",
void 0);d([h.aliasOf("viewModel.formats"),c.renderable()],b.prototype,"formats",void 0);d([h.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);d([h.property()],b.prototype,"label",void 0);d([h.aliasOf("viewModel.mode"),c.renderable()],b.prototype,"mode",void 0);d([h.property(),c.renderable()],b.prototype,"orientation",void 0);d([h.aliasOf("viewModel.requestDelay")],b.prototype,"requestDelay",void 0);d([h.property(),c.renderable()],b.prototype,"multipleConversions",null);d([h.aliasOf("viewModel.locationSymbol")],
b.prototype,"locationSymbol",void 0);d([h.aliasOf("viewModel.view"),c.renderable()],b.prototype,"view",void 0);d([h.property({type:n}),c.renderable(["viewModel.state","viewModel.waitingForConversions"])],b.prototype,"viewModel",void 0);d([c.accessibleHandler()],b.prototype,"_copyCoordinateOutput",null);d([c.accessibleHandler()],b.prototype,"_removeConversion",null);d([c.accessibleHandler()],b.prototype,"_setDefaultPattern",null);d([c.accessibleHandler()],b.prototype,"_toggleExpand",null);d([c.accessibleHandler()],
b.prototype,"_toggleInputVisibility",null);d([c.accessibleHandler()],b.prototype,"_toggleMode",null);d([c.accessibleHandler()],b.prototype,"_toggleSettingsVisibility",null);return b=d([h.subclass("esri.widgets.CoordinateConversion")],b)}(h.declared(w))});