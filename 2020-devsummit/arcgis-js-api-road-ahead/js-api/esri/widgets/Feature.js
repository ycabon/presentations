// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/throttle":function(){define(["require","exports"],function(A,p){function f(c,f,p,r){var l=null,n=1E3;"number"===typeof f?(n=f,r=p):(l=f,n=p);var z=0,w,x=function(){z=0;c.apply(r,w)};f=function(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];l&&l.apply(r,c);w=c;n?z||(z=setTimeout(x,n)):x()};f.remove=function(){z&&(clearTimeout(z),z=0)};f.forceUpdate=function(){z&&(clearTimeout(z),x())};f.hasPendingUpdates=function(){return!!z};return f}Object.defineProperty(p,
"__esModule",{value:!0});p.throttle=f;p.default=f})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Graphic ../../intl ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/string ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(A,p,f,c,w,C,r,l,n,z,G,x,u,v,E,F,J,m,d,k,y,D,h,a,b,t,g,B){function O(){return r(this,void 0,void 0,function(){return C(this,function(a){return[2,v.create(function(a){A(["../../support/arcadeUtils"],function(e){a(e)})})]})})}function H(a){var b=/(\n)/gi;return"string"===typeof a?a.replace(b,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function K(a,b){return a&&"function"===typeof a.getField?a.getField(b):null}function L(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+
a.charCodeAt(0)+";"})}var P=["$datastore","$map","$layer"],I=u.getLogger("esri.widgets.FeatureViewModel"),N=/^\s*expression\//i,M=d.convertDateFormatToIntlOptions("short-date-short-time");return function(d){function g(a){var e=d.call(this,a)||this;e._handles=new G;e._featureAbortController=null;e._graphicChangedThrottled=F.throttle(e._graphicChanged,1,e);e._effectivePopupTemplate=null;e._contentResponse=null;e._graphic=null;e._fieldInfoMap=null;e.content=null;e.defaultPopupTemplateEnabled=!1;e.formattedAttributes=
null;e.graphic=null;e.lastEditInfo=null;e.title="";e.view=null;e._handles.add(J.init(e,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.expressionInfos graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.sourceLayer.popupTemplate.outFields graphic.sourceLayer.popupTemplate.relatedRecordsInfo graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.expressionInfos graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.outFields graphic.popupTemplate.relatedRecordsInfo".split(" "),
function(){return e._graphicChangedThrottled()}));return e}f(g,d);g.prototype.destroy=function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null};Object.defineProperty(g.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(e){void 0===e?this._clearOverride("spatialReference"):this._override("spatialReference",e)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"map",
{get:function(){return this.get("view.map")||null},set:function(e){void 0===e?this._clearOverride("map"):this._override("map",e)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});g.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};g.prototype._graphicChanged=function(){return r(this,void 0,void 0,function(){var e,
a,b,d;return C(this,function(q){switch(q.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=a=(e=this.graphic)?e.clone():null;if(!a)return[2];this._featureAbortController=b=v.createAbortController();q.label=1;case 1:return q.trys.push([1,3,,4]),[4,this._queryFeature({signal:b.signal})];case 2:return q.sent(),[3,4];case 3:return d=q.sent(),I.error("error","error loading template",d),[3,4];case 4:return this._featureAbortController=null,[2]}})})};g.prototype._cancelFeatureQuery=function(){var e=
this._featureAbortController;e&&e.abort();this._featureAbortController=null};g.prototype._compileContent=function(e,a){var q=this;if(e&&(e.nodeName||e&&B.hasDomNode(e)||B.isWidget(e)))return e;if(this._graphic){if("string"===typeof e)return this._compileText(new D({text:e})).text;if(Array.isArray(e))return e.map(function(e,b){b=(b=a&&a[b])&&b.value;if("attachments"===e.type)return q._compileAttachments(e,b);if("fields"===e.type)return q._compileFields(e);if("media"===e.type)return q._compileMedia(e);
if("text"===e.type)return q._compileText(e)});e&&I.warn("invalid content type.")}};g.prototype._compileFields=function(e){var a=this,b=this._effectivePopupTemplate;e=x.clone(e);var d=b&&b.expressionInfos,b=e.fieldInfos?void 0:b&&b.fieldInfos,b=e.fieldInfos||x.clone(b),g=[];b&&b.forEach(function(e){var b=e.fieldName.toLowerCase();if(!e.hasOwnProperty("visible")||e.visible)b=a._isExpressionField(b)?a._getExpressionInfo(d,b):null,e.label=b?b.title:e.label,g.push(e)});e.fieldInfos=g;return e};g.prototype._setImageValue=
function(e){var a=e.value,b=e.formattedAttributes;e=e.layer;var d=a.linkURL,g=a.sourceURL;g&&(g=this._fixTokens(g,e),a.sourceURL=this._substituteAttributes(b,g));d&&(e=this._fixTokens(d,e),a.linkURL=this._substituteAttributes(b,e))};g.prototype._compileMedia=function(e){var a=this,b=this._graphic;e=x.clone(e);var d=e.mediaInfos,g=b.attributes,h=t.getSourceLayer(b),c=this.formattedAttributes.global,k=w({},c,g);e.mediaInfos=d&&d.map(function(e){if(e=x.clone(e)){var b=e.title?a._processFieldsInLinks(e.title,
k):"",q=e.caption?a._processFieldsInLinks(e.caption,k):"";e.title=b?a._substituteAttributes(c,b):"";e.caption=q?a._substituteAttributes(c,q):"";if("image"===e.type)return b=e.value,a._setImageValue({value:b,formattedAttributes:c,layer:h}),e.value.sourceURL?e:void 0;if("pie-chart"===e.type||"line-chart"===e.type||"column-chart"===e.type||"bar-chart"===e.type)return b=e.value,a._setChartValue({value:b,chartType:e.type,attributes:g,formattedAttributes:c,layer:h}),e}}).filter(Boolean);return e};g.prototype._normalizeTemplateFields=
function(e){var a=this._fieldInfoMap.get(e.toLowerCase());return"{"+(a&&a.fieldName||e)+"}"};g.prototype._substituteAttributes=function(e,a){var b=this;return(""+this._removeEmptyHref(n.substitute(E.replace(a,function(e){return b._normalizeTemplateFields(e)}),e))).trim()};g.prototype._compileText=function(e){if((e=x.clone(e))&&e.text){var a=this.formattedAttributes.global,b=this._processFieldsInLinks(e.text,w({},a,this._graphic.attributes));e.text=this._substituteAttributes(a,b)}return e};g.prototype._formatEditInfo=
function(e,a){var b=e.creatorField,q=e.creationDateField,d=e.editorField;if(a){e=a[e.editDateField];if("number"===typeof e)return a=a[d],b=n.formatDate(e,M),{type:"edit",date:b,user:a};q=a[q];if("number"===typeof q)return a=a[b],b=n.formatDate(q,M),{type:"create",date:b,user:a}}};g.prototype._compileLastEditInfo=function(){var e=this._effectivePopupTemplate,a=this._graphic;if(e){var e=e.lastEditInfoEnabled,b=a.get("sourceLayer.editFieldsInfo");if(e&&b)return this._formatEditInfo(b,a.attributes)}};
g.prototype._compileTitle=function(){var e=this._effectivePopupTemplate,a=this._graphic,b=e&&e.title,d=a.attributes,e=this.formattedAttributes.global,a="function"===typeof b?b.call(null,{graphic:a}):b;return"string"===typeof a&&a?(a=this._processFieldsInLinks(a,w({},e,d)),this._substituteAttributes(e,a)):""};g.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var e=b.replace(N,"").toLowerCase(),q;a.some(function(a){return a.name.toLowerCase()===e?(q=a,!0):!1});return q}};g.prototype._fixTokens=
function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,e,q){return(a=K(b,q))?"{"+a.name+"}":e})};g.prototype._encodeAttributes=function(a){var e=a?x.clone(a):{};Object.keys(e).forEach(function(a){var b=e[a];"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),e[a]=b)});return e};g.prototype._createfieldInfoMap=function(a,b){var e=this,d=new Map;a&&a.forEach(function(a){var q=e._getFixedFieldName(a.fieldName,b);a.fieldName=q;d.set(q.toLowerCase(),a)});return d};g.prototype._formatAttributeValue=
function(a){var e=a.value,b=a.fieldName,d=a.fieldInfos,g=a.fieldInfoMap;a=a.layer;if(null==e)return e;var t=this._getDomainName(b,e);return t||(t=this._getTypeName(b))?t:g.get(b.toLowerCase())?this._formatValueToFieldInfo(e,{fieldInfos:d,fieldName:b,layer:a}):(d=a&&a.fieldsIndex)&&d.isDateField(b)?n.formatDate(e,M):H(e)};g.prototype._formatAttributes=function(a){var e=this,b=this._graphic,d=t.getSourceLayer(b),g=x.clone(b.attributes);this.addRelatedFeatureAttributes(g);var c=this._createfieldInfoMap(a,
d);this._fieldInfoMap=c;Object.keys(g).forEach(function(b){g[b]=e._formatAttributeValue({fieldName:b,fieldInfos:a,fieldInfoMap:c,layer:d,value:g[b]})});return g};g.prototype._parseNumberFromString=function(a,b){return"string"!==typeof a||!b||null!=b.dateFormat||null==b.places&&null==b.digitSeparator||(b=Number(a),isNaN(b))?a:b};g.prototype._formatValueToFieldInfo=function(e,b){var d=b.fieldName,g=this._getFieldInfo(b.fieldInfos,d),q=x.clone(g),g=b.preventPlacesFormatting;(b=K(b.layer,d))&&"date"===
b.type&&(b=q.format||new a,b.dateFormat=b.dateFormat||"short-date-short-time",q.format=b);q=q&&q.format;e=this._parseNumberFromString(e,q);return"string"===typeof e||null==e||null==q?e:g?k.formatNumber(e,w({},k.convertNumberFormatToIntlOptions(q),{minimumFractionDigits:0,maximumFractionDigits:20})):q.format(e)};g.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var e=this._graphic,d=t.getSourceLayer(e);return d&&"function"===typeof d.getFieldDomain?(a=d.getFieldDomain(a,
{feature:e}))&&"coded-value"===a.type?a.getName(b):null:null};g.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var e=b.toLowerCase(),d=void 0;a.some(function(a){return a.fieldName&&a.fieldName.toLowerCase()===e?(d=a,!0):!1});return d}};g.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this._graphic,e=t.getSourceLayer(b);if(!e||"function"!==typeof e.getFeatureType)return null;var d=e.typeIdField;return d&&a===d?(a=e.getFeatureType(b))?a.name:null:null};g.prototype._removeEmptyHref=
function(a){return a.replace(/href=(""|'')/gi,"")};g.prototype._processFieldsInLinks=function(a,b){var e=this.get("_graphic.layer");a=this._fixTokens(a,e);var d=this._encodeAttributes(b),e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(e,function(a,e,g){e=(""+(e||g)).trim();return n.substitute(a,e&&"{"===e[0]?b:d)}):a};g.prototype._compileAttachments=function(a,b){a=x.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};g.prototype._queryAttachments=function(){var a=
this._graphic,d=t.getSourceLayer(a);if(!d)return v.resolve([]);if((d="scene"===d.type&&d.associatedLayer?d.associatedLayer:d)&&"function"===typeof d.queryAttachments){var g=d.objectIdField,c=(a=a.attributes)&&a[g],a=new b({objectIds:[c],returnMetadata:!0});return d.queryAttachments(a).then(function(a){return a[c]||[]})}return v.resolve([])};g.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return v.resolve();var e={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&
(e[d]=a)});return Object.keys(e).length?v.eachAlways(e):v.resolve()};g.prototype._getContent=function(){var a=this._effectivePopupTemplate,b=this._graphic,a=a&&a.content,b="function"===typeof a?a.call(null,{graphic:b}):a;return v.isPromiseLike(b)?b:v.resolve(b)};g.prototype._querySourceLayer=function(a,b){var e=a.layer,d=a.outFields;a=a.objectIds;if("function"!==typeof e.queryFeatures||!a)return b=new z("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available.",
{outFields:d,objectIds:a}),I.warn("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available."),v.reject(b);var g=e.createQuery();g.objectIds=a;g.outFields=d;g.returnGeometry=!0;return e.queryFeatures(g,b).then(function(a){return a.features[0]})};g.prototype._queryRequiredFieldsFeature=function(a){var b=this,e=this._graphic,d=this._effectivePopupTemplate,g=e.sourceLayer;return g&&d?("function"===typeof g.load?g.load(a):v.resolve()).then(function(){var t=
e.attributes[g.objectIdField],q="number"===typeof t?[t]:void 0;return d.getRequiredFields(g.fields).then(function(d){return y.featureHasFields(d,e)?null:b._querySourceLayer({layer:g,outFields:d,objectIds:q},a)})}):v.resolve(null)};g.prototype._queryFeature=function(a){var b=this,e=this._featureAbortController,d=this._graphic;this._effectivePopupTemplate=d&&d.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return this._getContent().then(function(g){if(e===b._featureAbortController&&d){var t=
b._checkForRelatedFeatures(g,a),c=b._createFormattedExpressions().then(function(a){d.attributes=w({},d.attributes,a)}),h=b._queryContentElements(g).then(function(a){return b._contentResponse=a}),q=b._queryRequiredFieldsFeature(a).then(function(a){a&&(d.geometry=a.geometry,d.attributes=w({},d.attributes,a.attributes))});return v.eachAlways([t,c,h,q]).then(function(){if(e===b._featureAbortController&&d){b._set("formattedAttributes",b._createFormattedAttributes(g));b._set("title",b._compileTitle());
var a=b._compileLastEditInfo();b._set("lastEditInfo",a||null);a=b._compileContent(g,b._contentResponse);b._set("content",a||null);return a}})}})};g.prototype._isExpressionField=function(a){return N.test(a)};g.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?H(L(a)):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};g.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+
a.keys().map(function(b){var e=a.field(b),e="string"===typeof e?H(L(e)):e;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};g.prototype._createFormattedExpressions=function(){return r(this,void 0,void 0,function(){var a,b,d,g,t,c,h,k,f,y,B,D=this;return C(this,function(e){switch(e.label){case 0:return a=this,b=a._effectivePopupTemplate,d=a._graphic,g=b&&b.expressionInfos,t=[],c={},g&&g.length?[4,O()]:[2,c];case 1:h=e.sent();k=function(a){var b=
"expression/"+a.name,e=h.createSyntaxTree(a.expression),g=P.filter(function(a){return h.hasVariable(e,a)});a=h.loadScriptDependencies(e,!0,g).then(function(){return r(D,void 0,void 0,function(){var a,t,k,q,f=this;return C(this,function(y){a=this.spatialReference;t=h.getViewInfo({spatialReference:a});k=h.createExecContext(d,t);k.useAsync=!0;this._addVarsToContext(h,g,k,t);q=h.createFunction(e,k);return[2,h.executeAsyncFunction(q,k).then(function(a){c[b]="string"===typeof a?H(L(a)):Array.isArray(a)?
f._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?f._formatArcadeDictionary(a):a},function(a){return I.error("arcade-execution-error",a)})]})})});t.push(a)};f=0;for(y=g;f<y.length;f++)B=y[f],k(B);return[2,v.eachAlways(t).then(function(){return c})]}})})};g.prototype._addVarsToContext=function(a,b,d,g){var e=this.graphic,t=this.map;b.forEach(function(b){b=b.toLowerCase();var c={map:t,spatialReference:g.sr};"$map"===b&&(d.vars[b]=a.convertMapToFeatureSetCollection(c));"$layer"===
b&&(d.vars[b]=a.convertFeatureLayerToFeatureSet(e.sourceLayer,g.sr));"$datastore"===b&&(d.vars[b]=a.convertServiceUrlToWorkspace(e.sourceLayer.url,g.sr))})};g.prototype._createFormattedAttributes=function(a){var b=this,e=this._effectivePopupTemplate,d={global:this._formatAttributes(e&&e.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,e){"fields"===a.type&&a.fieldInfos&&(d.content[e]=b._formatAttributes(a.fieldInfos))});return d};g.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,
e=[];(b=b&&b.fieldInfos)&&e.push.apply(e,b);if(!a||!Array.isArray(a))return e;a.forEach(function(a){"fields"===a.type&&e.push.apply(e,a&&a.fieldInfos)});return e};g.prototype._checkForRelatedFeatures=function(a,b){var e=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(e,a,b)};g.prototype._getTooltip=function(a){var b=a.label;return"pie-chart"===a.chartType?b:b+": "+a.value};g.prototype._getChartOption=function(a){var b=a.value,e=a.attributes,d=a.formattedAttributes,g=a.fieldName,
c=a.relatedFieldName,k=a.fieldInfos,f=a.index;a=a.chartType;var y=t.getSourceLayer(this._graphic),B=b.normalizeField,b=b.tooltipField,B=B?this.isRelatedField(B)?e[this.getRelatedFieldInfo(B).fieldName]:e[B]:null,D=c&&void 0!==e[c]?e[c]:void 0!==e[g]?e[g]:d[g],D=void 0===D?null:D&&B?D/B:D,f=new h({x:f,y:D});if(this.isRelatedField(g))return d=this.getRelatedFieldInfo(g),g=(g=this.getRelatedFieldInfo(b))?g.fieldName:null,k=this._formatValueToFieldInfo(D,{fieldInfos:k,fieldName:c,layer:y,preventPlacesFormatting:!!B}),
c=d?d.label||d.fieldName:c,f.tooltip=this._getTooltip({label:g&&void 0!==e[g]?e[g]:c,value:k,chartType:a}),f;e=this._getFieldInfo(k,g);c=this._getFixedFieldName(g,y);e=e?e.label||e.fieldName:g;f.tooltip=this._getTooltip({label:b&&void 0!==d[b]?d[b]:e,value:d[c],chartType:a});return f};g.prototype._getFixedFieldName=function(a,b){return(b=K(b,a))?b.name:a};g.prototype._getFixedFieldNames=function(a,b){var e=this;return a&&a.map(function(a){return e._getFixedFieldName(a,b)})};g.prototype._setChartValue=
function(a){var b=this,e=a.value,d=a.attributes,g=a.formattedAttributes,t=a.chartType;a=a.layer;var c=this._effectivePopupTemplate,h=this.relatedInfoCount,k=e.fields,f=e.normalizeField;e.fields=this._getFixedFieldNames(k,a);f&&(e.normalizeField=this._getFixedFieldName(f,a));if(k.some(function(a){return!!(null!=g[a]||b.isRelatedField(a)&&h)})){var y=c&&c.fieldInfos;k.forEach(function(a,c){b.isRelatedField(a)?e.series=e.series.concat(b._getRelatedChartInfos({fieldInfos:y,fieldName:a,formattedAttributes:g,
chartType:t,value:e})):(a=b._getChartOption({value:e,index:c,attributes:d,chartType:t,formattedAttributes:g,fieldName:a,fieldInfos:y}),e.series.push(a))})}};g.prototype._getRelatedChartInfos=function(a){var b=this,e=a.fieldInfos,d=a.fieldName,g=a.formattedAttributes,t=a.chartType,c=a.value,h=[];a=this.getRelatedFieldInfo(d);var k=a.fieldName,f=this.getRelatedInfo(a.layerId);if(!f)return h;a=f.relatedFeatures;f=f.relation;if(!f||!a)return h;f=f.cardinality;a.forEach(function(a,f){var y=a.attributes;
y&&Object.keys(y).forEach(function(a){a===k&&h.push(b._getChartOption({value:c,index:f,attributes:y,formattedAttributes:g,fieldName:d,chartType:t,relatedFieldName:a,fieldInfos:e}))})});return"one-to-many"===f||"many-to-many"===f?h:[h[0]]};c([m.property()],g.prototype,"_featureAbortController",void 0);c([m.property({readOnly:!0})],g.prototype,"content",void 0);c([m.property({type:Boolean})],g.prototype,"defaultPopupTemplateEnabled",void 0);c([m.property({readOnly:!0})],g.prototype,"formattedAttributes",
void 0);c([m.property({type:l})],g.prototype,"graphic",void 0);c([m.property({readOnly:!0})],g.prototype,"lastEditInfo",void 0);c([m.property({dependsOn:["view"]})],g.prototype,"spatialReference",null);c([m.property({readOnly:!0})],g.prototype,"title",void 0);c([m.property({dependsOn:["view"]})],g.prototype,"map",null);c([m.property({readOnly:!0,dependsOn:["_featureAbortController"]})],g.prototype,"waitingForContent",null);c([m.property()],g.prototype,"view",void 0);return g=c([m.subclass("esri.widgets.FeatureViewModel")],
g)}(m.declared(g))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});p.getSourceLayer=function(f){if(f)return f.get("sourceLayer")||f.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(A,p,f,c,w,C,r,l,n,z,G,x,u,v){var E=new Map,F=l.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(l){function m(d){d=l.call(this,d)||this;d.relatedInfoCount=null;d.relatedInfos=new Map;return d}f(m,l);m.prototype.destroy=function(){this.relatedInfos.clear()};m.prototype.addRelatedFeatureAttributes=function(d){var c=this;this.relatedInfos.forEach(function(k){return c._addRelatedFeatureAttribute(d,k)})};m.prototype.getRelatedFieldInfo=function(d){if(-1===d.indexOf("relationships/"))return null;
d=d.split("/").slice(1);return{layerId:d[0],fieldName:d[1]}};m.prototype.getRelatedInfo=function(d){return this.relatedInfos.get(d.toString())};m.prototype.isRelatedField=function(d){void 0===d&&(d="");return d?-1!==d.indexOf("relationships/"):!1};m.prototype.queryRelatedInfos=function(d,c,f){var k=this;this.relatedInfos.clear();var h=v.getSourceLayer(d);if(!h)return n.resolve();var a=c.filter(function(a){return a&&k.isRelatedField(a.fieldName)});if(!a||!a.length)return n.resolve();this._createRelatedInfos(c,
h);return this._queryLayerInfos(h,f).then(function(a){k._updateRelatedInfoLayerInfos(a);return k._queryRelatedFeatureMap(d,f).then(function(a){Object.keys(a).forEach(function(b){k._setRelatedFeatures(a[b],b.toString())});return a})})};m.prototype._addRelatedFeatureAttribute=function(d,c){var f=this;d&&c&&(c.relatedFeatures&&c.relatedFeatures&&c.relatedFeatures.forEach(function(k){return f._addAttributesFromFeature(d,k,c)}),c.relatedStatsFeatures&&c.relatedStatsFeatures&&c.relatedStatsFeatures.forEach(function(k){return f._addAttributesFromFeature(d,
k,c)}))};m.prototype._updateRelatedInfoLayerInfo=function(d,c){if(d=d.value)this.getRelatedInfo(c).layerInfo=d.data};m.prototype._updateRelatedInfoLayerInfos=function(d){var c=this;Object.keys(d).forEach(function(f){return c._updateRelatedInfoLayerInfo(d[f],f.toString())})};m.prototype._addAttributesFromFeature=function(d,c,f){var k=this;d&&c&&f&&Object.keys(c.attributes).forEach(function(h){var a=k._relatedFieldInfoToString({layerId:f.relation.id.toString(),fieldName:h});d[a]=c.attributes[h]})};
m.prototype._relatedFieldInfoToString=function(d){return d?"relationships/"+d.layerId+"/"+d.fieldName:""};m.prototype._createRelatedInfoForFieldInfo=function(d,c){var f=this.getRelatedFieldInfo(d.fieldName);if(f){var k=f.layerId,f=f.fieldName;k&&(c=this.getRelatedInfo(k)||this._createRelatedInfo(k,c))&&(c.relatedFields.push(f),d.statisticType&&(d=new u({statisticType:d.statisticType,onStatisticField:f,outStatisticFieldName:f}),c.outStatistics.push(d)))}};m.prototype._createRelatedInfos=function(d,
c){var f=this;d.forEach(function(d){return f._createRelatedInfoForFieldInfo(d,c)})};m.prototype._queryRelatedFeatureMap=function(d,c){var f=this,k={};this.relatedInfos.forEach(function(h,a){h.layerInfo&&(k[a]=f._queryRelatedLayerFeatures(d,h,c))});return n.eachAlways(k)};m.prototype._queryLayerInfos=function(d,c){var f=this,k={};this.relatedInfos.forEach(function(h,a){h=h.relation;if(!h)throw a=new r("relation-required","A relation is required on a layer to retrieve related records."),F.error(a),
a;h=h.relatedTableId;if(!h)throw a=new r("A related table ID is required on a layer to retrieve related records."),F.error(a),a;h=d.url+"/"+h;var b=E.get(h),t=b?b:f._queryLayerInfo(h,c);b||E.set(h,t);k[a]=t});return n.eachAlways(k)};m.prototype._queryLayerInfo=function(d,c){return w(d,{query:{f:"json"},signal:c&&c.signal})};m.prototype._queryRelatedLayerFeatures=function(d,c,f){var k=v.getSourceLayer(d).layerId.toString(),h=c.layerInfo,a=c.queryTask,b=c.relation;if(k=this._getDestinationRelation(h,
k)){var b=b.keyField,t=k.keyField,k="string"===this._getDestinationFieldType(h,k)?t+"\x3d'"+d.attributes[b]+"'":t+"\x3d"+d.attributes[b];d=a.execute(new x({where:k,outFields:c.relatedFields}),f);c=c.outStatistics&&0<c.outStatistics.length&&h.supportsStatistics?a.execute(new x({where:k,outFields:c.relatedFields,outStatistics:c.outStatistics}),f):null;return n.eachAlways({features:d,statsFeatures:c?c:n.resolve()})}return n.resolve()};m.prototype._setRelatedFeatures=function(d,c){if(c=this.getRelatedInfo(c)){var f=
d.value;f&&(d=f.features,f=f.statsFeatures,d=d&&d.value,c.relatedFeatures=d?d.features:[],d=f&&f.value,c.relatedStatsFeatures=d?d.features:[])}};m.prototype._getRelation=function(d,c){if(!c.relationships)return null;var f=null;c.relationships.some(function(c){return c.id===parseInt(d,10)?(f=c,!0):!1});return f};m.prototype._createRelatedInfo=function(d,c){var f=this._getRelation(d,c);if(f){var k=c.url+"/"+f.relatedTableId;c=new G({url:k,sourceSpatialReference:c.spatialReference});f={url:k,queryTask:c,
relation:f,relatedFields:[],outStatistics:[]};this.relatedInfos.set(d,f);return f}};m.prototype._getDestinationRelation=function(d,c){var f;d&&d.relationships&&d.relationships.some(function(d){return""+d.relatedTableId===c?(f=d,!0):!1});return f};m.prototype._getDestinationFieldType=function(d,c){var f=void 0;d.fields.some(function(d){return d.name===c.keyField?(f=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(d.type)?"number":"string",
!0):!1});return f};c([z.aliasOf("relatedInfos.size")],m.prototype,"relatedInfoCount",void 0);c([z.property()],m.prototype,"relatedInfos",void 0);return m=c([z.subclass("esri.widgets.Popup.support.RelatedFeatures")],m)}(z.declared(C))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(A,p){Object.defineProperty(p,"__esModule",{value:!0});var f=A.toUrl("../../../themes/base/images/files/");p.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===
c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};p.getIconPath=function(c){return c?"text/plain"===c?f+"text-32.svg":"application/pdf"===c?f+"pdf-32.svg":"text/csv"===c?f+"csv-32.svg":"application/gpx+xml"===c?f+"gpx-32.svg":"application/x-dwf"===c?f+"cad-32.svg":"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?f+"code-32.svg":"application/x-zip-compressed"===c||
"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?f+"zip-32.svg":-1!==c.indexOf("image/")?f+"image-32.svg":-1!==c.indexOf("audio/")?f+"sound-32.svg":-1!==c.indexOf("video/")?f+"video-32.svg":-1!==c.indexOf("msexcel")||-1!==c.indexOf("ms-excel")||-1!==c.indexOf("spreadsheetml")?
f+"excel-32.svg":-1!==c.indexOf("msword")||-1!==c.indexOf("ms-word")||-1!==c.indexOf("wordprocessingml")?f+"word-32.svg":-1!==c.indexOf("powerpoint")||-1!==c.indexOf("presentationml")?f+"report-32.svg":f+"generic-32.svg":f+"generic-32.svg"}})},"esri/widgets/support/chartUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/_base/kernel @dojo/framework/shim/Promise".split(" "),function(A,p,f,c,w){function C(){var c=w.locale;if(!c)return"en_US";
var f;if(!(f=p.locales[c])){c=c.split("-")[0].toLowerCase();f=null;for(var l=0,r=Object.keys(p.locales);l<r.length;l++){var u=r[l];if(-1<u.indexOf(c)){f=p.locales[u];break}}}return f||"en_US"}Object.defineProperty(p,"__esModule",{value:!0});p.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hr-hr":"hr_HR","hu-hu":"hu_HU",
"id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP","ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL","pl-pl":"pl_PL","pt-br":"pt_BR","pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};p.getChartLocale=C;var r,l;p.loadChartsModule=function(n){void 0===n&&(n=C());return c(this,void 0,void 0,function(){var p=this;
return f(this,function(w){if(r&&n===l)return[2,r];l=n;r=Promise.all([new Promise(function(c,f){A(["../../libs/amcharts4/index"],c,f)}),new Promise(function(c,f){A(["../../libs/amcharts4/lang/"+n],c,f)})]).then(function(r){var u=r[0],v=r[1];return c(p,void 0,void 0,function(){var c,r;return f(this,function(f){switch(f.label){case 0:return c=u.am4core,l===n&&(c.options.defaultLocale=v.default),"function"===typeof Object.assign?[3,2]:[4,new Promise(function(c,d){A(["@dojo/framework/shim/object"],c,d)})];
case 1:r=f.sent(),Object.defineProperty(Object,"assign",{value:r.assign,writable:!0,configurable:!0}),f.label=2;case 2:return[2,u]}})})},function(){return l=r=null});return[2,r]})})}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/string"],function(A,p,f,c){function w(c){var f=null;C.some(function(l){l.pattern.test(c)&&(f=l);return!!f});return f}Object.defineProperty(p,"__esModule",{value:!0});var C=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:f.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:f.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:f.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:f.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Microsoft Power Bi"}];p.autoLink=function(f){if("string"!==typeof f||!f)return f;var l=w(f);if(!l)return f;var n=f.match(l.pattern),n=c.replace(l.label,{appName:l.appName,hierPart:n&&n[2]});return f.replace(l.pattern,
"\x3ca "+(l.target?'target\x3d"'+l.target+'"':"")+' href\x3d"$1" '+("_blank"===l.target?'rel\x3d"noreferrer"':"")+"\x3e"+n+"\x3c/a\x3e")}})},"*now":function(A){A(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/i18n!./Feature/nls/Feature ../intl ../core/events ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/chartUtils ./support/uriUtils ./support/widget ./support/widgetUtils".split(" "),function(A,p,f,c,w,C,
r,l,n,z,G,x,u,v,E,F,J,m,d,k){var y={title:!0,content:!0,lastEditedInfo:!0};return function(p){function h(a){var b=p.call(this,a)||this;b._chartUIds=new Map;b._contentElementCharts=new Map;b._activeMediaMap=new Map;b._refreshTimers=new Map;b._mediaInfo=new Map;b._renderChartThrottled=G.throttle(function(a){return b._renderChart(a)},100);b.graphic=null;b.defaultPopupTemplateEnabled=!1;b.label=l.widgetLabel;b.spatialReference=null;b.title=null;b.visibleElements=w({},y);b.map=null;b.view=null;b.viewModel=
new E;return b}f(h,p);h.prototype.postInitialize=function(){var a=this;this.own(x.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}),x.init(this,"viewModel.graphic",function(){return a._disposeCharts()}))};h.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._disposeCharts()};h.prototype.castVisibleElements=function(a){return w({},y,a)};h.prototype.render=function(){var a=d.tsx("div",{key:"loading-container",
class:"esri-feature__loading-container"},d.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),b=this.visibleElements,c=this.viewModel,g=c.waitingForContent,c=c.title,c=b.title?d.tsx("h4",{class:"esri-feature__title",innerHTML:c}):null,b=b.content?d.tsx("div",{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return d.tsx("div",{class:this.classes("esri-feature","esri-widget")},d.tsx("div",{class:"esri-feature__size-container"},
c,g?a:b))};h.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};h.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};h.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};h.prototype._buildKey=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];d=this.get("viewModel.graphic.uid")||"0";b=b.join("-");return a+"__"+d+"-"+b};h.prototype._disposeCharts=function(){return r(this,void 0,void 0,function(){return C(this,
function(a){this._chartUIds.forEach(function(a){return a.dispose()});this._chartUIds.clear();this._contentElementCharts.forEach(function(a){return a.dispose()});this._contentElementCharts.clear();return[2]})})};h.prototype._renderContent=function(){var a=this.viewModel.content;return a?"string"===typeof a?d.tsx("div",{key:"content-string",innerHTML:a}):d.isWidget(a)?d.tsx("div",{key:"content-widget"},a.render()):a instanceof HTMLElement?d.tsx("div",{key:"content-html-element",bind:a,afterCreate:this._attachToNode}):
d.hasDomNode(a)?d.tsx("div",{key:"content-dijit",bind:a.domNode,afterCreate:this._attachToNode}):Array.isArray(a)?a.length?d.tsx("div",{key:"content-content-elements"},a.map(this._renderContentElement,this)):null:null:null};h.prototype._renderContentElement=function(a,b){var d=this.visibleElements;if("boolean"!==typeof d.content&&!d.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(a);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,
b);case "text":return this._renderText(a,b);default:return null}};h.prototype._renderAttachmentInfo=function(a){var b,c,g=a.attachmentInfo,f=a.supportsResizeAttachments,h=g.contentType,k=g.orientationInfo,m=g.name,p=g.url;a="list"===a.contentElement.displayType?48:400;var n=window.CSS,k=(k=n&&n.supports&&n.supports("image-orientation","from-image")||!k?"":[k.rotation?"rotate("+k.rotation+"deg)":"",k.mirrored?"scaleX(-1)":""].join(" "))?{transform:k,"image-orientation":"none"}:{},n=f&&F.isSupportedImage(h),
r=-1===p.indexOf("?")?"?":"\x26",h=n?""+p+r+"w\x3d"+a:F.getIconPath(h);a=(b={},b["esri-feature__attachment-item-mask--icon"]=!n,b);b=(c={},c["esri-feature__attachments-image--resizable"]=f,c);return d.tsx("li",{class:"esri-feature__attachments-item",key:g},d.tsx("a",{class:"esri-feature__attachments-item-link",href:p,rel:"noreferrer",target:"_blank"},d.tsx("div",{class:this.classes(a,"esri-feature__attachment-item-mask")},d.tsx("img",{styles:k,alt:"",class:this.classes(b,"esri-feature__attachments-image"),
src:h}),d.tsx("span",{class:"esri-feature__attachments-image-overlay"},d.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),d.tsx("span",{class:"esri-feature__attachments-filename"},m||l.noTitle)))};h.prototype._renderAttachments=function(a){var b=this,c,g=a.displayType,f=a.attachmentInfos,h=f&&f.length,k=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),g=(c={},c["esri-feature__attachments--list"]="preview"!==g,c["esri-feature__attachments--preview"]=
"preview"===g,c);return h?d.tsx("div",{key:"attachments-element",class:this.classes("esri-feature__attachments","esri-feature__content-element",g)},d.tsx("div",{class:"esri-feature__attachments-title"},l.attach),d.tsx("ul",{class:"esri-feature__attachments-items"},f.map(function(d,c){return b._renderAttachmentInfo({attachmentInfo:d,attachmentInfoIndex:c,supportsResizeAttachments:k,contentElement:a})}))):null};h.prototype._forceLTR=function(a){return"\x26lrm;"+a};h.prototype._renderFieldInfo=function(a,
b){var c,g=this.viewModel.formattedAttributes,f=g?g.content[b]||g.global:null,h=a.fieldName,g=a.label||h,f=f?null==f[h]?"":f[h]:"";a=!(!a.format||!a.format.dateFormat);f="number"!==typeof f||a?m.autoLink(f):this._forceLTR(f);a=(c={},c["esri-feature__field-data--date"]=a,c);return d.tsx("tr",{key:this._buildKey("fields-element-info-row",b)},d.tsx("th",{key:this._buildKey("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:g}),d.tsx("td",{key:this._buildKey("fields-element-info-row-data",
b),class:this.classes("esri-feature__field-data",a),innerHTML:f}))};h.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?d.tsx("div",{key:this._buildKey("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},d.tsx("table",{class:"esri-widget__table",summary:l.fieldsSummary,key:this._buildKey("fields-element-table",b)},d.tsx("tbody",{key:this._buildKey("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,b)})))):
null};h.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};h.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};h.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};h.prototype._getImageSource=function(a,b){var d=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var c=
a[1],c=void 0===c?"":c;return""+a[0]+d+"timestamp\x3d"+b+(c?"#":"")+c};h.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var d=this._activeMediaMap.get(a);isNaN(d)&&(d=0);(b=b.mediaInfos[d])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};h.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,
d){return a._setupMediaRefreshTimer(d)})};h.prototype._updateMediaInfoTimestamp=function(a,b){var d=Date.now();this._mediaInfo.set(b,{timestamp:d,sourceURL:this._getImageSource(a,d)});this.scheduleRender()};h.prototype._setRefreshTimeout=function(a,b){var d=this,c=b.refreshInterval,f=b.value;c&&(b=6E4*c,this._updateMediaInfoTimestamp(f.sourceURL,a),b=setInterval(function(){d._updateMediaInfoTimestamp(f.sourceURL,a)},b),this._refreshTimers.set(a,b))};h.prototype._renderMediaInfoType=function(a){var b=
a.mediaInfo,c=a.contentElementIndex;a=a.activeMediaIndex;var g=b.title,g=void 0===g?"":g;if("image"===b.type){var f=b.value,h=b.refreshInterval,k=f.sourceURL,b=f.linkURL,f=this._shouldOpenInNewTab(b)?"_blank":"_self",m="_blank"===f?"noreferrer":"",k=(h=h?this._mediaInfo.get(c):null)?h.sourceURL:k,c=d.tsx("img",{alt:g,key:this._buildKey("media-image",c,a,h?h.timestamp:0),src:k});return(a=b?d.tsx("a",{title:g,href:b,rel:m,target:f},c):null)?a:c}if(-1!==b.type.indexOf("chart"))return d.tsx("div",{key:this._buildKey("media-chart",
c,a),bind:this,"data-media-info":b,"data-content-element-index":c,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterRemoved:this._disposeChartByNode})};h.prototype._getChartDependencies=function(a){var b=this,d=a["data-media-info"],c=a["data-content-element-index"];this._disposeChartByNode(a);this._disposeChartByContgentElementIndex(c);var f=d.value,h=d.type;J.loadChartsModule().then(function(d){return b._renderChartThrottled({chartDiv:a,contentElementIndex:c,type:h,value:f,
chartsModule:d})})};h.prototype._disposeChartByContgentElementIndex=function(a){(a=this._contentElementCharts.get(a))&&a.dispose()};h.prototype._disposeChartByNode=function(a){a=a.getAttribute("data-chart-uid");(a=this._chartUIds.get(a))&&a.dispose()};h.prototype._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};h.prototype._createPieChart=function(a){var b=
a.chartsModule,d=b.am4core,b=b.am4charts;a=d.create(a.chartDiv,b.PieChart);a.rtl=k.isRTL();b=a.series.push(new b.PieSeries);b.labels.template.disabled=!0;b.ticks.template.disabled=!0;b.dataFields.value="y";b.dataFields.category="x";this._customizeChartTooltip(b.tooltip,d);return a};h.prototype._getMinSeriesValue=function(a){var b=0;a.forEach(function(a){return b=Math.min(a.x,b)});return b};h.prototype._createXYChart=function(a){var b=a.type,d=a.value,c=a.chartsModule,f=c.am4core,c=c.am4charts;a=f.create(a.chartDiv,
c.XYChart);a.rtl=k.isRTL();var h=15<d.series.length;if("column-chart"===b){var m=a.xAxes.push(new c.CategoryAxis);m.dataFields.category="x";m.renderer.labels.template.disabled=!0;this._customizeChartTooltip(m.tooltip,f);m.tooltip.events.on("sizechanged",function(){m.tooltip.dy=-m.tooltip.contentHeight});var l=a.yAxes.push(new c.ValueAxis),n=l.renderer.labels.template;l.renderer.minLabelPosition=.05;l.renderer.maxLabelPosition=.95;l.min=this._getMinSeriesValue(d.series);this._customizeChartTooltip(l.tooltip,
f);n.wrap=!0;l=a.series.push(new c.ColumnSeries);l.dataFields.valueY="y";l.dataFields.categoryX="x";a.cursor=new c.XYCursor;h&&(a.scrollbarX=new f.Scrollbar)}if("bar-chart"===b){var p=a.yAxes.push(new c.CategoryAxis);p.dataFields.category="x";p.renderer.inversed=!0;p.renderer.labels.template.disabled=!0;this._customizeChartTooltip(p.tooltip,f);p.tooltip.events.on("sizechanged",function(){p.tooltip.dx=p.tooltip.contentWidth});l=a.xAxes.push(new c.ValueAxis);n=l.renderer.labels.template;l.renderer.minLabelPosition=
.05;l.renderer.maxLabelPosition=.95;l.min=this._getMinSeriesValue(d.series);this._customizeChartTooltip(l.tooltip,f);n.wrap=!0;l=a.series.push(new c.ColumnSeries);l.dataFields.valueX="y";l.dataFields.categoryY="x";a.cursor=new c.XYCursor;h&&(a.scrollbarY=new f.Scrollbar)}if("line-chart"===b){var r=a.xAxes.push(new c.CategoryAxis);r.dataFields.category="x";r.renderer.labels.template.disabled=!0;this._customizeChartTooltip(r.tooltip,f);r.tooltip.events.on("sizechanged",function(){r.tooltip.dy=-r.tooltip.contentHeight});
l=a.yAxes.push(new c.ValueAxis);n=l.renderer.labels.template;l.renderer.minLabelPosition=.05;l.renderer.maxLabelPosition=.95;l.min=this._getMinSeriesValue(d.series);this._customizeChartTooltip(l.tooltip,f);n.wrap=!0;l=a.series.push(new c.LineSeries);l.dataFields.categoryX="x";l.dataFields.valueY="y";a.cursor=new c.XYCursor;h&&(a.scrollbarX=new f.Scrollbar)}return a};h.prototype._renderChart=function(a){var b=a.type,d=a.contentElementIndex,c=a.value,f=a.chartsModule,h=a.chartDiv;f.am4core.useTheme(f.am4themes_animated);
a="pie-chart"===b?this._createPieChart(a):this._createXYChart(a);this._chartUIds.set(a.uid,a);this._contentElementCharts.set(d,a);h.setAttribute("data-chart-uid",a.uid);a.data=c.series.map(function(a){return{x:a.tooltip,y:a.y}})};h.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:c,activeMediaIndex:a.activeMediaIndex});var f=b.title?d.tsx("div",{key:this._buildKey("media-title",c),class:"esri-feature__media-item-title",
innerHTML:b.title}):null,b=b.caption?d.tsx("div",{key:this._buildKey("media-caption",c),class:"esri-feature__media-item-caption",innerHTML:b.caption}):null;return d.tsx("div",{key:this._buildKey("media-container",c),class:"esri-feature__media-item-container"},f,b,d.tsx("div",{key:this._buildKey("media-item-container",c),class:"esri-feature__media-item"},a))};h.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?l.previous:l.next,f=a?this.classes("esri-feature__button","esri-feature__media-previous"):
this.classes("esri-feature__button","esri-feature__media-next"),h=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),k=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),m=a?this._previousClick:
this._nextClick;return d.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:c,tabIndex:0,role:"button",class:f,"data-content-element-index":b,bind:this,onkeydown:m,onclick:m},d.tsx("span",{"aria-hidden":"true",class:h}),d.tsx("span",{"aria-hidden":"true",class:k}),d.tsx("span",{class:"esri-icon-font-fallback-text"},c))};h.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=z.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previousMedia(b));
"ArrowRight"===c&&(a.stopPropagation(),this.nextMedia(b))};h.prototype._renderMedia=function(a,b){var c,f=(a=a.mediaInfos)&&a.length||0,h=(c={},c["esri-feature--media-pagination-visible"]=1<f,c);c=this._renderMediaPageButton("previous",b);var k=this._renderMediaPageButton("next",b),l=this._activeMediaMap.get(b);isNaN(l)&&(this._activeMediaMap.set(b,0),l=0);return f?d.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media",
"esri-feature__content-element",h)},d.tsx("div",{key:this._buildKey("media-element-container",b),class:"esri-feature__media-container"},c,this._renderMediaInfo({mediaInfo:a[l],contentElementIndex:b,activeMediaIndex:l}),k)):null};h.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=n.substitute("edit"===b.type?a?l.lastEditedByUser:l.lastEdited:a?l.lastCreatedByUser:l.lastCreated,{date:b.date,user:a});return d.tsx("div",
{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};h.prototype._renderText=function(a,b){return a.text?d.tsx("div",{key:this._buildKey("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};h.prototype._attachToNode=function(a){a.appendChild(this)};h.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&
c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};h.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};h.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};h.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};c([u.aliasOf("viewModel.graphic")],
h.prototype,"graphic",void 0);c([u.aliasOf("viewModel.defaultPopupTemplateEnabled")],h.prototype,"defaultPopupTemplateEnabled",void 0);c([u.property()],h.prototype,"label",void 0);c([u.aliasOf("viewModel.spatialReference")],h.prototype,"spatialReference",void 0);c([u.aliasOf("viewModel.title")],h.prototype,"title",void 0);c([u.property(),d.renderable()],h.prototype,"visibleElements",void 0);c([u.cast("visibleElements")],h.prototype,"castVisibleElements",null);c([u.aliasOf("viewModel.map")],h.prototype,
"map",void 0);c([u.aliasOf("viewModel.view")],h.prototype,"view",void 0);c([u.property({type:E}),d.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],h.prototype,"viewModel",void 0);c([d.accessibleHandler()],h.prototype,"_previousClick",null);c([d.accessibleHandler()],h.prototype,"_nextClick",null);return h=c([u.subclass("esri.widgets.Feature")],h)}(u.declared(v))});