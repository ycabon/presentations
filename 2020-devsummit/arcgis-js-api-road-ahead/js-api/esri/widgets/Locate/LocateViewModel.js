// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/i18n!./nls/Locate ../../PopupTemplate ../../core/Error ../../core/geolocationUtils ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../Popup/actions ../support/GeolocationPositioning".split(" "),function(v,w,h,e,k,l,c,m,f,n,p,q,r,d,g,t){var u={title:c.currentLocation,
fieldInfos:[{fieldName:"timestamp",label:c.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:c.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:c.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:c.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:c.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:c.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",
label:c.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:c.speed,format:{places:0,digitSeparator:!0}}],actions:[g.removeSelectedFeature.clone()],content:[{type:"fields"}]};return function(c){function a(a){var b=c.call(this,a)||this;b._locateController=null;b._handles=new p;b.locate=b.locate.bind(b);b.graphic&&(b.graphic.popupTemplate=new m(u));b._handles.add(r.on(b,"view.popup","trigger-action",function(a){return g.triggerAction({event:a,view:b.view})}));return b}h(a,c);a.prototype.destroy=
function(){this.cancelLocate();this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"state",{get:function(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"},enumerable:!0,configurable:!0});a.prototype.locate=function(){return l(this,void 0,void 0,function(){var a,b,c;return k(this,function(d){switch(d.label){case 0:this.cancelLocate();if("disabled"===this.state)throw new f("locate:disabled-state",
"Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new f("locate:feature-unsupported-state","Cannot locate in unsecure domain.");this._locateController=a=q.createAbortController();d.label=1;case 1:return d.trys.push([1,4,,5]),[4,n.getCurrentPosition(this.geolocationOptions)];case 2:return b=d.sent(),[4,this._setPosition(b,{signal:a.signal})];case 3:b=d.sent();if(this._locateController!==a)return[2,null];this.graphic&&(this.graphic=this.graphic.clone(),this.view.graphics.push(this.graphic));
this.emit("locate",{position:b});this._locateController=null;return[2,b];case 4:throw c=d.sent(),this._locateController=null,this.emit("locate-error",{error:c}),c;case 5:return[2]}})})};a.prototype.cancelLocate=function(){this._clear();this._locateController&&this._locateController.abort();this._locateController=null};e([d.property()],a.prototype,"_locateController",void 0);e([d.property({dependsOn:["view.ready","_locateController","_geolocationUsable"],readOnly:!0})],a.prototype,"state",null);e([d.property()],
a.prototype,"locate",null);e([d.property()],a.prototype,"cancelLocate",null);return a=e([d.subclass("esri.widgets.Locate.LocateViewModel")],a)}(d.declared(t))});