// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper dojo/i18n!./Measurement/nls/Measurement ../core/compilerUtils ../core/accessorSupport/decorators ./Widget ./Measurement/MeasurementViewModel ./support/widget @dojo/framework/shim/Promise".split(" "),function(n,x,y,k,u,e,p,v,q,c,w,l,g){return function(m){function a(b){b=m.call(this,b)||this;b._widgets=new Map;
b.activeTool=null;b.activeWidget=null;b.areaUnit=null;b.iconClass="esri-icon-measure";b.label=v.widgetLabel;b.linearUnit=null;b.view=null;b.viewModel=new l;return b}u(a,m);a.prototype.postInitialize=function(){var b=this;this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel);this.view&&this.activeTool&&this._getActiveWidget().then(function(d){b._set("activeWidget",d)});this.own([this.watch(["view","activeTool"],function(){b._getActiveWidget().then(function(d){b._set("activeWidget",
d)})}),this.watch("activeWidget",function(d,a){b.viewModel.set("activeViewModel",d?d.viewModel:null);a&&(a.visible=!1)}),this.watch(["areaUnit","linearUnit"],function(){return b._updateWidgetUnits()})])};a.prototype.destroy=function(){this._destroyWidgets()};a.prototype.render=function(){var b=this.activeWidget,b=b&&!b.destroyed?b.render():null;return g.tsx("div",{class:"esri-measurement"},b)};a.prototype.clear=function(){this.activeTool=null;this._destroyWidgets()};a.prototype.startMeasurement=function(){var b=
this.viewModel.activeViewModel;b&&b.newMeasurement()};a.prototype._createWidget=function(b){return k(this,void 0,void 0,function(){var a,c,f,h,e,g,k,l,m,r,t;return p(this,function(d){switch(d.label){case 0:a=this;c=a.areaUnit;f=a.linearUnit;h=a.view;e=b;switch(e){case "area":return[3,1];case "distance":return[3,7];case "direct-line":return[3,9]}return[3,11];case 1:k=g=h.type;switch(k){case "2d":return[3,2];case "3d":return[3,4]}return[3,6];case 2:return[4,new Promise(function(b,a){n(["./AreaMeasurement2D"],
b,a)})];case 3:return l=d.sent(),[2,new l({view:h,unit:c})];case 4:return[4,new Promise(function(b,a){n(["./AreaMeasurement3D"],b,a)})];case 5:return m=d.sent(),[2,new m({view:h,unit:c})];case 6:return q.neverReached(g),[2,null];case 7:return[4,new Promise(function(b,a){n(["./DistanceMeasurement2D"],b,a)})];case 8:return r=d.sent(),[2,new r({view:h,unit:f})];case 9:return[4,new Promise(function(b,a){n(["./DirectLineMeasurement3D"],b,a)})];case 10:return t=d.sent(),[2,new t({view:h,unit:f})];case 11:return q.neverReached(b),
[2,null]}})})};a.prototype._destroyWidgets=function(){this._widgets.forEach(function(b){return b.destroy()});this._widgets.clear()};a.prototype._getActiveWidget=function(){return k(this,void 0,void 0,function(){var b,a,c,f;return p(this,function(d){switch(d.label){case 0:b=this;a=b.activeTool;c=b.view;if(!c||!a)return[2,null];f=null;if(!this._widgets.has(a))return[3,1];f=this._widgets.get(a);f.visible=!0;return[3,3];case 1:return[4,this._createWidget(a)];case 2:f=d.sent();if(!f)return[2,null];f.viewModel.newMeasurement();
this._widgets.set(a,f);d.label=3;case 3:return[2,f]}})})};a.prototype._updateWidgetUnits=function(){var b=this;this._widgets.forEach(function(a){var c=b.areaUnit,d=b.linearUnit;a.unit=!a||"esri.widgets.AreaMeasurement2D"!==a.declaredClass&&"esri.widgets.AreaMeasurement3D"!==a.declaredClass?d:c})};e([c.aliasOf("viewModel.activeTool")],a.prototype,"activeTool",void 0);e([c.property({readOnly:!0}),g.renderable()],a.prototype,"activeWidget",void 0);e([c.aliasOf("viewModel.areaUnit")],a.prototype,"areaUnit",
void 0);e([c.property()],a.prototype,"iconClass",void 0);e([c.property()],a.prototype,"label",void 0);e([c.aliasOf("viewModel.linearUnit")],a.prototype,"linearUnit",void 0);e([c.aliasOf("viewModel.view"),g.renderable()],a.prototype,"view",void 0);e([c.property({type:l}),g.renderable(["viewModel.state"])],a.prototype,"viewModel",void 0);return a=e([c.subclass("esri.widgets.Measurement")],a)}(c.declared(w))});