// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/i18n!../nls/common dojo/i18n!./Popup/nls/Popup ../intl ../core/deprecate ../core/events ../core/Handles ../core/Logger ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),function(X,ga,Y,
e,q,J,S,v,w,K,Z,x,aa,ba,ca,l,f,da,ea,T,d,P){function y(d,b){return void 0===b?"esri-popup__"+d:"esri-popup__"+d+"-"+b}function fa(){return S(this,void 0,void 0,function(){return J(this,function(d){return[2,ca.create(function(b){X(["./Feature"],function(a){b(a)})})]})})}var V={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},D=ba.getLogger("esri.widgets.Popup"),W={closeButton:!0,featureNavigation:!0};return function(U){function b(a){var c=U.call(this,a)||this;c._blurContainer=!1;c._containerNode=
null;c._mainContainerNode=null;c._featureMenuNode=null;c._actionsMenuNode=null;c._focusContainer=!1;c._focusDockButton=!1;c._focusFeatureMenuButton=!1;c._focusActionsMenuButton=!1;c._focusFirstFeature=!1;c._focusFirstAction=!1;c._handles=new aa;c._pointerOffsetInPx=16;c._spinner=null;c.actions=null;c.alignment="auto";c.autoCloseEnabled=null;c.autoOpenEnabled=null;c.defaultPopupTemplateEnabled=null;c.content=null;c.collapsed=!1;c.collapseEnabled=!0;c.dockEnabled=!1;c.featureCount=null;c.featureMenuOpen=
!1;c.features=null;c.goToOverride=null;c.highlightEnabled=null;c.location=null;c.featureWidgets=[];c.label=w.widgetLabel;c.promises=null;c.selectedFeature=null;c.selectedFeatureIndex=null;c.selectedFeatureWidget=null;c.spinnerEnabled=!0;c.title=null;c.updateLocationEnabled=null;c.view=null;c.viewModel=new T;c.visible=null;c.visibleElements=q({},W);c._addSelectedFeatureIndexHandle();c.own([l.watch(c,"viewModel.screenLocation",function(){return c._positionContainer()}),l.watch(c,["viewModel.visible",
"dockEnabled"],function(){return c._toggleScreenLocationEnabled()}),l.watch(c,"viewModel.screenLocation",function(a,b){!!a!==!!b&&c.reposition()}),l.watch(c,"viewModel.features",function(){return c._updateFeatureWidgets()}),l.watch(c,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return c.reposition()}),l.watch(c,"spinnerEnabled",function(a){return c._spinnerEnabledChange(a)}),l.watch(c,"viewModel.view.size",
function(a,b){return c._updateDockEnabledForViewSize(a,b)}),l.watch(c,"viewModel.view",function(a,b){return c._viewChange(a,b)}),l.watch(c,"viewModel.view.ready",function(a,b){return c._viewReadyChange(a,b)}),l.watch(c,["viewModel.waitingForResult","viewModel.location"],function(){return c._displaySpinner()}),l.watch(c,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return c._updateFeatureWidget()}),l.watch(c,"selectedFeatureWidget.viewModel.title",function(a){return c._setTitleFromFeatureWidget(a)}),
l.watch(c,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return c._setContentFromFeatureWidget()}),l.whenFalse(c,"collapsed",function(){"xsmall"===c.get("viewModel.view.widthBreakpoint")&&c.visible&&c.collapseEnabled&&c.viewModel.centerAtLocation()}),l.on(c,"viewModel.allActions","change",function(){return c._watchActions()}),l.init(c,"viewModel.allActions",function(){return c._watchActions()})]);return c}Y(b,U);b.prototype.destroy=function(){this._destroyFeatureWidgets();
this._destroySpinner();this._handles&&this._handles.destroy();this._handles=null};Object.defineProperty(b.prototype,"actionsMenuOpen",{get:function(){return this.viewModel.visible?this._get("actionsMenuOpen"):!1},set:function(a){this._set("actionsMenuOpen",!!a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||V},set:function(a){var c=q({},V),b=this.get("viewModel.view.breakpoints"),g={};b&&(g.width=b.xsmall,g.height=b.xsmall);a=q({},c,a);c=q({},c.breakpoint,g);g=a.breakpoint;!0===g?a.breakpoint=c:"object"===typeof g&&(a.breakpoint=q({},c,g));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"featureNavigationEnabled",{set:function(a){Z.deprecatedProperty(D,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",version:"4.15"});this.visibleElements=q({},this.visibleElements,{featureNavigation:a})},enumerable:!0,configurable:!0});b.prototype.castVisibleElements=function(a){return q({},W,a)};b.prototype.blur=function(){this.visible||D.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};b.prototype.clear=function(){this.viewModel.clear()};
b.prototype.close=function(){this.visible=!1};b.prototype.fetchFeatures=function(a,c){return this.viewModel.fetchFeatures(a,c)};b.prototype.focus=function(){this.visible||D.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};b.prototype.next=function(){return this.viewModel.next()};b.prototype.open=function(a){this._handles.remove("selected-index");var c={collapsed:a?!!a.collapsed:!1,actionsMenuOpen:a?!!a.actionsMenuOpen:!1,featureMenuOpen:a?!!a.featureMenuOpen:
!1};"xsmall"===this.get("viewModel.view.widthBreakpoint")&&(c.collapsed=!0);this.set(c);this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};b.prototype.previous=function(){return this.viewModel.previous()};b.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};b.prototype.triggerAction=function(a){this.viewModel.triggerAction(a)};b.prototype.render=function(){var a=this,c,b,g,p,k,e,h,f=this.actionsMenuOpen,t=this.collapsed,l=this.collapseEnabled,
u=this.dockEnabled,m=this.featureMenuOpen,q=this.featureWidgets,n=this.visible,A=this.visibleElements.featureNavigation,B=this.viewModel,x=B.content,r=B.featureCount,D=B.pendingPromisesCount,H=B.selectedFeatureIndex,E=B.title,C=n&&1<r&&A,J=C?2:3,A=this._divideActions(J),F=A.inlineActions,G=A.menuActions,A=C&&m,B=1<G.length&&f,L=C&&this._getPageText(r,H),M=this._renderContent(),z=P.isRTL(),N=!!(this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):
M),Q=(l=!!(l&&E&&N))&&!A&&t,I=this.get("viewModel.view.widthBreakpoint"),O=u?w.undock:w.dock,t=this.currentAlignment,r=this.currentDockPosition,D=D?d.tsx("div",{key:y("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":v.loading,title:v.loading},d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,R=(c={},c["esri-icon-right-triangle-arrow"]=z,c["esri-popup__pagination-previous-icon--rtl"]=
z,c["esri-icon-left-triangle-arrow"]=!z,c["esri-popup__pagination-previous-icon"]=!z,c);c=d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",R)});R=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":w.previous,title:w.previous},c);c=(b={},b["esri-icon-left-triangle-arrow"]=z,b["esri-popup__pagination-next-icon--rtl"]=z,b["esri-icon-right-triangle-arrow"]=
!z,b["esri-popup__pagination-next-icon"]=!z,b);b=d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",c)});z=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":w.next,title:w.next},b);c=P.cssTransition("enter","esri-popup--feature-updated");b=this.id+"-feature-menu";m=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":b,"aria-expanded":m,"aria-label":v.menu,title:v.menu},L);L=C?[R,D||m,z]:null;m=this._wouldDockTo();m=(g={},g["esri-icon-minimize"]=u,g["esri-popup__icon--dock-icon"]=!u,g["esri-icon-dock-right"]=!u&&("top-right"===m||"bottom-right"===m),g["esri-icon-dock-left"]=!u&&("top-left"===m||"bottom-left"===
m),g["esri-icon-maximize"]=!u&&"top-center"===m,g["esri-icon-dock-bottom"]=!u&&"bottom-center"===m,g);g=d.tsx("span",{"aria-hidden":"true",class:this.classes(m,"esri-popup__icon")});g="xsmall"!==I&&this.get("dockOptions.buttonEnabled")?d.tsx("div",{role:"button","aria-label":O,title:O,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},
g):null;m=(p={},p["esri-popup__header-container--button"]=l,p);I=l?"button":"heading";O=l?Q?v.expand:v.collapse:"";p=this.id+"-popup-title";E=E?d.tsx("div",{class:this.classes("esri-popup__header-container",m),key:E,enterAnimation:c,id:p,role:I,"aria-label":O,title:O,tabIndex:l?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},d.tsx("h2",{class:"esri-popup__header-title",innerHTML:E})):null;m=d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});
m=d.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":v.close,title:v.close},m);g=d.tsx("header",{class:"esri-popup__header"},E,d.tsx("div",{class:"esri-popup__header-buttons"},g,this.visibleElements.closeButton?m:null));m=this.id+"-popup-content";x=!N||l&&Q?null:d.tsx("article",{key:x,enterAnimation:c,id:m,class:"esri-popup__content"},M);N="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===r||"top-center"===
r||"top-right"===r;M="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===r||"bottom-center"===r||"bottom-right"===r;c=f?v.close:v.open;c=G.length?d.tsx("div",{key:y("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:this.id+"-actions-menu-button","aria-haspopup":"true","aria-controls":f?this.id+"-actions-menu":null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,
afterUpdate:this._focusActionsMenuButtonNode,"aria-label":c,title:c},d.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null;I=F.length&&F.toArray().map(function(c,b){return a._renderAction({action:c,index:b,type:"inline"})});f=G.length&&f?d.tsx("ul",{id:this.id+"-actions-menu",role:"menu","aria-labelledby":this.id+"-actions-menu-button",key:y("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},
G.toArray().map(function(c,b){return a._renderAction({action:c,index:b+J,type:"menu-item"})})):null;f=I?d.tsx("div",{key:"inline-actions-container",class:"esri-popup__inline-actions-container"},I,c,f):null;L=C?d.tsx("section",{key:y("navigation"),class:this.classes("esri-popup__navigation")},L):null;G=(k={},k["esri-popup__footer--has-pagination"]=C,k["esri-popup__footer--has-actions"]=!!F.length,k["esri-popup__footer--has-actions-menu"]=!!G.length,k);k=C||F.length?d.tsx("div",{key:y("feature-buttons"),
class:this.classes("esri-popup__footer",G)},f,L):null;H=this._renderFeatureMenuNode(q,H,b);q=K.substitute(w.selectedFeatures,{total:q.length});F=d.tsx("section",{key:y("menu"),class:"esri-popup__feature-menu"},d.tsx("h2",{class:"esri-popup__feature-menu-header"},q),d.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},H));q=u?null:d.tsx("div",{key:y("pointer"),class:"esri-popup__pointer",role:"presentation"},
d.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}));H=this.get("selectedFeature.layer.title");C=this.get("selectedFeature.layer.id");l=(e={},e["esri-popup--shadow"]=u,e["esri-popup--is-collapsible"]=l,e["esri-popup--is-collapsed"]=Q,e);e=(h={},h["esri-popup--aligned-top-center"]=n&&"top-center"===t,h["esri-popup--aligned-bottom-center"]=n&&"bottom-center"===t,h["esri-popup--aligned-top-left"]=n&&"top-left"===t,h["esri-popup--aligned-bottom-left"]=n&&"bottom-left"===
t,h["esri-popup--aligned-top-right"]=n&&"top-right"===t,h["esri-popup--aligned-bottom-right"]="bottom-right"===t,h["esri-popup--is-docked"]=n&&u,h["esri-popup--shadow"]=n&&!u,h["esri-popup--is-docked-top-left"]=n&&"top-left"===r,h["esri-popup--is-docked-top-center"]=n&&"top-center"===r,h["esri-popup--is-docked-top-right"]=n&&"top-right"===r,h["esri-popup--is-docked-bottom-left"]=n&&"bottom-left"===r,h["esri-popup--is-docked-bottom-center"]=n&&"bottom-center"===r,h["esri-popup--is-docked-bottom-right"]=
n&&"bottom-right"===r,h["esri-popup--feature-menu-open"]=n&&A,h["esri-popup--actions-menu-open"]=n&&B,h);h=N?F:null;u=M?F:null;A=N?k:null;B=M?k:null;h=d.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",l),tabIndex:-1,role:"dialog","aria-labelledby":E?p:"","aria-describedby":x?m:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},A,h,g,x,B,u);return d.tsx("div",{key:y("base"),class:this.classes("esri-popup",
e),role:"presentation","data-layer-title":H,"data-layer-id":C,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},n?[h,q]:null)};b.prototype._watchActions=function(){var a=this,c=this.viewModel.allActions;this._handles.remove("actions");c&&c.forEach(function(c){a._handles.add(l.watch(c,"active className disabled id title image visible".split(" "),function(){return a.scheduleRender()}),"actions")})};b.prototype._divideActions=function(a){var c=this.viewModel.allActions;
return{inlineActions:c.slice(0,a),menuActions:c.slice(a)}};b.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};b.prototype._actionsMenuOpenChanged=function(a){a?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};b.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};b.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};
b.prototype._handleFeatureMenuKeyup=function(a){"Escape"===x.eventKey(a)&&(a.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};b.prototype._handleActionMenuKeyup=function(a){"Escape"===x.eventKey(a)&&(a.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};b.prototype._handleFeatureMenuItemKeyup=function(a){var c=x.eventKey(a),b=this._featureMenuNode,g=a.currentTarget["data-feature-index"];if(b){var b=b.querySelectorAll("li"),
d=b.length;"ArrowUp"===c?(a.stopPropagation(),b[(g-1+d)%d].focus()):"ArrowDown"===c?(a.stopPropagation(),b[(g+1+d)%d].focus()):"Home"===c?(a.stopPropagation(),b[0].focus()):"End"===c&&(a.stopPropagation(),b[b.length-1].focus())}};b.prototype._handleActionMenuItemKeyup=function(a){var c=x.eventKey(a),b=this._actionsMenuNode,d=a.currentTarget["data-action-index"];if(b){var b=b.querySelectorAll("li"),p=b.length;"ArrowUp"===c?(a.stopPropagation(),b[(d-1+p)%p].focus()):"ArrowDown"===c?(a.stopPropagation(),
b[(d+1+p)%p].focus()):"Home"===c?(a.stopPropagation(),b[0].focus()):"End"===c&&(a.stopPropagation(),b[b.length-1].focus())}};b.prototype._handleMainKeyup=function(a){var c=x.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previous());"ArrowRight"===c&&(a.stopPropagation(),this.next())};b.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};b.prototype._displaySpinner=function(){var a=this._spinner;if(a){var c=this.viewModel,
b=c.location;c.waitingForResult?a.show({location:b}):a.hide()}};b.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};b.prototype._renderAction=function(a){var c,b,g=a.action,p=a.index;a=a.type;var k=this.get("selectedFeature.attributes"),e=g.title,h=g.className,f=g.image,h=f||h?h:"esri-icon-default-action",e=e&&k?K.substitute(e,k):e,l=h&&k?K.substitute(h,k):h,k=f&&k?K.substitute(f,k):f,f=(c={},c["esri-icon-loading-indicator"]=g.active,c["esri-rotating"]=g.active,c["esri-popup__icon"]=
!!h,c["esri-popup__action-image"]=!g.active&&!!k,c);l&&(f[l]=!g.active);c=(b={},b["esri-popup__action"]="toggle"!==g.type,b["esri-popup__action-toggle"]="toggle"===g.type,b["esri-popup__action-toggle--on"]="toggle"===g.type&&g.value,b["esri-popup__button--disabled"]=g.disabled,b);b=d.tsx("span",{key:"text",class:"esri-popup__action-text"},e);b=[d.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",f),styles:this._getIconStyles(k)}),b];p="menu-item"===a?d.tsx("li",{key:g,
role:"menuitem",tabIndex:0,title:e,"aria-label":e,class:this.classes("esri-popup__button",c),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":p,onclick:this._triggerAction,onkeydown:this._triggerAction},b):d.tsx("div",{key:g,role:"button",tabIndex:0,title:e,"aria-label":e,class:this.classes("esri-popup__button",c),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":p,onclick:this._triggerAction,onkeydown:this._triggerAction},b);return g.visible?p:null};b.prototype._addSelectedFeatureIndexHandle=
function(){var a=this,c=l.watch(this,"viewModel.selectedFeatureIndex",function(c,b){return a._selectedFeatureIndexUpdated(c,b)});this._handles.add(c,"selected-index")};b.prototype._selectedFeatureIndexUpdated=function(a,c){this.featureCount&&a!==c&&-1!==a&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};b.prototype._updateFeatureWidget=function(){this._set("selectedFeatureWidget",this.featureWidgets[this.viewModel.selectedFeatureIndex]||null)};b.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});
this._set("featureWidgets",[])};b.prototype._updateFeatureWidgets=function(){return S(this,void 0,void 0,function(){var a,c,b,d,e,k,f=this;return J(this,function(g){switch(g.label){case 0:return a=this,c=a.features,b=a.featureWidgets,c&&c.length?[4,fa()]:(this._destroyFeatureWidgets(),[2]);case 1:return d=g.sent(),e=b.slice(0),k=[],c.forEach(function(a,c){if(a){var b=null;e.some(function(c,d){c&&c.graphic===a&&(b=c,e.splice(d,1));return!!b});if(b)k[c]=b;else{var g=new d({defaultPopupTemplateEnabled:f.defaultPopupTemplateEnabled,
graphic:a,spatialReference:f.get("view.spatialReference"),map:f.get("view.map")});g.visibleElements=q({},g.visibleElements,{title:!1});k[c]=g}}}),e.forEach(function(a){return a&&a.destroy()}),this._set("featureWidgets",k),[2]}})})};b.prototype._isScreenLocationWithinView=function(a,c){return-1<a.x&&-1<a.y&&a.x<=c.width&&a.y<=c.height};b.prototype._isOutsideView=function(a){var c=a.popupHeight,b=a.popupWidth,d=a.screenLocation,e=a.side;a=a.view;if(isNaN(b)||isNaN(c)||!a||!d)return!1;var k=a.padding;
return"right"===e&&d.x+b/2>a.width-k.right||"left"===e&&d.x-b/2<k.left||"top"===e&&d.y-c<k.top||"bottom"===e&&d.y+c>a.height-k.bottom?!0:!1};b.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,c=this._containerNode,b=this._mainContainerNode,d=this.viewModel,e=d.screenLocation,d=d.view;if(!e||!d||!c)return"top-center";if(!this._isScreenLocationWithinView(e,d))return this._get("currentAlignment")||"top-center";var k=b?window.getComputedStyle(b,null):null,b=k?parseInt(k.getPropertyValue("max-height").replace(/[^-\d\.]/g,
""),10):0,k=k?parseInt(k.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,f=c.getBoundingClientRect(),c=f.width+a,f=Math.max(f.height,b,k)+a,a=this._isOutsideView({popupHeight:f,popupWidth:c,screenLocation:e,side:"right",view:d}),b=this._isOutsideView({popupHeight:f,popupWidth:c,screenLocation:e,side:"left",view:d}),k=this._isOutsideView({popupHeight:f,popupWidth:c,screenLocation:e,side:"top",view:d}),e=this._isOutsideView({popupHeight:f,popupWidth:c,screenLocation:e,side:"bottom",view:d});
return b?k?"bottom-right":"top-right":a?k?"bottom-left":"top-left":k?e?"top-center":"bottom-center":"top-center"};b.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};b.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};b.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};
b.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};b.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};b.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};b.prototype._renderFeatureMenuItemNode=function(a,c,b){var e,f=c===b,k=(e={},e["esri-popup__feature-menu-item--selected"]=f,e);e=f?d.tsx("span",
{key:y("feature-menu-selected-feature-"+b),title:w.selectedFeature,"aria-label":w.selectedFeature,class:"esri-icon-check-mark"}):null;a=d.tsx("span",{innerHTML:a.title||v.untitled});return d.tsx("li",{role:"menuitem",tabIndex:-1,key:y("feature-menu-feature-"+b),class:this.classes(k,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":c,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},d.tsx("span",{class:"esri-popup__feature-menu-title"},
a,e))};b.prototype._renderFeatureMenuNode=function(a,c,b){var e=this;return 1<a.length?d.tsx("ol",{class:"esri-popup__feature-menu-list",id:b,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,b){return e._renderFeatureMenuItemNode(a,b,c)})):null};b.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),c=P.isRTL()?"top-left":"top-right";if(!a)return c;var b=a.padding||
{left:0,right:0,top:0,bottom:0},b=a.width-b.left-b.right;return(a=a.get("breakpoints"))&&b<=a.xsmall?"bottom-center":c};b.prototype._renderContent=function(){var a=this.get("viewModel.content");if(!a)return null;if("string"===typeof a)return d.tsx("div",{key:a,innerHTML:a});if(d.isWidget(a)&&!a.destroyed)return d.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return d.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(d.hasDomNode(a))return d.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};
b.prototype._attachToNode=function(a){a.appendChild(this)};b.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,b=a.getBoundingClientRect().width;if(c=this._calculatePositionStyle(c,b))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};b.prototype._calculateFullWidth=function(a){var c=this.currentAlignment,b=this._pointerOffsetInPx;return"top-left"===c||"bottom-left"===
c||"top-right"===c||"bottom-right"===c?a+b:a};b.prototype._calculateAlignmentPosition=function(a,c,b,d){var e=this.currentAlignment,f=this._pointerOffsetInPx;d/=2;var g=b.height-c;b=b.width-a;var h=this.view.padding;if("bottom-center"===e)return{top:c+f-h.top,left:a-d-h.left};if("top-left"===e)return{bottom:g+f-h.bottom,right:b+f-h.right};if("bottom-left"===e)return{top:c+f-h.top,right:b+f-h.right};if("top-right"===e)return{bottom:g+f-h.bottom,left:a+f-h.left};if("bottom-right"===e)return{top:c+f-
h.top,left:a+f-h.left};if("top-center"===e)return{bottom:g+f-h.bottom,left:a-d-h.left}};b.prototype._calculatePositionStyle=function(a,c){var b=this.view;if(b){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&c&&(c=this._calculateFullWidth(c),a=this._calculateAlignmentPosition(a.x,a.y,b,c)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};b.prototype._viewChange=
function(a,c){a&&c&&(this.close(),this.clear())};b.prototype._viewReadyChange=function(a,c){a?(a=this.get("viewModel.view"),this._wireUpView(a)):c&&(this.close(),this.clear())};b.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};b.prototype._dockingThresholdCrossed=function(a,c,b){var d=a[0];a=a[1];var e=c[0];c=c[1];var f=b.width;b=b.height;return d<=f&&e>f||d>f&&e<=f||a<=b&&c>b||a>b&&c<=b};
b.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,e=c.top+c.bottom,c=[],f=[];c[0]=a[0]-d;c[1]=a[1]-e;f[0]=b[0]-d;f[1]=b[1]-e;a=this.dockOptions;this._dockingThresholdCrossed(c,f,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};b.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};b.prototype._mainContainerNodeUpdated=
function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};b.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._actionsMenuNodeUpdated=function(a){(this._actionsMenuNode=a)&&this._focusFirstAction&&(this._focusFirstAction=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};
b.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};b.prototype._focusActionsMenuButtonNode=function(a){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,a.focus())};b.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};b.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};b.prototype._shouldDockAtCurrentViewSize=
function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),d=b.width,b=b.height;if(isNaN(d)||isNaN(b))return!1;d=a.hasOwnProperty("width")&&d<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return d||a};b.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};b.prototype._getPageText=function(a,b){return K.substitute(w.pageText,{index:b+1,total:a})};b.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&
b.ui&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};b.prototype._createSpinner=function(a){a&&(this._spinner=new da({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};b.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};b.prototype._close=function(){this.close();this.view&&this.view.focus()};b.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};b.prototype._toggleFeatureMenu=
function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.actionsMenuOpen=!1;this.featureMenuOpen=a};b.prototype._toggleActionsMenu=function(){var a=!this.actionsMenuOpen;this._actionsMenuOpenChanged(a);this.featureMenuOpen=!1;this.actionsMenuOpen=a};b.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(a)};b.prototype._selectFeature=
function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};b.prototype._next=function(){this.next()};b.prototype._previous=function(){this.previous()};e([f.aliasOf("viewModel.actions"),d.renderable()],b.prototype,"actions",void 0);e([f.property({dependsOn:["viewModel.visible"]}),d.renderable()],b.prototype,"actionsMenuOpen",null);e([f.property()],b.prototype,"alignment",void 0);
e([f.aliasOf("viewModel.autoCloseEnabled")],b.prototype,"autoCloseEnabled",void 0);e([f.aliasOf("viewModel.autoOpenEnabled")],b.prototype,"autoOpenEnabled",void 0);e([f.aliasOf("viewModel.defaultPopupTemplateEnabled")],b.prototype,"defaultPopupTemplateEnabled",void 0);e([f.aliasOf("viewModel.content"),d.renderable()],b.prototype,"content",void 0);e([f.property(),d.renderable()],b.prototype,"collapsed",void 0);e([f.property(),d.renderable()],b.prototype,"collapseEnabled",void 0);e([f.property({readOnly:!0,
dependsOn:["dockEnabled","alignment"]}),d.renderable()],b.prototype,"currentAlignment",null);e([f.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),d.renderable()],b.prototype,"currentDockPosition",null);e([f.property(),d.renderable()],b.prototype,"dockOptions",null);e([f.property(),d.renderable()],b.prototype,"dockEnabled",void 0);e([f.aliasOf("viewModel.featureCount"),d.renderable()],b.prototype,"featureCount",void 0);e([f.property(),d.renderable()],b.prototype,
"featureMenuOpen",void 0);e([f.aliasOf("viewModel.features"),d.renderable()],b.prototype,"features",void 0);e([f.property(),d.renderable()],b.prototype,"featureNavigationEnabled",null);e([f.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);e([f.aliasOf("viewModel.highlightEnabled")],b.prototype,"highlightEnabled",void 0);e([f.aliasOf("viewModel.location"),d.renderable()],b.prototype,"location",void 0);e([f.property({readOnly:!0}),d.renderable()],b.prototype,"featureWidgets",void 0);
e([f.property()],b.prototype,"label",void 0);e([f.aliasOf("viewModel.promises")],b.prototype,"promises",void 0);e([f.aliasOf("viewModel.selectedFeature"),d.renderable()],b.prototype,"selectedFeature",void 0);e([f.aliasOf("viewModel.selectedFeatureIndex"),d.renderable()],b.prototype,"selectedFeatureIndex",void 0);e([f.property({readOnly:!0}),d.renderable()],b.prototype,"selectedFeatureWidget",void 0);e([f.property()],b.prototype,"spinnerEnabled",void 0);e([f.aliasOf("viewModel.title"),d.renderable()],
b.prototype,"title",void 0);e([f.aliasOf("viewModel.updateLocationEnabled")],b.prototype,"updateLocationEnabled",void 0);e([f.aliasOf("viewModel.view")],b.prototype,"view",void 0);e([f.property({type:T}),d.renderable("viewModel.view.widthBreakpoint viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),d.vmEvent(["triggerAction","trigger-action"])],b.prototype,"viewModel",
void 0);e([f.aliasOf("viewModel.visible"),d.renderable()],b.prototype,"visible",void 0);e([f.property(),d.renderable()],b.prototype,"visibleElements",void 0);e([f.cast("visibleElements")],b.prototype,"castVisibleElements",null);e([d.accessibleHandler()],b.prototype,"_toggleCollapsed",null);e([d.accessibleHandler()],b.prototype,"_close",null);e([d.accessibleHandler()],b.prototype,"_toggleDockEnabled",null);e([d.accessibleHandler()],b.prototype,"_toggleFeatureMenu",null);e([d.accessibleHandler()],b.prototype,
"_toggleActionsMenu",null);e([d.accessibleHandler()],b.prototype,"_triggerAction",null);e([d.accessibleHandler()],b.prototype,"_selectFeature",null);e([d.accessibleHandler()],b.prototype,"_next",null);e([d.accessibleHandler()],b.prototype,"_previous",null);return b=e([f.subclass("esri.widgets.Popup")],b)}(f.declared(ea))});