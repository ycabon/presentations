// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/awaiterHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/Accessor ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ./ScaleRanges ../Slider/SliderViewModel".split(" "),function(t,u,l,m,e,n,p,q,f,d,g,r){return function(h){function b(a){a=h.call(this,a)||this;a.layer=null;a.scaleRanges=g.fromScaleRange({minScale:0,maxScale:0});var c;c=a._getSliderIndexRange(a.scaleRanges.length-
1).max;c=new r({precision:10,min:0,max:c,values:[0,c]});a.sliderViewModel=c;return a}m(b,h);b.prototype.initialize=function(){var a=this;this.handles.add([f.init(this,"sliderViewModel.values",function(){if(a._hasTiledLayer()){var c=a.sliderViewModel.values,b=c[0],c=c[1],k=a.mapScaleToSlider(a._getTiledLayerMaxScale()),d=a.mapScaleToSlider(a._getTiledLayerMinScale());if(c>k||b<d)a.sliderViewModel.values=[Math.max(b,d),Math.min(c,k)]}}),f.init(this,"layer.loaded",function(){return l(a,void 0,void 0,
function(){var a,b,d,e,f,g;return n(this,function(c){switch(c.label){case 0:return a=this,b=a.layer,d=a.view,b?d?[4,d.when()]:[3,2]:[2];case 1:c.sent(),c.label=2;case 2:return[4,b.when()];case 3:return e=c.sent(),f=e.minScale,g=e.maxScale,this.set({minScale:f,maxScale:g}),[2]}})})})])};Object.defineProperty(b.prototype,"maxScale",{get:function(){var a=this.mapSliderToScale(this.sliderViewModel.values[1]);return Math.round(this._handleEdgeScale("max",a))},set:function(a){this._setMaxScaleOnSlider(a)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxScaleLimit",{get:function(){return this.mapSliderToScale(this.sliderViewModel.max)},set:function(a){this._setSliderRange({maxScale:a,minScale:this.minScaleLimit})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minScale",{get:function(){var a=this.mapSliderToScale(this.sliderViewModel.values[0]);return Math.round(this._handleEdgeScale("min",a))},set:function(a){this._setMinScaleOnSlider(a)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"minScaleLimit",{get:function(){return this.mapSliderToScale(this.sliderViewModel.min)},set:function(a){this._setSliderRange({maxScale:this.maxScaleLimit,minScale:a})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){var a=this.view,c=this.layer;return!a&&!c||!a&&c&&c.loaded||!c&&a&&a.ready||a&&a.ready&&c&&c.loaded?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{set:function(a){this._set("view",
a)},enumerable:!0,configurable:!0});b.prototype.mapScaleToSlider=function(a){var c=this.scaleRanges.scaleToRangeIndex(a),b=this.scaleRanges.findScaleRangeByIndex(c),d=b.maxScale,b=b.minScale,c=this._getSliderIndexRange(c);return this._mapToRange(a,b,d,c.min,c.max)};b.prototype.mapSliderToScale=function(a){var c=this.scaleRanges.findScaleRangeByIndex(a),b=c.maxScale,c=c.minScale,d=this._getSliderIndexRange(a);return this._mapToRange(a,d.min,d.max,c,b)};b.prototype._setSliderRange=function(a){this.scaleRanges=
g.fromScaleRange(a);a=this._getSliderIndexRange(this.scaleRanges.length-1).max;this.sliderViewModel.max=a;this.sliderViewModel.min=0;this.notifyChange("maxScaleLimit");this.notifyChange("minScaleLimit")};b.prototype._getSliderIndexRange=function(a){a=Math.floor(a);return{min:a,max:a+.99999}};b.prototype._mapToRange=function(a,c,b,d,e){return d+(a-c)*(e-d)/(b-c)};b.prototype._setMaxScaleOnSlider=function(a){var c=this.scaleRanges,b=this.sliderViewModel;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMaxScaleToLayer(c.clampMaxScale(a))),
b.values=[b.values[0],a])};b.prototype._setMinScaleOnSlider=function(a){var b=this.scaleRanges,d=this.sliderViewModel;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMinScaleToLayer(b.clampMinScale(a))),d.values=[a,d.values[1]])};b.prototype._constrainMinScaleToLayer=function(a){var b=this.scaleRanges;if(this._hasTiledLayer()){var b=b.firstRange,d=this._getTiledLayerMinScale();a=.85<this._mapToRange(a,b.maxScale,b.minScale,0,1)?d:a>d?d:a}return a};b.prototype._constrainMaxScaleToLayer=function(a){if(this._hasTiledLayer()){var b=
this._getTiledLayerMaxScale();a=a<b?b:a}return a};b.prototype._handleEdgeScale=function(a,b){return this.scaleRanges["max"===a?"maxScale":"minScale"]===b?0:b};b.prototype._getLayerLODS=function(){return this.get("layer.tileInfo.lods")};b.prototype._getTiledLayerMinScale=function(){var a=this._getLayerLODS();return this.scaleRanges.clampMinScale(a[0].scale)};b.prototype._getTiledLayerMaxScale=function(){var a=this._getLayerLODS();return a[a.length-1].scale};b.prototype._hasTiledLayer=function(){return!!this._getLayerLODS()};
e([d.property()],b.prototype,"layer",void 0);e([d.property({dependsOn:["sliderViewModel.values"]})],b.prototype,"maxScale",null);e([d.property({dependsOn:["sliderViewModel.max"]})],b.prototype,"maxScaleLimit",null);e([d.property({dependsOn:["sliderViewModel.values"]})],b.prototype,"minScale",null);e([d.property({dependsOn:["sliderViewModel.min"]})],b.prototype,"minScaleLimit",null);e([d.property()],b.prototype,"scaleRanges",void 0);e([d.property()],b.prototype,"sliderViewModel",void 0);e([d.property({dependsOn:["layer.loaded",
"view.ready"],readOnly:!0})],b.prototype,"state",null);e([d.property()],b.prototype,"view",null);return b=e([d.subclass("esri.widgets.ScaleRangeSlider.ScaleRangeSliderViewModel")],b)}(d.declared(q.HandleOwnerMixin(p)))});