// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../Graphic ../../../core/maybe ../../../core/promiseUtils ./geometryUtils".split(" "),function(B,l,x,u,q,n){function y(a,c){var b=a.source,f=a.spatialReference,d=a.location,g=a.sourceIndex,h=a.view;a=b.locator;var p=b.zoomScale,m=b.defaultZoomScale,k=h&&h.scale;c=c&&c.signal;f&&(a.outSpatialReference=f);return a.locationToAddress({location:d},{signal:c}).then(function(a){return v([a],{sourceIndex:g,scale:k,view:h,zoomScale:p,defaultZoomScale:m})})}function w(a,c){var b=
a.filter,f=a.searchExtent;a=a.withinViewEnabled;var d=c&&c.extent;return(c=n.createExtentFromGeometry(b&&b.geometry,c,c&&c.scale))||f||(a&&d?d:void 0)}function z(a,c){var b=a.source,f=a.suggestResult,d=a.spatialReference,g=a.view,h=a.maxResults,p=a.sourceIndex,m=b&&b.zoomScale,k=b&&b.defaultZoomScale;if(!f.text.trim())return q.resolve();a=""+(!f.key&&b.prefix?b.prefix:"")+f.text+(!f.key&&b.suffix?b.suffix:"");var e={},r=b.locator,l=g&&g.scale,n=w(b,g);c=c&&c.signal;if(!r)return q.resolve();b.categories&&
(e.categories=b.categories);b.locationType&&(e.locationType=b.locationType);d&&(r.outSpatialReference=d);if(d=g&&g.get("extent.center"))e.location=d;e.maxLocations=h;n&&(e.searchExtent=u.unwrap(n));b.countryCode&&(e.countryCode=b.countryCode);var t=f.key;t&&(e.magicKey=t);e.address={};e.address[b.singleLineFieldName||"Single Line Input"]=a;b.outFields&&(e.outFields=b.outFields);return r.addressToLocations(e,{signal:c}).then(function(a){return v(a,{key:t,scale:l,sourceIndex:p,view:g,zoomScale:m,defaultZoomScale:k})})}
function A(a,c){return a.map(function(a){return{text:a.text,key:a.magicKey,sourceIndex:c}})}function v(a,c){return a.map(function(a){var b=c.key,d=c.scale,g=c.sourceIndex,h=c.view,p=c.zoomScale,m=c.defaultZoomScale,k=a.extent,e=a.location,l=a.address;a=new x({geometry:e,attributes:a.attributes});k=k||e;d=n.createExtentFromGeometry(k,h,d);h=p?n.scaleExtent(d,h,p):m&&"point"===k.type?n.scaleExtent(d,h,m):d;e=e?e.x+","+e.y:"";return{extent:h,feature:a,key:b,name:l||e,sourceIndex:g}})}Object.defineProperty(l,
"__esModule",{value:!0});l.getResults=function(a,c){return a.location?y(a,c):z(a,c)};l.getSuggestions=function(a,c){var b=a.source,f=a.spatialReference,d=a.view,g=a.suggestTerm,h=a.maxSuggestions,l=a.sourceIndex;a={};var m=b.locator,k=w(b,d);c=c&&c.signal;if(!m)return q.resolve();b.categories&&(a.categories=b.categories);m.outSpatialReference=f;if(f=d&&d.get("extent.center"))a.location=f;if(!g.trim())return q.resolve();f=b.prefix;d=b.suffix;a.text=""+(void 0===f?"":f)+g+(void 0===d?"":d);k&&(a.searchExtent=
u.unwrap(k));a.maxSuggestions=h;b.countryCode&&(a.countryCode=b.countryCode);return m.suggestLocations(a,{signal:c}).then(function(a){return A(a,l)})};l.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1}});