// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/i18n!../nls/common dojo/i18n!./TimeSlider/nls/TimeSlider ../TimeInterval ../core/arrayUtils ../core/Collection ../core/compilerUtils ../core/Error ../core/events ../core/mathUtils ../core/maybe ../core/throttle ../core/accessorSupport/decorators ../intl/date ../layers/support/timeUtils ./Slider ./Widget ./TimeSlider/TimeSliderViewModel ./support/widget".split(" "),function(O,
P,E,e,Q,p,F,a,G,H,v,B,I,J,l,K,d,t,C,L,M,D,c){var N=new H([{minor:new a({value:100,unit:"milliseconds"}),major:new a({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new a({value:500,unit:"milliseconds"}),major:new a({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new a({value:1,unit:"seconds"}),major:new a({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new a({value:2,unit:"seconds"}),major:new a({value:30,unit:"seconds"}),format:{minute:"numeric",
second:"numeric"}},{minor:new a({value:10,unit:"seconds"}),major:new a({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new a({value:15,unit:"seconds"}),major:new a({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:1,unit:"minutes"}),major:new a({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:5,unit:"minutes"}),major:new a({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:15,
unit:"minutes"}),major:new a({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:1,unit:"hours"}),major:new a({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new a({value:6,unit:"hours"}),major:new a({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new a({value:1,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"long"}},{minor:new a({value:2,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"short"}},
{minor:new a({value:3,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"short"}},{minor:new a({value:4,unit:"days"}),major:new a({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new a({value:1,unit:"weeks"}),major:new a({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new a({value:1,unit:"months"}),major:new a({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new a({value:2,unit:"months"}),major:new a({value:2,unit:"years"}),format:{year:"numeric"}},
{minor:new a({value:1,unit:"years"}),major:new a({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new a({value:2,unit:"years"}),major:new a({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new a({value:5,unit:"decades"}),major:new a({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:1,unit:"centuries"}),major:new a({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:2,unit:"centuries"}),major:new a({value:20,unit:"centuries"}),
format:{era:"short",year:"numeric"}},{minor:new a({value:5,unit:"centuries"}),major:new a({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:10,unit:"centuries"}),major:new a({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:20,unit:"centuries"}),major:new a({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:50,unit:"centuries"}),major:new a({value:500,unit:"centuries"}),format:{era:"short",
year:"numeric"}},{minor:new a({value:100,unit:"centuries"}),major:new a({value:1E3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:200,unit:"centuries"}),major:new a({value:1E3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:500,unit:"centuries"}),major:new a({value:5E3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:1E3,unit:"centuries"}),major:new a({value:1E4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);
return function(a){function b(g){g=a.call(this,g)||this;g._slider=null;g._tickFormat=null;g.effectiveStops=null;g.fullTimeExtent=null;g.iconClass="esri-icon-time-clock";g.label=F.widgetLabel;g.loop=!0;g.playRate=1E3;g.mode="time-window";g.stops={count:10};g.timeExtent=null;g.timeVisible=!1;g.values=null;g.view=null;g.viewModel=new D;return g}E(b,a);b.prototype.postInitialize=function(){var a=this;this._slider=new L({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1});var b=K.throttle(function(){return a.scheduleRender()},
100);this.own([this._slider.watch("values",function(g){a.set("values",g.map(function(a){return new Date(a)}))}),I.on(window,"resize",b),this.watch("effectiveStops",function(){a._updateSliderSteps()}),this.watch(["stops","fullTimeExtent"],function(){a._createDefaultValues()})]);this._updateSliderSteps();this._createDefaultValues();this._validateTimeExtent()};b.prototype.destroy=function(){this.view=null;this._slider.destroy();this._tickFormat=null};b.prototype.next=function(){};b.prototype.play=function(){};
b.prototype.previous=function(){};b.prototype.stop=function(){return null};b.prototype.render=function(){var a=this.domNode,b=this.fullTimeExtent,e=this.mode,d=this._slider,w=this.effectiveStops,m=this.timeVisible,f=this.values,q=this.viewModel;if(null!=b){var h=b.start,k=b.end;if(null==h||null==k)return;var h=h.getTime(),n=k.getTime();if(k=d.min!==h||d.max!==n)d.min=h,d.max=n;var v=(n-h)/(d.trackElement?d.trackElement.offsetWidth:400),r=N.find(function(a){return a.minor.toMilliseconds()>3*v});if(h=
this._tickFormat!==r&&null!=r)this._tickFormat=r;if(k||h)h={mode:"position",values:this._getTickPositions(r.minor),labelsVisible:!1,tickCreatedFunction:function(a,b){b.classList.add("minorTick")}},k={mode:"position",values:this._getTickPositions(r.major),labelsVisible:!0,tickCreatedFunction:function(a,b){b.classList.add("majorTick")},labelFormatFunction:function(a){return t.formatDate(a,r.format)}},d.tickConfigs=[h,k]}h=f?f.map(function(a){return a.getTime()}):null;G.equals(d.values,h)||(d.values=
h);var k=b&&b.start,h=l.isSome(k)?this._formateDate(k):null,k=m&&l.isSome(k)?this._formateTime(k):null,n=b&&b.end,b=l.isSome(n)?this._formateDate(n):null,n=m&&l.isSome(n)?this._formateTime(n):null,x=null,y=null,z=null,A=null;if(f&&0<f.length){var u=f[0],x=this._formateDate(u);m&&(y=this._formateTime(u))}"time-window"===e&&f&&1<f.length&&(u=f[1],z=this._formateDate(u),m&&(A=this._formateTime(u)));f=q.state;q="ready"===f;m="playing"===f;f="disabled"===f||0===w.length;w=c.tsx("div",{class:"esri-time-slider__animation"},
c.tsx("button",{"aria-disabled":f?"true":"false","aria-label":m?p.control.stop:p.control.play,bind:this,class:this.classes("esri-widget--button","esri-time-slider__animation-button",f&&"esri-button--disabled"),disabled:f,title:m?p.control.stop:p.control.play,onclick:this._playOrStopClick},c.tsx("div",{class:this.classes((q||f)&&"esri-icon-play",m&&"esri-icon-pause")})));q=c.tsx("div",{class:"esri-time-slider__time-extent"},l.isSome(x)&&c.tsx("div",{key:"start-date-group",class:"esri-time-slider__time-extent-group"},
c.tsx("div",{key:"start-date",class:"esri-time-slider__time-extent-date"},x),l.isSome(y)&&c.tsx("div",{key:"start-time",class:"esri-time-slider__time-extent-time"},y)),l.isSome(z)&&c.tsx("div",{key:"separator",class:"esri-time-slider__time-extent-separator"},"\u2013"),l.isSome(x)&&c.tsx("div",{key:"end-date-group",class:"esri-time-slider__time-extent-group"},c.tsx("div",{key:"end-date",class:"esri-time-slider__time-extent-date"},z),l.isSome(A)&&c.tsx("div",{key:"end-time",class:"esri-time-slider__time-extent-time"},
A)));h=c.tsx("div",{class:"esri-time-slider__min"},l.isSome(h)&&c.tsx("div",{key:"min-date",class:"esri-time-slider__min-date"},h),l.isSome(k)&&c.tsx("div",{key:"min-time"},k));d=c.tsx("div",{class:"esri-time-slider__slider"},d.render());b=c.tsx("div",{class:"esri-time-slider__max"},l.isSome(b)&&c.tsx("div",{key:"max-date",class:"esri-time-slider__max-date"},b),l.isSome(n)&&c.tsx("div",{key:"max-time"},n));k=c.tsx("div",{class:"esri-time-slider__previous"},c.tsx("button",{"aria-disabled":f?"true":
"false","aria-label":p.pagination.previous,bind:this,class:this.classes("esri-widget--button","esri-time-slider__previous-button",(m||f)&&"esri-button--disabled"),disabled:f,title:p.pagination.previous,onclick:this._previousClick},c.tsx("div",{class:"esri-icon-reverse"})));m=c.tsx("div",{class:"esri-time-slider__next"},c.tsx("button",{"aria-disabled":f?"true":"false","aria-label":p.pagination.next,bind:this,class:this.classes("esri-widget--button","esri-time-slider__next-button",(m||f)&&"esri-button--disabled"),
disabled:f,title:p.pagination.next,onclick:this._nextClick},c.tsx("div",{class:"esri-icon-forward"})));a=858>a.clientWidth?"compact":"wide";return c.tsx("div",{class:this.classes("esri-time-slider","esri-widget","esri-time-slider__mode--"+e,"esri-time-slider__layout--"+a)},"wide"===a&&c.tsx("div",{class:"esri-time-slider__row"},[w,q,h,d,b,k,m]),"compact"===a&&[c.tsx("div",{key:"time-slider-row-1",class:"esri-time-slider__row"},[q]),c.tsx("div",{key:"time-slider-row-2",class:"esri-time-slider__row"},
[d]),c.tsx("div",{key:"time-slider-row-3",class:"esri-time-slider__row"},[h,k,w,m,b])])};b.prototype._createDefaultValues=function(){var a=this.effectiveStops,b=this.mode,c=this.values;this.fullTimeExtent&&a&&b&&!c&&(this.values="time-window"===b?1<a.length?[a[0],a[1]]:null:0<a.length?[a[0]]:null)};b.prototype._getTickPositions=function(a){var b=this.fullTimeExtent,c=b.start,b=b.end,d=[],g=a.value;a=a.unit;for(var e=C.truncateDate(c,a);e.getTime()<=b.getTime();)e.getTime()>=c.getTime()&&d.push(e.getTime()),
e=C.offsetDate(e,g,a);return d};b.prototype._formateDate=function(a){return t.formatDate(a,t.convertDateFormatToIntlOptions("short-date"))};b.prototype._formateTime=function(a){return t.formatDate(a,t.convertDateFormatToIntlOptions("long-time"))};b.prototype._updateSliderSteps=function(){this._slider.steps=0<this.effectiveStops.length?this.effectiveStops.map(function(a){return a.getTime()}):null};b.prototype._validateTimeExtent=function(){var a=this;if(this.fullTimeExtent&&this.mode&&this.values){if(!Array.isArray(this.values))throw new B("time-slider:invalid-values",
"Values must be an array of dates.");if(0===this.values.length||this.values.some(function(a){return!(a instanceof Date)}))throw new B("time-slider:invalid-values","Values must be an array of dates.");this.values=this.values.map(function(b){b=b.getTime();b=J.clamp(b,a.fullTimeExtent.start.getTime(),a.fullTimeExtent.end.getTime());return new Date(b)});switch(this.mode){case "instant":case "cumulative-from-start":case "cumulative-from-end":1<this.values.length&&this.values.splice(1);break;case "time-window":1===
this.values.length?this.values.push(this.fullTimeExtent.end):2<this.values.length&&this.values.splice(2);this.values.sort(function(a,b){return a.getTime()-b.getTime()});break;default:v.neverReached(this.mode)}}};b.prototype._playOrStopClick=function(){switch(this.viewModel.state){case "ready":this.viewModel.play();break;case "playing":this.viewModel.stop();break;case "disabled":break;default:v.neverReached(this.viewModel.state)}};b.prototype._previousClick=function(){this.viewModel.previous()};b.prototype._nextClick=
function(){this.viewModel.next()};e([d.aliasOf("viewModel.effectiveStops"),c.renderable()],b.prototype,"effectiveStops",void 0);e([d.aliasOf("viewModel.fullTimeExtent"),c.renderable()],b.prototype,"fullTimeExtent",void 0);e([d.property()],b.prototype,"iconClass",void 0);e([d.property()],b.prototype,"label",void 0);e([d.aliasOf("viewModel.loop")],b.prototype,"loop",void 0);e([d.aliasOf("viewModel.playRate")],b.prototype,"playRate",void 0);e([d.aliasOf("viewModel.mode"),c.renderable()],b.prototype,
"mode",void 0);e([d.aliasOf("viewModel.stops")],b.prototype,"stops",void 0);e([d.aliasOf("viewModel.timeExtent")],b.prototype,"timeExtent",void 0);e([d.property({nonNullable:!0}),c.renderable()],b.prototype,"timeVisible",void 0);e([d.aliasOf("viewModel.values"),c.renderable()],b.prototype,"values",void 0);e([d.aliasOf("viewModel.view")],b.prototype,"view",void 0);e([d.property({type:D}),c.renderable(["viewModel.state"])],b.prototype,"viewModel",void 0);e([d.aliasOf("viewModel.next")],b.prototype,
"next",null);e([d.aliasOf("viewModel.play")],b.prototype,"play",null);e([d.aliasOf("viewModel.previous")],b.prototype,"previous",null);e([d.aliasOf("viewModel.stop")],b.prototype,"stop",null);e([c.accessibleHandler()],b.prototype,"_playOrStopClick",null);e([c.accessibleHandler()],b.prototype,"_previousClick",null);e([c.accessibleHandler()],b.prototype,"_nextClick",null);return b=e([d.subclass("esri.widgets.TimeSlider")],b)}(d.declared(M))});