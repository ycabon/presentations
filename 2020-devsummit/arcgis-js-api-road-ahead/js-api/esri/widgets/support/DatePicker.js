// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper dojo/i18n!./nls/DatePicker ../../intl ../../moment ../../core/events ../../core/accessorSupport/decorators ../Widget ./DatePickerViewModel ./Popover ./widget".split(" "),function(z,A,h,v,g,k,r,m,l,w,n,x,d){var p={year:"numeric",month:"2-digit",day:"2-digit"},y=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),q="onfocusout"in HTMLElement.prototype;return function(t){function b(a){var c=
t.call(this,a)||this;c._activeDate=null;c._calendarNode=null;c._calendarPopover=new x({owner:c,placement:"bottom-start",anchorElement:function(){return c._rootNode},renderContentFunction:c._renderCalendar});c._closedByUserAction=!1;c._isOpen=!1;c._rootNode=null;c.value=null;c.commitOnMonthChange=!1;c.viewModel=new n;c._handleDatePickerBlur=q?null:c._handleDatePickerBlurOrFocusOut;c._handleDatePickerFocusOut=q?c._handleDatePickerBlurOrFocusOut:null;return c}v(b,t);b.prototype.destroy=function(){this._calendarPopover.destroy()};
b.prototype.render=function(){var a,c=k.formatDate(this.viewModel.value.valueOf(),p),b=this._isOpen,e=(a={},a["esri-icon-down-arrow"]=!b,a["esri-icon-up-arrow"]=b,a);return d.tsx("div",{afterCreate:d.storeNode,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},d.tsx("div",{afterUpdate:this._focusSelectedOrClosed,"aria-pressed":b.toString(),bind:this,class:this.classes("esri-widget--button","esri-date-picker__calendar-toggle"),onclick:this._toggle,onkeydown:this._toggle,
role:"button",tabIndex:0},d.tsx("span",{class:"esri-date-picker__date"},c),d.tsx("span",{"aria-hidden":"true",class:this.classes(e)})))};b.prototype._focusSelectedOrClosed=function(a){this._closedByUserAction&&(this._closedByUserAction=!1,a.focus())};b.prototype._handleDatePickerKeydown=function(a){"Escape"===m.eventKey(a)&&(this._closedByUserAction=!0,this._close(),a.preventDefault(),a.stopPropagation())};b.prototype._renderCalendar=function(){var a=this._activeDate,c=this.get("viewModel.value");
return d.tsx("div",{afterCreate:d.storeNode,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(a),this._renderDayPicker(a,c),this._renderYearPicker(a))};b.prototype._handleDatePickerBlurOrFocusOut=function(a){a.currentTarget===a.target&&(a=a.relatedTarget,this._calendarNode.contains(a)||this._rootNode.contains(a)||this._close())};b.prototype._renderMonthPicker=
function(a){var c=d.isRTL(),b=c?"esri-icon-right":"esri-icon-left",c=c?"esri-icon-left":"esri-icon-right",e=r.months().map(function(c,b){b=a.month()===b;return d.tsx("option",{selected:b},c)});return d.tsx("div",{class:"esri-date-picker__month-picker"},d.tsx("div",{"aria-label":g.goToPreviousMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setPreviousMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousMonth,role:"button",tabIndex:0,
title:g.goToPreviousMonth},d.tsx("span",{"aria-hidden":"true",class:b})),d.tsx("select",{"aria-live":"assertive",bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),id:this.id+"__month-picker",onblur:this._handleDatePickerBlur,onchange:this._setMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setMonth},e),d.tsx("div",{"aria-label":g.goToNextMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setNextMonth,onfocusout:this._handleDatePickerFocusOut,
onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:g.goToNextMonth},d.tsx("span",{"aria-hidden":"true",class:c})))};b.prototype._renderDayPicker=function(a,b){var c=this,e=a.clone().day(r.localeData().firstDayOfWeek()),e=this._getWeekLabels(e),f=this._getDayId(a);a=this._renderMonth(a,b);return d.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":f,"aria-labelledby":this.id+"__month-picker "+this.id+"__selected-year",bind:this,class:"esri-date-picker__day-picker",
id:this.id+"__day-picker",onblur:this._handleDatePickerBlur,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},d.tsx("div",{class:"esri-date-picker__week-item",role:"row"},e.map(function(a){return d.tsx("div",{"aria-label":a.name,class:c.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:a.name},a.abbr)})),a)};b.prototype._getDayId=function(a){return this.id+"__"+k.formatDate(a.valueOf(),p)};b.prototype._handleDayPickerCreate=
function(a){a.focus()};b.prototype._getWeekLabels=function(a){for(var b=[],d={weekday:"long"},e={weekday:"narrow"},f=0;7>f;f++)b.push({name:k.formatDate(a.valueOf(),d),abbr:k.formatDate(a.valueOf(),e)}),a.add(1,"day");return b};b.prototype._handleDayPickerKeydown=function(a){var b=a.ctrlKey,d=a.shiftKey,e=m.eventKey(a),f=this._activeDate;if(-1!==y.indexOf(e)){if("ArrowLeft"===e)f.subtract(1,"day");else if("ArrowRight"===e)f.add(1,"day");else if("ArrowUp"===e)f.subtract(1,"week");else if("ArrowDown"===
e)f.add(1,"week");else if("PageUp"===e)f.subtract(1,d?"year":"month");else if("PageDown"===e)f.add(1,d?"year":"month");else if("Home"===e)f.startOf(b?"year":"month");else if("End"===e)f.endOf(b?"year":"month");else if("Enter"===e||" "===e)this.viewModel.value=f.clone(),this._closedByUserAction=!0,this._close();a.preventDefault();a.stopPropagation()}};b.prototype._renderMonth=function(a,b){for(var c,e=r(),f=a.clone().startOf("month"),h=a.clone().endOf("month"),g=f.clone().subtract(f.weekday(),"day"),
k=[],l=0;6>l;l++){for(var m=[],n=0;7>n;n++){var p=g.date(),q=g.isSame(a,"day"),u=g.isSame(b,"day"),t=this._getDayId(g),u=(c={},c["esri-date-picker__day-item--nearby-month"]=!g.isBetween(f,h,null,"[]"),c["esri-date-picker__day-item--today"]=g.isSame(e,"day"),c["esri-date-picker__day-item--active"]=q,c["esri-date-picker__day-item--selected"]=u,c);m.push(d.tsx("div",{"aria-label":p.toString(),"aria-selected":q.toString(),bind:this,class:this.classes("esri-date-picker__day-item",u),"data-iso-date":g.toISOString(),
id:t,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},p));g.add(1,"day")}k.push(d.tsx("div",{class:"esri-date-picker__week-item",role:"row"},m))}return k};b.prototype._renderYearPicker=function(a){var b={year:"numeric"},h=a.clone();a=k.formatDate(h.valueOf(),b);var e=k.formatDate(h.add(1,"year").valueOf(),b),b=k.formatDate(h.subtract(2,"year").valueOf(),b);return d.tsx("div",{class:"esri-date-picker__year-picker"},d.tsx("div",{"aria-label":g.goToPreviousYear,bind:this,
class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setPreviousYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousYear,tabIndex:0,title:g.goToPreviousYear},b),d.tsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:this.id+"__selected-year"},a),d.tsx("div",{"aria-label":g.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setNextYear,
onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextYear,tabIndex:0,title:g.goToNextYear},e))};b.prototype._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value.clone())};b.prototype._setMonth=function(a){this._activeDate.month(a.target.value);this.commitOnMonthChange&&(this.viewModel.value=this._activeDate)};b.prototype._close=function(){this._activeDate=null;this._isOpen=!1;this._calendarPopover.open=!1};b.prototype._open=function(a){this._activeDate=a;this._isOpen=
!0;this._calendarPopover.open=!0};b.prototype._setPreviousMonth=function(){this._activeDate.subtract(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate)};b.prototype._setNextMonth=function(){this._activeDate.add(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate)};b.prototype._setPreviousYear=function(){this._activeDate.subtract(1,"year")};b.prototype._setNextYear=function(){this._activeDate.add(1,"year")};b.prototype._handleSelectedDate=function(a){this.viewModel.value=
r(a.target.getAttribute("data-iso-date"));this._closedByUserAction=!0;this._close()};h([l.aliasOf("viewModel.value")],b.prototype,"value",void 0);h([l.property({type:n}),d.renderable("viewModel.value")],b.prototype,"viewModel",void 0);h([d.accessibleHandler()],b.prototype,"_toggle",null);h([d.accessibleHandler()],b.prototype,"_setPreviousMonth",null);h([d.accessibleHandler()],b.prototype,"_setNextMonth",null);h([d.accessibleHandler()],b.prototype,"_setPreviousYear",null);h([d.accessibleHandler()],
b.prototype,"_setNextYear",null);h([d.accessibleHandler()],b.prototype,"_handleSelectedDate",null);return b=h([l.subclass("esri.widgets.support.DatePicker")],b)}(l.declared(w))});