// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Accessor ../../core/Error ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/interactive/interactiveToolUtils".split(" "),function(e,f,l,d,m,n,p,q,r,t,u,v,c,w){Object.defineProperty(f,"__esModule",{value:!0});e=function(e){function a(b){var a=
e.call(this)||this;a.tool=null;a._baseHandles=new t;a._loggedUnsupportedErrorOnce=!1;a._creationAbortController=null;b&&null!=b.visible&&(a.visible=b.visible);return a}l(a,e);a.prototype.initialize=function(){var b=this;this._baseHandles.add(v.init(this,["view.ready","isSupported"],function(){b.view&&b.view.ready&&!b.isSupported?b._loggedUnsupportedErrorOnce||(b.logUnsupportedError(),b._loggedUnsupportedErrorOnce=!0):b._loggedUnsupportedErrorOnce=!1}))};a.prototype.destroy=function(){this.removeTool();
this.view=null;this._baseHandles.destroy();this._baseHandles=null};Object.defineProperty(a.prototype,"isSupported",{get:function(){return!this.view||this.view.type===this.supportedViewType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"view",{get:function(){return this._get("view")},set:function(b){var a=this;b!==this.view&&(this.removeTool(),this._set("view",b),this._baseHandles.remove("tools"),b&&this._baseHandles.add(b.tools.on("change",function(b){if(a.tool){var c=0;for(b=
b.removed;c<b.length;c++){var d=b[c];if(a.tool===d){d.destroyed||d.destroy();a._set("tool",null);break}}}}),"tools"))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{set:function(b){this._set("visible",b);this.tool&&(this.tool.visible=b);!b&&this._creationAbortController&&(this._creationAbortController.abort(),this._creationAbortController=null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"active",{get:function(){return null!=this._creationAbortController||
null!=this.tool&&this.tool.active},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isDisabled",{get:function(){return!this.view||!this.view.ready||!this.isSupported},enumerable:!0,configurable:!0});a.prototype.createTool=function(){return p(this,void 0,void 0,function(){var b,a,c,d,e,f,k,h=this;return n(this,function(g){switch(g.label){case 0:this.removeTool();if(!this.isSupported)return[2,u.reject(new r("tool:create","The view does not support the tool"))];b=this.createToolParams();
a=function(){var a=w.evaluateToolConstructorArguments(b.constructorArguments);return m({visible:h.visible},a)};c=new AbortController;d=c.signal;this._creationAbortController=c;e=function(){c===h._creationAbortController&&(h._creationAbortController=null)};g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.view.createTool(b.toolConstructor,a,{signal:d})];case 2:return f=g.sent(),this._set("tool",f),e(),[3,4];case 3:throw k=g.sent(),e(),k;case 4:return[2]}})})};a.prototype.removeTool=function(){this._creationAbortController&&
this._creationAbortController.abort();this._creationAbortController=null;var a=this.tool;a&&(this.view&&this.view.tools&&this.view.tools.remove(a),a.destroyed||a.destroy(),this._set("tool",null))};d([c.property({constructOnly:!0})],a.prototype,"tool",void 0);d([c.property({dependsOn:["view.type"]})],a.prototype,"isSupported",null);d([c.property({value:null})],a.prototype,"view",null);d([c.property({type:Boolean,value:!0})],a.prototype,"visible",null);d([c.property({dependsOn:["_creationAbortController",
"tool.active"]})],a.prototype,"active",null);d([c.property({dependsOn:["view","view.ready","isSupported"]})],a.prototype,"isDisabled",null);d([c.property()],a.prototype,"_creationAbortController",void 0);return a=d([c.subclass("esri.widgets.support.InteractiveToolViewModel")],a)}(c.declared(q));f.InteractiveToolViewModel=e});