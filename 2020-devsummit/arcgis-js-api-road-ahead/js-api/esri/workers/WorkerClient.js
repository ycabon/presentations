// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../core/promiseUtils","../core/urlUtils"],function(h,k,g,f){return function(){function d(){var a=this;this.worker=null;this._queue=new Map;this._useProxy=!1;this._acceptMessage=function(b){var e=b.data,c=e.msgId;if(a._queue.has(c)){var d=a._queue.get(c);"error"===e.status?d.reject(b.data):d.resolve(b.data);a._queue.delete(c)}};this._errorMessage=function(a){console.log("Worker Error: "+a.message+"\nIn "+a.filename+" on "+a.lineno)}}d.prototype.setWorker=function(a,b){a=
this._getUrl(a);a=f.normalize(a);var e=!f.hasSameOrigin(a,location.href),c;this.worker&&(c=this.worker,c.removeEventListener("message",this._acceptMessage,!1),c.removeEventListener("error",this._errorMessage,!1),c.terminate(),c=null);e?(e=URL.createObjectURL(new Blob(['\nfunction actionHandler(evt) {\n  var msg \x3d evt.data;\n  var error, success;\n\n  if (msg.action) {\n    switch (msg.action) {\n      case "import-script":\n        try {\n          if (!Array.isArray(msg.url)) {\n            msg.url \x3d [msg.url];\n          }\n\n          importScripts(msg.url);\n          success \x3d true;\n        }\n        catch (err) {\n          error \x3d err;\n        }\n\n        break;\n    }\n\n    if (success) {\n      postMessage({\n        msgId: msg.msgId,\n        success: true\n      });\n    }\n    else if (error) {\n      postMessage({\n        status: "error",\n        msgId: msg.msgId,\n        message: error.message\n      });\n    }\n  }\n}\n\nself.addEventListener("message", actionHandler, false);\n'],
{type:"text/javascript"})),b(this._createWorker(e,a))):b(this._createWorker(a))};d.prototype.postMessage=function(a,b){if(!this.worker)return g.reject({message:"No worker was set."});if(Array.isArray(a)||"object"!==typeof a)a={data:a};var e=g.createDeferred(),c=Math.floor(64E9*Math.random()).toString(36);a.msgId=c;this._queue.set(c,e);b?this.worker.postMessage(a,b):this.worker.postMessage(a);return e.promise};d.prototype.terminate=function(){this.worker&&this.worker.terminate();this._queue.forEach(function(a){a.reject(g.createAbortError("terminated"))});
this._queue.clear()};d.prototype.importScripts=function(a){var b=this;Array.isArray(a)||(a=[a]);a=a.map(function(a){a=b._getUrl(a,!0);b._useProxy&&!f.hasSameOrigin(a,location.href)&&(a=f.getProxyUrl(a).path+"?"+encodeURI(a));return a});return this.postMessage({action:"import-script",url:a}).then(function(a){a.target=b})};d.prototype._createWorker=function(a,b){a=new Worker(a);a.addEventListener("message",this._acceptMessage,!1);a.addEventListener("error",this._errorMessage,!1);this.worker=a;b&&this.importScripts(b);
return a};d.prototype._getUrl=function(a,b){void 0===b&&(b=!1);a.match(/\.js$/)||(a+=".js");a=h.toUrl(a);return b?f.makeAbsolute(a):a};return d}()});