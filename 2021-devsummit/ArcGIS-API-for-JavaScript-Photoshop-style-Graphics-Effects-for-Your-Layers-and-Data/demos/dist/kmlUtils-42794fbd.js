import { a_ as y, L, bf as s, dr as s$1, eM as pt, N as s$2, eN as f, d8 as g$1, ex as u, ew as M } from './_virtual:index-98fd932b.js';
import { S as S$1, i, C, o } from './aaBoundingBox-52683a99.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const c={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function d(o){const t=o.folders||[],r=t.slice(),s$1=new Map,n=new Map,i=new Map,a=new Map,f=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:i,esriGeometryPolygon:a};(o.featureCollection&&o.featureCollection.layers||[]).forEach((o=>{const t=s(o);t.featureSet.features=[];const r=o.featureSet.geometryType;s$1.set(r,t);const f=o.layerDefinition.objectIdField;"esriGeometryPoint"===r?G(n,f,o.featureSet.features):"esriGeometryPolyline"===r?G(i,f,o.featureSet.features):"esriGeometryPolygon"===r&&G(a,f,o.featureSet.features);})),o.groundOverlays&&o.groundOverlays.forEach((e=>{f.set(e.id,e);})),t.forEach((e=>{e.networkLinkIds.forEach((t=>{const s=function(e,o,t){const r=function(e,o){let t;return o.some((o=>o.id===e&&(t=o,!0))),t}(e,t);r&&(r.parentFolderId=o,r.networkLink=r);return r}(t,e.id,o.networkLinks);s&&r.push(s);}));})),r.forEach((o=>{o.featureInfos&&(o.points=s(s$1.get("esriGeometryPoint")),o.polylines=s(s$1.get("esriGeometryPolyline")),o.polygons=s(s$1.get("esriGeometryPolygon")),o.mapImages=[],o.featureInfos.map((e=>{switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const t=l[e.type].get(e.id);t&&o[c[e.type]].featureSet.features.push(t);break}case"GroundOverlay":{const t=f.get(e.id);t&&o.mapImages.push(t);break}}})),o.fullExtent=P([o]));}));const u=P(r);return {folders:t,sublayers:r,extent:u}}function g(e,r,s,n){const f=s$1&&s$1.findCredential(e);e=pt(e,{token:f&&f.token});const l=s$2.kmlServiceUrl;return L(l,{query:{url:e,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(r)},responseType:"json",signal:n})}function S(e,o,t=null,r=[]){const s=[],n={},i=o.sublayers,a=o.folders.map((e=>e.id));return i.forEach((o=>{const i=new e;if(t?i.read(o,t):i.read(o),r.length&&a.indexOf(i.id)>-1&&(i.visible=-1!==r.indexOf(i.id)),n[o.id]=i,null!=o.parentFolderId&&-1!==o.parentFolderId){const e=n[o.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(i);}else s.unshift(i);})),s}function G(e,o,t){t.forEach((t=>{e.set(t.attributes[o],t);}));}async function h(e){const o=g$1.fromJSON(e.featureSet).features,t=e.layerDefinition,r=u(t.drawingInfo.renderer),s=M.fromJSON(e.popupInfo),i=[];for(const e of o){const o=await r.getSymbolAsync(e);e.symbol=o,e.popupTemplate=s,e.visible=!0,i.push(e);}return i}function P(e){const o$1=i(),t=i(C);for(const r of e){if(r.polygons&&r.polygons.featureSet&&r.polygons.featureSet.features)for(const e of r.polygons.featureSet.features)f(o$1,e.geometry),o(t,o$1);if(r.polylines&&r.polylines.featureSet&&r.polylines.featureSet.features)for(const e of r.polylines.featureSet.features)f(o$1,e.geometry),o(t,o$1);if(r.points&&r.points.featureSet&&r.points.featureSet.features)for(const e of r.points.featureSet.features)f(o$1,e.geometry),o(t,o$1);if(r.mapImages)for(const e of r.mapImages)f(o$1,e.extent),o(t,o$1);}return S$1(t,C)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:y.WGS84}}

export { P, S, d, g, h };
