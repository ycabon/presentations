import { q as e, y, cP as n$1, r as i$1, cI as a, e5 as e$1, d8 as g, eY as P, U, L, eZ as i$2 } from './index.js';
import { c as c$3, n as n$2, e as e$2 } from './NAMessage-8f5f744a.js';
import { c as c$2 } from './DirectionsFeatureSet-7cddab48.js';
import './GPMessage-2a62343a.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
let i=class extends a{constructor(o){super(o),this.directions=null,this.route=null,this.routeName=null,this.stops=null;}};e([y({type:c$2,json:{write:!0}})],i.prototype,"directions",void 0),e([y({type:n$1,json:{write:!0}})],i.prototype,"route",void 0),e([y({type:String,json:{write:!0}})],i.prototype,"routeName",void 0),e([y({type:[n$1],json:{write:!0}})],i.prototype,"stops",void 0),i=e([i$1("esri.tasks.support.RouteResult")],i);var u=i;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function n(r){return r&&g.fromJSON(r).features.map((r=>r))}let u$1=class extends a{constructor(r){super(r),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null;}readPointBarriers(r,o){return n(o.barriers||o.pointBarriers)}readPolylineBarriers(r){return n(r)}readPolygonBarriers(r){return n(r)}};e([y({aliasOf:"pointBarriers"})],u$1.prototype,"barriers",void 0),e([y({type:[c$3]})],u$1.prototype,"messages",void 0),e([y({type:[n$1]})],u$1.prototype,"pointBarriers",void 0),e([e$1("pointBarriers",["barriers","pointBarriers"])],u$1.prototype,"readPointBarriers",null),e([y({type:[n$1]})],u$1.prototype,"polylineBarriers",void 0),e([e$1("polylineBarriers")],u$1.prototype,"readPolylineBarriers",null),e([y({type:[n$1]})],u$1.prototype,"polygonBarriers",void 0),e([e$1("polygonBarriers")],u$1.prototype,"readPolygonBarriers",null),e([y({type:[u]})],u$1.prototype,"routeResults",void 0),u$1=e([i$1("esri.tasks.support.RouteResultsContainer")],u$1);var c=u$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const l=e$2({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});let u$2=class extends(n$2(i$2)){constructor(e){super(e);}solve(e,r){const i=[],a=[],n={},p={};return e.stops&&e.stops.features&&this._collectGeometries(e.stops.features,a,"stops.features",n),e.pointBarriers&&e.pointBarriers.features&&this._collectGeometries(e.pointBarriers.features,a,"pointBarriers.features",n),e.polylineBarriers&&e.polylineBarriers.features&&this._collectGeometries(e.polylineBarriers.features,a,"polylineBarriers.features",n),e.polygonBarriers&&e.polygonBarriers.features&&this._collectGeometries(e.polygonBarriers.features,a,"polygonBarriers.features",n),P(a).then((e=>{for(const r in n){const t=n[r];i.push(r),p[r]=e.slice(t[0],t[1]);}return this._isInputGeometryZAware(p,i)?this.getServiceDescription():U({dontCheck:!0})})).then((t=>{("dontCheck"in t?t.dontCheck:t.hasZ)||this._dropZValuesOffInputGeometry(p,i);for(const r in p)p[r].forEach(((t,s)=>{e.get(r)[s].geometry=t;}));let o={query:{...this.parsedUrl.query,f:"json",...l.toQueryParams(e)}};(this.requestOptions||r)&&(o={...this.requestOptions,...r,...o});const{path:a}=this.parsedUrl,n="/solve",u=a.endsWith(n)?a:a+n;return L(u,o)})).then((e=>this._handleSolveResponse(e)))}_collectGeometries(e,r,t,s){s[t]=[r.length,r.length+e.length],e.forEach((e=>{r.push(e.geometry);}));}_handleSolveResponse(e){const r=[],t=[],{directions:s=[],routes:{features:o=[],spatialReference:i=null}={},stops:{features:a=[],spatialReference:n=null}={},barriers:l,polygonBarriers:u,polylineBarriers:c$1,messages:m}=e.data,f="esri.tasks.RouteTask.NULL_ROUTE_NAME";let h,y,d=!0;const g=o&&i||a&&n||l&&l.spatialReference||u&&u.spatialReference||c$1&&c$1.spatialReference;s.forEach((e=>{r.push(h=e.routeName),t[h]={directions:e};})),o.forEach((e=>{-1===r.indexOf(h=e.attributes.Name)&&(r.push(h),t[h]={}),e.geometry&&(e.geometry.spatialReference=g),t[h].route=e;})),a.forEach((e=>{y=e.attributes,-1===r.indexOf(h=y.RouteName||f)&&(r.push(h),t[h]={}),h!==f&&(d=!1),e.geometry&&(e.geometry.spatialReference=g),null==t[h].stops&&(t[h].stops=[]),t[h].stops.push(e);})),a.length>0&&!0===d&&(t[r[0]].stops=t[f].stops,delete t[f],r.splice(r.indexOf(f),1));const B=r.map((e=>(t[e].routeName=e===f?null:e,t[e])));return c.fromJSON({routeResults:B,pointBarriers:l,polygonBarriers:u,polylineBarriers:c$1,messages:m})}};u$2=e([i$1("esri.tasks.RouteTask")],u$2);var c$1=u$2;

export default c$1;
