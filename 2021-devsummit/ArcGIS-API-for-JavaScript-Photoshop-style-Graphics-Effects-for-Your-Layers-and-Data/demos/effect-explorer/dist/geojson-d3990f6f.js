import { eK as t, h as s$1, aF as t$1 } from './index.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function o(e){const t=[];return e.forEach((e=>t.push(e))),t}const r={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*i(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t);}}function*s(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e;}}function c(e){for(;;){const{value:t,done:n}=e.next();if(n)return !1;if(t.length>2)return !0}}function u(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1];}return t<=0}function l(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function f(e,t,n){switch(t.type){case"LineString":return function(e,t,n){return p(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const o of t.coordinates)p(e,o,n);return e}(e,t,n);case"MultiPoint":return function(e,t,n){return p(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const o of t.coordinates){a(e,o[0],n);for(let t=1;t<o.length;t++)y(e,o[t],n);}return e}(e,t,n);case"Point":return function(e,t,n){return g(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const o=t.coordinates;a(e,o[0],n);for(let t=1;t<o.length;t++)y(e,o[t],n);return e}(e,t,n)}}function a(e,t,n){const o=l(t);u(o)?p(e,o,n):d(e,o,n);}function y(e,t,n){const o=l(t);u(o)?d(e,o,n):p(e,o,n);}function p(e,t,n){for(const o of t)g(e,o,n);e.lengths.push(t.length);}function d(e,t,n){for(let o=t.length-1;o>=0;o--)g(e,t[o],n);e.lengths.push(t.length);}function g(e,t,n){const[o,r,i]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(i||0);}function m(e){switch(typeof e){case"string":return "esriFieldTypeString";case"number":return "esriFieldTypeDouble";default:return "unknown"}}function h(t){if(!t)throw new s$1("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==t.type&&"FeatureCollection"!==t.type)throw new s$1("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:n}=t;if(!n)return;const o="string"==typeof n?n:"name"===n.type?n.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new s$1("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function w(e,t={}){const n=i(e),u=[],l=new Set,f=new Set;let a,y=!1,p=Number.NEGATIVE_INFINITY,d=null,g=!1,{geometryType:h=null}=t,w=!1;for(;;){const{value:e,done:t}=n.next();if(t){const e=d&&1===d.length&&d[0]||null;if(e)for(const t of u)t.name===e&&(t.type="esriFieldTypeOID");return {fields:u,geometryType:h,hasZ:y,maxObjectId:Math.max(0,p),objectIdFieldName:e,objectIdFieldType:a,unknownFields:o(f)}}const{geometry:i,properties:b,id:P}=e;if(!i||(h||(h=r[i.type]),r[i.type]===h)){if(!y){y=c(s(i));}if(g||(g=null!=P,g&&(a=typeof P,"number"===a&&(d=Object.keys(b).filter((e=>b[e]===P))))),g&&"number"===a&&null!=P&&(p=Math.max(p,P),d.length>1?d=d.filter((e=>b[e]===P)):1===d.length&&(d=b[d[0]]===P?d:[])),!w&&b){let e=!0;for(const t in b){if(l.has(t))continue;const n=b[t];if(null==n){e=!1,f.add(t);continue}const o=m(n);"unknown"!==o?(f.delete(t),l.add(t),u.push({name:t,alias:t,type:o})):f.add(t);}w=e;}}}}function b(e,o){return function(e){const t=[];for(;;){const{value:n,done:o}=e.next();if(o)return t;t.push(n);}}(function*(e,o={}){const{geometryType:i,objectIdFieldName:s}=o;for(;;){const{value:c,done:u}=e.next();if(u)return;const{geometry:l,properties:a,id:y}=c;if(l&&r[l.type]!==i)continue;const p=a||{};s&&null!=y&&!p[s]&&(p[s]=y);const d=new t(l?f(new t$1,l,o):null,p);yield d;}}(i(e),o))}

export { b, h, w };
