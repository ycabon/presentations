import { b as a$b, D, s as s$c, c as e$6, m as m$5, d as e$7, i as i$7, g as t$b, h as s$d, P as P$1, Q, j as o$9, p as p$3, k as c$9, l as a$c, n as e$8, q as e$9, y as y$1, r as i$8, v as p$4, a as u$4, w as f$7, x as v$3, z as t$e, U as U$1, L, A as r$b, B as h$c, C as d$a, E as m$7, X, T, F as j$2, G as s$g, t as t$f, H as r$c, I as y$3, J as u$5, K as n$a, M as J, N as A, O as B, R as F$1, S as E$1, V as S, W as s$h, Y as i$f, Z as n$b, _ as e$c, e as e$d, $ as s$i, a0 as v$4, a1 as r$f, a2 as d$b, a3 as n$c, a4 as h$d, a5 as c$a, a6 as l$9, a7 as e$e, a8 as n$d, a9 as r$g, aa as r$h, ab as e$f, ac as n$e, ad as o$c, ae as s$j, af as d$c, ag as u$6, ah as w$2, ai as At, aj as o$d, ak as t$i, al as _$3, am as wt, an as X$1, ao as ht, ap as ft, aq as jt, ar as p$5, as as u$7, at as I$1, au as l$a } from './index.js';
import { i as i$d, r as r$d, t as t$g, c as t$h, l as l$8 } from './RenderingContext-65298a94.js';
import { a as a$d, i as i$a, o as o$b } from './VertexArrayObject-4975422d.js';
import { t as t$d, n as n$8 } from './ShaderCompiler-e329735c.js';
import { I, O, E as E$2 } from './Utils-a8735f16.js';
import { r as r$e, a as a$f } from './Container-aff74082.js';
import { h as h$a, l as l$7, m as m$6, f as f$5, s as s$f, i as i$9, t as t$c, o as o$a, a as i$e, g as g$2 } from './WGLContainer-be0dfffa.js';
import { s as s$e } from './ProgramCache-1c304585.js';
import { h as h$b, y as y$2, i as i$b, n as n$9 } from './shapingUtils-87458a4f.js';
import { r as r$a, a as a$e, f as f$6, e as e$a } from './WGLMeshFactory-9c4f2842.js';
import { i as i$c } from './Rect-49fd2d8c.js';
import { P as P$2 } from './GeometryUtils-83dd86c8.js';
import { e as e$b } from './CircularArray-ace18093.js';
export { Q as GraphicsView2D } from './GraphicsView2D-aac2bc15.js';
import { t as t$j } from './requestImageUtils-b1feb81d.js';
import './_commonjsHelpers-34398bae.js';
import './mat4f32-a4d1c0af.js';
import './earcut-54ba3d1d.js';
import './MaterialKey-9e164379.js';
import './BidiEngine-e6ac532e.js';
import './MD5-5f4e3a98.js';
import './visualVariablesUtils-aa4bb9a6.js';
import './VertexBuffer-0de68176.js';
import './TurboLine-7e396736.js';
import './quantizationUtils-e428adec.js';
import './json-dc26b8a4.js';
import './quickselect-1f1691b9.js';
import './FeatureContainer-7e56c667.js';
import './TileContainer-fd402c56.js';
import './ComputedAttributeStorage-8a9574b4.js';
import './FeatureSetReader-9e82c0c1.js';
import './centroid-6105d00e.js';
import './graphicsUtils-2d5bfdbd.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class t{constructor(){this._reference=null;}get dirty(){return this.reference&&this.reference.isDirty}set dirty(e){this.reference&&this.reference.hasData&&(e||this.reference.isDirty)&&(this.reference.isDirty=e);}get index(){return this._reference&&this._reference.labelIndex}get reference(){return this._reference}set reference(e){this._reference=e;}reset(s,n,i){const{state:c}=s,o=i.layerView.tileRenderer,f=this.reference;if(!f||!f.hasData)return !1;n&&(f.isDirty=!0);const a=f.transforms.labelMat2d,h=a[4],u=a[5];for(const s of f.displayObjects){const n=o.featuresView.attributeView,l=i.hasVV()?n.getVVSize(s.id):0;for(const n of s.metrics){i.hasVV()&&n.computeVVOffset(l,i.vvEval);const s=n.bounds.center,o=n.bounds.centerT;f.isDirty&&(n.minZoom=-1);const d=a$b(o,n.anchor);if(c.rotation?D(d,d,a):(o[0]=d[0]+h,o[1]=d[1]+u),s$c(o,d,s),o[0]+=n.offsetX,o[1]+=n.offsetY,n.boxes)for(const e of n.boxes){const s=e.center,i=n.anchor,o=e.centerT;s$c(o,i,s),c.rotation?D(o,o,a):(o[0]=o[0]+h,o[1]=o[1]+u);}}}return !0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class c{constructor(e,i){this.neighbors=new Array(9),this._tiles=new Array(i);for(let e=0;e<i;e++)this._tiles[e]=new t;this.key=e;}get isDirty(){for(const e of this._tiles)if(e.dirty)return !0;return !1}get size(){return this._tiles.length}getTile(e){return this._tiles[e]}getReference(e){const t=this._tiles[e];return t&&t.reference}onRegisterLayer(e){this.invalidateRange(e),this._add(e);}onUnregisterLayer(e){this.invalidateRange(e),this._remove(e);}onLabelsRendered(){}invalidateRange(e){for(let t=e;t<this._tiles.length;t++)this._tiles[t].dirty=!0;}add(e){this._add(e);}remove(e){this._remove(e);}canDelete(){return 0===this._tiles.length}ready(){for(const e of this._tiles)e.dirty=!1;}computeNeighbors(e){this.neighbors[0]=this._getNeighbor(e,-1,-1),this.neighbors[1]=this._getNeighbor(e,0,-1),this.neighbors[2]=this._getNeighbor(e,1,-1),this.neighbors[3]=this._getNeighbor(e,-1,0),this.neighbors[4]=this,this.neighbors[5]=this._getNeighbor(e,1,0),this.neighbors[6]=this._getNeighbor(e,-1,1),this.neighbors[7]=this._getNeighbor(e,0,1),this.neighbors[8]=this._getNeighbor(e,1,1);}reset(e,t,i){const s=this._tiles[i.index];s&&s.reset(e,t,i);}_add(e){const i=[];if(e>=this._tiles.length)this._tiles.push(new t);else {for(let s=0;s<this._tiles.length;s++)s===e&&i.push(new t),i.push(this._tiles[s]);this._tiles=i;}}_remove(e){const t=[];for(let i=0;i<this._tiles.length;i++)i!==e&&t.push(this._tiles[i]);this._tiles=t;}_getNeighbor(t,i,s){const r=this.key,h=r.col+i,n=r.row+s,o=r.level,l=r.world,g=e$6.getId(o,n,h,l);return t.has(g)?t.get(g):null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const e=Math.PI;function r(r,i){switch(i.transformationType){case"additive":return function(t,n){const e=a(n.minSize,t);return t+(e||n.minDataValue)}(r,i);case"constant":return function(t,n){const e=t.stops;let r=e&&e.length&&e[0].size;null==r&&(r=t.minSize);return a(r,n)}(i,r);case"clamped-linear":return function(t,n){const e=(t-n.minDataValue)/(n.maxDataValue-n.minDataValue),r=a(n.minSize,t),i=a(n.maxSize,t);if(t<=n.minDataValue)return r;if(t>=n.maxDataValue)return i;return r+e*(i-r)}(r,i);case"proportional":return function(n,e){const r=n/e.minDataValue,i=a(e.minSize,n),u=a(e.maxSize,n);let s=null;return s=r*i,e$7(s,i,u)}(r,i);case"stops":return function(t,n){const[e,r,i]=function(t,n){if(!n)return;let e=0,r=n.length-1;return n.some(((n,a)=>t<n?(r=a,!0):(e=a,!1))),[e,r,(t-n[e])/(n[r]-n[e])]}(t,n.cache.ipData);if(e===r)return a(n.stops[e].size,t);{const u=a(n.stops[e].size,t);return u+(a(n.stops[r].size,t)-u)*i}}(r,i);case"real-world-size":return function(r,i){const u=m$5[i.valueUnit],s=a(i.minSize,r),o=a(i.maxSize,r),{valueRepresentation:c}=i;let l=null;l="area"===c?2*Math.sqrt(r/e)/u:"radius"===c||"distance"===c?2*r/u:r/u;return e$7(l,s,o)}(r,i);case"identity":return r;case"unknown":return null}}function a(t,n){return "number"==typeof t?t:r(n,t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const i=(e,t)=>e.order-t.order,n=(e,t)=>e.index-t.index,l=i$7.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");function s(e,r){const o=!!e.minScale,i=!!e.maxScale,n=o&&r.scaleToZoom(e.minScale)||0,l=i&&r.scaleToZoom(e.maxScale)||255;return {deconflictionStrategy:e.deconflictionStrategy,minZoom:e$7(Math.floor(10*n),0,255),maxZoom:e$7(Math.floor(10*l),0,255)}}function a$1(e){return t=>t$b(r(t,e))}function c$1(e){if(!e)return null;for(const t of e)if("size"===t.type)return a$1(t);return null}class d{constructor(e,t,r,o){this._vvHandle=null;const i=e.layer,{geometryType:n,labelingInfo:l,renderer:a}=i;a&&(this.vvEval=c$1("visualVariables"in a&&a.visualVariables)),this._vvHandle=i.watch("renderer",(e=>{e&&(this.vvEval=c$1("visualVariables"in e&&e.visualVariables));}));const d=i.featureReduction,f=d&&"cluster"===d.type&&d.labelingInfo,m=(l||[]).map((e=>s(e,o))),u=(f||[]).map((e=>s(e,o)));this.layerView=e,this.geometryType=n,this.index=t,this.order=r,this.zoomRanges=[...m,...u],this.layerView=e;}hasVV(){return !!this.vvEval}allOrNothing(){return !("polyline"===this.geometryType)}destroy(){this._vvHandle.remove();}static create(e,t,r,o){const n=r.sort(i);let l=!1,s=-1;for(const e of n)!l&&e.order>t&&(s=e.index,l=!0),l&&e.index++;return l||(s=n.length),new d(e,s,t,o)}static delete(e,t){const r=t.sort(n);for(let o=e+1;o<r.length;o++)t[o].index--;t[e].destroy(),t.splice(e,1);}static find(e,t){for(const r of t)if(r.index===e)return r;return l.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!"),null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const h=o$9/p$3,f=h,m=i$7.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");class u{constructor(e){this._layers=new Map,this._collisionBuckets=new Map,this._didError=!1,this._tilingScheme=e;}get collisionInfos(){return Array.from(this._layers.values())}registerLayerView(e,i){if(this._layers.has(e))return;const t=d.create(e,i,this.collisionInfos,this._tilingScheme);this._layers.set(e,t),this._collisionBuckets.forEach((e=>e.onRegisterLayer(t.index)));}unregisterLayerView(e){if(!this._layers.has(e))return;const i=this._layers.get(e);d.delete(i.index,this.collisionInfos),this._layers.delete(e),this._collisionBuckets.forEach(((e,t)=>{const s=e.getTile(i.index);s&&(e.onUnregisterLayer(i.index),e.canDelete()&&this._collisionBuckets.delete(t),s.reference&&(s.reference.isDirty=!1));}));}addTile(e,i){const t=i.key.id;if(!this._layers.has(e))return;this._collisionBuckets.has(t)||this._collisionBuckets.set(t,new c(i.key,this._layers.size));const s=this._getIndex(e);this._collisionBuckets.get(t).getTile(s).reference=i;}removeTile(e,i){if(!this._layers.has(e)||!this._collisionBuckets.has(i))return;const t=this._getIndex(e),s=this._collisionBuckets.get(i).getTile(t);s.dirty=!1,s.reference=null;}run(e,t){const s=Array.from(this._collisionBuckets.values()).sort(((e,i)=>e.key.compareRowMajor(i.key)));let o=!0;const r=e.renderingOptions.labelCollisionsEnabled&&!this._didError,n=this.collisionInfos;try{for(const i of s){o=o||i.isDirty,i.computeNeighbors(this._collisionBuckets);for(let t=0;t<this._layers.size;t++){const s=d.find(t,n);i.reset(e,o,s);}}for(let e=0;e<this._layers.size;e++){const i=d.find(e,n);for(const e of s)this._run(r,e,i,t);}}catch(e){m.error(new s$d("mapview-labeling","Encountered an error during decluttering. Disabling collisions",e)),this._didError=!0;}for(const e of s)e.ready();}_run(e,i,t,s){const o=i.getReference(t.index);o&&o.hasData&&(o.key.level!==s?this._resetLabelsMinZoom(i,t):this._runVisibility(e,i,o,t,s));}_resetLabelsMinZoom(e,i){if(!e||"polyline"===i.geometryType)return;const t=e.getReference(i.index);if(!t||!t.hasData)return;const s=i.layerView.tileRenderer.featuresView.attributeView,o=t.displayObjects;for(const e of o)s.setLabelMinZoom(e.id,255);}_checkLabelsVisible(e,i){const t=!i.filter||!!(e&P$1),s=!i.effect||i.effect.excludedLabelsVisible||!!(e&Q);return t&&s}_runVisibility(e,i,t,s,o){const r=s.layerView.tileRenderer.featuresView.attributeView,n=t.displayObjects.sort(((e,i)=>r.getLabelMinZoom(e.id)-r.getLabelMinZoom(i.id))),l=s.zoomRanges.some((e=>"none"===e.deconflictionStrategy));for(const t of n){if(!t.metrics.length)continue;let n="polyline"===s.geometryType?0:10*(o-1);const c=r.getFilterFlags(t.id),a=this._checkLabelsVisible(c,s.layerView);if(e&&!l)for(let e=0;e<t.metrics.length;e++){const r=t.metrics[e],l=a?-1!==r.minZoom?r.minZoom:this._computeLabelVisibility(t,r,s.index,i,r.baseZoom,o):255;n=Math.max(l,n);}n=Math.max(n,0),r.setLabelMinZoom(t.id,n);for(const e of t.metrics)e.minZoom=n;}}_computeLabelVisibility(e,i,t,s,o,r){let n=o;const{xBucket:l,yBucket:c,xOverflow:a,yOverflow:m}=i,u=l-a,g=l+a+1,d=c+m+1;for(let o=c-m;o<d;o++)for(let l=u;l<g;l++)if(!(l<-h||o<-f||l>h||o>f))for(let c=0;c<=t;c++){const a=this._getRelativeSubBucket(c,s,l,o);if(a)for(const s of a){if(c===t&&s.id===e.id)continue;const o=this._compareLabels(i,s,n,r);n=Math.max(o,n);}}return n}_compareLabels(e,i,s,o){const r=10*(o+1);if(-1===i.minZoom||i.minZoom>r)return s;const n=e.findCollisionDelta(i),l=e$7(Math.ceil(10*(n+o)),0,255);return i.minZoom>=l?s:Math.max(s,l)}_getNeighboringTile(e,i,t,s){const o=3*(1+s)+(1+t),r=i.neighbors[o];return r&&r.getTile(e)}_getRelativeSubBucket(e,i,t,o){const r=c$9(Math.floor(t/4)),n=c$9(Math.floor(o/4)),l=this._getNeighboringTile(e,i,r,n);return l&&l.reference&&l.index&&l.reference.hasData?l.index[o-4*n][t-4*r]:null}_getIndex(e){return this._layers.get(e).index}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const t$1=i$7.getLogger("esri.views.2d.engine.collisions.LayerViewSorter");function i$1(e){return "esri.views.2d.layers.FeatureLayerView2D"===e.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===e.declaredClass}function a$2(e){if(!e.layer||!e.layer.renderer)return !1;switch(e.layer.renderer.type){case"class-breaks":case"simple":case"unique-value":case"dictionary":case"dot-density":return !0;default:return t$1.error(new s$d("mapview-labeling",`Renderer of type ${e.layer.renderer.type} does not currently support labeling`)),!1}}class s$1{constructor(e,r){this.registerLayer=e,this.unregisterLayer=r,this._layerViewState=new Map;}findIndex(e){return e.view.allLayerViews.findIndex((r=>r.uid===e.uid))}update(e){const{added:r,removed:t}=e;for(const e of t)i$1(e)&&this._layerViewState.has(e)&&this._deleteState(e);for(const e of r)i$1(e)&&a$2(e)&&!this._layerViewState.has(e)&&this._createState(e);this._recomputeOrder();}destroy(){this._layerViewState.forEach((e=>e.handles.forEach((e=>e.remove()))));}_createState(e){const r={priority:-1,handles:null};return r.handles=[e.layer.watch("visible",this._recomputeOrder.bind(this)),e.layer.watch("labelsVisible",this._recomputeOrder.bind(this)),e.layer.watch("labelingInfo",this._recomputeOrder.bind(this)),e.layer.watch("featureReduction",this._recomputeOrder.bind(this))],this._layerViewState.set(e,r),r}_deleteState(e){if(!this._layerViewState.has(e))return;const r=this._layerViewState.get(e);r.handles.forEach((e=>e.remove())),-1!==r.priority&&this.unregisterLayer(e),this._layerViewState.delete(e);}_recomputeOrder(){this._layerViewState.forEach(((e,r)=>{const t=r.view.map.allLayers.findIndex((e=>e.uid===r.layer.uid)),i=r.layer,a=i.featureReduction,s=a&&"cluster"===a.type&&a.labelsVisible&&a.labelingInfo&&a.labelingInfo.length,l=i.labelsVisible&&i.labelingInfo&&i.labelingInfo.length||s,n=i.visible&&l?4294967295-t:-1;n!==e.priority&&(e.priority=n,this.unregisterLayer(r),-1!==n&&this.registerLayer(r,n));}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const d$1=i$7.getLogger("esri.views.2d.layers.labels.LabelManager");let u$1=class extends(a$c(p$4)){constructor(e){super(e),this._applyVisibilityPassThrottled=e$8(this._applyVisibilityPass,64,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null;}initialize(){this.collisionEngine=new u(this.view.featuresTilingScheme),this._layerViewSorter=new s$1(((e,t)=>{this.collisionEngine.registerLayerView(e,t);const i=e.tileRenderer;i&&i.forEachTile((t=>{t.isDirty=!0,this.addTile(e,t);})),this.requestUpdate();}),(e=>{this.collisionEngine.unregisterLayerView(e),this.requestUpdate();})),this.handles.add(this.view.allLayerViews.on("change",(e=>{this._layerViewSorter.update(e);})));}destroy(){this._layerViewSorter.destroy(),this._layerViewSorter=null,this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null;}get updating(){return this.updateRequested}update(e){this._applyVisibilityPassThrottled(e);}viewChange(){this.requestUpdate();}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate());}processUpdate(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e));}addTile(e,t){this.collisionEngine.addTile(e,t);}removeTile(e,t){this.collisionEngine.removeTile(e,t);}_applyVisibilityPass(e){try{const t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(e,t);}catch(e){d$1.error(new s$d("mapview-labeling","Encountered an error during label decluttering",e));}}};e$9([y$1()],u$1.prototype,"updateRequested",void 0),e$9([y$1({readOnly:!0})],u$1.prototype,"updateParameters",void 0),e$9([y$1({dependsOn:["updateRequested"]})],u$1.prototype,"updating",null),e$9([y$1()],u$1.prototype,"view",void 0),u$1=e$9([i$8("esri.views.2d.layers.labels.LabelManager")],u$1);var c$2=u$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class o{constructor(t){this._cache=new Array(8);for(let r=0;r<8;r++)this._cache[r]={};this._programRepo=new s$e(t);}dispose(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null);}getProgram(r,t,e){const s=this._cache[r];if(!s[t]){const a=this._programRepo.getProgram(this._getProgramTemplate(r),e);s[t]=a;}return s[t]}getProgramAttributes(r){switch(r){case 0:return t$c.attributes;case 5:return i$9.attributes;case 1:return s$f.attributes;case 4:return f$5.attributes;case 3:return m$6.attributes;case 2:return l$7.attributes;case 6:return h$a.attributes;default:return null}}_getProgramTemplate(r){switch(r){case 0:return t$c;case 5:return i$9;case 1:return s$f;case 4:return f$5;case 3:return m$6;case 2:return l$7;case 6:return h$a;default:return null}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const e$1={name:"bitBlit",shaders:{vertexShader:o$a("bitBlit/bitBlit.vert"),fragmentShader:o$a("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class s$2{constructor(){this._initialized=!1;}dispose(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null);}render(r,t,e,i){r&&(this._initialized||this._initialize(r),r.setBlendFunctionSeparate(1,771,1,771),r.bindVAO(this._vertexArrayObject),r.bindProgram(this._program),t.setSamplingMode(e),r.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",i),r.drawArrays(5,0,4),r.bindTexture(null,0),r.bindVAO());}_initialize(s){if(this._initialized)return !0;const o=e$1.attributes,a=t$d(s,e$1);if(!a)return !1;const n=new Int8Array(16);n[0]=-1,n[1]=-1,n[2]=0,n[3]=0,n[4]=1,n[5]=-1,n[6]=1,n[7]=0,n[8]=-1,n[9]=1,n[10]=0,n[11]=1,n[12]=1,n[13]=1,n[14]=1,n[15]=1;const m=new a$d(s,o,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:i$a.createVertex(s,35044,n)});return this._program=a,this._vertexArrayObject=m,this._initialized=!0,!0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const t$2=r=>{let e="";e+=r[0].toUpperCase();for(let t=1;t<r.length;t++){const s=r[t];s===s.toUpperCase()?(e+="_",e+=s):e+=s.toUpperCase();}return e},s$3=e=>{const s={};for(const r in e){s[t$2(r)]=e[r];}return n$8(s)},o$1=(r,t,o)=>{const n=r+r.substring(r.lastIndexOf("/")),a=t+t.substring(t.lastIndexOf("/"));return {name:name,attributes:o,shaders:r=>({vertexShader:s$3(r)+o$a(`${n}.vert`),fragmentShader:s$3(r)+o$a(`${a}.frag`)})}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const a$3=r=>r===I.HITTEST||r===I.LABEL_ALPHA,s$4=({rendererInfo:e,drawPhase:o},s,i,n)=>`${s.getVariationHash()}-${n.join(".")}-${(r=>(a$3(r)?1:0)|(r===I.HIGHLIGHT?2:0))(o)}-${e.getVariationHash()}-${u$4(i)&&i.join(".")}`;class a$4{constructor(r){this._programByKey=new Map,this._programCache=new s$e(r);}dispose(){this._programCache&&this._programCache.dispose();}getProgram(r,e,t=[],a=[]){const s=e.vsPath+"."+e.fsPath+JSON.stringify(t)+a.join(".");if(this._programByKey.has(s))return this._programByKey.get(s);const i=a.reduce(((e,t)=>({...e,[t]:r.driverTestResult[t]})),{}),n={...t.map((r=>"string"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{}),...i},{vsPath:g,fsPath:m,attributes:h}=e,p=this._programCache.getProgram(o$1(g,m,h),n);if(!p)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(s,p),p}getMaterialProgram(e,i,n,g,m,h=["ignoresSamplerPrecision"]){const p=s$4(e,i,m,h);if(this._programByKey.has(p))return this._programByKey.get(p);const c=((e,o,s,i)=>{const n=i.reduce(((r,t)=>({...r,[t]:e.driverTestResult[t]})),{}),g={...o.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===I.HIGHLIGHT,id:a$3(e.drawPhase),...n};if(u$4(s))for(const r of s)g[r]=!0;return g})(e,i,m,h),f=this._programCache.getProgram(o$1(n,n,g),c);if(!f)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(p,f),f}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class l$1{dispose(){this._rasterizationCanvas=null;}rasterizeJSONResource(e,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[r,a,n]=h$b.rasterizeSimpleFill(this._rasterizationCanvas,e.style,s);return {size:[a,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){const[r,a,n]=h$b.rasterizeSimpleLine(e.style,e.cap);return {size:[a,n],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(m=y$2.fromSimpleMarker(e),f=r$a(m)):"CIMHatchFill"===e.type?(m=y$2.fromCIMHatchFill(e),l=new i$b(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(m=y$2.fromCIMInsidePolygon(e),l=new i$b(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e,f=r$a(m)),f&&!o){const[e,r,t]=f$6(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=y$2.rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(r,t,a,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=r,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext("2d");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute("width",`${r}px`),a.setAttribute("height",`${t}px`),i.drawImage(a,0,0,r,t));const s=i.getImageData(0,0,r,t),o=new Uint8Array(s.data);if(n)for(const e of n)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[r,t,a,n]=e.oldColor,[i,s,m,l]=e.newColor;if(r===i&&t===s&&a===m&&n===l)continue;for(let e=0;e<o.length;e+=4)r===o[e]&&t===o[e+1]&&a===o[e+2]&&n===o[e+3]&&(o[e]=i,o[e+1]=s,o[e+2]=m,o[e+3]=l);}let m;for(let e=0;e<o.length;e+=4)m=o[e+3]/255,o[e]=o[e]*m,o[e+1]=o[e+1]*m,o[e+2]=o[e+2]*m;let l=o,f=r,c=t;const h=512;if(f>=h||c>=h){const a=f/c;a>1?(f=h,c=Math.round(h/a)):(c=h,f=Math.round(h*a)),l=new Uint8Array(4*f*c);const n=new Uint8ClampedArray(l.buffer);a$e(o,r,t,n,f,c,!1);}return {size:[r,t],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function e$2(e){const r=function(e){if(!e.weight)return "";switch(e.weight.toLowerCase()){case"bold":case"bolder":return "-bold"}return ""}(e)+function(e){if(!e.style)return "";switch(e.style.toLowerCase()){case"italic":case"oblic":return "-italic"}return ""}(e);return function(e){const r=e.toLowerCase().split(" ").join("-");switch(r){case"serif":return "noto-serif";case"sans-serif":return "arial-unicode-ms";case"monospace":return "ubuntu-mono";case"fantasy":return "cabin-sketch";case"cursive":return "redressed";default:return r}}(e.family)+(r.length>0?r:"-regular")}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class h$1{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new i$c(0,0,t,e));}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new i$c;let i=null,s=-1;for(let h=0;h<this._free.length;++h){const r=this._free[h];t<=r.width&&e<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,s=h);}return null===i?new i$c:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new i$c(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new i$c(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new i$c(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new i$c(i.x,i.y+e,t,i.height-e))),new i$c(i.x,i.y,t,e))}release(h){for(let t=0;t<this._free.length;++t){const e=this._free[t];if(e.y===h.y&&e.height===h.height&&e.x+e.width===h.x)e.width+=h.width;else if(e.x===h.x&&e.width===h.width&&e.y+e.height===h.y)e.height+=h.height;else if(h.y===e.y&&h.height===e.height&&h.x+h.width===e.x)e.x=h.x,e.width+=h.width;else {if(h.x!==e.x||h.width!==e.width||h.y+h.height!==e.y)continue;e.y=h.y,e.height+=h.height;}this._free.splice(t,1),this.release(h);}this._free.push(h);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const a$5=t=>Math.floor(t/256);class m$1{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=i,this._binPack=new h$1(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph();}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0;}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let i=0;i<t.length;i++){const h=t[i];for(let t=0;t<11;t++)e.push(h);}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i);}async getGlyphItems(t,e,i){const h=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(h,t,e)))}bind(t,e,i,h){const s=this._getTexture(t,i);s.setSamplingMode(e),this._dirties[i]&&(s.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(s,h);}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){return this._textures[e]||(this._textures[e]=new i$d(t,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0;}async _fetchRanges(t,i,h){const s=function(t){const e=new Set;for(const i of t)e.add(a$5(i));return e}(i),r=[];s.forEach((e=>{r.push(this._fetchRange(t,e,h));})),await f$7(r);}async _fetchRange(t,e,h){if(e>256)return null;const s=t+e;return r=this._rangePromises,a=s,n=()=>this._glyphSource.getRange(t,e,h),r.has(a)||r.set(a,n().then((()=>{r.delete(a);})).catch((t=>{r.delete(a),v$3(t);}))),r.get(a);var r,a,n;}_getMosaicItem(t,e,i){if(!t[i]){const h=this._glyphSource.getGlyph(e,i);if(!h||!h.metrics)return (t=>({rect:new i$c(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}))(i);const r=this._recordGlyph(h),a=this._currentPage,n=h.metrics;t[i]={rect:r,page:a,metrics:n,code:i,sdf:!0},this._invalidate();}return t[i]}_getMosaicItemsStable(t,e,i){const h=[],s=i.map((t=>t));return i.map((t=>t)).sort().map((i=>this._getMosaicItem(t,e,i))).forEach((t=>{const e=s.indexOf(t.code);h[e]=t,s[e]=null;})),h}_recordGlyph(e){const i=e.metrics;let h;if(0===i.width)h=new i$c(0,0,0,0);else {const s=3,a=i.width+2*s,n=i.height+2*s;h=this._binPack.allocate(a,n),h.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new h$1(this.width-4,this.height-4),h=this._binPack.allocate(a,n));const c=this._glyphData[this._currentPage],o=e.bitmap;let l,g;if(o)for(let t=0;t<n;t++){l=a*t,g=this.width*(h.y+t)+h.x;for(let t=0;t<a;t++)c[g+t]=o[l+t];}t$e("esri-glyph-debug")&&this._showDebugPage(c);}return h}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),h=new ImageData(this.width,this.height),s=h.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let e=0;e<t.length;++e)s[4*e+0]=t[e],s[4*e+1]=0,s[4*e+2]=0,s[4*e+3]=255;i.putImageData(h,0,0),document.body.appendChild(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class a$6{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let s,a,r,n,i,c,g;for(;t.next();)switch(t.tag()){case 1:s=t.getUInt32();break;case 2:a=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:g=t.getUInt32();break;default:t.skip();}t.release(),s&&(this._metrics[s]={width:r,height:n,left:i,top:c,advance:g},this._bitmaps[s]=a);break}default:e.skip();}e.release();break}default:t.skip();}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class r$1{constructor(){this._ranges=[];}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e;}}class f$1{constructor(t){this._glyphInfo={},this._baseURL=t;}getRange(r,n,i){const c=this._getFontStack(r);if(c.getRange(n))return U$1();const g=256*n,o=g+255,h=this._baseURL.replace("{fontstack}",r).replace("{range}",g+"-"+o);return L(h,{responseType:"array-buffer",...i}).then((t=>{c.addRange(n,new a$6(new r$b(new Uint8Array(t.data),new DataView(t.data))));}))}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const a=Math.floor(e/256);if(a>256)return;const r=s.getRange(a);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new r$1),e}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const r$2=[1,256,65536,16777216],t$3=[1/256,1/65536,1/16777216,1/4294967296],n$1=function(r,n=0){let o=0;for(let e=0;e<4;e++)o+=r[n+e]*t$3[e];return o}(new Uint8ClampedArray([255,255,255,255]));function o$2(t,o,e=0){const f=function(r,t,n){if(r<t)return t;if(r>n)return n;return r}(t,0,n$1);for(let t=0;t<4;t++)o[e+t]=Math.floor(256*((u=f*r$2[t])-Math.floor(u)));var u;}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const h$2=1e20;class y{constructor(t){this.size=t;const s=document.createElement("canvas");s.width=s.height=t,this._context=s.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t);}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null);}draw(r,n,o=31){this._initSVG();const a=this._createSVGString(r);return h$c(((t,r)=>{const d=new Image;d.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(a),d.onload=()=>{d.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(d,0,0,this.size,this.size);const s=this._context.getImageData(0,0,this.size,this.size),e=new Uint8Array(this.size*this.size*4);for(let t=0;t<this.size*this.size;t++){const e=s.data[4*t+3]/255;this._gridOuter[t]=1===e?0:0===e?h$2:Math.pow(Math.max(0,.5-e),2),this._gridInner[t]=1===e?h$2:0===e?0:Math.pow(Math.max(0,e-.5),2);}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let t=0;t<this.size*this.size;t++){const s=this._gridOuter[t]-this._gridInner[t];o$2(.5-s/(2*o),e,4*t);}t(e);};const l=n&&n.signal;l&&d$a(l,(()=>r(m$7())));}))}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t;}}_createSVGString(t){const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",t),this._svg.appendChild(s);const e=s.getBBox(),i=e.width/e.height,h=this.size/2;let r,n,o,a;if(i>1){n=r=h/e.width;const t=h*(1/i);o=this.size/4,a=h-t/2;}else {r=n=h/e.height;o=h-h*i/2,a=this.size/4;}const d=-e.x*r+o,l=-e.y*n+a;s.setAttribute("style",`transform: matrix(${r}, 0, 0, ${n}, ${d}, ${l})`);const _=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${this._svg.innerHTML}</svg>`;return this._svg.removeChild(s),_}_edt(t,s,e){const i=this._f,h=this._d,r=this._v,n=this._z;for(let o=0;o<s;o++){for(let h=0;h<e;h++)i[h]=t[h*s+o];this._edt1d(i,h,r,n,e);for(let i=0;i<e;i++)t[i*s+o]=h[i];}for(let o=0;o<e;o++){for(let e=0;e<s;e++)i[e]=t[o*s+e];this._edt1d(i,h,r,n,s);for(let e=0;e<s;e++)t[o*s+e]=Math.sqrt(h[e]);}}_edt1d(t,s,e,i,r){e[0]=0,i[0]=-h$2,i[1]=+h$2;for(let s=1,n=0;s<r;s++){let r=(t[s]+s*s-(t[e[n]]+e[n]*e[n]))/(2*s-2*e[n]);for(;r<=i[n];)n--,r=(t[s]+s*s-(t[e[n]]+e[n]*e[n]))/(2*s-2*e[n]);n++,e[n]=s,i[n]=r,i[n+1]=+h$2;}for(let h=0,n=0;h<r;h++){for(;i[n+1]<h;)n++;s[h]=(h-e[n])*(h-e[n])+t[e[n]];}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function c$3(t){return t&&"static"===t.type}class n$2{constructor(e,i,s,a=0){if(this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._fixSpriteLocationsTable=t$e("fix-sprite-locations"),this._testId=t$e("test-id"),this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(i<=0||s<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=i,this._pageHeight=s,this._requestRender=e,a>0&&(this._maxItemSize=a),this.pixelRatio=window.devicePixelRatio||1,this._fixSpriteLocationsTable){const t=[];for(const e in this._fixSpriteLocationsTable[this._testId]){const i=this._fixSpriteLocationsTable[this._testId][e];t[i.page]=i.pageSize;}for(const e of t)this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(e[0]*e[1])},size:[e[0],e[1]],dirty:!0,texture:void 0});}this._binPack=new h$1(this._pageWidth,this._pageHeight);const r=Math.floor(this._pageWidth),o=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*o)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0});}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,a,o){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let h,n,p;if(c$3(i))if(this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][t]){const e=this._fixSpriteLocationsTable[this._testId][t];h=e.rect,n=e.page,p=e.pageSize;}else [h,n,p]=this._allocateImage(e[0],e[1]);else {h=new i$c(0,0,e[0],e[1]),n=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:e,dirty:!0,texture:t});}if(h.width<=0||h.height<=0)return null;const g={rect:h,width:e[0],height:e[1],sdf:a,simplePattern:o,pixelRatio:1,page:n};return this._mosaicRects.set(t,g),c$3(i)&&this._copy({rect:h,spriteSize:e,spriteData:i.data,page:n,pageSize:p,repeat:s,sdf:a}),g}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t);}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const a=e.width,r=e.height,o=X,h=this._mosaicPages[e.page];return {size:[e.width,e.height],tl:[(i.x+o)/h[0],(i.y+o)/h[1]],br:[(i.x+o+a)/h[0],(i.y+o+r)/h[1]],page:e.page}}bind(t,i,s=0,r=0){const o=this._mosaicPages[s],h=o.mosaicsData;let n=o.texture;if(n||(n=function(t,e,i){if(c$3(e))return new i$d(t,{pixelFormat:6408,dataType:5121,width:i[0],height:i[1]},new Uint8Array(e.data.buffer));return new i$d(t,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:i[0],height:i[1]},null)}(t,h,o.size),o.texture=n),n.setSamplingMode(i),c$3(h))t.bindTexture(n,r),o.dirty&&(n.setData(new Uint8Array(h.data.buffer)),n.generateMipmap());else {const i=h.data,s=i.bindFrame(t,n,r);u$4(this._requestRender)&&s&&i.frameCount>0&&this._requestRender.requestRender(),i.bindFrame(t,n,r);}o.dirty=!1;}static _copyBits(t,e,i,s,a,r,o,h,c,n,p){let g=s*e+i,m=h*r+o;if(p){m-=r;for(let o=-1;o<=n;o++,g=((o+n)%n+s)*e+i,m+=r)for(let e=-1;e<=c;e++)a[m+e]=t[g+(e+c)%c];}else for(let i=0;i<n;i++){for(let e=0;e<c;e++)a[m+e]=t[g+e];g+=e,m+=r;}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],a=e.mosaicsData;if(!c$3(e.mosaicsData))throw new s$d("mapview-invalid-resource","unsuitable data type!");const r=t.spriteData,o=a.data;o&&r||console.error("Source or target images are uninitialized!"),n$2._copyBits(r,t.spriteSize[0],0,0,o,t.pageSize[0],t.rect.x+X,t.rect.y+X,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0;}_allocateImage(t,e){t+=2*X,e+=2*X;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=Math.pow(2,Math.ceil(P$2(t))),s=Math.pow(2,Math.ceil(P$2(e))),a=new i$c(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[i,s]]}const a=this._binPack.allocate(t,e);if(a.width<=0){const i=this._mosaicPages[this._currentPage];return !i.dirty&&c$3(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new h$1(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return [a,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;if(!c$3(i)){i.data.pause();}}this._mosaicPages=null,this._mosaicRects.clear();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const i$2=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)e=0!=(1&e)?3988292384^e>>>1:e>>>1;i$2[t]=e;}const n$3=new s$d("Not a PNG"),s$5=new s$d("Not an animated PNG"),h$3=new Uint8Array([137,80,78,71,13,10,26,10]);function u$2(t){const e=t.constructor===Uint8Array?t:new Uint8Array(t);return !h$3.some(((t,r)=>t!==e[r]))}function o$3(t){const e=new Uint8Array(t);if(!u$2(e))return !1;let r=!1;return m$2(e,(t=>!(r="acTL"===t))),r}class c$4{constructor(){this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1;}static async create(r,a){const i=new c$4;try{await i._load(r,a);}catch(r){if(!T(r))return new s$d("invalid-resource",`Could not load PNG: ${r.message}`)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play());}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID);}togglePlay(){this.paused||!this.playing?this.play():this.pause();}bindFrame(t,e,r){t.bindTexture(e,r);const a=this.frameChanged();if(!a)return !1;const i=this.currentFrame,n=i.frameData,s=e.descriptor;return (i.left||i.top||i.width!==s.width||i.height!==s.height)&&e.setData(null),e.updateData(0,i.left,i.top,i.width,i.height,n),this.updateUsedFrame(),a}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber;}async _load(a,i){try{const t=function(t,e){const r=new Uint8Array(e);if(h$3.some(((t,e)=>t!==r[e])))return n$3;let a=!1;if(m$2(r,(t=>!(a="acTL"===t))),!a)return s$5;const i=[],u=[];let l=null,o=null,c=0;if(m$2(r,((e,r,a,n)=>{const s=new DataView(r.buffer);switch(e){case"IHDR":l=r.subarray(a+8,a+8+n),t.width=s.getUint32(a+8),t.height=s.getUint32(a+12);break;case"acTL":t.numPlays=s.getUint32(a+8+4);break;case"fcTL":{o&&(t.frames.push(o),c++),o=new d$2,o.width=s.getUint32(a+8+4),o.height=s.getUint32(a+8+8),o.left=s.getUint32(a+8+12),o.top=s.getUint32(a+8+16);const e=s.getUint16(a+8+20);let r=s.getUint16(a+8+22);0===r&&(r=100),o.delay=1e3*e/r,o.delay<=10&&(o.delay=100),t.playTime+=o.delay,o.disposeOp=s.getUint8(a+8+24),o.blendOp=s.getUint8(a+8+25),o.dataParts=[],0===c&&2===o.disposeOp&&(o.disposeOp=1);break}case"fdAT":o&&o.dataParts.push(r.subarray(a+8+4,a+8+n));break;case"IDAT":o&&o.dataParts.push(r.subarray(a+8,a+8+n));break;case"IEND":u.push(g(r,a,12+n));break;default:i.push(g(r,a,12+n));}})),0===t.frames.length)return s$5;t.frameCount=t.frames.length;const p=new Blob(i),y=new Blob(u);return t.frames.forEach((t=>{let e=[];e.push(h$3),l.set(w(t.width),0),l.set(w(t.height),4),e.push(f$2("IHDR",l)),e.push(p),t.dataParts.forEach((t=>e.push(f$2("IDAT",t)))),e.push(y),t.data=new Blob(e,{type:"image/png"}),delete t.dataParts,e=null;})),t}(this,a);if(t!==this)return t;this._resizeCanvas=document.createElement("canvas"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,await f$7(this.frames.map((t=>t.createImage(this._resizeCanvas))));}catch(r){if(!T(r))return new s$d("invalid-resource","Could not parse PNG")}this.play();}_play(){let t,e;if(0===this.playSpeed)return void this.pause();this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);const r=this.frames[this.currentFrameNumber];this.currentFrame={frameData:r.imageData,top:r.top,left:r.left,width:r.width,height:r.height},this.timerID=window.setTimeout((()=>this._play()),t);}}class d$2{constructor(){this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null;}async createImage(t){if(null===this.imageData)return h$c(((e,r)=>{const a=URL.createObjectURL(this.data),i=document.createElement("img");i.onload=()=>{URL.revokeObjectURL(a),this.imageData=function(t,e){e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height),i=new Uint8Array(a.data);let n;for(let t=0;t<i.length;t+=4)n=i[t+3]/255,i[t]=i[t]*n,i[t+1]=i[t+1]*n,i[t+2]=i[t+2]*n;return new ImageData(new Uint8ClampedArray(i.buffer),t.width,t.height)}(i,t),e();},i.onerror=()=>{URL.revokeObjectURL(a),this.imageData=null,r(new Error("Image creation error"));},i.src=a;}))}}function m$2(t,e){const r=new DataView(t.buffer);let a,i,n,s=8;do{i=r.getUint32(s),a=p(t,s+4,4),n=e(a,t,s,i),s+=12+i;}while(!1!==n&&"IEND"!==a&&s<t.length)}function p(t,e,r){const a=Array.prototype.slice.call(t.subarray(e,e+r));return String.fromCharCode.apply(String,a)}function g(t,e,r){const a=new Uint8Array(r);return a.set(t.subarray(e,e+r)),a}function f$2(t,e){const r=t.length+e.length,a=new Uint8Array(r+8),n=new DataView(a.buffer);n.setUint32(0,e.length),a.set(function(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}(t),4),a.set(e,8);const s=function(t,e=0,r=t.length-e){let a=-1;for(let n=e,s=e+r;n<s;n++)a=a>>>8^i$2[255&(a^t[n])];return -1^a}(a,4,r);return n.setUint32(r+4,s),a}function w(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const r$3=249,h$4=254,o$4=255,l$2=1,n$4=44,d$3=59;function p$1(t){if(!t||0===t.byteLength)return !1;const e=t.constructor===Uint8Array?t:new Uint8Array(t);return 71===e[0]&&73===e[1]&&70===e[2]&&56===e[3]}function m$3(t){if(!t||0===t.byteLength)return !1;const e=new Uint8Array(t);if(!p$1(e))return !1;let s=0;for(let t=0,i=e.length-9;t<i&&(0!==e[t]||33!==e[t+1]||249!==e[t+2]||4!==e[t+3]||0!==e[t+8]||44!==e[t+9]&&33!==e[t+9]||(s++,!(s>1)));++t);return s>1}class c$5{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment="",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1;}static async create(s,i){const a=new c$5;try{await a._load(s,i);}catch(s){if(!T(s))return new s$d("invalid-resource",`Could not load PNG: ${s.message}`)}return a}play(){this.playing||(this.paused=!1,this.playing=!0,this._play());}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID);}togglePlay(){this.paused||!this.playing?this.play():this.pause();}bindFrame(t,e,s){t.bindTexture(e,s);const i=this.frameChanged();if(i){const t=this.currentFrame,s=t.frameData;e.updateData(0,0,0,t.width,t.height,s),this.updateUsedFrame();}return i}seekFrame(t){clearTimeout(this.timerID),this.currentFrameNumber=t%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber);}seek(t){clearTimeout(this.timerID),t<0&&(t=0),t*=1e3,t%=this.length;let e=0;for(;t>this.frames[e].time+this.frames[e].delay&&e<this.frames.length;)e+=1;this.currentFrameNumber=e,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber);}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber;}async _load(s,i){try{this.loading=!0,await this._parse(s,i),this.loading=!1,this.play();}catch(s){if(!T(s))return new s$d("invalid-resource","Could not parse gif!")}}_parse(t,e){const i=new f$3(t);i.pos+=6,this.width=i.data[i.pos++]+(i.data[i.pos++]<<8),this.height=i.data[i.pos++]+(i.data[i.pos++]<<8);const a=i.data[i.pos++];return this.globalColourCount=1<<1+(7&a),i.pos++,i.pos++,128&a&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,i)),h$c(((t,s)=>{setTimeout((()=>this._parseBlock(i,t,s,e)),0);}))}async _parseBlock(t,e,s,r){if(r&&r.signal&&j$2(r.signal))return void s(m$7());const h=t.data[t.pos++];if(h===n$4){if(this._parseImg(t),this.firstFrameOnly)return this._finishedLoading(),void e()}else {if(h===d$3)return this._finishedLoading(),void e();this._parseExt(t);}"function"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((()=>this._parseBlock(t,e,s,r)),0);}_parseColourTable(t,e){const s=[];for(let i=0;i<t;i++)s.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return s}_parseImg(t){const e=t=>{const e=this.pixelBufSize/t;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let s=0;for(let i=0;i<4;i++)for(let a=this.interlaceOffsets[i];a<e;a+=this.interlaceSteps[i])this.deinterlaceBuf.set(this.pixelBuf.subarray(s,s+t),a*t),s+=t;},s={};this.frames.push(s),s.disposalMethod=this.disposalMethod,s.time=this.length,s.delay=10*this.delayTime,this.length+=s.delay,this.transparencyGiven?s.transparencyIndex=this.transparencyIndex:s.transparencyIndex=void 0,s.leftPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.topPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.width=t.data[t.pos++]+(t.data[t.pos++]<<8),s.height=t.data[t.pos++]+(t.data[t.pos++]<<8);const i=t.data[t.pos++];s.localColourTableFlag=!!(128&i),s.localColourTableFlag&&(s.localColourTable=this._parseColourTable(1<<1+(7&i),t)),this.pixelBufSize!==s.width*s.height&&(this.pixelBuf=new Uint8Array(s.width*s.height),this.pixelBufSize=s.width*s.height),this._lzwDecode(t.data[t.pos++],t.readSubBlocksB()),64&i?(s.interlaced=!0,e(s.width)):s.interlaced=!1,this._processFrame(s);}_lzwDecode(t,e){let s,i,a,r,h,o,l,n,d,p,u;a=i=0;let m=[];for(r=1<<t,h=r+1,o=t+1,u=!1;!u;){for(n=l,l=0,s=0;s<o;s++)e[a>>3]&1<<(7&a)&&(l|=1<<s),a++;if(l===r){for(m=[],o=t+1,s=0;s<r;s++)m[s]=[s];m[r]=[],m[h]=null;}else {if(l===h)return void(u=!0);for(l>=m.length?m.push(m[n].concat(m[n][0])):n!==r&&m.push(m[n].concat(m[l][0])),d=m[l],p=d.length,s=0;s<p;s++)this.pixelBuf[i++]=d[s];m.length===1<<o&&o<12&&o++;}}}_processFrame(t){t.image=document.createElement("canvas"),t.image.width=this.width,t.image.height=this.height,t.ctx=t.image.getContext("2d");const e=t.localColourTableFlag?t.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=t);const s=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;s||t.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const i=t.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),a=t.transparencyIndex,r=i.data,h=t.interlaced?this.deinterlaceBuf:this.pixelBuf,o=h.length;let l,n,d=0;for(let t=0;t<o;t++)l=h[t],n=e[l],a!==l?(r[d++]=n[0],r[d++]=n[1],r[d++]=n[2],r[d++]=255):s?(r[d+3]=0,d+=4):d+=4;t.ctx.putImageData(i,t.leftPos,t.topPos),this.lastFrame=t;}_parseExt(t){const e=t.data[t.pos++];e===r$3?this._parseGCExt(t):e===h$4?this.comment+=t.readSubBlocks():e===o$4?this._parseAppExt(t):(e===l$2&&(t.pos+=13),t.readSubBlocks());}_parseAppExt(t){t.pos+=1,"NETSCAPE"===t.getString(8)?t.pos+=8:(t.pos+=3,t.readSubBlocks());}_parseGCExt(t){let e;t.pos++,e=t.data[t.pos++],this.disposalMethod=(28&e)>>2,this.transparencyGiven=!!(1&e),this.delayTime=t.data[t.pos++]+(t.data[t.pos++]<<8),this.transparencyIndex=t.data[t.pos++],t.pos++;}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play();}_play(){let t,e;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((()=>this._play()),t)):this.pause();}_setCurrentFrame(t){const e=this.frames[t];this.currentFrame={frameData:e.image,top:0,left:0,width:this.width,height:this.height};}}class f$3{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length;}getString(t){let e="";for(;t--;)e+=String.fromCharCode(this.data[this.pos++]);return e}readSubBlocks(){let t,e,s="";do{for(e=t=this.data[this.pos++];e--;)s+=String.fromCharCode(this.data[this.pos++]);}while(0!==t&&this.pos<this.len);return s}readSubBlocksB(){let t,e;const s=[];do{for(e=t=this.data[this.pos++];e--;)s.push(this.data[this.pos++]);}while(0!==t&&this.pos<this.len);return s}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function e$3(e){switch(e.type){case"esriSMS":return `${e.style}.${e.path}`;case"esriSLS":return `${e.style}.${e.cap}`;case"esriSFS":return `${e.style}`;case"esriPFS":case"esriPMS":return e.imageData?`${e.imageData}${e.width}${e.height}`:`${e.url}${e.width}${e.height}`;default:return e.mosaicHash?e.mosaicHash:JSON.stringify(e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const z=n$a(),j=i$7.getLogger("esri.views.2d.engine.webgl.TextureManager"),R=e=>"esriSMS"===e.type&&e.path;function C(e){switch(e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return !1;default:return !0}}function U(e,t){const i=Math.round(t$b(t)*window.devicePixelRatio),s=i>=128?2:4;return Math.min(e,i*s)}const F=(e,t,i)=>j.error(new s$d(e,t,i));class P{constructor(e,t,i){this.mosaicType=e,this.page=t,this.sdf=i;}static fromMosaic(e,t){return new P(e,t.page,t.sdf)}}class f$4{constructor(t){this._invalidFontsMap=new Map,this._sdfConverter=new y(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._rasterizer=new l$1,this._ongoingRasterizations=new Map,this._spriteMosaic=new n$2(t,2048,2048,500),this._glyphSource=new f$1(`${s$g.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new m$1(1024,1024,this._glyphSource);}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._rasterizer=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null;}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(e,i,s,r){if(t$f(e))return F("mapview-null-resource","Unable to rasterize null resource"),null;switch(e.type){case"CIMTextSymbol":case"esriTS":{const t=await this._rasterizeText(e,s,r);return t.forEach((e=>this._setTextureBinding(O.GLYPH,e))),{glyphMosaicItems:t}}case"esriSMS":case"esriPMS":case"esriSFS":case"esriPFS":case"esriSLS":default:{if((a=e).type&&-1!==a.type.toLowerCase().indexOf("3d"))return F("mapview-invalid-type",`MapView does not support symbol type: ${e.type}`,e),null;const t=await this._rasterizeSpriteSymbol(e,i,r);return e$a(t)&&t&&this._setTextureBinding(O.SPRITE,t),{spriteMosaicItem:t}}}var a;}bindTextures(e,t,i,s=!1){if(0===i.textureBinding)return;const r=this._bindingInfos[i.textureBinding-1],a=r.page,n=s?9987:9729;switch(r.mosaicType){case O.SPRITE:{const i=this.sprites.getWidth(a),s=this.sprites.getHeight(a),r=r$c(z,i,s);return this._spriteMosaic.bind(e,n,a,u$5),t.setUniform1i("u_texture",u$5),void t.setUniform2fv("u_mosaicSize",r)}case O.GLYPH:{const i=this.glyphs.width,s=this.glyphs.height,r=r$c(z,i,s);return this._glyphMosaic.bind(e,n,a,y$3),t.setUniform1i("u_texture",y$3),void t.setUniform2fv("u_mosaicSize",r)}default:j.error("mapview-texture-manager",`Cannot handle unknown type ${r.mosaicType}`);}}_hashMosaic(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}_setTextureBinding(e,t){const i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){const s=P.fromMosaic(e,t),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(s);}t.textureBinding=this._hashToBindingIndex.get(i);}async _rasterizeText(e,t,i){const s=e$2(e.font),r=this._invalidFontsMap.has(s),a=t||function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}(n$9(e.text)[0]);try{return await this._glyphMosaic.getGlyphItems(r?"arial-unicode-ms-regular":s,a,i)}catch(e){return F("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",a,i)}}async _rasterizeSpriteSymbol(e,t,i){if(function(e){switch(e.type){case"CIMSolidStroke":case"CIMSolidFill":return !0;case"esriSFS":return "esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return "esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return !1}}(e))return null;const r=e$3(e);if(this._spriteMosaic.has(r))return this._spriteMosaic.getSpriteItem(r);if(R(e)||(e=>e.url||e.imageData)(e))return this._handleAsyncResource(r,e,i);const a=this._rasterizer.rasterizeJSONResource(e,t);if(a){const{size:t,image:i,sdf:s,simplePattern:n}=a;return this._addItemToMosaic(r,t,{type:"static",data:i},C(e),s,n)}return new s$d("TextureManager","unrecognized or null rasterized image")}async _handleAsyncResource(e,t,i){if(this._ongoingRasterizations.has(e))return this._ongoingRasterizations.get(e);let s;s=R(t)?this._handleSVG(t,e,i):this._handleImage(t,e,i),this._ongoingRasterizations.set(e,s);try{await s,this._ongoingRasterizations.delete(e);}catch{this._ongoingRasterizations.delete(e);}return s}async _handleSVG(e,t,i){const s=[126,126],r=await this._sdfConverter.draw(e.path,i);return this._addItemToMosaic(t,s,{type:"static",data:new Uint32Array(r.buffer)},!1,!0,!0)}async _handleGIFOrPNG(e,t,i){const a=await async function(e,t){const i=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;let a;const o=";base64,";if(-1!==i.indexOf(o)){const e=i.indexOf(o)+o.length,t=i.substring(e),s=atob(t),r=new Uint8Array(s.length);for(let e=0;e<s.length;e++)r[e]=s.charCodeAt(e);a=r.buffer;}else try{const{data:e}=await L(i,{responseType:"array-buffer",...t});a=e;}catch(e){if(!T(e))return new s$d("mapview-invalid-resource",`Could not fetch requested resource at ${i}`)}return a}(e,i);if(e$a(a)){const o=p$1(a),c=u$2(a);if(!o&&!c)return new s$d("mapview-invalid-resource","Image data is neither GIF nor PNG!");let h;try{o&&m$3(a)?h=await c$5.create(a,i):c&&o$3(a)&&(h=await c$4.create(a,i));}catch(e){if(!T(e))return new s$d("mapview-invalid-resource","Could not fetch requested resource!")}if(h&&e$a(h))return this._addItemToMosaic(t,[h.width,h.height],{type:"animated",data:h},C(e),!1,!1);const d=new Blob([a],{type:o?"image/gif":"image/png"}),u=await async function(e){const t=window.URL.createObjectURL(e);try{const{data:e}=await L(t,{responseType:"image"});return window.URL.revokeObjectURL(t),e}catch(e){return window.URL.revokeObjectURL(t),new s$d("mapview-invalid-resource",`Could not fetch requested resource at ${t}`)}}(d);if(u&&u instanceof HTMLImageElement){let i=u.width,s=u.height;"esriPMS"===e.type&&(i=Math.round(U(u.width,e.width)),s=Math.round(u.height*(i/u.width)));const{size:r,sdf:a,image:n}=this._rasterizer.rasterizeImageResource(i,s,u,e.colorSubstitutions);return this._addItemToMosaic(t,r,{type:"static",data:n},C(e),a,!1)}}return new s$d("mapview-invalid-resource","Could not handle resource!")}async _handleImage(e,t,i){if((e=>e.url&&-1!==e.url.indexOf(".gif")||e.contentType&&"image/gif"===e.contentType||e.imageData&&-1!==e.imageData.indexOf("data:image/gif"))(e)||(e=>e.url&&-1!==e.url.indexOf(".png")||e.contentType&&"image/png"===e.contentType||e.imageData&&-1!==e.imageData.indexOf("data:image/png"))(e))return this._handleGIFOrPNG(e,t,i);const o=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;try{const{data:s}=await L(o,{responseType:"image",...i});-1!==o.indexOf("data:image/svg+xml")&&(s.width=t$b(e.width),s.height=t$b(e.height));let r=s.width,c=s.height;"esriPMS"===e.type&&(r=Math.round(U(s.width,e.width)),c=Math.round(s.height*(r/s.width)));const{size:h,sdf:d,image:u}=this._rasterizer.rasterizeImageResource(r,c,s,e.colorSubstitutions);return this._addItemToMosaic(t,h,{type:"static",data:u},C(e),d,!1)}catch(e){if(!T(e))return new s$d("mapview-invalid-resource",`Could not fetch requested resource at ${o}`)}}_addItemToMosaic(e,t,i,s,r,a){return this._spriteMosaic.addSpriteItem(e,t,i,s,r,a)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class t$4{constructor(){this.name=this.constructor.name;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class o$5 extends t$4{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:{a_position:0}};}dispose(){this._quad&&this._quad.dispose();}bind(){}unbind(){}draw(i,r){if(!r.size)return;const{context:a,renderingOptions:o}=i;this._quad||(this._quad=new i$e(a,[0,0,1,0,0,1,1,1]));const n=a.getBoundFramebufferObject(),{x:m,y:u,width:d,height:f}=a.getViewport();r.bindTextures(a);const c=r.getBlock(J);if(t$f(c))return;const _=c.getFBO(a),l=c.getFBO(a,1);a.setViewport(0,0,r.size,r.size),this._computeDelta(i,l,o.labelsAnimationTime),this._updateAnimationState(i,l,_),a.bindFramebuffer(n),a.setViewport(m,u,d,f);}_computeDelta(e,t,s){const{context:a,painter:o,displayLevel:n}=e,m=o.materialManager.getProgram(e,this._desc,["delta"]);a.bindFramebuffer(t),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),a.bindProgram(m),m.setUniform1i("u_maskTexture",A),m.setUniform1i("u_sourceTexture",B),m.setUniform1f("u_timeDelta",e.deltaTime),m.setUniform1f("u_animationTime",s),m.setUniform1f("u_zoomLevel",Math.round(10*n)),this._quad.draw();}_updateAnimationState(e,t,i){const{context:r,painter:s}=e,a=s.materialManager.getProgram(e,this._desc,["update"]);r.bindTexture(t.colorTexture,1),r.bindProgram(a),a.setUniform1i("u_sourceTexture",1),r.bindFramebuffer(i),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT),this._quad.draw();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const r$4=e=>`#define ${(e=>e.replace("-","_").toUpperCase())(e)}\n`,a$7={name:"blend",attributes:{a_pos:0,a_tex:1},shaders:a=>({vertexShader:r$4(a)+o$a("blend/blend.vert"),fragmentShader:r$4(a)+o$a("blend/blend.frag")})};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const d$4=i$7.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class u$3{constructor(){this._size=[0,0];}dispose(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null);}draw(e,r,i,s,n){const{context:u,drawPhase:c}=e;if(this._setupShader(u),s&&"normal"!==s&&c!==I.LABEL)return void this._drawBlended(e,r,i,s,n);const m=this._programCache.getProgram(a$7,"normal");if(!m)return void d$4.error(new s$d("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));u.bindProgram(m),r.setSamplingMode(i),u.bindTexture(r,0),m.setUniform1i("u_layerTexture",0),m.setUniform1f("u_opacity",n),u.setBlendingEnabled(!0),u.setBlendFunction(1,771);const f=this._quad;f.draw(),f.unbind();}_drawBlended(r,i,s,o,n){const{context:u,state:c,pixelRatio:m,inFadeTransition:f}=r,{size:h}=c,l=u.getBoundFramebufferObject();let p,g;if(u$4(l)){const e=l.descriptor;p=e.width,g=e.height;}else p=Math.round(m*h[0]),g=Math.round(m*h[1]);this._createOrResizeTexture(r,p,g);const _=this._backBufferTexture;l.copyToTexture(0,0,p,g,0,0,_),u.setStencilTestEnabled(!1),u.setStencilWriteMask(0),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setDepthWriteEnabled(!1);const b=this._programCache.getProgram(a$7,o);if(!b)return void d$4.error(new s$d("mapview-BlendEffect",`Error creating shader program for blend mode ${o}`));u.bindProgram(b),_.setSamplingMode(s),u.bindTexture(_,0),b.setUniform1i("u_backbufferTexture",0),i.setSamplingMode(s),u.bindTexture(i,1),b.setUniform1i("u_layerTexture",1),b.setUniform1f("u_opacity",n),b.setUniform1f("u_inFadeOpacity",f?1:0),u.setBlendFunction(1,0);const x=this._quad;x.draw(),x.unbind(),u.setBlendFunction(1,771);}_setupShader(e){this._programCache||(this._programCache=new s$e(e),this._quad||(this._quad=new i$e(e,[-1,-1,1,-1,-1,1,1,1])));}_createOrResizeTexture(e,r,t){const{context:s}=e;null!==this._backBufferTexture&&r===this._size[0]&&t===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(r,t):this._backBufferTexture=new i$d(s,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:r,height:t}),this._size[0]=r,this._size[1]=t);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class t$5 extends t$4{constructor(e){super(),this.name=this.constructor.name,this.defines=[e];}dispose(){}bind({context:e,painter:t}){this._prev=e.getBoundFramebufferObject();const{width:s,height:r}=e.getViewport(),n=t.getFbos(s,r).effect0;e.bindFramebuffer(n),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT);}unbind(){}draw(e,t){const{context:s,painter:r,state:n,deltaTime:o}=e,c=r.getPostProcessingEffects(t.effects),i=s.getBoundFramebufferObject();c.length&&t.transitionStep(o,n.scale);for(const{postProcessingEffect:t,effect:s}of c)t.draw(e,i,s);s.bindFramebuffer(this._prev),s.setStencilTestEnabled(!1),r.blitTexture(s,i.colorTexture,9728),s.setStencilTestEnabled(!0);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const o$6=[void 0,void 0,void 0,1],i$3=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],t$6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d$5=256,n$5={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const n$6=i$7.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");const h$5=[0,0,0,0];class i$4{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:n$5.outlinePosition,outlineWidth:n$5.outlineWidth,innerHaloWidth:n$5.innerHaloWidth,outerHaloWidth:n$5.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*d$5),this.minMaxDistance=[0,0];}setHighlightOptions(o){const i=this._convertedHighlightOptions;var t,s;t=o,(s=i).fillColor[0]=t.color.r/255,s.fillColor[1]=t.color.g/255,s.fillColor[2]=t.color.b/255,s.fillColor[3]=t.color.a,t.haloColor?(s.outlineColor[0]=t.haloColor.r/255,s.outlineColor[1]=t.haloColor.g/255,s.outlineColor[2]=t.haloColor.b/255,s.outlineColor[3]=t.haloColor.a):(s.outlineColor[0]=s.fillColor[0],s.outlineColor[1]=s.fillColor[1],s.outlineColor[2]=s.fillColor[2],s.outlineColor[3]=s.fillColor[3]),s.fillColor[3]*=t.fillOpacity,s.outlineColor[3]*=t.haloOpacity,s.fillColor[0]*=s.fillColor[3],s.fillColor[1]*=s.fillColor[3],s.fillColor[2]*=s.fillColor[3],s.outlineColor[0]*=s.outlineColor[3],s.outlineColor[1]*=s.outlineColor[3],s.outlineColor[2]*=s.outlineColor[3],s.outlineWidth=n$5.outlineWidth,s.outerHaloWidth=n$5.outerHaloWidth,s.innerHaloWidth=n$5.innerHaloWidth,s.outlinePosition=n$5.outlinePosition;const a=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,d=i.outlinePosition-i.outlineWidth/2,u=i.outlinePosition+i.outlineWidth/2,g=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,C=Math.sqrt(Math.PI/2)*o$6[3],f=Math.abs(a)>C?Math.round(10*(Math.abs(a)-C))/10:0,c=Math.abs(g)>C?Math.round(10*(Math.abs(g)-C))/10:0;let m;f&&!c?n$6.error("The outer rim of the highlight is "+f+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!f&&c?n$6.error("The inner rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):f&&c&&n$6.error("The highlight is "+Math.max(f,c)+"px away from the edge of the feature; consider reducing some width values.");const p=[void 0,void 0,void 0,void 0];function x(o,i,t){p[0]=(1-t)*o[0]+t*i[0],p[1]=(1-t)*o[1]+t*i[1],p[2]=(1-t)*o[2]+t*i[2],p[3]=(1-t)*o[3]+t*i[3];}const{texelData:w}=this;for(let o=0;o<d$5;++o)m=a+o/(d$5-1)*(g-a),m<a?(p[4*o+0]=0,p[4*o+1]=0,p[4*o+2]=0,p[4*o+3]=0):m<d?x(h$5,i.outlineColor,(m-a)/(d-a)):m<u?[p[0],p[1],p[2],p[3]]=i.outlineColor:m<g?x(i.outlineColor,i.fillColor,(m-u)/(g-u)):[p[4*o+0],p[4*o+1],p[4*o+2],p[4*o+3]]=i.fillColor,w[4*o+0]=255*p[0],w[4*o+1]=255*p[1],w[4*o+2]=255*p[2],w[4*o+3]=255*p[3];this.minMaxDistance[0]=a,this.minMaxDistance[1]=g,this.shadeTexChanged=!0;}applyHighlightOptions(o,e){this.shadeTex||(this.shadeTex=new i$d(o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:d$5,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,d$5,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,F$1),e.setUniform2fv("u_minMaxDistance",this.minMaxDistance);}destroy(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const e$4={name:"highlight",shaders:{vertexShader:o$a("highlight/textured.vert"),fragmentShader:o$a("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}},r$5={name:"blur",shaders:{vertexShader:o$a("highlight/textured.vert"),fragmentShader:o$a("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class h$6{constructor(){this._width=void 0,this._height=void 0,this._resources=null;}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null);}preBlur(e,s){e.bindTexture(s,E$1),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",i$3),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO();}finalBlur(e,s){e.bindTexture(s,E$1),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",t$6),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO();}renderHighlight(e,s,i){e.bindTexture(s,E$1),e.bindProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO();}_initialize(o,h,m){this._width=h,this._height=m;const d=new i$a(o,34962,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),g=new a$d(o,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d}),l=t$d(o,e$4),_=t$d(o,r$5);l.setUniform1i("u_texture",E$1),l.setUniform1i("u_shade",F$1),l.setUniform4fv("u_sigmas",o$6),_.setUniform1i("u_texture",E$1),_.setUniform4fv("u_sigmas",o$6),this._resources={quadGeometry:d,quadVAO:g,highlightProgram:l,blurProgram:_};}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function r$6(r,t,i){const h=new i$d(r,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:i,samplingMode:9729});return [h,new r$d(r,{colorTarget:0,depthStencilTarget:2},h)]}class s$6{constructor(){this._width=void 0,this._height=void 0,this._resources=null;}dispose(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null);}_initialize(e,s,t){this._width=s,this._height=t;const[i,h]=r$6(e,s,t),[o,u]=r$6(e,s,t);this._resources={sharedBlur1Tex:i,sharedBlur1Fbo:h,sharedBlur2Tex:o,sharedBlur2Fbo:u};}setup(e,s,r){!this._resources||this._width===s&&this._height===r||this.dispose(),this._resources||this._initialize(e,s,r);}get sharedBlur1Tex(){return this._resources.sharedBlur1Tex}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Tex}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class d$6 extends t$4{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new h$6,this._hlGradient=new i$4,this._width=void 0,this._height=void 0,this._hlSurfaces=new s$6,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new s$2;}dispose(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null;}bind(e){const{context:t,painter:i}=e,{width:h,height:s}=t.getViewport(),r=i.getFbos(h,s).effect0;this.setup(e,h,s),t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT);}unbind(){}setup({context:e},t,i){this._width=t,this._height=i;const h=t%4,s=i%4;t+=h<2?-h:4-h,i+=s<2?-s:4-s,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=e.getBoundFramebufferObject();const r=Math.round(.75*t),d=Math.round(.75*i);this._hlRenderer.setup(e,r,d),this._hlSurfaces.setup(e,r,d);}draw({context:e}){const t=e.getBoundFramebufferObject();e.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,t.colorTexture,9728,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null;}setHighlightOptions(e){this._hlGradient.setHighlightOptions(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class r$7 extends t$4{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["id"],this._lastSize=0;}dispose(){u$4(this._fbo)&&this._fbo.dispose();}bind({context:t,painter:e}){const{width:s,height:r}=t.getViewport(),i=e.getFbos(s,r).effect0;t.bindFramebuffer(i),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT);}unbind(){}draw({context:t,state:s,pixelRatio:r},i,o=S){const f=t.getBoundFramebufferObject(),n=s.size[1]*r,a=Math.round(o*r),h=a/2,c=a/2;this._ensureBuffer(a),i.forEach(((t,e)=>{const s=new Map,o=Math.floor(e[0]*r-a/2),u=Math.floor(n-e[1]*r-a/2);f.readPixels(o,u,a,a,6408,5121,this._buf);for(let t=0;t<this._buf32.length;t++){const e=this._buf32[t];if(4294967295!==e&&0!==e){const r=t%a,i=a-Math.floor(t/a),o=(h-r)*(h-r)+(c-i)*(c-i),f=s.has(e)?s.get(e):4294967295;s.set(e,Math.min(o,f));}}const b=Array.from(s).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(b),i.delete(e);}));}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function e$5(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return "colorize"}}const t$7={colorize:async()=>new((await import('./Colorize-a09b7003.js')).Colorize),blur:async()=>new((await import('./Blur-213b28fd.js')).Blur),bloom:async()=>new((await import('./Bloom-f2f11c39.js')).Bloom),opacity:async()=>new((await import('./Opacity-795c3c21.js')).Opacity),"drop-shadow":async()=>new((await import('./DropShadow-9b910d55.js')).DropShadow)};class s$7{constructor(e){this._requestRender=e,this._effectMap=new Map,this._effectPromiseMap=new Map;}dispose(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((e=>e.dispose())),this._effectMap.clear(),this._effectPromiseMap.clear();}getPostProcessingEffects(t){if(!t||0===t.length)return [];const s=[];for(const o of t){const t=e$5(o.type),r=this._effectMap.get(t);r?s.push({postProcessingEffect:r,effect:o}):this._enablePostProcessingEffect(t);}return s}async _enablePostProcessingEffect(e){const t=await this._loadPostProcessingEffect(e);this._requestRender&&(this._effectMap.set(e,t),this._requestRender.requestRender());}async _loadPostProcessingEffect(e){return this._effectPromiseMap.has(e)||this._effectPromiseMap.set(e,t$7[e]()),this._effectPromiseMap.get(e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class _{constructor(r,e){var s;this.brushes=r,this.name=e.name,this.drawPhase=e.drawPhase||I.MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=null!=(s=e.enableDefaultDraw)?s:()=>!0,this.has=e.has;}render(e){const{context:s,profiler:t}=e,a=this._targetFn(),o=this.drawPhase&e.drawPhase;if(t.recordPassStart(this.name),o&&(!this.has||t$e(this.has))){this.enableDefaultDraw()&&this._doRender(e,a),t.recordPassEnd();for(const r of this.effects){if(!r.enable())continue;const o=r.apply;t.recordPassStart(this.name+"."+o.name),t.recordBrushStart(o.name);const i=r.args&&r.args(),{x:n,y:h,width:f,height:d}=s.getViewport(),c=s.getBoundFramebufferObject();o.bind(e,i),this._doRender(e,a,o.defines),o.draw(e,i),o.unbind(e,i),s.bindFramebuffer(c),s.setViewport(n,h,f,d),t.recordBrushEnd(),t.recordPassEnd();}}}_doRender(r,t,a){if(!t$f(t))if(s$h(t)){for(const e of t)if(e.visible)for(const s of this.brushes)r.profiler.recordBrushStart(s.name),s.prepareState(r,e,a),s.draw(r,e,a),r.profiler.recordBrushEnd();}else for(const e of this.brushes)r.profiler.recordBrushStart(e.name),e.prepareState(r,t,a),e.draw(r,t,a),r.profiler.recordBrushEnd();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function m$4(t,s,r){return 1!==r||u$4(t)&&"normal"!==t||u$4(s)&&s.length>0}class v{constructor(e,t){this.context=e,this._blitRenderer=new s$2,this._brushCache=new Map,this._vtlProgramCache=null,this._blendEffect=new u$3,this.effects={highlight:new d$6,hittest:new r$7,integrate:new o$5,insideEffect:new t$5("inside"),outsideEffect:new t$5("outside")},this.materialManager=new a$4(e),this._vtlProgramCache=new o(e),this.textureManager=new f$4(t),this._effectsManager=new s$7(t);}getRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e;}getFbos(e,r){if(e!==this._lastWidth||r!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=r,this._fbos){for(const t in this._fbos)this._fbos[t].resize(e,r);return this._fbos}const i={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:r},n={colorTarget:0,depthStencilTarget:3},o=new t$g(this.context,{width:e,height:r,internalFormat:34041});this._stencilBuf=o,this._fbos={output:new r$d(this.context,n,i,o),blend:new r$d(this.context,n,i,o),effect0:new r$d(this.context,n,i,o)};}return this._fbos}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(t,s=null){const{width:r,height:i}=t.getViewport();this._prevFBO=t.getBoundFramebufferObject();const n=this.getFbos(r,i);if(t.bindFramebuffer(n.output),t.setColorMask(!0,!0,!0,!0),t.setDepthWriteEnabled(!0),u$4(s)){const{r:e,g:r,b:i,a:n}=s.color;t.setClearColor(n*e/255,n*r/255,n*i/255,n);}else t.setClearColor(0,0,0,0);t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1);}beforeRenderLayer(e,t,s){const{context:r,blendMode:i,effects:n}=e;if(m$4(i,n,s))r.bindFramebuffer(this._fbos.blend),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT);else {const e=this._getOutputFBO();r.bindFramebuffer(e);}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(r.gl.STENCIL_BUFFER_BIT);}compositeLayer(t,s){const{context:i,blendMode:n,effects:o}=t;if(m$4(n,o,s)){u$4(o)&&o.length>0&&t.drawPhase===I.MAP&&this._applyEffects(t,o);const h=this._getOutputFBO();i.bindFramebuffer(h),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);const a=u$4(n)?n:"normal";this._blendEffect.draw(t,this._fbos.blend.colorTexture,9728,a,s);}}renderLayers(e){if(e.bindFramebuffer(this._prevFBO),!this._fbos)return;const t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728);}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null),this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(const e in this.effects)this.effects[e]&&this.effects[e].dispose();this._prevFBO=null;}getGeometryBrush(e){const t={[E$2.FILL]:g$2.fill,[E$2.LINE]:g$2.line,[E$2.MARKER]:g$2.marker,[E$2.TEXT]:g$2.text}[e];let s=this._brushCache.get(t);return void 0===s&&(s=new t,this._brushCache.set(t,s)),this._brushCache.get(t)}renderObject(e,t,s,r){const i=g$2[s];if(!i)return null;let o=this._brushCache.get(i);void 0===o&&(o=new i,this._brushCache.set(i,o)),o.prepareState(e,t,r),o.draw(e,t,r);}renderObjects(e,t,s,r){const i=g$2[s];if(!i)return null;let o=this._brushCache.get(i);void 0===o&&(o=new i,this._brushCache.set(i,o)),o.drawMany(e,t,r);}getVectorTileProgramCache(){return this._vtlProgramCache}registerRenderPass(e){const t=e.brushes.map((e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e))));return new _(t,e)}setHighlightOptions(e){this.effects.highlight.setHighlightOptions(e);}blitTexture(e,t,s,r=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,s,r);}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(e,t){const{context:s}=e,r=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:t,effect:i}of r)s.bindFramebuffer(this._fbos.blend),t.draw(e,this._fbos.blend,i);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const i$5=t$e("esri-2d-profiler");class o$7{constructor(e,s){if(this._events=new i$f,this._entries=new Map,this._timings=new e$b(10),!i$5)return;this._ext=t$h(e.gl,{}),this._debugOutput=s;const o=e.gl;if(this.enableCommandLogging)for(const e in o)if("function"==typeof o[e]){const s=o[e],t=-1!==e.indexOf("draw");o[e]=(...r)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:e,args:r,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),s.apply(o,r));}}get enableCommandLogging(){return !("object"==typeof i$5&&i$5.disableCommands)}recordContainerStart(e){i$5&&(this._currentContainer=e);}recordContainerEnd(){i$5&&(this._currentContainer=null);}recordPassStart(e){i$5&&(this._currentPass=e,this._initSummary());}recordPassEnd(){i$5&&(this._currentPass=null,this._emitSummary());}recordBrushStart(e){i$5&&(this._currentBrush=e);}recordBrushEnd(){i$5&&(this._currentBrush=null);}recordStart(e){if(i$5&&u$4(this._ext)){if(this._entries.has(e)){const t=this._entries.get(e),r=this._ext.resultAvailable(t.query),n=this._ext.disjoint();if(r&&!n){const r=this._ext.getResult(t.query)/1e6;let n=0;if(u$4(this._timings.enqueue(r))){const e=this._timings.entries,s=e.length;let t=0;for(const s of e)t+=s;n=t/s;}const i=r.toFixed(2),o=n?n.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${i} ms (${o} last 10 avg)\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${i} ms (${o} last 10 avg)`),this._debugOutput.innerHTML=`${i} (${o})`;}for(const e of t.handles)e.remove();this._entries.delete(e);}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on("command",(e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++;}))),t.handles.push(this._events.on("summary",(e=>{t.summaries.push(e);})))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t);}}recordEnd(e){i$5&&u$4(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed();}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0});}_emitSummary(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const s$8=i$7.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest");class a$8{constructor(e){this._ignoresSamplerPrecision=null,this._context=e;}get ignoresSamplerPrecision(){return t$f(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=l$3(this._context)),this._ignoresSamplerPrecision}}const p$2=e=>new a$8(e),l$3=e=>{const r=new r$d(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),a=new Uint8Array(4),p=new i$e(e,[0,0,1,0,0,1,1,1]),l=new o$b(e,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",{a_pos:0}),g=new i$d(e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));l.setUniform1i("u_texture",0),e.bindTexture(g,0);const m=e.getBoundFramebufferObject();e.bindFramebuffer(r),e.bindProgram(l);const{x:c,y:d,width:u,height:h}=e.getViewport();e.setViewport(0,0,1,1),p.draw(),e.setViewport(c,d,u,h),r.readPixels(0,0,1,1,6408,5121,a),l.dispose(),p.dispose(),r.dispose();const f=255!==a[0]||255!==a[1]||255!==a[2]||255!==a[3];return f&&s$8.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${a[0]}.${a[1]}.${a[2]}.${a[3]}]`),e.bindFramebuffer(m),f};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const r$8={name:"stencil",shaders:{vertexShader:o$a("stencil/stencil.vert"),fragmentShader:o$a("stencil/stencil.frag")},attributes:{a_pos:0}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class E extends r$e{constructor(r,n){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=n$b(),this._upperRight=n$b(),this._lowerLeft=n$b(),this._lowerRight=n$b(),this._mat2=e$c(),this._clipRendererInitialized=!1,this._supersampleScreenshots=!0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:h=document.createElement("canvas"),alpha:o=!0,stencil:l=!0,renderContext:d="webgl",supersampleScreenshots:c=!0,contextOptions:p={}}=n;this._canvas=h;const _=e$d(h,{alpha:o,antialias:!1,depth:!0,stencil:l},d);this.context=new l$8(_,p),this.painter=new v(this.context,this),t$e("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),r.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:n.timeline||new s$i,renderingOptions:n.renderingOptions,driverTestResult:p$2(this.context),profiler:new o$7(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=v$4({render:e=>this.renderFrame(e)}),this._taskHandle.pause(),this._supersampleScreenshots=c,this._lostWebGLContextHandle=r$f(h,"webglcontextlost",(()=>{this.emit("webgl-error",{error:new s$d("webgl-context-lost")});})),h.setAttribute("style","width: 100%; height:100%; display:block;"),r.appendChild(h);}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.painter.dispose(),this.context.dispose(),this._canvas=null;}get background(){return this._background}set background(e){this._background=e,this.requestRender();}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=d$b(this._highlightOptions,"version",(()=>{this.painter.setHighlightOptions(e),this.requestRender();})));}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender();}get state(){return this._state}set state(e){this._state=e,this.requestRender();}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender());}trashDisplayObject(e){this._trash.add(e),this.requestRender();}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._lastRenderRequestTime=performance.now(),this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume());}renderFrame(e){e.time-this._lastRenderRequestTime>=2e3&&this._taskHandle.pause(),this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render");}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._renderChildren(this.children,e);for(const t of this.children)t.afterRender(e);}_renderChildren(t,i){const s=this.context;i.profiler.recordStart("drawLayers"),i.dataUploadCounter=0,this._beforeRenderChildren(i),i.drawPhase=I.MAP,this.painter.beforeRenderLayers(s,this.background);for(const e of t)e.processRender(i);this.painter.renderLayers(s),i.drawPhase=I.HIGHLIGHT,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s);if(this._isLabelDrawPhaseRequired(t)){i.drawPhase=I.LABEL,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s);}if(t$e("esri-tiles-debug")){i.drawPhase=I.DEBUG,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s);}i.profiler.recordEnd("drawLayers"),this._afterRenderChildren();}_beforeRenderChildren(e){const{context:t}=this,{state:i,pixelRatio:s}=e;t.enforceState();const{size:n,rotation:a}=i,h=Math.round(n[0]*s),o=Math.round(n[1]*s);this._boundFBO=t.getBoundFramebufferObject();if(!(i.spatialReference&&(i.spatialReference._isWrappable?i.spatialReference._isWrappable():i.spatialReference.isWrappable)))return void(this._clipFrame=!1);const l=r$h(a),d=Math.abs(Math.cos(l)),u=Math.abs(Math.sin(l)),f=Math.round(h*d+o*u),b=Math.round(i.worldScreenWidth);if(f<=b)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===h&&this._clipFBO.height===o||(this._clipFBO=new r$d(t,{colorTarget:0,depthStencilTarget:3,width:h,height:o}));const w=(this.state.padding.left-this.state.padding.right)/2,R=(this.state.padding.bottom-this.state.padding.top)/2,x=.5*h,y=.5*o,C=1/h,F=1/o,v=b*s*.5,P=.5*(h*u+o*d),S=this._upperLeft,j=this._upperRight,B=this._lowerLeft,E=this._lowerRight;r$c(S,-v,-P),r$c(j,v,-P),r$c(B,-v,P),r$c(E,v,P),n$c(this._mat2),h$d(this._mat2,this._mat2,[x+w,y+R]),0!==a&&c$a(this._mat2,this._mat2,l),D(S,S,this._mat2),D(j,j,this._mat2),D(B,B,this._mat2),D(E,E,this._mat2);const T=this._clipData;T.set([2*B[0]*C-1,2*(o-B[1])*F-1,2*E[0]*C-1,2*(o-E[1])*F-1,2*S[0]*C-1,2*(o-S[1])*F-1,2*j[0]*C-1,2*(o-j[1])*F-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(T),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0;}_afterRenderChildren(){const e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.bindProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:t,g:i,b:s,a:r}=this.background.color;e.setClearColor(r*t/255,r*i/255,r*s/255,r);}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1);}}doRender(e){const t=this.context,{state:i,pixelRatio:s}=e;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,s*i.size[0],s*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),super.doRender(e);}async takeScreenshot(e,t){const i=l$9(e,this._supersampleScreenshots,this._state.padding),{framebufferWidth:s,framebufferHeight:r}=i,n=this.context,a=e.layers;let l=this.children;const d={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:i.pixelRatio,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1};if(null!=e.rotation){const t=d.state.viewpoint;t.rotation=e.rotation,d.state.viewpoint=t;}a.length>0&&(l=[],a.forEach((e=>{const i=t.find((t=>t.layer.id===e.id));i&&"container"in i&&i.container&&l.push(i.container);})));const c=new r$d(n,{colorTarget:0,depthStencilTarget:3,width:s,height:r}),p=n.getBoundFramebufferObject(),u=n.getViewport();n.bindFramebuffer(c),n.setViewport(0,0,s,r),this._renderChildren(l,d);const _=this._readbackScreenshot(i);n.bindFramebuffer(p),n.setViewport(u.x,u.y,u.width,u.height),this.requestRender();const m=this._ensureScreenshotEncodeCanvas();return e$e(_,e,m,{flipY:!0,premultipliedAlpha:!0})}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}_readbackScreenshot(e){const{framebufferWidth:t,framebufferHeight:i,region:s,resample:r}=e,n=this.context.gl;if(r){const e=n$d(t,i,this._ensureScreenshotEncodeCanvas());n.readPixels(0,0,t,i,6408,5121,new Uint8Array(e.data.buffer));const a=n$d(s.width,s.height,this._ensureScreenshotEncodeCanvas());return r$g(e,a,!0,r.region.x,i-(r.region.y+r.region.height),r.region.width,r.region.height)}{const e=n$d(s.width,s.height,this._ensureScreenshotEncodeCanvas());return n.readPixels(s.x,i-(s.y+s.height),s.width,s.height,6408,5121,new Uint8Array(e.data.buffer)),e}}_resizeCanvas(e){const t=this._canvas,i=t.style,{state:{size:s},pixelRatio:r}=e,n=s[0],a=s[1],h=Math.round(n*r),o=Math.round(a*r);t.width===h&&t.height===o||(t.width=h,t.height=o),i.width=n+"px",i.height=a+"px";}_initializeClipRenderer(e){if(this._clipRendererInitialized)return !0;const t=r$8.attributes,i=t$d(e,r$8);if(!i)return !1;const s=i$a.createVertex(e,35040,32),r=new Uint16Array([0,1,2,2,1,3]),n=i$a.createIndex(e,35044,r),a=new a$d(e,t,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:s},n);return this._clipStencilProgram=i,this._clipVBO=s,this._clipVAO=a,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach();}}_isLabelDrawPhaseRequired(e){let t=!1;for(const i of e){if(!(i instanceof r$e)){t=t||!1;break}if(i.hasLabels)return !0;t=t||this._isLabelDrawPhaseRequired(i.children);}return t}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const o$8="esri-zoom-box__container",a$9="esri-zoom-box__overlay",n$7="esri-zoom-box__overlay-background",h$7="esri-zoom-box__outline",l$4="Shift",c$6="Ctrl";let d$7=class extends p$4{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this);}destroy(){this.view=null;}set view(t){this._handles&&this._handles.forEach((t=>{t.remove();})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[l$4],(t=>this._handleDrag(t,1))),t.on("drag",[l$4,c$6],(t=>this._handleDrag(t,-1))));}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin();}_update(t,e,i,s){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw));}_end(t,e,i,s,o){const a=this.view,n=a.toMap(e$f(t+.5*i,e+.5*s));let h=Math.max(i/a.width,s/a.height);-1===o&&(h=1/h),this._destroyOverlay(),this.navigation.end(),a.goTo({center:n,scale:a.scale*h});}_updateBox(t,e,i,s){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+s),r.setAttributeNS(null,"class",h$7);}_updateBackground(t,e,i,s){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,s,this.view.width,this.view.height));}_createContainer(){const t=document.createElement("div");t.className=o$8,this.view.root.appendChild(t),this._container=t;}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",n$7);const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",a$9),r.appendChild(i),r.appendChild(s),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=s,this._overlay=r;}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null;}_toSVGPath(t,e,i,s,r,o){const a=t+i,n=e+s;return "M 0 0 L "+r+" 0 L "+r+" "+o+" L 0 "+o+" ZM "+t+" "+e+" L "+t+" "+n+" L "+a+" "+n+" L "+a+" "+e+" Z"}_handleDrag(t,e){const i=t.x,s=t.y,r=t.origin.x,o=t.origin.y;let a,n,h,l;switch(i>r?(a=r,h=i-r):(a=i,h=r-i),s>o?(n=o,l=s-o):(n=s,l=o-s),t.action){case"start":this._start();break;case"update":this._update(a,n,h,l);break;case"end":this._end(a,n,h,l,e);}t.stopPropagation();}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:s}=this._box;this._updateBox(t,e,i,s),this._updateBackground(t,e,i,s),this._rafId=requestAnimationFrame(this._redraw);}};e$9([y$1()],d$7.prototype,"navigation",void 0),e$9([y$1()],d$7.prototype,"view",null),d$7=e$9([i$8("esri.views.2d.navigation.ZoomBox")],d$7);var _$1=d$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class t$8{constructor(t){this.gain=t;}update(t){if(this.hasLastValue){const e=this.computeDelta(t);this.updateDelta(e);}this.lastValue=t;}reset(){this.lastValue=void 0,this.filteredDelta=void 0;}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return t-this.lastValue}updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class t$9{constructor(t,i,o){this._initialVelocity=t,this._stopVelocity=i,this._friction=o,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction));}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const o=this.value(t);return this.value(t+i)-o}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const o=1-this.friction;return t*(Math.pow(o,i)-1)/Math.log(o)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class c$7 extends t$9{constructor(e,t,i,s,n){super(e,t,i),this.sceneVelocity=s,this.direction=n;}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class h$8{constructor(t=300,i=12,s=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=s,this.enabled=!0,this.time=new t$8(.6),this.screen=[new t$8(.4),new t$8(.4)],this.scene=[new t$8(.6),new t$8(.6),new t$8(.6)],this.tmpDirection=n$e();}add(e,t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.015)return}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i);}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset();}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,n,r){o$c(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const h=s$j(this.tmpDirection);h>0&&d$c(this.tmpDirection,this.tmpDirection,1/h);const a=h/this.time.filteredDelta;return new c$7(e,n,r,a,this.tmpDirection)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
let c$8=class extends p$4{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new h$8(500,6,.92),this.momentum=null,this.tmpMomentum=n$e(),this.momentumFinished=!1,this.viewpoint=new u$6({targetGeometry:new w$2,scale:0,rotation:0}),this.watch("momentumFinished",(t=>{t&&this.navigation.stop();}));}begin(t,i){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(i),this.previousDrag=i;}update(t,i){this.addToEstimator(i);let o=i.center.x,s=i.center.y;const e=this.previousDrag;o=e?e.center.x-o:-o,s=e?s-e.center.y:s,t.viewpoint=At(this.viewpoint,t.viewpoint,[o||0,s||0]),this.previousDrag=i;}end(t,i){this.addToEstimator(i);const o=t.navigation.momentumEnabled;this.momentum=o?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end();}addToEstimator(t){const i=t.center.x,o=t.center.y,s=o$d(-i,o),e=t$i(-i,o,0);this.momentumEstimator.add(s,e,.001*t.timestamp);}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((i,o)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const s=.001*o;if(!this.momentumFinished){const o=this.momentum.valueDelta(this.animationTime,s);d$c(this.tmpMomentum,this.momentum.direction,o),At(i,i,this.tmpMomentum),t.constraints.constrainByGeometry(i);}this.animationTime+=s;}));}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop());}};e$9([y$1()],c$8.prototype,"momentumFinished",void 0),e$9([y$1()],c$8.prototype,"viewpoint",void 0),e$9([y$1()],c$8.prototype,"navigation",void 0),c$8=e$9([i$8("esri.views.2d.navigation.actions.Pan")],c$8);var d$8=c$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class s$9{constructor(t=2.5,i=.01,s=.95,l=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=s,this.maxVelocity=l,this.enabled=!0,this.value=new t$8(.8),this.time=new t$8(.3);}add(t,e){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta){const e=this.value.computeDelta(t);this.value.filteredDelta*e<0&&this.value.reset();}}this.time.update(e),this.value.update(t);}}reset(){this.value.reset(),this.time.reset();}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=e$7(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(t,e,s){return new t$9(t,e,s)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class a$a extends s$9{constructor(t=3,a=.01,s=.95,e=12){super(t,a,s,e);}add(t,a){if(this.value.hasLastValue){const a=this.value.lastValue;let s=t-a;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=a+s;}super.add(t,a);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class r$9 extends t$9{constructor(e,t,r){super(e,t,r);}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const r=super.value(e),s=super.value(e+t)-r;return Math.exp(s)}}class s$a extends s$9{constructor(e=2.5,t=.01,r=.95,s=12){super(e,t,r,s);}add(e,t){super.add(Math.log(e),t);}createMomentum(e,t,s){return new r$9(e,t,s)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
let l$5=class extends p$4{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new a$a(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new s$a,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new u$6({targetGeometry:new w$2,scale:0,rotation:0}),this.watch("_momentumFinished",(t=>{t&&this.navigation.stop();}));}begin(t,o){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=o.angle,this._previousRadius=this._startRadius=o.radius,this._previousCenter=o.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,o.timestamp),this.addToZoomEstimator(o,1);}update(t,o){null===this._updateTimestamp&&(this._updateTimestamp=o.timestamp);const i=o.angle,s=o.radius,e=o.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),m=Math.abs(s-this._startRadius),a=this._startRadius/s;if(this._previousRadius){const r=s/this._previousRadius;let h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=r>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&o.timestamp-this._updateTimestamp>200&&(this._zoomOnly=m-n>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,o.timestamp)):h=0,this.addToZoomEstimator(o,a),this.navigation.setViewpoint([e.x,e.y],1/r,h,[this._previousCenter.x-e.x,e.y-this._previousCenter.y]);}this._previousAngle=i,this._previousRadius=s,this._previousCenter=e;}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end();}addToRotateEstimator(t,o){this._rotationMomentumEstimator.add(t,.001*o);}addToZoomEstimator(t,o){this._zoomMomentumEstimator.add(o,.001*t.timestamp);}canZoomIn(t){const o=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||o>i}canZoomOut(t){const o=t.scale,i=t.constraints.effectiveMinScale;return 0===i||o<i}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((o,i)=>{const s=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,e=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),p=.001*i;if(this._momentumFinished=e&&n,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,p))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,p)):1;const e=n$b(),n=n$b();if(this._previousCenter){r$c(e,this._previousCenter.x,this._previousCenter.y),_$3(n,t.size,t.padding),s$c(e,e,n);const{constraints:m,scale:p}=t,c=p*s;s<1&&!m.canZoomInTo(c)?(s=p/m.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!m.canZoomOutTo(c)&&(s=p/m.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),wt(o,t.viewpoint,s,i,e,t.size),t.constraints.constrainByGeometry(o);}}this._animationTime+=p;}));}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop());}};e$9([y$1()],l$5.prototype,"_momentumFinished",void 0),e$9([y$1()],l$5.prototype,"viewpoint",void 0),e$9([y$1()],l$5.prototype,"navigation",void 0),l$5=e$9([i$8("esri.views.2d.navigation.actions.Pinch")],l$5);var _$2=l$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const v$1=n$b(),d$9=n$b();let j$1=class extends p$4{constructor(e){super(e),this._previousCenter=n$b(),this.viewpoint=new u$6({targetGeometry:new w$2,scale:0,rotation:0});}begin(e,t){this.navigation.begin(),r$c(this._previousCenter,t.center.x,t.center.y);}update(e,t){const{state:{size:o,padding:r}}=e;r$c(v$1,t.center.x,t.center.y),X$1(d$9,o,r),e.viewpoint=ht(this.viewpoint,e.state.paddedViewState.viewpoint,ft(d$9,this._previousCenter,v$1)),a$b(this._previousCenter,v$1);}end(){this.navigation.end();}};e$9([y$1()],j$1.prototype,"viewpoint",void 0),e$9([y$1()],j$1.prototype,"navigation",void 0),j$1=e$9([i$8("esri.views.2d.actions.Rotate")],j$1);var h$9=j$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const l$6=new u$6({targetGeometry:new w$2}),v$2=[0,0];let w$1=class extends p$4{constructor(t){super(t),this._endTimer=null,this.animationManager=null;}initialize(){this.pan=new d$8({navigation:this}),this.rotate=new h$9({navigation:this}),this.pinch=new _$2({navigation:this}),this.zoomBox=new _$1({view:this.view,navigation:this});}destroy(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null;}begin(){this._set("interacting",!0);}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250);}async zoom(t,i=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(i):this.zoomOut(i);this.setViewpoint(i,t,0,[0,0]);}async zoomIn(t){const i=this.view,o=i.constraints.snapToNextScale(i.scale);return this._zoomToScale(o,t)}async zoomOut(t){const i=this.view,o=i.constraints.snapToPreviousScale(i.scale);return this._zoomToScale(o,t)}setViewpoint(t,i,o,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,n),this.end();}setViewpointImmediate(t,i=0,o=[0,0],n=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,i,o);}continousRotateClockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{ht(t,t,-1);}));}continousRotateCounterclockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{ht(t,t,1);}));}resetRotation(){this.view.rotation=0;}continousPanLeft(){this._continuousPan([-10,0]);}continousPanRight(){this._continuousPan([10,0]);}continousPanUp(){this._continuousPan([0,10]);}continousPanDown(){this._continuousPan([0,-10]);}stop(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1));}_continuousPan(t){const i=this.get("view.viewpoint");this.animationManager.animateContinous(i,(i=>{At(i,i,t),this.view.constraints.constrainByGeometry(i);}));}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-this._lastEventTimestamp;t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1);}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:i,right:o,top:n,bottom:e}}=this.view;return v$2[0]=.5*(t[0]-o+i),v$2[1]=.5*(t[1]-e+n),v$2}async _zoomToScale(t,i=this._getDefaultAnchor()){const{view:o}=this,{constraints:n,scale:e,viewpoint:s,size:a,padding:r}=o,m=n.canZoomInTo(t),p=n.canZoomOutTo(t);if(!(t<e&&!m||t>e&&!p))return jt(l$6,s,t/e,0,i,a,r),n.constrainByGeometry(l$6),o.goTo(l$6,{animate:!0})}_scaleRotateTranslateViewpoint(t,i,o,n,e){const{view:s}=this,{size:a,padding:m,constraints:p,scale:h,viewpoint:u}=s,l=h*o,v=p.canZoomInTo(l),w=p.canZoomOutTo(l);return (o<1&&!v||o>1&&!w)&&(o=1),At(u,u,e),jt(t,u,o,n,i,a,m),p.constrainByGeometry(t)}};e$9([y$1()],w$1.prototype,"animationManager",void 0),e$9([y$1({type:Boolean,readOnly:!0})],w$1.prototype,"interacting",void 0),e$9([y$1()],w$1.prototype,"pan",void 0),e$9([y$1()],w$1.prototype,"pinch",void 0),e$9([y$1()],w$1.prototype,"rotate",void 0),e$9([y$1()],w$1.prototype,"view",void 0),e$9([y$1()],w$1.prototype,"zoomBox",void 0),w$1=e$9([i$8("esri.views.2d.navigation.MapViewNavigation")],w$1);var g$1=w$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
async function s$b(s){const r=import('./mask-svg-a36d7429.js'),i=import('./overlay-svg-48d17709.js'),o=t$j((await r).default,{signal:s}),e=t$j((await i).default,{signal:s}),m={mask:await o,overlay:await e};return p$5(s),m}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const i$6={name:"magnifier",shaders:{vertexShader:o$a("magnifier/magnifier.vert"),fragmentShader:o$a("magnifier/magnifier.frag")},attributes:{a_pos:0}};function t$a(e){return t$d(e,i$6)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class MagnifierView2D extends a$f{constructor(){super(),this._handles=new u$7,this._resourcePixelRatio=1,this.visible=!1;}destroy(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null);}get background(){return this._background}set background(e){this._background=e,this.requestRender();}get magnifier(){return this._magnifier}set magnifier(e){this._magnifier=e,this._handles.removeAll(),this._handles.add([d$b(e,"version",(()=>{this.visible=e.visible&&u$4(e.position)&&e.size>0,this.requestRender();})),e.watch(["mask","overlay"],(()=>this._reloadResources())),e.watch("size",(()=>{this._disposeRenderResources(),this.requestRender();}))]);}doRender(r){var t;const s=r.context;if(!this._resourcesTask)return void this._reloadResources();if(r.drawPhase!==I.MAP||!this._canRender())return;this._updateResources(r);const i=this._magnifier;if(t$f(i.position))return;const o=r.pixelRatio,n=i.size*o,h=1/i.factor,m=Math.ceil(h*n);this._readbackTexture.resize(m,m);const{size:l}=r.state,d=o*l[0],u=o*l[1],c=.5*m,p=.5*m,g=e$7(o*i.position.x,c,d-c-1),f=e$7(u-o*i.position.y,p,u-p-1),b=g-c,x=f-p,y=this._readbackTexture;s.bindTexture(y,0),s.gl.copyTexImage2D(y.descriptor.target,0,y.descriptor.pixelFormat,b,x,m,m,0);const k=null==(t=this.background)?void 0:t.color,T=k?[k.a*k.r/255,k.a*k.g/255,k.a*k.b/255,k.a]:[1,1,1,1],R=(g+i.offsetX*o)/d*2-1,v=(f-i.offsetY*o)/u*2-1,w=n/d*2,j=n/u*2,M=this._program;s.bindVAO(this._vertexArrayObject),s.bindTexture(this._overlayTexture,6),s.bindTexture(this._maskTexture,7),s.bindProgram(M),M.setUniform4fv("u_background",T),M.setUniform1i("u_readbackTexture",0),M.setUniform1i("u_overlayTexture",6),M.setUniform1i("u_maskTexture",7),M.setUniform4f("u_drawPos",R,v,w,j),M.setUniform1i("u_maskEnabled",i.maskEnabled?1:0),M.setUniform1i("u_overlayEnabled",i.overlayEnabled?1:0),s.setStencilTestEnabled(!1),s.drawArrays(5,0,4),s.bindVAO();}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const t=u$4(this._magnifier)?this._magnifier.mask:null,a=u$4(this._magnifier)?this._magnifier.overlay:null;this._resourcesTask=I$1((async s=>{const n=t$f(t)||t$f(a)?s$b(s):null,h=u$4(t)?L(t,{responseType:"image",signal:s}).then((e=>e.data)):n.then((e=>e.mask)),m=u$4(a)?L(a,{responseType:"image",signal:s}).then((e=>e.data)):n.then((e=>e.overlay)),[l,d]=await f$7([h,m]);this.mask=l,this.overlay=d,this._disposeRenderResources(),this.requestRender();}));}_disposeRenderResources(){this._readbackTexture=l$a(this._readbackTexture),this._overlayTexture=l$a(this._overlayTexture),this._maskTexture=l$a(this._maskTexture),this._vertexArrayObject=l$a(this._vertexArrayObject),this._program=l$a(this._program);}_updateResources(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const r=e.context;this._resourcePixelRatio=e.pixelRatio;const t=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=t$a(r);const s=new Uint16Array([0,1,0,0,1,1,1,0]),i=i$6.attributes;this._vertexArrayObject=new a$d(r,i,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:i$a.createVertex(r,35044,s)}),this.overlay.width=t,this.overlay.height=t,this._overlayTexture=new i$d(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay),this.mask.width=t,this.mask.height=t,this._maskTexture=new i$d(r,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);const a=1/this._magnifier.factor;this._readbackTexture=new i$d(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(a*t),height:Math.ceil(a*t)});}}

export { c$2 as LabelManager, MagnifierView2D, g$1 as MapViewNavigation, E as Stage };
