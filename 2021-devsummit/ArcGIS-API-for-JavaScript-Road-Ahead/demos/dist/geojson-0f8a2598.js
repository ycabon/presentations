import { ej as t, s as s$1, aB as t$1 } from './_virtual_index-634cbc09.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*r(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const n of e.features)n&&(yield n);}}function*i(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const n of e.coordinates)yield*n;break;case"MultiPolygon":for(const n of e.coordinates)for(const e of n)yield*e;}}function*s(e,r={}){const{geometryType:i,objectIdField:s}=r;for(;;){var u;const{value:c,done:l}=e.next();if(l)return;const{geometry:f,properties:a,id:d}=c;if(f&&o[f.type]!==i)continue;const p=a||{};let g=null!=(u=p[s])?u:null;s&&null!=d&&!p[s]&&(p[s]=g=d);const m=new t(f?y(new t$1,f,r):null,p,null,g);yield m;}}function u(e){for(;;){const{value:n,done:t}=e.next();if(t)return !1;if(n.length>2)return !0}}function c(e){return !f(e)}function l(e){return f(e)}function f(e){let n=0;for(let t=0;t<e.length;t++){const o=e[t],r=e[(t+1)%e.length];n+=o[0]*r[1]-r[0]*o[1];}return n<=0}function a(e){const n=e[0],t=e[e.length-1];return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]||e.push(n),e}function y(e,n,t){switch(n.type){case"LineString":return d(e,n,t);case"MultiLineString":return p(e,n,t);case"MultiPoint":return g(e,n,t);case"MultiPolygon":return m(e,n,t);case"Point":return h(e,n,t);case"Polygon":return w(e,n,t)}}function d(e,n,t){return j(e,n.coordinates,t),e}function p(e,n,t){for(const o of n.coordinates)j(e,o,t);return e}function g(e,n,t){return j(e,n.coordinates,t),e}function m(e,n,t){for(const o of n.coordinates){b(e,o[0],t);for(let n=1;n<o.length;n++)P(e,o[n],t);}return e}function h(e,n,t){return S(e,n.coordinates,t),e}function w(e,n,t){const o=n.coordinates;b(e,o[0],t);for(let r=1;r<o.length;r++)P(e,o[r],t);return e}function b(e,n,t){const o=a(n);c(o)?F(e,o,t):j(e,o,t);}function P(e,n,t){const o=a(n);l(o)?F(e,o,t):j(e,o,t);}function j(e,n,t){for(const o of n)S(e,o,t);e.lengths.push(n.length);}function F(e,n,t){for(let o=n.length-1;o>=0;o--)S(e,n[o],t);e.lengths.push(n.length);}function S(e,n,t){const[o,r,i]=n;e.coords.push(o,r),t.hasZ&&e.coords.push(i||0);}function M(e){switch(typeof e){case"string":return "esriFieldTypeString";case"number":return "esriFieldTypeDouble";default:return "unknown"}}function G(n){if(!n)throw new s$1("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==n.type&&"FeatureCollection"!==n.type)throw new s$1("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:n});const{crs:t}=n;if(!t)return;const o="string"==typeof t?t:"name"===t.type?t.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new s$1("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function I(e,n={}){const t=r(e),s=[],c=new Set,l=new Set;let f,a=!1,y=Number.NEGATIVE_INFINITY,d=null,p=!1,{geometryType:g=null}=n,m=!1;for(;;){const{value:e,done:n}=t.next();if(n){const e=d&&1===d.length&&d[0]||null;if(e)for(const n of s)n.name===e&&(n.type="esriFieldTypeOID");return {fields:s,geometryType:g,hasZ:a,maxObjectId:Math.max(0,y),objectIdFieldName:e,objectIdFieldType:f,unknownFields:Array.from(l)}}const{geometry:r,properties:h,id:w}=e;if(!r||(g||(g=o[r.type]),o[r.type]===g)){if(!a){a=u(i(r));}if(p||(p=null!=w,p&&(f=typeof w,"number"===f&&(d=Object.keys(h).filter((e=>h[e]===w))))),p&&"number"===f&&null!=w&&(y=Math.max(y,w),d.length>1?d=d.filter((e=>h[e]===w)):1===d.length&&(d=h[d[0]]===w?d:[])),!m&&h){let e=!0;for(const n in h){if(c.has(n))continue;const t=h[n];if(null==t){e=!1,l.add(n);continue}const o=M(t);"unknown"!==o?(l.delete(n),c.add(n),s.push({name:n,alias:n,type:o})):l.add(n);}m=e;}}}}function T(e,n){return Array.from(s(r(e),n))}

export { G, I, T };
