import { a3 as j$1, dG as V, dH as X, dI as D, s, bz as M$1, dJ as H, dK as g$1, bS as G$1, r, bd as e, dL as O } from './_virtual_index-2683c931.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const m=5e-4,f=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return !(e.equals(n)||t)},p=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,o=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return [Math.abs(t-e[2*n.rows+2]),Math.abs(o-e[2*n.rows+3])]},h={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54099:13524439.768288724,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125},y=32;async function M(){if(V()||!X())return null;await D();}function w(e,n,o){if(!f(e.spatialReference,n))return null;if(!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");return o?O(n,e.spatialReference,e):O(e.spatialReference,n,e)}function d(e,n,r,a=null){if(e.spatialReference.equals(n))return e;const l=f(e.spatialReference,n);if(l&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const c=r.center,x=new M$1({xmin:c.x-e.x/2,xmax:c.x+e.x/2,ymin:c.y-e.y/2,ymax:c.y+e.y/2,spatialReference:e.spatialReference}),m=l?H(x,n,a):g$1(x,n);if(null==m)return null;return {x:m.xmax-m.xmin,y:m.ymax-m.ymin}}function g(e,n=.01){return G$1(e)?n/G$1(e):0}function R(e,n,r=null,i=!0){const a=e.spatialReference;if(a.equals(n))return e;const l=f(a,n);if(l&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");const c=l?H(e,n,r):g$1(e,n);if(c&&i&&n.isGeographic){const[n,t]=W(a,!0),o=g(a);o&&null!=n&&null!=t&&(Math.abs(e.x-n)<o&&Math.abs(180-c.x)<m?c.x-=360:Math.abs(e.x-t)<o&&Math.abs(180+c.x)<m&&(c.x+=360));}return c}function j(n){const t=S(n[0].spatialReference);if(n.length<2||!r(t))return n[0];let{xmin:o,xmax:r$1,ymin:a,ymax:s}=n[0];for(let e=1;e<n.length;e++){const o=n[e];r$1=o.xmax+t*e,a=Math.min(a,o.ymin),s=Math.max(s,o.ymax);}return new M$1({xmin:o,xmax:r$1,ymin:a,ymax:s,spatialReference:n[0].spatialReference})}function b(n,t,o=null,r$1=!0){if(n.spatialReference.equals(t))return n;const i=z(n),a=S(n.spatialReference,!0);if(!r(a)||0===i)return N(n,t,o,r$1);return j(n.clone().normalize().map((e=>N(e,t,o,r$1))))}function N(e,n,i=null,a=!0){const l=e.spatialReference;if(l.equals(n))return e;const c=f(l,n);if(c&&!V())throw new s("rasterprojectionhelper-projectExtent","projection engine is not loaded");const x=c?H(e,n,i):g$1(e,n);let[p,h]=W(l,!0);if(x&&a&&l.isWebMercator&&n.isGeographic&&null!=p&&null!=h){const t=.001,o=1e3;if(Math.abs(e.xmin-p)<t&&Math.abs(h-e.xmax)>o&&Math.abs(180-x.xmax)<m){x.xmin=-180;const t=[];t.push(new j$1(e.xmax,e.ymin,l)),t.push(new j$1(e.xmax,(e.ymin+e.ymax)/2,l)),t.push(new j$1(e.xmax,e.ymax,l));const o=t.map((e=>R(e,n,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));x.xmax=Math.max.apply(null,o);}if(Math.abs(e.xmax-h)<t&&Math.abs(p-e.xmin)>o&&Math.abs(180+x.xmin)<m){x.xmax=180;const t=[];t.push(new j$1(e.xmin,e.ymin,l)),t.push(new j$1(e.xmin,(e.ymin+e.ymax)/2,l)),t.push(new j$1(e.xmin,e.ymax,l));const o=t.map((e=>R(e,n,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));x.xmin=Math.min.apply(null,o);}}[p,h]=W(n,!0);const y=g(n);return y&&null!=p&&null!=h&&(Math.abs(x.xmin-p)<y&&(x.xmin=p),Math.abs(x.xmax-h)<y&&(x.xmax=h)),x}function S(e,n=!1){const t=n?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*h[e.wkid]||null}function W(n,t=!1){const o=[],r$1=S(n,t);return r(r$1)&&(o.push(-r$1/2),o.push(r$1/2)),o}function v(e,n,t,o){let r=(e-n)/t;return r-Math.floor(r)!=0?r=Math.floor(r):o&&(r-=1),r}function z(n,t=!1){const o=S(n.spatialReference);if(!r(o))return 0;const r$1=t?0:-(o/2);return v(n.xmax,r$1,o,!0)-v(n.xmin,r$1,o,!1)}function P(t){const o=t.storageInfo.origin.x,r$1=S(t.spatialReference,!0);if(!r(r$1))return {originX:o,halfWorldWidth:null,pyramidsInfo:null};const i=r$1/2,{spatialReference:a,nativePixelSize:s,storageInfo:l,extent:c}=t,{maximumPyramidLevel:x,blockWidth:u,pyramidScalingFactor:m}=l;let f=s.x;const p=[];for(let e=0;e<=x;e++){const e=(c.xmax-o)/f/u,n=e-Math.floor(e)==0?e:Math.ceil(e),t=(r$1/2-o)/f/u,a=t-Math.floor(t)==0?t:Math.ceil(t),s=Math.floor((o+i)/f/u),l=Math.round((o+i)/f)%u,x=(u-Math.round((r$1-o)/f)%u)%u;p.push({resolutionX:f,blockWidth:u,datsetColumnCount:n,worldColumnCountFromOrigin:a,leftMargin:l,rightPadding:x,originColumnOffset:s}),f*=m;}return {originX:o,halfWorldWidth:e(S(a))/2,pyramidsInfo:p}}function C(n,o,i,a=null,l=null,c=!1,x=[y,y]){if(f(n.spatialReference,o.spatialReference)&&!V())throw new s("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(n&&o&&i))return null;const{xmin:u,ymin:m,xmax:h,ymax:M}=n,w=n.spatialReference,d=o.spatialReference,g=S(d);c=c||"gcs-shift"===(null==l?void 0:l.type);const j={x:x[0]*i.x,y:x[1]*i.y},b={cols:Math.ceil((h-u)/j.x-.1)+1,rows:Math.ceil((M-m)/j.y-.1)+1},N=j.x,W=j.y,v=[];let z,P=!1;for(let t=0;t<b.cols;t++){const n=[];for(let i=0;i<b.rows;i++){let s=R(new j$1({x:u+N*t,y:M-W*i,spatialReference:w}),d,a);l&&(s=l.inverseTransform(s)),n.push(s),t>0&&c&&s&&z[i]&&r(g)&&s.x<z[i].x&&(s.x+=g),s?(v.push((s.x-o.xmin)/(o.xmax-o.xmin)),v.push((o.ymax-s.y)/(o.ymax-o.ymin))):(v.push(NaN),v.push(NaN),P=!0);}z=n;}const C=p(v,b),G=new Float32Array((b.cols-1)*(b.rows-1)*2*6),L=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),k=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<b.cols-1;e++){for(let n=0;n<b.rows-1;n++){let t=e*b.rows*2+2*n;const o=v[t],r=v[t+1],i=v[t+2],a=v[t+3];t+=2*b.rows;const s=v[t],l=v[t+1],c=v[t+2],x=v[t+3];let u=0,m=12*(n*(b.cols-1)+e);for(let e=0;e<3;e++)G[m++]=L[u++]*o+L[u++]*i+L[u++]*c;u=0;for(let e=0;e<3;e++)G[m++]=L[u++]*r+L[u++]*a+L[u++]*x;u=0;for(let e=0;e<3;e++)G[m++]=k[u++]*o+k[u++]*s+k[u++]*c;u=0;for(let e=0;e<3;e++)G[m++]=k[u++]*r+k[u++]*l+k[u++]*x;}if(P)for(let e=0;e<G.length;e++)isNaN(G[e])&&(G[e]=-1);}return {offsets:v,error:C,coefficients:G,spacing:x,size:[b.cols-1,b.rows-1]}}function G(e){const n=e.clone().normalize();return 1===n.length?n[0]:j(n)}function L(e,n,t){const o=Math.log(e.x/n.pixelSize.x)/Math.LN2,i=Math.log(e.y/n.pixelSize.y)/Math.LN2,a=n.storageInfo.maximumPyramidLevel||0;let s="down"===t?Math.floor(Math.min(o,i)):"up"===t?Math.ceil(Math.max(o,i)):Math.round((o+i)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);const c=2**s;return {pyramidLevel:s,pyramidResolution:new j$1({x:c*n.nativePixelSize.x,y:c*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function k(e,n,t=512,o=!0){const{extent:i,spatialReference:s,pixelSize:l}=e,c=d(new j$1({x:l.x,y:l.y,spatialReference:s}),n,i);if(null==c)return {projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const x=(c.x+c.y)/2,u=G$1(n),m=x*u*96*39.37,f=n.isGeographic?512/t*295828763.7958547:512/t*591657527.591555;let p=!1;const h=b(i,n);o&&(n.isGeographic||n.isWebMercator)&&(p=h.xmin*h.xmax<0);let y,M=m;const w=1.001;if(p){M=f;const e=.29858214164761665,n=e*(96*u*39.37);y=d(new j$1({x:e,y:e,spatialReference:{wkid:3857}}),s,h),y.x*=M/n,y.y*=M/n;}else {y={x:l.x,y:l.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;M<f*(w/2)&&t<n;)t++,M*=2,y.x*=2,y.y*=2;Math.max(M,f)/Math.min(M,f)<=w&&(M=f);}const g=[M],R=[{x:y.x,y:y.y}],j=70.5310735,N=Math.min(j,m)/w;for(;M>=N;)M/=2,y.x/=2,y.y/=2,g.push(M),R.push({x:y.x,y:y.y});return {projectedPixelSize:c,scales:g,srcResolutions:R,isCustomTilingScheme:!p}}

export { C, G, L, M, P, R, b, d, k, w, z };
