import { b3 as y$5, ao as y$6, ap as f$7, am as s$b, an as u$a, al as l$7, ai as i$7, aq as c$9, n as n$f, b5 as o$b, b6 as o$c, b7 as t$7, C as n$g, b8 as c$a, b9 as h$7, ba as n$h, bb as o$d, B as r$e, R as D$2, P as i$8, Q as c$b, O as n$i, bc as e$8, aK as a$6, bd as e$9, be as o$e, bf as l$8, bg as _$2, c as u$b, bh as e$a, aE as k$2, aj as S$3, j as e$b, y as y$7, bi as o$f, k as i$9, bj as j$2, bk as n$j, o as t$9, t as t$a, bl as l$9, s as s$c, bm as o$h, bn as t$b, r as r$f, bo as m$6, H as c$c, bp as i$a } from './_virtual_index-634cbc09.js';
import { x as x$5 } from './MD5-a554c7d9.js';
import { m as m$5, A as A$4, E as E$2, X as X$1 } from './Utils-3e0360c1.js';
import { f as f$8, A as A$5 } from './MaterialKey-202e82ff.js';
import { o as o$g } from './visualVariablesUtils-07a6daab.js';
import { k as k$3 } from './definitions-12783a0f.js';
import { t as t$8 } from './Rect-a3838111.js';
import { C as C$3 } from './BidiEngine-fb789855.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class t$6{constructor(){this.setIdentity();}getAngle(){return (null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0;}setTranslate(t,s){this.tx=t,this.ty=s;}setTranslateZ(t){this.tz=t;}setRotateCS(t,s){this.rz=void 0,this.rz_c=t,this.rz_s=s;}setRotate(t){this.rz=t,this.rz_c=void 0,this.rz_s=void 0;}setRotateY(t){this.ry=t;}setScale(t){this.s=t;}setMeasure(t){this.m=t;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class r$d{constructor(t){this._geometry=t;}next(){const t=this._geometry;return this._geometry=null,t}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function o$a(i){const h=y$5(i);return c$8(h),h}function a$5(t){if(t){for(let i=t.length-1;i>0;--i)t[i][0]-=t[i-1][0],t[i][1]-=t[i-1][1];}}function r$c(t){if(t)for(const i of t)a$5(i);}function l$6(t){if(t){const i=t.length;for(let h=1;h<i;++h)t[h][0]+=t[h-1][0],t[h][1]+=t[h-1][1];}}function u$9(t){if(t)for(const i of t)l$6(i);}function c$8(t){t&&(y$6(t)?u$9(t.rings):f$7(t)?u$9(t.paths):s$b(t)&&l$6(t.points));}function p$6(t){t&&(y$6(t)?r$c(t.rings):f$7(t)?r$c(t.paths):s$b(t)&&a$5(t.points));}function m$4(t){if(t)for(const i of t)f$6(i);}function f$6(t){t&&t.reverse();}function P$2(t,i,h){return [t[0]+(i[0]-t[0])*h,t[1]+(i[1]-t[1])*h]}function x$4(t){return !(!t||0===t.length)&&(t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1])}function g$1(t){return t[4]}function d$2(t,i){t[4]=i;}class C$2{constructor(t,n,o,a){this.acceptPolygon=n,this.acceptPolyline=o,this.geomUnitsPerPoint=a,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,t&&(y$6(t)?n&&(this.multiPath=t.rings,this.isClosed=!0):f$7(t)?o&&(this.multiPath=t.paths,this.isClosed=!1):u$a(t)&&n&&(this.multiPath=I$2(t).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new t$6;}next(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;const t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}class y$4{constructor(t,i,h,n){this.inputGeometries=t,this.acceptPolygon=i,this.acceptPolyline=h,this.geomUnitsPerPoint=n,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1;}next(){for(;;){if(!this.multiPath){let t=this.inputGeometries.next();for(;t;){if(y$6(t)?this.acceptPolygon&&(this.multiPath=t.rings,this.isClosed=!0):f$7(t)?this.acceptPolyline&&(this.multiPath=t.paths,this.isClosed=!1):u$a(t)&&this.acceptPolygon&&(this.multiPath=I$2(t).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}t=this.inputGeometries.next();}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;const t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null;}}}function I$2(t){return {rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class o$9{static local(){return null===o$9.instance&&(o$9.instance=new o$9),o$9.instance}execute(s,t,e){return new r$b(s,t,e)}}o$9.instance=null;class r$b{constructor(s,t,e){this._inputGeometries=s,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI);}next(){let n=this._inputGeometries.next();for(;n;){if(y$6(n)){this._isClosed=!0;const t=y$5(n);return this._processMultipath(t.rings),t}if(f$7(n)){this._isClosed=!1;const t=y$5(n);return this._processMultipath(t.paths),t}if(u$a(n)){if(this._maxCosAngle)return n;this._isClosed=!0;const s=[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]];return this._processPath(s),{rings:[s]}}n=this._inputGeometries.next();}return null}_processMultipath(s){if(s)for(const t of s)this._processPath(t);}_processPath(s){if(s){let t,e,i,o,r,l,a=s.length,h=s[0];this._isClosed&&++a;for(let c=1;c<a;++c){let m;m=this._isClosed&&c===a-1?s[0]:s[c];const _=m[0]-h[0],u=m[1]-h[1],p=Math.sqrt(_*_+u*u);if(c>1&&p>0&&i>0){(t*_+e*u)/p/i<=this._maxCosAngle&&d$2(h,1);}1===c&&(o=_,r=u,l=p),p>0&&(h=m,t=_,e=u,i=p);}if(this._isClosed&&i>0&&l>0){(t*o+e*r)/l/i<=this._maxCosAngle&&d$2(s[0],1);}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const t$5=.03;class e$7{constructor(){this._path=[];}path(){return this._path}addPath(t,e){e||t.reverse(),Array.prototype.push.apply(this._path,t),e||t.reverse();}static mergePath(t,e){e&&Array.prototype.push.apply(t,e);}startPath(t){this._path.push(t);}lineTo(t){this._path.push(t);}close(){const t=this._path;t.length>1&&(t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]]));}}class s$a{constructor(t=0,e=!1){}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);t[0]/=e,t[1]/=e;}calculateLength(t,e){const s=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(s*s+n*n)}calculateSegLength(t,e){return this.calculateLength(t[e],t[e+1])}calculatePathLength(t){let e=0;const s=t?t.length:0;for(let n=0;n<s-1;++n)e+=this.calculateSegLength(t,n);return e}calculatePathArea(t){let e=0;const s=t?t.length:0;for(let n=0;n<s-1;++n)e+=(t[n+1][0]-t[n][0])*(t[n+1][1]+t[n][1]);return e/2}getCoord2D(t,e,s){return [t[0]+(e[0]-t[0])*s,t[1]+(e[1]-t[1])*s]}getSegCoord2D(t,e,s){return this.getCoord2D(t[e],t[e+1],s)}getAngle(t,e,s){const n=e[0]-t[0],r=e[1]-t[1];return Math.atan2(r,n)}getSegAngle(t,e,s){return this.getAngle(t[e],t[e+1],s)}getAngleCS(t,e,s){const n=e[0]-t[0],r=e[1]-t[1],h=Math.sqrt(n*n+r*r);return h>0?[n/h,r/h]:[1,0]}getSegAngleCS(t,e,s){return this.getAngleCS(t[e],t[e+1],s)}cut(t,e,s,n){return [s<=0?t[e]:this.getSegCoord2D(t,e,s),n>=1?t[e+1]:this.getSegCoord2D(t,e,n)]}addSegment(t,e,s){s&&t.push(e[0]),t.push(e[1]);}getSubCurve(t,e,s){const n=[];return this.appendSubCurve(n,t,e,s)?n:null}appendSubCurve(t,e,s,n){const r=e?e.length-1:0;let h=0,l=!0,a=0;for(;a<r;){const r=this.calculateSegLength(e,a);if(0!==r){if(l){if(h+r>s){const o=(s-h)/r;let u=1,c=!1;h+r>=n&&(u=(n-h)/r,c=!0);const i=this.cut(e,a,o,u);if(i&&this.addSegment(t,i,l),c)break;l=!1;}}else {if(h+r>n){const s=this.cut(e,a,0,(n-h)/r);s&&this.addSegment(t,s,l);break}this.addSegment(t,[e[a],e[a+1]],l);}h+=r,++a;}else ++a;}return !0}getCIMPointAlong(t,e){const s=t?t.length-1:0;let n=0,r=-1;for(;r<s;){++r;const s=this.calculateSegLength(t,r);if(0!==s){if(n+s>e){const h=(e-n)/s;return this.getCoord2D(t[r],t[r+1],h)}n+=s;}}return null}isEmpty(t,e){if(!t||t.length<=1)return !0;const s=t?t.length-1:0;let n=-1;for(;n<s;){if(++n,t[n+1][0]!==t[n][0]||t[n+1][1]!==t[n][1])return !1;if(e&&t[n+1][2]!==t[n][2])return !1}return !0}offset(t,e,s,n,r){if(!t||t.length<2)return null;let h=t.length;const l=t[0][0]===t[h-1][0]&&t[0][1]===t[h-1][1];if(l){if(t.length<3)return null;--h;}const a=[];let o=l?t[h-1]:null,u=t[0];for(let c=0;c<h;c++){const r=c===h-1?l?t[0]:null:t[c+1];if(o)if(r){const t=[r[0]-u[0],r[1]-u[1]];this.normalize(t);const h=[u[0]-o[0],u[1]-o[1]];this.normalize(h);const l=h[0]*t[1]-h[1]*t[0],c=h[0]*t[0]+h[1]*t[1];if(l>=0==e<=0){const s=[t[0]-h[0],t[1]-h[1]];this.normalize(s);const n=Math.sqrt((1+c)/2),r=-Math.abs(e)/n;a.push([u[0]-s[0]*r,u[1]-s[1]*r]);}else switch(s){case"Mitered":{const s=Math.sqrt((1+c)/2);if(s>0&&1/s<n){const n=[t[0]-h[0],t[1]-h[1]];this.normalize(n);const r=Math.abs(e)/s;a.push([u[0]-n[0]*r,u[1]-n[1]*r]);break}}case"Bevelled":a.push([u[0]+h[1]*e,u[1]-h[0]*e]),a.push([u[0]+t[1]*e,u[1]-t[0]*e]);break;case"Rounded":{a.push([u[0]+h[1]*e,u[1]-h[0]*e]);const s=5,n=1/s;let r=n;for(let l=1;l<s;l++,r+=n){const s=[h[1]*(1-r)+t[1]*r,-h[0]*(1-r)-t[0]*r];this.normalize(s),a.push([u[0]+s[0]*e,u[1]+s[1]*e]);}a.push([u[0]+t[1]*e,u[1]-t[0]*e]);break}case"Square":default:if(l<0)a.push([u[0]+(h[1]+h[0])*e,u[1]+(h[1]-h[0])*e]),a.push([u[0]+(t[1]-t[0])*e,u[1]-(t[0]+t[1])*e]);else {const s=Math.sqrt((1+Math.abs(c))/2),n=[t[0]-h[0],t[1]-h[1]];this.normalize(n);const r=e/s;a.push([u[0]-n[0]*r,u[1]-n[1]*r]);}}}else {const t=[u[0]-o[0],u[1]-o[1]];this.normalize(t),a.push([u[0]+t[1]*e,u[1]-t[0]*e]);}else {const t=[r[0]-u[0],r[1]-u[1]];this.normalize(t),a.push([u[0]+t[1]*e,u[1]-t[0]*e]);}o=u,u=r;}return l&&a.push([a[0][0],a[0][1]]),a}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const s$9=1.7320508075688772,i$6=5,l$5="OpenEnded";class c$7{static local(){return null===c$7.instance&&(c$7.instance=new c$7),c$7.instance}execute(t,e,r){return new u$8(t,e,r)}}c$7.instance=null;class u$8 extends y$4{constructor(t,e,o){super(t,!1,!0),this._curveHelper=new s$a,this._width=(void 0!==e.width?e.width:i$6)*o,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:l$5,this._offsetFlattenError=t$5*o;}processPath(t){switch(this._arrowType){case"OpenEnded":default:return this._constructSimpleArrow(t,!0);case"Block":return this._constructSimpleArrow(t,!1);case"Crossed":return this._constructCrossedArrow(t)}}_constructSimpleArrow(t,e){const r=this._curveHelper.calculatePathLength(t);let n=this._width;r<2*n&&(n=r/2);const s=this._curveHelper.getSubCurve(t,0,r-n);if(!s)return null;const i=n/2;if(this._curveHelper.isEmpty(s,!1))return null;const l=this._constructOffset(s,-i);if(!l)return null;const c=this._constructOffset(s,i);if(!c)return null;const u=this._constructArrowBasePoint(l,-i/2);if(!u)return null;const h=this._constructArrowBasePoint(c,i/2);if(!h)return null;const a=t[t.length-1];e||(this._makeControlPoint(c,!0),this._makeControlPoint(l,!0));const _=new e$7;return _.addPath(c,!0),_.lineTo(h),this._makeControlPoint(_.path()),_.lineTo(a),this._makeControlPoint(_.path()),_.lineTo(u),this._makeControlPoint(_.path()),_.addPath(l,!1),e?{paths:[_.path()]}:(_.close(),{rings:[_.path()]})}_constructCrossedArrow(t){const e=this._curveHelper.calculatePathLength(t);let r=this._width;e<r*(1+s$9+1)&&(r=e/(1+s$9+1));const n=this._curveHelper.getSubCurve(t,0,e-r*(1+s$9));if(!n)return null;const i=r/2;if(this._curveHelper.isEmpty(n,!1))return null;const l=this._constructOffset(n,i);if(!l)return null;const c=this._constructOffset(n,-i);if(!c)return null;const u=this._curveHelper.getSubCurve(t,0,e-r);if(!u)return null;if(this._curveHelper.isEmpty(u,!1))return null;const h=this._constructOffset(u,i);if(!h)return null;const a=this._constructOffset(u,-i);if(!a)return null;const _=h[h.length-1],f=this._constructArrowBasePoint(h,i/2);if(!f)return null;const p=a[a.length-1],d=this._constructArrowBasePoint(a,-i/2);if(!d)return null;const m=t[t.length-1];this._makeControlPoint(l,!1),this._makeControlPoint(c,!1);const w=new e$7;return w.addPath(l,!0),this._makeControlPoint(w.path()),w.lineTo(p),w.lineTo(d),this._makeControlPoint(w.path()),w.lineTo(m),this._makeControlPoint(w.path()),w.lineTo(f),this._makeControlPoint(w.path()),w.lineTo(_),this._makeControlPoint(w.path()),w.addPath(c,!1),{paths:[w.path()]}}_constructOffset(t,e){return this._curveHelper.offset(t,e,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const r=t[t.length-2],n=t[t.length-1],o=[n[0]-r[0],n[1]-r[1]];return this._curveHelper.normalize(o),[n[0]+o[1]*e,n[1]-o[0]*e]}_makeControlPoint(t,r=!1){d$2(r?t[0]:t[t.length-1],1);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class o$8{static local(){return null===o$8.instance&&(o$8.instance=new o$8),o$8.instance}execute(e,t,i){return new f$5(e,t,i)}}o$8.instance=null;class f$5{constructor(e,t,i){this._inputGeometries=e,this._curveHelper=new s$a,this._size=(void 0!==t.size?t.size:1)*i,this._offsetFlattenError=t$5*i;}next(){let n=this._inputGeometries.next();for(;n;){if(u$a(n))if(this._size>0){const e=[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]],t=this._curveHelper.offset(e,this._size,"Rounded",4,this._offsetFlattenError);if(t)return {rings:[t]}}else {if(!(this._size<0))return n;if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return {xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size}}if(y$6(n)){if(0===this._size)return n;const e=[];for(const t of n.rings){const i=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError);i&&e.push(i);}if(e.length)return {rings:e}}if(f$7(n)&&this._size>0){const e=[];for(const t of n.paths)if(t&&t.length>1){const i=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError),s=this._curveHelper.offset(t,-this._size,"Rounded",4,this._offsetFlattenError);if(i&&s){for(let e=s.length-1;e>=0;e--)i.push(s[e]);i.push([i[0][0],i[0][1]]),e.push(i);}}if(e.length)return {rings:e}}l$7(n)&&this._size,n=this._inputGeometries.next();}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class u$7{static local(){return null===u$7.instance&&(u$7.instance=new u$7),u$7.instance}execute(e,t,u){return new s$8(e,t,u)}}u$7.instance=null;class s$8 extends y$4{constructor(e,u,s){super(e,!0,!0),this._curveHelper=new s$a,this._beginCut=(void 0!==u.beginCut?u.beginCut:1)*s,this._endCut=(void 0!==u.endCut?u.endCut:1)*s,this._middleCut=(void 0!==u.middleCut?u.middleCut:0)*s,this._invert=void 0!==u.invert&&u.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0);}processPath(e){const t=this._beginCut,u=this._endCut,s=this._middleCut,i=this._curveHelper.calculatePathLength(e),r=[];if(this._invert)if(0===t&&0===u&&0===s);else if(t+u+s>=i)r.push(e);else {let n=this._curveHelper.getSubCurve(e,0,t);n&&r.push(n),n=this._curveHelper.getSubCurve(e,.5*(i-s),.5*(i+s)),n&&r.push(n),n=this._curveHelper.getSubCurve(e,i-u,u),n&&r.push(n);}else if(0===t&&0===u&&0===s)r.push(e);else if(t+u+s>=i);else if(0===s){const s=this._curveHelper.getSubCurve(e,t,i-u);s&&r.push(s);}else {let n=this._curveHelper.getSubCurve(e,t,.5*(i-s));n&&r.push(n),n=this._curveHelper.getSubCurve(e,.5*(i+s),i-u),n&&r.push(n);}return 0===r.length?null:{paths:r}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const i$5=1e-7;class n$e{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0;}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,s,e=!0){if(this._setEmpty(),!t||0===t.length)return !1;for(let n=0;n<t.length;n++){let s=Math.abs(t[n]);e&&s<i$5&&(s=i$5),this._values.push(s),this._length+=s;}return s&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const s=this._values?this._values.length:0;for(let e=0;e<s;++e)this._values[e]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t;}addValue(t){this._length+=t,this._values.push(t);}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1;}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0;}}class h$6{constructor(){this.reset();}reset(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1;}isValid(){return -1!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd;}}class r$a extends s$a{constructor(t=0,s=!1){super(t,s),this._tolerance=t$5,this._currentPosition=new h$6;}updateTolerance(t){this._tolerance=t$5*t;}init(t,s,e=!0){return e?(this._patternLength=s.length(),this._partExtPtGap=s.extPtGap,this._partCtrlPtGap=s.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=t,this._seg=-1,this.setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,s=0){const e=new h$6;return !!this._nextPosition(t,e,null,s)&&(e.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[s,e]=this._getAngle(this._currentPosition);t.ca=s,t.sa=e;}nextPointAndAngle(t,s,e=0){const i=new h$6;if(!this._nextPosition(t,i,null,e))return !1;i.copyTo(this._currentPosition),s.pt=this._getPoint(i);const[n,r]=this._getAngle(i);return s.ca=n,s.sa=r,!0}nextCurve(t){if(0===t)return null;const s=[],e=new h$6;return this._nextPosition(t,e,s,1)?(e.copyTo(this._currentPosition),s):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}_nextPosition(t,s,e,i){if(this._currentPosition.isPathEnd)return !1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(s);s.abscissa+t*this._partLengthRatio>s.segmentLength+this._tolerance;){if(e){if(0===e.length)if(0===n){const t=this._path[s.segment];e.push([t[0],t[1]]);}else e.push(this.getSegCoord2D(this._path,s.segment,n));const t=this._path[s.segment+1];e.push([t[0],t[1]]);}if(n=0,t-=(s.segmentLength-s.abscissa)/this._partLengthRatio,this._partSegCount)s.segment=this.nextSegment(),s.segmentLength=this.calculateSegLength(this._path,s.segment),s.abscissa=0,this._partSegCount--;else {if(!this.setPosAtNextPart())return 0!==i&&(s.segmentLength=this.calculateSegLength(this._path,s.segment),s.isPartEnd=!0,1===i?(s.abscissa=s.segmentLength,s.isPathEnd=!0):s.abscissa=s.segmentLength+t,!0);this._currentPosition.copyTo(s);}}if(s.abscissa+=t*this._partLengthRatio,e){if(0===e.length)if(0===n){const t=this._path[s.segment];e.push([t[0],t[1]]);}else e.push(this.getSegCoord2D(this._path,s.segment,n));const t=s.abscissa/s.segmentLength;if(1===t){const t=this._path[s.segment+1];e.push([t[0],t[1]]);}else e.push(this.getSegCoord2D(this._path,s.segment,t));}return this._partSegCount||Math.abs(s.abscissa-s.segmentLength)<this._tolerance&&(s.isPathEnd=this._partIsLast,s.isPartEnd=!0),!0}_getPoint(t){if(-1===t.segment)throw new Error("missing segment");const s=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._path,t.segment,s)}_getAngle(t){if(-1===t.segment)throw new Error("missing segment");const s=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._path,t.segment,s)}setPosAtNextPart(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return !1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===g$1(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}let s=this._partSegCount;for(;s;)this.previousSegment(),--s;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this.getStartPointIndex();this._ctrlPtBegin=1===g$1(this._path[e]);let i=e+this._partSegCount+1;if(i>=this._path.length&&(i=0),this._ctrlPtEnd=1===g$1(this._path[i]),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,s=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let e=Math.round((this._partLength-(t+s))/this._patternLength);e<=0&&(e=t+s>0?0:1),this._partLengthRatio=this._partLength/(t+s+e*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1);}else this._partLengthRatio=1;return !0}hasNextSegment(){return this._seg<this._path.length-2}previousSegment(){return --this._seg}nextSegment(){return ++this._seg}getStartPointIndex(){return this._seg}getEndPointIndex(){return this._seg+1}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class i$4{static local(){return null===i$4.instance&&(i$4.instance=new i$4),i$4.instance}execute(t,e,s){return new r$9(t,e,s)}}i$4.instance=null;class r$9 extends y$4{constructor(t,e,i){super(t,!0,!0),this._walker=new r$a,this._walker.updateTolerance(i),this._endings=e.lineDashEnding,this._customDashPos=void 0!==e.offsetAlongLine?e.offsetAlongLine*i:0,this._offsetAtEnd=void 0!==e.customEndingOffset?e.customEndingOffset*i:0,this._pattern=new n$e,this._pattern.init(e.dashTemplate,!0),this._pattern.scale(i);}processPath(t){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[t]};if(!this.iteratePath){let e=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(e=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd);}const s=this._walker.calculatePathLength(t);if(this._pattern.isEmpty()||s<.1*this._pattern.length())return {paths:[t]};if(!this._walker.init(t,this._pattern,e))return {paths:[t]}}let s;if(this.iteratePath)s=this._pattern.nextValue();else {let t;switch(this._endings){case"HalfPattern":default:t=.5*this._pattern.firstValue();break;case"HalfGap":t=.5*-this._pattern.lastValue();break;case"FullGap":t=-this._pattern.lastValue();break;case"FullPattern":t=0;break;case"NoConstraint":case"Custom":t=-this._customDashPos;}let e=t/this._pattern.length();e-=Math.floor(e),t=e*this._pattern.length(),this._pattern.reset(),s=this._pattern.nextValue();let a=!1;for(;t>=s;)t-=s,s=this._pattern.nextValue(),a=!a;s-=t,a?(this._walker.nextPosition(s),s=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(s),s=this._pattern.nextValue(),this._walker.nextPosition(s),s=this._pattern.nextValue());}let a=this._walker.nextCurve(s);return a?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),e$7.mergePath(a,this._firstCurve),this._firstCurve=null)):(s=this._pattern.nextValue(),!this._walker.nextPosition(s)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(a=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,a=this._firstCurve,this._firstCurve=null),{paths:[a]}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class h$5{static local(){return null===h$5.instance&&(h$5.instance=new h$5),h$5.instance}execute(t,i,e){return new n$d(t,i,e)}}h$5.instance=null;class n$d{constructor(t,i,h){switch(this._inputGeometries=t,this._curveHelper=new s$a,this._width=(void 0!==i.width?i.width:2)*h,i.method){case"Mitered":default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square";}this._option=i.option,this._offsetFlattenError=t$5*h;}next(){let e=this._inputGeometries.next();for(;e;){if(u$a(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;const t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if(y$6(e)&&this._width>0){const t=[];for(const i of e.rings){const e=this._curveHelper.calculatePathLength(i),s=this._curveHelper.offset(i,this._width,this._method,4,this._offsetFlattenError);s&&(e<0&&s.reverse(),t.push(s));}if(t.length)return {rings:t}}e=this._inputGeometries.next();}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class s$7{static local(){return null===s$7.instance&&(s$7.instance=new s$7),s$7.instance}execute(t,i,s){return new e$6(t,i,s)}}s$7.instance=null;class e$6 extends y$4{constructor(t,s,e){super(t,!1,!0),this._curveHelper=new s$a,this._length=(void 0!==s.length?s.length:20)*e,this._angle=void 0!==s.angle?s.angle:225,this._position=void 0!==s.position?s.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1;}processPath(t){if(this._curveHelper.isEmpty(t,!1))return null;const i=t[0],s=t[t.length-1],e=[s[0]-i[0],s[1]-i[1]];this._curveHelper.normalize(e);const n=[i[0]+(s[0]-i[0])*this._position/100,i[1]+(s[1]-i[1])*this._position/100],h=Math.cos((90-this._angle)/180*Math.PI);let r=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(r=-r),this._mirror=!this._mirror;return {paths:[[i,[n[0]-this._length/2*h,n[1]-this._length/2*r],[n[0]+this._length/2*h,n[1]+this._length/2*r],s]]}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class n$c{static local(){return null===n$c.instance&&(n$c.instance=new n$c),n$c.instance}execute(t,s,e){return new r$8(t,s,e)}}n$c.instance=null;class r$8{constructor(t,s,e){this._inputGeometries=t,this._offsetX=void 0!==s.offsetX?s.offsetX*e:0,this._offsetY=void 0!==s.offsetY?-s.offsetY*e:0;}next(){let n=this._inputGeometries.next();for(;n;){if(u$a(n))return {xmin:n.xmin+this._offsetX,xmax:n.xmax+this._offsetX,ymin:n.ymin+this._offsetY,ymax:n.ymax+this._offsetY};if(y$6(n)){const s=y$5(n);return this._moveMultipath(s.rings,this._offsetX,this._offsetY),s}if(f$7(n)){const s=y$5(n);return this._moveMultipath(s.paths,this._offsetX,this._offsetY),s}if(s$b(n)){const s=y$5(n);return this._movePath(s.points,this._offsetX,this._offsetY),s}if(l$7(n))return {x:n.x+this._offsetX,y:n.y+this._offsetY};n=this._inputGeometries.next();}return null}_moveMultipath(t,s,e){if(t)for(const i of t)this._movePath(i,s,e);}_movePath(t,s,e){if(t)for(const i of t)i[0]+=s,i[1]+=e;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class o$7{static local(){return null===o$7.instance&&(o$7.instance=new o$7),o$7.instance}execute(t,e,s){return new r$7(t,e,s)}}o$7.instance=null;class r$7{constructor(t,e,s){this._inputGeometries=t,this._curveHelper=new s$a,this._offset=(void 0!==e.offset?e.offset:1)*s,this._method=e.method,this._option=e.option,this._offsetFlattenError=t$5*s;}next(){let i=this._inputGeometries.next();for(;i;){if(0===this._offset)return i;if(u$a(i)){if("Rounded"===this._method&&this._offset>0){const t=[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]],e=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError);return e?{rings:[e]}:null}if(Math.min(i.xmax-i.xmin,i.ymax-i.ymin)+2*this._offset>0)return {xmin:i.xmin-this._offset,xmax:i.xmax+this._offset,ymin:i.ymin-this._offset,ymax:i.ymax+this._offset}}if(y$6(i)){const t=[];for(const e of i.rings){const s=this._curveHelper.offset(e,this._offset,this._method,4,this._offsetFlattenError);s&&t.push(s);}if(t.length)return {rings:t}}if(f$7(i)){const t=[];for(const e of i.paths){const s=this._curveHelper.offset(e,this._offset,this._method,4,this._offsetFlattenError);s&&t.push(s);}if(t.length)return {paths:t}}i=this._inputGeometries.next();}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class s$6{static local(){return null===s$6.instance&&(s$6.instance=new s$6),s$6.instance}execute(e,t,r){return new n$b(e,t,r)}}s$6.instance=null;class n$b{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse;}next(){let s=this._inputGeometries.next();for(;s;){if(!this._reverse)return s;if(f$7(s)){const t=y$5(s);return m$4(t.paths),t}s=this._inputGeometries.next();}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class u$6{static local(){return null===u$6.instance&&(u$6.instance=new u$6),u$6.instance}execute(t,n,e){return new c$6(t,n,e)}}u$6.instance=null;class c$6{constructor(t,n,e){this._inputGeometries=t,this._rotateAngle=void 0!==n.angle?-n.angle*Math.PI/180:0;}next(){let u=this._inputGeometries.next();for(;u;){if(0===this._rotateAngle)return u;const c=i$7();c$9(c,u);const l=(c[2]+c[0])/2,m=(c[3]+c[1])/2;if(u$a(u)){const t={rings:[[[u.xmin,u.ymin],[u.xmin,u.ymax],[u.xmax,u.ymax],[u.xmax,u.ymin],[u.xmin,u.ymin]]]};return this._rotateMultipath(t.rings,l,m),t}if(y$6(u)){const n=y$5(u);return this._rotateMultipath(n.rings,l,m),n}if(f$7(u)){const n=y$5(u);return this._rotateMultipath(n.paths,l,m),n}if(s$b(u)){const n=y$5(u);return this._rotatePath(n.points,l,m),n}if(l$7(u))return u;u=this._inputGeometries.next();}return null}_rotateMultipath(t,n,e){if(t)for(const r of t)this._rotatePath(r,n,e);}_rotatePath(t,n,e){if(t){const r=Math.cos(this._rotateAngle),i=Math.sin(this._rotateAngle);for(const o of t){const t=o[0]-n,s=o[1]-e;o[0]=n+t*r-s*i,o[1]=e+t*i+s*r;}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class c$5{static local(){return null===c$5.instance&&(c$5.instance=new c$5),c$5.instance}execute(t,s,i){return new l$4(t,s,i)}}c$5.instance=null;class l$4{constructor(t,s,i){this._inputGeometries=t,this._xFactor=void 0!==s.xScaleFactor?s.xScaleFactor:1.15,this._yFactor=void 0!==s.yScaleFactor?s.yScaleFactor:1.15;}next(){let c=this._inputGeometries.next();for(;c;){if(1===this._xFactor&&1===this._yFactor)return c;const l=i$7();c$9(l,c);const u=(l[2]+l[0])/2,m=(l[3]+l[1])/2;if(u$a(c)){const t={rings:[[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]};return this._scaleMultipath(t.rings,u,m),t}if(y$6(c)){const s=y$5(c);return this._scaleMultipath(s.rings,u,m),s}if(f$7(c)){const s=y$5(c);return this._scaleMultipath(s.paths,u,m),s}if(s$b(c)){const s=y$5(c);return this._scalePath(s.points,u,m),s}if(l$7(c))return c;c=this._inputGeometries.next();}return null}_scaleMultipath(t,s,i){if(t)for(const r of t)this._scalePath(r,s,i);}_scalePath(t,s,i){if(t)for(const r of t){const t=(r[0]-s)*this._xFactor,n=(r[1]-i)*this._yFactor;r[0]=s+t,r[1]=i+n;}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class n$a{static local(){return null===n$a.instance&&(n$a.instance=new n$a),n$a.instance}execute(t,e,i){return new r$6(t,e,i)}}n$a.instance=null;class r$6{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new n$e,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new r$a,this._walker.updateTolerance(i);}next(){let i=this._inputGeometries.next();for(;i;){if(0===this._height||0===this._period)return i;if(f$7(i)){const t=this._processGeom(i.paths);if(t.length)return {paths:t}}if(y$6(i)){const t=this._processGeom(i.rings);if(t.length)return {rings:t}}i=this._inputGeometries.next();}return null}_processGeom(t){const e=[];for(const i of t)if(this._walker.init(i,this._pattern))switch(this._style){case"Sinus":default:e.push(this._constructCurve(i,!1));break;case"Square":e.push(this._constructSquare(i));break;case"Triangle":e.push(this._constructTriangle(i));break;case"Random":e.push(this._constructCurve(i,!0));}else e.push(i);return e}_constructCurve(t,e){const s=new e$7,h=this._walker.calculatePathLength(t);let n=Math.round(h/this._period);0===n&&(n=1);const r=n*16+1,a=h/n,o=this._period/16,l=1/r,_=2*Math.PI*h/a,c=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),d=.75-Math.random()/2,g=.75-Math.random()/2,w={};this._walker.curPointAndAngle(w),s.startPath(w.pt);let k=0;for(;;){if(!this._walker.nextPointAndAngle(o,w)){s.lineTo(t[t.length-1]);break}{const t=k;let i;if(k+=l,e){const e=this._height/2*(1+.3*Math.sin(d*_*t+c));i=e*Math.sin(_*t+p),i+=e*Math.sin(g*_*t+u),i/=2;}else i=.5*this._height*Math.sin(.5*_*t);s.lineTo([w.pt[0]-i*w.sa,w.pt[1]+i*w.ca]);}}return s.path()}_constructSquare(t){const e=new e$7,s=this._walker.calculatePathLength(t);Math.round(s/this._period);let n=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const s={};if(this._walker.nextPointAndAngle(this._period,s)){const h={};this._walker.nextPointAndAngle(this._period,h)&&(n?(e.startPath(i.pt),n=!1):e.lineTo(i.pt),e.lineTo([i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca]),e.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),e.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),e.lineTo([h.pt[0]+this._height/2*h.sa,h.pt[1]-this._height/2*h.ca]),t=!0);}}if(!t){e.lineTo(this._walker.getPathEnd());break}}return e.path()}_constructTriangle(t){const e=new e$7,s=this._walker.calculatePathLength(t);Math.round(s/this._period);let n=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const s={};if(this._walker.nextPointAndAngle(this._period/2,s)){const h={};this._walker.nextPointAndAngle(this._period,h)&&(this._walker.nextPosition(this._period/2)&&(n?(e.startPath(i.pt),n=!1):e.lineTo(i.pt),e.lineTo([s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca]),e.lineTo([h.pt[0]+this._height/2*h.sa,h.pt[1]-this._height/2*h.ca])),t=!0);}}if(!t){e.lineTo(this._walker.getPathEnd());break}}return e.path()}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var t$4;!function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom";}(t$4||(t$4={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class n$9{static local(){return null===n$9.instance&&(n$9.instance=new n$9),n$9.instance}execute(t,e,s){return new a$4(t,e,s)}}n$9.instance=null;class a$4 extends C$2{constructor(t,i,n){super(t,!0,!0),this._grometryWalker=new r$a,this._grometryWalker.updateTolerance(n),this._angleToLine=void 0===i.angleToLine||i.angleToLine,this._offset=void 0!==i.offset?i.offset*n:0,this._originalEndings=i.endings,this._offsetAtEnd=void 0!==i.customEndingOffset?i.customEndingOffset*n:0,this._position=void 0!==i.offsetAlongLine?i.offsetAlongLine*n:0,this._pattern=new n$e,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(n),this._endings=this._originalEndings;}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else {this._originalEndings===t$4.WithFullGap&&this.isClosed?this._endings=t$4.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case t$4.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case t$4.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case t$4.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case t$4.WithMarkers:s=0;break;case t$4.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd;}if(!this._grometryWalker.init(t,this._pattern,n))return null;this._pattern.reset();let a=0;for(;s>a;)s-=a,a=this._pattern.nextValue();a-=s,e=a,this.iteratePath=!0;}const s={};return this._grometryWalker.nextPointAndAngle(e,s)?this._endings===t$4.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===t$4.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(s.pt[0]+this._offset*s.sa,s.pt[1]-this._offset*s.ca),this._angleToLine&&this.internalPlacement.setRotateCS(s.ca,s.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class i$3{static local(){return null===i$3.instance&&(i$3.instance=new i$3),i$3.instance}execute(e,t,s){return new n$8(e,t,s)}}i$3.instance=null;class n$8 extends C$2{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new s$a,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._beginProcessed=!1;}processPath(e){let t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);break;case"None":}return t}_atExtremities(e,s,i){const n=e.length;if(n<2)return null;const r=i?1:n-2,o=i?n:-1,a=i?1:-1;let l,h=0,c=i?e[0]:e[n-1];for(let _=r;_!==o;_+=a){l=c,c=e[_];const i=this._curveHelper.calculateLength(l,c);if(h+i>s){const e=(s-h)/i,[n,r]=this._curveHelper.getAngleCS(l,c,e),o=P$2(l,c,e);return this.internalPlacement.setTranslate(o[0]-this._offset*r,o[1]+this._offset*n),this._angleToLine&&this.internalPlacement.setRotateCS(-n,-r),this.internalPlacement}h+=i;}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class e$5{static local(){return null===e$5.instance&&(e$5.instance=new e$5),e$5.instance}execute(t,i,s){return new n$7(t,i,s)}}e$5.instance=null;class n$7 extends C$2{constructor(t,e,n){super(t,!0,!0),this._walker=new r$a,this._walker.updateTolerance(n),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*n:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*n:0,this._endGap=void 0!==e.endPosition?e.endPosition*n:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new n$e,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0;}processPath(t){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,s=this._beginGap+t;i=s-this._prevPos,this._prevPos=s;}else {if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(t)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const s=this._pattern.nextValue()*this._subPathLen,e=this._beginGap+s;i=e-this._prevPos,this._prevPos=e,this.iteratePath=!0;}const s={};if(!this._walker.nextPointAndAngle(i,s,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]+this._offset*s.sa,s.pt[1]-this._offset*s.ca);const e=this._isFirst&&this._flipFirst;let n,a;return this._angleToLine?(n=s.ca,a=s.sa):(n=1,a=0),e&&(n=-n,a=-a),this.internalPlacement.setRotateCS(n,a),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function s$5(t){return void 0!==t.rings}class i$2{static local(){return null===i$2.instance&&(i$2.instance=new i$2),i$2.instance}execute(t,s,i){return new h$4(t,s,i)}}i$2.instance=null;class h$4{constructor(i,h,e){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==h.stepX?Math.abs(h.stepX):16)*e,this._stepY=(void 0!==h.stepY?Math.abs(h.stepY):16)*e,0!==this._stepX&&0!==this._stepY&&i&&s$5(i)&&i.rings){if(this._gridType=void 0!==h.gridType?h.gridType:"Fixed","Random"===this._gridType)this._randomness=void 0!==h.randomness?h.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else {if(this._randomness=0,this._gridAngle=void 0!==h.gridAngle?h.gridAngle:0,this._shiftOddRows=void 0!==h.shiftOddRows&&h.shiftOddRows,this._offsetX=void 0!==h.offsetX?h.offsetX*e:0,this._offsetY=void 0!==h.offsetY?h.offsetY*e:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY;}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new t$6,this._calculateMinMax(i),this._geometry=i;}}next(){return this._geometry?this._nextInside():null}_calculateMinMax(t){let s,i,h,e,n,_,r,o;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,n=_=Number.MAX_VALUE,r=o=-Number.MAX_VALUE;for(const a of t.rings){const t=a?a.length:0;for(let f=0;f<t;++f)s=a[f][0]-this._graphicOriginX-this._offsetX,i=a[f][1]-this._graphicOriginY-this._offsetY,h=this._cosAngle*s-this._sinAngle*i,e=this._sinAngle*s+this._cosAngle*i,n=Math.min(n,h),r=Math.max(r,h),_=Math.min(_,e),o=Math.max(o,e);}n+=this._graphicOriginX,r+=this._graphicOriginX,_+=this._graphicOriginY,o+=this._graphicOriginY,this._xMin=Math.round(n/this._stepX),this._xMax=Math.round(r/this._stepX),this._yMin=Math.round(_/this._stepY),this._yMax=Math.round(o/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1;}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--;}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const s=this._currentY*this._stepY+this._offsetY;let i,h;return this._currentX++,"Random"===this._gridType?(i=this._graphicOriginX+t+this._stepX*this._randomness*(.5-Math.random())*2/3,h=this._graphicOriginY+s+this._stepY*this._randomness*(.5-Math.random())*2/3):(i=this._graphicOriginX+this._cosAngle*t+this._sinAngle*s,h=this._graphicOriginY-this._sinAngle*t+this._cosAngle*s),this._internalPlacement.setTranslate(i,h),this._internalPlacement}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const s$4=.001;class r$5{static local(){return null===r$5.instance&&(r$5.instance=new r$5),r$5.instance}execute(e,t,n){return new l$3(e,t,n)}}r$5.instance=null;class l$3 extends C$2{constructor(e,t,n){super(e,!0,!0),this._curveHelper=new s$a,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*n:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*n:0,this._epsilon=s$4*n;}processPath(e){const i=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){const n=this._curSegment;this._curSegment++;const i=e[n-1],s=e[n],r=this._curveHelper.calculateLength(i,s);if(r<this._epsilon)continue;const l=.5+this._position/r,[a,o]=this._curveHelper.getAngleCS(i,s,l),h=P$2(i,s,l);return this.internalPlacement.setTranslate(h[0]-this._offset*o,h[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,o),this.internalPlacement}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&f$6(e);const s=this.onLine(e,i);return "LineEnd"===this._relativeTo&&f$6(e),s}onLine(e,n){let i,s=!1;switch(this._relativeTo){case"LineMiddle":default:i=this._curveHelper.calculatePathLength(e)/2+n;break;case"LineBeginning":i=n;break;case"LineEnd":i=n,s=!0;}const r=e.length;let l,a=0,o=e[0];for(let h=1;h<r;++h){l=o,o=e[h];const n=this._curveHelper.calculateLength(l,o);if(a+n>i){const e=(i-a)/n,[r,h]=this._curveHelper.getAngleCS(l,o,e),c=P$2(l,o,e),u=s?this._offset:-this._offset;return this.internalPlacement.setTranslate(c[0]-u*h,c[1]+u*r),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-r,-h):this.internalPlacement.setRotateCS(r,h)),this.internalPlacement}a+=n;}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class n$6{static local(){return null===n$6.instance&&(n$6.instance=new n$6),n$6.instance}execute(t,e,s){return new r$4(t,e,s)}}n$6.instance=null;const a$3=1e-15;class r$4 extends C$2{constructor(t,e,s){super(t,!0,!0),this._curveHelper=new s$a,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*s:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0;}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let s=e[0],i=e[1];if(0!==this._offset){const t=Math.cos(e[2]),n=Math.sin(e[2]);s-=this._offset*n,i+=this._offset*t;}return this.internalPlacement.setTranslate(s,i),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0;const i=x$4(t),n=t.length-1;let a,r,o=0,l=0,_=0,c=0,g=0;for(;o<n;){o++,a=t[o-1],r=t[o];const e=g$1(a),u=g$1(r);(this._angleToLine||0!==this._offset)&&(c=this._curveHelper.getAngle(a,r,0)),1===o?i?(l=c,_=e):this._endPoints&&this._tags.push([a[0],a[1],c]):1===e?this._controlPoints&&this._tags.push([a[0],a[1],h$3(g,c)]):this._regularVertices&&this._tags.push([a[0],a[1],h$3(g,c)]),(this._angleToLine||0!==this._offset)&&(g=this._curveHelper.getAngle(a,r,1)),o===n&&(i?1===u||1===_?this._controlPoints&&this._tags.push([r[0],r[1],h$3(g,l)]):this._regularVertices&&this._tags.push([r[0],r[1],h$3(g,l)]):this._endPoints&&this._tags.push([r[0],r[1],g]));}this._tagIterator=0;}}function h$3(t,e){const s=Math.PI;for(;Math.abs(e-t)>s+2*a$3;)e-t>s?e-=2*s:e+=2*s;return (t+e)/2}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function s$3(t){return void 0!==t.rings}class o$6{static local(){return null===o$6.instance&&(o$6.instance=new o$6),o$6.instance}execute(t,e,n){return new r$3(t,e,n)}}o$6.instance=null;class r$3{constructor(t,e,s){this._geometry=t,this._offsetX=void 0!==e.offsetX?e.offsetX*s:0,this._offsetY=void 0!==e.offsetY?e.offsetY*s:0,this._method=void 0!==e.method?e.method:"OnPolygon",this._internalPlacement=new t$6;}next(){const t=this._geometry;return this._geometry=null,t&&s$3(t)?this._polygonCenter(t):null}_polygonCenter(n){let s=!1;switch(this._method){case"OnPolygon":default:case"CenterOfMass":case"BoundingBoxCenter":{const o=i$7();c$9(o,n),this._internalPlacement.setTranslate((o[2]+o[0])/2+this._offsetX,(o[3]+o[1])/2-this._offsetY),s=!0;break}}return s?this._internalPlacement:null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function G$2(p){if(!p)return null;switch(p.type){case"CIMGeometricEffectAddControlPoints":return o$9.local();case"CIMGeometricEffectArrow":return c$7.local();case"CIMGeometricEffectBuffer":return o$8.local();case"CIMGeometricEffectCut":return u$7.local();case"CIMGeometricEffectDashes":return i$4.local();case"CIMGeometricEffectDonut":return h$5.local();case"CIMGeometricEffectJog":return s$7.local();case"CIMGeometricEffectMove":return n$c.local();case"CIMGeometricEffectOffset":return o$7.local();case"CIMGeometricEffectReverse":return s$6.local();case"CIMGeometricEffectRotate":return u$6.local();case"CIMGeometricEffectScale":return c$5.local();case"CIMGeometricEffectWave":return n$a.local()}return null}function A$3(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return n$9.local();case"CIMMarkerPlacementAtExtremities":return i$3.local();case"CIMMarkerPlacementAtRatioPositions":return e$5.local();case"CIMMarkerPlacementInsidePolygon":return i$2.local();case"CIMMarkerPlacementOnLine":return r$5.local();case"CIMMarkerPlacementOnVertices":return n$6.local();case"CIMMarkerPlacementPolygonCenter":return o$6.local()}return null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class t$3{constructor(t=0,h=0,i=0,s=0){this.x=t,this.y=h,this.width=i,this.height=s;}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const c$4=Math.PI/180,f$4=n$f.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class m$3{constructor(t){this._t=t;}static createIdentity(){return new m$3([1,0,0,0,1,0])}clone(){const t=this._t;return new m$3(t.slice())}transform(t){const s=this._t;return [s[0]*t[0]+s[1]*t[1]+s[2],s[3]*t[0]+s[4]*t[1]+s[5]]}static createScale(t,s){return new m$3([t,0,0,0,s,0])}scale(t,s){const e=this._t;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=s,e[4]*=s,e[5]*=s,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,s){return new m$3([0,0,t,0,0,s])}translate(t,s){const e=this._t;return e[2]+=t,e[5]+=s,this}static createRotate(t){const s=Math.cos(t),e=Math.sin(t);return new m$3([s,-e,0,e,s,0])}rotate(t){return this.multiply(m$3.createRotate(t))}multiply(t){const s=this._t,e=t._t,r=s[0]*e[0]+s[3]*e[1],i=s[1]*e[0]+s[4]*e[1],o=s[2]*e[0]+s[5]*e[1]+e[2],a=s[0]*e[3]+s[3]*e[4],n=s[1]*e[3]+s[4]*e[4],h=s[2]*e[3]+s[5]*e[4]+e[5];return s[0]=r,s[1]=i,s[2]=o,s[3]=a,s[4]=n,s[5]=h,this}}class u$5{constructor(t){this._transfos=[],this._sizeTransfos=[],this._transfos.push(t||m$3.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1);}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}back(){return this._transfos[this._transfos.length-1]}push(t,s){const e=s?t.scaleRatio():1;t.multiply(this.back()),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*e);}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1);}drawSymbol(t,s){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,s);}}drawMultiLayerSymbol(t,s){if(!t)return;const e=t.symbolLayers;if(!e)return;const r=t.effects;if(r){const t=this.executeEffects(r,s);if(t){let s=t.next();for(;s;)this.drawSymbolLayers(e,s),s=t.next();}}else this.drawSymbolLayers(e,s);}executeEffects(t,s){const e=1;let r=new r$d(s);for(const i of t){const t=G$2(i);t&&(r=t.execute(r,i,e));}return r}drawSymbolLayers(t,s){let e=t.length;for(;e--;){const r=t[e];if(!r||!1===r.enable)continue;const i=r.effects;if(i){const t=this.executeEffects(i,s);if(t){let s=t.next();for(;s;)this.drawSymbolLayer(r,s),s=t.next();}}else this.drawSymbolLayer(r,s);}}drawSymbolLayer(t,s){switch(t.type){case"CIMSolidFill":this.drawSolidFill(s,t.color);break;case"CIMHatchFill":this.drawHatchFill(t,s);break;case"CIMSolidStroke":this.drawSolidStroke(s,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,s);}}drawHatchFill(t,s){const e=1,r=this._buildHatchPolyline(t,s,e);r&&(this.pushClipPath(s),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath());}drawMarkerLayer(t,s){const e=t.markerPlacement;if(e){const r=A$3(e);if(r){const i="CIMMarkerPlacementInsidePolygon"===e.type;i&&this.pushClipPath(s);const o=1,a=r.execute(s,e,o);if(a){let s=a.next();for(;s;)this.drawMarker(t,s),s=a.next();}i&&this.popClipPath();}}else {const e=new t$6;e.tx=s.x,e.ty=s.y,this.drawMarker(t,e);}}drawMarker(t,s){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,s);break;case"CIMVectorMarker":this.drawVectorMarker(t,s);}}drawPictureMarker(t,s){if(!t)return;const e=t.size||10,r=m$3.createIdentity(),i=t.anchorPoint;if(i){let s=i.x,o=i.y;"Absolute"!==t.anchorPointUnits&&(s*=e,o*=e),r.translate(-s,-o);}t.rotation&&r.rotate(t.rotation*c$4),r.translate(t.offsetX||0,t.offsetY||0),r.translate(s.tx,s.ty),this.push(r,!1),this.drawImage(t.url,e,t.scaleX),this.pop();}drawVectorMarker(t,s){if(!t)return;const e=t.markerGraphics;if(!e)return;const r=t.size,i=t.frame,o=i?i.ymax-i.ymin:0,a=r&&o?r/o:1,n=m$3.createIdentity();i&&n.translate(.5*-(i.xmax+i.xmin),.5*-(i.ymax+i.ymin));const h=t.anchorPoint;if(h){let s=h.x,e=h.y;"Absolute"!==t.anchorPointUnits&&i&&(s*=i.xmax-i.xmin,e*=i.ymax-i.ymin),n.translate(-s,-e);}1!==a&&n.scale(a,a),t.rotation&&n.rotate(t.rotation*c$4),n.translate(t.offsetX||0,t.offsetY||0),n.translate(s.tx,s.ty),this.push(n,t.scaleSymbolsProportionally);for(const l of e)l&&l.symbol&&l.geometry||f$4.error("Invalid marker graphic",l),this.drawSymbol(l.symbol,l.geometry);this.pop();}_buildHatchPolyline(t,e,r){let o=(void 0!==t.separation?t.separation:4)*r,a=void 0!==t.rotation?t.rotation:0;if(0===o)return null;o<0&&(o=-o);let n=0;const h=.5*o;for(;n>h;)n-=o;for(;n<-h;)n+=o;const l=i$7();c$9(l,e),l[0]-=h,l[1]-=h,l[2]+=h,l[3]+=h;const f=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;a>180;)a-=180;for(;a<0;)a+=180;const m=Math.cos(a*c$4),u=Math.sin(a*c$4),p=-o*u,_=o*m;let y,d,x,M;n=(void 0!==t.offsetX?t.offsetX*r:0)*u-(void 0!==t.offsetY?t.offsetY*r:0)*m,y=x=Number.MAX_VALUE,d=M=-Number.MAX_VALUE;for(const s of f){const t=s[0],e=s[1],r=m*t+u*e,i=-u*t+m*e;y=Math.min(y,r),x=Math.min(x,i),d=Math.max(d,r),M=Math.max(M,i);}x=Math.floor(x/o)*o;let b=m*y-u*x-p*n/o,w=u*y+m*x-_*n/o,P=m*d-u*x-p*n/o,S=u*d+m*x-_*n/o;const g=1+Math.round((M-x)/o),C=[];for(let s=0;s<g;s++)b+=p,w+=_,P+=p,S+=_,C.push([[b,w],[P,S]]);return {paths:C}}}class p$5 extends u$5{constructor(){super(),this.reset();}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0;}envelope(){return new t$3(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}drawSolidFill(t){!t||this._clipCount>0||(y$6(t)?this._processPath(t.rings,0):f$7(t)&&this._processPath(t.paths,0));}drawSolidStroke(t,s,i){if(!t||this._clipCount>0)return;const o=.5*this.transformSize(i);y$6(t)?this._processPath(t.rings,o):f$7(t)&&this._processPath(t.paths,o);}pushClipPath(t){this.drawSolidFill(t),++this._clipCount;}popClipPath(){--this._clipCount;}drawImage(t,s,e){const r=s/2;this._merge(this.transformPt([0,0]),r);}_processPath(t,s){if(t)for(const e of t){const t=e?e.length:0;if(t>1){this._merge(this.transformPt(e[0]),s);for(let r=1;r<t;++r)this._merge(this.transformPt(e[r]),s);}}}_merge(t,s){t[0]-s<this._xmin&&(this._xmin=t[0]-s),t[0]+s>this._xmax&&(this._xmax=t[0]+s),t[1]-s<this._ymin&&(this._ymin=t[1]-s),t[1]+s>this._ymax&&(this._ymax=t[1]+s);}}class _$1 extends u$5{constructor(t,s){super(s),this._ctx=t;}drawSolidFill(t,s){if(!t)return;if(y$6(t))this._buildPath(t.rings,!0);else {if(!f$7(t))return;this._buildPath(t.paths,!0);}const i=this._ctx;i.fillStyle="string"==typeof s?s:"rgba("+Math.round(s[0])+","+Math.round(s[1])+","+Math.round(s[2])+","+s[3]/255+")",i.fill("evenodd");}drawSolidStroke(t,s,i,o,a,n){if(!t||!s||0===i)return;if(y$6(t))this._buildPath(t.rings,!0);else {if(!f$7(t))return;this._buildPath(t.paths,!1);}const h=this._ctx;h.strokeStyle="string"==typeof s?s:"rgba("+Math.round(s[0])+","+Math.round(s[1])+","+Math.round(s[2])+","+s[3]/255+")",h.lineWidth=this.transformSize(i)+.5,this._setCapStyle(o),this._setJoinStyle(a),h.miterLimit=n,h.stroke();}pushClipPath(t){this._ctx.save(),y$6(t)?this._buildPath(t.rings,!0):f$7(t)&&this._buildPath(t.paths,!0),this._ctx.clip("evenodd");}popClipPath(){this._ctx.restore();}drawImage(t,s,e){}_buildPath(t,s){const e=this._ctx;if(e.beginPath(),t)for(const r of t){const t=r?r.length:0;if(t>1){let i=this.transformPt(r[0]);e.moveTo(i[0],i[1]);for(let s=1;s<t;++s)i=this.transformPt(r[s]),e.lineTo(i[0],i[1]);s&&e.closePath();}}}_setCapStyle(t){switch(t){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square";}}_setJoinStyle(t){switch(t){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter";}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const t$2=[1,256,65536,16777216],n$5=[1/256,1/65536,1/16777216,1/4294967296],o$5=e$4(new Uint8ClampedArray([255,255,255,255]));function r$2(n,r,e=0){const c=f$3(n,0,o$5);for(let o=0;o<4;o++)r[e+o]=Math.floor(256*u$4(c*t$2[o]));}function e$4(t,o=0){let r=0;for(let e=0;e<4;e++)r+=t[o+e]*n$5[e];return r}function f$3(t,n,o){return t<n?n:t>o?o:t}function u$4(t){return t-Math.floor(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const n$4=Math.PI,l$2=n$4/2,m$2=4,y$3=n$f.getLogger("esri.symbols.cim.CIMSymbolHelper");function f$2(e,t){switch(t.type){case"CIMSymbolReference":{const r={type:"point",x:0,y:0};e.drawSymbol(t.symbol,r);break}case"CIMPointSymbol":{const r={type:"point",x:0,y:0};e.drawSymbol(t,r);break}case"CIMTextSymbol":break;case"CIMVectorMarker":{const r=new t$6;e.drawMarker(t,r);break}}return e.envelope()}class h$2{static getEnvelope(e){const t=new p$5;if(Array.isArray(e)){let r;for(const o of e)r?r.union(f$2(t,o)):r=f$2(t,o);return r}return f$2(t,e)}static getTextureAnchor(e){const t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return [0,0,0];const r=96/72,o=(t.x+.5*t.width)*r,s=-(t.y+.5*t.height)*r,a=t.width*r+2,i=t.height*r+2;return [o/a,s/i,i]}static rasterize(e,t,r,s=!0){const c=r||this.getEnvelope(t);if(!c||c.width<=0||c.height<=0)return [null,0,0,0,0];const n=96/72,l=(c.x+.5*c.width)*n,m=(c.y+.5*c.height)*n;e.width=c.width*n,e.height=c.height*n,r||(e.width+=2,e.height+=2);const y=e.getContext("2d"),f=m$3.createScale(n,-n);f.translate(.5*e.width-l,.5*e.height+m);const h=new _$1(y,f);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};h.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new t$6;h.drawMarker(t,e);break}}const p=y.getImageData(0,0,e.width,e.height),S=new Uint8Array(p.data);if(s){let e;for(let t=0;t<S.length;t+=4)e=S[t+3]/255,S[t]=S[t]*e,S[t+1]=S[t+1]*e,S[t+2]=S[t+2]*e;}return [S,e.width,e.height,-l/e.width,-m/e.height]}static fromSimpleMarker(e){const t=100,r=50;let o,s;const a=e.style;if("circle"===a||"esriSMSCircle"===a){const e=.25;let t=Math.acos(1-e/r),a=Math.ceil(n$4/t/4);0===a&&(a=1),t=l$2/a,a*=4;const i=[];i.push([r,0]);for(let o=1;o<a;o++)i.push([r*Math.cos(o*t),-r*Math.sin(o*t)]);i.push([r,0]),o={rings:[i]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};}else if("cross"===a||"esriSMSCross"===a){const e=0;o={rings:[[[e,r],[e,e],[r,e],[r,-e],[e,-e],[e,-r],[-e,-r],[-e,-e],[-r,-e],[-r,e],[-e,e],[-e,r],[e,r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};}else if("diamond"===a||"esriSMSDiamond"===a)o={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("square"===a||"esriSMSSquare"===a)o={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("x"===a||"esriSMSX"===a){const e=0;o={rings:[[[0,e],[r-e,r],[r,r-e],[e,0],[r,e-r],[r-e,-r],[0,-e],[e-r,-r],[-r,e-r],[-e,0],[-r,r-e],[e-r,r],[0,e]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};}else if("triangle"===a||"esriSMSTriangle"===a){const e=t*.5773502691896257,r=-e,a=2/3*t,i=a-t;o={rings:[[[r,i],[0,a],[e,i],[r,i]]]},s={xmin:r,ymin:i,xmax:e,ymax:a};}else "arrow"!==a&&"esriSMSArrow"!==a||(o={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r});let i;if(o&&s){const t=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&t.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});const r={type:"CIMPolygonSymbol",symbolLayers:t};i={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:s,markerGraphics:[{type:"CIMMarkerGraphic",geometry:o,symbol:r}]}]};}return i}static fromCIMHatchFill(e){const t=void 0!==e.separation?e.separation:m$2,r=t/2;let o=this._getLineSymbolPeriod(e.lineSymbol)||m$2;for(;o<4;)o*=2;const s=o/2;return {type:"CIMVectorMarker",frame:{xmin:-s,xmax:s,ymin:-r,ymax:r},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-s,0],[s,0]]]},symbol:e.lineSymbol}],size:t}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const r of e.symbolLayers){const e=this._getEffectsRepeat(r.effects);if(e)return e;if(r){const e=this._getPlacementRepeat(r.markerPlacement);if(e)return e}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:y$3.error(`unsupported geometric effect type ${t.type}`);}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={type:e.type,...e};let o,s,a,i;if(r.markerPlacement=null,r.anchorPoint=null,!0===t.shiftOddRows){s=t.stepX/2,a=t.stepY,i=2*t.stepY;o=[{x:-s,y:0},{x:s,y:0},{x:0,y:a},{x:0,y:-a}].map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})));}else s=t.stepX/2,a=t.stepY/2,i=t.stepY,o=[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[r]}}];return {type:"CIMVectorMarker",frame:{xmin:-s,xmax:s,ymin:-a,ymax:a},markerGraphics:o,size:i}}static getFillColor(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h$2.getFillColor(t);if(null!=e)return e}break;case"CIMTextSymbol":return h$2.getFillColor(e.symbol);case"CIMSolidFill":return e.color}}static getStrokeColor(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h$2.getStrokeColor(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return h$2.getStrokeColor(e.symbol);case"CIMSolidStroke":return e.color}}static getStrokeWidth(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=h$2.getStrokeWidth(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return h$2.getStrokeWidth(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}static getSize(e){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers){const e=h$2.getSize(r);e>t&&(t=e);}return t}case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return e.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return e.size}}static getMarkerScaleRatio(e){if(e)switch(e.type){case"CIMVectorMarker":if(!1!==e.scaleSymbolsProportionally&&e.frame){const t=e.frame.ymax-e.frame.ymin;return e.size/t}}return 1}}class p$4{static rasterizeSimpleFill(e,r,o){"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r||console.error("Unexpected: style does not require rasterization");const s=o$c(Math.ceil(o)),a=this._isHorizontalOrVertical(r)?8*s:16*s,i=2*s;e.width=a,e.height=a;const c=e.getContext("2d");c.strokeStyle="#FFFFFF",c.lineWidth=s,c.beginPath(),"vertical"!==r&&"cross"!==r&&"esriSFSCross"!==r&&"esriSFSVertical"!==r||(c.moveTo(a/2,-i),c.lineTo(a/2,a+i)),"horizontal"!==r&&"cross"!==r&&"esriSFSCross"!==r&&"esriSFSHorizontal"!==r||(c.moveTo(-i,a/2),c.lineTo(a+i,a/2)),"forward-diagonal"!==r&&"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r&&"esriSFSForwardDiagonal"!==r||(c.moveTo(-i,-i),c.lineTo(a+i,a+i),c.moveTo(a-i,-i),c.lineTo(a+i,i),c.moveTo(-i,a-i),c.lineTo(i,a+i)),"backward-diagonal"!==r&&"diagonal-cross"!==r&&"esriSFSBackwardDiagonal"!==r&&"esriSFSDiagonalCross"!==r||(c.moveTo(a+i,-i),c.lineTo(-i,a+i),c.moveTo(i,-i),c.lineTo(-i,i),c.moveTo(a+i,a-i),c.lineTo(a-i,a+i)),c.stroke();const n=c.getImageData(0,0,e.width,e.height),l=new Uint8Array(n.data);let m;for(let t=0;t<l.length;t+=4)m=l[t+3]/255,l[t]=l[t]*m,l[t+1]=l[t+1]*m,l[t+2]=l[t+2]*m;return [l,e.width,e.height]}static rasterizeSimpleLine(e,t){let r;switch(t){case"butt":r="Butt";break;case"square":r="Square";break;default:r="Round";}const o="Butt"===r;let s;switch(e){case"dash":case"esriSLSDash":s=o?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":s=o?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":s=o?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":s=o?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":s=o?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":s=o?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":s=o?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":s=o?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":s=o?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":s=o?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":y$3.error("Unexpected: style does not require rasterization"),s=[0,0];break;default:y$3.error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),s=[0,0];}return this.rasterizeDash(s,r)}static rasterizeDash(e,t){const r="Butt"===t,o="Square"===t,s=!r&&!o,a=15,i=2*a+1;let n=0;for(const c of e)n+=c;const l=n*a,m=l*i,y=new Float32Array(m),f=s?a*a:a;for(let c=0;c<m;++c)y[c]=f;const h=a,p=.5*a;let S=0,d=0,M=!0;for(const c of e){S=d,d+=c*a;let e=S;for(;e<d;){let t=0;for(;t<i;){const a=t*l+e,i=s?(t-h)*(t-h):Math.abs(t-h);y[a]=M?r?Math.max(Math.max(S+p-e,i),Math.max(e-d+p,i)):i:s?Math.min((e-S)*(e-S)+i,(e-d)*(e-d)+i):o?Math.min(Math.max(e-S,i),Math.max(d-e,i)):Math.min(Math.max(e-S+p,i),Math.max(d+p-e,i)),t++;}e++;}M=!M;}const b=y.length,g=new Uint8Array(4*b);for(let u=0;u<b;++u){const e=(s?Math.sqrt(y[u]):y[u])/a;r$2(e,g,4*u);}return [g,l,i]}static _isHorizontalOrVertical(e){return "vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}}class S$2{static findApplicableOverrides(e,t,r){if(t){if(e.primitiveName){let o=!1;for(const t of r)if(t.primitiveName===e.primitiveName){o=!0;break}if(!o)for(const s of t)s.primitiveName===e.primitiveName&&r.push(s);}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const o of e.effects)S$2.findApplicableOverrides(o,t,r);if(e.symbolLayers)for(const o of e.symbolLayers)S$2.findApplicableOverrides(o,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const o of e.effects)S$2.findApplicableOverrides(o,t,r);if(e.markerPlacement&&S$2.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const o of e.markerGraphics)S$2.findApplicableOverrides(o,t,r),S$2.findApplicableOverrides(o.symbol,t,r);}else "CIMCharacterMarker"===e.type?S$2.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type&&S$2.findApplicableOverrides(e.lineSymbol,t,r);}}}static applyOverrides(e,t,r,o){if(!t)return;const s=e=>e?e.charAt(0).toLowerCase()+e.substr(1):e;if(e.primitiveName)for(const a of t)if(a.primitiveName===e.primitiveName){const t=s(a.propertyName);if(o&&o.push({cim:e,nocapPropertyName:t,value:e[t]}),a.expression&&(a.value=S$2.toValue(a.propertyName,a.expression)),r){let t=!1;for(const o of r)o.primitiveName===e.primitiveName&&(t=!0);t||r.push(a);}e[t]=a.value;}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)S$2.applyOverrides(s,t,r,o);if(e.symbolLayers)for(const s of e.symbolLayers)S$2.applyOverrides(s,t,r,o);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)S$2.applyOverrides(s,t,r,o);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)S$2.applyOverrides(s,t,r,o),S$2.applyOverrides(s.symbol,t,r,o);}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value;}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new o$b(t).toRgba();return e[3]*=255,e}return t}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const i$1=new C$3;function n$3(r){if(!i$1.hasBidiChar(r))return [r,!1];let n;return n="rtl"===i$1.checkContextual(r)?"IDNNN":"ICNNN",[i$1.bidiTransform(r,n,"VLYSN"),!0]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var e$3,t$1;function n$2(t){switch(t){case"left":return e$3.Left;case"right":return e$3.Right;case"center":case"justify":return e$3.Center}}function r$1(e){switch(e){case"top":return t$1.Top;case"middle":return t$1.Center;case"baseline":return t$1.Baseline;case"bottom":return t$1.Bottom}}function a$2(n){switch(n){case"above-left":return [e$3.Right,t$1.Bottom];case"above-center":case"above-along":return [e$3.Center,t$1.Bottom];case"above-right":return [e$3.Left,t$1.Bottom];case"center-left":return [e$3.Right,t$1.Center];case"center-center":case"center-along":return [e$3.Center,t$1.Center];case"center-right":return [e$3.Left,t$1.Center];case"below-left":return [e$3.Right,t$1.Top];case"below-center":case"below-along":return [e$3.Center,t$1.Top];case"below-right":return [e$3.Left,t$1.Top];case"always-horizontal":return [e$3.Center,t$1.Baseline];default:return console.debug(`Found invalid placement type ${n}`),[e$3.Center,t$1.Center]}}function c$3(t){switch(t){case e$3.Right:return -1;case e$3.Center:return 0;case e$3.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function o$4(e){switch(e){case t$1.Top:return 1;case t$1.Center:return 0;case t$1.Bottom:case t$1.Baseline:return -1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}function s$2(t){switch(t){case"left":return e$3.Left;case"right":return e$3.Right;case"center":case"justify":return e$3.Center}}!function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right";}(e$3||(e$3={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline";}(t$1||(t$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
class e$2{constructor(t,e,s,r){this.center=t$7(t,e),this.centerT=n$g(),this.halfWidth=s/2,this.halfHeight=r/2,this.width=s,this.height=r;}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t;}set y(t){this.center[1]=t;}clone(){return new e$2(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(h,i=4){const e=Math.abs(h.centerT[0]-this.centerT[0]),s=Math.abs(h.centerT[1]-this.centerT[1]),r=(h.halfWidth+this.halfWidth+i)/e,n=(h.halfHeight+this.halfHeight+i)/s,a=Math.min(r,n);return c$a(a)}extend(t){const h=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),e=Math.max(this.xmax,t.xmax)-h,s=Math.max(this.ymax,t.ymax)-i,r=h+e/2,n=i+s/2;this.width=e,this.height=s,this.halfWidth=e/2,this.halfHeight=s/2,this.x=r,this.y=n;}static deserialize(t){const h=t.readF32(),i=t.readF32(),s=t.readInt32(),r=t.readInt32();return new e$2(h,i,s,r)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const u$3=26,g=4,_=u$3+g,p$3=u$3-6,x$3=3,w$1=8,y$2=Math.PI/180;class T$2{constructor(t,s,e,i){this._rotationT=n$h(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const h=e.rect,n=new Float32Array(8);t*=i,s*=i;const o=e.code?h.width*i:e.metrics.width,a=e.code?h.height*i:e.metrics.height;n[0]=t,n[1]=s,n[2]=t+o,n[3]=s,n[4]=t,n[5]=s+a,n[6]=t+o,n[7]=s+a,this._data=n,this._setTextureCoords(h),this._scale=i,this._mosaic=e,this.x=t,this.y=s,this.maxOffset=Math.max(t+o,s+a);}get width(){return this._mosaic.metrics.width*this._scale}get mosaic(){return this._mosaic}set angle(t){this._angle=t,n$i(this._rotationT),c$b(this._rotationT,this._rotationT,-t),this._setOffsets(this._data);}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:s}=this._mosaic.metrics,e=s*this._scale,i=Math.abs(t)*this._scale,n=new Float32Array(8);n[0]=this.x,n[1]=this.y,n[2]=this.x+e,n[3]=this.y,n[4]=this.x,n[5]=this.y+i,n[6]=this.x+e,n[7]=this.y+i;const o=o$d(n$h(),this._rotationT,this._T);e$8(n,n,o);let c=1/0,d=1/0,f=0,l=0;for(let h=0;h<4;h++){const t=n[2*h],s=n[2*h+1];c=Math.min(c,t),d=Math.min(d,s),f=Math.max(f,t),l=Math.max(l,s);}const u=f-c,g=l-d,_=c+u/2,p=d+g/2;this._bounds=new e$2(_,p,u,g);}return this._bounds}setTransform(t){this._T=t,this._offsets=null;}_setOffsets(t){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const s=this._offsets,e=new Float32Array(8),i=o$d(n$h(),this._rotationT,this._T);e$8(e,t,i),s.upperLeft=m$5(e[0]*w$1,e[1]*w$1),s.upperRight=m$5(e[2]*w$1,e[3]*w$1),s.lowerLeft=m$5(e[4]*w$1,e[5]*w$1),s.lowerRight=m$5(e[6]*w$1,e[7]*w$1);}_setTextureCoords({x:t,y:s,width:e,height:i}){this._texcoords={upperLeft:m$5(t,s),upperRight:m$5(t+e,s),lowerLeft:m$5(t,s+i),lowerRight:m$5(t+e,s+i)};}}const M$2=(t,s)=>({code:0,page:0,sdf:!0,rect:new t$8(0,0,11,8),textureBinding:s,metrics:{advance:0,height:4,width:t,left:0,top:0}});class B$2{constructor(t,s,e){this._rotation=0,this._decorate(t,s,e),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=s.length>1,this._hasRotation=0!==e.angle,this._T=this._createGlyphTransform(this.bounds,e);for(const i of t)i.setTransform(this._T);}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const s=this._T,e=h$7(n$h(),t);o$d(s,e,s);for(const i of this.glyphs)i.setTransform(this._T);}_decorate(t,s,e){if(!e.decoration||"none"===e.decoration||!t.length)return;const i=e.scale,h="underline"===e.decoration?_:p$3,n=t[0].textureBinding;for(const o of s){const s=o.startX*i,e=o.startY*i,r=(o.width+o.glyphWidthEnd)*i;t.push(new T$2(s,e+h*i,M$2(r,n),1));}}get boundsT(){const e=this.bounds,i=r$e(n$g(),e.x,e.y);if(D$2(i,i,this._T),this._hasRotation){const t=Math.max(e.width,e.height);return new e$2(i[0],i[1],t,t)}return new e$2(i[0],i[1],e.width,e.height)}_createBounds(t){let s=1/0,e=1/0,i=0,h=0;for(const r of t)s=Math.min(s,r.xTopLeft),e=Math.min(e,r.yTopLeft),i=Math.max(i,r.xTopLeft+r.width),h=Math.max(h,r.yBottomRight);const n=i-s,o=h-e;return new e$2(s+n/2,e+o/2,n,o)}_createGlyphTransform(s,e){const h=y$2*e.angle,n=n$h(),a=n$g();return i$8(n,n,r$e(a,e.xOffset,-e.yOffset)),e.isCIM?c$b(n,n,h):(i$8(n,n,r$e(a,s.x,s.y)),c$b(n,n,h),i$8(n,n,r$e(a,-s.x,-s.y))),n}}class b$1{constructor(t,s,e,i,h,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(s,e)),this.end=Math.max(0,Math.max(s,e)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=i,this.yMin=h,this.yMax=n;}}const R$2=t=>10===t,L$2=t=>32===t;function v$3(t,s,e){const i=new Array,h=1/e.scale,n=e.maxLineWidth*h,o=s?t.length-1:0,r=s?-1:t.length,a=s?-1:1;let c=o,d=0,f=0,l=c,m=l,u=0,g=1/0,_=0;for(;c!==r;){const{code:s,metrics:e}=t[c],h=Math.abs(e.top);if(R$2(s)||L$2(s)||(g=Math.min(g,h),_=Math.max(_,h+e.height)),R$2(s))c!==o&&(i.push(new b$1(t,l,c-a,d,g,_)),g=1/0,_=0),d=0,l=c+a,m=c+a,f=0;else if(L$2(s))m=c+a,f=0,u=e.advance,d+=e.advance;else if(d>n){if(m!==l){const s=m-2*a;d-=u,i.push(new b$1(t,l,s,d-f,g,_)),g=1/0,_=0,l=m,d=f;}else i.push(new b$1(t,l,c-a,d,g,_)),g=1/0,_=0,l=c,m=c,d=0;d+=e.advance,f+=e.advance;}else d+=e.advance,f+=e.advance;c+=a;}const p=new b$1(t,l,c-a,d,g,_);return p.start>=0&&p.end<t.length&&i.push(p),i}function j$1(t,s){let e=0;for(let n=0;n<t.length;n++){const{width:s}=t[n];e=Math.max(s,e);}const i="underline"===s.decoration?g:0,h=t[0].yMin;return {x:0,y:h,height:t[t.length-1].yMax+s.lineHeight*(t.length-1)+i-h,width:e}}function A$2(t,s,e){const i=e.scale,h=new Array,n=v$3(t,s,e),o=j$1(n,e),{vAlign:r,hAlign:a}=e,c=r===t$1.Baseline?1:0,f=c?0:r-1,l=(1-c)*-o.y+f*(o.height/2)+(c?1:0)*-u$3;for(let d=0;d<n.length;d++){const{start:s,end:o,width:r}=n[d];let c=-1*(a+1)*(r/2)-x$3;const f=d*e.lineHeight+l-x$3;n[d].startX=c,n[d].startY=f;for(let e=s;e<=o;e++){const s=t[e];if(R$2(s.code))continue;const n=new T$2(c+s.metrics.left,f-s.metrics.top,s,i);c+=s.metrics.advance,h.push(n);}}return new B$2(h,n,e)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const k$1=Math.PI/180,I$1=.04,U$1=n$h(),v$2=n$g(),z$1=512,P$1=50;function T$1(t,e){if(!e.isWrappable)return null;const[s,n]=a$6(e);return t[2]>n?[i$7([t[0],t[1],n,t[3]]),i$7([s,t[1],s+t[2]-n,t[3]])]:t[0]<s?[i$7([s,t[1],t[2],t[3]]),i$7([n-(s-t[0]),t[1],n,t[3]])]:null}function A$1(t,e,o,r,i,a,c){if(!r||!o.symbol)return t[0]=t[1]=t[2]=t[3]=0,e[0]=e[1]=e[2]=e[3]=0,t;const m=r;if(!l$7(m)){c$9(t,m);let n=e[0];0===n&&(n=N$1(o),e[0]=n);const r=i*n/2;return t[0]-=r,t[1]-=r,t[2]+=r,t[3]+=r,t}{const s=m.x,n=m.y;"esriTS"===o.symbol.type&&0===e[2]&&0===e[3]&&Q$1(e,o.symbol,o.mosaicItem),V$1(t,s,n,o.symbol,e,i,a,c);}return t}function C$1(t){return "text"===t||"esriTS"===t}function H$1(t){return "simple-marker"===t||"picture-marker"===t||"esriSMS"===t||"esriPMS"===t}function W$1(e){switch(e$9(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const q$1=n$g(),R$1=n$g(),B$1=n$g(),E$1=n$g(),F$1=n$g(),L$1=n$g(),O$1=n$g();function D$1(t,e,s,n){r$e(B$1,e,s);const o=t.paths;let r,l,h,f,u,p,g,y,b,M=1/0;for(let d=0;d<o.length;d++){const t=o[d];if(!(t.length<2))for(let o=1;o<t.length;o++)r=t[o-1][0],h=t[o-1][1],l=t[o][0],f=t[o][1],u=Math.min(r,l)-n,p=Math.min(h,f)-n,g=Math.max(r,l)+n,y=Math.max(h,f)+n,e<u||e>g||s<p||s>y||(r$e(q$1,r,h),r$e(R$1,l,f),o$e(E$1,R$1,q$1),o$e(F$1,q$1,B$1),l$8(L$1,E$1,_$2(E$1,F$1)/_$2(E$1,E$1)),o$e(O$1,F$1,L$1),b=_$2(O$1,O$1),M>b&&(M=b));}return Math.sqrt(M)<=n}function G$1(t,e,s,n,r,a){let c,m;const h=u$b(s.xoffset),f=u$b(s.yoffset),b=k$1*s.angle,M=k$1*a;switch(s.type){case"esriSMS":c=m=u$b(s.size);break;case"esriPMS":c=u$b(s.width),m=u$b(s.height);}r<I$1&&(n=I$1*n/r);const d=n$i(U$1);i$8(d,d,r$e(v$2,t,e)),c$b(d,d,M-b),e$a(d,d,r$e(v$2,n,-n)),i$8(d,d,r$e(v$2,h,-f));const x=[0,0];D$2(x,r$e(v$2,-.5*c,-.5*m),d);const S=[0,0];D$2(S,r$e(v$2,-.5*c,.5*m),d);const j=[0,0];D$2(j,r$e(v$2,.5*c,-.5*m),d);const w=[0,0];return D$2(w,r$e(v$2,.5*c,.5*m),d),{rings:[[x,j,w,S,x]]}}function J$1(t,e,s,n,r,a){const c=h$2.getEnvelope(s.data);if(!c)return null;r<I$1&&(n=I$1*n/r);const m=u$b(c.width),h=u$b(c.height),f=u$b(c.x),b=u$b(c.y),M=0*k$1,d=k$1*a,x=n$i(U$1);i$8(x,x,r$e(v$2,t,e)),c$b(x,x,d-M),e$a(x,x,r$e(v$2,n,n));const S=[0,0];D$2(S,r$e(v$2,f,b+h),x);const j=[0,0];D$2(j,r$e(v$2,f,b),x);const z=[0,0];D$2(z,r$e(v$2,f+m,b+h),x);const P=[0,0];return D$2(P,r$e(v$2,f+m,b),x),{rings:[[S,z,P,j,S]]}}function K$1(t,e,s,n,r,a){const c=u$b(s.xoffset),m=u$b(s.yoffset),h=k$1*s.angle,f=k$1*a,b=n$i(U$1);i$8(b,b,r$e(v$2,t,e)),c$b(b,b,f),e$a(b,b,r$e(v$2,r,-r));const M=n[0]+n[2]/2,d=n[1]+n[3]/2;i$8(b,b,r$e(v$2,c,-m)),i$8(b,b,r$e(v$2,M,d)),c$b(b,b,h),i$8(b,b,r$e(v$2,-M,-d));const x=[0,0];D$2(x,r$e(v$2,n[0],n[1]),b);const S=[0,0];D$2(S,r$e(v$2,n[0],n[1]+n[3]),b);const j=[0,0];D$2(j,r$e(v$2,n[0]+n[2],n[1]),b);const w=[0,0];return D$2(w,r$e(v$2,n[0]+n[2],n[1]+n[3]),b),{rings:[[x,j,w,S,x]]}}function N$1(t){switch(t.symbol.type){case"esriSFS":case"esriPFS":{const e=t.symbol.outline;return e?e.width:0}case"esriSLS":return u$b(t.symbol.width);case"esriSMS":return u$b(t.symbol.size);case"esriPMS":return u$b(Math.max(t.symbol.width,t.symbol.height));case"esriTS":{const e=[0,0,0,0];Q$1(e,t.symbol,t.mosaicItem);const s=Math.max(Math.abs(e[0]),Math.abs(e[1]));return Math.max(e[2],e[3])+s}case"expanded-cim":{const e=h$2.getEnvelope(t.symbol.data);return e.width!==-1/0&&e.height!==-1/0||(e.width=10,e.height=10,e.x=0,e.y=0),u$b(Math.sqrt(e.width*e.width+e.height*e.height))}case"composite-symbol":{if(!t.symbol.layers.length)return 0;const e=t.symbol.layers.length-1;return N$1({symbol:t.symbol.layers[e],mosaicItem:null})}case"label":default:return 0}}function Q$1(t,e,s){if(!s||0===s.glyphMosaicItems.length)return t;const n=n$3(e.text)[1],r=s.glyphMosaicItems,i=A$2(r,n,{scale:u$b(e.font.size)/24,angle:e.angle,xOffset:e.xoffset,yOffset:e.yoffset,hAlign:n$2(e.horizontalAlignment||"center"),vAlign:r$1(e.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(e.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(e.lineHeight||1,4)),decoration:e.font.decoration||"none",isCIM:!1}).bounds;return t[0]=u$b(i.x-i.halfWidth),t[1]=u$b(i.y-i.halfHeight),t[2]=u$b(i.width),t[3]=u$b(i.height),t}function V$1(t,s,n,o,r,i,a,c){let m;switch(o.type){case"esriSMS":case"esriPMS":m=G$1(s,n,o,i,a,0);break;case"esriTS":m=K$1(s,n,o,r,i,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":m=J$1(s,n,o,i,a,0);}let l,h,u=0;for(let e=0;e<m.rings[0].length-1;e++)h=m.rings[0][e],l=(s-h[0])*(s-h[0])+(n-h[1])*(n-h[1]),u=Math.max(u,l);u=Math.sqrt(u);let p=k$2(s-u,c),g=k$2(s+u,c);if(p>g){const t=S$3(c);if(t){const[e,s]=t.valid;p=e,g=s;}}return t[0]=p,t[1]=n-u,t[2]=g,t[3]=n+u,t}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
var l$1;let n$1=l$1=class extends j$2{writeLevels(e,s,i){for(const t in e){const e=this.levels[t];return void(s.stops=e)}}clone(){return new l$1({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:n$j(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:n$j(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:y$5(this.levels)})}};e$b([y$7()],n$1.prototype,"levels",void 0),e$b([o$f("levels")],n$1.prototype,"writeLevels",null),n$1=l$1=e$b([i$9("esri.views.2d.engine.LevelDependentSizeVariable")],n$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const o$3=n$f.getLogger("esri.views.2d.layers.support.clusterUtils");t$9.add("esri-cluster-arcade-enabled",1);const u$2=t$9("esri-cluster-arcade-enabled"),c$2=(e,t,r,s)=>{const a=t.clone();if(!m$1(a))return a;if(r.fields)for(const i of r.fields)x$2(e,i);if("visualVariables"in a){const t=(a.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression)),n=d$1(t);t.forEach((i=>{"rotation"===i.type?i.field?i.field=y$1(e,i.field,"avg_angle"):i.valueExpression&&(i.field=S$1(e,i.valueExpression,"avg_angle"),i.valueExpression=null):i.normalizationField?(i.field=y$1(e,i.field,"norm",i.normalizationField),i.normalizationField=null):i.field?i.field=y$1(e,i.field,"avg"):(i.field=S$1(e,i.valueExpression,"avg"),i.valueExpression=null);})),t$a(n)&&!p$2(t)&&(t.push(f$1(r,s)),a.dynamicClusterSize=!0),a.visualVariables=t;}switch(a.type){case"simple":break;case"unique-value":a.field?a.field=y$1(e,a.field,"mode"):a.valueExpression&&(a.field=S$1(e,a.valueExpression,"mode"),a.valueExpression=null);break;case"class-breaks":a.normalizationField?(a.field=y$1(e,a.field,"norm",a.normalizationField),a.normalizationField=null):a.field?a.field=y$1(e,a.field,"avg"):(a.field=S$1(e,a.valueExpression,"avg"),a.valueExpression=null);}return a},d$1=e=>{for(const i of e)if("size"===i.type)return i;return null},p$2=e=>{for(const i of e)if("cluster_count"===i.field)return !0;return !1},f$1=(e,t)=>{const r=[new l$9({value:0,size:0}),new l$9({value:1})];if(t$a(t))return new j$2({field:"cluster_count",stops:[...r,new l$9({value:2,size:0})]});const n=Object.keys(t).reduce(((i,a)=>({...i,[a]:[...r,new l$9({value:Math.max(2,t[a].minValue),size:e.clusterMinSize}),new l$9({value:Math.max(3,t[a].maxValue),size:e.clusterMaxSize})]})),{});return new n$1({field:"cluster_count",levels:n})},m$1=e=>{const i=i=>o$3.error(new s$c("Unsupported-renderer",i,{renderer:e}));if("unique-value"===e.type){if(e.field2||e.field3)return i("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===e.type){if(e.normalizationField){const t=e.normalizationType;if("field"!==t)return i(`FeatureReductionCluster does not support a normalizationType of ${t}`),!1}}else if("simple"!==e.type)return i(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1;if(!u$2){if("valueExpression"in e&&e.valueExpression)return i("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return i("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return !0};function v$1(e,i,t){switch(e){case"avg":case"avg_angle":return `cluster_avg_${i}`;case"mode":return `cluster_type_${i}`;case"norm":{const e=t,r="field",s=i.toLowerCase()+",norm:"+r+","+e.toLowerCase();return "cluster_avg_"+x$5(s)}}}function x$2(e,i){const{name:t,outStatistic:s}=i,{onStatisticField:a,onStatisticValueExpression:l,statisticType:u}=s;if(l){const i=x$5(l.toLowerCase());e.push({name:t,outStatistic:{onStatisticField:i,onStatisticValueExpression:l,statisticType:u}});}else a?e.push({name:t,outStatistic:{onStatisticField:a,statisticType:u}}):o$3.error(new s$c("mapview-unsupported-field","Unable to handle field",{field:i}));}function S$1(e,i,t){const r=x$5(i),s="mode"===t?`cluster_type_${r}`:`cluster_avg_${r}`;return e.some((e=>e.name===s))||e.push({name:s,outStatistic:{onStatisticField:r,onStatisticValueExpression:i,statisticType:t}}),s}function y$1(e,i,t,r){if("cluster_count"===i||e.some((e=>e.name===i)))return i;const s=v$1(t,i,r);return e.some((e=>e.name===s))||("norm"===t?e.push({name:s,outStatistic:{onStatisticField:i,onStatisticNormalizationField:r,statisticType:t}}):e.push({name:s,outStatistic:{onStatisticField:i,statisticType:t}})),s}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
function e$1(e){if(!e)return A$4.NONE;let r=0;for(const i of e)if("size"===i.type){const t=o$g(i);r|=t,"outline"===i.target&&(r|=t<<4);}else "color"===i.type?r|=A$4.COLOR:"opacity"===i.type?r|=A$4.OPACITY:"rotation"===i.type&&(r|=A$4.ROTATION);return r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const s$1={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},o$2=.707;function a$1(t){if(!("visualVariables"in t))return 0;if(!t.hasVisualVariables("size"))return 0;const e=t.getVisualVariablesForType("size");if(!e[0])return 0;const i=e[0];if("stops"===i.transformationType)return i.stops.map((t=>t.size)).reduce(x$1,0);if("clamped-linear"===i.transformationType){let t=-1/0,e=-1/0;return t="number"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map((t=>t.size)).reduce(x$1,0),e="number"==typeof i.minSize?i.minSize:i.minSize.stops.map((t=>t.size)).reduce(x$1,0),Math.max(t,e)}return "real-world-size"===i.transformationType?30:void 0}function m(t){return t.type in s$1}async function u$1(e,i,r){if(!e||r&&"cluster"===r.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return "esriGeometryPoint"===i||"esriGeometryMultipoint"===i?100:200;const n=e.getSymbols(),s=a$1(e),o=[];for(const t of n)o.push(d(t,s));const m=await Promise.all(o);return u$b(m.reduce(x$1,0))}const c$1=[0,0,0,0];function l(t,e){return null==t?e:t}function p$1(t,e){return null==t.outline?e:l(t.outline.width,e)}const f={sdf:!0,code:99,metrics:k$3.metrics,rect:new t$3(0,0,24,24),page:0,textureBinding:2};function h$1(t){const e=t.text&&t.text.length;if(!e)return {glyphMosaicItems:[f]};const i=[];for(let r=0;r<e;r++)i.push({...f,code:t.text.charCodeAt(r)});return {glyphMosaicItems:i}}async function y(t,e){if("simple-marker"===t.type){const i=Math.max(l(t.size,12),e);return M$1(t)+i*o$2}if("picture-marker"===t.type){const i=Math.max(l(t.height,12),e),r=l(t.width,12)*(i/l(t.height,12))/2,n=i/2;return M$1(t)+Math.sqrt(r*r+n*n)}if("text"===t.type){const e=h$1(t);Q$1(c$1,t.toJSON(),e);const i=Math.abs(c$1[0]),r=Math.abs(c$1[1]),s=c$1[2],o=c$1[3];return Math.max(i,r)+Math.max(s,o)}if("simple-line"===t.type){const i=t,r=Math.max(l(i.width,.75),e)/2;return i.marker?Math.max(6*i.width,2*e):r}if("simple-fill"===t.type||"picture-fill"===t.type)return Math.max(p$1(t,0),e)/2;if("cim"===t.type){const e=h$2.getEnvelope(t.data);return e?Math.sqrt(e.width*e.width+e.height*e.height):0}return "web-style"===t.type?y(await t.fetchCIMSymbol(),e):0}async function d(t,e){return m(t)?Math.min(await y(t,e),75):0}function M$1(t){const e=l(t.xoffset,0),i=l(t.yoffset,0);return Math.sqrt(e*e+i*i)}function x$1(t,e){return Math.max(t,e)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const o$1=8,t=o$1-2,r=n$f.getLogger("esri.renderers.visualVariables.support.utils"),s=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const l=e.clone(),o=l.visualVariables.map((e=>n(e)?i(e):e));return l.visualVariables=o,l};function a(e){return e.map((e=>n(e)?i(e.clone()):e))}function n(e){return ("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function i(e){return e.stops=b(e.type,e.stops),e}function u(e,l,o){return (1-o)*e+o*l}function c(e,o){const[r,...s]=o,a=s.pop(),n=s[0].value,i=s[s.length-1].value,c=(i-n)/t,p=[];for(let t=n;t<i;t+=c){let r=0;for(;t>=s[r].value;)r++;const a=s[r],n=o[r-1],i=t-n.value,c=a.value===n.value?1:i/(a.value-n.value);if("color"===e){const e=s[r],l=o[r-1],a=e.color.clone();a.r=u(l.color.r,a.r,c),a.g=u(l.color.g,a.g,c),a.b=u(l.color.b,a.b,c),a.a=u(l.color.a,a.a,c),p.push({value:t,color:a,label:e.label});}else if("size"===e){const e=s[r],a=o[r-1],n=o$h(e.size),i=u(o$h(a.size),n,c);p.push({value:t,size:i,label:e.label});}else {const e=s[r],l=u(o[r-1].opacity,e.opacity,c);p.push({value:t,opacity:l,label:e.label});}}return [r,...p,a]}function p(e){const[l,...o]=e,r=o.pop();for(;o.length>t;){let e=0,l=0;for(let t=1;t<o.length;t++){const r=o[t-1],s=o[t],a=Math.abs(s.value-r.value);a>l&&(l=a,e=t);}o.splice(e,1);}return [l,...o,r]}function b(e,l){return l.length<=o$1?l:(r.warn(`Found ${l.length} Visual Variable stops, but MapView only supports ${o$1}. Displayed stops will be simplified.`),l.length>2*o$1?c(e,l):p(l))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const o=new t$b({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function e(t){return o.toJSON(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
const h=n$f.getLogger("esri.views.2d.layers.features.schemaUtils"),x="ValidationError",v={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function w(e){return f$8(e)}function E(e){return e}function I(e){switch(e.type){case"line-marker":var t;return {type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style};default:return i$a(e.toJSON()).toJSON()}}function S(e,t,i){if(!e)return null;let n=0,l=!1,s=0;switch(r$f(t)&&(s=a$1(t),"visualVariables"in t&&(n=e$1(t.visualVariables||[]),l="dot-density"===t.type)),e.type){case"simple-fill":case"picture-fill":return F(e,n,l,i);case"simple-marker":case"picture-marker":return j(e,n,s,i);case"simple-line":return z(e,n,i);case"text":return V(e,n,s,i);case"label":return N(e,n,i);case"cim":return {type:"cim",rendererKey:n,data:e.data,maxVVSize:s};case"web-style":return {...I(e),type:"web-style",hash:e.hash(),rendererKey:n,maxVVSize:s};default:throw new Error(`symbol not supported ${e.type}`)}}function F(e,t,r,i){const n=A$5(E$2.FILL,t,!1,r),l=i?w(n):n,s=e.clone(),a=s.outline;s.outline=null;const o=[],u={materialKey:l,hash:s.hash(),...I(s)};if(o.push(u),a){const e=A$5(E$2.LINE,t,!0,!1),r={materialKey:i?w(e):e,hash:a.hash(),...I(a)};o.push(r);}return {type:"composite-symbol",layers:o,hash:o.reduce(((e,t)=>t.hash+e),"")}}function z(e,t,r){const i=A$5(E$2.LINE,t,!1,!1),n=r?w(i):i,l=e.clone(),s=l.marker;l.marker=null;const a=[];if(a.push({materialKey:n,hash:l.hash(),...I(l)}),s){var o;const e=A$5(E$2.MARKER,t,!1,!1),i=r?w(e):e;s.color=null!=(o=s.color)?o:l.color,a.push({materialKey:i,hash:s.hash(),lineWidth:l.width,...I(s)});}return {type:"composite-symbol",layers:a,hash:a.reduce(((e,t)=>t.hash+e),"")}}function j(e,t,r,i){const n=A$5(E$2.MARKER,t,!1,!1),l=i?w(n):n,s=I(e);return {materialKey:l,hash:e.hash(),...s,angle:e.angle,maxVVSize:r}}function V(e,t,r,i){const n=A$5(E$2.TEXT,t,!1,!1),l=i?w(n):n,s=I(e);return {materialKey:l,hash:e.hash(),...s,angle:e.angle,maxVVSize:r}}function T(e,t){const r=e.labelPlacement,i=v[t];if(!e.symbol)return h.warn("No ILabelClass symbol specified."),!0;if(!i)return h.error(new s$c("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${t} is not supported`)),!0;if(!i.some((e=>e===r))){const n=i[0];r&&h.warn(`Found invalid label placement type ${r} for ${t}. Defaulting to ${n}`),e.labelPlacement=n;}return !1}function R(e,r){const i=y$5(e);return i.some((e=>T(e,r)))?[]:i}function N(e,t,r){const i=A$5(E$2.LABEL,t,!1,!1,e.labelPlacement);return {materialKey:r?w(i):i,hash:e.hash(),...e.toJSON(),labelPlacement:e.labelPlacement}}function k(t){return t$9("esri-2d-update-debug")&&console.debug("Created new schema",K(t,!0)),K(t)}function K(e,t=!1){try{var r,i;const n=C(e,t),l={};n.map((t=>M(l,e,t)));return {source:{definitionExpression:e.definitionExpression,fields:e.fields.map((e=>e.toJSON())),gdbVersion:e.gdbVersion,historicMoment:null==(r=e.historicMoment)?void 0:r.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null==(i=e.timeExtent)?void 0:i.toJSON()},attributes:{fields:{},indexCount:0},processors:n,targets:l}}catch(n){if(n.fieldName===x)return h.error(n),null;throw n}}function M(e,t,r){switch(r.target){case"feature":return void L(e,J(t),r);case"aggregate":{const i=t.featureReduction;if("selection"===i.type)throw new s$c(x,"Mapview does not support `selection` reduction type",i);return L(e,J(t),r),void B(e,i,r)}}}function O(e,t){for(const r in t){const i=t[r];if(i.target!==e.name)continue;const n=e.attributes[r];n?(n.context.mesh=n.context.mesh||i.context.mesh,n.context.storage=n.context.storage||i.context.storage):e.attributes[r]=i;}return e}function J(e){var t,r,i,n,l;return [null!=(t=null==(r=e.filter)?void 0:r.toJSON())?t:null,null!=(i=null==(n=e.effect)||null==(l=n.filter)?void 0:l.toJSON())?i:null]}function L(e,t,r){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),O(e.feature,r.attributes.fields),e}function B(e,t,r){return e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:u$b(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(u$b(t.clusterMaxSize)/64),fields:r.aggregateFields}}),O(e.aggregate,r.attributes.fields),e}function P(e,t){return t.field?U(e,{...t,type:"field",field:t.field}):t.valueExpression?U(e,{...t,type:"expression",valueExpression:t.valueExpression}):{field:null,fieldIndex:null}}function U(e,t){switch(t.type){case"expression":{const r=E(t.valueExpression);if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i};}return {fieldIndex:e.fields[r].fieldIndex}}case"label-expression":{const r=E(JSON.stringify(t.label));if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i};}return {fieldIndex:e.fields[r].fieldIndex}}case"field":{const r=t.field;return "aggregate"===t.target&&e.fields[r]||(e.fields[r]={...t,name:r}),{field:r}}case"statistic":return e.fields[t.name]={...t},{field:t.name}}}function C(e,t=!1){const r=new Array;let i=0;return r.push($(e,i++,t)),r}function D(e,t,r,i,n,l=!1){const s=U(t,{type:"label-expression",target:i,context:{mesh:!0},resultType:"string",label:{labelExpression:r.labelExpression,labelExpressionInfo:r.labelExpressionInfo?{expression:r.labelExpressionInfo.expression}:null,symbol:!!r.symbol,where:r.where}}),{fieldIndex:a}=s;return {...S(r,e,l),fieldIndex:a,target:i,index:n}}function $(e$1,t,r=!1){const i={indexCount:0,fields:{}},n="featureReduction"in e$1&&e$1.featureReduction,s=n?"aggregate":"feature";switch(e$1.renderer.type){case"heatmap":{const{blurRadius:t,fieldOffset:r,field:n}=e$1.renderer;return {type:"heatmap",aggregateFields:[],attributes:i,target:s,storage:null,mesh:{blurRadius:t,fieldOffset:r,field:P(i,{target:s,field:n,resultType:"numeric"}).field}}}default:{const t=[],a="aggregate"===s?c$2(t,e$1.renderer,n,null):e$1.renderer;q(i,t);const d=W(i,s,a,r);let c=null;const f=A(i,s,a),p=e(e$1.geometryType);let m=e$1.labelsVisible&&e$1.labelingInfo||[],y=[];if(n){if("selection"===n.type)throw new s$c(x,"Mapview does not support `selection` reduction type",n);if(n.symbol){const e=new m$6({symbol:n.symbol,visualVariables:"visualVariables"in a?a.visualVariables:null});c=W(i,s,e,r);}y=n&&n.labelsVisible&&n.labelingInfo||[];}m=R(m,p),y=R(y,p);let g=0;const h=[...m.map((e=>D(a,i,e,"feature",g++,r))),...y.map((e=>D(a,i,e,"aggregate",g++,r)))];return {type:"symbol",target:s,attributes:i,aggregateFields:t,storage:f,mesh:{matcher:d,labels:h,aggregateMatcher:c}}}}}function q(e,t){const r={mesh:!0,storage:!0};for(const i of t){const{name:t,outStatistic:n}=i,{statisticType:l,onStatisticField:s}=n;let a=null,o=null,u=null;const d="numeric",c="feature";if("onStatisticValueExpression"in n){o=U(e,{type:"expression",target:c,valueExpression:n.onStatisticValueExpression,resultType:d}).fieldIndex;}else if("onStatisticNormalizationField"in n){a=U(e,{type:"field",target:c,field:s,resultType:d}).field,u=n.onStatisticNormalizationField;}else {a=U(e,{type:"field",target:c,field:s,resultType:d}).field;}U(e,{type:"statistic",target:"aggregate",name:t,context:r,inField:a,inNormalizationField:u,inFieldIndex:o,statisticType:l});}}function A(e,t,r){switch(r.type){case"dot-density":return G(e,t,r.attributes);case"simple":case"class-breaks":case"unique-value":return H(e,t,r.visualVariables);case"heatmap":case"dictionary":return null}}function G(e,t,r){if(!r||!r.length)return {type:"dot-density",mapping:[],target:t};return {type:"dot-density",mapping:r.map(((r,i)=>{const{field:n,fieldIndex:l}=P(e,{valueExpression:r.valueExpression,field:r.field,resultType:"numeric",target:t});return {binding:i,field:n,fieldIndex:l}})),target:t}}function H(e,t,r){if(!r||!r.length)return {type:"visual-variable",mapping:[],target:t};const i={storage:!0},n="numeric";return {type:"visual-variable",mapping:a(r).map((r=>{var l;const s=X$1(r.type),{field:a,fieldIndex:o}=P(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:i,resultType:n});switch(r.type){case"size":return "$view.scale"===r.valueExpression?null:{type:"size",binding:s,field:a,fieldIndex:o,normalizationField:P(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field,valueRepresentation:null!=(l=r.valueRepresentation)?l:null};case"color":return {type:"color",binding:s,field:a,fieldIndex:o,normalizationField:P(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case"opacity":return {type:"opacity",binding:s,field:a,fieldIndex:o,normalizationField:P(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case"rotation":return {type:"rotation",binding:s,field:a,fieldIndex:o}}})).filter((e=>e)),target:t}}function W(e,t,r,n=!1){const l=c$c(e,{indexCount:0,fields:{}});switch(r.type){case"simple":case"dot-density":return X(l,r,"dot-density"===r.type,n);case"class-breaks":return Q(l,t,r,n);case"unique-value":return Y(l,t,r,n);case"dictionary":return Z(l,r,n)}}function X(e,t,r,i=!1){const n=t.getSymbols();return {type:"simple",symbol:S(n.length?n[0]:null,t,i),isDotDensity:r}}function Q(e,t,r,i=!1){const n={mesh:!0,use:"renderer.field"},l=r.backgroundFillSymbol,{field:s,fieldIndex:a}=P(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:"numeric",context:n}),o=r.normalizationType,u="log"===o?"esriNormalizeByLog":"percent-of-total"===o?"esriNormalizeByPercentOfTotal":"field"===o?"esriNormalizeByField":null,d=r.classBreakInfos.map((e=>({symbol:S(e.symbol,r,i),min:e.minValue,max:e.maxValue}))).sort(((e,t)=>e.min-t.min));return {type:"interval",attributes:e.fields,field:s,fieldIndex:a,backgroundFillSymbol:S(l,r,i),defaultSymbol:S(r.defaultSymbol,r,i),intervals:d,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:u,isMaxInclusive:r.isMaxInclusive}}function Y(e,t,r,i=!1){const n=[],s=r.backgroundFillSymbol,a={target:t,context:{mesh:!0},resultType:"string"};if(r.field&&"string"!=typeof r.field)throw new s$c(x,"Expected renderer.field to be a string",r);const{field:o,fieldIndex:u}=P(e,{...a,field:r.field,valueExpression:r.valueExpression});for(const l of r.uniqueValueInfos)n.push({value:""+l.value,symbol:S(l.symbol,r,i)});return {type:"map",attributes:e.fields,field:o,fieldIndex:u,field2:P(e,{...a,field:r.field2}).field,field3:P(e,{...a,field:r.field3}).field,fieldDelimiter:r.fieldDelimiter,backgroundFillSymbol:S(s,r),defaultSymbol:S(r.defaultSymbol,r),map:n}}function Z(e,t,r=!1){return {type:"dictionary",renderer:t.toJSON()}}

export { A$1 as A, k as B, C$1 as C, D$1 as D, s as E, G$1 as G, H$1 as H, J$1 as J, K$1 as K, P$1 as P, S, T$1 as T, W$1 as W, W as a, S$2 as b, A$3 as c, A$2 as d, G$2 as e, p$6 as f, r$d as g, h$2 as h, n$2 as i, r$1 as j, a$2 as k, c$3 as l, o$4 as m, n$3 as n, o$a as o, p$4 as p, e as q, r$2 as r, s$2 as s, t$3 as t, u$1 as u, d$1 as v, f$1 as w, m$1 as x, c$2 as y, z$1 as z };
