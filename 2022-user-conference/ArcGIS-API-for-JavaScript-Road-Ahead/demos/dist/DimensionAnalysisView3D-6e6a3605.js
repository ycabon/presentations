import { t as t$1, u5 as v, u6 as N$1, m as r$3, aK as n$1, fP as r$4, hb as c$3, eC as n$2, d8 as i$2, hg as g$3, gb as m, j6 as O$2, u7 as J$1, eG as _$2, eD as P, fQ as G$1, hT as f$1, eF as z$2, hk as e$1, gn as q$1, f2 as k$1, u8 as X$1, f1 as v$2, gq as v$3, u as e$2, y as y$2, z as n$3, A as m$1, bC as t$3, es as s$2, fu as ue$1, b7 as l$3, eX as w$2, fa as E$1, $ as s$3, ck as l$4, hE as u$2, i5 as q$2, bn as g$4, hd as t$4, bk as w$4, js as s$4, g1 as _$3, fY as p$1, eE as e$3, g2 as R$1, i7 as F$1, jj as r$6, hz as s$5, hr as i$3, aO as o$1, aF as u$3, bp as r$7, u9 as m$2, ga as Y$1, gx as b$3, ua as n$4, eu as p$2, b8 as h$1, e9 as j$2, ub as p$3, uc as E$2, ud as M$2, eq as n$5, ue as t$5, eY as d$2, il as r$8, gM as o$2, hH as U$2, d3 as o$4, bl as f$2, uf as w$5, e$ as g$5, gR as H, jQ as x$1, jR as t$6, h3 as t$7, l$ as e$5, ug as c$5, gi as h$3, uh as t$8, dR as r$9, ha as x$2, gO as t$9, ui as v$4, kg as w$7, gU as m$3, L as e$6, uj as f$3, uk as s$6, ul as l$5, tV as s$7, gC as u$6, gD as a$5, gh as p$5 } from './_virtual_index-1ea2035a.js';
import { n as n$7 } from './AnalysisView3D-341b9eab.js';
import { t as t$2, r as r$5, u as u$5 } from './LengthDimension-f85d48b3.js';
import { v as v$1, g as g$8 } from './quantityFormatUtils-d7b5c624.js';
import { l as l$2, g as g$7 } from './Segment-03bd0aa3.js';
import { j as j$1, y as y$1 } from './euclideanLengthMeasurementUtils-93ea014d.js';
import { U as U$1, i as ie$1, x, R, T, z as z$3, D as D$1 } from './manipulatorUtils-81641492.js';
import { B as B$1, C, z as z$4, o as o$3 } from './Factory-11dfe060.js';
import { d as d$1, w as w$3, G as G$2 } from './dragEventPipeline-b225d16a.js';
import { a as _$4, _ as _$5 } from './VerticesVisualElement-cdf1199e.js';
import { c as c$4, n as n$6, a as n$8, b as a$4 } from './LineVisualElement-e2d301b0.js';
import { p as p$4 } from './ImageMaterial-26ca33d0.js';
import { V as V$1, g as g$6, w as w$6 } from './EditGeometryOperations-2f1c7df5.js';
import { e as e$4 } from './SnappingContext-a1ff8c28.js';
import { u as u$4, h as h$2 } from './SnappingOperation-e299c5a9.js';
import { a as a$3, s as s$8, m as m$4, c as c$6 } from './analysisViewUtils-afc4be3a.js';
import { r as r$a } from './RenderTexture-4d4fdf4e.js';
import './TextOverlayItem-24d2f827.js';
import './measurementUtils-d2a749ce.js';
import './drawUtils-716bb6e9.js';
import './PointVisualElement-12207533.js';
import './RightAngleQuadVisualElement-9584f4cd.js';
import './PointSnappingHint-71b3a4f1.js';
import './dehydratedFeatureComparison-73cd17db.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function w$1(t,r,i){if(t$1(t))return null;const d=t.dimensionSegment.startRenderSpace,c=t.dimensionSegment.endRenderSpace,l=j$1(d,c,t.spatialReference);if(t$1(l))return null;const p=r===t$2.Vertical?v(l.value,l.unit,i):N$1(l.value,l.unit,i);return v$1(l,p)}function z$1(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:r,measureType:i,orientation:o}}=e;return {elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:r,measureType:i,orientation:o}}function k({elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:o,measureType:a,orientation:s},d,c=null){if(t$1(t)||t$1(i))return null;const p=D(r$3(c)?c.directSegment:new l$2,{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i},d),m=r$3(c)?c.primaryOffsetAxis:n$1();L$1(m,{measureType:a,elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,directSegment:p,orientation:s,renderCoordsHelper:d});const u=r$3(c)?c.dimensionSegment:new l$2;return Z({elevationAlignedStartPoint:t,elevationAlignedEndPoint:i})&&a===t$2.Vertical?(r$4(u.startRenderSpace,p.startRenderSpace),r$4(u.endRenderSpace,p.endRenderSpace)):G(u,{offsetAxis:m,offset:o,relativeToSegment:p,renderCoordsHelper:d}),{directSegment:p,dimensionSegment:u,primaryOffsetAxis:m,spatialReference:d.spatialReference}}function U(e,t,n,r){return t===b$2.Start?(r$4(e.startRenderSpace,n.startRenderSpace),r$4(e.endRenderSpace,r.startRenderSpace)):(r$4(e.startRenderSpace,n.endRenderSpace),r$4(e.endRenderSpace,r.endRenderSpace)),e}var b$2;function M$1(e,t,n,r){q$1(e.startRenderSpace,t.startRenderSpace,n,r),q$1(e.endRenderSpace,t.endRenderSpace,n,r);}function V(t,n,r,i){switch(n){case t$2.Direct:return D(t,r,i);case t$2.Horizontal:case t$2.Vertical:{const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:a,dimension:s,geometry:d}=r;let c;if(s.measureType===t$2.Direct){c=F(d,i)===o.z>a.z,n===t$2.Horizontal&&(c=!c);}else c=!O$1(d);const[l,p]=c?[o,a]:[a,o],m=k$1(p,I);return n===t$2.Horizontal?m.z=l.z:(m.x=l.x,m.y=l.y),i.toRenderCoords(l,t.startRenderSpace),i.toRenderCoords(m,t.endRenderSpace),t}}}function D(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}function F(e,t){const n=e.directSegment.eval(.5,c$3.get()),r=t.worldUpAtPosition(n,c$3.get()),i=e.dimensionSegment.eval(.5,c$3.get()),o=J$1(c$3.get(),i,n);return !G$1(o,f$1)&&P(o,r)>0}function O$1(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:r,endRenderSpace:i}=e.directSegment;return X$1(r,t)<X$1(i,n)}!function(e){e[e.Start=0]="Start",e[e.End=1]="End";}(b$2||(b$2={}));const I=v$2(0,0,0,null);function q(e,t,n,r){const{directSegment:i}=n,o=L$1(c$3.get(),{measureType:t,directSegment:i,renderCoordsHelper:r}),a=G(B,{offsetAxis:o,offset:0,relativeToSegment:i,renderCoordsHelper:r}).eval(.5,c$3.get()),s=J$1(c$3.get(),e,a);return P(s,o)*r.unitInMeters}const B=new l$2;function L$1(n,r){const{measureType:o,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:c,endRenderSpace:p},directSegment:f,renderCoordsHelper:A}=r,P$1=f.eval(.5,c$3.get()),h=A.worldUpAtPosition(P$1,c$3.get()),x=A.worldBasisAtPosition(P$1,n$2.Y,c$3.get());switch(o){case t$2.Horizontal:r$4(n,h);break;case t$2.Vertical:P(c,h)<P(p,h)?J$1(n,p,c):J$1(n,c,p),_$2(n,n,h),_$2(n,n,h);break;case t$2.Direct:{const e=i$2(r.orientation,0);if(Z({elevationAlignedStartPoint:a,elevationAlignedEndPoint:s}))g$3(Y,-m(e),h),O$2(n,x,Y);else {const r=J$1(c$3.get(),p,c),i=_$2(c$3.get(),r,h);_$2(i,i,r),g$3(Y,m(e),r),O$2(n,i,Y);}break}}return G$1(n,f$1)?r$4(n,x):z$2(n,n)}const Y=e$1();function Z({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}){return r$3(e)&&r$3(t)&&e.x===t.x&&e.y===t.y}function G(e,t){const{offsetAxis:n,offset:r,relativeToSegment:{startRenderSpace:i,endRenderSpace:o},relativeToSegment:a,renderCoordsHelper:s}=t,d=r/s.unitInMeters,[c,l]=J(i,o,n,d);return q$1(e.startRenderSpace,a.startRenderSpace,n,c),q$1(e.endRenderSpace,a.endRenderSpace,n,l),e}function J(e,t,n,r=0){const i=P(t,n),o=P(e,n),a=Math.abs(i-o)+r;return i>o?[a,r]:[r,a]}function K(e,t,n){const r=t.directSegment.eval(.5,c$3.get());return n.worldUpAtPosition(r,e)}function N(e,t){const{startRenderSpace:n,endRenderSpace:r}=t.directSegment;return J$1(e,r,n)}function Q(e,t,n={invert:!1}){const{startRenderSpace:r,endRenderSpace:i}=t.dimensionSegment;return n.invert?J$1(e,r,i):J$1(e,i,r)}function W(e,t){const n=e.directSegment.eval(.5,c$3.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}function X(e,t){return v$3(Q($,e))/t**2}const $=n$1();function _$1(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if(t$1(t)||t$1(i))return !1;const a=y$1(t,i);return r$3(a)&&v$1(a,"meters").value>ee}const ee=1e5;function te(e){return r$3(e.geometry)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let g$2=class extends m$1{constructor(e){super(e),this._handles=new t$3;}initialize(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",(({added:e,removed:t})=>{for(const s of t)this._removeComputation(s);for(const s of e)this._addComputation(s);})));}destroy(){this._handles=s$2(this._handles);}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return ue$1(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add(l$3((()=>z$1(e)),(s=>{const{measureType:o}=s;if(_$1(s)&&o!==t$2.Direct){const t=Math.round(E$1(ee,"meters","kilometers"));return s$3.getLogger(this.declaredClass).warnOnce(`A ${o} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const i=k(s,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=w$1(i,o,this._defaultUnit);}),w$2),e);}_removeComputation(e){this._handles.remove(e);}};e$2([y$2({constructOnly:!0})],g$2.prototype,"analysisViewData",void 0),e$2([y$2({constructOnly:!0})],g$2.prototype,"view",void 0),e$2([y$2()],g$2.prototype,"analysis",null),e$2([y$2()],g$2.prototype,"_defaultUnit",null),g$2=e$2([n$3("esri.views.3d.analysis.Dimension.support.DimensionController")],g$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const s$1={main:new l$4([255,127,0])};class i$1{constructor(){this.color=s$1.main,this.opacity=.5,this.radius=5;}}class o{constructor(){this.color=new l$4([127,127,127]),this.opacity=.5,this.radius=5;}}class n{constructor(){this.lineSizeFraction=.8;}}class c$2{constructor(){this.color=s$1.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1;}}class e{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2;}}class r$2{constructor(){this.lineSizeFraction=.25;}}class a$2{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5;}}class h{constructor(){this.color=new l$4([255,127,0,.5]);}}class l$1{constructor(){this.pointManipulators=new i$1,this.offsetManipulator=new c$2,this.orientationManipulator=new e,this.markers=new n,this.labels=new a$2,this.offsetLine=new r$2,this.constraint=new h,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new o,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500;}}const u$1=new l$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class ie{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical;}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return [this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const n of r$5)e(this.manipulatorForMeasureType(n),n);}manipulatorForMeasureType(e){switch(e){case t$2.Direct:return this.direct;case t$2.Horizontal:return this.horizontal;case t$2.Vertical:return this.vertical}}}function ae(t,n){const r=U$1(t,l$4.toUnitRGB(u$1.pointManipulators.color),u$1.pointManipulators.opacity,Ee);return r.available=!1,r.grabCursor="crosshair",r.radius=u$1.pointManipulators.radius,r.metadata=n.metadata,r.collisionPriority=1,r}function se(e,t){const n=[r$7(-.5,0,0),r$7(.5,0,0)],{lengthFraction:r}=u$1.offsetManipulator,o=q$2(n.map((e=>g$4(n$1(),e,r))));return new ie$1({view:e,renderObjects:[{geometry:o,material:t.unfocusedMaterial,stateMask:t$4.Unfocused|t$4.Selected|Ee},{geometry:o,material:t.focusedMaterial,stateMask:t$4.Focused|Ee}],collisionType:{type:"line",paths:[n]},radius:Re(t.lineSizePt)/2,metadata:t.metadata,available:!1,...x})}function ce(e,{lineSizePt:t,material:n}){const{calloutOffsetPx:r,calloutOpacity:o,calloutWidth:i,discScale:a,focusMultiplier:c}=u$1.orientationManipulator;return {calloutLength:.25*m$2*u$1.markers.lineSizeFraction*u$3(t)+r,calloutOpacity:o,calloutWidth:i,customStateMask:Ee,discScale:a,focusMultiplier:c,material:n,metadata:e}}function me(e,t){return R(e,ce(t.metadata,t))}function de(e,t){T(e,ce(e.metadata,t));}function le(e,t){const n=[r$7(-.5,0,0),r$7(.5,0,0)],{lengthFraction:r}=u$1.offsetManipulator,o=q$2(n),i=q$2(n.map((e=>g$4(n$1(),e,r))));return new ie$1({view:e,renderObjects:[{geometry:i,material:t.unfocusedMaterial,stateMask:t$4.Unfocused|Ee},{geometry:i,material:t.focusedMaterial,stateMask:t$4.Focused|Ee},{geometry:o,material:t.thinOffsetManipulatorMaterial,stateMask:Ee}],collisionType:{type:"line",paths:[n]},radius:Re(t.lineSizePt)/2,available:!1,metadata:t.metadata,...x})}function ue(e,{isStart:t,createSnappingPipelineStep:n,dimension:r,onUpdate:o,snappingPipeline:i,view:a}){const s=t?"startPoint":"endPoint",c=d$1(e,((e,t,c,m)=>{const d=z$4(e);c=c.next(d).next(w$3(r,[s,"measureType","orientation"])),t.next(d).next(B$1(a)).next(n(c,m),i.next).next((e=>{const t=k$1(e.mapEnd,new w$4);o("startPoint"===s?{startPoint:t}:{endPoint:t});}));}));return [c]}function pe(e,{computation:t,view:n}){return [d$1(e,((e,r,o)=>{if(!te(t)||!e.selected)return;const{geometry:i,dimension:a}=t,s=z$4(e);r.next(s).next(Me(n,a,i.dimensionSegment,i.primaryOffsetAxis)),o.next(s).next(w$3(a,["offset"]));}))]}function fe(e,{computation:t,view:n}){return [d$1(e,((e,r,o)=>{ye({cancel:o,computation:t,settingHeading:!0,steps:r,view:n});}))]}function ge(e,{computation:t,view:n}){return [d$1(e,((e,r,o)=>{ye({cancel:o,computation:t,settingHeading:!1,steps:r,view:n});})),e.events.on("immediate-click",(e=>{he(e,t,n);}))]}function he(e,t,n){const{dimension:o,geometry:a}=t;if(90===o.orientation||270===o.orientation)return o.orientation=0,void e.stopPropagation();if(t$1(a))return;const{renderCoordsHelper:s}=n,c=k({...z$1(t),orientation:90},s),m=k({...z$1(t),orientation:270},s);if(t$1(c)||t$1(m))return;const d=W(c,s),l=W(m,s),u=xe(a,n),p=s$4.shortestSignedDiff(u,d),f=s$4.shortestSignedDiff(u,l);o.orientation=Math.abs(p)<Math.abs(f)?90:270,e.stopPropagation();}function ye(e){const{cancel:t,computation:n,settingHeading:r,steps:i,view:s}=e;if(!te(n))return;const{renderCoordsHelper:c}=s,{dimension:m,geometry:d}=n,l=n$1(),p=be(n$1(),d,d.directSegment,c),f=Oe(c$3.get(),{forHeading:r,geometry:d,renderCoordsHelper:c}),g=_$3(p,f,p$1()),h=i$2(m.orientation,r?()=>W(d,s.renderCoordsHelper):0);i.next(C(s,g)).next((e=>{"start"===e.action&&r$4(l,e.renderStart);const t=Y$1(g),n=z$3(l,e.renderEnd,p,t);let i=h-b$3(n);r||(i=ve(i)),m.orientation=i;})),t.next(w$3(m,["orientation"]));}function ve(e){const t=s$4.normalize(e)%90;return t<u$1.orientationSnapThresholdDegrees?e-t:90-t<u$1.orientationSnapThresholdDegrees?e+(90-t):e}function Se(e,{computation:t,manipulatorMeasureType:r,view:o}){let i=t$2.Direct,a=0,s=0;return [e.events.on("grab-changed",(n=>{if("start"!==n.action||!te(t))return;const{dimension:c,geometry:m}=t;i=c.measureType,a=c.offset,s=c.orientation;const d=r$4(c$3.get(),e.renderLocation);c.measureType=r,c.offset=q(d,r,m,o.renderCoordsHelper),c.orientation=0;})),d$1(e,((e,n,c)=>{if(!te(t))return;const{geometry:m,dimension:d}=t,{renderCoordsHelper:l}=o,u=V(Ie,r,t,l),p=L$1(c$3.get(),{measureType:r,directSegment:m.directSegment,renderCoordsHelper:l}),f=z$4(e);n.next(f).next(Me(o,d,u,p)),c.next(f).next((e=>(d.measureType=i,d.offset=a,d.orientation=s,e)));}))]}function Me(e,t,n,r){const o=e$3(c$3.get(),n.endRenderSpace,n.startRenderSpace);_$2(o,o,r);const i=_$3(n.startRenderSpace,o,p$1()),a=_$3(n.startRenderSpace,r,p$1()),s=t.offset;let c,m=0;const d=new G$2;return d.next(C(e,i)).next((n=>{"start"===n.action&&(m=R$1(a,n.renderStart));const r=(R$1(a,n.renderEnd)-m)*e.renderCoordsHelper.unitInMeters;t.offset=s+r,c=n;})),e=>(d.execute(e),c)}function xe(e,t){const{directSegment:n}=e,{renderCoordsHelper:r}=t,o=K(c$3.get(),e,r),i=N(c$3.get(),e),a=_$2(c$3.get(),i,o),{viewForward:s}=t.state.camera;P(a,s)>0&&g$4(a,a,-1);const c=n.eval(.5,c$3.get());return r.headingAtPosition(c,a)}function je(e,t,n){const{dimensionSegment:r,primaryOffsetAxis:o}=t,i=Q(Le,t),a=F$1(i,f$1)?r$6(Ge):D$1(i,o,f$1,Ge),s=Math.max(s$5(i),u$1.offsetManipulator.minLengthMeters/n.unitInMeters);i$3(a,a,o$1(Le,s,s,s)),e.modelTransform=a,e.renderLocation=r.eval(.5,Le);}function Pe(e,t,n){we(e,t,n,{forHeading:!0});}function He(e,t,n){we(e,t,n,{forHeading:!1});}function we(e,t,n,{forHeading:r}){const{dimension:o,geometry:i}=t,{primaryOffsetAxis:a}=i,s=g$4(Te,a,o.offset>=0?1:-1),c=Oe(ke,{forHeading:r,geometry:i,renderCoordsHelper:n});_$2(c,c,s);const m=D$1(s,c,f$1,Ge);e.modelTransform=m,e.renderLocation=be(Le,i,i.dimensionSegment,n);}const Te=n$1(),ke=n$1();function Ce(e,t,n,r){const{geometry:o}=t,i=V(Ie,n,t,r),a=L$1(Le,{measureType:n,directSegment:o.directSegment,renderCoordsHelper:r}),s=J$1(Ae,i.endRenderSpace,i.startRenderSpace),c=D$1(s,a,f$1,Ge),d=s$5(s);i$3(c,c,o$1(Ae,d,d,d)),e.modelTransform=c,e.renderLocation=i.eval(.5,Ae);}function be(e,t,n,r){const{startRenderSpace:o,endRenderSpace:i}=n,a=ze(t,r)?o:i;return r$4(e,a)}function Oe(e,{forHeading:t,geometry:n,renderCoordsHelper:r}){return t?K(e,n,r):Q(e,n,{invert:!0})}function ze(e,t){const n=N(Ue,e),r=K(De,e,t);return P(n,r)>0}const Ue=n$1(),De=n$1();function Fe(e){return u$3(e)+u$1.offsetManipulator.linePaddingPx}function Re(e){return u$3(e)+u$1.offsetManipulator.focusedLinePaddingPx}const Ee=u$2.Custom1,Le=n$1(),Ae=n$1(),Ge=e$1(),Ie=new l$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var u;function f(t,n){if(_$1(t))return u.Direct;const{geometry:m}=t;if(t$1(m)||F$1(m.directSegment.startRenderSpace,m.directSegment.endRenderSpace))return null;const{constraintThresholdPx:f}=u$1,{camera:g}=n.state,y=K(c$3.get(),m,n.renderCoordsHelper),S=N(c$3.get(),m),z=g$4(c$3.get(),y,P(S,y)),x=e$3(c$3.get(),S,z),h=v$3(x),j=v$3(z),{startRenderSpace:v,endRenderSpace:D}=m.directSegment,R=Math.max(g.computeRenderPixelSizeAt(v)*f,g.computeRenderPixelSizeAt(D)*f)**2;return h<R?u.Vertical:j<R?u.Horizontal:null}function g$1(i,o,r){const{constraint:s,elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,unconstrainedGeometry:l,view:d}=r,{dimension:p,previousConstraint:P,preConstraintProperties:f}=i;if(t$1(a)||t$1(c))return;const g=()=>{"startPoint"in o?p.startPoint=o.startPoint:"endPoint"in o&&(p.endPoint=o.endPoint);};if(t$1(s))g(),r$3(P)&&r$3(f)&&(p.measureType=f.measureType,p.orientation=f.orientation);else switch(p.measureType=t$2.Direct,s){case u.Horizontal:if(s!==P&&(p.orientation=0),"startPoint"in o){const t=o.startPoint;r$3(t)&&(t.z=c.z),p.startPoint=t;}else if("endPoint"in o){const t=o.endPoint;r$3(t)&&(t.z=a.z),p.endPoint=t;}break;case u.Vertical:if(s!==P&&(p.orientation=xe(l,d)),"startPoint"in o){const t=o.startPoint;r$3(t)&&(t.x=c.x,t.y=c.y),p.startPoint=t;}else if("endPoint"in o){const t=o.endPoint;r$3(t)&&(t.x=a.x,t.y=a.y),p.endPoint=t;}break;case u.Direct:s!==P&&r$3(f)&&(p.orientation=f.orientation),g();}i.previousConstraint=s;}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct";}(u||(u={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function a$1(a,s){const l=new n$4({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:s?.distance??p$2.distance,touchSensitivityMultiplier:s?.touchSensitivityMultiplier??p$2.touchSensitivityMultiplier});return {...l$3((()=>a.map?.allLayers?.toArray()??[]),(t=>{l.featureSources=new j$2(t.map((e=>new p$3({layer:e,enabled:!0}))));}),h$1),options:l}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const i=new Map;function a(n){if(!i.has(n)){const e=a$1(n,{distance:10}),o=s(n,e.options);i.set(n,{referenceCount:0,snappingManager:o,remove:()=>{e.remove(),o.destroy();}});}const o=i.get(n);o.referenceCount++;const t=n$5((()=>p(n,o)));return {snappingManager:o.snappingManager,...t}}function p(e,r){r.referenceCount--,r.referenceCount>0||t$5((()=>{0===r.referenceCount&&(r.remove(),i.delete(e));}));}function s(e,n){return new E$2({view:e,options:n,snappingEnginesFactory:(n,r)=>[new M$2({view:e,spatialReference:e.spatialReference,options:r})]})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let pt=class extends d$2{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new t$3,this._snappingPipeline=new u$4,this._snappingManagerResult=a(t.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=lt(),this._focusedOffsetManipulatorMaterial=lt(),this._thinOffsetManipulatorMaterial=lt(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:r$8(2)}),this._constraintSnappingIndicator=new c$4({view:t.view,attached:!0,width:1,color:l$4.toUnitRGBA(u$1.constraint.color),renderOccluded:o$2.OccludeAndTransparent,stipplePattern:r$8(5)});const i=l$4.toUnitRGBA(u$1.disabledPointIndicator.color);i[3]*=u$1.disabledPointIndicator.opacity,this._stagedStartIndicator=new _$4({view:t.view,attached:!1,color:i,size:2*u$1.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:o$2.OccludeAndTransparent});}initialize(){this._snappingOperation=new h$2({view:this.view}),this._orientationManipulatorTexture=o$3(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new p$4({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:o$2.Opaque});const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles([t.on("after-add",(t=>this._addComputation(t.item))),t.on("after-remove",(t=>this._removeComputation(t.item)))]),this.addHandles([l$3((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:t,stagedComputation:e})=>{if(t$1(e)||t$1(t))return;const i=k$1(t,new w$4);this._applyPointUpdate(e,{endPoint:i});}),U$2),l$3((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((t,e)=>{const{stagedDimension:i,selectedComputation:a,firstGrabbedManipulator:n}=t;if(i===e.stagedDimension&&n===e.firstGrabbedManipulator){for(const s of [a,e.selectedComputation])if(r$3(s)){const e=this._computationManipulators.get(s);this._updateManipulators(s,e,t);}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,t);}),w$2),l$3((()=>this.analysis.style.lineSize),(t=>{this._updateManipulatorStyle(t);}),h$1),l$3((()=>this.view.state.camera),(()=>{r$3(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation);})),l$3((()=>o$4(this._stagedComputation,(t=>{const e=t.elevationAlignedStartPoint,i=n$1();return r$3(e)&&this.view.renderCoordsHelper.toRenderCoords(e,i)?i:null}))),(t=>{r$3(t)?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1;}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles);}destroy(){this._snappingOperation=s$2(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release();}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(r$3(this._stagedComputation))return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&r$3(t)?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1);return t$1(t)||t$1(e)||e.dimension!==t?null:e}get _constraintHandles(){return [f$2((()=>this.analysisViewData.selectedComputation),(t=>{t.previousConstraint=f(t,this.view);}),{...w$2,equals:w$5}),l$3((()=>{const t=this._activeComputation;if(t$1(t))return null;const{measureType:e,orientation:i}=t.dimension;return {measureType:e,orientation:i,computation:t}}),((t,e)=>{if(r$3(t)&&t$1(e)){const{measureType:e,orientation:a,computation:n}=t;switch(n.previousConstraint){case u.Horizontal:n.preConstraintProperties={measureType:t$2.Horizontal,orientation:0};break;case u.Vertical:n.preConstraintProperties={measureType:t$2.Vertical,orientation:0};break;case u.Direct:n.preConstraintProperties={measureType:t$2.Direct,orientation:a};break;default:n.preConstraintProperties={measureType:e,orientation:a};}}t$1(t)&&r$3(e)&&(e.computation.preConstraintProperties=null);}),U$2)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return [l$3((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:e,activeComputation:i})=>{const a=this._constraintSnappingIndicator;if(this.removeHandles(t),t$1(i))a.attached=!1;else if(i===e)a.attached=!0;else {const{start:e,end:n}=this._computationManipulators.get(i),s=()=>{a.attached=e.grabbing||n.grabbing;};s(),this.addHandles([e.events.on("grab-changed",s),n.events.on("grab-changed",s)],t);}})),l$3((()=>{const t=this._activeComputation;return r$3(t)?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(({geometry:t,constraint:e})=>{const i=this._constraintSnappingIndicator;r$3(t)&&r$3(e)&&e!==u.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1;}))]}removeStaged(){return !!r$3(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState();}onClick(t){const{_stagedDimension:e}=this;if(t$1(e)){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove({mapPoint:t,pointerType:e}){if("touch"===e)return;const i=this._snappingContext(e);this.updatingHandles.addPromise(g$5(this._snappingOperation.snap({point:t},this._snappingManager,i)));}onManipulatorSelectionChanged(){if(r$3(this.analysisViewData.selectedComputation)){this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null);}}_onUnstagedClick({mapPoint:t,pointerType:e}){let n=t;if("mouse"===e){const i=this._snappingContext(e);n=this._snappingManager.update({point:t,context:i});}const s=new u$5({startPoint:k$1(n,new w$4),endPoint:null,measureType:t$2.Horizontal});return this._stagedDimension=s,this._resetSnappingState(),s}_onStagedClick({mapPoint:t,pointerType:e}){const i=this._stagedComputation;if(t$1(i))return;let a=t;if("mouse"===e){const i=this._snappingContext(e);a=this._snappingManager.update({point:t,context:i});}const n=k$1(a,new w$4);this._applyPointUpdate(i,{endPoint:n}),this._stagedDimension=null,this._resetSnappingState();}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null;}_addComputation(t){if(this._computationManipulators.has(t))return;const e=this._setupPointManipulator(t,{isStart:!0}),a=this._setupPointManipulator(t,{isStart:!1}),n=this._setupOffsetManipulator(t),s=this._setupHeadingManipulator(t),o=this._setupRotationManipulator(t),r=this._setupMeasureTypeManipulator(t,t$2.Direct),p=this._setupMeasureTypeManipulator(t,t$2.Horizontal),l=this._setupMeasureTypeManipulator(t,t$2.Vertical),d=new ie({start:e,end:a,offset:n,heading:s,rotation:o,direct:r,horizontal:p,vertical:l});this._setupComputationToManipulatorsSync(t,d),this._computationManipulators.set(t,d),this.manipulators.addMany(d.values());}_removeComputation(t){const e=this._computationManipulators.get(t);if(!t$1(e)){this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of e.values())this.manipulators.remove(t);}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([l$3((()=>t.geometry),(()=>this._updateManipulators(t,e)),{...w$2,equals:w$5})],t);}_setupPointManipulator(t,e){const{view:i}=this,{dimension:a}=t,n=ae(i,{metadata:a}),s=ue(n,{isStart:e.isStart,createSnappingPipelineStep:(t,e)=>this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(e),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles,cancel:t}),dimension:a,onUpdate:e=>{this._applyPointUpdate(t,e);},snappingPipeline:this._snappingPipeline,view:i});return this._computationHandles.add(s,t),n}_setupOffsetManipulator(t){const{view:e}=this,i=se(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),a=pe(i,{computation:t,view:e});return this._computationHandles.add(a,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=me(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),a=fe(i,{computation:t,view:e});return this._computationHandles.add(a,t),i}_setupRotationManipulator(t){const{view:e}=this,i=me(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),a=ge(i,{computation:t,view:e});return this._computationHandles.add(a,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,a=le(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),n=Se(a,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(n,t),a}_updateManipulators(t,e,a={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:o}=a,{start:l,end:d,offset:u,heading:c,rotation:m}=e,h=s===t,g=te(t),{dimension:f$1}=t;for(const i of e.values()){const t=g&&t$1(n)&&(t$1(o)||i===o);i===u?(i.available=t,i.selected=h):i.available=t&&h;}if(!g)return;r$3(f(t,this.view))?e.forEachMeasureTypeManipulator((t=>t.available=!1)):e.manipulatorForMeasureType(f$1.measureType).available=!1;for(const r of [c,m])f$1.measureType===t$2.Direct&&0!==f$1.offset||(r.available=!1);Z(t)?m.available=!1:c.available=!1;const{geometry:_}=t;l.renderLocation=_.directSegment.startRenderSpace,d.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:M}=this.view;je(u,_,M),c.available&&Pe(c,t,M),m.available&&He(m,t,M),e.forEachMeasureTypeManipulator(((e,i)=>{e.available&&Ce(e,t,i,M);}));}_updateManipulatorStyle(t){const e=Fe(t),i=Re(t),a={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:n,heading:s,rotation:o}of this._computationManipulators.values())n.radius=i/2,de(s,a),de(o,a);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i});}_snappingContext(t){return new e$4({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new V$1(new g$6("point",w$6(!0,!1,this.view.spatialReference))),visualizer:new _$5})}_applyPointUpdate(t,e){const{view:i}=this,a=z$1(t);"startPoint"in e&&(a.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(a.elevationAlignedEndPoint=e.endPoint);const n=k(a,i.renderCoordsHelper);if(t$1(n))return;const s=f({...a,geometry:n},i);g$1(t,e,{...a,constraint:s,unconstrainedGeometry:n,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t);}_updateStagedDimensionOffset(t){if(t$1(t.geometry))return;t.geometry.directSegment.eval(.5,dt);const e=this.view.state.camera.computeRenderPixelSizeAt(dt);t.dimension.offset=u$1.initialOffsetPx*e;}get testInfo(){const t=t=>this.analysisViewData.computations.find((e=>e.dimension===t));return {getManipulatorsForDimension:e=>this._computationManipulators.get(t(e)),getComputationForDimension:e=>t(e),getConstraintForDimension:e=>{const i=t(e);return r$3(i)?f(i,this.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function lt(){const{color:t,opacity:i}=u$1.offsetManipulator;return new H({color:[...l$4.toUnitRGB(t),i],width:1,renderOccluded:o$2.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}e$2([y$2({constructOnly:!0})],pt.prototype,"analysis",void 0),e$2([y$2({constructOnly:!0})],pt.prototype,"analysisViewData",void 0),e$2([y$2({constructOnly:!0})],pt.prototype,"manipulators",void 0),e$2([y$2({constructOnly:!0})],pt.prototype,"parentTool",void 0),e$2([y$2({constructOnly:!0,nonNullable:!0})],pt.prototype,"view",void 0),e$2([y$2({readOnly:!0})],pt.prototype,"updating",null),e$2([y$2()],pt.prototype,"firstGrabbedManipulator",null),e$2([y$2()],pt.prototype,"hasGrabbedManipulators",null),e$2([y$2()],pt.prototype,"_stagedDimension",void 0),e$2([y$2()],pt.prototype,"_activeComputation",null),e$2([y$2()],pt.prototype,"_stagedComputation",null),pt=e$2([n$3("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],pt);const dt=n$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var b$1;!function(e){e.Ready="ready",e.Creating="creating",e.Created="created";}(b$1||(b$1={}));let M=class extends a$3{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=u$1.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null;}initialize(){this._intersector=x$1(this.view.state.viewingMode),this._intersector.options.store=t$6.MIN,this._lengthDimensionSubTool=new pt({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([t$7(this._lengthDimensionSubTool),n$5((()=>this._clearPointerMoveTimeout())),l$3((()=>this.state),(e=>{e===b$1.Created&&this.finishToolCreation();}),w$2),f$2((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata;}),w$2),l$3((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),w$2)]);}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?r$3(this._activeSubTool)?b$1.Creating:b$1.Created:b$1.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e;}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(e$5.cancel===e.key){if(r$3(this._activeSubTool)&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null);}else e$5.delete.includes(e.key)&&this._deleteKeyHandler();}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool;}onDeactivate(){r$3(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null);}onShow(){this._resetPointerMoveTimeout();}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged();}onHide(){this.selectedDimension=null;}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(t$1(this._activeSubTool))return;const t=this._intersectScreen(e);t$1(t)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation());}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation());}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),t$1(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);t$1(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType});}_deleteKeyHandler(){r$3(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected();}_intersectScreen(e){const t=c$5(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,o=c$3.get();return i.getIntersectionPoint(o)?this.view.renderCoordsHelper.fromRenderCoords(o,this.view.spatialReference):null}_removeSelected(){r$3(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null);}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=h$3(this._prevPointerMoveTimeout);}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>{e.manipulator.state|=Ee;})),this._prevPointerMoveTimeout=t$8.setTimeout((()=>{this.manipulators.forEach((e=>{e.manipulator.state&=~Ee;}));}),this._pointerMoveTimerMs);}get testInfo(){return {...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout();}}}};e$2([y$2({constructOnly:!0})],M.prototype,"view",void 0),e$2([y$2({constructOnly:!0})],M.prototype,"analysis",void 0),e$2([y$2({readOnly:!0})],M.prototype,"state",null),e$2([y$2({readOnly:!0})],M.prototype,"updating",null),e$2([y$2({readOnly:!0})],M.prototype,"cursor",null),e$2([y$2({constructOnly:!0})],M.prototype,"analysisViewData",void 0),e$2([y$2()],M.prototype,"selectedDimension",null),e$2([y$2()],M.prototype,"automaticManipulatorSelection",void 0),e$2([y$2()],M.prototype,"_activeSubTool",void 0),e$2([y$2()],M.prototype,"_lengthDimensionSubTool",void 0),M=e$2([n$3("esri.views.3d.analysis.Dimension.DimensionTool")],M);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class c$1 extends n$6{constructor(t,r){super(t),this._hasExternalMaterial=!1,this._renderOccluded=o$2.OccludeAndTransparent,this._width=1,this._color=r$9(1,0,1,1),this._placement="end",this._textureId=null,this._material=r,this._hasExternalMaterial=r$3(r),this.applyProps(t);}setGeometryFromSegment(e,t){const a=e.endRenderSpace;this.transform=x$2(d,a),this._normal=t;const{points:s}=e.createRenderGeometry(a,this.view.renderCoordsHelper);this.geometry=[s];}get renderOccluded(){return r$3(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,r$3(this._material)&&this._material.setParameters({renderOccluded:t});}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry();}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry();}get width(){return r$3(this._material)?this._material.parameters.width:this._width}set width(t){this._width=t,r$3(this._material)&&this._material.setParameters({width:t});}get color(){return r$3(this._material)?this._material.parameters.color:this._color}set color(t){this._color=t$9(t),r$3(this._material)&&this._material.setParameters({color:this._color});}get placement(){return r$3(this._material)?this._material.parameters.placement:this._placement}set placement(t){this._placement=t,r$3(this._material)&&this._material.setParameters({placement:this._placement});}get textureId(){return r$3(this._material)?this._material.parameters.textureId:this._textureId}set textureId(t){this._textureId=t,r$3(this._material)&&this._material.setParameters({textureId:t});}createExternalResources(){this._hasExternalMaterial||(this._material=new v$4({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}));}destroyExternalResources(){this._hasExternalMaterial||(this._material=null);}createGeometries(e){for(const r of w$7(this.geometry,this.normal)){const a=m$3(r);e.addGeometry(a,e$6(this._material));}}forEachExternalMaterial(e){this._hasExternalMaterial||e(e$6(this._material));}}const d=e$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class b{constructor(i){this.destroyed=!1,this._handles=new t$3,this._messages=null,this._labelSegment=new l$2;const{analysis:n,computation:l,view:r,messages:f}=i;this.analysis=n,this.computation=l,this.view=r,this._messages=f;const d=i.visible,c={view:r,attached:d},{fontSize:h,textColor:u,textBackgroundColor:b}=n.style;this._visualElements=new L({marker:new c$1(c,i.markerMaterial),dimension:new c$4(c,i.dimensionLineMaterial),startOffset:new c$4(c,i.offsetLineMaterial),endOffset:new c$4(c,i.offsetLineMaterial),dimensionSmall:new c$4(c,i.smallDimensionLineMaterial),startOffsetSmall:new c$4(c,i.smallOffsetLineMaterial),endOffsetSmall:new c$4(c,i.smallOffsetLineMaterial),label:new g$7({view:r,attached:d,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:u$3(h),textColor:u.clone(),backgroundColor:b.clone()})}),this._handles.add([l$3((()=>l.geometry),(e=>{this.updateCameraDependentElements(r.state.camera,e,n.style),r$3(l.geometry)&&this._updateLines(l.geometry);}),{...h$1,equals:w$5}),l$3((()=>l.length),(e=>this._updateLabelContent(e)),h$1)]);}set visible(e){for(const t of this._visualElements.values())t.attached=e;}destroy(){this.destroyed=!0,this._handles=s$2(this._handles);for(const e of this._visualElements.values())e.destroy();}get testInfo(){return {dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=U(_,b$2.Start,e.directSegment,e.dimensionSegment),s=U(y,b$2.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(s),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(s);}updateCameraDependentElements(e,t,s){const i=this._visualElements;if(t$1(t)){for(const e of i.values())e.visible=!1;return}const l=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,E)),a=X(t,l),m=a<(u$3(s.lineSize)*u$1.smallScreenLengthLineSizeFactor)**2,r=!m;i.marker.visible=r,i.dimension.visible=r,i.startOffset.visible=r,i.endOffset.visible=r,i.dimensionSmall.visible=m,i.startOffsetSmall.visible=m,i.endOffsetSmall.visible=m;const f=u$3(s.fontSize)*u$1.labels.minScreenLengthFontSizeFactor,{label:d}=i;if(a<f**2)return void(d.visible=!1);d.visible=!0;const{dimensionSegment:S,primaryOffsetAxis:g}=t,{offset:v}=this.computation.dimension,p=(Math.sign(v)>=0?1:-1)*O(s)*l;M$1(this._labelSegment,S,g,p),d.updateLabelPosition();}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=u$3(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor;}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t);}_updateLabelContent(e){const{label:t}=this._visualElements;t$1(e)||t$1(this._messages)?t.text="":t.text=g$8(this._messages,e,e.unit);}}function O(e){return 1.5*u$3(e.fontSize)+u$1.labels.marginPx+u$3(e.lineSize/2)}const _=new l$2,y=new l$2,E=n$1();class L{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label;}values(){return [this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$1{constructor(e,t){this._textures=e,this._textureRepository=t,this._texturesByPrimitive=new Map;}acquire(r){if(!this._texturesByPrimitive.has(r)){const i=f$3(this._textures,r),s=new r$a(this._textureRepository,i.texture.id);return this._texturesByPrimitive.set(r,{result:i,reference:s}),i.texture}return this._texturesByPrimitive.get(r).result.texture}destroy(){this._texturesByPrimitive.forEach((({result:e,reference:t})=>{t.dispose(),e.release();})),this._texturesByPrimitive.clear();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let j=class extends m$1{constructor(e){super(e),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new v$4({width:1,anchor:s$6.Tip,color:l$5,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:o$2.OccludeAndTransparent}),this._dimensionLineMaterial=new H({width:1,color:l$5,renderOccluded:o$2.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new H({width:1,color:l$5,renderOccluded:o$2.OccludeAndTransparent,stipplePattern:r$8(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new H({width:1,color:l$5,renderOccluded:o$2.OccludeAndTransparent}),this._smallOffsetLineMaterial=new H({width:1,color:l$5,renderOccluded:o$2.OccludeAndTransparent,stipplePattern:r$8(5),stippleScaleWithLineWidth:!0});}get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}initialize(){const{textures:e}=this.view.sharedSymbolResources;if(r$3(e)){const{textureRepository:i}=this.view._stage.renderView,s=new r$1(e,i),a=s.acquire("triangle");this.addHandles(n$5((()=>s.destroy()))),this._markerMaterial.setParameters({textureId:a.id});}for(const i of this._lineMaterials())this.view._stage.add(i),this.addHandles(n$5((()=>{this.view._stage.remove(i),i.dispose();})));const{computations:s}=this.analysisViewData;for(const i of s)this._addComputation(i);this.addHandles([s.on("change",(({added:e,removed:i})=>{for(const s of i)this._removeComputation(s);for(const s of e)this._addComputation(s);})),l$3((()=>l$4.toUnitRGBA(this.analysis.style.color)),(e=>{for(const i of this._lineMaterials())i.setParameters({color:e});}),w$2),l$3((()=>this.analysis.style.lineSize),(e=>{const i=u$3(e);this._markerMaterial.setParameters({width:i*u$1.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:i,markerParameters:this._markerMaterial.parameters});const s=Math.max(i*u$1.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:s});}),w$2),l$3((()=>({camera:this.view.state.camera,style:z(this.analysis)})),(({camera:e,style:i})=>{for(const[s,t]of this._dimensionVisualizations)t.updateCameraDependentElements(e,s.geometry,i),t.updateLabelStyle(i);})),l$3((()=>this.visible),(e=>{for(const i of this._dimensionVisualizations.values())i.visible=e;}))]),this.addHandles([s$7((()=>this._updateMessageBundle())),f$2((()=>!this.loadingMessages),(()=>{for(const e of this._dimensionVisualizations.values())e.updateUnitsMessages(this._messages);}),U$2)]),this._updateMessageBundle();}destroy(){this._dimensionVisualizations.forEach((e=>{e.destroy();})),this._dimensionVisualizations.clear();}get testInfo(){return {visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:o$2.Occlude});}}}_addComputation(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new b({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}));}_removeComputation(e){const i=this._dimensionVisualizations.get(e);t$1(i)||(i.destroy(),this._dimensionVisualizations.delete(e));}_lineMaterials(){return [this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await u$6("esri/core/t9n/Units");}finally{this.loadingMessages=!1;}}};function z(e){const{fontSize:i,lineSize:s,textColor:t,textBackgroundColor:a}=e.style;return {fontSize:i,lineSize:s,textBackgroundColor:a.clone(),textColor:t.clone()}}e$2([y$2({constructOnly:!0})],j.prototype,"analysisViewData",void 0),e$2([y$2({constructOnly:!0,nonNullable:!0})],j.prototype,"view",void 0),e$2([y$2()],j.prototype,"analysis",null),e$2([y$2()],j.prototype,"visible",null),e$2([y$2()],j.prototype,"loadingMessages",void 0),j=e$2([n$3("esri.views.3d.analysis.Dimension.DimensionVisualization")],j);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let t=class extends m$1{constructor(s){super(s),this.dimension=null,this.length=null;}};e$2([y$2({constructOnly:!0,nonNullable:!0})],t.prototype,"dimension",void 0),e$2([y$2()],t.prototype,"length",void 0),t=e$2([n$3("esri.views.3d.analysis.LengthDimensionResult")],t);const c=t;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let l=class extends m$1{constructor(t){super(t),this.geometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null;}normalizeCtorArgs(t){const{dimension:o,...e}=t;return {result:new c({dimension:o}),...e}}initialize(){this.addHandles([l$3((()=>this.dimension.startPoint),(t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t)),w$2),l$3((()=>this.dimension.endPoint),(t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t)),w$2)]);}get dimension(){return this.result.dimension}get length(){return this.result.length}};e$2([y$2({constructOnly:!0,nonNullable:!0})],l.prototype,"result",void 0),e$2([y$2({constructOnly:!0,nonNullable:!0})],l.prototype,"projectAndAlignPoint",void 0),e$2([y$2()],l.prototype,"dimension",null),e$2([y$2()],l.prototype,"length",null),e$2([y$2()],l.prototype,"geometry",void 0),e$2([y$2()],l.prototype,"elevationAlignedStartPoint",void 0),e$2([y$2()],l.prototype,"elevationAlignedEndPoint",void 0),e$2([y$2()],l.prototype,"preConstraintProperties",void 0),e$2([y$2()],l.prototype,"previousConstraint",void 0),l=e$2([n$3("esri.views.3d.analysis.LengthDimensionComputation")],l);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const r=r=>{let i=class extends r{constructor(...o){super(...o),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null;}get results(){return new j$2}createLengthDimensions(o){throw new Error("Method not implemented.")}};return e$2([y$2({constructOnly:!0})],i.prototype,"view",void 0),e$2([y$2({constructOnly:!0,nonNullable:!0})],i.prototype,"analysis",void 0),e$2([y$2()],i.prototype,"tool",void 0),e$2([y$2({readOnly:!0})],i.prototype,"results",null),e$2([y$2()],i.prototype,"selectedDimension",void 0),e$2([y$2()],i.prototype,"interactive",void 0),e$2([y$2()],i.prototype,"visible",void 0),i=e$2([n$3("esri.views.analysis.DimensionAnalysisView")],i),i};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let g=class extends(r(n$7(m$1))){constructor(i){super(i),this.type="dimension-view-3d",this.tool=null,this.computations=new j$2,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null;}initialize(){this._projectAndAlignPoint=i=>{if(t$1(i))return null;const{spatialReference:s,elevationProvider:t}=this.view,n=n$8(i,s,t);return t$1(n)&&a$4(this.analysis,i.spatialReference,s$3.getLogger(this.declaredClass)),n},this.addHandles([s$8(this,M),a$5((()=>this.analysis.dimensions),"after-add",(i=>this._onDimensionAdd(i.item)),{onListenerAdd:i=>{for(const s of i)this._onDimensionAdd(s);},onListenerRemove:()=>{this._onDimensionsClear();}}),a$5((()=>this.analysis.dimensions),"after-remove",(i=>this._onDimensionRemove(i.item)))]),this._analysisVisualization=new j({analysisViewData:this,view:this.view}),this._analysisController=new g$2({analysisViewData:this,view:this.view});}destroy(){this._placementTask=p$5(this._placementTask),this._analysisVisualization=s$2(this._analysisVisualization),m$4(this);}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((i=>this._dimensionsToComputations.get(i).result))}get selectedComputation(){const{selectedDimension:i}=this;return t$1(i)?null:this._dimensionsToComputations.get(i)}get testInfo(){return {visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(i){return this.selectedDimension=null,this._placementTask=p$5(this._placementTask),this._placementTask=c$6(this,i),this._placementTask.promise}_onDimensionAdd(i){const{computations:s,_dimensionsToComputations:t}=this;if(t.has(i))return;const o=new l({dimension:i,projectAndAlignPoint:this._projectAndAlignPoint});s.add(o),t.set(i,o);}_onDimensionRemove(i){const{computations:s,_dimensionsToComputations:t}=this,o=s.findIndex((s=>s.dimension===i)),e=s.getItemAt(o);e.dimension===this.selectedDimension&&(this.selectedDimension=null),s.removeAt(o),t.delete(i),s$2(e);}_onDimensionsClear(){this.computations.drain((i=>i.destroy())),this._dimensionsToComputations.clear();}};e$2([y$2({readOnly:!0})],g.prototype,"type",void 0),e$2([y$2()],g.prototype,"tool",void 0),e$2([y$2()],g.prototype,"updating",null),e$2([y$2({readOnly:!0})],g.prototype,"results",null),e$2([y$2({readOnly:!0})],g.prototype,"computations",void 0),e$2([y$2()],g.prototype,"selectedDimension",void 0),e$2([y$2()],g.prototype,"selectedComputation",null),e$2([y$2()],g.prototype,"_analysisVisualization",void 0),e$2([y$2()],g.prototype,"_analysisController",void 0),e$2([y$2()],g.prototype,"_dimensionsToComputations",void 0),e$2([y$2()],g.prototype,"_placementTask",void 0),g=e$2([n$3("esri.views.3d.analysis.DimensionAnalysisView3D")],g);const w=g;

export { w as default };
