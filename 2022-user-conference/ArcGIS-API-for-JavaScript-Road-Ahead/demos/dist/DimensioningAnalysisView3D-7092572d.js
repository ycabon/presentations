import { f2 as r$1, t as t$3, r as r$2, aH as n$1, e6 as n$2, fF as c$3, hk as q, e7 as P$1, qM as J, ea as _$1, fn as G, hf as f$1, e9 as z, B as e$1, C as d$2, D as n$3, E as f$2, by as t$4, dX as l$3, b3 as l$4, b4 as h, bg as b, iG as s, iI as s$1, iJ as a$2, qN as l$5, w, ct as l$6, aF as u$2, eI as d$3, oQ as E$1, qO as b$1, qP as e$2, nt as h$1, fx as h$2, qQ as n$4, gB as t$5, j as j$1, oW as E$2, hA as l$7, qR as r$4, qS as p$3, qT as g$1, dW as n$5, qU as t$6, h5 as U, cv as o$1, ij as k, eK as g$2, er as w$1, qV as w$2, gw as T, gj as B$1, g7 as o$2, gI as t$7, e8 as e$3, fe as _$2, f9 as p$4, ff as W, g$ as s$2, gS as i$2, aL as o$3, gO as e$5, bl as r$5, j5 as x$1, j6 as t$8, qW as c$4, f4 as r$6, ep as m$1, ga as r$7, g2 as a$4 } from './_virtual_index-9b831d4a.js';
import { n as n$6 } from './AnalysisView3D-e549779b.js';
import { l as l$2, v as v$2 } from './Segment-b8cea6ae.js';
import { y as y$1, i as ie, k as k$1 } from './manipulatorUtils-66df729c.js';
import { g as g$4 } from './SnappingVisualizer3D-fe472306.js';
import { B, C, z as z$1 } from './dragEventPipeline3D-94a21c94.js';
import { S as S$1, g as g$3, R as R$1 } from './EditGeometryOperations-7433228d.js';
import { y as y$2, w as w$3 } from './dragEventPipeline-b56dbe77.js';
import { r as r$3 } from './VertexSnappingCandidate-6547b1c5.js';
import { e as e$4 } from './SnappingContext-43cb3fd4.js';
import { a as d$4, b as h$3, z as z$2 } from './SnappingOperation-11f9e419.js';
import { a as a$3, c as c$5, v as v$4, b as a$5 } from './analysisViewUtils-f1f7fbe7.js';
import { v as v$3 } from './quantityUtils-95a87361.js';
import { C as C$1 } from './LineVisualElement-53a30f81.js';
import './TextOverlayItem-a5459168.js';
import './PointVisualElement-b8280c3d.js';
import './RightAngleQuadVisualElement-05916d4c.js';
import './drawUtils-4f83a157.js';
import './PointSnappingHint-f4370fcd.js';
import './measurementUtils-77091aae.js';
import './dehydratedFeatureComparison-dbb61b6e.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function u$1({startPoint:n,endPoint:r,offset:s,axis:a},o,c=null){if(t$3(n)||t$3(r))return null;const i=x(r$2(c)?c.directSegment:new l$2,{startPoint:n,endPoint:r},o),S=v$1(r$2(c)?c.offsetAxis:n$1(),{axis:a,directSegment:i},o);return {directSegment:i,dimensionSegment:A(r$2(c)?c.dimensionSegment:new l$2,{offsetAxis:S,offset:s,directSegment:i},o),offsetAxis:S}}function R(e,t,r){const{directSegment:s,dimensionSegment:a}=r;return t===g.Start?(r$1(e.startRenderSpace,s.startRenderSpace),r$1(e.endRenderSpace,a.startRenderSpace)):(r$1(e.startRenderSpace,s.endRenderSpace),r$1(e.endRenderSpace,a.endRenderSpace)),e}var g;function l$1(e,t,n,s){q(e.startRenderSpace,t.startRenderSpace,n,s),q(e.endRenderSpace,t.endRenderSpace,n,s);}function x(e,t,n){return n.toRenderCoords(t.startPoint,e.startRenderSpace),n.toRenderCoords(t.endPoint,e.endRenderSpace),e}function v$1(e,t,n){const{axis:r,directSegment:{startRenderSpace:s,endRenderSpace:a},directSegment:o}=t,c=o.eval(.5,c$3.get());return P(e,s,a,n.worldUpAtPosition(c,c$3.get()),r,n.worldBasisAtPosition(c,n$2.X,c$3.get()))}function P(e,t,r,d,p,f){switch(p){case"horizontal":return r$1(e,d);case"vertical":return P$1(t,d)<P$1(r,d)?J(e,r,t):J(e,t,r),_$1(e,e,d),G(e,f$1)?r$1(e,f):(_$1(e,e,d),z(e,e),e);case"direct":return P$1(t,f)>P$1(r,f)?J(e,r,t):J(e,t,r),_$1(e,e,d),G(e,f$1)?r$1(e,f):(z(e,e),e)}}function A(e,t,n){const{offsetAxis:s,offset:a,directSegment:{startRenderSpace:o,endRenderSpace:c},directSegment:i}=t,d=a/n.unitInMeters,[S,p]=j(o,c,s,d);return q(e.startRenderSpace,i.startRenderSpace,s,S),q(e.endRenderSpace,i.endRenderSpace,s,p),e}function j(e,t,n,r=0){const a=P$1(t,n),o=P$1(e,n),c=Math.abs(a-o)+r;return a>o?[c,r]:[r,c]}!function(e){e[e.Start=0]="Start",e[e.End=1]="End";}(g||(g={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let d$1=class extends f$2{constructor(o){super(o),this._handles=new t$4;}initialize(){const{computations:o}=this.analysisViewData;for(const s of o)this._addComputation(s);this.addHandles(o.on("change",(({added:o,removed:s})=>{for(const t of s)this._removeComputation(t);for(const t of o)this._addComputation(t);})));}destroy(){this._handles=l$3(this._handles);}_addComputation(o){this._handles.has(o)||this._handles.add(l$4((()=>{const{startPoint:s,endPoint:t,offset:e,axis:r,heading:i}=o.dimension;return {startPoint:s,endPoint:t,offset:e,axis:r,heading:i}}),(s=>{o.geometry=u$1(s,this.view.renderCoordsHelper,o.geometry);}),h),o);}_removeComputation(o){this._handles.remove(o);}};e$1([d$2({constructOnly:!0})],d$1.prototype,"analysisViewData",void 0),e$1([d$2({constructOnly:!0})],d$1.prototype,"view",void 0),d$1=e$1([n$3("esri.views.3d.analysis.Dimensioning.support.DimensioningController")],d$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const t$2=["horizontal","vertical","direct"];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let y=class extends l$5{constructor(t){super(t),this.type="length",this.startPoint=null,this.endPoint=null,this.axis="horizontal",this.offset=0,this.heading=0;}get extent(){if(t$3(this.startPoint))return null;const t=w.fromPoint(this.startPoint);return r$2(this.endPoint)&&t.union(w.fromPoint(this.endPoint)),t}};e$1([d$2({type:["length"]})],y.prototype,"type",void 0),e$1([d$2({type:b})],y.prototype,"startPoint",void 0),e$1([d$2({type:b})],y.prototype,"endPoint",void 0),e$1([d$2({type:t$2,nonNullable:!0})],y.prototype,"axis",void 0),e$1([d$2({type:Number,nonNullable:!0})],y.prototype,"offset",void 0),e$1([d$2({type:Number,nonNullable:!0}),s((t=>s$1.normalize(a$2(t),0,!0)))],y.prototype,"heading",void 0),e$1([d$2({readOnly:!0})],y.prototype,"extent",null),y=e$1([n$3("esri.analysis.LengthDimension")],y);const u=y;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const i$1={main:new l$6([255,127,0])};class o{constructor(){this.color=i$1.main,this.opacity=.5,this.radius=5;}}class r{constructor(){this.color=i$1.main,this.opacity=.5,this.displayWidth=4,this.displayFocusMultiplier=2,this.lengthFraction=.9,this.collisionRadius=4;}}class n{constructor(){this.fontSize=14;}get height(){return 1.5*u$2(this.fontSize)}get offset(){return this.height+20}}class c$2{constructor(){this.pointManipulators=new o,this.offsetManipulator=new r,this.labels=new n;}}const e=new c$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let p$2=class extends d$3{constructor(e){super(e),this.availability=0,this._ids=new Set,this.tmpP=n$1();}destroy(){this.workerHandle.destroy(),this.workerHandle=null;}initialize(){this.workerHandle=new l(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)});}async fetchCandidates(e,t){const r=e.coordinateHelper.toXYZ(e.point);this.view.renderCoordsHelper.toRenderCoords(r,e.coordinateHelper.spatialReference,r);const o="number"==typeof e.distance?e.distance:e.distance.pixelSize,s=await this.workerHandle.invoke({bounds:E$1(r[0],r[1],r[2],o),types:e.types},t),i=e.coordinateHelper;return s.candidates.sort(((e,t)=>e.distance-t.distance)),s.candidates.map((e=>this._convertCandidate(i,e)))}async add(e,t){this._ids.add(e.id),await this.workerHandle.invokeMethod("add",e,t);}async remove(e,t){this._ids.delete(e.id),await this.workerHandle.invokeMethod("remove",e,t);}_convertCandidate(e,t){switch(t.type){case"edge":return new e$2({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),elevationInfo:b$1});case"vertex":return new r$3({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),elevationInfo:b$1})}}_convertRenderCoordinate(e,t){return this.view.renderCoordsHelper.fromRenderCoords(t,this.tmpP,e.spatialReference),e.fromXYZ(this.tmpP)}async _fetchAllEdgeLocations(e,t){const r=[],o=[];for(const{id:s,uid:i}of e.components)this._ids.has(s)&&r.push((async()=>{const e=await this.fetchEdgeLocations(s,t.signal);return o.push(e.locations.buffer),{id:s,uid:i,objectIds:e.objectIds,locations:e.locations.buffer,origin:e.origin,type:e.type}})());return {result:{components:(await Promise.all(r)).filter((({id:e})=>this._ids.has(e)))},transferList:o}}};e$1([d$2({constructOnly:!0})],p$2.prototype,"view",void 0),e$1([d$2({constructOnly:!0})],p$2.prototype,"fetchEdgeLocations",void 0),e$1([d$2({constructOnly:!0})],p$2.prototype,"schedule",void 0),e$1([d$2({readOnly:!0})],p$2.prototype,"availability",void 0),p$2=e$1([n$3("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],p$2);class l extends h$1{constructor(e,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t});}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let c$1=class extends d$3{constructor(e){super(e),this.availability=1,this._abortController=new AbortController;}get updating(){return this.updatingHandles.updating}get _layer(){return this.layerSource.layer}destroy(){this._abortController=h$2(this._abortController);}initialize(){const e=this.view.resourceController;this._edgeWorker=new n$4((r=>e.schedule(r))),this._workerHandle=new p$2({view:this.view,schedule:r=>e.schedule(r),fetchEdgeLocations:async(e,r)=>{if(t$3(this._tracker))throw new Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(e,this._edgeWorker,r)}}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([t$5(this._workerHandle),t$5(this._edgeWorker)]);}async fetchCandidates(e,r){return this._workerHandle.fetchCandidates(e,r)}refresh(){}async _setupLayerView(){const e=await this.view.whenLayerView(this._layer);if("scene-layer-graphics-3d"===e.type)return;const r={add:(e,r)=>this.updatingHandles.addPromise(this._workerHandle.add({id:e,bounds:r},this._abortController.signal)),remove:e=>this.updatingHandles.addPromise(this._workerHandle.remove({id:e},this._abortController.signal))};this._tracker=e.trackSnappingSources(r),this.handles.add(this._tracker);}};e$1([d$2({constructOnly:!0})],c$1.prototype,"layerSource",void 0),e$1([d$2({constructOnly:!0})],c$1.prototype,"view",void 0),e$1([d$2({readOnly:!0})],c$1.prototype,"updating",null),e$1([d$2({readOnly:!0})],c$1.prototype,"availability",void 0),c$1=e$1([n$3("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],c$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let m=class extends f$2{constructor(e){super(e),this.options=null,this._snappingSources=new j$1;}initialize(){this.addHandles([this.view.on("layerview-create",(({layerView:e})=>this._createSource(e))),this.view.on("layerview-destroy",(({layerView:e})=>this._removeSource(e)))]);for(const e of this.view.allLayerViews.items)this._createSource(e);}destroy(){this.options=null,this._snappingSources.drain((e=>e.destroy()));}get updating(){return this._snappingSources.some((e=>e.updating))}get _types(){return E$2.EDGE|E$2.VERTEX}async fetchCandidates(e,r,t){const{view:s,options:i}=this,{coordinateHelper:n,elevationInfo:a}=r,u=r$2(i)?i.distance:1,m=l$7(e,n,a,s,c$3.get()),y=u*s.state.camera.computeScreenPixelSizeAt(m),d=this._types,S=this._snappingSources.items.map((r=>r.fetchCandidates({point:e,coordinateHelper:n,distance:y,types:d},t))),h=(await Promise.all(S)).flat();return r$4(e,h),h}_createSource(e){if("scene-layer-3d"!==e.type)return;const r=new c$1({layerSource:new p$3({layer:e.layer}),view:this.view});this._snappingSources.push(r);}_removeSource(e){const r=this._snappingSources.findIndex((r=>r.layerSource.layer===e.layer));-1!==r&&this._snappingSources.removeAt(r).destroy();}};e$1([d$2({constructOnly:!0})],m.prototype,"view",void 0),e$1([d$2()],m.prototype,"updating",null),e$1([d$2()],m.prototype,"options",void 0),e$1([d$2()],m.prototype,"_snappingSources",void 0),m=e$1([n$3("esri.views.interactive.snapping.SceneSnappingEngine")],m);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const t$1=new Map;function a$1(e){t$1.has(e)||t$1.set(e,{referenceCount:0,snappingManager:p$1(e)});const r=t$1.get(e);r.referenceCount++;const o=n$5((()=>i(e,r)));return {snappingManager:r.snappingManager,...o}}function i(n,r){r.referenceCount--,r.referenceCount>0||t$6((()=>{0===r.referenceCount&&(r.snappingManager.destroy(),t$1.delete(n));}));}function p$1(n){return new g$1({view:n,snappingEnginesFactory:(e,o)=>[new m({view:n,options:o})]})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let Y=class extends d$3{constructor(t){super(t),this.stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new t$4,this._snappingPipeline=new d$4,this._snappingManagerResult=a$1(t.view),this.addHandles(this._snappingManagerResult);}initialize(){this._snappingOperation=new h$3({view:this.view}),this.addHandles([this._computationHandles,l$4((()=>this._snappingOperation.stagedPoint),(t=>{r$2(this.stagedDimension)&&(this.stagedDimension.endPoint=o$1(t,(t=>k(t,new b))));}),U)]);const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles(t.on("change",(({added:t,removed:e})=>{for(const n of e)this._removeComputation(n);for(const n of t)this._addComputation(n);})));}destroy(){this._snappingOperation=l$3(this._snappingOperation);}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get _snappingManager(){return this._snappingManagerResult.snappingManager}onDeactivate(){this._snappingManager.doneSnapping();}onUnstagedClick({mapPoint:t,pointerType:e}){const i=this._snappingContext(e),o=k(this._snappingManager.update(t,i),new b),s=new u({startPoint:o,endPoint:null});return this.stagedDimension=s,this._snappingManager.doneSnapping(),s}onStagedClick({mapPoint:t,pointerType:e}){if(t$3(this.stagedDimension))return;const n=this._snappingContext(e),i=k(this._snappingManager.update(t,n),new b);this.stagedDimension.endPoint=i,this.stagedDimension=null,this._snappingManager.doneSnapping();}onPointerMove({mapPoint:t,pointerType:e}){const n=this._snappingContext(e);this.updatingHandles.addPromise(g$2(this._snappingOperation.snap(t,this._snappingManager,n)));}_addComputation(t){if(this._computationManipulators.has(t))return;const e=this._createPointManipulator(t,{isStart:!0}),n=this._createPointManipulator(t,{isStart:!1}),i=this._createOffsetManipulator(t),o=new $({start:e,end:n,offset:i});this._setupComputationToManipulatorsSync(t,o),this._computationManipulators.set(t,o),this.manipulators.addMany(o.toArray());}_removeComputation(t){const e=this._computationManipulators.get(t);if(!t$3(e)){this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of e.toArray())this.manipulators.remove(t);}}_setupComputationToManipulatorsSync(t,e){const{dimension:n}=t;this._computationHandles.add([l$4((()=>({startPoint:n.startPoint,endPoint:n.endPoint,stagedDimension:this.stagedDimension})),(({startPoint:t,endPoint:i,stagedDimension:o})=>{const{start:s,end:r}=e;r$2(t)?(s.available=t$3(o)||o===n,s.location=t):s.available=!1,r$2(i)?(r.available=t$3(o),r.location=i):r.available=!1;}),w$1),l$4((()=>t.geometry),(t=>{const{offset:n}=e,i=r$2(t);n.available=i,i&&tt(n,t);}),{...w$1,equals:w$2})],t);}_createPointManipulator(t,n){const{dimension:i}=t,{isStart:o}=n,s=o?"startPoint":"endPoint",a=y$1(this.view,l$6.toUnitRGB(e.pointManipulators.color),e.pointManipulators.opacity);a.available=!1,a.radius=e.pointManipulators.radius;const r=y$2(a,((t,e,n,o)=>{const a=z$1(t);e.next(a).next(B(this.view)).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(o),snappingManager:this._snappingManager,cancel:n,updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((t=>{const e=k(t.mapEnd,new b);i[s]=e;})),n.next(a).next(w$3(i,[s]));}));return this._computationHandles.add(r,t),a}_createOffsetManipulator(t){const{color:n,opacity:i,displayWidth:o,displayFocusMultiplier:s,collisionRadius:a}=e.offsetManipulator,r=[r$5(-.5,0,0),r$5(.5,0,0)],p=T.createPolylineGeometry(r),l=t=>new B$1({color:[...l$6.toUnitRGB(n),i],width:t,renderOccluded:o$2.OccludeAndTransparent,writeDepth:!1}),d=new ie({view:this.view,renderObjects:[{geometry:p,material:l(o),stateMask:t$7.Unfocused},{geometry:p,material:l(s*o),stateMask:t$7.Focused}],collisionType:{type:"line",paths:[r]},radius:a,focusMultiplier:1,available:!1,autoScaleRenderObjects:!1,worldSized:!0}),c=y$2(d,((e,n,i)=>{if(t$3(t.geometry))return;const{dimensionSegment:o,offsetAxis:s}=t.geometry,a=e$3(c$3.get(),o.endRenderSpace,o.startRenderSpace);_$1(a,a,s);const r=_$2(o.startRenderSpace,a,p$4()),p=_$2(o.startRenderSpace,s,p$4()),{dimension:l}=t,d=l.offset;let c=0;const u=z$1(e);n.next(u).next(C(this.view,r)).next((t=>{"start"===t.action&&(c=W(p,t.renderStart));const e=(W(p,t.renderEnd)-c)*this.view.renderCoordsHelper.unitInMeters;l.offset=d+e;})),i.next(u).next(w$3(l,["offset"]));}));return this._computationHandles.add(c,t),d}_snappingContext(t){return new e$4({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new S$1(new g$3("point",R$1(!0,!1,this.view.spatialReference))),visualizer:new g$4})}get testInfo(){return {getManipulatorsForDimension:t=>{for(const[e,n]of this._computationManipulators.entries())if(t===e.dimension)return n;return null}}}};e$1([d$2({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),e$1([d$2({constructOnly:!0})],Y.prototype,"manipulators",void 0),e$1([d$2({constructOnly:!0,nonNullable:!0})],Y.prototype,"view",void 0),e$1([d$2({readOnly:!0})],Y.prototype,"updating",null),e$1([d$2()],Y.prototype,"stagedDimension",void 0),Y=e$1([n$3("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],Y);class ${constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset;}toArray(){return [this.start,this.end,this.offset]}}function tt(t,e$1){const{dimensionSegment:n,offsetAxis:i}=e$1,o=e$3(et,n.endRenderSpace,n.startRenderSpace),s=k$1(o,i,f$1,nt),a=s$2(o),r=e.offsetManipulator.lengthFraction*a;i$2(s,s,o$3(et,r,r,r)),t.modelTransform=s,t.renderLocation=n.eval(.5,et);}const et=n$1(),nt=e$5();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var d;!function(e){e.Ready="ready",e.Creating="creating",e.Created="created";}(d||(d={}));let v=class extends a$3{constructor(e){super(e),this.analysisViewData=null;}initialize(){this._intersector=x$1(this.view.state.viewingMode),this._intersector.options.store=t$8.MIN,this._lengthDimensionSubTool=new Y({analysisViewData:this.analysisViewData,manipulators:this.manipulators,view:this.view}),this.addHandles(t$5(this._lengthDimensionSubTool)),this.addHandles(l$4((()=>this.state),(e=>{e===d.Created&&this.finishToolCreation();}),w$1));}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?r$2(this._activeSubTool)?d.Creating:d.Created:d.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool;}onDeactivate(){r$2(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),r$2(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null);}_clickHandler(e){if(t$3(this._activeSubTool))return;const t=this._intersectScreen(e);if(!t$3(t)){if(t$3(this._activeSubTool.stagedDimension)){const i=this._activeSubTool.onUnstagedClick({mapPoint:t,pointerType:e.pointerType});this.analysis.dimensions.add(i);}else this._activeSubTool.onStagedClick({mapPoint:t,pointerType:e.pointerType});e.stopPropagation();}}_doubleClickHandler(e){this.view.activeTool=null,e.stopPropagation();}_pointerMoveHandler(e){if(t$3(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);t$3(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType});}_intersectScreen(e){const t=c$4(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,o=c$3.get();return i.getIntersectionPoint(o)?this.view.renderCoordsHelper.fromRenderCoords(o,this.view.spatialReference):null}get testInfo(){return this._lengthDimensionSubTool.testInfo}};e$1([d$2({constructOnly:!0})],v.prototype,"view",void 0),e$1([d$2({constructOnly:!0})],v.prototype,"analysis",void 0),e$1([d$2({readOnly:!0})],v.prototype,"state",null),e$1([d$2({readOnly:!0})],v.prototype,"updating",null),e$1([d$2({readOnly:!0})],v.prototype,"cursor",null),e$1([d$2({constructOnly:!0})],v.prototype,"analysisViewData",void 0),e$1([d$2()],v.prototype,"_activeSubTool",void 0),e$1([d$2()],v.prototype,"_lengthDimensionSubTool",void 0),v=e$1([n$3("esri.views.3d.analysis.Dimensioning.DimensioningTool")],v);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let E=class extends f$2{constructor(e$1){super(e$1),this._labelSegment=new l$2;const t={view:e$1.view,attached:!0,width:1,color:r$6(1,.5,0,1),renderOccluded:o$2.OccludeAndTransparent},i={...t,stipplePattern:r$7(5)};this._dimensionVisualElement=new C$1(t),this._startOffsetVisualElement=new C$1(i),this._endOffsetVisualElement=new C$1(i),this._label=new v$2({view:e$1.view,attached:!0,distance:0,fontSize:e.labels.fontSize});}initialize(){const{computation:e,view:t}=this;this.addHandles([t$5(this._dimensionVisualElement),t$5(this._startOffsetVisualElement),t$5(this._endOffsetVisualElement),t$5(this._label),l$4((()=>({geometry:e.geometry})),(({geometry:e})=>{this._updateLines(e);}),h),l$4((()=>({length:e.length,geometry:e.geometry})),(({length:e,geometry:t})=>this._updateLabelContent(e,t)),h),l$4((()=>({camera:t.state.camera,geometry:e.geometry})),(({camera:e,geometry:t})=>this._updateLabelGeometry(e,t)),h)]);}get testInfo(){return {dimensionVisualElement:this._dimensionVisualElement,label:this._label}}_updateLines(e){const t=r$2(e);this._dimensionVisualElement.visible=t,this._startOffsetVisualElement.visible=t,this._endOffsetVisualElement.visible=t,t&&(this._dimensionVisualElement.setGeometryFromSegment(e.dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(R(S,g.Start,e)),this._endOffsetVisualElement.setGeometryFromSegment(R(S,g.End,e)));}_updateLabelContent(e,t){if(t$3(e)||t$3(t))return this._label.text="",void(this._label.visible=!1);const{value:i}=v$3(e,"meters");this._label.text=`${m$1(i,{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this._label.visible=!0;}_updateLabelGeometry(e$1,t){if(t$3(t))return void(this._label.visible=!1);const{dimensionSegment:i,offsetAxis:o}=t,{offset:n}=this.computation.dimension,r=e$1.computeRenderPixelSizeAt(i.eval(.5,c$3.get())),l=(Math.sign(n)>=0?1:-1)*e.labels.offset*r;l$1(this._labelSegment,i,o,l),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1};}};e$1([d$2({constructOnly:!0,nonNullable:!0})],E.prototype,"computation",void 0),e$1([d$2({constructOnly:!0,nonNullable:!0})],E.prototype,"view",void 0),E=e$1([n$3("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],E);const S=new l$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let a=class extends f$2{constructor(i){super(i),this._dimensionVisualizations=new Map;}initialize(){const{computations:i}=this.analysisViewData;for(const o of i)this._addComputation(o);this.addHandles(i.on("change",(({added:i,removed:o})=>{for(const s of o)this._removeComputation(s);for(const s of i)this._addComputation(s);})));}destroy(){this._dimensionVisualizations.forEach((i=>{i.destroy();})),this._dimensionVisualizations.clear();}get testInfo(){return {visualizations:Array.from(this._dimensionVisualizations.values())}}_addComputation(i){this._dimensionVisualizations.has(i)||this._dimensionVisualizations.set(i,new E({computation:i,view:this.view}));}_removeComputation(i){const o=this._dimensionVisualizations.get(i);t$3(o)||(o.destroy(),this._dimensionVisualizations.delete(i));}};e$1([d$2({constructOnly:!0,nonNullable:!0})],a.prototype,"view",void 0),e$1([d$2({constructOnly:!0})],a.prototype,"analysisViewData",void 0),a=e$1([n$3("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],a);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let t=class extends f$2{constructor(s){super(s),this.dimension=null;}};e$1([d$2({constructOnly:!0,nonNullable:!0})],t.prototype,"dimension",void 0),t=e$1([n$3("esri.views.3d.analysis.LengthDimensionResult")],t);const c=t;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let p=class extends f$2{constructor(o){super(o),this.geometry=null;}initialize(){this._set("result",new c({dimension:this.dimension}));}get length(){const{startPoint:o,endPoint:t,axis:e}=this.dimension;if(t$3(o)||t$3(t))return null;const s=z$2(o,t);if(t$3(s))return null;return s[e]}};e$1([d$2({constructOnly:!0,nonNullable:!0})],p.prototype,"dimension",void 0),e$1([d$2({constructOnly:!0,nonNullable:!0})],p.prototype,"result",void 0),e$1([d$2()],p.prototype,"geometry",void 0),e$1([d$2()],p.prototype,"length",null),p=e$1([n$3("esri.views.3d.analysis.LengthDimensionComputation")],p);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let _=class extends(n$6(f$2)){constructor(s){super(s),this.type="dimensioning-view-3d",this.tool=null,this.computations=new j$1,this._dimensionsToResults=new Map,this._placementTask=null;}initialize(){this.addHandles([c$5(this,v),a$4((()=>this.analysis.dimensions),"change",(({added:s,removed:i})=>{for(const o of i)this._removeDimension(o);for(const o of s)this._addDimension(o);}),{onListenerAdd:s=>{for(const i of s)this._addDimension(i);},onListenerRemove:s=>{for(const i of s)this._removeDimension(i);}})]),this._analysisVisualization=new a({analysisViewData:this,view:this.view}),this._analysisController=new d$1({analysisViewData:this,view:this.view});}destroy(){this._placementTask=h$2(this._placementTask),this._analysisVisualization=l$3(this._analysisVisualization),this.computations.drain((s=>s.destroy())),v$4(this);}get results(){return this.analysis.dimensions.map((s=>this._dimensionsToResults.get(s)))}get testInfo(){return {visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(s){return this._placementTask=h$2(this._placementTask),this._placementTask=a$5(this,v,s),this._placementTask.promise}_addDimension(s){const{computations:i,_dimensionsToResults:o}=this;if(o.has(s))return;const t=new p({dimension:s});i.add(t),o.set(s,t.result);}_removeDimension(s){const{computations:i,_dimensionsToResults:o}=this,t=i.findIndex((i=>i.dimension===s)),n=i.removeAt(t);o.delete(s),l$3(n);}};e$1([d$2({readOnly:!0})],_.prototype,"type",void 0),e$1([d$2({constructOnly:!0,nonNullable:!0})],_.prototype,"analysis",void 0),e$1([d$2()],_.prototype,"tool",void 0),e$1([d$2({readOnly:!0})],_.prototype,"results",null),e$1([d$2({readOnly:!0})],_.prototype,"computations",void 0),e$1([d$2()],_.prototype,"_analysisVisualization",void 0),e$1([d$2()],_.prototype,"_analysisController",void 0),e$1([d$2()],_.prototype,"_dimensionsToResults",void 0),e$1([d$2()],_.prototype,"_placementTask",void 0),_=e$1([n$3("esri.views.3d.analysis.DimensioningAnalysisView3D")],_);const f=_;

export { f as default };
