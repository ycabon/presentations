import { cs as j$2, nO as j$3, nP as b$3, gt as w$2, nQ as u$5, nR as b$4, nS as o$1, nT as u$6, dd as y$2, dh as m$2, m4 as c$3, nU as r$2, nV as p$4, c6 as l$3, nW as i$2, nX as l$4, dZ as m$3, J as s$3, jE as S$1, B as e, C as d$2, D as n$3, E as f$3, be as t$1, j as j$4, fw as a$2, kk as t$2, Z as s$4, a5 as E$2, aP as l$5, i2 as j$5, al as e$1, nY as s$5, nZ as i$3, n_ as g$2, jV as Bt, h as L$4, kP as r$3, f as o$2, n$ as u$7, o0 as a$4, o1 as i$4, o2 as m$4, o3 as h$4, o4 as b$5, o5 as r$4, o6 as i$5, o7 as n$4, o8 as e$2, c2 as e$3, o9 as t$3, oa as S$2, ob as a$5, r as r$5, oc as K, od as r$6, N as x$1, aQ as h$5, oe as s$6, b2 as f$4, d_ as n$5, of as p$5, e0 as f$5, og as v$3, oh as M$1, oi as S$3, oj as j$6, ok as O, ol as T$2, om as E$3, on as N$2, oo as i$6, aw as u$8, jI as s$7, dW as e$4, op as t$4, dX as M$2, oq as n$6, or as l$6, os as C$2, ot as o$4, gC as s$8, df as l$7 } from './_virtual_index-fc1e0009.js';
import { a as a$3 } from './EffectView-1b384502.js';
import { c as c$4 } from './ExportImageParameters-9cb9ed8f.js';
import { o as o$3 } from './rendererConversion-430ada08.js';
import { getSymbolLayerFill as N$1 } from './previewSymbol3D-6bdd06bf.js';
import './floorFilterUtils-776aae8e.js';
import './sublayerUtils-cad23a30.js';
import './webStyleSymbolUtils-c95aa38c.js';
import './devEnvironmentUtils-0f97b5c2.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const l$2=(e,l)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return l?.levels?l.levels[a]:null};function a$1(a,i){if(!a||!("visualVariables"in a)||!a.visualVariables)return null;const s=a.visualVariables.find((e=>"size"===e.type)),n=l$2(i,s);return n?new j$2({field:s.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const s$2={HH:315,HL:45,LL:135,LH:225},l$1={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function n$2(t){if(!t)return;const{type:s}=t;if(s.includes("3d"))return N$1(t.symbolLayers.getItemAt(0));if("simple-line"===s){const o=j$3(t);return o&&o.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const o=j$3(t);return o&&o.color}return b$3(t)}function H(t,e){const o=e.HH.label,r=e.LL.label,s=e.HL.label,l=e.LH.label;switch(t){case"HH":default:return {top:o,bottom:r,left:s,right:l};case"HL":return {top:s,bottom:l,left:r,right:o};case"LL":return {top:r,bottom:o,left:l,right:s};case"LH":return {top:l,bottom:s,left:o,right:r}}}function i$1(t){const{focus:e,infos:o,numClasses:r}=t,s=l$1[r],L={};o.forEach((t=>{L[t.value]={label:t.label,fill:n$2(t.symbol)};}));const i=[];for(let l=0;l<r;l++){const t=[];for(let e=0;e<r;e++){const o=L[s[l][e]];t.push(o.fill);}i.push(t);}return {type:"relationship-ramp",numClasses:r,focus:e,colors:i,labels:H(e,L),rotation:u$4(e)}}function u$4(t){let e=s$2[t];return t&&null==e&&(e=s$2.HH),e||0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const p$3=30,y$1=12,b$2=[255,255,255],h$3=[200,200,200],d$1=[128,128,128],w$1=20,g$1=5;function S(e){return "esri.symbols.SimpleMarkerSymbol"===e.declaredClass}function v$2(e){return "esri.symbols.PictureMarkerSymbol"===e.declaredClass}function z$1(e){return "esri.symbols.SimpleLineSymbol"===e.declaredClass}function j$1(e){return "esri.symbols.TextSymbol"===e.declaredClass}function V(e,l){const t=e.length-1;return e.map(((e,o)=>o$1(e,o,t,l)))}async function k$1(e,l,o,s,n,a){const u=l.legendOptions,c=u&&u.customValues,m=await U(e,o),f=!!m,p=!!c,y=null!=l.minSize&&null!=l.maxSize,b=l.stops&&l.stops.length>1,h=!!l.target;if(!f||!p&&!(y||b&&!h))return;const d=w$2(m);let w=null,g=null,S=null;g=d&&!b?u$5([l.minDataValue,l.maxDataValue]):c||await D(l,m,s,n);const v=e?.authoringInfo,z="univariate-color-size"===v?.type,j=z&&"above-and-below"===v?.univariateTheme;if(!g&&b&&(g=l.stops.map((e=>e.value)),w=l.stops.some((e=>!!e.label)),"flow"===e.type&&(g=u$5(g)),w&&(S=l.stops.map((e=>e.label)))),d&&g?.length>2&&!j&&(g=[g[0],g[g.length-1]]),!g)return null;z&&5!==g?.length&&(g=E$1({minSize:g[0],maxSize:g[g.length-1]}));const k=d?x(e,g):null,C=b$4(m),I=w?null:V(g,a);return (await Promise.all(g.map((async(t,o)=>{const i=d?k[o]:await B$1(l,m,t,s,n);return {value:t,symbol:P(j&&"class-breaks"===e.type?L$3(e,o):m,i),label:w?S[o]:I[o],size:i,outlineSize:C}})))).reverse()}function x(e,l){const t=e?.authoringInfo,o="univariate-color-size"===t?.type;let s=[y$1,p$3];if(o){const e=l[0],t=l[l.length-1],o=y$1,n=p$3;s=l.map((l=>o+(l-e)/(t-e)*(n-o)));}return o&&"below"===t?.univariateTheme&&s.reverse(),s}function L$3(e,l){const t=e.classBreakInfos,o=t.length,s=o<2||!(l>=2)?t[0].symbol.clone():t[o-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(s.type.includes("3d")?I$2(s):M(s)),s}async function U(e,l){if("flow"===e.type)return u$6(e,l);if("pie-chart"===e.type)return new y$2({color:null,outline:e.outline?.width?e.outline:new m$2});let t=null,o=null;if("simple"===e.type)t=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;t=l&&l[0]&&l[0].symbol,o=l.length>1;}else if("unique-value"===e.type){const l=e.uniqueValueInfos;t=l&&l[0]&&l[0].symbol,o=l.length>1;}return !t||C$1(t)?null:(t=t.clone(),(l||o)&&(t.type.includes("3d")?I$2(t):M(t)),t)}function C$1(e){if(e){if(c$3(e)){return !!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type))}return e.type.includes("fill")}return !1}function I$2(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:d$1};})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:h$3}:(e.material={color:b$2},e.outline={color:d$1,size:1.5});}));}function M(l){const t=r$2();if("cim"===l.type)p$4(l,new l$3(h$3));else if(l.type.includes("line"))l.color=d$1;else if(l.color=t?d$1:b$2,"simple-marker"===l.type)if(l.outline){const e=l.outline?.color?.toHex();"#ffffff"===e&&(l.outline.color=d$1);}else l.outline={color:d$1,width:1.5};}async function D(e,l,o,s){const n=(await import('./_virtual_index-fc1e0009.js').then(function (n) { return n.rd; })).getSizeRangeAtScale(e,o,s),i=n&&E$1(n);if(!n&&!i)return;let r=i.map((l=>T$1(l,e,n)));r=u$5(r);for(let t=1;t<r.length-1;t++){const n=await q(e,l,r[t],r[t-1],o,s);n&&(r[t]=n[0],i[t]=n[1]);}return r}function E$1(e){const l=e.minSize,t=e.maxSize,o=g$1,s=(t-l)/(o-1),n=[];for(let i=0;i<o;i++)n.push(l+s*i);return n}function T$1(e,l,t){const o=t.minSize,s=t.maxSize,n=l.minDataValue,i=l.maxDataValue;let r=null;if(e<=o)r=n;else if(e>=s)r=i;else {r=(e-o)/(s-o)*(i-n)+n;}return r}async function q(e,l,n,i,r,a){const u=await B$1(e,l,n,r,a),c=await B$1(e,l,i,r,a),m=i$2(n),f=m.fractional,p=w$1;let y=m.integer,b=null,h=null;n>0&&n<1&&(b=10**f,y=i$2(n*=b).integer);for(let o=y-1;o>=0;o--){const i=10**o;let m=Math.floor(n/i)*i,f=Math.ceil(n/i)*i;null!=b&&(m/=b,f/=b);let y=(m+f)/2;[,y]=u$5([m,y,f],{indexes:[1]});const d=await B$1(e,l,m,r,a),w=await B$1(e,l,f,r,a),g=await B$1(e,l,y,r,a),S=l$4(u,d,c,null),v=l$4(u,w,c,null),z=l$4(u,g,c,null);let j=S.previous<=p,V=v.previous<=p;if(j&&V&&(S.previous<=v.previous?(j=!0,V=!1):(V=!0,j=!1)),j?h=[m,d]:V?h=[f,w]:z.previous<=p&&(h=[y,g]),h)break}return h}async function B$1(e,l,t,o,s){const{getSize:n}=await import('./_virtual_index-fc1e0009.js').then(function (n) { return n.rd; });return n(e,t,{scale:o,view:s,shape:"simple-marker"===l.type?l.style:null})}function P(e,t){const o=e.clone();if(c$3(o))w$2(o)||o.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t);}));else if(S(o))o.size=t;else if(v$2(o)){const e=o.width,l=o.height;o.height=t,o.width=t*(e/l);}else z$1(o)?o.width=t:j$1(o)&&o.font&&(o.font.size=t);return o}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function s$1(t){const n=2,i=Math.floor(Math.log10(Math.abs(t)))+1,e=i<4||i>6?4:i,r=1e6,a=Math.abs(t)>=r?"compact":"standard";return m$3(t,{notation:a,minimumSignificantDigits:n,maximumSignificantDigits:e})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const se="https://utility.arcgis.com/sharing/tools/legend",le="esri.layers.ImageryLayer",re="esri.layers.ImageryTileLayer",ie="esri.layers.WCSLayer",ne=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,ae=new s$3({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),oe={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ce=new y$2({size:6,outline:{color:[128,128,128,.5],width:.5}}),ue=new S$1({style:"solid"});function de(e){return "flow"===e.type}function ye(e){return "vector-field"===e.type}function he(e){return "raster-colormap"===e.type}function me(e){return "raster-stretch"===e.type}function fe(e){return "raster-shaded-relief"===e.type}function pe(e){return "esri.renderers.SimpleRenderer"===e.declaredClass}function ge(e){return "esri.renderers.ClassBreaksRenderer"===e.declaredClass}function be(e){return "esri.renderers.UniqueValueRenderer"===e.declaredClass}function Se(e){return "esri.renderers.HeatmapRenderer"===e.declaredClass}function _e(e){return ve(e)||we(e)||Ee(e)||Le(e)}function Le(e){return "esri.renderers.PointCloudRGBRenderer"===e.declaredClass}function ve(e){return "esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function we(e){return "esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ee(e){return "esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Ce(e){return "esri.renderers.DotDensityRenderer"===e.declaredClass}function Ie(e){return "esri.renderers.PieChartRenderer"===e.declaredClass}function Re(e,t){return pe(e)||ge(e)||be(e)||Se(e)||Ce(e)||Ie(e)?"2d"===t.type||o$3(e):me(e)||he(e)||fe(e)||ve(e)||we(e)||Ee(e)||ye(e)||de(e)}function Ve(e){return "esri.layers.BuildingSceneLayer"===e.declaredClass}function Fe(e){return "esri.layers.VoxelLayer"===e.declaredClass}function Te(e){return "esri.layers.WMSLayer"===e.declaredClass}function ze(e){return "esri.layers.WMTSLayer"===e.declaredClass}function xe(e){return "esri.layers.MapImageLayer"===e.declaredClass}function je(e){return "esri.layers.TileLayer"===e.declaredClass}function De(e){return "esri.layers.FeatureLayer"===e.declaredClass}function Oe(e){return e.declaredClass===le}function Pe(e){return e.declaredClass===re}function Me(e){return e.declaredClass===ie}function Ae(e){return "stretch-ramp"===e.type}function Be(e){return "univariate-color-size"===("authoringInfo"in e&&e?.authoringInfo)?.type}function Ue(e){const t="authoringInfo"in e&&e?.authoringInfo;return "univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}const ke=new y$2({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Ne={},qe=class extends f$3{constructor(e){super(e),this._handles=new t$1,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new j$4,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null;}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([a$2((()=>this.children),"change",(t=>{const{added:s,removed:l}=t,r=this._handles;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add(l$5((()=>t.ready),e,h$5),s);})),l.forEach((e=>r.remove(e.layer.uid))),e();}))]),this.keepCacheOnDestroy||(Ne={});}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Ne=null);}get effectList(){const e=this.layer;let t=null;return "effect"in e&&e.effect&&(t=new a$3,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,s=this.layer.parent,l=s&&"uid"in s?this._getParentLayerOpacity(s):null;return null!=t?t*e:null!=l?l*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return !1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return !0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return !0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return "renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(De(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,s=t&&t.drawingInfo,l=s&&t$2(s.renderer),r=ae.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:r}):(s$4.getLogger(this.declaredClass).warn("drawingInfo not available!"),null)}return null}));try{const e=[];await E$2(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)));})),this.legendElements=e,this.notifyChange("ready");}catch(s){s$4.getLogger(this.declaredClass).warn("error while building legend for layer!",s);}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready");}catch(t){s$4.getLogger(this.declaredClass).warn("error while building legend for layer!",t);}}async buildLegendElementsForTools(){const e=this.layer;if(Fe(e))this._constructLegendElementsForVoxellayer();else if(ze(e))this._constructLegendElementsForWMTSlayer();else if(Te(e))await this._constructLegendElementsForWMSSublayers();else if(Ve(e))await this._constructLegendElementsForBuildingSceneLayer();else if(xe(e)||je(e)||Ve(e))await this._constructLegendElementsForSublayers();else {this._handles.remove("imageryLayers-watcher");let t="default";if(Oe(e)){t=(e?.renderingRule?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###");}await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Oe(e)||Pe(e)){const t=l$5((()=>["renderingRule"in e&&e.renderingRule,e.bandIds]),(()=>x$1((async()=>{Ne.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools();}))()));this._handles.add(t,"imageryLayers-watcher");}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Oe(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready");}));await E$2(s);})).catch((e=>{s$4.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e);}));}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!s&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return !0;await j$5((()=>!t.updating));const l=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();l.geometry=this.view.extent;return 0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(l):"queryFeatureCount"in e&&await e.queryFeatureCount(l))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return !!e.length&&e.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return !0;const t="valueExpression"in e&&e.valueExpression;if(ne.test(t))return !0;const s="visualVariables"in e&&e.visualVariables;return !!s&&s.some((e=>this._isScaleDrivenSizeVariable(e)))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return !1;const t=e,s=t.minSize,l=t.maxSize;return "object"==typeof s&&s?this._isScaleDrivenSizeVariable(s):"object"==typeof l&&l?this._isScaleDrivenSizeVariable(l):!!t.expression||ne.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return !0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&xe(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers)if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return !0;return !1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add(l$5((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=e$1(e.getVariableStyle(null)),s=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new S$1({color:t.color,outline:null})});})),e.length&&s.push({type:"symbol-table",title:t.label,infos:e});}else if(t.transferFunction){const{colorStops:e,stretchRange:l}=t.transferFunction,r=e.toArray().reverse(),i=l.map(((e,t)=>`${0===t?s$5:i$3} ${s$1(e)}`)).reverse(),n=r.map((e=>({color:e.color,value:null,label:null})));n[0].label=i[0],n[n.length-1].label=i[1],s.push({type:"color-ramp",title:t.label,infos:n,preview:g$2(r.map((e=>e.color)))});}const l=e.opacity,r=s.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,l)));await E$2(r),this.legendElements=s,this.notifyChange("ready");}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(l$5((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]);}this.notifyChange("ready");}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(l$5((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready");}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const l=e.toArray();for(const r of l){const e=l$5((()=>[r.title,r.visible,r.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e&&e.infos.length&&s.unshift(e);}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return {type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let s=e.legendUrl;if(!s)return;const r={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(s=Bt(s,t));let i=null;const n=e.layer?.opacity;try{i=(await L$4(s,{responseType:"image"})).data,i&&(i.style.opacity=n);}catch{}return r.infos.push({src:s,preview:i,opacity:n}),r}_getLegendLayers(e,t){const s=Ne&&Ne[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return Ne[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Oe(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(s.renderingRule=JSON.stringify(e.rasterFunctionDefinition||e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:l,customParameters:r}=t;s={raster:e,viewId:l,...s,...r};}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend";}else {const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r=se+"?soapUrl="+encodeURI(t)+"&returnbytes=true";}return L$4(r,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(l$5((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){s$4.getLogger(this.declaredClass).warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const l=e.toArray();for(const r of l){const e=l$5((()=>["renderer"in r&&r.renderer,r.opacity,r.title,r.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=r&&null!=r.opacity?r.opacity:null,l=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,l);e.infos.push(...t),s=[e,...s];}else if(r.renderer){s=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...s];}}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(l$5((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){s$4.getLogger(this.declaredClass).warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForSublayers(e,t,s){const l=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let i=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(i=this.sublayerIds.map((e=>l.findSublayerById(e))).filter(Boolean));for(const n of i){const e=l$5((()=>[n.renderer,n.opacity,n.title,n.visible,n.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled&&this._isSublayerInScale(n)){const e=n&&null!=n.opacity?n.opacity:null,l=null!=e?e*t:t;if(n.renderer&&!n.sublayers&&n.originIdOf("renderer")>r$3.SERVICE){await n.load();r=[...await this._getRendererLegendElements(n.renderer,{title:n.title,opacity:l,sublayer:n}),...r];}else {const e=await this._generateSymbolTableElementForSublayer(n,l,s);e&&r.unshift(e);}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,l=e.source;let r=null;if(!(!l||"map-layer"===l.type&&l.mapLayerId===e.id&&(!l.gdbVersion||l.gdbVersion===("gdbVersion"in t&&t.gdbVersion)))||e.originIdOf("renderer")>r$3.SERVICE||e.originIdOf("labelingInfo")>r$3.SERVICE||e.originIdOf("labelsVisible")>r$3.SERVICE){const e=new c$4({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy();}const i=r||`${t.uid}-default`;(await this._getLegendLayers(i,r)).forEach((e=>s.set(e.layerId,e)));}const l=s.get(e.id);if((!l||l?.subLayerIds&&l.defaultVisibility)&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return {type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const l=t?.renderer;let r=t?.title||e.layerName;if(l&&(!t||t?.originIdOf("renderer")>r$3.SERVICE)){const e=t?.title||this._getRendererTitle(l,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e);}const i={type:"symbol-table",title:r,legendType:e.legendType?e.legendType:null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups?.length>0?e.legendGroups.forEach((t=>{const l={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter((e=>e.groupId===t.id)),e.layerId,s)};l.infos?.length>0&&i.infos.push(l);})):i.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,s),i.infos.length>0?i:null}_generateSymbolTableElementInfosForLegendLayer(e,t,l){return e.map((e=>{let r=e.url;if(e.imageData&&e.imageData.length>0)r=`data:image/png;base64,${e.imageData}`;else {if(0===r.indexOf("http"))return null;r=o$2(`${this.layer.url}/${t}/images/${r}`);}return {label:e.label,src:r,opacity:l??this.opacity,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return !(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let l=null,r=null,i=!0;return !s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(l=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(l=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(l>0&&l<this.scale||r>this.scale)&&(i=!1),i}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const s=t.renderer,l=e.some((e=>e.values));let r=null,i=null;return l&&e.some(((e,t)=>(e.values||(r=t,i=e,i.label||(i.label="others")),null!=i))),s?"unique-value"===s.type?i&&(e.splice(r,1),e.push(i)):"class-breaks"===s.type&&(i&&e.splice(r,1),e.reverse(),i&&e.push(i)):i&&(e.splice(r,1),e.push(i)),e}async _getRendererLegendElements(e,t={}){return Re(e,this.view)?_e(e)?this._constructPointCloudRendererLegendElements(e,t):Ce(e)?this._constructDotDensityRendererLegendElements(e):Ie(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(s$4.getLogger(this.declaredClass).warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const s=t.title,l=[];let r=null,i=null;if(ve(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(ce,e.color)});}));else if(we(e)){const t=e.stops;let l=null;if(t.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,s=t[t.length-1].value;if(null!=e&&null!=s){l=u$7(e+(s-e)/2,t);}}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(ce,l||ce.color)}]};const n=a$4(e.stops);i={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:n,preview:g$2(n.map((e=>e.color)))};}else Ee(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(ce,e.color)});})));r&&r.infos.length&&l.push(r),i&&i.infos.length&&l.push(i);const n=l.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return E$2(n).then((()=>l))}_getElementInfoForDotDensity(e,t){const{backgroundColor:s,outline:l,dotSize:r}=e,i=this.effectList?.effects.map((e=>e.toJSON())),n=i$4(i),a=r+"-"+t+"-"+s+"-"+(l&&JSON.stringify(l.toJSON()))+"-"+n,o=this._dotDensityUrlCache,c=o.has(a)?o.get(a):m$4(e,t);o.set(a,c);const u={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},d=h$4([[u]],[c.width,c.height],{effectView:this.effectList});return {opacity:1,src:c.src,preview:d,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions&&e.legendOptions.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};return e.attributes.forEach((t=>{const s=this._getElementInfoForDotDensity(e,t.color);s.label=t.label||t.valueExpressionTitle||t.field,l.infos.push(s);})),Promise.resolve([l])}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,s=[],l="Others",r=e.outline;e.attributes.forEach((e=>{const t=new y$2({color:e.color,outline:r}),l=e.label||e.valueExpressionTitle||e.field;s.push({label:l,symbol:t});}));const i=s.length?[...s]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new y$2({color:e.othersCategory.color,outline:r});s.push({label:e.othersCategory.label||l,symbol:t});}if(e.defaultColor?.a){const t=new y$2({color:e.defaultColor,outline:r});s.push({label:e.defaultLabel,symbol:t});}const n=await this._getVisualVariableLegendElements(e,this.layer)||[];if(s.length){n.unshift({type:"symbol-table",title:null,infos:s});const t=i.filter((e=>e.label!==l)).map((e=>e.symbol.color)).filter(Boolean),a=b$5(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:r});n.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:s,preview:a});}const a=n.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await E$2(a),n}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:l}=t,r=l||this.layer;let i=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const n=await this._getVisualVariableLegendElements(i,r)||[],a={type:"symbol-table",title:s||this._getRendererTitle(i,r),infos:[]};let o=null,u=!1;const y=new Set;if(de(i)&&!this._hasSizeRamp){const e=await u$6(i);a.infos.push({label:null,symbol:e});}else if(Be(i)){let e=s;const t=Ue(i)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",l=n.findIndex((e=>"color-ramp"===e.type)),r=-1!==l?n.splice(l,1)[0]:null,a=n.findIndex((e=>"size-ramp"===e.type)),o=-1!==a?n.splice(a,1)[0]:null,c=[];r&&(e=r.title,c.push(r)),o&&(e=o.title,c.push(o)),c.length>0&&n.push({type:t,title:e,infos:c});}else if(Se(i)){const e=r$4(i);n.push({type:"heatmap-ramp",title:s||i.legendOptions?.title,infos:e,preview:g$2(e.map((e=>e.color)),{effectList:this.effectList})});}else if(be(i)){const e=i&&i.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:s,field1:l,field2:o}=e;if(s&&l&&o){const e=[l,o];let c=u$4(t)||0;for(const t of e){const{field:e,normalizationField:s,label:l}=t,i=l||{field:this._getFieldAlias(e,r),normField:s&&this._getFieldAlias(s,r)},n=ke.clone();n.angle=c,a.infos.push({label:i,symbol:n}),y.add(n),c+=90;}const u=i$1({focus:t,numClasses:s,infos:i.uniqueValueInfos});n.unshift(u);}}else {const e=i.field;i.uniqueValueInfos.forEach((t=>{t.symbol&&a.infos.push({label:t.label||this._getDomainName(e,t.value,r)||t.value,value:t.value,symbol:t.symbol});}));}i.defaultSymbol&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),u=!0);}else if(ge(i)){o=this._isUnclassedRenderer(i);(!o||!this._hasSizeRamp)&&(i.classBreakInfos.forEach((e=>{e.symbol&&a.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol});})),o&&(a.title=null),this._updateInfosforClassedSizeRenderer(i,a.infos)),i.defaultSymbol&&!o&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),u=!0);}else if(me(i))if(Pe(this.layer)||Me(this.layer)){const e=this._constructTileImageryStretchRendererElements(i);Ae(e)?n.push(e):a.infos=e;}else {const e=this.layer;let t,s;i.statistics&&i.statistics.length&&(t=null!=i.statistics[0].min?i.statistics[0].min:i.statistics[0][0],s=null!=i.statistics[0].max?i.statistics[0].max:i.statistics[0][1]);let l=[];const r=e$1(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),o=r.keyProperties.BandProperties,u=oe[e.rasterInfo.pixelType.toLowerCase()];1===r.bandCount||e.bandIds&&1===e.bandIds.length?(t=null!=t?t:r.statistics?r.statistics[e.bandIds[0]].min:u[0],s=null!=s?s:r.statistics?r.statistics[e.bandIds[0]].max:u[1],t||s?n.push(this._getStretchLegendElements(i,{min:t,max:s})):this._getServerSideLegend()):r.bandCount>=3?o&&o.length>=r.bandCount?e.bandIds&&3===e.bandIds.length?(l=e.bandIds.map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):"lerc"===e.format?(l=[0,1,2].map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():"lerc"===e.format?(l=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():this._getServerSideLegend();}else if(he(i))i.colormapInfos.forEach((e=>{a.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(ue,e.color)});}));else if(pe(i)){let e=i.symbol;switch(t.geometryType){case"point":e="pointSymbol"in r&&r.pointSymbol;break;case"polyline":e="lineSymbol"in r&&r.lineSymbol;break;case"polygon":e="polygonSymbol"in r&&r.polygonSymbol;}i.symbol&&!this._hasSizeRamp&&a.infos.push({label:i.label,symbol:e});}else if(ye(i)){i.outputUnit&&(this.title="("+i.toJSON().outputUnit+")"),a.title=i.attributeField;const e=i.getClassBreakInfos();e?.length?e.forEach((e=>{a.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol});})):a.infos.push({label:i.attributeField,symbol:i.getDefaultSymbol()});}else fe(i)&&n.push(this._getStretchLegendElements(i,{min:0,max:255}));const h=i.defaultSymbol;!h||u||pe(i)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||n.push({type:"symbol-table",infos:[{label:i.defaultLabel||"others",symbol:h}]}),a.infos.length&&n.unshift(a);const m=null==t.opacity?this.opacity:t.opacity,f=this._isTallSymbol("visualVariables"in i&&i.visualVariables),p=Oe(this.layer)||Pe(this.layer),g=n.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,m,{isDefault:e.symbol===h,applyScaleDrivenSize:!y.has(e.symbol),symbolConfig:{isTall:f,isSquareFill:p},effectList:y.has(e.symbol)?null:this.effectList})));return i=null,await E$2(g),n}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0);}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){const t=this.layer,s=t.rasterInfo,l=s.bandCount||e.statistics.length;let r,i,n=[];const a=s.keyProperties&&s.keyProperties.BandProperties,o=e?.statistics?.length?e.statistics:s?.statistics;if(o)r=void 0!==o[0].min?o[0].min:o[0][0],i=o[0].max||o[0][1];else {const e=oe[t.rasterInfo.pixelType.toLowerCase()];r=e[0],i=e[1];}if(t.hasStandardTime()&&(r=t.getStandardTimeValue(r),i=t.getStandardTimeValue(i)),1===s.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:r,max:i});function c(e){const l=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return l.length<3?l.push(l[1]):l.length>3&&l.splice(3),l}return n=a&&a.length>=l?c(a):c(),this._createSymbolTableElementMultiBand(n)}_getStretchLegendElements(e,t){const s=e.colorRamp,l=i$5(s,t);return {type:"stretch-ramp",title:"",infos:l,preview:g$2(l.map((e=>e.color)))}}async _getSizeLegendElement(e,t,s,l){return {type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await k$1(s,t,await n$4(s),this.scale,this.view.type,l)}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach(((e,l)=>{t.push({label:{colorName:s[l],bandName:e},src:e$2[l],opacity:this.opacity??1});})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some((e=>w$2(e.symbol)));if(s&&l){const s=p$3,l=y$1,r=e.classBreakInfos.length,i=(s-l)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=s-i*t;}));}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let l=0;l<e.length&&(!t||!s);l++){const r=e[l];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0));}return t&&s}async _getSymbolPreview(e,t,s){let l=!s?.isDefault&&null==e.size&&this._hasSizeRamp?e$3(t$3.size):e.size;if(this._scaleDrivenSizeVariable&&s?.applyScaleDrivenSize){const{getSize:t}=await import('./_virtual_index-fc1e0009.js').then(function (n) { return n.rd; });l=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null});}return S$2(e.symbol,{size:l,opacity:t,scale:!1,symbolConfig:s?.symbolConfig,effectView:s?.effectList}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){const t=[],s=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const l="visualVariables"in e&&e.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!ne.test(e.valueExpression)));if(e&&"visualVariables"in e&&!l&&"featureReduction"in s&&"cluster"===s.featureReduction?.type){const t=this.layerView._effectiveRenderer,l=e$1(a$1(t,this.view));if(l){const t=s.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:s}=t;l.legendOptions=new a$5({showLegend:e!==s});}const r=e.visualVariables||[];e.visualVariables=r.concat([l]),this._hasClusterSizeVariable=!0;}}const r=await n$4(e);if(ge(e)||be(e)){const s=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,r).then((t=>{e.symbol=t;})).catch((()=>{e.symbol=null;}))));Array.prototype.push.apply(t,s);}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:r).then((t=>{this._applySymbolToRenderer(e,t,pe(e));})).catch((()=>{this._applySymbolToRenderer(e,null,pe(e));}))),E$2(t).then((()=>e))}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t;}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const s=this._webStyleSymbolCache;try{const l=await("2d"===this.view.type?e.fetchCIMSymbol({cache:s}):e.fetchSymbol({cache:s}));return this._getAppliedCloneSymbol(l,t)}catch{throw s$4.getLogger(this.declaredClass).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,s){if(!e||!s)return e;const l=e.clone(),r=s&&s.toRgba();return l.type.includes("3d")?this._applyColorTo3dSymbol(l,r):"cim"===l.type?p$4(l,s):l.color&&(l.color=new l$3(r||l.color)),l}_applyColorTo3dSymbol(e,s){s&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new l$3(s));}));}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,l=[],r=[],i=[];for(const u of s)"color"===u.type?l.push(u):"size"===u.type?r.push(u):"opacity"===u.type&&i.push(u);const n=[...l,...r,...i];let a,o;if(0===l.length&&ge(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];a=t&&t.symbol;}if(0===l.length&&pe(e)&&(a=e.symbol),a)if(a.type.includes("3d")){const e=a.symbolLayers.getItemAt(0);"water"===e.type?r$5(e.color)&&(o=e.color):r$5(e.material)&&r$5(e.material.color)&&(o=e.material.color);}else a.url||(o=a.color);const c=this.effectList;return (await Promise.all(n.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const l=de(e)?s.field:this._getRampTitle(s,t);let r=null;const i="getField"in t&&t.getField&&t.getField(s.field),n=i&&K(i);if("color"===s.type){const e=await r$6(s,null,n);r={type:"color-ramp",title:l,infos:e,preview:g$2(e.map((e=>e.color)),{effectList:c})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length));}else if("size"===s.type&&"outline"!==s.target)ne.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r=await this._getSizeLegendElement(l,s,e,n),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await r$6(s,o,n);r={type:"opacity-ramp",title:l,infos:e,preview:g$2(e.map((e=>e.color)),{effectList:c})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length));}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const l="getField"in s&&s.getField&&s.getField(e),r=l&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(l.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,r=l&&l.fieldInfos;if(r)for(const t of r)if(t.fieldName===s)return "cluster_count"===s?t.label||{showCount:!0}:t.label}return {showCount:!0}}_getRampTitle(e,t){let s=e.field,l=e.normalizationField,r=!1,i=!1,n=!1,a=null;s="function"==typeof s?null:s,l="function"==typeof l?null:l;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else {if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){i=!0;break}if("percent-of-total"===s.style){n=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:l&&this._getFieldAlias(l,t),ratio:r,ratioPercent:i,ratioPercentTotal:n};}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions&&s.legendOptions.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let l=s.field,r=null,i=null;ge(s)&&(r=s.normalizationField,i="percent-of-total"===s.normalizationType),l="function"==typeof l?null:l,r="function"==typeof r?null:r;let n=null;return (l||r)&&(n={field:l&&this._getFieldAlias(l,t),normField:r&&this._getFieldAlias(r,t),normByPct:i}),n}_getFieldAlias(e,t){const s="popupTemplate"in t&&t.popupTemplate,l=s&&s.fieldInfos;let r=null;l&&l.some((t=>e===t.fieldName&&(r=t,!0)));let i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));const n=r||i;let a=null;return n&&(a=r&&r.label||i&&i.alias||"name"in n&&n.name||"fieldName"in n&&n.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return ge(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};e([d$2()],qe.prototype,"children",void 0),e([d$2({readOnly:!0})],qe.prototype,"effectList",null),e([d$2()],qe.prototype,"layerView",void 0),e([d$2()],qe.prototype,"layer",void 0),e([d$2()],qe.prototype,"legendElements",void 0),e([d$2({readOnly:!0})],qe.prototype,"opacity",null),e([d$2()],qe.prototype,"parent",void 0),e([d$2({readOnly:!0,dependsOn:[]})],qe.prototype,"ready",null),e([d$2()],qe.prototype,"hideLayersNotInCurrentView",void 0),e([d$2()],qe.prototype,"keepCacheOnDestroy",void 0),e([d$2()],qe.prototype,"respectLayerVisibility",void 0),e([d$2({readOnly:!0})],qe.prototype,"scale",null),e([d$2()],qe.prototype,"sublayerIds",void 0),e([d$2({readOnly:!0})],qe.prototype,"isScaleDriven",null),e([d$2()],qe.prototype,"title",void 0),e([d$2({readOnly:!0,dependsOn:["ready"],value:0})],qe.prototype,"version",null),e([d$2()],qe.prototype,"view",void 0),qe=e([n$3("esri.widgets.Legend.support.ActiveLayerInfo")],qe);const We=qe;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const h$2={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},c$2=j$4.ofType(We),L$2=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],_$1="view.basemapView.baseLayerViews",f$2="view.groundView.layerViews",u$3="view.basemapView.referenceLayerViews",p$2=[_$1,f$2,"view.layerViews",u$3];let v$1=class extends f$3{constructor(e){super(e),this._handles=new t$1,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new j$4,this.activeLayerInfos=new c$2,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null;}initialize(){this._handles.add(l$5((()=>this.view),(()=>this._viewHandles()),h$5),h$2.view),this._handles.add(s$6((()=>this._refresh())));}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null;}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(h$2.state),this.view&&this._handles.add(l$5((()=>this.state),(()=>this._stateHandles()),h$5),h$2.state);}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews();}_resetAll(){this._handles.remove([h$2.allLayerViews,h$2.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll();}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this);}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const i=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],i&&i.parent&&i.parent.children.remove(i);}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",(e=>this._allLayerViewsChangeHandle(e))),h$2.allLayerViews),this._handles.add(l$5((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),h$2.legendProperties);}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh();}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh();}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos);}_sortActiveLayerInfos(e){if(e.length<2)return;const i=[];e.forEach((r=>{if(!r.parent){const t=r.layer.parent,s=t&&"uid"in t&&this._layerViewByLayerId[t.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&e.includes(a)&&(i.push(r),r.parent=a,a.children.add(r),this._sortActiveLayerInfos(a.children));}})),e.removeMany(i);const r={};this.view.allLayerViews.forEach(((e,i)=>r[e.layer.uid]=i)),e.sort(((e,i)=>{const t=r[e.layer.uid]||0;return (r[i.layer.uid]||0)-t}));}_generateLayerViews(){const e=[];return p$2.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const i=!this.basemapLegendVisible&&(e===_$1||e===u$3),r=!this.groundLegendVisible&&e===f$2;return !i&&!r}_collectLayerViews(e,i){const r=t=>(t&&t.forEach((t=>{i.push(t),r(t[e]);})),i);return r}_filterLayerViewsByLayerInfos(e){const i=this.layerInfos;return !i||!i.length||i.some((i=>this._hasLayerInfo(i,e)))}_hasLayerInfo(e,i){const r=this._isLayerUIDMatching(e.layer,i.layer.uid);return r&&(this._layerInfosByLayerViewId[i.uid]=e),r}_isLayerUIDMatching(e,i){return e&&(e.uid===i||this._hasLayerUID(e.layers,i))}_hasLayerUID(e,i){return e&&e.some((e=>this._isLayerUIDMatching(e,i)))}_isLayerViewSupported(e){return !!L$2.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(l$5((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid));}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e));}_isLayerActive(e){return !this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){const i=e.layer,r=e.uid,t=this._layerInfosByLayerViewId[r];let o=this._activeLayerInfosByLayerViewId[r];if(!o){const s=t&&void 0!==t.title&&t.layer.uid===i.uid;o=new We({layer:i,layerView:e,title:s?t.title:i.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:t&&t.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=o;}const l=i.parent&&"uid"in i.parent&&this._layerViewByLayerId[i.parent?.uid];if(o.parent=this._activeLayerInfosByLayerViewId[l?.uid],!this._handles.has(r)){const t=[l$5((()=>i.title),(e=>this._titleHandle(e,o))),l$5((()=>[i.opacity,"renderer"in i&&i.renderer,"pointSymbol"in i&&i.pointSymbol,"lineSymbol"in i&&i.lineSymbol,"polygonSymbol"in i&&i.polygonSymbol]),(()=>this._constructLegendElements(o))),f$4((()=>!0===this.view?.stationary),(()=>this._scaleHandle(o)),h$5),l$5((()=>e._effectiveRenderer),(()=>this._constructLegendElements(o))),l$5((()=>"effect"in i&&i.effect),(()=>this._constructLegendElements(o)))];if(this.respectLayerVisibility){const r=l$5((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,o))),a=l$5((()=>i.legendEnabled),(e=>this._legendEnabledHandle(e,o)));t.push(r,a);}this._handles.add(t,r);}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o);}_titleHandle(e,i){i.title=e,this._constructLegendElements(i);}_legendEnabledHandle(e,i){e?this._addActiveLayerInfo(i):this._removeActiveLayerInfo(i);}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e);}_addActiveLayerInfo(e){const{layerView:i,layer:r}=e;if(this._isLayerActive(i)&&!this.activeLayerInfos.includes(e)){const i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else {const i=this.layerInfos?.some((e=>e.layer.uid===r.uid));r.parent&&"uid"in r.parent&&!i?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos));}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((i=>{const r=i.layer.parent,t=r&&"uid"in r&&this._layerViewByLayerId[r?.uid],s=this._activeLayerInfosByLayerViewId[t?.uid];s&&(e.push(i),i.parent=s);})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))));}}}_removeActiveLayerInfo(e){const i=e.parent;i?i.children.remove(e):this.activeLayerInfos.remove(e);}_constructLegendElements(e){const i=e.layer;"featureCollections"in i&&i.featureCollections?e.buildLegendElementsForFeatureCollections(i.featureCollections):"featureReduction"in i&&"binning"===i.featureReduction?.type&&"renderer"in i.featureReduction?e.buildLegendElementsForRenderer(i.featureReduction.renderer):"renderer"in i&&i.renderer?e.buildLegendElementsForRenderer(i.renderer):"url"in i&&i.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)));}};e([d$2({type:c$2})],v$1.prototype,"activeLayerInfos",void 0),e([d$2()],v$1.prototype,"basemapLegendVisible",void 0),e([d$2()],v$1.prototype,"groundLegendVisible",void 0),e([d$2()],v$1.prototype,"hideLayersNotInCurrentView",void 0),e([d$2()],v$1.prototype,"keepCacheOnDestroy",void 0),e([d$2()],v$1.prototype,"respectLayerVisibility",void 0),e([d$2()],v$1.prototype,"layerInfos",void 0),e([d$2({readOnly:!0})],v$1.prototype,"state",null),e([d$2()],v$1.prototype,"view",void 0),v$1=e([n$3("esri.widgets.Legend.LegendViewModel")],v$1);const I$1=v$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const u$2="http://www.w3.org/2000/svg",b$1={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function p$1(e,a,r,l){const{focus:t,labels:s}=e,i=!!t,o=c$1(e,a,r,l),u={justifyContent:"center"},p=f$5();return i?n$5("div",{class:b$1.diamondContainer,styles:u},n$5("div",{class:b$1.diamondLeftCol},p?s.right:s.left),n$5("div",{class:b$1.diamondMidCol},n$5("div",{class:b$1.diamondMidColLabel},s.top),o,n$5("div",{class:b$1.diamondMidColLabel},s.bottom)),n$5("div",{class:b$1.diamondRightCol},p?s.left:s.right)):n$5("div",{class:b$1.squareTable},n$5("div",{class:b$1.squareTableRow},n$5("div",{class:p$5(b$1.squareTableCell,b$1.squareTableLabel,b$1.squareTableLabelRightBottom)},p?s.top:s.left),n$5("div",{class:b$1.squareTableCell}),n$5("div",{class:p$5(b$1.squareTableCell,b$1.squareTableLabel,b$1.squareTableLabelLeftBottom)},p?s.left:s.top)),n$5("div",{class:b$1.squareTableRow},n$5("div",{class:b$1.squareTableCell}),o,n$5("div",{class:b$1.squareTableCell})),n$5("div",{class:b$1.squareTableRow},n$5("div",{class:p$5(b$1.squareTableCell,b$1.squareTableLabel,b$1.squareTableLabelRightTop)},p?s.right:s.bottom),n$5("div",{class:b$1.squareTableCell}),n$5("div",{class:p$5(b$1.squareTableCell,b$1.squareTableLabel,b$1.squareTableLabelLeftTop)},p?s.bottom:s.right)))}function h$1(e,a,r){const l=`${r}_arrowStart`,t=`${r}_arrowEnd`,s="left"===e,i={markerStart:null,markerEnd:null};switch(a){case"HL":s?i.markerStart=`url(#${t})`:i.markerEnd=`url(#${l})`;break;case"LL":i.markerStart=`url(#${t})`;break;case"LH":s?i.markerEnd=`url(#${l})`:i.markerStart=`url(#${t})`;break;default:i.markerEnd=`url(#${l})`;}return i}function c$1(n,d,p,c,f=60){const{focus:q,numClasses:k,colors:T,rotation:_}=n,g=!!q,L=Math.sqrt(f**2+f**2)+(g?0:5),C=[],v=[],w=[],y=(f||75)/k;for(let s=0;s<k;s++){const i=s*y;for(let o=0;o<k;o++){const n=o*y,d=v$3(T[s][o]),m=M$1(null),u={type:"rect",x:n,y:i,width:y,height:y};C.push(S$3(d)),v.push(j$6(u,d.fill,m,null)),w.push(O(u));}}const x=10,R=15,$=15,E=10;let M=null;g||(M="margin: -15px -15px -18px -15px");const S=h$1("left",q,d),j=h$1("right",q,d),B=T$2(w),H=E$3(B,L,L,0,!1,_,!1),U=E$3(B,L,L,0,!1,g?-45:null,!1),W={filter:N$2(c),opacity:null==p?null:`${p}`};return n$5("div",{styles:W,class:g?b$1.diamondMidColRamp:b$1.squareTableCell},n$5("svg",{xmlns:u$2,width:L,height:L,style:M},n$5("defs",null,n$5("marker",{id:`${d}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$5("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),n$5("marker",{id:`${d}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$5("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),C),n$5("g",{transform:H},v),n$5("g",{transform:U},n$5("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":S.markerStart,"marker-end":S.markerEnd,x1:-x,y1:f-R,x2:-x,y2:R}),n$5("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":j.markerStart,"marker-end":j.markerEnd,x1:$,y1:f+E,x2:f-$,y2:f+E}))))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const n$1=i$6(),l=10,r$1=20,s=10,a=20,c={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function f$1(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return "vertical"===e?n$5("svg",{height:"4",width:"10"},n$5("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):n$5("svg",{height:"10",width:"10"},n$5("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function p(e,t="vertical"){const o=document.createElement("div");return o.style.height=`${r$1}px`,o.className=c.univariateAboveAndBelowSymbol,null!=e&&(o.style.opacity=e.toString()),n$1.append(o,f$1.bind(null,t)),o}function m$1(t,o,i="vertical",n){t.infos.forEach(((t,l)=>{if(n&&2===l)t.preview=p(o,i);else {const o=u$8(t.size)+("horizontal"===i?a:s),n="div"===t.preview.tagName.toLowerCase(),l=n?t.preview:document.createElement("div");l.className=c.univariateAboveAndBelowSymbol,"horizontal"===i?l.style.width=`${o}px`:l.style.height=`${o}px`,n||l.appendChild(t.preview),t.preview=l;}}));}function u$1(t,o="classic"){const i=t.infos;return "classic"===o?(u$8(i[0].size)+s)/2:(u$8(i[0].size)-u$8(i[i.length-1].size))/2}function v(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),n=g$2("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return n.className=c.colorRamp,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function h(t,o,i,n="vertical"){let c=0;const f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p;for(let v=m;v<=u;v++)if(i&&v===p)c+="horizontal"===n?l:r$1;else {c+=u$8(f[v].size)+("horizontal"===n?a:s);}return Math.round(c)}function y(t,o,i,n="vertical"){const c=h(t,o,i,n),f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p,v="full"===o?f[m].size+f[u].size:"above"===o?f[m].size:f[u].size,y=i?"vertical"===n?r$1:l:0,d="vertical"===n?s*("full"===o?2:1):a*("full"===o?2:1);return Math.round(c-(u$8(v)/2+y/2+d/2))}function d(e,t,o="vertical"){const i=e.infos;let n=i.find((({type:e})=>"size-ramp"===e)),l=i.find((({type:e})=>"color-ramp"===e));return n&&(n={...n},n.infos=[...n.infos],m$1(n,t,o,!0)),l&&(l={...l},l.infos=[...l.infos]),"horizontal"===o&&(n?.infos.reverse(),l?.infos.reverse()),{sizeRampElement:n,colorRampElement:l}}function b(e,t="vertical"){const o=e.infos;let i=o.find((({type:e})=>"size-ramp"===e)),n=o.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],m$1(i,null,t,!1)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===t&&(i?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:i,colorRampElement:n}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function n(e,n){return n}function t(e){const n=this;e.appendChild(n);}function r(t,r,i){if(!r)return;if("string"==typeof r||"number"==typeof r)return r;if("value"in r||"unit"in r)return s$7(t.dotValue,r);if("colorName"in r||"bandName"in r)return t[r.colorName]+": "+(t[r.bandName]||r.bandName);if("showCount"in r)return r.showCount?t.clusterCountTitle:null;let l=null;return n(r,i)?l=r.ratioPercentTotal?"showRatioPercentTotal":r.ratioPercent?"showRatioPercent":r.ratio?"showRatio":r.normField?"showNormField":r.field?"showField":null:o(r,i)&&(l=r.normField?"showNormField":r.normByPct?"showNormPct":r.field?"showField":null),l?s$7("showField"===l?"{field}":t[l],{field:r.field,normField:r.normField}):null}function o(e,n){return !n}function i(e,n){return !!(n&&"Stretched"===n&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const R$1={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",pieChartRampPreview:"esri-legend--card__pie-chart-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},z=25,$=25,I=768,k=100;var A$1;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side";}(A$1||(A$1={}));const N="#ddd",j=window.devicePixelRatio;function E(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1),i=s.resource&&s.resource.primitive;return "circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return "circle"===t||"diamond"===t||"cross"===t}}}function F(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return "triangle"===s||"cone"===s||"tetrahedron"===s}return "triangle"===e.style}}let T=class extends M$2{constructor(e,s){super(e,s),this._handles=new t$1,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=A$1.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null;}initialize(){this.addHandles(l$5((()=>this.activeLayerInfos),(e=>{this._handles.removeAll(),this._watchForSectionChanges(e);})));}destroy(){this._handles.destroy(),this._handles=null;}render(){this._hasIndicators=this.layout===A$1.Auto&&this.view.container.clientWidth<=I||this.layout===A$1.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,i=this._sectionNames.map(((e,t)=>{const i=s$7(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return n$5("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(R$1.indicator,{[R$1.activated]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&s>1?n$5("div",{class:R$1.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[R$1.stacked]:this._hasIndicators};return n$5("div",{class:this.classes(R$1.base,o)},a||n$5("div",{class:R$1.message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t);}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e);}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),a=this._sectionNames;let o=null;-1!==r&&(a[r+s]?o=document.getElementById(a[r+s]):"ArrowLeft"===t?o=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(o=document.getElementById(a[0])),o&&o.focus());}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(l$5((()=>e.version),(()=>this._generateSectionNames())),t);}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t);}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this);}_getSectionName(e,t,s){return `${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s));}));}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$5("div",{key:e.layer.uid,class:this.classes(R$1.service,R$1.groupLayer)},n$5("div",{class:R$1.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={[R$1.groupLayerChild]:!!e.parent};return n$5("div",{key:e.layer.uid,class:this.classes(R$1.service,r)},n$5("div",{class:R$1.serviceCaptionContainer},n$5("div",{class:R$1.serviceCaptionText},e.title)),n$5("div",{class:R$1.serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1){const r$1="color-ramp"===e.type,a="opacity-ramp"===e.type,o="size-ramp"===e.type,l=t.layer;let n=null;if("string"==typeof e.title)n=e.title;else if(e.title){const t=e.title,s=r(this.messages,t,r$1||a);n=t.title?`${t.title} (${s})`:s;}const d=this._getSectionName(l,e,s),p=this._hasIndicators?n$5("div",null,n$5(n$6,{level:this.headingLevel,class:R$1.carouselTitle},t.title),n$5(n$6,{level:l$6(this.headingLevel),class:R$1.layerCaption},n)):n?n$5(n$6,{level:this.headingLevel,class:R$1.layerCaption},n):null,m=t.effectList;let h=null;if("symbol-table"===e.type){const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes&&s[0].properties.classes[R$1.symbolRow],t={[R$1.labelContainer]:!e&&!i,[R$1.relationshipLabelContainer]:i};h=n$5("div",{class:this.classes(t)},s);}}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,l.opacity,m):o?h=this._renderSizeRamp(e,l.opacity):"pie-chart-ramp"===e.type?h=this._renderPieChartRamp(e):"relationship-ramp"===e.type?h=p$1(e,this.id,l.opacity,m):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,l.opacity,m):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,l.opacity,m));if(!h)return null;const y=n$5("div",{key:d,class:R$1.section,id:`${d}-panel`,role:"tabpanel","aria-labelledby":d,tabIndex:0},[p,h]);return this._sectionMap.set(d,y),y}_renderPieChartRamp(e){return n$5("div",{class:R$1.pieChartRampPreview,bind:e.preview,afterCreate:t})}_renderUnivariateAboveAndBelowRamp(e,t$1,s){const{sizeRampElement:i,colorRampElement:r}=d(e,t$1,"horizontal");if(!i)return null;const a=h(i,"full",!0,"horizontal"),o=y(i,"above",!0,"horizontal"),l=y(i,"below",!0,"horizontal"),n=12,c=v(r,{width:o,height:n,rampAlignment:"horizontal",opacity:t$1,type:"above",effectList:s}),g=v(r,{width:l,height:n,rampAlignment:"horizontal",opacity:t$1,type:"below",effectList:s}),_=u$1(i,"card"),u=i.infos.map((e=>e.label)),f=u.length-1,b=u.map(((e,t)=>0===t||t===f?n$5("div",{key:t},e):null)),w={display:"flex",flexDirection:"column"},L={display:"flex",flexDirection:"row"},S={marginTop:"3px",display:"flex"};f$5(this.container)?S.marginRight=`${_}px`:S.marginLeft=`${_}px`;const z={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$5("div",{class:R$1.layerRow,key:"size-ramp-preview",styles:w},n$5("div",{class:this.classes(R$1.symbolContainer,R$1.sizeRampHorizontal),styles:L},i.infos.map(((e,t$1)=>n$5("div",{key:t$1,class:R$1.symbol,bind:e.preview,afterCreate:t})))),c?n$5("div",{class:R$1.univariateAboveAndBelowColorRamp,styles:S,key:"color-ramp-preview"},n$5("div",{bind:c,afterCreate:t}),n$5("div",{bind:g,afterCreate:t})):null,n$5("div",{class:R$1.layerInfo},n$5("div",{class:R$1.rampLabelsContainer,styles:z},b)))}_renderUnivariateColorSizeRamp(e,t$1,s){const{sizeRampElement:i,colorRampElement:r}=b(e,"horizontal");if(!i)return null;const a=h(i,"full",!1,"horizontal"),o=y(i,"full",!1,"horizontal"),l=v(r,{width:o,height:12,rampAlignment:"horizontal",opacity:t$1,type:"full",effectList:s}),n=u$1(i,"card"),c=i.infos.length-1,d=i.infos.map(((e,t)=>0===t||t===c?n$5("div",{key:t},e.label):null)),_={display:"flex",flexDirection:"column"},u={display:"flex",flexDirection:"row"},f={marginTop:"3px",display:"flex"};f$5(this.container)?f.marginRight=`${n}px`:f.marginLeft=`${n}px`;const b$1={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$5("div",{class:R$1.layerRow,key:"size-ramp-preview",styles:_},n$5("div",{class:this.classes(R$1.symbolContainer,R$1.sizeRampHorizontal),styles:u},i.infos.map(((e,t$1)=>n$5("div",{key:t$1,class:R$1.symbol,bind:e.preview,afterCreate:t})))),n$5("div",{class:R$1.univariateAboveAndBelowColorRamp,styles:f,key:"color-ramp-preview"},n$5("div",{bind:l,afterCreate:t})),n$5("div",{class:R$1.layerInfo},n$5("div",{class:R$1.rampLabelsContainer,styles:b$1},d)))}_renderLegendForElementInfo(e,t$1,s,i$1){const r$1=t$1.layer;if(e.type)return this._renderLegendForElement(e,t$1,i$1);const a=i(r$1,s);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return n$5("div",{key:i$1,bind:e.preview,afterCreate:t});const t$1={[R$1.symbolCell]:this._hasIndicators};return n$5("div",{key:i$1,class:this.classes(R$1.layerRow,{[R$1.symbolRow]:this._hasIndicators})},n$5("div",{class:this.classes(t$1),bind:e.preview,afterCreate:t}),n$5("div",{class:this.classes(R$1.imageLabel,{[R$1.labelCell]:this._hasIndicators})},r(this.messages,e.label,!1)||""))}let s=255,a=255,o=255,n=0,c=255,d=255,p=255,m=0;const h=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(s=e.symbol.color.r,a=e.symbol.color.g,o=e.symbol.color.b,n=e.symbol.color.a*r$1.opacity),y&&(c=e.symbol.outline.color.r,d=e.symbol.outline.color.g,p=e.symbol.outline.color.b,m=e.symbol.outline.color.a*r$1.opacity);const g=e.symbol.color?.isBright??!0,u=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",f={background:h?`rgba(${s}, ${a}, ${o}, ${n})`:"none",color:g?"black":"white",textShadow:`-1px -1px 0 ${u},\n                                              1px -1px 0 ${u},\n                                              -1px 1px 0 ${u},\n                                              1px 1px 0 ${u}`,border:y?`1px solid rgba(${c}, ${d}, ${p}, ${m})`:"none",filter:N$2(t$1.effectList)};return n$5("div",{key:i$1,class:R$1.layerRow},n$5("div",{class:R$1.labelElement,styles:f}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r$1,a);return n$5("div",{key:i$1,class:R$1.layerRow},t,n$5("div",{class:R$1.imageLabel},e.label||""))}}_renderImage(e,t,s){const{label:i,src:r$1,opacity:a}=e,o={[R$1.imageryLayerStretchedImage]:s,[R$1.symbol]:!s},l={opacity:`${null!=a?a:t.opacity}`};return n$5("img",{alt:r(this.messages,i,!1),src:r$1,border:0,width:e.width,height:e.height,class:this.classes(o),styles:l})}_renderSizeRampLines(e){const t$1=e.infos,s=t$1[0],r=t$1[t$1.length-1],a=s.symbol,o=this._hasIndicators,l=u$8(s.size+s.outlineSize)*j,n=u$8(r.size+r.outlineSize)*j,c=o?l:l+50*j,d=o?l/2+50*j:l,p=F(a),m=E(a),h=document.createElement("canvas");h.width=c,h.height=d,h.style.width=h.width/j+"px",h.style.height=h.height/j+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=c/2-n/2,i=d;y.moveTo(e,t),y.lineTo(s,i);const r=c,a=0,o=c/2+n/2,l=d;y.moveTo(r,a),y.lineTo(o,l);}else {y.beginPath();const e=0,t=d/2-n/2,s=c,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,a=d/2+n/2,o=c,l=d;y.moveTo(r,a),y.lineTo(o,l);}return y.strokeStyle=N,y.stroke(),n$5("div",{bind:h,afterCreate:t,styles:o?{display:"flex",marginTop:`-${p?0:m?l/2:0}px`,marginBottom:`-${p?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${p?0:m?l/2:0}px`,marginLeft:`-${p?0:m?n/2:0}px`}})}_renderSizeRamp(e,t$1){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let a=s[0].preview,o=s[s.length-1].preview;const l=this._hasIndicators,n={"flex-direction":l?"column":"row-reverse"};a&&(a=a.cloneNode(!0),a.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:null!=t$1?`${t$1}`:""};return n$5("div",{class:this.classes(R$1.layerRow,{[R$1.sizeRampRow]:l})},n$5("div",{class:R$1.rampLabel},l?i:r),n$5("div",{class:R$1.sizeRampContainer,styles:n},n$5("div",{bind:a,afterCreate:t,class:R$1.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),n$5("div",{bind:o,afterCreate:t,class:R$1.sizeRampContainer,styles:c})),n$5("div",{class:R$1.rampLabel},l?r:i))}_renderLegendForRamp(e,t,s){const i=e.infos,r="heatmap-ramp"===e.type,a=i.length-1,n=$,c=a>2&&!r?z*a:k,d=c+20,p=10,m=i.slice(0).reverse();m.forEach(((e,t)=>{e.offset=r?e.ratio:t/a;}));const h=m.length-1,y=m.length%2!=0&&m[m.length/2|0],g=y&&n$5("div",{class:R$1.intervalSeparatorsContainer},n$5("div",{class:R$1.intervalSeparator},"|"),n$5("div",{class:R$1.rampLabel},y.label)),_=i[i.length-1].label,v=i[0].label,u=[[{shape:{type:"path",path:`M0 ${n/2} L${p} 0 L${p} ${n} Z`},fill:m[0].color,stroke:{width:0}},{shape:{type:"rect",x:p,y:0,width:c,height:n},fill:{type:"linear",x1:p,y1:0,x2:c+p,y2:0,colors:m},stroke:{width:0}},{shape:{type:"path",path:`M${c+p} 0 L${d} ${n/2} L${c+p} ${n} Z`},fill:m[h].color,stroke:{width:0}}]],f=C$2(u,d,n),{messages:b}=this,w={filter:N$2(s),opacity:null==t?null:`${t}`},L={justifyContent:"center"};return n$5("div",{class:R$1.layerRow,styles:L},n$5("div",{class:R$1.rampLabel},r?b[_]:_),n$5("div",{class:R$1.symbolContainer},n$5("div",{styles:w},f),g),n$5("div",{class:R$1.rampLabel},r?b[v]:v))}};e([d$2()],T.prototype,"activeLayerInfos",void 0),e([d$2()],T.prototype,"headingLevel",void 0),e([d$2()],T.prototype,"layout",void 0),e([d$2(),e$4("esri/widgets/Legend/t9n/Legend")],T.prototype,"messages",void 0),e([d$2(),e$4("esri/t9n/common")],T.prototype,"messagesCommon",void 0),e([d$2({readOnly:!0})],T.prototype,"type",void 0),e([d$2()],T.prototype,"view",void 0),e([t$4()],T.prototype,"_selectSection",null),T=e([n$3("esri.widgets.Legend.styles.Card")],T);const B=T;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const u={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},_="esri-legend__",f=24,L$1={display:"flex",alignItems:"flex-start"},w={marginLeft:"3px"},C={display:"table-cell",verticalAlign:"middle"};let R=class extends M$2{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic";}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return n$5("div",null,r&&r.length?r:n$5("div",{class:u.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,a=`${_}${e.layer.uid}-version-${e.version}`,l=e.title?n$6({level:this.headingLevel,class:this.classes(u.header,u.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$5("div",{key:a,class:this.classes(u.service,u.groupLayer)},l,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer,e.effectList))).filter((e=>!!e));if(!s.length)return null;const t={[u.groupLayerChild]:!!e.parent};return n$5("div",{key:a,class:this.classes(u.service,t),tabIndex:0},l,n$5("div",{class:u.layer},s))}}_renderLegendForElement(e,r$1,a,l){const t="color-ramp"===e.type,i="opacity-ramp"===e.type,n="size-ramp"===e.type;let o$1=null;if("symbol-table"===e.type||n){const l=e.infos.map((l=>this._renderLegendForElementInfo(l,r$1,a,n,e.legendType))).filter((e=>!!e));l.length&&(o$1=n$5("div",{class:u.layerBody},l));}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o$1=this._renderLegendForRamp(e,r$1.opacity):"relationship-ramp"===e.type?o$1=p$1(e,this.id,r$1.opacity,a):"pie-chart-ramp"===e.type?o$1=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?o$1=this._renderUnivariateAboveAndBelowRamp(e,r$1.opacity,a):"univariate-color-size-ramp"===e.type&&(o$1=this._renderUnivariateColorSizeRamp(e,r$1.opacity,a));if(!o$1)return null;const p=e.title;let y=null;if("string"==typeof p)y=p;else if(p){const e=r(this.messages,p,t||i);y=o(p,t||i)&&p.title?`${p.title} (${e})`:e;}const c=l?u.layerChildTable:u.layerTable,g=y?n$5("div",{class:u.layerCaption},y):null,v={[u.layerTableSizeRamp]:n||!l};return n$5("div",{class:this.classes(c,v)},g,o$1)}_renderPieChartRamp(e){return n$5("div",{bind:e.preview,afterCreate:t})}_renderUnivariateAboveAndBelowRamp(e,r,a){const{sizeRampElement:l,colorRampElement:s}=d(e,r);if(!l)return null;const p=y(l,"above",!0),d$1=y(l,"below",!0),m=12,c=v(s,{width:m,height:p,rampAlignment:"vertical",opacity:r,type:"above",effectList:a}),g=v(s,{width:m,height:d$1,rampAlignment:"vertical",opacity:r,type:"below",effectList:a}),v$1=u$1(l),b=l.infos.map((e=>e.label)),_=b.map(((e,r)=>{const a=2===r;return 0===r?n$5("div",{key:r,class:e?c?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):a?n$5("div",null):null})),f=b.length-1,R=Math.floor(b.length/2),A=b.map(((e,r)=>r===R||r===f?n$5("div",{key:r,class:e?c?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):null)),S={display:"table-cell",verticalAlign:"middle"},I={marginTop:`${v$1}px`},j={height:`${p}px`},k={height:`${d$1}px`};return n$5("div",{key:"univariate-above-and-below-ramp-preview",styles:L$1},n$5("div",{class:u.layerBody},l.infos.map(((e,r)=>n$5("div",{class:this.classes(u.layerRow,u.sizeRamp)},n$5("div",{class:u.symbol,styles:S,bind:e.preview,afterCreate:t}),c||r%2!=0?null:n$5("div",{class:u.layerInfo},b[r]))))),c?n$5("div",{styles:I,key:"color-ramp-preview"},n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:u.rampContainer,bind:c,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:u.rampLabelsContainer,styles:j},_))),n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:u.rampContainer,bind:g,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:u.rampLabelsContainer,styles:k},A)))):null)}_renderUnivariateColorSizeRamp(e,r,a){const{sizeRampElement:l,colorRampElement:s}=b(e);if(!l)return null;const t$1=u$1(l),d=12,m=y(l,"full",!1),c=v(s,{width:d,height:m,rampAlignment:"vertical",opacity:r,type:"full",effectList:a}),g=l.infos.length-1,v$1=l.infos.map(((e,r)=>0===r||r===g?n$5("div",{key:r,class:e.label?s?u.univariateAboveAndBelowLabel:u.rampLabel:null},e.label):null)),b$1={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${t$1}px`},f={height:`${m}px`};return n$5("div",{key:"univariate-above-and-below-ramp-preview",styles:L$1},n$5("div",{class:u.layerBody},l.infos.map((e=>n$5("div",{class:this.classes(u.layerRow,u.sizeRamp)},n$5("div",{class:u.symbol,styles:b$1,bind:e.preview,afterCreate:t}))))),n$5("div",{styles:_,key:"color-ramp-preview"},n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:u.rampContainer,bind:c,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:u.rampLabelsContainer,styles:f},v$1)))))}_renderLegendForRamp(e,r){const a=e.infos,l="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,t$1="stretch-ramp"===e.type,i=e.preview,n=l?u.opacityRamp:"";i.className=`${u.colorRamp} ${n}`,null!=r&&(i.style.opacity=r.toString());const o=a.map((e=>n$5("div",{class:e.label?u.rampLabel:null},s?this.messages[e.label]||e.label:t$1?this._getStretchStopLabel(e):e.label))),p={width:`${f}px`},d={height:i.style.height};return n$5("div",{class:u.layerRow},n$5("div",{class:u.symbolContainer,styles:p},n$5("div",{class:u.rampContainer,bind:i,afterCreate:t})),n$5("div",{class:u.layerInfo},n$5("div",{class:u.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:m$3(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r$1,a,l,s){if(e.type)return this._renderLegendForElement(e,r$1,a,!0);let t$1=null;const i$1=i(r$1,s);if(e.preview?t$1=n$5("div",{class:u.symbol,bind:e.preview,afterCreate:t}):e.src&&(t$1=this._renderImage(e,r$1,i$1)),!t$1)return null;const n={[u.imageryLayerInfoStretched]:i$1},o={[u.imageryLayerInfoStretched]:i$1,[u.sizeRamp]:!i$1&&l};return n$5("div",{class:u.layerRow},n$5("div",{class:this.classes(u.symbolContainer,o)},t$1),n$5("div",{class:this.classes(u.layerInfo,n)},r(this.messages,e.label,!1)||""))}_renderImage(e,r$1,a){const{label:l,src:s,opacity:t}=e,i={[u.imageryLayerStretchedImage]:a,[u.symbol]:!a},n={opacity:`${null!=t?t:r$1.opacity}`};return n$5("img",{alt:r(this.messages,l,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})}};e([d$2()],R.prototype,"activeLayerInfos",void 0),e([d$2()],R.prototype,"headingLevel",void 0),e([d$2(),e$4("esri/widgets/Legend/t9n/Legend")],R.prototype,"messages",void 0),e([d$2({readOnly:!0})],R.prototype,"type",void 0),R=e([n$3("esri.widgets.Legend.styles.Classic")],R);const A=R;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const g={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let m=class extends M$2{constructor(e,t){super(e,t),this._handles=new t$1,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=g.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new A,this.view=null,this.viewModel=new I$1;}initialize(){this.addHandles([a$2((()=>this.view),"resize",(()=>this.scheduleRender())),a$2((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),l$5((()=>this.headingLevel),(e=>{const{style:s}=this;s&&(s.headingLevel=e);})),l$5((()=>this.style),((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel);}),h$5)]);}destroy(){this._handles=l$7(this._handles);}castStyle(e){if(e instanceof B||e instanceof A)return e;if("string"==typeof e)return "card"===e?new B:new A;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?B:A)(s)}return new A}render(){return n$5("div",{class:this.classes(g.base,g.widget,this.style instanceof A?g.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender();}_renderOnActiveLayerInfoChange(e){const s=l$5((()=>e.version),(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const t=a$2((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),h$5);this._handles.add(t,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)));}};e([o$4("viewModel.activeLayerInfos")],m.prototype,"activeLayerInfos",void 0),e([o$4("viewModel.basemapLegendVisible")],m.prototype,"basemapLegendVisible",void 0),e([o$4("viewModel.groundLegendVisible")],m.prototype,"groundLegendVisible",void 0),e([d$2()],m.prototype,"headingLevel",void 0),e([o$4("viewModel.hideLayersNotInCurrentView")],m.prototype,"hideLayersNotInCurrentView",void 0),e([o$4("viewModel.keepCacheOnDestroy")],m.prototype,"keepCacheOnDestroy",void 0),e([o$4("viewModel.respectLayerVisibility")],m.prototype,"respectLayerVisibility",void 0),e([d$2()],m.prototype,"iconClass",void 0),e([d$2({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0),e([o$4("viewModel.layerInfos")],m.prototype,"layerInfos",void 0),e([d$2(),e$4("esri/widgets/Legend/t9n/Legend")],m.prototype,"messages",void 0),e([d$2()],m.prototype,"style",void 0),e([s$8("style")],m.prototype,"castStyle",null),e([o$4("viewModel.view")],m.prototype,"view",void 0),e([d$2()],m.prototype,"viewModel",void 0),m=e([n$3("esri.widgets.Legend")],m);const L=m;

export { L as default };
