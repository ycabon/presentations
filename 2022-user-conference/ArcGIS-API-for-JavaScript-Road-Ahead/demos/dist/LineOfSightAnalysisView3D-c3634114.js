import { u as e, y as y$2, ck as l$1, z as n$2, A as m$2, aK as n$3, Y as y$3, hJ as t, f0 as y$4, fQ as G, eM as i$1, un as j, h$ as d$1, jQ as x, jR as t$1, i0 as d$2, hV as t$2, i1 as s$3, t as t$3, uo as n$4, jT as i$2, up as k, uq as r, ur as d$3, m as r$1, l7 as O$1, fP as r$2, eF as z, bn as g, g0 as u$1, i6 as h, $ as s$4, b1 as n$5, m0 as c, gg as y$5, bC as t$4, gf as I$1, fN as x$1, us as w, ut as V$1, eE as e$1, ho as U$1, bk as w$1, u7 as J$1, uu as b$1, f8 as r$3, oj as un, b8 as h$1, gh as p$1, bD as j$1, e$ as g$1, eq as n$6, d8 as i$3, lh as D, lR as vn, jc as F, uv as j$2, hP as n$7, hE as u$2, hA as T$1, i4 as v$1, b7 as l$3, eX as w$2, es as s$5, d3 as o, i8 as b$2, hC as t$5, lX as n$9, g$ as x$2, h2 as f$3, eV as g$2, fO as e$2, hk as e$3, e9 as j$3 } from './_virtual_index-1ea2035a.js';
import { n as n$a } from './AnalysisView3D-341b9eab.js';
import { l as l$2, u as u$3, f as f$2 } from './LineOfSightAnalysisTarget-e7f5e9fa.js';
import { b as a, c as c$1 } from './LineVisualElement-e2d301b0.js';
import { i as ie, A } from './manipulatorUtils-81641492.js';
import { n as n$8 } from './manipulatorUtils-70b4d4ba.js';
import { d as d$5, S } from './PointVisualElement-12207533.js';
import { a as a$1, s as s$6, m as m$3 } from './analysisViewUtils-afc4be3a.js';
import { d as d$4 } from './dragEventPipeline-b225d16a.js';
import './persistable-2efd2972.js';
import './ImageMaterial-26ca33d0.js';
import './drawUtils-716bb6e9.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let s$2=class extends m$2{constructor(o){super(o),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new l$1([3,252,111,1]),this.visibleOuterColor=new l$1([3,252,111,.15]),this.occludedInnerColor=new l$1([252,3,69,1]),this.occludedOuterColor=new l$1([252,3,69,.1]),this.undefinedInnerColor=new l$1([255,255,255,1]),this.undefinedOuterColor=new l$1([127,127,127,.2]);}};e([y$2({type:Number})],s$2.prototype,"innerWidth",void 0),e([y$2({type:Number})],s$2.prototype,"outerWidth",void 0),e([y$2({type:l$1})],s$2.prototype,"visibleInnerColor",void 0),e([y$2({type:l$1})],s$2.prototype,"visibleOuterColor",void 0),e([y$2({type:l$1})],s$2.prototype,"occludedInnerColor",void 0),e([y$2({type:l$1})],s$2.prototype,"occludedOuterColor",void 0),e([y$2({type:l$1})],s$2.prototype,"undefinedInnerColor",void 0),e([y$2({type:l$1})],s$2.prototype,"undefinedOuterColor",void 0),s$2=e([n$2("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],s$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let s$1=class extends m$2{constructor(o){super(o),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0;}};e([y$2()],s$1.prototype,"target",void 0),e([y$2()],s$1.prototype,"intersectedGraphic",void 0),e([y$2()],s$1.prototype,"intersectedLocation",void 0),e([y$2()],s$1.prototype,"elevationAlignedTargetLocation",void 0),e([y$2({type:Boolean})],s$1.prototype,"visible",void 0),s$1=e([n$2("esri.views.3d.analysis.LineOfSightAnalysisResult")],s$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let i=class extends m$2{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:n$3(),observerSurfaceNormal:null,observerFeatureId:null,target:n$3(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:n$3(),targetAdjusted:n$3()},this.computationResult={start:n$3(),end:n$3(),intersection:n$3(),isValid:!1,isTargetVisible:!1},this.result=null;}notifyResultChanged(){this.notifyChange("computationResult");}notifyInputPointsChanged(){this.notifyChange("inputPoints");}};e([y$2()],i.prototype,"target",void 0),e([y$2()],i.prototype,"elevationAlignedTargetLocation",void 0),e([y$2()],i.prototype,"inputPoints",void 0),e([y$2()],i.prototype,"computationResult",void 0),e([y$2()],i.prototype,"result",void 0),i=e([n$2("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],i);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var m$1;let y$1=m$1=class extends m$2{constructor(r){super(r);}clone(){return new m$1({type:this.type,id:y$3(this.id),mapPoint:y$3(this.mapPoint),renderPoint:t(this.renderPoint),normal:y$3(this.normal),ray:y$3(this.ray),graphic:this.graphic})}equals(r){return this.type===r.type&&this.id===r.id&&y$4(this.mapPoint,r.mapPoint)&&G(this.renderPoint,r.renderPoint)&&i$1(this.normal,r.normal)&&j(this.ray,r.ray)&&this.graphic===r.graphic}};e([y$2()],y$1.prototype,"type",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"id",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"mapPoint",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"renderPoint",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"normal",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"graphic",void 0),e([y$2({constructOnly:!0})],y$1.prototype,"ray",void 0),y$1=m$1=e([n$2("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],y$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let U=class extends m$2{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"]);}initialize(){this.intersector=x(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=t$1.MIN;}getScreenPointIntersection(e){const r=d$2(e,t$2.get()),t=s$3(this.view.state.camera,r,_$1);return this._getRayIntersection(t)}_getRayIntersection(e,r$2){if(t$3(e)||t$3(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=t$1.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,r$2);const o=this.intersector.results.min,i=n$3();if(!o.getIntersectionPoint(i))return null;const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference),c=t(o.normal);if(n$4(o))return new y$1({type:i$2.OBJECT,id:`${o.target.layerUid}/${o.target.nodeIndex}/${o.target.componentIndex}`,mapPoint:n,renderPoint:i,normal:c,ray:k(e),graphic:null});if(r(o))return new y$1({type:i$2.TERRAIN,id:o.target.lij.slice(),mapPoint:n,renderPoint:i,normal:c,ray:k(e),graphic:null});const a=d$3(o,this.view);if(r$1(a)){const r=a.layer,t=a.sourceLayer;let s;if(t)if("scene"===t.type)s=O$1(a,t.objectIdField);else s=a.uid;else s=a.uid;return new y$1({type:i$2.OBJECT,id:`${r.uid}/${s}`,mapPoint:n,renderPoint:i,normal:c,ray:k(e),graphic:a})}return null}updateFromGroundIntersection(e,r,t$1){const o=O,i=C$1,n=L,d=T;r$2(i,e),this.view.renderCoordsHelper.worldUpAtPosition(i,n),z(n,n);const u=this.view.basemapTerrain.visibleElevationBounds,h$1=u?Math.abs(u.max-u.min):100,y=r>=0?1:-1;g(d,n,y*(h$1+Math.abs(r))),u$1(o,i,d),h(o,i,_$1);const g$1=this._getRayIntersection(_$1,{include:this._terrainIntersectionOptionsLayerUids});return r$1(g$1)?(g(d,n,y*r),u$1(t$1,g$1.renderPoint,d),t(g$1.normal)):(r$2(t$1,e),null)}};e([y$2()],U.prototype,"view",void 0),e([y$2()],U.prototype,"intersector",void 0),U=e([n$2("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],U);const O=n$3(),C$1=n$3(),L=n$3(),T=n$3(),_$1=d$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const W="esri.views.3d.analysis.LineOfSight.LineOfSightController",J=s$4.getLogger(W);let K=class extends(n$5.EventedMixin(m$2)){constructor(e){super(e),this.updateOnCameraChange=!0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new c,this._frameTask=y$5,this._handles=new t$4,this._computationHandles=new t$4,this._externalObserverUpdate=!0;}initialize(){const e=this.view.resourceController?.scheduler;this._frameTask=e?e.registerTask(I$1.LINE_OF_SIGHT_TOOL):y$5,this._intersector=new U({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()]);}destroy(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy();}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e;}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(e){this.analysisViewData.observerEngineLocation=e;}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(e){const t=e.computation,{inputPoints:o,computationResult:i}=t,{observerAdjusted:n,targetAdjusted:r}=o,{start:s,end:a}=i;r$2(s,n),r$2(a,r);this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result});}_updateAdjustedPointsFromFeatures(e){const o=this.view,{sceneIntersectionHelper:i}=o,{inputPoints:n}=e,{observerAdjusted:r,observerFeatureId:s,targetFeatureId:a,targetAdjusted:l}=n;if(t$3(s)&&t$3(a))return;const u=x$1(r,l),p=this._intersector.intersector,h$1=h(n.observer,n.target,Y);p.options.store=t$1.ALL,i.intersectToolIntersectorRay(h$1,p);let g=null,v=null,m=null,f=null;for(const _ of p.results.all){const e=d$3(_,this.view);if(t$3(e)||t$3(_.distanceInRenderSpace))continue;const i=l$2(e);t$3(i)||(r$1(s)&&i===s&&(t$3(g)&&(g=this._getFeatureDistanceThreshold(_,o,u)),_.distanceInRenderSpace<g&&(m=_)),r$1(a)&&i===a&&(t$3(v)&&(v=this._getFeatureDistanceThreshold(_,o,u)),t$3(f)&&_.distanceInRenderSpace<u&&u-_.distanceInRenderSpace<v&&(f=_)));}r$1(m)&&m.getIntersectionPoint(r)&&(n.observerSurfaceNormal=m.getTransformedNormal(n$3())),r$1(f)&&f.getIntersectionPoint(l)&&(n.targetSurfaceNormal=f.getTransformedNormal(n$3()));}_getFeatureDistanceThreshold(e,t,o){if(w(e)){const i=V$1(e,t);if(r$1(i))return Math.min(i*ee,o)}return 1e-5*o}_adjustStartEndPositions(e){const t=this._screenPixelSize,o=this.view,{inputPoints:i}=e,{observer:n,observerSurfaceNormal:r,target:s,targetSurfaceNormal:a,observerAdjusted:l,targetAdjusted:c}=i,u=X;r$2(l,n),r$2(c,s),this._updateAdjustedPointsFromFeatures(e),r$1(r)?r$2(u,r):e$1(u,c,l);const p=t;z(u,u),g(u,u,Math.min(p,1)),u$1(l,l,u),r$1(a)?r$2(u,a):e$1(u,l,c);const h=o.state.camera.computeScreenPixelSizeAt(c);z(u,u),g(u,u,Math.min(h,1)),u$1(c,c,u);}_computeIntersection({computation:e,interpolationInfo:t}){const{view:o}=this,{sceneIntersectionHelper:i,renderCoordsHelper:n}=o;if(t$3(i))return;const r=this._intersector.intersector,{computationResult:s,inputPoints:a}=e,{observer:l,target:u}=a,{start:p,end:h$1}=s,g=h(p,h$1,Y);r.options.store=t$1.MIN,i.intersectToolIntersectorRay(g,r);const v=r.results.min,m=s.intersection,f=X;let b=!0;if(r$1(v)&&v.getIntersectionPoint(m)){r$2(t.originalIntersection,m),r$2(t.originalObserver,p),r$2(t.originalTarget,h$1),n.fromRenderCoords(m,f,o.spatialReference);const e=1-U$1(h$1,u)/U$1(p,u);b=U$1(l,m)>=e*U$1(l,u);}const y=new w$1(f,o.spatialReference);{const{result:t,target:i}=e;r$1(t)?(t.target=i,t.intersectedGraphic=b?null:d$3(v,o),t.intersectedLocation=b?null:y,t.visible=b):e.result=new s$1({target:i,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:b?null:d$3(v,o),intersectedLocation:b?null:y,visible:b});}s.isValid=a.isValid=!0,s.isTargetVisible=b;}_interpolateIntersection({computation:e,interpolationInfo:t}){const{computationResult:o,inputPoints:i}=e,{start:n,end:r,intersection:s}=o,{originalIntersection:a,originalObserver:l,originalTarget:c}=t;if(r$2(s,a),i.isValid){const e=X,t=U$1(l,a)/U$1(l,c);J$1(e,n,l),g(e,e,1-t),u$1(s,s,e),J$1(e,r,c),g(e,e,t),u$1(s,s,e),o.isValid=!0;}else e.result=null,o.isValid=!1,o.isTargetVisible=!1;}_canCompute(e){const t=this.analysisViewData.elevationAlignedObserver,o=this.view.frustum;if(t$3(t)||t$3(e.elevationAlignedTargetLocation)||t$3(o))return !1;const{observerAdjusted:i,targetAdjusted:n}=e.inputPoints,r=o.intersectsPoint(i),s=o.intersectsPoint(n);return r&&s}_onObserverPositionChange(e,o,i,n,r){if(this._externalObserverUpdate=r,t$3(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(t$3(o))return a(this.analysis,e.spatialReference,J),void(this.analysisViewData.elevationAlignedObserver=null);const s=this._getEffectiveElevationInfo(o,i),{absoluteZ:a$1,elevation:l}=b$1(o.x,o.y,o.z,this.view.spatialReference,this.view,s),d=o.clone();d.z=a$1,this._effectiveObserverElevationMode=s.mode,this.analysisViewData.elevationAlignedObserver=d;const u=n$3();this.view.renderCoordsHelper.toRenderCoords(d,u),this._elevationAlignedObserverPositionRenderSpace=u,this._observerGroundOffsetRenderSpace=a$1-l,this._observerFeatureId=l$2(n),this.priority=I$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_onObserverRenderSpacePositionChangeForComputation(e,t,o,i,n){const{inputPoints:r}=e;switch(r$2(r.observer,t),r.observerFeatureId=n,r.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(r.observer,o,r.observer);t$3(r.observerFeatureId)&&(r.observerSurfaceNormal=e);}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=I$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_onTargetPositionChange(e,o,i,n,r,s=!0){const a$1=e.inputPoints;if(s&&(a$1.isValid=!1),t$3(i))return r$1(o)&&a(this.analysis,o.spatialReference,J),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();const l=this._getEffectiveElevationInfo(i,n),{absoluteZ:u,elevation:p}=b$1(i.x,i.y,i.z,this.view.spatialReference,this.view,l),h=i.clone();switch(h.z=u,e.elevationAlignedTargetLocation=h,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a$1.target),a$1.targetFeatureId=l$2(r),a$1.targetSurfaceNormal=null,l.mode){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(a$1.target,u-p,a$1.target);t$3(a$1.targetFeatureId)&&(a$1.targetSurfaceNormal=e);}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=I$1.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_connectComputationToTarget(e){return r$3([this._updatingHandles.add((()=>({computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:un(e.target.position,this.view.spatialReference)})),(({computation:e,targetPosition:t,targetElevationInfo:o,targetFeatureInfo:i,projectedTargetPosition:n})=>{r$1(n.pending)?this._updatingHandles.addPromise(n.pending):this._onTargetPositionChange(e,t,n.geometry,o,i);}),h$1)])}_connectComputationToObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this.analysisViewData.elevationAlignedObserver})),(({computation:e})=>{this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged());}),h$1)}_connectComputationToRenderSpaceObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(({computation:e,observer:t,observerGroundOffset:o,observerElevationMode:i,observerFeatureId:n})=>{this._onObserverRenderSpacePositionChangeForComputation(e,t,o,i,n);}),h$1)}_connectComputationToCamera(e){return this._updatingHandles.add((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(({isDirty:t})=>{!this.updateOnCameraChange||e.inputPoints.isValid&&!t||e.notifyInputPointsChanged();}))}_connectComputationToSlicePlane(e){return this._updatingHandles.add((()=>this.view.slicePlane),(()=>{e.inputPoints.isValid=!1,e.notifyInputPointsChanged();}))}_connectComputationToElevation(e){const t=(o,i)=>{const n=this.analysis.observer,r=e.target;let s=null,a=null,l=null,u=null,p=null,h=null;if(r$1(n)&&r$1(n.position)){const e=un(n.position,this.view.spatialReference);if(r$1(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(o,i)));s=e.geometry,a=n.elevationInfo,l=n.feature;}if(r$1(r.position)){const e=un(r.position,this.view.spatialReference);if(r$1(e.pending))return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(o,i)));u=e.geometry,p=r.elevationInfo,h=r.feature;}t$3(s)&&t$3(u)||(vn(o,i,$,this.view.spatialReference),r$1(s)&&F($,s)&&this._onObserverPositionChange(r$1(n)?n.position:null,s,a,l,!1),r$1(u)&&F($,u)&&this._onTargetPositionChange(e,r.position,u,p,h,!1),r$1(s)&&r$1(u)&&j$2($,s,u)&&e.notifyInputPointsChanged());};return this.view.elevationProvider.on("elevation-change",(e=>t(e.extent,e.spatialReference)))}_connectComputationToTask(e){let t=n$7;const o={computation:e,interpolationInfo:{originalIntersection:n$3(),originalObserver:n$3(),originalTarget:n$3()}};return r$3([this._updatingHandles.add((()=>e.inputPoints),(()=>{t=p$1(t),t=j$1((async e=>{await g$1(this._frameTask.schedule((()=>this._computeResult(o)),e));}));}),{initial:!0,equals:()=>!1}),n$6((()=>t=p$1(t)))])}_connectComputation(e){const t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e);}_disconnectComputation(e){this._computationHandles.remove(e);}_onComputationCollectionChange({added:e,removed:t}){for(const o of t)this._disconnectComputation(o);for(const o of e)this._connectComputation(o);}_onTargetCollectionChange({added:e,removed:t}){for(const o of t)this._removeTarget(o);for(const o of e)this._addTarget(o);}_onCursorTargetChange(e,t){r$1(t)&&this._removeTarget(t),r$1(e)&&this._addTarget(e);}_addTarget(e){this._computations.some((t=>t.target===e))||this._computations.add(new i({target:e}));}_removeTarget(e){const t=this._computations.findIndex((t=>t.target===e));this._computations.removeAt(t);}_connectObserver(){return r$3([this._updatingHandles.add((()=>({observerPosition:r$1(this.analysis.observer)?this.analysis.observer.position:null,projectedObserverPosition:un(r$1(this.analysis.observer)?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:r$1(this.analysis.observer)?this.analysis.observer.elevationInfo:null,observerFeatureInfo:r$1(this.analysis.observer)?this.analysis.observer.feature:null})),(({observerPosition:e,projectedObserverPosition:t,observerElevationInfo:o,observerFeatureInfo:i})=>{r$1(t.pending)?this._updatingHandles.addPromise(t.pending):this._onObserverPositionChange(e,t.geometry,o,i,!0);}),h$1)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this._computations),(e=>this._onComputationCollectionChange(e)),{initial:!0,final:!0})}_connectTargets(){return r$3([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(e=>this._onTargetCollectionChange(e)),{initial:!0,final:!0}),this._updatingHandles.add((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t);}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:o}=t;if(t$3(e)||t$3(o))return !1;const i=X;o.toRenderCoords(e,i);const n=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((n-this._screenPixelSize)/this._screenPixelSize)>Q}_getEffectiveElevationInfo(e,t){return e.hasZ?i$3(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}};e([y$2({constructOnly:!0})],K.prototype,"analysis",void 0),e([y$2({constructOnly:!0})],K.prototype,"analysisViewData",void 0),e([y$2({constructOnly:!0})],K.prototype,"view",void 0),e([y$2()],K.prototype,"updating",null),e([y$2()],K.prototype,"priority",null),e([y$2()],K.prototype,"updateOnCameraChange",void 0),e([y$2()],K.prototype,"_computations",null),e([y$2()],K.prototype,"_elevationAlignedObserverPositionRenderSpace",null),e([y$2()],K.prototype,"_observerGroundOffsetRenderSpace",void 0),e([y$2()],K.prototype,"_effectiveObserverElevationMode",void 0),e([y$2()],K.prototype,"_observerFeatureId",void 0),e([y$2()],K.prototype,"_screenPixelSize",null),e([y$2({readOnly:!0})],K.prototype,"_updatingHandles",void 0),e([y$2()],K.prototype,"_frameTask",void 0),e([y$2()],K.prototype,"_isCameraDirty",null),K=e([n$2(W)],K);const Q=.1,X=n$3(),Y=d$1(),$=D(),ee=.05;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let s=class extends m$2{constructor(e){super(e),this.enabled=!0,this.glowColor=new l$1([255,127,0]),this.glowWidth=8,this.innerColor=new l$1([255,255,255]),this.innerWidth=.75,this.globalAlpha=.75;}};e([y$2({type:Boolean})],s.prototype,"enabled",void 0),e([y$2({type:l$1})],s.prototype,"glowColor",void 0),e([y$2({type:Number})],s.prototype,"glowWidth",void 0),e([y$2({type:l$1})],s.prototype,"innerColor",void 0),e([y$2({type:Number})],s.prototype,"innerWidth",void 0),e([y$2({type:Number})],s.prototype,"globalAlpha",void 0),s=e([n$2("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],s);let n$1=class extends m$2{constructor(e){super(e),this.size=.5,this.color=new l$1([255,127,0,.75]);}};e([y$2({type:Number})],n$1.prototype,"size",void 0),e([y$2({type:l$1})],n$1.prototype,"color",void 0),n$1=e([n$2("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],n$1);let p=class extends m$2{constructor(e){super(e),this.size=.5,this.visibleColor=new l$1([3,252,111,.75]),this.occludedColor=new l$1([252,3,69,.75]),this.undefinedColor=new l$1([127,127,127,.75]);}};e([y$2({type:Number})],p.prototype,"size",void 0),e([y$2({type:l$1})],p.prototype,"visibleColor",void 0),e([y$2({type:l$1})],p.prototype,"occludedColor",void 0),e([y$2({type:l$1})],p.prototype,"undefinedColor",void 0),p=e([n$2("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],p);class l extends m$2{constructor(e){super(e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new l$1([3,252,111,1]),this.visibleOuterColor=new l$1([3,252,111,.15]),this.occludedInnerColor=new l$1([252,3,69,1]),this.occludedOuterColor=new l$1([252,3,69,.1]),this.undefinedInnerColor=new l$1([255,255,255,1]),this.undefinedOuterColor=new l$1([127,127,127,.2]);}}e([y$2({type:Number})],l.prototype,"innerWidth",void 0),e([y$2({type:Number})],l.prototype,"outerWidth",void 0),e([y$2({type:l$1})],l.prototype,"visibleInnerColor",void 0),e([y$2({type:l$1})],l.prototype,"visibleOuterColor",void 0),e([y$2({type:l$1})],l.prototype,"occludedInnerColor",void 0),e([y$2({type:l$1})],l.prototype,"occludedOuterColor",void 0),e([y$2({type:l$1})],l.prototype,"undefinedInnerColor",void 0),e([y$2({type:l$1})],l.prototype,"undefinedOuterColor",void 0);let d=class extends m$2{constructor(e){super(e),this.laserLine=new s,this.observer=new n$1,this.target=new p,this.lineOfSight=new l;}};e([y$2({type:s})],d.prototype,"laserLine",void 0),e([y$2({type:n$1})],d.prototype,"observer",void 0),e([y$2({type:p})],d.prototype,"target",void 0),e([y$2({type:l})],d.prototype,"lineOfSight",void 0),d=e([n$2("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],d);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function m(t,e,s){return {geometry:T$1(t,32,32),material:A(l$1.toUnitRGBA(e)),stateMask:s}}function n(o){const t=[];return o.customColor1&&t.push(m(o.size,o.customColor1,u$2.Custom1)),o.customColor2&&t.push(m(o.size,o.customColor2,u$2.Custom2)),o.customColor3&&t.push(m(o.size,o.customColor3,u$2.Custom3)),o.color&&t.push(m(o.size,o.color)),t}function u(o,r){const i=n(r),s=new ie({view:o,renderObjects:i,elevationInfo:{mode:"absolute-height",offset:0}});return n$8(s),s}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var I;!function(e){e.Ready="ready",e.Creating="creating",e.Created="created";}(I||(I={}));let H=class extends a$1{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.configuration=new d,this.analysisViewData=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new t$4,this._handles=new t$4,this._updatingHandles=new c,this._manipulatorHandles=new t$4,this._targetTrackerManipulator=null;}initialize(){this._intersector=new U({view:this.view}),this._handles.add(l$3((()=>this.state),(e=>{e===I.Created&&this.finishToolCreation();}),w$2)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([this._updatingHandles.add((()=>({...this.configuration.observer})),(()=>this._updateObserverManipulatorStyle())),this._updatingHandles.add((()=>this.analysisViewData.elevationAlignedObserver),(e=>this._onObserverLocationChange(e)),h$1),this._updatingHandles.add((()=>({...this.configuration.laserLine})),(()=>this._createVisualElements()),h$1),this._updatingHandles.add((()=>this._laserLineRendererDependencies()),(e=>this._updateLaserLineRenderer(e))),this._connectComputations(),this._updatingHandles.addWhen((()=>!this._shouldRenderTracker),(()=>this._clearCursorTracker()),h$1)]);}destroy(){this._updatingHandles=s$5(this._updatingHandles),this._handles=s$5(this._handles),this._manipulatorHandles=s$5(this._manipulatorHandles),this._analysisHandles=s$5(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null);}get state(){return this.active?this.hasGrabbedManipulators?I.Created:I.Creating:r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)?I.Created:I.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return r$1(this.analysisViewData)&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){return this._showTracker&&r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this;}stop(){this.view.activeTool=null;}onEditableChange(){this.analysisViewData.editable=this.internallyEditable;}onInputEvent(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);}}onInputEventAfter(e){if("immediate-click"===e.type)this._clickHandler(e);}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker();}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange({added:e,removed:t}){for(const i of t)this._disconnectComputation(i);for(const i of e)this._connectComputation(i);}_connectComputation(e){if(this.destroyed)return void s$4.getLogger(this.declaredClass).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const t=this._analysisHandles;if(t.has(e))return;const i=this._createTargetManipulator(e.target);t$3(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),t.add([this._updatingHandles.add((()=>this._getLineOfSightManipulatorStateDependencies(e)),(()=>this._updateManipulatorState(i,e)),h$1),this._updatingHandles.add((()=>e.elevationAlignedTargetLocation),(e=>this._onTargetLocationChange(e,i)),h$1)],e);}_disconnectComputation(e){if(this.destroyed)return void s$4.getLogger(this.declaredClass).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(e);const t=this._getTargetManipulator(e.target);r$1(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),r$1(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null));}_clearCursorTracker(){this.analysisViewData.cursorTarget=s$5(this.analysisViewData.cursorTarget);}_createManipulator(e,t,i){const a=u(this.view,e);return a.metadata=i,this._manipulatorHandles.add([t(a),a.events.on("grab-changed",(e=>this._manipulatorGrabChanged(a,e))),a.events.on("immediate-click",(e=>this._manipulatorClick(a,e)))],a),this.manipulators.add(a),a}_createTargetManipulator(e){const t=this.configuration,i={size:t.target.size,customColor1:t.target.visibleColor,customColor2:t.target.occludedColor,customColor3:t.target.undefinedColor,visible:!0},a={target:e,type:"target"},r=this._createManipulator(i,(e=>this._createTargetManipulatorDragPipeline(e)),a);return r$1(e.position)?r.elevationAlignedLocation=e.position:r.available=!1,r}_getTargetManipulator(e){let t=null;return this.manipulators.forEach((i=>{const a=i.manipulator;t$3(t)&&"target"===a.metadata.type&&a.metadata.target===e&&(t=a);})),t}_createObserverManipulator(){const e=this.configuration,t={size:e.observer.size,color:e.observer.color,visible:!0};return this._createManipulator(t,(e=>this._createObserverManipulatorDragPipeline(e)),{type:"observer",intersection:null})}_updateObserverManipulatorStyle(){const e=this._observerManipulator,t=this.configuration.observer,i={size:t.size,color:t.color,visible:e.available};e.renderObjects=n(i);}_screenToIntersection(){return e=>{const t=this._intersector.getScreenPointIntersection(e.screenEnd);return t$3(t)?null:{...e,intersection:t}}}_createTargetManipulatorDragPipeline(e){return d$4(e,((t,i,a)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(e)).next((()=>this._updateLaserLineRenderer())),a.next(this._cancelTargetDragStep(e.metadata.target)).next((()=>this._updateLaserLineRenderer()));}))}_createObserverManipulatorDragPipeline(e){return d$4(e,((e,t,i)=>{t.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()));}))}_updateObserverDragStep(){return e=>(r$1(e.intersection.mapPoint)?(t$3(this.analysis.observer)&&(this.analysis.observer=new u$3),this._updateFromIntersection(this.analysis.observer,e.intersection)):this.analysis.observer=null,e)}_cancelObserverDragStep(){const e=r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)?this.analysis.observer.clone():null;return t=>(this.analysis.observer=e,t)}_updateTargetDragStep(e){return t=>{this._updateFromIntersection(e.metadata.target,t.intersection);const i=t.intersection.mapPoint;return r$1(i)&&(e.elevationAlignedLocation=i),t}}_cancelTargetDragStep(e){const t=o(e.position,(e=>e.clone()));return i=>(e.position=t,i)}_manipulatorGrabChanged(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null);}}_updateManipulatorState(e,t){const{isValid:i,isTargetVisible:a}=t.computationResult;e.state=i?a?u$2.Custom1:u$2.Custom2:u$2.Custom3;}_getLineOfSightManipulatorStateDependencies(e){const{isValid:t,isTargetVisible:i}=e.computationResult;return {isValid:t,isTargetVisible:i}}_laserLineRendererDependencies(){return {laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:r$1(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(e=this._laserLineRendererDependencies()){const{laserlineVisualElement:t,grabbedManipulator:i,shouldRenderTracker:a,observerPosition:r,visible:s}=e;if(t$3(t))return;const n=r$1(i)?i:a&&r$1(r)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&r$1(n)&&s?(t.visible=!0,t.heightManifoldTarget=n.renderLocation,n!==this._observerManipulator?t.lineVerticalPlaneSegment=b$2(this._observerManipulator.renderLocation,n.renderLocation,P):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null);}_createVisualElements(){const e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new d$5({view:this.view,attached:!0,visible:this.visible,style:{glowColor:l$1.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:l$1.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}});}_removeVisualElements(){r$1(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null);}_onObserverLocationChange(e){t$3(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e);}_onTargetLocationChange(e,t){r$1(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1;}_addPointFromClickEvent(e){const t=this._intersector.getScreenPointIntersection(e);if(!t$3(t)&&!t$3(t.mapPoint))if(r$1(this.analysis.observer)&&r$1(this.analysis.observer.position)){this._clearCursorTracker();const e=new f$2;this._updateFromIntersection(e,t),this.analysis.targets.add(e);}else {const e=new u$3;this._updateFromIntersection(e,t),this.analysis.observer=e;}}_clickHandler(e){this.active&&e.button!==t$5.Right&&(this._addPointFromClickEvent(n$9(e)),e.stopPropagation());}_doubleClickHandler(e){this.active&&e.button!==t$5.Right&&(this.stop(),e.stopPropagation());}_keyDownHandler(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation());}_pointerMoveHandler(e){if(this.hasGrabbedManipulators)return;if(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),!this._showTracker||t$3(this.analysis.observer)||t$3(this.analysis.observer.position))return;const t=n$9(e),i=this._intersector.getScreenPointIntersection(t);r$1(i)&&r$1(i.mapPoint)&&(t$3(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new f$2),this._updateFromIntersection(this.analysisViewData.cursorTarget,i),this._updateLaserLineRenderer());}_updateFromIntersection(e,t){if(t$3(t.mapPoint))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case i$2.OBJECT:if(r$1(t.graphic)){const i=t.graphic,a=f$3(i);"on-the-ground"===a.mode&&(a.mode="relative-to-ground",a.offset=0),e.elevationInfo=new x$2(a),e.feature=i;}else e.elevationInfo=null,e.feature=null;break;case i$2.TERRAIN:case i$2.I3S:e.elevationInfo=new x$2({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null;}const i=t.mapPoint.clone();i.z=g$2(this.view,i,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=i;}_manipulatorClick(e,t){if("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==t$5.Right||this.analysis.targets.length<=1)return;const{target:i}=e.metadata;this.analysis.targets.remove(i),t.stopPropagation();}get testInfo(){return {laserLineVisualElement:this._laserlineVisualElement}}};e([y$2({constructOnly:!0})],H.prototype,"view",void 0),e([y$2({constructOnly:!0})],H.prototype,"analysis",void 0),e([y$2({readOnly:!0})],H.prototype,"state",null),e([y$2({readOnly:!0})],H.prototype,"cursor",null),e([y$2()],H.prototype,"removeIncompleteOnCancel",void 0),e([y$2({readOnly:!0})],H.prototype,"updating",null),e([y$2({type:d})],H.prototype,"configuration",void 0),e([y$2({constructOnly:!0})],H.prototype,"analysisViewData",void 0),e([y$2({readOnly:!0})],H.prototype,"_showTracker",null),e([y$2()],H.prototype,"_latestPointerMovePointerType",void 0),e([y$2()],H.prototype,"_shouldRenderTracker",null),e([y$2()],H.prototype,"_laserlineVisualElement",void 0),e([y$2()],H.prototype,"_grabbedManipulator",void 0),H=e([n$2("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],H);const P=v$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let f$1=class extends m$2{constructor(i){super(i),this._lineOfSightVisualizations=[],this._computationHandles=new t$4,this._updatingHandles=new c;}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization();}destroy(){this._updatingHandles=s$5(this._updatingHandles),this._computationHandles=s$5(this._computationHandles),this._observerVisualElement=s$5(this._observerVisualElement);}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get testInfo(){return {visualizations:this._lineOfSightVisualizations}}get _configuration(){return this.analysisViewData.configuration}_createLineOfSightVisualization(){const i=this._configuration,t=this.view,n={view:t,attached:!0,width:i.outerWidth,innerWidth:i.innerWidth},o=l$1.toUnitRGBA(i.visibleOuterColor),s=l$1.toUnitRGBA(i.visibleInnerColor),a=l$1.toUnitRGBA(i.occludedOuterColor),l=l$1.toUnitRGBA(i.occludedInnerColor),r=l$1.toUnitRGBA(i.undefinedOuterColor),u=l$1.toUnitRGBA(i.undefinedInnerColor),c={visibleLineVisualElement:new c$1({...n,color:o,innerColor:s}),occludedLineVisualElement:new c$1({...n,color:a,innerColor:l}),undefinedLineVisualElement:new c$1({...n,color:r,innerColor:u}),targetVisualElement:new S({view:t,attached:!0,...b,size:8})};return this._lineOfSightVisualizations.push(c),c}_destroyLineOfSightVisualization(i){i.visibleLineVisualElement=s$5(i.visibleLineVisualElement),i.occludedLineVisualElement=s$5(i.occludedLineVisualElement),i.undefinedLineVisualElement=s$5(i.undefinedLineVisualElement),i.targetVisualElement=s$5(i.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(i),1);}_updateLineOfSightVisualization(i,t,n){const o=this._configuration,{computationResult:s,inputPoints:l}=i,{start:r,end:u,intersection:c,isValid:h,isTargetVisible:p}=s,{observer:v}=l,g=C;g[12]=v[0],g[13]=v[1],g[14]=v[2];const f=e$1(V,r,v),b=e$1(_,u,v),O=e$1(y,c,v),{visibleLineVisualElement:E,occludedLineVisualElement:A,undefinedLineVisualElement:L,targetVisualElement:w}=t,z=t$3(this.analysisViewData.elevationAlignedObserver)||t$3(i.elevationAlignedTargetLocation),S=this.visible&&!z;E.visible=S,A.visible=S,L.visible=S,w.visible=S,w.attached=!n.interactiveAndEditable,S&&(E.geometry=null,A.geometry=null,L.geometry=null,w.geometry=i.elevationAlignedTargetLocation,h?p?(E.geometry=[[e$2(f),e$2(b)]],E.transform=g,E.color=l$1.toUnitRGBA(o.visibleOuterColor),w.color=l$1.toUnitRGBA(o.visibleInnerColor)):(E.geometry=[[e$2(f),e$2(O)]],E.transform=g,E.color=l$1.toUnitRGBA(o.occludedOuterColor),A.geometry=[[e$2(O),e$2(b)]],A.transform=g,w.color=l$1.toUnitRGBA(o.occludedInnerColor)):(L.geometry=[[e$2(f),e$2(b)]],L.transform=g,w.color=l$1.toUnitRGBA(o.undefinedInnerColor)));}_getLineOfSightVisualizationDependencies(i){const{computationResult:e}=i,{occludedOuterColor:t,visibleOuterColor:n}=this._configuration;return {computationResult:e,occludedOuterColor:t,visibleOuterColor:n,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(i){const e=this._computationHandles;if(e.has(i))return;const t=this._createLineOfSightVisualization();e.add([this._updatingHandles.add((()=>this._getLineOfSightVisualizationDependencies(i)),(e=>this._updateLineOfSightVisualization(i,t,e)),{initial:!0,equals:()=>!1}),n$6((()=>this._destroyLineOfSightVisualization(t)))],i);}_disconnectComputation(i){this._computationHandles.remove(i);}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(i=>this._onComputationsCollectionChange(i)),{initial:!0,final:!0})}_onComputationsCollectionChange({added:i,removed:e}){for(const t of e)this._disconnectComputation(t);for(const t of i)this._connectComputation(t);}_createObserverVisualization(){const i=l$1.toUnitRGBA(this._configuration.visibleInnerColor),t=new S({view:this.view,attached:!1,color:i,...b});this._observerVisualElement=t,this.addHandles(this._updatingHandles.add((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(({observer:i,interactiveAndEditable:e,visible:n})=>{t$3(i)||e||!n?t.attached=!1:(t.geometry=i,this._observerVisualElement.attached=!0);}),h$1));}};e([y$2({constructOnly:!0})],f$1.prototype,"analysis",void 0),e([y$2({constructOnly:!0})],f$1.prototype,"analysisViewData",void 0),e([y$2({constructOnly:!0})],f$1.prototype,"view",void 0),e([y$2({readOnly:!0})],f$1.prototype,"visible",null),e([y$2()],f$1.prototype,"updating",null),e([y$2()],f$1.prototype,"interactiveAndEditable",null),e([y$2()],f$1.prototype,"testInfo",null),e([y$2()],f$1.prototype,"_configuration",null),f$1=e([n$2("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],f$1);const b={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},V=n$3(),_=n$3(),y=n$3(),C=e$3();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let f=class extends(n$a(n$5.EventedMixin(m$2))){constructor(t){super(t),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new j$3,this.elevationAlignedObserver=null,this.configuration=new s$2,this.observerEngineLocation=n$3(),this.cursorTarget=null,this.editable=!0;}initialize(){const t=this.view,i=this.analysis;this._analysisController=new K({analysis:i,analysisViewData:this,view:t}),this._analysisVisualization=new f$1({analysis:i,analysisViewData:this,view:t}),this.addHandles([this._analysisController.on("result-changed",(t=>{t.target!==this.cursorTarget&&this.emit("result-changed",t);})),s$6(this,H)]);}destroy(){m$3(this),this._analysisController=s$5(this._analysisController),this._analysisVisualization=s$5(this._analysisVisualization);}get results(){return this.computations.map((t=>t.result))}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t;}get updating(){return r$1(this._analysisController)&&this._analysisController.updating||r$1(this._analysisVisualization)&&this._analysisVisualization.updating}getResultForTarget(t){const i=this.computations.find((i=>i.target===t));return o(i,(t=>t.result))}get testInfo(){return {visualization:this._analysisVisualization,controller:this._analysisController}}};e([y$2({readOnly:!0})],f.prototype,"type",void 0),e([y$2({constructOnly:!0,nonNullable:!0})],f.prototype,"analysis",void 0),e([y$2()],f.prototype,"tool",void 0),e([y$2({readOnly:!0})],f.prototype,"results",null),e([y$2()],f.prototype,"priority",null),e([y$2()],f.prototype,"computations",void 0),e([y$2()],f.prototype,"elevationAlignedObserver",void 0),e([y$2()],f.prototype,"configuration",void 0),e([y$2()],f.prototype,"observerEngineLocation",void 0),e([y$2()],f.prototype,"cursorTarget",void 0),e([y$2()],f.prototype,"updating",null),e([y$2()],f.prototype,"editable",void 0),e([y$2()],f.prototype,"_analysisController",void 0),e([y$2()],f.prototype,"_analysisVisualization",void 0),f=e([n$2("esri.views.3d.analysis.LineOfSightAnalysisView3D")],f);const v=f;

export { v as default };
