import { av as r$f, f3 as r$g, eL as n$d, b8 as n$e, c0 as e$a, gO as e$b, r as r$h, fi as O$5, fT as e$e, fE as n$f, g9 as u$b, aK as c$d, dD as A$5, t as t$d, eg as x$5, ff as t$e, e8 as r$k, aI as r$l, aA as o$9, ay as n$g, aH as n$h, gP as n$i, be as t$f, df as l$9, du as e$f, dw as _$3, dv as z$6, a$ as g$5, eT as u$c, dt as P$6, gQ as l$b, B as e$i, aT as o$k, gR as M$4, Z as s$l, bc as a$b, a_ as s$m, gS as _$7, fZ as x$6, g5 as Pn, gT as l$f, eA as v$9, gU as l$g, gV as s$n, gW as o$l, f$ as k$4, bi as u$f, gX as t$l, eK as e$o, gM as m$8, gp as b$8, gY as l$h, gZ as l$i, cQ as $$5, g_ as I$5, g$ as y$3, h0 as N$2, a as n$l, fR as Un, h1 as qn, gf as p$9, h2 as a$c, h3 as r$n, h4 as n$m, gG as i$i, es as l$j, g1 as a$f, ge as h$c, g2 as S$8, fd as e$p, eM as r$o, aF as r$p, C as d$c, D as n$o, E as f$g, h5 as H$4, h6 as z$7, h7 as a$h, h8 as T$9, ax as n$p, ai as s$q, eP as a$i, h9 as A$7, ha as g$8, hb as l$l, hc as k$5, hd as m$9, gN as o$q, e7 as F$5, fa as D$3, he as E$7, hf as J$3, hg as Z$5, hh as X$3, hi as b$a, b4 as i$k, fC as w$5, hj as s$r, eR as H$6, hk as Q$5, fB as c$h, eS as j$8, hl as F$6, fg as l$m, hm as f$i, b6 as s$t, fz as l$n, eH as A$8, fx as b$b, dk as o$s, eX as j$9, hn as g$9, eW as v$a, ho as s$u, hp as u$i, hq as b$c, aq as n$q, cG as f$j, hr as s$w, hs as u$k, ht as i$o, hu as s$x, hv as h$h, hw as n$s, al as e$s, aJ as o$x, eu as v$b, aP as l$r, d$ as w$6, fw as a$k, et as A$9, fD as p$d, hx as n$u, hy as G$4, fH as x$8, hz as t$r, ga as u$m, hA as ne$3, hB as H$7, gk as Hn, hC as E$8 } from './_virtual_index-a68dd1ed.js';
import { r as r$m, n as n$j, t as t$g } from './vec3f32-3c06790e.js';
import { l as l$8, p as p$8, _ as _$4, q as q$2, j as j$7, W as W$3, Z as Z$4 } from './plane-999ac6bd.js';
import { R as R$6, C as C$2, j as j$6, d as d$d, f as f$h, p as p$b, l as l$o } from './sphere-a826bb8b.js';
import { u as u$a, i as i$f, j as a$8, o as o$e, W as W$2, c as c$f, A as A$6, f as l$c, d as a$a, E as E$3, _ as _$5, e as _$6, b as s$p, h as h$f, g as a$g, n as n$n, S as S$9, k as l$k, O as O$7, a as t$q, l as l$q } from './requestImageUtils-3044e709.js';
import { k as e$8, b as e$9, n as n$c, T as r$i, r as e$c, U as c$c, V as f$c, s as g$4, o as o$b, e as e$g, W as o$c, X as o$d, Y as e$h, Z as a$9, v as c$e, m as m$6, h as e$j, w as h$a, F as s$j, c as o$f, _ as t$h, $ as o$g, A as v$6, d as e$k, C as n$k, y as u$d, z as e$l, D as t$i, f as e$m, g as o$h, O as e$n, P as o$i, Q as f$d, a0 as s$k, a1 as m$7, a2 as l$d, a3 as P$7, a4 as i$g, p as E$5, t as t$j, G as d$9, q as o$j, a5 as u$e, I as t$k, a6 as v$8, L as L$5, a7 as c$g, a8 as f$e, a9 as i$h, a as a$d, aa as s$o, ab as t$m, N as o$n, ac as a$e, E as E$6, ad as o$o, ae as f$f, af as d$a, ag as L$6, R as h$d, ah as o$p, M as p$a, ai as y$4, aj as g$7, ak as d$b, K as h$e, x as r$q, al as e$q, H as x$7, J as h$g, am as e$r, an as o$r, ao as u$j, ap as y$5, aq as c$i, ar as i$l, as as a$j, at as s$v, au as n$r, av as i$m, aw as o$t, ax as m$a, ay as m$b, az as c$j, aA as i$n, aB as l$p, i as t$o, l as t$p, j as o$v, aC as m$c, aD as o$w, u as u$l, aE as d$e, aF as i$p, aG as p$c, aH as i$q, aI as E$9 } from './BooleanPassUniform-2b3a4773.js';
import { l as l$a, h as h$b, g as g$6, u as u$n } from './geometryDataUtils-566f9a30.js';
import { O as O$6 } from './VertexAttribute-f7d7a686.js';
import { e as e$d, r as r$j, o as o$a } from './mat4f64-2ebd3575.js';
import { T as T$8 } from './InterleavedLayout-30cd523e.js';
import { o as o$m } from './floatRGBA-86b5337e.js';
import { E as E$4, D as D$2, R as R$7, I as I$6, Y as Y$3, V as V$2, M as M$5, P as P$8, G as G$3, L as L$7, _ as _$8, F as F$7 } from './enums-fb707d37.js';
import { c as c$l, l as l$s } from './triangulationUtils-354b53bb.js';
import { b as b$9, u as u$h, f as f$k, c as c$k, n as n$t } from './VertexArrayObject-8465ed50.js';
import { t as t$n } from './NestedMap-d8c8763b.js';
import { G as G$2, k as k$2, H as H$5, i as i$j, a as s$s } from './Octree-c3cd7251.js';
import { v as v$7, b as b$7, l as l$e, k as k$3 } from './lineSegment-0f1ab256.js';
import { u as u$g } from './Texture-6d086a89.js';
import './boundedPlane-93d1e9f2.js';
import { o as o$u } from './glUtil-2dc26fa6.js';
import { i as i$r, u as u$o } from './BufferView-0e0bd1d6.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function n$b(r){r.fragment.uniforms.add(new e$8("projInfo",((r,o)=>f$b(o)))),r.fragment.uniforms.add(new e$9("zScale",((r,o)=>i$e(o)))),r.fragment.code.add(n$c`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`);}function f$b(r){const o=r.camera.projectionMatrix;return 0===o[11]?r$g(m$5,2/(r.camera.fullWidth*o[0]),2/(r.camera.fullHeight*o[5]),(1+o[12])/o[0],(1+o[13])/o[5]):r$g(m$5,-2/(r.camera.fullWidth*o[0]),-2/(r.camera.fullHeight*o[5]),(1-o[8])/o[0],(1-o[9])/o[5])}const m$5=n$d();function i$e(o){return 0===o.camera.projectionMatrix[11]?r$f(d$8,0,1):r$f(d$8,1,0)}const d$8=n$e();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class o$8{constructor(){this._disposed=!1;}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,r,i,o,e,a){this.id=e$b(),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=o,this.origin=e,this._shaderTransformation=a,this._disposed=!1;}release(){this._disposed=!1;}dispose(){this._disposed=!0;}getStaticTransformation(){return this.transformation}getShaderTransformation(){return r$h(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return !!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(O$5(t,t,this.getStaticTransformation()),!0)}}o$8.pool=new e$a(o$8);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$e{constructor(r){this.channel=r,this.id=e$b();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class O$4 extends r$i{constructor(t={}){super(),this.type=e$c.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=e$d(),this._bvObjectSpace=new R$5,this._bvWorldSpace=new R$5,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new L$4),this.transformation=e$d();const{geometries:e,materials:s,transformations:i,origins:r}=t;if(Array.isArray(e)){e$e(s.length===e.length,"Object3D: materials don't match geometries"),e$e(i.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=e.length,this._geometries.length=e.length;for(let t=0;t<e.length;t++)this._geometries[t]=e[t],this._geometryRecords[t]=o$8.pool.acquire(e[t],s[t],r$j(i[t]),{highlights:null,occludees:null,visible:this._visible},r&&r[t]);}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){n$f(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this);}dispose(){this._geometryRecords.length=0,this._geometries.length=0;}get parentLayer(){return this._parentLayer}set parentLayer(t){e$e(null==this._parentLayer||null==t,"Object3D can only be added to a single Layer"),this._parentLayer=t;}addGeometry(e,s,i,r,o){i=i||o$a,this._geometries.push(e);const a=o$8.pool.acquire(e,s,i,{highlights:null,occludees:null,visible:this._visible},r,o);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||r$h(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(e){const s=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=r$h(s.shaderTransformation)?this._geometryRecords.some((e=>r$h(e.shaderTransformation))):this._hasVolatileTransformation,s.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:s}),this._invalidateBoundingVolume(),s}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0);}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume();}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this);}}maskOccludee(){const t=new r$e(u$a.MaskOccludee);for(const e of this._geometryRecords)e.instanceParameters.occludees=c$c(e.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const e of this._geometryRecords)e.instanceParameters.occludees=f$c(e.instanceParameters.occludees,t);this._emit("occlusionChanged",this);}highlight(){const t=new r$e(u$a.Highlight);for(const e of this._geometryRecords)e.instanceParameters.highlights=c$c(e.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const e of this._geometryRecords)e.instanceParameters.highlights=f$c(e.instanceParameters.highlights,t);this._emit("highlightChanged",this);}getCombinedStaticTransformation(t,s){return u$b(c$d(s,e$d()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,e){return e=e||e$d(),u$b(e,this.transformation,t.getShaderTransformation()),e}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const e=this._geometries[s],i=this._geometryRecords[s],r=e.boundingInfo;r$h(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,i.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this._getCombinedShaderTransformation(i)));}A$5(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),A$5(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=n$g(),i=n$g(),r=l$8(this.transformation);for(let t=0;t<this._geometryRecords.length;++t){const o=this._geometries[t].boundingInfo;if(t$d(o))continue;const a=this._geometryRecords[t].getShaderTransformation(),n=l$8(a);O$5(e,o.getCenter(),a);const h=x$5(e,this._bvObjectSpace.bounds),l=o.getBSRadius()*n;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],h+l),O$5(i,e,this.transformation);const d=x$5(i,this._bvWorldSpace.bounds),g=l*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+g);}this._bvDirty=!1;}_calculateTransformedBoundingVolume(t,e,s){const i=t.getBBMin(),r=t.getBBMax(),o=t$e(i),a=t$e(r);O$5(o,o,s),O$5(a,a,s);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],o[n],a[n]),e.max[n]=Math.max(e.max[n],o[n],a[n]);for(let n=0;n<3;++n){r$k(o,i),r$k(a,r),o[n]=r[n],a[n]=i[n],O$5(o,o,s),O$5(a,a,s);for(let t=0;t<3;++t)e.min[t]=Math.min(e.min[t],o[t],a[t]),e.max[t]=Math.max(e.max[t],o[t],a[t]);}}_invalidateBoundingVolume(){this._bvDirty=!0,r$h(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds);}_emit(e,s){r$h(this._parentLayer)&&this._parentLayer.events.emit(e,s);}get test(){const t=this;return {hasGeometry:e=>t._geometries.includes(e),getGeometryIndex:e=>t._geometries.indexOf(e)}}}class L$4{constructor(){this.min=r$l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=r$l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class R$5 extends L$4{constructor(){super(...arguments),this.bounds=R$6();}init(){o$9(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o$9(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),C$2(this.bounds);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const e$7=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class l$7 extends r$i{constructor(s,r=""){super(),this.apiLayerUid=r,this.type=e$c.Layer,this.events=new n$h,this.isSliceable=!1,this._objects=new n$i,this._stageHandles=new t$f,this.apiLayerUid=r,this.isVisible=s?.isVisible??!0,this.isPickable=s?.isPickable??!0,this.updatePolicy=s?.updatePolicy??i$f.ASYNC;}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null;}attachStage(e){this.detachStage(),this._stage=e;for(const t of e$7)this._stageHandles.add(this.events.on(t,(s=>e.handleEvent(t,s))));}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator();}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),r$h(this._octree)&&this._octree.add([e]);}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),r$h(this._octree)&&this._octree.remove([e]));}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),r$h(this._octree)&&this._octree.add(e);}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),r$h(this._octree)&&this._octree.remove(t);}}sync(){r$h(this._stage)&&this.updatePolicy!==i$f.SYNC&&this._stage.syncLayer(this.id);}notifyObjectBBChanged(e,t){r$h(this._octree)&&this._octree.update(e,t);}getSpatialQueryAccelerator(){return t$d(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this);}invalidateSpatialQueryAccelerator(){this._octree=l$9(this._octree);}_createOctree(){this._octree=new G$2((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var n$a;!function(n){function t(n,t){const c=n[t],o=n[t+1],r=n[t+2];return Math.sqrt(c*c+o*o+r*r)}function c(n,t){const c=n[t],o=n[t+1],r=n[t+2],u=1/Math.sqrt(c*c+o*o+r*r);n[t]*=u,n[t+1]*=u,n[t+2]*=u;}function o(n,t,c){n[t]*=c,n[t+1]*=c,n[t+2]*=c;}function r(n,t,c,o,r,u=t){(r=r||n)[u]=n[t]+c[o],r[u+1]=n[t+1]+c[o+1],r[u+2]=n[t+2]+c[o+2];}function u(n,t,c,o,r,u=t){(r=r||n)[u]=n[t]-c[o],r[u+1]=n[t+1]-c[o+1],r[u+2]=n[t+2]-c[o+2];}n.length=t,n.normalize=c,n.scale=o,n.add=r,n.subtract=u;}(n$a||(n$a={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const P$5=n$a;var U$5,S$7,p$7,x$4;!function(t){const e=.5,n=[[-e,-e,e],[e,-e,e],[e,e,e],[-e,e,e],[-e,-e,-e],[e,-e,-e],[e,e,-e],[-e,e,-e]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],a=[0,0,1,0,1,1,0,1],o=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let c=0;c<6;c++)for(let t=0;t<6;t++)s[6*c+t]=c;const l=new Uint16Array(36);for(let c=0;c<6;c++)l[6*c+0]=0,l[6*c+1]=1,l[6*c+2]=2,l[6*c+3]=2,l[6*c+4]=3,l[6*c+5]=0;function i(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(24);for(let r=0;r<8;r++)e[3*r]=n[r][0]*t[0],e[3*r+1]=n[r][1]*t[1],e[3*r+2]=n[r][2]*t[2];return new g$4([[O$6.POSITION,{size:3,data:e,exclusive:!0}],[O$6.NORMAL,{size:3,data:r}],[O$6.UV0,{size:2,data:a}]],[[O$6.POSITION,o],[O$6.NORMAL,s],[O$6.UV0,l]])}t.createGeometry=i;}(U$5||(U$5={})),function(t){const e=.5,n=[[-e,0,-e],[e,0,-e],[e,0,e],[-e,0,e],[0,-e,0],[0,e,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],a=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),o=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(18);for(let r=0;r<6;r++)e[3*r]=n[r][0]*t[0],e[3*r+1]=n[r][1]*t[1],e[3*r+2]=n[r][2]*t[2];return new g$4([[O$6.POSITION,{size:3,data:e,exclusive:!0}],[O$6.NORMAL,{size:3,data:r}]],[[O$6.POSITION,a],[O$6.NORMAL,o]])}t.createGeometry=s;}(S$7||(S$7={})),function(r){const a=.5,o=0,s=r$m(-a,o,-a),l=r$m(a,o,-a),i=r$m(0,o,a),h=r$m(0,o+a,0),f=n$j(),O=n$j(),A=n$j(),y=n$j(),I=n$j();e$f(f,s,h),e$f(O,s,l),_$3(A,f,O),z$6(A,A),e$f(f,l,h),e$f(O,l,i),_$3(y,f,O),z$6(y,y),e$f(f,i,h),e$f(O,i,s),_$3(I,f,O),z$6(I,I);const g=[s,l,i,h],M=[0,-1,0,A[0],A[1],A[2],y[0],y[1],y[2],I[0],I[1],I[2]],d=[0,1,2,3,1,0,3,2,1,3,0,2],w=[0,0,0,1,1,1,2,2,2,3,3,3];function P(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(12);for(let n=0;n<4;n++)e[3*n]=g[n][0]*t[0],e[3*n+1]=g[n][1]*t[1],e[3*n+2]=g[n][2]*t[2];return new g$4([[O$6.POSITION,{size:3,data:e,exclusive:!0}],[O$6.NORMAL,{size:3,data:M}]],[[O$6.POSITION,new Uint16Array(d)],[O$6.NORMAL,new Uint16Array(w)]])}r.createGeometry=P;}(p$7||(p$7={})),function(M){function x(t,e,n,r={uv:!0}){const a=-Math.PI,o=2*Math.PI,s=-Math.PI/2,l=Math.PI,i=Math.max(3,Math.floor(e)),c=Math.max(2,Math.floor(n)),u=(i+1)*(c+1),h=new Float32Array(3*u),f=new Float32Array(3*u),O=new Float32Array(2*u),A=[];let y=0;for(let m=0;m<=c;m++){const e=[],n=m/c,r=s+n*l,u=Math.cos(r);for(let s=0;s<=i;s++){const l=s/i,c=a+l*o,A=Math.cos(c)*u,I=Math.sin(r),g=-Math.sin(c)*u;h[3*y]=A*t,h[3*y+1]=I*t,h[3*y+2]=g*t,f[3*y]=A,f[3*y+1]=I,f[3*y+2]=g,O[2*y]=l,O[2*y+1]=n,e.push(y),++y;}A.push(e);}const I=new Uint32Array(2*i*(c-1)*3);y=0;for(let m=0;m<c;m++)for(let t=0;t<i;t++){const e=A[m][t],n=A[m][t+1],r=A[m+1][t+1],a=A[m+1][t];0===m?(I[y++]=e,I[y++]=r,I[y++]=a):m===c-1?(I[y++]=e,I[y++]=n,I[y++]=r):(I[y++]=e,I[y++]=n,I[y++]=r,I[y++]=r,I[y++]=a,I[y++]=e);}const g=[[O$6.POSITION,I],[O$6.NORMAL,I]],M=[[O$6.POSITION,{size:3,data:h,exclusive:!0}],[O$6.NORMAL,{size:3,data:f,exclusive:!0}]];return r.uv&&(M.push([O$6.UV0,{size:2,data:O,exclusive:!0}]),g.push([O$6.UV0,I])),r.offset&&(g[0][0]=O$6.OFFSET,M[0][0]=O$6.OFFSET,g.push([O$6.POSITION,new Uint32Array(I.length)]),M.push([O$6.POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new g$4(M,g)}function T(t,e,n){const r=t;let a,o;if(n)a=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else {const t=r*(1+Math.sqrt(5))/2;a=[-r,t,0,r,t,0,-r,-t,0,r,-t,0,0,-r,t,0,r,t,0,-r,-t,0,r,-t,t,0,-r,t,0,r,-t,0,-r,-t,0,r],o=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);}for(let h=0;h<a.length;h+=3)P$5.scale(a,h,t/P$5.length(a,h));let s={};function l(e,n){e>n&&([e,n]=[n,e]);const r=e.toString()+"."+n.toString();if(s[r])return s[r];let o=a.length;return a.length+=3,P$5.add(a,3*e,a,3*n,a,o),P$5.scale(a,o,t/P$5.length(a,o)),o/=3,s[r]=o,o}for(let h=0;h<e;h++){const t=o.length,e=new Uint32Array(4*t);for(let n=0;n<t;n+=3){const t=o[n],r=o[n+1],a=o[n+2],s=l(t,r),i=l(r,a),c=l(a,t),u=4*n;e[u]=t,e[u+1]=s,e[u+2]=c,e[u+3]=r,e[u+4]=i,e[u+5]=s,e[u+6]=a,e[u+7]=c,e[u+8]=i,e[u+9]=s,e[u+10]=i,e[u+11]=c;}o=e,s={};}const i=new Float32Array(a);for(let h=0;h<i.length;h+=3)P$5.normalize(i,h);const c=[[O$6.POSITION,o],[O$6.NORMAL,o]],u=[[O$6.POSITION,{size:3,data:new Float32Array(a),exclusive:!0}],[O$6.NORMAL,{size:3,data:i,exclusive:!0}]];return new g$4(u,c)}function L(t,e,n,r,a,o,s){const l=e?[e[0],e[1],e[2]]:[0,0,0],i=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const c=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],u=null!=r&&2===r.length?r:[1,1],h=[[O$6.POSITION,{size:3,data:l,exclusive:!0}],[O$6.NORMAL,{size:3,data:i,exclusive:!0}],[O$6.UV0,{size:o.length,data:o}],[O$6.COLOR,{size:4,data:c,exclusive:!0}],[O$6.SIZE,{size:2,data:u}]];if(null!=a){const t=new Float32Array([a[0],a[1],a[2],a[3]]);h.push([O$6.AUXPOS1,{size:4,data:t}]);}if(null!=s){const t=new Float32Array([s[0],s[1],s[2],s[3]]);h.push([O$6.AUXPOS2,{size:4,data:t}]);}return new g$4(h,null,a$8.Point)}function R(t,e,n,r,a,o,s,l){if(null!=t){const{data:e}=l.getMutableAttribute(O$6.NORMAL);e[0]=t[0],e[1]=t[1],e[2]=t[2];}if(null!=e){const{data:t}=l.getMutableAttribute(O$6.POSITION);t[0]=e[0],t[1]=e[1],t[2]=e[2];}if(null!=n){const{data:t}=l.getMutableAttribute(O$6.COLOR);t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3];}if(null!=r){const{data:t}=l.getMutableAttribute(O$6.SIZE);t[0]=r[0],t[1]=r[1];}if(null!=a){const{data:t}=l.getMutableAttribute(O$6.AUXPOS1);t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3];}if(null!=o){const{data:t}=l.getMutableAttribute(O$6.UV0);t[0]=o[0],t[1]=o[1];}if(null!=s){const{data:t}=l.getMutableAttribute(O$6.AUXPOS2);t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3];}}function b(t,e){const n=new Float32Array(3*t.length),r=new Float32Array(e?3*t.length:3),a=new Uint32Array(t.length),o=new Uint32Array(t.length);for(let c=0;c<t.length;c++)n[3*c]=t[c][0],n[3*c+1]=t[c][1],n[3*c+2]=t[c][2],e&&(r[3*c]=e[c][0],r[3*c+1]=e[c][1],r[3*c+2]=e[c][2]),a[c]=c,o[c]=0;e||(r[0]=0,r[1]=1,r[2]=0);const s=[0,0],l=[[O$6.POSITION,a],[O$6.NORMAL,e?a:o],[O$6.UV0,o]],i=[[O$6.POSITION,{size:3,data:n,exclusive:!0}],[O$6.NORMAL,{size:3,data:r,exclusive:!0}],[O$6.UV0,{size:2,data:s,exclusive:!0}]];return new g$4(i,l,a$8.Point)}function G(){const t=[0,0,0,0,0,100,100,0,0],e=new Uint16Array([0,1,2]),n=[0,1,0],r=new Uint16Array([0,0,0]),a=[0,0],o=new Uint16Array([0,0,0]),s=[[O$6.POSITION,e],[O$6.NORMAL,r],[O$6.UV0,o]],l=[[O$6.POSITION,{size:3,data:t,exclusive:!0}],[O$6.NORMAL,{size:3,data:n,exclusive:!0}],[O$6.UV0,{size:2,data:a,exclusive:!0}]];return new g$4(l,s)}M.createBoxGeometry=U$5.createGeometry,M.createDiamondGeometry=S$7.createGeometry,M.createTetrahedronGeometry=p$7.createGeometry,M.createSphereGeometry=x,M.createPolySphereGeometry=T,M.createPointGeometry=L,M.updatePointGeometry=R,M.createPointArrayGeometry=b,M.createTriangleGeometry=G;const F=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function V(t=F){const e=new Array(12);for(let c=0;c<4;c++)for(let n=0;n<3;n++)e[3*c+n]=t[c][n];const n=new Uint32Array([0,1,2,2,3,0]),r=[0,0,1],a=new Uint32Array([0,0,0,0,0,0]),o=[0,0,1,0,1,1,0,1],s=[255,255,255,255],l=[[O$6.POSITION,n],[O$6.NORMAL,a],[O$6.UV0,n],[O$6.COLOR,a]],i=[[O$6.POSITION,{size:3,data:e,exclusive:!0}],[O$6.NORMAL,{size:3,data:r,exclusive:!0}],[O$6.UV0,{size:2,data:o,exclusive:!0}],[O$6.COLOR,{size:4,data:s,exclusive:!0}]];return new g$4(i,l)}function j(t,e,n,r,a=!0,o=!0){let s=0;const l=e,i=t;let u=r$m(0,s,0),h=r$m(0,s+i,0),f=r$m(0,-1,0),O=r$m(0,1,0);r&&(s=i,h=r$m(0,0,0),u=r$m(0,s,0),f=r$m(0,1,0),O=r$m(0,-1,0));const A=[h,u],y=[f,O],I=n+2,g=Math.sqrt(i*i+l*l);if(r)for(let m=n-1;m>=0;m--){const t=m*(2*Math.PI/n),e=r$m(Math.cos(t)*l,s,Math.sin(t)*l);A.push(e);const r=r$m(i*Math.cos(t)/g,-l/g,i*Math.sin(t)/g);y.push(r);}else for(let m=0;m<n;m++){const t=m*(2*Math.PI/n),e=r$m(Math.cos(t)*l,s,Math.sin(t)*l);A.push(e);const r=r$m(i*Math.cos(t)/g,l/g,i*Math.sin(t)/g);y.push(r);}const M=new Uint32Array(2*(n+2)*3),d=new Uint32Array(2*(n+2)*3);let w=0,P=0;if(a){for(let t=3;t<A.length;t++)M[w++]=1,M[w++]=t-1,M[w++]=t,d[P++]=0,d[P++]=0,d[P++]=0;M[w++]=A.length-1,M[w++]=2,M[w++]=1,d[P++]=0,d[P++]=0,d[P++]=0;}if(o){for(let t=3;t<A.length;t++)M[w++]=t,M[w++]=t-1,M[w++]=0,d[P++]=t,d[P++]=t-1,d[P++]=1;M[w++]=0,M[w++]=2,M[w++]=A.length-1,d[P++]=1,d[P++]=2,d[P++]=y.length-1;}const U=new Float32Array(3*I);for(let c=0;c<I;c++)U[3*c]=A[c][0],U[3*c+1]=A[c][1],U[3*c+2]=A[c][2];const S=new Float32Array(3*I);for(let c=0;c<I;c++)S[3*c]=y[c][0],S[3*c+1]=y[c][1],S[3*c+2]=y[c][2];const p=[[O$6.POSITION,M],[O$6.NORMAL,d]],x=[[O$6.POSITION,{size:3,data:U,exclusive:!0}],[O$6.NORMAL,{size:3,data:S,exclusive:!0}]];return new g$4(x,p)}function C(t,l,i,f,O,A){const y=f?t$g(f):r$m(1,0,0),I=O?t$g(O):r$m(0,0,0);A=A??!0;const g=n$j();z$6(g,y);const M=n$j();g$5(M,g,Math.abs(t));const d=n$j();g$5(d,M,-.5),u$c(d,d,I);const w=r$m(0,1,0);Math.abs(1-P$6(g,w))<.2&&o$9(w,0,0,1);const P=n$j();_$3(P,g,w),z$6(P,P),_$3(w,P,g);const U=2*i+(A?2:0),S=i+(A?2:0),p=new Float32Array(3*U),x=new Float32Array(3*S),z=new Float32Array(2*U),v=new Uint32Array(3*i*(A?4:2)),T=new Uint32Array(3*i*(A?4:2));A&&(p[3*(U-2)+0]=d[0],p[3*(U-2)+1]=d[1],p[3*(U-2)+2]=d[2],z[2*(U-2)]=0,z[2*(U-2)+1]=0,p[3*(U-1)+0]=p[3*(U-2)+0]+M[0],p[3*(U-1)+1]=p[3*(U-2)+1]+M[1],p[3*(U-1)+2]=p[3*(U-2)+2]+M[2],z[2*(U-1)]=1,z[2*(U-1)+1]=1,x[3*(S-2)+0]=-g[0],x[3*(S-2)+1]=-g[1],x[3*(S-2)+2]=-g[2],x[3*(S-1)+0]=g[0],x[3*(S-1)+1]=g[1],x[3*(S-1)+2]=g[2]);const L=(t,e,n)=>{v[t]=e,T[t]=n;};let R=0;const b=n$j(),G=n$j();for(let e=0;e<i;e++){const t=e*(2*Math.PI/i);g$5(b,w,Math.sin(t)),g$5(G,P,Math.cos(t)),u$c(b,b,G),x[3*e+0]=b[0],x[3*e+1]=b[1],x[3*e+2]=b[2],g$5(b,b,l),u$c(b,b,d),p[3*e+0]=b[0],p[3*e+1]=b[1],p[3*e+2]=b[2],z[2*e+0]=e/i,z[2*e+1]=0,p[3*(e+i)+0]=p[3*e+0]+M[0],p[3*(e+i)+1]=p[3*e+1]+M[1],p[3*(e+i)+2]=p[3*e+2]+M[2],z[2*(e+i)+0]=e/i,z[2*e+1]=1;const n=(e+1)%i;L(R++,e,e),L(R++,e+i,e),L(R++,n,n),L(R++,n,n),L(R++,e+i,e),L(R++,n+i,n);}if(A){for(let t=0;t<i;t++){const e=(t+1)%i;L(R++,U-2,S-2),L(R++,t,S-2),L(R++,e,S-2);}for(let t=0;t<i;t++){const e=(t+1)%i;L(R++,t+i,S-1),L(R++,U-1,S-1),L(R++,e+i,S-1);}}const F=[[O$6.POSITION,v],[O$6.NORMAL,T],[O$6.UV0,v]],V=[[O$6.POSITION,{size:3,data:p,exclusive:!0}],[O$6.NORMAL,{size:3,data:x,exclusive:!0}],[O$6.UV0,{size:2,data:z,exclusive:!0}]];return new g$4(V,F)}function E(t,e,n,r,a){n=n||10,r=null==r||r,e$e(t.length>1);const o=[[0,0,0]],s=[],l=[];for(let i=0;i<n;i++){s.push([0,-i-1,-(i+1)%n-1]);const t=i/n*2*Math.PI;l.push([Math.cos(t)*e,Math.sin(t)*e]);}return M.createPathExtrusionGeometry(l,t,o,s,r,a)}function k(o,i,h,g,M,d=r$m(0,0,0)){const w=o.length,P=new Float32Array(i.length*w*3+(6*h.length||0)),U=new Float32Array(i.length*w*3+(h?6:0)),S=(i.length-1)*w*6+3*g.length*2,p=new Uint32Array(S),x=new Uint32Array(S);let v=0,T=0,L=0,R=0;const b=n$j(),G=n$j(),F=n$j(),V=n$j(),j=n$j(),C=n$j(),E=n$j(),k=n$g(),B=n$j(),D=n$j(),X=n$j(),q=n$j(),Z=n$j(),J=p$8();o$9(B,0,1,0),e$f(G,i[1],i[0]),z$6(G,G),M?(u$c(k,i[0],d),z$6(F,k)):o$9(F,0,0,1),H(G,F,B,B,j,F,z$5),r$k(V,F),r$k(q,j);for(let t=0;t<h.length;t++)g$5(C,j,h[t][0]),g$5(k,F,h[t][2]),u$c(C,C,k),u$c(C,C,i[0]),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2];U[T++]=-G[0],U[T++]=-G[1],U[T++]=-G[2];for(let t=0;t<g.length;t++)p[L++]=g[t][0]>0?g[t][0]:-g[t][0]-1+h.length,p[L++]=g[t][1]>0?g[t][1]:-g[t][1]-1+h.length,p[L++]=g[t][2]>0?g[t][2]:-g[t][2]-1+h.length,x[R++]=0,x[R++]=0,x[R++]=0;let K=h.length;const Q=h.length-1;for(let s=0;s<i.length;s++){let c=!1;if(s>0){r$k(b,G),s<i.length-1?(e$f(G,i[s+1],i[s]),z$6(G,G)):c=!0,u$c(D,b,G),z$6(D,D),u$c(X,i[s-1],V),_$4(i[s],D,J);q$2(J,j$6(X,b),k)?(e$f(k,k,i[s]),z$6(F,k),_$3(j,D,F),z$6(j,j)):H(D,V,q,B,j,F,z$5),r$k(V,F),r$k(q,j);}M&&(u$c(k,i[s],d),z$6(Z,k));for(let t=0;t<w;t++)if(g$5(C,j,o[t][0]),g$5(k,F,o[t][1]),u$c(C,C,k),z$6(E,C),U[T++]=E[0],U[T++]=E[1],U[T++]=E[2],u$c(C,C,i[s]),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2],!c){const e=(t+1)%w;p[L++]=K+t,p[L++]=K+w+t,p[L++]=K+e,p[L++]=K+e,p[L++]=K+w+t,p[L++]=K+w+e;for(let t=0;t<6;t++)x[R++]=p[L-6+t]-Q;}K+=w;}const W=i[i.length-1];for(let t=0;t<h.length;t++)g$5(C,j,h[t][0]),g$5(k,F,h[t][1]),u$c(C,C,k),u$c(C,C,W),P[v++]=C[0],P[v++]=C[1],P[v++]=C[2];const Y=T/3;U[T++]=G[0],U[T++]=G[1],U[T++]=G[2];const $=K-w;for(let t=0;t<g.length;t++)p[L++]=g[t][0]>=0?K+g[t][0]:-g[t][0]-1+$,p[L++]=g[t][2]>=0?K+g[t][2]:-g[t][2]-1+$,p[L++]=g[t][1]>=0?K+g[t][1]:-g[t][1]-1+$,x[R++]=Y,x[R++]=Y,x[R++]=Y;const _=[[O$6.POSITION,p],[O$6.NORMAL,x]],tt=[[O$6.POSITION,{size:3,data:P,exclusive:!0}],[O$6.NORMAL,{size:3,data:U,exclusive:!0}]];return new g$4(tt,_)}function B(t,e,n){e$e(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),e$e(3===t[0].length,"createPolylineGeometry(): malformed vertex"),e$e(null==e||e.length===t.length,"createPolylineGeometry: need same number of points and normals"),e$e(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*t.length),a=new Uint32Array(2*(t.length-1));let o=0,s=0;for(let c=0;c<t.length;c++){for(let e=0;e<3;e++)r[o++]=t[c][e];c>0&&(a[s++]=c-1,a[s++]=c);}const l=[],i=[];if(l.push([O$6.POSITION,a]),i.push([O$6.POSITION,{size:3,data:r,exclusive:!0}]),e){const n=new Float32Array(3*e.length);let r=0;for(let a=0;a<t.length;a++)for(let t=0;t<3;t++)n[r++]=e[a][t];l.push([O$6.NORMAL,a]),i.push([O$6.NORMAL,{size:3,data:n,exclusive:!0}]);}return n&&(i.push([O$6.COLOR,{size:4,data:n}]),l.push([O$6.COLOR,l$a(n.length/4)])),new g$4(i,l,a$8.Line)}function D(t,e,n,r,a=0){const o=new Array(18),s=[[-e,a,r/2],[n,a,r/2],[0,t+a,r/2],[-e,a,-r/2],[n,a,-r/2],[0,t+a,-r/2]],l=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let i=0;i<6;i++)o[3*i]=s[i][0],o[3*i+1]=s[i][1],o[3*i+2]=s[i][2];return new g$4([[O$6.POSITION,{size:3,data:o,exclusive:!0}]],[[O$6.POSITION,l]])}function X(t,e){const n=t.getMutableAttribute(O$6.POSITION).data;for(let r=0;r<n.length;r+=3){const t=n[r],a=n[r+1],o=n[r+2];o$9(v$5,t,a,o),O$5(v$5,v$5,e),n[r]=v$5[0],n[r+1]=v$5[1],n[r+2]=v$5[2];}}function q(t,e=t){const n=t.vertexAttributes,r=n.get(O$6.POSITION).data,a=n.get(O$6.NORMAL).data;if(a){const t=e.getMutableAttribute(O$6.NORMAL).data;for(let e=0;e<a.length;e+=3){const n=a[e+1];t[e+1]=-a[e+2],t[e+2]=n;}}if(r){const t=e.getMutableAttribute(O$6.POSITION).data;for(let e=0;e<r.length;e+=3){const n=r[e+1];t[e+1]=-r[e+2],t[e+2]=n;}}return e}function Z(t,r,a,s,l){return !(Math.abs(P$6(r,t))>l)&&(_$3(a,t,r),z$6(a,a),_$3(s,a,t),z$6(s,s),!0)}function H(t,e,n,r,a,o,s){return Z(t,e,a,o,s)||Z(t,n,a,o,s)||Z(t,r,a,o,s)}M.createSquareGeometry=V,M.createConeGeometry=j,M.createCylinderGeometry=C,M.createTubeGeometry=E,M.createPathExtrusionGeometry=k,M.createPolylineGeometry=B,M.createExtrudedTriangle=D,M.transformInPlace=X,M.cgToGIS=q,M.makeOrthoBasisDirUp=Z,M.makeOrthoBasisDirUpFallback=H;}(x$4||(x$4={}));const z$5=.99619469809,v$5=n$j(),T$7=x$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const l$6=8;function s$i(s,u){const c=s.vertex;c.uniforms.add(new o$b("intrinsicWidth",(e=>e.width))),u.vvSize?(s.attributes.add(O$6.SIZEFEATUREATTRIBUTE,"float"),c.uniforms.add(new e$g("vvSizeMinSize",(e=>e.vvSizeMinSize))),c.uniforms.add(new e$g("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),c.uniforms.add(new e$g("vvSizeOffset",(e=>e.vvSizeOffset))),c.uniforms.add(new e$g("vvSizeFactor",(e=>e.vvSizeFactor))),c.code.add(n$c`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(s.attributes.add(O$6.SIZE,"float"),c.code.add(n$c`float getSize(){
return intrinsicWidth * size;
}`)),u.vvOpacity?(s.attributes.add(O$6.OPACITYFEATUREATTRIBUTE,"float"),c.constants.add("vvOpacityNumber","int",8),c.uniforms.add([new o$c("vvOpacityValues",(e=>e.vvOpacityValues),l$6),new o$c("vvOpacityOpacities",(e=>e.vvOpacityOpacities),l$6)]),c.code.add(n$c`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):c.code.add(n$c`vec4 applyOpacity( vec4 color ){
return color;
}`),u.vvColor?(s.attributes.add(O$6.COLORFEATUREATTRIBUTE,"float"),c.constants.add("vvColorNumber","int",o$d),c.uniforms.add(new o$c("vvColorValues",(e=>e.vvColorValues),o$d)),c.uniforms.add(new e$h("vvColorColors",(e=>e.vvColorColors),o$d)),c.code.add(n$c`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(s.attributes.add(O$6.COLOR,"vec4"),c.code.add(n$c`vec4 getColor(){
return applyOpacity(color);
}`));}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function t$c(c){return t$d(c)?l$b:4===c.length?c:r$g(e$6,c[0],c[1],c[2],1)}const e$6=n$d();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function s$h(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?d$7(e,t):c$b(e);}function d$7(e,t){const s=!(t.draped&&t.stipplePreferContinuous),{vertex:d,fragment:c}=e;c.include(a$9),t.draped||(c$e(d,t),d.uniforms.add(new o$b("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),d.code.add(n$c`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),d.code.add(n$c`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${h$9};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),d.code.add(n$c`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),d.code.add(n$c`
    if (segmentLengthPseudoScreen >= ${s?"patternLength":"1e4"}) {
  `),d.uniforms.add(new o$b("pixelRatio",((e,t)=>t.camera.pixelRatio))),d.code.add(n$c`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?n$c`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),c.uniforms.add([new m$6("stipplePatternTexture",(e=>e.stippleTexture)),new o$b("stipplePatternSDFNormalizer",(e=>u$9(e.stipplePattern))),new o$b("stipplePatternTextureSize",(e=>m$4(e.stipplePattern))),new o$b("stipplePatternPixelSizeInv",(e=>1/S$6(e)))]),c.code.add(n$c`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),c.code.add(n$c`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?n$c`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n$c`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?n$c`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?n$c`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:n$c`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?n$c`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n$c`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(c.uniforms.add(new e$8("stippleOffColor",(e=>t$c(e.stippleOffColor)))),c.code.add(n$c`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):c.code.add(n$c`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`);}function c$b(e){e.fragment.code.add(n$c`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`);}function f$a(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio))).reduce(((e,t)=>Math.max(e,t)))}function u$9(t){return r$h(t)?(Math.floor(.5*(f$a(t)-1))+.5)/t.pixelRatio:1}function m$4(e){if(t$d(e))return 1;const i=e.pattern.map((t=>Math.round(t*e.pixelRatio)));return Math.floor(i.reduce(((e,t)=>e+t)))}function S$6(t){const i=t.stipplePattern;return r$h(i)?m$4(t.stipplePattern)/i.pixelRatio:1}const h$9=n$c.float(.4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var r$d;!function(o){o[o.BUTT=0]="BUTT",o[o.SQUARE=1]="SQUARE",o[o.ROUND=2]="ROUND",o[o.COUNT=3]="COUNT";}(r$d||(r$d={}));class s$g extends s$j{constructor(){super(...arguments),this.output=h$a.Color,this.capType=r$d.BUTT,this.transparencyPassType=o$e.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1;}}e$i([e$j({count:h$a.COUNT})],s$g.prototype,"output",void 0),e$i([e$j({count:r$d.COUNT})],s$g.prototype,"capType",void 0),e$i([e$j({count:o$e.COUNT})],s$g.prototype,"transparencyPassType",void 0),e$i([e$j()],s$g.prototype,"occluder",void 0),e$i([e$j()],s$g.prototype,"hasSlicePlane",void 0),e$i([e$j()],s$g.prototype,"hasPolygonOffset",void 0),e$i([e$j()],s$g.prototype,"writeDepth",void 0),e$i([e$j()],s$g.prototype,"draped",void 0),e$i([e$j()],s$g.prototype,"stippleEnabled",void 0),e$i([e$j()],s$g.prototype,"stippleOffColorEnabled",void 0),e$i([e$j()],s$g.prototype,"stippleScaleWithLineWidth",void 0),e$i([e$j()],s$g.prototype,"stipplePreferContinuous",void 0),e$i([e$j()],s$g.prototype,"roundJoins",void 0),e$i([e$j()],s$g.prototype,"vvSize",void 0),e$i([e$j()],s$g.prototype,"vvColor",void 0),e$i([e$j()],s$g.prototype,"vvOpacity",void 0),e$i([e$j()],s$g.prototype,"falloffEnabled",void 0),e$i([e$j()],s$g.prototype,"innerColorEnabled",void 0),e$i([e$j()],s$g.prototype,"hasOccludees",void 0),e$i([e$j()],s$g.prototype,"hasMultipassTerrain",void 0),e$i([e$j()],s$g.prototype,"cullAboveGround",void 0),e$i([e$j()],s$g.prototype,"wireframe",void 0),e$i([e$j({constValue:!0})],s$g.prototype,"stippleRequiresClamp",void 0),e$i([e$j({constValue:!0})],s$g.prototype,"stippleRequiresStretchMeasure",void 0),e$i([e$j({constValue:!0})],s$g.prototype,"hasVvInstancing",void 0),e$i([e$j({constValue:!0})],s$g.prototype,"hasSliceTranslatedView",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const b$6=1;function L$3(L){const w=new o$f,y=L.hasMultipassTerrain&&(L.output===h$a.Color||L.output===h$a.Alpha);w.include(t$h),w.include(s$i,L),w.include(s$h,L),L.output===h$a.Depth&&w.include(o$g,L),v$6(w,L);const{vertex:C,fragment:j}=w;C.uniforms.add([new e$k("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new e$9("nearFar",((e,t)=>t.camera.nearFar)),new o$b("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new e$8("viewport",((e,t)=>t.camera.fullViewport))]),C.constants.add("LARGE_HALF_FLOAT","float",65500),w.attributes.add(O$6.POSITION,"vec3"),w.attributes.add(O$6.SUBDIVISIONFACTOR,"float"),w.attributes.add(O$6.UV0,"vec2"),w.attributes.add(O$6.AUXPOS1,"vec3"),w.attributes.add(O$6.AUXPOS2,"vec3"),w.varyings.add("vColor","vec4"),w.varyings.add("vpos","vec3"),w.varyings.add("linearDepth","float"),y&&w.varyings.add("depth","float");const R=L.capType===r$d.ROUND,P=L.stippleEnabled&&L.stippleScaleWithLineWidth||R;P&&w.varyings.add("vLineWidth","float");const A=L.stippleEnabled&&L.stippleScaleWithLineWidth;A&&w.varyings.add("vLineSizeInv","float");const F=L.innerColorEnabled||R;F&&w.varyings.add("vLineDistance","float");const E=L.stippleEnabled&&R,T=L.falloffEnabled||E;T&&w.varyings.add("vLineDistanceNorm","float"),R&&(w.varyings.add("vSegmentSDF","float"),w.varyings.add("vReverseSegmentSDF","float")),C.code.add(n$c`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),C.code.add(n$c`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),C.code.add(n$c`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${y?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),C.uniforms.add(new o$b("pixelRatio",((e,t)=>t.camera.pixelRatio))),C.code.add(n$c`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${P?n$c`vLineWidth = lineWidth;`:""}
      ${A?n$c`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);(L.stippleEnabled||R)&&C.code.add(n$c`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${R?n$c`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),C.code.add(n$c`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),L.roundJoins?C.code.add(n$c`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${L.stippleEnabled?n$c`min(1.0, subdivisionFactor * ${n$c.float((b$6+2)/(b$6+1))})`:n$c`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):C.code.add(n$c`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const W=L.capType!==r$d.BUTT;return C.code.add(n$c`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${W?n$c`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),C.code.add(n$c`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${T||F?n$c`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${F?n$c`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${T?n$c`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),R&&C.code.add(n$c`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),L.stippleEnabled&&(L.draped?C.uniforms.add(new o$b("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):C.code.add(n$c`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),C.code.add(n$c`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),L.draped?C.code.add(n$c`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):C.code.add(n$c`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),C.uniforms.add(new o$b("stipplePatternPixelSize",(e=>S$6(e)))),C.code.add(n$c`
      float patternLength = ${L.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),C.code.add(n$c`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${L.wireframe&&!L.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),y&&w.include(n$k,L),w.include(u$d,L),j.include(e$l),j.code.add(n$c`
  void main() {
    discardBySlice(vpos);
    ${y?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),L.wireframe?j.code.add(n$c`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(R&&j.code.add(n$c`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${n$c.float(t$i)}) {
        discard;
      }
    `),E?j.code.add(n$c`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${n$c.float(t$i)}, stippleCoverage);
      `):j.code.add(n$c`float stippleAlpha = getStippleAlpha();`),j.uniforms.add(new e$8("intrinsicColor",(e=>e.color))),j.code.add(n$c`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),L.innerColorEnabled&&(j.uniforms.add(new e$8("innerColor",(t=>c$d(t.innerColor,t.color)))),j.uniforms.add(new o$b("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),j.code.add(n$c`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),j.code.add(n$c`vec4 finalColor = blendStipple(color, stippleAlpha);`),L.falloffEnabled&&(j.uniforms.add(new o$b("falloff",(e=>e.falloff))),j.code.add(n$c`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),j.code.add(n$c`
    if (finalColor.a < ${n$c.float(t$i)}) {
      discard;
    }

    ${L.output===h$a.Alpha?n$c`gl_FragColor = vec4(finalColor.a);`:""}
    ${L.output===h$a.Color?n$c`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${L.output===h$a.Color&&L.transparencyPassType===o$e.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${L.output===h$a.Highlight?n$c`gl_FragColor = vec4(1.0);`:""}
    ${L.output===h$a.Depth?n$c`outputDepth(linearDepth);`:""}
  }
  `),w}const w$4=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:b$6,build:L$3},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const I$4=new Map([[O$6.POSITION,0],[O$6.SUBDIVISIONFACTOR,1],[O$6.UV0,2],[O$6.AUXPOS1,3],[O$6.AUXPOS2,4],[O$6.COLOR,5],[O$6.COLORFEATUREATTRIBUTE,5],[O$6.SIZE,6],[O$6.SIZEFEATUREATTRIBUTE,6],[O$6.OPACITYFEATUREATTRIBUTE,7]]);class y$2 extends e$m{initializeProgram(e){return new o$h(e.rctx,y$2.shader.get().build(this.configuration),I$4)}_makePipelineState(t,i){const c=this.configuration,a=t===o$e.NONE,d=t===o$e.FrontFace;return W$2({blending:c.output===h$a.Color||c.output===h$a.Alpha?a?c$f:A$6(t):null,depthTest:{func:l$c(t)},depthWrite:a?c.writeDepth&&a$a:E$3(t),colorWrite:_$5,stencilWrite:c.hasOccludees?e$n:null,stencilTest:c.hasOccludees?i?o$i:f$d:null,polygonOffset:a||d?c.hasPolygonOffset&&_$2:_$6})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset&&_$2;this._occluderPipelineTransparent=W$2({blending:c$f,polygonOffset:t,depthTest:s$k,depthWrite:null,colorWrite:_$5,stencilWrite:null,stencilTest:m$7}),this._occluderPipelineOpaque=W$2({blending:c$f,polygonOffset:t,depthTest:s$k,depthWrite:null,colorWrite:_$5,stencilWrite:l$d,stencilTest:P$7}),this._occluderPipelineMaskWrite=W$2({blending:null,polygonOffset:t,depthTest:i$g,depthWrite:null,colorWrite:null,stencilWrite:e$n,stencilTest:o$i});}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?E$4.LINES:E$4.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===E$5.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===E$5.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}y$2.shader=new t$j(w$4,(()=>import('./RibbonLine.glsl-fd2f06e2.js')));const _$2={factor:0,units:-4};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var z$4;!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END";}(z$4||(z$4={}));class B$4 extends d$9{constructor(e){super(e,new W$1),this._configuration=new s$g,this._vertexAttributeLocations=I$4,this._layout=this.createLayout();}isClosed(e,t){return X$2(this.parameters,e,t)}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===E$5.DRAPED_MATERIAL;const i=r$h(this.parameters.stipplePattern)&&e!==h$a.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&r$h(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&r$h(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===o$j.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersect(e,t,i,s,a,n,o,l,c){r$h(c)?this._intersectDrapedLineGeometry(e,s,c,n,o):this._intersectLineGeometry(e,t,i,s,o);}_intersectDrapedLineGeometry(e,r,i,s,a){if(!r.options.selectionMode)return;const n=e.vertexAttributes.get(O$6.POSITION).data,o=e.vertexAttributes.get(O$6.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const r=e.vertexAttributes.get(O$6.SIZEFEATUREATTRIBUTE).data[0];l*=o$k(this.parameters.vvSizeOffset[0]+r*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0]);}else o&&(l*=o.data[0]);const c=s[0],h=s[1],p=(l/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE,m=0;for(let f=0;f<n.length-5;f+=3){const e=n[f],r=n[f+1],i=c-e,s=h-r,a=n[f+3]-e,o=n[f+4]-r,l=o$k((a*i+o*s)/(a*a+o*o),0,1),p=a*l-i,T=o*l-s,_=p*p+T*T;_<u&&(u=_,m=f/3);}u<p*p&&a(i.dist,i.normal,m,!1);}_intersectLineGeometry(r,i,m,f,T){if(!f.options.selectionMode||u$e(i))return;if(!M$4(m))return void s$l.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const d=r.vertexAttributes,R=d.get(O$6.POSITION).data;let g=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=d.get(O$6.SIZEFEATUREATTRIBUTE).data[0];g*=o$k(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0]);}else d.has(O$6.SIZE)&&(g*=d.get(O$6.SIZE).data[0]);const b=f.camera,P=$$4;a$b(P,f.point);const L=g*b.pixelRatio/2+4*b.pixelRatio;o$9(ce$3[0],P[0]-L,P[1]+L,0),o$9(ce$3[1],P[0]+L,P[1]+L,0),o$9(ce$3[2],P[0]+L,P[1]-L,0),o$9(ce$3[3],P[0]-L,P[1]-L,0);for(let e=0;e<4;e++)if(!b.unprojectFromRenderScreen(ce$3[e],he$1[e]))return;j$7(b.eye,he$1[0],he$1[1],pe$2),j$7(b.eye,he$1[1],he$1[2],ue$3),j$7(b.eye,he$1[2],he$1[3],me$2),j$7(b.eye,he$1[3],he$1[0],fe$1);let N=Number.MAX_VALUE,C=0;const y=k$1(this.parameters,d,r.indices)?R.length-2:R.length-5;for(let e=0;e<y;e+=3){q$1[0]=R[e]+m[12],q$1[1]=R[e+1]+m[13],q$1[2]=R[e+2]+m[14];const t=(e+3)%R.length;if(Y$2[0]=R[t]+m[12],Y$2[1]=R[t+1]+m[13],Y$2[2]=R[t+2]+m[14],W$3(pe$2,q$1)<0&&W$3(pe$2,Y$2)<0||W$3(ue$3,q$1)<0&&W$3(ue$3,Y$2)<0||W$3(me$2,q$1)<0&&W$3(me$2,Y$2)<0||W$3(fe$1,q$1)<0&&W$3(fe$1,Y$2)<0)continue;if(b.projectToRenderScreen(q$1,ee$2),b.projectToRenderScreen(Y$2,te$2),ee$2[2]<0&&te$2[2]>0){e$f(Q$4,q$1,Y$2);const e=b.frustum,t=-W$3(e[k$2.NEAR],q$1)/P$6(Q$4,Z$4(e[k$2.NEAR]));g$5(Q$4,Q$4,t),u$c(q$1,q$1,Q$4),b.projectToRenderScreen(q$1,ee$2);}else if(ee$2[2]>0&&te$2[2]<0){e$f(Q$4,Y$2,q$1);const e=b.frustum,t=-W$3(e[k$2.NEAR],Y$2)/P$6(Q$4,Z$4(e[k$2.NEAR]));g$5(Q$4,Q$4,t),u$c(Y$2,Y$2,Q$4),b.projectToRenderScreen(Y$2,te$2);}else if(ee$2[2]<0&&te$2[2]<0)continue;ee$2[2]=0,te$2[2]=0;const r=b$7(l$e(ee$2,te$2,se$2),P);r<N&&(N=r,r$k(re$2,q$1),r$k(ie$2,Y$2),C=e/3);}const U=f.rayBegin,F=f.rayEnd;if(N<L*L){let e=Number.MAX_VALUE;if(k$3(l$e(re$2,ie$2,se$2),l$e(U,F,ae$2),K$4)){e$f(K$4,K$4,U);const t=s$m(K$4);g$5(K$4,K$4,1/t),e=t/x$5(U,F);}T(e,K$4,C,!1);}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return !1;const i=e.indices,s=r.get(O$6.POSITION);return h$b(s,i?i.get(O$6.POSITION):null,i&&k$1(this.parameters,r,i),t)}createLayout(){const e=T$8().vec3f(O$6.POSITION).f32(O$6.SUBDIVISIONFACTOR).vec2f(O$6.UV0).vec3f(O$6.AUXPOS1).vec3f(O$6.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(O$6.SIZEFEATUREATTRIBUTE):e.f32(O$6.SIZE),this.parameters.vvColorEnabled?e.f32(O$6.COLORFEATUREATTRIBUTE):e.vec4f(O$6.COLOR),this.parameters.vvOpacityEnabled&&e.f32(O$6.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new V$1(this._layout,this.parameters)}requiresSlot(e,t){if(t===h$a.Color||t===h$a.Alpha||t===h$a.Highlight||t===h$a.Depth){if(e===E$5.DRAPED_MATERIAL)return !0;if(this.parameters.renderOccluded===o$j.OccludeAndTransparentStencil)return e===E$5.OPAQUE_MATERIAL||e===E$5.OCCLUDER_MATERIAL||e===E$5.TRANSPARENT_OCCLUDER_MATERIAL;if(t===h$a.Color||t===h$a.Alpha){return e===(this.parameters.writeDepth?E$5.TRANSPARENT_MATERIAL:E$5.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}return e===E$5.OPAQUE_MATERIAL}return !1}createGLMaterial(e){return new H$3(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0);}}class H$3 extends t$k{constructor(){super(...arguments),this._stipplePattern=null;}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null;}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){this._output!==h$a.Color&&this._output!==h$a.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(y$2,e)}}class W$1 extends v$8{constructor(){super(...arguments),this.width=0,this.color=_$7,this.join="miter",this.cap=r$d.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1;}}class V$1{constructor(e,t){this._parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=b$6+r;}}_isClosed(e){return k$1(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2,r=e.indices.get(O$6.POSITION).length/2+1,i=this._isClosed(e);let s=i?2:2*t;return s+=((i?r:r-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,t,r,i){const s=ne$2,n=oe$2,o=le$2,l=t.vertexAttributes.get(O$6.POSITION).data,c=t.indices&&t.indices.get(O$6.POSITION),p=t.vertexAttributes.get(O$6.DISTANCETOSTART)?.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,T=0;this._parameters.vvSizeEnabled?T=t.vertexAttributes.get(O$6.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(O$6.SIZE)&&(f=t.vertexAttributes.get(O$6.SIZE).data[0]);let _=[1,1,1,1],d=0;this._parameters.vvColorEnabled?d=t.vertexAttributes.get(O$6.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(O$6.COLOR)&&(_=t.vertexAttributes.get(O$6.COLOR).data);let E=0;this._parameters.vvOpacityEnabled&&(E=t.vertexAttributes.get(O$6.OPACITYFEATUREATTRIBUTE).data[0]);const A=l.length/3,v=e.transformation,R=new Float32Array(r.buffer),S=this.vertexBufferLayout.stride/4;let I=i*S;const O=I;let g=0;const b=p?(e,t,r)=>g=p[r]:(e,t,r)=>g+=x$5(e,t),P=(e,t,r,i,s,a,n)=>{if(R[I++]=t[0],R[I++]=t[1],R[I++]=t[2],R[I++]=i,R[I++]=n,R[I++]=s,R[I++]=e[0],R[I++]=e[1],R[I++]=e[2],R[I++]=r[0],R[I++]=r[1],R[I++]=r[2],this._parameters.vvSizeEnabled?R[I++]=T:R[I++]=f,this._parameters.vvColorEnabled)R[I++]=d;else {const e=Math.min(4*a,_.length-4);R[I++]=_[e+0],R[I++]=_[e+1],R[I++]=_[e+2],R[I++]=_[e+3];}this._parameters.vvOpacityEnabled&&(R[I++]=E);};I+=S,o$9(n,l[0],l[1],l[2]),v&&O$5(n,n,v);const L=this._isClosed(t);if(L){const e=l.length-3;o$9(s,l[e],l[e+1],l[e+2]),v&&O$5(s,s,v);}else o$9(o,l[3],l[4],l[5]),v&&O$5(o,o,v),P(n,n,o,1,z$4.LEFT_CAP_START,0,0),P(n,n,o,1,z$4.RIGHT_CAP_START,0,0),r$k(s,n),r$k(n,o);const N=L?0:1,C=L?A:A-1;for(let u=N;u<C;u++){const e=(u+1)%A*3;o$9(o,l[e+0],l[e+1],l[e+2]),v&&O$5(o,o,v),b(s,n,u),P(s,n,o,0,z$4.LEFT_JOIN_END,u,g),P(s,n,o,0,z$4.RIGHT_JOIN_END,u,g);const t=this.numJoinSubdivisions;for(let r=0;r<t;++r){const e=(r+1)/(t+1);P(s,n,o,e,z$4.LEFT_JOIN_END,u,g),P(s,n,o,e,z$4.RIGHT_JOIN_END,u,g);}P(s,n,o,1,z$4.LEFT_JOIN_START,u,g),P(s,n,o,1,z$4.RIGHT_JOIN_START,u,g),r$k(s,n),r$k(n,o);}L?(o$9(o,l[3],l[4],l[5]),v&&O$5(o,o,v),g=b(s,n,C),P(s,n,o,0,z$4.LEFT_JOIN_END,N,g),P(s,n,o,0,z$4.RIGHT_JOIN_END,N,g)):(g=b(s,n,C),P(s,n,n,0,z$4.LEFT_CAP_END,C,g),P(s,n,n,0,z$4.RIGHT_CAP_END,C,g)),Z$3(R,O+S,R,O,S);I=Z$3(R,I-S,R,I,S),this._parameters.wireframe&&this._addWireframeVertices(r,O,I,S);}_addWireframeVertices(e,t,r,i){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let n=0;const o=e=>n=Z$3(a,e,s,n,i);for(let l=0;l<a.length-1;l+=2*i)o(l),o(l+2*i),o(l+1*i),o(l+2*i),o(l+1*i),o(l+3*i);}}function Z$3(e,t,r,i,s){for(let a=0;a<s;a++)r[i++]=e[t++];return i}function k$1(e,t,r){return X$2(e,t.get(O$6.POSITION).data,r?r.get(O$6.POSITION):null)}function X$2(e,t,r){return !!e.isClosed&&(r?r.length>2:t.length>6)}const q$1=n$g(),Y$2=n$g(),Q$4=n$g(),K$4=n$g(),$$4=n$g(),ee$2=x$6(),te$2=x$6(),re$2=n$g(),ie$2=n$g(),se$2=v$7(),ae$2=v$7(),ne$2=n$g(),oe$2=n$g(),le$2=n$g(),ce$3=[x$6(),x$6(),x$6(),x$6()],he$1=[n$g(),n$g(),n$g(),n$g()],pe$2=p$8(),ue$3=p$8(),me$2=p$8(),fe$1=p$8();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function t$b(t){return "point"===t.type}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function A$4(t,e){if("point"===t.type)return F$4(t,e,!1);if(l$f(t))switch(t.type){case"extent":return F$4(t.center,e,!1);case"polygon":return F$4(t.centroid,e,!1);case"polyline":return F$4(M$3(t),e,!0);case"mesh":return F$4(t.origin,e,!1)}else switch(t.type){case"extent":return F$4(P$4(t),e,!0);case"polygon":return F$4(k(t),e,!0);case"polyline":return F$4(M$3(t),e,!0)}}function M$3(t){const e=t.paths[0];if(!e||0===e.length)return null;const r=l$g(e,s$n(e)/2);return v$9(r[0],r[1],r[2],t.spatialReference)}function P$4(t){const e=isFinite(t.zmin);return v$9(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),e?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function k(t){const e=t.rings[0];if(!e||0===e.length)return null;const r=o$l(t.rings,t.hasZ);return v$9(r[0],r[1],r[2],t.spatialReference)}function F$4(t,e,r){const n=r?t:k$4(t);return e&&t?Pn(t,n,e)?n:null:n}function z$3(t,e,r,n=0){if(t){e||(e=u$f());const o=t;let i=.5*o.width*(r-1),s=.5*o.height*(r-1);return o.width<1e-7*o.height?i+=s/20:o.height<1e-7*o.width&&(s+=i/20),r$g(e,o.xmin-i-n,o.ymin-s-n,o.xmax+i+n,o.ymax+s+n),e}return null}function U$4(t,e){for(let r=0;r<t.geometries.length;++r){const n=t.geometries[r].getMutableAttribute(O$6.AUXPOS1);n&&n.data[3]!==e&&(n.data[3]=e,t.geometryVertexAttrsUpdated(t.geometryRecords[r]));}}function B$3(e,r){const n=t$l(_$7);return r$h(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),r$h(r)?n[3]=r:r$h(e)&&e.length>3&&(n[3]=e[3]),n}function I$3(t=l$i,r,n,o=1){const i=new Array(3);if(t$d(r)||t$d(n))i[0]=1,i[1]=1,i[2]=1;else {let e,o=0;for(let s=2;s>=0;s--){const u=t[s];let a;const m=null!=u,l=0===s&&!e&&!m,c=n[s];"symbol-value"===u||l?a=0!==c?r[s]/c:1:m&&"proportional"!==u&&isFinite(u)&&(a=0!==c?u/c:1),null!=a&&(i[s]=a,e=a,o=Math.max(o,Math.abs(a)));}for(let t=2;t>=0;t--)null==i[t]?i[t]=e:0===i[t]&&(i[t]=.001*o);}for(let e=2;e>=0;e--)i[e]/=o;return e$o(i)}function O$3(t){return null!=t.isPrimitive}function S$5(t){return O$3(t)&&(t=[t.width,t.depth,t.height]),V(t)?null:"Symbol sizes may not be negative values"}function V(t){if(Array.isArray(t)){for(const e of t)if(!V(e))return !1;return !0}return null==t||t>=0}function G$1(t,e,r,u=e$d()){const a=t||0,m=e||0,l=r||0;return 0!==a&&m$8(u,u,-a/180*Math.PI),0!==m&&b$8(u,u,m/180*Math.PI),0!==l&&l$h(u,u,l/180*Math.PI),u}function X$1(t,e,n){if(null!=n.minDemResolution)return n.minDemResolution;const o=$$5(e),i=I$5(t)*o,s=y$3(t)*o,u=N$2(t)*(e.isGeographic?1:o);return 0===i&&0===s&&0===u?n.minDemResolutionForPoints:.01*Math.max(i,s,u)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class t$a{constructor(e,r=null,t=0){this.array=e,this.spatialReference=r,this.offset=t;}}function a$7(e){return "array"in e}function i$d(t,i,n="ground"){if(t$b(i))return t.getElevation(i.x,i.y,i.z||0,i.spatialReference,n);if(a$7(i)){let r=i.offset;return t.getElevation(i.array[r++],i.array[r++],i.array[r]||0,c$d(i.spatialReference,t.spatialReference),n)}return t.getElevation(i[0],i[1],i[2]||0,t.spatialReference,n)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function f$9(e,t,n,o,r,s,a,l,c,u,f){const d=O$2[f.mode];let m,p,g=0;if(Un(e,t,n,o,c.spatialReference,r,l))return d.requiresAlignment(f)?(g=d.applyElevationAlignmentBuffer(o,r,s,a,l,c,u,f),m=s,p=a):(m=o,p=r),Un(m,c.spatialReference,p,s,u.spatialReference,a,l)?g:void 0}function d$6(n,o,r,i,s){const l=(t$b(n)?n.z:a$7(n)?n.array[n.offset+2]:n[2])||0;switch(r.mode){case"on-the-ground":{const e=c$d(i$d(o,n,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=e,void(s.z=e)}case"relative-to-ground":{const e=c$d(i$d(o,n,"ground"),0),a=r.geometryZWithOffset(l,i);return s.verticalDistanceToGround=a,s.sampledElevation=e,void(s.z=a+e)}case"relative-to-scene":{const e=c$d(i$d(o,n,"scene"),0),a=r.geometryZWithOffset(l,i);return s.verticalDistanceToGround=a,s.sampledElevation=e,void(s.z=a+e)}case"absolute-height":{const e=r.geometryZWithOffset(l,i),a=c$d(i$d(o,n,"ground"),0);return s.verticalDistanceToGround=e-a,s.sampledElevation=a,void(s.z=e)}default:return n$l(r.mode),void(s.z=0)}}function m$3(e,t,n,o){return d$6(e,t,n,o,z$2),z$2.z}function p$6(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?x$3.UPDATE:e.onTheGroundChanged}function g$3(e){return "relative-to-ground"===e||"relative-to-scene"===e}function v$4(e){return "absolute-height"!==e}function h$8(e,t,o,r,i){d$6(t,o,i,r,z$2),U$4(e,z$2.verticalDistanceToGround);const a=z$2.sampledElevation,c=n$f(U$3,e.transformation);C$1[0]=t.x,C$1[1]=t.y,C$1[2]=z$2.z;return qn(t.spatialReference,C$1,c,r.spatialReference)?e.transformation=c:console.warn("Could not locate symbol object properly, it might be misplaced"),a}function E$2(e,n,o,r,i,s){let a=0;const l=s.spatialReference;n*=3,r*=3;for(let c=0;c<i;++c){const i=e[n+0],c=e[n+1],u=e[n+2],f=c$d(s.getElevation(i,c,u,l,"ground"),0);a+=f,o[r+0]=i,o[r+1]=c,o[r+2]=f,n+=3,r+=3;}return a/i}function y$1(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,d=s.spatialReference;n*=3,r*=3;for(let m=0;m<i;++m){const i=e[n+0],a=e[n+1],l=e[n+2],m=c$d(s.getElevation(i,a,l,d,"ground"),0);c+=m,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+m+u:m+u,n+=3,r+=3;}return c/i}function A$3(e,n,o,r,i,s,a,l){let c=0;const u=l.calculateOffsetRenderUnits(a),f=l.featureExpressionInfoContext,d=s.spatialReference;n*=3,r*=3;for(let m=0;m<i;++m){const i=e[n+0],a=e[n+1],l=e[n+2],m=c$d(s.getElevation(i,a,l,d,"scene"),0);c+=m,o[r+0]=i,o[r+1]=a,o[r+2]=null==f?l+m+u:m+u,n+=3,r+=3;}return c/i}function R$4(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}function T$6(e,t,n,o,r,i,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,o*=3;for(let u=0;u<r;++u){const r=e[t+0],i=e[t+1],s=e[t+2];n[o+0]=r,n[o+1]=i,n[o+2]=null==c?s+l:l,t+=3,o+=3;}return 0}class j$5{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0;}}var x$3;!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE";}(x$3||(x$3={}));const O$2={"absolute-height":{applyElevationAlignmentBuffer:T$6,requiresAlignment:R$4},"on-the-ground":{applyElevationAlignmentBuffer:E$2,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:y$1,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:A$3,requiresAlignment:()=>!0}},U$3=e$d(),z$2=new j$5,C$1=n$g();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const n$9=s$l.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function c$a(e){return {cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function a$6(e,t,n){const c=e&&e.expression;if("string"!=typeof c)return null;const o=p$5(c);if(null!=o)return {cachedResult:o};const a=await a$c(),u=a.arcadeUtils,s=u.createSyntaxTree(c);return u.dependsOnView(s)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:u.createFunction(s),context:u.createExecContext(null,{sr:t}),modules:a}}}function u$8(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function s$f(e,r){if(null!=e&&!f$8(e)){if(!r||!e.arcade)return void n$9.errorOncePerTick("Arcade support required but not provided");const c=r;c._geometry&&(c._geometry=p$9(c._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,r);}}function l$5(e){if(null!=e){if(f$8(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return "number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function i$c(e,t=!1){let r=e&&e.featureExpressionInfo;const n=r&&r.expression;return t||"0"===n||(r=null),r}const d$5={cachedResult:0};function f$8(e){return null!=e.cachedResult}function p$5(e){return "0"===e?0:null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class h$7{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null;}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=r$n(t);}get requiresSampledElevationInfo(){return "absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters";}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0;}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0;}addOffsetRenderUnits(t){this._renderUnitOffset+=t;}geometryZWithOffset(t,e){const n=this.calculateOffsetRenderUnits(e);return null!=this.featureExpressionInfoContext?n:t+n}calculateOffsetRenderUnits(t){let e=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(e+=l$5(n)*this._metersPerElevationInfoUnit),e/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=n$m(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=c$d(e.offset,0);}updateFeatureExpressionInfoContext(t,s,i){if(t$d(t))return void(this._featureExpressionInfoContext=null);const r=t&&t.arcade;r&&r$h(s)&&r$h(i)?(this._featureExpressionInfoContext=c$a(t),s$f(this._featureExpressionInfoContext,u$8(r.modules,s,i))):this._featureExpressionInfoContext=t;}static fromElevationInfo(t){const e=new h$7;return r$h(t)&&e.setFromElevationInfo(t),e}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const e$5=128,a$5=.5;function o$7(t,o=e$5,c=o*a$5,s=0){const i=u$7(t,o,c,s);return new L$5(i,{mipmap:!1,wrap:{s:D$2.CLAMP_TO_EDGE,t:D$2.CLAMP_TO_EDGE},width:o,height:o,components:4,noUnpackFlip:!0})}function u$7(t,n=e$5,r=n*a$5,o=0){switch(t){case"circle":default:return c$9(n,r);case"square":return s$e(n,r);case"cross":return h$6(n,r,o);case"x":return f$7(n,r,o);case"kite":return i$b(n,r);case"triangle":return M$2(n,r);case"arrow":return m$2(n,r)}}function c$9(t,n){const r=t/2-.5;return w$3(t,T$5(r,r,n/2))}function s$e(t,n){return l$4(t,n,!1)}function i$b(t,n){return l$4(t,n,!0)}function h$6(t,n,r=0){return p$4(t,n,!1,r)}function f$7(t,n,r=0){return p$4(t,n,!0,r)}function M$2(t,n){return w$3(t,b$5(t/2,n,n/2))}function m$2(t,n){const r=n,e=n/2,a=t/2,o=.8*r,u=T$5(a,(t-n)/2-o,Math.sqrt(o*o+e*e)),c=b$5(a,r,e);return w$3(t,((t,n)=>Math.max(c(t,n),-u(t,n))))}function l$4(t,n,r){return r&&(n/=Math.SQRT2),w$3(t,((e,a)=>{let o=e-.5*t+.25,u=.5*t-a-.75;if(r){const t=(o+u)/Math.SQRT2;u=(u-o)/Math.SQRT2,o=t;}return Math.max(Math.abs(o),Math.abs(u))-.5*n}))}function p$4(t,n,r,e=0){n-=e,r&&(n*=Math.SQRT2);const a=.5*n;return w$3(t,((n,o)=>{let u,c=n-.5*t,s=.5*t-o-1;if(r){const t=(c+s)/Math.SQRT2;s=(s-c)/Math.SQRT2,c=t;}return c=Math.abs(c),s=Math.abs(s),u=c>s?c>a?Math.sqrt((c-a)*(c-a)+s*s):s:s>a?Math.sqrt(c*c+(s-a)*(s-a)):c,u-=e/2,u}))}function T$5(t,n,r){return (e,a)=>{const o=e-t,u=a-n;return Math.sqrt(o*o+u*u)-r}}function b$5(t,n,r){const e=Math.sqrt(n*n+r*r);return (a,o)=>{const u=Math.abs(a-t)-r,c=o-t+n/2+.75,s=(n*u+r*c)/e,i=-c;return Math.max(s,i)}}function w$3(n,r){const e=new Uint8Array(4*n*n);for(let a=0;a<n;a++)for(let o=0;o<n;o++){const u=o+n*a;let c=r(o,a);c=c/n+.5,o$m(c,e,4*u);}return e}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function n$8(n){return n instanceof Float32Array&&n.length>=16}function r$c(n){return Array.isArray(n)&&n.length>=16}function t$9(t){return n$8(t)||r$c(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var c$8;!function(c){c[c.Occluded=0]="Occluded",c[c.NotOccluded=1]="NotOccluded",c[c.Both=2]="Both",c[c.COUNT=3]="COUNT";}(c$8||(c$8={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var p$3;function u$6(u,v){u.include(c$g),u.attributes.add(O$6.POSITION,"vec3"),u.attributes.add(O$6.NORMAL,"vec3"),u.attributes.add(O$6.AUXPOS1,"vec4");const m=u.vertex;v$6(u,v),c$e(m,v),m.uniforms.add([new e$8("viewport",((e,t)=>t.camera.fullViewport)),new o$b("polygonOffset",(e=>e.shaderPolygonOffset)),new o$b("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1)),new o$b("renderTransparentlyOccludedHUD",((e,o)=>o.renderTransparentlyOccludedHUD===c$8.Occluded?1:o.renderTransparentlyOccludedHUD===c$8.NotOccluded?0:.75)),new m$6("hudVisibilityTexture",((e,t)=>t.hudVisibilityTexture))]),v.hasVerticalOffset&&f$e(m),m.constants.add("smallOffsetAngle","float",.984807753012208),m.code.add(n$c`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),m.code.add(n$c`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),v.isDraped&&!v.hasVerticalOffset||m.uniforms.add(new e$k("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix))),v.isDraped||(m.uniforms.add(new o$b("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),m.code.add(n$c`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),v.screenCenterOffsetUnitsEnabled===p$3.Screen&&m.uniforms.add(new o$b("pixelRatio",((e,t)=>t.camera.pixelRatio))),v.hasScreenSizePerspective&&i$h(m),m.code.add(n$c`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${v.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${v.hasScreenSizePerspective&&(v.hasVerticalOffset||v.screenCenterOffsetUnitsEnabled===p$3.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${v.hasVerticalOffset?v.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${v.hasVerticalOffset?n$c`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${v.screenCenterOffsetUnitsEnabled!==p$3.Screen?n$c`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${v.screenCenterOffsetUnitsEnabled===p$3.Screen?v.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${v.screenCenterOffsetUnitsEnabled===p$3.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),m.code.add(n$c`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`);}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT";}(p$3||(p$3={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function c$7(c){const i=n$c`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,o=n$c`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(i),c.vertex.code.add(o),c.fragment.code.add(i),c.fragment.code.add(o);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function a$4(a){a.include(a$d),a.uniforms.add([new m$6("geometryDepthTexture",((e,r)=>r.multipassGeometry.linearDepthTexture)),new e$9("nearFar",((e,r)=>r.camera.nearFar))]),a.code.add(n$c`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`);}class s$d{constructor(){this.enabled=!1;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function s$c(s,n){const{vertex:p,fragment:l}=s;n.hasMultipassGeometry&&p.include(a$4),n.hasMultipassTerrain&&s.varyings.add("depth","float"),p.code.add(n$c`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${n.hasMultipassGeometry?n$c`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${n.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),n.hasMultipassTerrain&&l.include(a$d),n.hasMultipassTerrain&&l.uniforms.add([new m$6("terrainDepthTexture",((e,r)=>r.multipassTerrain.linearDepthTexture)),new e$9("nearFar",((e,r)=>r.camera.nearFar)),new e$9("inverseViewport",((e,r)=>r.inverseViewport))]),l.include(a$9),l.code.add(n$c`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${n.hasMultipassTerrain?n$c`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function B$2(i){const l=new o$f,B=i.signedDistanceFieldEnabled;if(l.include(c$7),l.include(u$6,i),l.include(u$d,i),i.occlusionPass)return l.include(s$c,i),l;const{vertex:H,fragment:U}=l;l.include(c$g),U.include(a$9),U.include(e$l),l.include(s$o,i),l.varyings.add("vcolor","vec4"),l.varyings.add("vtc","vec2"),l.varyings.add("vsize","vec2"),i.binaryHighlightOcclusionEnabled&&l.varyings.add("voccluded","float"),H.uniforms.add([new e$8("viewport",((e,o)=>o.camera.fullViewport)),new e$9("screenOffset",((e,i)=>r$f(T$4,2*e.screenOffset[0]*i.camera.pixelRatio,2*e.screenOffset[1]*i.camera.pixelRatio))),new e$9("anchorPosition",(e=>L$2(e))),new e$8("materialColor",(e=>e.color)),new o$b("pixelRatio",((e,o)=>o.camera.pixelRatio))]),B&&(H.uniforms.add(new e$8("outlineColor",(e=>e.outlineColor))),U.uniforms.add([new e$8("outlineColor",(e=>_$1(e)?e.outlineColor:l$b)),new o$b("outlineSize",(e=>_$1(e)?e.outlineSize:0))])),i.hasScreenSizePerspective&&(t$m(H),i$h(H)),(i.debugDrawLabelBorder||i.binaryHighlightOcclusionEnabled)&&l.varyings.add("debugBorderCoords","vec4"),l.attributes.add(O$6.UV0,"vec2"),l.attributes.add(O$6.COLOR,"vec4"),l.attributes.add(O$6.SIZE,"vec2"),l.attributes.add(O$6.AUXPOS2,"vec4"),H.code.add(n$c`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${i.hasScreenSizePerspective?n$c`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:n$c`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${i.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${i.occlusionTestEnabled||i.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${i.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const V=n$c`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,E=i.pixelSnappingEnabled?B?n$c`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:n$c`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:n$c`posProj += quadOffset;`;i.vvColor&&H.uniforms.add([new e$h("vvColorColors",(e=>e.vvColorColors),o$d),new o$c("vvColorValues",(e=>e.vvColorValues),o$d)]),H.uniforms.add(new e$9("textureCoordinateScaleFactor",(o=>r$h(o.texture)&&r$h(o.texture.descriptor.textureCoordinateScaleFactor)?o.texture.descriptor.textureCoordinateScaleFactor:i$i))),H.code.add(n$c`
    ${i.occlusionTestEnabled?"if (visible) {":""}
    ${V}
    ${i.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${n$c.float(t$i)};
    ${B?`alphaDiscard = alphaDiscard && outlineColor.a < ${n$c.float(t$i)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${E}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${i.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${i.occlusionTestEnabled?n$c`} else { vtc = vec2(0.0);
      ${i.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),U.uniforms.add(new m$6("tex",(e=>e.texture)));const M=i.debugDrawLabelBorder?n$c`(isBorder > 0.0 ? 0.0 : ${n$c.float(o$n)})`:n$c.float(o$n),R=n$c`
    ${i.debugDrawLabelBorder?n$c`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${B?n$c`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${n$c.float(e$5)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${n$c.float(t$i)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:n$c`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${i.debugDrawLabelBorder?n$c`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return i.output===h$a.Alpha&&U.code.add(n$c`
      void main() {
        ${R}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),i.output===h$a.Color&&U.code.add(n$c`
    void main() {
      ${R}
      ${i.transparencyPassType===o$e.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),i.output===h$a.Highlight&&(l.include(a$e),U.code.add(n$c`
    void main() {
      ${R}
      ${i.binaryHighlightOcclusionEnabled?n$c`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),l}function _$1(e){return e.outlineColor[3]>0&&e.outlineSize>0}function L$2(e,o=T$4){return e.textureIsSignedDistanceField?H$2(e.anchorPosition,e.distanceFieldBoundingBox,o):a$b(o,e.anchorPosition),o}function H$2(i,r,l){r$h(r)?r$f(l,i[0]*(r[2]-r[0])+r[0],i[1]*(r[3]-r[1])+r[1]):r$f(l,0,0);}const T$4=n$e(),U$2=Object.freeze(Object.defineProperty({__proto__:null,build:B$2,calculateAnchorPosForRendering:L$2},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class g$2 extends e$m{initializeConfiguration(t,i){i.spherical=t.viewingMode===l$j.Global;}initializeProgram(e){return new o$h(e.rctx,g$2.shader.get().build(this.configuration),E$6)}_setPipelineState(e){const i=this.configuration,r=e===o$e.NONE,o=e===o$e.FrontFace,s=this.configuration.hasPolygonOffset&&b$4,l=(r||o)&&i.output!==h$a.Highlight?(i.depthEnabled||i.occlusionPass)&&a$a:null;return W$2({blending:i.output===h$a.Color||i.output===h$a.Alpha||i.output===h$a.Highlight?r?j$4:A$6(e):null,depthTest:{func:I$6.LEQUAL},depthWrite:l,colorWrite:_$5,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?E$4.POINTS:E$4.TRIANGLES}}g$2.shader=new t$j(U$2,(()=>import('./HUDMaterial.glsl-bf7de45a.js')));const b$4={factor:0,units:-4},j$4=s$p(R$7.ONE,R$7.ONE_MINUS_SRC_ALPHA);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class p$2 extends s$j{constructor(){super(...arguments),this.output=h$a.Color,this.screenCenterOffsetUnitsEnabled=p$3.World,this.transparencyPassType=o$e.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1;}}e$i([e$j({count:h$a.COUNT})],p$2.prototype,"output",void 0),e$i([e$j({count:p$3.COUNT})],p$2.prototype,"screenCenterOffsetUnitsEnabled",void 0),e$i([e$j({count:o$e.COUNT})],p$2.prototype,"transparencyPassType",void 0),e$i([e$j()],p$2.prototype,"spherical",void 0),e$i([e$j()],p$2.prototype,"occlusionTestEnabled",void 0),e$i([e$j()],p$2.prototype,"signedDistanceFieldEnabled",void 0),e$i([e$j()],p$2.prototype,"vvSize",void 0),e$i([e$j()],p$2.prototype,"vvColor",void 0),e$i([e$j()],p$2.prototype,"hasVerticalOffset",void 0),e$i([e$j()],p$2.prototype,"hasScreenSizePerspective",void 0),e$i([e$j()],p$2.prototype,"debugDrawLabelBorder",void 0),e$i([e$j()],p$2.prototype,"binaryHighlightOcclusionEnabled",void 0),e$i([e$j()],p$2.prototype,"hasSlicePlane",void 0),e$i([e$j()],p$2.prototype,"hasPolygonOffset",void 0),e$i([e$j()],p$2.prototype,"depthEnabled",void 0),e$i([e$j()],p$2.prototype,"pixelSnappingEnabled",void 0),e$i([e$j()],p$2.prototype,"isDraped",void 0),e$i([e$j()],p$2.prototype,"hasMultipassGeometry",void 0),e$i([e$j()],p$2.prototype,"hasMultipassTerrain",void 0),e$i([e$j()],p$2.prototype,"cullAboveGround",void 0),e$i([e$j()],p$2.prototype,"occlusionPass",void 0),e$i([e$j({constValue:!0})],p$2.prototype,"hasSliceInVertexProgram",void 0),e$i([e$j({constValue:!1})],p$2.prototype,"hasVvInstancing",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class K$3 extends d$9{constructor(e){super(e,new Oe),this._configuration=new p$2;}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?p$3.Screen:p$3.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=t.slot===E$5.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===h$a.Color||e===h$a.Alpha),e===h$a.Color&&(this._configuration.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===h$a.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,s,i,a,n,o,c,l){r$h(l)?this._intersectDrapedHudGeometry(e,n,o,c,l):this._intersectHudGeometry(e,r,s,i,o,c);}_intersectDrapedHudGeometry(e,r,s,i,a){const n=e.vertexAttributes.get(O$6.POSITION),o=e.vertexAttributes.get(O$6.SIZE),c=this.parameters,l=L$2(c);let f=1,u=1;if(r$h(i)){const e=i(pe$1);f=e[0],u=e[5];}f*=e.screenToWorldRatio,u*=e.screenToWorldRatio;const h=de*e.screenToWorldRatio;for(let t=0;t<n.data.length/n.size;t++){const i=t*n.size,p=n.data[i],m=n.data[i+1],d=t*o.size;let g;ge$1[0]=o.data[d]*f,ge$1[1]=o.data[d+1]*u,c.textureIsSignedDistanceField&&(g=c.outlineSize*e.screenToWorldRatio/2),ee$1(r,p,m,ge$1,h,g,c,l)&&s(a.dist,a.normal,-1,!1);}}_intersectHudGeometry(e,r,i,n,o,c){if(!n.options.selectionMode||!n.options.hud||u$e(r))return;const l=this.parameters;let O=1,v=1;if(a$f(ce$2,i),r$h(c)){const e=c(pe$1);O=e[0],v=e[5],$$3(ce$2);}const A=e.vertexAttributes.get(O$6.POSITION),b=e.vertexAttributes.get(O$6.SIZE),x=e.vertexAttributes.get(O$6.NORMAL),_=e.vertexAttributes.get(O$6.AUXPOS1);e$e(A.size>=3);const y=n.point,I=n.camera,z=L$2(l);O*=I.pixelRatio,v*=I.pixelRatio;const T="screen"===this.parameters.centerOffsetUnits;for(let t=0;t<A.data.length/A.size;t++){const e=t*A.size;o$9(se$1,A.data[e],A.data[e+1],A.data[e+2]),O$5(se$1,se$1,i);const r=t*b.size;ge$1[0]=b.data[r]*O,ge$1[1]=b.data[r+1]*v,O$5(se$1,se$1,I.viewMatrix);const s=t*_.size;if(o$9(ue$2,_.data[s+0],_.data[s+1],_.data[s+2]),!T&&(se$1[0]+=ue$2[0],se$1[1]+=ue$2[1],0!==ue$2[2])){const e=ue$2[2];z$6(ue$2,se$1),e$f(se$1,se$1,g$5(ue$2,ue$2,e));}const c=t*x.size;if(o$9(ie$1,x.data[c],x.data[c+1],x.data[c+2]),this._normalAndViewAngle(ie$1,ce$2,I,he),this._applyVerticalOffsetTransformationView(se$1,he,I,te$1),I.applyProjection(se$1,ae$1),ae$1[0]>-1){ae$1[0]=Math.floor(ae$1[0]),ae$1[1]=Math.floor(ae$1[1]),T&&(ue$2[0]||ue$2[1])&&(ae$1[0]+=ue$2[0],0!==ue$2[1]&&(ae$1[1]+=o$o(ue$2[1],te$1.factorAlignment)),I.unapplyProjection(ae$1,se$1)),ae$1[0]+=this.parameters.screenOffset[0],ae$1[1]+=this.parameters.screenOffset[1],f$f(ge$1,te$1.factor,ge$1);const e=me$1*I.pixelRatio;let t;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*I.pixelRatio/2),ee$1(y,ae$1[0],ae$1[1],ge$1,e,t,l,z)){const e=n.ray;if(O$5(oe$1,se$1,h$c(fe,I.viewMatrix)),ae$1[0]=y[0],ae$1[1]=y[1],I.unprojectFromRenderScreen(ae$1,se$1)){const t=n$g();r$k(t,e.direction);const r=1/s$m(t);g$5(t,t,r);o(x$5(e.origin,se$1)*r,t,-1,!0,1,oe$1);}}}}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return !1;const s=r.get(O$6.POSITION),i=e.indices.get(O$6.POSITION);return g$6(s,i,t)}createBufferWriter(){return new Ae(this)}_normalAndViewAngle(e,t,r,i){return t$9(t)&&(t=a$f(le$1,t)),S$8(i.normal,e,t),O$5(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=P$6(ne$1,Se),i}_updateScaleInfo(e,r,s){const i=this.parameters;r$h(i.screenSizePerspective)?d$a(s,r,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r$h(i.screenSizePerspectiveAlignment)?d$a(s,r,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels);}applyShaderOffsetsView(e,t,r,s,i,a,n){const o=this._normalAndViewAngle(t,r,i,he);return this._applyVerticalGroundOffsetView(e,o,i,n),this._applyVerticalOffsetTransformationView(n,o,i,a),this._applyPolygonOffsetView(n,o,s[3],i,n),this._applyCenterOffsetView(n,s,n),n}applyShaderOffsetsNDC(e,r,s,i,a){return this._applyCenterOffsetNDC(e,r,s,i),r$h(a)&&r$k(a,i),this._applyPolygonOffsetNDC(i,r,s,i),i}_applyPolygonOffsetView(t,r,s,i,a){const n=i.aboveGround?1:-1;let o=Math.sign(s);0===o&&(o=n);const c=n*o;if(this.parameters.shaderPolygonOffset<=0)return r$k(a,t);const l=o$k(Math.abs(r.cosAngle),.01,1),f=1-Math.sqrt(1-l*l)/l/i.viewport[2];return g$5(a,t,c>0?f:1/f),a}_applyVerticalGroundOffsetView(e,t,r,s){const i=s$m(e),a=r.aboveGround?1:-1,n=.5*r.computeRenderPixelSizeAtDist(i),o=g$5(se$1,t.normal,a*n);return u$c(s,e,o),s}_applyVerticalOffsetTransformationView(e,t,s,i){const a=this.parameters;if(!a.verticalOffset||!a.verticalOffset.screenLength){if(a.screenSizePerspective||a.screenSizePerspectiveAlignment){const r=s$m(e);this._updateScaleInfo(i,r,t.cosAngle);}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const n=s$m(e),o=c$d(a.screenSizePerspectiveAlignment,a.screenSizePerspective),c=L$6(s,n,a.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,n,t.cosAngle),g$5(t.normal,t.normal,c),u$c(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const s="screen"!==this.parameters.centerOffsetUnits;return r!==e&&r$k(r,e),s&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(z$6(ie$1,r),u$c(r,r,g$5(ie$1,ie$1,t[2])))),r}_applyCenterOffsetNDC(e,t,r,s){const i="screen"!==this.parameters.centerOffsetUnits;return s!==e&&r$k(s,e),i||(s[0]+=t[0]/r.fullWidth*2,s[1]+=t[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,t,r,s){const i=this.parameters.shaderPolygonOffset;if(e!==s&&r$k(s,e),i){const e=r.aboveGround?1:-1,a=e*Math.sign(t[3]);s[2]-=(a||e)*i;}return s}requiresSlot(e,t){if(t===h$a.Color||t===h$a.Alpha||t===h$a.Highlight){if(e===E$5.DRAPED_MATERIAL)return !0;const{drawInSecondSlot:t,occlusionTest:r}=this.parameters;return e===(t?E$5.LABEL_MATERIAL:E$5.HUD_MATERIAL)||r&&e===E$5.OCCLUSION_PIXELS}return !1}createGLMaterial(e){return new Q$3(e)}calculateRelativeScreenBounds(e,t,r=u$f()){return Y$1(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class Q$3 extends h$d{constructor(e){super({...e,...e.material.parameters});}selectProgram(e){return this.ensureTechnique(g$2,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function Y$1(e,t,r,s=re$1){return a$b(s,e.anchorPosition),s[0]*=-t[0],s[1]*=-t[1],s[0]+=e.screenOffset[0]*r,s[1]+=e.screenOffset[1]*r,s}function $$3(e){const t=e[0],r=e[1],s=e[2],i=e[3],a=e[4],n=e[5],o=e[6],c=e[7],l=e[8],f=1/Math.sqrt(t*t+r*r+s*s),u=1/Math.sqrt(i*i+a*a+n*n),h=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*f,e[1]=r*f,e[2]=s*f,e[3]=i*u,e[4]=a*u,e[5]=n*u,e[6]=o*h,e[7]=c*h,e[8]=l*h,e}function ee$1(e,r,s,i,a,n,o,c){let l=r-a-(c[0]>0?i[0]*c[0]:0),f=l+i[0]+2*a,u=s-a-(c[1]>0?i[1]*c[1]:0),h=u+i[1]+2*a;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&r$h(p)&&(l+=i[0]*p[0],u+=i[1]*p[1],f-=i[0]*(1-p[2]),h-=i[1]*(1-p[3]),l-=n,f+=n,u-=n,h+=n),e[0]>l&&e[0]<f&&e[1]>u&&e[1]<h}const te$1={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},re$1=n$e(),se$1=n$g(),ie$1=n$g(),ae$1=n$d(),ne$1=n$g(),oe$1=n$g(),ce$2=e$p(),le$1=e$p(),fe=e$d(),ue$2=n$g(),he={normal:ne$1,cosAngle:0},pe$1=e$d(),me$1=1,de=2,ge$1=[0,0],Se=r$l(0,0,1);class Oe extends o$p{constructor(){super(...arguments),this.renderOccluded=o$j.Occlude,this.color=r$o(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=r$p(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=r$o(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1;}}const ve=T$8().vec3f(O$6.POSITION).vec3f(O$6.NORMAL).vec2f(O$6.UV0).vec4u8(O$6.COLOR).vec2f(O$6.SIZE).vec4f(O$6.AUXPOS1).vec4f(O$6.AUXPOS2);class Ae{constructor(e){this._material=e,this.vertexBufferLayout=ve;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(O$6.POSITION).length}write(e,t,r,s){p$a(t.indices.get(O$6.POSITION),t.vertexAttributes.get(O$6.POSITION).data,e.transformation,r.position,s,6),y$4(t.indices.get(O$6.NORMAL),t.vertexAttributes.get(O$6.NORMAL).data,e.invTranspTransformation,r.normal,s,6);{const e=t.vertexAttributes.get(O$6.UV0).data;let i,a,n,o;if(null==e||e.length<4){const e=this._material.parameters;i=0,a=0,n=e.texCoordScale[0],o=e.texCoordScale[1];}else i=e[0],a=e[1],n=e[2],o=e[3];n=Math.min(1.99999,n+1),o=Math.min(1.99999,o+1);const c=t.indices.get(O$6.POSITION).length,l=r.uv0;let f=s;for(let t=0;t<c;++t)l.set(f,0,i),l.set(f,1,a),f+=1,l.set(f,0,n),l.set(f,1,a),f+=1,l.set(f,0,n),l.set(f,1,o),f+=1,l.set(f,0,n),l.set(f,1,o),f+=1,l.set(f,0,i),l.set(f,1,o),f+=1,l.set(f,0,i),l.set(f,1,a),f+=1;}g$7(t.indices.get(O$6.COLOR),t.vertexAttributes.get(O$6.COLOR).data,4,r.color,s,6);{const e=t.indices.get(O$6.SIZE),i=t.vertexAttributes.get(O$6.SIZE).data,a=e.length,n=r.size;let o=s;for(let t=0;t<a;++t){const r=i[2*e[t]],s=i[2*e[t]+1];for(let e=0;e<6;++e)n.set(o,0,r),n.set(o,1,s),o+=1;}}t.indices.get(O$6.AUXPOS1)&&t.vertexAttributes.get(O$6.AUXPOS1)&&d$b(t.indices.get(O$6.AUXPOS1),t.vertexAttributes.get(O$6.AUXPOS1).data,r.auxpos1,s,6),t.indices.get(O$6.AUXPOS2)&&t.vertexAttributes.get(O$6.AUXPOS2)&&d$b(t.indices.get(O$6.AUXPOS2),t.vertexAttributes.get(O$6.AUXPOS2).data,r.auxpos2,s,6);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const f$6=T$8().vec3f(O$6.POSITION),o$6=T$8().vec3f(O$6.POSITION).vec2f(O$6.UV0),u$5=T$8().vec3f(O$6.POSITION).vec4u8(O$6.COLOR);class i$a{constructor(e){this.vertexBufferLayout=e;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O$6.POSITION).length}write(e,t,f,o){h$e(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,f,o);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function v$3(v){const w=new o$f,f=v.output===h$a.Depth,b=v.hasMultipassTerrain&&(v.output===h$a.Color||v.output===h$a.Alpha);v$6(w,v),w.include(r$q,v),w.include(e$q,v),w.attributes.add(O$6.POSITION,"vec3"),w.varyings.add("vpos","vec3"),b&&w.varyings.add("depth","float");const{vertex:C,fragment:y}=w;return f&&(w.include(o$g,v),C.uniforms.add(new e$9("nearFar",((e,r)=>r.camera.nearFar))),w.varyings.add("linearDepth","float")),C.code.add(n$c`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${b?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${f?n$c`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:n$c`transformPosition(proj, view, vpos);`}
    }
  `),w.include(u$d,v),b&&w.include(n$k,v),y.include(e$l),y.uniforms.add(new e$8("eColor",(e=>e.color))),v.output===h$a.Highlight&&w.include(a$e),y.code.add(n$c`
  void main() {
    discardBySlice(vpos);
    ${b?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${v.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${n$c.float(t$i)}) {
      discard;
    }

    ${v.output===h$a.Alpha?n$c`gl_FragColor = vec4(fColor.a);`:""}

    ${v.output===h$a.Color?n$c`gl_FragColor = highlightSlice(fColor, vpos); ${v.transparencyPassType===o$e.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${v.output===h$a.Highlight?n$c`outputHighlight();`:""};
    ${v.output===h$a.Depth?n$c`outputDepth(linearDepth);`:""};
  }
  `),w}const w$2=Object.freeze(Object.defineProperty({__proto__:null,build:v$3},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class b$3 extends e$m{initializeProgram(e){return new o$h(e.rctx,b$3.shader.get().build(this.configuration),E$6)}_createPipeline(t,r){const i=this.configuration,a=t===o$e.NONE,d=t===o$e.FrontFace;return W$2({blending:i.output!==h$a.Color&&i.output!==h$a.Alpha||!i.transparent?null:a?c$f:A$6(t),culling:h$f(i.cullFace),depthTest:{func:l$c(t)},depthWrite:a||d?i.writeDepth&&a$a:null,colorWrite:_$5,stencilWrite:i.hasOccludees?e$n:null,stencilTest:i.hasOccludees?r?o$i:f$d:null,polygonOffset:a||d?i.polygonOffset&&j$3:a$g(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}b$3.shader=new t$j(w$2,(()=>import('./ColorMaterial.glsl-bdc3619a.js')));const j$3={factor:1,units:1};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class p$1 extends s$j{constructor(){super(...arguments),this.output=h$a.Color,this.cullFace=n$n.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=o$e.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$i([e$j({count:h$a.COUNT})],p$1.prototype,"output",void 0),e$i([e$j({count:n$n.COUNT})],p$1.prototype,"cullFace",void 0),e$i([e$j()],p$1.prototype,"hasSlicePlane",void 0),e$i([e$j()],p$1.prototype,"hasVertexColors",void 0),e$i([e$j()],p$1.prototype,"transparent",void 0),e$i([e$j()],p$1.prototype,"polygonOffset",void 0),e$i([e$j()],p$1.prototype,"enableOffset",void 0),e$i([e$j()],p$1.prototype,"writeDepth",void 0),e$i([e$j()],p$1.prototype,"hasOccludees",void 0),e$i([e$j({count:o$e.COUNT})],p$1.prototype,"transparencyPassType",void 0),e$i([e$j()],p$1.prototype,"hasMultipassTerrain",void 0),e$i([e$j()],p$1.prototype,"cullAboveGround",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class f$5 extends d$9{constructor(e){super(e,new _),this.supportsEdges=!0,this._configuration=new p$1;}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<S$9,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,s,i,a,n){x$7(e,t,s,i,a,void 0,n);}requiresSlot(e,r){if(r===h$a.Color||r===h$a.Alpha||r===h$a.Highlight||r===h$a.Depth&&this.parameters.writeLinearDepth){if(e===E$5.DRAPED_MATERIAL)return !0;if(r===h$a.Highlight)return e===E$5.OPAQUE_MATERIAL;return e===(this.parameters.transparent?this.parameters.writeDepth?E$5.TRANSPARENT_MATERIAL:E$5.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:E$5.OPAQUE_MATERIAL)}return !1}createGLMaterial(e){return new m$1(e)}createBufferWriter(){return new i$a(u$5)}}class m$1 extends t$k{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){return this._output!==h$a.Color&&this._output!==h$a.Alpha||this._updateOccludeeState(e),this.ensureTechnique(b$3,e)}}class _ extends h$g{constructor(){super(...arguments),this.color=l$b,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n$n.None,this.hasOccludees=!1;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const d$4={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s$b={dash:d$4.dash,"dash-dot":[...d$4.dash,...d$4.dot],dot:d$4.dot,"long-dash":d$4["long-dash"],"long-dash-dot":[...d$4["long-dash"],...d$4.dot],"long-dash-dot-dot":[...d$4["long-dash"],...d$4.dot,...d$4.dot],none:null,"short-dash":d$4["short-dash"],"short-dash-dot":[...d$4["short-dash"],...d$4["short-dot"]],"short-dash-dot-dot":[...d$4["short-dash"],...d$4["short-dot"],...d$4["short-dot"]],"short-dot":d$4["short-dot"],solid:null},h$5=8;function n$7(t,d=2){return t$d(t)?t:{pattern:t.slice(),pixelRatio:d}}function r$b(o,t=2){return {pattern:[o,o],pixelRatio:t}}function a$3(o){return r$h(o)&&"style"===o.type?l$3(o.style):null}function l$3(o){return r$h(o)?n$7(s$b[o],h$5):null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var e$4,t$8;!function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features";}(e$4||(e$4={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage";}(t$8||(t$8={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var E$1;!function(E){var I,T;(I=E.Geometry||(E.Geometry={}))[I.ADD=1]="ADD",I[I.UPDATE=2]="UPDATE",I[I.REMOVE=4]="REMOVE",(T=E.State||(E.State={}))[T.VISIBILITIES=1]="VISIBILITIES",T[T.VERTEXATTRS=2]="VERTEXATTRS",T[T.TRANSFORMATION=4]="TRANSFORMATION",T[T.HIGHLIGHTS=8]="HIGHLIGHTS",T[T.OCCLUDEES=16]="OCCLUDEES";}(E$1||(E$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const r$a=1.2,t$7=l$b,a$2=_$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let T$3=class extends f$g{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1;}};e$i([d$c()],T$3.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),e$i([d$c()],T$3.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),e$i([d$c()],T$3.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),e$i([d$c()],T$3.prototype,"DECONFLICTOR_SHOW_GRID",void 0),e$i([d$c()],T$3.prototype,"LABELS_SHOW_BORDER",void 0),e$i([d$c()],T$3.prototype,"TEXT_SHOW_BASELINE",void 0),e$i([d$c()],T$3.prototype,"TEXT_SHOW_BORDER",void 0),e$i([d$c()],T$3.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),e$i([d$c()],T$3.prototype,"OVERLAY_SHOW_CENTER",void 0),e$i([d$c()],T$3.prototype,"SHOW_POI",void 0),e$i([d$c()],T$3.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),e$i([d$c()],T$3.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),e$i([d$c()],T$3.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),e$i([d$c()],T$3.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),e$i([d$c()],T$3.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),e$i([d$c()],T$3.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),e$i([d$c()],T$3.prototype,"I3S_TREE_SHOW_TILES",void 0),e$i([d$c()],T$3.prototype,"I3S_SHOW_MODIFICATIONS",void 0),e$i([d$c()],T$3.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),e$i([d$c()],T$3.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),e$i([d$c()],T$3.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),e$i([d$c()],T$3.prototype,"LINE_WIREFRAMES",void 0),T$3=e$i([n$o("esri.views.3d.support.DebugFlags")],T$3);const t$6=new T$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$9{constructor(n,t){this.vec3=n,this.id=t;}}function c$6(n,s,c,e){return new r$9(r$l(n,s,c),e)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var h$4;!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded";}(h$4||(h$4={}));class l$2{constructor(e,r){this.index=e,this.renderTargets=r,this._extent=u$f(),this.resolution=0,this.renderLocalOrigin=c$6(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new u$4,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1);}get extent(){return this._extent}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===h$4.ColorAndWater?this.renderTargets.getTarget(H$4.Color):e===h$4.Highlight?this.renderTargets.getTarget(H$4.Highlight):this.renderTargets.getTarget(H$4.Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(H$4.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(H$4.Color):null}getNormalTexture(e){const t=e===h$4.ColorAndWater?this.renderTargets.getTarget(H$4.Water):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==H$4.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,t):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?l$k.CHANGED:l$k.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return +e[H$4.Color]|+e[H$4.ColorNoRasterImage]<<1|+e[H$4.Highlight]<<2|+e[H$4.Water]<<3|+e[H$4.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$7(this._extent,e.range,0,t);}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];z$7(this._extent,-e.range,0,t);}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,a$h(this.canvasGeometries.extents[0],this._extent);}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return !0}return !1}applyViewport(e){e.setViewport(this.index===T$9.INNER?0:this.resolution,0,this.resolution,this.resolution);}}class u$4{constructor(){this.extents=[u$f(),u$f(),u$f()],this.numViews=0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class b$2{constructor(e,b){this.size=n$p(),this._fbo=null,this._fbo=new b$9(e,{colorTarget:Y$3.TEXTURE,depthStencilTarget:V$2.NONE},{target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,wrapMode:D$2.CLAMP_TO_EDGE,samplingMode:L$7.LINEAR_MIPMAP_LINEAR,hasMipmap:b,maxAnisotropy:8,width:0,height:0});}dispose(){this._fbo=s$q(this._fbo);}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1]);}bind(e){e.bindFramebuffer(this._fbo);}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap();}disposeRenderTargetMemory(){this._fbo?.resize(0,0);}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class t$5{constructor(e,s,t,o=!0){this.output=s,this.type=t,this.valid=!1,this.lastUsed=1/0,this.fbo=new b$2(e,o);}}class o$5{constructor(r){this.renderTargets=[new t$5(r,h$a.Color,H$4.Color),new t$5(r,h$a.Color,H$4.ColorNoRasterImage),new t$5(r,h$a.Highlight,H$4.Highlight,!1),new t$5(r,h$a.Normal,H$4.Water),new t$5(r,h$a.Color,H$4.Occluded)];}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose();}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory();}validateUsageForTarget(e,r,s){if(e)r.lastUsed=s;else if(s-r.lastUsed>a$1)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return !0;return !1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,r)=>e+r.fbo.gpuMemoryUsage),0)}}const a$1=1e3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class s$a{constructor(e){this._context=e,this._perConstructorInstances=new t$n,this._frameCounter=0,this._keepAliveFrameCount=o$4;}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear();}acquire(t,r){const s=r.key;let o=this._perConstructorInstances.get(t,s);if(t$d(o)){const e=new t(this._context,r,(()=>this.release(e)));o=new n$6(e),this._perConstructorInstances.set(t,s,o);}return ++o.refCount,o.technique}releaseAndAcquire(e,r,s){if(r$h(s)){if(r.key===s.key)return s;this.release(s);}return this.acquire(e,r)}release(t){if(t$d(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);t$d(r)||(--r.refCount,0===r.refCount&&(r.refZeroFrame=this._frameCounter));}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==o$4&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r));}));}));}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{const s=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>{e.technique.reload(this._context);})));};e.push(s(t,r));})),await Promise.all(e);}}class n$6{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0;}}const o$4=-1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const s$9=s=>{class e extends s{constructor(){super(...arguments),this._isDisposed=!1;}dispose(){for(const s of this._managedDisposables??[]){const e=this[s];this[s]=null,e&&"function"==typeof e.dispose&&e.dispose();}this._isDisposed=!0;}get isDisposed(){return this._isDisposed}}return e};function i$9(){return (s,e)=>{s.hasOwnProperty("_managedDisposables")||(s._managedDisposables=s._managedDisposables?.slice()??[]),s._managedDisposables.unshift(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class J$2{constructor(t=null,i=null,r=null){this._viewUp=n$g(),this._viewForward=n$g(),this._viewRight=n$g(),this._ray=d$d(),this._viewport=r$o(0,0,1,1),this._padding=r$o(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=r$p(1,1e3),this._viewDirty=!0,this._viewMatrix=e$d(),this._projectionDirty=!0,this._projectionMatrix=e$d(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=e$d(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=e$d(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=H$5(),this._fullViewport=n$d(),this._pixelRatio=1,this.relativeElevation=0,r$h(t)&&r$k(this._ray.origin,t),this._center=r$h(i)?t$e(i):n$g(),this._up=r$h(r)?t$e(r):r$l(0,0,1);}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1;}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin);}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center);}get ray(){return e$f(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up);}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){n$f(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3];}get x(){return this._viewport[0]}set x(t){t+=this._padding[it$1.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get y(){return this._viewport[1]}set y(t){t+=this._padding[it$1.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get fullWidth(){return this._viewport[2]+this._padding[it$1.RIGHT]+this._padding[it$1.LEFT]}set fullWidth(t){this.width=t-(this._padding[it$1.RIGHT]+this._padding[it$1.LEFT]);}get fullHeight(){return this._viewport[3]+this._padding[it$1.TOP]+this._padding[it$1.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[it$1.TOP]+this._padding[it$1.BOTTOM]);}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[it$1.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[it$1.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[it$1.TOP]===t[it$1.TOP]&&this._padding[it$1.RIGHT]===t[it$1.RIGHT]&&this._padding[it$1.BOTTOM]===t[it$1.BOTTOM]&&this._padding[it$1.LEFT]===t[it$1.LEFT]||(this._viewport[0]+=t[it$1.LEFT]-this._padding[it$1.LEFT],this._viewport[1]+=t[it$1.BOTTOM]-this._padding[it$1.BOTTOM],this._viewport[2]-=t[it$1.RIGHT]+t[it$1.LEFT]-(this._padding[it$1.RIGHT]+this._padding[it$1.LEFT]),this._viewport[3]-=t[it$1.TOP]+t[it$1.BOTTOM]-(this._padding[it$1.TOP]+this._padding[it$1.BOTTOM]),a$i(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0);}get viewProjectionMatrix(){return this._viewProjectionDirty&&(u$b(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,e=this.near*Math.tan(this.fovY/2),r=e*this.aspect;A$7(this._projectionMatrix,-r*(1+2*this._padding[it$1.LEFT]/t),r*(1+2*this._padding[it$1.RIGHT]/t),-e*(1+2*this._padding[it$1.BOTTOM]/i),e*(1+2*this._padding[it$1.TOP]/i),this.near,this.far),this._projectionDirty=!1;}return this._projectionMatrix}get inverseProjectionMatrix(){return t$d(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=e$d()),this._inverseProjectionDirty&&h$c(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){n$f(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fovX(){return g$8(this._fov,this.width,this.height)}set fovX(t){this._fov=l$l(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get fovY(){return k$5(this._fov,this.width,this.height)}set fovY(t){this._fov=m$9(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0;}get distance(){return x$5(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return (this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(h$c(this._viewInverseTransposeMatrix,this.viewMatrix),o$q(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){r$k(this._ray.origin,t.eye),r$k(this._center,t.center),r$k(this._up,t.up),a$i(this._viewport,t.viewport),a$i(this._padding,t.padding),a$b(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(n$f(this._viewMatrix,t.viewMatrix),r$k(this._viewRight,t.viewRight),r$k(this._viewUp,t.viewUp),r$k(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(n$f(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(i$j(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n$f(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),a$i(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up;}clone(){return (new J$2).copyFrom(this)}equals(t){return F$5(this.eye,t.eye)&&F$5(this._center,t.center)&&F$5(this._up,t.up)&&D$3(this._viewport,t.viewport)&&D$3(this._padding,t.padding)&&E$7(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return !1;const i=5e-4,e=1-1e-10;J$3(Z$2,t.eye,t.center),J$3($$2,this.eye,this._center);const r=P$6(Z$2,$$2),s=Z$5(Z$2),h=Z$5($$2);return r*r>=e*s*h&&X$3(t.eye,this.eye)<Math.max(s,h)*i*i&&b$a(t.padding,this._padding)<.5&&b$a(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(f$h(this.viewForward,e$f(Z$2,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=i$k()){return t[0]=(this.padding[it$1.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[it$1.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,e=.5){return t[0]=this.padding[it$1.LEFT]+this.width*i,t[1]=this.padding[it$1.BOTTOM]+this.height*e,t[2]=.5,t}setGLViewport(t){const i=this.viewport,e=this.padding;t.setViewport(i[0]-e[3],i[1]-e[2],i[2]+e[1]+e[3],i[3]+e[0]+e[2]);}applyProjection(t,e){t!==K$2&&r$k(K$2,t),K$2[3]=1,w$5(K$2,K$2,this.projectionMatrix);const r=Math.abs(K$2[3]);g$5(K$2,K$2,1/r);const s=this.fullViewport;e[0]=s$r(0,s[0]+s[2],.5+.5*K$2[0]),e[1]=s$r(0,s[1]+s[3],.5+.5*K$2[1]),e[2]=.5*(K$2[2]+1),e[3]=r;}unapplyProjection(t,i){const e=this.fullViewport;K$2[0]=(t[0]/(e[0]+e[2])*2-1)*t[3],K$2[1]=(t[1]/(e[1]+e[3])*2-1)*t[3],K$2[2]=(2*t[2]-1)*t[3],K$2[3]=t[3],w$5(K$2,K$2,this.inverseProjectionMatrix),i[0]=K$2[0],i[1]=K$2[1],i[2]=K$2[2];}projectToScreen(t,i){this.projectToRenderScreen(t,tt$1),this.renderToScreen(tt$1,i);}projectToRenderScreen(t,e){if(K$2[0]=t[0],K$2[1]=t[1],K$2[2]=t[2],K$2[3]=1,w$5(K$2,K$2,this.viewProjectionMatrix),0===K$2[3])return null;g$5(K$2,K$2,1/Math.abs(K$2[3]));const r=this.fullViewport;return "x"in e?(e.x=s$r(0,r[0]+r[2],.5+.5*K$2[0]),e.y=s$r(0,r[1]+r[3],.5+.5*K$2[1])):(e[0]=s$r(0,r[0]+r[2],.5+.5*K$2[0]),e[1]=s$r(0,r[1]+r[3],.5+.5*K$2[1]),e.length>2&&(e[2]=.5*(K$2[2]+1))),e}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,tt$1),i)}unprojectFromRenderScreen(t,i){if(u$b(Q$2,this.projectionMatrix,this.viewMatrix),!h$c(Q$2,Q$2))return null;const e=this.fullViewport;return K$2[0]=2*(t[0]-e[0])/e[2]-1,K$2[1]=2*(t[1]-e[1])/e[3]-1,K$2[2]=2*t[2]-1,K$2[3]=1,w$5(K$2,K$2,Q$2),0===K$2[3]?null:(i[0]=K$2[0]/K$2[3],i[1]=K$2[1]/K$2[3],i[2]=K$2[2]/K$2[3],i)}constrainWindowSize(t,i,e,r=e){const s=t*this._pixelRatio,h=i*this._pixelRatio,o=Math.max(s-e/2,0),n=Math.max(this.fullHeight-h-r/2,0),a=-Math.min(s-e/2,0),_=-Math.min(this.fullHeight-h-r/2,0);return [o,n,e-a- -Math.min(this.fullWidth-s-e/2,0),r-_- -Math.min(h-r/2,0)]}computeUp(t){t===l$j.Global?this._computeUpGlobal():this._computeUpLocal();}screenToRender(t,i){const e=t[0]*this._pixelRatio,r=this.fullHeight-t[1]*this._pixelRatio;return i[0]=e,i[1]=r,i}renderToScreen(t,i){const e=t[0]/this._pixelRatio,r=(this.fullHeight-t[1])/this._pixelRatio;i[0]=e,i[1]=r;}_computeUpGlobal(){e$f(Z$2,this.center,this.eye);const t=s$m(this.center);t<1?(o$9(this._up,0,0,1),this._markViewDirty()):Math.abs(P$6(Z$2,this.center))>.9999*s$m(Z$2)*t||(_$3(this._up,Z$2,this.center),_$3(this._up,this._up,Z$2),z$6(this._up,this._up),this._markViewDirty());}_computeUpLocal(){H$6(Z$2,this.eye,this.center),Math.abs(Z$2[2])<=.9999&&(g$5(Z$2,Z$2,Z$2[2]),o$9(this._up,-Z$2[0],-Z$2[1],1-Z$2[2]),z$6(this._up,this._up),this._markViewDirty());}_compareAndSetView(i,e){"number"==typeof i[0]&&isFinite(i[0])&&"number"==typeof i[1]&&isFinite(i[1])&&"number"==typeof i[2]&&isFinite(i[2])?F$5(i,e)||(r$k(e,i),this._markViewDirty()):s$l.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value");}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0;}_recomputeFrustum(){this._frustumDirty&&(s$s(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1);}_ensureViewClean(){this._viewDirty&&(Q$5(this._viewMatrix,this.eye,this._center,this._up),o$9(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),o$9(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),o$9(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0);}}const K$2=n$d(),Q$2=e$d(),Z$2=n$g(),$$2=n$g(),tt$1=x$6();var it$1;!function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT";}(it$1||(it$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class a{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new t$n;}dispose(){this._textureRepository.dispose();}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(t$d(s)){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new l$1(t),this._id2glMaterialRef.set(i,e.id,s);}return s.ref(),s.glMaterial}release(e,t){const s=this._id2glMaterialRef.get(t,e.id);r$h(s)&&(s.unref(),s.referenced||(s$q(s.glMaterial),this._id2glMaterialRef.delete(t,e.id)));}_ownMaterial(t){r$h(t.repository)&&t.repository!==this&&s$l.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this;}}class l$1{constructor(e){this.glMaterial=e,this.refCnt=0;}ref(){++this.refCnt;}unref(){--this.refCnt,e$e(this.refCnt>=0);}get referenced(){return this.refCnt>0}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const n$5={rootOrigin:null};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class j$2{constructor(t,r=125e4){this._originSR=t,this._gridSize=r,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+e$b();}getOrigin(i){const r=this._origins.get(this._rootOriginId);if(null==r){const r=n$5.rootOrigin;if(r$h(r))return this._origins.set(this._rootOriginId,c$6(r[0],r[1],r[2],this._rootOriginId)),this.getOrigin(i);const o=c$6(i[0]+Math.random()-.5,i[1]+Math.random()-.5,i[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,o),o}const s=this._gridSize,e=Math.round(i[0]/s),a=Math.round(i[1]/s),n=Math.round(i[2]/s),h=`${e}/${a}/${n}`;let c=this._origins.get(h);const g=.5*s;if(e$f(p,i,r.vec3),p[0]=Math.abs(p[0]),p[1]=Math.abs(p[1]),p[2]=Math.abs(p[2]),p[0]<g&&p[1]<g&&p[2]<g){if(c){const t=Math.max(...p);e$f(p,i,c.vec3),p[0]=Math.abs(p[0]),p[1]=Math.abs(p[1]),p[2]=Math.abs(p[2]);if(Math.max(...p)<t)return c}return r}return c||(c=c$6(e*s,a*s,n*s,h),this._origins.set(h,c)),c}_drawOriginBox(t,i=r$o(1,1,0,1)){const o=window.view,s=o._stage,m=i.toString();if(!this._objects.has(m)){this._material=new B$4({width:2,color:i}),s.add(this._material);const t=new l$7({isPickable:!1}),r=new O$4({castShadow:!1});s.add(r),t.add(r),s.add(t),this._objects.set(m,r);}const d=this._objects.get(m),j=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=j.length,b=new Array(3*p),l=new Uint16Array(2*(p-1)),u=.5*this._gridSize;for(let r=0;r<p;r++)b[3*r+0]=t[0]+(1&j[r]?u:-u),b[3*r+1]=t[1]+(2&j[r]?u:-u),b[3*r+2]=t[2]+(4&j[r]?u:-u),r>0&&(l[2*r+0]=r-1,l[2*r+1]=r);Un(b,this._originSR,0,b,o.renderSpatialReference,0,p);const M=new g$4([[O$6.POSITION,{size:3,data:b,exclusive:!0}]],[[O$6.POSITION,l]],a$8.Line);s.add(M),d.addGeometry(M,this._material,o$a);}}const p=n$g();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$8{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=n$g(),this.isCameraPositionFinal=!0,this.parallax={anchorPointClouds:n$g(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:e$d()},this.parallaxNew={anchorPointClouds:n$g(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:e$d()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:o$3.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:s$8.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:i$8.FINISHED,factor:-1};}}var s$8,o$3,i$8;!function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN";}(s$8||(s$8={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN";}(o$3||(o$3={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE";}(i$8||(i$8={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function n$4(e,n){const c=e.fragment;c.include(a$d),c.uniforms.add(new e$9("nearFar",((e,o)=>o.camera.nearFar))),c.uniforms.add(new m$6("depthMap",((e,o)=>o.linearDepthTexture))),c.uniforms.add(new e$k("proj",((e,o)=>o.ssr.camera.projectionMatrix))),c.uniforms.add(new o$b("invResolutionHeight",((e,o)=>1/o.ssr.camera.height))),c.uniforms.add(new e$k("reprojectionMatrix",((e,o)=>o.ssr.reprojectionMatrix))),c.code.add(n$c`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${n.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `);}class c$5{constructor(){this.reprojectionMatrix=e$d();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class h$3{constructor(h,n,l){this.shadowMap=h,this.ssaoHelper=n,this.slicePlane=l,this.slot=E$5.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=n$e(),this.lighting=new e$r,this.ssr=new c$5,this.multipassTerrain=new o$r,this.multipassGeometry=new s$d,this.clouds=new r$8,this.overlays=[];}get camera(){return this._camera}set camera(s){this._camera=this.ssr.camera=s,this._inverseViewport[0]=1/s.fullViewport[2],this._inverseViewport[1]=1/s.fullViewport[3];}get inverseViewport(){return this._inverseViewport}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class c$4{constructor(a,c,n,l=null){this.rctx=a,this.sliceHelper=l,this.lastFrameCamera=new J$2,this.output=h$a.Color,this.renderOccludedMask=i$7,this.bindParameters=new h$3(c,n,r$h(l)?l.plane:null);}resetRenderOccludedMask(){this.renderOccludedMask=i$7;}}const i$7=o$j.Occlude|o$j.OccludeAndTransparent|o$j.OccludeAndTransparentStencil;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var J$1;!function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default";}(J$1||(J$1={}));class K$1{constructor(){this.camera=new J$2,this.lightMat=e$d();}}class Q$1{constructor(t,e,s=0){this._rctx=t,this._viewingMode=e,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=n$d(),this._cascades=[new K$1,new K$1,new K$1,new K$1],this.maxTextureSize=this._rctx.parameters.maxTextureSize,this._snapshotCount=s;}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return r$g(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots();}set maxCascades(e){this.maxNumCascades=o$k(Math.floor(e),1,4);}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots());}get enabled(){return this._enabled}get ready(){return this._enabled&&r$h(this._depthTexture)}get _snapshotCount(){return this._snapshots.length}set _snapshotCount(t){const e=this._snapshots.length;if(t>e){const s=t-e;this._snapshots.length=t;for(let t=0;t<s;++t)this._snapshots[e+t]=null;}else if(t<this._snapshotCount){const s=e-t;for(let e=0;e<s;++e)this._discardSnapshot(t+e);this._snapshots.length=t;}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)dt[t]=this._cascades[t];return dt.length=this.numCascades,dt}start(t,e,s){e$e(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:a,far:i}=this._clampNearFar(s);this._computeCascadeDistances(i,a),this._setupMatrices(t,e);const r=t.viewMatrix,h=t.projectionMatrix;for(let c=0;c<this.numCascades;++c)this._constructCascade(c,h,r,e);this.lastOrigin=null,this.clear();}finish(t){e$e(this.enabled),this._rctx.bindFramebuffer(t);}getShadowMapMatrices(t){if(!this.lastOrigin||!F$5(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||n$g(),r$k(this.lastOrigin,t);for(let e=0;e<this.numCascades;++e){c$h(_t,this._cascades[e].lightMat,t);for(let t=0;t<16;++t)pt[16*e+t]=_t[t];}}return pt}takeCascadeSnapshotTo(t,e){e$e(this.enabled);const s=this._ensureSnapshot(e);this._bindFbo();const a=this._rctx,i=a.bindTexture(s,u$g.TEXTURE_UNIT_FOR_UPDATES);a.gl.copyTexSubImage2D(M$5.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),a.bindTexture(i,u$g.TEXTURE_UNIT_FOR_UPDATES);}clear(){const t=this._rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(_$8.COLOR_BUFFER_BIT|_$8.DEPTH_BUFFER_BIT);}_computeTextureSize(t,e){const s=.5*Math.log(t*t+e*e)*Math.LOG2E,a=.35,i=2**Math.round(s+a);return Math.min(this.maxTextureSize,2*i)}_ensureDepthTexture(){if(r$h(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,wrapMode:D$2.CLAMP_TO_EDGE,samplingMode:L$7.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new u$g(this._rctx,t),this._fbo=new b$9(this._rctx,{colorTarget:Y$3.TEXTURE,depthStencilTarget:V$2.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture);}_ensureSnapshot(t){let e=this._snapshots[t];if(r$h(e)&&e.descriptor.width===this._textureSize)return e;this._discardSnapshot(t);const s={target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,wrapMode:D$2.CLAMP_TO_EDGE,samplingMode:L$7.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return e=new u$g(this._rctx,s),this._snapshots[t]=e,e}_discardDepthTexture(){this._fbo=s$q(this._fbo),this._depthTexture=s$q(this._depthTexture);}_discardSnapshot(t){this._snapshots[t]=s$q(this._snapshots[t]);}_discardAllSnapshots(){for(let t=0;t<this._snapshotCount;++t)this._discardSnapshot(t);}_bindFbo(){const t=this._rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo);}_constructCascade(t,e,s,a){const i=this._cascades[t],r=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],n=(e[10]*r+e[14])/Math.abs(e[11]*r+e[15]),u=(e[10]*o+e[14])/Math.abs(e[11]*o+e[15]);e$e(n<u);for(let h=0;h<8;++h){r$g(et,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?n:u,1),w$5(st[h],et,tt);for(let t=0;t<3;++t)st[h][t]/=st[h][3];}j$8(mt,st[0]),c$h(Z$1,ut,mt),i.camera.viewMatrix=Z$1;for(let h=0;h<8;++h)O$5(st[h],st[h],i.camera.viewMatrix);r$k(at,st[0]),r$k(it,st[0]);for(let h=1;h<8;++h)for(let t=0;t<3;++t)at[t]=Math.min(at[t],st[h][t]),it[t]=Math.max(it[t],st[h][t]);at[2]-=200,it[2]+=200,i.camera.near=-it[2],i.camera.far=-at[2],this.warp?this._constructTrapezoidalProjection(s,a,i):this._constructOrthogonalProjection(i),u$b(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);const m=this._textureSize/2;i.camera.viewport[0]=t%2==0?0:m,i.camera.viewport[1]=0===Math.floor(t/2)?0:m,i.camera.viewport[2]=m,i.camera.viewport[3]=m;}_constructOrthogonalProjection(t){F$6(t.camera.projectionMatrix,at[0],it[0],at[1],it[1],t.camera.near,t.camera.far);}_constructTrapezoidalProjection(t,s,a){const i=1/st[0][3],r=1/st[4][3];e$e(i<r);let h=i+Math.sqrt(i*r);const c=Math.sin(l$m(t[2]*s[0]+t[6]*s[1]+t[10]*s[2]));h/=c,Dt(st,h,c,rt,ht,ct,ot,nt),Ut(rt,ht,ot,nt,a.camera.projectionMatrix),a.camera.projectionMatrix[10]=2/(at[2]-it[2]),a.camera.projectionMatrix[14]=-(at[2]+it[2])/(at[2]-it[2]);}_setupMatrices(t,e){u$b($$1,t.projectionMatrix,t.viewMatrix),h$c(tt,$$1);const s=this._viewingMode===l$j.Global?t.eye:o$9(mt,0,0,1);Q$5(ut,[0,0,0],[-e[0],-e[1],-e[2]],s);}_clampNearFar(t){let{near:e,far:s}=t;return e<2&&(e=2),s<2&&(s=2),e>=s&&(e=2,s=4),{near:e,far:s}}_computeCascadeDistances(t,e){this.numCascades=Math.min(1+Math.floor(f$i(t/e,4)),this.maxNumCascades);const a=(t-e)/this.numCascades,i=(t/e)**(1/this.numCascades);let r=e,h=e;for(let c=0;c<this.numCascades+1;++c)this._cascadeDistances[c]=s$r(r,h,this.splitSchemeLambda),r*=i,h+=a;}get gpuMemoryUsage(){return this._snapshots.reduce(((t,e)=>t+u$h(e)),this._fbo?.gpuMemoryUsage??0)}get test(){const t=this;return {maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(e){t.splitSchemeLambda=e;},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(e){t.warp=e;},get warp(){return t.warp}}}}const Z$1=e$d(),$$1=e$d(),tt=e$d(),et=n$d(),st=[];for(let Ft=0;Ft<8;++Ft)st.push(n$d());const at=n$g(),it=n$g(),rt=n$e(),ht=n$e(),ct=n$e(),ot=n$e(),nt=n$e(),ut=e$d(),mt=n$g(),dt=[],_t=e$d(),pt=new Float32Array(64),lt=n$e(),ft=n$e(),xt=[n$e(),n$e(),n$e(),n$e()],Tt=n$e(),gt=n$e(),St=n$e(),bt=n$e(),wt=n$e(),Mt=n$e(),Ct=n$e();function Dt(t,e,s,a,i,r,h,c){r$f(lt,0,0);for(let d=0;d<4;++d)s$t(lt,lt,t[d]);l$n(lt,lt,.25),r$f(ft,0,0);for(let d=4;d<8;++d)s$t(ft,ft,t[d]);l$n(ft,ft,.25),A$8(xt[0],t[4],t[5],.5),A$8(xt[1],t[5],t[6],.5),A$8(xt[2],t[6],t[7],.5),A$8(xt[3],t[7],t[4],.5);let o=0,n=b$b(xt[0],lt);for(let d=1;d<4;++d){const t=b$b(xt[d],lt);t<n&&(n=t,o=d);}o$s(Tt,xt[o],t[o+4]);const u=Tt[0];let m,w;Tt[0]=-Tt[1],Tt[1]=u,o$s(gt,ft,lt),j$9(gt,Tt)<0&&g$9(Tt,Tt),A$8(Tt,Tt,gt,s),v$a(Tt,Tt),m=w=j$9(o$s(St,t[0],lt),Tt);for(let d=1;d<8;++d){const e=j$9(o$s(St,t[d],lt),Tt);e<m?m=e:e>w&&(w=e);}a$b(a,lt),l$n(St,Tt,m-e),s$t(a,a,St);let M=-1,C=1,D=0,E=0;for(let d=0;d<8;++d){o$s(bt,t[d],a),v$a(bt,bt);const e=Tt[0]*bt[1]-Tt[1]*bt[0];e>0?e>M&&(M=e,D=d):e<C&&(C=e,E=d);}s$u(M>0,"leftArea"),s$u(C<0,"rightArea"),l$n(wt,Tt,m),s$t(wt,wt,lt),l$n(Mt,Tt,w),s$t(Mt,Mt,lt),Ct[0]=-Tt[1],Ct[1]=Tt[0];const j=u$i(a,t[E],Mt,s$t(St,Mt,Ct),1,i),v=u$i(a,t[D],Mt,St,1,r),z=u$i(a,t[D],wt,s$t(St,wt,Ct),1,h),R=u$i(a,t[E],wt,St,1,c);s$u(j,"rayRay"),s$u(v,"rayRay"),s$u(z,"rayRay"),s$u(R,"rayRay");}function Et(t,e){return 3*e+t}const jt=n$e();function vt(t,e){return r$f(jt,t[e],t[e+3]),jt}const zt=n$e(),Rt=e$p();function Ut(t,e,s,a,i){o$s(zt,s,a),l$n(zt,zt,.5),Rt[0]=zt[0],Rt[1]=zt[1],Rt[2]=0,Rt[3]=zt[1],Rt[4]=-zt[0],Rt[5]=0,Rt[6]=zt[0]*zt[0]+zt[1]*zt[1],Rt[7]=zt[0]*zt[1]-zt[1]*zt[0],Rt[8]=1,Rt[Et(0,2)]=-j$9(vt(Rt,0),t),Rt[Et(1,2)]=-j$9(vt(Rt,1),t);let r=j$9(vt(Rt,0),s)+Rt[Et(0,2)],h=j$9(vt(Rt,1),s)+Rt[Et(1,2)],c=j$9(vt(Rt,0),a)+Rt[Et(0,2)],o=j$9(vt(Rt,1),a)+Rt[Et(1,2)];r=-(r+c)/(h+o),Rt[Et(0,0)]+=Rt[Et(1,0)]*r,Rt[Et(0,1)]+=Rt[Et(1,1)]*r,Rt[Et(0,2)]+=Rt[Et(1,2)]*r,r=1/(j$9(vt(Rt,0),s)+Rt[Et(0,2)]),h=1/(j$9(vt(Rt,1),s)+Rt[Et(1,2)]),Rt[Et(0,0)]*=r,Rt[Et(0,1)]*=r,Rt[Et(0,2)]*=r,Rt[Et(1,0)]*=h,Rt[Et(1,1)]*=h,Rt[Et(1,2)]*=h,Rt[Et(2,0)]=Rt[Et(1,0)],Rt[Et(2,1)]=Rt[Et(1,1)],Rt[Et(2,2)]=Rt[Et(1,2)],Rt[Et(1,2)]+=1,r=j$9(vt(Rt,1),e)+Rt[Et(1,2)],h=j$9(vt(Rt,2),e)+Rt[Et(2,2)],c=j$9(vt(Rt,1),s)+Rt[Et(1,2)],o=j$9(vt(Rt,2),s)+Rt[Et(2,2)],r=-.5*(r/h+c/o),Rt[Et(1,0)]+=Rt[Et(2,0)]*r,Rt[Et(1,1)]+=Rt[Et(2,1)]*r,Rt[Et(1,2)]+=Rt[Et(2,2)]*r,r=j$9(vt(Rt,1),e)+Rt[Et(1,2)],h=j$9(vt(Rt,2),e)+Rt[Et(2,2)],c=-h/r,Rt[Et(1,0)]*=c,Rt[Et(1,1)]*=c,Rt[Et(1,2)]*=c,i[0]=Rt[0],i[1]=Rt[1],i[2]=0,i[3]=Rt[2],i[4]=Rt[3],i[5]=Rt[4],i[6]=0,i[7]=Rt[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=Rt[6],i[13]=Rt[7],i[14]=0,i[15]=Rt[8];}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$7{constructor(){this.adds=new n$i,this.removes=new n$i,this.updates=new n$i({allocator:e=>e||new s$7,deallocator:e=>(e.renderGeometry=null,e)});}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear();}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune();}}class s$7{}class t$4{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var i$6,t$3;!function(i){i[i.OBJECT=0]="OBJECT",i[i.HUD=1]="HUD",i[i.TERRAIN=2]="TERRAIN",i[i.OVERLAY=3]="OVERLAY",i[i.I3S=4]="I3S",i[i.PCL=5]="PCL",i[i.LOD=6]="LOD",i[i.VOXEL=7]="VOXEL";}(i$6||(i$6={}));class s$6{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=t$3.ALL;}}!function(i){i[i.MIN=0]="MIN",i[i.MINMAX=1]="MINMAX",i[i.ALL=2]="ALL";}(t$3||(t$3={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function c$3(t){return r$h(t)&&r$h(t.dist)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const A$2=1e-5;class T$2{constructor(t){this.options=new s$6,this._results=new I$2,this.transform=new u$j,this.tolerance=A$2,this.verticalOffset=null,this._ray=d$d(),this._rayEnd=n$g(),this._rayBeginTransformed=n$g(),this._rayEndTransformed=n$g(),this.viewingMode=t??l$j.Global;}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,s){this.resetWithRay(p$b(t,r,this._ray),s);}resetWithRay(t,r){this.camera=r,t!==this._ray&&l$o(t,this._ray),0!==this.options.verticalOffset?this.viewingMode===l$j.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,u$c(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray);}intersect(r=null,s,i,e,a){this.point=s,this.filterPredicate=e,this.tolerance=i??A$2;const n=y$5(this.verticalOffset);if(r$h(r)&&r.length>0){const s=a?t=>{a(t)&&this.intersectObject(t);}:t=>{this.intersectObject(t);};for(const i of r){const r=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();r$h(r)?(r$h(n)?r.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,s,n):r.forEachAlongRay(this._ray.origin,this._ray.direction,s),this.options.selectionMode&&this.options.hud&&r.forEachDegenerateObject(s)):i.objects.forAll((t=>s(t)));}}this.sortResults();}intersectObject(r){const s=r.geometryRecords;if(!s)return;const i=r.transformation,a=y$5(this.verticalOffset);for(const o of s){const{geometry:s,material:h,instanceParameters:d}=o;if(u$e(d))continue;const c=s.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),O$5(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),O$5(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;r$h(a)&&(a.objectTransform=this.transform),h.intersect(s,d,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((s,i,a,n,o,h)=>{if(s>=0){if(r$h(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,s))return;const d=n?this._results.hud:this._results,m=n?n=>{const d={object:r,geometryId:c,triangleNr:a,center:r$h(h)?[h[0],h[1],h[2]]:null};n.set(i$6.HUD,d,s,i,o$a,o);}:t=>t.set(i$6.OBJECT,{object:r,geometryId:c,triangleNr:a},s,i,l,o);if((null==d.min.drapedLayerOrder||o>=d.min.drapedLayerOrder)&&(null==d.min.dist||s<d.min.dist)&&m(d.min),this.options.store!==t$3.MIN&&(null==d.max.drapedLayerOrder||o<d.max.drapedLayerOrder)&&(null==d.max.dist||s>d.max.dist)&&m(d.max),this.options.store===t$3.ALL)if(n){const t=new M$1(this._ray);m(t),this._results.hud.all.push(t);}else {const t=new N$1(this._ray);m(t),this._results.all.push(t);}}}),o.shaderTransformation);}}sortResults(t=this._results.all){t.sort(((t,s)=>t.dist!==s.dist?c$d(t.dist,0)-c$d(s.dist,0):t.drapedLayerOrder!==s.drapedLayerOrder?c$d(t.drapedLayerOrder,Number.MAX_VALUE)-c$d(s.drapedLayerOrder,Number.MAX_VALUE):c$d(s.drapedLayerGraphicOrder,Number.MIN_VALUE)-c$d(t.drapedLayerGraphicOrder,Number.MIN_VALUE)));}}function x$2(t){return new T$2(t)}class I$2{constructor(){this.min=new N$1(d$d()),this.max=new N$1(d$d()),this.hud={min:new M$1(d$d()),max:new M$1(d$d()),all:new Array},this.ground=new N$1(d$d()),this.all=[];}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0;}}class N$1{constructor(t){this.intersector=i$6.OBJECT,this.normal=n$g(),this.transformation=e$d(),this._ray=d$d(),this.init(t);}get ray(){return this._ray}get distanceInRenderSpace(){return r$h(this.dist)?(g$5(B$1,this.ray.direction,this.dist),s$m(B$1)):null}getIntersectionPoint(t){return !!c$3(this)&&(g$5(B$1,this.ray.direction,this.dist),u$c(t,this.ray.origin,B$1),!0)}getTransformedNormal(t){return r$k(R$3,this.normal),R$3[3]=0,w$5(R$3,R$3,this.transformation),r$k(t,R$3),z$6(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=i$6.OBJECT,l$o(t,this._ray);}set(t,i,a,n,o,h,c){this.intersector=t,this.dist=a,r$k(this.normal,c$d(n,b$c)),n$f(this.transformation,c$d(o,o$a)),this.target=i,this.drapedLayerOrder=h,this.drapedLayerGraphicOrder=c;}copy(t){l$o(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,r$k(this.normal,t.normal),n$f(this.transformation,t.transformation);}}class M$1 extends N$1{constructor(){super(...arguments),this.intersector=i$6.HUD;}}function U$1(t){return new N$1(t)}const B$1=n$g(),R$3=n$d();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function r$6(r){const n=new Map,a=r=>{let t=n.get(r);return t||(t=new t$4,n.set(r,t)),t};return r.removes.forAll((e=>{t$2(e)&&a(e.material).removes.push(e);})),r.adds.forAll((e=>{t$2(e)&&a(e.material).adds.push(e);})),r.updates.forAll((e=>{t$2(e.renderGeometry)&&a(e.renderGeometry.material).updates.push(e);})),n}function t$2(e){return e.data.indexCount>=1}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class e$3{constructor(r,t){this._material=r,this._repository=t,this._map=new Map;}destroy(){this._map.forEach(((t,e)=>{r$h(t)&&this._repository.release(this._material,e);}));}load(e,s,i){if(!this._material.requiresSlot(s,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,s,i));const a=this._map.get(i);if(r$h(a)){if(a.ensureResources(e)===O$7.LOADED)return a;this._repository.requestRender();}return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class i$5 extends c$i{constructor(s=n$g()){super(),this.origin=s,this.slicePlaneLocalOrigin=this.origin;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class i$4{constructor(){this.enabled=!0,this._time=0;}get time(){return n$q(this._time)}advance(t){return r$h(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||0===t.dt)&&(this._time+=t.dt,!0)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function o$2(o){o.fragment.code.add(n$c`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`);}function n$3(o){o.fragment.code.add(n$c`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function i$3(t){t.fragment.uniforms.add(new m$6("texWaveNormal",(e=>e.waveNormal))),t.fragment.uniforms.add(new m$6("texWavePerturbation",(e=>e.wavePertubation))),t.fragment.uniforms.add([new e$8("waveParams",(e=>r$g(f$4,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new e$9("waveDirection",(t=>r$f(c$2,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)))]),t.include(o$2),t.fragment.code.add(n$c`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`);}const f$4=n$d(),c$2=n$e();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function r$5(r,c){c.spherical?r.vertex.code.add(n$c`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):r.vertex.code.add(n$c`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),c.spherical?r.vertex.code.add(n$c`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):r.vertex.code.add(n$c`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function e$2(e){e.fragment.code.add(n$c`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class s$5 extends i$l{constructor(e,s){super(e,"samplerCube",a$j.Pass,((r,o,t)=>r.bindTexture(e,s(o,t))));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function v$2(r){const v=r.fragment;v.uniforms.add([new e$k("rotationMatrixClouds",((o,t)=>t.clouds.parallax.transform)),new e$k("rotationMatrixCloudsCrossFade",((o,t)=>t.clouds.parallaxNew.transform)),new e$g("anchorPosition",((o,t)=>t.clouds.parallax.anchorPointClouds)),new e$g("anchorPositionCrossFade",((o,t)=>t.clouds.parallaxNew.anchorPointClouds)),new e$9("cloudVariables",((o,r)=>r$h(r.clouds.data)?r$f(h$2,r.clouds.data.coverage,r.clouds.data.absorption):f$j)),new o$b("cloudsHeight",((o,t)=>t.clouds.parallax.cloudsHeight)),new o$b("radiusCurvatureCorrectionFactor",((o,t)=>t.clouds.parallax.radiusCurvatureCorrectionFactor)),new o$b("totalFadeInOut",((t,a)=>a.clouds.fadeInOut.stage===o$3.FINISHED?a.clouds.fadeInOutHeight.factor+Math.max(o$k(a.clouds.fadeIn.factor,0,1)):a.clouds.fadeInOutHeight.factor+Math.max(o$k(a.clouds.fadeInOut.factor,0,1)))),new o$b("crossFadeAnchorFactor",((t,a)=>o$k(a.clouds.crossFade.factor,0,1))),new s$5("cubeMap",((o,a)=>r$h(a.clouds.data)?a.clouds.data.cubeMap.colorTexture:null)),new s$v("crossFade",((o,t)=>t.clouds.crossFade.enabled))]),v.constants.add("planetRadius","float",s$w.radius),v.code.add(n$c`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),v.code.add(n$c`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),v.code.add(n$c`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),v.uniforms.add([new e$g("lightingMainDirection",((o,t)=>t.lighting.lightingMainDirection)),new e$g("lightingMainIntensity",((o,t)=>t.lighting.mainLight.intensity))]),v.code.add(n$c`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),v.code.add(n$c`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),v.code.add(n$c`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),v.code.add(n$c`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),v.code.add(n$c`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`);}const h$2=n$e();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function c$1(c,s){c.include(n$r,s),c.include(e$2),c.include(n$3),s.hasCloudsReflections&&c.include(v$2,s),s.hasScreenSpaceReflections&&c.include(n$4,s);const f=c.fragment;f.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),f.code.add(n$c`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),f.uniforms.add([new o$b("lightingSpecularStrength",((e,o)=>o.lighting.mainLight.specularStrength)),new o$b("lightingEnvironmentStrength",((e,o)=>o.lighting.mainLight.environmentStrength))]),f.code.add(n$c`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),s.hasCloudsReflections&&f.code.add(n$c`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),s.hasScreenSpaceReflections?(f.uniforms.add(new e$k("view",((e,o)=>o.ssr.camera.viewMatrix))),f.uniforms.add(new m$6("lastFrameColorMap",((e,o)=>o.ssr.lastFrameColorTexture))),f.code.add(n$c`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`)):f.code.add(n$c`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),s.hasCloudsReflections?s.hasScreenSpaceReflections?f.code.add(n$c`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):f.code.add(n$c`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):f.code.add(n$c`return waterRenderedColor;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function F$3(F){const P=new o$f,{vertex:L,fragment:_}=P;v$6(P,F),P.include(r$q,F),P.attributes.add(O$6.POSITION,"vec3"),P.attributes.add(O$6.UV0,"vec2");const S=new e$8("waterColor",(e=>e.color));if(F.output===h$a.Color&&F.isDraped)return P.varyings.add("vpos","vec3"),L.uniforms.add(S),L.code.add(n$c`
        void main(void) {
          if (waterColor.a < ${n$c.float(t$i)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),_.uniforms.add(S),_.code.add(n$c`void main() {
gl_FragColor = waterColor;
}`),P;switch(F.output!==h$a.Color&&F.output!==h$a.Alpha||(P.include(r$5,F),P.include(i$m,F),P.varyings.add("vuv","vec2"),P.varyings.add("vpos","vec3"),P.varyings.add("vnormal","vec3"),P.varyings.add("vtbnMatrix","mat3"),F.hasMultipassTerrain&&P.varyings.add("depth","float"),L.uniforms.add(S),L.code.add(n$c`
      void main(void) {
        if (waterColor.a < ${n$c.float(t$i)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${F.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${F.output===h$a.Color?"forwardLinearDepth();":""}
      }
    `)),P.include(n$k,F),F.output){case h$a.Alpha:P.include(u$d,F),_.uniforms.add(S),_.code.add(n$c`
        void main() {
          discardBySlice(vpos);
          ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case h$a.Color:P.include(o$t,{isGround:!1}),P.include(m$a,{pbrMode:m$b.Disabled,lightingSphericalHarmonicsOrder:2}),P.include(i$3),P.include(u$d,F),P.include(c$j,F),P.include(c$1,F),_.uniforms.add([S,new e$g("lightingMainDirection",((e,i)=>i.lighting.lightingMainDirection)),new e$g("lightingMainIntensity",((e,i)=>i.lighting.mainLight.intensity)),new o$b("timeElapsed",(e=>e.timeElapsed)),L.uniforms.get("view"),L.uniforms.get("localOrigin")]),c$e(_,F),_.include(e$l),_.code.add(n$c`
      void main() {
        discardBySlice(vpos);
        ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${F.receiveShadows?n$c`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${F.transparencyPassType===o$e.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case h$a.Normal:P.include(r$5,F),P.include(i$3,F),P.include(u$d,F),P.varyings.add("vpos","vec3"),P.varyings.add("vuv","vec2"),L.uniforms.add(S),L.code.add(n$c`
        void main(void) {
          if (waterColor.a < ${n$c.float(t$i)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),_.uniforms.add(new o$b("timeElapsed",(e=>e.timeElapsed))),_.code.add(n$c`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case h$a.Highlight:P.include(a$e),P.varyings.add("vpos","vec3"),L.uniforms.add(S),L.code.add(n$c`
      void main(void) {
        if (waterColor.a < ${n$c.float(t$i)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),P.include(u$d,F),_.code.add(n$c`void main() {
discardBySlice(vpos);
outputHighlight();
}`);}return P}const P$3=Object.freeze(Object.defineProperty({__proto__:null,build:F$3},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class P$2 extends e$m{initializeConfiguration(e,r){r.spherical=e.viewingMode===l$j.Global,r.doublePrecisionRequiresObfuscation=i$n(e.rctx);}initializeProgram(e){return new o$h(e.rctx,P$2.shader.get().build(this.configuration),E$6)}_setPipelineState(e){const t=this.configuration,o=e===o$e.NONE,i=e===o$e.FrontFace;return W$2({blending:t.output!==h$a.Normal&&t.output!==h$a.Highlight&&t.transparent?o?c$f:A$6(e):null,depthTest:{func:l$c(e)},depthWrite:o?t.writeDepth&&a$a:E$3(e),colorWrite:_$5,polygonOffset:o||i?null:a$g(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}P$2.shader=new t$j(P$3,(()=>import('./WaterSurface.glsl-91a03b70.js')));class O$1 extends s$j{constructor(){super(...arguments),this.output=h$a.Color,this.transparencyPassType=o$e.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1;}}e$i([e$j({count:h$a.COUNT})],O$1.prototype,"output",void 0),e$i([e$j({count:o$e.COUNT})],O$1.prototype,"transparencyPassType",void 0),e$i([e$j()],O$1.prototype,"spherical",void 0),e$i([e$j()],O$1.prototype,"receiveShadows",void 0),e$i([e$j()],O$1.prototype,"hasSlicePlane",void 0),e$i([e$j()],O$1.prototype,"transparent",void 0),e$i([e$j()],O$1.prototype,"enableOffset",void 0),e$i([e$j()],O$1.prototype,"writeDepth",void 0),e$i([e$j()],O$1.prototype,"hasScreenSpaceReflections",void 0),e$i([e$j()],O$1.prototype,"doublePrecisionRequiresObfuscation",void 0),e$i([e$j()],O$1.prototype,"hasCloudsReflections",void 0),e$i([e$j()],O$1.prototype,"isDraped",void 0),e$i([e$j()],O$1.prototype,"hasMultipassTerrain",void 0),e$i([e$j()],O$1.prototype,"cullAboveGround",void 0),e$i([e$j({constValue:m$b.Water})],O$1.prototype,"pbrMode",void 0),e$i([e$j({constValue:!0})],O$1.prototype,"useCustomDTRExponentForWater",void 0),e$i([e$j({constValue:!0})],O$1.prototype,"highStepCount",void 0),e$i([e$j({constValue:!1})],O$1.prototype,"useFillLights",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$4 extends t$k{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled});}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled});}_updateCloudsReflectionState(t){const a=r$h(t.clouds.data);a!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:a});}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===h$a.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(P$2,e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class f$3 extends d$9{constructor(e){super(e,new d$3),this._configuration=new O$1,this.animation=new i$4;}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<S$9,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<A$1;const i=this.animation.advance(t);return this.setParameters({timeElapsed:u$k(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(e,t,r,i,a,s,n){x$7(e,t,i,a,s,void 0,n);}requiresSlot(e,t){switch(t){case h$a.Normal:return e===E$5.DRAPED_WATER;case h$a.Color:if(this.parameters.isDraped)return e===E$5.DRAPED_MATERIAL;break;case h$a.Alpha:break;case h$a.Highlight:return e===E$5.OPAQUE_MATERIAL||e===E$5.DRAPED_MATERIAL;default:return !1}let r=E$5.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?E$5.TRANSPARENT_MATERIAL:E$5.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new r$4(e)}createBufferWriter(){return new i$a(o$6)}}class d$3 extends h$g{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=r$p(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=r$o(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1;}}const A$1=35e3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class t$1{constructor(t){this.first=t.from,this.count=t.to-t.from;}}class s$4{constructor(t=0,s=0){this.from=t,this.to=s;}}class o$1 extends s$4{constructor(t,s,o,r,n,i){super(s,o),this.id=t,this.isVisible=r,this.hasHighlights=n,this.hasOccludees=i;}}function r$3(t){return Array.from(t.values()).sort(n$2)}function n$2(t,s){return t.from===s.from?t.to-s.to:t.from-s.from}function i$2(s,o){if(0===s.length)return void s.push(new t$1(o));const r=s[s.length-1];if(c(r,o)){const t=o.from-r.first+o.to-o.from;r.count=t;}else s.push(new t$1(o));}function c(t,s){return t.first+t.count>=s.from}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class e$1{constructor(e,r){this._pool=e,this._size=0,this._buffer=e.newBuffer(s$3(r));}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0;}release(){this.erase(0,this._size),this.dispose();}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose();}alloc(e){return this._resize(e,!1)}_resize(e,r){let s;const i=t(this._buffer.length,this._size,e);if(this._buffer.length!==i){const e=this._pool.newBuffer(i);r&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),s=this._buffer,this._buffer=e;}const f=this._size;return this._size=e,s?{dispose:()=>{s.array.fill(0,0,f),this._pool.deleteBuffer(s);},copy:(e,r,t)=>this._buffer.array.set(s.array.subarray(r,t),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,r,s)=>{e!==r&&this._buffer.array.copyWithin(e,r,s);},hasNewBuffer:!1}}erase(e,r){this._buffer.array.fill(0,e,r);}}const r$2=65536;function s$3(e){return Math.ceil(e/r$2)*r$2}function t(e,r,t){return r<=t?e>=t?e:s$3(Math.max(2*e,t)):e<=2*t?e:s$3(t)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class s$2{constructor(s,o,a,i){this.vao=new f$k(s,o,{geometry:a},{geometry:c$k.createVertex(s,F$7.STATIC_DRAW)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength);}dispose(){this.vao.dispose(!0);}get length(){return this.array.length}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const s$1=s$x+1;class h$1{constructor(t,e,r){this._rctx=t,this._locations=e,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${e$b()}`,i$1);}dispose(){this._cache.destroy();}newBuffer(e){const r=e.toString(),o=this._cache.pop(r);if(r$h(o)){const t=o.pop();return o.length>0&&this._cache.put(r,o,t.array.byteLength*o.length,s$1),t}return new s$2(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const r=e.array.byteLength,o=e.array.length.toString(),c=this._cache.pop(o);return r$h(c)?(c.push(e),this._cache.put(o,c,r*c.length,-1)):this._cache.put(o,[e],r,-1),null}}function i$1(t,r){if(r===i$o.ALL)return void t.forEach((t=>t.dispose()));const o=t.pop(),c=t.length*o.array.byteLength;return o.dispose(),c}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class H$1{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new n$i,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new e$3(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new h$1(e,r.vertexAttributeLocations,o$u(this._bufferWriter.vertexBufferLayout));}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.buffer.dispose())),this._dataByOrigin.clear(),this._bufferPool.dispose();}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return !this.isEmpty&&this._material instanceof f$3}get rendersOccluded(){return !this.isEmpty&&this._material.renderOccluded!==o$j.Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands();}_addAndRemoveGeometries(e,t){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,i=this._dataByOrigin,a=A(e,t);a.forEach(((e,t)=>{a.delete(t);const o=e.toAdd.reduce(((e,t)=>e+r.elementCount(t.data)),0);let n=i.get(t);if(null==n)e$e(0===e.toRemove.length),n=new I$1(e.origin,new e$1(this._bufferPool,o*s)),i.set(t,n);else if(0===e.toAdd.length&&n.instances.size===e.toRemove.length)return n.buffer.dispose(),void i.delete(t);let d=0;n.instances.forEach((e=>d+=e.to-e.from));const h=e.toRemove.reduce(((e,t)=>e+r.elementCount(t.data)),0),l=n.buffer.size,m=(d+o-h)*s,f=T$1;if(m<l/2?this._removeAndRebuild(n,e.toRemove,s,m,f):e.toRemove.length>0&&this._remove(n,e.toRemove,s,f),e.toAdd.length>0){const t=j$1;h$h(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(n,e.toAdd,s,t,f);}const g=n.buffer.vao.vertexBuffers.geometry;D$1(f),f.forAll((({from:e,to:t})=>{if(e<t){const r=n.buffer.array,s=4,i=e*s,a=t*s;g.setSubData(r,i,i,a);}})),f.clear(),n.drawCommandsDirty=!0;}));}_updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const s of e){const e=s.renderGeometry,i=this._dataByOrigin.get(e.origin.id),a=i&&i.instances.get(e.id);if(!a)return;const o=s.updateType;if(o&E$1.State.VISIBILITIES&&(a.isVisible=e.instanceParameters.visible),o&(E$1.State.HIGHLIGHTS|E$1.State.VISIBILITIES)){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t;}if(o&E$1.State.OCCLUDEES&&(a.hasOccludees=!!e.instanceParameters.occludees),o&(E$1.State.VERTEXATTRS|E$1.State.TRANSFORMATION)){const{array:s,vao:o}=i.buffer;l$p(e,x$1,L$1),t.write({transformation:x$1,invTranspTransformation:L$1},e.data,t.vertexBufferLayout.createView(s.buffer),a.from),e$e(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),o.vertexBuffers.geometry.setSubData(s,a.from*r*4,a.from*r*4,a.to*r*4);}i.drawCommandsDirty=!0;}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((t=>{t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,n$s(t.instances,(e=>(e.isVisible?(e.hasHighlights&&(this._hasHighlights=!0,t.hasHighlights=!0),e.hasOccludees&&(this._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees)));}));const t=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!R$2(e)){const t=this._bufferWriter.vertexBufferLayout.stride,r=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:r}])}const t=r$3(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?i$2(e.drawCommandsOccludees,r):i$2(e.drawCommandsDefault,r),r.hasHighlights?i$2(e.drawCommandsHighlight,r):i$2(e.drawCommandsShadowHighlightRest,r));};this._dataByOrigin.forEach((e=>{e.drawCommandsDirty&&(t(e),e.drawCommandsDirty=!1);}));}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return this._material.requiresSlot(e,t)}render(e,s){if(!this.requiresSlot(s.slot,e))return !1;const i=e===h$a.Highlight||e===h$a.ShadowHighlight;if(i&&!this._hasHighlights)return !1;const a=e===h$a.ShadowExludeHighlight,o=!(i||a);if(this._dataByOrigin.forEach((e=>{if(i&&!e.hasHighlights)return;const r=(i?e.drawCommandsHighlight:a&&R$2(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,s=o&&e.drawCommandsOccludees||null;(r$h(r)||r$h(s))&&this._renderCommandData.push(new M(e.origin,e.buffer,r,s));})),0===this._renderCommandData.length)return !1;const n=this._rctx,d=this._glMaterials.load(n,s.slot,e);if(t$d(d))return this._renderCommandData.clear(),!1;const l=d.beginSlot(s),m=n.bindTechnique(l,this._material.parameters,s);return this._renderCommandData.forAll((e=>{m.bindDraw(e,s,this._material.parameters);const{buffer:r,renderCommands:i,occludeeCommands:a}=e;l.ensureAttributeLocations(r.vao),n.bindVAO(r.vao);const o=l.primitiveType;r$h(i)&&(l.bindPipelineState(n,s.slot,!1),this._renderCommands(n,o,i)),r$h(a)&&(l.bindPipelineState(n,s.slot,!0),this._renderCommands(n,o,a));})),this._renderCommandData.clear(),!0}_renderCommands(e,t,r){for(let s=0;s<r.length;s++)e.drawArrays(t,r[s].first,r[s].count);}_removeAndRebuild(e,t,r,s,i){for(const h of t)e.instances.delete(h.id);const a=r$3(e.instances);e.instances.clear();const o=e.buffer.size,n=e.buffer.alloc(s);let d=0;for(const h of a){const t=h.from*r,s=h.to*r;n.copy(d,t,s),h.from=d/r,d+=s-t,h.to=d/r,e.instances.set(h.id,h);}i.push(new s$4(0,n.hasNewBuffer?e.buffer.array.length:o)),n.dispose(),e.buffer.erase(d,i.back().to),e.holes.clear();}_remove(e,t,r,s){for(const i of t){const t=i.id,a=e.instances.get(t),o=a.from*r,n=a.to*r;e.buffer.erase(o,n),e.holes.push(new s$4(a.from,a.to)),e.instances.delete(t),s.push(new s$4(o,n));}D$1(e.holes);}_add(e,s,n,d,h){if(0===s.length)return;const l=this._bufferWriter;let m=l.vertexBufferLayout.createView(e.buffer.array.buffer);const f=e.holes.length>0;let u=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER;for(const _ of s){const s=r$h(_.transformation)?u$b(x$1,d,_.transformation):d;h$c(L$1,s);const p=o$q(L$1,L$1),y=l.elementCount(_.data),C=y*n;let v=E(e.holes,y);t$d(v)&&(v=e.buffer.size/n,e.buffer.grow(C),m=l.vertexBufferLayout.createView(e.buffer.array.buffer)),l.write({transformation:s,invTranspTransformation:p},_.data,m,v);const O=_.instanceParameters.visible,H=!!_.instanceParameters.highlights&&O,S=!!_.instanceParameters.occludees,A=new o$1(_.id,v,v+y,O,H,S);e$e(null==e.instances.get(_.id)),e.instances.set(_.id,A),f?h.push(new s$4(A.from*n,A.to*n)):(u=Math.min(A.from,u),g=Math.max(A.to,g));}f||h.push(new s$4(u*n,g*n));}get test(){return {material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class S$4{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array;}}function A(e,t){const r=new Map;for(const s of e)B(r,s,!0);for(const s of t)B(r,s,!1);return r}function B(e,t,s){const i=t.origin;if(t$d(i))return;let a=e.get(i.id);null==a&&(a=new S$4(i.vec3),e.set(i.id,a)),s?a.toAdd.push(t):a.toRemove.push(t);}function R$2(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function E(e,t){let r;if(!e.some((e=>!(e.to-e.from<t)&&(r=e,!0))))return null;const s=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),s}function D$1(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;)r=!1,e.forEach((s=>{const i=t.get(s.to);i&&(s.to=i.to,t.delete(i.from),e.removeUnordered(i),r=!0);}));}class I$1{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new n$i({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1;}}class M extends i$5{constructor(e,t,r,s){super(e),this.buffer=t,this.renderCommands=r,this.occludeeCommands=s;}}const T$1=new n$i({deallocator:null}),j$1=e$d(),x$1=e$d(),L$1=e$d();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let y=class extends f$g{constructor(e){super(e),this._pending=new f$2,this._changes=new r$7,this._materialRenderers=new Map,this._sortedMaterialRenderers=new n$i,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1;}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear();}get updating(){return !this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return n$s(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return !this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return !1;this._processAddsRemoves();const e=r$6(this._changes);let r=!1,s=!1,i=!1;return e.forEach(((e,t)=>{let a=this._materialRenderers.get(t);if(!a&&e.adds.length>0&&(a=new H$1(this.rctx,this._materialRepository,t),this._materialRenderers.set(t,a),r=!0,s=!0,i=!0),!a)return;const n=s||a.hasHighlights,o=i||a.hasWater;a.modify(e),s=s||n!==a.hasHighlights,i=i||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(t),a.dispose(),r=!0);})),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),s&&(this._hasHighlights=n$s(this._materialRenderers,(e=>e.hasHighlights))),i&&(this._hasWater=n$s(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,r){if(0===e.length)return;const t=this._validateRenderGeometries(e);for(const i of t)this._geometries.set(i.id,i);const s=this._pending.empty;for(const i of t)this._pending.adds.add(i);s&&this.notifyChange("updating"),r===E$1.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e);}removeGeometries(e,r){const t=this._pending.empty,i=this._pending.adds;for(const a of e)i.has(a)?(this._pending.removed.add(a),i.delete(a)):this._pending.removed.has(a)||this._pending.removes.add(a),this._geometries.delete(e$s(a.id));t&&!this._pending.empty&&this.notifyChange("updating"),r===E$1.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e);}modifyGeometries(e,r){const t=0===this._changes.updates.length;for(const s of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(s),e.updateType=r;}switch(t&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case E$1.State.TRANSFORMATION:case E$1.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case E$1.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:t})=>r=t.updateAnimation(e)||r)),r}render(e,r){for(let t=0;t<this._sortedMaterialRenderers.length;t++){const s=this._sortedMaterialRenderers.data[t];s.material.shouldRender(e)&&s.materialRenderer.render(e.output,r);}}intersect(e,r,t,s,i){return this._geometries.forEach((a=>{if(s&&!s(a))return;this._intersectRenderGeometry(a,t,r,0,e,i);const n=this.rendererContext.longitudeCyclical;n&&(a.boundingSphere[0]-a.boundingSphere[3]<n.min&&this._intersectRenderGeometry(a,t,r,n.range,e,i),a.boundingSphere[0]+a.boundingSphere[3]>n.max&&this._intersectRenderGeometry(a,t,r,-n.range,e,i)),i++;})),i}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((r,t)=>{t.insertOrder=e++,this._sortedMaterialRenderers.push({material:t,materialRenderer:r});})),this._sortedMaterialRenderers.sort(((e,r)=>{const t=r.material.renderPriority-e.material.renderPriority;return 0!==t?t:e.material.insertOrder-r.material.insertOrder}));}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++;}this._pending.clear();}_intersectRenderGeometry(e,r,t,s,a,n){if(!e.instanceParameters.visible)return;let o=0;r$h(e.transformation)&&(s+=e.transformation[12],o=e.transformation[13]),G[0]=t[0]-s,G[1]=t[1]-o,G[2]=1,S$3[0]=t[0]-s,S$3[1]=t[1]-o,S$3[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),a,G,S$3,((t,s,i)=>{R$1(r,i,e.material.renderPriority,n,a,e.layerUid,e.graphicUid);}),e.calculateShaderTransformation,r);}_notifyGraphicGeometryChanged(e){if(t$d(this.drapeSource.notifyGraphicGeometryChanged))return;let r;for(const t of e){const e=t.graphicUid;r$h(e)&&e!==r&&(this.drapeSource.notifyGraphicGeometryChanged(e),r=e);}}_notifyGraphicVisibilityChanged(e){if(t$d(this.drapeSource.notifyGraphicVisibilityChanged))return;let r;for(const t of e){const e=t.graphicUid;r$h(e)&&e!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(e),r=e);}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return t$d(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return {sortedMaterialRenderers:this._sortedMaterialRenderers}}};e$i([d$c()],y.prototype,"drapeSource",void 0),e$i([d$c()],y.prototype,"updating",null),e$i([d$c()],y.prototype,"rctx",null),e$i([d$c()],y.prototype,"rendererContext",void 0),e$i([d$c()],y.prototype,"_materialRepository",null),e$i([d$c()],y.prototype,"_localOriginFactory",null),y=e$i([n$o("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],y);class f$2{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set;}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear();}}function R$1(e,r,t,s,i,a,n){const o={layerUid:a,graphicUid:n,triangleNr:r},d=r=>{r.set(i$6.OVERLAY,o,e.dist,e.normal,e.transformation,t,s);};if((null==i.results.min.drapedLayerOrder||t>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&d(i.results.min),i.options.store!==t$3.MIN&&(null==i.results.max.drapedLayerOrder||t<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&d(i.results.max),i.options.store===t$3.ALL){const e=U$1(i.ray);d(e),i.results.all.push(e);}}const G=n$g(),S$3=n$g();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var u$3;!function(o){o[o.SSAO=0]="SSAO",o[o.Blur=1]="Blur",o[o.COUNT=2]="COUNT";}(u$3||(u$3={}));class e extends t$o{constructor(){super(...arguments),this.output=u$3.SSAO;}}e$i([e$j({count:u$3.COUNT})],e.prototype,"output",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const w$1={samples:16,filterRadius:4,attenuation:.5};class x extends t$p{constructor(){super(...arguments),this.projScale=1;}}class g$1 extends t$p{constructor(){super(...arguments),this.blurSize=n$e();}}function b$1(t){const f=new o$f,x=f.fragment;if(f.include(o$v),t.output===u$3.Blur){const e=(w$1.filterRadius+1)/2,r=1/(2*e*e);x.include(a$d),x.uniforms.add([new m$6("depthMap",(e=>e.depthTexture)),new m$c("tex",(e=>e.colorTexture)),new o$w("blurSize",(e=>e.blurSize)),new o$b("projScale",((e,r)=>{const t=x$5(r.camera.eye,r.camera.center);return t>5e4?Math.max(0,e.projScale-(t-5e4)):e.projScale})),new e$9("nearFar",((e,r)=>r.camera.nearFar))]),x.code.add(n$c`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${n$c.float(r)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),x.code.add(n$c`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale / center_d;
        for (int r = -${n$c.int(w$1.filterRadius)}; r <= ${n$c.int(w$1.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `);}return t.output===u$3.SSAO&&(x.include(a$d),f.include(n$b),x.uniforms.add(new o$b("radius",((e,r)=>S$2(r)))),x.code.add(n$c`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),x.code.add(n$c`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),x.uniforms.add([new e$9("nearFar",((e,r)=>r.camera.nearFar)),new m$6("normalMap",(e=>e.normalTexture)),new m$6("depthMap",(e=>e.depthTexture)),new e$9("zScale",((e,r)=>i$e(r))),new o$b("projScale",(e=>e.projScale)),new m$6("rnm",(e=>e.noiseTexture)),new e$9("rnmScale",((t,a)=>r$f(F$2,a.camera.fullWidth/e$s(t.noiseTexture).descriptor.width,a.camera.fullHeight/e$s(t.noiseTexture).descriptor.height))),new o$b("intensity",((e,r)=>4*w$1.attenuation/S$2(r)**6)),new e$9("screenSize",((e,t)=>r$f(F$2,t.camera.fullWidth,t.camera.fullHeight)))]),x.code.add(n$c`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${n$c.int(w$1.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0 - sum * intensity / float(${n$c.int(w$1.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),f}function S$2(e){return Math.max(10,20*e.camera.computeRenderPixelSizeAtDist(Math.abs(4*e.camera.relativeElevation)))}const F$2=n$e(),P$1=Object.freeze(Object.defineProperty({__proto__:null,SSAOPassParameters:x,SSAODrawParameters:g$1,build:b$1},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class n$1 extends e$m{initializeProgram(e){return new o$h(e.rctx,n$1.shader.get().build(this.configuration),E$6)}initializePipeline(){return W$2({colorWrite:_$5})}}n$1.shader=new t$j(P$1,(()=>import('./SSAO.glsl-7bffb0fa.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const q=2;class f$1{constructor(e$1,s,t){this._techniqueRep=e$1,this._rctx=s,this._requestRender=t,this._enabled=!1,this._ssaoTechniqueConfig=new e,this.quadVAO=null,this._passParameters=new x,this._drawParameters=new g$1;}dispose(){this.quadVAO=s$q(this.quadVAO);}disposeOffscreenBuffers(){o$x(this._ssaoFBO,(e=>e.resize(0,0))),o$x(this._blur0FBO,(e=>e.resize(0,0))),o$x(this._blur1FBO,(e=>e.resize(0,0)));}set enabled(e){e?this._enable():this._disable();}get enabled(){return this._enabled}get ready(){return this.enabled&&r$h(this._passParameters.noiseTexture)&&r$h(this._ssaoFBO)&&r$h(this._blur0FBO)&&r$h(this._blur1FBO)}get colorTexture(){return r$h(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return r$h(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return r$h(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(e,s,t){if(!this.enabled||t$d(s)||t$d(t)||t$d(this._passParameters.noiseTexture)||t$d(this._ssaoFBO)||t$d(this._blur0FBO)||t$d(this._blur1FBO))return;const a=this._rctx,o=e.camera;this._passParameters.normalTexture=t,this._passParameters.depthTexture=s,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1);const _=o.fullViewport,u=_[2],n=_[3],l=u/q,d=n/q;this._ssaoFBO.resize(u,n),this._blur0FBO.resize(l,d),this._blur1FBO.resize(l,d),t$d(this.quadVAO)&&(this.quadVAO=u$l(this._rctx)),a.bindFramebuffer(this._ssaoFBO),a.setViewport(0,0,u,n);a.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),a.bindVAO(this.quadVAO),a.drawArrays(E$4.TRIANGLE_STRIP,0,n$t(this.quadVAO,"geometry"));const b=a.bindTechnique(this._blurTechnique,this._passParameters,e);a.setViewport(0,0,l,d),a.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,r$f(this._drawParameters.blurSize,0,q/n),b.bindDraw(this._drawParameters,e,this._passParameters),a.setViewport(0,0,l,d),a.drawArrays(E$4.TRIANGLE_STRIP,0,n$t(this.quadVAO,"geometry")),a.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,r$f(this._drawParameters.blurSize,q/u,0),b.bindDraw(this._drawParameters,e,this._passParameters),a.drawArrays(E$4.TRIANGLE_STRIP,0,n$t(this.quadVAO,"geometry")),a.setViewport(_[0],_[1],_[2],_[3]);}_selectPrograms(){this._ssaoTechniqueConfig.output=u$3.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(n$1,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=u$3.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(n$1,this._ssaoTechniqueConfig,this._blurTechnique);}_enable(){this.enabled||(this._enabled=!0,this._loadResources((()=>{this._enabled&&this._initialize();})));}_loadResources(e){this._data?e():import('./SSAOHelperData-86bb3ec7.js').then((s=>{this._data=s,e();}));}_initialize(){const e={target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,samplingMode:L$7.LINEAR,wrapMode:D$2.CLAMP_TO_EDGE,width:0,height:0},s={colorTarget:Y$3.TEXTURE,depthStencilTarget:V$2.NONE};t$q(this._data.noiseTexture).then((t=>{this._enabled&&(this._ssaoFBO=new b$9(this._rctx,s,e),this._blur0FBO=new b$9(this._rctx,s,e),this._blur1FBO=new b$9(this._rctx,s,e),this._passParameters.noiseTexture=new u$g(this._rctx,{target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,hasMipmap:!0,width:t.width,height:t.height},t),this._requestRender());})),this._selectPrograms();}_disable(){this._enabled=!1,this._passParameters.noiseTexture=s$q(this._passParameters.noiseTexture),this._blur1FBO=s$q(this._blur1FBO),this._blur0FBO=s$q(this._blur0FBO),this._ssaoFBO=s$q(this._ssaoFBO);}get gpuMemoryUsage(){return (r$h(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(r$h(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(r$h(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return {ssao:this._ssaoFBO,blur:this._blur1FBO}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class m extends e$m{initializeProgram(e){return new o$h(e.rctx,m.shader.get().build(),E$6)}initializePipeline(){return this.configuration.hasAlpha?W$2({blending:l$q(R$7.SRC_ALPHA,R$7.ONE,R$7.ONE_MINUS_SRC_ALPHA,R$7.ONE_MINUS_SRC_ALPHA),colorWrite:_$5}):W$2({colorWrite:_$5})}}m.shader=new t$j(d$e,(()=>import('./TextureOnly.glsl-84607dfb.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r$1 extends t$o{constructor(){super(...arguments),this.hasAlpha=!1;}}e$i([e$j()],r$1.prototype,"hasAlpha",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class l{constructor(e){this._rctx=e,this.cache=new Map;}dispose(){this.cache.forEach((e=>s$q(e.stippleTexture))),this.cache.clear();}_acquire(e){if(t$d(e))return null;const t=this._patternId(e),s=this.cache.get(t);if(s)return s.refCount++,s;const{encodedData:o,paddedPixels:i}=d$2(e),a=new u$2(new u$g(this._rctx,{width:i,height:1,internalFormat:P$8.RGBA,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,wrapMode:D$2.CLAMP_TO_EDGE},o));return this.cache.set(t,a),a}release(e){if(t$d(e))return;const t=this._patternId(e),o=this.cache.get(t);o&&(o.refCount--,0===o.refCount&&(r$h(o.stippleTexture)&&o.stippleTexture.dispose(),this.cache.delete(t)));}swap(e,t){const r=this._acquire(t);return this.release(e),r}_patternId(e){return `${e.pattern.join(",")}-r${e.pixelRatio}`}}class u$2 extends t$p{constructor(e){super(),this.stippleTexture=e,this.refCount=1;}}function d$2(t){const r=t.pattern.map((e=>Math.round(e*t.pixelRatio))),s=1/t.pixelRatio,a=m$4(t),n=f$a(t),c=(Math.floor(.5*(n-1))+.5)*s,p=[];let h=1;for(const e of r){for(let t=0;t<e;t++){const r=h*(Math.min(t,e-1-t)+.5)*s/c*.5+.5;p.push(r);}h=-h;}const l=Math.round(r[0]/2),u=[...p.slice(l),...p.slice(0,l)],d=a+2,f=new Uint8Array(4*d);let m=4;for(const o of u)o$m(o,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,paddedPixels:d}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var n,o;!function(a){a[a.Standard=0]="Standard",a[a.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",a[a.Transparency=2]="Transparency",a[a.OverlayWithTransparency=3]="OverlayWithTransparency",a[a.COUNT=4]="COUNT";}(n||(n={})),function(a){a[a.None=0]="None",a[a.Alpha=1]="Alpha",a[a.PremultipliedAlpha=2]="PremultipliedAlpha",a[a.COUNT=3]="COUNT";}(o||(o={}));class i extends t$o{constructor(){super(...arguments),this.function=n.Standard,this.alphaMode=o.None,this.hasOpacityFactor=!1;}}e$i([e$j({count:n.COUNT})],i.prototype,"function",void 0),e$i([e$j({count:o.COUNT})],i.prototype,"alphaMode",void 0),e$i([e$j()],i.prototype,"hasOpacityFactor",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let ce$1=class extends(s$9(f$g)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new t$f,this._frameTask=v$b,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new n$i,this._passParameters=new i$p,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new n$h,this.longitudeCyclical=null;}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const r=e.waterTextureRepository;this._stippleTextureRepository=new l(e.renderingContext),this._shaderTechniqueRepository=new s$a({rctx:this._rctx,viewingMode:l$j.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new c$4(this._rctx,new Q$1(this._rctx,this.view.state.viewingMode),new f$1(this._shaderTechniqueRepository,this._rctx,(()=>{}))),this._handles.add([l$r((()=>r.updating),(()=>this.events.emit("content-changed")),w$6),l$r((()=>this.spatialReference),(e=>this._localOriginFactory=new j$2(e)),w$6),a$k((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new a(e.textureRepository,this._shaderTechniqueRepository,(e=>{(e.renderOccluded&ye)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating");}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=E$5.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=p$c(this._rctx),this._bindParameters.camera=_e,this._bindParameters.transparencyPassType=o$e.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new i$q(r$l(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(A$9.STAGE,this),this._handles.add(this._frameTask);}dispose(){this._handles.destroy(),this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=p$d(this._debugTextureTechnique),this._passParameters.texture=s$q(this._passParameters.texture),this._bindParameters.highlightDepthTexture=s$q(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=s$q(this._shaderTechniqueRepository),this._temporaryFBO=s$q(this._temporaryFBO),this._quadVAO=s$q(this._quadVAO),this.disposeOverlays();}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||n$s(this._renderers,(e=>e.updating))}get hasOverlays(){return r$h(this._overlays)&&r$h(this._overlayRenderTarget)}get gpuMemoryUsage(){return r$h(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,y)}createDrapeSourceRenderer(e,r,t){const s=this._renderers.get(e);r$h(s)&&s.destroy();const i=new r({...t,rendererContext:this,drapeSource:e});return this._renderers.set(e,i),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(l$r((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),i}removeDrapeSourceRenderer(e){if(t$d(e))return;const r=this._renderers.get(e);t$d(r)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy());}collectUnusedRenderTargetMemory(e){let r=!1;if(r$h(this._overlayRenderTarget))for(const t of this._overlayRenderTarget.renderTargets){const s=this.overlays[0].validTargets[t.type]||!this.overlays[1].validTargets[t.type];r=this._overlayRenderTarget.validateUsageForTarget(s,t,e)||r;}return r}get overlays(){return c$d(this._overlays,[])}ensureDrapeTargets(e){r$h(this._overlays)&&this._overlays.forEach((r=>{r.hasTargetWithoutRasterImage=n$u(e,(e=>e.drapeTargetType===t$8.WithoutRasterImage));}));}ensureDrapeSources(e){r$h(this._overlays)&&this._overlays.forEach((r=>{r.hasDrapedFeatureSource=n$u(e,(e=>e.drapeSourceType===e$4.Features)),r.hasDrapedRasterSource=n$u(e,(e=>e.drapeSourceType===e$4.RasterImage));}));}ensureOverlays(e,r){t$d(this._overlays)&&(this._overlayRenderTarget=new o$5(this._rctx),this._overlays=[new l$2(T$9.INNER,this._overlayRenderTarget),new l$2(T$9.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r);}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=s$q(this._overlayRenderTarget),this.events.emit("textures-disposed");}get running(){return this.updating}runTask(e,r=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,r);}_processDrapeSources(e,r){let t=!1;for(const[s,i]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&(i.commitChanges()&&(t=!0,e.madeProgress()));}this._updateSortedDrapeSourceRenderers(),t&&(r$h(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater());}processSyncDrapeSources(){this._processDrapeSources(G$4,(e=>e.updatePolicy===i$f.SYNC));}isEmpty(){if(t$6.OVERLAY_DRAW_DEBUG_TEXTURE)return !1;for(const e of this._renderers.values())if(!e.isEmpty)return !1;return !0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach((t=>r=t.updateAnimation(e)||r)),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0;}drawTarget(e,r,t){const s=e.canvasGeometries;if(0===s.numViews)return !1;this._screenToWorldRatio=t*e.mapUnitsPerPixel;const i=r.output;if(this.isEmpty()||i===h$a.Highlight&&!this.hasHighlights||i===h$a.Normal&&!this.hasWater||!e.hasSomeSizedView())return !1;const o$1=r.fbo;if(!o$1.isValid())return !1;const a=2*e.resolution,h=e.resolution;o$1.resize(a,h);const d=this._rctx;_e.pixelRatio=e.pixelRatio*t,this._renderContext.output=i,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=i===h$a.Normal?E$5.DRAPED_WATER:E$5.DRAPED_MATERIAL,e.applyViewport(this._rctx),o$1.bind(d),e.index===T$9.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(_$8.COLOR_BUFFER_BIT));const l=r.type===H$4.ColorNoRasterImage?pe.ExcludeRasterImage:r.type===H$4.Occluded?pe.OccludedOnly:pe.Normal;if(l===pe.OccludedOnly&&(this._renderContext.renderOccludedMask=ye),t$6.OVERLAY_DRAW_DEBUG_TEXTURE&&l!==pe.OccludedOnly)for(let n=0;n<s.numViews;n++)this._setViewParameters(s.extents[n],e,_e),this._drawDebugTexture(e.resolution,me[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll((({drapeSource:r,renderer:t})=>{if(l===pe.ExcludeRasterImage&&r.drapeSourceType===e$4.RasterImage)return;const{fullOpacity:c}=r,p=r$h(c)&&c<1&&i===h$a.Color;p&&(this.bindTemporaryFramebuffer(this._rctx,a,h),d.clearSafe(_$8.COLOR_BUFFER_BIT));for(let i=0;i<s.numViews;i++)this._setViewParameters(s.extents[i],e,_e),t.render(this._renderContext,this._bindParameters);p&&r$h(this._temporaryFBO)&&(o$1.bind(d),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),o.PremultipliedAlpha,c,n.OverlayWithTransparency,e.index));})),d.bindFramebuffer(null),o$1.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,t){t$d(this._temporaryFBO)&&(this._temporaryFBO=new b$2(e,!1)),this._temporaryFBO.resize(r,t),this._temporaryFBO.bind(e);}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll();}notifyContentChanged(){this.events.emit("content-changed");}intersect(e,r,t,s){let i=0;for(const o of this._renderers.values())i=o.intersect?.(e,r,t,s,i)??i;}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty)return;if(this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers;this._renderers.forEach(((r,t)=>{const s=e.indexOf(t.layer);this._sortedRenderers.push(new ue$1(t,r,s<0?1/0:s));})),this._sortedRenderers.sort(((e,r)=>e.index-r.index));}_setViewParameters(e,r,t){t.viewport[0]=t.viewport[1]=0,t.viewport[2]=t.viewport[3]=r.resolution,F$6(t.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],t.near,t.far),x$8(t.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=t;}_updateHasWater(){const e=n$s(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e));}_updateHasHighlights(){const e=n$s(this._renderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e));}_updateRendersOccluded(){const e=n$s(this._renderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e));}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e,r);const t=this._rctx;t.bindTechnique(this._debugTextureTechnique,this._passParameters,null),t.bindVAO(this._quadVAO),t.drawArrays(E$4.TRIANGLE_STRIP,0,n$t(this._quadVAO,"geometry"));}_ensureDebugPatternResources(e,r,t){if(o$9(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const s=new Uint8Array(e*r*4);let i=0;for(let a=0;a<r;a++)for(let t=0;t<e;t++){const o=Math.floor(t/10),n=Math.floor(a/10);o<2||n<2||10*o>e-20||10*n>r-20?(s[i++]=255,s[i++]=255,s[i++]=255,s[i++]=255):(s[i++]=255,s[i++]=255,s[i++]=255,s[i++]=1&o&&1&n?1&t^1&a?0:255:1&o^1&n?0:128);}this._passParameters.texture=new u$g(this._rctx,{target:M$5.TEXTURE_2D,pixelFormat:P$8.RGBA,dataType:G$3.UNSIGNED_BYTE,samplingMode:L$7.NEAREST,width:e,height:r},s);const o=new r$1;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(m,o),this._quadVAO=u$l(this._rctx);}get test(){return {drapeSourceRenderers:this._renderers,getDrapeSourceRenderer:e=>this._renderers.get(e)}}};var pe;e$i([d$c()],ce$1.prototype,"_frameTask",void 0),e$i([d$c()],ce$1.prototype,"_sortedDrapeSourceRenderersDirty",void 0),e$i([i$9()],ce$1.prototype,"_shaderTechniqueRepository",void 0),e$i([i$9()],ce$1.prototype,"_stippleTextureRepository",void 0),e$i([d$c({constructOnly:!0})],ce$1.prototype,"view",void 0),e$i([d$c()],ce$1.prototype,"worldToPCSRatio",void 0),e$i([d$c()],ce$1.prototype,"spatialReference",void 0),e$i([d$c({type:Boolean,readOnly:!0})],ce$1.prototype,"updating",null),ce$1=e$i([n$o("esri.views.3d.terrain.OverlayRenderer")],ce$1),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage";}(pe||(pe={}));class ue$1{constructor(e,r,t){this.drapeSource=e,this.renderer=r,this.index=t;}}const me=[[1,.5,.5],[.5,.5,1]],_e=new J$2;_e.near=1,_e.far=1e4,_e.relativeElevation=null;const ge=-2,ye=o$j.OccludeAndTransparent;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function O(t){const e=[],o=[];d$1(t,o,e);const n=o[0][1].data,r=e[0][1].length,i=new Uint16Array(r);return j(t,o,e),S$1(t,o,e,i),w(t,o,e,i),U(t,o,e,i),F$1(t,o,e,i),v$1(t,o,e,i),C(t,o,e,n),new g$4(o,e,a$8.Line)}function R(t,e,o,n){const r="polygon"===t.type?c$l.CCW_IS_HOLE:c$l.NONE,i="polygon"===t.type?t.rings:t.paths,{position:a,outlines:s}=l$s(i,t.hasZ,r),u=new Float64Array(a.length),c=f$9(a,t.spatialReference,0,u,0,a,0,a.length/3,e,o,n),f=null!=c;return {lines:f?b(s,a,u):[],projectionSuccess:f,sampledElevation:c}}function b(t,e,o){const n=new Array;for(const{index:r,count:i}of t){if(i<=1)continue;const t=3*r,a=t+3*i;n.push({position:e.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0});}return n}function I(t,e){const o="polygon"===t.type?c$l.CCW_IS_HOLE:c$l.NONE,n="polygon"===t.type?t.rings:t.paths,{position:r,outlines:i}=l$s(n,!1,o),a=Un(r,t.spatialReference,0,r,e,0,r.length/3);for(let s=2;s<r.length;s+=3)r[s]=ge;return {lines:a?b(i,r):[],projectionSuccess:a}}function d$1(t,e,o){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,a=D(r)&&i===P.REMOVE,s=r.length/3-(a?1:0),u=new Uint32Array(2*(s-1)),c=a?t$r(r,0,r.length-3):r;let l=0;for(let n=0;n<s-1;n++)u[l++]=n,u[l++]=n+1;e.push([O$6.POSITION,{size:3,data:c,exclusive:a}]),o.push([O$6.POSITION,u]);}function j(e,o,n){const r=e.attributeData.mapPosition;t$d(r)||(n.push([O$6.MAPPOS,n[0][1]]),o.push([O$6.MAPPOS,{size:3,data:r}]));}function S$1(t,n,r,i){if(r$h(t.attributeData.colorFeature))return;const a=t.attributeData.color;n.push([O$6.COLOR,{size:4,data:c$d(a,a$2)}]),r.push([O$6.COLOR,i]);}function U(e,o,n,r){const i=e.attributeData.colorFeature;t$d(i)||(o.push([O$6.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$6.COLOR,r]));}function w(t,n,r,i){if(r$h(t.attributeData.sizeFeature))return;const a=t.attributeData.size;n.push([O$6.SIZE,{size:1,data:[c$d(a,1)]}]),r.push([O$6.SIZE,i]);}function F$1(e,o,n,r){const i=e.attributeData.sizeFeature;t$d(i)||(o.push([O$6.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$6.SIZEFEATUREATTRIBUTE,r]));}function v$1(e,o,n,r){const i=e.attributeData.opacityFeature;t$d(i)||(o.push([O$6.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),n.push([O$6.OPACITYFEATUREATTRIBUTE,r]));}function C(e,o,n,a){if(t$d(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==l$j.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(a.length),l=u$m(e.overlayInfo.spatialReference);for(let t=0;t<s.length;t+=3)ne$3(a,t,s,t,l);const p=a.length/3,m=new Float32Array(p+1);let h=z$1,E=N,T=0,g=0;o$9(h,s[g++],s[g++],s[g++]),m[0]=0;for(let t=1;t<p+1;++t)t===p&&(g=0),o$9(E,s[g++],s[g++],s[g++]),T+=H$7(h,E),m[t]=T,[h,E]=[E,h];o.push([O$6.DISTANCETOSTART,{size:1,data:m}]),n.push([O$6.DISTANCETOSTART,n[0][1]]);}function D(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}var P;!function(t){t[t.KEEP=0]="KEEP",t[t.REMOVE=1]="REMOVE";}(P||(P={}));const z$1=n$g(),N=n$g();function L(t){switch(t){case"butt":return r$d.BUTT;case"square":return r$d.SQUARE;case"round":return r$d.ROUND;default:return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class s{constructor(){this.visible=!0;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class T{constructor(r,i,a={}){this.data=r,this.material=i,this.boundingSphere=n$d(),this.instanceParameters=new s,this._transformation=e$d(),this._shaderTransformationDirty=!0,this.layerUid=c$d(a.layerUid,null),this.graphicUid=c$d(a.graphicUid,null),this.id=a.id?a.id:e$b(),this.boundingInfo=c$d(a.boundingInfo,null),this.calculateShaderTransformation=c$d(a.calculateShaderTransformation,null),this.castShadow=!!a.castShadow&&a.castShadow;}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere);}shaderTransformationChanged(){this._shaderTransformationDirty=!0;}computeBoundingSphere(t,i,s=l$8(t)){t$d(this.boundingInfo)||(O$5(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*s);}get hasShaderTransformation(){return r$h(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return t$d(this.calculateShaderTransformation)?c$d(this.transformation,o$a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=e$d()),n$f(this._shaderTransformation,this.calculateShaderTransformation(c$d(this.transformation,o$a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return !!this.material.computeAttachmentOrigin(this,t)&&(r$h(this._transformation)&&O$5(t,t,this._transformation),!0);const r=this.indices.get(O$6.POSITION),s=this.vertexAttributes.get(O$6.POSITION);return !!u$n(s,r,t)&&(r$h(this._transformation)&&O$5(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new r$e(u$a.Highlight),r=this.instanceParameters;return r.highlights=c$c(r.highlights,t),t}removeHighlight(t){const r=this.instanceParameters;r.highlights=f$c(r.highlights,t);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const u$1=n$g();function f(r,i,s,a,c,p,f,g){const d=s?s.length:0,h=r.clippingExtent;if(Hn(i,u$1,r.elevationProvider.spatialReference),r$h(h)&&!E$8(h,u$1))return null;Hn(i,u$1,r.renderCoordsHelper.spatialReference);const j=r.localOriginFactory.getOrigin(u$1),y=new O$4({castShadow:!1,metadata:{layerUid:p,graphicUid:f,usesVerticalDistanceToGround:!0}});for(let e=0;e<d;e++){const r=o$a;y.addGeometry(s[e],a[e],r,j,g);}return {object:y,sampledElevation:h$8(y,i,r.elevationProvider,r.renderCoordsHelper,c)}}function g(t,r,n){const i=t.elevationContext,s=n.spatialReference;Hn(r,u$1,s),i.centerPointInElevationSR=v$9(u$1[0],u$1[1],r.hasZ?u$1[2]:0,r$h(s)?s:null);}function d(e){switch(e.type){case"point":return e;case"polygon":case"extent":return A$4(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=l$g(t,s$n(t)/2);return v$9(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function h(e,t,r,o,n){const i=new Float64Array(3*e.length),s=new Float64Array(i.length);e.forEach(((e,t)=>{i[3*t+0]=e[0],i[3*t+1]=e[1],i[3*t+2]=e.length>2?e[2]:0;}));const a=f$9(i,t,0,s,0,i,0,i.length/3,r,o,n),l=null!=a;return {numVertices:e.length,position:i,mapPosition:s,projectionSuccess:l,sampledElevation:a}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function u(u){const v=new o$f;v.include(r$q,u),v.include(e$q,u),v.include(s$h,u),v$6(v,u);const{vertex:h,fragment:w}=v;return u.stippleEnabled&&(v.attributes.add(O$6.UV0,"vec2"),v.attributes.add(O$6.AUXPOS1,"vec3"),h.uniforms.add(new e$8("viewport",((e,o)=>o.camera.fullViewport)))),v.attributes.add(O$6.POSITION,"vec3"),v.varyings.add("vpos","vec3"),h.code.add(n$c`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),u.stippleEnabled&&(h.code.add(n$c`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),u.draped?h.uniforms.add(new o$b("worldToScreenRatio",((e,o)=>1/o.screenToPCSRatio))):h.code.add(n$c`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),h.code.add(n$c`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),u.draped?h.code.add(n$c`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):h.code.add(n$c`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),h.uniforms.add(new o$b("stipplePatternPixelSize",(e=>S$6(e)))),h.code.add(n$c`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),h.code.add(n$c`}`),u.output===h$a.Highlight&&v.include(a$e),v.include(u$d,u),w.uniforms.add(new o$b("alphaCoverage",((e,o)=>Math.min(1,e.width*o.camera.pixelRatio)))),u.hasVertexColors||w.uniforms.add(new e$8("constantColor",(e=>e.color))),w.code.add(n$c`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${u.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${n$c.float(t$i)}) {
      discard;
    }

    ${u.output===h$a.Color?n$c`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${u.output===h$a.Highlight?n$c`outputHighlight();`:""}
  }
  `),v}const v=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class S extends e$m{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==h$a.Highlight}initializeProgram(e){return new o$h(e.rctx,S.shader.get().build(this.configuration),E$6)}initializePipeline(){const t=this.configuration,i=l$q(R$7.SRC_ALPHA,R$7.ONE,R$7.ONE_MINUS_SRC_ALPHA,R$7.ONE_MINUS_SRC_ALPHA),r=(e,i=null,r=null)=>W$2({blending:i,depthTest:i$g,depthWrite:r,colorWrite:_$5,stencilWrite:t.hasOccludees?e$n:null,stencilTest:t.hasOccludees?e?o$i:f$d:null});return t.output===h$a.Color?(this._occludeePipelineState=r(!0,t.transparent||this._stippleEnabled?i:null,a$a),r(!1,t.transparent||this._stippleEnabled?i:null,a$a)):r(!1)}get primitiveType(){return E$4.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}S.shader=new t$j(v,(()=>import('./NativeLine.glsl-ae9265ac.js')));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class r extends s$j{constructor(){super(...arguments),this.output=h$a.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1;}}e$i([e$j({count:h$a.COUNT})],r.prototype,"output",void 0),e$i([e$j()],r.prototype,"hasSlicePlane",void 0),e$i([e$j()],r.prototype,"hasVertexColors",void 0),e$i([e$j()],r.prototype,"transparent",void 0),e$i([e$j()],r.prototype,"draped",void 0),e$i([e$j()],r.prototype,"stippleEnabled",void 0),e$i([e$j()],r.prototype,"stippleOffColorEnabled",void 0),e$i([e$j()],r.prototype,"stipplePreferContinuous",void 0),e$i([e$j()],r.prototype,"hasOccludees",void 0),e$i([e$j({constValue:!1})],r.prototype,"stippleRequiresClamp",void 0),e$i([e$j({constValue:!1})],r.prototype,"stippleScaleWithLineWidth",void 0),e$i([e$j({constValue:!1})],r.prototype,"stippleRequiresStretchMeasure",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var X;!function(e){e[e.START=0]="START",e[e.END=1]="END";}(X||(X={}));class F extends d$9{constructor(e){super(e,new Q),this._configuration=new r;}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===E$5.DRAPED_MATERIAL;const s=r$h(this.parameters.stipplePattern);return this._configuration.stippleEnabled=s,this._configuration.stippleOffColorEnabled=s&&r$h(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,s,i,o,n,a,c,l){r$h(l)?E$9(e,i,l,n,1,a):this._intersectLineGeometry(e,r,s,i,a);}_intersectLineGeometry(t,r,s,m,h){if(!m.options.selectionMode||u$e(r))return;if(!M$4(s))return void s$l.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const d=t.vertexAttributes.get(O$6.POSITION).data,_=m.camera,S=ie;a$b(S,m.point);const b=2;o$9(oe[0],S[0]-b,S[1]+b,0),o$9(oe[1],S[0]+b,S[1]+b,0),o$9(oe[2],S[0]+b,S[1]-b,0),o$9(oe[3],S[0]-b,S[1]-b,0);for(let e=0;e<4;e++)if(!_.unprojectFromRenderScreen(oe[e],ne[e]))return;j$7(_.eye,ne[0],ne[1],ae),j$7(_.eye,ne[1],ne[2],ce),j$7(_.eye,ne[2],ne[3],le),j$7(_.eye,ne[3],ne[0],ue);let x=Number.MAX_VALUE,v=0;for(let e=0;e<d.length-5;e+=3){if(z[0]=d[e]+s[12],z[1]=d[e+1]+s[13],z[2]=d[e+2]+s[14],J[0]=d[e+3]+s[12],J[1]=d[e+4]+s[13],J[2]=d[e+5]+s[14],W$3(ae,z)<0&&W$3(ae,J)<0||W$3(ce,z)<0&&W$3(ce,J)<0||W$3(le,z)<0&&W$3(le,J)<0||W$3(ue,z)<0&&W$3(ue,J)<0)continue;if(_.projectToRenderScreen(z,Z),_.projectToRenderScreen(J,$),Z[2]<0&&$[2]>0){e$f(K,z,J);const e=_.frustum,t=-W$3(e[k$2.NEAR],z)/P$6(K,Z$4(e[k$2.NEAR]));g$5(K,K,t),u$c(z,z,K),_.projectToRenderScreen(z,Z);}else if(Z[2]>0&&$[2]<0){e$f(K,J,z);const e=_.frustum,t=-W$3(e[k$2.NEAR],J)/P$6(K,Z$4(e[k$2.NEAR]));g$5(K,K,t),u$c(J,J,K),_.projectToRenderScreen(J,$);}else if(Z[2]<0&&$[2]<0)continue;Z[2]=0,$[2]=0;const t=b$7(l$e(Z,$,re),S);t<x&&(x=t,r$k(ee,z),r$k(te,J),v=e/3);}const R=m.rayBegin,N=m.rayEnd;if(x<b*b){let e=Number.MAX_VALUE;if(k$3(l$e(ee,te,re),l$e(R,N,se),Y)){e$f(Y,Y,R);const t=s$m(Y);g$5(Y,Y,1/t),e=t/x$5(R,N);}h(e,Y,v,!1);}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return !1;const s=r.get(O$6.POSITION);return h$b(s,null,!1,t)}requiresSlot(e,t){return !(t!==h$a.Color&&t!==h$a.Highlight||e!==E$5.OPAQUE_MATERIAL&&e!==E$5.DRAPED_MATERIAL)}createGLMaterial(e){return new W(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?u$5:f$6;return t$d(this.parameters.stipplePattern)?new i$a(e):new H(e.clone().vec3f(O$6.AUXPOS1).vec2f(O$6.UV0))}}class W extends t$k{constructor(){super(...arguments),this._stipplePattern=null;}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null;}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees});}beginSlot(e){this._output===h$a.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(S,e)}}class H{constructor(e){this.vertexBufferLayout=e;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O$6.POSITION).length}write(e,t,r,s){h$e(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,s),this._writeAuxpos1(e,t,r,s),this._writeUV0(e,t,r,s);}_writeAuxpos1(e,t,r,s){const i=r.getField(O$6.AUXPOS1,i$r),o=t.indices.get(O$6.POSITION),n=t.vertexAttributes.get(O$6.POSITION).data,a=e.transformation,c=i.typedBufferStride,l=i.typedBuffer;s*=c;for(let u=0;u<o.length-1;u+=2)for(const e of [1,0]){const t=3*o[u+e],r=n[t],i=n[t+1],p=n[t+2],f=a[0]*r+a[4]*i+a[8]*p+a[12],m=a[1]*r+a[5]*i+a[9]*p+a[13],h=a[2]*r+a[6]*i+a[10]*p+a[14];l[s]=f,l[s+1]=m,l[s+2]=h,s+=c;}}_writeUV0(e,t,r,s){const i=r.getField(O$6.UV0,u$o),n=t.indices.get(O$6.POSITION),a=t.vertexAttributes.get(O$6.POSITION).data,c=t.vertexAttributes.get(O$6.DISTANCETOSTART)?.data,l=e.transformation,p=i.typedBufferStride,h=i.typedBuffer;let d=0;h[s*=p]=X.START,h[s+1]=d,s+=p;const g=3*n[0],_=o$9(z,a[g],a[g+1],a[g+2]);l&&O$5(_,_,l);const A=J,O=n.length-1;let T=1;const S=c?(e,t,r)=>d=c[r]:(e,t,r)=>d+=x$5(e,t);for(let f=1;f<O;f+=2){const e=3*n[f];o$9(A,a[e],a[e+1],a[e+2]),l&&O$5(A,A,l),S(_,A,T++);for(let t=0;t<2;++t)h[s]=1-t,h[s+1]=d,s+=p;r$k(_,A);}const P=3*n[O];o$9(A,a[P],a[P+1],a[P+2]),l&&O$5(A,A,l),S(_,A,T),h[s]=X.END,h[s+1]=d;}}class Q extends h$g{constructor(){super(...arguments),this.color=_$7,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null;}}const z=n$g(),J=n$g(),K=n$g(),Y=n$g(),Z=x$6(),$=x$6(),ee=n$g(),te=n$g(),re=v$7(),se=v$7(),ie=n$g(),oe=[x$6(),x$6(),x$6(),x$6()],ne=[n$g(),n$g(),n$g(),n$g()],ae=p$8(),ce=p$8(),le=p$8(),ue=p$8();

export { r$d as $, A$4 as A, B$4 as B, p$3 as C, p$6 as D, E$1 as E, F, g$3 as G, f as H, I, J$2 as J, K$3 as K, g as L, u$8 as M, f$9 as N, O$4 as O, P, ge as Q, R, S$5 as S, T$7 as T, U$4 as U, v$4 as V, e$5 as W, X$1 as X, t$7 as Y, d as Z, s$i as _, a$5 as a, L as a0, a$3 as a1, r$e as a2, e$3 as a3, i$6 as a4, t$3 as a5, U$1 as a6, I$3 as a7, G$1 as a8, r$5 as a9, V as aa, d$3 as ab, f$3 as ac, x$2 as ad, j$2 as ae, i$c as af, a$6 as ag, z$3 as ah, r$a as ai, b$6 as aj, L$3 as ak, v$3 as al, u as am, B$2 as an, L$2 as ao, g$1 as ap, x as aq, b$1 as ar, F$3 as as, T as b, O as c, h as d, e$4 as e, f$5 as f, i$a as g, h$7 as h, i$d as i, o$6 as j, j$5 as k, l$7 as l, m$3 as m, n$b as n, o$7 as o, d$6 as p, t$a as q, r$b as r, s$f as s, t$6 as t, d$5 as u, B$3 as v, c$7 as w, x$3 as x, u$6 as y, a$4 as z };
