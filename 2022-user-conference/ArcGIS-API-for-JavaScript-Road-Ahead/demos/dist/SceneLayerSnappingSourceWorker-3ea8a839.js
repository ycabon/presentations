import { gn as q, fN as x, g0 as u, k3 as R, vU as k, u as e, z as n, vV as G, i4 as v, aK as n$1, aB as f, t as t$1, d8 as i, u_ as m, sI as q$1, i8 as b, vW as j$1, vX as N, hJ as t$2 } from './_virtual_index-1ea2035a.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const t=1e3;function a(t,a,e){const i=R(),m=k(i);return q(m,m,t,.5),q(m,m,a,.5),i[3]=x(m,t),u(m,m,e),i}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let j=class{constructor(){this._idToComponent=new Map,this._components=new G((e=>e.bounds)),this._edges=new G((e=>e.bounds)),this._tmpLineSegment=v(),this._tmpP1=n$1(),this._tmpP2=n$1(),this._tmpP3=n$1(),this.remoteClient=null;}async fetchCandidates(e,t$1){await Promise.resolve(),f(t$1),await this._ensureEdgeLocations(e,t$1);const s=[];return this._edges.forEachNeighbor((t$1=>(this._addCandidates(e,t$1,s),s.length<t)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,o){const n=[];if(this._components.forEachNeighbor((e=>{if(t$1(e.info)){const{id:t,uid:s}=e;n.push({id:t,uid:s});}return !0}),e.bounds),!n.length)return;const i$1={components:n},r=await this.remoteClient.invoke("fetchAllEdgeLocations",i$1,i(o,{}));for(const t of r.components)this._setFetchEdgeLocations(t);}async add(e){const t=new E(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>(s.component===t&&e.push(s),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id);}return {result:{}}}_setFetchEdgeLocations(e){const s=this._idToComponent.get(e.id);if(t$1(s)||e.uid!==s.uid)return;const o=m.createView(e.locations),n=new Array(o.count),i=n$1(),r=n$1();for(let t=0;t<o.count;t++){o.position0.getVec(t,i),o.position1.getVec(t,r);const d=a(i,r,e.origin),c=new C(s,t,d);n[t]=c;}this._edges.add(n);const{objectIds:c,origin:a$1}=e;s.info={locations:o,objectIds:c,origin:a$1};}_addCandidates(e,t,s){const{locations:o,origin:n,objectIds:r}=t.component.info,d=o.position0.getVec(t.index,this._tmpP1),c=o.position1.getVec(t.index,this._tmpP2);u(d,d,n),u(c,c,n);const a=r[o.componentIndex.get(t.index)];this._addEdgeCandidate(e,a,d,c,s),this._addVertexCandidate(e,a,d,s),this._addVertexCandidate(e,a,c,s);}_addEdgeCandidate(e,t,s,o,n){if(!(e.types&q$1.EDGE))return;const i=k(e.bounds),d=b(s,o,this._tmpLineSegment),a=j$1(d,i,this._tmpP3);if(!N(e.bounds,a))return null;n.push({type:"edge",objectId:t,target:t$2(a),distance:x(i,a),start:t$2(s),end:t$2(o)});}_addVertexCandidate(e,t,s,o){if(!(e.types&q$1.VERTEX))return;const n=k(e.bounds);if(!N(e.bounds,s))return null;o.push({type:"vertex",objectId:t,target:t$2(s),distance:x(n,s)});}};j=e([n("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],j);const y=j;class E{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++E.uid;}}E.uid=0;class C{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s;}}

export { y as default };
