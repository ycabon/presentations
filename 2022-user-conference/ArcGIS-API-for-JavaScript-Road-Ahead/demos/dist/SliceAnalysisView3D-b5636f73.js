import { j3 as n, $ as s$1, u as e, y, z as n$1, A as m, bC as t, eb as b$1, b7 as l, t as t$1, m as r, hU as G, uh as t$2, bh as c$1, jQ as x, jR as t$3, hH as U, eX as w, k8 as w$1, es as s$2, lX as n$2, hZ as X, eD as P$1, jN as ms, hz as s$3, g2 as R, fP as r$1, hb as c$3, bn as g$1, g0 as u$2, jG as D$1, fY as p, h_ as q, ga as Y, hg as g$2, hc as f, j6 as O, hJ as t$4, eF as z$1, b5 as A, gi as h$1, h$ as d$1, i0 as d$2, i1 as s$4, hV as t$5, aO as o$1, hh as q$1, hf as u$3, bo as i$1, aK as n$3, il as r$2, ul as l$1, L as e$2 } from './_virtual_index-1ea2035a.js';
import { n as n$5 } from './AnalysisView3D-341b9eab.js';
import { k as ke, T as Te, O as Oe, g as ge, h, e as e$1, o as oe, a as ae, u as ue, l as le, c as ce, b as u$1, m as m$1, d as c$2, q as qt, R as Re, Y as Yt, f as M$1, Z as Zt, w as we, G as Gt, I as Ie, B as Bt, z as zt, K as Kt, Q as Qt, J as Jt, i as b$2, x as x$1, W as Wt, n as n$4, j as i$2, v, C as C$2 } from './sliceToolUtils-fb65526f.js';
import { M } from './BuildingComponentSublayer-b40946d4.js';
import { b as a } from './LineVisualElement-e2d301b0.js';
import { o, i, C as C$1 } from './Factory-11dfe060.js';
import { z } from './manipulatorUtils-81641492.js';
import { a as a$1, s as s$5, m as m$2 } from './analysisViewUtils-afc4be3a.js';
import { d } from './dragEventPipeline-b225d16a.js';
import './persistable-2efd2972.js';
import './capabilities-c49325e3.js';
import './I3SIndexInfo-68240858.js';
import './I3SLayerDefinitions-49ecbb72.js';
import './popupUtils-4fcb9e6d.js';
import './ImageMaterial-26ca33d0.js';
import './drawUtils-716bb6e9.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function s(s){switch(s.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return !1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return !0;default:return n(s.type),!1}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const _="esri.views.3d.analysis.Slice.SliceController",V=s$1.getLogger(_);let g=class extends m{constructor(e){super(e),this._handles=new t,this._internalChange=!1,this._currentSlicePlane=null;}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(e=>{const i=e.item;null!=i&&(i instanceof b$1||i instanceof M)?i instanceof b$1&&s(i)?(V.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(i)&&e.preventDefault():(V.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault());}))),L(this.view,this),this._handles.add([l((()=>this.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews();}),{sync:!0}),l((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),l((()=>[this.analysisViewData.active,this.analysisViewData.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane();}),{sync:!0}),l((()=>this._allLayerAndSubLayerViews),(()=>this._updateLayerViews()))]),this._handles.add([l((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane());}),{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane();}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),D(this.view,this),this._handles.destroy(),this.set("view",null);}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(ke).flatMap((({sublayerViews:e})=>e.items)))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,i=this._currentSlicePlane;if(t$1(i)&&t$1(e)||r(i)&&r(e)&&e.equals(i))return;let a$1=null,t=null;if(r(e)&&r(e.position)){const i=e.position.spatialReference,s=Te(e,this.view);t$1(s)&&a(this.analysis,i,V),a$1=Oe(s,this.view,{tiltEnabled:this.analysis.tiltEnabled},G()),r(a$1)&&(t={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height});}this._currentSlicePlane=t,this._internalChange=!0,this.analysisViewData.plane=a$1,this._internalChange=!1;}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,a=ge(e,this.view,this.view.spatialReference,new h);let t=null;r(a)&&(t={heading:a.heading,tilt:a.tilt,position:a.position,width:a.width,height:a.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=a,this._internalChange=!1,this._updateViewSlicePlane();}_updateActiveController(){if(S)return;const e=C(this.view);if(this.analysisViewData.active)r(e.activeController)&&e.activeController!==this?(S=!0,e.activeController.analysisViewData.active=!1,S=!1):r(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else {if(r(e.activeController)&&e.activeController!==this)return;r(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews());}}_updateViewSlicePlane(){P(this.view);}_updateLayerViews(){const e=r(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,i=[],a=e=>{"layers"in e?e.layers.forEach(a):i.push(e);};this.analysis.excludedLayers.forEach(a),this.view.allLayerViews.forEach((a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&!i.includes(a.layer)),"sublayerViews"in a&&a.sublayerViews.forEach((a=>{a.slicePlaneEnabled=e&&!i.includes(a.sublayer);})));})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface);}};e([y()],g.prototype,"view",void 0),e([y()],g.prototype,"analysis",void 0),e([y()],g.prototype,"analysisViewData",void 0),e([y()],g.prototype,"_allLayerAndSubLayerViews",null),g=e([n$1(_)],g);const b=new Map;let S=!1;function P(e){const i=C(e).activeController;r(i)&&r(i.analysisViewData.plane)&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null;}function L(e,i){b.has(e)||b.set(e,{all:[],activeController:null}),b.get(e).all.push(i);}function C(e){return b.get(e)}function D(e,i){if(!b.has(e))throw new Error("view expected in global slice register");const a=b.get(e),t=a.all.lastIndexOf(i);if(-1===t)throw new Error("controller expected in global slice register");a.all.splice(t,1),0===a.all.length&&b.delete(e);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var kt;let Et=kt=class extends a$1{constructor(t$1){super(t$1),this._clock=t$2,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new t,this._viewHandles=new t,this._frameTask=null,this._pointerMoveTimerMs=e$1,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=G(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=c$1(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=x(t$1.view.state.viewingMode),this._intersector.options.store=t$3.MIN;}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=o(this.view.toolViewManager.textures),this._rotateTiltImage=i(this.view.toolViewManager.textures);const t=t=>{this._updateManipulatorsInteractive(t),t.grabbing||(r(this.analysisViewData.plane)&&X(this.analysisViewData.plane,this._startPlane),this.inputState=null);};this.shiftManipulator=oe(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(e=>{this._onShiftGrab(e),t(this.shiftManipulator);})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=ae(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(e=>{this._onRotateHeadingGrab(e),t(this.rotateHeadingManipulator);})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=ae(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(e=>{this._onRotateTiltGrab(e),t(this.rotateTiltManipulator);})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((e,i)=>{const a=ue(this.view,e);return a.events.on("grab-changed",(e=>{this._onResizeGrab(e,i),t(a);})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=le(this.view),this._previewPlaneOutlineVisualElement=ce(this.view),this._previewPlaneOutlineVisualElement.width=u$1,this._handles.add(l((()=>this.analysisViewData.plane),(()=>this._updateManipulators()),U));const e=l((()=>this.state),(t=>{"sliced"===t&&this.finishToolCreation();}),w);this._handles.add([e,l((()=>this.view.state.camera),(()=>this._onCameraChange()))]);}destroy(){this._rotateHeadingImage=w$1(this._rotateHeadingImage),this._rotateTiltImage=w$1(this._rotateTiltImage),this._handles=s$2(this._handles),this._viewHandles=s$2(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=s$2(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=s$2(this._previewPlaneGridVisualElement);}get state(){const t=!!this.analysisViewData.plane,e=!!this.inputState;return t?t&&e?"slicing":t&&!e?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":r(this._creatingPointerId)?"grabbing":null}set analysis(t){if(null==t)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",t);}get inputState(){return this._get("inputState")}set inputState(t){this._set("inputState",t),this.analysisViewData.showGrid=r(t)&&"resize"===t.type,this._updateMaterials();}get _isPlacingSlicePlane(){return !this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return r(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){t$1(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this));}exitExcludeLayerMode(){t$1(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null));}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null);}onShow(){this._updateVisibility(!0);}onHide(){this._updateVisibility(!1);}_updateVisibility(t){this._updateManipulators(),t||this._clearPointerMoveTimeout();}onInputEvent(t){switch(t.type){case"pointer-drag":if(!Ht(t))return;this._isPlacingSlicePlane?this._onClickPlacePlane(t)&&t.stopPropagation():this._onPointerDrag(t)&&t.stopPropagation();break;case"pointer-move":this._onPointerMove(t);break;case"pointer-up":this._onPointerUp(t)&&t.stopPropagation();break;case"immediate-click":if(!Ht(t))return;this._onClickPlacePlane(t)&&t.stopPropagation();break;case"click":if(!Ht(t))return;this._onClickExcludeLayer(t)&&t.stopPropagation();break;case"drag":this.inputState&&t.stopPropagation();break;case"key-down":this._onKeyDown(t)&&t.stopPropagation();break;case"key-up":this._onKeyUp(t)&&t.stopPropagation();}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable;}_onPointerDrag(t){const e=this.inputState;if(t.pointerId===this._creatingPointerId&&r(e)&&"shift"===e.type){const i=n$2(t);return this.shiftManipulator.events.emit("drag",{action:e.hasBeenDragged?"update":"start",pointerType:t.pointerType,start:i,screenPoint:i}),e.hasBeenDragged=!0,!0}return !1}_onPointerMove(t){this._lastCursorPosition.x=t.x,this._lastCursorPosition.y=t.y,this._resetPointerMoveTimeout(),"touch"!==t.pointerType&&this._updatePreviewPlane(n$2(t),this._activeKeyModifiers);}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators();}_onPointerUp(t){if(t.pointerId===this._creatingPointerId&&r(this.analysisViewData.plane)){const e=n$2(t);return this.shiftManipulator.events.emit("drag",{action:"end",start:e,screenPoint:e}),X(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return !1}_onClickPlacePlane(t){if("exclude"===this.layersMode)return !1;if(this._isPlacingSlicePlane){const i=n$2(t),a=G();if(this._pickPlane(i,!1,this._activeKeyModifiers,a)){if(X(a,this._startPlane),this.analysis.shape=ge(a,this.view,this.view.spatialReference,new h),"pointer-drag"===t.type){const e=this._calculatePickRay(i);this.inputState=St(e,t.pointerId,a.origin,a);}return !0}}return !1}_onClickExcludeLayer(t){return !("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(n$2(t)).then((t=>{if(t.results.length){const e=t.results[0],i="graphic"===e?.type&&e.graphic;if(i){const t=i.sourceLayer||i.layer;t&&this.analysis.excludedLayers.push(t);}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0;})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}_onKeyDown(t){return (t.key===m$1||t.key===c$2)&&(this._activeKeyModifiers[t.key]=!0,r(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(t){return !(t.key!==m$1&&t.key!==c$2||!this._activeKeyModifiers[t.key])&&(delete this._activeKeyModifiers[t.key],r(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(t){if("start"!==t.action||t$1(this.analysisViewData.plane))return;const e=this._calculatePickRay(t.screenPoint);X(this.analysisViewData.plane,this._startPlane),this.inputState=St(e,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane);}_createShiftDragPipeline(t){return d(t,((t,e,i)=>{const a=this.inputState;if(t$1(a)||"shift"!==a.type)return;const s=r(this.analysisViewData.plane)?X(this.analysisViewData.plane,G()):null;e.next(C$1(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{r(s)&&this._updateBoundedPlane(s);}));}))}_shiftDragAdjustSensitivity(t){return e=>{if(t$1(this.analysisViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs(P$1(ms(this.analysisViewData.plane),e.ray.direction)/s$3(e.ray.direction)))/i,1),s=-R(this._startPlane.plane,e.renderEnd),n=-R(this._startPlane.plane,t.startPoint);return t.depth=t.depth*(1-a)+s*a-n,e}}_shiftDragUpdatePlane(t){return ()=>{if(t$1(this.analysisViewData.plane))return;const e=r$1(c$3.get(),this._startPlane.origin),i=r$1(c$3.get(),ms(this._startPlane));g$1(i,i,-t.depth),u$2(i,i,e);const a=D$1(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,G());this._updateBoundedPlane(a);}}_onRotateHeadingGrab(t){if("start"!==t.action||t$1(this.analysisViewData.plane))return;const e=qt(this.analysisViewData.plane,this.view.renderCoordsHelper,Re.HEADING,p()),i=this._calculatePickRay(t.screenPoint),a=n$3();q(e,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:a});}_createRotateHeadingDragPipeline(t){return d(t,((t,e,i)=>{const a=this.inputState;if(t$1(a)||"rotate"!==a.type)return;const s=r(this.analysisViewData.plane)?X(this.analysisViewData.plane,G()):null;e.next(C$1(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{r(s)&&this._updateBoundedPlane(s);}));}))}_onRotateTiltGrab(t){if("start"!==t.action||t$1(this.analysisViewData.plane))return;const e=qt(this.analysisViewData.plane,this.view.renderCoordsHelper,Re.TILT,p()),i=this._calculatePickRay(t.screenPoint),a=n$3();q(e,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:e,startPoint:a});}_createRotateTiltDragPipeline(t){return d(t,((t,e,i)=>{const a=this.inputState;if(t$1(a)||"rotate"!==a.type)return;const s=r(this.analysisViewData.plane)?X(this.analysisViewData.plane,G()):null;e.next(C$1(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{r(s)&&this._updateBoundedPlane(s);}));}))}_rotateDragRenderPlaneToRotate(t){return e=>{if(t$1(this.analysisViewData.plane))return null;const i=Y(t.rotatePlane),a=z(t.startPoint,e.renderEnd,this.analysisViewData.plane.origin,i);return {...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return t=>{if(t$1(this.analysisViewData.plane))return;const e=g$2(f.get(),t.rotateAngle,t.rotateAxis);if(t$1(e))return;const i=O(c$3.get(),this._startPlane.basis1,e),a=O(c$3.get(),this._startPlane.basis2,e),s=D$1(this.analysisViewData.plane.origin,i,a,G());this._updateBoundedPlane(s);}}_onResizeGrab(t,e){if("start"!==t.action||t$1(this.analysisViewData.plane))return;const i=this._calculatePickRay(t.screenPoint),a=c$3.get();q(this.analysisViewData.plane.plane,i,a)&&(X(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:e,startPoint:t$4(a)});}_createResizeDragPipeline(t){return d(t,((t,e,i)=>{const a=this.inputState;if(t$1(a)||"resize"!==a.type||t$1(this.analysisViewData.plane))return;const s=X(this.analysisViewData.plane,G());e.next(C$1(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(s);}));}))}_resizeDragUpdatePlane(t){return e=>{if(t$1(this.analysisViewData.plane))return;const i=this._resizeHandles[t.activeHandleIdx],a=Yt(i,t.startPoint,e.renderEnd,this.view.state.camera,this._startPlane,X(this.analysisViewData.plane));this._updateBoundedPlane(a);}}_updateBoundedPlane(t){const e=this.analysisViewData;if(!r(e))throw new Error("valid internal object expected");e.plane=t;}_updatePreviewPlane(t,e={}){let i=this._previewPlane;if(this._previewPlane=null,t$1(t))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=r(i)?i:G();if(i=r(i)?X(i,xt):null,this._pickPlane(t,!0,e,a)){const t=n$4;let e=!1;r(i)&&(e=P$1(i.plane,a.plane)<t||P$1(z$1(c$3.get(),i.basis1),z$1(c$3.get(),a.basis1))<t),e&&(this._previewPlaneOpacity=0),this._previewPlane=a;}}r(this._previewPlane)&&t$1(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=A({update:({deltaTime:t})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+t/(1e3*M$1),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask();}}):t$1(this._previewPlane)&&r(this._frameTask)?this._removeFrameTask():r(this._previewPlane)&&this._updateManipulators();}_removeFrameTask(){this._frameTask=h$1(this._frameTask);}_calculatePickRay(t){const e=d$1(),i=d$2(t,It);return s$4(this.view.state.camera,i,e),z$1(e.direction,e.direction),e}_pickMinResult(t){const e=d$2(t,t$5.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector),this._intersector.results.min}_pickPlane(t,e,i,a){const s=this._pickMinResult(t),n=c$3.get();if(!s.getIntersectionPoint(n))return !1;const r=s.getTransformedNormal(c$3.get()),l=this.view.state.camera;P$1(r,l.viewForward)>0&&g$1(r,r,-1);const o=Zt(n,l),h=(e?1:-1)*o*i$2,p=g$1(c$3.get(),r,h);u$2(p,p,n);const u=this.analysis.tiltEnabled?we.TILTED:we.HORIZONTAL_OR_VERTICAL,c=i[m$1]?we.VERTICAL:i[c$2]?we.HORIZONTAL:u;return Gt(p,r,o,o,l,c,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=h$1(this._prevPointerMoveTimeout);}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=Ie,this.rotateHeadingManipulator.state|=Ie,this.rotateTiltManipulator.state|=Ie,this._prevPointerMoveTimeout=this._clock.setTimeout((()=>{this.shiftManipulator.state&=~Ie,this.rotateHeadingManipulator.state&=~Ie,this.rotateTiltManipulator.state&=~Ie;}),this._pointerMoveTimerMs);}_updateManipulators(){if(kt.disableEngineLayers)return;let t=null,e=!1;if(r(this.analysisViewData.plane))t=this.analysisViewData.plane,e=!1;else {if(!r(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((t=>t.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,e=!0;}const i=Bt(t,f.get());e?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((t=>t.available=!1)),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((t=>t.available=!0)),zt(this.shiftManipulator,i,t,this.view.state.camera),Kt(this.rotateHeadingManipulator,i,t,this.view.renderCoordsHelper),Qt(this.rotateTiltManipulator,i,t),this.resizeManipulators.forEach(((e,a)=>Jt(e,this._resizeHandles[a],i,t))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=o$1(c$3.get(),s$3(t.basis1),s$3(t.basis2),1),s=q$1(f.get(),a),n=u$3(s,i,s);this._previewPlaneOutlineVisualElement.transform=n,this._previewPlaneGridVisualElement.transform=n,this._updateMaterials();}_updateMaterials(){const t=[b$2[0],b$2[1],b$2[2],b$2[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=t;const e=[x$1[0],x$1[1],x$1[2],x$1[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=e,this._previewPlaneGridVisualElement.gridColor=i;}_updateManipulatorsInteractive(t){if(!t.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((t=>{t.interactive=!0;}));this.shiftManipulator.interactive=this.shiftManipulator===t,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===t,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===t,this.resizeManipulators.forEach((e=>{e.interactive=e===t;}));}testData(){return {plane:this.analysisViewData.plane,setPointerMoveTimerMs:t=>{this._pointerMoveTimerMs=t;}}}};function St(t,e,i,a){const s=Wt(i,ms(a),t.direction,p()),n=n$3();return q(s,t,n)?{type:"shift",creatingPointerId:e,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:n}:null}function Ht(t){return "mouse"!==t.pointerType||0===t.button}Et.disableEngineLayers=!1,e([y()],Et.prototype,"_clock",void 0),e([y({constructOnly:!0})],Et.prototype,"view",void 0),e([y()],Et.prototype,"analysisViewData",void 0),e([y({readOnly:!0})],Et.prototype,"state",null),e([y({readOnly:!0})],Et.prototype,"cursor",null),e([y()],Et.prototype,"analysis",null),e([y()],Et.prototype,"removeIncompleteOnCancel",void 0),e([y({readOnly:!0})],Et.prototype,"layersMode",void 0),e([y({value:null})],Et.prototype,"inputState",null),e([y()],Et.prototype,"_isPlacingSlicePlane",null),e([y()],Et.prototype,"_creatingPointerId",null),Et=kt=e([n$1("esri.views.3d.analysis.Slice.SliceTool")],Et);const xt=G(),It=i$1(),Rt=Et;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let k=class extends m{constructor(i){super(i),this._handles=new t,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0;}initialize(){const i=this.analysisViewData;if(t$1(i))throw new Error("expected internal object to be valid");this._gridVisualElement=le(this.view),this._outlineVisualElement=ce(this.view),this._handles.add([l((()=>({visible:r(i.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(i=>this._updateMaterials(i)),w),l((()=>i.plane),(i=>this._updatePlane(i)),w)],"internal");}destroy(){this._handles.destroy(),this._gridVisualElement=s$2(this._gridVisualElement),this._outlineVisualElement=s$2(this._outlineVisualElement),this.set("view",null);}_updatePlane(i){if(t$1(i))return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const e=o$1(c$3.get(),s$3(i.basis1),s$3(i.basis2),1),s=q$1(f.get(),e),r=Bt(i,f.get()),o=u$3(s,r,s);this._outlineVisualElement.transform=o,this._gridVisualElement.transform=o;}_updateMaterials({visible:i,active:e,preview:s,showGrid:t}){this._outlineVisualElement.color=b$2,this._outlineVisualElement.width=s?u$1:v,this._outlineVisualElement.stipplePattern=e?null:r$2(5),this._gridVisualElement.backgroundColor=x$1,this._gridVisualElement.gridColor=t?C$2:l$1,this._gridVisualElement.visible=i,this._outlineVisualElement.visible=i;}};e([y()],k.prototype,"view",void 0),e([y()],k.prototype,"analysis",void 0),e([y()],k.prototype,"analysisViewData",void 0),e([y()],k.prototype,"showGrid",void 0),e([y()],k.prototype,"preview",void 0),k=e([n$1("esri.views.3d.analysis.Slice.SliceVisualization")],k);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let c=class extends(n$5(m)){constructor(s){super(s),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0;}initialize(){this.analysisVisualization=new k({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new g({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles(s$5(this,Rt));}destroy(){m$2(this),this.analysisVisualization=s$2(this.analysisVisualization),this.analysisController=s$2(this.analysisController);}get showGrid(){return this.analysisVisualization?.showGrid??!1}set showGrid(s){this.analysisVisualization&&(this.analysisVisualization.showGrid=s);}get editable(){return !this.analysisVisualization.preview}set editable(s){this.analysisVisualization.preview=!s;}get testData(){return {visualization:this.analysisVisualization,controller:this.analysisController,tool:e$2(this.tool)}}};e([y({readOnly:!0})],c.prototype,"type",void 0),e([y({constructOnly:!0,nonNullable:!0})],c.prototype,"analysis",void 0),e([y()],c.prototype,"tool",void 0),e([y()],c.prototype,"plane",void 0),e([y()],c.prototype,"active",void 0),e([y()],c.prototype,"showGrid",null),e([y()],c.prototype,"editable",null),c=e([n$1("esri.views.3d.analysis.SliceAnalysisView3D")],c);const u=c;

export { u as default };
