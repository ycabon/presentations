import { r, eA as E, fs as ee, ft as Z$1, t, fu as Bn, f0 as x$1, aL as o$1, aH as n, fv as A, fw as v$1, eK as g, fx as h$2, N as x$2, B as e$1, C as d$2, D as n$1, E as f$1, fy as a$1 } from './_virtual_index-9b831d4a.js';
import { o } from './quantityUtils-95a87361.js';
import { i } from './measurementUtils-77091aae.js';
import { a } from './dehydratedFeatureComparison-dbb61b6e.js';
import { P } from './dragEventPipeline-b56dbe77.js';
import { e } from './SnappingContext-43cb3fd4.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var f;function p(t){return m(t,f.Direct)}function h$1(t){return m(t,f.Horizontal)}function m(t$1,i$1){const{hasZ:o$1,spatialReference:c}=t$1,u=i(c);let l=0;const a=Z$1(u);if(t(a))return null;const p=i$1===f.Direct?j:d$1;for(const r of t$1.paths){if(r.length<2)continue;const t$1=r.length-1;for(let e=0;e<t$1;++e){const t$1=r[e];U[0]=t$1[0],U[1]=t$1[1],U[2]=o$1?t$1[2]:0;const i=r[e+1];b[0]=i[0],b[1]=i[1],b[2]=o$1?i[2]:0;const u=p(U,b,c);if(t(u))return null;l+=u.value;}}return o(l,a)}function z(t,n){const{spatialReference:r}=t;return E(r,n.spatialReference)?(U[0]=t.x,U[1]=t.y,U[2]=t.hasZ?t.z:0,b[0]=n.x,b[1]=n.y,b[2]=n.hasZ?n.z:0,Z(U,b,r)):null}function R(t,n){const{spatialReference:r}=t;return E(r,n.spatialReference)?(U[0]=t.x,U[1]=t.y,U[2]=t.hasZ?t.z:0,b[0]=n.x,b[1]=n.y,b[2]=n.hasZ?n.z:0,d$1(U,b,r)):null}function v(t,n){const{spatialReference:r}=t;return E(r,n.spatialReference)?(U[0]=t.x,U[1]=t.y,U[2]=t.hasZ?t.z:0,b[0]=n.x,b[1]=n.y,b[2]=n.hasZ?n.z:0,D(U,b,r)):null}function x(t){return U[0]=t.x,U[1]=t.y,U[2]=t.hasZ?t.z:0,H(U,t.spatialReference)}function Z(n,e,i){const o$1=V(n,e,i);return r(o$1)?{direct:o(o$1.direct,o$1.unit),horizontal:o(o$1.horizontal,o$1.unit),vertical:o(o$1.vertical,o$1.unit)}:null}function j(n,e,i){const o$1=V(n,e,i,f.Direct);return r(o$1)?o(o$1.direct,o$1.unit):null}function d$1(n,e,i){const o$1=V(n,e,i,f.Horizontal);return r(o$1)?o(o$1.horizontal,o$1.unit):null}function D(n,e,i){const o$1=V(n,e,i,f.Vertical);return r(o$1)?o(o$1.verticalSigned,o$1.unit):null}function H(n,e){const o$1=ee(e);return r(o$1)?o(n[2],o$1):null}function V(t$1,r,i$1,u){const a=i(i$1),p=Z$1(a);if(t(p))return null;const h=r[2]-t$1[2];if(u===f.Vertical)return {verticalSigned:h,unit:p};if(!Bn(t$1,i$1,S,a)||!Bn(r,i$1,k,a))return null;if(u===f.Direct){return {direct:x$1(k,S),unit:p}}if(o$1(M,t$1[0],t$1[1],r[2]),!Bn(M,i$1,M,a))return null;const m=x$1(M,k);if(u===f.Horizontal)return {horizontal:m,unit:p};return {direct:x$1(k,S),horizontal:m,vertical:Math.abs(h),unit:p}}!function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical";}(f||(f={}));const U=n(),b=n(),S=n(),k=n(),M=n();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class d{constructor(){this.next=new P;}createSnapDragEventPipelineStep({predicate:d=(()=>!0),cancel:c,snappingManager:m,snappingContext:x,updatingHandles:u}){if(t(m))return e=>e;let y=null,f=null;const g$1=()=>{y=h$2(y),m.doneSnapping(),r(f)&&f.frameTask.remove(),f=null;};c.next((e=>(g$1(),e))),this.next=new P;const v=x$2((async({frameTask:e,point:t,context:n,event:r,dx:a$1,dy:i},s)=>{const p=await e.schedule((()=>m.snap(t,n,s)),s);if(p.valid){let l=await e.schedule((()=>p.apply()),s);t!==P$1&&(l=m.update(P$1,n)),a(l,h)||(r.mapEnd.x=l.x+a$1,r.mapEnd.y=l.y+i,this.next.execute(r));}}));let P$1,h;return e$1=>{if(!d(e$1))return e$1;if("start"===e$1.action){const n="3d"===m.view.type?m.view.resourceController.scheduler.registerTask(A.SNAPPING):v$1;f={context:new e({editGeometryOperations:x.editGeometryOperations,elevationInfo:x.elevationInfo,pointer:x.pointer,vertexHandle:r(e$1.info)?e$1.info.handle:null,excludeFeature:x.excludeFeature,visualizer:x.visualizer}),originalPos:r(e$1.snapOrigin)?x.coordinateHelper.vectorToDehydratedPoint(e$1.snapOrigin):e$1.mapStart,frameTask:n};}if(r(f)){const n=f.context.coordinateHelper.vectorToDehydratedPoint(f.context.coordinateHelper.arrayToVector([f.originalPos.x,f.originalPos.y,f.originalPos.z]));n.x+=e$1.mapEnd.x-e$1.mapStart.x,n.y+=e$1.mapEnd.y-e$1.mapStart.y;const a=e$1.mapStart.x-f.originalPos.x,o=e$1.mapStart.y-f.originalPos.y,i={...e$1,action:"update"},s=f.context,p=m.update(n,f.context);if(h=p,e$1.mapEnd.x=p.x+a,e$1.mapEnd.y=p.y+o,P$1=n,"end"!==e$1.action){const e=f.frameTask;r(y)||(y=new AbortController),u.addPromise(g(v({frameTask:e,event:i,context:s,point:n,dx:a,dy:o},y.signal)));}}return "end"===e$1.action&&g$1(),e$1}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let h=class extends f$1{constructor(t){super(t),this.stagedPoint=null,this._abortController=null,this._snap=x$2((async(t,r,s,o)=>{const e=await this._frameTask.schedule((()=>r.snap(t,s,o)),o);e.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=e.apply(),t!==this._snapMapPoint&&(this.stagedPoint=r.update(this._snapMapPoint,s));}),o);}));}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=r(t)?t.registerTask(A.SNAPPING):v$1;}destroy(){this._abortController=h$2(this._abortController),this._frameTask=a$1(this._frameTask);}async snap(t$1,r,s){return this.stagedPoint=r.update(t$1,s),this._snapMapPoint=t$1,t(this._abortController)&&(this._abortController=new AbortController),this._snap(t$1,r,s,this._abortController.signal)}abort(){this._abortController=h$2(this._abortController);}};e$1([d$2({constructOnly:!0})],h.prototype,"view",void 0),e$1([d$2()],h.prototype,"stagedPoint",void 0),h=e$1([n$1("esri.views.interactive.snapping.SnappingOperation")],h);

export { D, R, d as a, h as b, d$1 as d, h$1 as h, j, p, v, x, z };
