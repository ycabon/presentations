import { a9 as m$1, t, E as s, mp as w, m as r, mq as Ut, n as j, e8 as a$1 } from './_virtual_index-1ea2035a.js';
import { a, r as r$1 } from './fetchService-5c7089ef.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
async function c(e){const r=e.properties?.customParameters,a=await m(e.url,r),t={...e.properties,url:e.url};if(!a.sublayerIds)return null!=a.layerOrTableId&&(t.layerId=a.layerOrTableId,t.sourceJSON=a.sourceJSON),new a.Constructor(t);const s=new((await import('./_virtual_index-1ea2035a.js').then(function (n) { return n.zi; })).default)({title:a.parsedUrl.title});return d(s,a,t),s}function i(e,r){return e?e.find((e=>e.id===r)):null}function d(e,r$1,t){function s(e,s){const n={...t,layerId:e,sublayerTitleMode:"service-name"};return r(s)&&(n.sourceJSON=s),new r$1.Constructor(n)}r$1.sublayerIds.forEach((a=>{const t=s(a,i(r$1.sublayerInfos,a));e.add(t);})),r$1.tableIds.forEach((a=>{const t=s(a,i(r$1.tableInfos,a));e.tables.add(t);}));}async function m(a$1,t$1){let s$1=m$1(a$1);if(t(s$1)&&(s$1=await f(a$1,t$1)),t(s$1))throw new s("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:a$1});const{serverType:l,sublayer:u}=s$1;let y;const c={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(l){case"MapServer":y=null!=u?"FeatureLayer":b(a$1,t$1).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":y=a(a$1,{customParameters:t$1}).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?"LERC"!==r?.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":y=a(s$1.url.path,{customParameters:t$1}).then((e=>{if(e){if("Voxel"===e?.layerType)return "VoxelLayer";if(e?.layers&&Array.isArray(e.layers)&&e.layers.length>0){const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},a=e.layers[0]?.layerType;if(null!=r[a])return r[a]}}return "SceneLayer"}));break;default:y=c[l];}const i={FeatureLayer:!0,SceneLayer:!0},d="FeatureServer"===l,m={parsedUrl:s$1,Constructor:null,layerOrTableId:d?u:null,sublayerIds:null,tableIds:null},p=await y;if(i[p]&&null==u){const e=await I(a$1,l,t$1);d&&(m.sublayerInfos=e.layerInfos,m.tableInfos=e.tableInfos);1!==e.layerIds.length+e.tableIds.length?(m.sublayerIds=e.layerIds,m.tableIds=e.tableIds):d&&(m.layerOrTableId=e.layerIds[0]??e.tableIds[0],m.sourceJSON=e.layerInfos[0]??e.tableInfos[0]);}return m.Constructor=await S(p),m}async function f(e,r$1){const n=await a(e,{customParameters:r$1});let u=null,y=null;const c=n.type;if("Feature Layer"===c||"Table"===c?(u="FeatureServer",y=n.id):"indexedVector"===c?u="VectorTileServer":n.hasOwnProperty("mapName")?u="MapServer":n.hasOwnProperty("bandCount")&&n.hasOwnProperty("pixelSizeX")?u="ImageServer":n.hasOwnProperty("maxRecordCount")&&n.hasOwnProperty("allowGeometryUpdates")?u="FeatureServer":n.hasOwnProperty("streamUrls")?u="StreamServer":p(n)?(u="SceneServer",y=n.id):n.hasOwnProperty("layers")&&p(n.layers?.[0])&&(u="SceneServer"),!u)return null;const i=null!=y?w(e):null;return {title:r(i)&&n.name||Ut(e),serverType:u,sublayer:y,url:{path:r(i)?i.serviceUrl:j(e).path}}}function p(e){return e?.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}async function I(e,r,a$1){let t,s=!1;if("FeatureServer"===r){const r=await r$1(e,{customParameters:a$1});s=!!r.layersJSON,t=r.layersJSON||r.serviceJSON;}else t=await a(e,{customParameters:a$1});const n=t?.layers,l=t?.tables;return {layerIds:n?.map((e=>e.id)).reverse()||[],tableIds:l?.map((e=>e.id)).reverse()||[],layerInfos:s?n:[],tableInfos:s?l:[]}}async function S(e){return (0, a$1[e])()}async function b(e,r){return (await a(e,{customParameters:r})).tileInfo}

export { c as fromUrl };
