import { bH as s$1, bq as y$1, bm as c$3, cX as c$4, Z as s$2, y as y$2, cY as i$2, c1 as M, r as r$3, ce as e$2, cZ as o$2, c_ as n$2, aw as u$2, c$ as o$3, d0 as p, d1 as C, cq as i$3, c6 as l, c2 as e$4 } from './_virtual_index-fc1e0009.js';
import { t as t$1, x as x$1, a as a$1, r as r$2, A as A$1, Z as Z$1, c as te$1 } from './CIMSymbolHelper-d0b50b9c.js';
import { f as i$1, e as e$3, c as n$3 } from './enums-11126df6.js';
import { o as o$1 } from './floatRGBA-3ce2e497.js';
import { s as s$3 } from './callExpressionWithFeature-1f700441.js';
import { d as dt } from './definitions-20a531fc.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function r$1(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const n=t.symbolLayers;return n&&1===n.length?r$1(n[0]):null}case"CIMVectorMarker":{const n=t.markerGraphics;if(!n||1!==n.length)return null;const o=n[0];if(!o)return null;const r=o.geometry;if(!r)return null;const l=o.symbol;return !l||"CIMPolygonSymbol"!==l.type&&"CIMLineSymbol"!==l.type||l.symbolLayers?.some((t=>!!t.effects))?null:{geom:r,asFill:"CIMPolygonSymbol"===l.type}}case"sdf":return {geom:t.geom,asFill:t.asFill}}return null}function e$1(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}function s(t){let n=1/0,r=-1/0,l=1/0,e=-1/0;for(const o of t)for(const t of o)t[0]<n&&(n=t[0]),t[0]>r&&(r=t[0]),t[1]<l&&(l=t[1]),t[1]>e&&(e=t[1]);return new t$1(n,l,r-n,e-l)}function i(t){let n=1/0,o=-1/0,r=1/0,l=-1/0;for(const e of t)for(const t of e)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return [n,r,o,l]}function f$1(t){return t?t.rings?i(t.rings):t.paths?i(t.paths):s$1(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function m(t,n,o,r,l){const[e,s,i,f]=t;if(i<e||f<s)return [0,0,0];const m=i-e,a=f-s,u=128,c=1,y=Math.floor(.5*(.5*u-c)),h=(u-2*(y+c))/Math.max(m,a),x=Math.round(m*h)+2*y,M=Math.round(a*h)+2*y;let g=1;if(n){g=M/h/(n.ymax-n.ymin);}let p=0,d=0;if(r)if(l){if(n&&o&&n.ymax-n.ymin>0){const t=(n.xmax-n.xmin)/(n.ymax-n.ymin);p=r.x/(o*t),d=r.y/o;}}else p=r.x,d=r.y;p=.5*(n.xmax+n.xmin)+p*(n.xmax-n.xmin),d=.5*(n.ymax+n.ymin)+d*(n.ymax-n.ymin),p-=e,d-=s,p*=h,d*=h,p+=y,d+=y;return [g,p/x-.5,-(d/M-.5)]}function a(t){const n=e$1(t.geom),o=s(n),r=128,l=1,i=Math.floor(.5*(.5*r-l)),f=(r-2*(i+l))/Math.max(o.width,o.height),m=Math.round(o.width*f)+2*i,a=Math.round(o.height*f)+2*i,h=[];for(const e of n)if(e&&e.length>1){const n=[];for(const r of e){let[l,e]=r;l-=o.x,e-=o.y,l*=f,e*=f,l+=i-.5,e+=i-.5,t.asFill?n.push([l,e]):n.push([Math.round(l),Math.round(e)]);}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0]);}h.push(n);}const x=u$1(h,m,a,i);return t.asFill&&c$2(h,m,a,i,x),[y(x,i),m,a]}function u$1(t,n,o,r){const l=n*o,e=new Array(l),s=r*r+1;for(let i=0;i<l;++i)e[i]=s;for(const i of t){const t=i.length;for(let l=1;l<t;++l){const t=i[l-1],s=i[l];let f,m,a,u;t[0]<s[0]?(f=t[0],m=s[0]):(f=s[0],m=t[0]),t[1]<s[1]?(a=t[1],u=s[1]):(a=s[1],u=t[1]);let c=Math.floor(f)-r,y=Math.floor(m)+r,h=Math.floor(a)-r,x=Math.floor(u)+r;c<0&&(c=0),y>n&&(y=n),h<0&&(h=0),x>o&&(x=o);const M=s[0]-t[0],g=s[1]-t[1],p=M*M+g*g;for(let r=c;r<y;r++)for(let l=h;l<x;l++){let i,f,m=(r-t[0])*M+(l-t[1])*g;m<0?(i=t[0],f=t[1]):m>p?(i=s[0],f=s[1]):(m/=p,i=t[0]+m*M,f=t[1]+m*g);const a=(r-i)*(r-i)+(l-f)*(l-f),u=(o-l-1)*n+r;a<e[u]&&(e[u]=a);}}}for(let i=0;i<l;++i)e[i]=Math.sqrt(e[i]);return e}function c$2(t,n,o,r,l){for(const e of t){const t=e.length;for(let s=1;s<t;++s){const t=e[s-1],i=e[s];let f,m,a,u;t[0]<i[0]?(f=t[0],m=i[0]):(f=i[0],m=t[0]),t[1]<i[1]?(a=t[1],u=i[1]):(a=i[1],u=t[1]);let c=Math.floor(f),y=Math.floor(m)+1,h=Math.floor(a),x=Math.floor(u)+1;c<r&&(c=r),y>n-r&&(y=n-r),h<r&&(h=r),x>o-r&&(x=o-r);for(let e=h;e<x;++e){if(t[1]>e==i[1]>e)continue;const s=(o-e-1)*n;for(let n=c;n<y;++n)n<(i[0]-t[0])*(e-t[1])/(i[1]-t[1])+t[0]&&(l[s+n]=-l[s+n]);for(let t=r;t<c;++t)l[s+t]=-l[s+t];}}}}function y(n,o){const r=2*o,l=n.length,e=new Uint8Array(4*l);for(let s=0;s<l;++s){const o=.5-n[s]/r;o$1(o,e,4*s);}return e}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const c$1=96/72;class f{static executeEffects(t,s,r){const f=a$1(s),p=c$1;let u=new r$2(f);for(const e of t){const t=A$1(e);t&&(u=t.execute(u,e,p,r));}return u}static next(t){const s=t.next();return x$1(s),s}static applyEffects(e,r,c){if(!e)return r;let f=new r$2(r);for(const t of e){const s=A$1(t);s&&(f=s.execute(f,t,1,c));}let p,u=null;for(;p=f.next();)u?y$1(u)?y$1(p)&&u.paths.push(...p.paths):c$3(u)&&c$3(p)&&u.rings.push(...p.rings):u=p;return u}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function t(e){const r=e.toLowerCase().split(" ").join("-");switch(r){case"serif":return "noto-serif";case"sans-serif":return "arial-unicode-ms";case"monospace":return "ubuntu-mono";case"fantasy":return "cabin-sketch";case"cursive":return "redressed";default:return r}}function n$1(e){const r=u(e)+c(e);return t(e.family)+(r.length>0?r:"-regular")}function u(e){if(!e.weight)return "";switch(e.weight.toLowerCase()){case"bold":case"bolder":return "-bold"}return ""}function c(e){if(!e.style)return "";switch(e.style.toLowerCase()){case"italic":case"oblique":return "-italic"}return ""}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function e(e,o){let r;if("string"==typeof e)r=c$4(e+`-seed(${o})`);else {let t=12;r=e^o;do{r=107*(r>>8^r)+t|0;}while(0!=--t)}return (1+r/(1<<31))/2}function o(t){return Math.floor(e(t,r)*n)}const r=53290320,n=10;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const w=s$2.getLogger("esri.symbols.cim.cimAnalyzer");function L(e){switch(e){case"Butt":return e$3.BUTT;case"Square":return e$3.SQUARE;default:return e$3.ROUND}}function X(e){switch(e){case"Bevel":return n$3.BEVEL;case"Miter":return n$3.MITER;default:return n$3.ROUND}}function z(e){switch(e){case"Left":default:return "left";case"Right":return "right";case"Center":return "center";case"Justify":return w.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),"center"}}function A(e){switch(e){case"Top":default:return "top";case"Center":return "middle";case"Baseline":return "baseline";case"Bottom":return "bottom"}}function R(e){let t="",i="";if(e){const o=e.toLowerCase();o.includes("italic")?t="italic":o.includes("oblique")&&(t="oblique"),o.includes("bold")?i="bold":o.includes("light")&&(i="lighter");}return {style:t,weight:i}}function J(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function x(e,t,i,o){let r;e[t]?r=e[t]:(r={},e[t]=r),r[i]=o;}function H(e){const t=e.markerPlacement;return t&&t.angleToLine?i$1.MAP:i$1.SCREEN}async function Y(e,t,i,o,r){const n=o??[];if(!e)return n;let l,s;const c={};if("CIMSymbolReference"!==e.type)return w.error("Expect cim type to be 'CIMSymbolReference'"),n;if(l=e.symbol,s=e.primitiveOverrides,s){const e=[];for(const i of s){const o=i.valueExpressionInfo;if(o&&t){const r=o.expression,n=i$3(r,t.spatialReference,t.fields).then((e=>{e&&x(c,i.primitiveName,i.propertyName,e);}));e.push(n);}else null!=i.value&&x(c,i.primitiveName,i.propertyName,i.value);}e.length>0&&await Promise.all(e);}const f=[];switch(fe(l,i,f),f.length>0&&await Promise.all(f),l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":$(l,s,c,t,n,i,r);}return n}function $(e,t,i,o,r,n,l){if(!e)return;const a=e.symbolLayers;if(!a)return;const s=e.effects;let p;const u=Z$1.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(p=i$1.MAP);let y=a.length;for(;y--;){const c=a[y];if(!c||!1===c.enable)continue;let m;s&&s.length&&(m=[...s]);const h=c.effects;h&&h.length&&(s?m.push(...h):m=[...h]);const g=[];let d;te$1.findEffectOverrides(m,t,g),d=g.length>0?re(m,g,i,o):m;const S=[];switch(te$1.findApplicableOverrides(c,t,S),c.type){case"CIMSolidFill":E(c,d,i,S,o,r);break;case"CIMPictureFill":T(c,d,i,S,o,n,r);break;case"CIMHatchFill":j(c,d,i,S,o,r);break;case"CIMGradientFill":F(c,d,i,S,o,r);break;case"CIMSolidStroke":W(c,d,i,S,o,r,"CIMPolygonSymbol"===e.type,u);break;case"CIMPictureStroke":D(c,d,i,S,o,r,"CIMPolygonSymbol"===e.type,u);break;case"CIMGradientStroke":U(c,d,i,S,o,r,"CIMPolygonSymbol"===e.type,u);break;case"CIMCharacterMarker":if(G(c,d,i,S,o,r))break;break;case"CIMPictureMarker":if(G(c,d,i,S,o,r))break;"CIMLineSymbol"===e.type&&(p=H(c)),B(c,d,i,S,o,n,r,p,u);break;case"CIMVectorMarker":if(G(c,d,i,S,o,r))break;"CIMLineSymbol"===e.type&&(p=H(c)),q(c,d,i,S,o,r,n,p,u,l);break;default:w.error("Cannot analyze CIM layer",c.type);}}}function E(e,t,i,o,r,n){const a=e.primitiveName,s=i$2(e.color),[c,f]=ce(o,a,t,null,null),m=c$4(JSON.stringify(e)+f).toString();n.push({type:"fill",templateHash:m,materialHash:c?()=>m:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:ie(a,i,"Color",r,s,te),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t,applyRandomOffset:!1,sampleAlphaOnly:!0});}function T(e,t,i,r,n,a,s){const c=e.primitiveName,f=e.tintColor?i$2(e.tintColor):{r:255,g:255,b:255,a:1},[m,p]=ce(r,c,t,null,null),u=c$4(JSON.stringify(e)+p).toString(),y=c$4(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let h=M(e.scaleX);if("width"in e){const t=e.width;let i=1;const r=a.getResource(e.url);r$3(r)&&(i=r.width/r.height),h/=i*(e.height/t);}s.push({type:"fill",templateHash:u,materialHash:m?()=>y:y,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:ie(c,i,"TintColor",n,f,te),height:ie(c,i,"Height",n,e.height),scaleX:ie(c,i,"ScaleX",n,h),angle:ie(c,i,"Rotation",n,M(e.rotation)),offsetX:ie(c,i,"OffsetX",n,M(e.offsetX)),offsetY:ie(c,i,"OffsetY",n,M(e.offsetY)),url:e.url,applyRandomOffset:!1,sampleAlphaOnly:!1});}function j(e,t,i,o,r,n){const a=["Rotation","OffsetX","OffsetY"],s=o.filter((t=>t.primitiveName!==e.primitiveName&&!a.includes(t.propertyName))),c=e.primitiveName,[f,m]=ce(o,c,t,null,null),p=c$4(JSON.stringify(e)+m).toString(),u=c$4(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();let y={r:255,g:255,b:255,a:1};if(e.lineSymbol){const t=e.lineSymbol?.symbolLayers.find((e=>"CIMSolidStroke"===e.type));t&&(y=i$2(t.color));}n.push({type:"fill",templateHash:p,materialHash:f?ae(u,i,s,r):u,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:t,color:y,height:ie(c,i,"Separation",r,e.separation),scaleX:1,angle:ie(c,i,"Rotation",r,M(e.rotation)),offsetX:ie(c,i,"OffsetX",r,M(e.offsetX)),offsetY:ie(c,i,"OffsetY",r,M(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0});}function F(e,t,i,o,r,n){const a=e.primitiveName,[s,c]=ce(o,a,t,null,null),f=c$4(JSON.stringify(e)+c).toString();n.push({type:"fill",templateHash:f,materialHash:s?ae(f,i,o,r):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1});}function W(e,t,i,o,r,n,a,s){const c=e.primitiveName,f=i$2(e.color),m=void 0!==e.width?e.width:4,p=L(e.capStyle),u=X(e.joinStyle),y=e.miterLimit,[h,d]=ce(o,c,t,null,null),S=c$4(JSON.stringify(e)+d).toString();let v,N;if(t&&t instanceof Array&&t.length>0){const e=t[t.length-1];if("CIMGeometricEffectDashes"===e.type&&"NoConstraint"===e.lineDashEnding&&null===e.offsetAlongLine){const e=(t=[...t]).pop();v=e.dashTemplate,N=e.scaleDash;}}n.push({type:"line",templateHash:S,materialHash:h?()=>S:S,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:ie(c,i,"Color",r,f,te),width:ie(c,i,"Width",r,m),cap:ie(c,i,"CapStyle",r,p),join:ie(c,i,"JoinStyle",r,u),miterLimit:ie(c,i,"MiterLimit",r,y),referenceWidth:s,zOrder:ee(e.name),dashTemplate:v,scaleDash:N,sampleAlphaOnly:!0});}function D(e,t,i,o,r,n,a,s){const c=c$4(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,m=i$2(e.tintColor),p=void 0!==e.width?e.width:4,u=L(e.capStyle),y=X(e.joinStyle),h=e.miterLimit,[d,S]=ce(o,f,t,null,null),v=c$4(JSON.stringify(e)+S).toString();n.push({type:"line",templateHash:v,materialHash:d?()=>c:c,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:ie(f,i,"TintColor",r,m,te),width:ie(f,i,"Width",r,p),cap:ie(f,i,"CapStyle",r,u),join:ie(f,i,"JoinStyle",r,y),miterLimit:ie(f,i,"MiterLimit",r,h),referenceWidth:s,zOrder:ee(e.name),dashTemplate:null,scaleDash:!1,url:e.url,sampleAlphaOnly:!1});}function U(e,t,i,o,r,n,a,s){const c=e.primitiveName,f=void 0!==e.width?e.width:4,m=L(e.capStyle),p=X(e.joinStyle),u=e.miterLimit,[y,h]=ce(o,c,t,null,null),g=c$4(JSON.stringify(e)+h).toString();n.push({type:"line",templateHash:g,materialHash:y?ae(g,i,o,r):g,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:ie(c,i,"Width",r,f),cap:ie(c,i,"CapStyle",r,m),join:ie(c,i,"JoinStyle",r,p),miterLimit:ie(c,i,"MiterLimit",r,u),referenceWidth:s,zOrder:ee(e.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1});}function G(e,t,i,o,r,a){const s=e.markerPlacement;if(!s||"CIMMarkerPlacementInsidePolygon"!==s.type)return !1;const c=s,f=Math.abs(c.stepX),m=Math.abs(c.stepY);if(0===f||0===m)return !0;const p=["Rotation","OffsetX","OffsetY"],u=o.filter((t=>t.primitiveName!==e.primitiveName&&!p.includes(t.propertyName))),y="url"in e?e.url:null,[h,S]=ce(o,c.primitiveName,t,null,null),v=c$4(JSON.stringify(e)+S).toString();let N,b,O=null;if("Random"===s.gridType){const e=e$4(dt),t=Math.max(Math.floor(e/f),1),i=Math.max(Math.floor(e/m),1);N=m*i,O=e=>e?e*i:0;b=t*f/N;}else s.shiftOddRows?(N=2*m,O=e=>e?2*e:0,b=f/m*.5):(N=m,O=null,b=f/m);let C={r:255,g:255,b:255,a:1};return "tintColor"in e&&(C=i$2(e.tintColor)),a.push({type:"fill",templateHash:v,materialHash:h?ae(v,i,u,r):v,cim:e,materialOverrides:u,colorLocked:e.colorLocked,effects:t,color:ie(c.primitiveName,i,"TintColor",r,C,te),height:ie(c.primitiveName,i,"StepY",r,N,O),scaleX:b,angle:ie(c.primitiveName,i,"GridAngle",r,c.gridAngle),offsetX:ie(c.primitiveName,i,"OffsetX",r,M(c.offsetX)),offsetY:ie(c.primitiveName,i,"OffsetY",r,M(c.offsetY)),url:y,applyRandomOffset:"Random"===s.gridType,sampleAlphaOnly:!y}),!0}function B(e,t,i,r,n,a,s,c,f){const m=e.primitiveName,p=M(e.size);let u=M(e.scaleX);const y=M(e.rotation),h=M(e.offsetX),S=M(e.offsetY),v=e.tintColor?i$2(e.tintColor):{r:255,g:255,b:255,a:1},b=c$4(`${e.url}${JSON.stringify(e.colorSubstitutions)}${JSON.stringify(e.animatedSymbolProperties)}`).toString(),O=ne(e.markerPlacement,r,i,n),C=le(e.animatedSymbolProperties,r,i,n),[k,P]=ce(r,m,t,O,C),M$1=c$4(JSON.stringify(e)+P).toString(),w=e.anchorPoint??{x:0,y:0};if("width"in e){const t=e.width;let i=1;const r=a.getResource(e.url);r$3(r)&&(i=r.width/r.height),u/=i*(p/t);}function L(e,t){return e$2(C,e,t)}const X=e.animatedSymbolProperties&&!0===e.animatedSymbolProperties.randomizeStartTime?(e,t,i,o$1)=>{const r=o(o$1),n=L(e,t);return b+`-MATERIALGROUP(${r})`+`-ASP(${JSON.stringify(n)})`}:k?(e,t)=>{const i=L(e,t);return b+`-ASP(${JSON.stringify(i)})`}:b;s.push({type:"marker",templateHash:M$1,materialHash:X,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:c,size:ie(m,i,"Size",n,p),scaleX:ie(m,i,"ScaleX",n,u),rotation:ie(m,i,"Rotation",n,y),offsetX:ie(m,i,"OffsetX",n,h),offsetY:ie(m,i,"OffsetY",n,S),color:ie(m,i,"TintColor",n,v,te),anchorPoint:{x:w.x,y:-w.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:1,markerPlacement:O,url:e.url,animatedSymbolProperties:C});}function q(e,t,i,o,r,n,l,a,s,c){const f=e.markerGraphics;if(!f)return;let m=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(m=t.ymax-t.ymin);}const p=ne(e.markerPlacement,o,i,r);for(const u of f)if(u){const f=u.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":K(e,t,p,null,u,o,i,r,n,l,a,s,m,c);break;case"CIMTextSymbol":V(e,t,p,u,i,o,r,n,a,s,m);}}}function V(e,t$1,i,o,r,n,a,s,m,p,u){const y=[];te$1.findApplicableOverrides(o,n,y);const h=o.geometry;if(!("x"in h)||!("y"in h))return;const b=o.symbol,O=J(b),C=R(b.fontStyleName),k=t(b.fontFamilyName);b.font={family:k,decoration:O,...C};const P=e.frame,I=h.x-.5*(P.xmin+P.xmax),w=h.y-.5*(P.ymin+P.ymax),L=e.size/u,X=e.primitiveName,x=M(b.height)*L,H=M(b.angle),Y=M(e.offsetX)+(M(b.offsetX)+I)*L,$=M(e.offsetY)+(M(b.offsetY)+w)*L,E=i$2(Z$1.getFillColor(b));let T=i$2(Z$1.getStrokeColor(b)),j=Z$1.getStrokeWidth(b);j||(T=i$2(Z$1.getFillColor(b.haloSymbol)),j=b.haloSize*L);const[F,W]=ce(n,X,t$1,i,null),D=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),U=c$4(JSON.stringify(o)+D+W).toString();let G=ie(o.primitiveName,r,"TextString",a,o.textString,o$2,b.textCase);if(null==G)return;const{fontStyleName:B}=b,q=k+(B?"-"+B.toLowerCase():"-regular"),V=q;"string"==typeof G&&G.includes("[")&&b.fieldMap&&(G=n$2(b.fieldMap,G,b.textCase)),s.push({type:"text",templateHash:U,materialHash:F||"function"==typeof G||G.match(/\[(.*?)\]/)?(e,t,i)=>V+"-"+e$2(G,e,t,i):V+"-"+c$4(G),cim:b,materialOverrides:null,colorLocked:e.colorLocked,effects:t$1,alignment:m,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:q,decoration:O,weight:ie(X,r,"Weight",a,C.weight),style:ie(X,r,"Size",a,C.style),size:ie(X,r,"Size",a,x),angle:ie(X,r,"Rotation",a,H),offsetX:ie(X,r,"OffsetX",a,Y),offsetY:ie(X,r,"OffsetY",a,$),horizontalAlignment:z(b.horizontalAlignment),verticalAlignment:A(b.verticalAlignment),text:G,color:E,outlineColor:T,outlineSize:j,referenceSize:p,sizeRatio:1,markerPlacement:i});}function K(e,t,i,r,n,a,s,f$2,m$1,p,u,S,v,N){const b=n.symbol,O=b.symbolLayers;if(!O)return;if(N)return void _(e,t,i,r,n,s,a,f$2,m$1,p,u,S,v);let k=O.length;if(me(O))return void Q(e,t,i,r,n,O,a,s,f$2,m$1,u,S,v);const P=f.applyEffects(b.effects,n.geometry,p.geometryEngine);if(P)for(;k--;){const N=O[k];if(N&&!1!==N.enable)switch(N.type){case"CIMSolidFill":case"CIMSolidStroke":{const b=f.applyEffects(N.effects,P,p.geometryEngine),O=f$1(b);if(!O)continue;const[k,M$1,I]=m(O,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),w="CIMSolidFill"===N.type,L={type:"sdf",geom:b,asFill:w},X=e.primitiveName,z=M(e.size)??10,A=M(e.rotation),R=M(e.offsetX),J=M(e.offsetY),x=N.path,H=N.primitiveName,Y=i$2(w?Z$1.getFillColor(N):Z$1.getStrokeColor(N)),$=w?{r:0,g:0,b:0,a:0}:i$2(Z$1.getStrokeColor(N)),E=Z$1.getStrokeWidth(N);if(!w&&!E)break;let T=!1,j="";for(const e of a)e.primitiveName!==H&&e.primitiveName!==X||(void 0!==e.value?j+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(T=!0));r$3(t)&&"function"==typeof t&&(T=!0);const F=JSON.stringify({...e,markerGraphics:null}),W=c$4(JSON.stringify(L)+x).toString(),D={type:"marker",templateHash:c$4(JSON.stringify(n)+JSON.stringify(N)+F+j).toString(),materialHash:T?()=>W:W,cim:L,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:u,anchorPoint:{x:M$1,y:I},isAbsoluteAnchorPoint:!1,size:ie(e.primitiveName,s,"Size",f$2,z),rotation:ie(e.primitiveName,s,"Rotation",f$2,A),offsetX:ie(e.primitiveName,s,"OffsetX",f$2,R),offsetY:ie(e.primitiveName,s,"OffsetY",f$2,J),scaleX:1,frameHeight:v,rotateClockwise:e.rotateClockwise,referenceSize:S,sizeRatio:k,color:ie(H,s,"Color",f$2,Y,te),outlineColor:ie(H,s,"Color",f$2,$,te),outlineWidth:ie(H,s,"Width",f$2,E),markerPlacement:i,animatedSymbolProperties:r,path:x};m$1.push(D);break}default:_(e,t,i,r,n,s,a,f$2,m$1,p,u,S,v);}}}function Q(e,t,i,o,r,n,a,s,f,m$1,p,u,S){const v=r.geometry,N=n[0],b=n[1],O=f$1(v);if(!O)return;const[C,k,P]=m(O,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),M$1={type:"sdf",geom:v,asFill:!0},I=e.primitiveName,w=M(e.size),L=M(e.rotation),X=M(e.offsetX),z=M(e.offsetY),A=b.path,R=b.primitiveName,J=N.primitiveName,x=i$2(Z$1.getFillColor(b)),H=i$2(Z$1.getStrokeColor(N)),Y=Z$1.getStrokeWidth(N);let $=!1,E="";for(const l of a)l.primitiveName!==R&&l.primitiveName!==J&&l.primitiveName!==I||(void 0!==l.value?E+=`-${l.primitiveName}-${l.propertyName}-${JSON.stringify(l.value)}`:l.valueExpressionInfo&&($=!0));const T=JSON.stringify({...e,markerGraphics:null}),j=c$4(JSON.stringify(M$1)+A).toString(),F={type:"marker",templateHash:c$4(JSON.stringify(r)+JSON.stringify(b)+JSON.stringify(N)+T+E).toString(),materialHash:$?()=>j:j,cim:M$1,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:p,anchorPoint:{x:k,y:P},isAbsoluteAnchorPoint:!1,size:ie(e.primitiveName,s,"Size",f,w),rotation:ie(e.primitiveName,s,"Rotation",f,L),offsetX:ie(e.primitiveName,s,"OffsetX",f,X),offsetY:ie(e.primitiveName,s,"OffsetY",f,z),scaleX:1,frameHeight:S,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:C,color:ie(R,s,"Color",f,x,te),outlineColor:ie(J,s,"Color",f,H,te),outlineWidth:ie(J,s,"Width",f,Y),markerPlacement:i,path:A,animatedSymbolProperties:o};m$1.push(F);}function _(e,t,i,n,a,s,f,m,p,u,y,h,g){const S=Z(e,a);let v=[];const N=["Rotation","OffsetX","OffsetY"];v=f.filter((t=>t.primitiveName!==e.primitiveName||!N.includes(t.propertyName)));let b="";for(const o of f)void 0!==o.value&&(b+=`-${o.primitiveName}-${o.propertyName}-${JSON.stringify(o.value)}`);const[O,C,k]=Z$1.getTextureAnchor(S,u),P=e.primitiveName,M$1=M(e.rotation),I=M(e.offsetX),w=M(e.offsetY),L=c$4(JSON.stringify(S)+b).toString(),X={type:"marker",templateHash:L,materialHash:v.length>0||r$3(t)&&"function"==typeof t?ae(L,s,v,m):L,cim:S,materialOverrides:v,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:y,anchorPoint:{x:O,y:C},isAbsoluteAnchorPoint:!1,size:e.size,rotation:ie(P,s,"Rotation",m,M$1),offsetX:ie(P,s,"OffsetX",m,I),offsetY:ie(P,s,"OffsetY",m,w),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:g,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:k/u$2(e.size),markerPlacement:i,animatedSymbolProperties:n};p.push(X);}function Z(e,t){return {type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}function ee(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(!isNaN(t))return t}return 0}function te(t){if(!t||0===t.length)return null;const i=new l(t).toRgba();return {r:i[0],g:i[1],b:i[2],a:i[3]}}function ie(e,t,i,o,r,n,l){const a=t[e];if(a){const e=a[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return n?n.call(null,e,l):e;if(null!=e&&e instanceof o$3)return (t,i,a)=>{let s=s$3(e,t,{$view:a},o.geometryType,i);return null!==s&&n&&(s=n.call(null,s,l)),null!==s?s:r}}return r}function oe(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e}function re(e,i,o,r){for(const t of i){if(t.valueExpressionInfo){const e=o[t.primitiveName]&&o[t.primitiveName][t.propertyName];e instanceof o$3&&(t.fn=(t,i,o)=>s$3(e,t,{$view:o},r.geometryType,i));}}return (o,r,n)=>{for(const e of i)e.fn&&(e.value=e.fn(o,r,n));const l=[];for(let a of e){const e=a?.primitiveName;if(e){let o=!1;for(const r of i)if(r.primitiveName===e){const e=oe(r.propertyName);null!=r.value&&r.value!==a[e]&&(o||(a=y$2(a),o=!0),a[e]=r.value);}}l.push(a);}return l}}function ne(e,i,o,r){const n=[];if(te$1.findApplicableOverrides(e,i,n),0===n.length)return e;for(const t of n){if(t.valueExpressionInfo){const e=o[t.primitiveName]&&o[t.primitiveName][t.propertyName];e instanceof o$3&&(t.fn=(t,i,o)=>s$3(e,t,{$view:o},r.geometryType,i));}}return (i,o,r)=>{for(const e of n)e.fn&&(e.value=e.fn(i,o,r));const l=y$2(e),a=e.primitiveName;for(const e of n)if(e.primitiveName===a){const t=oe(e.propertyName);null!=e.value&&e.value!==l[t]&&(l[t]=e.value);}return l}}function le(e,i,o,r){const n=[];if(te$1.findApplicableOverrides(e,i,n),0===n.length)return e;for(const t of n){if(t.valueExpressionInfo){const e=o[t.primitiveName]&&o[t.primitiveName][t.propertyName];e instanceof o$3&&(t.fn=(t,i,o)=>s$3(e,t,{$view:o},r.geometryType,i));}}return (i,o,r)=>{for(const e of n)e.fn&&(e.value=e.fn(i,o,r));const l=y$2(e),a=e.primitiveName;for(const e of n)if(e.primitiveName===a){const t=oe(e.propertyName);null!=e.value&&e.value!==l[t]&&(l[t]=e.value);}return l}}function ae(e,t,i,o){for(const r of i){if(r.valueExpressionInfo){const e=t[r.primitiveName]&&t[r.primitiveName][r.propertyName];e instanceof o$3&&(r.fn=(t,i,r)=>s$3(e,t,{$view:r},o.geometryType,i));}}return (t,o,r)=>{for(const e of i)e.fn&&(e.value=e.fn(t,o,r));return c$4(e+te$1.buildOverrideKey(i)).toString()}}function se(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return te$1.applyOverrides(i,t),i}function ce(e,t,i,r,n){let l=!1,a="";for(const o of e)o.primitiveName===t&&(void 0!==o.value?a+=`-${o.primitiveName}-${o.propertyName}-${JSON.stringify(o.value)}`:o.valueExpressionInfo&&(l=!0));return r$3(i)&&"function"==typeof i&&(l=!0),r$3(r)&&"function"==typeof r&&(l=!0),r$3(n)&&"function"==typeof n&&(l=!0),[l,a]}function fe(e,t,i){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const o=e.symbolLayers;if(!o)return;for(const e of o)switch(ue(e,t,i),e.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in e&&e.url&&i.push(t.fetchResource(e.url,null));break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)continue;for(const e of o)if(e){const o=e.symbol;o&&fe(o,t,i);}}}}}}const me=e=>e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&!e[0].effects&&!e[1].effects;let pe;function ue(e,t,i){if(!e.effects||r$3(t.geometryEngine))return;if(pe)return void i.push(pe);p(e.effects)&&(pe=C(),i.push(pe),pe.then((e=>t.geometryEngine=e)));}

export { Y, a, e, f, n$1 as n, o, r$1 as r, se as s };
