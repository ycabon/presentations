import { n as n$2 } from './deduplicate-dd3c0590.js';
import { T } from './InterleavedLayout-30cd523e.js';
import { O } from './VertexAttribute-f7d7a686.js';
import { o } from './glUtil-2dc26fa6.js';
import { eZ as M, mM as p$3, mN as n, aA as o$1, e8 as r$1, dt as P, dw as _, fg as l$1, eR as H, du as e$1, dv as z, ay as n$1, eg as x, bT as t$1, eT as u$3 } from './_virtual_index-a68dd1ed.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const A$1=T().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),e=T().vec2u8(O.SIDENESS);o(e);const E=T().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),S=E.clone().vec3f(O.NORMAL),r=E.clone().vec3f(O.NORMALA).vec3f(O.NORMALB);new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const p$2=-1;var u$2;function h$1(n$1,i,l,f=N){const g=n$1.vertices.position,m=n$1.vertices.componentIndex,u=M(f.anglePlanar),h=M(f.angleSignificantEdge),V=Math.cos(h),S=Math.cos(u),j=I.edge,x$1=j.position0,E=j.position1,D=j.faceNormal0,F=j.faceNormal1,L=y$1(n$1),U=w$1(n$1),b=U.length/4,k=i.allocate(b);let C=0;const H=b,K=l.allocate(H);let M$1=0,O=0,P$1=0;const T=p$3(0,b),q=new Float32Array(b);n(q,((e,t,n)=>{g.getVec(U[4*t+0],x$1),g.getVec(U[4*t+1],E),n[t]=x(x$1,E);})),T.sort(((e,t)=>q[t]-q[e]));const z=new Array,B=new Array;for(let e=0;e<b;e++){const t=T[e],n=q[t],o=U[4*t+0],r=U[4*t+1],f=U[4*t+2],h=U[4*t+3],w=h===p$2;if(g.getVec(o,x$1),g.getVec(r,E),w)o$1(D,L[3*f+0],L[3*f+1],L[3*f+2]),r$1(F,D),j.componentIndex=m.get(o),j.cosAngle=P(D,F);else {if(o$1(D,L[3*f+0],L[3*f+1],L[3*f+2]),o$1(F,L[3*h+0],L[3*h+1],L[3*h+2]),j.componentIndex=m.get(o),j.cosAngle=P(D,F),A(j,S))continue;j.cosAngle<-.9999&&r$1(F,D);}O+=n,P$1++,w||v(j,V)?(i.write(k,C++,j),z.push(n)):d$2(j,u)&&(l.write(K,M$1++,j),B.push(n));}const G=new Float32Array(z.reverse()),J=new Float32Array(B.reverse());return {regular:{instancesData:i.trim(k,C),lodInfo:{lengths:G}},silhouette:{instancesData:l.trim(K,M$1),lodInfo:{lengths:J}},averageEdgeLength:O/P$1}}function v(e,t){return e.cosAngle<t}function A(e,t){return e.cosAngle>t}function d$2(e,t){const o=l$1(e.cosAngle),r=I.fwd,s=I.ortho;H(r,e.position1,e.position0);return o*(P(_(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function w$1(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let r=0;for(let a=0;a<t;a++){const e=o[3*a+0],t=o[3*a+1],s=o[3*a+2],c=n[3*a+0],i=n[3*a+1],l=n[3*a+2];r+=e===p$2||c<i?1:0,r+=t===p$2||i<l?1:0,r+=s===p$2||l<c?1:0;}const s=new Int32Array(4*r);let c=0;for(let a=0;a<t;a++){const e=o[3*a+0],t=o[3*a+1],r=o[3*a+2],i=n[3*a+0],l=n[3*a+1],f=n[3*a+2];(e===p$2||i<l)&&(s[c++]=i,s[c++]=l,s[c++]=a,s[c++]=e),(t===p$2||l<f)&&(s[c++]=l,s[c++]=f,s[c++]=a,s[c++]=t),(r===p$2||f<i)&&(s[c++]=f,s[c++]=i,s[c++]=a,s[c++]=r);}return s}function y$1(e){const t=e.faces.length/3,n=e.vertices.position,o=e.faces,r=V.v0,s=V.v1,c=V.v2,a=new Float32Array(3*t);for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],m=o[3*i+2];n.getVec(e,r),n.getVec(t,s),n.getVec(m,c),e$1(s,s,r),e$1(c,c,r),_(r,s,c),z(r,r),a[3*i+0]=r[0],a[3*i+1]=r[1],a[3*i+2]=r[2];}return a}!function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH";}(u$2||(u$2={}));const I={edge:{position0:n$1(),position1:n$1(),faceNormal0:n$1(),faceNormal1:n$1(),componentIndex:0,cosAngle:0},ortho:n$1(),fwd:n$1()},V={v0:n$1(),v1:n$1(),v2:n$1()},N={anglePlanar:4,angleSignificantEdge:35};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function t(t,o,n){const r=o/3,c=new Uint32Array(n+1),e=new Uint32Array(n+1),s=(t,o)=>{t<o?c[t+1]++:e[o+1]++;};for(let x=0;x<r;x++){const o=t[3*x],n=t[3*x+1],r=t[3*x+2];s(o,n),s(n,r),s(r,o);}let f=0,l=0;for(let x=0;x<n;x++){const t=c[x+1],o=e[x+1];c[x+1]=f,e[x+1]=l,f+=t,l+=o;}const i=new Uint32Array(6*r),a=c[n],w=(t,o,n)=>{if(t<o){const r=c[t+1]++;i[2*r]=o,i[2*r+1]=n;}else {const r=e[o+1]++;i[2*a+2*r]=t,i[2*a+2*r+1]=n;}};for(let x=0;x<r;x++){const o=t[3*x],n=t[3*x+1],r=t[3*x+2];w(o,n,x),w(n,r,x),w(r,o,x);}const y=(t,o)=>{const n=2*t,r=o-t;for(let c=1;c<r;c++){const t=i[n+2*c],o=i[n+2*c+1];let r=c-1;for(;r>=0&&i[n+2*r]>t;r--)i[n+2*r+2]=i[n+2*r],i[n+2*r+3]=i[n+2*r+1];i[n+2*r+2]=t,i[n+2*r+3]=o;}};for(let x=0;x<n;x++)y(c[x],c[x+1]),y(a+e[x],a+e[x+1]);const A=new Int32Array(3*r),U=(o,n)=>o===t[3*n]?0:o===t[3*n+1]?1:o===t[3*n+2]?2:-1,u=(t,o)=>{const n=U(t,o);A[3*o+n]=-1;},p=(t,o,n,r)=>{const c=U(t,o);A[3*o+c]=r;const e=U(n,r);A[3*r+e]=o;};for(let x=0;x<n;x++){let t=c[x];const o=c[x+1];let n=e[x];const r=e[x+1];for(;t<o&&n<r;){const o=i[2*t],r=i[2*a+2*n];o===r?(p(x,i[2*t+1],r,i[2*a+2*n+1]),t++,n++):o<r?(u(x,i[2*t+1]),t++):(u(r,i[2*a+2*n+1]),n++);}for(;t<o;)u(x,i[2*t+1]),t++;for(;n<r;){u(i[2*a+2*n],i[2*a+2*n+1]),n++;}}return A}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class a$1{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?f$1:p$1;}write(t,o,e){const n=this.edgeHashFunction(e);W.seed=n;const i=W.getIntRange(0,255),r=W.getIntRange(0,this.settings.variants-1),s=.7,a=W.getFloat(),c=255*(.5*g$1(-(1-Math.min(a/s,1))+Math.max(0,a-s)/(1-s),1.2)+.5);t.position0.setVec(o,e.position0),t.position1.setVec(o,e.position1),t.componentIndex.set(o,e.componentIndex),t.variantOffset.set(o,i),t.variantStroke.set(o,r),t.variantExtension.set(o,c);}trim(t,o){return t.slice(0,o)}}const c=new Float32Array(6),m=new Uint32Array(c.buffer),u$1=new Uint32Array(1);function p$1(t){const o=c;o[0]=t.position0[0],o[1]=t.position0[1],o[2]=t.position0[2],o[3]=t.position1[0],o[4]=t.position1[1],o[5]=t.position1[2],u$1[0]=5381;for(let e=0;e<m.length;e++)u$1[0]=31*u$1[0]+m[e];return u$1[0]}function f$1(t){const o=c;o[0]=h(t.position0[0]),o[1]=h(t.position0[1]),o[2]=h(t.position0[2]),o[3]=h(t.position1[0]),o[4]=h(t.position1[1]),o[5]=h(t.position1[2]),u$1[0]=5381;for(let e=0;e<m.length;e++)u$1[0]=31*u$1[0]+m[e];return u$1[0]}const l=1e4;function h(t){return Math.round(t*l)/l}function g$1(t,o){const e=t<0?-1:1;return Math.abs(t)**o*e}class d$1{constructor(){this.commonWriter=new a$1;}updateSettings(t){this.commonWriter.updateSettings(t);}allocate(t){return S.createBuffer(t)}write(t,n,i){this.commonWriter.write(t,n,i),u$3(y,i.faceNormal0,i.faceNormal1),z(y,y),t.normal.setVec(n,y);}trim(t,o){return this.commonWriter.trim(t,o)}}d$1.Layout=S,d$1.glLayout=o(S,1);class w{constructor(){this.commonWriter=new a$1;}updateSettings(t){this.commonWriter.updateSettings(t);}allocate(t){return r.createBuffer(t)}write(t,o,e){this.commonWriter.write(t,o,e),t.normalA.setVec(o,e.faceNormal0),t.normalB.setVec(o,e.faceNormal1);}trim(t,o){return this.commonWriter.trim(t,o)}}w.Layout=r,w.glLayout=o(r,1);const y=n$1(),W=new t$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function f(e){const t=u(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return g.updateSettings(e.writerSettings),p.updateSettings(e.writerSettings),h$1(t,g,p)}function u(r,i,n,o){if(i){return {faces:n,facesLength:o,neighbors:t(n,o,r.count),vertices:r}}const c=n$2(r.buffer,r.stride/4,{originalIndices:n,originalIndicesLength:o}),f=t(c.indices,o,c.uniqueCount);return {faces:c.indices,facesLength:c.indices.length,neighbors:f,vertices:A$1.createView(c.buffer)}}const g=new d$1,p=new w,d=T().vec3f(O.POSITION0).vec3f(O.POSITION1),a=T().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});

export { A$1 as A, a, d, f, h$1 as h, u };
