import { u as e$2, y as y$3, z as n$3, A as m$3, bD as j$3, gC as u$2, aB as f$1, b7 as l$2, m as r$4, gD as a$5, eq as n$4, t as t$2, fQ as G$4, eN as h$3, gE as b$3, gF as i$4, fu as ue, aE as r$5, g5 as v$2, gG as l$3, fJ as A$3, bt as s$3, d3 as o$2, bv as n$5, bo as i$5, gH as d$4, aK as n$6, dA as s$4, gI as e$3, gJ as i$6, gK as E$1, gL as a$6, f1 as v$3, b1 as n$7, dR as r$6, gM as o$3, gN as D$2, fV as a$7, gO as t$3, aO as o$4, gP as O, L as e$4, gQ as f$2, g0 as u$4, bn as g$2, gR as H, gS as s$5, gT as T$4, gU as m$4, gV as A$4, gW as M$7, gX as r$7, gY as xn, gZ as i$7, g_ as h$4, g$ as x$4, eZ as s$6, f8 as r$8, h0 as u$5, h1 as m$5, b8 as h$5, es as s$7, h2 as f$3, h3 as t$4, gb as m$6, h4 as o$6, gm as jn, h5 as Z$1, h6 as gn, h7 as w$2, bC as t$5, h8 as Z$2, h9 as B$2, ha as x$5, hb as c$4, hc as f$4, hd as t$6, he as R$2, hf as u$6, hg as g$4, bp as r$9, hh as q$3, ck as l$4, hi as m$7, hj as n$8, hk as e$5, f3 as d$7, hl as E$2, hm as X, hn as C$6, ho as U$3, eE as e$6, eF as z$1, eD as P$4, eG as _$3, hp as c$5, hq as b$4, hr as i$8, hs as q$4, bb as a$8, B as has, bl as f$5, be as a$9, e9 as j$4, eT as p$4, ht as i$9, hu as P$6, eV as g$5, eX as w$3, ga as Y$1, g1 as _$4, fY as p$6, fZ as H$1, hv as t$8, hw as x$6, gq as v$6, eY as d$8, gi as h$8, hx as d$9, hy as o$7, hz as s$8, hA as T$6, hB as v$7, eP as A$7, hC as t$9, hD as H$2, e1 as $, hE as u$8, ev as m$a, eS as c$7, hF as m$b, hG as l$7, hH as U$4, b5 as A$8, d8 as i$b, hI as f$6, fU as e$9, hJ as t$a, hK as r$c, gx as b$5, hL as k$2, hM as p$7, hN as p$8, hO as b$6, hP as n$a, hQ as g$6, hR as l$8, e_ as l$9, bk as w$4, hS as T$7, hT as f$7, ge as w$5, hU as G$8, hV as t$d, g6 as j$6, hW as f$8, hX as M$9, ew as o$8, hY as H$3, gn as q$5, gu as Z$3, hZ as X$2, h_ as q$6, fP as r$d, h$ as d$a, i0 as d$b, i1 as s$a, i2 as m$c } from './_virtual_index-1ea2035a.js';
import { x as x$2, y as y$5, j as j$5, a as a$c, c as c$8, p as p$9 } from './quantityFormatUtils-d7b5c624.js';
import { x as x$3 } from './TextOverlayItem-24d2f827.js';
import { d as d$3, a as a$b, b as m$8, e as e$8, m as m$9, l as l$6, g as g$7 } from './automaticLengthMeasurementUtils-ee98e9f2.js';
import { _ as _$1, a as _$2, y as y$4, G as G$5, r as r$a } from './VerticesVisualElement-cdf1199e.js';
import { u as u$3, d as d$5, S as S$4 } from './PointVisualElement-12207533.js';
import { Z, C as C$4, q as q$2, c as c$3, o as o$5 } from './drawSurfaces-232145d5.js';
import { i as ie, A as A$5, N as N$3, I as I$1, C as C$8, z as z$2, R as R$3 } from './manipulatorUtils-81641492.js';
import { t as t$7 } from './manipulatorUtils-70b4d4ba.js';
import { N as N$2, G as G$7, h as h$7, T as T$5, F, P as P$8, C as C$9, o as o$9 } from './Factory-11dfe060.js';
import { h as h$6, M as M$8, d as d$6, C as C$5, g as g$3, U as U$2, G as G$6, P as P$5, p as p$3, v as v$4, D as D$3, X as X$1 } from './dragEventPipeline-b225d16a.js';
import { C as C$7 } from './GraphicManipulator-dab088a1.js';
import { V as V$3, A as A$6, P as P$7, E as E$3, t as t$b, a as t$c, s as s$9, c as c$9, e as e$a } from './EditGeometryOperations-2f1c7df5.js';
import { e as e$7 } from './SnappingContext-a1ff8c28.js';
import { u as u$7 } from './SnappingOperation-e299c5a9.js';
import { r as r$b, p as p$5, a as a$a, l as l$5, c as c$6, n as n$9 } from './TranslateTooltipInfos-6a2dddcf.js';
import { v as v$5, x as x$7, D as D$4 } from './euclideanLengthMeasurementUtils-93ea014d.js';
import { i as i$a } from './automaticAreaMeasurementUtils-4f3d1b01.js';
import { s as se, o as oe, _ as _e, A as Ae, u as ue$1, M as Me, L as Le, r as re, q as qt, R as Re$1, B as Bt, K as Kt, J as Jt } from './sliceToolUtils-fb65526f.js';
import { i as i$c, p as p$a } from './ExtentTooltipInfos-bc73e71a.js';
import './geometryEngine-d05be472.js';
import './geometryEngineBase-16bf8893.js';
import './hydrated-40740f3e.js';
import './LineVisualElement-e2d301b0.js';
import './RightAngleQuadVisualElement-9584f4cd.js';
import './dehydratedFeatureComparison-73cd17db.js';
import './ImageMaterial-26ca33d0.js';
import './drawUtils-716bb6e9.js';
import './drapedUtils-fff0739e.js';
import './PointSnappingHint-71b3a4f1.js';
import './measurementUtils-d2a749ce.js';
import './euclideanAreaMeasurementUtils-01fe08b0.js';
import './persistable-2efd2972.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const S$3=3025,w$1={default:15,far:25};let P$3=class extends m$3{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0;}initialize(){const e=j$3((async e=>{const t=await u$2("esri/core/t9n/Units");f$1(e),this._messagesUnits=t;})),t=()=>o$2(this.context,(e=>e.editGeometryOperations));this.addHandles([l$2((()=>[r$4(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>a$5(t,e,(()=>this._update())))),n$4((()=>e.abort()))]);}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop());}get updating(){return t$2(this._messagesUnits)}get test(){return {labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return w$1[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if(t$2(e))return void this._destroyUnusedLabels();const{components:t,geometry:s,coordinateHelper:o}=e.editGeometryOperations.data;if(!s)return void this._destroyUnusedLabels();const a=t.length;for(let i=0;i<a;++i){const n=[];if(t[i].iterateVertices((e=>{n.push(o.toXYZ(e.pos));})),0===i&&r$4(this.stagedVertex)&&n.push(o.toXYZ(this.stagedVertex)),n.length<2)continue;const l=n[0],c=n[n.length-1];"polygon"===s.type&&n.length>2&&!G$4(l,c)&&n.push(l);const p=1===a&&!h$3(n,!1,!1);let h=C$3,d=G$3;this.toScreenPointArray(e,l,h);for(let t=1;t<n.length;++t){const s=n[t-1],o=n[t];this.toScreenPointArray(e,o,d),this._addLabel(e,s,h,o,d,p),[h,d]=[d,h];}}this._destroyUnusedLabels();}_addLabel(e,t,s,o,i,a){const{label:n}=this._getOrCreateLabel(e);if(!this.visible||b$3(s,i)<S$3)return void(n.visible=!1);const c=r$4(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":i$4(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:p}=e.editGeometryOperations.data,h=d$3(t,o,p,c),m=this._messagesUnits,u=ue(e.view);n.text=r$4(m)&&r$4(h)?x$2(m,h,u):"",n.visible=!0;const v=i[0]-s[0],j=i[1]-s[1];a?r$5(V$2,-j,v):r$5(V$2,j,-v),v$2(V$2,V$2),l$3(V$2,V$2,this._edgeDistancePixels),A$3(k$1,s,i,.5),s$3(k$1,k$1,V$2),n.position=[k$1[0],k$1[1]],Math.abs(V$2[0])>Math.abs(V$2[1])?n.anchor=V$2[0]>0?"left":"right":n.anchor=-V$2[1]<0?"top":"bottom";}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new x$3({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const s={label:t};return this._labelInfos.push(s),this._nextLabelIndex=this._labelInfos.length,s}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop());}_destroyLabel({label:e}){o$2(this.context,(t=>t.view.overlay.items.remove(e))),e.destroy();}};e$2([y$3()],P$3.prototype,"context",void 0),e$2([y$3()],P$3.prototype,"stagedVertex",void 0),e$2([y$3()],P$3.prototype,"visible",void 0),e$2([y$3()],P$3.prototype,"edgeDistance",void 0),e$2([y$3()],P$3.prototype,"updating",null),e$2([y$3()],P$3.prototype,"_messagesUnits",void 0),e$2([y$3()],P$3.prototype,"_edgeDistancePixels",null),P$3=e$2([n$3("esri.views.interactive")],P$3);const V$2=n$5(),k$1=n$5(),C$3=i$5(),G$3=i$5();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let a$4=class extends P$3{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:o},s,a=i$5()){const{spatialReference:m}=o.data.coordinateHelper;return d$4(s,m,t,e,c$2),e.state.camera.projectToScreen(c$2,a),a}};a$4=e$2([n$3("esri.views.3d.interactive.SegmentLabels3D")],a$4);const c$2=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class h$2{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1;}destroy(){this._destroyResources();}get resources(){return r$4(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer());}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources());}recreate(){this.attached&&this._createResources();}recreateGeometry(){this._resourceFactory.recreateGeometry?t$2(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate();}_createOrDestroyResources(){this._attached?t$2(this._resources)&&this._createResources():this._destroyResources();}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),r=new n$2({view:this._resourceFactory.view}),s=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new n$2({view:this._resourceFactory.view}),external:e,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(r)),this._syncGeometriesToRenderer();}_destroyResources(){if(t$2(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null;}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved();}_ensureRenderGeometriesRemoved(){if(t$2(this._resources)||t$2(this._resources.drapeSourceRenderer))return;if(!this._resources.geometriesAdded)return;this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,E$1.UPDATE),this._resources.geometriesAdded=!1;}_ensureRenderGeometriesAdded(){if(t$2(this._resources)||t$2(this._resources.drapeSourceRenderer))return;if(this._resources.geometriesAdded)return;this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,E$1.UPDATE),this._resources.geometriesAdded=!0;}}let n$2=class extends(s$4(m$3)){constructor(e){super(e),this.drapeSourceType=e$3.Features,this.updatePolicy=i$6.SYNC;}};e$2([y$3({constructOnly:!0})],n$2.prototype,"view",void 0),e$2([y$3({readOnly:!0})],n$2.prototype,"drapeSourceType",void 0),n$2=e$2([n$3("DrapedVisualElementLayerView")],n$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class S$2{constructor(t){this.view=null,this._attachmentOrigin=v$3(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new n$7,this._isDraped=!1,this._geometry=null,this._width=1,this._color=r$6(1,0,1,1),this._innerWidth=0,this._innerColor=r$6(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=o$3.OccludeAndTransparentStencil,this._resources=new u$3({view:t.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this._drapedResources=new h$2({view:t.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged();}});let r=!0;this._laserline=new d$5({view:t.view});for(const e in t)e in this?"attached"===e?r=t[e]:this[e]=t[e]:console.error("Cannot set unknown property",e);this.attached=r;}destroy(){this._resources.destroy(),this._drapedResources.destroy(),this._laserline.destroy();}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this._laserlineAttached);}get _laserlineAttached(){return this.attached&&this.visible&&r$4(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e,this._drapedResources.visible=e,this._laserline.attached=this._laserlineAttached;}get attached(){return this._resources.attached||this._drapedResources.attached}set attached(e){this._updateAttached(e);}_updateAttached(e){this._resources.attached=!this.isDraped&&e,this._drapedResources.attached=this.isDraped&&e,this._laserline.attached=this._laserlineAttached,this.attached&&this._attachmentOriginChanged();}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry(),this._drapedResources.recreateGeometry();}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial());}get color(){return this._color}set color(e){D$2(e,this._color)||(a$7(this._color,e),this._updateMaterial());}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial());}get innerColor(){return this._innerColor}set innerColor(e){D$2(e,this._innerColor)||(a$7(this._innerColor,e),this._updateMaterial());}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const r=r$4(e)!==r$4(this._stipplePattern);this._stipplePattern=e,r?this._resources.recreate():this._updateMaterial();}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&D$2(e,this._stippleOffColor)||(this._stippleOffColor=e?t$3(e):null,this._updateMaterial());}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial());}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources.recreateGeometry();}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,r$4(e)&&(this._laserline.style=e);}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached);}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial());}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=r$4(this._resources.resources)?this._resources.resources.geometries:null;if(!e||0===e.length)return null;o$4(W,0,0,0);let s=0;for(const t of e){const e=t.vertexAttributes.get(O.POSITION),i=t.indices.get(O.POSITION),n=e$4(this._resources.resources).material.isClosed(e.data,i);f$2(e,i,n,T$3)&&(u$4(W,W,T$3),s++);}return 0===s?null:(g$2(W,W,1/s),this.view.renderCoordsHelper.fromRenderCoords(W,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){r$4(this._resources.resources)&&this._resources.resources.material.setParameters(this._materialParameters),r$4(this._drapedResources.resources)&&this._drapedResources.resources.material.setParameters(this._materialParameters);}get _isClosed(){return r$4(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return {width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===o$3.OccludeAndTransparentStencil?o$3.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){const s=this._createRenderGeometries();for(const i of s)e.addGeometry(i,t),r.push(i);this._attachmentOriginChanged();}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed");}_createResources(e){const t=new H(this._materialParameters),r=[];return this._recreateGeometry(e,t,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e);}}}_createDrapedResources(){const e=new H(this._materialParameters);return {material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(t$2(t)||t$2(this.view.basemapTerrain.spatialReference))return [];const r=s$5(t,this.view.basemapTerrain.spatialReference),i=[];for(const{position:s}of r.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed},r=new T$4(m$4(t),e),a=A$4(M$6);M$7(a,s),r$7(r.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),i.push(r);}return i}calculateMapBounds(e){if(t$2(this._resources.resources))return !1;const t=this.view.renderCoordsHelper;for(const r of this._resources.resources.geometries){const s=r.vertexAttributes.get(O.POSITION),i=new Float64Array(s.data.length);xn(s.data,t.spatialReference,0,i,this.view.spatialReference,0,s.data.length/3),M$7(e,i);}return !0}_createRenderGeometries(){const e=this.geometry;if(t$2(e))return [];const t=i$7(e,this.view.elevationProvider,this.view.renderCoordsHelper,h$4.fromElevationInfo(this.elevationInfo??new x$4({mode:i$4(e,null)}))),r=[],i=[];for(const{position:s,mapPosition:a}of t.lines){const e={attributeData:{position:s,mapPosition:a},removeDuplicateStartEnd:this._isClosed};r.push(m$4(e)),i.push(s);}return this._laserline.pathVerticalPlane=i,r}}const M$6=a$6(),T$3=n$6(),W=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let e$1=class extends n$7.EventedAccessor{constructor(r){super(r),this.tracking=!1,this.displaying=!1,this.isDraped=!1;}};e$2([y$3({constructOnly:!0})],e$1.prototype,"graphic",void 0),e$2([y$3()],e$1.prototype,"tracking",void 0),e$2([y$3()],e$1.prototype,"displaying",void 0),e$2([y$3()],e$1.prototype,"isDraped",void 0),e$1=e$2([n$3("esri.views.3d.layers.graphics.GraphicState")],e$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let T$2=class extends Z{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d";}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new x$4({mode:e,offset:t});}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return {...e,elevationInfo:s$6(t)}}return e}initializeGraphic(e){const i=this._createGraphicState=new e$1({graphic:e});return r$8([this.view.maskOccludee(e),this.view.trackGraphicState(i),l$2((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(({element:e,isDraped:t})=>{o$2(e,(e=>e.isDraped=t));}),h$5)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new C$4({view:this.view,manipulators:this.manipulators,geometryType:q$2(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new c$3(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new o$5(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new _$1,segmentLabels:t?new a$4:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:r$4(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===u$5(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){const{view:t}=this;return r$4(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null):(this._activeVertexVisualElement=new _$2({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y$4.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=y$4.colorToVec4(y$4.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new G$5({view:t,extensionType:y$4.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:o$3.OccludeAndTransparent}),y$4.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),n$4((()=>{this._activeVertexVisualElement=s$7(this._activeVertexVisualElement),this._verticalLineVisualElement=s$7(this._verticalLineVisualElement);})))}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(t$2(t))return;const{renderCoordsHelper:i,spatialReference:s,elevationProvider:r}=this.view;o$4(M$5,e[0],e[1],e[2]),b$2.setFromElevationInfo(this.elevationInfo),M$5[2]=m$5(M$5,r,b$2,i);i.toRenderCoords(M$5,s,M$5)?(t.setStartEndFromWorldDownAtLocation(M$5),t.attached=!0):t.attached=!1;}onOutlineChanged(e){if(r$4(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new S$2({view:this.view,geometry:e,elevationInfo:t,isDraped:r$4(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===u$5(this.hasZ,t),attached:!1}),y$4.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),y$4.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,n$4((()=>{this._outlineVisualElement=s$7(this._outlineVisualElement);}))}onRegularVerticesChanged(e){return r$4(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new _$2({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y$4.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,n$4((()=>{this._verticesVisualElement=s$7(this._verticesVisualElement);})))}};e$2([y$3({constructOnly:!0})],T$2.prototype,"elevationInfo",void 0),e$2([y$3({constructOnly:!0})],T$2.prototype,"geometryType",void 0),e$2([y$3()],T$2.prototype,"type",void 0),e$2([y$3({constructOnly:!0})],T$2.prototype,"view",void 0),T$2=e$2([n$3("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],T$2);const b$2=new h$4,M$5=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var N$1;!function(N){N[N.NONE=0]="NONE",N[N.ANY=1]="ANY",N[N.Z=2]="Z",N[N.XY=4]="XY";}(N$1||(N$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var A$2;!function(A){A[A.TRANSLATE_Z=0]="TRANSLATE_Z",A[A.TRANSLATE_XY=1]="TRANSLATE_XY",A[A.SCALE=2]="SCALE",A[A.ROTATE=3]="ROTATE",A[A.SCALE_ROTATE=4]="SCALE_ROTATE";}(A$2||(A$2={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class a$3{constructor(){this.grabbingState=N$1.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null;}update(a){this.grabbingState=N$1.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,a.forEachManipulator(((a,s)=>{if(s===A$2.TRANSLATE_Z&&(this.zManipulator=a),a instanceof ie&&(a.selected&&(0===this.numSelected&&(this.firstSelected=a),this.numSelected++),t$2(this.firstGrabbedXY)&&a.grabbing&&s===A$2.TRANSLATE_XY&&(this.firstGrabbedXY=a)),a.grabbing)switch(this.grabbingState|=N$1.ANY,s){case A$2.TRANSLATE_Z:this.grabbingState|=N$1.Z;break;case A$2.TRANSLATE_XY:this.grabbingState|=N$1.XY;}}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function b$1(t){const{view:a,graphic:n}=t,i=new e$1({graphic:n}),l=j$2(t,i),r=[l,S$1(t,l.visualElement,i),a.maskOccludee(n),a.trackGraphicState(i)];return {visualElement:l.visualElement,remove:()=>r$8(r).remove()}}function j$2(a,n){const{view:i,graphic:r}=a,o=new S$2({view:i,geometry:L$1(r)?r.geometry:null,elevationInfo:f$3(r),attached:!1});y$4.visualElements.lineGraphics.shadowStyle.apply(o);const s=()=>{o.attached=n.displaying;};y$4.visualElements.lineGraphics.outline.apply(o);const p=[l$2((()=>n.displaying),s),l$2((()=>n.isDraped),(e=>{o.isDraped=e;})),n.on("changed",(()=>o.geometry=L$1(r)?r.geometry:null)),t$4(o)];return s(),{visualElement:o,remove:()=>r$8(p).remove()}}function S$1(i,r,o){const{graphic:s,view:p}=i,m=[],d=f$3(s),y="on-the-ground"===d.mode||!d.offset&&"absolute-height"!==d.mode,E=new a$3,b=new G$5({view:p,extensionType:y$4.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:o$3.OccludeAndTransparent});y$4.visualElements.pointGraphics.shadowStyle.apply(b);const j=m$6(y$4.visualElements.heightPlaneAngleCutoff),S=new d$5({view:p,attached:!1,angleCutoff:j});y$4.visualElements.heightPlane.apply(S);let T=1,A=1;const D=()=>{if(E.update(i),!o.displaying||y&&(o.isDraped||!L$1(s)||!s.geometry.hasZ))return r.laserlineEnabled=!1,b.attached=!1,void(S.attached=!1);r.laserlineEnabled=!0;{const e=E.grabbingState&N$1.XY?y$4.visualElements.laserlineAlphaMultiplier:1;e!==T&&(T=e,y$4.visualElements.lineGraphics.shadowStyle.apply(r,e),y$4.visualElements.pointGraphics.shadowStyle.apply(b,e));}{const e=E.grabbingState&N$1.Z?y$4.visualElements.laserlineAlphaMultiplier:1;e!==A&&(A=e,y$4.visualElements.heightPlane.apply(S,e));}M$4(b,E),G$2(i,r,S,E);};y$4.visualElements.zVerticalLine.apply(b),m.push(o.on("changed",D),l$2((()=>o.displaying),D),r.events.on("attachment-origin-changed",D),t$4(b),t$4(S));const C=[],O=()=>{r$8(C).remove(),C.length=0,i.forEachManipulator((e=>C.push(e.events.on("grab-changed",D)))),i.forEachManipulator((e=>C.push(e.events.on("select-changed",D)))),D();};return O(),m.push(i.onManipulatorsChanged(O),o$6((()=>r$8(C)))),r$8(m)}function M$4(e,t){const a=1===t.numSelected?t.firstSelected:t.numSelected>1&&r$4(t.firstGrabbedXY)?t.firstGrabbedXY:null;r$4(a)?(e.setStartEndFromWorldDownAtLocation(a.renderLocation),e.attached=!0):e.attached=!1;}function G$2(e,t,a,n){if(n.numSelected>0){o$4(T$1,0,0,0);let t=0;e.forEachManipulator(((e,a)=>{a===A$2.TRANSLATE_XY&&e.selected&&e instanceof ie&&(u$4(T$1,T$1,e.renderLocation),t++);})),t>0?(a.heightManifoldTarget=g$2(T$1,T$1,1/t),a.attached=!0):a.attached=!1;}else {const n=t.attachmentOrigin;r$4(n)&&e.view.renderCoordsHelper.toRenderCoords(n,T$1)?(a.heightManifoldTarget=T$1,a.attached=!0):a.attached=!1;}}function L$1(e){return r$4(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const T$1=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function M$3(t){const{view:n,graphic:i}=t,o=new e$1({graphic:i}),a=[],r=C$2(t,o,a);return P$2(t,o,a,r),a.push(n.trackGraphicState(o)),{visualElement:r,remove(){r$8(a).remove();}}}function P$2(e,n,s,p){const{view:m,graphic:u}=e,f=new G$5({view:m,extensionType:y$4.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:o$3.OccludeAndTransparent});y$4.visualElements.zVerticalLine.apply(f);const b=new d$5({view:m,intersectsLineInfinite:!0,attached:!1});y$4.visualElements.pointGraphics.shadowStyle.apply(b);const A=m$6(y$4.visualElements.heightPlaneAngleCutoff),M=new d$5({view:m,attached:!1,angleCutoff:A});y$4.visualElements.heightPlane.apply(M);const P=f$3(e.graphic),C=h$4.fromElevationInfo(P),R="on-the-ground"===P.mode||!P.offset&&"absolute-height"!==P.mode,U=new a$3;let D=1,I=1;const T=()=>{U.update(e);const t=G$1(u),i=R&&(n.isDraped||t$2(t)||!t.hasZ);let r=!0;if(!i&&r$4(t)){const e=m$5(t,m.elevationProvider,C,m.renderCoordsHelper);o$4(V$1,t.x,t.y,e),jn(V$1,t.spatialReference,V$1,m.renderCoordsHelper.spatialReference),f.setStartEndFromWorldDownAtLocation(V$1),b.intersectsWorldUpAtLocation=V$1;}else r=!1;const s=U.grabbingState&N$1.Z?y$4.visualElements.laserlineAlphaMultiplier:1;s!==D&&(D=s,y$4.visualElements.heightPlane.apply(M,s));const g=A$4(B$1);!i&&n.displaying&&p.calculateMapBounds(g)&&jn(Z$1(g,V$1),m.spatialReference,V$1,m.renderCoordsHelper.spatialReference)?(M.heightManifoldTarget=V$1,M.attached=!0):M.attached=!1;const y=U.grabbingState&N$1.XY?y$4.visualElements.laserlineAlphaMultiplier:1;y!==I&&(I=y,y$4.visualElements.pointGraphics.shadowStyle.apply(b,y));const j=r&&n.displaying&&!i;b.attached=j,f.attached=j;};s.push(l$2((()=>[n.displaying,n.isDraped]),T),n.on("changed",T)),e.forEachManipulator((e=>{s.push(e.events.on("grab-changed",T));})),s.push(t$4(b)),s.push(t$4(f)),s.push(t$4(M)),T();}function C$2(e,n,i){const{view:o,graphic:a}=e,r=new S$4({view:o,geometry:G$1(a),elevationInfo:f$3(a),attached:!1});return R$1(e,r,n,i),i.push(t$4(r)),r}function G$1(e){const t=e.geometry;return t$2(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}function R$1(e,t,n,i){const o=()=>t.attached=n.displaying;U$1(e,t,n,i),y$4.visualElements.pointGraphics.outline.apply(t),i.push(l$2((()=>n.displaying),o,h$5));}function U$1(e,t,i,o){const{view:r,graphic:s}=e;let l=null;const p=e=>{r$4(l)&&(l.remove(),l=null),i.isDraped&&r$4(e)&&(l=D$1(r,e,(()=>{t.geometry=e;})));},c=()=>{const e=G$1(s);p(e),t.geometry=e;};o.push(i.on("changed",c),o$6((()=>l))),c();}function D$1(e,t,n){const i=e.elevationProvider.spatialReference;gn(t,V$1,i);const o=V$1[0],a=V$1[1];return e.elevationProvider.on("elevation-change",(e=>{w$2(e.extent,o,a)&&n();}))}const V$1=n$6(),B$1=a$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function i$3(i){switch(e$4(i.graphic.geometry).type){case"point":case"mesh":return M$3(i);case"polygon":case"polyline":return b$1(i);default:return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const t$1=[1,.5,0],a$2=128,e=70,h$1=80,M$2=.02,c$1=54,o$1=100,I=Math.ceil(e/3*2),P$1=160,i$2=.5,l$1=24,n$1=9,p$2=P$1+30,r$3=P$1+53,s$2=60,x$1=23,b=5*Math.PI/12,d$2=1*Math.PI/3,f=10,g$1=.2,j$1=30,k=53,m$2=.2,q$1=.3,u$1=200,v$1=3,w=1e6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class t{constructor(){this._available=!0;}set location(a){this._forEachManipulator3D((t=>t.location=a));}set elevationAlignedLocation(a){this._forEachManipulator3D((t=>t.elevationAlignedLocation=a));}set elevationInfo(a){this._forEachManipulator3D((t=>t.elevationInfo=a));}get renderLocation(){let a;return this._forEachManipulator3D((t=>{a||(a=t.renderLocation);})),a}get available(){return this._available}set available(a){this._available=a,this._forEachManipulator3D((t=>t.available=a));}get hovering(){return this.someManipulator((a=>a.hovering))}get grabbing(){return this.someManipulator((a=>a.grabbing))}get dragging(){return this.someManipulator((a=>a.dragging))}hasManipulator(a){return this.someManipulator((t=>t===a))}someManipulator(a){let t=!1;return this.forEachManipulator((i=>{!t&&a(i)&&(t=!0);})),t}_forEachManipulator3D(t){this.forEachManipulator(((i,o)=>{i instanceof ie&&t(i,o);}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function r$2(t,r,a,i){const c=t.graphic,s=(t,e)=>r({action:t,graphic:c,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY});return a(((t,r,a)=>{const o=r.next((t=>("start"===t.action&&s("start",t),t))).next(h$6(c,i)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&s("update",t);break;case"end":s("end",t);}return t}));return a.next(M$8(c)).next((()=>{s("end",{screenDeltaX:0,screenDeltaY:0});})),o}))}function a$1(e){if(t$2(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const n=("polyline"===e.type?e.paths:e.rings)[0];if(!n||n.length<2)return 0;const r=n[0],a=n[1];return Math.atan2(a[1]-r[1],a[0]-r[0])}function i$1(e){if(t$2(e)||t$2(e.axis))return 1;const{mapStart:n,mapEnd:r,axis:a}=e,i=[r.x-n.x,r.y-n.y];return i[0]*a[0]+i[1]*a[1]>0?1:-1}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class C$1 extends t{constructor(t){super(),this._handles=new t$5,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=e,this._updateAfterDrag=!1,this.events=new n$7,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t;}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._handles=s$7(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0;}forEachManipulator(t){for(const{manipulator:a}of this._arrowManipulatorInfos)t(a,A$2.TRANSLATE_XY);}createGraphicDragPipeline(t,a,r){const e=a.graphic,i=f$3(e),s=e$4(e.geometry).spatialReference;return r$2(a,r,(a=>this.createDragPipeline(((r,e,i,o,s)=>a(r,t(r,e,i,o,s),i)),i,s,e)),this._view.state.viewingMode)}createDragPipeline(t,a,r,i){return r$8(this._arrowManipulatorInfos.map((({manipulator:e},o)=>d$6(e,((e,s,n,l,p)=>{const u=s.next((t=>({...t,manipulatorType:A$2.TRANSLATE_XY}))).next(C$5(this._view,e.elevationAlignedLocation)).next(N$2(this._view,e.elevationAlignedLocation,a,r,i)).next(g$3(e.location,this.angle+(o+1)*Math.PI*.5)).next(U$2());t(e,u,n,l,p);})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform();}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform();}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators());}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform();}_updateArrowManipulator({manipulator:t,transform:a},r){const e$1=this._radius/e,i=c$1*e$1,o=i*Math.sqrt(3)/2,s=Z$2(o,i/2,i/2,M$2);B$2(s,x$5(f$4.get(),o$4(c$4.get(),0,-o/3,0))),t.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:t$6.Focused},{geometry:s,material:this._transparentMaterial,stateMask:t$6.Unfocused}],t.radius=o/3*2*1.2;const u=R$2(f$4.get(),r*Math.PI/2),h=x$5(f$4.get(),o$4(c$4.get(),0,o$1*e$1,0));u$6(a,u,h);}_createManipulators(){for(let t=0;t<4;t++){const a=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(a);}this._updateManipulatorTransform();}_updateManipulatorTransform(){const t=this.angle,a=g$4(f$4.get(),t,r$9(0,0,1));if(t$2(a))return;const r=q$3(f$4.get(),o$4(c$4.get(),this.displayScale,this.displayScale,this.displayScale)),e=u$6(f$4.get(),r,a);for(const i of this._arrowManipulatorInfos){const t=u$6(f$4.get(),e,i.transform);i.manipulator.modelTransform=t;}}_createArrowManipulator(t){const a=new ie({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:r$9(0,0,1)}}),r={manipulator:a,transform:e$5()};return this._updateArrowManipulator(r,t),this._handles.add(a.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1);}))),r}_createMaterial(a=1){const r=l$4.toUnitRGBA(r$a.main);return r[3]*=a,new m$7({color:r,transparent:1!==a,cullFace:n$8.Back,renderOccluded:o$3.Transparent})}get test(){return {arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class a{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new G$6,this._enabled=!1;}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&r$4(this._lastDragEvent)){const n=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(r$4(a)){const t={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?a:n,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(t);}}this._enabled=e;}_snap(n){const a=r$4(this._view)?this._view.toMap(n,{exclude:[]}):null;return r$4(a)&&r$4(this._view)&&(a.z=d$7(a,this._view,this._elevationInfo)),a}createDragEventPipelineStep(e,n){return this._view=e,this._elevationInfo=n,this._lastDragEvent=null,e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const n=this._snap(e.screenEnd);return r$4(n)?{action:e.action,mapStart:e.mapStart,mapEnd:n,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return {action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class E extends t{constructor(t){super(),this._snapToScene=new a,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=e,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._tool=null,this._view=null,this._manipulator=null;}forEachManipulator(t){t(this._manipulator,A$2.TRANSLATE_XY);}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform();}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t;}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator());}createGraphicDragPipeline(t,i,a){const r=i.graphic,s=f$3(r),o=e$4(r.geometry).spatialReference;return r$2(i,a,(e=>this.createDragPipeline(((i,a,r,s,o)=>e(i,t(i,a,r,s,o),r)),s,o,r)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const r=this._view;return d$6(this._manipulator,((s,o,n,l,p)=>{const u=o.next(C$5(r,s.elevationAlignedLocation)).next(N$2(r,s.elevationAlignedLocation,e,i,a)).next(this._snapToScene.createDragEventPipelineStep(r,e),this._snapToScene.next).next((t=>({...t,manipulatorType:A$2.TRANSLATE_XY}))).next(U$2());t(s,u,n,l,p);}))}_updateManipulatorTransform(){const t=q$3(f$4.get(),o$4(c$4.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t;}_createManipulator(){const t=this._view;this._manipulator=new ie({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:r$9(0,0,1)},worldOriented:!0}),this._updateManipulator();}_updateManipulator(){const t=E$2(M$2,1,a$2,r$9(0,0,1),r$9(0,0,0)),e$1=q$3(e$5(),r$9(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:t,material:this._discMaterial,transform:e$1,stateMask:t$6.Focused},{geometry:t,material:this._discMaterialTransparent,transform:e$1,stateMask:t$6.Unfocused}],this._manipulator.radius=h$1*(this._radius/e);}_createMaterial(e=1){const i=l$4.toUnitRGBA(r$a.main);return i[3]*=e,new m$7({color:i,transparent:1!==e,cullFace:n$8.Back,renderOccluded:o$3.Transparent})}get test(){return {discManipulator:this._manipulator}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class T extends t{constructor(t){super(),this._radius=e,this.events=new n$7,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();}));}forEachManipulator(t){t(this._manipulator,A$2.TRANSLATE_Z);}createGraphicDragPipeline(t,e,r){const i=e$4(e.graphic.geometry).spatialReference;return r$2(e,r,(e=>this.createDragPipeline(((r,a,i,o,s)=>e(r,t(r,a,i,o,s),i)),i)),this._view.state.viewingMode)}createDragPipeline(t,e){const r=this._view;return d$6(this._manipulator,((a,i,o,s,n)=>{const l=i.next((t=>({...t,manipulatorType:A$2.TRANSLATE_Z}))).next(G$7(r,a.renderLocation,e)).next(U$2());t(a,l,o,s,n);}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator());}_updateManipulator(){const e$1=this._radius/e,r=y$4.zManipulator.height*e$1,a=y$4.zManipulator.coneHeight*e$1,l=y$4.zManipulator.coneWidth*e$1,m=y$4.zManipulator.width*e$1,p=[r$9(0,0,0),r$9(0,0,r)],u=X(p,m/2,16,!1),c=C$6(a,l/2,16,!1),d=[r$9(0,0,0),r$9(0,0,r+a)],h=t=>{const e=e$5();if(c$5(e,e,[0,0,r]),b$4(e,e,Math.PI/2),t){const r=1+2*t/l;i$8(e,e,[r,r,r]);}return e},M=h(0),g=(e,r)=>{const a=q$4(y$4.zManipulator.color,r);return [a.r/255,a.g/255,a.b/255,y$4.zManipulator.color.a*e]},j=A$5(g(1,.25),o$3.Occlude),w=A$5(g(1,0),o$3.Occlude),k=A$5(g(.7,0),y$4.zManipulator.renderOccluded),P=A$5(g(.85,0),y$4.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:c,transform:M,material:j,stateMask:t$6.Unfocused},{geometry:u,material:j,stateMask:t$6.Unfocused},{geometry:c,transform:M,material:w,stateMask:t$6.Focused},{geometry:u,material:w,stateMask:t$6.Focused},{geometry:c,transform:M,material:k,stateMask:t$6.Unfocused},{geometry:u,material:k,stateMask:t$6.Unfocused},{geometry:c,transform:M,material:P,stateMask:t$6.Focused},{geometry:u,material:P,stateMask:t$6.Focused}],this._manipulator.radius=m/2+2,this._manipulator.collisionType={type:"line",paths:[d]};}_createManipulator(){const t=new ie({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e$1=this._view.state.camera,a=A$1;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,a);const i=U$3(e$1.eye,a),o=e$1.computeRenderPixelSizeAtDist(i),s=e$6(x,a,e$1.eye);z$1(s,s);const n=D;this._view.renderCoordsHelper.worldUpAtPosition(A$1,n);const h=Math.abs(P$4(s,n)),f=_$3(x,s,n),M=_$3(x,f,n),_=a$8(h,.01,1),g=1-Math.sqrt(1-_*_)/_/e$1.fullWidth,j=this._radius/e,w=y$4.zManipulator.width*j;g$2(M,z$1(M,M),(1/g-1)*i+o*w),t[12]-=x[0],t[13]-=x[1],t[14]-=x[2];},this._manipulator=t,this._updateManipulator();}get test(){return {manipulator:this._manipulator}}}const A$1=n$6(),x=n$6(),D=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class u extends t{constructor(a){super(),this._handles=new t$5,this._interactive=!0;const{tool:t,view:n,snapToScene:e,radius:s}=a;this._view=n,this.xyManipulation=new E({tool:t,view:n,snapToScene:e,radius:s}),this.xyAxisManipulation=new C$1({tool:t,view:n,radius:s}),this.zManipulation=new T({tool:t,view:n,radius:s}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((i=>{this._handles.add(i.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())));}));}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy();}createGraphicDragPipeline(i,t,n){return r$8([this.xyManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(M$1.XY,a,t,n,e,s)),t,n),this.xyAxisManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(M$1.XY_AXIS,a,t,n,e,s)),t,n),this.zManipulation.createGraphicDragPipeline(((a,t,n,e,s)=>i(M$1.Z,a,t,n,e,s)),t,n)])}createDragPipeline(i,t,n,e){return r$8([this.xyManipulation.createDragPipeline(((a,t,n,e,s)=>i(M$1.XY,a,t,n,e,s)),t,n,e),this.xyAxisManipulation.createDragPipeline(((a,t,n,e,s)=>i(M$1.XY_AXIS,a,t,n,e,s)),t,n,e),this.zManipulation.createDragPipeline(((a,t,n,e,s)=>i(M$1.Z,a,t,n,e,s)),n)])}set snapToScene(i){this.xyManipulation.snapToScene=i;}set angle(i){this.xyAxisManipulation.angle=i;}set interactive(i){this._interactive!==i&&(this._interactive=i,this._updateManipulatorInteractivity());}set radius(i){this.xyAxisManipulation.radius=i,this.xyManipulation.radius=i,this.zManipulation.radius=i;}set displayScale(i){this.xyManipulation.displayScale=i,this.xyAxisManipulation.displayScale=i;}forEachManipulator(i){this.xyManipulation.forEachManipulator((a=>i(a,A$2.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((a=>i(a,A$2.TRANSLATE_XY))),this.zManipulation.forEachManipulator((a=>i(a,A$2.TRANSLATE_Z)));}get _xyAxisVisible(){const i=this.xyManipulation.someManipulator((i=>i.focused))||this.xyAxisManipulation.someManipulator((i=>i.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||i}_autoHideXYAxis(){const i=this.xyAxisManipulation,a=this.xyManipulation;if(has("esri-mobile"))return;const t=[];a.forEachManipulator((i=>t.push(i))),i.forEachManipulator((i=>t.push(i)));const e=()=>{const a=[];this._xyAxisVisible||i.forEachManipulator((i=>a.push(i.disableDisplay()))),this._handles.remove(c),this._handles.add(a,c);};for(const n of t)this._handles.add(n.events.on("focus-changed",e));this._view.inputManager&&this._handles.add(f$5((()=>this._view.inputManager?.latestPointerType),e)),e();}_updateManipulatorInteractivity(){const i=this.grabbing;this.forEachManipulator((a=>{a.interactive=!i&&this._interactive||a.grabbing;}));}static radiusForSymbol(i){const a=r$4(i)&&"point-3d"===i.type&&i.symbolLayers;return !!a&&a.length>0&&a.some((i=>"icon"===i.type))?I:e}}const c="disable-xy-axis-display";var M$1;!function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z";}(M$1||(M$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class l extends t{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null;}forEachManipulator(t){t(this._manipulator,A$2.TRANSLATE_XY);}createGraphicDragPipeline(t){return r$2(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(e){const r=this._view,a=this._graphicState.graphic,p=r$4(a.geometry)?a.geometry.spatialReference:null;return d$6(this._manipulator,((t,o,l,h,c)=>{const m=o.next(h$7(c,r,a,p)).next(P$5()).next(U$2());e(t,m,l,h,c);}))}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new C$7({graphic:i,view:t,selectable:!0,cursor:"move"});}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class L{constructor(t){this.allGraphics=t,this.type="graphic-move-start";}}class N{constructor(t,i,e){this.dx=t,this.dy=i,this.allGraphics=e,this.type="graphic-move";}}class q{constructor(t){this.allGraphics=t,this.type="graphic-move-stop";}}let B=class extends(a$9(n$7.EventedMixin(p$3))){constructor(t){super(t),this.graphics=new j$4,this.enableZ=!0,this.tooltipOptions=new p$4,this.type="move-3d",this._snappingPipeline=new u$7,this._tooltip=null;}initialize(){const{graphics:t,view:i}=this;this.addHandles([t.on("change",(()=>this._refreshManipulators())),l$2((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new m$8({view:i}):s$7(this._tooltip);}),w$3)]),this._refreshManipulators(),this.finishToolCreation();}destroy(){this._tooltip=s$7(this._tooltip),this._moveManipulation=s$7(this._moveManipulation),this.graphics.removeAll(),this._set("view",null);}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>i$9(t)===P$6.SUPPORTED)).map((t=>new J(t)));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this._updateMoveManipulation(t));}_createManipulators(t){for(const i of t){const e=i.state;i.manipulationXY=new l({tool:this,view:this.view,graphicState:e}),i.manipulationXY.forEachManipulator((t=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e.graphic}),t.stopPropagation();})),t.events.on("grab-changed",(({action:t})=>{const{tooltipOptions:i,_tooltip:e}=this;t$2(e)||("start"===t?e.info=new r$b({tooltipOptions:i}):e.clear());}))]))),this.handles.add(i.manipulationXY.createDragPipeline(((i,e,o,a)=>this._buildDragEventPipeline(t,M$1.XY,i,e,o,a))));}this._createMoveManipulation(t);}_createMoveManipulation(t){const i=new u({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?u.radiusForSymbol(t[0].graphic.symbol):e});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(e=>{i.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...e,graphic:this.graphics.getItemAt(0)}),e.stopPropagation();})));}));const e$1=i=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const o=this._tooltip;t$2(o)||("focus"===e?this._updateMoveTooltip(t,i):o.clear());})));};this._moveManipulation.xyManipulation.forEachManipulator(e$1(M$1.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(e$1(M$1.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(e$1(M$1.Z));const o=()=>this._updateMoveManipulation(t);for(const n of t)this.handles.add([n.state.on("changed",o),l$2((()=>n.state.displaying),o)]);const a=t[t.length-1];this.handles.add(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a)))),this.handles.add(i.createDragPipeline(((i,e,o,a,n)=>this._buildDragEventPipeline(t,i,e,o,a,n)),f$3(a.graphic),e$4(a.graphic.geometry).spatialReference,a.graphic)),this._updateMoveManipulationAngle(a);}_createVisualElements(t){for(const i of t){const e=i.graphic,o=i$3({view:this.view,graphic:e,forEachManipulator:t=>{i.manipulationXY.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);},onManipulatorsChanged:()=>n$4()});t$2(o)||(i.geometryRepresentation=o.visualElement,i.geometryRepresentation instanceof S$2&&this.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(()=>{i.state.isDraped||this._updateMoveManipulation(t);})),l$2((()=>i.state.isDraped),(()=>this._updateMoveManipulation(t)))]),this.handles.add(o));}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=a$1(t.graphic.geometry);}_updateMoveManipulation(t){const i=v$3(0,0,0,this.view.spatialReference);let e=0,o=!1;const a=this._moveManipulation;for(const n of t){if(!n.state.displaying)continue;const t=n.state.graphic;this.enableZ&&t$7(t)&&(o=!0);const a=n.geometryRepresentation instanceof S$2&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:N$3(this.view,t);r$4(a)&&(i.x+=a.x,i.y+=a.y,i.z+=a.z,e++);}e>0?(i.x/=e,i.y/=e,i.z/=e,a.location=i,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=o):a.available=!1;}_buildDragEventPipeline(t,i,e,o,a,n){const s=[],r=[];let p=null,l=null;const h=()=>{for(const t of s)t.dragging=!1;s.length=0,r.length=0,p=null,l=null,this._moveManipulation.interactive=!0;};if(a=a.next((t=>l(t))).next((()=>{if(this.emit("graphic-move-stop",new q(r)),this.destroyed)return null;h();})),1===t.length&&i===M$1.XY){const i=t[0].graphic;o=this._buildSnappingPipelineSteps(i,f$3(i),o,a,n);}return o.next((i=>{if("start"===i.action){s.length=0,r.length=0;for(const i of t)i.dragging||!i.manipulationXY.hasManipulator(e)&&i.manipulationXY.grabbing||(s.push(i),r.push(i.graphic),i.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,p=v$4(r,this.view.state.viewingMode),l=D$3(r),this.emit("graphic-move-start",new L(r)),this.destroyed))return null}return 0!==r.length?i:null})).next((t=>p(t))).next((e=>(this._updateMoveTooltip(t,i,e),e))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const i=this.view.toScreen(t.mapStart),e=this.view.toScreen(t.mapEnd),o=e.x-i.x,a=e.y-i.y;if(this.emit("graphic-move",new N(o,a,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new q(r)),this.destroyed)return null;h();}}))}_updateMoveTooltip(t,i,e){const{tooltipOptions:o,_tooltip:a}=this;if(t$2(a))return;a.clear();const n=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(i){case M$1.XY:a.info=new r$b({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>a$b(t,i,n)));break;case M$1.XY_AXIS:a.info=new a$a({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const o=a$b(t,i,n);return y$5(o,i$1(e))}));break;case M$1.Z:a.info=new p$5({tooltipOptions:o}),this._updateMoveTooltipDistance(a.info,e,v$5);}}_updateMoveTooltipDistance(t,i,e){if(r$4(i)&&"end"!==i.action){const{mapStart:o,mapEnd:a}=i,n=e(o,a);t.distance=r$4(n)?n:j$5;}}_buildSnappingPipelineSteps(t,i,e,o,a){const n=t.geometry;if(t$2(n)||"point"!==n.type&&"mesh"!==n.type)return e;const r=("point"===n.type?n:n.anchor).clone(),p=new e$7({elevationInfo:i,pointer:a,editGeometryOperations:V$3.fromGeometry(r,this.view.state.viewingMode),visualizer:new _$1,excludeFeature:t}),l=this.snappingManager;return e.next((i=>{r.z=g$5(this.view,r,f$3(t),{mode:"absolute-height",offset:0});return {...i,snapOrigin:p.coordinateHelper.pointToVector(r)}})).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:p,snappingManager:l,cancel:o,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return {tooltip:this._tooltip}}};e$2([y$3({constructOnly:!0,nonNullable:!0})],B.prototype,"view",void 0),e$2([y$3()],B.prototype,"graphics",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],B.prototype,"enableZ",void 0),e$2([y$3({constructOnly:!0,type:p$4})],B.prototype,"tooltipOptions",void 0),e$2([y$3({constructOnly:!0})],B.prototype,"snappingManager",void 0),e$2([y$3()],B.prototype,"type",void 0),e$2([y$3()],B.prototype,"updating",null),B=e$2([n$3("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],B);class J{constructor(t){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new e$1({graphic:t});}get graphic(){return this.state.graphic}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function j(e,r,o){const n="on-the-ground"===o.mode?A$6.XY:A$6.XYZ;return new P$7(e,n,r,0)}function h(r,o,n){const s=n$6();if(!r.renderCoordsHelper.toRenderCoords(o,s))return null;const c=y$2(r,o,Y$1(n.plane)),i=y$2(r,o,n.edgeDirection);if(t$2(c)||t$2(i))return null;const u=_$3(n$6(),c,i);return _$4(s,u,p$6())}function y$2(e,r,o){const n=v$3(r.x+o[0],r.y+o[1],r.z+o[2],r.spatialReference),t=n$6(),c=n$6();return e.renderCoordsHelper.toRenderCoords(r,t)&&e.renderCoordsHelper.toRenderCoords(n,c)?H$1(c,t,c):null}function C(e,r,o){const c=Y$1(e),i=H$1(n$6(),r,o),p=_$3(n$6(),i,c),m=_$3(n$6(),i,p);return t$8(i[0],i[1],i[2],0,p[0],p[1],p[2],0,m[0],m[1],m[2],0,0,0,0,1)}function R(e,n,t){const s=t.projectToRenderScreen(e,x$6()),d=t.projectToRenderScreen(n,x$6());return r$4(s)&&r$4(d)?v$6(e$6(s,s,d)):0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let p$1=class extends e$8{constructor(o){super(o),this.type="reshape-edge-offset",this.distance=j$5,this.area=null,this.totalLength=null;}};e$2([y$3()],p$1.prototype,"type",void 0),e$2([y$3()],p$1.prototype,"distance",void 0),e$2([y$3()],p$1.prototype,"area",void 0),e$2([y$3()],p$1.prototype,"totalLength",void 0),p$1=e$2([n$3("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],p$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let Ue=class extends(n$7.EventedMixin(d$8)){constructor(e){super(e),this._vertexManipulatorMaterial=A$5(y$4.colorToVec4(y$4.reshapeManipulators.vertex.color),y$4.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=I$1(y$4.colorToVec4(y$4.reshapeManipulators.vertex.outlineColor),y$4.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=I$1(y$4.colorToVec4(y$4.reshapeManipulators.vertex.hoverOutlineColor),y$4.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=A$5(y$4.colorToVec4(y$4.reshapeManipulators.edge.color),y$4.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=I$1(y$4.colorToVec4(y$4.reshapeManipulators.edge.outlineColor),y$4.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=A$5(y$4.colorToVec4(y$4.reshapeManipulators.edgeOffset.color),y$4.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=A$5(y$4.colorToVec4(y$4.reshapeManipulators.edgeOffset.hoverColor),y$4.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=A$5(y$4.colorToVec4(y$4.reshapeManipulators.selected.color),y$4.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=I$1(y$4.colorToVec4(y$4.reshapeManipulators.selected.outlineColor),y$4.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=I$1(y$4.colorToVec4(y$4.reshapeManipulators.selected.hoverOutlineColor),y$4.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new t$5,this._manipulatorInfos=[],this._editGeometryOperations=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Xe.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new u$7,this._snappingPipelineHandle=new u$7,this._vertexLaserLineVisualElement=null;}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new e$1({graphic:e});this._tooltip=new m$8({view:t}),this.addHandles([l$2((()=>i.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e;})),l$2((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:i})=>{r$4(e)&&(e.visible=t,e.edgeDistance=i?"far":"default");}),h$5),f$5((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),h$5),this.view.trackGraphicState(i)]);}destroy(){this._segmentLabels=s$7(this._segmentLabels),this._tooltip=s$7(this._tooltip),this._removeManipulators();}get inputGeometry(){return r$4(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e);}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e);}onManipulatorSelectionChanged(){this.emit("manipulators-changed");}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=s$7(this._moveManipulation),this._graphicMoveManipulation=s$7(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0;}_createManipulators(){if(t$2(this._editGeometryOperations))return;const e=f$3(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e);}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements();}get canRedo(){return r$4(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return r$4(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(t$2(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return r$4(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(t$2(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return r$4(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._tooltip.clear(),this._createManipulators();}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._tooltip.clear(),t$2(e)||(s$7(this._editGeometryOperations),this._editGeometryOperations=V$3.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),s$7(this._segmentLabels),this._segmentLabels=new a$4({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:f$3(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}));}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const a=[],o=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),n=e===Ze.SELECTED_OR_ALL&&o;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.grabbing||n&&!r.manipulator.selected||a.push(r),i++);if(0===a.length)return t;this._moveVertices(a,t);if(a.length===i){if(this._updateEventState(Xe.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic});}else {if(this._updateEventState(Xe.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic});}return t}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)"vertex"===t.type&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Xe.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const o=[];for(const n of this._manipulatorInfos)"vertex"===n.type&&(n.manipulator.selected&&!n.manipulator.grabbing||n===e.info)&&o.push(n);this._moveVertices(o,e,E$3.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic});}_updateEventState(e){if(e===this._reshapeEventState)return !1;switch(e){case Xe.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return !1;switch(this._reshapeEventState){case Xe.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic});}break;case Xe.MOVING:switch(this._reshapeEventState){case Xe.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});}break;case Xe.RESHAPING:switch(this._reshapeEventState){case Xe.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Xe.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic});}}if(this.destroyed)return !1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new l({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=e$4(this._editGeometryOperations).createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(Ze.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(M$1.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=h$8(e));})),a.next((()=>this._onDragCancel(!0,(()=>e=h$8(e)))));}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))));}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null;}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation();})))));}_createMoveManipulation(e){const{graphic:t,handles:i,tool:a,view:o}=this,n=this._graphicState;this._moveManipulation=new u({tool:a,view:o,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&t$7(t),snapToScene:!1,radius:u.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>i.add([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation();})),this._watchAndUpdateGrabState(e,!1)])));const r=e=>t=>{i.add(t.events.on("focus-changed",(({action:t})=>{"focus"===t&&this._tooltipOptions.enabled?this._updateTranslateTooltip(e):this._tooltip.clear();})));};this._moveManipulation.xyManipulation.forEachManipulator(r(M$1.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(M$1.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(M$1.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const s=e$4(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,o,n,r,s)=>{r=r.next((e=>(this._onDragCancel(),e)));return n.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===A$2.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next(X$1(this.view,e,t)).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:r,snappingManager:a.snappingManager,snappingContext:new e$7({editGeometryOperations:e$4(this._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:t,visualizer:new _$1}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipelineHandle.next).next(P$5()).next((e=>this._perGraphicManipulatorDragAction(Ze.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e)))}),e,s,t),l$2((()=>n.displaying),(()=>{this._updateMoveManipulationPosition();}),h$5),n.on("changed",(()=>this._updateMoveManipulationPosition())),l$2((()=>n.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):i.remove(t);}),h$5)]);}_createVisualElements(){const{graphic:e,view:t}=this,i=i$3({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,A$2.TRANSLATE_XY);}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});r$4(i)&&(this._outlineVisualElement=i.visualElement instanceof S$2?i.visualElement:null),r$4(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition();}))),this._manipulatorHandles.add(i);}_createEdgeOffsetManipulator(e,t=f$3(this.graphic)){const i=y$4.reshapeManipulators.edgeOffset,a=i.size/2,o=a+i.collisionPadding;if(t$2(this._edgeOffsetManipulatorGeometryInside)||t$2(this._edgeOffsetManipulatorGeometryOutside)){const e=a/o,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=Z$2(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=Z$2(-t,e/2,e/2,i.height,-i.offset);}const r=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:t$6.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:t$6.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:t$6.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:t$6.Focused}],s=new ie({view:this.view,renderObjects:r,elevationInfo:"on-the-ground"!==t.mode||d$9(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:r$9(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new ie({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),d={manipulator:s,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);const u=[];for(const n of [d.handle.leftVertex,d.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(n);r$4(e)&&u.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d))));}d.locationUpdateHandle=r$8(u),this._manipulatorHandles.add(d.locationUpdateHandle,s),this._manipulatorHandles.add([this._watchAndUpdateGrabState(s,!0),this._watchAndUpdateGrabState(h,!0)],s),this._manipulatorHandles.add(d$6(s,this._createEdgeOffsetPipeline(d,t)),s),this._manipulatorHandles.add(d$6(h,((e,i,a,o)=>{if("touch"===o){this._createEdgeOffsetPipeline(d,t)(e,i,a);}else if(this.enableMoveGraphic){const o=this.graphic,n=r$4(o.geometry)?o.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next(C$5(this.view,e.elevationAlignedLocation)).next(N$2(this.view,e.elevationAlignedLocation,t,n,o)).next(U$2()).next(P$5()).next((e=>this._perGraphicManipulatorDragAction(Ze.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(M$1.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear();})),a.next((()=>this._onDragCancel(!e.metadata.deleting)));}})),s);const c=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation();};return this._manipulatorHandles.add([s.events.on("immediate-click",c),h.events.on("immediate-click",c),s.events.on("focus-changed",(({action:e})=>{const t=this._tooltipOptions;if("focus"===e&&t.enabled){const e=this._tooltip.info=new p$1({tooltipOptions:t});this._updateTooltipAreaOrTotalLength(e);}else this._tooltip.clear();}))],s),this._manipulatorInfos.push(d),this.manipulators.add(s),this.manipulators.add(h),this.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,o=()=>{e.visibilityHandle=h$8(e.visibilityHandle);const o=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex),s=r$4(o)&&r$4(r)&&R(o.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||s)&&(i.grabbable=!s,a.grabbable=!s,e.visibilityHandle=r$8([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic;}}]));};this._manipulatorHandles.add([i.events.on("focus-changed",o),a.events.on("focus-changed",o),{remove:()=>{h$8(e.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a);}}],i),o();}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=e$4(this._editGeometryOperations).data,i=h(this.view,e.manipulator.elevationAlignedLocation,j(t,e.handle,e$4(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(t$2(a)||t$2(o))return;const n=a.manipulator.renderLocation,r=o.manipulator.renderLocation,s=r$4(i)?C(i,n,r):o$7;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const d=s$8(e$6(Re,n,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-d,0,0],[d,0,0]]]};}_createEdgeOffsetPipeline(e,t){return (i,a,o)=>{this._clearSelection();const{step:n,cleanup:r}=this._initializeEdgeOffset(e,t);a.next((e=>this._trackNumDragging(e))).next(C$5(this.view,i.elevationAlignedLocation)).next(n).next(T$5(this.view)).next(F(this.view,e$4(this._editGeometryOperations).data.spatialReference)).next(P$5()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&r();})),o.next((()=>{i.metadata.deleting||(r(),this._onDragCancel());}));}}_initializeEdgeOffset(e,t){const i=e$4(this._editGeometryOperations),a=j(i.data.coordinateHelper,e.handle,t),o=i.createUndoGroup(),s=h(this.view,e.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);r$4(t)&&this._splitEdgeManipulator(t,1);}if(a.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);r$4(t)&&this._splitEdgeManipulator(t,0);}const u=()=>new m$a({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),c=new S$2({view:this.view,isDraped:this._graphicState.isDraped,geometry:u(),elevationInfo:e.elevationInfo,width:y$4.visualElements.lineGraphics.outline.width,color:y$4.colorToVec4(r$a.main),attached:!0});let m;const _=()=>{this._cleanEdgeOffsetCollapsedEdges(e),m=h$8(m);},f=this.on("undo",_);return m=r$8([t$4(c),l$2((()=>this._graphicState.isDraped),(e=>c.isDraped=e)),this._graphicState.on("changed",(()=>c.geometry=u())),o,f]),{step:e=>t$2(a)||t$2(s)?(_(),null):{...e,operation:a,plane:s},cleanup:_}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||t$2(t.operation))return t;this._updateEventState(Xe.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o}=t;return (i||a||o)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return t$2(t)||t$2(i)?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,o=this._tooltip,n=this._tooltipOptions;if(!n.enabled||t$2(i))return o.clear(),e;let r=o.info;(t$2(r)||"reshape-edge-offset"!==r.type)&&(r=o.info=new p$1({tooltipOptions:n}));const{coordinateHelper:s}=e$4(this._editGeometryOperations).data;return r.distance="end"===e.action?j$5:Ne(this._graphicState.isDraped,i*a.selectedArrow,t,a.plane,s),this._updateTooltipAreaOrTotalLength(r),e}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,a=e.handle.rightVertex.rightEdge?.rightVertex,o=e.handle.rightVertex,n=e$4(this._editGeometryOperations).data.coordinateHelper,r=[];if(t&&n.distance(t.pos,i.pos)<Fe){const e=this._getManipulatorInfoFromHandle(i);r$4(e)&&r.push(e);}if(n.distance(i.pos,o.pos)<Fe||a&&n.distance(a.pos,o.pos)<Fe){const e=this._getManipulatorInfoFromHandle(o);r$4(e)&&r.push(e);}r.length&&this._removeVertices(r);}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return {size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=f$3(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(t$2(this._vertexManipulatorGeometry)||t$2(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(y$4.reshapeManipulators.vertex);this._vertexManipulatorGeometry=T$6(e,16,16),this._vertexManipulatorOutlineGeometry=T$6(t,16,16);}if(t$2(this._edgeManipulatorGeometry)||t$2(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(y$4.reshapeManipulators.edge);this._edgeManipulatorGeometry=T$6(e,16,16),this._edgeManipulatorOutlineGeometry=T$6(t,16,16);}const i=r$4(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:ze.Vertex|t$6.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:ze.Vertex|t$6.Unfocused|t$6.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:ze.Vertex|t$6.Focused|t$6.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:t$6.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:t$6.Selected|t$6.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:t$6.Selected|t$6.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:ze.Edge|t$6.Focused|t$6.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:ze.Edge|t$6.Focused|t$6.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:ze.Edge|t$6.Unfocused|t$6.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:ze.Edge|t$6.Unfocused|t$6.Unselected});const a=new ie({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible),metadata:{deleting:!1}});this._setTypeSpecificManipulatorSettings(a,e,t);const o="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(o),this.manipulators.add(a),this._updateManipulatorPosition(o),"edge"===o.type){const e=[];for(const t of [o.handle.leftVertex,o.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);r$4(i)&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(o))));}o.locationUpdateHandle=r$8(e),this._manipulatorHandles.add(o.locationUpdateHandle,a);}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const r=d$6(a,((e,i,a,n)=>{let r=null;a=a.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>r=h$8(r))),t))),i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(r=e$4(this._editGeometryOperations).createUndoGroup()),"edge"===o.type){const t=this._splitEdgeManipulator(o);return {...e,info:t,snapOrigin:t.handle.pos}}return {...e,info:o,snapOrigin:o.handle.pos}})).next(C$5(this.view,e.elevationAlignedLocation)).next(P$8(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(X$1(this.view,t,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new e$7({editGeometryOperations:e$4(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new _$1}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipeline.next).next(P$5()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(r=h$8(r)),this._updateTranslateVertexTooltip(e,M$1.XY,t);}));}));return this._manipulatorHandles.add([r,a.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,o))),a.events.on("select-changed",(()=>{o.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition();})),a.events.on("focus-changed",(({action:e})=>{"focus"===e&&"edge"!==o.type?this._updateTranslateVertexTooltip(a,M$1.XY):this._tooltip.clear();}))],a),this.emit("manipulators-changed"),o}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--;}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=r$4(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),r$4(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Xe.NONE:break;case Xe.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Xe.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic});}t&&t(),this.destroyed||this._updateEventState(Xe.NONE);}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=ze.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=y$4.reshapeManipulators.vertex.size/2+y$4.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=r$4(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=ze.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=y$4.reshapeManipulators.edge.size/2+y$4.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||d$9(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i;}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i,a="mouse"){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Xe.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=e.manipulator.grabbing||!this._numGrabbing&&r$4(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing);})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing;})));}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"));}_removeManipulator(e){t$2(e)||(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),v$7(this._manipulatorInfos,e),this.emit("manipulators-changed"));}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(t$2(e))return;const t=e$4(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Ce),e.manipulator.grabbing&&r$4(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(t$2(i)||t$2(a))return;const o=i.manipulator,n=a.manipulator;if(r$4(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=o.location,a=n.location,r=.5,s=i.x+r*(a.x-i.x),l=i.y+r*(a.y-i.y),p=i.hasZ&&a.hasZ?0:void 0;e.manipulator.location=v$3(s,l,p,t.data.spatialReference);}else A$7(Re,o.renderLocation,n.renderLocation,.5),e.manipulator.renderLocation=Re;}}_splitEdgeManipulator(e,t=.5){const i=e$4(this._editGeometryOperations),a=e$4(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const o=f$3(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(e),n=this._createVertexOrEdgeManipulator(a)):(n=e,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,o)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(n),this.enableEdgeOffset||this._updateTranslateVertexTooltip(n.manipulator,M$1.XY),this._updateSelection(e.manipulator);const r=this._updateEventState(Xe.RESHAPING),s=i.data.coordinateHelper.vectorToArray(n.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:e$4(a.index)}],added:s}),r&&this._updateEventState(Xe.NONE),n}_updateMoveManipulationPosition(){const e=o$4(Re,0,0,0);let t=0,i=!1,a=null,o=null;for(const n of this._manipulatorInfos)"vertex"===n.type&&(n.manipulator.selected?(t++,u$4(e,e,n.manipulator.renderLocation),t$2(a)||n.selectedIndex>a.selectedIndex?(o=a,a=n):(t$2(o)||n.selectedIndex>o.selectedIndex)&&(o=n)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&t$7(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;}else {const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&t$7(this.graphic);}if(0!==t){let e=0;if(r$4(a)){const t=a.handle.pos,i=r$4(o)?o.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,n=t$2(o)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&n?this._moveManipulation.xyAxisManipulation.available=!1:i?e=ke(i,t):n&&(e=ke(t,n));}this._moveManipulation.angle=e,this._moveManipulation.radius=I;}else this._moveManipulation.angle=a$1(e$4(this.graphic.geometry)),this._moveManipulation.radius=u.radiusForSymbol(this.graphic.symbol);0!==t&&i?(g$2(e,e,1/t),Ce.spatialReference=e$4(this._editGeometryOperations).data.spatialReference,Ce.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Ce),this._moveManipulation.elevationAlignedLocation=Ce):r$4(this._outlineVisualElement)&&!this._graphicState.isDraped&&r$4(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:C$8(this.view,this._moveManipulation,this.graphic);}_removeVertices(e){const t=[],i=e$4(this._editGeometryOperations);for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=e$4(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e);}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return {coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e$4(e.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(Xe.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(Xe.NONE),this.destroyed))return;this._updateMoveManipulationPosition();}}_moveVertices(e,t,i=("start"===t.action?E$3.NEW_STEP:E$3.ACCUMULATE_STEPS)){const a=e$4(this._editGeometryOperations);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const o of e)this._updateManipulatorPosition(o);}_offsetEdge(e,t){if(t$2(t.operation)||t$2(t.signedDistance))return;const i=e$4(this._editGeometryOperations),a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex));}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===t$9.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===t$9.Left&&this._splitEdgeManipulator(t),e.stopPropagation();}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t);}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case M$1.XY:this._tooltip.info=new r$b({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,t)=>a$b(e,t,a)));break;case M$1.XY_AXIS:this._tooltip.info=new a$a({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,i)=>{const o=a$b(e,i,a);return y$5(o,i$1(t))}));break;case M$1.Z:this._tooltip.info=new p$5({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,v$5);}}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;let o;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case M$1.XY:o=new n$9({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((e,t)=>a$b(e,t,n))),this._updateTooltipAreaOrTotalLength(o);break;case M$1.XY_AXIS:o=new c$6({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,((e,t)=>{const a=a$b(e,t,n);return y$5(a,i$1(i))})),this._updateTooltipAreaOrTotalLength(o);break;case M$1.Z:o=new l$5({tooltipOptions:a}),this._updateTranslateTooltipDistance(o,i,v$5);}const r=x$7(e.elevationAlignedLocation);r$4(r)&&(o.elevation={mode:"absolute-height",...r}),this._tooltip.info=o;}_updateTranslateTooltipDistance(e,t,i){if(r$4(t)&&"end"!==t.action){const{mapStart:a,mapEnd:o}=t,n=i(a,o);e.distance=r$4(n)?n:j$5;}}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(t$2(t))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?i$a(t,i):null,e.totalLength="polyline"===t.type?m$9(t,i):null;}get test(){return {segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function ke(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Ne(e,t,i,a,o){if(e){const e=o.toXYZ(o.pointToVector(i)),n=H$2(a,e,c$4.get()),r=l$6(n,e,o.spatialReference);if(r$4(r))return a$c(r.value*Math.sign(t),r.unit)}return a$c(t*$(i.spatialReference),"meters")}e$2([y$3()],Ue.prototype,"_segmentLabels",void 0),e$2([y$3({constructOnly:!0})],Ue.prototype,"tool",void 0),e$2([y$3()],Ue.prototype,"_tooltip",void 0),e$2([y$3()],Ue.prototype,"inputGeometry",null),e$2([y$3()],Ue.prototype,"outputGeometry",void 0),e$2([y$3({readOnly:!0})],Ue.prototype,"updating",null),e$2([y$3()],Ue.prototype,"manipulators",null),e$2([y$3()],Ue.prototype,"view",null),e$2([y$3()],Ue.prototype,"graphic",null),e$2([y$3()],Ue.prototype,"enableZShape",null),e$2([y$3()],Ue.prototype,"enableZVertex",null),e$2([y$3()],Ue.prototype,"enableMoveGraphic",null),e$2([y$3()],Ue.prototype,"enableMidpoints",null),e$2([y$3()],Ue.prototype,"enableEdgeOffset",null),e$2([y$3()],Ue.prototype,"_labelOptions",null),e$2([y$3()],Ue.prototype,"_tooltipOptions",null),Ue=e$2([n$3("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ue);const Ce=v$3(0,0,null,null),Re=n$6(),Fe=1e-6;var ze,Xe,Ze;!function(e){e.Vertex=u$8.Custom1,e.Edge=u$8.Custom2;}(ze||(ze={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING";}(Xe||(Xe={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL";}(Ze||(Ze={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let v=class extends(n$7.EventedMixin(p$3)){constructor(e){super(e),this._handles=new t$5,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new c$7,this.tooltipOptions=new p$4,this.snappingManager=null,this.automaticManipulatorSelection=!1;}initialize(){const e=this._reshapeOperation=new Ue({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e);})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e);})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e);})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e);})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation();})),l$2((()=>this.graphic),(()=>this._updateGraphic()),w$3)]),this.finishToolCreation();}destroy(){this._handles=s$7(this._handles),this._reshapeOperation=s$7(this._reshapeOperation);}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=m$b(this.graphic);this._reshapeOperation.inputGeometry=r$4(e)?e.clone():null;}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),l$7(this.graphic)!==P$6.SUPPORTED)return;const e=l$2((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry();}),U$4);this._handles.add(e,"onGraphicGeometryChange");}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged();}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1;}_onReshapeGeometryChanged(){t$2(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){r$4(this.snappingManager)&&this.snappingManager.doneSnapping(),r$4(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){r$4(this.snappingManager)&&this.snappingManager.doneSnapping(),r$4(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices();}reset(){}get test(){return {snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};e$2([y$3()],v.prototype,"_reshapeOperation",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"view",void 0),e$2([y$3({constructOnly:!0})],v.prototype,"graphic",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"enableZShape",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"enableZVertex",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"enableMoveGraphic",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"enableMidpoints",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],v.prototype,"enableEdgeOffset",void 0),e$2([y$3()],v.prototype,"type",void 0),e$2([y$3({constructOnly:!0,type:c$7})],v.prototype,"labelOptions",void 0),e$2([y$3({constructOnly:!0,type:p$4})],v.prototype,"tooltipOptions",void 0),e$2([y$3({constructOnly:!0})],v.prototype,"snappingManager",void 0),e$2([y$3()],v.prototype,"updating",null),e$2([y$3()],v.prototype,"automaticManipulatorSelection",void 0),v=e$2([n$3("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],v);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let r$1=class extends e$8{constructor(o){super(o),this.type="transform-rotate",this.rotationType="geographic";}};e$2([y$3()],r$1.prototype,"type",void 0),e$2([y$3()],r$1.prototype,"rotation",void 0),e$2([y$3()],r$1.prototype,"rotationPrecision",void 0),e$2([y$3()],r$1.prototype,"orientation",void 0),e$2([y$3()],r$1.prototype,"orientationPrecision",void 0),e$2([y$3()],r$1.prototype,"rotationType",void 0),r$1=e$2([n$3("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],r$1);let s$1=class extends e$8{constructor(o){super(o),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null;}};e$2([y$3()],s$1.prototype,"type",void 0),e$2([y$3()],s$1.prototype,"scale",void 0),e$2([y$3()],s$1.prototype,"size",void 0),e$2([y$3()],s$1.prototype,"sizeUnit",void 0),e$2([y$3()],s$1.prototype,"sizePrecision",void 0),s$1=e$2([n$3("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],s$1);let p=class extends e$8{constructor(o){super(o),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null;}};e$2([y$3()],p.prototype,"type",void 0),e$2([y$3()],p.prototype,"orientation",void 0),e$2([y$3()],p.prototype,"orientationEnabled",void 0),e$2([y$3()],p.prototype,"orientationPrecision",void 0),e$2([y$3()],p.prototype,"rotationType",void 0),e$2([y$3()],p.prototype,"size",void 0),e$2([y$3()],p.prototype,"sizeUnit",void 0),e$2([y$3()],p.prototype,"sizeEnabled",void 0),e$2([y$3()],p.prototype,"sizePrecision",void 0),p=e$2([n$3("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],p);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
var yt,bt;!function(t){t.ScaleIn=u$8.Custom2,t.ScaleOut=u$8.Custom3,t.RotateLeft=u$8.Custom4,t.RotateRight=u$8.Custom5,t.Unlocked=u$8.Custom7,t.DelayedFocused=u$8.Custom8,t.TouchInput=u$8.Custom12;}(yt||(yt={}));class Tt{constructor({adapter:t,tooltipOptions:i,mode:o,tool:r}){this._mode=null,this._handles=new t$5,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new n$7,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>r$4(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=r,this._mode=o,this._adapter=t,this._tooltipOptions=i,this._tooltip=new m$8({view:r.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(f$5((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),h$5));}get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t;}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t;}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t;}destroy(){r$4(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=s$7(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=s$7(this._tooltip);}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=A$8({update:({deltaTime:e})=>{t.update(e)&&this.cancelActiveAnimation();}});this._activeAnimation={...t,frameTask:e};}cancelActiveAnimation(){r$4(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=s$7(this._activeAnimation));}forEachManipulator(t){t(this._ringManipulator,A$2.SCALE_ROTATE);}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const a=this.tool.graphicState.graphic,r=d$6(e,((e,r,n)=>{this._scaleRotateDragData=null;const l=this._adapter.startInteraction(),c={mode:"none",origin:t$a(e.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=c,this._updateDragState();const h=c$4.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,h),r.next(C$9(this.tool.view,_$4(e.renderLocation,h,p$6()))).next((e=>{const r=Y$1(e.plane),n=z$2(e.renderStart,e.renderEnd,c.origin,r),h=r$c.shortestSignedDiff(c.angle,n);c.angleDir=a$8(c.angleDir+h,-q$1,q$1),c.angle=n;const p=Rt(c,e),u=p-this._adapter.scale;if(c.scaleDir=a$8(c.scaleDir+u,-m$2,m$2),this._onScaleChanged(),"none"===c.mode){const t=this._mode||kt$1(e,e.plane,c.origin,this.tool.view.state.camera);if(r$4(t)){switch(t){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:a,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:a,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});}c.mode=t;}}switch(c.mode){case"rotate":l.state.angle=c.initialAngle+n;break;case"scale":l.state.scale=p,this._onScaleChanged();}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(c.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:a,angle:b$5(c.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:a,xScale:p,yScale:p});}break;case"end":switch(c.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:b$5(c.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:p,yScale:p});}}return "end"===e.action&&(this.startAnimation(wt(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),l.done()),e})).next(this._updateTooltipPipelineStep(c)),n.next((()=>{if(l.cancel(),r$4(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1});}this.startAnimation(wt(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState();}this._updateFocusTooltip();}));}));this._handles.add([r,e.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(Ot(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState();})),e.events.on("immediate-click",(t=>{t.stopPropagation();})),l$2((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),h$5)]);}_updateTooltipPipelineStep(t){return e=>{const a=this._tooltipOptions;if(!a.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const i=this._tooltip,o=this._tooltipOptions.visualVariables,r=r$4(o)?o.size:null,l=r$4(o)?o.rotation:null;switch(t.mode){case"scale":i.info=new s$1({tooltipOptions:a,scale:{value:this._adapter.scale},size:a$c(i$b(this._adapter.size,-1),"meters"),sizeUnit:r$4(r)?r.unit:null,sizePrecision:r$4(r)?At(r.valueType):null});break;case"rotate":{const t=r$4(l)?At(l.valueType):null,e=r$4(l)?l.rotationType:"geographic";i.info=new r$1({tooltipOptions:a,rotation:c$8(i$b(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:t,orientation:c$8(-this._adapter.angle,"radians","geographic"),orientationPrecision:t,rotationType:e});}}return e}}_updateFocusTooltip(){if(!this._tooltipOptions.enabled)return;if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=r$4(t)?t.rotation:null,a=r$4(t)?t.size:null;this._tooltip.info=new p({tooltipOptions:this._tooltipOptions,orientation:c$8(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:r$4(e)?At(e.valueType):null,rotationType:r$4(e)?e.rotationType:"geographic",size:a$c(i$b(this._adapter.size,-1),"meters"),sizeUnit:r$4(a)?a.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:r$4(a)?At(a.valueType):null});}else this._tooltip.clear();}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform();}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(yt.DelayedFocused,this.getFocused()),this._updateFocusTooltip();}_updateDragState(){if(this._ringManipulator.updateStateEnabled(yt.Unlocked,!(r$4(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),r$4(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(yt.ScaleIn|yt.ScaleOut,!1),this._ringManipulator.updateStateEnabled(yt.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(yt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(yt.RotateLeft|yt.RotateRight,!1),this._ringManipulator.updateStateEnabled(yt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(yt.ScaleOut,this._scaleRotateDragData.scaleDir>=0);}else this._ringManipulator.updateStateEnabled(yt.ScaleIn|yt.ScaleOut|yt.RotateLeft|yt.RotateRight,!1);}_updateManipulatorTransform(){const t=g$4(f$4.get(),this._adapter.angle,r$9(0,0,1));if(t$2(t))return;const e=this.getScale(),a=q$3(f$4.get(),o$4(c$4.get(),e,e,e));this._ringManipulator.modelTransform=u$6(f$4.get(),a,t);}_createRingManipulator(){const t=(t,e,a)=>{const i=[],o=Math.ceil(a$2*(e-t)/(2*Math.PI));for(let s=0;s<o+1;s++){const r=t+s*(e-t)/o;i.push(r$9(a*Math.cos(r),a*Math.sin(r),0));}return i},e=e=>t(0,2*Math.PI,e),a=t=>[[-t/2,0],[t/2,0],[t/2,i$2/2],[-t/2,i$2/2]],i=(t,e)=>k$2(a(e),t,[],[],!1),o=e(P$1),s=i(o,l$1),r={left:[],right:[]},n=[];for(let k=0;k<2;k++){const e=k*Math.PI-Math.PI/4,a=Math.PI/2-b,o=e+a,s=e+Math.PI/2-a,l=t(o,s,p$2),c=i(l,n$1);n.push(l),n.push(t(o,s,r$3-l$1/2)),r.left.push(c),r.right.push(c);for(let t=0;t<2;t++){const e=0===t,a=e$5();if(e){i$8(a,a,[1,-1,1]),f$6(a,a,-o,[0,0,1]);const t=Math.round(g$1*(l.length-1));a[12]=l[t][0],a[13]=l[t][1],a[14]=l[t][2];}else {f$6(a,a,s,[0,0,1]);const t=Math.round((1-g$1)*(l.length-1));a[12]=l[t][0],a[13]=l[t][1],a[14]=l[t][2];}const i=Z$2(s$2,0,x$1,i$2);B$2(i,a),(e?r.left:r.right).push(i);}}const l=[];for(let D=0;D<2;D++){const e=D*Math.PI-Math.PI/4,a=Math.PI/2-d$2,o=e+a,s=e+Math.PI/2-a,r=t(o,s,r$3);l.push(i(r,n$1));}const c=e(P$1+j$1),h=e(P$1+k),p=i(c,n$1),u=i(h,n$1),d=e(P$1-j$1),g=e(P$1-k),m=i(d,n$1),_=i(g,n$1),f=this._createMaterial(),M=this._createMaterial(.66),y=this._createMaterial(.5),b$1=this._createMaterial(.33);let T=[{geometry:s,material:f,stateMask:yt.DelayedFocused},{geometry:s,material:y,stateMask:t$6.None}];this._mode&&"scale"!==this._mode||(T=T.concat([{geometry:l,material:f,stateMask:yt.DelayedFocused|yt.Unlocked},{geometry:p,material:M,stateMask:yt.DelayedFocused|yt.ScaleIn},{geometry:u,material:b$1,stateMask:yt.DelayedFocused|yt.ScaleIn},{geometry:m,material:M,stateMask:yt.DelayedFocused|yt.ScaleOut},{geometry:_,material:b$1,stateMask:yt.DelayedFocused|yt.ScaleOut}])),this._mode&&"rotate"!==this._mode||(T=T.concat([{geometry:r.right,material:f,stateMask:yt.DelayedFocused|yt.Unlocked},{geometry:r.left,material:f,stateMask:yt.DelayedFocused|yt.RotateLeft},{geometry:r.right,material:f,stateMask:yt.DelayedFocused|yt.RotateRight}]));const R=[o,...n];return new ie({view:this.tool.view,renderObjects:T,autoScaleRenderObjects:!1,worldOriented:!0,radius:l$1,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:f$3(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:R,direction:r$9(0,0,1)}})}_createMaterial(t=1){const e=e$9([...t$1,t]);return new m$7({color:e,transparent:1!==t,cullFace:n$8.Back,renderOccluded:o$3.Transparent})}get test(){return {ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function Rt(t,e){const a=e$6(c$4.get(),e.renderStart,t.origin),i=e$6(c$4.get(),e.renderEnd,t.origin),o=s$8(a),s=s$8(i);return 0===o?0:s/o}function kt$1(t,e,a,i){const{renderStart:o,renderEnd:s}=t,r=jt(o,i,c$4.get()),n=jt(s,i,c$4.get());if(p$7(r,n)<f*f)return null;const l=e$6(c$4.get(),o,a),c=_$3(c$4.get(),l,Y$1(e)),h=o,p=u$4(c$4.get(),h,c),u=jt(a,i,c$4.get()),d=r,g=jt(p,i,c$4.get()),m=e$6(c$4.get(),g,d),_=e$6(c$4.get(),r,u),f$1=p$8(d,m),M=p$8(u,_);return b$6(f$1,n)<b$6(M,n)?"rotate":"scale"}function jt(t,e,a){return e.projectToScreen(t,It),o$4(a,It[0],It[1],0)}function wt(t,e){let a=null,i=1;const o=()=>i;return {start:()=>{i=t.getScale(),a=t.getScale,t.getScale=o,e();},update:t=>(i+=((i+1)/2-i)*Math.min(t*v$1,1),e(),Math.abs(i-1)<.01?bt.STOP:bt.CONTINUE),destroy:()=>{t.getScale=a,e();}}}function Ot(t,e){let a=0,i=null;const o=()=>!1;return {start:()=>{i=t.getFocused,t.getFocused=o,a=0,e();},update:t=>(a+=t,!i()||a>u$1?bt.STOP:bt.CONTINUE),destroy:()=>{t.getFocused=i,e();}}}function At(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP";}(bt||(bt={}));const It=i$5();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function r(t){return r$4(t.geometry)&&"mesh"===t.geometry.type?o(t.geometry):n(t)}function o(t){return r$4(t.transform)?m$1(t,t.transform):i(t)}function n(e){let r=e.geometry,o=n$a;return {undo(e){o=e.geometry,e.geometry=r;},redo(e){r=e.geometry,e.geometry=o;}}}function m$1(t,r){let o=r.clone(),n=null;return {undo:r=>{n=r$4(t.transform)?t.transform.clone():null,t.transform=o,r.notifyGeometryChanged();},redo:r=>{o=r$4(t.transform)?t.transform.clone():null,t.transform=n,r.notifyGeometryChanged();}}}function i(e){let t,r=e.vertexAttributes.clonePositional();return {undo:o=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=r,o.notifyGeometryChanged();},redo:o=>{r=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,o.notifyGeometryChanged();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let d$1=class extends d$8{constructor(t){super(t),this._interactionState=null;}initialize(){this.addHandles([f$5((()=>r$4(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(({interactionState:t})=>{this._updateMeshRotation(t);}),U$4),f$5((()=>r$4(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(({interactionState:t})=>{this._updateMeshSize(t);}),U$4)]);}get angle(){const t=this.geometry.transform;if(t$2(t))return 0;const e=g$6(t.rotation)[2];return Math.abs(e)>.999999?m$6(l$8(t.rotation))*Math.sign(e):0}get scale(){return r$4(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new y$1({angle:this.angle});this._interactionState=t;const e=()=>this._interactionState=null;return {state:t,done:e,cancel:()=>{t.cancel(),e();}}}createUndoRecord(){return r(this.graphic)}_updateMeshRotation(t){const e=this.geometry.anchor,i=this.viewingMode===l$9.Global,{angle:o,previousAngle:a}=t;this.geometry.rotate(0,0,b$5(o-a),{origin:e,geographic:i}),t.previousAngle=o,r$4(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged();}_updateMeshSize(t){const e=this.geometry.anchor,i=this.viewingMode===l$9.Global,{scale:o,previousScale:r}=t;this.geometry.scale(o/r,{origin:e,geographic:i}),t.previousScale=o,r$4(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged();}};e$2([y$3({constructOnly:!0})],d$1.prototype,"graphic",void 0),e$2([y$3({constructOnly:!0})],d$1.prototype,"geometry",void 0),e$2([y$3({constructOnly:!0})],d$1.prototype,"viewingMode",void 0),e$2([y$3()],d$1.prototype,"angle",null),e$2([y$3()],d$1.prototype,"scale",null),e$2([y$3()],d$1.prototype,"_interactionState",void 0),d$1=e$2([n$3("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],d$1);let y$1=class extends m$3{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle;}get state(){const{angle:t,scale:e}=this;return {angle:t,scale:e}}cancel(){this.angle=this.initialAngle,this.scale=1;}};e$2([y$3()],y$1.prototype,"angle",void 0),e$2([y$3()],y$1.prototype,"initialAngle",void 0),e$2([y$3()],y$1.prototype,"previousAngle",void 0),e$2([y$3()],y$1.prototype,"previousScale",void 0),e$2([y$3()],y$1.prototype,"scale",void 0),e$2([y$3()],y$1.prototype,"state",null),y$1=e$2([n$3("InteractionState")],y$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let y=class extends d$8{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null;}initialize(){this.addHandles(f$5((()=>r$4(this._interactionState)?this._interactionState.state:null),(t=>{this._updateSymbol(t);}),U$4));}get angle(){return r$4(this._interactionState)?this._interactionState.angle:r$4(this._orientationReferenceSymbolLayer)?g(this._orientationReferenceSymbolLayer.heading):0}get scale(){return r$4(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return r$4(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if(t$2(t))return null;const e=this.findLayerView(),i=this._graphicSymbol;if(t$2(e)||t$2(i)||"point-3d"!==i.type)return null;const o=e.getSymbolLayerSize(i,t);if("size"in o&&r$4(o.size))return o.size;const r=this.sizeAxis;return "width"in o&&r$4(o.width)&&(t$2(r)||"width"===r||"all"===r||"width-and-depth"===r)?o.width:"depth"in o&&r$4(t.depth)&&(t$2(r)||"depth"===r||"all"===r||"width-and-depth"===r)?o.depth:"height"in o&&r$4(t.height)&&(t$2(r)||"height"===r||"all"===r)?o.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return t$2(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return t$2(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&r$4(t.heading)))}get _graphicSymbol(){return r$4(this.graphic)&&r$4(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t;}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(r$4(this._interactionState)||t$2(t)||t$2(e))return m;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),o=t.clone(),r=this.angle,s=new d({originalSymbol:o,angle:r,initialSizes:i});this._interactionState=s;const a=()=>this._interactionState=null;return {state:s,done:a,cancel:()=>{this._graphicSymbol=o,a();}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return {undo:i=>{e=i.symbol,i.symbol=t;},redo:i=>{t=i.symbol,i.symbol=e;}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:r}){const a=this._graphicSymbol;if(t$2(a)||"point-3d"!==a.type)return;const c=a.clone(),h=-b$5(e-this.initialAngle);let p=!1;this._forEachObjectSymbolLayerPair(i,c,((e,i,o)=>{const l=i$b(e.heading,0)+h;i.heading!==l&&(i.heading=l,p=!0);const a=r[o];if(r$4(a)&&"width"in a){a.width=this.sizeFilter(a.width),a.height=this.sizeFilter(a.height),a.depth=this.sizeFilter(a.depth);const e=a.width*t;i.width!==e&&(i.width=e,p=!0);const o=a.depth*t;i.depth!==o&&(i.depth=o,p=!0);const r=a.height*t;i.height!==r&&(i.height=r,p=!0);}})),p&&(this._graphicSymbol=c);}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,o)=>{const r=e.symbolLayers.getItemAt(o);"object"===t.type&&"object"===r.type&&i(t,r,o);}));}};function g(t){return -m$6(t)}e$2([y$3()],y.prototype,"angle",null),e$2([y$3()],y.prototype,"scale",null),e$2([y$3()],y.prototype,"relativeAngle",null),e$2([y$3()],y.prototype,"initialAngle",null),e$2([y$3()],y.prototype,"size",null),e$2([y$3()],y.prototype,"sizeAxis",void 0),e$2([y$3({constructOnly:!0})],y.prototype,"graphic",void 0),e$2([y$3()],y.prototype,"_interactionState",void 0),e$2([y$3({constructOnly:!0})],y.prototype,"findLayerView",void 0),e$2([y$3({constructOnly:!0})],y.prototype,"sizeFilter",void 0),e$2([y$3()],y.prototype,"_sizeReferenceSymbolLayer",null),e$2([y$3()],y.prototype,"_orientationReferenceSymbolLayer",null),e$2([y$3()],y.prototype,"_graphicSymbol",null),y=e$2([n$3("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],y);const m={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let d=class extends m$3{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle;}get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:o,initialSizes:r}=this;return {originalSymbol:t,angle:e,initialAngle:i,scale:o,initialSizes:r}}};e$2([y$3()],d.prototype,"originalSymbol",void 0),e$2([y$3()],d.prototype,"angle",void 0),e$2([y$3()],d.prototype,"initialAngle",void 0),e$2([y$3()],d.prototype,"initialSizes",void 0),e$2([y$3()],d.prototype,"scale",void 0),e$2([y$3()],d.prototype,"state",null),d=e$2([n$3("InteractionState")],d);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let V=class extends(a$9(n$7.EventedMixin(p$3))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new p$4,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new u$7,this._tooltip=null;}initialize(){const{graphic:t,view:e}=this;this.graphicState=new e$1({graphic:t}),this.addHandles(l$2((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new m$8({view:e}):s$7(this._tooltip);}),w$3)),this._moveManipulation=new u({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&t$7(t),radius:u.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation();})))));const i=t=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const i=this._tooltip;t$2(i)||("focus"===e?this._updateMoveTooltip(t):i.clear());})));};this._moveManipulation.xyManipulation.forEachManipulator(i(M$1.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(M$1.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(M$1.Z)),this._moveManipulation.elevationInfo=f$3(t);const r=t.geometry;if(this._moveManipulation.createGraphicDragPipeline(((i,a,n,s,p)=>(r$4(r)&&i===M$1.XY&&(n=n.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new e$7({elevationInfo:f$3(t),pointer:p,editGeometryOperations:V$3.fromGeometry(new w$4({spatialReference:r.spatialReference}),e.state.viewingMode),visualizer:new _$1,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:s,useZ:!1}),this._snappingPipeline.next)),n=n.next((t=>(this._updateMoveTooltip(i,t),t))))),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:o}=t,n={graphic:i,dxScreen:a,dyScreen:o};switch(e){case"start":this.emit("graphic-translate-start",n),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n);}})),this._moveManipulation.angle=r$4(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(l$2((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Tt({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())));}this.handles.add([i$3({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>n$4()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),l$2((()=>e.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof ie&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())));})),this.finishToolCreation();}destroy(){this._tooltip=s$7(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=s$7(this._scaleRotate),this._scaleRotateAdapter=s$7(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null);}_updateManipulatorsInteractive(){t$2(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing);}_createScaleRotateAdapter(){return r$4(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new d$1({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new y({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:r$4(this.tooltipOptions.visualVariables)&&r$4(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),r$4(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t);}_hideManipulatorsForGraphicState(){return l$2((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&t$7(this.graphic);}))}_createGeometryUndoRecord(){return r(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t);}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,r$4(this._scaleRotate)&&(this._scaleRotate.location=t);}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,r$4(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t);}reset(){}onHide(){r$4(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation();}_onScaleChanged(){if(t$2(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t;}_updateMoveAngle(){this.view.state.viewingMode===l$9.Local||this.view.scale<w?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0;}_onGeometryChanged(){C$8(this.view,this,this.graphic);}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if(t$2(a))return;a.clear();const o=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case M$1.XY:a.info=new r$b({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>a$b(t,e,o)));break;case M$1.XY_AXIS:a.info=new a$a({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=a$b(t,i,o);return y$5(a,i$1(e))}));break;case M$1.Z:a.info=new p$5({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,v$5);}}_updateMoveTooltipDistance(t,e,i){if(r$4(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,s=i(a,n);t.distance=r$4(s)?s:j$5;}}get test(){return {discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:r$4(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};e$2([y$3({constructOnly:!0,nonNullable:!0})],V.prototype,"view",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],V.prototype,"graphic",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],V.prototype,"enableZ",void 0),e$2([y$3()],V.prototype,"enableRotation",void 0),e$2([y$3()],V.prototype,"enableScaling",void 0),e$2([y$3({constructOnly:!0,type:p$4})],V.prototype,"tooltipOptions",void 0),e$2([y$3()],V.prototype,"graphicState",void 0),e$2([y$3({value:!1})],V.prototype,"snapToScene",null),e$2([y$3({constructOnly:!0})],V.prototype,"snappingManager",void 0),e$2([y$3({readOnly:!0})],V.prototype,"type",void 0),e$2([y$3({readOnly:!0})],V.prototype,"updating",null),V=e$2([n$3("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],V);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
class s{constructor(){this._lastDragEvent=null,this.next=new G$6,this._enabled=!1;}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&r$4(this._lastDragEvent)){const t={...this._lastDragEvent,action:"update"};a&&this._adjustScaleFactors(t),this.next.execute(t);}this._enabled=a;}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=se(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e;}get test(){return {_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
function S(s,o){return _(s,o,!1)}function Y(s,o){return _(s,o,!0)}function _(s,o,i){if(s instanceof t$b){if(s.operation instanceof t$c)return z(s.operation,o,i),!0;if(s.operation instanceof s$9)return P(s.operation,o,i),!0;if(s.operation instanceof c$9)return U(s.operation,o,i),!0}return !1}function z(s,o,i=!1){const t=i?-1:1,n=r$9(t*s.dx,t*s.dy,t*s.dz);u$4(o.origin,o.origin,n);}function P(s,o,i=!1){const t=i?-s.angle:s.angle;T$7(o.basis1,o.basis1,f$7,t),T$7(o.basis2,o.basis2,f$7,t);}function U(s,o,t=!1){const n=t?1/s.factor1:s.factor1,r=t?1/s.factor2:s.factor2;g$2(o.basis1,o.basis1,n),g$2(o.basis2,o.basis2,r),w$5(o.origin,o.origin,s.origin,s.axis1,n),w$5(o.origin,o.origin,s.origin,s.axis2,r);}function A(s,o,i,b){b||(b=G$8());const f=r$5(t$d.get(),s[1],-s[0]),u=r$5(t$d.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),m=r$5(t$d.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=t$d.get();o.components.forEach((o=>o.vertices.forEach((o=>{const i=o.pos;r$5(p,j$6(s,i),j$6(f,i)),f$8(u,u,p),M$9(m,m,p);}))));const I=1e-6,d=r$5(t$d.get(),m[0]-u[0]<I?i/2:0,m[1]-u[1]<I?i/2:0);return o$8(u,u,d),s$3(m,m,d),l$3(b.basis1,s,(m[0]-u[0])/2),l$3(b.basis2,f,(m[1]-u[1])/2),r$5(b.origin,u[0]*s[0]+u[1]*f[0],u[0]*s[1]+u[1]*f[1]),s$3(b.origin,b.origin,b.basis1),s$3(b.origin,b.origin,b.basis2),b}function G(s,o,i,t=0,n){n||(n=G$8()),o.toRenderCoords(s.origin,i,n.origin);const r=c$4.get();u$4(r,s.origin,s.basis1),u$4(r,r,s.basis2),o.toRenderCoords(r,i,r);const a=c$4.get();u$4(a,s.origin,s.basis1),e$6(a,a,s.basis2),o.toRenderCoords(a,i,a);const e=c$4.get();e$6(e,s.origin,s.basis1),e$6(e,e,s.basis2),o.toRenderCoords(e,i,e);const c=c$4.get();e$6(c,s.origin,s.basis1),u$4(c,c,s.basis2),o.toRenderCoords(c,i,c);const g=A$7(c$4.get(),r,a,.5);e$6(g,g,n.origin);const f=A$7(c$4.get(),e,c,.5);e$6(f,n.origin,f),A$7(n.basis1,g,f,.5);const h=A$7(c$4.get(),c,r,.5);e$6(h,h,n.origin);const l=A$7(c$4.get(),a,e,.5);e$6(l,n.origin,l),A$7(n.basis2,h,l,.5);const x=_$3(c$4.get(),n.basis1,n.basis2),V=_$3(x,x,n.basis1);return z$1(V,V),g$2(n.basis2,V,P$4(n.basis2,V)),g$2(n.basis1,n.basis1,1+t/s$8(n.basis1)),g$2(n.basis2,n.basis2,1+t/s$8(n.basis2)),H$3(n),n}function M(i,t,n,r){const a=c$4.get();e$6(a,e$6(a,i.origin,i.basis1),i.basis2);const e=c$4.get();q$5(e,a,i.basis1,2);const c=c$4.get();q$5(c,e,i.basis2,2);const g=c$4.get();q$5(g,a,i.basis2,2),a[2]=e[2]=c[2]=g[2]=t;const b=r?"on-the-ground":"absolute-height",f=p$9(g$7(a,e,n,b),g$7(g,c,n,b)),u=p$9(g$7(e,c,n,b),g$7(a,g,n,b));return t$2(u)||t$2(f)?null:[f,u]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
let Zt=class extends(n$7.EventedMixin(p$3)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new p$4,this._preserveAspectRatio=new s,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new t$5,this._moveZManipulator=null,this._resizeManipulators=null,this._rotateManipulator=null,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=G$8(),this._mapBoundsStart=G$8(),this._zmax=0,this._sizeStart=null,this._displayBounds=G$8(),this._displayBoundsStart=G$8(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=n$5(),this._endScale=n$5();}initialize(){const{view:t,graphic:e,manipulators:i,_handles:s}=this,r=this._graphicState=new e$1({graphic:e}),n=e.geometry;this._editGeometryOperations=V$3.fromGeometry(n,t.state.viewingMode),this._graphicMoveManipulation=new l({tool:this,view:t,graphicState:r}),this._moveZManipulator=oe(t,_e.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Ae,s.add([this._createMoveXYGraphicDragPipeline(),l$2((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,A$2.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=ue$1(t,e);return s.add([l$2((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,A$2.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=o$9(t.toolViewManager.textures),this._rotateManipulator=R$3(t,{texture:this._rotateManipulatorTexture.texture}),s.add([l$2((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,A$2.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t);})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const p=i$3({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>n$4()});r$4(p)&&(this._outlineVisualElement=p.visualElement instanceof S$2?p.visualElement:null),r$4(this._outlineVisualElement)&&s.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),s.add(p),s.add([r.on("changed",(()=>this._onGeometryChanged())),l$2((()=>r.displaying),(()=>this._updateAllManipulatorAvailability())),l$2((()=>r.isDraped),(()=>this._graphicDrapedChanged()),h$5),t.trackGraphicState(r)]);const l$1=t.pointsOfInterest;l$1&&s.add(l$2((()=>l$1.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));const d=t=>{s.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability();})));};this._forEachManipulator(d);const u=(t,i)=>{s.add(t.events.on("immediate-click",(t=>{i===A$2.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation();})));};this._forEachManipulator(u),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation();}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null);}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new m$8({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo();};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear();})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a();})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a();})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a();})),this.on("graphic-scale-start",(t=>{r$5(this._startScale,t.xScale,t.yScale),r$5(this._endScale,t.xScale,t.yScale),a();})),this.on("graphic-scale",(t=>{r$5(this._endScale,t.xScale,t.yScale),a();})),this.on("graphic-scale-stop",(()=>{r$5(this._startScale,0,0),r$5(this._endScale,0,0),a();}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a();}))]);}));}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=i$b(this._moveXYTooltipInfo,(()=>new r$b({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo=i$b(this._moveZTooltipInfo,(()=>new p$5({tooltipOptions:this.tooltipOptions}))),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=D$4(e,i,this.view.spatialReference);if(t$2(a))return null;t.distance=a;}else t.distance=a$c(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo=i$b(this._rotateTooltipInfo,(()=>new i$c({tooltipOptions:this.tooltipOptions})));return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if(t$2(t))return null;const e=this._scaleTooltipInfo=i$b(this._scaleTooltipInfo,(()=>new p$a({tooltipOptions:this.tooltipOptions}))),i=M(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return t$2(i)?null:(e.xSize=i[0],e.ySize=i[1],r$4(this._sizeStart)&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(Ct),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{r$4(this._attachmentOrigin)&&w$2(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds();})),Ct);}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)));}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof ie){const a=this._graphicState.displaying,s=this.enableZ&&t$7(this.graphic);switch(e){case A$2.ROTATE:t.available=a&&this.enableRotation;break;case A$2.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||s),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?Me:Le;break;case A$2.TRANSLATE_Z:t.available=a&&s;break;default:t.available=a;}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,A$2.SCALE))),t(this._rotateManipulator,A$2.ROTATE),t(this._moveZManipulator,A$2.TRANSLATE_Z);}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t);}get _moveUnit(){return i$b(Z$3(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds();}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=o$8(t$d.get(),i.leftVertex.pos,i.rightVertex.pos);v$2(a,a);const s=i$b(N$3(this.view,this.graphic),(()=>t.extent.center));let o=Xt*this.view.pixelSizeAt(s);const n=this.view.spatialReference,p=t.spatialReference;n.equals(p)||(o*=$(n)/$(p)),A(a,e,o,this._mapBounds),this._updateZMax();}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos);i=Math.max(a,i);}this._zmax=i;}_updateDisplayBounds(){const t=this.graphic.geometry;if(t$2(t))return;const e=r$4(this._outlineVisualElement)&&!this._graphicState.isDraped&&r$4(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:N$3(this.view,this.graphic);this._attachmentOrigin=i$b(e,t.extent.center);const i=r$4(e)?e.z:m$5(this._mapBounds.origin,this.view.elevationProvider,h$4.fromElevationInfo(f$3(this.graphic)),this.view.renderCoordsHelper),a=X$2(this._mapBounds);a.origin[2]=i,G(a,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators();}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent.center;return kt*this.view.pixelSizeAt(e)}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,M$1.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return d$6(this._moveZManipulator,((i,a,s)=>{const o=t$a(i.renderLocation),r=a.next(G$7(t,o,e)).next(U$2());this._applyGraphicMoveSteps(r,s,M$1.Z);}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next(P$5()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||t.mapEnd.z-t.mapStart.z)&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e);}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{r$4(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel();})),a}_updateOperationStartProperties(){X$2(this._displayBounds,this._displayBoundsStart),X$2(this._mapBounds,this._mapBoundsStart),t$2(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=M(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped);}_moveDragUpdateGeometry(){return t=>{if(t$2(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const s of this._editGeometryOperations.data.components)e.push(...s.vertices);const i="start"===t.action?E$3.NEW_STEP:E$3.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return S(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===M$1.XY||e===M$1.XY_AXIS){const e=a$b(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");r$4(e)&&r$4(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=e);}return t}_onResizeGrab(t){if("start"!==t.action)return;const e=this._calculatePickRay(t.screenPoint);q$6(this._displayBounds.plane,e,c$4.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"});}_createResizeDragPipeline(t,e){return d$6(t,((t,i,a)=>{t$2(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(C$9(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e);}return t})),a.next((()=>{r$4(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel();})));}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,o=r$d(c$4.get(),e.origin);q$5(o,o,e.basis1,-i[0]),q$5(o,o,e.basis2,-i[1]);const r=e$6(c$4.get(),t.renderEnd,o),n=e$6(c$4.get(),t.renderStart,o),p=se(t.handle),l=re(e),h=re(this._displayBounds)/l,c=(t,e)=>{if(0===t)return 1;let i=s$8(e),o=.5*t*P$4(e,r)/i;const l=o<0?-1:1;if(p){o+=(i-.5*t*P$4(e,n)/i)*l*h;}const c=i<1.5*s?1:Yt;return i=Math.max(i-s,Yt),l>0&&(o-=a),l*Math.max(l*(o/i),c)};return {...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=r$d(n$6(),this._mapBoundsStart.origin);q$5(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),q$5(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=r$5(n$5(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);v$2(i,i);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s="start"===t.action?E$3.NEW_STEP:E$3.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,s,e$a.REPLACE);return X$2(this._mapBoundsStart,this._mapBounds),S(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab(t){if("start"!==t.action)return;const e=qt(this._displayBounds,this.view.renderCoordsHelper,Re$1.HEADING,p$6()),i=this._calculatePickRay(t.screenPoint);q$6(e,i,c$4.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:e});}_createRotateDragPipeline(t){return d$6(t,((t,e,i)=>{const a=this.inputState;t$2(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(C$9(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:b$5(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e);}return t})),i.next((()=>{r$4(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel();})));}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=Y$1(t.rotatePlane),a=z$2(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return {...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=r$d(n$6(),this._mapBoundsStart.origin),i=[];for(const o of this._editGeometryOperations.data.components)i.push(...o.vertices);const a="start"===t.action?E$3.NEW_STEP:E$3.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,e$a.REPLACE);return X$2(this._mapBoundsStart,this._mapBounds),S(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=d$a(),i=d$b(t);return s$a(this.view.state.camera,i,e),z$1(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=Bt(this._displayBounds,f$4.get());Kt(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{Jt(e,this._resizeHandles[i],t,this._displayBounds);}));}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:e$6(c$4.get(),i.origin,i.basis1),edge:2},s=f$4.get();m$c(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=a.position;}_cancel(){const t=this._editGeometryOperations.lastOperation;t$2(t)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Y(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null);}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(r$4(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Y(e$4(t),this._mapBounds),this._updateDisplayBounds();}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,S(e$4(t),this._mapBounds),this._updateDisplayBounds();}}get test(){return {resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};e$2([y$3({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],Zt.prototype,"graphic",void 0),e$2([y$3({constructOnly:!0,nonNullable:!0})],Zt.prototype,"enableZ",void 0),e$2([y$3()],Zt.prototype,"enableRotation",void 0),e$2([y$3()],Zt.prototype,"enableScaling",void 0),e$2([y$3({constructOnly:!0,type:p$4})],Zt.prototype,"tooltipOptions",void 0),e$2([y$3()],Zt.prototype,"preserveAspectRatio",null),e$2([y$3()],Zt.prototype,"grabbing",void 0),e$2([y$3()],Zt.prototype,"inputState",void 0),e$2([y$3({readOnly:!0})],Zt.prototype,"type",void 0),e$2([y$3()],Zt.prototype,"_moveUnit",null),Zt=e$2([n$3("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Zt);const Ct="draped-elevation-changes",kt=10,Xt=80,Yt=1e-6;

export { T$2 as DrawGraphicTool3D, Zt as ExtentTransformTool, B as GraphicMoveTool, v as GraphicReshapeTool, V as GraphicTransformTool };
