import { wt as t, aF as u, w7 as f$1, w6 as y$1, x0 as e, E as s, xp as d$1, wn as h, ck as l, wO as h$1, cD as e$1 } from './_virtual_index-1ea2035a.js';
import { o } from './fontUtils-49a60944.js';
import { u as u$1 } from './colorUtils-cf7dfb0b.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
const p="picture-fill",d="picture-marker",f="simple-fill",y="simple-line",w="simple-marker",g="text",v="Aa",b=t.size,x=t.maxSize,k=t.maxOutlineSize,M=t.lineWidth,z=225,L=document.createElement("canvas");function j(e,t){const a=L.getContext("2d"),n=[];return t&&(t.weight&&n.push(t.weight),t.size&&n.push(t.size+"px"),t.family&&n.push(t.family)),a.font=n.join(" "),a.measureText(e).width}const C=7.2/2.54,S=72/2.54;function F(e){if(0===e.length)return 0;if(e.length>2){const t=e$1(1),a=parseFloat(e);switch(e.slice(-2)){case"px":return a;case"pt":return a*t;case"in":return 72*a*t;case"pc":return 12*a*t;case"mm":return a*C*t;case"cm":return a*S*t}}return parseFloat(e)}function E(e){const t=e?.size;return {width:null!=t&&"object"==typeof t&&"width"in t?u(t.width):null,height:null!=t&&"object"==typeof t&&"height"in t?u(t.height):null}}async function U(e,t){const a=t.fill,n=e.color;if("pattern"===a?.type&&n&&e.type!==p){const e=await h$1(a.src,n.toCss(!0));a.src=e,t.fill=a;}}async function Z(e,t,n,l){if(!("font"in e)||!e.font||"text"!==t.shape.type)return;try{await o(e.font);}catch{}const{width:i}=E(l),s=/[\uE600-\uE6FF]/.test(t.shape.text);null!=i||s||(n[0]=j(t.shape.text,{weight:t.font.weight,size:t.font.size,family:t.font.family}));}function q(e,t){return e>t?"dark":"light"}function D(e$1,t){const a="number"==typeof t?.size?t?.size:null,l=null!=a?u(a):null,o=null!=t?.maxSize?u(t.maxSize):null,r=null!=t?.rotation?t.rotation:"angle"in e$1?e$1.angle:null,m=f$1(e$1);let u$1=y$1(e$1);"dark"!==T(e$1,245)||t?.ignoreWhiteSymbols||(u$1={width:.75,...u$1,color:"#bdc3c7"});const h={shape:null,fill:m,stroke:u$1,offset:[0,0]};u$1?.width&&(u$1.width=Math.min(u$1.width,k));const z=u$1?.width||0;let L=null!=t?.size&&(null==t?.scale||t?.scale),C=0,S=0,U=!1;switch(e$1.type){case w:{const a=e$1.style,{width:i,height:s}=E(t),c=i===s&&null!=i?i:null!=l?l:Math.min(u(e$1.size),o||x);switch(C=c,S=c,a){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*c},L||(C+=z,S+=z);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*S]},{command:"L",values:[C,.5*S]},{command:"M",values:[.5*C,0]},{command:"L",values:[.5*C,S]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*S]},{command:"L",values:[.5*C,0]},{command:"L",values:[C,.5*S]},{command:"L",values:[.5*C,S]},{command:"Z",values:[]}]},L||(C+=z,S+=z);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,0]},{command:"L",values:[C,S]},{command:"L",values:[0,S]},{command:"Z",values:[]}]},L||(C+=z,S+=z),r&&(U=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*C,0]},{command:"L",values:[C,S]},{command:"L",values:[0,S]},{command:"Z",values:[]}]},L||(C+=z,S+=z),r&&(U=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,S]},{command:"M",values:[C,0]},{command:"L",values:[0,S]}]},r&&(U=!0);break;case"path":h.shape={type:"path",path:e$1.path||""},L||(C+=z,S+=z),r&&(U=!0),L=!0;}break}case y:{const{width:e,height:a}=E(t),n=null!=a?a:null!=l?l:z,i=null!=e?e:M;u$1&&(u$1.width=n),C=i,S=n;const s=h?.stroke?.cap||"butt",o="round"===s;L=!0,h.stroke&&(h.stroke.cap="butt"===s?"square":s),h.shape={type:"path",path:[{command:"M",values:[o?n/2:0,S/2]},{command:"L",values:[o?C-n/2:C,S/2]}]};break}case p:case f:{const e$1="object"==typeof t?.symbolConfig&&t?.symbolConfig.isSquareFill,{width:a,height:n}=E(t);C=!e$1&&a!==n||null==a?null!=l?l:b:a,S=!e$1&&a!==n||null==n?C:n,L||(C+=z,S+=z),L=!0,h.shape=e$1?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[C,0]},{command:"L",values:[C,S]},{command:"L",values:[0,S]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:e.fill[0];break}case d:{const a=Math.min(u(e$1.width),o||x),i=Math.min(u(e$1.height),o||x),{width:s,height:c}=E(t),m=s===c&&null!=s?s:null!=l?l:Math.max(a,i),u$1=a/i;C=u$1<=1?Math.ceil(m*u$1):m,S=u$1<=1?m:Math.ceil(m/u$1),h.shape={type:"image",x:-Math.round(C/2),y:-Math.round(S/2),width:C,height:S,src:e$1.url||""},r&&(U=!0);break}case g:{const a=e$1,i=t?.overrideText||a.text||v,s=a.font,{width:r,height:c}=E(t),m=null!=c?c:null!=l?l:Math.min(u(s.size),o||x),u$1=j(i,{weight:s.weight,size:m,family:s.family}),p=/[\uE600-\uE6FF]/.test(i);C=r??(p?m:u$1),S=m;let d=.25*F((s?m:0).toString());p&&(d+=5),h.shape={type:"text",text:i,x:a.xoffset||0,y:a.yoffset||d,align:"middle",alignBaseline:a.verticalAlignment,decoration:s&&s.decoration,rotated:a.rotated,kerning:a.kerning},h.font=s&&{size:m,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return {shapeDescriptor:h,size:[C,S],renderOptions:{node:t?.node,scale:L,opacity:t?.opacity,rotation:r,useRotationSize:U,effectView:t?.effectView}}}async function O(e,a){const{shapeDescriptor:n,size:l,renderOptions:i}=D(e,a);if(!n.shape)throw new s("symbolPreview: renderPreviewHTML2D","symbol not supported.");await U(e,n),await Z(e,n,l,a);const s$1=[[n]];if("object"==typeof a?.symbolConfig&&a?.symbolConfig.applyColorModulation){const e=.6*l[0];s$1.unshift([{...n,offset:[-e,0],fill:d$1(n.fill,-.3)}]),s$1.push([{...n,offset:[e,0],fill:d$1(n.fill,.3)}]),l[0]+=2*e,i.scale=!1;}return h(s$1,l,i)}function T(t,a=z){const n=f$1(t),l$1=y$1(t),o=!n||"type"in n?null:new l(n),r=l$1?.color?new l(l$1?.color):null,c=o?q(u$1(o),a):null,m=r?q(u$1(r),a):null;return m?c?c===m?c:a>=z?"light":"dark":m:c}

export { T as getContrastingBackgroundTheme, D as getRenderSymbolParameters, O as previewSymbol2D };
