/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import t from"../request.js";import{e as s}from"../core/lang.js";import{throwIfAborted as r}from"../core/promiseUtils.js";import{g as e,a,b as n}from"./infoFor3D.js";class i{constructor(t,s,r){this.assetName=t,this.assetMimeType=s,this.parts=r}equals(t){return this===t||this.assetName===t.assetName&&this.assetMimeType===t.assetMimeType&&s(this.parts,t.parts,((t,s)=>t.equals(s)))}isOnService(t){return this.parts.every((s=>s.isOnService(t)))}makeHash(){let t="";for(const s of this.parts)t+=s.partHash;return t}async toBlob(t){const{parts:s}=this;if(1===s.length)return s[0].toBlob(t);const e=await Promise.all(s.map((s=>s.toBlob(t))));return r(t),new Blob(e)}}class o{constructor(t,s){this.partUrl=t,this.partHash=s}equals(t){return this===t||this.partUrl===t.partUrl&&this.partHash===t.partHash}isOnService(t){return this.partUrl.startsWith(`${t.path}/assets/`)}async toBlob(s){const{data:e}=await t(this.partUrl,{responseType:"blob"});return r(s),e}}function u(t){return s=t?.source,!!s&&(Array.isArray(s)?s.some(p):p(s));var s}function c(t){return!!Array.isArray(t)&&t.every((t=>t instanceof i))}const l=/^(model\/gltf\+json)|(model\/gltf-binary)$/,f=/\.(gltf|glb)/i;function p(t){if(t instanceof File){const{type:s,name:r}=t;return l.test(s)||f.test(r)}return l.test(t.assetMimeType)||f.test(t.assetName)}function m(t,s){if(!t)return!1;const{source:r}=t;return function(t,s){if(Array.isArray(t)){const r=t;return r.length>0&&r.every((t=>y(t,s)))}return y(t,s)}(r,s)}function h(t,s){if(t===s)return!0;const{source:r}=t,{source:e}=s;if(r===e)return!0;if(c(r)&&c(e)){if(r.length!==e.length)return!1;const t=(t,s)=>t.assetName<s.assetName?-1:t.assetName>s.assetName?1:0,s=[...r].sort(t),a=[...e].sort(t);for(let t=0;t<s.length;++t)if(!s[t].equals(a[t]))return!1;return!0}return!1}function y(t,s){return t instanceof i&&t.isOnService(s)}function g(t,s){return t instanceof File?e(t,s):a(t.assetMimeType,s)??n(t.assetName,s)}function b(t){return Array.isArray(t)?t:[t]}function N(t){return!!t.original}export{o as S,i as a,g as b,b as c,u as d,m as e,h as f,N as i};
