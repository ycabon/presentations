/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{C as e}from"./CIMSymbolHelper.js";import{y as t}from"./utils6.js";import{n as i,O as s,P as a,Q as r,u as o,S as n}from"./definitions.js";import{W as l,c as u,i as c,g as p,h as d,j as h,k as f,l as m,m as y,n as v,V as b}from"./Container.js";import{_ as g,b as x}from"./tslib.es6.js";import{l as w,u as S,V,e as z,G as _,M,f as P,t as T,h as I,F,s as C,i as A,j as O,k as R,o as E,p as D,q as L,S as B,r as k,v as U,w as H,x as N,y as W,A as j,z as G,B as q,D as $,E as K,H as Z,m as X,I as Y,J as Q,O as J,P as ee,K as te,L as ie,N as se,Q as ae,R as re,T as oe,W as ne,X as le,Y as ue,Z as ce,_ as pe,$ as de,a0 as he,a1 as fe,a2 as me,a3 as ye,a4 as ve,a5 as be,a6 as ge,a7 as xe,a8 as we,a9 as Se,aa as Ve,ab as ze,ac as _e,ad as Me,ae as Pe,af as Te,ag as Ie,ah as Fe,ai as Ce,aj as Ae,ak as Oe,al as Re,am as Ee,an as De,ao as Le,ap as Be,aq as ke,ar as Ue,as as He,at as Ne,au as We,av as je,aw as Ge,ax as qe,ay as $e,az as Ke,aA as Ze,aB as Xe,aC as Ye,aD as Qe,aE as Je,aF as et,aG as tt,aH as it,aI as st,U as at}from"./UpdateTracking2D.js";import{R as rt,i as ot}from"../core/lang.js";import{D as nt,U as lt,T as ut,b as ct,f as pt,m as dt,P as ht,l as ft,k as mt,n as yt}from"./enums.js";import{B as vt}from"./BufferObject.js";import{V as bt}from"./VertexArrayObject.js";import{V as gt}from"./VertexElementDescriptor.js";import{v as xt}from"./dataViewUtils.js";import{R as wt,a as St,F as Vt}from"./FramebufferObject.js";import{a as zt,T as _t}from"./Texture.js";import{L as Mt,n as Pt}from"./Logger.js";import{f as Tt}from"./maybe.js";import{l as It}from"./heatmapTextureUtils.js";import{d as Ft}from"./constants.js";import{r as Ct}from"./WGLContainer.js";import{t as At,a as Ot}from"./screenUtils.js";import{g as Rt}from"./unitUtils.js";import{m as Et}from"./lengthUtils.js";import Dt from"../core/Error.js";import{g as Lt}from"./capabilities.js";import{Q as Bt}from"./QueueProcessor.js";class kt{constructor(e){this.registryName=e,this.postProcessingEnabled=!1,this.overrideStencilRef=null,this.drawPhase=l.MAP|l.HITTEST|l.HIGHLIGHT|l.DEBUG,this.symbologyPlane=u.FILL}startup(){}shutdown(){}postProcess(e,t){}}class Ut extends V{}g([w(0,L)],Ut.prototype,"pos",void 0);class Ht extends z{}g([S(F)],Ht.prototype,"dotSize",void 0);class Nt extends z{}g([S(B)],Nt.prototype,"locations",void 0),g([S(F)],Nt.prototype,"pixelRatio",void 0),g([S(F)],Nt.prototype,"tileZoomFactor",void 0);class Wt extends _{vertex(e){const t=new M(1,0,0,0,-1,0,0,1,1).multiply(new P(e.pos.xy.divide(i),1)),s=T(this.draw.locations,t.xy),a=I(this.instance.dotSize.divide(2),new F(1));let r=new F(0);r=r.add(C(s.a,new F(1e-6)).multiply(2));let o=a.add(this.instance.dotSize);const n=this.view.displayViewScreenMat3.multiply(new P(e.pos.add(.5),1)),l=new A(n.xy,r,1),u=this.instance.dotSize.divide(o),c=new F(-1).divide(a.divide(o));return o=o.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:o,color:s,ratio:u,invEdgeRatio:c}}fragment(e){const t=O(e.glPointCoord.subtract(.5)).multiply(2),i=R(new F(0),new F(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),s=new D;return s.glFragColor=e.color.multiply(i),s}}g([S(Ht)],Wt.prototype,"instance",void 0),g([S(Nt)],Wt.prototype,"draw",void 0),g([S(k)],Wt.prototype,"view",void 0),g([x(0,E(Ut))],Wt.prototype,"vertex",null),g([x(0,E(class extends U{}))],Wt.prototype,"fragment",null);class jt extends W{}g([w(3,F)],jt.prototype,"inverseArea",void 0);class Gt extends z{}g([S(H.ofType(A,2))],Gt.prototype,"isActive",void 0),g([S(H.ofType(A,8))],Gt.prototype,"colors",void 0),g([S(F)],Gt.prototype,"dotValue",void 0);class qt extends z{}g([S(B)],qt.prototype,"dotTexture0",void 0),g([S(B)],qt.prototype,"dotTexture1",void 0),g([S(F)],qt.prototype,"tileZoomFactor",void 0),g([S(F)],qt.prototype,"pixelRatio",void 0),g([S(F)],qt.prototype,"tileDotsOverArea",void 0);class $t extends j{_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){const t=new M(2/i,0,0,0,-2/i,0,-1,1,1).multiply(new P(e.pos,1)),s=this.clip(e.id),a=new A(t.xy,s,1),r=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),o=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),n=this.draw.tileZoomFactor.multiply(i).divide(this.draw.pixelRatio),l=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(o,this.instance.dotValue,this.draw.tileDotsOverArea),c=e.pos.add(.5).divide(n);return{glPosition:a,color:new A(0,0,0,0),textureCoords:c,thresholds0:l,thresholds1:u}}fragment(e){const t=new D,i=T(this.draw.dotTexture0,e.textureCoords),s=T(this.draw.dotTexture1,e.textureCoords),a=e.thresholds0.subtract(i),r=e.thresholds1.subtract(s);let o;const n=G.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),l=G.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const e=C(new F(0),a),t=C(new F(0),r),i=q(e,a).add(q(t,r)),s=C(i,new F(0)),u=new F(1).subtract(s),c=i.add(s),p=a.multiply(e).divide(c),d=r.multiply(t).divide(c),h=n.multiply(p).add(l.multiply(d));o=u.multiply(h)}else{const e=I($(a),$(r)),t=C(e,new F(0)),i=new F(1).subtract(t),s=C(e,a),u=C(e,r),c=n.multiply(s).add(l.multiply(u));o=i.multiply(c)}return t.glFragColor=o,t}hittest(e){return K(this.hittestRequest)}}g([N],$t.prototype,"blending",void 0),g([S(Gt)],$t.prototype,"instance",void 0),g([S(qt)],$t.prototype,"draw",void 0),g([x(0,E(jt))],$t.prototype,"vertex",null),g([x(0,E(U))],$t.prototype,"fragment",null);const Kt={[nt.BYTE]:1,[nt.UNSIGNED_BYTE]:1,[nt.SHORT]:2,[nt.UNSIGNED_SHORT]:2,[nt.INT]:4,[nt.UNSIGNED_INT]:4,[nt.FLOAT]:4};class Zt{constructor(e,t){this._boundPart=null;const i=[];for(const s of t.vertex){const t=vt.createVertex(e,lt.STATIC_DRAW,s);i.push(t)}const s=[];for(const i of t.index||[]){const t=vt.createIndex(e,lt.STATIC_DRAW,i);s.push(t)}this.groups=[];for(const a of t.groups){let r;if(null!=a.index){if(!t.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:e}=t.index[a.index];2===e?r=nt.UNSIGNED_SHORT:4===e&&(r=nt.UNSIGNED_INT)}const o=null!=a.index?s[a.index]:null,n=new Map,l={},u={};for(const e of a.attributes){const{name:t,count:s,type:a,offset:r,normalized:o,divisor:c,stride:p,vertex:d,location:h}=e,f=`vertex-buffer-${d}`;let m=l[f];m||(m=l[f]=[]);const y=new gt(t,s,a,r,p,o,c);m.push(y),n.set(t,h),u[f]=i[d]}const c=new bt(e,n,l,u,o);this.groups.push({...a,vertexArray:c,locations:n,layout:l,indexing:r})}this.parts=t.parts}bind(e,t){this._boundPart=t;const{group:i}=this.parts[this._boundPart],{vertexArray:s}=this.groups[i];e.bindVAO(s)}draw(e){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:t,count:i}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{indexing:a,primitive:r}=this.groups[s];a?e.drawElements(r,i,a,t*Kt[a]):e.drawArrays(r,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){for(const{vertexArray:e}of this.groups)e.dispose()}}class Xt extends Zt{static create(e,t){const i=[];let{stride:s,hash:a}=t.layout;if(null==s){s=0;for(const{count:e,type:i,offset:a}of t.layout.attributes){if(null!=a)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=e*Kt[i]}}let r=0,o=0;for(const{count:e,name:a,offset:n,type:l,normalized:u}of t.layout.attributes){null!=n&&(o=n);const t={name:a,location:r,vertex:0,count:e,type:l,offset:o,stride:s,divisor:0,normalized:null!=u&&u};i.push(t),r++,o+=e*Kt[l]}const n={attributes:i,primitive:t.primitive};null!=t.index&&(n.index=0);let{count:l}=t;if(null==l&&(l=t.index?t.index.length:t.vertex.byteLength/s,Math.floor(l)!==l))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const u={start:0,count:l,group:0,primitive:t.primitive},c={vertex:[t.vertex],parts:[u],groups:[n]};return null!=t.index&&(c.index=[t.index]),null==a&&(a=xt(i)),new Xt(e,c,{hash:a,attributes:i,stride:s})}constructor(e,t,i){super(e,t),this.layout=i}bind(e,t=0){super.bind(e,t)}}class Yt{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){const t=i,s=i,a=new zt(t,s);a.samplingMode=ut.NEAREST,a.wrapMode=ct.CLAMP_TO_EDGE;const r=new wt(e,new St(pt.DEPTH_STENCIL,t,s));this._dotFBO=new Vt(e,a,r)}return this._dotFBO}getDotDensityMesh(e){if(null==this._dotMesh){const t=i,s=t*t,a=2,r=new Int16Array(s*a);for(let e=0;e<t;e++)for(let i=0;i<t;i++)r[a*(i+e*t)]=i,r[a*(i+e*t)+1]=e;const o=[{count:2,type:nt.UNSIGNED_SHORT,name:"a_position",offset:0}],n={hash:xt(o),attributes:o,stride:4};this._dotMesh=Xt.create(e,{primitive:dt.POINTS,vertex:r,count:s,layout:n})}return this._dotMesh}getDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){const s=new rt(i);this._dotTextures=[this._allocDotDensityTexture(e,t,s),this._allocDotDensityTexture(e,t,s)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){const s=new Float32Array(t*t*4);for(let e=0;e<s.length;e++)s[e]=i.getFloat();const a=new zt;return a.dataType=ht.FLOAT,a.samplingMode=ut.NEAREST,a.width=t,a.height=t,new _t(e,a,s)}}function Qt(e){const t=1/e;return{antialiasing:t,blur:0+t}}function Jt(e){return e?.25:1}class ei extends W{}g([w(5,L)],ei.prototype,"offset",void 0);class ti extends z{}g([S(F)],ti.prototype,"radius",void 0),g([S(F)],ti.prototype,"isFieldActive",void 0);class ii extends j{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){const{radius:t,isFieldActive:i}=this.kernelControls,s=e.offset,a=i.multiply(this.storage.getVVData(e.id).x).add(new F(1).subtract(i)),r=this.view.displayViewScreenMat3.multiply(new P(e.pos,1)).add(this.view.displayViewMat3.multiply(new P(s,0)).multiply(t)),o=this.clip(e.id);return{glPosition:new A(r.xy,o,1),offset:s,fieldValue:a,color:new A(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const{offset:t,fieldValue:i}=e,s=O(t),a=C(s,new F(1)),r=new F(1).subtract(s.multiply(s)),o=r.multiply(r),n=a.multiply(o).multiply(i).multiply(new F(Jt(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new A(n),e)}hittest(e){const{viewMat3:t,tileMat3:i}=this.view,s=t.multiply(i).multiply(new P(e.pos,1));return ie(s.xy,this.kernelControls.radius,this.hittestRequest.position)}}g([N],ii.prototype,"usesHalfFloatPrecision",void 0),g([S(ti)],ii.prototype,"kernelControls",void 0),g([x(0,E(ei))],ii.prototype,"vertex",null),g([x(0,E(class extends U{}))],ii.prototype,"fragment",null);class si extends V{}g([w(0,L)],si.prototype,"pos",void 0);class ai extends z{}g([S(B)],ai.prototype,"texture",void 0),g([S(L)],ai.prototype,"minAndInvRange",void 0),g([S(F)],ai.prototype,"normalization",void 0);class ri extends z{}g([S(B)],ri.prototype,"texture",void 0);class oi extends _{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new A(e.pos.multiply(2).subtract(1),1,1),uv:e.pos}}fragment(e){const{accumulatedDensity:t,gradient:i}=this;let s=T(t.texture,e.uv).r.multiply(new F(Jt(this.usesHalfFloatPrecision)));s=s.multiply(t.normalization),s=s.subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);const a=T(i.texture,new L(s,.5)),r=new D;return r.glFragColor=new A(a.rgb.multiply(a.a),a.a),r}}function ni(e,t){const i=t>1.5?.25:.5;return e<1/(2*i)?1:i}function li(e){return e.key.level+1}g([N],oi.prototype,"usesHalfFloatPrecision",void 0),g([S(ai)],oi.prototype,"accumulatedDensity",void 0),g([S(ri)],oi.prototype,"gradient",void 0),g([x(0,E(si))],oi.prototype,"vertex",null),g([x(0,E(class extends se{}))],oi.prototype,"fragment",null);const ui={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:li,compare:mt.GEQUAL,mask:255,op:{fail:yt.KEEP,zFail:yt.KEEP,zPass:yt.REPLACE}}}},ci={...ui,stencil:!1},pi={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function di(e,t){const{referenceScale:i,radius:s}=e;return s*(0!==i?i/t.scale:1)}class hi extends z{getVVRotationMat4(e){return ae(re(e),G.identity(),(()=>{const t=this._getNormalizedAngle(e).multiply(le),i=ue(t),s=ce(t);return new G(s,i,0,0,i.multiply(new F(-1)),s,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(e){return ae(re(e),M.identity(),(()=>{const t=this._getNormalizedAngle(e).multiply(le),i=ue(t),s=ce(t);return new M(s,i,0,i.multiply(new F(-1)),s,0,0,0,1)}))}_getNormalizedAngle(e){const t=oe(this.rotationType,new F(ne.Arithmatic));return ae(t,new F(90).subtract(e),e)}}g([S(F)],hi.prototype,"rotationType",void 0);class fi extends W{}g([w(3,A)],fi.prototype,"color",void 0),g([w(4,L)],fi.prototype,"offset",void 0),g([w(5,L)],fi.prototype,"textureUV",void 0),g([w(6,F)],fi.prototype,"fontSize",void 0),g([w(7,F)],fi.prototype,"referenceSize",void 0),g([w(8,F)],fi.prototype,"haloFontSize",void 0),g([w(9,A)],fi.prototype,"haloColor",void 0),g([w(10,L)],fi.prototype,"zoomRange",void 0),g([w(11,F)],fi.prototype,"clipAngle",void 0),g([w(12,A)],fi.prototype,"referenceSymbol",void 0);class mi extends j{constructor(){super(...arguments),this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t,i){const s=t.multiply(1.4173228346456692),a=de(this.view.rotation.subtract(s)),o=he(new F(360).subtract(a),a);let n=new F(0);const l=fe(this.view.currentZoom.multiply(r)).divide(r),u=e.x,c=e.y,p=new F(1).subtract(C(u,l)).multiply(2),d=C(new F(90),o).multiply(2),h=new F(2).multiply(new F(1).subtract(C(l,c)));return n=n.add(i.multiply(p)),n=n.add(i.multiply(d)),n=n.add(h),n}vertex(e){const t=me(e.bitset,ze),i=new F(1).subtract(t);let s=e.fontSize,a=s.divide(ye);const r=this.isHaloPass?e.haloColor:this._getVertexColor(e),n=me(e.bitset,_e),l=this.isLabel?r.multiply(I(this.storage.getAnimationValue(e.id),n)):r,u=this.view.displayViewScreenMat3.multiply(new P(e.pos.xy,1));let c=e.offset.xy;if(this.isLabel){if(!e.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const t=e.referenceSymbol,i=t.xy,s=t.z,a=this._unpackDirection(t.w),r=ve(this,e.id,s).divide(2),n=a.multiply(r.add(o));c=c.add(i).add(n)}else{const t=ve(this,e.id,e.referenceSize).divide(e.referenceSize);s=s.multiply(t),a=a.multiply(t),c=c.multiply(t),c=be(this,e.id).multiply(new P(c,0)).xy}const p=me(e.bitset,Me),d=this._getViewRotationMatrix(p).multiply(new P(c,0));let h=this.isLabel?this.clipLabel(e.zoomRange,e.clipAngle,p):this.clip(e.id,e.zoomRange);h=this.isBackgroundPass?h.add(i.multiply(2)):h.add(t.multiply(2));const f=new A(u.xy.add(d.xy),h,1),m=e.textureUV.divide(this.mosaicInfo.size);let y=new F(0);return this.isHaloPass&&(y=e.haloFontSize.divide(a).divide(ge)),{glPosition:f,color:l,size:a,textureUV:m,antialiasingWidth:new F(.105*ye).divide(s),haloDistanceOffset:y,...this.maybeRunHittest(e,{},{fontSize:s,offset:c})}}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,s=new F(1).subtract(e);return t.multiply(e).add(i.multiply(s))}fragment(e){const t=new F(2/8),i=new F(1).subtract(t),s=T(this.mosaicInfo.texture,e.textureUV).a;let a=i.subtract(e.haloDistanceOffset);this.highlight&&(a=a.divide(2));const r=e.antialiasingWidth,o=R(a.subtract(r),a.add(r),s);return this.getFragmentOutput(e.color.multiply(o),e)}hittest(e,t,{fontSize:i,offset:s}){const{viewMat3:a,tileMat3:r}=this.view,o=a.multiply(r).multiply(new P(e.pos,1)).add(r.multiply(new P(s,0)));return ie(o.xy,i.divide(2),this.hittestRequest.position)}_unpackDirection(e){const t=new xe(e),i=we(t,new xe(2)),s=Se(t,new xe(3));return new L(new F(i).subtract(1),new F(s).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){const i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new Ve(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(e.id),s=this.visualVariableOpacity.getOpacity(i);t=t.multiply(s)}return t}}g([pe(Pe)],mi.prototype,"visualVariableColor",void 0),g([pe(Te)],mi.prototype,"visualVariableOpacity",void 0),g([pe(hi)],mi.prototype,"visualVariableRotation",void 0),g([pe(Ie)],mi.prototype,"visualVariableSizeMinMaxValue",void 0),g([pe(Fe)],mi.prototype,"visualVariableSizeScaleStops",void 0),g([pe(Ce)],mi.prototype,"visualVariableSizeStops",void 0),g([pe(Ae)],mi.prototype,"visualVariableSizeUnitValue",void 0),g([S(Oe)],mi.prototype,"mosaicInfo",void 0),g([N],mi.prototype,"isHaloPass",void 0),g([N],mi.prototype,"isBackgroundPass",void 0),g([N],mi.prototype,"isLabel",void 0),g([x(0,E(fi))],mi.prototype,"vertex",null),g([x(0,E(class extends U{}))],mi.prototype,"fragment",null);class yi extends Ee{}g([w(9,F)],yi.prototype,"accumulatedDistance",void 0),g([w(10,L)],yi.prototype,"segmentDirection",void 0),g([w(11,A)],yi.prototype,"tlbr",void 0);class vi extends Re{_getLineWidthRatio(e,t){const i=new F(Ft),s=me(e.bitset,We);return s.multiply(I(t,new F(.25))).add(new F(1).subtract(s)).divide(i)}_getSDFAlpha(e){const{halfWidth:t,normal:i,tlbr:s,patternSize:a,accumulatedDistance:r,lineWidthRatio:o}=e,n=a.x.multiply(new F(2)).multiply(o),l=De(r.divide(n)),u=new F(.25).multiply(i.y).add(new F(.5)),c=Le(s.xy,s.zw,new L(l,u)),p=Be(T(this.mosaicInfo.texture,c)).subtract(new F(.5)).multiply(t),d=ke(new F(.5).subtract(p),new F(0),new F(1));return new A(d)}_getPatternColor(e){const{halfWidth:t,normal:i,color:s,accumulatedDistance:a,patternSize:r,sampleAlphaOnly:o,tlbr:n}=e,l=r.y.multiply(new F(2).multiply(t).divide(r.x)),u=De(a.divide(l)),c=new F(.5).multiply(i.y).add(new F(.5)),p=Le(n.xy,n.zw,new L(c,u));let d=T(this.mosaicInfo.texture,p);return null!=this.visualVariableColor&&(d=ae(Ue(o,new F(.5)),new A(s.a),s)),d}vertex(e,t){const{segmentDirection:i,tlbr:s,bitset:a}=e,r=He(this,e),o=e.accumulatedDistance.divide(this.view.displayZoomFactor).add(q(i,r.scaledOffset)),n=new L(s.z.subtract(s.x),s.w.subtract(s.y)),l=s.divide(this.mosaicInfo.size.xyxy),u=me(a,je),c=me(a,Ge),p=ae(Ue(u,new F(.5)),this._getLineWidthRatio(e,r.scaledHalfWidth),new F(1));return{...r,tlbr:l,patternSize:n,accumulatedDistance:o,isSDF:u,sampleAlphaOnly:c,lineWidthRatio:p,...this.maybeRunHittest(e,t,r.halfWidth)}}fragment(e){const{color:t,opacity:i,isSDF:s}=e,a=Ne(e,this.antialiasingControls.blur),r=ae(Ue(s,new F(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),o=t.multiply(i).multiply(a).multiply(r);return this.getFragmentOutput(o,e)}}g([S(Oe)],vi.prototype,"mosaicInfo",void 0),g([x(0,E(yi)),x(1,E(qe))],vi.prototype,"vertex",null);class bi extends W{}g([w(3,A)],bi.prototype,"color",void 0),g([w(4,A)],bi.prototype,"outlineColor",void 0),g([w(5,L)],bi.prototype,"offset",void 0),g([w(6,L)],bi.prototype,"textureUV",void 0),g([w(7,A)],bi.prototype,"sizing",void 0),g([w(8,F)],bi.prototype,"placementAngle",void 0),g([w(9,F)],bi.prototype,"sizeRatio",void 0),g([w(10,L)],bi.prototype,"zoomRange",void 0);class gi extends $e{}function xi(e,t,i,s){return t.multiply(e.x).add(i.multiply(e.y)).add(s.multiply(e.z))}function wi(e){return e.multiply(e).divide(128)}g([w(12,L)],gi.prototype,"offsetNextVertex1",void 0),g([w(13,L)],gi.prototype,"offsetNextVertex2",void 0),g([w(14,L)],gi.prototype,"textureUVNextVertex1",void 0),g([w(15,L)],gi.prototype,"textureUVNextVertex2",void 0);class Si extends j{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=wi(e.sizing.x),s=wi(e.sizing.y),a=wi(e.sizing.z),r=e.placementAngle,o=me(e.bitset,it.bitset.isSDF),n=me(e.bitset,it.bitset.isMapAligned),l=me(e.bitset,it.bitset.scaleSymbolsProportionally),u=Ke(e.bitset,it.bitset.colorLocked),c=Ze(this,e.id),p=Xe(this,e.id,e.color,u).multiply(c),d=this.view.displayViewScreenMat3.multiply(new P(e.pos.xy,1)),h=ve(this,e.id,a).divide(a),f=i.multiply(h),m=e.offset.xy.multiply(h);let y=s.multiply(l.multiply(h.subtract(1)).add(1));y=he(y,I(f.subtract(.99),new F(0)));const v=I(y,new F(1)),b=he(y,new F(1)),g=M.fromRotation(r.multiply(Ye)),x=be(this,e.id),w=this._getViewRotationMatrix(n).multiply(x).multiply(g).multiply(new P(m.xy,0)),S=this.clip(e.id,e.zoomRange),V=new A(d.xy.add(w.xy),S,1),z=e.textureUV.divide(this.mosaicInfo.size),_=e.outlineColor.multiply(b),T=me(e.bitset,it.bitset.overrideOutlineColor),C=e.sizeRatio.multiply(f).multiply(.5);return{glPosition:V,color:p,textureUV:z,outlineColor:_,outlineSize:v,distanceToPx:C,isSDF:o,overrideOutlineColor:T,...this.maybeRunHittest(e,t,{pos:e.pos,sizeCorrection:h,isMapAligned:n,outlineSize:v,distanceToPx:C,isSDF:o})}}fragment(e){const t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){const{pos:s,sizeCorrection:a,isMapAligned:r,outlineSize:o,isSDF:n,distanceToPx:l}=i,u=new P(e.offset.multiply(a),0),c=new P(t.offsetNextVertex1.multiply(a),0),p=new P(t.offsetNextVertex2.multiply(a),0),{viewMat3:d,tileMat3:h}=this.view,f=d.multiply(h).multiply(new P(s,1)),m=this._getViewScreenMatrix(r),y=f.add(m.multiply(u)).xy,v=f.add(m.multiply(c)).xy,b=f.add(m.multiply(p)).xy,g=this.hittestRequest.position,x=this.hittestRequest.distance,w=Qe(g.add(new L(Je(x),Je(x))),y,v,b),S=Qe(g.add(new L(0,Je(x))),y,v,b),V=Qe(g.add(new L(x,Je(x))),y,v,b),z=Qe(g.add(new L(Je(x),0)),y,v,b),_=Qe(g,y,v,b),M=Qe(g.add(new L(x,0)),y,v,b),T=Qe(g.add(new L(Je(x),x)),y,v,b),I=Qe(g.add(new L(0,x)),y,v,b),O=Qe(g.add(new L(x,x)),y,v,b),R=e.textureUV.divide(this.mosaicInfo.size),E=t.textureUVNextVertex1.divide(this.mosaicInfo.size),D=t.textureUVNextVertex2.divide(this.mosaicInfo.size),B={color:new A(1),outlineColor:new A(1),overrideOutlineColor:new F(1),outlineSize:o,distanceToPx:l,isSDF:n};let k=new F(0);return k=k.add(et(w).multiply(this._getColor(xi(w,R,E,D),B).a)),k=k.add(et(S).multiply(this._getColor(xi(S,R,E,D),B).a)),k=k.add(et(V).multiply(this._getColor(xi(V,R,E,D),B).a)),k=k.add(et(z).multiply(this._getColor(xi(z,R,E,D),B).a)),k=k.add(et(_).multiply(this._getColor(xi(_,R,E,D),B).a)),k=k.add(et(M).multiply(this._getColor(xi(M,R,E,D),B).a)),k=k.add(et(T).multiply(this._getColor(xi(T,R,E,D),B).a)),k=k.add(et(I).multiply(this._getColor(xi(I,R,E,D),B).a)),k=k.add(et(O).multiply(this._getColor(xi(O,R,E,D),B).a)),C(k,new F(.05)).multiply(K(this.hittestRequest))}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,s=new F(1).subtract(e);return t.multiply(e).add(i.multiply(s))}_getViewScreenMatrix(e){const t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,s=new F(1).subtract(e);return t.multiply(e).add(i.multiply(s))}_getColor(e,t){return ae(oe(t.isSDF,new F(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return T(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=T(this.mosaicInfo.texture,e),s=new F(.5).subtract(Be(i)).multiply(t.distanceToPx).multiply(tt),a=ke(new F(.5).subtract(s),new F(0),new F(1)),r=t.color.multiply(a);let o=t.outlineSize;this.highlight&&(o=I(o,t.overrideOutlineColor.multiply(4)));const n=o.multiply(.5),l=de(s).subtract(n),u=ke(new F(.5).subtract(l),new F(0),new F(1)),c=Le(t.outlineColor,t.color,t.overrideOutlineColor).multiply(u);return new F(1).subtract(c.a).multiply(r).add(c)}}g([pe(Pe)],Si.prototype,"visualVariableColor",void 0),g([pe(Te)],Si.prototype,"visualVariableOpacity",void 0),g([pe(hi)],Si.prototype,"visualVariableRotation",void 0),g([pe(Ie)],Si.prototype,"visualVariableSizeMinMaxValue",void 0),g([pe(Fe)],Si.prototype,"visualVariableSizeScaleStops",void 0),g([pe(Ce)],Si.prototype,"visualVariableSizeStops",void 0),g([pe(Ae)],Si.prototype,"visualVariableSizeUnitValue",void 0),g([S(Oe)],Si.prototype,"mosaicInfo",void 0),g([x(0,E(bi)),x(1,E(gi))],Si.prototype,"vertex",null),g([x(0,E(class extends U{}))],Si.prototype,"fragment",null);class Vi{constructor(){this.computeAttributes={}}get locationsMap(){const e=new Map;for(const t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),i=Pt(t);this._locationInfo={hash:i,locations:e}}return this._locationInfo}getShaderKey(e,t,i){const s=Object.keys(i).filter((e=>i[e])).map((e=>`${e}_${i[e].toString()}`)).join("."),a=Object.keys(t).filter((e=>this.optionPropertyKeys.has(e))).join(".");return`${e.hash}.${s}.${a}`}getProgram(e,t,i,s){let a="",r="";for(const e in i)if(i[e]){const t="boolean"==typeof i[e]?`#define ${e}\n`:`#define ${e} ${i[e]}\n`;a+=t,r+=t}return a+=this.vertexShader,r+=this.fragmentShader,new st(a,r,this.locationsMap,this.locationInfo,this._getUniformBindings(t),this._transformFeedbackBindings)}_getUniformBindings(e){const t=[];for(const e in this.required){const i=this.required[e];t.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:i.type,uniformArrayElementType:zi(i),uniformArrayLength:_i(i)})}for(const i in e){const s=this.options[i];if(e[i])for(const e in s){const a=s[e];t.push({uniformHydrated:null,shaderModulePath:`${i}.${e}`,uniformName:e,uniformType:a.type,uniformArrayElementType:zi(a),uniformArrayLength:_i(a)})}}return t}}const zi=e=>"array"===e.type?e.elementType?.type:void 0,_i=e=>"array"===e.type?e.size:void 0,Mi={hittestDist:F,hittestPos:L},Pi={filterFlags:B,animation:B,visualVariableData:B,dataDriven0:B,dataDriven1:B,dataDriven2:B,gpgpu:B,size:F},Ti={displayViewScreenMat3:M,displayViewMat3:M,displayMat3:M,viewMat3:M,tileMat3:M,displayZoomFactor:F,requiredZoomFactor:F,tileOffset:L,currentScale:F,currentZoom:F,metersPerSRUnit:F};class Ii extends Vi{constructor(){super(...arguments),this.vertexShader=Ct("materials/pie/pie.vert"),this.fragmentShader=Ct("materials/pie/pie.frag"),this.required={...Pi,...Ti,outlineWidth:F,colors:H,defaultColor:A,othersColor:A,outlineColor:A,donutRatio:F,sectorThreshold:F},this.options={hittestUniforms:Mi,visualVariableSizeMinMaxValue:{minMaxValueAndSize:A},visualVariableSizeScaleStops:{sizes:{...H.ofType(F,8),type:"array",elementType:F,size:8},values:{...H.ofType(F,8),type:"array",elementType:F,size:8}},visualVariableSizeStops:{sizes:{...H.ofType(F,8),type:"array",elementType:F,size:8},values:{...H.ofType(F,8),type:"array",elementType:F,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:F},visualVariableOpacity:{opacities:{...H.ofType(F,8),type:"array",elementType:F,size:8},opacityValues:{...H.ofType(F,8),type:"array",elementType:F,size:8}}},this.locations={pos:{index:0,type:L},id:{index:1,type:P},bitset:{index:2,type:F},offset:{index:3,type:L},texCoords:{index:4,type:L},size:{index:5,type:L},referenceSize:{index:6,type:F},zoomRange:{index:7,type:L}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={...H.ofType(A,e),type:"array",elementType:A,size:e}}}const Fi={fill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.FillMeshWriter,this.shaders={geometry:new Z}}render(e,t){const{context:i,painter:s}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target)},defines:h(e),optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("fill"),patternFill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.PatternFillMeshWriter,this.shaders={geometry:new ee}}render(e,t){const{context:i,painter:s}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:v(t.target)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("patternFill"),complexFill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.ComplexFillMeshWriter,this.shaders={geometry:new Y}}render(e,t){const{context:i,painter:s}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:v(t.target)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("complexFill"),outlineFill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.OutlineFillMeshWriter,this.shaders={geometry:new J}}render(e,t){const{context:i,painter:s,pixelRatio:a}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),antialiasingControls:Qt(a)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("outlineFill"),patternOutlineFill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.PatternOutlineFillMeshWriter,this.shaders={geometry:new te}}render(e,t){const{context:i,painter:s,pixelRatio:a}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),antialiasingControls:Qt(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:v(t.target)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("patternOutlineFill"),complexOutlineFill:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.ComplexOutlineFillMeshWriter,this.shaders={geometry:new Q}}render(e,t){const{context:i,painter:s,pixelRatio:a}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),antialiasingControls:Qt(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:v(t.target)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("complexOutlineFill"),marker:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.MarkerMeshWriter,this.shaders={geometry:new Si},this.symbologyPlane=u.MARKER}render(e,t){const{context:i,painter:s}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey,!0)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("marker"),pieChart:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.PieChartMeshWriter,this.shaders={geometry:new Ii},this.symbologyPlane=u.MARKER}render(e,t){const{context:i,painter:s}=e,{instance:a,target:r}=t,o=this.shaders.geometry,n=a.getInput(),l=n.numberOfFields,u=p(e),c=d(e,r),m=h(e);o.setNumberOfFields(l),s.setShader({shader:o,uniforms:{...y(e,t.target,n.geometry),...c.storage,...c.view,hittestUniforms:c.hittestRequest?{hittestDist:c.hittestRequest?.distance,hittestPos:c.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!n.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!n.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!n.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!n.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!n.geometry.visualVariableOpacity,HITTEST:u,highlight:c.highlight?1:0,...m,numberOfFields:l},optionalAttributes:{},useComputeBuffer:u}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("pieChart"),line:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.LineMeshWriter,this.shaders={geometry:new Re},this.symbologyPlane=u.LINE}render(e,t){const{context:i,painter:s,pixelRatio:a}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),antialiasingControls:Qt(a)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("line"),texturedLine:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.TexturedLineMeshWriter,this.shaders={geometry:new vi},this.symbologyPlane=u.LINE}render(e,t){const{context:i,painter:s,pixelRatio:a}=e;s.setShader({shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),antialiasingControls:Qt(a),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...h(e)},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}}("texturedLine"),text:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.TextMeshWriter,this.shaders={geometry:new mi},this.symbologyPlane=u.TEXT}render(e,t){const{context:i,painter:s}=e,a=h(e),r={shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...a,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)};s.setShader(r),s.setPipelineState(f(e)),s.submitDraw(i,t),s.setShader({...r,defines:{...a,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),s.submitDraw(i,t),s.setShader({...r,defines:{...a,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),s.submitDraw(i,t)}}("text"),label:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.LabelMeshWriter,this.shaders={geometry:new mi},this.drawPhase=l.LABEL|l.LABEL_ALPHA,this.symbologyPlane=u.TEXT}render(e,t){const{context:i,painter:s}=e,a=h(e),r={...f(e),stencil:{write:!1,test:{compare:mt.EQUAL,mask:255,ref:0,op:{fail:yt.KEEP,zFail:yt.KEEP,zPass:yt.REPLACE}}}},o={shader:this.shaders.geometry,uniforms:{...y(e,t.target,t.instance.getInput().geometry),...d(e,t.target),mosaicInfo:s.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...a,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:!1};s.setShader(o),s.setPipelineState(r),s.submitDraw(i,t),s.setShader({...o,defines:{...a,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),s.setPipelineState(r),s.submitDraw(i,t),s.setShader({...o,defines:{...a,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),s.setPipelineState(r),s.submitDraw(i,t)}}("label"),heatmap:new class extends kt{constructor(){super(...arguments),this.meshWriter=X.HeatmapMeshWriter,this.shaders={accumulate:new ii,resolve:new oi},this.postProcessingEnabled=!0,this._isBound=!1,this.overrideStencilRef=li}shutdown(){super.shutdown(),this._prevFBO=null,this._accumulateFramebuffer=Tt(this._accumulateFramebuffer),this._resolveGradientTexture=Tt(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null,this._unbind()}render(e,t){const{context:i,painter:s,state:a}=e,r=t.instance.getInput(),{isFieldActive:o}=r,n=this._loadQualityProfile(i);if(c(e))return;p(e)||this._ensureBound(e,r),s.setShader({shader:this.shaders.accumulate,uniforms:{...d(e,t.target),kernelControls:{radius:di(r,a),isFieldActive:o?1:0}},defines:{...h(e),...n.defines},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:p(e)});const l=p(e)?ci:ui;s.setPipelineState(l),s.submitDraw(i,t)}postProcess(e,t){if(p(e)||c(e))return;if(null==this._prevFBO||null==this._prevViewport||null==this._accumulateFramebuffer||null==this._resolveGradientTexture)return;const{context:i,painter:s}=e,{defines:a}=this._loadQualityProfile(i),{minDensity:r,maxDensity:o,radius:n}=t.getInput();s.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:this._accumulateFramebuffer.colorTexture},minAndInvRange:[r,1/(o-r)],normalization:3/(n*n*Math.PI)},gradient:{texture:{unit:9,texture:this._resolveGradientTexture}}},defines:a,optionalAttributes:{},useComputeBuffer:!1}),i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(this._accumulateFramebuffer.colorTexture,8),i.bindTexture(this._resolveGradientTexture,9),s.setPipelineState(pi),s.submitDrawQuad(i),this._unbind()}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_ensureBound(e,t){if(this._isBound)return;const{context:i}=e;this._prevFBO=i.getBoundFramebufferObject(),this._prevViewport=i.getViewport(),this._ensureResources(e,t),this._updateResources(e,t),i.bindFramebuffer(this._accumulateFramebuffer),i.setViewport(0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.clear(ft.COLOR_BUFFER_BIT),this._isBound=!0}_ensureResources({context:e,state:t,pixelRatio:i},s){if(null==this._accumulateFramebuffer){const{dataType:a,samplingMode:r,pixelFormat:o,internalFormat:n}=this._loadQualityProfile(e),{width:l,height:u}=this._prevViewport,c=ni(di(s,t),i),p=l*c,d=u*c,h=new zt(p,d);h.pixelFormat=o,h.internalFormat=n,h.dataType=a,h.samplingMode=r,h.wrapMode=ct.CLAMP_TO_EDGE;const f=new St(pt.DEPTH_STENCIL,p,d);this._accumulateFramebuffer=new Vt(e,h,f)}if(null==this._resolveGradientTexture){const t=new zt;t.wrapMode=ct.CLAMP_TO_EDGE,this._resolveGradientTexture=new _t(e,t)}}_updateResources({context:e,state:t,pixelRatio:i},s){const{gradient:a,gradientHash:r}=s;this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(a.length/4,1),this._resolveGradientTexture.setData(a),this._prevGradientHash=r);const o=ni(di(s,t),i),{width:n,height:l}=this._prevViewport,u=n*o,c=l*o,{width:p,height:d}=this._accumulateFramebuffer;p===u&&d===c||this._accumulateFramebuffer.resize(u,c),e.blitFramebuffer(this._prevFBO,this._accumulateFramebuffer,0,0,this._prevFBO.width,this._prevFBO.height,0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height,ft.STENCIL_BUFFER_BIT,ut.NEAREST)}_loadQualityProfile(e){if(null==this._qualityProfile){const t=It(e,Mt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapTechnique"));this._qualityProfile={...t,defines:{usesHalfFloatPrecision:t.dataType!==ht.FLOAT}}}return this._qualityProfile}}("heatmap"),dotDensity:new class extends kt{constructor(){super(...arguments),this.shaders={polygon:new $t,point:new Wt,fill:new Z},this.meshWriter=X.DotDensityMeshWriter}render(e,t){c(e)||p(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){const{context:i,painter:s}=e;s.setShader({shader:this.shaders.fill,uniforms:{...d(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...h(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:p(e)}),s.setPipelineState(f(e)),s.submitDraw(i,t)}_renderDotDensity(e,t){const{context:r,painter:o,requiredLevel:n}=e,l=t.instance.getInput();this._resources||(this._resources=new Yt);const u=this._resources.getDotDensityTextures(r,i,l.seed),c=1/2**(n-t.target.key.level),p=i,y=p*window.devicePixelRatio*p*window.devicePixelRatio,v=1/c*(1/c),b=l.dotScale?e.state.scale/l.dotScale:1,g=l.dotValue*b*v;o.setShader({shader:this.shaders.polygon,uniforms:{...d(e,t.target),instance:{isActive:l.isActive,colors:l.colors,dotValue:Math.max(1,g)},draw:{dotTexture0:{unit:s,texture:u[0]},dotTexture1:{unit:a,texture:u[1]},tileZoomFactor:c,pixelRatio:window.devicePixelRatio,tileDotsOverArea:y/(i*window.devicePixelRatio*i*window.devicePixelRatio)}},defines:{...h(e),blending:l.blending},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState(f(e));const x=r.getViewport();r.setViewport(0,0,i,i);const w=r.getBoundFramebufferObject(),S=this._resources.getFBO(r);r.bindFramebuffer(S),r.setClearColor(0,0,0,0),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(r),r.clear(ft.COLOR_BUFFER_BIT),o.submitDraw(r,t),r.bindFramebuffer(w),r.setViewport(x.x,x.y,x.width,x.height);const V=this._resources.getFBO(r).colorTexture;o.setShader({shader:this.shaders.point,uniforms:{view:m(e,t.target),instance:{dotSize:l.dotSize},draw:{locations:{unit:s,texture:V},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...h(e)},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.submitDrawMesh(r,this._resources.getDotDensityMesh(r))}shutdown(){super.shutdown(),this._resources&&this._resources.destroy(),this._resources=null}}("dotDensity")};function Ci(){for(const e in Fi)Fi[e].startup()}function Ai(){for(const e in Fi)Fi[e].shutdown()}function Oi(e,t){const i=e.slice(0,t),s=t-i.length;for(let e=0;e<s;e++){const e=i[i.length-1];i.push(e)}return i}function Ri(e){if(!e)return[0,0,0,0];const{r:t,g:i,b:s,a}=e;return[t*(a/255),i*(a/255),s*(a/255),a]}const Ei=8,Di=Ei-2,Li=()=>Mt.getLogger("esri.views.2d.layers.features.support.rendererUtils");function Bi(e){return e.map((e=>function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?function(e){return e.stops=(t=e.type,(i=e.stops??[]).length<=Ei?i:(Li().warn(`Found ${i.length} Visual Variable stops, but MapView only supports ${Ei}. Displayed stops will be simplified.`),i.length>2*Ei?function(e,t){const[i,...s]=t,a=s.pop(),r=s[0].value,o=s[s.length-1].value,n=(o-r)/Di,l=[];for(let i=r;i<o;i+=n){let a=0;for(;i>=s[a].value;)a++;const r=s[a],o=t[a-1],n=i-o.value,u=r.value===o.value?1:n/(r.value-o.value);if("color"===e){const e=s[a],r=t[a-1],o=e.color.clone();o.r=ki(r.color.r,o.r,u),o.g=ki(r.color.g,o.g,u),o.b=ki(r.color.b,o.b,u),o.a=ki(r.color.a,o.a,u),l.push({value:i,color:o,label:e.label})}else if("size"===e){const e=s[a],r=t[a-1],o=At(e.size),n=ki(At(r.size),o,u);l.push({value:i,size:n,label:e.label})}else{const e=s[a],r=ki(t[a-1].opacity,e.opacity,u);l.push({value:i,opacity:r,label:e.label})}}return[i,...l,a]}(t,i):function(e){const[t,...i]=e,s=i.pop();for(;i.length>Di;){let e=0,t=0;for(let s=1;s<i.length;s++){const a=i[s-1],r=i[s],o=Math.abs(r.value-a.value);o>t&&(t=o,e=s)}i.splice(e,1)}return[t,...i,s]}(i))),e;var t,i}(e.clone()):e))}function ki(e,t,i){return(1-i)*e+i*t}function Ui(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=Lt();return e&&t||i}()){const e=Lt(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((t=>!e[t])).join(", ");return Li().errorOnce(new Dt("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}const Hi=1.25,Ni=128,Wi=128;function ji(e){if(!e.stops?.length)return null;const t=Oi(e.stops.sort(((e,t)=>e.value-t.value)),8),i=t.map((({value:e})=>e)),s=t.map((({color:e})=>Ri(e)));return{values:i,colors:s}}function Gi(e){if(!e.stops?.length)return null;const t=Oi(e.stops.sort(((e,t)=>e.value-t.value)),8);return{opacityValues:t.map((({value:e})=>e)),opacities:t.map((({opacity:e})=>e))}}function qi(e){return{rotationType:"geographic"===e.rotationType?ne.Geographic:ne.Arithmatic}}function $i(e){if(!e.stops?.length)return null;if(e.stops.some((e=>e.useMaxValue||e.useMinValue)))return(t,i)=>{const s=t.statisticsByLevel.get(i.key.level),a=Oi(e.stops.map((t=>({value:t.useMaxValue?s?.get(e.field)?.maxValue??0:t.useMinValue?s?.get(e.field)?.minValue??0:t.value,size:t.size?Ot(t.size):n}))).sort(((e,t)=>e.value-t.value)),8);return{values:a.map((({value:e})=>e)),sizes:a.map((({size:e})=>e))}};const t=Oi(e.stops.sort(((e,t)=>e.value-t.value)),8);return{values:t.map((({value:e})=>e)),sizes:t.map((({size:e})=>Ot(e)))}}function Ki(e){return t=>{const{state:i}=t;return{unitValueToPixelsRatio:Rt(i.spatialReference)/Et[e.valueUnit]/i.resolution}}}function Zi(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function Xi(e){const{minDataValue:t,maxDataValue:i,minSize:s,maxSize:a}=e;if("object"==typeof s&&"object"==typeof a)return(e,r)=>{const o=e.state.scale,n=Ot(Zi(o,s.stops)),l=Ot(Zi(o,a.stops));return{minMaxValueAndSize:[t,i,n,l]}};if("object"==typeof s||"object"==typeof a)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,i,Ot(s),Ot(a)]}}const Yi={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function Qi(e){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?Ni:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*Hi,Wi);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return Ni;const t=e.visualVariableSizeScaleStops.sizes;return Math.max(t[t.length-1]*Hi,Wi)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return Ni;const t=e.visualVariableSizeStops.sizes;return Math.max(t[t.length-1]*Hi,Wi)}return e.visualVariableSizeUnitValue?2*Ni:0}function Ji(e){const t={...Yi};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(const i of Bi(e.visualVariables))switch(i.type){case"color":t.visualVariableColor=ji(i);break;case"opacity":t.visualVariableOpacity=Gi(i);break;case"rotation":t.visualVariableRotation=qi(i);break;case"size":switch(es(i)){case"field-stops":t.visualVariableSizeStops=$i(i);break;case"scale-stops":"outline"===i.target?t.visualVariableSizeOutlineScaleStops=$i(i):t.visualVariableSizeScaleStops=$i(i);break;case"min-max":t.visualVariableSizeMinMaxValue=Xi(i);break;case"unit-value":t.visualVariableSizeUnitValue=Ki(i)}break;default:console.error("Unable to handle VV type")}return t}function es(e){if("number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize)return"min-max";if((e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops))return"scale-stops";if((null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels))return"field-stops";if((null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit)return"unit-value";throw new Error("InternalError: Found unknown sizeVV type")}function ts(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function is(e){if(null==e)return null;if(Array.isArray(e)){const[t,i,s,a]=e;return[t,i,s,255*a]}return"string"==typeof e?e:{...e,defaultValue:is(e?.defaultValue)}}function ss(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)}async function as(t,i){const{cimResourceManager:s,cimAnalyzer:a,scaleExpression:r}=i.schemaOptions;await Promise.all(e.fetchResources(t.symbol,s,[]));const o=a.analyzeSymbolReference(t,!1),n={scaleInfo:ts(t),scaleExpression:r},l=[];for(const e of o)switch(e.type){case"marker":l.push(...rs(e,i,n));break;case"fill":l.push(...ls(e,i,n));break;case"line":l.push(...cs(e,i,n));break;case"text":l.push(...fs(e,i,n))}return l}function rs(e,t,i){const{uniforms:s,schemaOptions:a}=t,{store:r}=a,o=e.isOutline?{...Yi,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue,visualVariableRotation:s.visualVariableRotation};return os(r.ensureInstance(Fi.marker,{geometry:o},{zoomRange:!!i.scaleInfo}),e,s,i)}function os(e,i,s,{scaleInfo:a,scaleExpression:r}){const o=ss(s);return[e.createMeshInfo({params:{size:i.size,scaleX:i.scaleX,anchorX:i.anchorPoint.x,anchorY:i.anchorPoint.y,angle:i.rotation,color:is(i.color)??[0,0,0,0],colorLocked:i.colorLocked,frameHeight:i.frameHeight,scaleInfo:a,offsetX:i.offsetX,offsetY:i.offsetY,outlineColor:is(i.outlineColor)??[0,0,0,0],outlineSize:i.outlineWidth,referenceSize:i.referenceSize||t.CIMVectorMarker.size,rotateClockwise:i.rotateClockwise,scaleFactor:r??1,sizeRatio:i.sizeRatio,alignment:i.alignment,isAbsoluteAnchorPoint:i.isAbsoluteAnchorPoint,scaleSymbolsProportionally:i.scaleSymbolsProportionally,sprite:i.spriteRasterizationParam,hasSizeVV:o,placement:i.markerPlacement,effects:i.effects?{type:"cim-effect-infos",effectInfos:i.effects}:null,transforms:i.transform,minPixelBuffer:Qi(s)}})]}function ns(e,t,{scaleInfo:i}){return[e.createMeshInfo({params:{color:is(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}})]}function ls(e,t,i){if(!e.spriteRasterizationParam)return function(e,t,i){const{uniforms:s,schemaOptions:a}=t,{store:r}=a;return ns(r.ensureInstance(Fi.fill,{geometry:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity}},{zoomRange:!!i.scaleInfo}),e,i)}(e,t,i);const{uniforms:s,schemaOptions:a}=t,{store:r}=a;return us(r.ensureInstance(Fi.complexFill,{geometry:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity}},{zoomRange:!!i.scaleInfo}),e,null!=s.visualVariableColor,i)}function us(e,t,i,{scaleInfo:s}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const a=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),r=t.sampleAlphaOnly&&!a,o=t.spriteRasterizationParam;return[e.createMeshInfo({params:{color:is(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:r,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:s,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}})]}function cs(e,t,i){const{uniforms:s,schemaOptions:a}=t,{store:r}=a,o=e.isOutline?{...Yi,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},n={geometry:o},l=!!(o.visualVariableSizeMinMaxValue||o.visualVariableSizeScaleStops||o.visualVariableSizeStops||o.visualVariableSizeUnitValue);return e.spriteRasterizationParam?hs(r.ensureInstance(Fi.texturedLine,n,{zoomRange:!!i.scaleInfo}),e,l,i):ds(r.ensureInstance(Fi.line,n,{zoomRange:!!i.scaleInfo}),e,l,i)}function ps(e,t,{scaleInfo:i}){return{params:{color:is(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}}function ds(e,t,i,s){if(t.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");return[e.createMeshInfo({params:ps(t,i,s).params})]}function hs(e,t,i,s){const{spriteRasterizationParam:a,scaleDash:r,sampleAlphaOnly:o}=t;if(!a)throw new Error("InternalError: Sprite should be defined");return[e.createMeshInfo({params:{...ps(t,i,s).params,shouldScaleDash:r??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==a.resource.type,sprite:a}})]}function fs(e,t,i){const{uniforms:s,schemaOptions:a}=t,{store:r}=a;return ms(r.ensureInstance(Fi.text,{geometry:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue}},{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}),e,s,i)}function ms(e,t,i,{scaleInfo:s}){return[e.createMeshInfo({params:{boxBackgroundColor:is(t.backgroundColor),boxBorderLineColor:is(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:is(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:is(t.outlineColor)??[0,0,0,0],haloFontSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:s,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,minPixelBuffer:Qi(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}function ys(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:Lt().maxTextureSize},bindings:bs(e)}}function vs(e){switch(e){case"opacity":return b.OPACITY;case"color":return b.COLOR;case"rotation":return b.ROTATION;case"size":return b.SIZE;default:return null}}function bs(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return gs(e);case"dot-density":return function(e){const t=[];for(const i of e.attributes)t.push({binding:t.length,expression:i.valueExpression,field:i.field});return t}(e);case"pie-chart":return function(e){const t=gs(e);let i=4;for(const s of e.attributes)t.push({binding:i++,expression:s.valueExpression,field:s.field});return t}(e);case"heatmap":return function({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}(e)}}function gs(e){return"visualVariables"in e&&e.visualVariables?.length?Bi(e.visualVariables).map((e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:vs(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:vs(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:vs(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e))).filter(ot):[]}function xs(e){return e.some((e=>e.globalId))}function ws(e){return e.filter((e=>!e.error)).map((e=>e.objectId??e.globalId)).filter((e=>null!=e))}function Ss(e,t){const i=new Set(e);for(const e of t.values())i.add(e);return i}function Vs(e,t){const i=new Set(e);for(const e of t.values())i.delete(e);return i}class zs{constructor(e){this.updateTracking=new at({debugName:"FeatureCommandQueue"}),this._hasGlobalIds=!1,this._queueProcessor=new Bt({concurrency:1,process:e.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return this.updateTracking.addPromise(this._doPush(e))}async _doPush(e){const t=this._queueProcessor,i=t.last(),s=[];switch(e.type){case"update":if(i?.type===e.type)return;s.push(t.push(e));break;case"edit":{const a="processed-edit"===i?.type?i:null;a&&t.popLast();const r=this._mergeEdits(a,e);for(const e of r)e&&s.push(t.push(e));break}}await Promise.all(s)}_mergeEdits(e,t){const{addedFeatures:i,deletedFeatures:s,updatedFeatures:a}=t.edits;if(this._hasGlobalIds=this._hasGlobalIds||xs(i)||xs(a)||xs(s),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[...i,...a],removed:s}}];const r=new Set(ws(e?.edits.addOrModified??[])),o=new Set(ws(e?.edits.removed??[])),n=new Set([...ws(i),...ws(a)]),l=new Set(ws(s));return[{type:"processed-edit",edits:{addOrModified:Array.from(Ss(Vs(r,l),n)).map((e=>({objectId:e}))),removed:Array.from(Ss(Vs(o,n),l)).map((e=>({objectId:e})))}}]}}export{zs as F,Fi as T,hs as a,ds as b,ms as c,ns as d,us as e,os as f,ts as g,ys as h,as as i,Ji as j,ss as k,Qi as l,Ui as m,Yi as n,gs as o,Ri as p,Ai as q,Ci as s};
