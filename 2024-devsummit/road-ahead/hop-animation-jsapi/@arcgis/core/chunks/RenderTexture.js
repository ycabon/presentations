/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{d as e}from"./mathUtils.js";import{c as t}from"./vec3f64.js";import{f as s,h as r,j as i,P as o,e as n,w as a}from"./projectBuffer.js";import{h as u}from"./unitUtils.js";import{c as l}from"./maybe.js";import{isPromiseLike as c}from"../core/promiseUtils.js";function f(e,t,s,l){if(null==t||null==l)return!1;const c=r(t,l,h);if(c.projector===i)return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],!0;if(null==c.projector)return!1;const{source:f,dest:m}=c;if(m.spatialReferenceId===o.WEB_MERCATOR){const t=n[f.spatialReferenceId][o.WGS84];return null!=t&&(t(e,0,R,0),a(R,0,s,0),s[3]=p(R[1],e[2],e[3],u.radius),!0)}if(f.spatialReferenceId!==o.WGS84&&f.spatialReferenceId!==o.CGCS2000||m.spatialReferenceId!==o.PLATE_CARREE){c.projector(e,0,s,0);const t=f.metersPerUnit??1,r=m.metersPerUnit??1;s[3]=e[3]*t/r}else{const t=n[f.spatialReferenceId][o.SPHERICAL_ECEF],r=n[o.SPHERICAL_ECEF][o.PLATE_CARREE];let i=e[3];null!=t&&null!=r&&(i=p(e[1],e[2],e[3],u.radius)),c.projector(e,0,s,0),s[3]=i}return!0}function p(e,t,s,r){const i=r+t;if(i<r/2||s>i)return Number.MAX_VALUE;const o=Math.abs(m*e)+Math.asin(s/i);return o>=Math.PI/2?Number.MAX_VALUE:s/Math.cos(o)}const R=t(),h=s(),m=e(1);class d{constructor(e,t){this._textureRep=e,this.loadPromise=null,this._disposed=!1;const s=this._textureRep.acquire(t);c(s)?(s.then((e=>{this._disposed?l(e):this._textureRef=e})),this.loadPromise=s):this._textureRef=s}dispose(){this._textureRef=l(this._textureRef),this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}export{d as R,f as p};
