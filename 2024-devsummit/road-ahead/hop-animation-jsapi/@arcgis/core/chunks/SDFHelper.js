/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{p as t}from"./floatRGBA.js";import{isExtent as o}from"../geometry/support/jsonUtils.js";import{R as n}from"./CIMSymbolHelper.js";import{s as r}from"./definitions.js";function l(t){switch(t.type){case"CIMPointSymbol":{const o=t.symbolLayers;if(!o||1!==o.length)return null;const n=o[0];return"CIMVectorMarker"!==n.type?null:l(n)}case"CIMVectorMarker":{const o=t.markerGraphics;if(!o||1!==o.length)return null;const n=o[0];if(!n)return null;const r=n.geometry;if(!r)return null;const l=n.symbol;return!l||"CIMPolygonSymbol"!==l.type&&"CIMLineSymbol"!==l.type||l.symbolLayers?.some((t=>!!t.effects))?null:{type:"sdf",geom:r,asFill:"CIMPolygonSymbol"===l.type}}}}function e(t){let o=1/0,n=-1/0,r=1/0,l=-1/0;for(const e of t)for(const t of e)t[0]<o&&(o=t[0]),t[0]>n&&(n=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return[o,r,n,l]}function s(t){return t?t.rings?e(t.rings):t.paths?e(t.paths):o(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function a(t,o,n,l,e){const[s,a,i,f]=t;if(i<s||f<a)return[0,0,0];const m=i-s,c=f-a,u=r,y=Math.floor(.5*(64-u)),h=(128-2*(y+u))/Math.max(m,c),x=Math.round(m*h)+2*y,M=Math.round(c*h)+2*y;let p=1;o&&(p=M/h/(o.ymax-o.ymin));let g=0,d=0,b=1;l&&(e?o&&n&&o.ymax-o.ymin>0&&(b=(o.xmax-o.xmin)/(o.ymax-o.ymin),g=l.x/(n*b),d=l.y/n):(g=l.x,d=l.y)),o&&(g=.5*(o.xmax+o.xmin)+g*(o.xmax-o.xmin),d=.5*(o.ymax+o.ymin)+d*(o.ymax-o.ymin)),g-=s,d-=a,g*=h,d*=h,g+=y,d+=y;let C=g/x-.5,I=d/M-.5;return e&&n&&(C*=n*b,I*=n),[p,C,I]}function i(t){const o=(l=t.geom)?l.rings?l.rings:l.paths?l.paths:void 0!==l.xmin&&void 0!==l.ymin&&void 0!==l.xmax&&void 0!==l.ymax?[[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]]]:null:null;var l;const e=function(t){let o=1/0,r=-1/0,l=1/0,e=-1/0;for(const n of t)for(const t of n)t[0]<o&&(o=t[0]),t[0]>r&&(r=t[0]),t[1]<l&&(l=t[1]),t[1]>e&&(e=t[1]);return new n(o,l,r-o,e-l)}(o),s=r,a=Math.floor(.5*(64-s)),i=(128-2*(a+s))/Math.max(e.width,e.height),m=Math.round(e.width*i)+2*a,c=Math.round(e.height*i)+2*a,u=[];for(const n of o)if(n&&n.length>1){const o=[];for(const r of n){let[n,l]=r;n-=e.x,l-=e.y,n*=i,l*=i,n+=a-.5,l+=a-.5,t.asFill?o.push([n,l]):o.push([Math.round(n),Math.round(l)])}if(t.asFill){const t=o.length-1;o[0][0]===o[t][0]&&o[0][1]===o[t][1]||o.push(o[0])}u.push(o)}const y=function(t,o,n,r){const l=o*n,e=new Array(l),s=r*r+1;for(let t=0;t<l;++t)e[t]=s;for(const l of t){const t=l.length;for(let s=1;s<t;++s){const t=l[s-1],a=l[s];let i,f,m,c;t[0]<a[0]?(i=t[0],f=a[0]):(i=a[0],f=t[0]),t[1]<a[1]?(m=t[1],c=a[1]):(m=a[1],c=t[1]);let u=Math.floor(i)-r,y=Math.floor(f)+r,h=Math.floor(m)-r,x=Math.floor(c)+r;u<0&&(u=0),y>o&&(y=o),h<0&&(h=0),x>n&&(x=n);const M=a[0]-t[0],p=a[1]-t[1],g=M*M+p*p;for(let r=u;r<y;r++)for(let l=h;l<x;l++){let s,i,f=(r-t[0])*M+(l-t[1])*p;f<0?(s=t[0],i=t[1]):f>g?(s=a[0],i=a[1]):(f/=g,s=t[0]+f*M,i=t[1]+f*p);const m=(r-s)*(r-s)+(l-i)*(l-i),c=(n-l-1)*o+r;m<e[c]&&(e[c]=m)}}}for(let t=0;t<l;++t)e[t]=Math.sqrt(e[t]);return e}(u,m,c,a);return t.asFill&&function(t,o,n,r,l){for(const e of t){const t=e.length;for(let s=1;s<t;++s){const t=e[s-1],a=e[s];let i,f,m,c;t[0]<a[0]?(i=t[0],f=a[0]):(i=a[0],f=t[0]),t[1]<a[1]?(m=t[1],c=a[1]):(m=a[1],c=t[1]);let u=Math.floor(i),y=Math.floor(f)+1,h=Math.floor(m),x=Math.floor(c)+1;u<r&&(u=r),y>o-r&&(y=o-r),h<r&&(h=r),x>n-r&&(x=n-r);for(let e=h;e<x;++e){if(t[1]>e==a[1]>e)continue;const s=(n-e-1)*o;for(let o=u;o<y;++o)o<(a[0]-t[0])*(e-t[1])/(a[1]-t[1])+t[0]&&(l[s+o]=-l[s+o]);for(let t=r;t<u;++t)l[s+t]=-l[s+t]}}}}(u,m,c,a,y),[f(y,a),m,c]}function f(o,n){const r=2*n,l=o.length,e=new Uint8Array(4*l);for(let n=0;n<l;++n){const l=.5-o[n]/r;t(l,e,4*n)}return e}export{s as a,a as b,i as c,l as g};
