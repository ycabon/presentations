/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{l as t,c as e}from"./mathUtils.js";import{a as n,k as i,d as o,h as a,r}from"./mat4.js";import{c as s}from"./mat4f64.js";import{j as c,h as l}from"./vec2.js";import{f as u,c as d}from"./vec2f64.js";import{s as f,a as m,n as h,b as g,g as b,h as p,p as y}from"./vec3.js";import{f as v,a as A,c as M}from"./vec3f64.js";import{V as N}from"./ViewingMode.js";import{g as T}from"./_commonjsHelpers.js";import{b as w}from"./mathUtils2.js";import{_ as x}from"./tslib.es6.js";import{p as P,S as O}from"./ShaderTechniqueConfiguration.js";var E,I,j={exports:{}};E=j,I=function(){var t=Math.PI,e=Math.sin,n=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,r=Math.acos,s=t/180,c=864e5,l=2440588,u=2451545,d={dec:0,ra:0};function f(t){return new Date((t+.5-l)*c)}function m(t){return function(t){return t.valueOf()/c-.5+l}(t)-u}var h=23.4397*s;function g(t,o){return a(e(t)*n(h)-i(o)*e(h),n(t))}function b(t,i){return o(e(i)*n(h)+n(i)*e(h)*e(t))}function p(t,o,r){return a(e(t),n(t)*e(o)-i(r)*n(o))}function y(t,i,a){return o(e(i)*e(a)+n(i)*n(a)*n(t))}function v(t,e){return s*(280.16+360.9856235*t)-e}function A(t){return s*(357.5291+.98560028*t)}function M(t){return s*(1.9148*e(t)+.02*e(2*t)+3e-4*e(3*t))}function N(e,n){return e+n+102.9372*s+t}function T(t,e){var n=A(t),i=N(n,M(n));return e||(e={dec:0,ra:0}),e.dec=b(i,0),e.ra=g(i,0),e}var w={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,e,n,i){var o=s*-n,a=s*e,r=m(t),c=T(r,d),l=v(r,o)-c.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=p(l,a,c.dec),i.altitude=y(l,a,c.dec),i}},x=[[-.83,"sunrise","sunset"]];w.addTime=function(t,e,n){x.push([t,e,n])};var P=9e-4;function O(e,n,i){return P+(e+n)/(2*t)+i}function E(t,n,i){return u+t+.0053*e(n)-.0069*e(2*i)}function I(t){var i=s*(134.963+13.064993*t),o=s*(93.272+13.22935*t),a=s*(218.316+13.176396*t)+6.289*s*e(i),r=5.128*s*e(o),c=385001-20905*n(i);return{ra:g(a,r),dec:b(a,r),dist:c}}return w.getTimes=function(i,o,a){var c=s*-a,l=s*o,u=function(e,n){return Math.round(e-P-n/(2*t))}(m(i),c),d=O(0,c,u),h=A(d),g=M(h),p=N(h,g),y=b(p,0),v=E(d,h,p);function T(t){return E(O(function(t,i,o){return r((e(t)-e(i)*e(o))/(n(i)*n(o)))}(t,l,y),c,u),h,p)}var I,j,z,G,S,D,H,L={solarNoon:f(v),nadir:f(v-.5),polarException:w.PolarException.NORMAL};for(I=0,j=x.length;I<j;I+=1)S=v-((G=T((z=x[I])[0]*s))-v),L[z[1]]=f(S),L[z[2]]=f(G);return L.polarException=(D=x[0][0]*s,(H=(e(D)-e(l)*e(y))/(n(l)*n(y)))<-1?w.PolarException.MIDNIGHT_SUN:H>1?w.PolarException.POLAR_NIGHT:w.PolarException.NORMAL),L},w.getMoonPosition=function(t,e,n){var o=s*-n,a=s*e,r=m(t),c=I(r),l=v(r,o)-c.ra,u=y(l,a,c.dec);return u+=.017*s/i(u+10.26*s/(u+5.1*s)),{azimuth:p(l,a,c.dec),altitude:u,distance:c.dist}},w.getMoonFraction=function(t){var i=m(t),o=T(i),s=I(i),c=149598e3,l=r(e(o.dec)*e(s.dec)+n(o.dec)*n(s.dec)*n(o.ra-s.ra)),u=a(c*e(l),s.dist-c*n(l));return(1+n(u))/2},w}(),void 0!==I&&(E.exports=I);const z=T(j.exports),G={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class S{constructor(t,e){this.direct=t,this.ambient=e}}function D(n,i,o,a,r,s){f(s.ambient.color,1,1,1),s.ambient.intensity=G.global.ambient,f(s.direct.color,1,1,1),s.direct.intensity=G.global.direct;const u=i[2],h=e((Math.abs(u)-G.local.altitude)/(G.global.altitude-G.local.altitude),0,1);let g;if(s.globalFactor=h,null!=n&&(g=z.getTimes(n,i[1],i[0])),h<1){let e;if(null!=n)e=function(t,e,n){const i=t.valueOf();let o,a;e.polarException===z.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===z.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,s=o+r/2,u=r/4,f=s-u,h=s+u,g=.06*r,b=o-g/2,p=o+g/2,v=a-g/2,A=a+g/2,N=d(),T=M(),w=M();let x="";if(i<b||i>A)c(N,$),y(T,B),y(w,W),x="night";else if(i<p){const t=(i-b)/(p-b);l(N,$,tt,t),m(T,B,J,t),m(w,W,X,t),x="sun rising"}else if(i<f){const t=(i-p)/(f-p);l(N,tt,et,t),m(T,J,K,t),m(w,X,Y,t),x="early morning"}else if(i<s){const t=(i-f)/(s-f);l(N,et,nt,t),m(T,K,Q,t),m(w,Y,Z,t),x="late morning"}else if(i<h){const t=(i-s)/(h-s);l(N,nt,it,t),m(T,Q,ot,t),m(w,Z,at,t),x="early afternoon"}else if(i<v){const t=(i-h)/(v-h);l(N,it,rt,t),m(T,ot,st,t),m(w,at,ct,t),x="late afternoon"}else if(i<A){const t=(i-v)/(A-v);l(N,rt,$,t),m(T,st,B,t),m(w,ct,W,t),x="sun setting"}let P=0;switch(n){case"rainy":case"foggy":P=.8;break;case"snowy":P=.5}P>0&&(q(T,P),q(w,P));const O=V(n);return{direct:{intensity:N[0]*O.direct,color:T},ambient:{intensity:N[1]*O.ambient,color:w},timeOfDay:x}}(n,g,a);else{const t=V(a);e={direct:{intensity:G.local.directAtNoon*t.direct,color:v(1,1,1)},ambient:{intensity:G.local.ambientAtNoon*t.ambient,color:v(1,1,1)},timeOfDay:"early afternoon"}}m(s.ambient.color,e.ambient.color,s.ambient.color,h),s.ambient.intensity=t(e.ambient.intensity,s.ambient.intensity,h),m(s.direct.color,e.direct.color,s.direct.color,h),s.direct.intensity=t(e.direct.intensity,s.direct.intensity,h),s.specularStrength="rainy"===a||"snowy"===a||"foggy"===a?0:1,s.environmentStrength="rainy"===a?.7:"snowy"===a||"foggy"===a?.75:1}s.noonFactor=null!=n?function(t,n){const i=t.valueOf();let o,a;n.polarException===z.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):n.polarException===z.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=n.sunrise.valueOf(),a=n.sunset.valueOf());const r=o+(a-o)/2;return 1-e(Math.abs(i-r)/432e5,0,1)}(n,g):1,null!=n?L(n,i,o,s.direct.directionToLightSource):H(r,o,s.direct.directionToLightSource)}function H(t,e,i){e===N.Global?h(dt,t.eye):f(dt,0,0,1),g(ft,t.viewForward,-1);const o=w(ft,dt),a=Math.max(o-2*ht,0),r=.85*a/(a+1),s=Math.max(ht,o-ht-r);n(ut,-s,t.viewRight),b(i,ft,ut),p(i,i,g(mt,t.viewRight,gt)),h(i,i)}function L(t,n,s,c){const l=k,u=i(C);if(s===N.Global)z.getPosition(t,0,0,l),f(c,0,0,-1),o(u,u,-l.azimuth),a(u,u,-l.altitude),b(c,c,u);else{const i=G.planarDirection,a=i.globalAngles,s=n[2];let d=(Math.abs(s)-i.localAltitude)/(i.globalAltitude-i.localAltitude);d=e(d,0,1),d<1?(z.getPosition(t,n[1],n[0],l),l.azimuth=(1-d)*l.azimuth+d*a.azimuth,l.altitude=(1-d)*l.altitude+d*a.altitude):(l.azimuth=a.azimuth,l.altitude=a.altitude),f(c,0,-1,0),r(u,u,-l.azimuth),o(u,u,-l.altitude),b(c,c,u)}}function _(t,e){if(e===N.Global)return!0;const n=G.planarDirection;return Math.abs(t)<n.localAltitude}function R(t,e,n,i,o){const a=t.getTime(),r=e.getTime()-a,s=Math.floor(r/n)+1,c=new Array(s);for(let t=0;t<s;++t)lt.setTime(a+n*t),c[t]=M(),L(lt,i,o,c[t]);return c}const U=v(.5773502691896258,-.5773502691896258,.5773502691896258);class F{constructor(){this.ambient={color:v(1,1,1),intensity:.55},this.direct={color:v(1,1,1),intensity:.55,directionToLightSource:A(U)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const C=s(),k={azimuth:0,altitude:0};function V(t){switch(t){case"disabled":case"sunny":case"cloudy":return new S(1,1);case"rainy":return new S(.4,1.2);case"snowy":return new S(.5,1.3);case"foggy":return new S(.2,1.6)}}function q(t,e){const n=(t[0]+t[1]+t[2])/3;t[0]+=(n-t[0])*e,t[1]+=(n-t[1])*e,t[2]+=(n-t[2])*e}const B=v(.01,.01,.01),J=v(1,.6,.5),K=v(1,.98,.98),Q=v(1,1,1),W=v(.8,.8,1),X=v(.8,.8,1),Y=v(.98,.98,1),Z=v(1,1,1),$=u(.01,G.local.ambientAtNight),tt=u(G.local.directAtTwilight,G.local.ambientAtTwilight),et=u(.9*G.local.directAtNoon,G.local.ambientAtNoon),nt=u(G.local.directAtNoon,G.local.ambientAtNoon),it=et,ot=K,at=Y,rt=tt,st=J,ct=X,lt=new Date(0),ut=s(),dt=M(),ft=M(),mt=M(),ht=.25,gt=.2;var bt;!function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"}(bt||(bt={}));class pt extends O{constructor(){super(...arguments),this.visualization=bt.Gradient,this.bandsEnabled=!1}}x([P({count:bt.COUNT})],pt.prototype,"visualization",void 0),x([P()],pt.prototype,"bandsEnabled",void 0);export{F as C,z as S,bt as a,D as b,R as c,H as d,_ as e,pt as f};
