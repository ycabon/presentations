/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{n as e,c as t,q as r,O as o}from"../core/lang.js";import{R as i,T as n,S as a}from"./basicInterfaces.js";import{_ as s}from"./tslib.es6.js";import{f as l,h as c}from"./mat3.js";import{c as u}from"./mat3f64.js";import{c as d,I as m}from"./mat4f64.js";import{s as f,g as h,h as p,c as v}from"./vec3.js";import{c as _,Z as g}from"./vec3f64.js";import{k as T,r as A,d as S,h as E,c as x,u as R,m as w,s as C,v as y}from"./mat4.js";import{B as P}from"./BindType.js";import{N as I,g as L}from"./interfaces5.js";import{p as b,S as D}from"./ShaderTechniqueConfiguration.js";import{V as F}from"./VertexAttribute.js";import{a as M,b as O}from"./doublePrecisionUtils.js";import{c as z}from"./mathUtils.js";import{m as N}from"./lengthUtils.js";import{d as U}from"./debugFlags2.js";import{R as B}from"./Material.js";import H from"../core/Error.js";import G from"../core/Evented.js";import{f as V,r as j}from"./maybe.js";import{throwIfAborted as $,onAbort as W,createAbortError as k}from"../core/promiseUtils.js";import{isBlobProtocol as X,isDataProtocol as q}from"../core/urlUtils.js";import{r as K}from"./requestImageUtils.js";import{l as Q}from"../request.js";import{g as Y}from"./assets.js";import{o as Z,a as J,T as ee,b as te,m as re,k as oe,n as ie}from"./enums.js";import{T as ne,g as ae,a as se,w as le}from"./Texture.js";import{a as ce,C as ue}from"./ContentObject.js";import{L as de}from"./Logger.js";import{a as me}from"./Util.js";import{P as fe}from"../core/scheduling.js";function he(t,r=!1){return t<=e?r?new Array(t).fill(0):new Array(t):new Float32Array(t)}function pe(r){return t(r)?r.length<e?r:new Float32Array(r):r.length<e?Array.from(r):r}function ve(r){return(t(r)?r.length:r.byteLength/8)<=e?Array.from(r):new Float32Array(r)}function _e(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}var ge,Te,Ae,Se;function Ee(e){return xe(e)||e===ge.Depth||e===ge.LinearDepth||e===ge.Normal||e===ge.ObjectAndLayerIdColor}function xe(e){return e===ge.Shadow||e===ge.ShadowHighlight||e===ge.ShadowExcludeHighlight}function Re(e){return De(e)||e===ge.Normal}function we(e){return e===ge.Highlight||e===ge.ObjectAndLayerIdColor}function Ce(e){return e===ge.Color||we(e)}function ye(e){return e===ge.Color||e===ge.Alpha}function Pe(e){return ye(e)||e===ge.ObjectAndLayerIdColor}function Ie(e){return ye(e)||e===ge.Highlight}function Le(e){return Ie(e)||e===ge.LinearDepth}function be(e){return ye(e)||we(e)}function De(e){return be(e)||e===ge.LinearDepth}!function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.Shadow=4]="Shadow",e[e.ShadowHighlight=5]="ShadowHighlight",e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",e[e.Highlight=7]="Highlight",e[e.Alpha=8]="Alpha",e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",e[e.CompositeColor=10]="CompositeColor",e[e.COUNT=11]="COUNT"}(ge||(ge={}));class Fe{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,t){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,t),this._technique),this._technique}ensureResources(e){return i.LOADED}}!function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.ANTIALIASING=12]="ANTIALIASING",e[e.COMPOSITE=13]="COMPOSITE",e[e.BLIT=14]="BLIT",e[e.SSAO=15]="SSAO",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT",e[e.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE",e[e.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=20]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=21]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=22]="HUD_MATERIAL",e[e.LABEL_MATERIAL=23]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=24]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=26]="DRAPED_MATERIAL",e[e.DRAPED_WATER=27]="DRAPED_WATER",e[e.VOXEL=28]="VOXEL",e[e.MAX_SLOTS=29]="MAX_SLOTS"}(Te||(Te={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(Ae||(Ae={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Se||(Se={}));class Me{constructor(e){this.field=e}}class Oe extends Me{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Ae.Undefined,Ae.Undefined,Ae.Undefined]}}class ze extends Me{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class Ne extends Me{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class Ue{}function Be(e){return null!=e}function He(e){return"number"==typeof e}function Ge(e){return"string"==typeof e}function Ve(e,t){e&&e.push(t)}function je(e,t,r,o,i){const n=e.minSize,a=e.maxSize;if(e.expression)return Ve(i,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=o.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ae.DefinedSize,!0}if(Be(e.field))return Be(e.stops)?2===e.stops.length&&He(e.stops[0].size)&&He(e.stops[1].size)?($e(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=Ae.DefinedSize,!0):(Ve(i,"Could not convert size info: stops only supported with 2 elements"),!1):He(n)&&He(a)&&Be(e.minDataValue)&&Be(e.maxDataValue)?($e(n,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=Ae.DefinedSize,!0):"unknown"===e.valueUnit?(Ve(i,"Could not convert size info: proportional size not supported"),!1):null!=N[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/N[e.valueUnit],t.type[r]=Ae.DefinedSize,!0):(Ve(i,"Could not convert size info: scale-dependent size not supported"),!1);if(!Be(e.field)){if(e.stops?.[0]&&He(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ae.DefinedSize,!0;if(He(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=Ae.DefinedSize,!0}return Ve(i,"Could not convert size info: unsupported variant of sizeInfo"),!1}function $e(e,t,r,o,i,n){const a=Math.abs(o-r)>0?(t-e)/(o-r):0;i.minSize[n]=a>0?e:t,i.maxSize[n]=a>0?t:e,i.offset[n]=e-r*a,i.factor[n]=a}function We(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function ke(e,t,r){const o=2===r&&"arithmetic"===e.rotationType;t.offset[r]=o?90:0,t.factor[r]=o?-1:1,t.type[r]=1}class Xe{constructor(e,t=[1,1,1],r=[1,1,1],o=1,i=[0,0,0],n=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=r,this.unitInMeters=o,this.anchor=i,this.scale=n,this.rotation=a}}function qe(e,t,r){if(!e)return null;const o=e.reduce(((e,o)=>{if(!e)return e;if(o.valueExpression)return Ve(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return t.supports.size?function(e,t,r,o){if(e.normalizationField||e.valueRepresentation)return Ve(o,"Could not convert size info: unsupported property"),null;if(null!=(i=e.field)&&!Ge(i))return Ve(o,"Could not convert size info: field is not a string"),null;var i;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Ve(o,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new Oe(e.field);let n;switch(e.axis){case"width":return n=je(e,t.size,0,r,o),n?t:null;case"height":return n=je(e,t.size,2,r,o),n?t:null;case"depth":return n=je(e,t.size,1,r,o),n?t:null;case"width-and-depth":return n=je(e,t.size,0,r,o),n&&je(e,t.size,1,r,o),n?t:null;case null:case void 0:case"all":return n=je(e,t.size,0,r,o),n=n&&je(e,t.size,1,r,o),n=n&&je(e,t.size,2,r,o),n?t:null;default:return Ve(o,`Could not convert size info: unknown axis "${e.axis}""`),null}}(o,e,t,r):e;case"color":return t.supports.color?function(e,t,r){if(e.normalizationField)return Ve(r,"Could not convert color info: unsupported property"),null;if(Ge(e.field)){if(!e.stops)return Ve(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Ve(r,"Could not convert color info: too many color stops"),null;t.color=new ze(e.field);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.color.values[e]=r.value,We(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Ve(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,We(t.color.colors,e,r)}}return t}(o,e,r):e;case"opacity":return t.supports.opacity?function(e,t,r){if(e.normalizationField)return Ve(r,"Could not convert opacity info: unsupported property"),null;if(Ge(e.field)){if(!e.stops)return Ve(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Ve(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new Ne(e.field);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Ve(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(o,e,r):null;case"rotation":return t.supports.rotation?function(e,t,r){if(!Ge(e.field))return Ve(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Ve(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return ke(e,t.rotation,0),t;case"roll":return ke(e,t.rotation,1),t;case null:case void 0:case"heading":return ke(e,t.rotation,2),t;default:return Ve(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(o,e,r):e;default:return null}}),new Ue);return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o?.size&&!function(e,t,r){for(let r=0;r<3;++r){let o=t.unitInMeters;e.type[r]===Ae.DefinedSize&&(o*=t.modelSize[r],e.type[r]=Ae.DefinedScale),e.minSize[r]=e.minSize[r]/o,e.maxSize[r]=e.maxSize[r]/o,e.offset[r]=e.offset[r]/o,e.factor[r]=e.factor[r]/o}let o;if(e.type[0]!==Ae.Undefined)o=0;else if(e.type[1]!==Ae.Undefined)o=1;else{if(e.type[2]===Ae.Undefined)return Ve(r,"No size axis contains a valid size or scale"),!1;o=2}for(let t=0;t<3;++t)e.type[t]===Ae.Undefined&&(e.minSize[t]=e.minSize[o],e.maxSize[t]=e.maxSize[o],e.offset[t]=e.offset[o],e.factor[t]=e.factor[o],e.type[t]=e.type[o]);return!0}(o.size,t,r)?null:o:null}class Ke{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function Qe(e,t){if(!e)return null;if(U.TESTS_DISABLE_FAST_UPDATES)return null;const r=qe(e.visualVariables,t);return r?new Ke(r,et(r,t),!!r.size):null}function Ye(e,t,r){if(!t||!e)return!1;const o=e.visualVariables,i=qe(t.visualVariables,r);return!!i&&!!(Ze(o.size,i.size,"size")&&Ze(o.color,i.color,"color")&&Ze(o.rotation,i.rotation,"rotation")&&Ze(o.opacity,i.opacity,"opacity"))&&(e.visualVariables=i,e.materialParameters=et(i,r),e.requiresShaderTransformation=!!i.size,!0)}function Ze(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,o=t;for(let e=0;e<3;e++)if(r.type[e]!==o.type[e]||r.offset[e]!==o.offset[e]||r.factor[e]!==o.factor[e])return!1}return!0}class Je extends I{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function et(e,t){const r=new Je(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,T(at),function(e,t,r,o=d()){const i=e||0,n=t||0,a=r||0;0!==i&&A(o,o,-i/180*Math.PI),0!==n&&S(o,o,n/180*Math.PI),0!==a&&E(o,o,a/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],at),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||u(),l(r.vvSymbolRotationMatrix,at)),r}function tt(e,t,r){if(!e.vvSize)return r;x(it,r);const o=e.vvSymbolRotationMatrix;R(at,o[0],o[1],o[2],0,o[3],o[4],o[5],0,o[6],o[7],o[8],0,0,0,0,1),w(it,it,at);for(let r=0;r<3;++r){const o=e.vvSize.offset[r]+t[0]*e.vvSize.factor[r];nt[r]=z(o,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return C(it,it,nt),y(it,it,e.vvSymbolAnchor),it}function rt(e,t,r){if(!t.vvSize)return f(e,1,1,1),e;for(let o=0;o<3;++o){const i=t.vvSize.offset[o]+r[0]*t.vvSize.factor[o];e[o]=z(i,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return e}function ot(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:0}const it=d(),nt=_(),at=d();class st extends Je{constructor(){super(...arguments),this.renderOccluded=B.Occlude,this.isDecoration=!1}}const lt=8;function ct({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(L`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(L`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}class ut{constructor(e,t,r,o,i=null){if(this.name=e,this.type=t,this.arraySize=i,this.bind={[P.Pass]:null,[P.Draw]:null},o)switch(r){case P.Pass:this.bind[P.Pass]=o;break;case P.Draw:this.bind[P.Draw]=o}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}class dt extends ut{constructor(e,t){super(e,"vec3",P.Draw,((r,o,i,n)=>r.setUniform3fv(e,t(o,i,n))))}}class mt extends ut{constructor(e,t){super(e,"vec3",P.Pass,((r,o,i)=>r.setUniform3fv(e,t(o,i))))}}class ft extends ut{constructor(e,t){super(e,"float",P.Pass,((r,o,i)=>r.setUniform1f(e,t(o,i))))}}class ht extends ut{constructor(e,t){super(e,"mat4",P.Draw,((r,o,i)=>r.setUniformMatrix4fv(e,t(o,i))))}}class pt extends ut{constructor(e,t){super(e,"mat4",P.Pass,((r,o,i)=>r.setUniformMatrix4fv(e,t(o,i))))}}function vt(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",g):e.uniforms.add(new dt("cameraPosition",((e,t)=>f(Tt,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function _t(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new pt("proj",((e,t)=>t.camera.projectionMatrix)),new ht("view",((e,t)=>y(gt,t.camera.viewMatrix,e.origin))),new dt("localOrigin",(e=>e.origin)));const r=e=>f(Tt,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new pt("proj",((e,t)=>t.camera.projectionMatrix)),new pt("view",((e,t)=>y(gt,t.camera.viewMatrix,r(t)))),new mt("localOrigin",((e,t)=>r(t))))}const gt=d(),Tt=_();function At(e){e.uniforms.add(new pt("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function St(e){e.uniforms.add(new ft("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}class Et extends ut{constructor(e,t){super(e,"mat3",P.Pass,((r,o,i)=>r.setUniformMatrix3fv(e,t(o,i))))}}class xt extends D{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}s([b()],xt.prototype,"instancedDoublePrecision",void 0),s([b()],xt.prototype,"hasModelTransformation",void 0);const Rt=u();function wt(e,t){const r=t.hasModelTransformation,o=t.instancedDoublePrecision;r&&(e.vertex.uniforms.add(new pt("model",(e=>e.modelTransformation??m))),e.vertex.uniforms.add(new Et("normalLocalOriginFromModel",(e=>(c(Rt,e.modelTransformation??m),Rt))))),t.instanced&&o&&(e.attributes.add(F.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(F.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(F.INSTANCEMODEL,"mat3"),e.attributes.add(F.INSTANCEMODELNORMAL,"mat3"));const i=e.vertex;o&&(i.include(ct,t),i.uniforms.add(new dt("viewOriginHi",((e,t)=>M(f(Ct,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),Ct))),new dt("viewOriginLo",((e,t)=>O(f(Ct,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),Ct))))),i.code.add(L`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?o?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":o?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${o?L`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(L`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?o?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":o?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===ge.Normal&&(At(i),i.code.add(L`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?o?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":o?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&i.code.add(L`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?o?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":o?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const Ct=_();class yt extends xt{}function Pt(e){e.attributes.add(F.POSITION,"vec3"),e.vertex.code.add(L`vec3 positionModel() { return position; }`)}s([b({constValue:!0})],yt.prototype,"hasSliceHighlight",void 0),s([b({constValue:!1})],yt.prototype,"hasSliceInVertexProgram",void 0),s([b({constValue:P.Pass})],yt.prototype,"pbrTextureBindType",void 0);class It extends ut{constructor(e,t){super(e,"mat3",P.Draw,((r,o,i)=>r.setUniformMatrix3fv(e,t(o,i))))}}function Lt(e,t){e.include(Pt);const r=e.vertex;r.include(ct,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new mt("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new mt("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new Et("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new pt("transformProjFromView",(e=>e.transformProjFromView)),new It("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new dt("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new dt("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),r.code.add(L`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(L`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?L`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:L`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new mt("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),r.code.add(L`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(L`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class bt extends I{constructor(){super(...arguments),this.transformWorldFromViewTH=_(),this.transformWorldFromViewTL=_(),this.transformViewFromCameraRelativeRS=u(),this.transformProjFromView=d()}}class Dt extends I{constructor(){super(...arguments),this.transformWorldFromModelRS=u(),this.transformWorldFromModelTH=_(),this.transformWorldFromModelTL=_()}}class Ft extends ut{constructor(e,t){super(e,"vec2",P.Pass,((r,o,i)=>r.setUniform2fv(e,t(o,i))))}}function Mt(e){e.varyings.add("linearDepth","float")}function Ot(e){e.vertex.uniforms.add(new Ft("nearFar",((e,t)=>t.camera.nearFar)))}function zt(e){e.vertex.code.add(L`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function Nt(e,t){const{vertex:r}=e;switch(t.output){case ge.Color:if(t.receiveShadows)return Mt(e),void r.code.add(L`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case ge.LinearDepth:case ge.Shadow:case ge.ShadowHighlight:case ge.ShadowExcludeHighlight:return e.include(Lt,t),Mt(e),Ot(e),zt(e),void r.code.add(L`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(L`void forwardLinearDepth() {}`)}class Ut extends I{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function Bt(e,t){Gt(e,t,new mt("slicePlaneOrigin",((e,r)=>Wt(t,e,r))),new mt("slicePlaneBasis1",((e,r)=>kt(t,e,r,r.slicePlane?.basis1))),new mt("slicePlaneBasis2",((e,r)=>kt(t,e,r,r.slicePlane?.basis2))))}function Ht(e,t){Gt(e,t,new dt("slicePlaneOrigin",((e,r)=>Wt(t,e,r))),new dt("slicePlaneBasis1",((e,r)=>kt(t,e,r,r.slicePlane?.basis1))),new dt("slicePlaneBasis2",((e,r)=>kt(t,e,r,r.slicePlane?.basis2))))}function Gt(e,t,...r){if(!t.hasSlicePlane){const r=L`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(r),void e.fragment.code.add(r)}t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...r),e.fragment.uniforms.add(...r);const o=L`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,i=L`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?L`
        ${i}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:L`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(o),e.fragment.code.add(o),e.fragment.code.add(n)}function Vt(e,t,r){return e.instancedDoublePrecision?f(Xt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function jt(e,t){return null!=e?v(qt,t.origin,e):t.origin}function $t(e,t,r){return e.hasSliceTranslatedView?null!=t?y(Qt,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function Wt(e,t,r){if(null==r.slicePlane)return g;const o=Vt(e,t,r),i=jt(o,r.slicePlane),n=$t(e,o,r);return null!=n?h(qt,i,n):i}function kt(e,t,r,o){if(null==o||null==r.slicePlane)return g;const i=Vt(e,t,r),n=jt(i,r.slicePlane),a=$t(e,i,r);return null!=a?(p(Kt,o,n),h(qt,n,a),h(Kt,Kt,a),v(Kt,Kt,qt)):o}const Xt=_(),qt=_(),Kt=_(),Qt=d();function Yt(e,t){const r=t.output===ge.ObjectAndLayerIdColor,o=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),o?e.attributes.add(F.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):e.attributes.add(F.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(L`
     void forwardObjectAndLayerIdColor() {
      ${r?o?L`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:L`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:L``} }`),e.fragment.code.add(L`
      void outputObjectAndLayerIdColor() {
        ${r?L`fragColor = objectAndLayerIdColorVarying;`:L``} }`)}class Zt extends ut{constructor(e,t,r){super(e,"vec4",P.Pass,((r,o,i)=>r.setUniform4fv(e,t(o,i))),r)}}class Jt extends ut{constructor(e,t,r){super(e,"float",P.Pass,((r,o,i)=>r.setUniform1fv(e,t(o,i))),r)}}function er(e,t){const{vertex:r,attributes:o}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&o.add(F.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(r.uniforms.add(new mt("vvSizeMinSize",(e=>e.vvSize.minSize))),r.uniforms.add(new mt("vvSizeMaxSize",(e=>e.vvSize.maxSize))),r.uniforms.add(new mt("vvSizeOffset",(e=>e.vvSize.offset))),r.uniforms.add(new mt("vvSizeFactor",(e=>e.vvSize.factor))),r.uniforms.add(new Et("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),r.uniforms.add(new mt("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),r.code.add(L`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(L`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?L`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(L`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",8),r.uniforms.add(new Jt("vvColorValues",(e=>e.vvColor.values),8),new Zt("vvColorColors",(e=>e.vvColor.colors),8)),r.code.add(L`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?L`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(L`vec4 vvColor() { return vec4(1.0); }`)}function tr(e){e.code.add(L`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function rr(e){e.code.add(L`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function or(e,t){switch(t.output){case ge.Shadow:case ge.ShadowHighlight:case ge.ShadowExcludeHighlight:e.fragment.include(tr),e.fragment.code.add(L`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case ge.LinearDepth:e.fragment.include(rr),e.fragment.code.add(L`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}class ir extends ut{constructor(e,t){super(e,"vec4",P.Pass,((r,o,i)=>r.setUniform4fv(e,t(o,i))))}}class nr extends ut{constructor(e,t){super(e,"sampler2D",P.Pass,((r,o,i)=>r.bindTexture(e,t(o,i))))}}let ar;var sr;!function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(sr||(sr={}));let lr=null,cr=null;async function ur(){return null==cr&&(cr=function(){if(null==ar){const e=e=>Y(`esri/libs/basisu/${e}`);ar=import("./basis_transcoder.js").then((e=>e.b)).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return ar}(),lr=await cr),cr}function dr(e,t,r,o,i){const n=ae(t?Z.COMPRESSED_RGBA8_ETC2_EAC:Z.COMPRESSED_RGB8_ETC2),a=i&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*o*n*a)}function mr(e){return e.getNumImages()>=1&&!e.isUASTC()}function fr(e){return e.getFaces()>=1&&e.isETC1S()}function hr(e,t,r,o,i,n,a,s){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,d]=l?o?[sr.ETC2_RGBA,Z.COMPRESSED_RGBA8_ETC2_EAC]:[sr.ETC1_RGB,Z.COMPRESSED_RGB8_ETC2]:c?o?[sr.BC3_RGBA,Z.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[sr.BC1_RGB,Z.COMPRESSED_RGB_S3TC_DXT1_EXT]:[sr.RGBA32,J.RGBA],m=t.hasMipmap?r:Math.min(1,r),f=[];for(let e=0;e<m;e++)f.push(new Uint8Array(a(e,u))),s(e,u,f[e]);return t.internalFormat=d,t.hasMipmap=f.length>1,t.samplingMode=t.hasMipmap?ee.LINEAR_MIPMAP_LINEAR:ee.LINEAR,t.width=i,t.height=n,new ne(e,t,{type:"compressed",levels:f})}const pr=()=>de.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function vr(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const _r=vr("DXT1"),gr=vr("DXT3"),Tr=vr("DXT5");function Ar(e){return 16*Math.ceil(e/16)}function Sr(e){return 16*Math.floor(e/16)}function Er(e,t){let r=e.width*e.height;if(r<4096)return e instanceof ImageData?Rr(e):e;let o=e.width,i=e.height;do{o=Math.ceil(o/2),i=Math.ceil(i/2),r=o*i}while(r>1048576||null!=t&&(o>t||i>t));return xr(e,o,i)}function xr(e,t,r){if(e instanceof ImageData)return xr(Rr(e),t,r);const o=document.createElement("canvas");return o.width=t,o.height=r,o.getContext("2d").drawImage(e,0,0,o.width,o.height),o}function Rr(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(null==r)throw new H("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(e,0,0),t}class wr extends ce{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=ue.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new G,this._parameters={...Pr,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(X(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){q(e.src)||X(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new se;return t.wrapMode=this._parameters.wrap??te.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?ee.LINEAR_MIPMAP_LINEAR:ee.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if(r(e)||o(e))return t.encoding===n.KTX2_ENCODING?function(e,t){if(null==lr)return e.byteLength;const r=new lr.KTX2File(new Uint8Array(e)),o=fr(r)?dr(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),o}(e,!!t.mipmap):t.encoding===n.BASIS_ENCODING?function(e,t){if(null==lr)return e.byteLength;const r=new lr.BasisFile(new Uint8Array(e)),o=mr(r)?dr(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),o}(e,!!t.mipmap):e.byteLength;const{width:i,height:a}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?Cr(e):t;return(t.mipmap?4/3:1)*i*a*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new ne(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):(r(t)||o(t))&&this._parameters.encoding===n.DDS_ENCODING?this._loadFromDDSData(e,t):(r(t)||o(t))&&this._parameters.encoding===n.KTX2_ENCODING?this._loadFromKTX2(e,t):(r(t)||o(t))&&this._parameters.encoding===n.BASIS_ENCODING?this._loadFromBasis(e,t):o(t)?this._loadFromPixelData(e,t):r(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<yr.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,r){const o=function(e,t){const r=new Int32Array(e,0,31);if(542327876!==r[0])return pr().error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return pr().error("Unsupported format, must contain a FourCC code"),null;const o=r[21];let i,n;switch(o){case _r:i=8,n=Z.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case gr:i=16,n=Z.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Tr:i=16,n=Z.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return pr().error("Unsupported FourCC code:",(a=o,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255))),null}var a;let s=1,l=r[4],c=r[3];0==(3&l)&&0==(3&c)||(pr().warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,c=c+3&-4);const u=l,d=c;131072&r[2]&&!1!==t&&(s=Math.max(1,r[7]));let m,f,h=r[1]+4;const p=[];for(let t=0;t<s;++t)f=(l+3>>2)*(c+3>>2)*i,m=new Uint8Array(e,h,f),p.push(m),h+=f,l=Math.max(1,l>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:p},internalFormat:n,width:u,height:d}}(r,t.hasMipmap??!1);if(null==o)throw new Error("DDS texture data is null");const{textureData:i,internalFormat:n,width:a,height:s}=o;return t.samplingMode=i.levels.length>1?ee.LINEAR_MIPMAP_LINEAR:ee.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=n,t.width=a,t.height=s,new ne(e,t,i)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,r){null==lr&&(lr=await ur());const o=new lr.KTX2File(new Uint8Array(r));if(!fr(o))return null;o.startTranscoding();const i=hr(e,t,o.getLevels(),o.getHasAlpha(),o.getWidth(),o.getHeight(),((e,t)=>o.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>o.transcodeImage(r,e,0,0,t,0,-1,-1)));return o.close(),o.delete(),i}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,r){null==lr&&(lr=await ur());const o=new lr.BasisFile(new Uint8Array(r));if(!mr(o))return null;o.startTranscoding();const i=hr(e,t,o.getNumLevels(0),o.getHasAlpha(),o.getImageWidth(0,0),o.getImageHeight(0,0),((e,t)=>o.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>o.transcodeImage(r,0,e,t,0,0)));return o.close(),o.delete(),i}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){me(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?J.LUMINANCE:3===this._parameters.components?J.RGB:J.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new ne(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async r=>{const o=await K(t,{signal:r});return $(r),this._loadFromImage(e,o)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async r=>{const o=await Q(t,t.src,!1,r);return $(r),this._loadFromImage(e,o)}))}_loadFromVideoElement(e,t){return t.readyState>=yr.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((r=>new Promise(((o,i)=>{const n=()=>{t.removeEventListener("loadeddata",a),t.removeEventListener("error",s),j(l)},a=()=>{t.readyState>=yr.HAVE_CURRENT_DATA&&(n(),o(this._loadFromImage(e,t)))},s=e=>{n(),i(e||new H("Failed to load video"))};t.addEventListener("loadeddata",a),t.addEventListener("error",s);const l=W(r,(()=>s(k())))}))))}_loadFromImage(e,t){let r=t;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;r=this._parameters.downsampleUncompressed?Er(r,t):function(e,t){const r=Math.max(e.width,e.height);if(r<=t)return e;const o=t/r;return xr(e,Math.round(e.width*o),Math.round(e.height*o))}(r,t)}const o=Cr(r);this._parameters.width=o.width,this._parameters.height=o.height;const i=this._createDescriptor(e);return i.pixelFormat=3===this._parameters.components?J.RGB:J.RGBA,i.width=o.width,i.height=o.height,this._glTexture=new ne(e,i,r),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const o=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(o,o),r}unload(){if(this._glTexture=V(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function Cr(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}var yr;!function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(yr||(yr={}));const Pr={wrap:{s:te.REPEAT,t:te.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};function Ir(e){e.include(rr),e.code.add(L`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function Lr(e){e.code.add(L`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromDepthTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)}function br(e,t){if(!t.multipassEnabled)return;e.fragment.include(Ir),e.fragment.uniforms.add(new nr("terrainDepthTexture",((e,t)=>t.multipassTerrain.linearDepth?.getTexture())),new Ft("nearFar",((e,t)=>t.camera.nearFar)));const r=t.occlusionPass;e.fragment.code.add(L`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${r?L`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:L`
          if(fragmentDepth ${t.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}class Dr{constructor(){this.cullAboveGround=!1}}function Fr(e){e.vertex.code.add(L`const float PI = 3.141592653589793;`),e.fragment.code.add(L`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}const Mr=.1,Or=.001;function zr(e){e.code.add(L`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}const Nr=()=>de.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Ur{constructor(){this._includedModules=new Map}include(e,t){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==t){Nr().error("Shader module included multiple times with different configuration.");const t=new Set;for(const o of Object.keys(r))r[o]!==e[o]&&t.add(o);for(const o of Object.keys(e))r[o]!==e[o]&&t.add(o);t.forEach((t=>console.error(`  ${t}: current ${r[t]} new ${e[t]}`)))}}else this._includedModules.set(e,t),e(this.builder,t)}}class Br extends Ur{constructor(){super(...arguments),this.vertex=new Vr,this.fragment=new Vr,this.attributes=new jr,this.varyings=new $r,this.extensions=new Wr,this.constants=new Xr,this.outputs=new kr}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),o=this.varyings.generateSource(e),i="vertex"===e?this.vertex:this.fragment,n=i.uniforms.generateSource(),a=i.code.generateSource(),s="vertex"===e?Kr:qr,l=this.constants.generateSource().concat(i.constants.generateSource()),c=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${s}\n\n${l.join("\n")}\n\n${n.join("\n")}\n\n${r.join("\n")}\n\n${o.join("\n")}\n\n${c.join("\n")}\n\n${a.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[P.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[P.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),o=r.length;return(t,i)=>{for(let n=0;n<o;++n)r[n](e,t,i)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[P.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[P.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),o=r.length;return(t,i,n)=>{for(let a=0;a<o;++a)r[a](e,t,i,n)}}}class Hr{constructor(){this._entries=new Map}add(...e){for(const t of e)this._add(t)}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new H(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Nr().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class Gr{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class Vr extends Ur{constructor(){super(...arguments),this.uniforms=new Hr,this.code=new Gr,this.constants=new Xr}get builder(){return this}}class jr{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class $r{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&me(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((r,o)=>t.push("vertex"===e?`out ${r} ${o};`:`in ${r} ${o};`))),t}}class Wr{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?Wr.ALLOWLIST_VERTEX:Wr.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}Wr.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Wr.ALLOWLIST_VERTEX=[];class kr{constructor(){this._entries=new Map}add(e,t,r=0){const o=this._entries.get(r);o?me(o.name===e&&o.type===t,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:kr.DEFAULT_NAME,type:kr.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`))),t}}kr.DEFAULT_TYPE="vec4",kr.DEFAULT_NAME="fragColor";class Xr{constructor(){this._entries=new Set}add(e,t,r){let o="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":o=Xr._numberToFloatStr(r);break;case"int":o=Xr._numberToIntStr(r);break;case"bool":o=r.toString();break;case"vec2":o=`vec2(${Xr._numberToFloatStr(r[0])},                            ${Xr._numberToFloatStr(r[1])})`;break;case"vec3":o=`vec3(${Xr._numberToFloatStr(r[0])},                            ${Xr._numberToFloatStr(r[1])},                            ${Xr._numberToFloatStr(r[2])})`;break;case"vec4":o=`vec4(${Xr._numberToFloatStr(r[0])},                            ${Xr._numberToFloatStr(r[1])},                            ${Xr._numberToFloatStr(r[2])},                            ${Xr._numberToFloatStr(r[3])})`;break;case"ivec2":o=`ivec2(${Xr._numberToIntStr(r[0])},                             ${Xr._numberToIntStr(r[1])})`;break;case"ivec3":o=`ivec3(${Xr._numberToIntStr(r[0])},                             ${Xr._numberToIntStr(r[1])},                             ${Xr._numberToIntStr(r[2])})`;break;case"ivec4":o=`ivec4(${Xr._numberToIntStr(r[0])},                             ${Xr._numberToIntStr(r[1])},                             ${Xr._numberToIntStr(r[2])},                             ${Xr._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":o=`${t}(${Array.prototype.map.call(r,(e=>Xr._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${o};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const qr="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",Kr="precision highp float;\nprecision highp sampler2D;";class Qr{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}class Yr{constructor(e,t,r){this.release=r,this.initializeConfiguration(e,t),this._configuration=t.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=V(this._program),this._pipeline=this._configuration=null}reload(e){V(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return re.TRIANGLES}getPipeline(e,t,r){return this._pipeline}initializeConfiguration(e,t){}}class Zr{constructor(e,t,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new fe({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=le()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}const Jr={func:oe.LESS},eo={func:oe.ALWAYS},to={mask:255},ro={mask:0},oo=e=>({function:{func:oe.NOTEQUAL,ref:e,mask:e},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.KEEP}}),io=e=>({function:{func:oe.ALWAYS,ref:e,mask:e},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.REPLACE}}),no={function:{func:oe.ALWAYS,ref:a.OutlineVisualElementMask,mask:a.OutlineVisualElementMask},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.ZERO}},ao={function:{func:oe.ALWAYS,ref:a.OutlineVisualElementMask,mask:a.OutlineVisualElementMask},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.REPLACE}},so={function:{func:oe.EQUAL,ref:a.OutlineVisualElementMask,mask:a.OutlineVisualElementMask},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.KEEP}},lo={function:{func:oe.NOTEQUAL,ref:a.OutlineVisualElementMask,mask:a.OutlineVisualElementMask},operation:{fail:ie.KEEP,zFail:ie.KEEP,zPass:ie.KEEP}};export{Et as $,Ce as A,st as B,zr as C,yt as D,At as E,ir as F,Fe as G,St as H,rr as I,be as J,rt as K,Ut as L,pt as M,ht as N,Yt as O,Zr as P,dt as Q,Ir as R,ge as S,wr as T,ut as U,er as V,Er as W,Dt as X,bt as Y,Lt as Z,It as _,Ft as a,Fr as a0,ur as a1,pe as a2,Jt as a3,Ee as a4,eo as a5,lo as a6,ro as a7,so as a8,Jr as a9,De as aa,Lr as ab,tr as ac,Pt as ad,wt as ae,Nt as af,Re as ag,xe as ah,Dr as ai,Ar as aj,Sr as ak,ot as al,Qe as am,Ye as an,Xe as ao,Le as ap,tt as aq,_e as ar,lt as as,Zt as at,we as au,oo as av,Bt as aw,io as ax,ct as ay,mt as b,vt as c,nr as d,zt as e,ve as f,Br as g,_t as h,Ht as i,ft as j,Mr as k,Qr as l,br as m,he as n,Yr as o,ao as p,no as q,Te as r,to as s,ye as t,Ie as u,or as v,Ot as w,Mt as x,Or as y,Pe as z};
