/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{urlToObject as e,removeTrailingSlash as r,removeQueryParameters as s,join as t,Url as n,makeAbsolute as l}from"../core/urlUtils.js";import{w as u}from"./persistableUrlUtils.js";const i={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},a=Object.values(i),o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),f=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function v(e){return!!o.test(e)}function p(r){if(null==r)return null;const s=e(r),t=s?.path.match(o)||s?.path.match(c);if(!t)return null;const[,n,l,u,a]=t,f=l.indexOf("/");return{title:m(-1!==f?l.slice(f+1):l),serverType:i[u.toLowerCase()],sublayer:null!=a&&""!==a?parseInt(a,10):null,url:{path:n}}}function d(r){const s=e(r).path.match(f);return s?{serviceUrl:s[1],sublayerId:Number(s[2])}:null}function m(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function w(e,r){const s=[];if(e){const r=p(e);null!=r&&r.title&&s.push(r.title)}if(r){const e=m(r);s.push(e)}if(2===s.length){if(s[0].toLowerCase().includes(s[1].toLowerCase()))return s[0];if(s[1].toLowerCase().includes(s[0].toLowerCase()))return s[1]}return s.join(" - ")}function h(e){if(!e)return!1;const r=(e=e.toLowerCase()).includes(".arcgis.com/"),s=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return r&&s}function y(e,t){return e?r(s(e,t)):e}function g(t){let{url:n}=t;if(!n)return{url:n};n=s(n,t.logger);const l=e(n),u=p(l.path);let i;if(null!=u)null!=u.sublayer&&null==t.layer.layerId&&(i=u.sublayer),n=u.url.path;else if(t.nonStandardUrlAllowed){const e=d(l.path);null!=e&&(n=e.serviceUrl,i=e.sublayerId)}return{url:r(n),layerId:i}}function S(e,r,s,n,l){u(r,n,"url",l),n.url&&null!=e.layerId&&(n.url=t(n.url,s,e.layerId.toString()))}function b(e){if(!e)return!1;const r=e.toLowerCase(),s=r.includes("/services/"),t=r.includes("/mapserver/wmsserver"),n=r.includes("/imageserver/wmsserver"),l=r.includes("/wmsserver");return s&&(t||n||l)}function C(e){if(!e)return!1;const r=new n(l(e)),s=r.authority?.toLowerCase();return"server.arcgisonline.com"===s||"services.arcgisonline.com"===s}export{v as a,d as b,C as c,m as d,g as e,b as f,h as i,p,y as s,w as t,S as w};
