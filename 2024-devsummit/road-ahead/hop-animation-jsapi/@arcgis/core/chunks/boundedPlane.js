/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{a as i}from"./mathUtils.js";import{h as n,O as t,i as a,g as o,j as r,w as e,k as c,s as u,l as g,m as b,n as f,o as l,q as p,r as m,t as d,u as h}from"./plane.js";import{i as I,t as j,a as P}from"./mat4.js";import{c as N}from"./mat4f64.js";import{p as v,d as w,l as M,g as T,b as A,h as S,s as x,i as y,x as _,c as O,o as V,n as E,j as Y}from"./vec3.js";import{f as q,a as B,c as F}from"./vec3f64.js";import{A as L}from"./Axis.js";import{c as k,p as C,d as R}from"./lineSegment.js";const U=()=>s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),z=class{constructor(){this.plane=n(),this.origin=F(),this.basis1=F(),this.basis2=F()}};function G(s=ls){return{plane:n(s.plane),origin:B(s.origin),basis1:B(s.basis1),basis2:B(s.basis2)}}function W(s,i=G()){return X(s.origin,s.basis1,s.basis2,i)}function X(s,i,n,t=G()){return v(t.origin,s),v(t.basis1,i),v(t.basis2,n),Z(t),a=t,o="fromValues()",Math.abs(w(a.basis1,a.basis2)/(M(a.basis1)*M(a.basis2)))>1e-6&&U().warn(o,"Provided basis vectors are not perpendicular"),Math.abs(w(a.basis1,cs(a)))>1e-6&&U().warn(o,"Basis vectors and plane normal are not perpendicular"),Math.abs(-w(cs(a),a.origin)-a.plane[3])>1e-6&&U().warn(o,"Plane offset is not consistent with plane origin"),t;var a,o}function Z(s){a(s.basis2,s.basis1,s.origin,s.plane)}function D(s,i,n){s!==n&&W(s,n);const t=A(u.get(),cs(s),i);return S(n.origin,n.origin,t),n.plane[3]-=i,n}function H(s,i=G()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return x(i.origin,s[0]+n,s[1]+t,0),x(i.basis1,n,0,0),x(i.basis2,0,t,0),g(0,0,1,0,i.plane),i}function J(s,i,n){return!!b(s.plane,i,n)&&us(s,n)}function K(s,n,t){const a=ps.get();fs(s,n,a,ps.get());let o=Number.POSITIVE_INFINITY;for(const r of Is){const e=bs(s,r,ms.get()),c=u.get();if(f(a,e,c)){const s=_(u.get(),n.origin,c),a=Math.abs(i(w(n.direction,s)));a<o&&(o=a,v(t,c))}}return o===Number.POSITIVE_INFINITY?Q(s,n,t):t}function Q(s,i,n){if(J(s,i,n))return n;const t=ps.get(),a=ps.get();fs(s,i,t,a);let o=Number.POSITIVE_INFINITY;for(const r of Is){const e=bs(s,r,ms.get()),c=u.get();if(l(t,e,c)){const s=p(i,c);if(!m(a,c))continue;s<o&&(o=s,v(n,c))}}return is(s,i.origin)<o&&$(s,i.origin,n),n}function $(s,i,n){const t=d(s.plane,i,u.get()),a=C(gs(s,s.basis1),t,-1,1,u.get()),o=C(gs(s,s.basis2),t,-1,1,u.get());return O(n,S(u.get(),a,o),s.origin),n}function ss(s,i,n){const{origin:t,basis1:a,basis2:o}=s,r=O(u.get(),i,t),e=h(a,r),c=h(o,r),g=h(cs(s),r);return x(n,e,c,g)}function is(s,i){const n=ss(s,i,u.get()),{basis1:t,basis2:a}=s,o=M(t),r=M(a),e=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-r,0),g=n[2];return e*e+c*c+g*g}function ns(s,i){return Math.sqrt(is(s,i))}function ts(s,i){return m(s.plane,i)&&us(s,i)}function as(s,i){const n=-s.plane[3];return h(cs(s),i)-n}function os(s,i){return V(s.basis1,i.basis1)&&V(s.basis2,i.basis2)&&V(s.origin,i.origin)}function rs(s,i,n){return s!==n&&W(s,n),I(js,i),j(js,js),T(n.basis1,s.basis1,js),T(n.basis2,s.basis2,js),T(o(n.plane),o(s.plane),js),T(n.origin,s.origin,i),r(n.plane,n.plane,n.origin),n}function es(s,i,n,t){return s!==t&&W(s,t),P(Ps,i,n),T(t.basis1,s.basis1,Ps),T(t.basis2,s.basis2,Ps),Z(t),t}function cs(s){return o(s.plane)}function us(s,i){const n=O(u.get(),i,s.origin),t=Y(s.basis1),a=Y(s.basis2),o=w(s.basis1,n),r=w(s.basis2,n);return-o-t<0&&o-t<0&&-r-a<0&&r-a<0}function gs(s,i){const n=ms.get();return v(n.origin,s.origin),v(n.vector,i),n}function bs(s,i,n){const{basis1:t,basis2:a,origin:o}=s,r=A(u.get(),t,i.origin[0]),e=A(u.get(),a,i.origin[1]);S(n.origin,r,e),S(n.origin,n.origin,o);const c=A(u.get(),t,i.direction[0]),g=A(u.get(),a,i.direction[1]);return A(n.vector,S(c,c,g),2),n}function fs(s,i,n,t){const r=cs(s);a(r,i.direction,i.origin,n),a(o(n),r,i.origin,t)}const ls={plane:n(),origin:q(0,0,0),basis1:q(1,0,0),basis2:q(0,1,0)},ps=new t(n),ms=new t(k),ds=F(),hs=new t((()=>G())),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],js=N(),Ps=N(),Ns=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:z,altitudeAt:as,axisAt:function(s,i,n,t){return function(s,i,n){switch(i){case L.X:v(n,s.basis1),E(n,n);break;case L.Y:v(n,s.basis2),E(n,n);break;case L.Z:v(n,cs(s))}return n}(s,n,t)},closestPoint:Q,closestPointOnSilhouette:K,copy:W,copyWithoutVerify:function(s,i){v(i.origin,s.origin),v(i.basis1,s.basis1),v(i.basis2,s.basis2),c(i.plane,s.plane)},create:G,distance:ns,distance2:is,distanceToSilhouette:function(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of Is){const a=bs(s,t,ms.get()),o=R(a,i);o>n&&(n=o)}return Math.sqrt(n)},elevate:D,equals:os,extrusionContainsPoint:ts,fromAABoundingRect:H,fromValues:X,intersectRay:J,intersectRayClosestSilhouette:function(s,i,n){if(J(s,i,n))return n;const t=K(s,i,u.get());return S(n,i.origin,A(u.get(),i.direction,y(i.origin,t)/M(i.direction))),n},normal:cs,projectPoint:$,projectPointLocal:ss,rotate:es,setAltitudeAt:function(s,i,n,t){const a=as(s,i),o=A(ds,cs(s),n-a);return S(t,i,o),t},setExtent:function(s,i,n){return H(i,n),D(n,as(s,s.origin),n),n},transform:rs,up:ls,updateUnboundedPlane:Z,wrap:function(s,i,n){const t=hs.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=e(0,0,0,0),Z(t),t}},Symbol.toStringTag,{value:"Module"}));export{z as B,W as a,Ns as b,G as c,H as d,ts as e,X as f,ns as g,os as h,J as i,cs as n,es as r,rs as t,Z as u};
