/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import e from"../core/Accessor.js";import t from"../core/Collection.js";import{g as n}from"./utils.js";const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function r(t){return t instanceof e}function i(e){return e instanceof t?Object.keys(e.items):r(e)?n(e).keys():e?Object.keys(e):[]}function f(e,n){return e instanceof t?e.items[n]:e[n]}function l(e){return e?e.declaredClass:null}function c(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const u=i(e),s=i(t);if(0===u.length&&0===s.length)return;if(!u.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const a=s.filter((e=>!u.includes(e))),p=u.filter((e=>!s.includes(e))),y=u.filter((n=>s.includes(n)&&f(e,n)!==f(t,n))).concat(a,p).sort(),d=l(e);if(d&&o.has(d)&&y.length)return{type:"complete",oldValue:e,newValue:t};let m;const h=r(e)&&r(t);for(const o of y){const r=f(e,o),i=f(t,o);let u;if((h||"function"!=typeof r&&"function"!=typeof i)&&r!==i&&(null!=r||null!=i)){if(n&&n[o]&&"function"==typeof n[o])u=n[o]?.(r,i);else if(r instanceof Date&&i instanceof Date){if(r.getTime()===i.getTime())continue;u={type:"complete",oldValue:r,newValue:i}}else u="object"==typeof r&&"object"==typeof i&&l(r)===l(i)?c(r,i):{type:"complete",oldValue:r,newValue:i};null!=u&&(null!=m?m.diff[o]=u:m={type:"partial",diff:{[o]:u}})}}return m}function u(e,t){return s(e,t)}function s(e,t){if(null==e)return!1;const n=t.split(".");let o=e;for(const e of n){if("complete"===o.type)return!0;if("partial"!==o.type)return!1;{const t=o.diff[e];if(!t)return!1;o=t}}return!0}function a(e,t){if(!e)return!1;if("partial"===e.type){const n=Object.keys(e.diff);return 1===n.length&&n[0]===t}return!1}function p(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)}function y(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!y(e))return!1;for(const e of t.removed)if(!y(e))return!1;for(const e of t.changed)if(!y(e))return!1;return!0}case"partial":for(const t in e.diff)if(!y(e.diff[t]))return!1;return!0}}export{a,u as b,p as d,s as h,y as i};
