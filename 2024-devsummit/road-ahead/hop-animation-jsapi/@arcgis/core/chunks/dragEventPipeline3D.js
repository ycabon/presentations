/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import"../geometry.js";import{s as e,f as n,b as t}from"./screenUtils.js";import{l as r,p as s,e as o,c as l,d as a,b as c,h as u}from"./vec3.js";import{c as i}from"./vec3f64.js";import{projectPoint as d}from"../geometry/projection.js";import{v as p,x as f,m,h as E,g as S,y as g,z as y}from"./plane.js";import{h as R,d as x}from"./elevationInfoUtils.js";import{f as j}from"./ray.js";import{n as v,S as I,I as w}from"./Intersector2.js";import{t as H}from"./verticalOffsetUtils.js";import{E as U}from"./InteractiveToolBase.js";import b from"../geometry/Point.js";function O(e,n){return h(e,(()=>n))}function T(e){return h(e,(e=>e.plane))}function h(t,r){const s=i(),o=i();let l=!1;return a=>{const c=r(a);if("start"===a.action){const r=e(a.screenStart,n(f.get())),o=j(t.state.camera,r,z);null!=o&&(l=m(c,o,s))}if(!l)return null;const u=e(a.screenEnd,n(f.get())),i=j(t.state.camera,u,z);return null==i?null:m(c,i,o)?{...a,renderStart:s,renderEnd:o,plane:c,ray:i}:null}}function C(e,n,r,s=null,o=null){return function(e,n,r=0,s=null,o=null){let l=null;return a=>{if("start"===a.action&&(l=e.sceneIntersectionHelper.intersectElevationFromScreen(t(a.screenStart.x,a.screenStart.y),n,r,o),null!=l&&null!=s&&!d(l,l,s)))return null;if(null==l)return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen(t(a.screenEnd.x,a.screenEnd.y),n,r,o);return null==c||null!=s&&!d(c,c,s)?null:{...a,mapStart:l,mapEnd:c}}}(e,r,R(n,e,r),s,o)}function D(e,n,t,r=null,s=null){return C(e,t,x(n),r,s)}function M(e,n,t,r){const s=n.toMap(e.screenStart,{include:[t]});return null!=s?D(n,t,s,r):null}function N(e,n,t){let d=null;const p=new U;return p.next(O(e,function(e,n){const t=k,r=q,s=E();e.renderCoordsHelper.worldUpAtPosition(n,t);const a=o(S(s),t,l(r,n,e.state.camera.eye));return o(a,a,t),g(n,a,s)}(e,n))).next(function(e,n){const t=i(),o=r(n);e.renderCoordsHelper.worldUpAtPosition(n,t);const d=i(),p=i(),f=s=>(l(s,s,n),y(t,s,s),"global"===e.viewingMode&&r(s)*Math.sign(a(t,s))<.001-o&&l(s,c(s,t,.001),n),u(s,s,n),s);return e=>(e.renderStart=f(s(d,e.renderStart)),e.renderEnd=f(s(p,e.renderEnd)),e)}(e,n)).next(G(e,t)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,d=e})),e=>(d=null,p.execute(e),d)}function G(e,n){const t=e.renderCoordsHelper;return e=>{const r=t.fromRenderCoords(e.renderStart,new b({spatialReference:n})),s=t.fromRenderCoords(e.renderEnd,new b({spatialReference:n}));return null!=r&&null!=s?{...e,mapStart:r,mapEnd:s}:null}}var P;function A(e){let n=null;return t=>{switch(t.action){case"start":n=e.disableDisplay();break;case"end":case"cancel":null!=n&&(n.remove(),n=null)}return t}}function F(n,r=null){const s=v(n.state.viewingMode);s.options.selectionMode=!0,s.options.store=I.MIN,s.options.hud=!1;const o=t(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},a=i(),c=r??n.spatialReference,u=t=>{n.map.ground&&n.map.ground.opacity<1?l.exclude.add(H):l.exclude.delete(H),n.sceneIntersectionHelper.intersectIntersectorScreen(e(t,o),s,l);const r=s.results.min;let u;if(r.getIntersectionPoint(a))u=r.intersector===w.TERRAIN?P.GROUND:P.OTHER;else{if(!s.results.ground.getIntersectionPoint(a))return null;u=P.GROUND}return{location:n.renderCoordsHelper.fromRenderCoords(a,new b({spatialReference:c})),surfaceType:u}};let d;return e=>{if("start"===e.action){const n=u(e.screenStart);d=null!=n?n.location:null}if(null==d)return null;const n=u(e.screenEnd);return null!=n?.location?{...e,mapStart:d,mapEnd:n.location,surfaceType:n.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(P||(P={}));const k=i(),q=i(),z=p();export{P as S,O as a,C as b,N as c,M as d,T as e,G as f,D as g,A as h,F as s};
