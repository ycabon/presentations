/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import e from"../Graphic.js";import i from"../core/Evented.js";import{m as o}from"./handleUtils.js";import{d as r}from"./maybe.js";import{m as n}from"./memoize.js";import{z as s,d as a,t as l,e as p,c,f as u,b as d,g as h}from"./quantityUtils.js";import{watch as m,syncAndInitial as y}from"../core/reactiveUtils.js";import{l as v,x as g}from"./unitUtils.js";import{property as f}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./Logger.js";import{subclass as w}from"../core/accessorSupport/decorators/subclass.js";import _ from"../layers/GraphicsLayer.js";import{p as O}from"./dehydratedFeatureComparison.js";import{a as I,p as b}from"./elevationInfoUtils.js";import{c as x,b as k,a as V,d as T,e as C,f as G,g as E}from"./createUtils.js";import{g as S}from"./helpMessageUtils.js";import{c as z}from"./surfaceCoordinateSystems.js";import{I as U}from"./InteractiveToolBase.js";import{t as P}from"./keybindings.js";import{S as j}from"../widgets/Sketch/SketchViewModel.js";import{g as M,c as A,e as D}from"./drawSurfaces.js";import{S as R,T as H}from"./Tooltip.js";import F,{a as L}from"../core/Accessor.js";import{g as N}from"./uuid.js";import{a as Z,D as Q,b as B}from"./angularMeasurementUtils.js";import{a as Y}from"./automaticAreaMeasurementUtils.js";import{b as q,a as J}from"./automaticLengthMeasurementUtils.js";import{u as K,g as W,d as X,v as $,w as tt,s as et,b as it,e as ot}from"./vec2.js";import{h as rt,H as nt,b as st}from"./vec3.js";import{f as at,Z as lt}from"./vec3f64.js";import{u as pt,c as ct}from"./boundedPlane.js";import{x as ut}from"./plane.js";import{U as dt,M as ht,R as mt,S as yt}from"./EditGeometryOperations.js";let vt=class extends F{constructor(t){super(t),this.actual=null,this.committed=null,this.id=N(),this.inputValue=null,this.readOnly=!1,this.unlockOnVertexPlacement=!0,this.visible=!0}get dirty(){return null!=this.inputValue}get locked(){return null!=this.committed}lock(t){this.inputValue=null,this.committed=t??this.actual}unlock(){this.committed=null,this.inputValue=null}};t([f()],vt.prototype,"actual",void 0),t([f()],vt.prototype,"committed",void 0),t([f()],vt.prototype,"createQuantity",void 0),t([f()],vt.prototype,"dirty",null),t([f()],vt.prototype,"format",void 0),t([f()],vt.prototype,"id",void 0),t([f()],vt.prototype,"inputValue",void 0),t([f()],vt.prototype,"locked",null),t([f()],vt.prototype,"name",void 0),t([f()],vt.prototype,"readOnly",void 0),t([f()],vt.prototype,"suffix",void 0),t([f()],vt.prototype,"title",void 0),t([f()],vt.prototype,"toInputUnits",void 0),t([f()],vt.prototype,"unlockOnVertexPlacement",void 0),t([f()],vt.prototype,"visible",void 0),vt=t([w("esri.views.interactive.tooltip.fields.TooltipField")],vt);let gt=class extends vt{constructor(t){super(t),this.mode="absolute-height"}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:s,createQuantity:(t,i)=>a(t,e(i)),toInputUnits:(t,i)=>l(t,e(i)),format:(t,e)=>e.formatters.verticalLength(t),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch.elevation,unlockOnVertexPlacement:!1,...t}}};t([f()],gt.prototype,"mode",void 0),gt=t([w("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],gt);const ft=t=>{const e=t=>t.inputUnitInfos.direction.unit;return new vt({name:"direction",actual:p,createQuantity:(t,i)=>c(t,e(i),"geographic"),toInputUnits:({value:t,unit:i,rotationType:o},r)=>{const n=Z(c(t,i,o),r.sketchOptions.values.effectiveDirectionMode),s=e(r),a=v(n.value,"degrees",s);return c(a,s,"geographic")},format:(t,{formatters:e,sketchOptions:i})=>{const o=i.values.effectiveDirectionMode,r=Z(t,o);switch(o){case Q.Absolute:return e.direction(r);case Q.Relative:return e.directionRelative(r);case Q.RelativeBilateral:return e.directionRelativeBilateral(r)}},suffix:t=>t.inputUnitInfos.direction.abbreviation,title:({messages:t,sketchOptions:e})=>{switch(e.values.effectiveDirectionMode){case Q.Absolute:return t.sketch.direction.absolute;case Q.Relative:case Q.RelativeBilateral:return t.sketch.direction.relative}},...t})},wt=t=>{const e=t=>t.inputUnitInfos.length.unit;return new vt({name:"distance",actual:s,createQuantity:(t,i)=>{const o=Math.max(t,0);return a(o,e(i))},toInputUnits:(t,i)=>l(t,e(i)),format:(t,e)=>e.formatters.length(t),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})},_t=t=>new gt(t);let Ot=class extends R{constructor(t){super(t),this.type="draw-point",this.elevation=_t()}get allFields(){return[this.elevation]}};t([f()],Ot.prototype,"type",void 0),t([f()],Ot.prototype,"elevation",void 0),t([f()],Ot.prototype,"allFields",null),t([f()],Ot.prototype,"helpMessage",void 0),Ot=t([w("esri.views.interactive.tooltip.DrawPointTooltipInfo")],Ot);let It=class extends R{constructor(t){super(t),this.type="draw-polyline",this.direction=ft(),this.distance=wt({title:t=>t.messages.sketch.distance}),this.elevation=_t(),this.totalLength=wt({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.direction,this.distance,this.elevation,this.totalLength]}};t([f()],It.prototype,"type",void 0),t([f()],It.prototype,"direction",void 0),t([f()],It.prototype,"distance",void 0),t([f()],It.prototype,"elevation",void 0),t([f()],It.prototype,"totalLength",void 0),t([f()],It.prototype,"allFields",null),t([f()],It.prototype,"helpMessage",void 0),It=t([w("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],It);let bt=class extends R{constructor(t){super(t),this.type="draw-polygon",this.direction=ft(),this.distance=wt({title:t=>t.messages.sketch.distance}),this.elevation=_t(),this.area=(t=>{const e=t=>t.inputUnitInfos.area.unit;return new vt({name:"area",actual:u,createQuantity:(t,i)=>d(t,e(i)),toInputUnits:(t,i)=>l(t,e(i)),format:(t,e)=>e.formatters.area(t),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0})})()}get allFields(){return[this.direction,this.distance,this.elevation,this.area]}};t([f()],bt.prototype,"type",void 0),t([f()],bt.prototype,"distance",void 0),t([f()],bt.prototype,"elevation",void 0),t([f()],bt.prototype,"area",void 0),t([f()],bt.prototype,"allFields",null),t([f()],bt.prototype,"helpMessage",void 0),bt=t([w("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],bt);let xt=class extends R{constructor(t){super(t),this.type="draw-mesh",this.elevation=_t()}get allFields(){return[this.elevation]}};t([f()],xt.prototype,"type",void 0),t([f()],xt.prototype,"elevation",void 0),t([f()],xt.prototype,"allFields",null),t([f()],xt.prototype,"helpMessage",void 0),xt=t([w("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],xt);let kt=class extends R{constructor(t){super(t),this.type="draw-rectangle",this.xSize=s,this.ySize=s,this.area=u}get allFields(){return[]}};t([f()],kt.prototype,"type",void 0),t([f()],kt.prototype,"xSize",void 0),t([f()],kt.prototype,"ySize",void 0),t([f()],kt.prototype,"area",void 0),t([f()],kt.prototype,"allFields",null),kt=t([w("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],kt);let Vt=class extends R{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=u}get allFields(){return[]}};t([f()],Vt.prototype,"type",void 0),t([f()],Vt.prototype,"radius",void 0),t([f()],Vt.prototype,"xSize",void 0),t([f()],Vt.prototype,"ySize",void 0),t([f()],Vt.prototype,"area",void 0),t([f()],Vt.prototype,"allFields",null),Vt=t([w("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],Vt);class Tt{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}let Ct=class extends(i.EventedMixin(U)){constructor(t){super(t),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new j,this._getPointConstraint=n(A),this._getPolylineOrPolygonConstraint=n(D)}initialize(){this.internalGraphicsLayer=new _({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation(),{sketchOptions:e}=this,i=this.view.type;this.tooltipInfos={point:new Ot({sketchOptions:e,viewType:i}),polyline:new It({sketchOptions:e,viewType:i}),polygon:new bt({sketchOptions:e,viewType:i}),mesh:new xt({sketchOptions:e,viewType:i}),rectangle:new kt({sketchOptions:e}),circle:new Vt({sketchOptions:e})},this.tooltip=new H({view:this.view}),this._initializeConstraints(),this.addHandles([t.on("vertex-add",(t=>this.onVertexAdd(t))),t.on("vertex-remove",(t=>this.onVertexRemove(t))),t.on("vertex-update",(t=>this.onVertexUpdate(t))),t.on("cursor-update",(t=>this.onCursorUpdate(t))),t.on("cursor-remove",(()=>this._updateGraphic())),t.on("complete",(t=>this.onComplete(t))),m((()=>this.cursor),(e=>t.cursor=e),y),L((()=>this._updateTooltipInfo())),L((()=>{t.constraintZ=this._constraintZ}))]),this.finishToolCreation()}destroy(){this.drawOperation=r(this.drawOperation),this.tooltip=r(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=r(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return a(this.defaultZ,"meters")}get _inputModeAvailable(){const{inputEnabled:t,visibleElements:e}=this.sketchOptions.tooltips;return t&&!0===this.activeTooltipInfo?.editableFields.some((t=>!0===e[t.name]))}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){if(!this.destroyed)return"key-down"===t.type&&t.key===P.enterInputMode&&this._inputModeAvailable?(this.tooltip.enterInputMode(),void t.stopPropagation()):void this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&this._initializeConstraints()}_destroyAllVisualizations(){this.removeHandles(Et.outline),this.removeHandles(Et.regularVertices),this.removeHandles(Et.activeVertex),this.removeHandles(Et.activeEdge),this.removeHandles(Gt)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(t),this._graphic;const i=new e({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=i,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(i),this.addHandles(this.initializeGraphic(i)),this.notifyChange("graphic"),this.addHandles(o((()=>{this.internalGraphicsLayer.remove(i),this._graphic===i&&(this._graphic=null)})),Gt),i}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:r,committedVertices:n,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=o))return;const l=t.operationComplete?n:s,p=l.length,c=null!=o?e.pointToArray(o):null,u=i.spatialReference,d="3d"===i.type&&"global"===i.viewingMode,h=new Tt;h.committedVertices=n,h.cursorVertex=c;const{geometryType:m}=this;switch(m){case"point":case"mesh":h.full=e.arrayToPoint(l[0]);break;case"multipoint":h.full=p>0?E(l,u):null;break;case"polyline":case"polygon":p>0&&(h.full="polygon"===m?C([l],u,d,!0):G([l],u,d),h.cursorEdge=null!=c&&r&&!O(o,r)?G([[c,e.pointToArray(r)]],u,d):null,h.outline=p>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!p)break;const e=z(i,l[0]),o=l[0],r=e.makeMapPoint(o[0]+zt*i.resolution,o[1]);"circle"===m?1===p&&t.operationComplete?h.circle=x([o,r],e,!0):2===p&&(this.forceUniformSize?h.circle=x(l,e,this.centered):h.rectangle=k(l,e,this.centered)):1===p&&t.operationComplete?h.rectangle=V([o,r],e,!0):2===p&&(h.rectangle=this.forceUniformSize?V(l,e,this.centered):T(l,e,this.centered)),h.full=null!=h.circle?h.circle.geometry:h.rectangle?.geometry,h.outline="polygon"===h.full?.type?h.full:null;break}default:return null}return h}initializeGraphic(t){return o()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return o()}onCursorEdgeChanged(t){return o()}onVertexAdd(t){this._updateGraphic(),this._unlockConstraintsOnVertexAddOrRemove(),this._lockElevationOnVertexAdd(t.vertices.at(0)?.coordinates),this.emit("vertex-add",t)}onVertexRemove(t){this._updateGraphic(),this._unlockConstraintsOnVertexAddOrRemove(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.cursorEdge?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),Et.activeEdge):this.removeHandles(Et.activeEdge),null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),Et.outline):this.removeHandles(Et.outline),null!=t.committedVertices?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),Et.regularVertices):this.removeHandles(Et.regularVertices),null!=t.cursorVertex?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),Et.activeVertex):this.removeHandles(Et.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(Gt)):this._destroyAllVisualizations()}get activeTooltipInfo(){const{drawOperation:t,graphic:e,view:i}=this;if(!t)return null;const o=this.tooltipInfos,r=e?.geometry?.type;switch(this.geometryType){case"point":return"2d"===i.type&&0===this.defaultZ?null:"point"===r?o.point:null;case"polyline":return"polyline"===r?o.polyline:null;case"polygon":return"polygon"===r?o.polygon:null;case"rectangle":return"polygon"===r?o.rectangle:null;case"circle":return"polygon"===r?o.circle:null;case"mesh":return"mesh"===r?o.mesh:null;default:return null}}_updateTooltipInfo(){const{activeTooltipInfo:t,tooltip:e,sketchOptions:i}=this;switch(t?.type){case"draw-point":this._updateDrawPointTooltipInfo(t);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(t);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(t);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(t);break;case"draw-circle":this._updateDrawCircleTooltipInfo(t);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(t)}e.view=this.view,e.info=i.tooltips.effectiveEnabled?t:null}_updateDrawPointTooltipInfo(t){const{drawOperation:e,graphic:i,view:o,sketchOptions:r}=this,{coordinateHelper:n,cursorVertex:s}=e;if(t.sketchOptions=r,t.viewType=o.type,t.helpMessage=S("point",i?.geometry),this.updateElevation(t.elevation),!s)return void(e.constraintInfo=void 0);const a=M(s,o,n.spatialReference,this._constraintElevationInfo,n.hasZ(),r.values.effectiveDirectionMode);e.constraintInfo={context:a,constraint:this._getPointConstraint(t.elevation.committed,a)}}_updateDrawPolylineTooltipInfo(t){const e=this._createOperationGeometry,i=null!=e?e.full:null;if("polyline"!==i?.type)return;this._updatePolylineOrPolygonCommon(t);const o=q(i);t.totalLength.actual=o??s,t.sketchOptions=this.sketchOptions,t.viewType=this.view.type,t.helpMessage=S("polyline",i)}_updateDrawPolygonTooltipInfo(t){const e=this._createOperationGeometry,i=null!=e?e.full:null;if("polygon"!==i?.type)return;this._updatePolylineOrPolygonCommon(t);const o=Y(i);t.area.actual=o??u,t.sketchOptions=this.sketchOptions,t.viewType=this.view.type,t.helpMessage=S("polygon",i)}_updatePolylineOrPolygonCommon(t){const{view:e,drawOperation:i,sketchOptions:o}=this,{coordinateHelper:r,cursorVertex:n,lastVertex:a,secondToLastVertex:l}=i,p=o.values.effectiveDirectionMode,c=a&&n?J(a,n):null;if(t.distance.actual=c??s,t.distance.readOnly=null==a,t.direction.actual=null,t.direction.readOnly=!0,a&&n&&("absolute"===p||l)){const e=B(l,a,n,p);t.direction.actual=e??h,t.direction.readOnly=!1}this.updateElevation(t.elevation);const u=n??a;if(u){const o=M(u,e,r.spatialReference,this._constraintElevationInfo,r.hasZ(),p);i.constraintInfo={context:o,constraint:this._getPolylineOrPolygonConstraint(a,l,t.distance.committed,t.direction.committed,t.elevation.committed,o)}}else i.constraintInfo=void 0}updateDrawMeshTooltipInfo(t){}_updateDrawRectangleTooltipInfo(t){t.sketchOptions=this.sketchOptions,t.xSize=this._xSize??s,t.ySize=this._ySize??s,t.area=this._fullGeometryArea??u}_updateDrawCircleTooltipInfo(t){const{forceUniformSize:e}=this;t.sketchOptions=this.sketchOptions,t.radius=e?this._circleRadius??s:null,t.xSize=e?null:this._xSize??s,t.ySize=e?null:this._ySize??s,t.area=this._fullGeometryArea??u}get _circleRadius(){const t=this._createOperationGeometry;return null!=t?.circle?.center&&null!=t.circle.edge?J(t.circle.center,t.circle.edge):null}get _xSize(){const t=this._createOperationGeometry?.rectangle?.midpoints;return null!=t?J(t.left,t.right):null}get _ySize(){const t=this._createOperationGeometry?.rectangle?.midpoints;return null!=t?J(t.top,t.bottom):null}get _fullGeometryArea(){const t=this._createOperationGeometry?.full;return"polygon"!==t?.type?null:Y(t)}updateElevation(t){t.actual=this._tooltipActualElevation,t.visible="3d"===this.view.type&&this.hasZ,t.readOnly=!1}get _tooltipActualElevation(){const{drawOperation:t}=this,e=t?.cursorVertex??t?.lastVertex;if(null==e)return this._defaultElevation;const{x:i,y:o,z:r}=e;return this._getConvertedVertexElevation(i,o,r,this._constraintElevationInfo)??this._defaultElevation}get _constraintElevationInfo(){return this.drawOperation?.elevationInfo??I}get _constraintZ(){const{geometryType:t}=this;switch(t){case"point":case"mesh":case"polyline":case"polygon":return this.tooltipInfos[t].elevation.committed?.value;default:return}}_initializeConstraints(){const{directionOptions:t,drawOperation:e,geometryType:i,tooltipInfos:o,sketchOptions:r}=this,n=t=>{const i=e.elevationInfo?.mode,r=o[t].elevation;"relative-to-ground"===i||"relative-to-scene"===i?r.lock(s):r.unlock()};switch(i){case"polygon":case"polyline":n(i),(e=>{if(t){const i=o[e].direction;i.committed=t.angle,i.unlockOnVertexPlacement=!1,r.values.directionMode=t.mode}})(i);break;case"point":case"mesh":n(i)}}_lockElevationOnVertexAdd(t){const{activeTooltipInfo:e,drawOperation:i,view:o}=this,r=this._constraintElevationInfo;if("2d"===o.type||!t||"absolute-height"!==r.mode||1!==i?.numCommittedVertices||!e||"draw-polyline"!==e.type&&"draw-polygon"!==e.type||e.elevation.locked)return;const[n,s,a]=t,l=this._getConvertedVertexElevation(n,s,a,r);null!=l&&e.elevation.lock(l)}_unlockConstraintsOnVertexAddOrRemove(){this.activeTooltipInfo?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}_getConvertedVertexElevation(t,e,i,o){const{view:r,drawOperation:n}=this;if("3d"!==r.type||!n)return;const{spatialReference:s}=n.coordinateHelper;i??=0;const l=n.elevationInfo,p=(b(r,t,e,i,s,l,o)??0)*g(s);return a(p,"meters")}};t([f()],Ct.prototype,"_createOperationGeometry",void 0),t([f()],Ct.prototype,"_defaultElevation",null),t([f()],Ct.prototype,"_inputModeAvailable",null),t([f({value:!0})],Ct.prototype,"centered",null),t([f()],Ct.prototype,"cursor",null),t([f({nonNullable:!0})],Ct.prototype,"defaultZ",void 0),t([f({constructOnly:!0})],Ct.prototype,"directionOptions",void 0),t([f()],Ct.prototype,"drawOperation",void 0),t([f({value:!0})],Ct.prototype,"enabled",null),t([f({value:!0})],Ct.prototype,"forceUniformSize",null),t([f({constructOnly:!0})],Ct.prototype,"geometryType",void 0),t([f()],Ct.prototype,"graphic",null),t([f({constructOnly:!0})],Ct.prototype,"graphicProperties",void 0),t([f()],Ct.prototype,"graphicSymbol",null),t([f({constructOnly:!0})],Ct.prototype,"hasZ",void 0),t([f({constructOnly:!0})],Ct.prototype,"geometryToPlace",void 0),t([f({constructOnly:!0})],Ct.prototype,"mode",void 0),t([f()],Ct.prototype,"snappingManager",void 0),t([f()],Ct.prototype,"snapToScene",void 0),t([f()],Ct.prototype,"tooltip",void 0),t([f()],Ct.prototype,"tooltipInfos",void 0),t([f({constructOnly:!0,type:j})],Ct.prototype,"sketchOptions",void 0),t([f({readOnly:!0})],Ct.prototype,"updating",null),t([f({constructOnly:!0,nonNullable:!0})],Ct.prototype,"view",void 0),t([f()],Ct.prototype,"activeTooltipInfo",null),t([f()],Ct.prototype,"_circleRadius",null),t([f()],Ct.prototype,"_xSize",null),t([f()],Ct.prototype,"_ySize",null),t([f()],Ct.prototype,"_fullGeometryArea",null),t([f()],Ct.prototype,"_tooltipActualElevation",null),t([f()],Ct.prototype,"_constraintElevationInfo",null),t([f()],Ct.prototype,"_constraintZ",null),Ct=t([w("esri.views.draw.DrawGraphicTool")],Ct);const Gt=Symbol("create-operation-graphic"),Et={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function St(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const zt=48;function Ut(t,e){return jt(t,e,!1)}function Pt(t,e){return jt(t,e,!0)}function jt(t,e,i){if(t instanceof dt){if(t.operation instanceof ht)return function(t,e,i=!1){const o=i?-1:1,r=at(o*t.dx,o*t.dy,o*t.dz);rt(e.origin,e.origin,r),pt(e)}(t.operation,e,i),!0;if(t.operation instanceof mt)return function(t,e,i=!1){const o=i?-t.angle:t.angle;nt(e.basis1,e.basis1,lt,o),nt(e.basis2,e.basis2,lt,o),pt(e)}(t.operation,e,i),!0;if(t.operation instanceof yt)return function(t,e,i=!1){const o=i?1/t.factor1:t.factor1,r=i?1/t.factor2:t.factor2;st(e.basis1,e.basis1,o),st(e.basis2,e.basis2,r),K(e.origin,e.origin,t.origin,t.axis1,o),K(e.origin,e.origin,t.origin,t.axis2,r),pt(e)}(t.operation,e,i),!0}return!1}function Mt(t,e,i,o){o||(o=ct());const r=W(ut.get(),t[1],-t[0]),n=W(ut.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=W(ut.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=ut.get();e.components.forEach((e=>e.vertices.forEach((({pos:e})=>{W(a,X(t,e),X(r,e)),$(n,n,a),tt(s,s,a)}))));const l=1e-6,p=W(ut.get(),s[0]-n[0]<l?i/2:0,s[1]-n[1]<l?i/2:0);return et(n,n,p),it(s,s,p),ot(o.basis1,t,(s[0]-n[0])/2),ot(o.basis2,r,(s[1]-n[1])/2),W(o.origin,n[0]*t[0]+n[1]*r[0],n[0]*t[1]+n[1]*r[1]),it(o.origin,o.origin,o.basis1),it(o.origin,o.origin,o.basis2),pt(o),o}export{Ct as D,Ut as a,Pt as b,Mt as c,St as g,_t as m};
