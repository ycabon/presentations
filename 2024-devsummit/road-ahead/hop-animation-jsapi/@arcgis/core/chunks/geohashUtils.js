/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import"../core/lang.js";import{r as t}from"./mathUtils.js";import o from"../geometry/Extent.js";import r from"../geometry/Polygon.js";import n from"../geometry/SpatialReference.js";import{h as e}from"./unitUtils.js";import{c as s}from"./featureConversionUtils.js";import{O as i}from"./OptimizedGeometry.js";import{p as a}from"./projectionSupport.js";const f=new Float64Array(2),c=new Float64Array(2),m="0123456789bcdefghjkmnpqrstuvwxyz";function l(t,e,f,c){const m=[t.xmin,t.ymin,t.xmax,t.ymax],l=r.fromExtent(o.fromBounds(m,c)),h=a(l,c,n.WGS84,{densificationStep:64*e}),p=s(new i,h,!1,!1),x=p.coords.filter(((t,o)=>!(o%2))),y=p.coords.filter(((t,o)=>o%2)),d=Math.min(...x),j=Math.min(...y),M=Math.max(...x),g=Math.max(...y),S=u(d,j,f,n.WGS84),w=u(M,g,f,n.WGS84);if(!S||!w)throw new Error("InternalError: Unable to project tile bounds");return{bounds:m,geohashBounds:{xLL:S[0],yLL:S[1],xTR:w[0],yTR:w[1]},level:f}}function u(o,r,s,i){if(i.isWebMercator){const n=t(o/e.radius),i=n-360*Math.floor((n+180)/360),a=[0,0];return j(a,0,t(Math.PI/2-2*Math.atan(Math.exp(-r/e.radius))),i,s),a}const f=a({x:o,y:r},i,n.WGS84);if(!f)return null;const c=[0,0];return j(c,0,f.y,f.x,s),c}function h(t){return m[t]}function p(t){return(t[0]+t[1])/2}function x(t,o,r){return t[0]=o,t[1]=r,t}function y(t,o){const r=o>p(t);return function(t,o){const r=p(t),n=o,e=!o;t[0]=e*t[0]+n*r,t[1]=e*r+n*t[1]}(t,r),r}function d(t,o){let r=-90,n=90,e=-180,s=180;for(let i=0;i<o;i++){const o=Math.ceil((i+1)/2),a=Math.floor((i+1)/2),f=1-i%2,c=30-(3*o+2*a),m=30-(2*o+3*a),l=3*f+2*(1-f),u=2*f+3*(1-f),h=3*f+7*(1-f)<<m,p=(7*f+3*(1-f)<<c&t.geohashX)>>c,x=(h&t.geohashY)>>m;for(let t=l-1;t>=0;t--){const o=(e+s)/2,r=p&1<<t?1:0;e=(1-r)*e+r*o,s=(1-r)*o+r*s}for(let t=u-1;t>=0;t--){const o=(r+n)/2,e=x&1<<t?1:0;r=(1-e)*r+e*o,n=(1-e)*o+e*n}}return[e,r,s,n]}function j(t,o,r,n,e){e%2&&(e+=1);let s=0,i=0,a=-90,f=90,c=-180,m=180;for(let t=0;t<e/2;t++){for(let o=0;o<5;o++){const r=(c+m)/2,e=n>r?1:0;s|=e<<29-(o+5*t),c=(1-e)*c+e*r,m=(1-e)*r+e*m}for(let o=0;o<5;o++){const n=(a+f)/2,e=r>n?1:0;i|=e<<29-(o+5*t),a=(1-e)*a+e*n,f=(1-e)*n+e*f}}t[2*o]=s,t[2*o+1]=i}function M(t,o,r){let n="";const e=x(f,-90,90),s=x(c,-180,180);for(let i=0;i<r;i++){let r=0;i%2?(r|=y(e,t)<<4,r|=y(s,o)<<3,r|=y(e,t)<<2,r|=y(s,o)<<1,r|=y(e,t)<<0):(r|=y(s,o)<<4,r|=y(e,t)<<3,r|=y(s,o)<<2,r|=y(e,t)<<1,r|=y(s,o)<<0),n+=h(r)}return n}export{u as a,d,M as e,l as g};
