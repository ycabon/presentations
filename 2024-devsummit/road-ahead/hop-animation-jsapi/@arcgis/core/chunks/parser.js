/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{a as t,i as e,b as r,h as n}from"./colorUtils.js";import u from"../core/Error.js";import{c as a,n as o,C as c,O as i,H as s,B as l,D as f,a as p}from"./utils3.js";import{c as h}from"./_commonjsHelpers.js";var m,g={exports:{}};(m=g).exports&&(m.exports=function(){function t(e,r,n,u){var a=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(a,t.prototype),a.expected=r,a.found=n,a.location=u,a.name="SyntaxError",a}function e(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var n,u=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){u=t[n].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(a):a,c=this.location.source+":"+o.line+":"+o.column;if(u){var i=this.location.end,s=e("",o.line.toString().length," "),l=u[a.line-1],f=(a.line===i.line?i.column:l.length+1)-a.column||1;r+="\n --\x3e "+c+"\n"+s+" |\n"+o.line+" | "+l+"\n"+s+" | "+e("",a.column-1," ")+e("",f,"^")}else r+="\n at "+c}return r},t.buildMessage=function(t,e){var r={literal:function(t){return'"'+u(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function u(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function o(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(o);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+u(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,r){var n,u,a,o,c={},i=(r=void 0!==r?r:{}).grammarSource,s={start:Qt},l=Qt,f="none",p=")",h=",",m="(",g="%",v="px",d="cm",y="mm",A="in",w="pt",x="pc",b="deg",C="rad",F="grad",E="turn",j="#",$=".",O="e",q=/^[ \t\n\r]/,S=/^[a-z\-]/,k=/^[0-9a-fA-F]/,z=/^[+\-]/,R=/^[0-9]/,I=Gt("none"),M=Dt("none",!1),P=Dt(")",!1),H=Dt(",",!1),N=Gt("whitespace"),T=_t([" ","\t","\n","\r"],!1,!1),U=Gt("function"),B=Dt("(",!1),D=Gt("identifier"),_=_t([["a","z"],"-"],!1,!1),G=Gt("percentage"),J=Dt("%",!1),K=Gt("length"),L=Dt("px",!1),Q=Dt("cm",!1),V=Dt("mm",!1),W=Dt("in",!1),X=Dt("pt",!1),Y=Dt("pc",!1),Z=Gt("angle"),tt=Dt("deg",!1),et=Dt("rad",!1),rt=Dt("grad",!1),nt=Dt("turn",!1),ut=Gt("number"),at=Gt("color"),ot=Dt("#",!1),ct=_t([["0","9"],["a","f"],["A","F"]],!1,!1),it=_t(["+","-"],!1,!1),st=_t([["0","9"]],!1,!1),lt=Dt(".",!1),ft=Dt("e",!1),pt=function(){return[]},ht=function(t,e){return{type:"function",name:t,parameters:e||[]}},mt=function(t,e){return e.length>0?function(t,e,r){return[t].concat(e.map((function(t){return t[3]})))}(t,e):[t]},gt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},vt=function(t){return{type:"color",colorType:t.type,value:t.value}},dt=function(t){return t},yt=function(){return Bt()},At=function(t){return{value:t,unit:"%"}},wt=function(t){return{value:t,unit:"px"}},xt=function(t){return{value:t,unit:"cm"}},bt=function(t){return{value:t,unit:"mm"}},Ct=function(t){return{value:t,unit:"in"}},Ft=function(t){return{value:t,unit:"pt"}},Et=function(t){return{value:t,unit:"pc"}},jt=function(t){return{value:t,unit:"deg"}},$t=function(t){return{value:t,unit:"rad"}},Ot=function(t){return{value:t,unit:"grad"}},qt=function(t){return{value:t,unit:"turn"}},St=function(t){return{value:t,unit:null}},kt=function(){return{type:"hex",value:Bt()}},zt=function(t){return{type:"function",value:t}},Rt=function(){return{type:"named",value:Bt()}},It=function(){return parseFloat(Bt())},Mt=0,Pt=0,Ht=[{line:1,column:1}],Nt=0,Tt=[],Ut=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');l=s[r.startRule]}function Bt(){return e.substring(Pt,Mt)}function Dt(t,e){return{type:"literal",text:t,ignoreCase:e}}function _t(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Gt(t){return{type:"other",description:t}}function Jt(t){var r,n=Ht[t];if(n)return n;for(r=t-1;!Ht[r];)r--;for(n={line:(n=Ht[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ht[t]=n,n}function Kt(t,e,r){var n=Jt(t),u=Jt(e),a={source:i,start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:u.line,column:u.column}};return r&&i&&"function"==typeof i.offset&&(a.start=i.offset(a.start),a.end=i.offset(a.end)),a}function Lt(t){Mt<Nt||(Mt>Nt&&(Nt=Mt,Tt=[]),Tt.push(t))}function Qt(){var t;return(t=function(){var t,r;return Ut++,t=Mt,Xt(),e.substr(Mt,4)===f?(r=f,Mt+=4):(r=c,0===Ut&&Lt(M)),r!==c?(Xt(),Pt=t,t=pt()):(Mt=t,t=c),Ut--,t===c&&0===Ut&&Lt(I),t}())===c&&(t=function(){var t,e;if(t=[],(e=Vt())!==c)for(;e!==c;)t.push(e),e=Vt();else t=c;return t}()),t}function Vt(){var t,r,n,u;return t=Mt,Xt(),(r=function(){var t,r,n;return Ut++,t=Mt,(r=Yt())!==c?(40===e.charCodeAt(Mt)?(n=m,Mt++):(n=c,0===Ut&&Lt(B)),n!==c?(Pt=t,t=dt(r)):(Mt=t,t=c)):(Mt=t,t=c),Ut--,t===c&&(r=c,0===Ut&&Lt(U)),t}())!==c?(Xt(),(n=function(){var t,r,n,u,a,o,i,s;if(t=Mt,(r=Wt())!==c){for(n=[],u=Mt,a=Xt(),44===e.charCodeAt(Mt)?(o=h,Mt++):(o=c,0===Ut&&Lt(H)),o===c&&(o=null),i=Xt(),(s=Wt())!==c?u=a=[a,o,i,s]:(Mt=u,u=c);u!==c;)n.push(u),u=Mt,a=Xt(),44===e.charCodeAt(Mt)?(o=h,Mt++):(o=c,0===Ut&&Lt(H)),o===c&&(o=null),i=Xt(),(s=Wt())!==c?u=a=[a,o,i,s]:(Mt=u,u=c);Pt=t,t=mt(r,n)}else Mt=t,t=c;return t}())===c&&(n=null),Xt(),41===e.charCodeAt(Mt)?(u=p,Mt++):(u=c,0===Ut&&Lt(P)),u!==c?(Xt(),Pt=t,t=ht(r,n)):(Mt=t,t=c)):(Mt=t,t=c),t}function Wt(){var t,r;return t=Mt,(r=function(){var t,r,n;return Ut++,t=Mt,Xt(),(r=Zt())!==c?(37===e.charCodeAt(Mt)?(n=g,Mt++):(n=c,0===Ut&&Lt(J)),n!==c?(Pt=t,t=At(r)):(Mt=t,t=c)):(Mt=t,t=c),Ut--,t===c&&0===Ut&&Lt(G),t}())===c&&(r=function(){var t,r,n;return Ut++,t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===v?(n=v,Mt+=2):(n=c,0===Ut&&Lt(L)),n!==c?(Pt=t,t=wt(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===d?(n=d,Mt+=2):(n=c,0===Ut&&Lt(Q)),n!==c?(Pt=t,t=xt(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===y?(n=y,Mt+=2):(n=c,0===Ut&&Lt(V)),n!==c?(Pt=t,t=bt(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===A?(n=A,Mt+=2):(n=c,0===Ut&&Lt(W)),n!==c?(Pt=t,t=Ct(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===w?(n=w,Mt+=2):(n=c,0===Ut&&Lt(X)),n!==c?(Pt=t,t=Ft(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,Xt(),(r=Zt())!==c?(e.substr(Mt,2)===x?(n=x,Mt+=2):(n=c,0===Ut&&Lt(Y)),n!==c?(Pt=t,t=Et(r)):(Mt=t,t=c)):(Mt=t,t=c)))))),Ut--,t===c&&0===Ut&&Lt(K),t}())===c&&(r=function(){var t,r,n;return Ut++,t=Mt,(r=Zt())!==c?(e.substr(Mt,3)===b?(n=b,Mt+=3):(n=c,0===Ut&&Lt(tt)),n!==c?(Pt=t,t=jt(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,(r=Zt())!==c?(e.substr(Mt,3)===C?(n=C,Mt+=3):(n=c,0===Ut&&Lt(et)),n!==c?(Pt=t,t=$t(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,(r=Zt())!==c?(e.substr(Mt,4)===F?(n=F,Mt+=4):(n=c,0===Ut&&Lt(rt)),n!==c?(Pt=t,t=Ot(r)):(Mt=t,t=c)):(Mt=t,t=c),t===c&&(t=Mt,(r=Zt())!==c?(e.substr(Mt,4)===E?(n=E,Mt+=4):(n=c,0===Ut&&Lt(nt)),n!==c?(Pt=t,t=qt(r)):(Mt=t,t=c)):(Mt=t,t=c)))),Ut--,t===c&&(r=c,0===Ut&&Lt(Z)),t}())===c&&(r=function(){var t,e;return Ut++,t=Mt,Xt(),(e=Zt())!==c?(Pt=t,t=St(e)):(Mt=t,t=c),Ut--,t===c&&0===Ut&&Lt(ut),t}()),r!==c&&(Pt=t,r=gt(r)),(t=r)===c&&(t=Mt,(r=function(){var t,r,n,u;if(Ut++,t=Mt,35===e.charCodeAt(Mt)?(r=j,Mt++):(r=c,0===Ut&&Lt(ot)),r!==c){if(n=[],k.test(e.charAt(Mt))?(u=e.charAt(Mt),Mt++):(u=c,0===Ut&&Lt(ct)),u!==c)for(;u!==c;)n.push(u),k.test(e.charAt(Mt))?(u=e.charAt(Mt),Mt++):(u=c,0===Ut&&Lt(ct));else n=c;n!==c?(Pt=t,t=kt()):(Mt=t,t=c)}else Mt=t,t=c;return t===c&&(t=Mt,(r=Vt())!==c&&(Pt=t,r=zt(r)),(t=r)===c&&(t=Mt,(r=Yt())!==c&&(Pt=t,r=Rt()),t=r)),Ut--,t===c&&(r=c,0===Ut&&Lt(at)),t}())!==c&&(Pt=t,r=vt(r)),t=r),t}function Xt(){var t,r;for(Ut++,t=[],q.test(e.charAt(Mt))?(r=e.charAt(Mt),Mt++):(r=c,0===Ut&&Lt(T));r!==c;)t.push(r),q.test(e.charAt(Mt))?(r=e.charAt(Mt),Mt++):(r=c,0===Ut&&Lt(T));return Ut--,r=c,0===Ut&&Lt(N),t}function Yt(){var t,r,n;if(Ut++,t=Mt,r=[],S.test(e.charAt(Mt))?(n=e.charAt(Mt),Mt++):(n=c,0===Ut&&Lt(_)),n!==c)for(;n!==c;)r.push(n),S.test(e.charAt(Mt))?(n=e.charAt(Mt),Mt++):(n=c,0===Ut&&Lt(_));else r=c;return r!==c&&(Pt=t,r=yt()),Ut--,(t=r)===c&&(r=c,0===Ut&&Lt(D)),t}function Zt(){var t,r,n,u,a,o,i;for(t=Mt,z.test(e.charAt(Mt))?(e.charAt(Mt),Mt++):0===Ut&&Lt(it),r=Mt,n=[],R.test(e.charAt(Mt))?(u=e.charAt(Mt),Mt++):(u=c,0===Ut&&Lt(st));u!==c;)n.push(u),R.test(e.charAt(Mt))?(u=e.charAt(Mt),Mt++):(u=c,0===Ut&&Lt(st));if(46===e.charCodeAt(Mt)?(u=$,Mt++):(u=c,0===Ut&&Lt(lt)),u!==c){if(a=[],R.test(e.charAt(Mt))?(o=e.charAt(Mt),Mt++):(o=c,0===Ut&&Lt(st)),o!==c)for(;o!==c;)a.push(o),R.test(e.charAt(Mt))?(o=e.charAt(Mt),Mt++):(o=c,0===Ut&&Lt(st));else a=c;a!==c?r=n=[n,u,a]:(Mt=r,r=c)}else Mt=r,r=c;if(r===c)if(r=[],R.test(e.charAt(Mt))?(n=e.charAt(Mt),Mt++):(n=c,0===Ut&&Lt(st)),n!==c)for(;n!==c;)r.push(n),R.test(e.charAt(Mt))?(n=e.charAt(Mt),Mt++):(n=c,0===Ut&&Lt(st));else r=c;if(r!==c){if(n=Mt,101===e.charCodeAt(Mt)?(u=O,Mt++):(u=c,0===Ut&&Lt(ft)),u!==c){if(z.test(e.charAt(Mt))?(a=e.charAt(Mt),Mt++):(a=c,0===Ut&&Lt(it)),a===c&&(a=null),o=[],R.test(e.charAt(Mt))?(i=e.charAt(Mt),Mt++):(i=c,0===Ut&&Lt(st)),i!==c)for(;i!==c;)o.push(i),R.test(e.charAt(Mt))?(i=e.charAt(Mt),Mt++):(i=c,0===Ut&&Lt(st));else o=c;o!==c?n=u=[u,a,o]:(Mt=n,n=c)}else Mt=n,n=c;n===c&&(n=null),Pt=t,t=It()}else Mt=t,t=c;return t}if((n=l())!==c&&Mt===e.length)return n;throw n!==c&&Mt<e.length&&Lt({type:"end"}),u=Tt,a=Nt<e.length?e.charAt(Nt):null,o=Nt<e.length?Kt(Nt,Nt+1):Kt(Nt,Nt),new t(t.buildMessage(u,a),u,a,o)}}}());var v=g.exports;function d(t){if(!t||0===t.length)return null;if("string"==typeof t){const e=y(t);return e&&0!==e.length?e:null}const e=t.map((t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new u("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:y(t.value)}}));e.sort(((t,e)=>e.effects.length-t.effects.length));for(let t=0;t<e.length-1;t++){if(!a(e[t].effects,e[t+1].effects))throw new u("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[t].effects,b:e[t+1].effects});o(e[t].effects,e[t+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}function y(t){let e;if(!t)return[];try{e=v.parse(t)}catch(e){throw new u("effect:invalid-syntax","Invalid effect syntax",{value:t,error:e})}return e.map((t=>function(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;return A(t.parameters,1),1===t.parameters.length&&(e=F(t.parameters[0])),new c(t.name,e)}(t);case"opacity":return function(t){let e=1;return A(t.parameters,1),1===t.parameters.length&&(e=F(t.parameters[0])),new i(e)}(t);case"hue-rotate":return function(t){let e=0;var r;return A(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=b[t.unit]))throw new u("effect:type-error",`Expected <angle>, Actual: ${w(t)}`,{term:t})}(r=t.parameters[0]),e=r.value*b[r.unit]||0),new s(e)}(t);case"blur":return function(t){let e=0;return A(t.parameters,1),1===t.parameters.length&&(e=E(t.parameters[0]),x(e,t.parameters[0])),new l(e)}(t);case"drop-shadow":return function(t){const e=[];let r=null;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),r)throw new u("effect:type-error","Accepts only one color",{});r=j(n)}else{const t=E(n);if(Object.isFrozen(e))throw new u("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&x(t,n)}if(e.length<2||e.length>3)throw new u("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new f(e[0],e[1],e[2]||0,r||$("black"))}(t);case"bloom":return function(t){let e=1,r=0,n=0;return A(t.parameters,3),t.parameters[0]&&(e=F(t.parameters[0])),t.parameters[1]&&(r=E(t.parameters[1]),x(r,t.parameters[1])),t.parameters[2]&&(n=F(t.parameters[2])),new p(e,r,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new u("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}(t)))}function A(t,e){if(t.length>e)throw new u("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function w(t){if("color"===t.type)return"<color>";if(t.unit){if(t.unit in C)return"<length>";if(t.unit in b)return"<angle>";if("%"===t.unit)return"<percentage>"}return"<double>"}function x(t,e){if(t<0)throw new u("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}const b={deg:1,grad:.9,rad:180/Math.PI,turn:360},C={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function F(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new u("effect:type-error",`Expected <double> or <percentage>, Actual: ${w(t)}`,{term:t})}(t);const e=t.value;return x(e,t),"%"===t.unit?.01*e:e}function E(t){return function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=C[t.unit]))throw new u("effect:type-error",`Expected <length>, Actual: ${w(t)}`,{term:t})}(t),t.value*C[t.unit]||0}function j(e){switch(e.colorType){case"hex":return t(e.value);case"named":return $(e.value);case"function":return function(t){if(A(t.parameters,4),O.test(t.name))return[F(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1];if(q.test(t.name))return n(function(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new u("effect:type-error",`Expected <double>, Actual: ${w(t)}`,{term:t})}(t),x(t.value,t),t.value}(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1);throw new u("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(e.value)}}function $(t){if(!e(t))throw new u("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return r(t)}const O=/^rgba?/i,q=/^hsla?/i;export{d as p};
