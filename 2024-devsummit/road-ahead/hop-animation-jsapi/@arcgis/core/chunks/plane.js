/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{a as t,c as r}from"./mathUtils.js";import{p as n,c as s,e,n as i,d as o,h as c,b as a,l as u,o as f,s as h}from"./vec3.js";import{c as m,a as g}from"./vec3f64.js";import{e as _}from"../core/lang.js";import"./Logger.js";import"./Axis.js";import{n as I}from"../core/scheduling.js";import{c as M}from"./mat3f64.js";import{c as l}from"./mat4f64.js";import{c as N}from"./quatf64.js";import{c as P}from"./vec2f64.js";import{c as p}from"./vec4f64.js";import{t as d}from"./mathUtils2.js";class j{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&I((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*E);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,E));t++)this._items.push(this._allocator())}}const E=1024;class w{constructor(t){this._create=t,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&I((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const t=2*this._itemsPtr;this._items.length>t&&(this._items.length=t),this._itemsPtr=0}static createVec2f64(){return new w(P)}static createVec3f64(){return new w(m)}static createVec4f64(){return new w(p)}static createMat3f64(){return new w(M)}static createMat4f64(){return new w(l)}static createQuatf64(){return new w(N)}get test(){return{length:this._items.length}}}const A=w.createVec2f64(),F=w.createVec3f64(),T=w.createVec4f64();w.createMat3f64();const v=w.createMat4f64(),b=w.createQuatf64();function x(t){return t?y(g(t.origin),g(t.direction)):y(m(),m())}function y(t,r){return{origin:t,direction:r}}function L(t,r){return _(t.origin,r.origin)&&_(t.direction,r.direction)}function V(t,r){const n=U.get();return n.origin=t,n.direction=r,n}function C(t,r=x()){return q(t.origin,t.direction,r)}function X(t,r,e=x()){return n(e.origin,t),s(e.direction,r,t),e}function q(t,r,s=x()){return n(s.origin,t),n(s.direction,r),s}function O(t,r){const n=e(F.get(),i(F.get(),t.direction),s(F.get(),r,t.origin));return o(n,n)}function Q(t,r,n){const e=o(t.direction,s(n,r,t.origin));return c(n,t.origin,a(n,t.direction,e)),n}const U=new j((()=>x()));function k(t,r,n){const s=o(t,r)/o(t,t);return a(n,t,s)}function z(t,r){return o(t,r)/u(t)}function B(r,n){const s=o(r,n)/(u(r)*u(n));return-t(s)}function D(r,n,s){i(G,r),i(H,n);const c=o(G,H),a=t(c),u=e(G,G,H);return o(u,s)<0?2*Math.PI-a:a}const G=m(),H=m();function J(t=wt){return[t[0],t[1],t[2],t[3]]}function K(t=wt[0],r=wt[1],n=wt[2],s=wt[3]){return W(t,r,n,s,T.get())}function R(t,r){return W(r[0],r[1],r[2],r[3],t)}function S(t){return t}function W(t,r,n,s,e=J()){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e}function Y(t,r,s){return n(s,t),s[3]=r,s}function Z(t,r,n){const s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],e=Math.abs(s-1)>1e-5&&s>1e-12?1/Math.sqrt(s):1;return n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n}function $(t,r,n,s=J()){const e=n[0]-r[0],i=n[1]-r[1],o=n[2]-r[2],c=t[0]-r[0],a=t[1]-r[1],u=t[2]-r[2],f=i*u-o*a,h=o*c-e*u,m=e*a-i*c,g=f*f+h*h+m*m,_=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;return s[0]=f*_,s[1]=h*_,s[2]=m*_,s[3]=-(s[0]*t[0]+s[1]*t[1]+s[2]*t[2]),s}function tt(t,r,n,e=0,c=Math.floor(n*(1/3)),a=Math.floor(n*(2/3))){if(n<3)return!1;r(st,e);let u=c,h=!1;for(;u<n-1&&!h;)r(et,u),u++,h=!f(st,et);if(!h)return!1;for(u=Math.max(u,a),h=!1;u<n&&!h;)r(it,u),u++,s(ot,st,et),i(ot,ot),s(ct,et,it),i(ct,ct),h=!f(st,it)&&!f(et,it)&&Math.abs(o(ot,ct))<nt;return h?($(st,et,it,t),!0):(0!==e||1!==c||2!==a)&&tt(t,r,n,0,1,2)}function rt(t,r,n=!0){const s=r.length/3;return tt(t,((t,n)=>h(t,r[3*n+0],r[3*n+1],r[3*n+2])),n?s-1:s)}const nt=.99619469809,st=m(),et=m(),it=m(),ot=m(),ct=m();function at(t,r,n){return r!==t&&R(t,r),t[3]=-o(t,n),t}function ut(t,r){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function ft(t,r,n,s){return e(it,r,t),Z(n,it,s)}function ht(t,r,n,e){return Et(t,r,s(F.get(),n,r),Ft,e)}function mt(t,r,n){return null!=r&&Et(t,r.origin,r.direction,Tt,n)}function gt(t,r,n){return Et(t,r.origin,r.vector,At.NONE,n)}function _t(t,r,n){return Et(t,r.origin,r.vector,At.CLAMP,n)}function It(t,r){return jt(t,r)>=0}function Mt(t,r){const n=o(t,r.ray.direction),s=-jt(t,r.ray.origin);if(s<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return s>0;if((s<0||n<0)&&!(s<0&&n<0))return!0;const e=s/n;return n>0?e<r.c1&&(r.c1=e):e>r.c0&&(r.c0=e),r.c0<=r.c1}function lt(t,r){const n=o(t,r.ray.direction),s=-jt(t,r.ray.origin);if(n>-1e-6&&n<1e-6)return s>0;const e=s/n;return n>0?e<r.c1&&(r.c1=e):e>r.c0&&(r.c0=e),r.c0<=r.c1}function Nt(t,r,n){const e=a(F.get(),t,-t[3]),i=pt(t,s(F.get(),r,e),F.get());return c(n,i,e),n}function Pt(t,r,n,e){const i=t,o=F.get(),c=F.get();d(i,o,c);const a=s(F.get(),n,r),u=z(o,a),f=z(c,a),m=z(i,a);return h(e,u,f,m)}function pt(t,r,n){const e=a(F.get(),t,o(t,r));return s(n,r,e),n}function dt(t,r){return Math.abs(jt(t,r))}function jt(t,r){return o(t,r)+t[3]}function Et(t,n,s,e,i){const u=o(t,s);if(0===u)return!1;let f=-(o(t,n)+t[3])/u;return e&At.CLAMP&&(f=r(f,0,1)),!(!(e&At.INFINITE_MIN)&&f<0||!(e&At.INFINITE_MAX)&&f>1||(c(i,n,a(i,s,f)),0))}const wt=[0,0,1,0];var At;!function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"}(At||(At={}));const Ft=At.INFINITE_MIN|At.INFINITE_MAX,Tt=At.INFINITE_MAX;export{q as A,tt as B,b as C,C as D,T as E,lt as F,jt as G,Mt as H,D as I,dt as J,ht as K,L,Y as M,rt as N,j as O,ut as P,pt as Q,v as a,B as b,Q as c,$ as d,V as e,X as f,S as g,J as h,ft as i,at as j,R as k,W as l,mt as m,gt as n,_t as o,Pt as p,O as q,It as r,F as s,Nt as t,z as u,x as v,K as w,A as x,Z as y,k as z};
