/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{r as e}from"./widgetUtils.js";const t="http://www.w3.org/",r=`${t}2000/svg`,o=`${t}1999/xlink`;let n=[],i=(e,t)=>{let r={};return Object.keys(e).forEach((t=>{r[t]=e[t]})),t&&Object.keys(t).forEach((e=>{r[e]=t[e]})),r},l=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),s=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},d=(e,t,r)=>{if(""!==t.vnodeSelector)for(let o=r;o<e.length;o++)if(l(e[o],t))return o;return-1},p=(e,t,r,o)=>{let n=e[t];if(""===n.vnodeSelector)return;let i=n.properties;if(!(i?void 0===i.key?i.bind:i.key:void 0))for(let i=0;i<e.length;i++)if(i!==t){let t=e[i];if(l(t,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===o?o:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},a=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},c=[],f=!1,u=e=>{(e.children||[]).forEach(u),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},m=()=>{f=!1,c.forEach(u),c.length=0},v=e=>{c.push(e),f||(f=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(m,{timeout:16}):setTimeout(m,16))},h=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";let o=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void r(t,o,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},y=(t,n,i)=>{if(!n)return;let l=i.eventHandlerInterceptor,d=Object.keys(n),p=d.length;for(let a=0;a<p;a++){let p=d[a],c=n[p];if("className"===p)throw new Error('Property "className" is not supported, use "class".');if("class"===p)A(t,c,!0);else if("classes"===p){let e=Object.keys(c),r=e.length;for(let o=0;o<r;o++){let r=e[o];c[r]&&t.classList.add(r)}}else if("styles"===p){let e=Object.keys(c),r=e.length;for(let o=0;o<r;o++){let r=e[o],n=c[r];n&&(s(n),i.styleApplyer(t,r,n))}}else if("key"!==p&&null!=c){let s=typeof c;"function"===s?(0===p.lastIndexOf("on",0)&&(l&&(c=l(p,c,t,n)),"oninput"===p&&function(){let e=c;c=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),t[p]=c):i.namespace===r?"href"===p?t.setAttributeNS(o,p,c):t.setAttribute(p,c):"string"===s&&"value"!==p?"innerHTML"===p?t[p]=e.sanitize(c):g(t)&&p in t?t[p]=c:t.setAttribute(p,c):t[p]=c}}};function g(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let N,b=(e,t,r)=>{((e,t,r)=>{if(t)for(let o of t)w(o,e,void 0,r)})(e,t.children,r),t.text&&(e.textContent=t.text),y(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},w=(e,t,o,n)=>{let l,s=0,d=e.vnodeSelector,p=t.ownerDocument;if(""===d)l=e.domNode=p.createTextNode(e.text),void 0!==o?t.insertBefore(l,o):t.appendChild(l);else{for(let a=0;a<=d.length;++a){let c=d.charAt(a);if(a===d.length||"."===c||"#"===c){let c=d.charAt(s-1),f=d.slice(s,a);"."===c?l.classList.add(f):"#"===c?l.id=f:("svg"===f&&(n=i(n,{namespace:r})),void 0!==n.namespace?l=e.domNode=p.createElementNS(n.namespace,f):(l=e.domNode=e.domNode||p.createElement(f),"input"===f&&e.properties&&void 0!==e.properties.type&&l.setAttribute("type",e.properties.type)),void 0!==o?t.insertBefore(l,o):l.parentNode!==t&&t.appendChild(l)),s=a+1}}b(l,e,n)}},A=(e,t,r)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,r)}))};N=(t,c,f)=>{let u=t.domNode,m=!1;if(t===c)return!1;let v=!1;if(""===c.vnodeSelector){if(c.text!==t.text){let e=u.ownerDocument.createTextNode(c.text);return u.parentNode.replaceChild(e,u),c.domNode=e,m=!0,m}c.domNode=u}else 0===c.vnodeSelector.lastIndexOf("svg",0)&&(f=i(f,{namespace:r})),t.text!==c.text&&(v=!0,void 0===c.text?u.removeChild(u.firstChild):u.textContent=c.text),c.domNode=u,v=((e,t,r,o,i)=>{if(r===o)return!1;o=o||n;let s,c=(r=r||n).length,f=o.length,u=0,m=0,v=!1;for(;m<f;){let n=u<c?r[u]:void 0,f=o[m];if(void 0!==n&&l(n,f))v=N(n,f,i)||v,u++;else{let n=d(r,f,u+1);if(n>=0){for(s=u;s<n;s++)h(r[s]),p(r,s,e,"removed");v=N(r[n],f,i)||v,u=n+1}else w(f,t,u<c?r[u].domNode:void 0,i),a(f),p(o,m,e,"added")}m++}if(c>u)for(s=u;s<c;s++)h(r[s]),p(r,s,e,"removed");return v})(c,u,t.children,c.children,f)||v,v=((t,n,i,l)=>{if(!i)return;let d=!1,p=Object.keys(i),a=p.length;for(let c=0;c<a;c++){let a=p[c],f=i[a],u=n[a];if("class"===a)u!==f&&(A(t,u,!1),A(t,f,!0));else if("classes"===a){let e=t.classList,r=Object.keys(f),o=r.length;for(let t=0;t<o;t++){let o=r[t],n=!!f[o];n!==!!u[o]&&(d=!0,n?e.add(o):e.remove(o))}}else if("styles"===a){let e=Object.keys(f),r=e.length;for(let o=0;o<r;o++){let r=e[o],n=f[r];n!==u[r]&&(d=!0,n?(s(n),l.styleApplyer(t,r,n)):l.styleApplyer(t,r,""))}}else if(f||"string"!=typeof u||(f=""),"value"!==a||g(t)){if(f!==u){let n=typeof f;"function"===n&&l.eventHandlerInterceptor||(l.namespace===r?"href"===a?t.setAttributeNS(o,a,f):t.setAttribute(a,f):"string"===n?"innerHTML"===a?t[a]=e.sanitize(f):"role"===a&&""===f?t.removeAttribute(a):g(t)&&a in t?t[a]=f:t.setAttribute(a,f):t[a]!==f&&(t[a]=f),d=!0)}}else{let e=t[a];e!==f&&(t["oninput-value"]?e===t["oninput-value"]:f!==u)&&(t[a]=f,t["oninput-value"]=void 0),f!==u&&(d=!0)}}return d})(u,t.properties,c.properties,f)||v,c.properties&&c.properties.afterUpdate&&c.properties.afterUpdate.apply(c.properties.bind||c.properties,[u,f,c.vnodeSelector,c.properties,c.children]);return v&&c.properties&&c.properties.updateAnimation&&c.properties.updateAnimation(u,c.properties,t.properties),m};let x=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let o=e;e=r,N(o,r,t)},domNode:e.domNode});const E={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{"-"===t.charAt(0)?e.style.setProperty(t,r):e.style[t]=r}};let k,S=e=>i(E,e),C={create:(e,t)=>(t=S(t),w(e,document.createElement("div"),void 0,t),x(e,t)),append:(e,t,r)=>(r=S(r),w(t,e,void 0,r),x(t,r)),insertBefore:(e,t,r)=>(r=S(r),w(t,e.parentNode,e,r),x(t,r)),merge:(e,t,r)=>(r=S(r),t.domNode=e,b(e,t,r),x(t,r)),replace:(e,t,r)=>(r=S(r),w(t,e.parentNode,e,r),e.parentNode.removeChild(e),x(t,r))};k=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let L=(e,t,r)=>{let o=function(o){r("domEvent",o);let n=t(),i=((e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(o.currentTarget,n.domNode);i.reverse();let l,s=((e,t)=>{let r=e;return t.forEach((e=>{r=r&&r.children?k(r.children,(t=>t.domNode===e)):void 0})),r})(n.getLastRender(),i);return e.scheduleRender(),s&&(l=s.properties[`on${o.type}`].apply(s.properties.bind||this,arguments)),r("domEventProcessed",o),l};return(e,t,r,n)=>o},O=e=>{let t,r,o=S(e),n=o.performanceLogger,i=!0,l=!1,s=[],d=[],p=(e,r,i)=>{let l;o.eventHandlerInterceptor=L(t,(()=>l),n),l=e(r,i(),o),s.push(l),d.push(i)},a=()=>{if(r=void 0,i){i=!1,n("renderStart",void 0);for(let e=0;e<s.length;e++){let t=d[e]();n("rendered",void 0),s[e].update(t),n("patched",void 0)}n("renderDone",void 0),i=!0}};return t={renderNow:a,scheduleRender:()=>{r||l||(r=requestAnimationFrame(a))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),l=!0},resume:()=>{l=!1,i=!0,t.scheduleRender()},append:(e,t)=>{p(C.append,e,t)},insertBefore:(e,t)=>{p(C.insertBefore,e,t)},merge:(e,t)=>{p(C.merge,e,t)},replace:(e,t)=>{p(C.replace,e,t)},detach:e=>{for(let t=0;t<d.length;t++)if(d[t]===e)return d.splice(t,1),s.splice(t,1)[0];throw new Error("renderFunction was not found")}},t};export{O as c,C as d};
