/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as t}from"./Logger.js";import{a as n,b as r}from"./mathUtils.js";import{a as s}from"./mat4.js";import{e,b as o,l as i,g as a,c,h as u,i as f,j as l,n as m,s as g,k as p,a as h,m as d}from"./vec3.js";import{c as j}from"./vec3f64.js";import{c as M,a as b}from"./vec4.js";import{c as y,f as S}from"./vec4f64.js";import{g as A}from"./common.js";import{A as v}from"./Axis.js";import{s as x,a as R,b as P,f as q,c as L}from"./plane.js";const _=w();function w(){return y()}const C=b,E=b;function O(t,n){return M(n,t)}function T(t,n){return S(t[0],t[1],t[2],n)}function k(t){return t}function N(t,n){return t[0]=t[1]=t[2]=0,t[3]=n,t}function Z(t){return t[3]}function z(t){return t}function U(t,n,r,s){return S(t,n,r,s)}function V(t,n,r){if(null==n)return!1;if(!B(t,n,Y))return!1;let{t0:s,t1:e}=Y;if((s<0||e<s&&e>0)&&(s=e),s<0)return!1;if(r){const{origin:t,direction:e}=n;r[0]=t[0]+e[0]*s,r[1]=t[1]+e[1]*s,r[2]=t[2]+e[2]*s}return!0}function X(t,n,r){const s=q(n,r);if(!B(t,s,Y))return[];const{origin:e,direction:o}=s,{t0:i,t1:a}=Y,c=n=>{const r=j();return d(r,e,o,n),H(t,r,r)};return Math.abs(i-a)<A()?[c(i)]:[c(i),c(a)]}const Y={t0:0,t1:0};function B(t,n,r){const{origin:s,direction:e}=n,o=D;o[0]=s[0]-t[0],o[1]=s[1]-t[1],o[2]=s[2]-t[2];const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(0===i)return!1;const a=2*(e[0]*o[0]+e[1]*o[1]+e[2]*o[2]),c=a*a-4*i*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-t[3]*t[3]);if(c<0)return!1;const u=Math.sqrt(c);return r.t0=(-a-u)/(2*i),r.t1=(-a+u)/(2*i),!0}const D=j();function F(t,n){return V(t,n,null)}function G(t,n,r){const c=x.get(),u=R.get();e(c,n.origin,n.direction);const f=Z(t);e(r,c,n.origin),o(r,r,1/i(r)*f);const l=J(t,n.origin),m=P(n.origin,r);return s(u,m+l,c),a(r,r,u),r}function H(t,n,r){const s=c(x.get(),n,t),e=o(x.get(),s,t[3]/i(s));return u(r,e,t)}function I(t,n){const r=c(x.get(),n,t),s=l(r),e=t[3]*t[3];return Math.sqrt(Math.abs(s-e))}function J(t,r){const s=c(x.get(),r,t),e=i(s),o=Z(t),a=o+Math.abs(o-e);return n(o/a)}const K=j();function Q(t,n,s,e){const o=c(K,n,t);switch(s){case v.X:{const t=r(o,K)[2];return g(e,-Math.sin(t),Math.cos(t),0)}case v.Y:{const t=r(o,K),n=t[1],s=t[2],i=Math.sin(n);return g(e,-i*Math.cos(s),-i*Math.sin(s),Math.cos(n))}case v.Z:return m(e,o);default:return}}function W(t,n){const r=c(nt,n,t);return i(r)-t[3]}function $(t,n){const r=p(t,n),s=Z(t);return r<=s*s}function tt(t,n,r=y()){const s=f(t,n),e=t[3],o=n[3];return s+o<e?(M(r,t),r):s+e<o?(M(r,n),r):(h(r,t,n,(s+o-e)/(2*s)),r[3]=(s+e+o)/2,r)}const nt=j(),rt=w(),st=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:_,altitudeAt:W,angleToSilhouette:J,axisAt:Q,clear:function(t){t[0]=t[1]=t[2]=t[3]=0},closestPoint:function(t,n,r){return V(t,n,r)?r:(L(n,t,r),H(t,r,r))},closestPointOnSilhouette:G,containsPoint:$,copy:O,create:w,distanceToSilhouette:I,elevate:function(t,n,r){return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=t[3]+n,r},equals:E,exactEquals:C,fromCenterAndRadius:T,fromRadius:N,fromValues:U,getCenter:z,getRadius:Z,intersectLine:X,intersectRay:V,intersectRayClosestSilhouette:function(t,n,r){if(V(t,n,r))return r;const s=G(t,n,x.get());return u(r,n.origin,o(x.get(),n.direction,f(n.origin,s)/i(n.direction))),r},intersectsRay:F,projectPoint:H,setAltitudeAt:function(t,n,r,s){const e=W(t,n),i=Q(t,n,v.Z,nt),a=o(nt,i,r-e);return u(s,n,a)},setExtent:function(n,r,s){return t.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),n!==s&&O(n,s),s},tmpSphere:rt,union:tt,wrap:k},Symbol.toStringTag,{value:"Module"}));export{_ as N,Z as a,w as b,O as c,$ as d,X as e,U as f,z as g,T as h,F as i,C as j,V as k,G as l,N as m,I as n,H as p,st as s,rt as t,tt as u,k as w};
