/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{C as n,c as e}from"./generateRendererUtils.js";const t="<Null>",l="equal-interval",a=1,i=5,o=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,r=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),u=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),s=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function m(n){return null==n||"string"==typeof n&&!n?t:n}function c(n){const e=null!=n.normalizationField||null!=n.normalizationType,t=null!=n.minValue||null!=n.maxValue,l=!!n.sqlExpression&&n.supportsSQLExpression;return!e&&!t&&!l}function f(n){const e=n.returnDistinct?[...new Set(n.values)]:n.values,t=e.filter((n=>null!=n)).sort(),l=t.length,a={count:l,min:t[0],max:t[l-1]};return n.supportsNullCount&&(a.nullcount=e.length-l),n.percentileParams&&(a.median=p(e,n.percentileParams)),a}function d(n){const{values:e,useSampleStdDev:t,supportsNullCount:l}=n;let a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=null,r=null,u=null,s=null,m=0;const c=null==n.minValue?-1/0:n.minValue,f=null==n.maxValue?1/0:n.maxValue;for(const n of e)Number.isFinite(n)?n>=c&&n<=f&&(o=null===o?n:o+n,a=Math.min(a,n),i=Math.max(i,n),m++):"string"==typeof n&&m++;if(m&&null!=o){r=o/m;let n=0;for(const t of e)Number.isFinite(t)&&t>=c&&t<=f&&(n+=(t-r)**2);s=t?m>1?n/(m-1):0:m>0?n/m:0,u=Math.sqrt(s)}else a=null,i=null;const d={avg:r,count:m,max:i,min:a,stddev:u,sum:o,variance:s};return l&&(d.nullcount=e.length-m),n.percentileParams&&(d.median=p(e,n.percentileParams)),d}function p(n,e){const{fieldType:t,value:l,orderBy:a,isDiscrete:i}=e,o=v(t,"desc"===a);if(0===(n=[...n].filter((n=>null!=n)).sort(((n,e)=>o(n,e)))).length)return null;if(l<=0)return n[0];if(l>=1)return n[n.length-1];const r=(n.length-1)*l,u=Math.floor(r),s=u+1,m=r%1,c=n[u],f=n[s];return s>=n.length||i||"string"==typeof c||"string"==typeof f?c:c*(1-m)+f*m}function v(n,e){if(n){if(r.has(n))return D(e);if(u.has(n))return x(e,!1);if("esriFieldTypeTimestampOffset"===n)return function(n){return n?b:h}(e);const t=x(e,!0);if("esriFieldTypeString"===n)return t;if("esriFieldTypeGUID"===n||"esriFieldTypeGlobalID"===n)return(n,e)=>t(I(n),I(e))}const t=e?1:-1,l=D(e),a=x(e,!0);return(n,e)=>"number"==typeof n&&"number"==typeof e?l(n,e):"string"==typeof n&&"string"==typeof e?a(n,e):t}const T=(n,e)=>null==n?null==e?0:1:null==e?-1:null,g=(n,e)=>null==n?null==e?0:-1:null==e?1:null,h=(n,e)=>g(n,e)??(n===e?0:new Date(n).getTime()-new Date(e).getTime()),b=(n,e)=>T(n,e)??(n===e?0:new Date(e).getTime()-new Date(n).getTime()),V=(n,e)=>g(n,e)??(n===e?0:n<e?-1:1),y=(n,e)=>T(n,e)??(n===e?0:n<e?1:-1);function x(n,e){if(!e)return n?y:V;const t=function(n){return n?T:g}(n);return n?(n,e)=>{const l=t(n,e);return null!=l?l:(n=n.toUpperCase())>(e=e.toUpperCase())?-1:n<e?1:0}:(n,e)=>{const l=t(n,e);return null!=l?l:(n=n.toUpperCase())<(e=e.toUpperCase())?-1:n>e?1:0}}const F=(n,e)=>T(n,e)??e-n,z=(n,e)=>g(n,e)??n-e;function D(n){return n?F:z}function I(n){return n.substr(24,12)+n.substr(19,4)+n.substr(16,2)+n.substr(14,2)+n.substr(11,2)+n.substr(9,2)+n.substr(6,2)+n.substr(4,2)+n.substr(2,2)+n.substr(0,2)}function N(n,e){let t;for(t in n)s.includes(t)&&(Number.isFinite(n[t])||(n[t]=null));return e?(["avg","stddev","variance"].forEach((e=>{null!=n[e]&&(n[e]=Math.ceil(n[e]??0))})),n):n}function S(n){const e={};for(let t of n)(null==t||"string"==typeof t&&""===t.trim())&&(t=null),null==e[t]?e[t]={count:1,data:t}:e[t].count++;return{count:e}}function M(n){return"coded-value"!==n?.type?[]:n.codedValues.map((n=>n.code))}function C(n,e,t,l){const a=n.count,i=[];if(t&&e){const n=[],t=M(e[0]);for(const a of t)if(e[1]){const t=M(e[1]);for(const i of t)if(e[2]){const t=M(e[2]);for(const e of t)n.push(`${m(a)}${l}${m(i)}${l}${m(e)}`)}else n.push(`${m(a)}${l}${m(i)}`)}else n.push(a);for(const e of n)a.hasOwnProperty(e)||(a[e]={data:e,count:0})}for(const n in a){const e=a[n];i.push({value:e.data,count:e.count,label:e.label})}return{uniqueValueInfos:i}}function k(n,e,t,l){let a=null;switch(e){case"log":0!==n&&(a=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(l)&&0!==l&&(a=n/l*100);break;case"field":Number.isFinite(t)&&0!==t&&(a=n/t);break;case"natural-log":n>0&&(a=Math.log(n));break;case"square-root":n>0&&(a=n**.5)}return a}function w(n,t){const l=$({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||i});return n=function(n,e,t){const l=e??-1/0,a=t??1/0;return n.filter((n=>Number.isFinite(n)&&n>=l&&n<=a))}(n,t.minValue,t.maxValue),e({definition:l,values:n,normalizationTotal:t.normalizationTotal})}function $(e){const{breakCount:t,field:i,normalizationField:o,normalizationType:r}=e,u=e.classificationMethod||l,s="standard-deviation"===u?e.standardDeviationInterval||a:void 0;return new n({breakCount:t,classificationField:i,classificationMethod:u,normalizationField:"field"===r?o:void 0,normalizationType:r,standardDeviationInterval:s})}function E(n,e){let t=n.classBreaks;const l=t.length,a=t[0]?.minValue,i=t[l-1]?.maxValue,r="standard-deviation"===e,u=o;return t=t.map((n=>{const e=n.label,t={minValue:n.minValue,maxValue:n.maxValue,label:e};if(r&&e){const n=e.match(u),l=n?.map((n=>+n.trim()))??[];2===l.length?(t.minStdDev=l[0],t.maxStdDev=l[1],l[0]<0&&l[1]>0&&(t.hasAvg=!0)):1===l.length&&(e.includes("<")?(t.minStdDev=null,t.maxStdDev=l[0]):e.includes(">")&&(t.minStdDev=l[0],t.maxStdDev=null))}return t})),{minValue:a,maxValue:i,classBreakInfos:t,normalizationTotal:n.normalizationTotal}}function O(n,e){const t=function(n,e){const{field:t,classificationMethod:l,standardDeviationInterval:a,normalizationType:i,normalizationField:o,normalizationTotal:r,minValue:u,maxValue:s}=e,m=e.numBins||10;let f=null,p=null,v=null;if(l&&"equal-interval"!==l||i){const{classBreaks:e}=w(n,{field:t,normalizationType:i,normalizationField:o,normalizationTotal:r,classificationMethod:l,standardDeviationInterval:a,minValue:u,maxValue:s,numClasses:m});f=e[0].minValue,p=e[e.length-1].maxValue,v=e.map((n=>[n.minValue,n.maxValue]))}else{if(null!=u&&null!=s)f=u,p=s;else{const e=d({values:n,minValue:u,maxValue:s,useSampleStdDev:!i,supportsNullCount:c({normalizationType:i,normalizationField:o,minValue:u,maxValue:s})});f=e.min??null,p=e.max??null}v=B(f??0,p??0,m)}return{min:f,max:p,intervals:v}}(n,e);if(null==t.min&&null==t.max)return{bins:[],minValue:t.min,maxValue:t.max,normalizationTotal:e.normalizationTotal};const l=t.intervals,a=t.min??0,i=t.max??0,o=l.map(((n,e)=>({minValue:l[e][0],maxValue:l[e][1],count:0})));for(const e of n)if(null!=e&&e>=a&&e<=i){const n=q(l,e);n>-1&&o[n].count++}return{bins:o,minValue:a,maxValue:i,normalizationTotal:e.normalizationTotal}}function q(n,e){let t=-1;for(let l=n.length-1;l>=0;l--)if(e>=n[l][0]){t=l;break}return t}function B(n,e,t){const l=(e-n)/t,a=[];let i,o=n;for(let n=1;n<=t;n++)i=o+l,i=Number(i.toFixed(16)),a.push([o,n===t?e:i]),o=i;return a}export{B as a,d as b,f as c,N as d,S as e,C as f,k as g,w as h,c as i,O as j,v as k,p as l,$ as m,m as p,E as r,s};
