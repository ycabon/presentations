/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{m as t}from"./handleUtils.js";import{M as e}from"../core/scheduling.js";import"../core/lang.js";import"../core/Error.js";import"../core/urlUtils.js";import{A as r}from"./enums2.js";import{g as i}from"./AttributeStore.js";function a(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class n{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case r.None:this._currentFrame-=this._direction;break;case r.Loop:this._currentFrame=0;break;case r.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case r.None:this._currentFrame-=this._direction;break;case r.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case r.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function o(o,s,m,u){const h=null==s.playAnimation||s.playAnimation,c=function(t,o,s,m){let u,{repeatType:h}=o;if(null==h&&(h=r.Loop),!0===o.reverseAnimation&&(t=function(t){const{width:e,height:r}=t,i=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)},width:e,height:r}}(t)),null!=o.duration&&(t=function(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}(t,e(1e3*o.duration))),null!=o.repeatDelay){const i=1e3*o.repeatDelay;h===r.Loop?t=a(t,e(i)):h===r.Oscillate&&(t=function(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}(a(t,e(i/2)),e(i/2)))}if(null!=o.startTimeOffset)u=e(1e3*o.startTimeOffset);else if(null!=o.randomizeStartTime){const r=82749913,a=null!=o.randomizeStartSeed?o.randomizeStartSeed:r,n=i(s,a);u=e(n*function(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}(t))}else u=e(0);return new n(t,u,h,m)}(o,s,m,u);let f,l=c.timeToFrame;return function t(){f=h?setTimeout((()=>{c.nextFrame(),l=c.timeToFrame,t()}),l):void 0}(),t((()=>h&&clearTimeout(f)))}export{o as p};
