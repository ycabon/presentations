/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as o}from"../chunks/tslib.es6.js";import s from"./Error.js";import{a as t}from"../chunks/maybe.js";import{EsriPromise as r}from"./Promise.js";import{onAbortOrThrow as e}from"./promiseUtils.js";import{W as l,subclass as a}from"./accessorSupport/decorators/subclass.js";import{property as i}from"./accessorSupport/decorators/property.js";import"./lang.js";import"../chunks/Logger.js";import"../config.js";import"./Accessor.js";import"./Handles.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"./scheduling.js";import"../chunks/ensureType.js";const n="loaded",d=r=>{let d=class extends r{constructor(...o){super(...o),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((o=>{const t=this.load.bind(this);this.load=r=>{const l=new Promise(((o,t)=>{const l=e(r,t);this.destroyed&&t(new s("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(o,t).finally((()=>{l&&l.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const o=this._loadController=new AbortController;t({signal:o.signal})}return o(),l}}))),this.when((()=>{this._set("loadStatus",n),this._loadController=null}),(o=>{this._set("loadStatus","failed"),this._set("loadError",o),this._loadController=null}))}destroy(){this._loadController&&(this._loadController=t(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===n}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new s("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return o([i({readOnly:!0})],d.prototype,"loaded",null),o([i({readOnly:!0})],d.prototype,"loadError",void 0),o([i({clonable:!1})],d.prototype,"loadStatus",void 0),o([i({type:[l],readOnly:!0})],d.prototype,"loadWarnings",null),d=o([a("esri.core.Loadable")],d),d};let h=class extends(d(r)){};h=o([a("esri.core.Loadable")],h),function(o){o.LoadableMixin=d,o.isLoadable=function(o){return!(!o||!o.load)}}(h||(h={}));const c=h;export{c as default};
