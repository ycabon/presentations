/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{h as t}from"../../core/lang.js";import{l as e}from"../../layers/support/fieldUtils.js";import{h as a,l as s,i as l,m as o,n as r,o as n,g as i,e as c,d as u,f as m,c as p,a as h,b as d,k as y,p as f}from"../../chunks/utils9.js";import b from"../../Color.js";import{id as L}from"../../kernel.js";import g from"../../request.js";import{a as k,c as v}from"../../chunks/colorUtils2.js";import j from"../../core/Error.js";import{c as w}from"../../chunks/projector.js";import{b as x}from"../../chunks/maybe.js";import{c as M}from"../../chunks/mat2df32.js";import{m as S,t as C,c as z,s as $,r as U}from"../../chunks/mat2d.js";import{a as Z,c as D}from"../../chunks/widgetUtils.js";import{t as T}from"../../chunks/jsxFactory.js";import{g as q}from"../../chunks/assets.js";import{L as H}from"../../chunks/Logger.js";import{a as R}from"../../chunks/screenUtils.js";import{d as _}from"../IconSymbol3DLayer.js";import{d as P}from"../ObjectSymbol3DLayer.js";import{resolveWebStyleSymbol as E}from"../../chunks/webStyleSymbolUtils.js";import"../../config.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../core/sql.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/datetime.js";import"../../chunks/messages.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/tslib.es6.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../symbols.js";import"../CIMSymbol.js";import"../../chunks/enumeration.js";import"../Symbol.js";import"../../chunks/colorUtils.js";import"../ExtrudeSymbol3DLayer.js";import"../Symbol3DLayer.js";import"../../chunks/utils4.js";import"../edges/Edges3D.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../edges/SketchEdges3D.js";import"../edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../FillSymbol.js";import"../SimpleLineSymbol.js";import"../LineSymbol.js";import"../LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../FillSymbol3DLayer.js";import"../patterns/LineStylePattern3D.js";import"../patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../Font.js";import"../LabelSymbol3D.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../chunks/persistableUrlUtils.js";import"../LineSymbol3DLayer.js";import"../LineStyleMarker3D.js";import"../../core/Clonable.js";import"../PathSymbol3DLayer.js";import"../TextSymbol3DLayer.js";import"../WaterSymbol3DLayer.js";import"./StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../callouts/Callout3D.js";import"../callouts/LineCallout3D.js";import"./Symbol3DVerticalOffset.js";import"../LineSymbol3D.js";import"../MarkerSymbol.js";import"../MeshSymbol3D.js";import"../PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../PictureMarkerSymbol.js";import"../PointSymbol3D.js";import"../PolygonSymbol3D.js";import"../../core/reactiveUtils.js";import"../../chunks/asyncUtils.js";import"../SimpleFillSymbol.js";import"../SimpleMarkerSymbol.js";import"../TextSymbol.js";import"../WebStyleSymbol.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/utils3.js";import"../../chunks/mat4.js";import"../../chunks/_commonjsHelpers.js";import"./cimSymbolUtils.js";import"../../chunks/utils6.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/vec4.js";import"../../chunks/vec4f64.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/devEnvironmentUtils.js";import"./jsonUtils.js";import"../../chunks/layerUtils2.js";import"../../chunks/styleUtils.js";var V;!function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"}(V||(V={}));const I={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function O(t){const e=V.size,a=.5*t;return[{type:"path",path:[{command:"M",values:[0,.7*e*.5]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+a]},{command:"L",values:[0,.7*e+a-.7*e*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+a]},{command:"L",values:[e,a]},{command:"L",values:[e,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,0]},{command:"L",values:[e,0]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[0,.7*e*.5]},{command:"Z",values:[]}]}]}function A(t,e){return Math.round(Math.min(Math.max(t+255*e*.75,0),255))}function F(t,e){if(null==t)return new b;if("type"in t&&("linear"===t.type||"pattern"===t.type))return t;const a=new b(t);return new b([A(a.r,e),A(a.g,e),A(a.b,e),a.a])}const W="http://www.w3.org/2000/svg";let B=0,G=0;const N=t("android"),X=t("chrome")||N&&N>=4?"auto":"optimizeLegibility",Y={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Q=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let J={},K={};const tt=Math.PI;let et=1;function at(t,e){const a=t*(tt/180);return Math.abs(e*Math.sin(a))+Math.abs(e*Math.cos(a))}function st(t){return t.map((t=>`${t.command} ${t.values.join(" ")}`)).join(" ").trim()}function lt(t,e,a,s,l){if(t){if("circle"===t.type)return T("circle",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",r:t.r,stroke:a.color,"stroke-dasharray":a.dashArray,"stroke-dashoffset":a.dashOffset,"stroke-linecap":a.cap,"stroke-linejoin":a.join,"stroke-miterlimit":"4","stroke-width":a.width});if("ellipse"===t.type)return T("ellipse",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",rx:t.rx,ry:t.ry,stroke:a.color,"stroke-dasharray":a.dashArray,"stroke-linecap":a.cap,"stroke-linejoin":a.join,"stroke-miterlimit":"4","stroke-width":a.width});if("rect"===t.type)return T("rect",{fill:e,"fill-rule":"evenodd",height:t.height,stroke:a.color,"stroke-dasharray":a.dashArray,"stroke-linecap":a.cap,"stroke-linejoin":a.join,"stroke-miterlimit":"4","stroke-width":a.width,width:t.width,x:t.x,y:t.y});if("image"===t.type)return T("image",{alt:l||"image",height:t.height,href:t.src,preserveAspectRatio:"none",width:t.width,x:t.x,y:t.y});if("path"===t.type){const s="string"!=typeof t.path?st(t.path):t.path;return T("path",{d:s,fill:e,"fill-rule":"evenodd",stroke:a.color,"stroke-dasharray":a.dashArray,"stroke-linecap":a.cap,"stroke-linejoin":a.join,"stroke-miterlimit":"4","stroke-width":a.width})}if("text"===t.type)return x(s),T("text",{"dominant-baseline":s.dominantBaseline,fill:e,"fill-rule":"evenodd","font-family":s.font.family,"font-size":s.font.size,"font-style":s.font.style,"font-variant":s.font.variant,"font-weight":s.font.weight,kerning:s.kerning,rotate:s.rotate,stroke:a.color,"stroke-dasharray":a.dashArray,"stroke-linecap":a.cap,"stroke-linejoin":a.join,"stroke-miterlimit":"4","stroke-width":a.width,"text-anchor":s.align,"text-decoration":s.decoration,"text-rendering":X,x:t.x,y:t.y},t.text)}return null}function ot(t){const e={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){const a="patternId-"+ ++B;e.fill=`url(#${a})`,e.pattern={id:a,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){const a="linearGradientId-"+ ++G;e.fill=`url(#${a})`,e.linearGradient={id:a,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map((t=>({offset:t.offset,color:t.color&&new b(t.color).toString()})))}}else if(t){const a=new b(t);e.fill=a.toString()}return e}function rt(t){const e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return t&&(null!=t.width&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new b(t.color).toString()),t.dashArray&&(e.dashArray=t.dashArray),t.dashoffset&&(e.dashOffset=t.dashoffset),t.style&&!t.dashArray&&(e.dashArray=a(t).join(",")||"none")),e}function nt(t,e){const a={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(t){const s=t.alignBaseline,l="baseline"===s?"auto":"top"===s?"text-top":"bottom"===s?"hanging":s;a.align=t.align,a.dominantBaseline=l,a.decoration=t.decoration,a.kerning=t.kerning?"auto":"0",a.rotate=t.rotated?"90":"0",x(e),a.font.style=e.style||"normal",a.font.variant=e.variant||"normal",a.font.weight=e.weight||"normal",a.font.size=e.size&&e.size.toString()||"10pt",a.font.family=e.family||"serif"}return a}function it(t){const{pattern:e,linearGradient:a}=t;if(e)return T("pattern",{height:e.height,id:e.id,patternUnits:"userSpaceOnUse",width:e.width,x:e.x,y:e.y},T("image",{height:e.image.height,href:e.image.href,width:e.image.width,x:e.image.x,y:e.image.y}));if(a){const t=a.stops.map(((t,e)=>T("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color})));return T("linearGradient",{gradientUnits:"userSpaceOnUse",id:a.id,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2},t)}return null}function ct(t,e){if(!t||0===t.length)return null;const a=[];for(const e of t){const{shape:t,fill:s,stroke:l,font:o}=e,r=ot(s),n=rt(l),i="text"===t.type?nt(t,o):null,c=lt(t,r.fill,n,i);c&&a.push(c)}return T("mask",{id:e,maskUnits:"userSpaceOnUse"},T("g",null,a))}function ut(t,e,a){return C(t,z(t),[e,a])}function mt(t,e,a,s,l){return $(t,z(t),[e,a]),t[4]=t[4]*e-s*e+s,t[5]=t[5]*a-l*a+l,t}function pt(t,e){J&&"left"in J?(null!=J.left&&J.left>t&&(J.left=t),(null==J.right||J.right<t)&&(J.right=t),(null==J.top||J.top>e)&&(J.top=e),(null==J.bottom||J.bottom<e)&&(J.bottom=e)):J={left:t,bottom:e,right:t,top:e}}function ht(t){const e=t.args,a=e.length;let s;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(s=0;s<a;s+=2)pt(e[s],e[s+1]);K.x=e[a-2],K.y=e[a-1];break;case"H":for(s=0;s<a;++s)pt(e[s],K.y);K.x=e[a-1];break;case"V":for(s=0;s<a;++s)pt(K.x,e[s]);K.y=e[a-1];break;case"m":{let t=0;"x"in K||(pt(K.x=e[0],K.y=e[1]),t=2);for(s=t;s<a;s+=2)pt(K.x+=e[s],K.y+=e[s+1]);break}case"l":case"t":for(s=0;s<a;s+=2)pt(K.x+=e[s],K.y+=e[s+1]);break;case"h":for(s=0;s<a;++s)pt(K.x+=e[s],K.y);break;case"v":for(s=0;s<a;++s)pt(K.x,K.y+=e[s]);break;case"c":for(s=0;s<a;s+=6)pt(K.x+e[s],K.y+e[s+1]),pt(K.x+e[s+2],K.y+e[s+3]),pt(K.x+=e[s+4],K.y+=e[s+5]);break;case"s":case"q":for(s=0;s<a;s+=4)pt(K.x+e[s],K.y+e[s+1]),pt(K.x+=e[s+2],K.y+=e[s+3]);break;case"A":for(s=0;s<a;s+=7)pt(e[s+5],e[s+6]);K.x=e[a-2],K.y=e[a-1];break;case"a":for(s=0;s<a;s+=7)pt(K.x+=e[s+5],K.y+=e[s+6])}}function dt(t,e,a){const s=Y[t.toLowerCase()];let l;"number"==typeof s&&(s?e.length>=s&&(l={action:t,args:e.slice(0,e.length-e.length%s)},a.push(l),ht(l)):(l={action:t,args:[]},a.push(l),ht(l)))}function yt(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const a=function(t){const e=("string"!=typeof t.path?st(t.path):t.path).match(Q),a=[];if(J={},K={},!e)return null;let s="",l=[];const o=e.length;for(let t=0;t<o;++t){const o=e[t],r=parseFloat(o);isNaN(r)?(s&&dt(s,l,a),l=[],s=o):l.push(r)}dt(s,l,a);const r={x:0,y:0,width:0,height:0};return J&&"left"in J&&(r.x=J.left,r.y=J.top,r.width=J.right-J.left,r.height=J.bottom-J.top),r}(t);e.x=a.x,e.y=a.y,e.width=a.width,e.height=a.height}return e}function ft(t){const e={x:0,y:0,width:0,height:0};let a=null,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(const o of t)a?(a.x=Math.min(a.x,o.x),a.y=Math.min(a.y,o.y),s=Math.max(s,o.x+o.width),l=Math.max(l,o.y+o.height)):(a=e,a.x=o.x,a.y=o.y,s=o.x+o.width,l=o.y+o.height);return a&&(a.width=s-a.x,a.height=l-a.y),a}function bt(t,e,a,s,l,o,r,n,i){let c=(r&&o?at(o,e):e)/2,u=(r&&o?at(o,a):a)/2;if(i){const t=i[0],e=i[1];c=(r&&o?at(o,t):t)/2,u=(r&&o?at(o,e):e)/2}const m=t.width+s,p=t.height+s,h=M(),d=M();let y=!1;if(l&&0!==m&&0!==p){const t=e!==a?e/a:m/p,s=e>a?e:a;let l=1,o=1;isNaN(s)||(t>1?(l=s/m,o=s/t/p):(o=s/p,l=s*t/m)),S(d,d,mt(h,l,o,c,u)),y=!0}const f=t.x+(m-s)/2,b=t.y+(p-s)/2;if(S(d,d,ut(h,c-f,u-b)),!y&&(m>e||p>a)){const t=m/e>p/a,s=(t?e:a)/(t?m:p);S(d,d,mt(h,s,s,f,b))}return o&&S(d,d,function(t,e,a,s){const l=e%360*Math.PI/180;U(t,z(t),l);const o=Math.cos(l),r=Math.sin(l),n=t[4],i=t[5];return t[4]=n*o-i*r+s*r-a*o+a,t[5]=i*o+n*r-a*r-s*o+s,t}(h,o,f,b)),n&&S(d,d,ut(h,n[0],n[1])),`matrix(${d[0]},${d[1]},${d[2]},${d[3]},${d[4]},${d[5]})`}function Lt(t,e,a,s={}){const l=[],o=[],r=++et,n=function(t,e,a){const s=t?.effects.find((t=>"bloom"===t.type));if(!s)return null;const{strength:l,radius:o}=s,r=l>0?o:0,n=(l+r)*e,i=4*l+1;return T("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${a}`,width:"300%",x:"-100%",y:"-100%"},T("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(l+.5*r)*(5**(e/100)*(.4+e/100)),result:"dilate"}),T("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:n/25}),T("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:n/50}),T("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},T("feFuncR",{slope:i,type:"linear"}),T("feFuncG",{slope:i,type:"linear"}),T("feFuncB",{slope:i,type:"linear"})),T("feMerge",null,T("feMergeNode",{in:"intensityBlur"}),T("feMergeNode",{in:"intensityBrightness"}),T("feGaussianBlur",{stdDeviation:l/10})))}(s.effectView,e,r);let i=null;if(n){const t=s.effectView?.effects.find((t=>"bloom"===t.type)),l=(t.strength?t.strength+t.radius/2:0)/3,o=e+e*l,r=a+a*l;i=[Math.max(o,10),Math.max(r,10)]}for(let r=0;r<t.length;r++){const n=t[r],c=[],u=[];let m=0,p=0,h=0;for(const t of n){const{shape:e,fill:a,stroke:o,font:r,offset:n}=t;s.ignoreStrokeWidth||"text"===e.type||(m+=o?.width||0);const i=ot(a),d=rt(o),y="text"===e.type?nt(e,r):null;l.push(it(i)),c.push(lt(e,i.fill,d,y,s.ariaLabel)),u.push(yt(e)),n&&(p+=n[0],h+=n[1])}const d=bt(ft(u),e,a,m,s.scale??!1,s.rotation,s.useRotationSize??!1,[p,h],i);let y=null;if(s.masking){const t=`mask-${r}`,e=s.masking[r];l.push(ct(e,t)),y=`url(#${t})`}o.push(y?T("g",{mask:y},T("g",{transform:d},c)):T("g",{transform:d},c))}return s.useRotationSize&&s.rotation&&(e=at(s.rotation,e),a=at(s.rotation,a)),n&&(x(i),e=i[0],a=i[1]),T("svg",{"aria-labelledby":s.ariaLabel,focusable:!1,height:a,role:"img",style:"display: block;",width:e,xmlns:W},n,T("defs",null,l),n?T("g",{filter:`url(#bloom${r})`},o):o)}const gt=w();function kt(t,e){gt.append(t,e),gt.detach(e)}function vt(t,e,a){const l=Math.ceil(e[0]),o=Math.ceil(e[1]);if(!t.some((t=>!!t.length)))return null;const r=a?.node||document.createElement("div");return null!=a.opacity&&(r.style.opacity=a.opacity.toString()),null!=a.effectView&&(r.style.filter=s(a.effectView)),kt(r,(()=>Lt(t,l,o,a))),r}function jt(t,e,a,s,l){switch(l){case"multiply":t[e]*=a[0],t[e+1]*=a[1],t[e+2]*=a[2],t[e+3]*=a[3];break;default:{const l=k({r:t[e],g:t[e+1],b:t[e+2]});l.h=s.h,l.s=s.s,l.v=l.v/100*s.v;const o=v(l);t[e]=o.r,t[e+1]=o.g,t[e+2]=o.b,t[e+3]*=a[3];break}}}const wt="esri-relationship-ramp",xt=`${wt}--diamond`,Mt=`${wt}--square`,St="http://www.w3.org/2000/svg",Ct={diamondContainer:`${xt}__container`,diamondLeftCol:`${xt}__left-column`,diamondRightCol:`${xt}__right-column`,diamondMidCol:`${xt}__middle-column`,diamondMidColLabel:`${xt}__middle-column--label`,diamondMidColRamp:`${xt}__middle-column--ramp`,squareTable:`${Mt}__table`,squareTableRow:`${Mt}__table-row`,squareTableCell:`${Mt}__table-cell`,squareTableLabel:`${Mt}__table-label`,squareTableLabelLeftBottom:`${Mt}__table-label--left-bottom`,squareTableLabelRightBottom:`${Mt}__table-label--right-bottom`,squareTableLabelLeftTop:`${Mt}__table-label--left-top`,squareTableLabelRightTop:`${Mt}__table-label--right-top`};function zt(t,e,a={}){const{focus:l,labels:o}=t,r=!!l,n=function(t,e,a={}){const{focus:l,numClasses:o,colors:r,rotation:n}=t,{opacity:i,effectList:c,ariaLabel:u}=a,m=a.size??60,p=!!l,h=Math.sqrt(m**2+m**2)+(p?0:5),d=[],y=[],f=[],b=(m||75)/o;for(let t=0;t<o;t++){const e=t*b;for(let a=0;a<o;a++){const s=a*b,l=ot(r[t][a]),o=rt(null),n={type:"rect",x:s,y:e,width:b,height:b},i=it(l);i&&d.push(i);const c=lt(n,l.fill,o,null);c&&y.push(c),f.push(yt(n))}}let L=null;p||(L="margin: -15px -15px -18px -15px");const g=$t("left",l,e),k=$t("right",l,e),v=ft(f),j=bt(v,h,h,0,!1,n,!1),w=bt(v,h,h,0,!1,p?-45:null,!1),x={filter:s(c)??void 0,opacity:null==i?"":`${i}`};return T("div",{class:p?Ct.diamondMidColRamp:Ct.squareTableCell,styles:x},T("svg",{"aria-labelledBy":u,focusable:!1,height:h,role:"image",style:L,width:h,xmlns:St},T("defs",null,T("marker",{id:`${e}_arrowStart`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"5",refY:"5"},T("polyline",{fill:"none",points:"0,0 5,5 0,10",stroke:"#555555","stroke-width":"1"})),T("marker",{id:`${e}_arrowEnd`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"0",refY:"5"},T("polyline",{fill:"none",points:"5,0 0,5 5,10",stroke:"#555555","stroke-width":"1"})),d),T("g",{transform:j},y),T("g",{transform:w},T("line",{fill:"none","marker-end":g.markerEnd,"marker-start":g.markerStart,stroke:"#555555","stroke-width":"1",x1:-10,x2:-10,y1:m-15,y2:15}),T("line",{fill:"none","marker-end":k.markerEnd,"marker-start":k.markerStart,stroke:"#555555","stroke-width":"1",x1:15,x2:m-15,y1:m+10,y2:m+10}))))}(t,e,a),i=Z();return r?T("div",{class:Ct.diamondContainer,styles:{justifyContent:"center"}},T("div",{class:Ct.diamondLeftCol},i?o.right:o.left),T("div",{class:Ct.diamondMidCol},T("div",{class:Ct.diamondMidColLabel},o.top),n,T("div",{class:Ct.diamondMidColLabel},o.bottom)),T("div",{class:Ct.diamondRightCol},i?o.left:o.right)):T("div",{class:Ct.squareTable},T("div",{class:Ct.squareTableRow},T("div",{class:D(Ct.squareTableCell,Ct.squareTableLabel,Ct.squareTableLabelRightBottom)},i?o.top:o.left),T("div",{class:Ct.squareTableCell}),T("div",{class:D(Ct.squareTableCell,Ct.squareTableLabel,Ct.squareTableLabelLeftBottom)},i?o.left:o.top)),T("div",{class:Ct.squareTableRow},T("div",{class:Ct.squareTableCell}),n,T("div",{class:Ct.squareTableCell})),T("div",{class:Ct.squareTableRow},T("div",{class:D(Ct.squareTableCell,Ct.squareTableLabel,Ct.squareTableLabelRightTop)},i?o.right:o.bottom),T("div",{class:Ct.squareTableCell}),T("div",{class:D(Ct.squareTableCell,Ct.squareTableLabel,Ct.squareTableLabelLeftTop)},i?o.bottom:o.right)))}function $t(t,e,a){const s=`${a}_arrowStart`,l=`${a}_arrowEnd`,o="left"===t,r={markerStart:null,markerEnd:null};switch(e){case"HL":o?r.markerStart=`url(#${l})`:r.markerEnd=`url(#${s})`;break;case"LL":r.markerStart=`url(#${l})`;break;case"LH":o?r.markerEnd=`url(#${s})`:r.markerStart=`url(#${l})`;break;default:r.markerEnd=`url(#${s})`}return r}const Ut=V.size,Zt=V.maxSize,Dt=V.maxOutlineSize,Tt=V.lineWidth,qt=V.tallSymbolWidth;function Ht(t){const e=t.outline,a=null!=t.material?t.material.color:null,s=null!=a?a.toHex():null;if(null==e||"pattern"in e&&null!=e.pattern&&"style"===e.pattern.type&&"none"===e.pattern.style)return"fill"===t.type&&"#ffffff"===s?{color:"#bdc3c7",width:.75}:null;const l=R(e.size)||0;return{color:"rgba("+(null!=e.color?e.color.toRgba():"255,255,255,1")+")",width:Math.min(l,Dt),style:"pattern"in e&&null!=e.pattern&&"style"===e.pattern.type?o(e.pattern.style):null,join:"butt",cap:"patternCap"in e?e.patternCap:"butt"}}function Rt(t,e=1){const a=t.a,s=k(t),l=s.h,o=s.s/e,r=100-(100-s.v)/e,{r:n,g:i,b:c}=v({h:l,s:o,v:r});return[n,i,c,a]}function _t(t){return"water"===t.type?null==t.color?null:t.color:null==t.material?.color?null:t.material.color}function Pt(t,e=0){const a=_t(t);if(!a){if("fill"===t.type)return null;const a=A(n.r,e);return[a,a,a,100]}const s=a.toRgba();for(let t=0;t<3;t++)s[t]=A(s[t],e);return s}async function Et(t,e){const a=t.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:await i(q(`esri/symbols/patterns/${a}.png`),e.toCss(!0)),width:5,height:5}}function Vt(t){return t.outline?Ht(t):{color:"rgba(0, 0, 0, 1)",width:1.5}}function It(t,e){const a=_t(t);if(!a)return null;let s="rgba(";return s+=A(a.r,e)+",",s+=A(a.g,e)+",",s+=A(a.b,e)+",",s+a.a+");"}function Ot(t,e){const a=It(t,e);return a?"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style?null:{color:a,width:Math.min(t.size?R(t.size):.75,Dt),style:"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type?o(t.pattern.style):null,cap:"cap"in t?t.cap:null,join:"join"in t?"miter"===t.join?R(2):t.join:null}:{}}function At(t,e,a){const s=null!=a?.75*a:0;return{type:"linear",x1:s?.25*s:0,y1:s?.5*s:0,x2:s||4,y2:s?.5*s:4,colors:[{color:t,offset:0},{color:e,offset:1}]}}function Ft(t){const e="number"==typeof t?.size?t?.size:null;return e?R(e):null}const Wt=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:Et,getSizeFromOptions:Ft,getSymbolLayerFill:Pt,previewSymbol3D:function(e,a){if(0===e.symbolLayers.length)return Promise.reject(new j("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return async function(e,a){const s=Ft(a),l=a?.maxSize?R(a.maxSize):null,o=a?.disableUpsampling??!1,n=e.symbolLayers,i=[];let c=0,u=0;const m=n.at(-1);let p;m&&"icon"===m.type&&(p=m.size&&R(m.size)),n.forEach((n=>{if("icon"!==n.type&&"object"!==n.type)return;const m="icon"===n.type?n.size&&R(n.size):0,h=s||m?Math.ceil(Math.min(s||m,l||Zt)):Ut;if(n?.resource?.href){const a=async function(t,e){if(t.thumbnail?.url)return t.thumbnail.url;if("icon"===e.type){const t=e?.resource?.href;if(t)return r(e)}const a=q("esri/images/Legend/legend3dsymboldefault.png");if(t.styleOrigin&&(t.styleOrigin.styleName||t.styleOrigin.styleUrl)){const e=await E(t.styleOrigin,{portal:t.styleOrigin.portal},"webRef").catch((()=>null));if(e&&"thumbnail"in e&&e.thumbnail?.url)return e.thumbnail.url}return a}(e,n).then((e=>{const a=n?.material?.color,s=function(t){return"icon"===t.type?"multiply":"tint"}(n);return function(e,a,s,l,o){return function(t,e,a){return t?g(t,{responseType:"image"}).then((t=>{const s=t.data,l=s.width,o=s.height,r=l/o;let n=e;if(a){const t=Math.max(l,o);n=Math.min(n,t)}return{image:s,width:r<=1?Math.ceil(n*r):n,height:r<=1?n:Math.ceil(n/r)}})):Promise.reject(new j("renderUtils: imageDataSize","href not provided."))}(e,a,o).then((o=>{const r=o.width??a,n=o.height??a;if(o.image&&function(t,e){return!(!t||"ignore"===e||"multiply"===e&&255===t.r&&255===t.g&&255===t.b&&1===t.a)}(s,l)){let a=o.image.width,i=o.image.height;t("edge")&&/\.svg$/i.test(e)&&(a-=1,i-=1);const c=function(t,e){t=Math.ceil(t),e=Math.ceil(e);const a=document.createElement("canvas");a.width=t,a.height=e,a.style.width=t+"px",a.style.height=e+"px";const s=a.getContext("2d");return s.clearRect(0,0,t,e),s}(r,n);c.drawImage(o.image,0,0,a,i,0,0,r,n);const u=c.getImageData(0,0,r,n),m=[s.r/255,s.g/255,s.b/255,s.a],p=k(s);for(let t=0;t<u.data.length;t+=4)jt(u.data,t,m,p,l);c.putImageData(u,0,0),e=c.canvas.toDataURL("image/png")}else{const t=L?.findCredential(e);if(t?.token){const a=e.includes("?")?"&":"?";e=`${e}${a}token=${t.token}`}}return{url:e,width:r,height:n}})).catch((()=>({url:e,width:a,height:a})))}(e,h,a,s,o)})).then((t=>{const e=t.width,a=t.height;return c=Math.max(c,e),u=Math.max(u,a),[{shape:{type:"image",x:0,y:0,width:e,height:a,src:t.url},fill:null,stroke:null}]}));i.push(a)}else{let t=h;"icon"===n.type&&p&&s&&(t=h*(m/p));const e="tall"===a?.symbolConfig||a?.symbolConfig?.isTall||"object"===n.type&&function(t){const e=t.depth,a=t.height,s=t.width;return 0!==s&&0!==e&&0!==a&&s===e&&null!=s&&null!=a&&s<a}(n);c=Math.max(c,e?qt:t),u=Math.max(u,t),i.push(Promise.resolve(function(t,e,a){const s=[];if(!t)return s;switch(t.type){case"icon":{const a=0,l=0,o=e,r=e;switch(t.resource&&t.resource.primitive||_){case"circle":s.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:Pt(t,0),stroke:Ht(t)});break;case"square":s.push({shape:{type:"path",path:[{command:"M",values:[a,r]},{command:"L",values:[a,l]},{command:"L",values:[o,l]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:Pt(t,0),stroke:Ht(t)});break;case"triangle":s.push({shape:{type:"path",path:[{command:"M",values:[a,r]},{command:"L",values:[.5*o,l]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:Pt(t,0),stroke:Ht(t)});break;case"cross":s.push({shape:{type:"path",path:[{command:"M",values:[.5*o,l]},{command:"L",values:[.5*o,r]},{command:"M",values:[a,.5*r]},{command:"L",values:[o,.5*r]}]},stroke:Vt(t)});break;case"x":s.push({shape:{type:"path",path:[{command:"M",values:[a,l]},{command:"L",values:[o,r]},{command:"M",values:[o,l]},{command:"L",values:[a,r]}]},stroke:Vt(t)});break;case"kite":s.push({shape:{type:"path",path:[{command:"M",values:[a,.5*r]},{command:"L",values:[.5*o,l]},{command:"L",values:[o,.5*r]},{command:"L",values:[.5*o,r]},{command:"Z",values:[]}]},fill:Pt(t,0),stroke:Ht(t)})}break}case"object":switch(t.resource&&t.resource.primitive||P){case"cone":{const l=At(Pt(t,0),Pt(t,-.6),a?qt:e),o=function(t,e){let a=e?V.tallSymbolWidth:t;const s=t,l=e?4:6;a<=V.size?a-=.5*l:a-=l;const o=.15*a,r=s-o;return[{type:"ellipse",cx:.5*a,cy:r,rx:.5*a,ry:o},{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,r]},{command:"L",values:[0,r]},{command:"Z",values:[]}]}]}(e,a);s.push({shape:o[0],fill:l},{shape:o[1],fill:l});break}case"inverted-cone":{const a=Pt(t,0),l=At(a,Pt(t,-.6),e),o=function(t){let e=t;const a=t;e<V.size?e-=3:e-=6;const s=.15*e;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[.5*e,a-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:0,rx:.5*e,ry:s}]}(e);s.push({shape:o[0],fill:l},{shape:o[1],fill:a});break}case"cube":{const l=function(t,e){let a=e?V.tallSymbolWidth:t;const s=t,l=e?4:6;a<=V.size?a-=.5*l:a-=l;const o=e?.35*a:.5*a;return[{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,.5*o]},{command:"L",values:[.5*a,o]},{command:"L",values:[0,.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*a,o]},{command:"L",values:[.5*a,s]},{command:"L",values:[0,s-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*a,o]},{command:"L",values:[.5*a,s]},{command:"L",values:[a,s-.5*o]},{command:"L",values:[a,.5*o]},{command:"Z",values:[]}]}]}(e,a);s.push({shape:l[0],fill:Pt(t,0)},{shape:l[1],fill:Pt(t,-.3)},{shape:l[2],fill:Pt(t,-.5)});break}case"cylinder":{const l=At(Pt(t,0),Pt(t,-.6),a?qt:e),o=function(t,e){let a=e?V.tallSymbolWidth:t;const s=t,l=e?4:6;a<=V.size?a-=.5*l:a-=l;const o=.5*a,r=.15*a,n=s-r;return[{type:"ellipse",cx:.5*a,cy:n,rx:o,ry:r},{type:"path",path:[{command:"M",values:[0,r]},{command:"L",values:[0,n]},{command:"L",values:[a,n]},{command:"L",values:[a,r]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*a,cy:r,rx:o,ry:r}]}(e,a);s.push({shape:o[0],fill:l},{shape:o[1],fill:l},{shape:o[2],fill:Pt(t,0)});break}case"diamond":{const a=function(t){let e=t;const a=t;e<V.size?e-=2:e-=4;const s=e,l=a,o=Math.floor(t/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*s,0]},{command:"L",values:[s,.5*l-o]},{command:"L",values:[.45*s-o,.5*l+o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*s,0]},{command:"L",values:[.45*s-o,.5*l+o]},{command:"L",values:[0,.5*l-o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*l-o]},{command:"L",values:[.45*s-o,.5*l+o]},{command:"L",values:[.45*s,a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*s,a]},{command:"L",values:[s,.5*l-o]},{command:"L",values:[.45*s-o,.5*l+o]},{command:"Z",values:[]}]}]}(e);s.push({shape:a[0],fill:Pt(t,-.3)},{shape:a[1],fill:Pt(t,0)},{shape:a[2],fill:Pt(t,-.3)},{shape:a[3],fill:Pt(t,-.7)});break}case"sphere":{const a=At(Pt(t,0),Pt(t,-.6));a.x1=0,a.y1=0,a.x2=.25*e,a.y2=.25*e,s.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:a});break}case"tetrahedron":{const a=function(t){const e=t;let a=t;return a<V.size?a-=1:a-=2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,a]},{command:"L",values:[.45*e,.6*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.45*e,.6*a]},{command:"L",values:[e,a]},{command:"Z",values:[]}]}]}(e);s.push({shape:a[0],fill:Pt(t,-.3)},{shape:a[1],fill:Pt(t,0)},{shape:a[2],fill:Pt(t,-.6)});break}}}return s}(n,t,e)))}}));const h=await Promise.allSettled(i),d=[];return h.forEach((t=>{"fulfilled"===t.status?d.push(t.value):t.reason&&H.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",t.reason)})),vt(d,[c,u],{node:a?.node,scale:!1,opacity:a?.opacity,ariaLabel:a?.ariaLabel})}(e,a);case"line-3d":return function(t,e){const a=t.symbolLayers,s=[],o=l(t),r=Ft(e),n=(e?.maxSize?R(e.maxSize):null)||Dt;let i,c=0,u=0;return a.forEach(((t,e)=>{if(!t)return;if("line"!==t.type&&"path"!==t.type)return;const a=[];switch(t.type){case"line":{const s=Ot(t,0);if(null==s)break;const l=s?.width||0;0===e&&(i=l);const o=Math.min(r||l,n),m=0===e?o:r?o*(l/i):o,p=m>Tt/2?2*m:Tt;u=Math.max(u,m),c=Math.max(c,p),s.width=m,a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[c,.5*u]}]},stroke:s});break}case"path":{const e=Math.min(r||Ut,n),s=Pt(t,0),l=Pt(t,-.2),o=It(t,-.4),i=o?{color:o,width:1}:{};if("quad"===t.profile){const e=t.width,o=t.height,r=function(t,e,a){const s=V.size;let l=s,o=s;t<1?l*=.75:t>1&&(o*=1.25);let r=s,n=s;return e&&a&&(l=o=r=n=0),[{type:"path",path:[{command:"M",values:[r,0]},{command:"L",values:[a?r:.875*r,0]},{command:"L",values:[a?l-.5*r:0,o-.5*n]},{command:"L",values:[l-.5*r,o-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[r,0]},{command:"L",values:[r,e?0:.125*n]},{command:"L",values:[l-.5*r,e?o-.5*n:n]},{command:"L",values:[l-.5*r,o-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l-.5*r,o-.5*n]},{command:"L",values:[a?l-.5*r:0,o-.5*n]},{command:"L",values:[a?l-.5*r:0,e?o-.5*n:n]},{command:"L",values:[l-.5*r,e?o-.5*n:n]},{command:"Z",values:[]}]}]}(e&&o?e/o:1,0===o,0===e),n={...i,join:"bevel"};a.push({shape:r[0],fill:l,stroke:n},{shape:r[1],fill:l,stroke:n},{shape:r[2],fill:s,stroke:n})}else a.push({shape:I.pathSymbol3DLayer[0],fill:l,stroke:i},{shape:I.pathSymbol3DLayer[1],fill:s,stroke:i});u=Math.max(u,e),c=u}}s.push(a)})),Promise.resolve(vt(s,[c,u],{node:e?.node,scale:o,opacity:e?.opacity,ariaLabel:e?.ariaLabel}))}(e,a);case"polygon-3d":case"mesh-3d":return async function(t,e){const a="mesh-3d"===t.type,s=t.symbolLayers,l=Ft(e),o=e?.maxSize?R(e.maxSize):null,r=l||Ut,n=[];let i=0,c=0,u=!1;for(let t=0;t<s.length;t++){const e=s.at(t),l=[];if(!a||"fill"===e.type){switch(e.type){case"fill":{const t=Math.min(r,o||Zt);if(i=Math.max(i,t),c=Math.max(c,t),u=!0,a){const t=I.meshSymbol3DFill,a=It(e,-.4),s=a?{color:a,width:1,join:"round"}:{};l.push({shape:t[0],fill:Pt(e,0),stroke:s},{shape:t[1],fill:Pt(e,-.2),stroke:s},{shape:t[2],fill:Pt(e,-.6),stroke:s})}else{let t=Pt(e,0);const a="pattern"in e?e.pattern:null,s=Ht(e),o=_t(e);null!=a&&"style"===a.type&&"solid"!==a.style&&o&&(t=await Et(a,o)),l.push({shape:I.fill[0],fill:t,stroke:s})}break}case"line":{const t=Ot(e,0);if(null==t)break;const a={stroke:t,shape:I.fill[0]};i=Math.max(i,Ut),c=Math.max(c,Ut),l.push(a);break}case"extrude":{const t={join:"round",width:1,...Ot(e,-.4)},a=Pt(e,0),s=Pt(e,-.2),n=Math.min(r,o||Zt),u=O(n);t.width=1,l.push({shape:u[0],fill:s,stroke:t},{shape:u[1],fill:s,stroke:t},{shape:u[2],fill:a,stroke:t});const m=Ut,p=.7*Ut+.5*n;i=Math.max(i,m),c=Math.max(c,p);break}case"water":{const t=_t(e),a=Rt(t),s=Rt(t,2),n=Rt(t,3),m=[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}];u=!0,l.push({shape:m[0],fill:a},{shape:m[1],fill:s},{shape:m[2],fill:n});const p=Math.min(r,o||Zt);i=Math.max(i,p),c=Math.max(c,p);break}}n.push(l)}}return vt(n,[i,c],{node:e?.node,scale:u,opacity:e?.opacity,ariaLabel:e?.ariaLabel})}(e,a)}return Promise.reject(new j("symbolPreview: swatchInfo3D","symbol not supported."))}},Symbol.toStringTag,{value:"Module"})),Bt={HH:315,HL:45,LL:135,LH:225},Gt={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function Nt(t){if(!t)return;const{type:e}=t;if(e.includes("3d"))return Pt(t.symbolLayers.at(0));if("simple-line"===e){const e=c(t);return e&&e.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const e=c(t);return e&&e.color}return u(t)}function Xt(t){const{focus:e,infos:a,numClasses:s}=t,l=Gt[s],o={};a.forEach((t=>{o[t.value]={label:t.label,fill:Nt(t.symbol)}}));const r=[];for(let t=0;t<s;t++){const e=[];for(let a=0;a<s;a++){const s=o[l[t][a]];e.push(s.fill)}r.push(e)}const n=function(t,e){const a=e.HH.label,s=e.LL.label,l=e.HL.label,o=e.LH.label;switch(t){case"HH":default:return{top:a,bottom:s,left:l,right:o};case"HL":return{top:l,bottom:o,left:s,right:a};case"LL":return{top:s,bottom:a,left:o,right:l};case"LH":return{top:o,bottom:l,left:a,right:s}}}(e,o);return{type:"relationship-ramp",numClasses:s,focus:e,colors:r,labels:n,rotation:Yt(e)}}function Yt(t){let e=Bt[t];return t&&null==e&&(e=Bt.HH),e||0}let Qt=null;const Jt=[255,255,255];function Kt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function te(t,e,a){const{backgroundColor:s,outline:l,dotSize:o}=t,r=a?.swatchSize||V.size,n=Math.round(r*r/Math.max(o,.5)**2*.8),i=window.devicePixelRatio,c=document.createElement("canvas"),u=r*i;c.width=u,c.height=u,c.style.width=c.width/i+"px",c.style.height=c.height/i+"px";const m=c.getContext("2d");if(s&&(m.fillStyle=s.toCss(!0),m.fillRect(0,0,u,u),m.fill()),m.fillStyle=e?.toCss(!0)??"",Qt&&Qt.length/2===n)for(let t=0;t<2*n;t+=2){const e=Qt[t],a=Qt[t+1];m.fillRect(e,a,o*i,o*i),m.fill()}else{Qt=[];for(let t=0;t<2*n;t+=2){const t=Kt(0,u),e=Kt(0,u);Qt.push(t,e),m.fillRect(t,e,o*i,o*i),m.fill()}}l&&(l.color&&(m.strokeStyle=l.color.toCss(!0)),m.lineWidth=l.width,m.strokeRect(0,0,u,u));const p=new Image(r,r);return p.src=c.toDataURL(),p.ariaLabel=a?.ariaLabel??null,p.alt=a?.ariaLabel??"",p}function ee(t,e={}){const a=e.radius||40,s=2*Math.PI*a,l=t.length,o=s/l,r=[],n=c(e.outline);null!=n?.width&&(n.width*=2),(n||e.backgroundColor)&&r.push({shape:{type:"circle",cx:a,cy:a,r:a},fill:e.backgroundColor,stroke:n,offset:[0,0]});const i=e.values,u=i&&i.length===l&&100===i.reduce(((t,e)=>t+e),0),m=[0];for(let e=0;e<l;e++){let l=null;u&&(l=i[e]*s/100,m.push(l+m[e])),r.push({shape:{type:"circle",cx:a,cy:a,r:a/2},fill:[0,0,0,0],stroke:{width:a,dashArray:`${(l??o)/2} ${s}`,dashoffset:"-"+(u?m[e]/2:e*(o/2)),color:t[e]},offset:[0,0]})}let p=null;const h=2*a+(n?.width||0),d=e.holePercentage;if(d){n&&r.push({shape:{type:"circle",cx:a,cy:a,r:a*d},fill:null,stroke:n,offset:[0,0]});const t=h/2;p=[[{shape:{type:"circle",cx:t,cy:t,r:t},fill:Jt,stroke:n?{...n,color:Jt}:null,offset:[0,0]},{shape:{type:"circle",cx:t,cy:t,r:a*d},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return vt([r],[h,h],{effectView:e.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90,ariaLabel:e.ariaLabel})}function ae(t,e={}){const a=t?.authoringInfo;if("relationship"!==a?.type||!a?.numClasses||!t.uniqueValueInfos)return null;const{focus:s,numClasses:l}=a,o=Xt({focus:s,numClasses:l,infos:t.uniqueValueInfos}),r=e?.node||document.createElement("div");return kt(r,(()=>zt(o,e.id||"relationship",{opacity:e.opacity||1,effectList:e.effectList,ariaLabel:e.ariaLabel}))),r}function se(t,e={}){const a="horizontal"===e.align,l=a?75:24,o=a?24:75,r=e.width??l,n=e.height??o,i=e.gradient??!0,c=window.devicePixelRatio,u=r*c,m=n*c,p=document.createElement("canvas");p.width=u,p.height=m,p.ariaLabel=e.ariaLabel??null,p.style.width=`${r}px`,p.style.height=`${n}px`;const h=p.getContext("2d"),d=a?u:0,y=a?0:m;if(i){const e=h.createLinearGradient(0,0,d,y),a=t.length,s=1===a?0:1/(a-1);t.forEach(((t,a)=>e.addColorStop(a*s,t.toString()))),h.fillStyle=e,h.fillRect(0,0,u,m)}else{const e=a?u/t.length:u,s=a?m:m/t.length;let l=0,o=0;for(const r of t)h.fillStyle=r.toString(),h.fillRect(l,o,e,s),l=a?l+e:0,o=a?0:o+s}const f=document.createElement("div");return f.style.width=`${r}px`,f.style.height=`${n}px`,function(t,e){if(!e)return;t.style.filter=s(e);const a=e.effects;if(a)for(const e of a)if("drop-shadow"===e?.type){e.offsetX<0?t.style.marginLeft=`${Math.abs(e.offsetX)}px`:t.style.marginRight=`${e.offsetX}px`;break}}(f,e?.effectList),f.appendChild(p),f}async function le(t,e){switch(t.type){case"web-style":{const{previewWebStyleSymbol:a}=await import("../../chunks/previewWebStyleSymbol.js");return a(t,le,e)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:a}=await Promise.resolve().then((()=>Wt));return a(t,e)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:a}=await import("../../chunks/previewSymbol2D.js");return a(t,e)}case"cim":{const{previewCIMSymbol:a}=await import("../../chunks/previewCIMSymbol.js");return a(t,e)}default:return}}function oe(t){return t&&"opacity"in t?t.opacity*oe(t.parent):1}async function re(t,a){if(!t)return;const s=t.sourceLayer,l=(null!=a&&a.useSourceLayer?s:t.layer)??s,o=oe(l);if(null!=t.symbol&&(null==a||!0!==a.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await m(t.symbol,{...a,cache:null!=a?a.webStyleCache:null}):t.symbol.clone();return p(e,null,o),e}const r=(null!=a?a.renderer:null)??(l&&"renderer"in l?l.renderer:null);let n=r&&"getSymbolAsync"in r?await r.getSymbolAsync(t,a):null;if(!n)return;if(n="web-style"===n.type?await n.fetchSymbol({...a,cache:null!=a?a.webStyleCache:null}):n.clone(),!r||!("visualVariables"in r)||!r.visualVariables?.length)return p(n,null,o),n;if("arcadeRequiredForVisualVariables"in r&&r.arcadeRequiredForVisualVariables&&null==a?.arcade){const t={...a};t.arcade=await e(),a=t}const{getColor:i,getOpacity:c,getAllSizes:u,getRotationAngle:y}=await import("../../chunks/visualVariableUtils.js"),f=[],b=[],L=[],g=[];for(const t of r.visualVariables)switch(t.type){case"color":f.push(t);break;case"opacity":b.push(t);break;case"rotation":g.push(t);break;case"size":t.target||L.push(t)}const k=!!f.length&&f[f.length-1],v=k?i(k,t,a):null,j=!!b.length&&b[b.length-1];let w=j?c(j,t,a):null;if(null!=o&&(w=null!=w?w*o:o),p(n,v,w),L.length){const e=u(L,t,a);await h(n,e)}for(const e of g)d(n,y(e,t,a),e.axis);return n}async function ne(t,a){if(!t)return;const s=t.layer,l=t.sourceLayer,o=oe(s??l);if(null!=t.symbol&&(null==a||!0!==a.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await m(t.symbol,a):t.symbol.clone();return y(e,o)}const r=a?.renderer||(s&&"renderer"in s?s.renderer:void 0)||(l&&"renderer"in l?l.renderer:void 0);let n=r&&"getSymbolAsync"in r?await r.getSymbolAsync(t,a):void 0;if(!n)return;n="web-style"===n.type?await m(n,a):n.clone();const i=y(n,o);if(!r||!("visualVariables"in r)||"visualVariables"in r&&!r.visualVariables||"visualVariables"in r&&!r.visualVariables?.length)return i;if("arcadeRequiredForVisualVariables"in r&&r.arcadeRequiredForVisualVariables&&null==a?.arcade){const t={...a};t.arcade=await e(),a=t}const{getColor:c,getOpacity:u}=await import("../../chunks/visualVariableUtils.js"),p=[],h=[];for(const t of r.visualVariables)switch(t.type){case"color":p.push(t);break;case"opacity":h.push(t)}const d=p.length>0?p[p.length-1]:null,b=d?c(d,t,a):i,L=h.length>0?h[h.length-1]:null;let g=L?u(L,t,a):null;return null!=o&&(g=null!=g?g*o:o),b?f(b,g):null}export{V as S,F as a,Yt as b,zt as c,Lt as d,Xt as g,ne as getDisplayedColor,re as getDisplayedSymbol,vt as r,se as renderColorRampPreviewHTML,te as renderDotDensityPreviewHTML,ee as renderPieChartPreviewHTML,le as renderPreviewHTML,ae as renderRelationshipRampPreviewHTML,I as s};
