/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import{b as e}from"../../../chunks/maybe.js";import{property as o}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import"../../../chunks/Logger.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import n from"./Column.js";import{a as s}from"../../../chunks/uriUtils.js";import"../../../chunks/ensureType.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/metadata.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/tracking.js";import"../../../core/Evented.js";import"../../../core/Accessor.js";import"../../../core/Handles.js";import"../../../chunks/ObservableBase.js";import"../../../core/scheduling.js";import"../../../core/promiseUtils.js";import"../../../core/reactiveUtils.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"./support/ButtonMenu.js";import"../../Widget.js";import"../../../intl.js";import"../../../chunks/date.js";import"../../../chunks/jsonMap.js";import"../../../chunks/locale.js";import"../../../chunks/timeZoneUtils.js";import"../../../chunks/datetime.js";import"../../../chunks/messages.js";import"../../../request.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../core/JSONSupport.js";import"../../../chunks/assets.js";import"../../../chunks/domUtils.js";import"../../../core/Promise.js";import"../../../chunks/uuid.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../chunks/projector.js";import"../../../chunks/widgetUtils.js";import"../../../chunks/jsxWidgetSupport.js";import"../../../chunks/legacyIcon.js";import"./support/ButtonMenuViewModel.js";import"./support/ButtonMenuItem.js";import"../../../chunks/globalCss.js";import"../../../chunks/jsxFactory.js";const r="esri-editor-column__cell-input",u={input:r,inputContainer:`${r}--container`};let a=class extends n{constructor(t){super(t),this.activeEditInfo=null,this.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,this.editable=!1,this.inputRenderFunction=({root:t,column:e,rowData:o})=>{if(this.activeEditInfo?.updating)return;if(!this.editable)return;const i=this.getCellValue(e,o),n=this.createInputElement({root:t,column:e,rowData:o,value:i});this._set("activeEditInfo",{column:e,input:n,root:t,rowData:o,updating:!0,oldValue:i});const s=this.createInputContainer();s.appendChild(n),this.removeCellContent(t),t.appendChild(s),n.focus(),n instanceof HTMLInputElement&&n.select()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.parseInputValueFunction=({input:t})=>t.value,this.renderFunction=t=>{const{root:e,column:o,rowData:i}=t,{activeEditInfo:n}=this;if(n&&n.updating)return;const r=this.getCellValue(o,i),u=this.cellValueFormatFunction({column:o,rowData:i,value:r});e.onclick=()=>e.focus(),e.ondblclick=()=>this.inputRenderFunction(t),e.ontouchend=()=>this.inputRenderFunction(t);const a=this.grid?.getSlotElementByName(e.slot),c=a?.parentElement;c&&!c.onkeydown&&(c.onkeydown=e=>{"Enter"!==e.key||this.activeEditInfo||this.inputRenderFunction(t),"Escape"===e.key&&this.activeEditInfo&&this.cancel()}),null!=r&&null!=u?e.title=u.toString():e.title&&e.removeAttribute("title");const l=s(this.messagesURIUtils,u);u?.toString()!==e.innerHTML&&l!==e.innerHTML&&(e.innerHTML=l)},this.required=!1,this.store=null,this.updateRowItemFunction=({rowData:t,column:o,value:i})=>{e(t),o.path&&t?.item&&(t.item[o.path]=i)},this.updateStoreItemFunction=async({rowData:t,column:o,value:i})=>{e(t),o.path&&await(this.store?.updateItem({index:t.index,name:o.path,value:i}))}}cancel(){const{activeEditInfo:t}=this;if(!t)return;const{column:e,root:o,rowData:i}=t;this._set("activeEditInfo",null),this.renderFunction({column:e,root:o,rowData:i})}createInputContainer(){const t=document.createElement("div");return t.classList.add(u.inputContainer),t}createInputElement({value:t}){const e=document.createElement("input");return e.classList.add(u.input),null!=this.maxLength&&(e.maxLength=this.maxLength),e.type=this.inputType,e.value=t,e.onblur=()=>{e.onblur=null,this.submit()},e}async submit(){const{activeEditInfo:t}=this;if(!t)return;const{column:e,input:o,root:i,rowData:n,oldValue:r}=t,u=this.parseInputValueFunction({input:o,column:e,rowData:n});if(this.cellValueValidatorFunction({value:u,oldValue:r,column:e,rowData:n})){i.innerHTML=this.loadingMessage;try{await this.updateStoreItemFunction({rowData:n,column:e,value:u}),this.updateRowItemFunction({rowData:n,column:e,value:u});const t=this.getCellValue(e,n),o=this.cellValueFormatFunction({column:e,rowData:n,value:t});null!=t&&null!=o?i.title=o.toString():i.title&&i.removeAttribute("title");const r=s(this.messagesURIUtils,o);i.innerHTML=r,this.emit("value-change",{column:e,rowData:n,value:t}),this._set("activeEditInfo",null)}catch(t){this.cancel()}}else this.cancel()}};t([o({readOnly:!0})],a.prototype,"activeEditInfo",void 0),t([o()],a.prototype,"cellValueValidatorFunction",void 0),t([o()],a.prototype,"editable",void 0),t([o()],a.prototype,"inputRenderFunction",void 0),t([o({constructOnly:!0})],a.prototype,"loadingMessage",void 0),t([o()],a.prototype,"inputType",void 0),t([o()],a.prototype,"maxLength",void 0),t([o()],a.prototype,"parseInputValueFunction",void 0),t([o()],a.prototype,"renderFunction",void 0),t([o()],a.prototype,"required",void 0),t([o()],a.prototype,"store",void 0),t([o()],a.prototype,"updateRowItemFunction",void 0),t([o()],a.prototype,"updateStoreItemFunction",void 0),a=t([i("esri.widgets.FeatureTable.Grid.EditorColumn")],a);const c=a;export{c as default};
