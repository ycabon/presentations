/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import r from"./Widget.js";import a from"./Histogram/HistogramViewModel.js";import{g as n}from"../chunks/globalCss.js";import{l as o}from"../chunks/legacyIcon.js";import{o as l}from"../chunks/widgetUtils.js";import{m as d}from"../chunks/messageBundle.js";import{t as u}from"../chunks/jsxFactory.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/assets.js";import"../chunks/ensureType.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../core/reactiveUtils.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";var h;const c="esri-histogram",p={base:c,widgetIcon:o.edit,horizontalLayout:`${c}--horizontal`,verticalLayout:`${c}--vertical`,content:`${c}__content`,svg:`${c}__svg`,bar:`${c}__bar`,bars:`${c}__bars`,label:`${c}__label`,dataLines:`${c}__data-lines`,dataLinesSubgroup:`${c}__data-lines-subgroup`,dataLine:`${c}__data-line`,averageLabel:`${c}__average-label`,averageDataLine:`${c}__average-data-line`,averageSymbol:`${c}__average-symbol`};let m=h=class extends r{constructor(e,t){super(e,t),this._bgFillId=`${this.id}-bg-fill`,this._containerNode=null,this._containerDimensions={width:0,height:0},this._defaultBarColor="#d8d8d8",this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.messages=null,this.viewModel=new a}get average(){return this.viewModel.average}set average(e){this.viewModel.average=e}get bins(){return this.viewModel.bins}set bins(e){this.viewModel.bins=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}set layout(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get state(){return this.viewModel.state}static fromHistogramResult(e){const{bins:t,maxValue:s,minValue:i}=e;return new h({bins:t,max:s,min:i})}render(){const{label:e,layout:t,state:s}=this,i=this.classes(p.base,n.widget,"horizontal"===t?p.horizontalLayout:p.verticalLayout,"disabled"===s?n.disabled:null);return u("div",{afterCreate:this._afterContainerNodeCreate,"aria-label":e,bind:this,class:i},"ready"===s?this._renderContent():null)}_renderContent(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return u("div",{class:p.content},u("svg",{class:p.svg,xmlns:"http://www.w3.org/2000/svg"},u("defs",null,this._renderFillDefinition(e)),u("g",{style:t},this._renderBarsGroup()),this._renderLinesGroup()))}_renderBarsGroup(){return u("g",{class:this.classes(p.bars)},this._renderBars())}_renderBars(){const{layout:e,viewModel:{binRange:t,range:s}}=this;if(!t||!s)return;const i=t/s,{width:r,height:a}=this._containerDimensions;if(0===a&&0===r)return;if(0===a&&0!==r)return void this.scheduleRender();const[n,o]="vertical"===e?[a*i,r]:[a,r*i];return this._getBarDimensions(n,o).map((([e,t],s)=>this._renderBar(s,e,t)))}_renderBar(e,s,i){const{bins:r,layout:a,max:n,messages:o,viewModel:{range:l}}=this;if(!r||null==n)return;const{width:d,height:h}=this._containerDimensions,c=r.slice()[e],{count:m,maxValue:g,minValue:_}=c,b=n-g,[v,L]="vertical"===a?[0,b*(h/l)]:[d-i-b*(d/l),h-s],j=t(o.barLabel,{count:m,maxValue:g,minValue:_});return u("rect",{afterCreate:this._afterBarCreate,"aria-label":j,bind:this,class:p.bar,"data-index":e,fill:this._defaultBarColor,height:s,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:v,y:L})}_renderLinesGroup(){return u("g",{class:this.classes(p.dataLines)},this._renderAverageLine(),this._renderCustomLines())}_renderAverageLine(){const{average:e}=this;if(null==e)return;const t=[u("tspan",{class:this.classes(p.averageSymbol)},"xÌ„ "),u("tspan",{class:this.classes(p.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return u("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(p.dataLinesSubgroup)},u("title",{key:"title"},e),this._renderLine(e,this.classes(p.averageDataLine)),this._renderLabel({label:t,value:e}))}_renderCustomLines(){if(this.dataLines?.length)return this.dataLines.map(((e,t)=>this._renderLineSubgroup(e,t)))}_renderLineSubgroup(e,t){const{value:s}=e;return u("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(p.dataLinesSubgroup),"data-index":t},u("title",{key:"title"},s),this._renderLine(s),this._renderLabel(e))}_renderLine(e,t){const[s,i,r,a]=this._getLinePosition(e);return u("line",{class:this.classes(p.dataLine,t),"shape-rendering":"crispEdges",x1:s,x2:i,y1:r,y2:a})}_renderLabel(e,t){const{label:s,value:i}=e,[r,a]=this._getLabelPosition(i);return u("text",{class:this.classes(p.label,t),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:a-2},s??"")}_renderFillDefinition(e){const{width:t,height:s}=this._containerDimensions;return u("clipPath",{id:e},u("rect",{height:s,width:t,x:"0",y:"0"}))}_afterContainerNodeCreate(e){this._containerNode=e,this.addHandles(l(e,(e=>{const{width:t,height:s}=e.contentRect;this._containerDimensions={width:t,height:s}})))}_getIndexFromElement(e){const t=e.dataset?.index,s=e.getAttribute("data-index");return null!=t?parseInt(t,10):null!=s?parseInt(s,10):null}_afterBarCreate(e){if(this.barCreatedFunction){const t=this._getIndexFromElement(e)??-1;this.barCreatedFunction(t,e)}}_afterLinesSubgroupCreate(e){if(this.dataLineCreatedFunction){const t=this._getIndexFromElement(e),s=e.childNodes[1],i=e.childNodes[2]?e.childNodes[2]:null;this.dataLineCreatedFunction(s,i,t)}}_afterLinesSubgroupUpdate(e){if(this.dataLineUpdatedFunction){const t=this._getIndexFromElement(e),s=e.childNodes[1],i=e.childNodes[2]?e.childNodes[2]:null;this.dataLineUpdatedFunction(s,i,t)}}_getBarDimensions(e,t){const{bins:s,layout:i}=this,r=s?s.map((e=>e.count)):[],a=Math.max.apply(Math,r);return r.map((s=>"vertical"===i?[e/r.length,0!==a?s/a*t:0]:[0!==a?s/a*e:0,t/r.length]))}_getLinePosition(e){const{layout:t,min:s,viewModel:{range:i}}=this;if(null==s)return[0,0,0,0];const r=Math.round((e-s)/i*100)/100,{width:a,height:n}=this._containerDimensions,[o,l]=[r*a||1,n-r*n||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]}_getLabelPosition(e){const{layout:t,min:s,viewModel:{range:i}}=this;if(null==s)return[0,0];const r=Math.round((e-s)/i*100)/100,{width:a,height:n}=this._containerDimensions;return"vertical"===t?[a,n-r*n]:[0,r*a]}};e([s()],m.prototype,"_bgFillId",void 0),e([s()],m.prototype,"_containerNode",void 0),e([s()],m.prototype,"_containerDimensions",void 0),e([s()],m.prototype,"_defaultBarColor",void 0),e([s()],m.prototype,"average",null),e([s()],m.prototype,"barCreatedFunction",void 0),e([s()],m.prototype,"dataLines",void 0),e([s()],m.prototype,"dataLineCreatedFunction",void 0),e([s()],m.prototype,"dataLineUpdatedFunction",void 0),e([s()],m.prototype,"label",null),e([s()],m.prototype,"labelFormatFunction",null),e([s({value:"horizontal"})],m.prototype,"layout",null),e([s()],m.prototype,"max",null),e([s(),d("esri/widgets/Histogram/t9n/Histogram")],m.prototype,"messages",void 0),e([s()],m.prototype,"min",null),e([s({readOnly:!0})],m.prototype,"state",null),e([s()],m.prototype,"viewModel",void 0),m=h=e([i("esri.widgets.Histogram")],m);const g=m;export{g as default};
