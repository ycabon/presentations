/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import s from"../Color.js";import{watch as e}from"../core/reactiveUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import{I as i}from"../chunks/ensureType.js";import"../core/lang.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import n from"./Histogram.js";import a from"./Slider.js";import l from"./Widget.js";import p from"./HistogramRangeSlider/HistogramRangeSliderViewModel.js";import{getDeviationValues as m}from"./smartMapping/support/utils.js";import{g as u}from"../chunks/globalCss.js";import{l as d}from"../chunks/legacyIcon.js";import"../chunks/widgetUtils.js";import{m as h}from"../chunks/messageBundle.js";import{t as c}from"../chunks/jsxFactory.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/asyncUtils.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/assets.js";import"./Histogram/HistogramViewModel.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"./Slider/SliderViewModel.js";import"../renderers/support/utils.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/numberUtils.js";import"../renderers/visualVariables/support/ColorStop.js";import"../chunks/utils2.js";import"../chunks/basemapUtils.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/Loadable.js";import"../chunks/loadAll.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/persistableUrlUtils.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils2.js";import"../chunks/utils3.js";import"../chunks/screenUtils.js";import"../chunks/mat4.js";import"../chunks/utils9.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/_commonjsHelpers.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils6.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";const j="esri-histogram-range-slider",b={base:j,widgetIcon:d.edit,sliderContainer:`${j}__slider-container`,histogramContainer:`${j}__histogram-container`,rangeTypePrefix:`${j}__range-type--`};let y=class extends l{constructor(t,e){super(t,e),this._barElements=[],this._histogram=null,this._slider=null,this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.excludedBarColor=new s("#d7e5f0"),this.includedBarColor=new s("#599dd4"),this.messages=null,this.standardDeviationCount=1,this.viewModel=new p}initialize(){const{average:t,bins:s,hasTimeData:o,max:i,min:r,viewModel:l}=this;this._updateBarFill=this._updateBarFill.bind(this),this._histogram=new n({average:t,bins:s,barCreatedFunction:(t,s)=>{0===t&&(this._barElements=[]),this._barElements.push(s),this._updateBarFill(t,s),this.barCreatedFunction&&this.barCreatedFunction(t,s)},dataLines:this._getDataLines(),dataLineCreatedFunction:(t,s)=>{this.dataLineCreatedFunction&&this.dataLineCreatedFunction(t,s)},labelFormatFunction:this.labelFormatFunction,layout:"horizontal",max:i,min:r}),this._slider=new a({labelFormatFunction:this.labelFormatFunction,layout:"horizontal",visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!o,viewModel:l}),this.addHandles([this._slider.on("max-change",(t=>this.emit("max-change",t))),this._slider.on("min-change",(t=>this.emit("min-change",t))),this._slider.on("segment-drag",(t=>{this._updateBarFills(),this.emit("segment-drag",t)})),this._slider.on("thumb-change",(t=>{this._updateBarFills(),this.emit("thumb-change",t)})),this._slider.on("thumb-drag",(t=>{this._updateBarFills(),this.emit("thumb-drag",t)})),e((()=>this.bins),(t=>{if(t&&this._histogram.bins){const s=this._histogram.bins.length-t.length;this._barElements.splice(-s,s)}else this._barElements=[];this._histogram.set({bins:t}),this._updateBarFills(),this.scheduleRender()})),e((()=>[this.max,this.min,this.rangeType,this.values]),(([t,s])=>{this._histogram.set({max:t,min:s}),this._updateBarFills(),this.scheduleRender()})),e((()=>[this.average,this.dataLines,this.standardDeviation,this.standardDeviationCount]),(([t])=>{this._histogram.set({average:t,dataLines:this._getDataLines()})})),e((()=>this.labelFormatFunction),(t=>{this._histogram.set({labelFormatFunction:t})})),e((()=>this.hasTimeData),(t=>{this._slider.set({rangeLabelInputsEnabled:!t})}))])}get average(){return this.viewModel.average}set average(t){this.viewModel.average=t}get bins(){return this.viewModel.bins}set bins(t){this.viewModel.bins=t}get hasTimeData(){return this.viewModel.hasTimeData}set hasTimeData(t){this.viewModel.hasTimeData=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(t){this.viewModel.labelFormatFunction=t}get max(){return this.viewModel.max}set max(t){this.viewModel.max=t}get min(){return this.viewModel.min}set min(t){this.viewModel.min=t}get precision(){return this.viewModel.precision}set precision(t){this.viewModel.precision=t}get rangeType(){return this.viewModel.rangeType}set rangeType(t){this.viewModel.rangeType=t}get standardDeviation(){return this.viewModel.standardDeviation}set standardDeviation(t){this.viewModel.standardDeviation=t}get values(){return this.viewModel.values}set values(t){this.viewModel.values=t}generateWhereClause(t){return this.viewModel.generateWhereClause(t)}render(){const{rangeType:t,viewModel:s,label:e}=this,o=this.classes(b.base,u.widget,`${b.rangeTypePrefix}${t}`,"disabled"===s.state?u.disabled:null);return c("div",{"aria-label":e,class:o},"disabled"===s.state?null:this._renderContent())}_renderContent(){return[this._renderHistogram(),this._renderSlider()]}_renderSlider(){return c("div",{class:b.sliderContainer,key:`${this.id}-slider-container`},this._slider.render())}_renderHistogram(){return c("div",{class:b.histogramContainer},this._histogram.render())}_getDataLines(){return[...this._getStandardDeviationDataLines(),...this.dataLines||[]]}_getStandardDeviationDataLines(){const{average:t,standardDeviation:s,standardDeviationCount:e}=this;return m(s,t,e).map((t=>({value:t})))}_updateBarFills(){this._barElements.forEach(((t,s)=>this._updateBarFill(s,t)))}_updateBarFill(t,s){s.setAttribute("fill",this._getFillForBar(t)?.toHex()??"")}_getFillForBar(t){const{bins:s,rangeType:e,values:o}=this;if(-1===t||!s?.length||!e||!o?.length)return null;const i=s[t];if(!i)return null;const{maxValue:r,minValue:n}=i,a=r-n,l=o[0]>n&&o[0]<r;switch(e){case"equal":case"not-equal":return this.includedBarColor;case"less-than":case"at-most":return l?this._getBlendedColor((o[0]-n)/a):r<=o[0]?this.includedBarColor:this.excludedBarColor;case"greater-than":case"at-least":return l?this._getBlendedColor(1-(o[0]-n)/a):n>=o[0]?this.includedBarColor:this.excludedBarColor;case"between":if(2===o.length)return o[0]>n&&o[0]<r?this._getBlendedColor(1-(o[0]-n)/a):o[1]>n&&o[1]<r?this._getBlendedColor((o[1]-n)/a):n>=o[0]&&r<=o[1]?this.includedBarColor:this.excludedBarColor;break;case"not-between":if(2===o.length)return o[0]>n&&o[0]<r?this._getBlendedColor((o[0]-n)/a):o[1]>n&&o[1]<r?this._getBlendedColor(1-(o[1]-n)/a):n>o[0]&&r<o[1]?this.excludedBarColor:this.includedBarColor}return this.includedBarColor}_getBlendedColor(t){return s.blendColors(this.excludedBarColor,this.includedBarColor,t)}};t([o()],y.prototype,"average",null),t([o()],y.prototype,"barCreatedFunction",void 0),t([o()],y.prototype,"bins",null),t([o()],y.prototype,"dataLines",void 0),t([o()],y.prototype,"dataLineCreatedFunction",void 0),t([o({type:s,json:{type:[i],write:!0}})],y.prototype,"excludedBarColor",void 0),t([o()],y.prototype,"hasTimeData",null),t([o({type:s,json:{type:[i],write:!0}})],y.prototype,"includedBarColor",void 0),t([o()],y.prototype,"label",null),t([o()],y.prototype,"labelFormatFunction",null),t([o()],y.prototype,"max",null),t([o(),h("esri/widgets/HistogramRangeSlider/t9n/HistogramRangeSlider")],y.prototype,"messages",void 0),t([o()],y.prototype,"min",null),t([o()],y.prototype,"precision",null),t([o()],y.prototype,"rangeType",null),t([o()],y.prototype,"standardDeviation",null),t([o()],y.prototype,"standardDeviationCount",void 0),t([o()],y.prototype,"values",null),t([o()],y.prototype,"viewModel",void 0),y=t([r("esri.widgets.HistogramRangeSlider")],y);const g=y;export{g as default};
