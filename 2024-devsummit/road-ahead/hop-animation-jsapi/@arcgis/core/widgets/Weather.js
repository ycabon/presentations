/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{m as s}from"../chunks/memoize.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as t}from"../core/accessorSupport/decorators/subclass.js";import{a as r}from"../chunks/weather.js";import i,{l as n}from"./Widget.js";import{g as a}from"../chunks/globalCss.js";import{H as l}from"../chunks/Heading.js";import{c}from"../chunks/widgetUtils.js";import{m as p}from"../chunks/messageBundle.js";import{t as d,a as h}from"../chunks/jsxFactory.js";import{l as u}from"../chunks/legacyIcon.js";import m,{W as g,a as v}from"./Weather/WeatherViewModel.js";import y from"../core/Accessor.js";import"../chunks/ensureType.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../config.js";import"../chunks/tracking.js";import"../views/3d/environment/CloudyWeather.js";import"../core/JSONSupport.js";import"../chunks/enumeration.js";import"../chunks/jsonMap.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/ObservableBase.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../views/3d/environment/FoggyWeather.js";import"../views/3d/environment/RainyWeather.js";import"../views/3d/environment/SnowyWeather.js";import"../views/3d/environment/SunnyWeather.js";import"../intl.js";import"../chunks/date.js";import"../chunks/locale.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../core/reactiveUtils.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";const b="esri-weather",j={base:b,widgetIcon:u.partlyCloudy,content:`${b}__content`,hasError:`${b}__content--has-error`,selector:`${b}__selector`,options:`${b}__options`,optionsHidden:`${b}__options--hidden`,error:`${b}__error`,warning:`${b}__warning`},w={base:`${b}__labeled-slider`};let k=class extends i{constructor(e){super(e),this._onChange=e=>{this.onChange(e.target.value)}}render(){const{label:e}=this;return d("div",{class:w.base},d("calcite-label",{scale:"s"},e,d("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderChange:this._onChange,onCalciteSliderInput:this._onChange})))}loadDependencies(){return n({label:()=>import("../chunks/calcite-label.js"),slider:()=>import("../chunks/calcite-slider.js")})}};e([o()],k.prototype,"value",void 0),e([o()],k.prototype,"onChange",void 0),e([o()],k.prototype,"disabled",void 0),k=e([t("esri.widgets.Weather.LabeledSlider")],k);let C=class extends y{constructor(e){super(e),this.header=!0}};e([o({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),C=e([t("esri.widgets.Weather.VisibleElements")],C);const _=C,f={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let S=class extends i{constructor(e){super(e),this.viewModel=new m,this.headingLevel=4,this.visibleElements=new _,this.iconClass=j.widgetIcon,this.icon=null,this._renderWeatherTypeButton=e=>{const s=this.viewModel,o=this.messages[e].label,t=s.state===g.Disabled,r=!t&&s.current.type===e;return d("calcite-button",{appearance:r?"solid":"outline","aria-checked":r?"true":"false",disabled:t,iconStart:f[e],key:`${e}-type-button`,kind:r?"brand":"neutral",label:o,onclick:()=>{r||s.setWeatherByType(e)},scale:"l",title:o})},this._memoizedCallbacks=s((e=>({onCloudCoverChange:s=>{"cloudCover"in e&&(e.cloudCover=s)},onPrecipitationChange:s=>{"precipitation"in e&&(e.precipitation=s)},onFogStrengthChange:s=>{"fogStrength"in e&&(e.fogStrength=s)},onSnowCoverChange:e=>{this.viewModel.setSnowCoverEnabled(e.target.checked)}})))}render(){const e=this.viewModel.state===g.Disabled;return d("div",{"aria-label":this.messages.widgetLabelAccessible,class:this.classes(j.base,a.widget,e&&a.widgetDisabled),role:"region"},this._renderContent())}loadDependencies(){return n({button:()=>import("../chunks/calcite-button.js"),checkbox:()=>import("../chunks/calcite-checkbox.js"),icon:()=>import("../chunks/calcite-icon.js"),label:()=>import("../chunks/calcite-label.js")})}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case v.LocalScene:return e.localScene;case v.NoAtmosphere:return e.noAtmosphere;case v.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){return this.viewModel.error===v.NotVisible&&null!=this.view&&"3d"===this.view?.type&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const{headingLevel:e,messages:s,viewModel:o,visibleElements:t}=this,i=this._warningMessage,n=o.current,a=o.state===g.Error;return d(h,null,t.header?d(l,{level:e},s.widgetLabel):null,a?d("div",{class:j.error,key:"error"},this._errorMessage):null,d("div",{class:c({[j.content]:!0,[j.hasError]:a}),key:"content"},d("div",{"aria-label":s.weatherType,class:j.selector,key:"type-selector",role:"radiogroup"},r.map(this._renderWeatherTypeButton)),Object.values(o.weatherByType).map((e=>d("div",{class:c({[j.options]:!0,[j.optionsHidden]:e.type!==n?.type}),key:"options-container"},this._renderOptions(e)))),null!=i?this._renderWarning(i):null))}_renderOptions(e){const{viewModel:s,messages:o}=this,t=s.state===g.Disabled,r=this._memoizedCallbacks(e);switch(e.type){case"sunny":return d(k,{disabled:t,key:"sunny-cover",label:o.sunny.cloudCover,value:e.cloudCover,onChange:r.onCloudCoverChange});case"cloudy":return d(k,{disabled:t,key:"cloudy-cover",label:o.cloudy.cloudCover,value:e.cloudCover,onChange:r.onCloudCoverChange});case"rainy":return d(h,null,d(k,{disabled:t,key:"rainy-cover",label:o.rainy.cloudCover,value:e.cloudCover,onChange:r.onCloudCoverChange}),d(k,{disabled:t,key:"rainy-precipitation",label:o.rainy.precipitation,value:e.precipitation,onChange:r.onPrecipitationChange}));case"snowy":return d(h,null,d(k,{disabled:t,key:"snowy-cloud-cover",label:o.snowy.cloudCover,value:e.cloudCover,onChange:r.onCloudCoverChange}),d(k,{disabled:t,key:"snowy-precipitation",label:o.snowy.precipitation,value:e.precipitation,onChange:r.onPrecipitationChange}),d("calcite-label",{key:"snow-cover",layout:"inline",scale:"s",title:o.snowy.snowCoverTooltip},d("calcite-checkbox",{checked:"enabled"===e.snowCover,disabled:t,onCalciteCheckboxChange:r.onSnowCoverChange}),o.snowy.snowCover));case"foggy":return d(k,{disabled:t,key:"foggy-cover",label:o.foggy.fogStrength,value:e.fogStrength,onChange:r.onFogStrengthChange})}}_renderWarning(e){return d("div",{class:j.warning,key:"warning"},d("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};e([o()],S.prototype,"viewModel",void 0),e([o()],S.prototype,"view",null),e([o()],S.prototype,"headingLevel",void 0),e([o({type:_,nonNullable:!0})],S.prototype,"visibleElements",void 0),e([o()],S.prototype,"iconClass",void 0),e([o()],S.prototype,"icon",void 0),e([o()],S.prototype,"label",null),e([o(),p("esri/widgets/Weather/t9n/Weather")],S.prototype,"messages",void 0),e([o()],S.prototype,"_errorMessage",null),e([o()],S.prototype,"_warningMessage",null),S=e([t("esri.widgets.Weather")],S);const M=S;export{M as default};
