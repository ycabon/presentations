// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ./ArcadeModule ./ArcadeModuleLoader ./Dictionary ./executionError ./Feature ./FunctionWrapper ../chunks/languageUtils ./treeAnalysis ../chunks/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ../geometry/Geometry ../geometry/SpatialReference".split(" "),function(A,D,N,u,f,O,t,e,X,Y,Z,aa,B,ba,ca,da,E,P){async function F(a,b){const c=[];for(let d=0;d<b.arguments.length;d++)c.push(await h(a,b.arguments[d]));return c}
async function v(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await F(a,b);return c(a,b,d)}async function y(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await F(a,b);return c(a,b,d)}async function h(a,b,c){if(b.breakpoint&&!0!==c)return await b.breakpoint(),h(a,b,!0);try{switch(b?.type){case "VariableDeclarator":return await ea(a,b);case "ImportDeclaration":return await fa(a,b);case "ExportNamedDeclaration":return await ha(a,b);case "VariableDeclaration":return await Q(a,
b,0);case "BlockStatement":case "Program":return await ia(a,b);case "FunctionDeclaration":return await ja(a,b);case "ReturnStatement":return await ka(a,b);case "IfStatement":return await la(a,b);case "ExpressionStatement":return await ma(a,b);case "UpdateExpression":return await na(a,b);case "AssignmentExpression":return await oa(a,b);case "ForStatement":return await pa(a,b);case "WhileStatement":return await qa(a,b);case "ForInStatement":return await ra(a,b);case "BreakStatement":return e.breakResult;
case "EmptyStatement":return e.voidOperation;case "ContinueStatement":return e.continueResult;case "TemplateElement":return await sa(a,b);case "TemplateLiteral":return await ta(a,b);case "Identifier":return await G(a,b);case "MemberExpression":return await ua(a,b);case "Literal":return b.value;case "CallExpression":return await va(a,b);case "UnaryExpression":return await wa(a,b);case "BinaryExpression":return await xa(a,b);case "LogicalExpression":return await ya(a,b);case "ArrayExpression":return await za(a,
b);case "ObjectExpression":return await Aa(a,b);case "Property":return await Ba(a,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Unrecognized,b);}}catch(d){throw f.ensureArcadeExecutionError(a,b,d);}}async function Aa(a,b){const c=[];for(var d=0;d<b.properties.length;d++)c[d]=await h(a,b.properties[d]);d={};const g=new Map;for(let k=0;k<c.length;k++){const l=c[k];if(e.isFunctionParameter(l.value))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInDictionary,
b);if(!1===e.isString(l.key))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyMustBeString,b);let m=l.key.toString();const n=m.toLowerCase();g.has(n)?m=g.get(n):g.set(n,m);d[m]=l.value===e.voidOperation?null:l.value}a=new u(d);a.immutable=!1;return a}async function Ba(a,b){const c=await h(a,b.value);return"Identifier"===b.key.type?{key:b.key.name,value:c}:{key:await h(a,b.key),value:c}}async function qa(a,b){var c=!0,d=e.voidOperation;c=await h(a,b.test);if(!1===c)return e.voidOperation;
if(!0!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);for(;!0===c;){d=await h(a,b.body);if(d===e.breakResult)break;if(d instanceof e.returnResult)break;c=await h(a,b.test);if(!0!==c&&!1!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return d instanceof e.returnResult?d:e.voidOperation}async function Ca(a,b,c){const d=await h(a,b.body);c.lastAction=d;if(c.lastAction===e.breakResult||c.lastAction instanceof e.returnResult)return c.testResult=
!1,c;null!==b.update&&await h(a,b.update);return c}async function Da(a,b,c){if(null!==b.test){const d=await h(a,b.test);if(!0===a.abortSignal?.aborted)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Cancelled,b);c.testResult=d;if(!1===c.testResult)return c;if(!0!==c.testResult)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return Ca(a,b,c)}function C(a,b,c,d,g,k){try{Da(a,b,c).then(()=>{try{!0===c.testResult?(k++,100<k?(k=0,setTimeout(()=>{C(a,b,c,d,
g,k)},0)):C(a,b,c,d,g,k)):c.lastAction instanceof e.returnResult?d(c.lastAction):d(e.voidOperation)}catch(l){g(l)}},l=>{g(l)})}catch(l){g(l)}}function pa(a,b){try{return null!==b.init?h(a,b.init).then(()=>new Promise((c,d)=>{C(a,b,{testResult:!0,lastAction:e.voidOperation},g=>{c(g)},g=>{d(g)},0)})):new Promise((c,d)=>{C(a,b,{testResult:!0,lastAction:e.voidOperation},g=>{c(g)},g=>{d(g)},0)})}catch(c){return Promise.reject(c)}}function H(a,b,c,d,g,k,l,m,n,p){try{d<=k?m(e.voidOperation):(g.value="k"===
l?c[k]:k,h(a,b.body).then(r=>{try{r instanceof e.returnResult?m(r):r===e.breakResult?m(e.voidOperation):(p++,100<p?(p=0,setTimeout(()=>{H(a,b,c,d,g,k+1,l,m,n,p)},0)):H(a,b,c,d,g,k+1,l,m,n,p))}catch(I){n(I)}},r=>{n(r)}))}catch(r){n(r)}}function J(a,b,c,d,g,k,l,m,n){try{c.length()<=g?l(e.voidOperation):(d.value="k"===k?c.get(g):g,h(a,b.body).then(p=>{p instanceof e.returnResult?l(p):p===e.breakResult?l(e.voidOperation):(n++,100<n?(n=0,setTimeout(()=>{J(a,b,c,d,g+1,k,l,m,n)},0)):J(a,b,c,d,g+1,k,l,m,
n))},p=>{m(p)}))}catch(p){m(p)}}function K(a,b,c,d,g,k){try{void 0===k&&(k="i"),0===c.length?d.resolve(e.voidOperation):H(a,b,c,c.length,g,0,k,l=>{d.resolve(l)},l=>{d.reject(l)},0)}catch(l){d.reject(l)}}function Ea(a,b,c,d,g,k){try{void 0===k&&(k="i"),0===c.length?d.resolve(e.voidOperation):J(a,b,c,g,0,k,l=>{d.resolve(l)},l=>{d.reject(l)},0)}catch(l){d.reject(l)}}function Fa(a,b,c,d,g){try{const k=c.keys();K(a,b,k,d,g,"k")}catch(k){d.reject(k)}}function L(a,b,c,d,g,k,l,m){try{a.next().then(n=>{try{if(null===
n)k(e.voidOperation);else{const p=O.createFromGraphicLikeObject(n.geometry,n.attributes,d,b.timeZone);p._underlyingGraphic=n;g.value=p;h(b,c.body).then(r=>{try{r===e.breakResult?k(e.voidOperation):r instanceof e.returnResult?k(r):(m++,100<m?(m=0,setTimeout(()=>{L(a,b,c,d,g,k,l,m)},0)):L(a,b,c,d,g,k,l,m))}catch(I){l(I)}},r=>{l(r)})}}catch(p){l(p)}},n=>{l(n)})}catch(n){l(n)}}async function ra(a,b){return new Promise((c,d)=>{h(a,b.right).then(g=>{try{let k=null;k="VariableDeclaration"===b.left.type?
h(a,b.left):Promise.resolve();k.then(()=>{try{let m="";if("VariableDeclaration"===b.left.type){var l=b.left.declarations[0].id;"Identifier"===l.type&&(m=l.name)}else"Identifier"===b.left.type&&(m=b.left.name);if(!m)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);m=m.toLowerCase();l=null;null!=a.localScope&&void 0!==a.localScope[m]&&(l=a.localScope[m]);null===l&&void 0!==a.globalScope[m]&&(l=a.globalScope[m]);null===l?d(new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,
b)):e.isArray(g)||e.isString(g)?K(a,b,g,{reject:d,resolve:c},l):e.isImmutableArray(g)?Ea(a,b,g,{reject:d,resolve:c},l):g instanceof u||e.isFeature(g)?Fa(a,b,g,{reject:d,resolve:c},l):e.isFeatureSet(g)?L(g.iterator(a.abortSignal),a,b,g,l,n=>{c(n)},n=>{d(n)},0):K(a,b,[],{reject:d,resolve:c},l)}catch(m){d(m)}},d)}catch(k){d(k)}},d)})}async function na(a,b){var c=b.argument;if("MemberExpression"===c.type){var d=null,g=null;d=await h(a,c.object);!0===c.computed?g=await h(a,c.property):"Identifier"===c.property.type&&
(g=c.property.name);c=d;if(e.isArray(c))if(e.isNumber(g)){0>g&&(g=c.length+g);if(0>g||g>=c.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);a=e.toNumber(c[g]);c[g]="++"===b.operator?a+1:a-1}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(c instanceof u){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===c.hasField(g))a=e.toNumber(c.field(g)),c.setField(g,
"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});}else if(c instanceof x){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleAccessorMustBeString,b);if(!0===c.hasGlobal(g))a=e.toNumber(await c.global(g)),c.setGlobal(g,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(c)){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===c.hasField(g))a=e.toNumber(c.field(g)),c.setField(g,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});}else{if(e.isImmutableArray(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return!1===b.prefix?a:"++"===b.operator?a+1:a-1}g="Identifier"===b.argument.type?b.argument.name.toLowerCase():
"";if(!g)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);if(null!=a.localScope&&void 0!==a.localScope[g])return c=e.toNumber(a.localScope[g].value),a.localScope[g]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;if(void 0!==a.globalScope[g])return c=e.toNumber(a.globalScope[g].value),a.globalScope[g]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidIdentifier,b);}function w(a,b,c,d,g){switch(b){case "\x3d":return a===e.voidOperation?null:a;case "/\x3d":return e.toNumber(c)/e.toNumber(a);case "*\x3d":return e.toNumber(c)*e.toNumber(a);case "-\x3d":return e.toNumber(c)-e.toNumber(a);case "+\x3d":return e.isString(c)||e.isString(a)?e.toString(c)+e.toString(a):e.toNumber(c)+e.toNumber(a);case "%\x3d":return e.toNumber(c)%e.toNumber(a);default:throw new f.ArcadeExecutionError(g,f.ExecutionErrorCodes.UnsupportedOperator,
d);}}async function oa(a,b){var c=b.left;if("MemberExpression"===c.type){var d=await h(a,c.object),g=null;if(!0===c.computed)g=await h(a,c.property);else if("Identifier"===c.property.type)g=c.property.name;else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);c=await h(a,b.right);if(e.isArray(d))if(e.isNumber(g)){0>g&&(g=d.length+g);if(0>g||g>d.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);if(g===d.length&&"\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.OutOfBounds,b);d[g]=w(c,b.operator,d[g],b,a)}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(d instanceof u){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(g))d.setField(g,w(c,b.operator,d.field(g),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});d.setField(g,w(c,b.operator,null,b,a))}}else if(d instanceof
x){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasGlobal(g))d.setGlobal(g,w(c,b.operator,await d.global(g),b,a));else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(d)){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(g))d.setField(g,w(c,b.operator,d.field(g),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.FieldNotFound,b,{key:g});d.setField(g,w(c,b.operator,null,b,a))}}else{if(e.isImmutableArray(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return e.voidOperation}d=c.name.toLowerCase();if(null!=a.localScope&&void 0!==a.localScope[d])return g=await h(a,b.right),a.localScope[d]={value:w(g,b.operator,a.localScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;if(void 0!==
a.globalScope[d])return g=await h(a,b.right),a.globalScope[d]={value:w(g,b.operator,a.globalScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}async function ma(a,b){if("AssignmentExpression"===b.expression.type)return h(a,b.expression);if("CallExpression"===b.expression.type)return a=await h(a,b.expression),a===e.voidOperation?e.voidOperation:new e.implicitResult(a);a=await h(a,b.expression);return a===e.voidOperation?
e.voidOperation:new e.implicitResult(a)}async function la(a,b){const c=await h(a,b.test);if(!0===c)return h(a,b.consequent);if(!1===c)return null!==b.alternate?h(a,b.alternate):e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}async function ia(a,b){return R(a,b,0)}async function R(a,b,c){if(c>=b.body.length)return e.voidOperation;const d=await h(a,b.body[c]);return d instanceof e.returnResult||d===e.breakResult||d===e.continueResult||c===b.body.length-
1?d:R(a,b,c+1)}async function ka(a,b){if(null===b.argument)return new e.returnResult(e.voidOperation);a=await h(a,b.argument);return new e.returnResult(a)}async function ja(a,b){const c=b.id.name.toLowerCase();a.globalScope[c]={valueset:!0,node:null,value:new Ga(b,a)};return e.voidOperation}async function fa(a,b){const c=b.specifiers[0].local.name.toLowerCase(),d=a.libraryResolver.loadLibrary(c);let g=null;a.libraryResolver._moduleSingletons?.has(d.uri)?g=a.libraryResolver._moduleSingletons.get(d.uri):
(g=new x(d),await g.loadModule(a),a.libraryResolver._moduleSingletons?.set(d.uri,g));a.globalScope[c]={value:g,valueset:!0,node:b};return e.voidOperation}async function ha(a,b){await h(a,b.declaration);if("FunctionDeclaration"===b.declaration.type)a.exports[b.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===b.declaration.type)for(const c of b.declaration.declarations)a.exports[c.id.name.toLowerCase()]="variable";return e.voidOperation}async function Q(a,b,c){if(c>=b.declarations.length)return e.voidOperation;
await h(a,b.declarations[c]);if(c===b.declarations.length-1)return e.voidOperation;await Q(a,b,c+1);return e.voidOperation}async function ea(a,b){let c=null;c=null===b.init?null:await h(a,b.init);if(null!==a.localScope){c===e.voidOperation&&(c=null);if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);var d=b.id.name.toLowerCase();null!=a.localScope&&(a.localScope[d]={value:c,valueset:!0,node:b.init});return e.voidOperation}if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidIdentifier,b);d=b.id.name.toLowerCase();c===e.voidOperation&&(c=null);a.globalScope[d]={value:c,valueset:!0,node:b.init};return e.voidOperation}async function ua(a,b){const c=await h(a,b.object);if(null===c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MemberOfNull,b);if(!1===b.computed){if("Identifier"===b.property.type){if(c instanceof u||e.isFeature(c))return c.field(b.property.name);if(c instanceof E)return B.geometryMember(c,b.property.name,a,b);if(c instanceof
x){if(!c.hasGlobal(b.property.name))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);return c.global(b.property.name)}}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}let d=await h(a,b.property);if(c instanceof u||e.isFeature(c)){if(e.isString(d))return c.field(d)}else if(c instanceof x){if(e.isString(d))return c.global(d)}else if(c instanceof E){if(e.isString(d))return B.geometryMember(c,d,a,b)}else if(e.isArray(c)){if(e.isNumber(d)&&
isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}}else if(e.isImmutableArray(c)){if(e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c.get(d)}}else if(e.isString(c)&&e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}async function wa(a,b){const c=await h(a,b.argument);if(e.isBoolean(c)&&"!"===b.operator)return!c;if("-"===b.operator)return-1*e.toNumber(c);if("+"===b.operator)return 1*e.toNumber(c);if("~"===b.operator)return~e.toNumber(c);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedUnaryOperator,b);}async function za(a,b){const c=[];for(var d=0;d<b.elements.length;d++)c.push(await h(a,
b.elements[d]));for(d=0;d<c.length;d++){if(e.isFunctionParameter(c[d]))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInArray,b);c[d]===e.voidOperation&&(c[d]=null)}return c}async function xa(a,b){var c=[];c[0]=await h(a,b.left);c[1]=await h(a,b.right);const d=c[0];c=c[1];switch(b.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":return e.binaryOperator(e.toNumber(d),e.toNumber(c),b.operator);case "\x3d\x3d":return e.equalityTest(d,c);
case "!\x3d":return!e.equalityTest(d,c);case "\x3c":return e.greaterThanLessThan(d,c,b.operator);case "\x3e":return e.greaterThanLessThan(d,c,b.operator);case "\x3c\x3d":return e.greaterThanLessThan(d,c,b.operator);case "\x3e\x3d":return e.greaterThanLessThan(d,c,b.operator);case "+":return e.isString(d)||e.isString(c)?e.toString(d)+e.toString(c):e.toNumber(d)+e.toNumber(c);case "-":return e.toNumber(d)-e.toNumber(c);case "*":return e.toNumber(d)*e.toNumber(c);case "/":return e.toNumber(d)/e.toNumber(c);
case "%":return e.toNumber(d)%e.toNumber(c);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedOperator,b);}}async function ya(a,b){const c=await h(a,b.left);let d=null;if(e.isBoolean(c))switch(b.operator){case "||":if(!0===c)return c;d=await h(a,b.right);if(e.isBoolean(d))return d;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);case "\x26\x26":if(!1===c)return c;d=await h(a,b.right);if(e.isBoolean(d))return d;throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.LogicExpressionOrAnd,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,b);}async function G(a,b){const c=b.name.toLowerCase();if(null!=a.localScope&&void 0!==a.localScope[c]){b=a.localScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=h(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}if(void 0!==a.globalScope[c]){b=
a.globalScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=h(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}async function va(a,b){if("MemberExpression"===b.callee.type){var c=await h(a,b.callee.object);if(!(c instanceof x))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);const d=!1===b.callee.computed?b.callee.property.name:await h(a,b.callee.property);if(!c.hasGlobal(d))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.FunctionNotFound,b);c=await c.global(d);if(!e.isFunctionParameter(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);return c.call(a,b)}if("Identifier"!==b.callee.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);if(null!=a.localScope&&void 0!==a.localScope[b.callee.name.toLowerCase()]){c=a.localScope[b.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.CallNonFunction,b);}if(void 0!==a.globalScope[b.callee.name.toLowerCase()]){c=a.globalScope[b.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);}async function sa(a,b){return b.value?b.value.cooked:""}async function ta(a,b){const c=[];for(var d=0;d<b.expressions.length;d++){var g=await h(a,
b.expressions[d]);c[d]=e.toString(g)}d="";g=0;for(const n of b.quasis)if(d+=n.value?n.value.cooked:"",!1===n.tail){if(c[g]){var k=c[g];var l=a,m=b;if(e.isFunctionParameter(k))throw new f.ArcadeExecutionError(l,f.ExecutionErrorCodes.NoFunctionInTemplateLiteral,m);}else k="";d+=k;g++}return d}async function S(a,b,c,d){var g=await h(a,b.arguments[c]);if(e.equalityTest(g,d))return h(a,b.arguments[c+1]);g=b.arguments.length-c;return 1===g?h(a,b.arguments[c]):2===g?null:3===g?h(a,b.arguments[c+2]):S(a,
b,c+2,d)}async function T(a,b,c,d){if(!0===d)return h(a,b.arguments[c+1]);if(3===b.arguments.length-c)return h(a,b.arguments[c+2]);d=await h(a,b.arguments[c+2]);if(!1===e.isBoolean(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b.arguments[c+2]);return T(a,b,c+2,d)}async function M(a,b,c,d){const g=a.body;if(c.length!==a.params.length)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let k=0;k<c.length;k++){const l=a.params[k];
"Identifier"===l.type&&null!=b.localScope&&(b.localScope[l.name.toLowerCase()]={d:null,value:c[k],valueset:!0,node:null})}a=await h(b,g);if(a instanceof e.returnResult)return a.value;if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);return a instanceof e.implicitResult?a.value:a}function U(a,b,c){const d=new z;if(void 0===a||null===a)a={};if(void 0===b||
null===b)b={};const g=new u({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});g.immutable=!1;d.textformatting={value:g,valueset:!0,node:null};for(const k in b)d[k]={value:new t.NativeFunction(b[k]),native:!0,valueset:!0,node:null};for(const k in a)d[k]=a[k]&&"esri.Graphic"===a[k].declaredClass?{value:O.createFromGraphic(a[k],c),valueset:!0,node:null}:{value:a[k],valueset:!0,node:null};return d}function V(a){console.log(a)}function W(a){const b={mode:"async",
compiled:!1,functions:{},signatures:[],standardFunction:v,standardFunctionAsync:y,evaluateIdentifier:G};for(let c=0;c<a.length;c++)a[c].registerFunctions(b);for(const c in b.functions)q[c]={value:new t.NativeFunction(b.functions[c]),valueset:!0,node:null},z.prototype[c]=q[c];for(a=0;a<b.signatures.length;a++)X.addFunctionDeclaration(b.signatures[a],"async")}class Ga extends t.ArcadeFunction{constructor(a,b){super();this.context=this.definition=null;this.definition=a;this.context=b}createFunction(a){return(...b)=>
{const c={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:a.depthCounter+1},globalScope:this.context.globalScope};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,null);return M(this.definition,c,b,null)}}call(a,
b){return y(a,b,(c,d,g)=>{c={spatialReference:a.spatialReference,services:a.services,console:a.console,libraryResolver:a.libraryResolver,exports:a.exports,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{},abortSignal:a.abortSignal,globalScope:a.globalScope,depthCounter:{depth:a.depthCounter.depth+1}};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,b);return M(this.definition,c,g,b)})}marshalledCall(a,b,c,d){return d(a,
b,async(g,k,l)=>{g={spatialReference:a.spatialReference,globalScope:c.globalScope,depthCounter:{depth:a.depthCounter.depth+1},libraryResolver:a.libraryResolver,exports:a.exports,console:a.console,abortSignal:a.abortSignal,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{}};l=l.map(m=>!e.isFunctionParameter(m)||m instanceof t.ScopeMarshalledFunction?m:t.wrapModuleScopedResponse(m,a,d));return t.wrapModuleScopedResponse(await M(this.definition,g,l,b),c,d)})}}class x extends D.ArcadeModule{constructor(a){super(a)}async global(a){a=
this.executingContext.globalScope[a.toLowerCase()];a.valueset||(a.value=await h(this.executingContext,a.node),a.valueset=!0);if(e.isFunctionParameter(a.value)&&!(a.value instanceof t.ScopeMarshalledFunction)){const b=new t.ScopeMarshalledFunction;b.fn=a.value;b.parameterEvaluator=y;b.context=this.executingContext;a.value=b}return a.value}setGlobal(a,b){if(e.isFunctionParameter(b))throw new f.ArcadeExecutionError(null,f.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[a.toLowerCase()]=
{value:b,valueset:!0,node:null}}hasGlobal(a){void 0===this.executingContext.exports[a]&&(a=a.toLowerCase());return void 0!==this.executingContext.exports[a]?!0:!1}async loadModule(a){let b=a.spatialReference;if(null===b||void 0===b)b=new P({wkid:102100});this.moduleScope=U({},a.customfunctions,a.timeZone);this.executingContext={spatialReference:b,services:a.services,libraryResolver:new N.ArcadeModuleLoader(a.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===
a.abortSignal||null===a.abortSignal?{aborted:!1}:a.abortSignal,globalScope:this.moduleScope,console:a.console??V,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:null,depthCounter:{depth:1}};await h(this.executingContext,this.source.syntax)}}const q={};Z.registerFunctions(q,v);da.registerFunctions(q,v);ba.registerFunctions(q,v);B.registerFunctions(q,v);ca.registerFunctions(q,v);aa.registerFunctions({functions:q,compiled:!1,signatures:null,evaluateIdentifier:null,
mode:"async",standardFunction:v,standardFunctionAsync:y});q.iif=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,3,3,a,b);const c=await h(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);return c?h(a,b.arguments[1]):h(a,b.arguments[2])};q.defaultvalue=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,2,3,a,b);var c=await h(a,b.arguments[0]);if(3===b.arguments.length){const d=await h(a,b.arguments[1]);
let g=[];if(e.isImmutableArray(d))g=d.toArray();else if(e.isArray(d))g=d;else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);if(null===c)return h(a,b.arguments[2]);for(const k of g)if(e.isFeature(c)){if(!1===e.isString(k)||!c.hasField(k))return h(a,b.arguments[2]);c=c.field(k)}else if(c instanceof u){if(!1===e.isString(k)||!c.hasField(k))return h(a,b.arguments[2]);c=c.field(k)}else if(c instanceof E){if(!1===e.isString(k))return h(a,b.arguments[2]);c=B.geometryMember(c,
k,null,null,2);if(null===c||"notfound"===c?.keystate)return h(a,b.arguments[2])}else if(e.isArray(c)){if(!1===e.isNumber(k))return h(a,b.arguments[2]);c=c[k];if(null===c||void 0===c)return h(a,b.arguments[2])}else if(e.isImmutableArray(c)){if(!1===e.isNumber(k))return h(a,b.arguments[2]);c=c.get(k);if(null===c||void 0===c)return h(a,b.arguments[2])}else return h(a,b.arguments[2]);return c}return null==c||""===c?h(a,b.arguments[1]):c};q.decode=async function(a,b){if(2>b.arguments.length)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(2===b.arguments.length)return h(a,b.arguments[1]);if(0===(b.arguments.length-1)%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);const c=await h(a,b.arguments[0]);return S(a,b,1,c)};q.when=async function(a,b){if(3>b.arguments.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(0===b.arguments.length%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,
b);const c=await h(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b.arguments[0]);return T(a,b,0,c)};D={fixSpatialReference:e.fixSpatialReference,parseArguments:F,standardFunction:v,standardFunctionAsync:y,evaluateIdentifier:G};for(const a in q)q[a]={value:new t.NativeFunction(q[a]),valueset:!0,node:null};const z=function(){};z.prototype=q;z.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};z.prototype.pi=
{value:Math.PI,valueset:!0,node:null};W([Y.ArrayFunctions]);A.executeScript=async function(a,b){let c=b.spatialReference;if(null===c||void 0===c)c=new P({wkid:102100});let d=null;a.usesModules&&(d=new N.ArcadeModuleLoader(new Map,a.loadedModules));const g=U(b.vars,b.customfunctions,b.timeZone);b={spatialReference:c,services:b.services,exports:{},libraryResolver:d,abortSignal:void 0===b.abortSignal||null===b.abortSignal?{aborted:!1}:b.abortSignal,globalScope:g,console:b.console??V,timeZone:b.timeZone??
null,lrucache:b.lrucache,interceptor:b.interceptor,localScope:null,depthCounter:{depth:1}};a=await h(b,a);a instanceof e.returnResult&&(a=a.value);a instanceof e.implicitResult&&(a=a.value);a===e.voidOperation&&(a=null);if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);if(e.isFunctionParameter(a))throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,
null);return a};A.extend=W;A.functionHelper=D;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});