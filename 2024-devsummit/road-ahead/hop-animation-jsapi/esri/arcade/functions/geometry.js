// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../Dictionary ../executionError ../Feature ../ImmutablePathArray ../ImmutablePointArray ../../chunks/languageUtils ./centroid ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/coordsUtils ../../geometry/support/jsonUtils".split(" "),function(D,n,f,q,E,F,d,x,G,v,y,r,z,A,I,u){function B(g){return g&&"esri.arcade.Feature"===g.arcadeDeclaredClass}function C(g,k,c,e,b=1){k=k.toLowerCase();
switch(k){case "hasz":return g=g.hasZ,void 0===g?!1:g;case "hasm":return g=g.hasM,void 0===g?!1:g;case "spatialreference":return k=g.spatialReference._arcadeCacheId,void 0===k&&(c=!0,Object.freeze&&Object.isFrozen(g.spatialReference)&&(c=!1),c&&(w++,k=g.spatialReference._arcadeCacheId=w)),g=new n({wkt:g.spatialReference.wkt,wkid:g.spatialReference.wkid}),void 0!==k&&(g._arcadeCacheId="SPREF"+k.toString()),g}switch(g.type){case "extent":switch(k){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return g=
g[k],void 0!==g?g:null;case "type":return"Extent"}break;case "polygon":switch(k){case "rings":return k=g.cache._arcadeCacheId,void 0===k&&(w++,k=w,g.cache._arcadeCacheId=k),new E(g.rings,g.spatialReference,!0===g.hasZ,!0===g.hasM,k);case "type":return"Polygon"}break;case "point":switch(k){case "x":case "y":case "z":case "m":return void 0!==g[k]?g[k]:null;case "type":return"Point"}break;case "polyline":switch(k){case "paths":return k=g.cache._arcadeCacheId,void 0===k&&(w++,k=w,g.cache._arcadeCacheId=
k),new E(g.paths,g.spatialReference,!0===g.hasZ,!0===g.hasM,k);case "type":return"Polyline"}break;case "multipoint":switch(k){case "points":return k=g.cache._arcadeCacheId,void 0===k&&(w++,k=w,g.cache._arcadeCacheId=k),new F(g.points,g.spatialReference,!0===g.hasZ,!0===g.hasM,k,1);case "type":return"Multipoint"}}if(1===b)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidIdentifier,e);return 2===b?{keystate:"notfound"}:null}let w=0;D.geometryMember=C;D.registerFunctions=function(g,k){g.ringisclockwise=
function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,1,1,c,e);b=[];if(null===a[0])return!1;if(d.isArray(a[0]))for(const h of a[0])if(h instanceof r)b.push(h.hasZ?h.hasM?[h.x,h.y,h.z,h.m]:[h.x,h.y,h.z]:[h.x,h.y]);else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);else if(a[0]instanceof F)b=a[0]._elements;else if(d.isImmutableArray(a[0]))for(const h of a[0].toArray())if(h instanceof r)b.push(h.hasZ?h.hasM?[h.x,h.y,h.z,h.m]:[h.x,h.y,h.z]:[h.x,h.y]);else throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.InvalidParameter,e);else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);return 3>b.length?!1:I.isClockwise(b)})};g.polygon=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,1,1,c,e);b=null;if(a[0]instanceof n){if(b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference),!1===b instanceof z)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}else a[0]instanceof z?b=u.fromJSON(a[0].toJSON()):
((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=c.spatialReference),b=d.fixSpatialReference(new z(a),c.spatialReference));if(null!==b&&!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.polyline=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,1,1,c,e);b=null;if(a[0]instanceof n){if(b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference),
!1===b instanceof A)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}else a[0]instanceof A?b=u.fromJSON(a[0].toJSON()):((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=c.spatialReference),b=d.fixSpatialReference(new A(a),c.spatialReference));if(null!==b&&!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.point=function(c,e){return k(c,e,(b,
l,a)=>{d.pcCheck(a,1,1,c,e);b=null;if(a[0]instanceof n){if(b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference),!1===b instanceof r)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}else a[0]instanceof r?b=u.fromJSON(a[0].toJSON()):((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=c.spatialReference),b=d.fixSpatialReference(new r(a),c.spatialReference));if(null!==b&&!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.multipoint=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,1,1,c,e);b=null;if(a[0]instanceof n){if(b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference),!1===b instanceof y)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}else a[0]instanceof y?b=u.fromJSON(a[0].toJSON()):((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=c.spatialReference),
b=d.fixSpatialReference(new y(a),c.spatialReference));if(null!==b&&!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.extent=function(c,e){return k(c,e,(b,l,a)=>{a=d.autoCastFeatureToGeometry(a);d.pcCheck(a,1,1,c,e);b=null;a[0]instanceof n?b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference):a[0]instanceof r?(b={xmin:a[0].x,ymin:a[0].y,xmax:a[0].x,
ymax:a[0].y,spatialReference:a[0].spatialReference.toJSON()},a=a[0],a.hasZ?(b.zmin=a.z,b.zmax=a.z):a.hasM&&(b.mmin=a.m,b.mmax=a.m),b=u.fromJSON(b)):a[0]instanceof z?b=u.fromJSON(a[0].extent?.toJSON()):a[0]instanceof A?b=u.fromJSON(a[0].extent?.toJSON()):a[0]instanceof y?b=u.fromJSON(a[0].extent?.toJSON()):a[0]instanceof G?b=u.fromJSON(a[0].toJSON()):((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=c.spatialReference),b=d.fixSpatialReference(new G(a),c.spatialReference));if(null!==b&&
!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.geometry=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,1,1,c,e);b=null;if(null===a[0])return null;B(a[0])?b=d.fixSpatialReference(a[0].geometry(),c.spatialReference):a[0]instanceof n?b=d.fixSpatialReference(q.parseGeometryFromDictionary(a[0],c.spatialReference),c.spatialReference):((a=JSON.parse(a[0]))&&!a.spatialReference&&(a.spatialReference=
c.spatialReference),b=d.fixSpatialReference(u.fromJSON(a),c.spatialReference));if(null!==b&&!1===b.spatialReference.equals(c.spatialReference))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongSpatialReference,e);return d.fixNullGeometry(b)})};g.setgeometry=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,2,2,c,e);if(B(a[0])){if(!0===a[0].immutable)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.Immutable,e);if(a[1]instanceof v||null===a[1])a[0]._geometry=a[1];else throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.InvalidParameter,e);}else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);return d.voidOperation})};g.feature=function(c,e){return k(c,e,(b,l,a)=>{if(0===a.length)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongNumberOfParameters,e);b=null;if(1===a.length)if(d.isString(a[0]))b=q.fromJson(JSON.parse(a[0]),c.timeZone);else if(B(a[0]))b=q.createFromArcadeFeature(a[0]);else if(a[0]instanceof v)b=q.createFromGraphicLikeObject(a[0],null,null,
c.timeZone);else if(a[0]instanceof n)b=a[0].hasField("geometry")?a[0].field("geometry"):null,a=a[0].hasField("attributes")?a[0].field("attributes"):null,null!==b&&b instanceof n&&(b=q.parseGeometryFromDictionary(b,c.spatialReference)),null!==a&&(a=q.parseAttributesFromDictionary(a)),b=q.createFromGraphicLikeObject(b,a,null,c.timeZone);else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);else if(2===a.length){l=b=null;if(null!==a[0])if(a[0]instanceof v)b=a[0];else if(b instanceof
n)b=q.parseGeometryFromDictionary(a[0],c.spatialReference);else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);if(null!==a[1])if(a[1]instanceof n)l=q.parseAttributesFromDictionary(a[1]);else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);b=q.createFromGraphicLikeObject(b,l,null,c.timeZone)}else{b=null;l={};if(null!==a[0])if(a[0]instanceof v)b=a[0];else if(b instanceof n)b=q.parseGeometryFromDictionary(a[0],c.spatialReference);else throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.InvalidParameter,e);for(let h=1;h<a.length;h+=2){const p=d.toString(a[h]),m=a[h+1];if(null===m||void 0===m||d.isString(m)||isNaN(m)||d.isDate(m)||d.isNumber(m)||d.isTime(m)||d.isDateOnly(m)||d.isBoolean(m)){if(d.isFunctionParameter(m)||!1===d.isSimpleType(m))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);l[p]=m===d.voidOperation?null:m}else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}b=q.createFromGraphicLikeObject(b,
l,null,c.timeZone)}b._geometry=d.fixSpatialReference(b.geometry(),c.spatialReference);b.immutable=!1;return b})};g.dictionary=function(c,e){return k(c,e,(b,l,a)=>{if(0===a.length||1===a.length&&null===a[0])return a=new n,a.immutable=!1,a;if(1===a.length&&d.isString(a[0]))try{var h=JSON.parse(a[0]),p=n.convertObjectToArcadeDictionary(h,d.defaultTimeZone(c),!1);p.immutable=!1;return p}catch(m){throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}if(1===a.length&&a[0]instanceof
v)try{const m=a[0].toJSON();m.hasZ=!0===a[0].hasZ;m.hasM=!0===a[0].hasM;const t=n.convertObjectToArcadeDictionary(m,d.defaultTimeZone(c),!1);t.immutable=!1;return t}catch(m){throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}if(1===a.length&&d.isFeature(a[0]))try{const m=new n;m.immutable=!1;m.setField("geometry",a[0].geometry());const t=new n;t.immutable=!1;m.setField("attributes",t);for(const H of a[0].keys())t.setField(H,a[0].field(H));return m}catch(m){throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.InvalidParameter,e);}if(1===a.length&&a[0]instanceof n)try{const m=new n;m.immutable=!1;for(const t of a[0].keys())m.setField(t,a[0].field(t));return m}catch(m){throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);}if(2===a.length&&a[0]instanceof n&&d.isBoolean(a[1]))try{if(!0!==a[1]){const m=new n;m.immutable=!1;for(const t of a[0].keys())m.setField(t,a[0].field(t));return m}return a[0].deepClone()}catch(m){throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,
e);}if(0!==a.length%2)throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.WrongNumberOfParameters,e);b={};for(l=0;l<a.length;l+=2)if(h=d.toString(a[l]),p=a[l+1],null===p||void 0===p||d.isString(p)||isNaN(p)||d.isDate(p)||d.isNumber(p)||d.isBoolean(p)||d.isDateOnly(p)||d.isTime(p)||d.isArray(p)||d.isImmutableArray(p)){if(d.isFunctionParameter(p))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);b[h]=p===d.voidOperation?null:p}else throw new f.ArcadeExecutionError(c,
f.ExecutionErrorCodes.InvalidParameter,e);a=new n(b);a.immutable=!1;return a})};g.haskey=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,2,2,c,e);b=d.toString(a[1]);if(B(a[0])||a[0]instanceof n)return a[0].hasField(b);if(a[0]instanceof v)return(a=C(a[0],b,null,null,2))&&"notfound"===a.keystate?!1:!0;throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);})};g.hasvalue=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,2,2,c,e);if(d.isArray(a[1])||d.isImmutableArray(a[1])){l=a[1];
b=[];if(d.isImmutableArray(l))b=l.toArray();else if(d.isArray(l))b=l;else throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);a=a[0];if(null===a)return!1;for(var h of b)if(d.isFeature(a)){if(!1===d.isString(h)||!a.hasField(h))return!1;a=a.field(h);if(null===a)return!1}else if(a instanceof n){if(!1===d.isString(h)||!a.hasField(h))return!1;a=a.field(h);if(null===a)return!1}else if(a instanceof v){if(!1===d.isString(h))return!1;a=C(a,h,null,null,0);if(null===a)return!1}else if(d.isArray(a)){if(!1===
d.isNumber(h))return!1;a=a[h];if(null===a||void 0===a)return!1}else if(d.isImmutableArray(a)){if(!1===d.isNumber(h))return!1;a=a.get(h);if(null===a||void 0===a)return!1}else return!1;return!0}if(null===a[0]||null===a[1])return!1;h=d.toString(a[1]);return d.isFeature(a[0])||a[0]instanceof n?a[0].hasField(h)&&null!==a[0].field(h)?!0:!1:a[0]instanceof v?null===C(a[0],h,null,null,0)?!1:!0:!1})};g.indexof=function(c,e){return k(c,e,(b,l,a)=>{d.pcCheck(a,2,2,c,e);b=a[1];if(d.isArray(a[0])){for(l=0;l<a[0].length;l++)if(d.equalityTest(b,
a[0][l]))return l;return-1}if(d.isImmutableArray(a[0])){l=a[0].length();for(let h=0;h<l;h++)if(d.equalityTest(b,a[0].get(h)))return h;return-1}throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);})};g.angle=function(c,e){return k(c,e,(b,l,a)=>{a=d.autoCastFeatureToGeometry(a);d.pcCheck(a,2,3,c,e);if(!(a[0]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);if(!(a[1]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,
e);if(2<a.length&&!(a[2]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);return 2===a.length?x.angle2D(a[0],a[1]):x.angleBetween2D(a[0],a[1],a[2])})};g.bearing=function(c,e){return k(c,e,(b,l,a)=>{a=d.autoCastFeatureToGeometry(a);d.pcCheck(a,2,3,c,e);if(!(a[0]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);if(!(a[1]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);if(2<a.length&&
!(a[2]instanceof r))throw new f.ArcadeExecutionError(c,f.ExecutionErrorCodes.InvalidParameter,e);return 2===a.length?x.bearing2D(a[0],a[1]):x.bearingBetween2D(a[0],a[1],a[2])})};g.isselfintersecting=function(c,e){return k(c,e,(b,l,a)=>{a=d.autoCastFeatureToGeometry(a);d.pcCheck(a,1,1,c,e);b=a[0];if(b instanceof z)return b.isSelfIntersecting;if(b instanceof A)return b=b.paths,x.pathsSelfIntersecting(b);if(b instanceof y)for(l=b.points,a=0;a<l.length;a++)for(let h=0;h<l.length;h++)if(h!==a){let p=!0;
for(let m=0;m<l[a].length;m++)if(l[a][m]!==l[h][m]){p=!1;break}if(!0===p)return!0}return d.isArray(b)||d.isImmutableArray(b)?(b=d.autoCastArrayOfPointsToPolyline(b,c.spatialReference),null!==b&&(b=b.paths),x.pathsSelfIntersecting(b)):!1})}};Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})});