// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","./comment-handler","./error-handler","./scanner","./types"],function(n,u,q,v,b){function r(a,c=0){let d=a.start-a.lineStart,e=a.lineNumber;0>d&&(d+=c,e--);return{index:a.start,line:e,column:d}}function t(a){return[{index:a.range[0],...a.loc.start},{index:a.range[1],...a.loc.end}]}function p(a){return b.operatorPrecedence[a]??0}var h;(function(a){a[a.None=0]="None";a[a.Function=1]="Function";a[a.IfClause=2]="IfClause";a[a.ForLoop=4]="ForLoop";a[a.WhileLoop=8]="WhileLoop"})(h||={});
var m;(function(a){a[a.AsObject=0]="AsObject";a[a.Automatic=1]="Automatic"})(m||={});class w{constructor(a,c={},d){this.delegate=d;this.hasLineTerminator=!1;this.options={tokens:"boolean"===typeof c.tokens&&c.tokens,comments:"boolean"===typeof c.comments&&c.comments,tolerant:"boolean"===typeof c.tolerant&&c.tolerant};this.options.comments&&(this.commentHandler=new u.CommentHandler);this.errorHandler=new q.ErrorHandler(this.options.tolerant);this.scanner=new v.Scanner(a,this.errorHandler);this.context=
{isAssignmentTarget:!1,blockContext:h.None,curlyParsingType:m.AsObject};this.rawToken={type:b.TokenType.EOF,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0};this.tokens=[];this.startMarker={index:0,line:this.scanner.lineNumber,column:0};this.endMarker={index:0,line:this.scanner.lineNumber,column:0};this.readNextRawToken();this.endMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}throwIfInvalidType(a,c,{validTypes:d,
invalidTypes:e}){d?.some(f=>a.type===f)||e?.some(f=>a.type===f)&&this.throwError(b.ParsingErrorCodes.InvalidExpression,c)}throwError(a,c,d=this.endMarker){const {index:e,line:f,column:g}=c;this.errorHandler.throwError({code:a,index:e,line:f,column:g+1,len:d.index-e-1})}tolerateError(a,c){throw Error("######################################### !!!");}unexpectedTokenError(a={}){const {rawToken:c}=a;let {code:d,data:e}=a;if(c){if(!d)switch(c.type){case b.TokenType.EOF:d=b.ParsingErrorCodes.UnexpectedEndOfScript;
break;case b.TokenType.Identifier:d=b.ParsingErrorCodes.UnexpectedIdentifier;break;case b.TokenType.NumericLiteral:d=b.ParsingErrorCodes.UnexpectedNumber;break;case b.TokenType.StringLiteral:d=b.ParsingErrorCodes.UnexpectedString;break;case b.TokenType.Template:d=b.ParsingErrorCodes.UnexpectedTemplate}a=c.value.toString()}else a="ILLEGAL";d=d??b.ParsingErrorCodes.UnexpectedToken;e||={value:a};a=q.formatErrorDescription(d,e);if(c)return new b.ParsingError({code:d,index:c.start,line:c.lineNumber,column:c.start-
c.lineStart+1,len:c.end-c.start-1,data:e,description:a});const {index:f,line:g}=this.endMarker;return new b.ParsingError({code:d,index:f,line:g,column:this.endMarker.column+1,data:e,description:a})}throwUnexpectedToken(a={}){a.rawToken=a.rawToken??this.rawToken;throw this.unexpectedTokenError(a);}collectComments(a){const {commentHandler:c}=this;c&&a.length&&a.forEach(d=>{d={type:d.multiLine?b.Syntax.BlockComment:b.Syntax.LineComment,value:this.getSourceValue(d),range:d.range,loc:d.loc};c.collectComment(d)})}peekAhead(a){const c=
this.scanner.saveState();a=a.call(this,()=>{this.scanner.scanComments();return this.scanner.lex()});this.scanner.restoreState(c);return a}getSourceValue(a){return this.scanner.source.slice(a.start,a.end)}convertToToken(a){return{type:b.rokenNames[a.type],value:this.getSourceValue(a),range:[a.start,a.end],loc:{start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}}}readNextRawToken(){this.endMarker.index=
this.scanner.index;this.endMarker.line=this.scanner.lineNumber;this.endMarker.column=this.scanner.index-this.scanner.lineStart;const a=this.rawToken;this.collectComments(this.scanner.scanComments());this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);this.rawToken=this.scanner.lex();this.hasLineTerminator=a.lineNumber!==this.rawToken.lineNumber;this.options.tokens&&
this.rawToken.type!==b.TokenType.EOF&&this.tokens.push(this.convertToToken(this.rawToken))}captureStartMarker(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}}getItemLocation(a){return{range:[a.index,this.endMarker.index],loc:{start:{line:a.line,column:a.column},end:{line:this.endMarker.line,column:this.endMarker.column}}}}finalize(a){if(this.delegate||this.commentHandler)this.commentHandler?.attachComments(a),this.delegate?.(a);return a}expectPunctuator(a){const c=
this.rawToken;this.matchPunctuator(a)?this.readNextRawToken():this.throwUnexpectedToken({rawToken:c,code:b.ParsingErrorCodes.PunctuatorExpected,data:{value:a}})}expectKeyword(a){this.rawToken.type===b.TokenType.Keyword&&this.rawToken.value.toLowerCase()===a?this.readNextRawToken():this.throwUnexpectedToken({rawToken:this.rawToken})}expectContextualKeyword(a){this.rawToken.type===b.TokenType.Identifier&&this.rawToken.value.toLowerCase()===a?this.readNextRawToken():this.throwUnexpectedToken({rawToken:this.rawToken})}matchKeyword(a){return this.rawToken.type===
b.TokenType.Keyword&&this.rawToken.value.toLowerCase()===a}matchContextualKeyword(a){return this.rawToken.type===b.TokenType.Identifier&&this.rawToken.value===a}matchPunctuator(a){return this.rawToken.type===b.TokenType.Punctuator&&this.rawToken.value===a}getMatchingPunctuator(a){"string"===typeof a&&(a=a.split(""));if(this.rawToken.type===b.TokenType.Punctuator&&a?.length)return a.find(this.matchPunctuator,this)}isolateCoverGrammar(a){const c=this.context.isAssignmentTarget;this.context.isAssignmentTarget=
!0;a=a.call(this);this.context.isAssignmentTarget=c;return a}inheritCoverGrammar(a){const c=this.context.isAssignmentTarget;this.context.isAssignmentTarget=!0;a=a.call(this);this.context.isAssignmentTarget=this.context.isAssignmentTarget&&c;return a}withBlockContext(a,c){const d=this.context.blockContext;this.context.blockContext|=a;a=this.context.curlyParsingType;this.context.curlyParsingType=m.Automatic;c=c.call(this);this.context.blockContext=d;this.context.curlyParsingType=a;return c}consumeSemicolon(){this.matchPunctuator(";")?
this.readNextRawToken():this.hasLineTerminator||(this.rawToken.type===b.TokenType.EOF||this.matchPunctuator("}")?(this.endMarker.index=this.startMarker.index,this.endMarker.line=this.startMarker.line,this.endMarker.column=this.startMarker.column):this.throwUnexpectedToken({rawToken:this.rawToken}))}parsePrimaryExpression(){const a=this.captureStartMarker(),c=this.rawToken;switch(c.type){case b.TokenType.Identifier:return this.readNextRawToken(),this.finalize({type:b.Syntax.Identifier,name:c.value,
...this.getItemLocation(a)});case b.TokenType.NumericLiteral:case b.TokenType.StringLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:b.Syntax.Literal,value:c.value,raw:this.getSourceValue(c),isString:"string"===typeof c.value,...this.getItemLocation(a)});case b.TokenType.BooleanLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:b.Syntax.Literal,value:c.value.toLowerCase()===b.Keywords.True,raw:this.getSourceValue(c),
isString:!1,...this.getItemLocation(a)});case b.TokenType.NullLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:b.Syntax.Literal,value:null,raw:this.getSourceValue(c),isString:!1,...this.getItemLocation(a)});case b.TokenType.Template:return this.parseTemplateLiteral();case b.TokenType.Punctuator:switch(c.value){case "(":return this.inheritCoverGrammar(this.parseGroupExpression);case "[":return this.inheritCoverGrammar(this.parseArrayInitializer);case "{":return this.inheritCoverGrammar(this.parseObjectExpression);
default:return this.throwUnexpectedToken({rawToken:this.rawToken})}case b.TokenType.Keyword:return this.context.isAssignmentTarget=!1,this.throwUnexpectedToken({rawToken:this.rawToken});default:return this.throwUnexpectedToken({rawToken:this.rawToken})}}parseArrayInitializer(){const a=this.captureStartMarker();this.expectPunctuator("[");const c=[];for(;!this.matchPunctuator("]");){const d=this.captureStartMarker();this.matchPunctuator(",")?(this.readNextRawToken(),this.throwError(b.ParsingErrorCodes.InvalidExpression,
d)):(c.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.matchPunctuator("]")||this.expectPunctuator(","))}this.expectPunctuator("]");return this.finalize({type:b.Syntax.ArrayExpression,elements:c,...this.getItemLocation(a)})}parseObjectPropertyKey(){const a=this.captureStartMarker(),c=this.rawToken;switch(c.type){case b.TokenType.StringLiteral:return this.readNextRawToken(),this.finalize({type:b.Syntax.Literal,value:c.value,raw:this.getSourceValue(c),isString:!0,...this.getItemLocation(a)});
case b.TokenType.Identifier:case b.TokenType.BooleanLiteral:case b.TokenType.NullLiteral:case b.TokenType.Keyword:return this.readNextRawToken(),this.finalize({type:b.Syntax.Identifier,name:c.value,...this.getItemLocation(a)});default:this.throwError(b.ParsingErrorCodes.KeyMustBeString,a)}}parseObjectProperty(){const a=this.rawToken,c=this.captureStartMarker(),d=this.parseObjectPropertyKey();let e=!1,f=null;this.matchPunctuator(":")?(this.readNextRawToken(),f=this.inheritCoverGrammar(this.parseAssignmentExpression)):
a.type===b.TokenType.Identifier?(e=!0,f=this.finalize({type:b.Syntax.Identifier,name:a.value,...this.getItemLocation(c)})):this.throwUnexpectedToken({rawToken:this.rawToken});return this.finalize({type:b.Syntax.Property,kind:"init",key:d,value:f,shorthand:e,...this.getItemLocation(c)})}parseObjectExpression(){const a=this.captureStartMarker();this.expectPunctuator("{");const c=[];for(;!this.matchPunctuator("}");)c.push(this.parseObjectProperty()),this.matchPunctuator("}")||this.expectPunctuator(",");
this.expectPunctuator("}");return this.finalize({type:b.Syntax.ObjectExpression,properties:c,...this.getItemLocation(a)})}parseTemplateElement(a=!1){var c=this.rawToken;c.type!==b.TokenType.Template&&this.throwUnexpectedToken({rawToken:c});a&&!c.head&&this.throwUnexpectedToken({code:b.ParsingErrorCodes.InvalidTemplateHead,rawToken:c});a=this.captureStartMarker();this.readNextRawToken();const {value:d,cooked:e,tail:f}=c;c=this.finalize({type:b.Syntax.TemplateElement,value:{raw:d,cooked:e},tail:f,...this.getItemLocation(a)});
c.loc.start.column++;c.loc.end.column-=f?1:2;return c}parseTemplateLiteral(){const a=this.captureStartMarker(),c=[],d=[];let e=this.parseTemplateElement(!0);for(d.push(e);!e.tail;)c.push(this.parseExpression()),e=this.parseTemplateElement(),d.push(e);return this.finalize({type:b.Syntax.TemplateLiteral,quasis:d,expressions:c,...this.getItemLocation(a)})}parseGroupExpression(){this.expectPunctuator("(");const a=this.inheritCoverGrammar(this.parseAssignmentExpression);this.expectPunctuator(")");return a}parseArguments(){this.expectPunctuator("(");
const a=[];if(!this.matchPunctuator(")"))for(;;){const c=this.isolateCoverGrammar(this.parseAssignmentExpression);a.push(c);if(this.matchPunctuator(")"))break;this.expectPunctuator(",");if(this.matchPunctuator(")"))break}this.expectPunctuator(")");return a}parseMemberName(){const a=this.rawToken,c=this.captureStartMarker();this.readNextRawToken();a.type!==b.TokenType.NullLiteral&&a.type!==b.TokenType.Identifier&&a.type!==b.TokenType.Keyword&&a.type!==b.TokenType.BooleanLiteral&&this.throwUnexpectedToken({rawToken:a});
return this.finalize({type:b.Syntax.Identifier,name:a.value,...this.getItemLocation(c)})}parseLeftHandSideExpression(){const a=this.captureStartMarker();let c=this.inheritCoverGrammar(this.parsePrimaryExpression);const d=this.captureStartMarker();for(var e;e=this.getMatchingPunctuator("([.");)switch(e){case "(":this.context.isAssignmentTarget=!1;c.type!==b.Syntax.Identifier&&c.type!==b.Syntax.MemberExpression&&this.throwError(b.ParsingErrorCodes.IdentiferExpected,a,d);e=this.parseArguments();c=this.finalize({type:b.Syntax.CallExpression,
callee:c,arguments:e,...this.getItemLocation(a)});continue;case "[":this.context.isAssignmentTarget=!0;this.expectPunctuator("[");e=this.isolateCoverGrammar(this.parseExpression);this.expectPunctuator("]");c=this.finalize({type:b.Syntax.MemberExpression,computed:!0,object:c,property:e,...this.getItemLocation(a)});continue;case ".":this.context.isAssignmentTarget=!0,this.expectPunctuator("."),e=this.parseMemberName(),c=this.finalize({type:b.Syntax.MemberExpression,computed:!1,object:c,property:e,...this.getItemLocation(a)})}return c}parseUpdateExpression(){const a=
this.captureStartMarker();let c=this.getMatchingPunctuator(b.updateOperators);if(c){this.readNextRawToken();var d=this.captureStartMarker(),e=this.inheritCoverGrammar(this.parseUnaryExpression);e.type!==b.Syntax.Identifier&&e.type!==b.Syntax.MemberExpression&&e.type!==b.Syntax.CallExpression&&this.throwError(b.ParsingErrorCodes.InvalidExpression,d);this.context.isAssignmentTarget||this.tolerateError(b.ParsingErrorCodes.InvalidLeftHandSideInAssignment,a);this.context.isAssignmentTarget=!1;return this.finalize({type:b.Syntax.UpdateExpression,
operator:c,argument:e,prefix:!0,...this.getItemLocation(a)})}d=this.captureStartMarker();e=this.inheritCoverGrammar(this.parseLeftHandSideExpression);const f=this.captureStartMarker();if(this.hasLineTerminator)return e;c=this.getMatchingPunctuator(b.updateOperators);if(!c)return e;e.type!==b.Syntax.Identifier&&e.type!==b.Syntax.MemberExpression&&this.throwError(b.ParsingErrorCodes.InvalidExpression,d,f);this.context.isAssignmentTarget||this.tolerateError(b.ParsingErrorCodes.InvalidLeftHandSideInAssignment,
a);this.readNextRawToken();this.context.isAssignmentTarget=!1;return this.finalize({type:b.Syntax.UpdateExpression,operator:c,argument:e,prefix:!1,...this.getItemLocation(a)})}parseUnaryExpression(){const a=this.getMatchingPunctuator(b.unaryOperators);if(a){const c=this.captureStartMarker();this.readNextRawToken();const d=this.inheritCoverGrammar(this.parseUnaryExpression);this.context.isAssignmentTarget=!1;return this.finalize({type:b.Syntax.UnaryExpression,operator:a,argument:d,prefix:!0,...this.getItemLocation(c)})}return this.parseUpdateExpression()}parseBinaryExpression(){var a=
this.rawToken,c=this.inheritCoverGrammar(this.parseUnaryExpression);if(this.rawToken.type!==b.TokenType.Punctuator)return c;var d=this.rawToken.value,e=p(d);if(0===e)return c;this.readNextRawToken();this.context.isAssignmentTarget=!1;a=[a,this.rawToken];var f=this.inheritCoverGrammar(this.parseUnaryExpression);d=[c,d,f];for(var g=[e];this.rawToken.type===b.TokenType.Punctuator&&0<(e=p(this.rawToken.value));){for(;2<d.length&&e<=g[g.length-1];){f=d.pop();const l=d.pop();g.pop();c=d.pop();a.pop();var k=
a[a.length-1];k=r(k,k.lineStart);d.push(this.finalize(this.createBinaryOrLogicalExpression(k,l,c,f)))}d.push(this.rawToken.value);g.push(e);a.push(this.rawToken);this.readNextRawToken();d.push(this.inheritCoverGrammar(this.parseUnaryExpression))}e=d.length-1;c=d[e];for(g=a.pop();1<e;){f=a.pop();if(!f)break;g=r(f,g?.lineStart);c=this.finalize(this.createBinaryOrLogicalExpression(g,d[e-1],d[e-2],c));e-=2;g=f}return c}createBinaryOrLogicalExpression(a,c,d,e){const f=b.logicalOperators.includes(c)?b.Syntax.LogicalExpression:
b.Syntax.BinaryExpression;if(f===b.Syntax.BinaryExpression)return{type:f,operator:c,left:d,right:e,...this.getItemLocation(a)};d.type!==b.Syntax.AssignmentExpression&&d.type!==b.Syntax.UpdateExpression||this.throwError(b.ParsingErrorCodes.InvalidExpression,...t(d));e.type!==b.Syntax.AssignmentExpression&&e.type!==b.Syntax.UpdateExpression||this.throwError(b.ParsingErrorCodes.InvalidExpression,...t(d));return{type:f,operator:c,left:d,right:e,...this.getItemLocation(a)}}parseAssignmentExpression(){const a=
this.captureStartMarker(),c=this.inheritCoverGrammar(this.parseBinaryExpression);var d=this.captureStartMarker();const e=this.getMatchingPunctuator(b.assignmentOperators);if(!e)return c;c.type!==b.Syntax.Identifier&&c.type!==b.Syntax.MemberExpression&&this.throwError(b.ParsingErrorCodes.InvalidExpression,a,d);this.context.isAssignmentTarget||this.tolerateError(b.ParsingErrorCodes.InvalidLeftHandSideInAssignment,a);this.matchPunctuator("\x3d")||(this.context.isAssignmentTarget=!1);this.readNextRawToken();
d=this.isolateCoverGrammar(this.parseAssignmentExpression);return this.finalize({type:b.Syntax.AssignmentExpression,left:c,operator:e,right:d,...this.getItemLocation(a)})}parseExpression(){return this.isolateCoverGrammar(this.parseAssignmentExpression)}parseStatements(a){const c=[];for(;this.rawToken.type!==b.TokenType.EOF&&!this.matchPunctuator(a);){const d=this.parseStatementListItem();b.isEmptyStatement(d)||c.push(d)}return c}parseStatementListItem(){this.context.isAssignmentTarget=!0;return this.matchKeyword(b.Keywords.Function)?
this.parseFunctionDeclaration():this.matchKeyword(b.Keywords.Export)?this.parseExportDeclaration():this.matchKeyword(b.Keywords.Import)?this.parseImportDeclaration():this.parseStatement()}parseBlock(){const a=this.captureStartMarker();this.expectPunctuator("{");const c=this.parseStatements("}");this.expectPunctuator("}");return this.finalize({type:b.Syntax.BlockStatement,body:c,...this.getItemLocation(a)})}parseObjectStatement(){const a=this.captureStartMarker(),c=this.parseObjectExpression();return this.finalize({type:b.Syntax.ExpressionStatement,
expression:c,...this.getItemLocation(a)})}parseBlockOrObjectStatement(){return this.context.curlyParsingType===m.AsObject||this.peekAhead(a=>{let c=a();if(c.type!==b.TokenType.Identifier&&c.type!==b.TokenType.StringLiteral)return!1;c=a();return c.type!==b.TokenType.Punctuator||":"!==c.value?!1:!0})?this.parseObjectStatement():this.parseBlock()}parseIdentifier(){const a=this.rawToken;if(a.type!==b.TokenType.Identifier)return null;const c=this.captureStartMarker();this.readNextRawToken();return this.finalize({type:b.Syntax.Identifier,
name:a.value,...this.getItemLocation(c)})}parseVariableDeclarator(){const a=this.captureStartMarker(),c=this.parseIdentifier();c||this.throwUnexpectedToken({code:b.ParsingErrorCodes.IdentiferExpected});let d=null;if(this.matchPunctuator("\x3d")){this.readNextRawToken();const e=this.rawToken;try{d=this.isolateCoverGrammar(this.parseAssignmentExpression)}catch(f){this.throwUnexpectedToken({rawToken:e,code:b.ParsingErrorCodes.InvalidVariableAssignment})}}return this.finalize({type:b.Syntax.VariableDeclarator,
id:c,init:d,...this.getItemLocation(a)})}parseVariableDeclarationList(){const a=[this.parseVariableDeclarator()];for(;this.matchPunctuator(",");)this.readNextRawToken(),a.push(this.parseVariableDeclarator());return a}parseVariableDeclaration(){const a=this.captureStartMarker();this.expectKeyword(b.Keywords.Var);const c=this.parseVariableDeclarationList();this.consumeSemicolon();return this.finalize({type:b.Syntax.VariableDeclaration,declarations:c,kind:"var",...this.getItemLocation(a)})}parseEmptyStatement(){const a=
this.captureStartMarker();this.expectPunctuator(";");return this.finalize({type:b.Syntax.EmptyStatement,...this.getItemLocation(a)})}parseExpressionStatement(){const a=this.captureStartMarker(),c=this.parseExpression();this.consumeSemicolon();return this.finalize({type:b.Syntax.ExpressionStatement,expression:c,...this.getItemLocation(a)})}parseIfClause(){return this.withBlockContext(h.IfClause,this.parseStatement)}parseIfStatement(){const a=this.captureStartMarker();this.expectKeyword(b.Keywords.If);
this.expectPunctuator("(");var c=this.captureStartMarker();const d=this.parseExpression();var e=this.captureStartMarker();this.expectPunctuator(")");d.type!==b.Syntax.AssignmentExpression&&d.type!==b.Syntax.UpdateExpression||this.throwError(b.ParsingErrorCodes.InvalidExpression,c,e);c=this.parseIfClause();e=null;this.matchKeyword(b.Keywords.Else)&&(this.readNextRawToken(),e=this.parseIfClause());return this.finalize({type:b.Syntax.IfStatement,test:d,consequent:c,alternate:e,...this.getItemLocation(a)})}parseWhileStatement(){const a=
this.captureStartMarker();this.expectKeyword(b.Keywords.While);this.expectPunctuator("(");var c=this.captureStartMarker();const d=this.parseExpression(),e=this.captureStartMarker();this.expectPunctuator(")");d.type!==b.Syntax.AssignmentExpression&&d.type!==b.Syntax.UpdateExpression||this.throwError(b.ParsingErrorCodes.InvalidExpression,c,e);c=this.withBlockContext(h.WhileLoop,this.parseStatement);return this.finalize({type:b.Syntax.WhileStatement,test:d,body:c,...this.getItemLocation(a)})}parseForStatement(){let a=
null,c=null,d=null,e=null,f=null;const g=this.captureStartMarker();this.expectKeyword(b.Keywords.For);this.expectPunctuator("(");if(this.matchPunctuator(";"))this.readNextRawToken();else if(this.matchKeyword(b.Keywords.Var)){var k=this.captureStartMarker();this.readNextRawToken();var l=this.parseVariableDeclarationList();1===l.length&&this.matchKeyword(b.Keywords.In)?(l[0].init&&this.throwError(b.ParsingErrorCodes.ForInOfLoopInitializer,k),e=this.finalize({type:b.Syntax.VariableDeclaration,declarations:l,
kind:"var",...this.getItemLocation(k)}),this.readNextRawToken(),f=this.parseExpression()):(this.matchKeyword(b.Keywords.In)&&this.throwError(b.ParsingErrorCodes.InvalidLeftHandSideInForIn,k),a=this.finalize({type:b.Syntax.VariableDeclaration,declarations:l,kind:"var",...this.getItemLocation(k)}),this.expectPunctuator(";"))}else k=this.context.isAssignmentTarget,l=this.captureStartMarker(),a=this.inheritCoverGrammar(this.parseAssignmentExpression),this.matchKeyword(b.Keywords.In)?(this.context.isAssignmentTarget||
this.tolerateError(b.ParsingErrorCodes.InvalidLeftHandSideInForIn,l),a.type!==b.Syntax.Identifier&&this.throwError(b.ParsingErrorCodes.InvalidLeftHandSideInForIn,l),this.readNextRawToken(),e=a,f=this.parseExpression(),a=null):(this.context.isAssignmentTarget=k,this.expectPunctuator(";"));e||(this.matchPunctuator(";")||(c=this.isolateCoverGrammar(this.parseExpression)),this.expectPunctuator(";"),this.matchPunctuator(")")||(d=this.isolateCoverGrammar(this.parseExpression)));this.expectPunctuator(")");
k=this.withBlockContext(h.ForLoop,()=>this.isolateCoverGrammar(this.parseStatement));return e&&f?this.finalize({type:b.Syntax.ForInStatement,left:e,right:f,body:k,...this.getItemLocation(g)}):this.finalize({type:b.Syntax.ForStatement,init:a,test:c,update:d,body:k,...this.getItemLocation(g)})}parseContinueStatement(){const a=this.captureStartMarker();this.expectKeyword(b.Keywords.Continue);this.consumeSemicolon();return this.finalize({type:b.Syntax.ContinueStatement,...this.getItemLocation(a)})}parseBreakStatement(){const a=
this.captureStartMarker();this.expectKeyword(b.Keywords.Break);this.consumeSemicolon();return this.finalize({type:b.Syntax.BreakStatement,...this.getItemLocation(a)})}parseReturnStatement(){const a=this.captureStartMarker();this.expectKeyword(b.Keywords.Return);const c=(this.matchPunctuator(";")||this.matchPunctuator("}")||this.hasLineTerminator||this.rawToken.type===b.TokenType.EOF)&&this.rawToken.type!==b.TokenType.StringLiteral&&this.rawToken.type!==b.TokenType.Template?null:this.parseExpression();
this.consumeSemicolon();return this.finalize({type:b.Syntax.ReturnStatement,argument:c,...this.getItemLocation(a)})}parseStatement(){switch(this.rawToken.type){case b.TokenType.BooleanLiteral:case b.TokenType.NullLiteral:case b.TokenType.NumericLiteral:case b.TokenType.StringLiteral:case b.TokenType.Template:case b.TokenType.Identifier:return this.parseExpressionStatement();case b.TokenType.Punctuator:return"{"===this.rawToken.value?this.parseBlockOrObjectStatement():"("===this.rawToken.value?this.parseExpressionStatement():
";"===this.rawToken.value?this.parseEmptyStatement():this.parseExpressionStatement();case b.TokenType.Keyword:switch(this.rawToken.value.toLowerCase()){case b.Keywords.Break:return this.parseBreakStatement();case b.Keywords.Continue:return this.parseContinueStatement();case b.Keywords.For:return this.parseForStatement();case b.Keywords.Function:return this.parseFunctionDeclaration();case b.Keywords.If:return this.parseIfStatement();case b.Keywords.Return:return this.parseReturnStatement();case b.Keywords.Var:return this.parseVariableDeclaration();
case b.Keywords.While:return this.parseWhileStatement();default:return this.parseExpressionStatement()}default:return this.throwUnexpectedToken({rawToken:this.rawToken})}}parseFormalParameters(){const a=[];this.expectPunctuator("(");if(!this.matchPunctuator(")"))for(;this.rawToken.type!==b.TokenType.EOF;){const c=this.parseIdentifier();c||this.throwUnexpectedToken({rawToken:this.rawToken,code:b.ParsingErrorCodes.IdentiferExpected});a.push(c);if(this.matchPunctuator(")"))break;this.expectPunctuator(",");
if(this.matchPunctuator(")"))break}this.expectPunctuator(")");return a}parseFunctionDeclaration(){(this.context.blockContext&h.Function)===h.Function&&this.throwUnexpectedToken({code:b.ParsingErrorCodes.NoFunctionInsideFunction});(this.context.blockContext&h.WhileLoop)!==h.WhileLoop&&(this.context.blockContext&h.IfClause)!==h.IfClause||this.throwUnexpectedToken({code:b.ParsingErrorCodes.NoFunctionInsideBlock});const a=this.captureStartMarker();this.expectKeyword(b.Keywords.Function);const c=this.parseIdentifier();
c||this.throwUnexpectedToken({code:b.ParsingErrorCodes.InvalidFunctionIdentifier});const d=this.parseFormalParameters(),e=this.context.blockContext;this.context.blockContext|=h.Function;const f=this.parseBlock();this.context.blockContext=e;return this.finalize({type:b.Syntax.FunctionDeclaration,id:c,params:d,body:f,...this.getItemLocation(a)})}parseScript(){var a=this.captureStartMarker();const c=this.parseStatements();a=this.finalize({type:b.Syntax.Program,body:c,...this.getItemLocation(a)});this.options.tokens&&
(a.tokens=this.tokens);this.options.tolerant&&(a.errors=this.errorHandler.errors);return a}parseExportDeclaration(){this.context.blockContext!==h.None&&this.throwUnexpectedToken({code:b.ParsingErrorCodes.ModuleExportRootOnly});let a=null;const c=this.captureStartMarker();this.expectKeyword(b.Keywords.Export);this.matchKeyword(b.Keywords.Var)?a=this.parseVariableDeclaration():this.matchKeyword("function")?a=this.parseFunctionDeclaration():this.throwUnexpectedToken({code:b.ParsingErrorCodes.InvalidExpression});
return this.finalize({type:b.Syntax.ExportNamedDeclaration,declaration:a,specifiers:[],source:null,...this.getItemLocation(c)})}parseModuleSpecifier(){const a=this.captureStartMarker(),c=this.rawToken;if(c.type===b.TokenType.StringLiteral)return this.readNextRawToken(),this.finalize({type:b.Syntax.Literal,value:c.value,raw:this.getSourceValue(c),isString:!0,...this.getItemLocation(a)});this.throwError(b.ParsingErrorCodes.InvalidModuleUri,a)}parseDefaultSpecifier(){const a=this.captureStartMarker(),
c=this.parseIdentifier();c||this.throwUnexpectedToken({code:b.ParsingErrorCodes.IdentiferExpected});return this.finalize({type:b.Syntax.ImportDefaultSpecifier,local:c,...this.getItemLocation(a)})}parseImportDeclaration(){this.context.blockContext!==h.None&&this.throwUnexpectedToken({code:b.ParsingErrorCodes.ModuleImportRootOnly});const a=this.captureStartMarker();this.expectKeyword(b.Keywords.Import);const c=this.parseDefaultSpecifier();this.expectContextualKeyword(b.Keywords.From);const d=this.parseModuleSpecifier();
return this.finalize({type:b.Syntax.ImportDeclaration,specifiers:[c],source:d,...this.getItemLocation(a)})}}n.Parser=w;n.binaryOperatorPrecedence=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});