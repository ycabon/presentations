// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../arcade/arcadeCompiler ../arcade/ArcadeModuleResolver ../arcade/arcadeRuntime ../arcade/executionError ../arcade/parser ../arcade/treeAnalysis ../arcade/functions/geomsync ../core/has ../core/maybe".split(" "),function(n,d,p,da,r,q,N,k,ea,O,fa){function P(a,b){if(!0===b.useAsync||!0===a.isAsync)return ha(a,b);if(O("esri-csp-restrictions"))return function(c){return r.executeScript(a,c)};try{return p.compileScript(a,b)}catch(c){if("esri.arcade.arcadeuncompilableerror"===c.declaredRootClass)return function(g){return r.executeScript(a,
g)};throw c;}}function ha(a,b){if(null===h)throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.AsyncNotEnabled,null);if(O("esri-csp-restrictions"))return function(c){return h.executeScript(a,c)};try{return p.compileScript(a,b,!0)}catch(c){if("esri.arcade.arcadeuncompilableerror"===c.declaredRootClass)return function(g){return h.executeScript(a,g)};throw c;}}function Q(a){r.extend(a);p.extend(a,"sync");null===h?w.push(a):(p.extend(a,"async"),h.extend(a))}function x(a,b=[]){return N.parseScript(a,
b)}function R(a,b,c=[]){a=N.parseScript(a,c);return y(a,b)}function y(a,b){if(!0===b.useAsync||!0===a.isAsync){if(null===h)throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.AsyncNotEnabled,null);return h.executeScript(a,b)}return r.executeScript(a,b)}function z(a,b){return k.referencesMember(a,b)}function S(a,b){return k.referencesFunction(a,b)}function T(a,b=!1){void 0===b&&(b=!1);return k.findFieldLiterals(a)}function U(a){return k.findExpectedFieldLiterals(a)}function t(a,b=[]){void 0===
a.usesGeometry&&k.findScriptDependencies(a,b);return!0===a.usesGeometry}function A(){return B?B:B=C()}async function C(){const a=await new Promise((b,c)=>n(["../geometry/geometryEngine"],b,c));D=!0;ea.setGeometryEngine(a);return!0}function u(){return null!==E?E:E=F()}async function F(){await p.enableAsyncSupport();h=await new Promise((a,b)=>n(["../arcade/arcadeAsyncRuntime"],a,b));for(const a of w)h.extend(a),p.extend(a,"async");w=null;return!0}function V(){return G}function H(){return h?!0:!1}function W(){return D}
function I(){return J?J:J=K()}async function K(){await u();const [a,b,c,g,m]=await Promise.all([new Promise((e,f)=>n(["../arcade/featureSetUtils"],e,f)),new Promise((e,f)=>n(["../arcade/functions/featuresetbase"],e,f)),new Promise((e,f)=>n(["../arcade/functions/featuresetgeom"],e,f)),new Promise((e,f)=>n(["../arcade/functions/featuresetstats"],e,f)),new Promise((e,f)=>n(["../arcade/functions/featuresetstring"],e,f))]);X=a;h.extend([b,c,g,m]);p.extend([b,c,g,m],"async");return G=!0}function L(a,b=
[]){void 0===a.usesFeatureSet&&k.findScriptDependencies(a,b);return!0===a.usesFeatureSet}function Y(a,b=[]){void 0===a.isAsync&&k.findScriptDependencies(a,b);return!0===a.isAsync}async function Z(a,b,c=[],g=!1,m=null){return v(new Set,a,b,c,g,m)}async function v(a,b,c,g=[],m=!1,e=null){b="string"===typeof b?x(b):b;const f=[];if(b&&(!1===D&&(t(b)||m)&&f.push(A()),!1===H()&&(!0===b.isAsync||c)&&f.push(u()),!1===G)){var l;if(!(l=L(b)))a:{if(g)for(const ia of g)if(z(b,ia)){l=!0;break a}l=!1}l&&f.push(I())}f.length&&
await Promise.all(f);await M(a,b,e,c,m);return!0}function aa(a,b=[]){void 0===a.usesModules&&k.findScriptDependencies(a,b);return!0===a.usesModules}async function M(a,b,c=null,g=!1,m=!1){var e=k.findModuleImports(b);null===c&&0<e.length&&(c=da.ArcadeModuleResolver.getDefault());b.loadedModules={};for(const f of e){fa.assertIsSome(c);e=c.normalizeModuleUri(f.source);if(a.has(e.uri))throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.CircularModules,null);a.add(e.uri);const l=await c.fetchModule(e);
await v(a,l,g,[],m,c);a.delete(e.uri);l.isAsync&&(b.isAsync=!0);l.usesFeatureSet&&(b.usesFeatureSet=!0);l.usesGeometry&&(b.usesGeometry=!0);b.loadedModules[f.libname]={uri:e.uri,script:l}}}function ba(a){if(t(a))return!0;a=k.findFunctionCalls(a);let b=!1;for(let c=0;c<a.length;c++)if(ja.has(a[c])){b=!0;break}return b}function ca(){return X}const ja=new Set("feature angle bearing centroid envelopeintersects extent geometry isselfintersecting ringisclockwise".split(" "));let G=!1,D=!1,h=null,w=[],B=
null,E=null,J=null,X=null;const ka=Object.freeze(Object.defineProperty({__proto__:null,_loadScriptDependenciesImpl:v,compileScript:P,enableAsyncSupport:u,enableAsyncSupportImpl:F,enableFeatureSetSupport:I,enableFeatureSetSupportImpl:K,enableGeometrySupport:A,enableGeometrySupportImpl:C,executeScript:y,extend:Q,extractExpectedFieldLiterals:U,extractFieldLiterals:T,featureSetUtils:ca,isAsyncEnabled:H,isFeatureSetSupportEnabled:V,isGeometryEnabled:W,loadDependentModules:M,loadScriptDependencies:Z,parseAndExecuteScript:R,
parseScript:x,referencesFunction:S,referencesMember:z,scriptIsAsync:Y,scriptTouchesGeometry:ba,scriptUsesFeatureSet:L,scriptUsesGeometryEngine:t,scriptUsesModules:aa},Symbol.toStringTag,{value:"Module"}));d._loadScriptDependenciesImpl=v;d.arcade=ka;d.compileScript=P;d.enableAsyncSupport=u;d.enableAsyncSupportImpl=F;d.enableFeatureSetSupport=I;d.enableFeatureSetSupportImpl=K;d.enableGeometrySupport=A;d.enableGeometrySupportImpl=C;d.executeScript=y;d.extend=Q;d.extractExpectedFieldLiterals=U;d.extractFieldLiterals=
T;d.featureSetUtils=ca;d.isAsyncEnabled=H;d.isFeatureSetSupportEnabled=V;d.isGeometryEnabled=W;d.loadDependentModules=M;d.loadScriptDependencies=Z;d.parseAndExecuteScript=R;d.parseScript=x;d.referencesFunction=S;d.referencesMember=z;d.scriptIsAsync=Y;d.scriptTouchesGeometry=ba;d.scriptUsesFeatureSet=L;d.scriptUsesGeometryEngine=t;d.scriptUsesModules=aa});