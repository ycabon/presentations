// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../request","../support/requestUtils"],function(e,f,g){class d extends EventTarget{constructor(){super(...arguments);this._readyState=0;this._responseType="";this.timeout=0;this._withCredentials=!1;this.onreadystatechange=this.ontimeout=this.onprogress=this.onloadstart=this.onloadend=this.onload=this.onerror=this.onabort=null;this.UNSENT=0;this.OPENED=1;this.HEADERS_RECEIVED=2;this.LOADING=3;this.DONE=4;this._error=this._abortController=null;this._options={};this._response=null;
this._sendFlag=!1;this._url=""}get readyState(){return this._readyState}get response(){return""===this.responseType||"text"===this.responseType?this.responseText:this.readyState!==this.DONE||this._error||!this._response?null:this._response.data}get responseText(){""!==this.responseType&&"text"!==this.responseType&&this._throwDOMException();return this.readyState!==this.DONE?"":this._response?this._response.data:null!=this._error?.raw?"string"===typeof this._error.raw?this._error.raw:JSON.stringify(this._error.raw):
""}get responseType(){return this._responseType}set responseType(a){if("document"!==a||globalThis instanceof Window)this.readyState!==this.LOADING&&this.readyState!==this.DONE||this._throwDOMException(),this._responseType=a}get responseURL(){return(this._response||this._error)?.url??""}get responseXML(){""!==this.responseType&&"document"!==this.responseType&&this._throwDOMException();return this.readyState!==this.DONE?null:this._response?.data??null}get status(){return(this._response||this._error)?.httpStatus??
0}get statusText(){return""}get upload(){console.warn("upload not implemented");return null}get withCredentials(){return this._withCredentials}set withCredentials(a){this.readyState!==this.UNSENT&&this.readyState!==this.OPENED&&this._throwDOMException();this._withCredentials=a}abort(){this.readyState===this.OPENED&&this._sendFlag||this.readyState===this.HEADERS_RECEIVED||this.readyState===this.LOADING?(this._sendFlag=!1,this._response=this._error=null,this._abortController?.abort(),this._updateReadyState(this.DONE),
this._dispatchProgressEvent("abort"),this._dispatchProgressEvent("loadend")):this.readyState===this.DONE&&this._updateReadyState(this.UNSENT)}getAllResponseHeaders(){let a="";const b=(this._response||this._error)?.getAllHeaders?.();if(b)for(const [c,h]of b)a+=`${c}: ${h}\r\n`;return a}getResponseHeader(a){return(this._response||this._error)?.getHeader?.(a)??null}open(a,b){this._sendFlag=!1;this._options={};switch(a){case "GET":this._options.method="auto";break;case "POST":this._options.method="post";
break;case "HEAD":this._options.method="head";break;case "DELETE":this._options.method="delete";break;case "PUT":this._options.method="put"}this._url=b;this._response=this._error=null;this._abortController=new AbortController;this._updateReadyState(this.OPENED)}overrideMimeType(a){throw Error("overrideMimeType not implemented");}send(a){(this.readyState!==this.OPENED||this._sendFlag)&&this._throwDOMException();this._sendFlag=!0;this._updateReadyState(this.LOADING);this._dispatchProgressEvent("loadstart");
const b=this._options;b.body=a instanceof URLSearchParams?a.toString():a;b.responseType=""===this.responseType?"text":"arraybuffer"===this.responseType?"array-buffer":this.responseType;b.signal=this._abortController?.signal;this.timeout&&(b.timeout=this.timeout);this.withCredentials&&(b.withCredentials=!0);f(this._url,b).then(c=>{this._response=c;this._updateReadyState(this.DONE);this._dispatchProgressEvent("load")}).catch(c=>{this._sendFlag&&(this._error=c.details,this._updateReadyState(this.DONE),
g.isTimeoutError(c)?this._dispatchProgressEvent("timeout"):"AbortError"===c.name?this._dispatchProgressEvent("abort"):this._dispatchProgressEvent("error"))}).finally(()=>{this._sendFlag&&this._dispatchProgressEvent("loadend")})}setRequestHeader(a,b){(this.readyState!==this.OPENED||this._sendFlag)&&this._throwDOMException();let c;(c=this._options).headers??(c.headers={});this._options.headers[a]=b}_dispatchProgressEvent(a){const b=new ProgressEvent(a,{loaded:0,total:0});this.dispatchEvent(b);this[`on${a}`]?.(b)}_throwDOMException(){throw new DOMException("",
"InvalidStateError");}_updateReadyState(a){this._readyState!==a&&(this._readyState=a,a!==this.UNSENT&&(a=new Event("readystatechange"),this.dispatchEvent(a),this.onreadystatechange?.(a)))}}d.UNSENT=0;d.OPENED=1;d.HEADERS_RECEIVED=2;d.LOADING=3;d.DONE=4;e.XHRAdapter=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});