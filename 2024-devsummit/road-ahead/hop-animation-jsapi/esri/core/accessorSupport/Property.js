// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","./ObservableBase","./PropertyOrigin","./tracking","./tracking/Flags"],function(g,k,l,f,c){class m extends k.ObservableBase{constructor(a,b){super();this.propertyName=a;this.metadata=b;this._handles=this._accessed=null;this.flags=0;this.flags=c.Flags.Dirty|(b.nonNullable?c.Flags.NonNullable:0)|(b.hasOwnProperty("value")?c.Flags.HasDefaultValue:0)|(void 0===b.get?c.Flags.DepTrackingInitialized:0)|(void 0===b.dependsOn?c.Flags.AutoTracked:0)}destroy(){if(this.flags&c.Flags.Dirty)this.onCommitted();
super.destroy();this._accessed=null;this._clearObservationHandles()}getComputed(a){f.trackAccess(this);var b=a.store;const d=this.propertyName;var e=this.flags;const h=b.get(d);if(e&c.Flags.Computing||~e&c.Flags.Dirty&&b.has(d))return h;this.flags|=c.Flags.Computing;a=a.host;e&c.Flags.AutoTracked?e=f.runTracked(this,this.metadata.get,a):(f.trackExplicitDependencies(a,this),e=this.metadata.get.call(a));b.set(d,e,l.OriginId.COMPUTED);b=b.get(d);b===h?this.flags&=~c.Flags.Dirty:f.runUntracked(this.commit,
this);this.flags&=~c.Flags.Computing;return b}onObservableAccessed(a){if(a!==this){var b=this._accessed;if(null==b)this._accessed=b=[];else if(b.includes(a))return;b.push(a)}}onTrackingEnd(){this._clearObservationHandles();this.flags|=c.Flags.DepTrackingInitialized;const a=this._accessed;if(null!=a&&0!==a.length){var b=this._handles;null==b&&(this._handles=b=[]);for(let d=0;d<a.length;++d)b.push(a[d].observe(this));a.length=0}}notifyChange(){this.onInvalidated();this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=
~c.Flags.Dirty;this.onCommitted()}_clearObservationHandles(){const a=this._handles;if(null!==a){for(let b=0;b<a.length;++b)a[b].remove();a.length=0}}onInvalidated(){~this.flags&c.Flags.Overridden&&(this.flags|=c.Flags.Dirty);const a=this._observers;if(a&&0<a.length)for(const b of a)b.onInvalidated()}onCommitted(){var a=this._observers;if(a&&0<a.length){a=a.slice();for(const b of a)b.onCommitted()}}}g.Property=m;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});