// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../time"],function(B,P){function Q(r,a){C??=document.createElement("canvas");C.width=r;C.height=a;return C.getContext("2d",{willReadFrequently:!0})}function R(r){x??=document.createElement("canvas");J??=x.getContext("2d",{willReadFrequently:!0});x.width=r.width;x.height=r.height;J.putImageData(r,0,0);return x}function K(r){const a=new Uint8Array(r);return!S.some((b,f)=>b!==a[f])}var t={},y={},n={};Object.defineProperty(n,"__esModule",{value:!0});n.loop=n.conditional=n.parse=void 0;
n.parse=function f(a,b){var g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:g;if(Array.isArray(b))b.forEach(function(d){return f(a,d,g,c)});else if("function"===typeof b)b(a,g,c,f);else{var m=Object.keys(b)[0];Array.isArray(b[m])?(c[m]={},f(a,b[m],g,c[m])):c[m]=b[m](a,g,c,f)}return g};n.conditional=function(a,b){return function(f,g,c,m){b(f,g,c)&&m(f,a,g,c)}};n.loop=function(a,b){return function(f,g,c,m){for(var d=[],h=f.pos;b(f,
g,c);){var k={};m(f,a,g,k);if(f.pos===h)break;h=f.pos;d.push(k)}return d}};var e={};Object.defineProperty(e,"__esModule",{value:!0});e.readBits=e.readArray=e.readUnsigned=e.readString=e.peekBytes=e.readBytes=e.peekByte=e.readByte=e.buildStream=void 0;e.buildStream=function(a){return{data:a,pos:0}};var L=function(){return function(a){return a.data[a.pos++]}};e.readByte=L;e.peekByte=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return function(b){return b.data[b.pos+a]}};
var D=function(a){return function(b){return b.data.subarray(b.pos,b.pos+=a)}};e.readBytes=D;e.peekBytes=function(a){return function(b){return b.data.subarray(b.pos,b.pos+a)}};e.readString=function(a){return function(b){return Array.from(D(a)(b)).map(function(f){return String.fromCharCode(f)}).join("")}};e.readUnsigned=function(a){return function(b){b=D(2)(b);return a?(b[1]<<8)+b[0]:(b[0]<<8)+b[1]}};e.readArray=function(a,b){return function(f,g,c){g="function"===typeof b?b(f,g,c):b;c=D(a);for(var m=
Array(g),d=0;d<g;d++)m[d]=c(f);return m}};e.readBits=function(a){return function(b){b=L()(b);for(var f=Array(8),g=0;8>g;g++)f[7-g]=!!(b&1<<g);return Object.keys(a).reduce(function(c,m){var d=a[m];if(d.length){for(var h=d.length,k=0,l=0;l<h;l++)k+=f[d.index+l]&&Math.pow(2,h-l-1);c[m]=k}else c[m]=f[d.index];return c},{})}};(function(a){Object.defineProperty(a,"__esModule",{value:!0});a["default"]=void 0;var b={blocks:function(d){for(var h=[],k=d.data.length,l=0,p=(0,e.readByte)()(d);0!==p&&p;p=(0,e.readByte)()(d)){if(d.pos+
p>=k){k-=d.pos;h.push((0,e.readBytes)(k)(d));l+=k;break}h.push((0,e.readBytes)(p)(d));l+=p}d=new Uint8Array(l);for(k=l=0;k<h.length;k++)d.set(h[k],l),l+=h[k].length;return d}},f=(0,n.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(d){d=
(0,e.peekBytes)(2)(d);return 33===d[0]&&249===d[1]}),g=(0,n.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,n.conditional)({lct:(0,e.readArray)(3,function(d,h,k){return Math.pow(2,k.descriptor.lct.size+1)})},function(d,h,k){return k.descriptor.lct.exists}),
{data:[{minCodeSize:(0,e.readByte)()},b]}]},function(d){return 44===(0,e.peekByte)()(d)}),c=(0,n.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,h,k){return(0,e.readBytes)(k.text.blockSize)(d)}},b]},function(d){d=(0,e.peekBytes)(2)(d);return 33===d[0]&&1===d[1]}),m=(0,n.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,h,k){return(0,e.readString)(k.blockSize)(d)}},b]},function(d){d=(0,e.peekBytes)(2)(d);
return 33===d[0]&&255===d[1]});b=(0,n.conditional)({comment:[{codes:(0,e.readBytes)(2)},b]},function(d){d=(0,e.peekBytes)(2)(d);return 33===d[0]&&254===d[1]});f=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,n.conditional)({gct:(0,e.readArray)(3,
function(d,h){return Math.pow(2,h.lsd.gct.size+1)})},function(d,h){return h.lsd.gct.exists}),{frames:(0,n.loop)([f,m,b,g,c],function(d){d=(0,e.peekByte)()(d);return 33===d||44===d})}];a["default"]=f})(y);var E={};Object.defineProperty(E,"__esModule",{value:!0});E.deinterlace=void 0;E.deinterlace=function(a,b){for(var f=Array(a.length),g=a.length/b,c=[0,4,2,1],m=[8,8,4,2],d=0,h=0;4>h;h++)for(var k=c[h];k<g;k+=m[h]){var l=k,p=a.slice(d*b,(d+1)*b);f.splice.apply(f,[l*b,b].concat(p));d++}return f};var F=
{};Object.defineProperty(F,"__esModule",{value:!0});F.lzw=void 0;F.lzw=function(a,b,f){var g,c,m,d,h,k,l,p,H=Array(f),I=Array(4096),z=Array(4096),A=Array(4097);var v=1<<a;var T=v+1;var q=v+2;var w=-1;var u=a+1;var G=(1<<u)-1;for(c=0;c<v;c++)I[c]=0,z[c]=c;for(m=d=g=h=k=p=l=0;m<f;){if(0===k){if(g<u){d+=b[l]<<g;g+=8;l++;continue}c=d&G;d>>=u;g-=u;if(c>q||c==T)break;if(c==v){u=a+1;G=(1<<u)-1;q=v+2;w=-1;continue}if(-1==w){A[k++]=z[c];h=w=c;continue}var U=c;c==q&&(A[k++]=h,c=w);for(;c>v;)A[k++]=z[c],c=I[c];
h=z[c]&255;A[k++]=h;4096>q&&(I[q]=w,z[q]=h,q++,0===(q&G)&&4096>q&&(u++,G+=q));w=U}k--;H[p++]=A[k];m++}for(m=p;m<f;m++)H[m]=0;return H};Object.defineProperty(t,"__esModule",{value:!0});var N=t.decompressFrames=t.decompressFrame=M=t.parseGIF=void 0,V=y&&y.__esModule?y:{default:y},M=t.parseGIF=function(a){a=new Uint8Array(a);return(0,n.parse)((0,e.buildStream)(a),V["default"])},O=function(a,b,f){if(a.image){var g=a.image,c=(0,F.lzw)(g.data.minCodeSize,g.data.blocks,g.descriptor.width*g.descriptor.height);
g.descriptor.lct.interlaced&&(c=(0,E.deinterlace)(c,g.descriptor.width));c={pixels:c,dims:{top:a.image.descriptor.top,left:a.image.descriptor.left,width:a.image.descriptor.width,height:a.image.descriptor.height}};c.colorTable=g.descriptor.lct&&g.descriptor.lct.exists?g.lct:b;a.gce&&(c.delay=10*(a.gce.delay||10),c.disposalType=a.gce.extras.disposal,a.gce.extras.transparentColorGiven&&(c.transparentIndex=a.gce.transparentColorIndex));if(f){a=c.pixels.length;b=new Uint8ClampedArray(4*a);for(f=0;f<a;f++){g=
4*f;var m=c.pixels[f],d=c.colorTable[m]||[0,0,0];b[g]=d[0];b[g+1]=d[1];b[g+2]=d[2];b[g+3]=m!==c.transparentIndex?255:0}c.patch=b}return c}console.warn("gif frame does not have associated image.")};t.decompressFrame=O;N=t.decompressFrames=function(a,b){return a.frames.filter(function(f){return f.image}).map(function(f){return O(f,a.gct,b)})};let C,x,J;const S=[71,73,70];B.isAnimatedGIF=function(a){function b(){m++;c+=8;const h=g.getUint8(c++);c+=h&128?3*2**((h&7)+1):0;c++;f()}function f(){let h;for(;h=
g.getUint8(c++);)c+=h}if(!K(a))return!1;const g=new DataView(a);a=g.getUint8(10);let c=13+(a&128?3*2**((a&7)+1):0),m=0;for(a=!1;!a;){switch(g.getUint8(c++)){case 33:a:{switch(g.getUint8(c++)){case 249:c++;c+=4;f();break;case 1:m++;c++;c+=12;f();break;case 254:f();break;case 255:c++;c+=8;c+=3;f();break;default:var d=!1;break a}d=!0}if(!d)return!1;break;case 44:b();break;case 59:a=!0;break;default:return!1}if(1<m)return!0}return!1};B.isGIF=K;B.parseGif=async function(a,b){b=M(a);a=N(b,!0);const {width:f,
height:g}=b.lsd;b=Q(f,g);const c=[],m=[];let d=0;for(const l of a){var h=P.Milliseconds(l.delay||100);m.push(h);d+=h;h=new ImageData(l.patch,l.dims.width,l.dims.height);var k=R(h);h=3===l.disposalType?b.getImageData(l.dims.left,l.dims.top,l.dims.width,l.dims.height):void 0;b.drawImage(k,l.dims.left,l.dims.top);k=b.getImageData(0,0,f,g);c.push(k);1!==l.disposalType&&(2===l.disposalType?b.clearRect(l.dims.left,l.dims.top,l.dims.width,l.dims.height):3===l.disposalType&&b.putImageData(h,l.dims.left,l.dims.top))}return{frameCount:a.length,
duration:d,frameDurations:m,getFrame:l=>c[l],width:f,height:g}};Object.defineProperty(B,Symbol.toStringTag,{value:"Module"})});