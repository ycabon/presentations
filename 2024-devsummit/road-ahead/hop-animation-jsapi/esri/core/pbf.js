// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["./has","./ObjectPool"],function(h,l){var f;(function(a){a[a.varint=0]="varint";a[a.fixed64=1]="fixed64";a[a.delimited=2]="delimited";a[a.fixed32=5]="fixed32";a[a.unknown=99]="unknown"})(f||={});const m=new TextDecoder("utf-8"),n=h("safari")||h("ios")?6:h("ff")?12:32;class g{constructor(a,b,d=0,c=a?a.byteLength:0){this._tag=0;this._dataType=f.unknown;this._init(a,b,d,c)}_init(a,b,d,c){this._data=a;this._dataView=b;this._pos=d;this._end=c}asUnsafe(){return this}clone(){return new g(this._data,
this._dataView,this._pos,this._end)}pos(){return this._pos}move(a){this._pos=a}nextTag(a){for(;;){if(this._pos===this._end)return!1;const b=this._decodeVarint();this._tag=b>>3;this._dataType=b&7;if(!a||a===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const a=this._decodeVarint();this._tag=a>>3;this._dataType=a&7;return!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let a=
4294967295;a=(this._data[this._pos]&127)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<7)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<14)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<21)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&15)<<28)>>>0;if(128>this._data[this._pos++])return a;throw Error("Varint overflow");}getUInt64(){return this._decodeVarint()}getSInt32(){const a=
this.getUInt32();return a>>>1^-(a&1)|0}getSInt64(){return this._decodeSVarint()}getBool(){const a=0!==this._data[this._pos];this._skip(1);return a}getEnum(){return this._decodeVarint()}getFixed64(){var a=this._dataView;const b=this._pos;a=a.getUint32(b,!0)+4294967296*a.getUint32(b+4,!0);this._skip(8);return a}getSFixed64(){var a=this._dataView;const b=this._pos;a=a.getUint32(b,!0)+4294967296*a.getInt32(b+4,!0);this._skip(8);return a}getDouble(){const a=this._dataView.getFloat64(this._pos,!0);this._skip(8);
return a}getFixed32(){const a=this._dataView.getUint32(this._pos,!0);this._skip(4);return a}getSFixed32(){const a=this._dataView.getInt32(this._pos,!0);this._skip(4);return a}getFloat(){const a=this._dataView.getFloat32(this._pos,!0);this._skip(4);return a}getString(){const a=this._getLength();var b=this._pos;b=this._toString(this._data,b,b+a);this._skip(a);return b}getBytes(){const a=this._getLength();var b=this._pos;b=this._toBytes(this._data,b,b+a);this._skip(a);return b}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(a,
b,d,c){const e=this.getMessage();a=a(e,b,d,c);e.release();return a}processMessage(a){const b=this.getMessage();a=a(b);b.release();return a}getMessage(){const a=this._getLength(),b=g.pool.acquire();b._init(this._data,this._dataView,this._pos,this._pos+a);this._skip(a);return b}release(){g.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case f.varint:this._decodeVarint();break;case f.fixed64:this._skip(8);break;case f.delimited:this._skip(this._getLength());break;case f.fixed32:this._skip(4);
break;default:throw Error("Invalid data type!");}}skipLen(a){this._skip(a)}_skip(a){if(this._pos+a>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=a}_decodeVarint(){const a=this._data;let b=this._pos,d=0,c=0;if(10<=this._end-b){if(c=a[b++],d|=c&127,0!==(c&128)&&(c=a[b++],d|=(c&127)<<7,0!==(c&128)&&(c=a[b++],d|=(c&127)<<14,0!==(c&128)&&(c=a[b++],d|=(c&127)<<21,0!==(c&128)&&(c=a[b++],d+=268435456*(c&127),0!==(c&128)&&(c=a[b++],d+=34359738368*(c&127),0!==(c&128)&&(c=a[b++],
d+=4398046511104*(c&127),0!==(c&128)&&(c=a[b++],d+=562949953421312*(c&127),0!==(c&128)&&(c=a[b++],d+=72057594037927936*(c&127),0!==(c&128)&&(c=a[b++],d+=0x7fffffffffffffff*(c&127),0!==(c&128)))))))))))throw Error("Varint too long!");}else{let e=1;for(;b!==this._end;){c=a[b];if(0===(c&128))break;++b;d+=(c&127)*e;e*=128}if(b===this._end)throw Error("Varint overrun!");++b;d+=c*e}this._pos=b;return d}_decodeSVarint(){const a=this._data;let b=0;const d=a[this._pos]&1;b=a[this._pos++];var c=0|b&127;if(0===
(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c|=(b&127)<<7;if(0===(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c|=(b&127)<<14;if(0===(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c|=(b&127)<<21;if(0===(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c+=268435456*(b&127);if(0===(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c+=34359738368*(b&127);if(0===(b&128))return d?-(c+1)/2:c/2;b=a[this._pos++];c+=4398046511104*(b&127);if(0===(b&128))return d?-(c+1)/2:c/2;c=BigInt(c);b=a[this._pos++];c+=562949953421312n*
BigInt(b&127);if(0===(b&128))return Number(d?-(c+1n)/2n:c/2n);b=a[this._pos++];c+=72057594037927936n*BigInt(b&127);if(0===(b&128))return Number(d?-(c+1n)/2n:c/2n);b=a[this._pos++];c+=9223372036854775808n*BigInt(b&127);if(0===(b&128))return Number(d?-(c+1n)/2n:c/2n);throw Error("Varint too long!");}_getLength(){if(this._dataType!==f.delimited)throw Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(a,b,d){d=Math.min(this._end,d);if(d-
b>n)return a=a.subarray(b,d),m.decode(a);let c="",e="";for(;b<d;++b){const k=a[b];k&128?e+="%"+k.toString(16):(c+=decodeURIComponent(e)+String.fromCharCode(k),e="")}e.length&&(c+=decodeURIComponent(e));return c}_toBytes(a,b,d){d=Math.min(this._end,d);return new Uint8Array(a.buffer,b,d-b)}}g.pool=new l(g,void 0,a=>{a._data=null;a._dataView=null});return g});