// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/tslib.es6 ../Accessor ../handleUtils ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),function(f,l,m,g,d,n,p,q){f.UpdatingHandles=class extends m{constructor(){super(...arguments);this.updating=!1;this._scheduleHandleId=this._handleId=0;this._pendingPromises=new Set}destroy(){this.removeAll()}add(a,b,c={}){return this._installWatch(a,b,c,d.watch)}addWhen(a,b,c={}){return this._installWatch(a,b,c,d.when)}addOnCollectionChange(a,
b,{initial:c=!1,final:h=!1}={}){const e=++this._handleId;this.addHandles([d.on(a,"after-changes",this._createSyncUpdatingCallback(),d.sync),d.on(a,"change",b,{onListenerAdd:c?k=>b({added:k.toArray(),removed:[]}):void 0,onListenerRemove:h?k=>b({added:[],removed:k.toArray()}):void 0})],e);return g.makeHandle(()=>this.removeHandles(e))}addPromise(a){if(null==a)return a;const b=++this._handleId;this.addHandles(g.makeHandle(()=>{this._pendingPromises.delete(a)&&(0!==this._pendingPromises.size||this.hasHandles(-42)||
this._set("updating",!1))}),b);this._pendingPromises.add(a);this._set("updating",!0);const c=()=>this.removeHandles(b);a.then(c,c);return a}removeAll(){this._pendingPromises.clear();this.removeAllHandles();this._set("updating",!1)}_installWatch(a,b,c={},h){const e=++this._handleId;c.sync||this._installSyncUpdatingWatch(a,e);a=h(a,b,c);this.addHandles(a,e);return g.makeHandle(()=>this.removeHandles(e))}_installSyncUpdatingWatch(a,b){const c=this._createSyncUpdatingCallback();a=d.watch(a,c,{sync:!0,
equals:()=>!1});this.addHandles(a,b);return a}_createSyncUpdatingCallback(){return()=>{this.removeHandles(-42);++this._scheduleHandleId;const a=this._scheduleHandleId;this._get("updating")||this._set("updating",!0);this.addHandles(n.schedule(()=>{a===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this.removeHandles(-42))}),-42)}}};l.__decorate([p.property({readOnly:!0})],f.UpdatingHandles.prototype,"updating",void 0);f.UpdatingHandles=l.__decorate([q.subclass("esri.core.support.UpdatingHandles")],
f.UpdatingHandles);Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});