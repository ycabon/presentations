// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),function(f,h,k,l,m,n){class p{constructor(a,b,c,d,g={}){this._mainMethod=b;this._transferLists=c;this._listeners=[];this._promise=n.open(a,{...g,schedule:d}).then(e=>{if(void 0===this._thread){this._thread=e;this._promise=null;g.hasInitialize&&this.broadcast({},"initialize");for(const q of this._listeners)this._connectListener(q)}else e.close()});this._promise.catch(e=>l.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${a} worker: ${e}`))}on(a,
b){const c={removed:!1,eventName:a,callback:b,threadHandle:null};this._listeners.push(c);this._connectListener(c);return k.makeHandle(()=>{c.removed=!0;h.remove(this._listeners,c);this._thread&&null!=c.threadHandle&&c.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(a,b){return this.invokeMethod(this._mainMethod,a,b)}invokeMethod(a,b,c){if(this._thread){var d=this._transferLists[a];d=
d?d(b):[];return this._thread.invoke(a,b,{transferList:d,signal:c})}return this._promise?this._promise.then(()=>{m.throwIfAborted(c);return this.invokeMethod(a,b,c)}):Promise.reject(null)}broadcast(a,b){return this._thread?Promise.all(this._thread.broadcast(b,a)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(a,b)):Promise.reject()}get promise(){return this._promise}_connectListener(a){this._thread&&this._thread.on(a.eventName,a.callback).then(b=>{a.removed||(a.threadHandle=b)})}}
f.WorkerHandle=p;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});