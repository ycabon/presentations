// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../has"],function(b,f){function g(a){return a&&"object"===typeof a&&("result"in a||"transferList"in a)}function h(a){return a?"string"===typeof a?JSON.stringify({name:"message",message:a}):a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details||{stack:a.stack}}):null}function k(a,c,e,d){if(c.type===b.MessageType.OPEN_PORT)a.postMessage(c,[c.port]);else if(c.type!==b.MessageType.INVOKE&&c.type!==b.MessageType.RESPONSE)a.postMessage(c);else if(g(e)?
(d=l(e.transferList),c.data=e.result):(d=l(d),c.data=e),d){if(f("ff"))for(const m of d)if("byteLength"in m&&267386880<m.byteLength)switch(c.type){case b.MessageType.INVOKE:throw"Worker call with large ArrayBuffer would crash Firefox";case b.MessageType.RESPONSE:k(a,{type:b.MessageType.RESPONSE,jobId:c.jobId,error:h("Worker call with large ArrayBuffer would crash Firefox")});return}a.postMessage(c,d)}else a.postMessage(c)}function l(a){if(!a?.length)return null;if(f("esri-workers-arraybuffer-transfer"))return a;
a=a.filter(c=>!(c instanceof ArrayBuffer||"ArrayBuffer"===c?.constructor?.name));return a.length?a:null}b.MessageType=void 0;(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.OPEN=1]="OPEN";a[a.OPENED=2]="OPENED";a[a.RESPONSE=3]="RESPONSE";a[a.INVOKE=4]="INVOKE";a[a.ABORT=5]="ABORT";a[a.CLOSE=6]="CLOSE";a[a.OPEN_PORT=7]="OPEN_PORT";a[a.ON=8]="ON"})(b.MessageType||(b.MessageType={}));let n=0;b.isTransferrableResult=g;b.newJobId=function(){return n++};b.postMessage=k;b.receiveMessage=function(a){return a?
(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null};b.toInvokeError=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});