// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../request","../../../core/arrayUtils","../../../core/promiseUtils","../../../layers/support/infoFor3D"],function(d,u,v,k,e){function l(a){return Array.isArray(a)?a.every(b=>b instanceof f):!1}function m(a){return a?Array.isArray(a)?a.some(g):g(a):!1}function g(a){if(a instanceof File){const {type:b,name:c}=a;return n.test(b)||p.test(c)}return n.test(a.assetMimeType)||p.test(a.assetName)}function q(a,b){return Array.isArray(a)?0<a.length&&a.every(c=>h(c,b)):h(a,b)}function h(a,
b){return a instanceof f&&a.isOnService(b)}class f{constructor(a,b,c){this.assetName=a;this.assetMimeType=b;this.parts=c}equals(a){return this===a||this.assetName===a.assetName&&this.assetMimeType===a.assetMimeType&&v.equals(this.parts,a.parts,(b,c)=>b.equals(c))}isOnService(a){return this.parts.every(b=>b.isOnService(a))}makeHash(){let a="";for(const b of this.parts)a+=b.partHash;return a}async toBlob(a){var {parts:b}=this;if(1===b.length)return b[0].toBlob(a);b=await Promise.all(b.map(c=>c.toBlob(a)));
k.throwIfAborted(a);return new Blob(b)}}class w{constructor(a,b){this.partUrl=a;this.partHash=b}equals(a){return this===a||this.partUrl===a.partUrl&&this.partHash===a.partHash}isOnService(a){return this.partUrl.startsWith(`${a.path}/assets/`)}async toBlob(a){const {data:b}=await u(this.partUrl,{responseType:"blob"});k.throwIfAborted(a);return b}}const n=/^(model\/gltf\+json)|(model\/gltf-binary)$/,p=/\.(gltf|glb)/i;d.ServiceAsset=f;d.ServiceAssetPart=w;d.assetFormatId=function(a,b){return a instanceof
File?e.getFileFormatId(a,b):e.getMimeTypeFormatId(a.assetMimeType,b)??e.getFilenameFormatId(a.assetName,b)};d.assetIsOnService=h;d.externalIsOnService=function(a,b){if(!a)return!1;({source:a}=a);return q(a,b)};d.externalSourceToMultiPart=function(a){return Array.isArray(a)?a:[a]};d.externalSourcesAreEqual=function(a,b){if(a===b)return!0;({source:a}=a);({source:b}=b);if(a===b)return!0;if(l(a)&&l(b)){if(a.length!==b.length)return!1;var c=(r,t)=>r.assetName<t.assetName?-1:r.assetName>t.assetName?1:0;
a=[...a].sort(c);b=[...b].sort(c);for(c=0;c<a.length;++c)if(!a[c].equals(b[c]))return!1;return!0}return!1};d.isDisplayAsset=g;d.isDisplayExternal=function(a){return m(a?.source)};d.isDisplaySource=m;d.isOriginalExternal=function(a){return!!a.original};d.sourceIsOnService=q;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});