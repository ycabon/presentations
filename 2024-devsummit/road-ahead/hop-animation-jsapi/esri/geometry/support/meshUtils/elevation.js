// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry ../../../Ground ../../../core/Logger ../../../core/unitUtils ../../Mesh ../../projection ../Indices ../MeshComponent ../MeshVertexAttributes ../../Point".split(" "),function(w,Q,A,B,C,D,E,F,G,H,I){function x(a,b,c){var f=C.getMetersPerUnitForSR(b.spatialReference),d=(c?.demResolution??a.demResolution.min)/f;f=Math.round(b.width/d);d=Math.round(b.height/d);const k=f+1,t=d+1,m=new Float64Array(k*t*3),u=new Float32Array(k*t*2);let q=0,y=0;const g=new Uint32Array(f*d*
6);let h=0,l=0;const J=!a.spatialReference.equals(b.spatialReference);r.spatialReference=b.spatialReference;const {xmin:K,ymin:L,height:M,width:N}=b;for(let n=0;n<t;n++){const v=L+n/d*M;for(let p=0;p<k;p++){var e=K+p/f*N;m[q++]=e;m[q++]=v;J?(r.x=e,r.y=v,e=E.project(r,a.spatialReference),m[q++]=a.elevationAt(e.x,e.y)??0):m[q++]=a.elevationAt(e,v)??0;e=p/f;const O=n/d;u[y++]=e;u[y++]=O;n!==d&&p!==f&&(g[l++]=h+1,g[l++]=h+k+1,g[l++]=h+k,g[l++]=h,g[l++]=h+1,g[l++]=h+k);h++}}return new D({vertexAttributes:new H.MeshVertexAttributes({position:m,
uv:u}),components:[new G({faces:F.compactIndices(g),shading:"smooth",material:c?.material??null})],spatialReference:b.spatialReference})}async function P(a){if(z(a))return a.load();await a.load();await Promise.allSettled(a.layers.items.map(b=>b.load()));return a}function z(a){return"type"in a&&("elevation"===a.type||"base-elevation"===a.type)}const r=new I;w.create=async function(a,b,c){return z(a)||a instanceof A?(a=await (await P(a)).createElevationSampler(b,{demResolution:c?.demResolution??"finest-contiguous"}),
x(a,b,{material:c?.material})):"string"===typeof c?.demResolution?(B.getLogger("esri.geometry.support.meshUtils.elevation").error("create()","demResolution must be a number when used directly with a sampler"),null):x(a,b,{material:c?.material,demResolution:c?.demResolution})};Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});