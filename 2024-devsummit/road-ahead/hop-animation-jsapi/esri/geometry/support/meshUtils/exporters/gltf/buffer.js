// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","./bufferview"],function(d,e){class f{constructor(a){this._gltf=a;this._bufferViews=[];this._isFinalized=!1;a.buffers||(a.buffers=[]);this.index=a.buffers.length;const b={byteLength:-1};a.buffers.push(b);this._buffer=b}addBufferView(a,b,c){if(this._finalizePromise)throw Error("Cannot add buffer view after fiinalizing buffer");a=new e.BufferView(this,this._gltf,a,b,c);this._bufferViews.push(a);return a}getByteOffset(a){let b=0;for(const c of this._bufferViews){if(c===a)return b;b+=
c.byteSize}throw Error("Given bufferView was not present in this buffer");}getViewFinalizePromises(a){const b=[];for(const c of this._bufferViews){if(a&&c===a)break;b.push(c.finalized)}return b}getArrayBuffer(){if(!this._isFinalized)throw Error("Cannot get ArrayBuffer from Buffer before it is finalized");var a=this._getTotalSize();a=new ArrayBuffer(a);let b=0;for(const c of this._bufferViews)c.writeOutToBuffer(a,b),b+=c.byteSize;return a}finalize(){if(this._finalizePromise)throw Error(`Buffer ${this.index} was already finalized`);
this._finalizePromise=Promise.allSettled(this.getViewFinalizePromises()).then(()=>{this._isFinalized=!0;const a=this.getArrayBuffer();this._buffer.byteLength=a.byteLength;this._buffer.uri=a});this._gltf.extras?.promises.push(this._finalizePromise);return this._finalizePromise}_getTotalSize(){let a=0;for(const b of this._bufferViews)a+=b.byteSize;return a}}d.Buffer=f;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});