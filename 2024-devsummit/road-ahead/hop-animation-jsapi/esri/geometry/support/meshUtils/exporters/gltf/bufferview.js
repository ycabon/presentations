// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","./types","../../../../../views/webgl/enums"],function(g,e,c){class k{constructor(a,b,d,f,h){this._buffer=a;this._componentType=d;this._dataType=f;this._data=[];this._isFinalized=!1;this._accessorIndex=-1;this._accessorMax=this._accessorMin=this._accessorAttribute=null;b.bufferViews||(b.bufferViews=[]);this.index=b.bufferViews.length;this._bufferView={buffer:a.index,byteLength:-1,target:h};a=this._getElementSize();4<=a&&h!==e.TargetBuffer.ELEMENT_ARRAY_BUFFER&&(this._bufferView.byteStride=
a);b.bufferViews.push(this._bufferView);this._numComponentsForDataType=this._calculateNumComponentsForDataType()}push(a){var b=this._data.length;this._data.push(a);if(0<=this._accessorIndex){b%=this._numComponentsForDataType;var d=this._accessorMin[b];this._accessorMin[b]="number"!==typeof d?a:Math.min(d,a);d=this._accessorMax[b];this._accessorMax[b]="number"!==typeof d?a:Math.max(d,a)}}get dataSize(){return this._data.length*this._sizeComponentType()}get byteSize(){return 4*Math.ceil(this.dataSize/
4)}getByteOffset(){if(!this._isFinalized)throw Error("Cannot get BufferView offset until it is finalized");return this._buffer.getByteOffset(this)}get byteOffset(){if(!this._isFinalized)throw Error("Cannot get BufferView offset until it is finalized");return this._buffer.getByteOffset(this)}_createTypedArray(a,b){switch(this._componentType){case c.DataType.BYTE:return new Int8Array(a,b);case c.DataType.FLOAT:return new Float32Array(a,b);case c.DataType.SHORT:return new Int16Array(a,b);case c.DataType.UNSIGNED_BYTE:return new Uint8Array(a,
b);case c.DataType.UNSIGNED_INT:return new Uint32Array(a,b);case c.DataType.UNSIGNED_SHORT:return new Uint16Array(a,b)}}writeOutToBuffer(a,b){this._createTypedArray(a,b).set(this._data)}writeAsync(a){if(this._asyncWritePromise)throw Error("Can't write multiple bufferView values asynchronously");return this._asyncWritePromise=a.then(b=>{b=new Uint8Array(b);for(let d=0;d<b.length;++d)this._data.push(b[d]);delete this._asyncWritePromise})}startAccessor(a){if(0<=this._accessorIndex)throw Error("Accessor was started without ending the previous one");
this._accessorIndex=this._data.length;this._accessorAttribute=a;a=this._numComponentsForDataType;this._accessorMin=Array(a);this._accessorMax=Array(a)}endAccessor(){if(0>this._accessorIndex)throw Error("An accessor was not started, but was attempted to be ended");var a=this._getElementSize();const b=this._numComponentsForDataType,d=(this._data.length-this._accessorIndex)/b;if(d%1)throw Error("An accessor was ended with missing component values");for(let f=0;f<this._accessorMin.length;++f)"number"!==
typeof this._accessorMin[f]&&(this._accessorMin[f]=0),"number"!==typeof this._accessorMax[f]&&(this._accessorMax[f]=0);a={byteOffset:this._accessorIndex/b*a,componentType:this._componentType,count:d,type:this._dataType,min:this._accessorMin,max:this._accessorMax,name:this._accessorAttribute};switch(this._accessorAttribute){case "TEXCOORD_0":case "TEXCOORD_1":case "COLOR_0":case "WEIGHTS_0":switch(this._componentType){case c.DataType.UNSIGNED_BYTE:case c.DataType.UNSIGNED_SHORT:a.normalized=!0}}this._accessorIndex=
-1;this._accessorMax=this._accessorMin=this._accessorAttribute=null;return a}get finalized(){return this._finalizedPromise?this._finalizedPromise:this._isFinalized?this._finalizedPromise=Promise.resolve():this._finalizedPromise=new Promise(a=>this._finalizedPromiseResolve=a)}async finalize(){const a=this._bufferView,b=this._buffer.getViewFinalizePromises(this);this._asyncWritePromise&&b.push(this._asyncWritePromise);await Promise.allSettled(b);this._isFinalized=!0;a.byteOffset=this.getByteOffset();
a.byteLength=this.dataSize;this._finalizedPromiseResolve&&this._finalizedPromiseResolve()}_getElementSize(){return this._sizeComponentType()*this._numComponentsForDataType}_sizeComponentType(){switch(this._componentType){case c.DataType.BYTE:case c.DataType.UNSIGNED_BYTE:return 1;case c.DataType.SHORT:case c.DataType.UNSIGNED_SHORT:return 2;case c.DataType.UNSIGNED_INT:case c.DataType.FLOAT:return 4}}_calculateNumComponentsForDataType(){switch(this._dataType){case e.AttributeType.SCALAR:return 1;
case e.AttributeType.VEC2:return 2;case e.AttributeType.VEC3:return 3;case e.AttributeType.VEC4:case e.AttributeType.MAT2:return 4;case e.AttributeType.MAT3:return 9;case e.AttributeType.MAT4:return 16}}}g.BufferView=k;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});