// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/unitUtils ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../DoubleArray ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../meshVertexSpaceUtils ../../../chunks/vec3 ./geographicUtils ./projection".split(" "),
function(l,A,M,t,p,N,v,B,O,C,D,E,w,F,P,Q,u,k,G,m){function x(a,b,c){if(G.isGlobal(b.spatialReference,c?.geographic)){var e=b.spatialReference,f=H(b,c,n),d=new Float64Array(a.position.length);b=a.position;var g=e;var h=d;k.transformMat4(h,b,f);b=new Float64Array(b.length);g=m.projectFromPCPF(h,b,g);f=B.normalFromMat4(I,f);h=d;b=a.normal;c=f;var q=e;if(null==b)h=null;else{var r=new Float32Array(b.length);k.transformMat3(r,b,c);m.projectNormalFromPCPF(r,g,h,q,r);h=r}a=a.tangent;if(null==a)a=null;else{b=
new Float32Array(a.length);k.transformMat3(b,a,f,4);for(f=3;f<b.length;f+=4)b[f]=a[f];m.projectTangentFromPCPF(b,g,d,e,b);a=b}a={position:g,normal:h,tangent:a}}else{e=new Float64Array(a.position.length);g=a.position;d=b.x;f=b.y;h=b.z??0;b=y(c?c.unit:null,b.spatialReference);for(c=0;c<g.length;c+=3)e[c]=g[c]*b+d,e[c+1]=g[c+1]*b+f,e[c+2]=g[c+2]*b+h;a={position:e,normal:a.normal,tangent:a.tangent}}return a}function J(a,b=p.IDENTITY){const {position:c,normal:e,tangent:f}=a;a=k.transformMat4(new Float64Array(c.length),
c,b);const d=null!=e?m.transformNormal(e,new Float32Array(e.length),b):null;b=null!=f?m.transformTangent(f,new Float32Array(f.length),b):null;return{position:a,normal:d,tangent:b}}function K(a,b,c,e){const {position:f,normal:d,tangent:g}=a;if(!u.isRelativeVertexSpace(b))return{position:f,normal:d,tangent:g};e=u.vertexSpaceOriginToPoint(b,e);a=J(a,c?.localMatrix);return x(a,e,{geographic:"local"===b.type})}function z(a,b,c){if(G.isGlobal(b.spatialReference,c?.geographic)){const g=b.spatialReference;
H(b,c,n);var e=t.invert(R,n);b=new Float64Array(a.position.length);c=e;var f=m.projectToPCPF(a.position,g,b),d=new Float64Array(f.length);k.transformMat4(d,f,c);c=d;e=B.normalFromMat4(I,e);d=a.normal;f=e;null==d?f=null:(d=m.projectNormalToPCPF(d,a.position,b,g,new Float32Array(d.length)),k.transformMat3(d,d,f),f=d);d=a.tangent;null==d?a=null:(a=m.projectTangentToPCPF(d,a.position,b,g,new Float32Array(d.length)),k.transformMat3(a,a,e,4));a={position:c,normal:f,tangent:a}}else a=L(a,b,c);return a}function L(a,
b,c){const e=new Float64Array(a.position.length),f=a.position,d=b.x,g=b.y,h=b.z??0;b=y(c?c.unit:null,b.spatialReference);for(c=0;c<f.length;c+=3)e[c]=(f[c]-d)/b,e[c+1]=(f[c+1]-g)/b,e[c+2]=(f[c+2]-h)/b;return{position:e,normal:a.normal,tangent:a.tangent}}function H(a,b,c){D.computeTranslationToOriginAndRotation(a.spatialReference,[a.x,a.y,a.z??0],c,C.getSphericalPCPF(a.spatialReference));a=y(b?b.unit:null,a.spatialReference);t.scale(c,c,[a,a,a]);return c}function y(a,b){if(null==a)return 1;b=A.getMetersPerCartesianUnitForSR(b);
return 1/A.convertUnit(b,"meters",a)}const n=p.create(),R=p.create(),I=M.create();l.applyTransform=J;l.georeference=x;l.georeferenceApplyTransform=K;l.georeferenceByTransform=function(a,b,c){if(c?.useTransform){const {position:e,normal:f,tangent:d}=a,{x:g,y:h,z:q}=b;a=v.fromValues(g,h,q??0);return{vertexAttributes:{position:e,normal:f,tangent:d},vertexSpace:c.geographic??!0?new P({origin:a}):new F({origin:a}),transform:new Q}}return{vertexAttributes:x(a,b,c),vertexSpace:new F,transform:null}};l.project=
function({positions:a,transform:b,vertexSpace:c,inSpatialReference:e,outSpatialReference:f,outPositions:d,localMode:g}){const h=c.origin??v.ZEROS;b=null!=c.origin?b?.localMatrix??p.IDENTITY:p.IDENTITY;if("georeferenced"===c.type){d=d??w.newDoubleArray(a.length);t.equals(b,p.IDENTITY)?w.copyInto(d,a):k.transformMat4(d,a,b);if(!N.exactEquals(h,v.ZEROS)){const [r,S,T]=h;for(a=0;a<d.length;a+=3)d[a]+=r,d[a+1]+=S,d[a+2]+=T}E.projectBuffer(d,e,0,d,f,0,d.length/3);return d}c=e;const q=C.getSphericalPCPF(e);
c=f.isWebMercator&&g||!O.canProjectWithoutEngine(e,q)?c:q;D.computeTranslationToOriginAndRotation(e,h,n,c);t.multiply(n,n,b);e=d??w.newDoubleArray(a.length);k.transformMat4(e,a,n);E.projectBuffer(e,c,0,e,f,0,e.length/3);return e};l.ungeoreference=z;l.ungeoreferenceByTransform=function(a,b,c,e,f){if(!u.isRelativeVertexSpace(b))return z(a,e,f);const {spatialReference:d}=e;a=K(a,b,c,d);return e.equals(u.vertexSpaceOriginToPoint(b,d))?L(a,e,f):z(a,e,f)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});