// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec3".split(" "),function(l,G,m,H,I,x,B,y,C,D,z,J,
f,p){function q(a,b,c,g,d,A){if(b){var E=c.count,r=y.getSphericalPCPF(d);if(F(d))for(c=0;c<E;c++)g.getVec(c,t),b.getVec(c,h),C.computeTranslationToOriginAndRotation(r,t,u,r),m.fromMat4(e,u),a===n.FROM_PCPF&&m.transpose(e,e),x.transformMat3(h,h,e),A.setVec(c,h);else for(d=0;d<E;d++){g.getVec(d,t);b.getVec(d,h);C.computeTranslationToOriginAndRotation(r,t,u,r);m.fromMat4(e,u);var k=J.y2lat(c.get(d,1));k=Math.cos(k);a===n.TO_PCPF&&(k=1/k);e[0]*=k;e[1]*=k;e[2]*=k;e[3]*=k;e[4]*=k;e[5]*=k;a===n.FROM_PCPF&&
m.transpose(e,e);x.transformMat3(h,h,e);x.normalize(h,h);A.setVec(d,h)}return A}}function v(a){return F(a)||a.isWebMercator}function F(a){return a.isWGS84||z.isCGCS2000(a)||z.isMars(a)||z.isMoon(a)}const w=()=>G.getLogger("esri.geometry.support.meshUtils.normalProjection");var n;(function(a){a[a.TO_PCPF=0]="TO_PCPF";a[a.FROM_PCPF=1]="FROM_PCPF"})(n||={});const t=B.create(),h=B.create(),u=I.create(),e=H.create();l.projectFromPCPF=function(a,b,c){D.projectBuffer(a,y.getSphericalPCPF(c),0,b,c,0,a.length/
3);return b};l.projectNormalFromPCPF=function(a,b,c,g,d){if(!v(g))return w().error("Cannot convert to spatial reference from PCPF"),d;q(n.FROM_PCPF,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(c),g,f.BufferViewVec3f.fromTypedArray(d));return d};l.projectNormalToPCPF=function(a,b,c,g,d){if(!v(g))return w().error("Cannot convert spatial reference to PCPF"),d;q(n.TO_PCPF,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(b),
f.BufferViewVec3f64.fromTypedArray(c),g,f.BufferViewVec3f.fromTypedArray(d));return d};l.projectTangentFromPCPF=function(a,b,c,g,d){if(!v(g))return w().error("Cannot convert to spatial reference from PCPF"),d;q(n.FROM_PCPF,f.BufferViewVec3f.fromTypedArray(a,16),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(c),g,f.BufferViewVec3f.fromTypedArray(d,16));for(b=3;b<a.length;b+=4)d[b]=a[b];return d};l.projectTangentToPCPF=function(a,b,c,g,d){if(!v(g))return w().error("Cannot convert spatial reference to PCPF"),
d;q(n.TO_PCPF,f.BufferViewVec3f.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(c),g,f.BufferViewVec3f.fromTypedArray(d,4*Float32Array.BYTES_PER_ELEMENT));for(b=3;b<a.length;b+=4)d[b]=a[b];return d};l.projectToPCPF=function(a,b,c){D.projectBuffer(a,b,0,c,y.getSphericalPCPF(b),0,a.length/3);return c};l.transformNormal=function(a,b,c){m.normalFromMat4(e,c);p.transformMat3(b,a,e);m.isOrthoNormal(e)||p.normalize(b,b);return b};
l.transformTangent=function(a,b,c){m.normalFromMat4(e,c);p.transformMat3(b,a,e,4);m.isOrthoNormal(e)||p.normalize(b,b,4);if(a!==b)for(c=3;c<a.length;c+=4)b[c]=a[c];return b};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});