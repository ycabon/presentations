// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),function(v,I,J,K,L,n,k,C){function D(a,b){if(null==a)return null;var c=a.spatialReference,d=C.getInfo(c);a=I.isSerializable(a)?a.toJSON():a;if(!d)return a;c=C.isWebMercator(c)?102100:4326;const e=k.cutParams[c].maxX,f=k.cutParams[c].minX;if(n.isPoint(a))return E(a,e,f);if(n.isMultipoint(a))a.points=a.points.map(g=>E(g,e,f));else{if(n.isExtent(a))return M(a,
d);if(n.isPolygon(a)||n.isPolyline(a)){c=K.getBoundsXY(N,a);d=c[0];c=c[2];const g=2*k.offsetMagnitude(d,f)*e;a=0===g?a:k.updatePolyGeometry(a,g);d+=g;c+=g;return c>e?F(a,e,b):d<f?F(a,f,b):a}}return a}function M(a,b){if(!b)return a;const c=O(a,b).map(d=>d.extent);return 2>c.length?c[0]||a:2<c.length?(a.xmin=b.valid[0],a.xmax=b.valid[1],a):{rings:c.map(d=>[[d.xmin,d.ymin],[d.xmin,d.ymax],[d.xmax,d.ymax],[d.xmax,d.ymin],[d.xmin,d.ymin]])}}function E(a,b,c){if(Array.isArray(a)){var d=a[0];d>b?(c=k.offsetMagnitude(d,
b),a[0]=d+-2*c*b):d<c&&(b=k.offsetMagnitude(d,c),a[0]=d+-2*b*c)}else d=a.x,d>b?(c=k.offsetMagnitude(d,b),a.x+=-2*c*b):d<c&&(b=k.offsetMagnitude(d,c),a.x+=-2*b*c);return a}function O(a,b){const c=[],{ymin:d,ymax:e,xmin:f,xmax:g}=a;var h=a.xmax-a.xmin;const [p,l]=b.valid,{x:q,frameId:r}=G(a.xmin,b),{x:t,frameId:u}=G(a.xmax,b);a=q===t&&0<h;if(h>2*l){h={xmin:f<g?q:t,ymin:d,xmax:l,ymax:e};a={xmin:p,ymin:d,xmax:f<g?t:q,ymax:e};b={xmin:0,ymin:d,xmax:l,ymax:e};const B={xmin:p,ymin:d,xmax:0,ymax:e},w=[],x=
[];y(h,b)&&w.push(r);y(h,B)&&x.push(r);y(a,b)&&w.push(u);y(a,B)&&x.push(u);for(let z=r+1;z<u;z++)w.push(z),x.push(z);c.push(new m(h,[r]),new m(a,[u]),new m(b,w),new m(B,x))}else q>t||a?c.push(new m({xmin:q,ymin:d,xmax:l,ymax:e},[r]),new m({xmin:p,ymin:d,xmax:t,ymax:e},[u])):c.push(new m({xmin:q,ymin:d,xmax:t,ymax:e},[r]));return c}function G(a,b){const [c,d]=b.valid;b=2*d;var e=0;a>d?(e=Math.ceil(Math.abs(a-d)/b),a-=e*b):a<c&&(e=Math.ceil(Math.abs(a-c)/b),a+=e*b,e=-e);return{x:a,frameId:e}}function y(a,
b){const {xmin:c,ymin:d,xmax:e,ymax:f}=b;return A(a,c,d)&&A(a,c,f)&&A(a,e,f)&&A(a,e,d)}function A(a,b,c){return b>=a.xmin&&b<=a.xmax&&c>=a.ymin&&c<=a.ymax?!0:!1}function F(a,b,c=!0){const d=!n.isPolyline(a);d&&L.closeRings(a);if(c)return(new H).cut(a,b);c=d?a.rings:a.paths;const e=d?4:2,f=c.length;b*=-2;for(let g=0;g<f;g++){const h=c[g];if(h&&h.length>=e){const p=[];for(const l of h)p.push([l[0]+b,l[1]]);c.push(p)}}d?a.rings=c:a.paths=c;return a}class m{constructor(a,b){this.extent=a;this.frameIds=
b}}const N=J.create();class H{constructor(){this._linesIn=[];this._linesOut=[]}cut(a,b){this._xCut=b;if(a.rings)this._closed=!0,b=a.rings,this._minPts=4;else if(a.paths)this._closed=!1,b=a.paths,this._minPts=2;else return null;for(var c of b)if(c&&!(c.length<this._minPts)){b=!0;for(const d of c)b?(this.moveTo(d),b=!1):this.lineTo(d);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();b=[];for(const d of this._linesIn)d&&d.length>=this._minPts&&b.push(d);c=-2*this._xCut;for(const d of this._linesOut)if(d&&
d.length>=this._minPts){for(const e of d)e[0]+=c;b.push(d)}this._closed?a.rings=b:a.paths=b;return a}moveTo(a){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(a[0]);this._moveTo(a[0],a[1],this._prevSide);this._firstPt=this._prevPt=a}lineTo(a){const b=this._side(a[0]);if(-1===b*this._prevSide){const c=this._intersect(this._prevPt,a);this._lineTo(this._xCut,c,0);this._prevSide=0}this._lineTo(a[0],a[1],b);this._prevSide=b;this._prevPt=a}close(){const a=this._firstPt,b=this._prevPt;a[0]===
b[0]&&a[1]===b[1]||this.lineTo(a);this._checkClosingPt(this._lineIn);this._checkClosingPt(this._lineOut)}_moveTo(a,b,c){this._closed?(this._lineIn.push([0>=c?a:this._xCut,b]),this._lineOut.push([0<=c?a:this._xCut,b])):(0>=c&&this._lineIn.push([a,b]),0<=c&&this._lineOut.push([a,b]))}_lineTo(a,b,c){this._closed?(this._addPolyVertex(this._lineIn,0>=c?a:this._xCut,b),this._addPolyVertex(this._lineOut,0<=c?a:this._xCut,b)):0>c?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([a,b])):0<c?(0===
this._prevSide&&this._pushLineIn(),this._lineOut.push([a,b])):0>this._prevSide?(this._lineIn.push([a,b]),this._lineOut.push([a,b])):0<this._prevSide&&(this._lineOut.push([a,b]),this._lineIn.push([a,b]))}_addPolyVertex(a,b,c){const d=a.length;1<d&&a[d-1][0]===b&&a[d-2][0]===b?a[d-1][1]=c:a.push([b,c])}_checkClosingPt(a){const b=a.length;3<b&&a[0][0]===this._xCut&&a[b-2][0]===this._xCut&&a[1][0]===this._xCut&&(a[0][1]=a[b-2][1],a.pop())}_side(a){return a<this._xCut?-1:a>this._xCut?1:0}_intersect(a,
b){return a[1]+(this._xCut-a[0])/(b[0]-a[0])*(b[1]-a[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}v.CutVertical=H;v.normalizeCentralMeridianForDisplay=function(a){return D(a,!1)};v.normalizeCentralMeridianSync=function(a){return D(a,!0)};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});