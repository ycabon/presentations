// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ImageryTileMixin":function(){define("exports ../../chunks/tslib.es6 ../../geometry ../../rasterRenderers ../../request ../../core/deprecate ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/support/spatialReferenceUtils ../support/arcgisLayerUrl ../support/commonProperties ../support/DimensionalDefinition ../support/MultidimensionalSubset ../support/RasterFunction ../support/RasterJobHandler ../support/TileInfo ../support/rasterDatasets/FunctionRaster ../support/rasterDatasets/multidimensionalUtils ../support/rasterFunctions/clipUtils ../support/rasterFunctions/rasterFunctionHelper ../support/rasterFunctions/rasterProjectionHelper ../support/rasterFunctions/stretchUtils ../support/rasterFunctions/vectorFieldUtils ../../renderers/support/rasterRendererHelper ../../renderers/support/RasterSymbolizer ../../rest/support/ImageHistogramParameters ../../views/2d/engine/flow/dataUtils ../../geometry/SpatialReference ../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e,a,c,f,l,r,z,y,F,K,H,D,G,S,A){m.ImageryTileMixin=B=>{function Q(O){if(!O.raster||!O.serviceRasterInfo)throw new R("imagery-tile","no raster");}B=class extends B{constructor(...O){super(...O);this._isConstructedFromFunctionRaster=!1;this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};this.copyright=this.bandIds=null;this.interpolation="nearest";this.symbolizer=this.spatialReference=this.sourceJSON=this.serviceRasterInfo=this.raster=
this.multidimensionalSubset=null;this._isConstructedFromFunctionRaster="Function"===O[0]?.raster?.datasetFormat}get fullExtent(){return this.serviceRasterInfo?.extent}set multidimensionalDefinition(O){this._set("multidimensionalDefinition",O);this.updateRenderer()}set rasterFunction(O){"none"===O?.functionName?.toLowerCase()&&(O=void 0);this._set("rasterFunction",O);this.updateRasterFunction()}get rasterInfo(){T.deprecatedProperty(P.getLogger(this),"rasterInfo",{replacement:"serviceRasterInfo",version:"4.29",
warnOnce:!0});return this._get("serviceRasterInfo")}set url(O){this._set("url",h.sanitizeUrl(O,P.getLogger(this)))}set renderer(O){null==O&&null==this.rasterFunction?this._configDefaultRenderer("override"):(this._set("renderer",O),this.updateRenderer())}readRenderer(O,C,M){return L.read(C?.layerDefinition?.drawingInfo?.renderer,M)||void 0}async convertVectorFieldData(O,C){var {serviceRasterInfo:M}=this;if(null==O||!M)return null;const N=this._rasterJobHandler.instance;M=M.dataType;return N?N.convertVectorFieldData({pixelBlock:O,
dataType:M},C):F.convertVectorFieldData(O,M)}async computeStatisticsHistograms(O,C){O=p.ensureClass(D,O).clone();var {serviceRasterInfo:M}=this;const {geometry:N}=O;if(null==N)throw new R("imagery-tile-mixin:compute-statistics-histograms","geometry must be specified");var U=N;const {spatialReference:X}=M;N.spatialReference.equals(X)||(await z.load(),U="extent"===N.type?z.projectExtent(N,X):z.projectPolygon(N,X));O=O.pixelSize??new A({x:M.pixelSize.x,y:M.pixelSize.y,spatialReference:X});const {extent:I,
width:V,height:W}=l.snapToRaster(M,U,O);M=await this.fetchPixels(I,V,W,{...C,interpolation:"nearest"});if(null==M.pixelBlock)throw new R("imagery-tile-mixin:compute-statistics-histograms","failed to fetch pixels");U=await l.clip(M.pixelBlock,I,U);return(M=this._rasterJobHandler.instance)?M.computeStatisticsHistograms({pixelBlock:U},C):y.computeStatisticsHistograms(U)}async createFlowMesh(O,C){const M=this._rasterJobHandler.instance;return M?M.createFlowMesh(O,C):G.createFlowMesh(O.meshType,O.simulationSettings,
O.flowData,null!=C.signal?C.signal:(new AbortController).signal)}normalizeRasterFetchOptions(O){var {multidimensionalInfo:C}=this.serviceRasterInfo??{};if(null==C)return O;let M=O.multidimensionalDefinition||this.multidimensionalDefinition;M?.length||(M=f.getDefaultMultidimensionalDefinition(this.raster.rasterInfo,{multidimensionalSubset:this.multidimensionalSubset}));var N=O.timeExtent||this.timeExtent;if(null!=M&&null!=N&&(null!=N.start||null!=N.end)){M=M.map(Y=>Y.clone());var U=C.variables.find(({name:Y})=>
Y===M[0].variableName)?.dimensions?.find(({name:Y})=>"StdTime"===Y);C=M.find(({dimensionName:Y})=>"StdTime"===Y);if(!U||!C)return{...O,multidimensionalDefinition:null};const {start:X,end:I}=N;N=null==X?null:X.getTime();const V=null==I?null:I.getTime(),W=N??V,Z=V??N;if(null!=U.values)U=U.values.filter(Y=>{if(Array.isArray(Y)){if(W===Z)return Y[0]<=W&&Y[1]>=W;const aa=Y[0]>=W&&Y[1]<=Z||Y[0]<W&&Y[1]>Z;return Y[0]<=W&&Y[1]>W||Y[0]<Z&&Y[1]>=Z||aa}return W===Z?Y===W:Y>=W&&Y<=Z}),U.length?(U=U.sort((Y,aa)=>
{const ea=Array.isArray(Y)?Y[0]:Y;Y=Array.isArray(Y)?Y[1]:Y;const fa=Array.isArray(aa)?aa[0]:aa;aa=Array.isArray(aa)?aa[1]:aa;return W===Z?ea-fa:Math.abs(Y-Z)-Math.abs(aa-Z)})[0],C.values=[U]):M=null;else if(U.hasRegularIntervals&&U.extent){const [Y,aa]=U.extent;W>aa||Z<Y?M=null:C.values=W===Z?[W]:[Math.max(Y,W),Math.min(aa,Z)]}}return null!=M&&f.hasExcludedVariableOrDimension(M,this.multidimensionalSubset)?{...O,multidimensionalDefinition:null}:{...O,multidimensionalDefinition:M}}async updateRasterFunction(){if(this.loaded&&
"imagery-tile"===this.type&&(this.rasterFunction||this._cachedRasterFunctionJson)&&JSON.stringify(this.rasterFunction)!==JSON.stringify(this._cachedRasterFunctionJson))if(this._isConstructedFromFunctionRaster&&"Function"===this.raster.datasetFormat){var O=this.raster.rasterFunction.toJSON();!this.rasterFunction&&O&&this._set("rasterFunction",b.fromJSON(O));this._cachedRasterFunctionJson=this.rasterFunction?.toJSON()}else{var C=this.raster;O=!1;if("Function"===C.datasetFormat){var M=C.primaryRasters.rasters;
C=M[0];O=!0}else M=[C];var {rasterFunction:N}=this;if(N){const X={raster:C};1<M.length&&M.forEach(I=>X[I.url]=I);C=r.create(N.functionDefinition?.toJSON()??N.toJSON(),X);C=new c({rasterFunction:C});C.rasterJobHandler=this._rasterJobHandler.instance;await C.open();this._cachedRasterFunctionJson=this.rasterFunction?.toJSON();this.raster=C}else this.raster=C,this._cachedRasterFunctionJson=null,await C.when();this._cachedRendererJson=null;if(O||N){({bandIds:O}=this);var {bandCount:U}=this.raster.rasterInfo;
N=O?.length?O.some(X=>X>=U):3<=U;O&&(N||this.renderer&&"raster-stretch"!==this.renderer.type)&&this._set("bandIds",null);this._configDefaultRenderer("auto")}}}async updateRenderer(){const {loaded:O,symbolizer:C}=this;if(O&&C&&this.renderer){var {rasterInfo:M}=this.raster,N=f.getDefaultVariableInfo(M,{multidimensionalDefinition:this.multidimensionalDefinition,multidimensionalSubset:this.multidimensionalSubset})?.name,U=K.normalizeRendererJSON({...this.renderer.toJSON(),variableName:N});if(JSON.stringify(this._cachedRendererJson)!==
JSON.stringify(U)){var X=this._rasterJobHandler.instance;X&&(C.rasterInfo=K.getVariableRasterInfo(M,N),C.rendererJSON=U,C.bind(),await X.updateSymbolizer(C),this._cachedRendererJson=U)}}}async applyRenderer(O,C){var M=O?.pixelBlock;if(!(null!=M&&M.pixels&&0<M.pixels.length))return null;await this.updateRenderer();M=this._rasterJobHandler.instance;const N=this.bandIds??[];return M?await M.symbolize({...O,simpleStretchParams:C,bandIds:N}):this.symbolizer.symbolize({...O,simpleStretchParams:C,bandIds:N})}getTileUrl(O,
C,M){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${O}/${C}/${M}`:""}getCompatibleTileInfo(O,C,M=!1){if(!this.loaded||null==C)return null;if(M&&O.equals(this.spatialReference))return this.tileInfo;M=n.getInfo(O);return a.create({size:256,spatialReference:O,origin:M?{x:M.origin[0],y:M.origin[1]}:{x:C.xmin,y:C.ymax}})}getCompatibleFullExtent(O){return this.loaded?this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(O)?this._compatibleFullExtent:this._compatibleFullExtent=
this.raster.computeExtent(O):null}async fetchTile(O,C,M,N={}){Q(this);if(N.requestAsImageElement)return O=this.getTileUrl(O,C,M),E(O,{responseType:"image",query:{...this.refreshParameters,...this.raster.ioConfig.customFetchParameters},signal:N.signal}).then(X=>X.data);const {serviceRasterInfo:U}=this;if(null!=U.multidimensionalInfo&&(N=this.normalizeRasterFetchOptions(N),null==N.multidimensionalDefinition))return{extent:this.raster.getTileExtentFromTileInfo(O,C,M,N.tileInfo||U.storageInfo.tileInfo),
pixelBlock:null};await this._initJobHandler();await this.updateRasterFunction();"raster-shaded-relief"===this.renderer?.type&&(N={...N,buffer:{cols:1,rows:1}});return this.raster.fetchTile(O,C,M,N)}async fetchPixels(O,C,M,N={}){if(null!=this.serviceRasterInfo.multidimensionalInfo&&(N=this.normalizeRasterFetchOptions(N),null==N.multidimensionalDefinition))return{extent:O,pixelBlock:null};await this._initJobHandler();await this.updateRasterFunction();C=Math.round(C);M=Math.round(M);return this.raster.fetchPixels(O,
C,M,N)}async identify(O,C={}){const {raster:M,serviceRasterInfo:N}=this;if(!(null==N.multidimensionalInfo||N.hasMultidimensionalTranspose&&(f.isMultiSliceOrRangeDefinition(C.multidimensionalDefinition)||C.transposedVariableName||C.timeExtent))&&(C=this.normalizeRasterFetchOptions(C),null==C.multidimensionalDefinition))return{location:O,value:null};const U=this.multidimensionalSubset?.areaOfInterest;if(U&&!U.contains(O))throw new R("imagery-tile-mixin:identify","the request cannot be fulfilled when falling outside of the multidimensional subset");
return M.identify(O,C)}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&this._shutdownJobHandler()}hasStandardTime(){const O=this.serviceRasterInfo?.multidimensionalInfo;if(null==O||"standard-time"!==this.serviceRasterInfo?.dataType)return!1;const C=this.multidimensionalDefinition,M=C?.[0]?.variableName;return O.variables.some(N=>N.name===M&&(!C?.[0].dimensionName||N.dimensions.some(U=>
"StdTime"===U.name)))}getStandardTimeValue(O){return(new Date(864E5*(O-25569))).toString()}getMultidimensionalSubsetVariables(O){return f.getSubsetVariablesFromMdInfo(this.multidimensionalSubset,O??this.serviceRasterInfo?.multidimensionalInfo)}_configDefaultSettings(){this._configDefaultInterpolation();this.multidimensionalDefinition||(this.multidimensionalDefinition=f.getDefaultMultidimensionalDefinition(this.raster.rasterInfo,{multidimensionalSubset:this.multidimensionalSubset}));this.rasterFunction&&
"Function"===this.raster.datasetFormat&&(this._cachedRasterFunctionJson=this.rasterFunction.toJSON());this._configDefaultRenderer()}_initJobHandler(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const O=new e;this._rasterJobHandler.connectionPromise=O.initialize().then(async()=>{Q(this);this._rasterJobHandler.instance=O;this.raster.rasterJobHandler=O;"Function"===this.raster.datasetFormat&&this.raster.syncJobHandler();this.rasterFunction&&await this.updateRasterFunction().catch(()=>
{});this.renderer&&this.updateRenderer()}).catch(()=>{});return this._rasterJobHandler.connectionPromise}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0;this._cachedRendererJson=null;this.raster&&(this.raster.rasterJobHandler=null)}_configDefaultInterpolation(){if(null==this.interpolation){Q(this);var {raster:O}=this;O=K.getDefaultInterpolation(O.rasterInfo,
O.tileType,this.sourceJSON?.defaultResamplingMethod);this._set("interpolation",O)}}_configDefaultRenderer(O="no"){Q(this);var {rasterInfo:C}=this.raster;!this.bandIds&&1<C.bandCount&&(this.bandIds=K.getDefaultBandCombination(C));var M=f.getDefaultVariableInfo(C,{multidimensionalDefinition:this.multidimensionalDefinition,multidimensionalSubset:this.multidimensionalSubset})?.name;if(!this.renderer||"override"===O){var N=K.createDefaultRenderer(C,{bandIds:this.bandIds,variableName:M}),U=C.statistics;
U=U&&0<U.length?U[0]:null;"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===N.type&&(1E24<(U?.max??0)||-1E24>(U?.min??0))&&(N.dynamicRangeAdjustment=!0,N.statistics=null,"none"===N.stretchType&&(N.stretchType="min-max"));this.renderer=N}N=K.normalizeRendererJSON({...this.renderer.toJSON(),variableName:M});C=K.getVariableRasterInfo(C,M);this.symbolizer?(this.symbolizer.rendererJSON=N,this.symbolizer.rasterInfo=C):this.symbolizer=new H({rendererJSON:N,rasterInfo:C});C=this.symbolizer.bind();
C.success?"auto"===O&&({colormap:C}=this.raster.rasterInfo,O=this.renderer,null!=C&&"raster-colormap"===O.type?(C=K.createDefaultRenderer(this.raster.rasterInfo),JSON.stringify(C)!==JSON.stringify(O)&&this._configDefaultRenderer("override")):"raster-stretch"===O.type&&(C=this.bandIds?.length,M=O.statistics?.length,!O.dynamicRangeAdjustment&&M&&C&&M!==C&&this._configDefaultRenderer("override"))):(P.getLogger(this).warn("imagery-tile-mixin",C.error||"The given renderer is not supported by the layer."),
"auto"===O&&this._configDefaultRenderer("override"))}};v.__decorate([J.property({clonable:!1})],B.prototype,"_cachedRendererJson",void 0);v.__decorate([J.property({clonable:!1})],B.prototype,"_cachedRasterFunctionJson",void 0);v.__decorate([J.property({clonable:!1})],B.prototype,"_compatibleFullExtent",void 0);v.__decorate([J.property({clonable:!1})],B.prototype,"_isConstructedFromFunctionRaster",void 0);v.__decorate([J.property({clonable:!1})],B.prototype,"_rasterJobHandler",void 0);v.__decorate([J.property()],
B.prototype,"bandIds",void 0);v.__decorate([J.property({json:{origins:{service:{read:{source:"copyrightText"}}}}})],B.prototype,"copyright",void 0);v.__decorate([J.property({json:{read:!1}})],B.prototype,"fullExtent",null);v.__decorate([J.property()],B.prototype,"interpolation",void 0);v.__decorate([J.property()],B.prototype,"ioConfig",void 0);v.__decorate([J.property({type:[t],json:{write:!0}})],B.prototype,"multidimensionalDefinition",null);v.__decorate([J.property({type:x,json:{write:!0}})],B.prototype,
"multidimensionalSubset",void 0);v.__decorate([J.property()],B.prototype,"raster",void 0);v.__decorate([J.property({type:b,json:{name:"renderingRule",write:!0}})],B.prototype,"rasterFunction",null);v.__decorate([J.property({readOnly:!0})],B.prototype,"rasterInfo",null);v.__decorate([J.property()],B.prototype,"serviceRasterInfo",void 0);v.__decorate([J.property()],B.prototype,"sourceJSON",void 0);v.__decorate([J.property({readOnly:!0,type:S,json:{read:!1}})],B.prototype,"spatialReference",void 0);
v.__decorate([J.property({type:a})],B.prototype,"tileInfo",void 0);v.__decorate([J.property(q.url)],B.prototype,"url",null);v.__decorate([J.property({types:L.rasterRendererTypes,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(){const O="raster-stretch"===this.renderer?.type&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!O}}},origins:{"web-scene":{types:L.websceneRasterRendererTypes,name:"layerDefinition.drawingInfo.renderer",
write:{overridePolicy(O){return{enabled:O&&"vector-field"!==O.type&&"flow"!==O.type}}}}}}})],B.prototype,"renderer",null);v.__decorate([g.reader("renderer")],B.prototype,"readRenderer",null);v.__decorate([J.property({clonable:!1})],B.prototype,"symbolizer",void 0);return B=v.__decorate([k.subclass("esri.layers.ImageryTileMixin")],B)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/rasterRenderers":function(){define("exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/FlowRenderer ./renderers/RasterColormapRenderer ./renderers/RasterShadedReliefRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer ./renderers/VectorFieldRenderer".split(" "),
function(m,v,w,L,E,T,R,P,J){function p(k,n){if(!k)return null;if("classBreaks"===k.type&&k.classificationMethod){var h=k.authoringInfo||{classificationMethod:""};h.classificationMethod=k.classificationMethod;k.authoringInfo=h}"vectorField"===k.type&&k.visualVariables&&!Array.isArray(k.visualVariables)&&(k.visualVariables=[k.visualVariables]);h=k?g[k.type]||null:null;if(h)return h=new h,h.read(k,n),h;n?.messages&&k&&n.messages.push(new v("renderer:unsupported","Renderers of type '"+(k.type||"unknown")+
"' are not supported",{definition:k,context:n}));return null}const u={key:"type",base:null,typeMap:{"unique-value":P,"class-breaks":w,"raster-colormap":E,"raster-stretch":R,"vector-field":J,"raster-shaded-relief":T,flow:L}},d={...u,typeMap:{...u.typeMap}};delete d.typeMap["vector-field"];delete d.typeMap.flow;const g={uniqueValue:P,classBreaks:w,rasterStretch:R,rasterColormap:E,vectorField:J,rasterShadedRelief:T,flowRenderer:L};m.ClassBreaksRenderer=w;m.FlowRenderer=L;m.RasterColormapRenderer=E;m.RasterShadedReliefRenderer=
T;m.RasterStretchRenderer=R;m.UniqueValueRenderer=P;m.VectorFieldRenderer=J;m.fromJSON=function(k,n){return p(k,n)};m.rasterRendererTypes=u;m.read=p;m.websceneRasterRendererTypes=d;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/FlowRenderer":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./mixins/VisualVariablesMixin ./support/AuthoringInfo ./support/LegendOptions".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k){var n;w=new w.JSONMap({flow_from:"flow-from",flow_to:"flow-to"});L=n=class extends d.VisualVariablesMixin(L.JSONSupport){constructor(h){super(h);this.density=.8;this.color=new v([255,255,255,1]);this.maxPathLength=200;this.trailWidth=1.5;this.flowSpeed=10;this.trailLength=100;this.smoothing=0;this.flowRepresentation="flow-from";this.type="flow";this.legendOptions=this.authoringInfo=null;this.trailCap="butt";this.background="none"}clone(){const {density:h,maxPathLength:q,
trailWidth:t,flowSpeed:x,trailLength:b,smoothing:e,flowRepresentation:a,trailCap:c,background:f}=this,l=this.color.clone(),r=(this.visualVariables||[]).map(F=>F.clone()),z=this.authoringInfo?.clone(),y=this.legendOptions?.clone();return new n({density:h,color:l,maxPathLength:q,trailWidth:t,flowSpeed:x,trailLength:b,trailCap:c,background:f,smoothing:e,flowRepresentation:a,visualVariables:r,authoringInfo:z,legendOptions:y})}getSymbol(h,q){}async getSymbolAsync(h,q){}getSymbols(){return[]}};m.__decorate([T.property({type:Number,
json:{write:!0}})],L.prototype,"density",void 0);m.__decorate([T.property({type:v,json:{write:{allowNull:!0}}})],L.prototype,"color",void 0);m.__decorate([T.property({type:Number,cast:E.toPt,json:{write:!0}})],L.prototype,"maxPathLength",void 0);m.__decorate([T.property({type:Number,cast:E.toPt,json:{write:!0}})],L.prototype,"trailWidth",void 0);m.__decorate([T.property({type:Number,json:{write:!0}})],L.prototype,"flowSpeed",void 0);m.__decorate([T.property({type:Number,json:{write:!0}})],L.prototype,
"trailLength",void 0);m.__decorate([T.property({type:Number,cast:E.toPt,json:{write:!1}})],L.prototype,"smoothing",void 0);m.__decorate([T.property({type:w.apiValues,json:{type:w.jsonValues,read:{reader:w.read},write:{writer:w.write}}})],L.prototype,"flowRepresentation",void 0);m.__decorate([p.enumeration({flowRenderer:"flow"})],L.prototype,"type",void 0);m.__decorate([T.property({type:g,json:{write:!0}})],L.prototype,"authoringInfo",void 0);m.__decorate([T.property({type:k.LegendOptions,json:{write:!0}})],
L.prototype,"legendOptions",void 0);m.__decorate([T.property({type:String,json:{write:!0}})],L.prototype,"trailCap",void 0);m.__decorate([T.property({type:String,json:{write:!0}})],L.prototype,"background",void 0);return L=n=m.__decorate([u.subclass("esri.renderers.FlowRenderer")],L)})},"esri/renderers/RasterColormapRenderer":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./support/ColormapInfo ./support/colorRampUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p){var u;v=u=class extends v.JSONSupport{constructor(d){super(d);this.colormapInfos=null;this.type="raster-colormap"}static createFromColormap(d,g){if(!d)return null;const k=5===d[0].length;d=[...d].sort((n,h)=>n[0]-h[0]).map(n=>J.fromJSON({value:n[0],color:k?n.slice(1,5):n.slice(1,4).concat([255]),label:g?g[n[0]]??"":n[0]}));return new u({colormapInfos:d})}static createFromColorramp(d){d=p.convertColorRampToColormap(d);return u.createFromColormap(d)}clone(){return new u({colormapInfos:this.colormapInfos.map(d=>
d.toJSON())})}extractColormap(){return this.colormapInfos.map(({value:d,color:g})=>[d,g.r,g.g,g.b,1<g.a?g.a:255*g.a&255]).sort((d,g)=>d[0]-g[0])}};m.__decorate([w.property({type:[J],json:{write:!0}})],v.prototype,"colormapInfos",void 0);m.__decorate([R.enumeration({rasterColormap:"raster-colormap"})],v.prototype,"type",void 0);return v=u=m.__decorate([P.subclass("esri.renderers.RasterColormapRenderer")],v)})},"esri/renderers/support/ColormapInfo":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(m,v,w,L,E,T,R,P){w=class extends w.JSONSupport{constructor(){super(...arguments);this.color=this.label=this.value=null}};m.__decorate([L.property({type:Number,json:{write:!0}})],w.prototype,"value",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"label",void 0);m.__decorate([L.property({type:v,json:{type:[E.Integer],write:!0}})],w.prototype,"color",void 0);return w=m.__decorate([P.subclass("esri.renderers.support.ColormapInfo")],w)})},"esri/renderers/support/colorRampUtils":function(){define(["exports",
"../../Color","../../core/colorUtils","../../core/jsonMap","../../core/JSONSupport"],function(m,v,w,L,E){function T(b,e){if(!b||!e||b.length!==e.length)return!1;for(let a=0;a<b.length;a++)if(b[a]>e[a]+2||b[a]<e[a]-2)return!1;return!0}function R(b){const e=b.clone();e.fromColor=b.toColor;e.toColor=b.fromColor;e.algorithm=b.algorithm;return e}function P(b){if("multipart"===b.type){b=b.clone();if(!b.colorRamps?.length)return b;b.colorRamps=b.colorRamps.reverse().map(e=>R(e));return b}return R(b)}function J(b,
e){if(b){e=e??t;var a=null;"algorithmic"===b.type?e.some(c=>{if(T(b.fromColor.toRgb(),c.fromColor)&&T(b.toColor.toRgb(),c.toColor))return a=c.id,!0}):"multipart"===b.type&&e.some(c=>{const f=b.colorRamps,l=c.colorRamps;if(f&&l&&f.length===l.length&&!l.some((r,z)=>{if(!T(f[z].fromColor.toRgb(),(new v(r.fromColor)).toRgb())||!T(f[z].toColor.toRgb(),(new v(r.toColor)).toRgb()))return!0})){if(a)return!0;a=c.id}});return a}}function p(b,e,a=!1){if(b){var c=!1,f=J(b,e);null!=f||a||(c=!0,b=P(b),f=J(b,e));
return f?{id:f,inverted:c}:void 0}}function u(b,e=!1){return(b="string"===typeof b?b:p(b,void 0,e)?.id)?x.toJSON(b):null}function d(b){b=b||{};const e=b.numColors||256;return{...b,numColors:e,distanceOffset:b.distanceOffset||0,interpolateAlpha:!!b.interpolateAlpha,distanceInterval:b.distanceInterval||1/(e-1),isCustomInterval:null!=b.isCustomInterval?b.isCustomInterval:null!==b.distanceInterval&&b.distanceInterval!==1/(e-1),weights:b.weights}}function g(b,e){let {fromColor:a,toColor:c}=b;a=[...a];
c=[...c];3===a.length&&(a=a.concat([255]));3===c.length&&(c=c.concat([255]));b=b.algorithm||"esriCIELabAlgorithm";var f=d(e);const {numColors:l,distanceOffset:r,isCustomInterval:z,interpolateAlpha:y}=f;if(1===l&&0===r)return[a];if(2===l&&0===r&&!z)return[a,c];var F={r:a[0],g:a[1],b:a[2]};e={r:c[0],g:c[1],b:c[2]};if("esriCIELabAlgorithm"===b){b=w.toLAB(F);e=w.toLAB(e);const {numColors:G,distanceOffset:S,distanceInterval:A,isCustomInterval:B}=f;let {l:Q,a:O,b:C}=b;b=(e.l-Q)*A;F=(e.a-O)*A;f=(e.b-C)*
A;var K=[];if(S){var H=S/A;Q+=H*b;O+=H*F;C+=H*f}for(H=0;H<G-1;H++)K.push({l:Q,a:O,b:C}),Q+=b,O+=F,C+=f;K.push(B?{l:Q,a:O,b:C}:e);e=K}else if("esriHSVAlgorithm"===b){b=w.toHSV(F);e=w.toHSV(e);const {numColors:G,distanceOffset:S,distanceInterval:A,isCustomInterval:B}=f;K=0===b.s;H=0===e.s;F=b.h;f=e.h;K&&!H?F=f:H&&!K&&(e={...e,h:F},f=F);K=Math.abs(f-F);180>K?f=(f-F)*A:(K=360-K,f=F>f?K*A:-K*A);K=(e.s-b.s)*A;H=(e.v-b.v)*A;let {s:Q,v:O}=b;b=F;S&&(F=S/A,b=(b+F*f+360)%360,Q+=F*K,O+=F*H);F=[];for(var D=0;D<
G-1;D++)F.push({h:b,s:Q,v:O}),b=(b+f+360)%360,Q+=K,O+=H;F.push(B?{h:b,s:Q,v:O}:e);e=F}else{F=w.toLCH(F);e=w.toLCH(e);const {numColors:G,distanceOffset:S,distanceInterval:A,isCustomInterval:B}=f;f=F.h;K=e.h;b=2*Math.PI;f<=K?(H=K-f,f=K-f-b,f=Math.abs(f)<Math.abs(H)?f:H):(H=K+b-f,f=K-f,f=Math.abs(f)<Math.abs(H)?f:H);f*=A;K=(e.l-F.l)*A;H=(e.c-F.c)*A;let {l:Q,c:O,h:C}=F;S&&(F=S/A,Q+=F*K,O+=F*H,C=(C+F*f+b)%b);F=[];for(D=0;D<G-1;D++)F.push({l:Q,c:O,h:C}),Q+=K,O+=H,C=(C+f+b)%b;F.push(B?{l:Q,c:O,h:C}:e);e=
F}b=[];F=a[3]??255;f=((c[3]??255)-F)/(l-1);for(K=0;K<l;K++){const {r:G,g:S,b:A}=w.toRGB(e[K]);b.push([G,S,A,y?Math.round(F+f*K):255])}return b}function k(b,e){const {numColors:a,interpolateAlpha:c}=d(e);e=e?.weights;({colorRamps:b}=b);if(e){const K=e.reduce((H,D)=>H+D);e=e.map(H=>H/K)}else{e=[];for(var f=0;f<b.length;f++)e[f]=1/b.length}f=[];const l=1/(a-1);let r=0,z=!1;for(let K=0;K<b.length;K++){var y=f.length,F=z?0:y*l-r;r+=e[K];y=K===b.length-1?a-1-y:(e[K]-F)/l;z=Math.ceil(y)===y;y=Math.ceil(y);
0!==y&&(F=g(b[K],{numColors:y,interpolateAlpha:c,distanceOffset:F/e[K],distanceInterval:l/e[K]}),f.push(...F))}e=[...b[b.length-1].toColor];3===e.length&&e.push(255);f.push(e);return f}function n(b,e){b=E.isSerializable(b)?b.toJSON():b;return"multipart"===b.type?k(b,e):g(b,e)}function h(b){b=w.toHSV(b);return{type:"HsvColor",Hue:b.h,Saturation:b.s,Value:b.v,AlphaValue:255}}function q(b){return{Algorithm:b.toJSON()?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:h(b.fromColor),
ToColor:h(b.toColor)}}const t=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,
0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,
255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,
255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,
255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,
96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,
242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},
{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},
{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",
colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",
fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},
{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",
type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,
0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},
{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",
colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,
107,45]}],x=new L.JSONMap({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging",
"Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging",
"Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark",
"Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark",
"Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});m.colorRampDict=x;m.convertColorRampToColormap=function(b,e){b=n(b,e);const a=e?.interpolateAlpha;b.forEach((c,f)=>{c.unshift(f);a||c.pop()});
return b};m.convertColorRampToColors=n;m.convertRGBATo32Bit=function(b){b=b.reverse().map(e=>{e=e.toString(16);return 2>e.length?"0"+e:e});return 4294967295&Number.parseInt(b.join(""),16)};m.getColorRampId=p;m.getColorRampJSON=function(b,e="esriCIELabAlgorithm"){const a=t.find(({id:c})=>c===b);return a?a.colorRamps?{type:"multipart",colorRamps:a.colorRamps.map(c=>({type:"algorithmic",algorithm:e,fromColor:[...c.fromColor],toColor:[...c.toColor]}))}:{type:"algorithmic",algorithm:e,fromColor:[...a.fromColor],
toColor:[...a.toColor]}:null};m.getColorRampName=u;m.getRFxArgColorRampValue=function(b){const e=u(b);return e?"algorithmic"===b.type?{...q(b),Name:e}:b.colorRamps?(b=b.colorRamps.map(q),{type:"MultiPartColorRamp",NumColorRamps:b.length,ArrayOfColorRamp:b,Name:e}):null:null};m.predefinedJsonColorRamps=t;m.rasterColormapNames="random ndvi ndvi2 ndvi3 elevation gray hillshade".split(" ");Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/RasterShadedReliefRenderer":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../rest/support/colorRamps".split(" "),
function(m,v,w,L,E,T,R,P,J,p){var u;v=u=class extends v.JSONSupport{constructor(d){super(d);this.altitude=45;this.azimuth=315;this.colorRamp=null;this.hillshadeType="traditional";this.pixelSizePower=.664;this.pixelSizeFactor=.024;this.scalingType="none";this.type="raster-shaded-relief";this.zFactor=1}readColorRamp(d){return p.fromJSON(d)}clone(){return new u({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,pixelSizeFactor:this.pixelSizeFactor,
pixelSizePower:this.pixelSizePower,colorRamp:w.clone(this.colorRamp)})}};m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"altitude",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"azimuth",void 0);m.__decorate([L.property({types:p.types,json:{write:!0}})],v.prototype,"colorRamp",void 0);m.__decorate([P.reader("colorRamp")],v.prototype,"readColorRamp",null);m.__decorate([L.property({type:["traditional","multi-directional"],json:{write:!0}})],v.prototype,
"hillshadeType",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"pixelSizePower",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"pixelSizeFactor",void 0);m.__decorate([L.property({type:["none","adjusted"],json:{write:!0}})],v.prototype,"scalingType",void 0);m.__decorate([R.enumeration({rasterShadedRelief:"raster-shaded-relief"})],v.prototype,"type",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"zFactor",void 0);
return v=u=m.__decorate([J.subclass("esri.renderers.RasterShadedReliefRenderer")],v)})},"esri/renderers/RasterStretchRenderer":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./support/stretchRendererUtils ../rest/support/colorRamps".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d){var g;v=g=class extends v.JSONSupport{constructor(k){super(k);this.colorRamp=null;this.dynamicRangeAdjustment=this.computeGamma=!1;this.gamma=[];this.sigmoidStrengthLevel=this.outputMin=this.outputMax=this.numberOfStandardDeviations=this.minPercent=this.maxPercent=null;this.statistics=[];this.histograms=null;this.useGamma=!1;this.stretchType="none";this.type="raster-stretch"}readColorRamp(k){if(k)return d.fromJSON(k)}writeStatistics(k,n,h){k?.length&&(Array.isArray(k[0])||
(k=k.map(q=>[q.min,q.max,q.avg,q.stddev])),n[h]=k)}readStretchType(k,n){k=n.stretchType;"number"===typeof k&&(k=u.stretchTypeFunctionEnum[k]);return u.stretchTypeJSONDict.read(k)}clone(){return new g({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:w.clone(this.statistics),gamma:w.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,
minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:w.clone(this.colorRamp),histograms:w.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})}};m.__decorate([L.property({types:d.types,json:{write:!0}})],v.prototype,"colorRamp",void 0);m.__decorate([P.reader("colorRamp")],v.prototype,"readColorRamp",null);m.__decorate([L.property({type:Boolean,json:{write:!0}})],v.prototype,"computeGamma",void 0);m.__decorate([L.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],
v.prototype,"dynamicRangeAdjustment",void 0);m.__decorate([L.property({type:[Number],json:{write:!0}})],v.prototype,"gamma",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"maxPercent",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"minPercent",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"numberOfStandardDeviations",void 0);m.__decorate([L.property({type:Number,json:{read:{source:"max"},write:{target:"max"}}})],
v.prototype,"outputMax",void 0);m.__decorate([L.property({type:Number,json:{read:{source:"min"},write:{target:"min"}}})],v.prototype,"outputMin",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"sigmoidStrengthLevel",void 0);m.__decorate([L.property({json:{type:[[Number]],write:!0}})],v.prototype,"statistics",void 0);m.__decorate([L.property()],v.prototype,"histograms",void 0);m.__decorate([p.writer("statistics")],v.prototype,"writeStatistics",null);m.__decorate([L.property({type:Boolean,
json:{write:!0}})],v.prototype,"useGamma",void 0);m.__decorate([L.property({type:u.stretchTypeJSONDict.apiValues,json:{type:u.stretchTypeJSONDict.jsonValues,write:u.stretchTypeJSONDict.write}})],v.prototype,"stretchType",void 0);m.__decorate([P.reader("stretchType",["stretchType"])],v.prototype,"readStretchType",null);m.__decorate([R.enumeration({rasterStretch:"raster-stretch"})],v.prototype,"type",void 0);return v=g=m.__decorate([J.subclass("esri.renderers.RasterStretchRenderer")],v)})},"esri/renderers/support/stretchRendererUtils":function(){define(["exports",
"../../core/jsonMap"],function(m,v){v=new v.JSONMap({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});m.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};m.stretchTypeJSONDict=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/VectorFieldRenderer":function(){define("../chunks/tslib.es6 ../Color ../geometry ../Graphic ../symbols ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/support/normalizeUtils ../layers/support/rasterFunctions/vectorFieldUtils ./ClassBreaksRenderer ./mixins/VisualVariablesMixin ./support/ClassBreakInfo ./visualVariables/RotationVariable ./visualVariables/SizeVariable ./visualVariables/support/visualVariableUtils ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../symbols/support/utils ../geometry/Point ../symbols/PictureMarkerSymbol".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e,a,c,f,l,r,z){var y;const F=new Set(["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"]);w=new T.JSONMap({beaufort_ft:"beaufort-ft",beaufort_km:"beaufort-km",beaufort_kn:"beaufort-kn",beaufort_m:"beaufort-m",beaufort_mi:"beaufort-mi",classified_arrow:"classified-arrow",ocean_current_kn:"ocean-current-kn",ocean_current_m:"ocean-current-m",simple_scalar:"simple-scalar",single_arrow:"single-arrow",wind_speed:"wind-barb"});
T=new T.JSONMap({flow_from:"flow-from",flow_to:"flow-to"});R=y=class extends t.VisualVariablesMixin(R.JSONSupport){constructor(K){super(K);this.attributeField="Magnitude";this.flowRepresentation="flow-from";this.rotationType="arithmetic";this.style="single-arrow";this.symbolTileSize=50;this.type="vector-field"}readInputUnit(K,H){return F.has(K)?h.unitKebabDict.fromJSON(K):null}readOutputUnit(K,H){return F.has(K)?h.unitKebabDict.fromJSON(K):null}get styleRenderer(){const K=this.attributeField,H=this._createStyleRenderer(this.style);
H.field=K;return H}get sizeVariables(){const K=[];if(this.visualVariables)for(var H of this.visualVariables)"size"===H.type&&K.push(H);0===K.length&&(H=new e({field:"Magnitude",minSize:.2*this.symbolTileSize,maxSize:.8*this.symbolTileSize}),this.visualVariables?this.visualVariables.push(H):this._set("visualVariables",[H]),K.push(H));return K}get rotationVariables(){const K=[];if(this.visualVariables)for(var H of this.visualVariables)"rotation"===H.type&&K.push(H);0===K.length&&(H=new b({field:"Direction",
rotationType:this.rotationType}),this.visualVariables?this.visualVariables.push(H):this._set("visualVariables",[H]),K.push(H));return K}clone(){return new y({attributeField:this.attributeField,flowRepresentation:this.flowRepresentation,rotationType:this.rotationType,symbolTileSize:this.symbolTileSize,style:this.style,visualVariables:P.clone(this.visualVariables),inputUnit:this.inputUnit,outputUnit:this.outputUnit})}async getGraphicsFromPixelData(K,H=!1,D=[]){const G=[];var S=h.getUnitConversionFactor(this.inputUnit,
this.outputUnit),A=this.rotationVariables[0]?.rotationType||this.rotationType;H=H?h.convertVectorFieldData(K.pixelBlock,"vector-uv",A,S):h.convertVectorFieldUnit(K.pixelBlock,"vector-magdir",S);if(null==H)return G;K=K.extent;S=null!=H.mask&&0<H.mask.length;A=0;const B=(K.xmax-K.xmin)/H.width,Q=(K.ymax-K.ymin)/H.height;for(let C=0;C<H.height;C++)for(let M=0;M<H.width;M++,A++){let N=new r({x:K.xmin+M*B+B/2,y:K.ymax-C*Q-Q/2,spatialReference:K.spatialReference});N=(await n.normalizeCentralMeridian(N))[0];
var O=D.some(U=>U.intersects(N));S&&!H.mask[A]||O||(O=new L({geometry:{type:"point",x:N.x,y:N.y,spatialReference:K.spatialReference},attributes:{Magnitude:H.pixels[0][A],Direction:H.pixels[1][A]}}),O.symbol=this._getVisualVariablesAppliedSymbol(O),G.push(O))}return G}getSymbol(K,H){}async getSymbolAsync(K,H){}getSymbols(){return[]}getClassBreakInfos(){return this.styleRenderer?.classBreakInfos}getDefaultSymbol(){return this.styleRenderer?.defaultSymbol}_getDefaultSymbol(K){return new f({path:"M14,32 14,18 9,23 16,3 22,23 17,18 17,32 z",
outline:new c({width:0}),size:20,color:K||new v([0,92,230])})}_getVisualVariablesAppliedSymbol(K){if(K){var H=this.styleRenderer?.getSymbol(K)?.clone(),D=this.sizeVariables,G=this.rotationVariables;D&&D.length&&this.sizeVariables.forEach(S=>l.applySizesToSymbol(H,a.getAllSizes([S],K)));G&&G.length&&(K.attributes.Direction+="flow-to"===this.flowRepresentation===("ocean-current-kn"===this.style||"ocean-current-m"===this.style)?0:180,this.rotationVariables.forEach(S=>l.applyRotationToSymbol(H,a.getRotationAngle(S,
K),S.axis)));return H}}_createStyleRenderer(K){let H={defaultSymbol:this._getDefaultSymbol(),classBreakInfos:[]};switch(K){case "single-arrow":H=this._createSingleArrowRenderer();break;case "beaufort-kn":H=this._createBeaufortKnotsRenderer();break;case "beaufort-m":H=this._createBeaufortMeterRenderer();break;case "beaufort-ft":H=this._createBeaufortFeetRenderer();break;case "beaufort-mi":H=this._createBeaufortMilesRenderer();break;case "beaufort-km":H=this._createBeaufortKilometersRenderer();break;
case "ocean-current-m":H=this._createCurrentMeterRenderer();break;case "ocean-current-kn":H=this._createCurrentKnotsRenderer();break;case "simple-scalar":H=this._createSimpleScalarRenderer();break;case "wind-barb":H=this._createWindBarbsRenderer();break;case "classified-arrow":H=this._createClassifiedArrowRenderer()}return new q(H)}_createSingleArrowRenderer(){return{defaultSymbol:this._getDefaultSymbol()}}_createBeaufortKnotsRenderer(){const K=this._getDefaultSymbol(new v([214,47,39])),H=this._getClassBreaks([0,
1,3,6,10,16,21,27,33,40,47,55,63],[[40,146,199],[89,162,186],[129,179,171],[160,194,155],[191,212,138],[218,230,119],[250,250,100],[252,213,83],[252,179,102],[250,141,52],[247,110,42],[240,71,29]]);return{defaultSymbol:K,classBreakInfos:H}}_createBeaufortMeterRenderer(){const K=this._getDefaultSymbol(new v([214,47,39])),H=this._getClassBreaks([0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7],[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,
220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]]);return{defaultSymbol:K,classBreakInfos:H}}_createBeaufortFeetRenderer(){const K=this._getDefaultSymbol(new v([214,47,39]));var H=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];H=H.map(D=>3.28084*D);H=this._getClassBreaks(H,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]]);return{defaultSymbol:K,classBreakInfos:H}}_createBeaufortMilesRenderer(){const K=
this._getDefaultSymbol(new v([214,47,39]));var H=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];H=H.map(D=>2.23694*D);H=this._getClassBreaks(H,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]]);return{defaultSymbol:K,classBreakInfos:H}}_createBeaufortKilometersRenderer(){const K=this._getDefaultSymbol(new v([214,47,39]));var H=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,
32.7];H=H.map(D=>3.6*D);H=this._getClassBreaks(H,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]]);return{defaultSymbol:K,classBreakInfos:H}}_createCurrentMeterRenderer(){const K=this._getDefaultSymbol(new v([177,177,177])),H=this._getClassBreaks([0,.5,1,1.5,2],[[78,26,153],[179,27,26],[202,128,26],[177,177,177]]);return{defaultSymbol:K,classBreakInfos:H}}_createCurrentKnotsRenderer(){const K=
this._getDefaultSymbol(new v([177,177,177])),H=this._getClassBreaks([0,.25,.5,1,1.5,2,2.5,3,3.5,4],[[0,0,0],[0,37,100],[78,26,153],[151,0,100],[179,27,26],[177,78,26],[202,128,26],[177,179,52],[177,177,177]]);return{defaultSymbol:K,classBreakInfos:H}}_createClassifiedArrowRenderer(){const K=this._getDefaultSymbol(new v([56,168,0]));var H=[0,1E-6,3.5,7,10.5,14];if(this.sizeVariables?.length){const D=this.sizeVariables[0].minDataValue,G=this.sizeVariables[0].maxDataValue;if(D&&G){const S=(G-D)/5;H=
Array.from(Array(6).keys()).map(A=>D+S*A)}}H=this._getClassBreaks(H,[[56,168,0],[139,309,0],[255,255,0],[255,128,0],[255,0,0]]);return{defaultSymbol:K,classBreakInfos:H}}_createSimpleScalarRenderer(){return{defaultSymbol:z.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAQAAABLVLlLAAAABGdBTUEAAYagMeiWXwAAAAJiS0dEAACqjSMyAAAACXBIWXMAAABIAAAASABGyWs+AAAC3ElEQVRIx9XXvW4cVRQH8N982btpsIREJECyiCXsxX4DKh6AliqGKCBBE2SlwlHgAbBD/AKmyEYUeQ1KahPZSZQvBCkQLTHZ7KGY8Xodz4w3a1NwbzVzz/znfJ//zbStVC5q3icKak9GAs2QIdDx3PtW/S011NW3p+M5Eomh11ipTIKe6+4LQzHaQ+G+63pIZNJJQXMpljwTwj1brpgx5w1zZlyx5Z4QnllEIm2xeeSUHBf0hV0bejo1Uh09G3aFvgXk7cCJFBc9EdaRVuHJJaOdKyTV2TVhYLMduNR0Q9gxL5GaaTDw8GzejrDRBpxWoGsySRW0dttKuattwNkIlFw2YXgzOdYq4Ox49PlM+JrKd5OusjTWhBuVxUfMX/KXXZ3WEmkuqa67wspR4BTbwtKr/5u4fFgStse/T7EifFPnnYl9zPq4vmUOPrRndgoHjDti1gOPqlyXoifcRNGQzUd31lDyfHmob1Gp35vSr+P6vilcQ5Egtyd8YF/ySg9NhPM+9M/IOaHwp5+PSZayXTvCogEUwlatC3J8LLwYtcWB8EuDXQVuCkV5/B4eNHb7wGBs87LBDS+xjdVSn09wq1G8dFM+9tSUhIGneLvUdniKxKpTYljCpu3j7rVWlHj/P23v4NPGUEyeCQnexe9lJjzEQqMjJs+EzNAX6B98dBZVRmroJx95x/A/6gln18EyfCUsl+qdXb/tjvfbw+mwforpUOBz4XLVoBwAn3aWnfeH246NyBXhrq7TTN5lNSP9RkU+puUJm3W2Tsdq0nZWM07srk7MwQrZSRysjjGWBLRJNsNbfj2JMR4AbxpU1XLAb9Mxfpsq5EjMuuiR8L0JiHOOBX3hiUvOmavN0nMueSzcceFk0BK4pMqLo7vDD1Z0qrtDx7Itt4Xwm9UqbMmk8S0Dtuzb2pvOU99Z1nLTOfleNmvfZfP2pYZmPfajwosKdDBNpacNpVGGsWX9CyDI8Xq/Sj6QAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE0LTExLTEwVDAzOjE3OjU4LTA1OjAwF+tHyQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMFQwMzoxNzo1OC0wNTowMGa2/3UAAAAASUVORK5CYII\x3d",
height:20,width:20,type:"esriPMS",angle:0})}}_createWindBarbsRenderer(){const K=Array.from(Array(31).keys()).map(S=>5*S),H=[{range:"0-5",path:"M20 20 M5 20 A15 15 0 1 0 35 20 A15 15 0 1 0 5 20 M20 20 M10 20 A10 10 0 1 0 30 20 A10 10 0 1 0 10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTIwIDIwIE01IDIwIEExNSAxNSAwIDEgMCAzNSAyMCBBMTUgMTUgMCAxIDAgNSAyMCBNMjAgMjAgTTEwIDIwIEExMCAxMCAwIDEgMCAzMCAyMCBBMTAgMTAgMCAxIDAgMTAgMjAiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},
{range:"5-10",path:"M25 0 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"10-15",path:"M25 0 L25 40 L10 45 L25 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},
{range:"15-20",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjEyIDAgMTUgNDUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"20-25",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},
{range:"25-30",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIEwyNSAzNSBNMjUgMzAgTDE3LjUgMzIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"30-35",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},
{range:"35-40",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"40-45",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"45-50",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},
{range:"50-55",path:"M25 0 L25 40 L10 40 L25 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"55-60",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxNy41IDMyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},
{range:"60-65",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"65-70",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},
{range:"70-75",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"75-80",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"80-85",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},
{range:"85-90",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxNy41IDE3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"90-95",
path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"95-100",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20 L25 15 M25 10 L17.5 12.5",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCBMMjUgMTUgTTI1IDEwIEwxNy41IDEyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"},{range:"100-105",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},
{range:"105-110",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDE3LjUgMjcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"110-115",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},
{range:"115-120",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDE3LjUgMjIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"120-125",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"125-130",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDE3LjUgMTcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},
{range:"130-135",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"135-140",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDE3LjUgMTIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg\x3d\x3d"},{range:"140-145",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"145-150",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",
imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IE0yNSAxMCBNMjUgNSBMMTcuNSA3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4\x3d"}],D=z.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACgAAAApCAQAAADtq6NDAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEY0lEQVRIx5XXWWxWRRQH8N+d+31tUdGAVjGglYJABFEBY91jfDAg7piYaFTccA++uMQEFRcSXlATtxiXqMQt4G4iisYl0ai4sIQYtVFZ1KIFKdTS0l4f7vRCS5fPebozc+bM/2z/Mzcx0AgSiUxXnKfIdMn875FIhX53U2n/B/s+kKM4UINTjTBZImixxnrv+9a2iL6zEoUBXcoudrWj/OtHm3wt02lfU9Qao9OnHvIhgmww84MEl1qnxfNmGrqHxAizLdPpC6chGcAxKGGcL+30gOERf1BSpUqVslQSV8d5ReZFe8VQ9avufJn31cWwlJV7iafKStGOE/1qvfH9qUxxu8ydUdmuSKbGO8YUdT2inKLG69pM70tliktl5qIkCAJGmusDG7Vqsc0WjZa4UBlBiA5YZIcjYzB7qDtH5kaUJFLs7RGZTZ42W4PRRmtwvbdt1+wGiaS4drEtDttdZYIDNVuAclR3vA3+dI3qHqmVSy7U6Tv1MScCPvPR7nIpFlsdCy3FdTLPGhK92e2CUITjMJ9ocwKxnsZqc3O3JwMma3d6UVLnyVxB4aXemZqvPqLdpJhW3KVVbY4yYImPo6M5Urv50fj+0z/FG9YaEiENs8UtMfXUaTeTePNHlhXfA1UU+2lyD1Il3Gtt9+adfpNG7dNlpg2U/T3KYLZ2dUWFdTgp3/rQ4sK973qnInV5TIf40x3dhvrJPBiqyWUo4wAtLqhQYS71qK+QKOFRywmGK/kpikzV6WMKhh58vGWs4TIJNjiEYLIuP8Tt4/zmLyqk+AyrJSbF+Qq1DgqRUPMxyl+9q3IQhX/rMCJ6tEunriDs1oSyQZKlr9AkhT2ZIARbJfaJS1vtVbHB+Rgi0RK/y1q1BWsEEyLoz40xtGKcARPVWB1BTPO7f4LNtpkUl1aoMbViLyZo0GRjPD3BxnxjqXeLYlvhqYrzMMG3HoyJXa3JjfnGlbYYFlP7Jh3qKsKY4hQ7TY0nG+xwRL61n63mxHtqNHosigyMLmClNwvuecFnOZB88nNBDzNkzhxEZaKMBVoKapggMzvHHXBEpNSSFAvtcFRsVn0bW8LlMmcXs+c0Kne3gRR32+zg4uXwjC6zit6Wt4a8LXVfcp/MtQXHn2ynGbuCmb8GvvFeJLEE82ReU9/n6+dkq2x3buG9Wn94smcgAw631RPR7BTH+kbmHReZoEpOdEe7zWqZl40s0JWs9Hmv7hjBHqPDwsjGKVJnWWqjbdZp1KhJi0aPmxYZsIRhlttgeF+Jlke41QcOQKoqilSb6HJzSvNG3G/UoWnxwsmt+sVaYwd63dRbqdnMyCPVeyRPvpYgdavM22oGKoMUVRbJfOWMwidJ8Zzb1UvmWK/VVUXzHaTjjrVYh1897HT7xxYEVUaa5SWb/WO+YUWa9SrwvigzM8YlzlYv2GSdVCYxxlBtVnnFq5olwp5/BEk/OLsf5LUmG2+inRJdVvjZ97ZH9/zP34ug1O91pf4p+D+JYBpvrKxfbwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNC0xMS0xMFQwMzoxMjowOS0wNTowMB9ViV0AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTBUMDM6MTI6MDktMDU6MDBuCDHhAAAAAElFTkSuQmCC",
height:20,width:20,type:"esriPMS",angle:0}),G=K.map((S,A)=>{if(A!==K.length-1)if(0===A)var B={minValue:S,maxValue:K[A+1],symbol:D};else B=z.fromJSON({type:"esriPMS",imageData:H[A].imageData,contentType:"image/svg+xml",height:32,width:32,angle:0}),B={minValue:S,maxValue:K[A+1],symbol:B};return new x(B)});return{defaultSymbol:D,classBreakInfos:G}}_getClassBreaks(K,H){return H.map((D,G)=>new x({minValue:K[G],maxValue:K[G+1],symbol:this._getDefaultSymbol(new v(D))}))}};m.__decorate([J.property({type:String,
json:{write:!0}})],R.prototype,"attributeField",void 0);m.__decorate([J.property({type:T.apiValues,json:{type:T.jsonValues,read:{reader:T.read},write:{writer:T.write}}})],R.prototype,"flowRepresentation",void 0);m.__decorate([J.property({type:["geographic","arithmetic"],json:{write:!0}})],R.prototype,"rotationType",void 0);m.__decorate([J.property({type:w.apiValues,json:{type:w.jsonValues,read:{reader:w.read},write:{writer:w.write}}})],R.prototype,"style",void 0);m.__decorate([J.property({json:{write:!0}})],
R.prototype,"symbolTileSize",void 0);m.__decorate([J.property({type:h.unitKebabDict.apiValues,json:{type:h.unitKebabDict.jsonValues,write:{writer:h.unitKebabDict.write}}})],R.prototype,"inputUnit",void 0);m.__decorate([g.reader("inputUnit")],R.prototype,"readInputUnit",null);m.__decorate([J.property({type:h.unitKebabDict.apiValues,json:{type:h.unitKebabDict.jsonValues,read:{reader:h.unitKebabDict.read},write:{writer:h.unitKebabDict.write}}})],R.prototype,"outputUnit",void 0);m.__decorate([g.reader("outputUnit")],
R.prototype,"readOutputUnit",null);m.__decorate([d.enumeration({vectorField:"vector-field"})],R.prototype,"type",void 0);m.__decorate([J.property({type:q})],R.prototype,"styleRenderer",null);m.__decorate([J.property({type:e})],R.prototype,"sizeVariables",null);m.__decorate([J.property({type:b})],R.prototype,"rotationVariables",null);return R=y=m.__decorate([k.subclass("esri.renderers.VectorFieldRenderer")],R)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap",
"../PixelBlock","./pixelUtils"],function(m,v,w,L){function E(f,l){return h.get(f)/h.get(l)||1}function T(f,l="geographic"){const [r,z]=f;f=Math.sqrt(r*r+z*z);let y=Math.atan2(z,r)*q;y=(360+y)%360;"geographic"===l&&(y=(450-y)%360);return[f,y]}function R(f,l="geographic"){let r=f[1];"geographic"===l&&(r=(450-r)%360);r%=360;f=f[0];return[f*Math.cos(r/q),f*Math.sin(r/q)]}function P(f,l,r="geographic",z=1){if(!L.isValidPixelBlock(f))return f;const {pixels:y,width:F,height:K}=f;var H=F*K;const D=y[0],G=
y[1],S=f.pixelType.startsWith("f")?f.pixelType:"f32",A=w.createEmptyBand(S,H);H=w.createEmptyBand(S,H);let B=0;for(let Q=0;Q<K;Q++)for(let O=0;O<F;O++)"vector-uv"===l?([A[B],H[B]]=T([D[B],G[B]],r),A[B]*=z):([A[B],H[B]]=R([D[B],G[B]],r),A[B]*=z,H[B]*=z),B++;f=new w({pixelType:S,width:f.width,height:f.height,mask:f.mask,validPixelCount:f.validPixelCount,maskIsAlpha:f.maskIsAlpha,pixels:[A,H]});f.updateStatistics();return f}function J(f=0,l=0,r=Math.PI,z=!0){z&&(r=(2*Math.PI-r)%(2*Math.PI));z=z?-1:1;
const y=-7*z,F=-2*z,K=-16*z,[H,D]=u(0,l+13*z,r,21.75),[G,S]=u(f-5.5,l+y,r,21.75),[A,B]=u(f+5.5,l+y,r,21.75),[Q,O]=u(f-1.5,l+F,r,21.75),[C,M]=u(f+1.5,l+F,r,21.75),[N,U]=u(f-1.5,l+K,r,21.75),[X,I]=u(f+1.5,l+K,r,21.75);return[H,D,G,S,Q,O,C,M,A,B,N,U,X,I]}function p(f=0,l=Math.PI,r=!0){r&&(l=(2*Math.PI-l)%(2*Math.PI));var z=r?-1:1,y=5*z;const F=20*z,K=25*z;z*=2;const H=r?1:-1;r=5*H;let [D,G]=[0+r,0-F],[S,A]=[D+2*H,G],[B,Q]=[S-0*H,A+z],[O,C]=[0-r,0-K],[M,N]=[O+0*H,C-z],U=Math.ceil(f/5),X=Math.floor(U/
10);U-=8*X;f=[];const I=[];for(let ja=0;ja<U/2;ja++,X--){0>=X&&1===U%2&&ja===(U-1)/2&&(O=0,M=O+0*H,C=(C+G)/2,N=C-z);const [la,na]=u(O,C,l,45);if(0<X){const [oa,qa]=u(S,C,l,45),[sa,ra]=u(D,G,l,45);f.push(oa);f.push(qa);f.push(la);f.push(na);f.push(sa);f.push(ra)}else{const [oa,qa]=u(S,A,l,45),[sa,ra]=u(B,Q,l,45),[ua,pa]=u(M,N,l,45);I.push(la);I.push(na);I.push(ua);I.push(pa);I.push(sa);I.push(ra);I.push(oa);I.push(qa)}C+=y;G+=y;A+=y;Q+=y;N+=y}const [V,W]=u(0+r,0+F,l,45);y=7*H;const [Z,Y]=u(0+y,0+F,
l,45),[aa,ea]=u(0+r,0-K,l,45),[fa,ca]=u(0+y,0-K,l,45);return{pennants:f,barbs:I,shaft:[V,W,Z,Y,aa,ea,fa,ca]}}function u(f,l,r,z=1){return[Math.sqrt(f*f+l*l)/z,(2*Math.PI+(2*Math.PI+Math.atan2(l,f))%(2*Math.PI)-r)%(2*Math.PI)]}function d(f,l,r,z){r=E(z||"knots",r);for(z=1;z<l.length;z++)if(z===l.length-1){if(f<l[z]*r)break}else if(f<=l[z]*r)break;return Math.min(z-1,l.length-2)}function g(f,l,r,z,y){let F=0;switch(l){case "beaufort_kn":F=d(f,b,"knots",r);break;case "beaufort_km":F=d(f,b,"kilometer-per-hour",
r);break;case "beaufort_ft":F=d(f,b,"feet-per-second",r);break;case "beaufort_m":F=d(f,b,"meter-per-second",r);break;case "classified_arrow":F=d(f,y??[],z,r);break;case "ocean_current_m":F=d(f,e,"meter-per-second",r);break;case "ocean_current_kn":F=d(f,a,"knots",r)}return F}function k(f,l){const {style:r,inputUnit:z,outputUnit:y,breakValues:F}=l,K=t.fromJSON(z),H=t.fromJSON(y);let D=0,G=0;const {width:S,height:A,mask:B}=f,Q=f.pixels[0];f=f.pixels[1];var O=null!=B?B.filter(N=>0<N).length:S*A;const C=
new Float32Array(42*O);O=new Uint32Array(15*O);l=l.invertDirection?J(0,0,0,!1):x;for(let N=0;N<A;N++)for(let U=0;U<S;U++){var M=N*S+U;if(!B||B[N*S+U]){const X=(f[M]+360)%360/180*Math.PI,I=g(Q[M],r,K,H,F);for(let V=0;V<l.length;V+=2)C[D++]=(U+.5)/S,C[D++]=(N+.5)/A,C[D++]=l[V],C[D++]=l[V+1]+X,C[D++]=I,C[D++]=Q[M];M=7*(D/42-1);O[G++]=M;O[G++]=M+1;O[G++]=M+2;O[G++]=M+0;O[G++]=M+4;O[G++]=M+3;O[G++]=M+0;O[G++]=M+2;O[G++]=M+3;O[G++]=M+2;O[G++]=M+5;O[G++]=M+3;O[G++]=M+5;O[G++]=M+6;O[G++]=M+3}}return{vertexData:C,
indexData:O}}function n(f,l){let r=0,z=0;const {width:y,height:F,mask:K}=f;f=f.pixels[0];const H=[],D=[];var G=t.fromJSON(l.inputUnit);G=E(G,"knots");l="wind_speed"===l.style?5:Number.MAX_VALUE;for(let A=0;A<F;A++)for(let B=0;B<y;B++){var S=f[A*y+B]*G;if((!K||K[A*y+B])&&S<l){for(let Q=0;4>Q;Q++)H[r++]=(B+.5)/y,H[r++]=(A+.5)/F,H[r++]=2>Q?-.5:.5,H[r++]=0===Q%2?-.5:.5,H[r++]=0,H[r++]=S;S=4*(r/24-1);D[z++]=S;D[z++]=S+1;D[z++]=S+2;D[z++]=S+1;D[z++]=S+2;D[z++]=S+3}}return{vertexData:new Float32Array(H),
indexData:new Uint32Array(D)}}const h=new Map;h.set("meter-per-second",1);h.set("kilometer-per-hour",.277778);h.set("knots",.514444);h.set("feet-per-second",.3048);h.set("mile-per-hour",.44704);const q=180/Math.PI,t=new v.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),x=J(0,0,0),b=[0,1,3,6,10,16,21,27,33,40,47,55,63],e=[0,.5,1,1.5,2],a=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],
c=[];m.convertToLocalDirections=function(f,l,r,z="geographic"){if(!L.isValidPixelBlock(f)||null==r)return f;f="vector-magdir"===l?f.clone():P(f,l);const y=f.pixels[1];for(let F=0;F<y.length;F++)y[F]="geographic"===z?(y[F]+r[F]+270)%360:(y[F]+360-r[F])%360;return"vector-magdir"===l?f:P(f,"vector-magdir")};m.convertVectorFieldData=P;m.convertVectorFieldUnit=function(f,l,r=1){if(1===r||!L.isValidPixelBlock(f))return f;f=f.clone();const {pixels:z,width:y,height:F}=f,K=z[0],H=z[1];let D=0;for(let G=0;G<
F;G++)for(let S=0;S<y;S++)"vector-uv"===l?(K[D]*=r,H[D]*=r):K[D]*=r,D++;f.updateStatistics();return f};m.createVFMesh=function(f,l){if("simple_scalar"===l.style)l=n(f,l);else if("wind_speed"===l.style){if(0===c.length)for(var r=0;30>r;r++)c.push(p(5*r,0,!l.invertDirection));l=t.fromJSON(l.inputUnit);l=E(l,"knots");const {width:K,height:H,mask:D}=f;r=f.pixels[0];f=f.pixels[1];const G=[],S=[];let A=0,B=0;for(let Q=0;Q<H;Q++)for(let O=0;O<K;O++){var z=Q*K+O,y=r[z]*l;if((!D||D[Q*K+O])&&5<=y){const C=
(f[z]+360)%360/180*Math.PI,{pennants:M,barbs:N,shaft:U}=c[Math.min(Math.floor(y/5),29)];if(0===M.length+N.length)continue;z=G.length/6;const X=(O+.5)/K,I=(Q+.5)/H;for(var F=0;F<M.length;F+=2)G[A++]=X,G[A++]=I,G[A++]=M[F],G[A++]=M[F+1]+C,G[A++]=0,G[A++]=y;for(F=0;F<N.length;F+=2)G[A++]=X,G[A++]=I,G[A++]=N[F],G[A++]=N[F+1]+C,G[A++]=0,G[A++]=y;for(F=0;F<U.length;F+=2)G[A++]=X,G[A++]=I,G[A++]=U[F],G[A++]=U[F+1]+C,G[A++]=0,G[A++]=y;for(y=0;y<M.length/6;y++)S[B++]=z,S[B++]=z+1,S[B++]=z+2,z+=3;for(y=0;y<
N.length/8;y++)S[B++]=z,S[B++]=z+1,S[B++]=z+2,S[B++]=z+1,S[B++]=z+2,S[B++]=z+3,z+=4;S[B++]=z+0;S[B++]=z+1;S[B++]=z+2;S[B++]=z+1;S[B++]=z+3;S[B++]=z+2;z+=4}}l={vertexData:new Float32Array(G),indexData:new Uint32Array(S)}}else l=k(f,l);return l};m.createVFMeshScalar=n;m.getUnitConversionFactor=E;m.sampleVectorField=function(f,l,r,z=[0,0],y=.5){const {width:F,height:K,mask:H}=f,[D,G]=f.pixels,[S,A]=z;f=Math.round((F-S)/r);z=Math.round((K-A)/r);var B=f*z;const Q=new Float32Array(B),O=new Float32Array(B);
B=new Uint8Array(B);l="vector-uv"===l;for(let M=0;M<z;M++)for(let N=0;N<f;N++){let U=0;const X=M*f+N,I=Math.max(0,M*r+A),V=Math.max(0,N*r+S),W=Math.min(K,I+r),Z=Math.min(F,V+r);for(let Y=I;Y<W;Y++)for(let aa=V;aa<Z;aa++){var C=Y*F+aa;if(!H||H[C]){U++;C=l?[D[C],G[C]]:[D[C],(360+G[C])%360];const [ea,fa]=l?C:R(C);Q[X]+=ea;O[X]+=fa}}if(U>=(W-I)*(Z-V)*(1-y)){B[X]=1;const [Y,aa]=T([Q[X]/U,O[X]/U]);Q[X]=Y;O[X]=aa}else B[X]=0,Q[X]=0,O[X]=0}r=new w({width:f,height:z,pixels:[Q,O],mask:B});r.updateStatistics();
return r};m.snapImageToSymbolTile=function(f,l,r,z,y){if(null==y||!y.spatialReference.equals(f.spatialReference))return{extent:f,width:Math.round(l/z),height:Math.round(r/z),resolution:f.width/l};const F=y.xmin;y=y.ymax;l=(f.xmax-f.xmin)/l*z;r=(f.ymax-f.ymin)/r*z;f.xmin=F+Math.floor((f.xmin-F)/l)*l;f.xmax=F+Math.ceil((f.xmax-F)/l)*l;f.ymin=y+Math.floor((f.ymin-y)/r)*r;f.ymax=y+Math.ceil((f.ymax-y)/r)*r;return{extent:f,width:Math.round(f.width/l),height:Math.round(f.height/r),resolution:(l+r)/2}};
m.unitKebabDict=t;m.uvComponentToVector=T;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),function(m,v,w,L,E,T,R,P,J,p){var u;w=u=class extends w.JSONSupport{static createEmptyBand(d,
g){return new (u.getPixelArrayConstructor(d))(g)}static combineBandMasks(d){if(2>d.length)return d[0];const g=d[0].length,k=(new Uint8Array(g)).fill(255);for(let n=0;n<d.length;n++){const h=d[n];for(let q=0;q<g;q++)h[q]||(k[q]=0)}return k}static getPixelArrayConstructor(d){let g;switch(d){case "u1":case "u2":case "u4":case "u8":g=Uint8Array;break;case "u16":g=Uint16Array;break;case "u32":g=Uint32Array;break;case "s8":g=Int8Array;break;case "s16":g=Int16Array;break;case "s32":g=Int32Array;break;case "f32":g=
Float32Array;break;case "f64":g=Float64Array;break;case "c64":case "c128":case "unknown":g=Float32Array}return g}constructor(d){super(d);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(d){if(!d)return"f32";d=d.toLowerCase();["u1","u2","u4"].includes(d)?d="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(d)||(d="f32");return d}getPlaneCount(){return this.pixels?.length}addData(d){if(!d.pixels||
d.pixels.length!==this.width*this.height)throw new v("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(d.pixels);this.statistics.push(d.statistics??new J.SimpleBandStatistics)}getAsRGBA(){const d=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(d);
break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)}getAsRGBAFloat(){const d=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(d);return d}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(k=>this._calculateBandStatistics(k,this.mask));var d=this.mask,g=0;if(null!=d)for(let k=0;k<d.length;k++)d[k]&&g++;else g=this.width*this.height;this.validPixelCount=g}}clamp(d){if(d&&"f64"!==d&&"f32"!==d&&this.pixels){var [g,k]=p.getPixelValueRange(d),n=this.pixels,
h=this.width*this.height,q=n.length,t=[];for(let a=0;a<q;a++){var x=u.createEmptyBand(d,h);var b=n[a];for(let c=0;c<h;c++){var e=b[c];x[c]=e>k?k:e<g?g:e}t.push(x)}this.pixels=t;this.pixelType=d}}extractBands(d){const {pixels:g,statistics:k}=this;if(null==d||0===d.length||!g||0===g.length)return this;var n=g.length;const h=d.some(a=>a>=g.length),q=n===d.length&&!d.some((a,c)=>a!==c);if(h||q)return this;n=this.bandMasks?.length===n?d.map(a=>this.bandMasks[a]):void 0;let {mask:t,validPixelCount:x}=this;
const {width:b,height:e}=this;n?.length&&(t=u.combineBandMasks(n),x=t.filter(a=>!!a).length);return new u({pixelType:this.pixelType,width:b,height:e,mask:t,bandMasks:n,validPixelCount:x,maskIsAlpha:this.maskIsAlpha,pixels:d.map(a=>g[a]),statistics:k&&d.map(a=>k[a])})}clone(){const d=new u({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(d.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):
this.mask.slice(0));this.bandMasks&&(d.bandMasks=this.bandMasks.map(n=>new Uint8Array(n)));let g;const k=u.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){d.pixels=[];const n=!!this.pixels[0].slice;for(g=0;g<this.pixels.length;g++)d.pixels[g]=n?this.pixels[g].slice(0,this.pixels[g].length):new k(this.pixels[g])}if(this.statistics)for(d.statistics=[],g=0;g<this.statistics.length;g++)d.statistics[g]=L.clone(this.statistics[g]);d.premultiplyAlpha=this.premultiplyAlpha;
return d}_fillFrom8Bit(d){const {mask:g,maskIsAlpha:k,premultiplyAlpha:n,pixels:h}=this;if(d&&h?.length){var q,t;var x=q=t=h[0];3<=h.length?(q=h[1],t=h[2]):2===h.length&&(q=h[1]);var b=new Uint32Array(d),e=this.width*this.height;if(x.length!==e)E.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=g&&g.length===e)if(k)for(d=0;d<e;d++){const a=g[d];if(a){const c=a/255;b[d]=n?a<<24|t[d]*c<<16|q[d]*c<<8|x[d]*c:a<<24|t[d]<<16|q[d]<<8|x[d]}}else for(d=
0;d<e;d++)g[d]&&(b[d]=-16777216|t[d]<<16|q[d]<<8|x[d]);else for(d=0;d<e;d++)b[d]=-16777216|t[d]<<16|q[d]<<8|x[d]}else E.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(d){const {pixels:g,mask:k,statistics:n}=this;if(d&&g?.length){var h=this.pixelType,q=1,t=0;q=1;if(n&&0<n.length){for(var x of n)null!=x.minValue&&(t=Math.min(t,x.minValue)),null!=x.maxValue&&null!=x.minValue&&(q=Math.max(q,x.maxValue-x.minValue));q=255/q}else q=255,
"s8"===h?(t=-128,q=127):"u16"===h?q=65535:"s16"===h?(t=-32768,q=32767):"u32"===h?q=4294967295:"s32"===h?(t=-2147483648,q=2147483647):"f32"===h?(t=-3.4*1E39,q=3.4*1E39):"f64"===h&&(t=-Number.MAX_VALUE,q=Number.MAX_VALUE),q=255/(q-t);d=new Uint32Array(d);h=this.width*this.height;var b,e,a;x=b=e=g[0];if(x.length!==h)return E.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=g.length)if(b=g[1],3<=g.length&&(e=g[2]),null!=k&&k.length===h)for(a=0;a<h;a++)k[a]&&
(d[a]=-16777216|(e[a]-t)*q<<16|(b[a]-t)*q<<8|(x[a]-t)*q);else for(a=0;a<h;a++)d[a]=-16777216|(e[a]-t)*q<<16|(b[a]-t)*q<<8|(x[a]-t)*q;else if(null!=k&&k.length===h)for(a=0;a<h;a++)b=(x[a]-t)*q,k[a]&&(d[a]=-16777216|b<<16|b<<8|b);else for(a=0;a<h;a++)b=(x[a]-t)*q,d[a]=-16777216|b<<16|b<<8|b}else E.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(d){const {pixels:g,mask:k}=this;if(!d||!g?.length)return E.getLogger(this).error("getAsRGBAFloat()",
"Unable to convert to RGBA. The input pixel block is empty.");let n,h,q,t;n=h=q=g[0];3<=g.length?(h=g[1],q=g[2]):2===g.length&&(h=g[1]);const x=this.width*this.height;if(n.length!==x)return E.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let b=0;if(null!=k&&k.length===x)for(t=0;t<x;t++)d[b++]=n[t],d[b++]=h[t],d[b++]=q[t],d[b++]=k[t]&1;else for(t=0;t<x;t++)d[b++]=n[t],d[b++]=h[t],d[b++]=q[t],d[b++]=1}_calculateBandStatistics(d,g){let k=Infinity,n=
-Infinity;const h=d.length;let q,t=0;if(null!=g)for(q=0;q<h;q++)g[q]&&(t=d[q],k=t<k?t:k,n=t>n?t:n);else for(q=0;q<h;q++)t=d[q],k=t<k?t:k,n=t>n?t:n;return new J.SimpleBandStatistics(k,n)}};m.__decorate([T.property({json:{write:!0}})],w.prototype,"width",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"height",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"pixelType",void 0);m.__decorate([R.cast("pixelType")],w.prototype,"castPixelType",null);m.__decorate([T.property({json:{write:!0}})],
w.prototype,"validPixelCount",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"mask",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"maskIsAlpha",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"pixels",void 0);m.__decorate([T.property()],w.prototype,"premultiplyAlpha",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"statistics",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"depthCount",void 0);m.__decorate([T.property({json:{write:!0}})],
w.prototype,"noDataValues",void 0);m.__decorate([T.property({json:{write:!0}})],w.prototype,"bandMasks",void 0);return w=u=m.__decorate([P.subclass("esri.layers.support.PixelBlock")],w)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(m){class v{constructor(w=null,L=null,E=null){this.minValue=w;this.maxValue=L;this.noDataValue=E}}m.SimpleBandStatistics=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],
function(m){function v(L){return w[L]??[-3.4028234663852886E38,3.4028234663852886E38]}const w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};m.convertNoDataToMask=function(L,E,T){if(!(L.depthCount&&1<L.depthCount)){var {pixels:R,statistics:P,pixelType:J}=L,p=R[0].length,u=L.bandMasks??
[];p=L.mask??(new Uint8Array(p)).fill(255);var d="f32"===J||"f64"===J,g=v(J),k=!1;for(let q=0;q<R.length;q++){const t="number"===typeof E?E:E[q];if(null==t)continue;var n=P?.[q]?.maxValue??g[1];if((P?.[q]?.minValue??g[0])>t+Number.EPSILON||n<t-Number.EPSILON)continue;n=u[q]||p.slice();const x=R[q];var h=T?.customFloatTolerance;if(d&&0!==h){h||=9.999999E37<=Math.abs(t)?2E-7*Math.abs(t):"f32"===J?2**-23:Number.EPSILON;for(let b=0;b<x.length;b++)n[b]&&Math.abs(x[b]-t)<h&&(x[b]=0,n[b]=0,p[b]=0,k=!0)}else for(h=
0;h<x.length;h++)n[h]&&x[h]===t&&(x[h]=0,n[h]=0,p[h]=0,k=!0);u[q]=n}k&&(L.bandMasks=L.bandMasks||1<L.pixels.length?u:null,L.mask=p);k&&"updateStatistics"in L&&L.updateStatistics()}};m.getIntegerPixelType=function(L,E){return null==L||null==E?"s32":0>L?-128<=L&&128>E?"s8":-32768<=L&&32768>E?"s16":"s32":256>E?"u8":65536>E?"u16":"u32"};m.getPixelValueRange=v;m.isIntegerPixelType=function(L){return(L?.startsWith("s")||L?.startsWith("u"))??!1};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(m,v,w){function L(b){return null!=b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length}function E(b,e,a,c,f){const l=b.length;f=v.createEmptyBand(f,l);if(e)for(let r=0;r<l;r++)e[r]&&(f[r]=a[b[r]-c]);else for(e=0;e<l;e++)f[e]=a[b[e]-c];return f}function T(b,e,a,c){const f=null!=a&&2<=a.length?new Set(a):null;a=1===a?.length?a[0]:null;
const l=!!e?.length;for(let r=0;r<b.length;r++)if(c[r]){const z=b[r];if(l){let y=!1;for(let F=0;F<e.length;F+=2)if(z>=e[F]&&z<=e[F+1]){y=!0;break}y||(c[r]=0)}c[r]&&(z===a||f?.has(z))&&(c[r]=0)}}function R(b,e){const a=b[0].length;for(let c=0;c<a;c++)if(e[c]){let f=!1;for(let l=0;l<b.length;l++)if(b[l][c]){f=!0;break}f||(e[c]=0)}}function P(b,e){const a=b[0].length;for(let c=0;c<a;c++)if(e[c]){let f=!1;for(let l=0;l<b.length;l++)if(0===b[l][c]){f=!0;break}f&&(e[c]=0)}}function J(b,e,a,c,f,l,r,z){return{xmin:f<=
a*b?0:f<a*b+b?f-a*b:b,ymin:l<=c*e?0:l<c*e+e?l-c*e:e,xmax:f+r<=a*b?0:f+r<a*b+b?f+r-a*b:b,ymax:l+z<=c*e?0:l+z<c*e+e?l+z-c*e:e}}function p(b,e,a,c,f,l){const {width:r,height:z}=a.block,{x:y,y:F}=a.offset,{width:K,height:H}=a.mosaic;a=J(r,z,c,f,y,F,K,H);let D=0;var G=0;if(l){var S=l.hasGCSSShiftTransform?360:l.halfWorldWidth??0,A=r*l.resolutionX;const B=l.startX+c*A;B<S&&B+A>S?G=l.rightPadding:B>=S&&(D=l.leftMargin-l.rightPadding,G=0)}a.xmax-=G;if("number"===typeof e)for(l=a.ymin;l<a.ymax;l++)for(G=(f*
z+l-F)*K+(c*r-y)+D,S=a.xmin;S<a.xmax;S++)b[G+S]=e;else for(l=a.ymin;l<a.ymax;l++)for(G=(f*z+l-F)*K+(c*r-y)+D,S=l*r,A=a.xmin;A<a.xmax;A++)b[G+A]=e[S+A]}function u(b,e,a={}){const {clipOffset:c,clipSize:f,alignmentInfo:l,blockWidths:r}=a;if(r)return d(b,e,{blockWidths:r});var z=b.find(C=>L(C));if(null==z)return null;a=f?f.width:e.width;const y=f?f.height:e.height;var F=z.width,K=z.height;const H=e.width/F,D=e.height/K;e={offset:c||{x:0,y:0},mosaic:f||e,block:{width:F,height:K}};F=z.pixelType;var G=
v.getPixelArrayConstructor(F);z=z.pixels.length;K=[];for(var S=0;S<z;S++){var A=new G(a*y);for(var B=0;B<D;B++)for(var Q=0;Q<H;Q++){var O=b[B*H+Q];L(O)&&(O=O.pixels[S],p(A,O,e,Q,B,l))}K.push(A)}G=b.some(C=>null==C||null!=C.mask&&0<C.mask.length);A=b.some(C=>C?.bandMasks&&1<C.bandMasks.length);G=G?new Uint8Array(a*y):void 0;A=A?[]:void 0;if(G){for(S=0;S<D;S++)for(B=0;B<H;B++)Q=b[S*H+B],O=null!=Q?Q.mask:null,null!=O?p(G,O,e,B,S,l):Q?p(G,255,e,B,S,l):p(G,0,e,B,S,l);if(A)for(S=0;S<z;S++){B=new Uint8Array(a*
y);for(Q=0;Q<D;Q++)for(O=0;O<H;O++){const C=b[Q*H+O],M=C?.bandMasks?.[S]??C?.mask;null!=M?p(B,M,e,O,Q,l):C?p(B,255,e,O,Q,l):p(B,0,e,O,Q,l)}A.push(B)}}b=new v({width:a,height:y,pixels:K,pixelType:F,bandMasks:A,mask:G});b.updateStatistics();return b}function d(b,e,a){const c=b.find(B=>null!=B);if(null==c)return null;var f=b.some(B=>null!=B?!!B.mask:!0);const {width:l,height:r}=e;e=f?new Uint8Array(l*r):null;({blockWidths:a}=a);const z=[],y=c.getPlaneCount(),F=v.getPixelArrayConstructor(c.pixelType);
if(f)for(let B=0,Q=0;B<b.length;Q+=a[B],B++)if(f=b[B],L(f)){var K=f.mask;for(var H=0;H<r;H++)for(var D=0;D<a[B];D++)e[H*l+D+Q]=null==K?255:K[H*f.width+D]}K=(f=b.some(B=>B?.bandMasks&&1<B.bandMasks.length))?[]:void 0;H=l*r;for(D=0;D<y;D++){const B=new F(H),Q=f?new Uint8Array(H):void 0;for(let O=0,C=0;O<b.length;C+=a[O],O++){const M=b[O];if(L(M)){var G=M.pixels[D];if(null!=G){for(var S=0;S<r;S++)for(var A=0;A<a[O];A++)B[S*l+A+C]=G[S*M.width+A];if(Q)for(G=M.bandMasks?.[D]??M.mask,S=0;S<r;S++)for(A=0;A<
a[O];A++)Q[S*l+A+C]=G?G[S*M.width+A]:255}}}z.push(B);K&&Q&&K.push(Q)}b=new v({width:l,height:r,mask:e,bandMasks:K,pixels:z,pixelType:c.pixelType});b.updateStatistics();return b}function g(b){if(!L(b))return null;const e=b.clone(),{width:a,height:c,pixels:f}=b;var l=f[0];const r=e.pixels[0];b=b.mask;for(let F=2;F<c-1;F++){const K=new Map;for(var z=F-2;z<F+2;z++)for(var y=0;4>y;y++){const H=z*a+y;h(K,l[H],b?b[H]:1)}r[F*a]=k(K);r[F*a+1]=r[F*a+2]=r[F*a];for(z=3;z<a-1;z++)y=(F-2)*a+z+1,h(K,l[y],b?b[y]:
1),y=(F-1)*a+z+1,h(K,l[y],b?b[y]:1),y=F*a+z+1,h(K,l[y],b?b[y]:1),y=(F+1)*a+z+1,h(K,l[y],b?b[y]:1),y=(F-2)*a+z-3,n(K,l[y],b?b[y]:1),y=(F-1)*a+z-3,n(K,l[y],b?b[y]:1),y=F*a+z-3,n(K,l[y],b?b[y]:1),y=(F+1)*a+z-3,n(K,l[y],b?b[y]:1),r[F*a+z]=k(K);r[F*a+z+1]=r[F*a+z]}for(l=0;l<a;l++)r[l]=r[a+l]=r[2*a+l],r[(c-1)*a+l]=r[(c-2)*a+l];e.updateStatistics();return e}function k(b){if(0===b.size)return 0;let e=0,a=-1,c=0;const f=b.keys();let l=f.next();for(;!l.done;)c=b.get(l.value),c>e&&(a=l.value,e=c),l=f.next();
return a}function n(b,e,a){0!==a&&(a=b.get(e),1===a?b.delete(e):b.set(e,a-1))}function h(b,e,a){0!==a&&b.set(e,b.has(e)?b.get(e)+1:1)}function q(b,e,a){let {x:c,y:f}=e;const {width:l,height:r}=a;if(0===c&&0===f&&r===b.height&&l===b.width)return b;const {width:z,height:y}=b;e=Math.max(0,f);const F=Math.max(0,c),K=Math.min(c+l,z),H=Math.min(f+r,y);if(0>K||0>H||!L(b))return null;c=Math.max(0,-c);f=Math.max(0,-f);var {pixels:D}=b,G=l*r,S=D.length;const A=[];for(var B=0;B<S;B++){var Q=D[B],O=v.createEmptyBand(b.pixelType,
G);for(let C=e;C<H;C++){const M=C*z;let N=(C+f-e)*l+c;for(let U=F;U<K;U++)O[N++]=Q[M+U]}A.push(O)}D=new Uint8Array(G);G=b.mask;for(S=e;S<H;S++)for(B=S*z,Q=(S+f-e)*l+c,O=F;O<K;O++)D[Q++]=G?G[B+O]:1;b=new v({width:a.width,height:a.height,pixelType:b.pixelType,pixels:A,mask:D});b.updateStatistics();return b}function t(b,e=!0){if(!L(b))return null;const {pixels:a,width:c,height:f,mask:l,pixelType:r}=b;b=[];const z=Math.round(c/2),y=Math.round(f/2),F=f-1,K=c-1;for(var H=0;H<a.length;H++){var D=a[H],G=
v.createEmptyBand(r,z*y),S=0;for(var A=0;A<f;A+=2)for(var B=0;B<c;B+=2){var Q=D[A*c+B];if(e){var O=B===K?Q:D[A*c+B+1];const C=A===F?Q:D[A*c+B+c],M=B===K?C:A===F?O:D[A*c+B+c+1];G[S++]=(Q+O+C+M)/4}else G[S++]=Q}b.push(G)}H=null;if(null!=l)for(H=new Uint8Array(z*y),D=0,G=0;G<f;G+=2)for(S=0;S<c;S+=2)A=l[G*c+S],e?(B=S===K?A:l[G*c+S+1],Q=G===F?A:l[G*c+S+c],O=S===K?Q:G===F?B:l[G*c+S+c+1],H[D++]=A*B*Q*O?1:0):H[D++]=A;return new v({width:z,height:y,pixelType:r,pixels:b,mask:H})}function x(b,e,a,c,f=0){const {width:l,
height:r}=b,{width:z,height:y}=e;b=c.cols;c=c.rows;e=Math.ceil(z/b-.1/b);const F=Math.ceil(y/c-.1/c);let K,H,D,G,S;const A=e*b;var B=A*F*c;const Q=new Float32Array(B),O=new Float32Array(B),C=new Uint32Array(B),M=new Uint32Array(B);let N=0,U,X;for(let W=0;W<F;W++)for(let Z=0;Z<e;Z++){var I=12*(W*e+Z);B=a[I];K=a[I+1];H=a[I+2];D=a[I+3];G=a[I+4];S=a[I+5];for(var V=0;V<c;V++){N=(W*c+V)*A+Z*b;X=(V+.5)/c;for(let Y=0;Y<V;Y++)U=(Y+.5)/b,Q[N+Y]=(B*U+K*X+H)*l+f,O[N+Y]=(D*U+G*X+S)*r+f,C[N+Y]=Math.floor(Q[N+Y]),
M[N+Y]=Math.floor(O[N+Y])}I+=6;B=a[I];K=a[I+1];H=a[I+2];D=a[I+3];G=a[I+4];S=a[I+5];for(I=0;I<c;I++)for(N=(W*c+I)*A+Z*b,X=(I+.5)/c,V=I;V<b;V++)U=(V+.5)/b,Q[N+V]=(B*U+K*X+H)*l+f,O[N+V]=(D*U+G*X+S)*r+f,C[N+V]=Math.floor(Q[N+V]),M[N+V]=Math.floor(O[N+V])}return{offsets_x:Q,offsets_y:O,offsets_xi:C,offsets_yi:M,gridWidth:A}}m.NoDataInterpretation=void 0;(function(b){b[b.matchAny=0]="matchAny";b[b.matchAll=1]="matchAll"})(m.NoDataInterpretation||(m.NoDataInterpretation={}));m.MissingBandAction=void 0;(function(b){b[b.bestMatch=
0]="bestMatch";b[b.fail=1]="fail"})(m.MissingBandAction||(m.MissingBandAction={}));m.approximateTransform=function(b,e,a,c,f="nearest"){if(!L(b))return null;"majority"===f&&(b=g(b));const {pixels:l,mask:r,bandMasks:z,pixelType:y}=b,F=b.width;var K=b.height;const H=v.getPixelArrayConstructor(y),D=l.length,{width:G,height:S}=e;b=!1;for(var A=0;A<a.length;A+=3)-1===a[A]&&-1===a[A+1]&&-1===a[A+2]&&(b=!0);const {offsets_x:B,offsets_y:Q,offsets_xi:O,offsets_yi:C,gridWidth:M}=x({width:F,height:K},e,a,c,
"majority"===f?.5:0);let N;e=(X,I,V,W)=>{const Z=X instanceof Float32Array||X instanceof Float64Array?0:.5;for(let Y=0;Y<S;Y++){N=Y*M;for(let aa=0;aa<G;aa++){if(0>B[N]||0>Q[N])X[Y*G+aa]=0;else if(W)X[Y*G+aa]=I[O[N]+C[N]*F];else{const ea=Math.floor(B[N]),fa=Math.floor(Q[N]),ca=Math.ceil(B[N]),ja=Math.ceil(Q[N]),la=B[N]-ea,na=Q[N]-fa;X[Y*G+aa]=!V||V[ea+fa*F]&&V[ca+fa*F]&&V[ea+ja*F]&&V[ca+ja*F]?(1-na)*((1-la)*I[ea+fa*F]+la*I[ca+fa*F])+na*((1-la)*I[ea+ja*F]+la*I[ca+ja*F])+Z:I[O[N]+C[N]*F]}N++}}};a=[];
c=z?.length===D;K=[];for(A=0;A<D;A++){if(c){var U=new Uint8Array(G*S);e(U,z[A],z[A],!0);K.push(U)}U=new H(G*S);e(U,l[A],c?z[A]:r,"nearest"===f||"majority"===f);a.push(U)}f=new v({width:G,height:S,pixelType:y,pixels:a,bandMasks:c?K:void 0});if(null!=r)f.mask=new Uint8Array(G*S),e(f.mask,r,r,!0);else if(b)for(f.mask=new Uint8Array(G*S),b=0;b<G*S;b++)f.mask[b]=0>B[b]||0>Q[b]?0:1;f.updateStatistics();return f};m.clip=q;m.clipTile=function(b){const {pixelBlock:e,tileSize:a,level:c,row:f,col:l,useBilinear:r}=
b;if(!L(e))return null;const {width:z,height:y}=a;var F=2**c;b=F*z;F*=y;b=q(e,{y:f*F,x:l*b},{width:b,height:F});if(!b)return null;for(F=c;0<F;F--)b=t(b,r);return b};m.colorize=function(b,e){if(!L(b)||!e||!e.indexedColormap&&!e.indexed2DColormap)return b;const a=b.clone();var c=a.pixels;let f=a.mask;const l=a.width*a.height;if(1!==c.length)return b;const {indexedColormap:r,indexed2DColormap:z,offset:y,alphaSpecified:F}=e;b=0;c=c[0];e=new Uint8Array(c.length);const K=new Uint8Array(c.length),H=new Uint8Array(c.length);
var D=0;if(r){const G=r.length-1;if(null!=f)for(b=0;b<l;b++)f[b]&&(D=4*(c[b]-y),D<y||D>G?f[b]=0:(e[b]=r[D],K[b]=r[D+1],H[b]=r[D+2],f[b]=r[D+3]));else{f=new Uint8Array(l);for(b=0;b<l;b++)D=4*(c[b]-y),D<y||D>G?f[b]=0:(e[b]=r[D],K[b]=r[D+1],H[b]=r[D+2],f[b]=r[D+3]);a.mask=f}}else if(z)if(null!=f)for(b=0;b<l;b++)f[b]&&(D=z[c[b]],e[b]=D[0],K[b]=D[1],H[b]=D[2],f[b]=D[3]);else{f=new Uint8Array(l);for(b=0;b<l;b++)D=z[c[b]],e[b]=D[0],K[b]=D[1],H[b]=D[2],f[b]=D[3];a.mask=f}a.pixels=[e,K,H];a.statistics=null;
a.pixelType="u8";a.maskIsAlpha=F;return a};m.compositeBands=function(b){if(!b?.length||b.some(y=>!L(y)))return null;if(1===b.length)return b[0]?.clone()??null;const {width:e,height:a,pixelType:c}=b[0];if(b.some(y=>y.width!==e||y.height!==a))return null;const f=b.map(({mask:y})=>y).filter(y=>null!=y);let l=null;f.length&&(l=new Uint8Array(e*a),l.set(f[0]),1<f.length&&P(f.slice(1),l));const r=[];b.forEach(({pixels:y})=>r.push(...y));const z=[];b.map(({statistics:y})=>y).filter(y=>y?.length).forEach(y=>
z.push(...y));return new v({pixelType:c,width:e,height:a,mask:l,pixels:r,statistics:z.length?z:null})};m.createColormapLUT=function(b){if(b){var e=b.colormap;if(e&&0!==e.length){e=e.sort((F,K)=>F[0]-K[0]);var a=0;0>e[0][0]&&(a=e[0][0]);var c=Math.max(256,e[e.length-1][0]-a+1),f=new Uint8Array(4*c),l=[],r=0,z=0,y=5===e[0].length;if(65536<c)return e.forEach(F=>{l[F[0]-a]=y?F.slice(1):F.slice(1).concat([255])}),{indexed2DColormap:l,offset:a,alphaSpecified:y};if(b.fillUnspecified)for(b=e[z],r=b[0]-a;r<
c;r++)f[4*r]=b[1],f[4*r+1]=b[2],f[4*r+2]=b[3],f[4*r+3]=y?b[4]:255,r===b[0]-a&&(b=z===e.length-1?b:e[++z]);else for(r=0;r<e.length;r++)b=e[r],z=4*(b[0]-a),f[z]=b[1],f[z+1]=b[2],f[z+2]=b[3],f[z+3]=y?b[4]:255;return{indexedColormap:f,offset:a,alphaSpecified:y}}}};m.createMaskLUT=function(b,e,a){if("u8"!==b&&"s8"!==b&&"u16"!==b&&"s16"!==b)return null;var c=b.includes("16")?65536:256;b=b.includes("s")?-c/2:0;c=new Uint8Array(c);if(e)for(let l=0;l<e.length;l++){var f=Math.ceil(e[2*l]-b);const r=Math.floor(e[2*
l+1]-b);for(;f<=r;f++)c[f]=255}else c.fill(255);if(a)for(e=0;e<a.length;e++)c[a[e]-b]=0;return{lut:c,offset:b}};m.createRemapLUT=function(b){const {srcPixelType:e,inputRanges:a,outputValues:c,allowUnmatched:f,noDataRanges:l,isLastInputRangeInclusive:r,outputPixelType:z}=b;if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;var y=e.includes("16")?65536:256;b=e.includes("s")?-y/2:0;const F=v.createEmptyBand(z,y);y=new Uint8Array(y);f&&y.fill(255);const [K,H]=w.getPixelValueRange(z);if(a?.length&&
c?.length){var D=a.map(B=>B-1E-6);D[0]=a[0];r&&(D[D.length-1]=a[a.length-1]);for(var G=0;G<D.length;G++){var S=c[G]>H?H:c[G]<K?K:c[G],A=Math.ceil(D[2*G]-b);const B=Math.floor(D[2*G+1]-b);for(;A<=B;A++)F[A]=S,y[A]=255}}if(l?.length)for(D=0;D<l.length;D++)for(S=Math.ceil(l[2*D]-b),G=Math.floor(l[2*D+1]-b);S<=G;S++)y[S]=0;return{lut:F,offset:b,mask:y}};m.extractBands=function(b,e){return e?.length&&L(b)?b.extractBands(e):b};m.getClipBounds=J;m.getLocalArithmeticNorthRotations=function(b,e){const {coefficients:a,
spacing:c}=e,{offsets_x:f,offsets_y:l,gridWidth:r}=x(b,b,a,{rows:c[0],cols:c[1]}),{width:z,height:y}=b;b=new Float32Array(z*y);e=180/Math.PI;for(let H=0;H<y;H++)for(let D=0;D<z;D++){var F=H*r+D,K=0===H?F:F-r;const G=H===y-1?F:F+r;F=f[K]-f[G];K=l[G]-l[K];isNaN(F)||isNaN(K)?b[H*z+D]=90:(K=Math.atan2(K,F)*e,K=(360+K)%360,b[H*z+D]=K)}return b};m.interpolateOffsets=x;m.isValidPixelBlock=L;m.lookupBandValues=E;m.lookupPixels=function(b,e){if(!L(b))return null;const {pixels:a,mask:c}=b,f=a.length;let l=
e.lut;const {offset:r}=e;l&&1===l[0].length&&(l=a.map(()=>l));const z=[];e=e.outputPixelType||"u8";for(let y=0;y<f;y++){const F=E(a[y],c,l[y],r||0,e);z.push(F)}b=new v({width:b.width,height:b.height,pixels:z,mask:c,pixelType:e});b.updateStatistics();return b};m.mask=function(b,e){if(!L(b))return null;const {width:a,height:c,pixels:f}=b;var l=a*c;const r=new Uint8Array(l);b.mask?r.set(b.mask):r.fill(255);b=f.length;const {includedRanges:z,noDataValues:y,outputPixelType:F,matchAll:K,lookups:H}=e;if(H){l=
[];for(e=0;e<b;e++){var D=H[e];D=E(f[e],r,D.lut,D.offset||0,"u8");l.push(D)}1===l.length?r.set(l[0]):K?R(l,r):P(l,r)}else if(K){e=[];for(D=0;D<b;D++){const G=new Uint8Array(l);G.set(r);T(f[D],z?.slice(2*D,2*D+2),y?.[D],G);e.push(G)}1===e.length?r.set(e[0]):R(e,r)}else for(l=0;l<b;l++)T(f[l],z?.slice(2*l,2*l+2),y?.[l],r);return new v({width:a,height:c,pixelType:F,pixels:f,mask:r})};m.maxMapSizeGpu=6;m.mosaic=u;m.mosaicPixelData=function(b,e){if(!b||0===b.length)return null;var a=b.find(H=>H.pixelBlock);
if(null==a?.pixelBlock)return null;var c=(a.extent.xmax-a.extent.xmin)/a.pixelBlock.width;const f=(a.extent.ymax-a.extent.ymin)/a.pixelBlock.height,l=.01*Math.min(c,f),r=b.sort((H,D)=>Math.abs(H.extent.ymax-D.extent.ymax)>l?D.extent.ymax-H.extent.ymax:Math.abs(H.extent.xmin-D.extent.xmin)>l?H.extent.xmin-D.extent.xmin:0);var z=Math.min.apply(null,r.map(H=>H.extent.xmin));const y=Math.min.apply(null,r.map(H=>H.extent.ymin)),F=Math.max.apply(null,r.map(H=>H.extent.xmax)),K=Math.max.apply(null,r.map(H=>
H.extent.ymax));b={x:Math.round((e.xmin-z)/c),y:Math.round((K-e.ymax)/f)};z={width:Math.round((F-z)/c),height:Math.round((K-y)/f)};c={width:Math.round((e.xmax-e.xmin)/c),height:Math.round((e.ymax-e.ymin)/f)};if(Math.round(z.width/a.pixelBlock.width)*Math.round(z.height/a.pixelBlock.height)!==r.length||0>b.x||0>b.y||z.width<c.width||z.height<c.height)return null;a=r.map(H=>H.pixelBlock);a=u(a,z,{clipOffset:b,clipSize:c});return{extent:e,pixelBlock:a}};m.remap=function(b,e){if(!L(b))return null;const {width:a,
height:c}=b,{inputRanges:f,outputValues:l,outputPixelType:r,noDataRanges:z,allowUnmatched:y,isLastInputRangeInclusive:F}=e;e=b.pixels[0];const K=v.createEmptyBand(r,e.length),H=b.mask,D=new Uint8Array(a*c);H?D.set(H):D.fill(255);const G=b.pixelType.startsWith("f")?1E-6:0;b=f.map(N=>N-G);b[0]=f[0];b[b.length-1]=f[f.length-1]+(F?1E-6:0);var S=f.length/2;const [A,B]=w.getPixelValueRange(r);for(var Q=0;Q<c;Q++)for(var O=0;O<a;O++){var C=Q*a+O;if(D[C]){var M=e[C];let N=!1;for(let U=S-1;0<=U;U--)if(M===
b[2*U]||M>b[2*U]&&M<b[2*U+1]){K[C]=l[U];N=!0;break}N||(y?K[C]=M>B?B:M<A?A:M:D[C]=0)}}if(b=z?.length)for(S=0;S<c;S++)for(Q=0;Q<a;Q++)if(O=S*a+Q,!H||H[O])for(C=e[O],M=0;M<b;M+=2)if(C>=z[M]&&C<=z[M+1]){K[O]=0;D[O]=0;break}return new v({width:a,height:c,pixelType:r,pixels:[K],mask:D})};m.remapColor=function(b,e){if(!L(b))return null;b=b.clone();var {pixels:a}=b;const c=b.width*b.height,f=e.length,l=Math.floor(f/2),r=e[Math.floor(l)];a=a[0];let z,y,F,K,H,D,G=!1;const S=new Uint8Array(c),A=new Uint8Array(c),
B=new Uint8Array(c);let Q=b.mask;const O=4===e[0].mappedColor.length;Q||(Q=new Uint8Array(c),Q.fill(O?255:1),b.mask=Q);for(H=0;H<c;H++)if(Q[H]){z=a[H];G=!1;D=l;y=r;F=0;for(K=f-1;1<K-F;){if(z===y.value){G=!0;break}z>y.value?F=D:K=D;D=Math.floor((F+K)/2);y=e[Math.floor(D)]}G||(z===e[F].value?(y=e[F],G=!0):z===e[K].value?(y=e[K],G=!0):z<e[F].value?(G=!1,y=null):z>e[F].value&&(z<e[K].value?(y=e[F],G=!0):K===f-1?(G=!1,y=null):(y=e[K],G=!0)));G?(S[H]=y.mappedColor[0],A[H]=y.mappedColor[1],B[H]=y.mappedColor[2],
Q[H]=y.mappedColor[3]):S[H]=A[H]=B[H]=Q[H]=0}b.pixels=[S,A,B];b.mask=Q;b.pixelType="u8";b.maskIsAlpha=O;return b};m.resampleByMajority=g;m.setValidBoundary=function(b,e,a){if(!L(b))return null;const {width:c,height:f}=b,l=e.x;e=e.y;const r=a.width+l;a=a.height+e;if(0>l||0>e||r>c||a>f||0===l&&0===e&&r===c&&a===f)return b;b.mask||(b.mask=new Uint8Array(c*f));const z=b.mask;for(let y=0;y<f;y++){const F=y*c;for(let K=0;K<c;K++)z[F+K]=y<e||y>=a||K<l||K>=r?0:1}b.updateStatistics();return b};m.split=function(b,
e,a=0,c=!0){if(!L(b))return null;const {width:f,height:l}=e;let {width:r,height:z}=b;const y=new Map,F={x:0,y:0};a=1+a;for(let K=0;K<a;K++){const H=Math.ceil(r/f),D=Math.ceil(z/l);for(let G=0;G<D;G++){F.y=G*l;for(let S=0;S<H;S++){F.x=S*f;const A=q(b,F,e);y.set(`${K}/${G}/${S}`,A)}}K<a-1&&(b=t(b,c));r=Math.round(r/2);z=Math.round(z/2)}return y};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d){function g(f){f=f.symbolLayers;if(!f)return null;let l=null;f.forEach(r=>{"object"===r.type&&r.resource?.href||(l="water"===r.type?r.color:r.material?r.material.color:null)});return l?new w(l):null}function k(f,l){if(null==l||null==f)return f;f=f.toRgba();f[3]*=l;return new w(f)}function n(f,l,r){if(f=f.symbolLayers){var z=y=>{l=l??y??(null!=r?c:null);return k(l,r)};f.forEach(y=>{if("object"!==y.type||!y.resource?.href||l)if("water"===y.type)y.color=z(y.color);else{const F=
z(null!=y.material?y.material.color:null);null==y.material?y.material=new d.Symbol3DMaterial({color:F}):y.material.color=F;null!=r&&"outline"in y&&null!=y.outline?.color&&(y.outline.color=k(y.outline.color,r))}})}}async function h(f,l){(f=f.symbolLayers)&&await E.forEach(f,async r=>q(r,l))}async function q(f,l){switch(f.type){case "extrude":f.size="number"===typeof l[2]?l[2]:0;break;case "icon":case "line":case "text":l=t(l);null!=l&&(f.size=l);break;case "path":const r=b(l,P.ONES,[f.width,void 0,
f.height]);f.width=a(l[0],f.width,1,r);f.height=a(l[2],f.height,1,r);break;case "object":await x(f,l)}}function t(f){for(const l of f)if("number"===typeof l)return l;return null}async function x(f,l){const {resourceSize:r,symbolSize:z}=await e(f),y=b(l,r,z);f.width=a(l[0],z[0],r[0],y);f.depth=a(l[1],z[1],r[1],y);f.height=a(l[2],z[2],r[2],y)}function b(f,l,r){for(let z=0;3>z;z++){const y=f[z];switch(y){case "symbol-value":return f=r[z],null!=f?f/l[z]:1;case "proportional":break;default:if(y&&l[z])return y/
l[z]}}return 1}async function e(f){var {computeObjectLayerResourceSize:l}=await new Promise((H,D)=>m(["./symbolLayerUtils"],H,D));l=await l(f,10);const {width:r,height:z,depth:y}=f;f=[r,y,z];let F=1;for(var K=0;3>K;K++){const H=f[K];if(null!=H){F=H/l[K];break}}for(K=0;3>K;K++)null==f[K]&&(f[K]=l[K]*F);return{resourceSize:l,symbolSize:f}}function a(f,l,r,z){switch(f){case "proportional":return r*z;case "symbol-value":return null!=l?l:r;default:return f}}const c=new w("white");v.applyColorToSymbol=
function(f,l,r){if(f&&(l||null!=r))if(l&&=new w(l),L.isSymbol3D(f))n(f,l,r);else if(L.isSymbol2D(f)){if(l=l??f.color)f.color=k(l,r);null!=r&&"outline"in f&&f.outline?.color&&(f.outline.color=k(f.outline.color,r))}};v.applyOpacityToColor=k;v.applyRotationToSymbol=function(f,l,r){f&&null!=l&&(L.isSymbol3D(f)?(f=f.symbolLayers)&&f.forEach(z=>{if(z&&"object"===z.type)switch(r){case "tilt":z.tilt=l;break;case "roll":z.roll=l;break;default:z.heading=l}}):!L.isSymbol2D(f)||"simple-marker"!==f.type&&"picture-marker"!==
f.type&&"text"!==f.type||(f.angle=l))};v.applySizesToSymbol=async function(f,l){if(f&&l){if(L.isSymbol3D(f))return h(f,l);if(L.isSymbol2D(f)&&(l=t(l),null!=l))switch(f.type){case "simple-marker":f.size=l;break;case "picture-marker":const r=f.width/f.height;1<r?(f.width=l,f.height=l*r):(f.width=l*r,f.height=l);break;case "simple-line":f.width=l;break;case "text":f.font.size=l}}};v.fetchWebStyleSymbol=async function(f,l){const r=await f.fetchSymbol(l);return r?r:f.fetchCIMSymbol(l)};v.getCSSFilterFromEffectList=
function(f){if(!f)return null;f=f.effects.filter(l=>"bloom"!==l.type).map(l=>l.toJSON());return J.effectFunctionsFromJSON(f)};v.getColorFromSymbol=function(f,l){if(!f)return null;let r=null;L.isSymbol3D(f)?r=g(f):L.isSymbol2D(f)&&(r="cim"===f.type?p.getCIMSymbolColor(f):f.color?new w(f.color):null);return r?k(r,l):null};v.getIconHref=function(f){return f.resource?.href??""};v.getSymbolOutlineSize=function(f){return f?L.isSymbol3D(f)?(f=(f=f.symbolLayers?.at(-1))&&"outline"in f?f?.outline?.size:void 0,
null!=f?f:0):R.px2pt(u.getStroke(f)?.width):0};v.isVolumetricSymbol=function(f){if(null==f||!("symbolLayers"in f)||null==f.symbolLayers)return!1;switch(f.type){case "point-3d":return f.symbolLayers.some(l=>"object"===l.type);case "line-3d":return f.symbolLayers.some(l=>"path"===l.type);case "polygon-3d":return f.symbolLayers.some(l=>"object"===l.type||"extrude"===l.type);default:return!1}};v.symbolHasExtrudeSymbolLayer=function(f){return null!=f&&"polygon-3d"===f.type&&f.symbolLayers.some(l=>"extrude"===
l.type)};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(m,v,w){function L(d){d=w.toCIMSymbolJSON(d);if("CIMTextSymbol"===d?.type)return d.height??0;let g=0;if(d?.symbolLayers)for(const k of d.symbolLayers)w.isCIMMarker(k)&&null!=k.size&&k.size>g?g=k.size:w.isCIMStroke(k)&&null!=k.width&&k.width>g?g=k.width:w.isCIMFill(k);return g}function E(d,g,k,n){if(d)if("CIMTextSymbol"===
d.type)null!=d.height&&(d.height*=g);else{if(k&&d.effects)for(const h of d.effects)P(h,g);if(d.symbolLayers)for(const h of d.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":T(h,g,n);break;case "CIMPictureStroke":case "CIMSolidStroke":!n?.preserveOutlineWidth&&h.width&&(h.width*=g);break;case "CIMPictureFill":h.height&&(h.height*=g);h.offsetX&&(h.offsetX*=g);h.offsetY&&(h.offsetY*=g);break;case "CIMHatchFill":E(h.lineSymbol,g,!0,{...n,preserveOutlineWidth:!1}),h.offsetX&&
(h.offsetX*=g),h.offsetY&&(h.offsetY*=g),h.separation&&(h.separation*=g)}}}function T(d,g,k){if(d&&(d.markerPlacement&&R(d.markerPlacement,g),d.offsetX&&(d.offsetX*=g),d.offsetY&&(d.offsetY*=g),d.anchorPoint&&"Absolute"===d.anchorPointUnits&&(d.anchorPoint={x:d.anchorPoint.x*g,y:d.anchorPoint.y*g}),d.size=null!=d.size?d.size*g:0,"CIMVectorMarker"===d.type&&d.markerGraphics))for(const n of d.markerGraphics)d.scaleSymbolsProportionally||E(n.symbol,g,!0,k)}function R(d,g){w.isCIMMarkerStrokePlacement(d)&&
d.offset&&(d.offset*=g);switch(d.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":d.customEndingOffset&&(d.customEndingOffset*=g);d.offsetAlongLine&&(d.offsetAlongLine*=g);if(d.placementTemplate&&d.placementTemplate.length){var k=d.placementTemplate.map(n=>n*g);d.placementTemplate=k}break;case "CIMMarkerPlacementAlongLineVariableSize":d.maxRandomOffset&&(d.maxRandomOffset*=g);d.placementTemplate&&d.placementTemplate.length&&(k=d.placementTemplate.map(n=>
n*g),d.placementTemplate=k);break;case "CIMMarkerPlacementOnLine":d.startPointOffset&&(d.startPointOffset*=g);break;case "CIMMarkerPlacementAtExtremities":d.offsetAlongLine&&(d.offsetAlongLine*=g);break;case "CIMMarkerPlacementAtRatioPositions":d.beginPosition&&(d.beginPosition*=g);d.endPosition&&(d.endPosition*=g);break;case "CIMMarkerPlacementPolygonCenter":d.offsetX&&(d.offsetX*=g);d.offsetY&&(d.offsetY*=g);break;case "CIMMarkerPlacementInsidePolygon":d.offsetX&&(d.offsetX*=g),d.offsetY&&(d.offsetY*=
g),d.stepX&&(d.stepX*=g),d.stepY&&(d.stepY*=g)}}function P(d,g){switch(d.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":d.width&&(d.width*=g);break;case "CIMGeometricEffectBuffer":d.size&&(d.size*=g);break;case "CIMGeometricEffectCut":d.beginCut&&(d.beginCut*=g);d.endCut&&(d.endCut*=g);d.middleCut&&(d.middleCut*=g);break;case "CIMGeometricEffectDashes":d.customEndingOffset&&(d.customEndingOffset*=g);d.offsetAlongLine&&(d.offsetAlongLine*=g);if(d.dashTemplate&&d.dashTemplate.length){const k=
d.dashTemplate.map(n=>n*g);d.dashTemplate=k}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":d.length&&(d.length*=g);break;case "CIMGeometricEffectMove":d.offsetX&&(d.offsetX*=g);d.offsetY&&(d.offsetY*=g);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":d.offset&&(d.offset*=g);break;case "CIMGeometricEffectRegularPolygon":d.radius&&(d.radius*=g);break;case "CIMGeometricEffectTaperedPolygon":d.fromWidth&&(d.fromWidth*=
g);d.length&&(d.length*=g);d.toWidth&&(d.toWidth*=g);break;case "CIMGeometricEffectWave":d.amplitude&&(d.amplitude*=g),d.period&&(d.period*=g)}}function J(d,g){if(d){var k="CIMTextSymbol"===d.type?d.symbol:d;d="CIMPolygonSymbol"===d.type;if(k?.symbolLayers)for(const n of k.symbolLayers)if(!(n.colorLocked||d&&(w.isCIMStroke(n)||w.isCIMMarker(n)&&n.markerPlacement&&w.isCIMMarkerStrokePlacement(n.markerPlacement))))switch(n.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":n.tintColor&&
p(g,n.tintColor);break;case "CIMVectorMarker":n.markerGraphics?.forEach(h=>{J(h.symbol,g)});break;case "CIMSolidStroke":case "CIMSolidFill":p(g,n.color);break;case "CIMHatchFill":J(n.lineSymbol,g)}}}function p(d,g){for(const k of d)if(k.join(".")===g.join("."))return;d.push(g)}function u(d,g,k){if(d){var n="CIMTextSymbol"===d.type?d.symbol:d;d="CIMPolygonSymbol"===n?.type;if(n?.symbolLayers)for(const h of n.symbolLayers)if(!h.colorLocked){if(d)if(k){if({layersToColor:n}=k,(w.isCIMStroke(h)||w.isCIMMarker(h)&&
h.markerPlacement&&w.isCIMMarkerStrokePlacement(h.markerPlacement))&&"fill"===n||w.isCIMFill(h)&&"outline"===n)continue}else if(w.isCIMStroke(h)||w.isCIMMarker(h)&&h.markerPlacement&&w.isCIMMarkerStrokePlacement(h.markerPlacement))continue;n=g.toArray();switch(h.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":h.tintColor=n;break;case "CIMVectorMarker":h.markerGraphics?.forEach(q=>{u(q.symbol,g,k)});break;case "CIMSolidStroke":case "CIMSolidFill":h.color=n;break;case "CIMHatchFill":u(h.lineSymbol,
g,k)}}}}m.applyCIMSymbolColor=function(d,g,k){g instanceof v||(g=new v(g));(d=w.toCIMSymbolJSON(d))&&u(d,g,k)};m.applyCIMSymbolRotation=function(d,g,k=!1){d=w.toCIMSymbolJSON(d);k&&0!==g&&(g=360-g);if("CIMTextSymbol"===d?.type)d.angle=g;else if("CIMPointSymbol"===d?.type&&d.symbolLayers){k=g-(d.angle||0);for(const n of d.symbolLayers)if(w.isCIMMarker(n)){let h=n.rotation||0;h=n.rotateClockwise?h-k:h+k;n.rotation=h}d.angle=g}};m.getCIMSymbolColor=function(d){d=w.toCIMSymbolJSON(d);const g=[];J(d,g);
return g.length?new v(w.normalizeAlpha(g[0])):null};m.getCIMSymbolRotation=function(d,g=!1){d=w.toCIMSymbolJSON(d);return"CIMTextSymbol"===d?.type||"CIMPointSymbol"===d?.type?(d=d.angle,null!=d&&0!==d&&g?360-d:d??0):0};m.getCIMSymbolSize=L;m.getCIMSymbolType=function(d){d=w.toCIMSymbolJSON(d);if(!d)return null;switch(d.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};m.scaleCIMMarker=T;m.scaleCIMSymbol=E;m.scaleCIMSymbolTo=function(d,g,k){if(d){var n=w.toCIMSymbolJSON(d);d=L(d);if(0===d){if(n)if("CIMTextSymbol"===n.type)n.height=g;else if(n.symbolLayers)for(const h of n.symbolLayers)switch(h.type){case "CIMPictureMarker":case "CIMVectorMarker":h.size=g;break;case "CIMPictureStroke":case "CIMSolidStroke":h.width=g}}else E(n,g/d,!1,k)}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(m,v,w,L,E,T,R){function P(g){if(!g)return null;let k=null;switch(g.type){case "simple-fill":case "picture-fill":case "simple-marker":k=P(g.outline);break;case "simple-line":const n=T.pt2px(g.width);null!=g.style&&"none"!==g.style&&0!==n&&(k={color:g.color,style:d(g.style),width:n,cap:g.cap,join:"miter"===g.join?T.pt2px(g.miterLimit):
g.join},k.dashArray=J(k).join(",")||"none");break;default:k=null}return k}function J(g){if(!g?.style)return[];const {dashArray:k,style:n,width:h}=g;if("string"===typeof k&&"none"!==k)return k.split(",").map(x=>Number(x));const q=h??0,t=p.has(n)?p.get(n).map(x=>x*q):[];if("butt"!==g.cap)for(const [x,b]of t.entries())t[x]=1===x%2?b+q:Math.max(b-q,1);return t}const p=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,
3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),u=new E.LRUCache(1E3),d=(()=>{const g={};return k=>{if(g[k])return g[k];const n=k.replaceAll("-","");return g[k]=n}})();w=new w([128,128,128]);m.defaultThematicColor=w;m.dekebabifyLineStyle=d;m.getDashArray=J;m.getFill=function(g){const k=g.style;let n=null;if(g)switch(g.type){case "simple-marker":"cross"!==k&&"x"!==k&&(n=g.color);break;case "simple-fill":"solid"===k?n=g.color:"none"!==
k&&(n={type:"pattern",x:0,y:0,src:v.getAssetUrl(`esri/symbols/patterns/${k}.png`),width:5,height:5});break;case "picture-fill":n={type:"pattern",src:g.url,width:T.pt2px(g.width)*g.xscale,height:T.pt2px(g.height)*g.yscale,x:T.pt2px(g.xoffset),y:T.pt2px(g.yoffset)};break;case "text":n=g.color;break;case "cim":n=R.getCIMSymbolColor(g)}return n};m.getPatternUrlWithColor=function(g,k){const n=g+"-"+k;return void 0!==u.get(n)?Promise.resolve(u.get(n)):L(g,{responseType:"image"}).then(h=>{h=h.data;const q=
h.naturalWidth,t=h.naturalHeight,x=document.createElement("canvas");x.width=q;x.height=t;const b=x.getContext("2d");b.fillStyle=k;b.fillRect(0,0,q,t);b.globalCompositeOperation="destination-in";b.drawImage(h,0,0);h=x.toDataURL();u.put(n,h);return h})};m.getStroke=P;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(m,v,w,L,E,T){var R;v=R=class extends v.JSONSupport{constructor(P){super(P);this.dimensionName=this.variableName=null;this.values=[];this.isSlice=!1}clone(){return new R({variableName:this.variableName,dimensionName:this.dimensionName,values:w.clone(this.values),isSlice:this.isSlice})}};m.__decorate([L.property({type:String,json:{write:!0}})],v.prototype,"variableName",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],v.prototype,"dimensionName",void 0);m.__decorate([L.property({type:E.types.array(E.types.oneOf([E.types.native(Number),
E.types.array(E.types.native(Number))])),json:{write:!0}})],v.prototype,"values",void 0);m.__decorate([L.property({type:Boolean,json:{write:!0}})],v.prototype,"isSlice",void 0);return v=R=m.__decorate([T.subclass("esri.layers.support.DimensionalDefinition")],v)})},"esri/layers/support/MultidimensionalSubset":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/Polygon ../../geometry/support/jsonUtils ./DimensionalDefinition ../../geometry/Geometry".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g){var k;v={base:g,key:"type",typeMap:{extent:J,polygon:p}};w=k=class extends w.JSONSupport{constructor(n){super(n);this.subsetDefinitions=this.areaOfInterest=null}get dimensions(){var {subsetDefinitions:n}=this;if(null==n||0===n.length)return[];const h=new Map;n.forEach(q=>{if(q.dimensionName){if(Array.isArray(q.values[0])){var t=q.values;var x=t[0][0];t=t[q.values.length-1][1]}else t=q.values,x=t[0],t=t[q.values.length-1];h.has(q.dimensionName)?(q=h.get(q.dimensionName),
q[0]=Math.min(x,q[0]),q[1]=Math.max(t,q[1])):h.set(q.dimensionName,[x,t])}});n=[];for(const q of h)n.push({name:q[0],extent:q[1]});return n}get variables(){const {subsetDefinitions:n}=this;if(null==n||0===n.length)return[];const h=new Set;n.forEach(q=>{q.variableName&&h.add(q.variableName)});return[...h]}clone(){const n=this.subsetDefinitions?.map(q=>q.clone()),h=this.areaOfInterest?this.areaOfInterest.clone():this.areaOfInterest;return new k({areaOfInterest:h,subsetDefinitions:n})}};m.__decorate([L.property({types:v,
json:{read:u.fromJSON,write:!0}})],w.prototype,"areaOfInterest",void 0);m.__decorate([L.property({readOnly:!0})],w.prototype,"dimensions",null);m.__decorate([L.property({readOnly:!0})],w.prototype,"variables",null);m.__decorate([L.property({type:[d],json:{write:!0}})],w.prototype,"subsetDefinitions",void 0);return w=k=m.__decorate([P.subclass("esri.layers.support.MultidimensionalSubset")],w)})},"esri/layers/support/RasterFunction":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./RasterFunctionTemplate".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){var d;const g=new Set(["raster","raster2","dem","fillraster"]),k=new Set(["rasters"]),n=x=>x?.rasterFunction?t.fromJSON(x):x,h=x=>x&&x instanceof t?x.toJSON():x,q=x=>x?.functionName&&!x.declaredClass?new t(x):x;E={types:{key:"type",base:null,typeMap:{RasterFunctionTemplate:u}},json:{write:!0,name:"rasterFunctionDefinition"}};let t=d=class extends v.JSONSupport{constructor(x){super(x);this.functionName=null;this.outputPixelType="unknown";this.functionDefinition=this.variableName=
null}set functionArguments(x){if(x){const b=Object.keys(x);if(b.some(e=>{var a;if(a=g.has(e.toLowerCase()))e=x[e],a=e?.functionName&&!e.declaredClass;return a})||b.some(e=>k.has(e.toLowerCase())&&Array.isArray(x[e])&&x[e].some(a=>a?.functionName&&!a.declaredClass))){x=w.clone(x);for(const e of b)g.has(e.toLowerCase())?x[e]=q(x[e]):k.has(e.toLowerCase())&&Array.isArray(x[e])&&(x[e]=x[e].map(a=>q(a)))}}this._set("functionArguments",x)}readFunctionArguments(x){if(null==x)var b=null;else{x=w.clone(x);
var e={};for(b of Object.keys(x))g.has(b.toLowerCase())?e[b]=n(x[b]):k.has(b.toLowerCase())&&Array.isArray(x[b])?e[b]=x[b].map(n):e[b]=x[b];b=e}return b}writeFunctionArguments(x,b,e){const a={};for(const c of Object.keys(x))g.has(c.toLowerCase())?a[c]=h(x[c]):k.has(c.toLowerCase())&&Array.isArray(x[c])?a[c]=x[c].map(h):a[c]=h(x[c]);b[e]=a}readFunctionName(x,b){x=b.rasterFunctionInfos;const e=b.name;return e?e:x?.length&&"None"!==x[0].name?x[0].name:b.rasterFunctionDefinition?b.rasterFunctionDefinition.name:
b.rasterFunction}get rasterFunctionDefinition(){return this.functionDefinition?.toJSON()}set rasterFunctionDefinition(x){this.functionDefinition=x?u.fromJSON(x):null}get hasClipFunction(){return this.rasterFunctionDefinition?JSON.stringify(this.rasterFunctionDefinition).includes('"type":"ClipFunction"'):JSON.stringify(this).includes('"rasterFunction":"Clip"')}clone(){return new d({functionName:this.functionName,functionArguments:w.clone(this.functionArguments),outputPixelType:this.outputPixelType,
variableName:this.variableName,rasterFunctionDefinition:w.clone(this.rasterFunctionDefinition)})}};m.__decorate([L.property({json:{type:Object,name:"rasterFunctionArguments"}})],t.prototype,"functionArguments",null);m.__decorate([P.reader("functionArguments")],t.prototype,"readFunctionArguments",null);m.__decorate([p.writer("functionArguments")],t.prototype,"writeFunctionArguments",null);m.__decorate([L.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0);
m.__decorate([P.reader("functionName",["rasterFunction","rasterFunctionInfos","rasterFunctionDefinition"])],t.prototype,"readFunctionName",null);m.__decorate([R.enumeration({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),L.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0);m.__decorate([L.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",
void 0);m.__decorate([L.property()],t.prototype,"rasterFunctionDefinition",null);m.__decorate([L.property(E)],t.prototype,"functionDefinition",void 0);m.__decorate([L.property()],t.prototype,"hasClipFunction",null);return t=d=m.__decorate([J.subclass("esri.layers.support.RasterFunction")],t)})},"esri/layers/support/RasterFunctionTemplate":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ./RasterFunctionInfo ./RasterFunctionProperties".split(" "),
function(m,v,w,L,E,T,R,P,J,p){v=new v.JSONMap({0:"mosaic",1:"item",2:"item-group"},{useNumericKeys:!0});w=class extends w.JSONSupport{constructor(){super(...arguments);this.functionType="mosaic";this.type="RasterFunctionTemplate"}};m.__decorate([L.property({type:[String],json:{write:!0}})],w.prototype,"aliases",void 0);m.__decorate([L.property({type:Object,json:{write:!0}})],w.prototype,"arguments",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"description",void 0);
m.__decorate([L.property({type:J,json:{write:!0,name:"function"}})],w.prototype,"functionInfo",void 0);m.__decorate([L.property({type:v.apiValues,json:{type:[0,1,2],read:v.read,write:v.write}})],w.prototype,"functionType",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"group",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"help",void 0);m.__decorate([L.property({type:Number,json:{type:E.Integer,write:!0,name:"_object_id"}})],w.prototype,
"id",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"name",void 0);m.__decorate([L.property({type:String,json:{write:!0,name:"definition"}})],w.prototype,"queryDefinition",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"tag",void 0);m.__decorate([L.property({type:p,json:{write:!0}})],w.prototype,"properties",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],w.prototype,"thumbnail",void 0);m.__decorate([L.property({type:String,
json:{write:!0}})],w.prototype,"thumbnailEx",void 0);m.__decorate([L.property({json:{type:["RasterFunctionTemplate"],write:!0}})],w.prototype,"type",void 0);return w=m.__decorate([P.subclass("esri.layers.support.RasterFunctionTemplate")],w)})},"esri/layers/support/RasterFunctionInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ./rasterEnums".split(" "),
function(m,v,w,L,E,T,R,P){v=class extends v.JSONSupport{constructor(){super(...arguments);this.pixelType="unknown"}};m.__decorate([w.property({type:String,json:{write:!0}})],v.prototype,"name",void 0);m.__decorate([w.property({type:String,json:{write:!0}})],v.prototype,"description",void 0);m.__decorate([w.property({type:L.Integer,json:{type:L.Integer,write:!0,name:"_object_id"}})],v.prototype,"id",void 0);m.__decorate([w.property({type:String,json:{type:P.pixelTypeKebabDict.jsonValues,read:P.pixelTypeKebabDict.read,
write:P.pixelTypeKebabDict.write}})],v.prototype,"pixelType",void 0);m.__decorate([w.property({type:String,json:{write:!0}})],v.prototype,"type",void 0);return v=m.__decorate([R.subclass("esri.layers.support.RasterFunctionInfo")],v)})},"esri/layers/support/rasterEnums":function(){define(["exports","../../core/jsonMap"],function(m,v){const w=v.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),L=v.strict()({esriNoDataMatchAny:"any",
esriNoDataMatchAll:"all"});v=v.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"});m.interpolationKebab=w;m.noDataInterpretationKebab=L;m.pixelTypeKebabDict=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/RasterFunctionProperties":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ./RasterFunctionVariable".split(" "),
function(m,v,w,L,E,T,R,P){E={key:"type",base:null,typeMap:{RasterFunctionVariable:P}};v=class extends v.JSONSupport{};m.__decorate([w.property({types:E,json:{types:E,name:"MatchVariable"}})],v.prototype,"matchVariable",void 0);m.__decorate([w.property({types:E,json:{types:E,name:"UnionDimension"}})],v.prototype,"unionDimension",void 0);m.__decorate([w.property({type:Number,json:{type:L.Integer,write:!0,name:"_object_id"}})],v.prototype,"id",void 0);m.__decorate([w.property({type:String,json:{write:!0}})],
v.prototype,"type",void 0);return v=m.__decorate([R.subclass("esri.layers.support.RasterFunctionProperties")],v)})},"esri/layers/support/RasterFunctionVariable":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(m,v,w,L,E,T,R){v=class extends v.JSONSupport{constructor(){super(...arguments);this.isPublic=
this.isDataset=!1;this.type="RasterFunctionVariable"}};m.__decorate([w.property({type:String,json:{write:!0}})],v.prototype,"name",void 0);m.__decorate([w.property({type:Number,json:{type:L.Integer,write:!0,name:"_object_id"}})],v.prototype,"id",void 0);m.__decorate([w.property({type:Boolean,json:{write:!0}})],v.prototype,"isDataset",void 0);m.__decorate([w.property({type:Boolean,json:{write:!0}})],v.prototype,"isPublic",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,"value",void 0);
m.__decorate([w.property({type:String,json:{write:!0}})],v.prototype,"type",void 0);return v=m.__decorate([R.subclass("esri.layers.support.RasterFunctionVariable")],v)})},"esri/layers/support/RasterJobHandler":function(){define(["../../core/Error","../../core/workers/workers","./PixelBlock"],function(m,v,w){class L{constructor(){this._workerThread=null;this._destroyed=!1}async initialize(){const E=await v.open("RasterWorker");this._destroyed?E.close():this._workerThread=E}destroy(){this._destroyed=
!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)}async convertVectorFieldData(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");return(E=await this._workerThread.invoke("convertVectorFieldData",{pixelBlock:E.pixelBlock.toJSON(),type:E.dataType},T))?new w(E):null}computeStatisticsHistograms(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");return this._workerThread.invoke("computeStatisticsHistograms",
{pixelBlock:E.pixelBlock.toJSON()},T)}async decode(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");return(E=await this._workerThread.invoke("decode",E,T))?new w(E):null}async symbolize(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");E={extent:E.extent?.toJSON(),pixelBlock:E.pixelBlock?.toJSON(),simpleStretchParams:E.simpleStretchParams,bandIds:E.bandIds};return(T=await this._workerThread.invoke("symbolize",
E,T))?new w(T):null}async updateSymbolizer(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");const R=E?.rendererJSON?.histograms;await Promise.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:E.toJSON(),histograms:R},T))}async updateRasterFunction(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");await Promise.all(this._workerThread.broadcast("updateRasterFunction",
{rasterFunctionJSON:E.toJSON()},T))}async process(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");return(E=await this._workerThread.invoke("process",{extent:E.extent?.toJSON(),primaryPixelSizes:E.primaryPixelSizes?.map(R=>null!=R?R.toJSON():null),primaryPixelBlocks:E.primaryPixelBlocks.map(R=>null!=R?R.toJSON():null),primaryRasterIds:E.primaryRasterIds},T))?new w(E):null}async stretch(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection",
"no available worker connection");if(!E?.pixelBlock)return null;E={srcPixelBlock:E.pixelBlock.toJSON(),stretchParams:E.stretchParams};return(T=await this._workerThread.invoke("stretch",E,T))?new w(T):null}async split(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");if(!E?.pixelBlock)return null;E={srcPixelBlock:E.pixelBlock.toJSON(),tileSize:E.tileSize,maximumPyramidLevel:E.maximumPyramidLevel,useBilinear:E.useBilinear};const R=await this._workerThread.invoke("split",
E,T);R&&R.forEach((P,J)=>{R.set(J,P?w.fromJSON(P):null)});return R}async clipTile(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");if(!E?.pixelBlock)return null;E={...E,pixelBlock:E.pixelBlock.toJSON()};return(T=await this._workerThread.invoke("clipTile",E,T))?w.fromJSON(T):null}async estimateStatisticsHistograms(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");if(!E?.pixelBlock)return null;
E={srcPixelBlock:E.pixelBlock.toJSON()};return await this._workerThread.invoke("estimateStatisticsHistograms",E,T)}async mosaicAndTransform(E,T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");if(!E?.srcPixelBlocks?.length)return{pixelBlock:null};E={...E,srcPixelBlocks:E.srcPixelBlocks.map(R=>null!=R?R.toJSON():null)};T=await this._workerThread.invoke("mosaicAndTransform",E,T);return{pixelBlock:T.pixelBlock?new w(T.pixelBlock):null,localNorthDirections:T.localNorthDirections}}async createFlowMesh(E,
T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");const R={buffer:E.flowData.data.buffer,maskBuffer:E.flowData.mask.buffer,width:E.flowData.width,height:E.flowData.height},{meshType:P,simulationSettings:J}=E;E=await this._workerThread.invoke("createFlowMesh",{meshType:P,flowData:R,simulationSettings:J},{...T,transferList:[R.buffer,R.maskBuffer]});return{vertexData:new Float32Array(E.vertexBuffer),indexData:new Uint32Array(E.indexBuffer)}}getProjectionOffsetGrid(E,
T){if(!this._workerThread)throw new m("raster-jobhandler:no-connection","no available worker connection");const R=null!=E.datumTransformation?E.datumTransformation.steps.map(J=>({wkid:J.wkid,wkt:J.wkt,isInverse:J.isInverse})):null,P=null!=E.rasterTransform?E.rasterTransform.toJSON():null;E={projectedExtent:E.projectedExtent.toJSON(),srcBufferExtent:E.srcBufferExtent.toJSON(),pixelSize:E.pixelSize,hasWrapAround:E.hasWrapAround,spacing:E.spacing,datumTransformationSteps:R,rasterTransform:P,isAdaptive:E.isAdaptive,
includeGCSGrid:E.includeGCSGrid};return this._workerThread.invoke("getProjectionOffsetGrid",E,T)}}return L})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t){var x;v=new v.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});w=x=class extends w.JSONSupport{static create(b={}){const {resolutionFactor:e=1,scales:a,size:c=256,spatialReference:f=g.WebMercator,numLODs:l=24}=b;if(!n.isValid(f)){b=[];if(a)for(var r=0;r<a.length;r++){var z=
a[r];b.push(new q({level:r,scale:z,resolution:z}))}else for(r=5E-4,z=l-1;0<=z;z--)b.unshift(new q({level:z,scale:r,resolution:r})),r*=2;return new x({dpi:96,lods:b,origin:new d(0,0,f),size:[c,c],spatialReference:f})}r=n.getInfo(f);b=b.origin?new d({x:b.origin.x,y:b.origin.y,spatialReference:f}):r?new d({x:r.origin[0],y:r.origin[1],spatialReference:f}):new d({x:0,y:0,spatialReference:f});r=1/(39.37*L.getMetersPerUnitForSR(f)*96);z=[];if(a)for(var y=0;y<a.length;y++){var F=a[y];z.push(new q({level:y,
scale:F,resolution:F*r}))}else{var K=n.isGeographic(f)?512/c*5.916575275917094E8:256/c*5.91657527591555E8;y=Math.ceil(l/e);z.push(new q({level:0,scale:K,resolution:K*r}));for(F=1;F<y;F++)K/=2**e,z.push(new q({level:F,scale:K,resolution:K*r}))}return new x({dpi:96,lods:z,origin:b,size:[c,c],spatialReference:f})}constructor(b){super(b);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:b,origin:e}=this;if(b&&e){const a=n.getInfo(b);return b.isWrappable&&
!!a&&Math.abs(a.origin[0]-e.x)<=a.dx}return!1}readOrigin(b,e){return d.fromJSON({spatialReference:e.spatialReference,...b})}set lods(b){const e=[],a=this._levelToLOD={};b&&b.forEach(c=>{e.push(c.scale);a[c.level]=c});this._set("scales",e);this._set("lods",b);this._initializeUpsampleLevels()}readSize(b,e){return[e.cols,e.rows]}writeSize(b,e){e.cols=b[0];e.rows=b[1]}zoomToScale(b){const e=this.scales;if(0>=b)return e[0];if(b>=e.length-1)return e[e.length-1];const a=Math.floor(b);return e[a]/(e[a]/e[a+
1])**(b-a)}scaleToZoom(b){const e=this.scales,a=e.length-1;let c=0;for(;c<a;c++){const f=e[c],l=e[c+1];if(f<=b)break;if(l===b)return c+1;if(f>b&&l<b)return c+Math.log(f/b)/Math.log(f/l)}return c}snapScale(b,e=.95){b=this.scaleToZoom(b);return b%Math.floor(b)>=e?this.zoomToScale(Math.ceil(b)):this.zoomToScale(Math.floor(b))}tileAt(b,e,a,c){var f=this.lodAt(b);if(!f)return null;let l;if("number"===typeof e)l=e,e=a;else{if(n.equals(e.spatialReference,this.spatialReference))l=e.x,e=e.y;else{c=h.project(e,
this.spatialReference);if(null==c)return null;l=c.x;e=c.y}c=a}a=f.resolution*this.size[0];f=f.resolution*this.size[1];c||=new t.TileKey(null,0,0,0,k.create());c.level=b;c.row=Math.floor((this.origin.y-e)/f+.001);c.col=Math.floor((l-this.origin.x)/a+.001);this.updateTileInfo(c);return c}updateTileInfo(b,e=x.ExtrapolateOptions.NONE){var a=this.lodAt(b.level);a||e!==x.ExtrapolateOptions.POWER_OF_TWO||(e=this.lods[this.lods.length-1],e.level<b.level&&(a=e));if(a){var c=b.level-a.level;e=a.resolution*
this.size[0]/2**c;a=a.resolution*this.size[1]/2**c;b.id=`${b.level}/${b.row}/${b.col}`;b.extent||(b.extent=k.create());b.extent[0]=this.origin.x+b.col*e;b.extent[1]=this.origin.y-(b.row+1)*a;b.extent[2]=b.extent[0]+e;b.extent[3]=b.extent[1]+a}}upsampleTile(b){const e=this._upsampleLevels[b.level];if(!e||-1===e.parentLevel)return!1;b.level=e.parentLevel;b.row=Math.floor(b.row/e.factor+.001);b.col=Math.floor(b.col/e.factor+.001);this.updateTileInfo(b);return!0}getTileBounds(b,e){var a=this.lodAt(e.level);
if(null==a)return null;var {resolution:c}=a;a=c*this.size[0];c*=this.size[1];b[0]=this.origin.x+e.col*a;b[1]=this.origin.y-(e.row+1)*c;b[2]=b[0]+a;b[3]=b[1]+c;return b}lodAt(b){return this._levelToLOD?.[b]??null}clone(){return x.fromJSON(this.write({}))}getOrCreateCompatible(b,e){if(256===this.size[0]&&256===this.size[1])return 256===b?this:null;const a=[],c=this.lods.length;for(let f=0;f<c;f++){const l=this.lods[f];a.push(new q({level:l.level,scale:l.scale,resolution:l.resolution*e}))}return new x({size:[b,
b],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:a})}_initializeUpsampleLevels(){const b=this.lods;this._upsampleLevels=[];let e=null;for(let a=0;a<b.length;a++){const c=b[a];this._upsampleLevels[c.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/c.resolution:0};e=c}}};m.__decorate([E.property({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0);m.__decorate([E.property({type:Number,
json:{write:!0}})],w.prototype,"dpi",void 0);m.__decorate([E.property({type:String,json:{read:v.read,write:v.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0);m.__decorate([E.property({readOnly:!0})],w.prototype,"isWrappable",null);m.__decorate([E.property({type:d,json:{write:!0}})],w.prototype,"origin",void 0);m.__decorate([J.reader("origin")],w.prototype,"readOrigin",null);m.__decorate([E.property({type:[q],value:null,json:{write:!0}})],w.prototype,"lods",null);m.__decorate([E.property({readOnly:!0})],
w.prototype,"scales",void 0);m.__decorate([E.property({cast:b=>Array.isArray(b)?b:"number"===typeof b?[b,b]:[256,256]})],w.prototype,"size",void 0);m.__decorate([J.reader("size",["rows","cols"])],w.prototype,"readSize",null);m.__decorate([u.writer("size",{cols:{type:T.Integer},rows:{type:T.Integer}})],w.prototype,"writeSize",null);m.__decorate([E.property({type:g,json:{write:!0}})],w.prototype,"spatialReference",void 0);w=x=m.__decorate([p.subclass("esri.layers.support.TileInfo")],w);(function(b){b=
b.ExtrapolateOptions||(b.ExtrapolateOptions={});b[b.NONE=0]="NONE";b[b.POWER_OF_TWO=1]="POWER_OF_TWO"})(w||={});return w})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(m,v,w,L,E,T,R){var P;v=P=class extends v.JSONSupport{constructor(J){super(J);this.cols=null;this.level=
0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new P({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};m.__decorate([w.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"cols",void 0);m.__decorate([w.property({type:L.Integer,json:{write:!0}})],v.prototype,"level",void 0);m.__decorate([w.property({type:String,json:{write:!0}})],
v.prototype,"levelValue",void 0);m.__decorate([w.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"origin",void 0);m.__decorate([w.property({type:Number,json:{write:!0}})],v.prototype,"resolution",void 0);m.__decorate([w.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"rows",void 0);m.__decorate([w.property({type:Number,json:{write:!0}})],v.prototype,"scale",void 0);
return v=P=m.__decorate([R.subclass("esri.layers.support.LOD")],v)})},"esri/layers/support/TileKey":function(){define(["exports"],function(m){class v{constructor(w,L,E,T,R){this.id=w;this.level=L;this.row=E;this.col=T;this.extent=R}}m.TileKey=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/FunctionRaster":function(){define("require ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Polygon ./BaseRaster ../rasterFunctions/clipUtils ../rasterFunctions/pixelUtils ../rasterFunctions/rasterProjectionHelper ../../../rest/support/FeatureSet".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k){E=class extends p{constructor(){super(...arguments);this.datasetFormat="Function";this.tileType="Raster";this.rasterFunction=null;this._clippingGeometry=new Map}async open(n){await this.init();const {rasterFunction:h}=this;this.primaryRasters?.rasters?.length?h.sourceRasters=this.primaryRasters.rasters:(this.primaryRasters=h.getPrimaryRasters(),this.rasterJobHandler&&this.primaryRasters.rasters?.forEach(a=>a.rasterJobHandler=this.rasterJobHandler));const {rasters:q,
rasterIds:t}=this.primaryRasters;var x=q.map(a=>a.rasterInfo?void 0:a.open(n));await Promise.all(x);x=q.map(({rasterInfo:a})=>a);var b=h.bind({rasterInfos:x,rasterIds:t});h.rawSourceRasterInfos=x;if(!b.success||0===x.length)throw new w("raster-function:open",`cannot bind the function: ${b.error??""}`);b="Table"===h.functionName?h:h.functionArguments?.raster;"Table"===b?.functionName&&(h.rasterInfo.attributeTable=k.fromJSON(b.functionArguments.attributeTableAsRecordSet));await this.syncJobHandler();
const e=x[0];this.hasUniqueSourceStorageInfo=1===x.length||x.slice(1).every(a=>this._hasSameStorageInfo(a,e));this.set("sourceJSON",q[0].sourceJSON);this.set("rasterInfo",h.rasterInfo);await this._updateClipGeometry()}async syncJobHandler(){return this.rasterJobHandler?.updateRasterFunction(this.rasterFunction)}async fetchPixels(n,h,q,t={}){const {rasters:x,rasterIds:b}=this.primaryRasters;var e=!1,{interpolation:a}=t,c=this.rasterFunction.flatWebGLFunctionChain?.hasFocalFunction;!t.requestRawData&&
c&&(e=1===x.length&&!t.skipRasterFunction,t={...t,interpolation:"bilinear",requestRawData:e});c=x.map(z=>z.fetchPixels(n,h,q,t));c=await Promise.all(c);var f=c.map(z=>z.pixelBlock),l=e||t.requestRawData?c.map(z=>z.srcTilePixelSize):null;if(t.skipRasterFunction||f.every(z=>null==z))return c[0];const r=c.find(z=>null!=z.pixelBlock)?.extent??n;f=this.rasterJobHandler?await this.rasterJobHandler.process({extent:r,primaryPixelBlocks:f,primaryPixelSizes:l,primaryRasterIds:b}):this.rasterFunction.process({extent:r,
primaryPixelBlocks:f,primaryPixelSizes:l,primaryRasterIds:b});({transformGrid:l}=c[0]);if(!e||null==f||null==l)return a=t.noClip?null:this.getClippingGeometry(r.spatialReference),t.noClip||t.requestRawData||null==f||!a||(f=await u.clip(f,r,a)),{...c[0],pixelBlock:f};e={rows:l.spacing[0],cols:l.spacing[1]};a=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:[f],srcMosaicSize:{width:f.width,height:f.height},destDimension:{width:h,height:q},coefs:l.coefficients,sampleSpacing:e,
projectDirections:!1,gcsGrid:null,isUV:!1,interpolation:a,alignmentInfo:void 0,blockWidths:null},t)).pixelBlock:d.approximateTransform(f,{width:h,height:q},l.coefficients,e,a);e=t.noClip?null:this.getClippingGeometry(n.spatialReference);t.noClip||t.requestRawData||null==a||null==e||(a=await u.clip(a,n,e));return{extent:n,srcExtent:c[0].srcExtent,pixelBlock:a}}getClippingGeometry(n){const h=this._clippingGeometry.get("0");if(!n||!h)return h;const q=this._getSRKey(n);let t=this._clippingGeometry.get(q);
if(null!=t)return t;t=n.equals(h.spatialReference)?h:g.projectPolygon(h,n);this._clippingGeometry.set(q,t);return t}_hasSameStorageInfo(n,h){const {storageInfo:q,pixelSize:t,spatialReference:x,extent:b}=n,{storageInfo:e,pixelSize:a,spatialReference:c,extent:f}=h;return t.x===a.x&&t.y===a.y&&x.equals(c)&&b.equals(f)&&q.blockHeight===e.blockHeight&&q.blockWidth===e.blockWidth&&q.maximumPyramidLevel===e.maximumPyramidLevel}async _updateClipGeometry(){var n=this.rasterFunction.getClippingGeometries()[0];
let h=n?.clippingGeometry;if(h&&"inside"===n.clippingType){({extent:n}=this.rasterInfo);const {difference:q,densify:t}=await new Promise((x,b)=>m(["../../../geometry/geometryEngine"],x,b));n=t(J.fromExtent(n),2*(n.width+n.height)/40);n=g.projectPolygon(n,h.spatialReference);h=q(n,h)}this._clippingGeometry.clear();h&&this._clippingGeometry.set("0",h)}_getSRKey(n){return String(n.wkid??n.wkt??n.wkt2)}};v.__decorate([L.property({type:String,json:{write:!0}})],E.prototype,"datasetFormat",void 0);v.__decorate([L.property()],
E.prototype,"tileType",void 0);v.__decorate([L.property()],E.prototype,"rasterFunction",void 0);v.__decorate([L.property()],E.prototype,"primaryRasters",void 0);return E=v.__decorate([P.subclass("esri.layers.support.rasterDatasets.FunctionRaster")],E)})},"esri/layers/support/rasterDatasets/BaseRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../request ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../arcgisLayerUrl ../commonProperties ../DimensionalDefinition ../LOD ../RasterStorageInfo ../TileInfo ./multidimensionalUtils ./RawBlockCache ../rasterFormats/pixelRangeUtils ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ../rasterFunctions/rasterProjectionHelper ../rasterFunctions/vectorFieldUtils ../../../views/support/QueueProcessor ../../../geometry/Extent ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e,a,c,f,l,r,z,y,F,K){let H=0;v=class extends R.EsriPromiseMixin(E.JSONSupport){constructor(){super(...arguments);this._tileFetchQueue=new z.QueueProcessor({concurrency:32,process:(D,G)=>this._fetchRawTile(D.pyramidLevel,D.row,D.col,{...D.options,signal:G})});this.datasetFormat=this.datasetName=null;this.hasUniqueSourceStorageInfo=!0;this.rasterInfo=null;this.ioConfig={sampling:"closest"}}async init(){const D=l.load();this.addResolvingPromise(D);await this.when()}normalizeCtorArgs(D){D?.ioConfig&&
(D={...D,ioConfig:{resolution:null,bandIds:null,sampling:"closest",tileInfo:x.create(),...D.ioConfig}});return D}get _isGlobalWrappableSource(){const {rasterInfo:D}=this,G=l.getWorldWidth(D.spatialReference);return null!=G&&D.extent.width>=G/2}get _hasNoneOrGCSShiftTransform(){const {transform:D}=this.rasterInfo;return null==D||"gcs-shift"===D.type}set rasterJobHandler(D){this._set("rasterJobHandler",D);"Function"===this.datasetFormat&&this.primaryRasters?.rasters?.forEach(G=>G.rasterJobHandler=D)}get rasterId(){return this.url||
`rasterId-${H++}`}set url(D){this._set("url",k.sanitizeUrl(D,T.getLogger(this)))}async open(D){throw new L("BaseRaster:open-not-implemented","open() is not implemented");}async fetchTile(D,G,S,A={}){const B=A.tileInfo||this.rasterInfo.storageInfo.tileInfo;D=this.getTileExtentFromTileInfo(D,G,S,B);A={noClip:!0,...A};return this.fetchPixels(D,B.size[0],B.size[1],A)}async identify(D,G={}){D=p.ensureClass(F,D).clone().normalize();const {multidimensionalDefinition:S,timeExtent:A}=G;var {rasterInfo:B}=
this;const {hasMultidimensionalTranspose:Q,multidimensionalInfo:O}=B;var {transposedVariableName:C}=G,M=null!=O&&Q&&(null!=A||b.isMultiSliceOrRangeDefinition(S));M&&!C&&(C=null!=S&&0<S.length?S[0].variableName??void 0:O.variables[0].name,G={...G,transposedVariableName:C});G=this._getRequestOptionsWithSliceId(G);const {spatialReference:N,extent:U}=B;var {datumTransformation:X}=G;X=l.projectPoint(D,N,X);if(!U.intersects(X)||null!=B.transform&&(X=B.transform.inverseTransform(X),!B.nativeExtent.intersects(X)))return{location:X,
value:null};let I=0;var V=null!=C&&null!=O&&B.hasMultidimensionalTranspose;if("Function"===this.datasetFormat){M=this.primaryRasters.rasters[0];if(V)return M.identify(X,G);({pixelSize:V}=B);G=3*V.x/2;V=3*V.y/2;G=new y({xmin:X.x-G,xmax:X.x+G,ymin:X.y-V,ymax:X.y+V,spatialReference:N});V={interpolation:"nearest"};({pixelBlock:M}=await M.fetchPixels(G,3,3,V));({pixelBlock:G}=await this.fetchPixels(G,3,3,V));if(null==M)return{location:X,value:null};M=!M.mask||M.mask[4]?M.pixels.map(ca=>ca[4]):null;var W;
null!=G&&(W=!G.mask||G.mask[4]?G.pixels.map(ca=>ca[4]):void 0);return{location:X,value:M,processedValue:W,pyramidLevel:0}}if(!V)if(G.srcResolution)I=l.snapPyramid(G.srcResolution,B,this.ioConfig.sampling).pyramidLevel;else if(I=await this.computeBestPyramidLevelForLocation(D,G),null==I)return{location:X,value:null};W=this.identifyPixelLocation(X,I,null,V);if(null===W)return{location:X,value:null};const {row:Z,col:Y,rowOffset:aa,colOffset:ea,blockWidth:fa}=W;W=e.getRasterId(this.rasterId,C??G.sliceId);
B=`${I}/${Z}/${Y}`;C=e.getBlock(W,null,B);null==C&&(C=this.fetchRawTile(I,Z,Y,G),e.putBlock(W,null,B,C));W=await C;return W?.pixels?.length?this._processIdentifyResult(W,{srcLocation:X,position:aa*fa+ea,pyramidLevel:I,useTransposedTile:!!V,requestSomeSlices:M,identifyOptions:G}):{location:X,value:null}}async fetchPixels(D,G,S,A={}){D=l.shiftExtent(D);A=this._getRequestOptionsWithSliceId(A);var {_hasNoneOrGCSShiftTransform:B}=this;if(A.requestRawData&&B)return this._fetchPixels(D,G,S,A);var Q=l.getWorldWidth(D.spatialReference),
O=l.getWorldWrapCount(D);if(null==Q||0===O||1===O&&this._isGlobalWrappableSource&&B)return this._fetchPixels(D,G,S,A);if(3<=O)return{extent:D,pixelBlock:null};const C=[],{xmin:M,xmax:N}=D,U=Math.round(Q/(N-M)*G),X=U-Math.round((Q/2-M)/(N-M)*G);let I=0;B=[];for(let W=0;W<=O;W++){var V=new y({xmin:0===W?M:-Q/2,xmax:W===O?N-Q*W:Q/2,ymin:D.ymin,ymax:D.ymax,spatialReference:D.spatialReference});const Z=0===W?U-X:W===O?G-I:U;I+=Z;B.push(Z);V=A.disableWrapAround&&0<W?null:this._fetchPixels(V,Z,S,A);C.push(V)}Q=
(await Promise.all(C)).map(W=>W?.pixelBlock);O=null;G={width:G,height:S};O=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:Q,srcMosaicSize:G,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:B},A)).pixelBlock:f.mosaic(Q,G,{blockWidths:B});A=l.projectExtent(D,this.rasterInfo.spatialReference,A.datumTransformation);return{extent:D,srcExtent:A,pixelBlock:O}}async fetchRawPixels(D,G,S,A={}){G={x:Math.floor(G.x),
y:Math.floor(G.y)};const B=await this._fetchRawTiles(D,G,S,A),{nativeExtent:Q,nativePixelSize:O,storageInfo:C}=this.rasterInfo;var M=2**D,N=O.x*M;M*=O.y;N=new y({xmin:Q.xmin+N*G.x,xmax:Q.xmin+N*(G.x+S.width-1),ymin:Q.ymax-M*(G.y+S.height-1),ymax:Q.ymax-M*G.y,spatialReference:Q.spatialReference});if(!B)return{extent:N,srcExtent:N,pixelBlock:null};const {pixelBlocks:U,mosaicSize:X}=B;if(1===U.length&&null!=U[0]&&U[0].width===S.width&&U[0].height===S.height)return{extent:N,srcExtent:N,pixelBlock:B.pixelBlocks[0]};
D={x:G.x%(0<D?C.pyramidBlockWidth:C.blockWidth),y:G.y%(0<D?C.pyramidBlockHeight:C.blockHeight)};S=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:U,srcMosaicSize:X,destDimension:S,clipOffset:D,clipSize:S,coefs:null,sampleSpacing:null,interpolation:A.interpolation,alignmentInfo:null,blockWidths:null},A)).pixelBlock:f.mosaic(U,X,{clipOffset:D,clipSize:S});return{extent:N,srcExtent:N,pixelBlock:S}}fetchRawTile(D,G,S,A){throw new L("BaseRaster:read-not-implemented",
"fetchRawTile() is not implemented");}computeExtent(D){return l.projectExtent(this.rasterInfo.extent,D)}decodePixelBlock(D,G){return!this.rasterJobHandler||G.useCanvas?c.decode(D,G):this.rasterJobHandler.decode({data:D,options:G})}async request(D,G,S=0){const {customFetchParameters:A}=this.ioConfig,{range:B,query:Q,headers:O}=G;S=S??G.retryCount??this.ioConfig.retryCount;const C=B?{Range:`bytes=${B.from}-${B.to}`}:null;try{return await w(D,{...G,query:{...Q,...A},headers:{...O,...C}})}catch(M){if(0<
S)return S--,this.request(D,G,S);throw M;}}getSliceIndex(D){const {multidimensionalInfo:G}=this.rasterInfo;return null==G||null==D||0===D.length?null:b.getSliceIndex(D,G)}getTileExtentFromTileInfo(D,G,S,A){D=A.lodAt(D);return this.getTileExtent({x:D.resolution,y:D.resolution},G,S,A.origin,A.spatialReference,A.size)}updateTileInfo(){const {storageInfo:D,spatialReference:G,extent:S,pixelSize:A}=this.rasterInfo;if(!D.tileInfo){const Q=[];var B=D.maximumPyramidLevel||0;let O=Math.max(A.x,A.y),C=1/.0254*
96*O;for(let M=0;M<=B;M++)Q.unshift(new q({level:B-M,resolution:O,scale:C})),O*=2,C*=2;B=new F({x:S.xmin,y:S.ymax,spatialReference:G});D.tileInfo=new x({origin:B,size:[D.blockWidth,D.blockHeight],spatialReference:G,lods:Q});D.isVirtualTileInfo=!0}}createRemoteDatasetStorageInfo(D,G=512,S=512,A){const {width:B,height:Q,nativeExtent:O,pixelSize:C,spatialReference:M}=D,N=new F({x:O.xmin,y:O.ymax,spatialReference:M});null==A&&(A=Math.max(0,Math.round(Math.log(Math.max(B,Q))/Math.LN2-8)));const U=this.computeBlockBoundary(O,
512,512,{x:O.xmin,y:O.ymax},[C],A);D.storageInfo=new t({blockWidth:G,blockHeight:S,pyramidBlockWidth:G,pyramidBlockHeight:S,origin:N,firstPyramidLevel:1,maximumPyramidLevel:A,blockBoundary:U})}async computeBestPyramidLevelForLocation(D,G){return 0}computeBlockBoundary(D,G,S,A,B,Q=0,O=2){if(1===B.length&&0<Q){B=[...B];let {x:N,y:U}=B[0];for(let X=0;X<Q;X++)N*=O,U*=O,B.push({x:N,y:U})}Q=[];const {x:C,y:M}=A;for(A=0;A<B.length;A++){const {x:N,y:U}=B[A];Q.push({minCol:Math.floor((D.xmin-C+.1*N)/G/N),
maxCol:Math.floor((D.xmax-C-.1*N)/G/N),minRow:Math.floor((M-D.ymax+.1*U)/S/U),maxRow:Math.floor((M-D.ymin-.1*U)/S/U)})}return Q}getPyramidPixelSize(D){const {nativePixelSize:G}=this.rasterInfo,{pyramidResolutions:S,pyramidScalingFactor:A}=this.rasterInfo.storageInfo;if(0===D)return G;if(null!=S&&S.length)return S[D-1];D=A**D;return{x:G.x*D,y:G.y*D}}identifyPixelLocation(D,G,S,A){const {spatialReference:B,nativeExtent:Q,storageInfo:O}=this.rasterInfo,{maximumPyramidLevel:C,origin:M,transposeInfo:N}=
O,U=A&&null!=N?N.tileSize[0]:O.blockWidth;A=A&&null!=N?N.tileSize[1]:O.blockHeight;D=l.projectPoint(D,B,S);if(!Q.intersects(D)||0>G||G>C)return null;S=this.getPyramidPixelSize(G);const {x:X,y:I}=S;S=(M.y-D.y)/I/A;const V=(D.x-M.x)/X/U;return{pyramidLevel:G,row:Math.floor(S),col:Math.floor(V),rowOffset:Math.min(A-1,Math.floor((S-Math.floor(S))*A)),colOffset:Math.min(U-1,Math.floor((V-Math.floor(V))*U)),blockWidth:U,srcLocation:D}}getTileExtent(D,G,S,A,B,Q){const [O,C]=Q;S=A.x+S*O*D.x;G=A.y-G*C*D.y;
return new y({xmin:S,xmax:S+O*D.x,ymin:G-C*D.y,ymax:G,spatialReference:B})}getBlockWidthHeight(D){return{blockWidth:0<D?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:0<D?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}isBlockOutside(D,G,S){D=this.rasterInfo.storageInfo.blockBoundary[D];return!D||D.maxRow<G||D.maxCol<S||D.minRow>G||D.minCol>S}updateImageSpaceRasterInfo(D){const {extent:G,pixelSize:S}=D;if(-.5!==
G.xmin||.5!==G.ymax||1!==S.x||1!==S.y||null!=D.transform){var {width:A,height:B}=D,Q=K.WebMercator;D.spatialReference=Q;D.extent=D.nativeExtent=new y({xmin:-.5,ymax:.5,xmax:A-.5,ymin:.5-B,spatialReference:Q});D.isPseudoSpatialReference=!0;D.transform=null;D.pixelSize=new F({x:1,y:1,spatialReference:Q});var {extent:O,storageInfo:C}=D;if(C&&(C.origin=new F({x:O.xmin,y:O.ymax,spatialReference:Q}),{tileInfo:Q}=C,Q)){Q.origin=C.origin;const M=(D.nativePixelSize.x+D.nativePixelSize.y)/2;Q.lods.forEach((N,
U)=>{N.resolution=M*2**U;N.scale=96*N.resolution/.0254})}}}async _fetchPixels(D,G,S,A={}){var B=l.getWorldWrapCount(D);if(2<=B)return{extent:D,pixelBlock:null};var Q=this._getSourceDataInfo(D,G,S,A);const {pyramidLevel:O,srcResolution:C,srcExtent:M,srcWidth:N,srcHeight:U,ul:X}=Q;if(0===N||0===U)return{extent:D,srcExtent:M,pixelBlock:null};var {rasterInfo:I}=this,V=I.transform,W="gcs-shift"===V?.type,Z=null!=l.getWorldWidth(D.spatialReference);if(W||!Z)B=l.getWorldWrapCount(Q.srcExtent,W);Q=await this._fetchRawTiles(O,
X,{width:N,height:U,wrapCount:B},A);if(!Q)return{extent:D,srcExtent:M,pixelBlock:null};var Y=I.storageInfo;W=0<O?Y.pyramidBlockWidth:Y.blockWidth;var aa=0<O?Y.pyramidBlockHeight:Y.blockHeight;let {x:ea,y:fa}=I.pixelSize;if(0<O){const {pyramidResolutions:ra,pyramidScalingFactor:ua}=Y;null!=ra&&ra[O-1]?{x:ea,y:fa}=ra[O-1]:(Y=ua**O,ea*=Y,fa*=Y)}var ca=I.spatialReference;I=new F({x:ea,y:fa,spatialReference:ca});const ja=W===N&&aa===U&&0===X.x%W&&0===X.y%aa;Y=new F({x:(D.xmax-D.xmin)/G,y:(D.ymax-D.ymin)/
S,spatialReference:D.spatialReference});const la=!D.spatialReference.equals(ca),na=ca.isGeographic?1E-9:1E-4;({datumTransformation:ca}=A);if(!la&&ja&&1===Q.pixelBlocks.length&&W===G&&aa===S&&this._isSameResolution(C,Y,na))return{extent:D,srcExtent:M,srcTilePixelSize:I,pixelBlock:Q.pixelBlocks[0]};W=Z&&null!=l.getWorldWidth(M.spatialReference)&&this._hasNoneOrGCSShiftTransform;(Z=A.requestProjectedLocalDirections&&this.rasterInfo.dataType.startsWith("vector"))&&!this.rasterJobHandler&&await l.load();
B=this.rasterJobHandler?await this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:D,srcBufferExtent:Q.extent,pixelSize:Y.toJSON(),datumTransformation:ca,rasterTransform:V,hasWrapAround:0<B||W,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:Z},A):l.getProjectionOffsetGrid({projectedExtent:D,srcBufferExtent:Q.extent,pixelSize:Y,datumTransformation:ca,rasterTransform:V,hasWrapAround:0<B||W,isAdaptive:!1,includeGCSGrid:Z});V=!A.requestRawData;W={rows:B.spacing[0],cols:B.spacing[1]};
aa=this._hasNoneOrGCSShiftTransform?this._getRasterTileAlignmentInfo(O,Q.extent.xmin):void 0;const {pixelBlocks:oa,mosaicSize:qa,isPartiallyFilled:sa}=Q;Q=null;this.rasterJobHandler?(G=await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:oa,srcMosaicSize:qa,destDimension:V?{width:G,height:S}:null,coefs:V?B.coefficients:null,sampleSpacing:V?W:null,projectDirections:Z,gcsGrid:Z?B.gcsGrid:null,isUV:"vector-uv"===this.rasterInfo.dataType,interpolation:A.interpolation,alignmentInfo:aa,blockWidths:null},
A),{pixelBlock:V,localNorthDirections:Q}=G):(aa=f.mosaic(oa,qa,{alignmentInfo:aa}),V=V?f.approximateTransform(aa,{width:G,height:S},B.coefficients,W,A.interpolation):aa,Z&&B.gcsGrid&&(Q=f.getLocalArithmeticNorthRotations({width:G,height:S},B.gcsGrid),V=r.convertToLocalDirections(V,this.rasterInfo.dataType,Q)));return A.requestRawData||Z?{extent:D,srcExtent:M,srcTilePixelSize:I,pixelBlock:V,transformGrid:B,localNorthDirections:Q,isPartiallyFilled:sa}:{extent:D,srcExtent:M,srcTilePixelSize:I,pixelBlock:V}}async _fetchRawTiles(D,
G,S,A){const {origin:B,blockBoundary:Q}=this.rasterInfo.storageInfo,{blockWidth:O,blockHeight:C}=this.getBlockWidthHeight(D);let {x:M,y:N}=G,{width:U,height:X,wrapCount:I}=S;var V=this._getRasterTileAlignmentInfo(D,0);A.buffer&&(M-=A.buffer.cols,N-=A.buffer.rows,U+=2*A.buffer.cols,X+=2*A.buffer.rows);var W=0,Z=0;let Y=0;I&&null!=V&&({worldColumnCountFromOrigin:Z,originColumnOffset:Y,rightPadding:W}=V,Z*V.blockWidth-W>=M+U&&(W=0));G=Math.floor(M/O);S=Math.floor(N/C);const aa=Math.floor((M+U+W-1)/O);
W=Math.floor((N+X+W-1)/C);var ea=Q[D];if(!ea)return null;const {minRow:fa,minCol:ca,maxCol:ja,maxRow:la}=ea;if(0===I&&(W<fa||aa<ca||S>la||G>ja))return null;ea=[];let na=!1;const oa=null==this.ioConfig.allowPartialFill?A.allowPartialFill:this.ioConfig.allowPartialFill;for(let ra=S;ra<=W;ra++)for(let ua=G;ua<=aa;ua++){let pa=ua;!A.disableWrapAround&&I&&null!=V&&Z<=ua&&(pa=ua-Z-Y);if(ra>=fa&&pa>=ca&&la>=ra&&ja>=pa){const xa=this._tileFetchQueue.push({pyramidLevel:D,row:ra,col:pa,options:A},{signal:A.signal});
oa?ea.push(new Promise(va=>{xa.then(Aa=>va(Aa)).catch(()=>{na=!0;va(null)})})):ea.push(xa)}else ea.push(Promise.resolve(null))}if(0===ea.length)return null;A=await Promise.all(ea);V={height:(W-S+1)*C,width:(aa-G+1)*O};({spatialReference:Z}=this.rasterInfo);D=this.getPyramidPixelSize(D);const {x:qa,y:sa}=D;return{extent:new y({xmin:B.x+G*O*qa,xmax:B.x+(aa+1)*O*qa,ymin:B.y-(W+1)*C*sa,ymax:B.y-S*C*sa,spatialReference:Z}),pixelBlocks:A,mosaicSize:V,isPartiallyFilled:na}}_isSameResolution(D,G,S){return Math.abs(D.x-
G.x)<S&&Math.abs(D.y-G.y)<S}_fetchRawTile(D,G,S,A){var B=this.rasterInfo.storageInfo.blockBoundary[D];if(!B)return Promise.resolve(null);const {minRow:Q,minCol:O,maxCol:C,maxRow:M}=B;if(G<Q||S<O||G>M||S>C)return Promise.resolve(null);const N=e.getRasterId(this.rasterId,A.sliceId),U=`${D}/${G}/${S}`;B=e.getBlock(N,A.registryId,U);if(null==B){const X=new AbortController;B=this.fetchRawTile(D,G,S,{...A,signal:X.signal});e.putBlock(N,A.registryId,U,B,X);B.catch(()=>e.deleteBlock(N,A.registryId,U))}if(A.signal)P.onAbort(A,
()=>{e.decreaseRefCount(N,A.registryId,U)});return B}_computeMagDirValues(D){const {bandCount:G,dataType:S}=this.rasterInfo;if((2!==G||"vector-magdir"!==S)&&"vector-uv"!==S||2!==D?.length||!D[0]?.length)return null;var A=D[0].length;if("vector-magdir"===S)return A=D[1].map(C=>(C+360)%360),[D[0],A];const [B,Q]=D;D=[];const O=[];for(let C=0;C<A;C++){const [M,N]=r.uvComponentToVector([B[C],Q[C]]);D.push(M);O.push(N)}return[D,O]}_getRasterTileAlignmentInfo(D,G){null==this._rasterTileAlignmentInfo&&(this._rasterTileAlignmentInfo=
l.getRasterDatasetAlignmentInfo(this.rasterInfo));return null==this._rasterTileAlignmentInfo.pyramidsInfo?null:{startX:G,halfWorldWidth:this._rasterTileAlignmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlignmentInfo.hasGCSSShiftTransform,...this._rasterTileAlignmentInfo.pyramidsInfo[D]}}_getSourceDataInfo(D,G,S,A={}){const B={datumTransformation:A.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0,ul:{x:0,y:0}};A.srcResolution&&
(B.srcResolution=A.srcResolution,this._updateSourceDataInfo(D,B));var Q=this.rasterInfo.storageInfo.maximumPyramidLevel||0;const {srcWidth:O,srcHeight:C,pyramidLevel:M}=B;var N=O/G;const U=C/S,X=M<Q&&16<=N*U;var I=M===Q&&this._requireTooManySrcTiles(O,C,G,S);if(X||I||0===O||0===C){I=new F({x:(D.xmax-D.xmin)/G,y:(D.ymax-D.ymin)/S,spatialReference:D.spatialReference});I=l.projectResolution(I,this.rasterInfo.spatialReference,D,B.datumTransformation);const V=!I||A.srcResolution&&I.x+I.y<A.srcResolution.x+
A.srcResolution.y;X&&A.srcResolution&&V&&(N=Math.round(Math.log(Math.max(N,U))/Math.LN2)-1,Q-M+3>=N&&(Q=2**N,I={x:A.srcResolution.x*Q,y:A.srcResolution.y*Q}));I&&(B.srcResolution=I,this._updateSourceDataInfo(D,B))}this._requireTooManySrcTiles(B.srcWidth,B.srcHeight,G,S)&&(B.srcWidth=0,B.srcHeight=0);return B}_requireTooManySrcTiles(D,G,S,A){const {tileInfo:B}=this.rasterInfo.storageInfo;return Math.ceil(D/B.size[0])*Math.ceil(G/B.size[1])>=256*Math.max(1,(S+A)/1024)||8<D/S||8<G/A}_updateSourceDataInfo(D,
G){G.srcWidth=0;G.srcHeight=0;var {rasterInfo:S}=this,A=S.spatialReference;const {srcResolution:B,datumTransformation:Q}=G,{pyramidLevel:O,pyramidResolution:C,excessiveReading:M}=l.snapPyramid(B,S,this.ioConfig.sampling);if(!M&&(D=G.srcExtent||l.projectExtent(D,A,Q),null!=D)){(A=S.transform)&&(D=A.inverseTransform(D));G.srcExtent=D;var {x:N,y:U}=S.storageInfo.origin;S=Math.floor((D.xmin-N)/C.x+.1);A=Math.floor((U-D.ymax)/C.y+.1);var X=Math.floor((D.xmax-N)/C.x-.1),I=Math.floor((U-D.ymin)/C.y-.1);
X=D.width<.1*C.x?0:X-S+1;D=D.height<.1*C.y?0:I-A+1;G.pyramidLevel=O;G.pyramidResolution=C;G.srcWidth=X;G.srcHeight=D;G.ul={x:S,y:A}}}_getRequestOptionsWithSliceId(D){null!=this.rasterInfo.multidimensionalInfo&&null==D.sliceId&&(D={...D,sliceId:this.getSliceIndex(D.multidimensionalDefinition)});return D}_processIdentifyResult(D,G){const {srcLocation:S,position:A,pyramidLevel:B,useTransposedTile:Q}=G,O=D.pixels[0].length/D.width/D.height;if(D.mask&&!D.mask[A])return{location:S,value:null};const {multidimensionalInfo:C}=
this.rasterInfo;if(null==C||!Q)return G=D.pixels.map(W=>W[A]),D={location:S,value:G,pyramidLevel:B},G=this._computeMagDirValues(G.map(W=>[W])),G?.length&&(D.magdirValue=G.map(W=>W[0])),D;let M=D.pixels.map(W=>W.slice(A*O,A*O+O)),N=this._computeMagDirValues(M);const {requestSomeSlices:U,identifyOptions:X}=G;let I=b.createSlices(C,X.transposedVariableName);if(U){const W=b.getSliceIds(I,X.multidimensionalDefinition,X.timeExtent);M=M.map(Z=>W.map(Y=>Z[Y]));N=N?.map(Z=>W.map(Y=>Z[Y]));I=W.map(Z=>I[Z])}G=
D.noDataValues||this.rasterInfo.noDataValue;D={pixels:M,pixelType:D.pixelType};let V;null!=G&&(a.convertNoDataToMask(D,G),V=D.mask);D=I.map((W,Z)=>{W={value:0===V?.[Z]?null:M.map(Y=>Y[Z]),multidimensionalDefinition:W.multidimensionalDefinition.map(Y=>new h({...Y,isSlice:!0}))};N?.length&&(W.magdirValue=[N[0][Z],N[1][Z]]);return W});return{location:S,value:null,dataSeries:D,pyramidLevel:B}}};m.__decorate([J.property()],v.prototype,"_rasterTileAlignmentInfo",void 0);m.__decorate([J.property()],v.prototype,
"_tileFetchQueue",void 0);m.__decorate([J.property({readOnly:!0})],v.prototype,"_isGlobalWrappableSource",null);m.__decorate([J.property({readOnly:!0})],v.prototype,"_hasNoneOrGCSShiftTransform",null);m.__decorate([J.property()],v.prototype,"rasterJobHandler",null);m.__decorate([J.property({readOnly:!0})],v.prototype,"rasterId",null);m.__decorate([J.property(n.url)],v.prototype,"url",null);m.__decorate([J.property({type:String,json:{write:!0}})],v.prototype,"datasetName",void 0);m.__decorate([J.property({type:String,
json:{write:!0}})],v.prototype,"datasetFormat",void 0);m.__decorate([J.property()],v.prototype,"hasUniqueSourceStorageInfo",void 0);m.__decorate([J.property()],v.prototype,"rasterInfo",void 0);m.__decorate([J.property()],v.prototype,"ioConfig",void 0);m.__decorate([J.property()],v.prototype,"sourceJSON",void 0);return v=m.__decorate([g.subclass("esri.layers.support.rasterDatasets.BaseRaster")],v)})},"esri/layers/support/RasterStorageInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P){var J;v=J=class extends v.JSONSupport{constructor(){super(...arguments);this.blockHeight=this.blockWidth=void 0;this.maximumPyramidLevel=this.firstPyramidLevel=this.origin=this.compression=null;this.pyramidScalingFactor=2;this.pyramidBlockHeight=this.pyramidBlockWidth=null;this.isVirtualTileInfo=!1;this.blockBoundary=this.transposeInfo=this.tileInfo=null}clone(){return new J({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:w.clone(this.origin),
firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:w.clone(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:w.clone(this.tileInfo),transposeInfo:w.clone(this.transposeInfo),blockBoundary:w.clone(this.blockBoundary)})}};m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"blockWidth",
void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"blockHeight",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],v.prototype,"compression",void 0);m.__decorate([L.property({type:P,json:{write:!0}})],v.prototype,"origin",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"firstPyramidLevel",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"maximumPyramidLevel",void 0);m.__decorate([L.property({json:{write:!0}})],
v.prototype,"pyramidResolutions",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"pyramidScalingFactor",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"pyramidBlockWidth",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],v.prototype,"pyramidBlockHeight",void 0);m.__decorate([L.property({type:Boolean,json:{write:!0}})],v.prototype,"isVirtualTileInfo",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"tileInfo",
void 0);m.__decorate([L.property()],v.prototype,"transposeInfo",void 0);m.__decorate([L.property()],v.prototype,"blockBoundary",void 0);return v=J=m.__decorate([R.subclass("esri.layers.support.RasterStorageInfo")],v)})},"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],function(m,v,w){function L(k,n,h){const q=n.shift();0===h.length&&h.push({sliceId:-1,multidimensionalDefinition:[]});const t=h.length;for(let x=
0;x<t;x++){const b=h.shift().multidimensionalDefinition;q.values?.forEach(e=>{h.push({sliceId:-1,multidimensionalDefinition:[...b,{variableName:k,dimensionName:q.name,values:[e]}]})})}n.length&&L(k,n,h)}function E(k,n){return Array.isArray(k)?n[0]===n[1]?k[0]===n[0]||k[1]===n[0]:k[0]>=n[0]&&k[0]<=n[1]&&k[1]>=n[0]&&k[1]<=n[1]:k>=n[0]&&k<=n[1]}function T(k,n){return k[0]<=n[0]&&k[1]>=n[0]||k[0]<=n[1]&&k[1]>=n[1]||k[0]>=n[0]&&k[1]<=n[1]}function R(k){return 1===k.length?[k[0],k[0]]:[k[0],k[k.length-
1]]}function P(k,n,h){if(!n?.subsetDefinitions?.length)return k;if(h){const {variables:t}=n;if(t.length&&!t.includes(h))return null;n=n.subsetDefinitions.find(x=>x.dimensionName===k.name&&x.variableName===h);if(!n?.values?.length)return k;n=R(n.values)}else n=n.dimensions.find(({name:t})=>t===k.name)?.extent;const q=n;if(!q?.length)return k;n=k.values.filter(t=>E(t,q));return{...k,extent:[...q],values:n}}function J(k,n,h){if(!n?.subsetDefinitions?.length)return!1;const {variables:q}=n;if(q.length&&
k.some(({variableName:t})=>t&&!q.includes(t)))return!0;for(let t=0;t<k.length;t++){const x=k[t],b=n.subsetDefinitions.find(e=>(""===x.variableName||e.variableName===x.variableName)&&e.dimensionName===x.dimensionName);if(b?.values.length){const e=R(b.values);if(!x.isSlice&&2===x.values.length&&!Array.isArray(x.values[0])&&x.values[0]!==x.values[1]&&h){if(!T(x.values,e))return!0}else if(x.values.some(a=>!E(a,e)))return!0}}return!1}function p(k,n){var h=k.dimensions.find(({name:b})=>"StdTime"===b);if(null==
h||null==n.start&&null==n.end)return n;n=n.clone();const {start:q,end:t}=n.toJSON(),x=q===t?[q]:null!=q&&null!=t?[q,t]:[q??t];if(2===x.length&&h?.extent.length&&(x[0]=Math.max(x[0],h.extent[0]),x[1]=Math.min(x[1],h.extent[1]??h.extent[0]),x[1]<x[0]))return null;h=new w({variableName:"",dimensionName:"StdTime",isSlice:1===x.length,values:x});if(J([h],k,!0))return null;n.start=new Date(x[0]);n.end=new Date(x[1]??x[0]);return n}function u(k,n={}){const {multidimensionalInfo:h,keyProperties:q}=k;if(null==
h)return null;const {variableName:t,multidimensionalSubset:x,multidimensionalDefinition:b}=n;k=null!=b?b[0]?.variableName:null;const e=t||k||q?.DefaultVariable;({variables:k}=h);x?.variables?.length&&(k=k.filter(({name:a})=>x.variables.includes(a)));return e?k.find(({name:a})=>a===e)??k[0]:k[0]}function d(k,n){var {values:h}=n;if(h?.length){n=Array.isArray(h[0]);var q=Array.isArray(k);return n!==q?-1:n&&q?h.findIndex(x=>x[0]===k[0]&&x[1]===k[1]):h.indexOf(k)}({extent:q}=n);if(Array.isArray(k)||k<
q[0]||k>q[1])return-1;h=n.interval||1;if("ISO8601"!==n.unit)return Math.round((k-q[0])/h);q=q[0];let t=-1;switch(n.intervalUnit?.toLowerCase()||"seconds"){case "seconds":t=Math.round((k-q)/1E3/h);break;case "minutes":t=Math.round((k-q)/6E4/h);break;case "hours":t=Math.round((k-q)/36E5/h);break;case "days":t=Math.round((k-q)/864E5/h);break;case "months":n=(new Date(k)).getUTCFullYear()-(new Date(q)).getUTCFullYear();h=(new Date(q)).getUTCMonth();q=(new Date(k)).getUTCMonth();t=0===n?q-h:q+11-h+12*
(n-1);break;case "years":t=Math.round(((new Date(k)).getUTCFullYear()-(new Date(q)).getUTCFullYear())/h);break;case "decades":t=Math.round(((new Date(k)).getUTCFullYear()-(new Date(q)).getUTCFullYear())/10/h)}return t}function g(k){var n=k.values?.length;if(n)return n;const {extent:h,unit:q}=k;n=k.interval||1;var t=h?h[1]-h[0]:0;if("ISO8601"!==q)return Math.round(t/n);switch(k.intervalUnit?.toLowerCase()??"seconds"){case "seconds":n=Math.round(t/1E3/n);break;case "minutes":n=Math.round(t/6E4/n);break;
case "hours":n=Math.round(t/36E5/n);break;case "days":n=Math.round(t/864E5/n);break;case "months":k=(new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear();n=(new Date(h[0])).getUTCMonth();t=(new Date(h[1])).getUTCMonth();n=0===k?t-n+1:t+11-n+12*(k-1)+1;break;case "years":n=Math.round(((new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear())/n);break;case "decades":n=Math.round(((new Date(h[1])).getUTCFullYear()-(new Date(h[0])).getUTCFullYear())/10/n);break;default:n=0}return n}
m.createSlices=function(k,n){const h=[];let q=0;(n?k.variables.filter(t=>t.name.toLowerCase()===n.toLowerCase()):[...k.variables].sort((t,x)=>t.name>x.name?1:-1)).forEach(t=>{const x=[],b=[...t.dimensions].sort((e,a)=>e.name>a.name?-1:1);L(t.name,b,x);x.forEach(e=>{h.push({...e,sliceId:q++})})});return h};m.getDefaultMultidimensionalDefinition=function(k,n={}){var h=u(k,n);if(!h)return null;k=[];const {dimensions:q,name:t}=h;if(0===q.length)return[new w({variableName:t,dimensionName:"",values:[],
isSlice:!0})];for(h=0;h<q.length;h++){const x=P(q[h],n.multidimensionalSubset,t);if(!x)return null;const {values:b,extent:e}=x;let a=b?.[0]??e[0];"stdz"===x.name.toLowerCase()&&!x.hasRanges&&Math.abs(e[1])<=Math.abs(e[0])&&(a=b?.length?b[b.length-1]:e[1]);k.push(new w({variableName:t,dimensionName:x.name,values:[a],isSlice:n.useRangeForRangedDimensionInfo?!!x.hasRanges:!0}))}return k};m.getDefaultVariableInfo=u;m.getSliceIds=function(k,n,h){let q=k;n&&(n=[...n].sort((t,x)=>t.dimensionName<x.dimensionName?
-1:1),n.forEach(({dimensionName:t,values:x,isSlice:b})=>{x.length&&(q=q.filter(e=>{e=e.multidimensionalDefinition.find(c=>c.dimensionName===t);if(null==e)return!1;const a=e.values[0];return"number"===typeof a?"number"===typeof x[0]?x.includes(a):x.some(c=>c[0]<=a&&c[1]>=a):"number"===typeof x[0]?x.some(c=>a[0]<=c&&a[1]>=c):b?x.some(c=>c[0]===a[0]&&c[0]===a[1]):x.some(c=>c[0]>=a[0]&&c[0]<=a[1]||c[1]>=a[0]&&c[1]<=a[1]||c[0]<a[0]&&c[1]>a[1])}))}));if(q.length&&null!=h?.start&&null!=h.end){const t=h.start.getTime(),
x=h.end.getTime(),b=q[0].multidimensionalDefinition.findIndex(e=>"StdTime"===e.dimensionName);-1<b&&(q=q.filter(e=>{e=e.multidimensionalDefinition[b].values[0];return t<=e&&x>=e}))}return q.map(t=>t.sliceId)};m.getSliceIndex=function(k,n){let h=0;var q=k[0].variableName;n=[...n.variables].sort((x,b)=>x.name>b.name?1:-1);for(var t=0;t<n.length;t++){const x=n[t],b=[...x.dimensions].sort((e,a)=>e.name>a.name?-1:1);if(x.name!==q)h+=b.map(e=>g(e)).reduce((e,a)=>e*a);else{q=b.map(e=>g(e));n=b.length;for(let e=
0;e<n;e++){t=k.find(a=>a.dimensionName===b[e].name);if(null==t)return null;t=d(t.values[0],b[e]);if(-1===t)return null;q.shift();h=e===n-1?h+t:h+t*q.reduce((a,c)=>a*c)}break}}return h};m.getSubsetVariablesFromMdInfo=function(k,n){if(null==n||null==k)return null;n=n.variables.map(h=>({...h}));k?.variables?.length&&(n=n.filter(({name:h})=>k.variables.includes(h)),n.forEach(h=>{h.dimensions=h.dimensions.map(q=>P(q,k,h.name)).filter(v.isSome)}));return n};m.hasExcludedVariableOrDimension=J;m.intersectMultimensionalSubset=
function(k,n){if(null==k)return{isOutside:!1};const {geometry:h,timeExtent:q,multidimensionalDefinition:t}=n;n=null;if(null!=q&&(n=p(k,q),null==n))return{isOutside:!0};const {areaOfInterest:x}=k;if(x&&h){const b="point"===h.type?h:"extent"===h.type?h.center:"polygon"===h.type?h.centroid:null;if(b&&!x.contains(b))return{isOutside:!0}}return null!=t&&t.length&&J(t,k,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:h,timeExtent:n,multidimensionalDefinition:t}}};m.isMultiSliceOrRangeDefinition=
function(k){return k?.length?k.some(n=>{if(null==n.values)return!0;const h=n.values.length;return 0===h||1<h||!n.isSlice&&Array.isArray(n.values[0])}):!1};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports","../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper","../../../geometry/Point"],function(m,v,w,L,E){function T(J,p){return(J=R.get(J))?J[p]??null:null}const R=new Map,
P=new w;m.decreaseRefCount=function(J,p,u){const d=R.get(J);if(!d)return null==p?P.decreaseRefCount(J,u):0;if(null==p||null==d[p])return P.decreaseRefCount(J,u);p=d[p]?.cache;J=p?.get(u);if(p&&J){J.refCount--;if(0===J.refCount){p.delete(u);for(p=0;p<d.length;p++)d[p]?.cache.delete(u);J.controller&&J.controller.abort()}return J.refCount}return 0};m.deleteBlock=function(J,p,u){const d=R.get(J);d?null==p||null==d[p]?P.deleteBlock(J,u):d[p]?.cache.delete(u):null==p&&P.deleteBlock(J,u)};m.deleteRaster=
function(J){R.delete(J)};m.getBlock=function(J,p,u){const d=R.get(J);if(!d)return null==p?P.getBlock(J,u):null;if(null==p||null==d[p]){for(p=0;p<d.length;p++){var g=d[p]?.cache.get(u);if(g)return g.refCount++,g.block}return P.getBlock(J,u)}if(J=d[p]?.cache.get(u))return J.refCount++,J.block;for(J=0;J<d.length;J++){if(J===p||!d[J])continue;g=d[J]?.cache;const k=g?.get(u);if(g&&k)return k.refCount++,g.set(u,k),k.block}return null};m.getRasterId=function(J,p){return null==p?J:`${J}?sliceId=${p}`};m.putBlock=
function(J,p,u,d,g=null){const k=R.get(J);if(k)if(null==p||null==k[p])P.putBlock(J,u,d,g);else{var n={refCount:1,block:d,isResolved:!1,isRejected:!1,controller:g};d.then(()=>n.isResolved=!0).catch(()=>n.isRejected=!0);k[p]?.cache.set(u,n)}else null==p&&P.putBlock(J,u,d,g)};m.register=function(J,p){p={extent:null,rasterInfo:p,cache:new Map};const u=R.get(J);if(u)return u.push(p),u.length-1;R.set(J,[p]);return 0};m.unregister=function(J,p){const u=R.get(J);u&&(u[p]=null,u.some(d=>null!=d)||R.delete(J))};
m.update=function(J,p,u,d,g,k,n=null){if(J=T(J,p)){p=J.extent;var {cache:h,rasterInfo:q}=J;if(!p||p.xmin!==u.xmin||p.xmax!==u.xmax||p.ymin!==u.ymin||p.ymax!==u.ymax){d=d??0;p=u.clone().normalize();var {spatialReference:t,transform:x}=q,b=new Set;for(let r=0;r<p.length;r++){var e=p[r];if(e.xmax-e.xmin<=d||e.ymax-e.ymin<=d)continue;var a=L.projectExtent(e,t,n);null!=x&&(a=x.inverseTransform(a));var c=new E({x:d,y:d,spatialReference:e.spatialReference});if(null==g&&(g=L.projectResolution(c,t,e,n),!g))return;
const {pyramidLevel:z,pyramidResolution:y,excessiveReading:F}=L.snapPyramid(g,q,k||"closest");if(F)return;({storageInfo:e}=q);var {origin:f}=e;c=Math.max(0,Math.floor((a.xmin-f.x)/y.x));f=Math.max(0,Math.floor((f.y-a.ymax)/y.y));const K=0<z?e.pyramidBlockWidth:e.blockWidth,H=0<z?e.pyramidBlockHeight:e.blockHeight;e=Math.max(0,Math.floor(c/K)-1);var l=Math.max(0,Math.floor(f/H)-1);c=Math.floor((c+Math.ceil((a.xmax-a.xmin)/y.x-.1)-1)/K)+1;a=Math.floor((f+Math.ceil((a.ymax-a.ymin)/y.y-.1)-1)/H)+1;for(f=
l;f<=a;f++)for(l=e;l<=c;l++)b.add(`${z}/${f}/${l}`)}h.forEach((r,z)=>{b.has(z)||(r=h.get(z),(null==r||r.isResolved||r.isRejected)&&h.delete(z))});J.extent={xmin:u.xmin,ymin:u.ymin,xmax:u.xmax,ymax:u.ymax}}}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){class m{constructor(v=15E3,w=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=v;this._interval=Math.min(v,w)}decreaseRefCount(v,
w){v=v+"/"+w;w=this._cachedBlocks;if(w.has(v)){const L=w.get(v);L.refCount--;0>=L.refCount&&(w.delete(v),L.controller&&L.controller.abort());return L.refCount}return 0}getBlock(v,w){v=v+"/"+w;w=this._cachedBlocks;if(w.has(v)){const L=w.get(v);L.ts=Date.now();L.refCount++;w.delete(v);w.set(v,L);return L.block}return null}putBlock(v,w,L,E){const T=this._cachedBlocks;v=v+"/"+w;T.has(v)?(L=T.get(v),L.ts=Date.now(),L.refCount++):T.set(v,{block:L,ts:Date.now(),refCount:1,controller:E});this._trim();this._updateTimer()}deleteBlock(v,
w){const L=this._cachedBlocks;v=v+"/"+w;L.has(v)&&L.delete(v)}updateMaxSize(v){this._size=v;this._trim()}empty(){this._cachedBlocks.clear();this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null==this._timer){var v=this._cachedBlocks;this._timer=setInterval(()=>{const w=Array.from(v),L=Date.now();for(let E=0;E<w.length;E++)if(w[E][1].ts<=L-this._duration)v.delete(w[E][0]);else break;0===v.size&&this._clearTimer()},this._interval)}}_trim(){const v=this._cachedBlocks;
if(!(-1===this._size||this._size>=v.size)){var w=Array.from(v);for(let L=0;L<w.length-this._size;L++)v.delete(w[L][0])}}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}return m})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d){function g(I,V,W){return!R.canProjectWithoutEngine(I,V,W)}function k(I,V,W){if((I=g(I,V,W))&&!R.isLoaded())throw new L("rasterprojectionhelper-project","projection engine is not loaded");return I}function n(I,V,W){k(I.spatialReference,V);return W?R.getTransformation(V,I.spatialReference,I):R.getTransformation(I.spatialReference,V,I)}function h(I,V,W,Z=null){const Y=I.spatialReference;if(Y.equals(V))return I;k(Y,V,Z);W=W.center;W=new J({xmin:W.x-I.x/2,xmax:W.x+I.x/
2,ymin:W.y-I.y/2,ymax:W.y+I.y/2,spatialReference:Y});Z=R.project(W,V,Z);W=H(V);null==Z||null!=W&&Z.width>=W?(V=E.getMetersPerUnitForSR(Y)/E.getMetersPerUnitForSR(V),I={x:I.x*V,y:I.y*V}):I={x:Z.width,y:Z.height};return I}function q(I,V=.01){return E.getMetersPerUnitForSR(I)?V/E.getMetersPerUnitForSR(I):0}function t(I,V,W=null,Z=!0){const Y=I.spatialReference;if(Y.equals(V))return I;k(Y,V,W);W=R.project(I,V,W);if(!Z||!W)return W;x([I],[W],Y,V);return W}function x(I,V,W,Z){const Y=D(W,!0),aa=D(Z,!0);
W=q(W,500);Z=q(Z,500);if(W&&null!=Y&&null!=aa)for(let ea=0;ea<I.length;ea++){const fa=V[ea];if(!fa)continue;const {x:ca}=I[ea],{x:ja}=fa;ja>=aa[1]-Z&&Math.abs(ca-Y[0])<W?fa.x-=aa[1]-aa[0]:ja<=aa[0]+Z&&Math.abs(ca-Y[1])<W&&(fa.x+=aa[1]-aa[0])}}function b(I){const {inSR:V,outSR:W,datumTransformation:Z,preferPE:Y}=I;if(V.equals(W))return{points:I}=l(I,null),I;if(V.isWebMercator&&W.isWGS84||V.isWGS84&&W.isWebMercator){const {cols:ca,rows:ja,xres:la,yres:na,usePixelCenter:oa,inSR:qa,outSR:sa}=I;let {xmin:ra,
ymax:ua}=I;oa&&(ra+=la/2,ua-=na/2);I=[];const pa=[];var aa=Math.max(ca,ja);for(var ea=0;ea<aa;ea++){var fa=R.project(new p({x:ra+la*Math.min(ca,ea),y:ua-na*Math.min(ja,ea),spatialReference:qa}),sa);ea<=ca&&I.push(fa.x);ea<=ja&&pa.push(fa.y)}aa=[];for(ea=0;ea<ca;ea++)for(fa=0;fa<ja;fa++)aa.push([I[ea],pa[fa]]);return aa}return k(V,W,Z)&&Y&&(V.isGeographic||null!=c(V))?a(I):e(I)}function e(I){var {points:V}=l(I,null);const {inSR:W,outSR:Z,datumTransformation:Y}=I;I=V.map(aa=>new p(aa[0],aa[1],W));V=
R.project(I,Z,Y);Y&&x(I,V,W,Z);return V.map(aa=>aa?[aa.x,aa.y]:[NaN,NaN])}function a(I){const {inSR:V,outSR:W,datumTransformation:Z}=I;var Y=c(V);const {points:aa,mask:ea}=l(I,Y);V.isGeographic||(I=V.wkid?T.PeFactory.coordsys(V.wkid):T.PeFactory.fromString(V.isGeographic?T.PeDefs.PE_TYPE_GEOGCS:T.PeDefs.PE_TYPE_PROJCS,V.wkt2||V.wkt),T.PeCSTransformations.projToGeog(I,aa.length,aa));if(null!=Z&&Z.steps.length){var fa;W.isGeographic&&(fa=aa.map(([ca])=>179.9955<ca?1:-179.9955>ca?-1:0));Z.steps.forEach(ca=>
{const ja=ca.wkid?T.PeFactory.geogtran(ca.wkid):T.PeFactory.fromString(T.PeDefs.PE_TYPE_GEOGTRAN,ca.wkt);T.PeGTTransformations.geogToGeog(ja,aa.length,aa,null,ca.isInverse?T.PeDefs.PE_TRANSFORM_2_TO_1:T.PeDefs.PE_TRANSFORM_1_TO_2)});if(fa)for(I=0;I<aa.length;I++){Y=fa[I];const ca=aa[I][0],ja=179.9955<ca?1:-179.9955>ca?-1:0;Y&&ja&&Y!==ja&&(aa[I][0]=0<Y?ca+360:ca-360)}}W.isGeographic||(fa=c(W,!0),r(aa,null!=fa&&fa.isEnvelope?[fa.bbox[1],fa.bbox[3]]:[-90,90]),fa=W.wkid?T.PeFactory.coordsys(W.wkid):T.PeFactory.fromString(W.isGeographic?
T.PeDefs.PE_TYPE_GEOGCS:T.PeDefs.PE_TYPE_PROJCS,W.wkt2||W.wkt),T.PeCSTransformations.geogToProj(fa,aa.length,aa));fa=aa;if(ea&&aa.length!==ea.length){fa=[];for(let ca=0,ja=0;ca<ea.length;ca++)ea[ca]?fa.push(aa[ja++]):fa.push([NaN,NaN])}return fa}function c(I,V=!1){var W=I.wkid||I.wkt2||I.wkt;if(!W||I.isGeographic)return null;W=String(W);if(U.has(W))return W=U.get(W),V?W?.gcs:W?.pcs;var Z=I.wkid?T.PeFactory.coordsys(I.wkid):T.PeFactory.fromString(I.isGeographic?T.PeDefs.PE_TYPE_GEOGCS:T.PeDefs.PE_TYPE_PROJCS,
I.wkt2||I.wkt);I=q(I,1E-4);I=f(Z,I);Z=f(Z,0,!0);U.set(W,{pcs:I,gcs:Z});return V?Z:I}function f(I,V=0,W=!1){var Z=T.PePCSInfo.generate(I),Y=W?I.horizonGcsGenerate():I.horizonPcsGenerate();if(!Z||!Y?.length)return null;I=!1;var aa=Y.find(la=>1===la.getInclusive()&&1===la.getKind());if(!aa){aa=Y.find(la=>1===la.getInclusive()&&0===la.getKind());if(!aa)return null;I=!0}W=W?0:(2===Z.getNorthPoleLocation()?1:0)|(2===Z.getSouthPoleLocation()?2:0);Z=Z.isPannableRectangle();aa=aa.getCoord();if(I)return{isEnvelope:I,
isPannable:Z,vertices:aa,coef:null,bbox:[aa[0][0]-V,aa[0][1]-V,aa[1][0]+V,aa[1][1]+V],poleLocation:W};V=0;I=[];let [ea,fa]=aa[0],[ca,ja]=aa[0];for(let la=0,na=aa.length;la<na;la++){V++;V===na&&(V=0);const [oa,qa]=aa[la],[sa,ra]=aa[V];if(ra===qa)I.push([oa,sa,qa,ra,2]);else{Y=(sa-oa)/(ra-qa||1E-4);const ua=oa-Y*qa;qa<ra?I.push([Y,ua,qa,ra,0]):I.push([Y,ua,ra,qa,1])}ea=ea<oa?ea:oa;fa=fa<qa?fa:qa;ca=ca>oa?ca:oa;ja=ja>qa?ja:qa}return{isEnvelope:!1,isPannable:Z,vertices:aa,coef:I,bbox:[ea,fa,ca,ja],poleLocation:W}}
function l(I,V){const W=[],{cols:Z,rows:Y,xres:aa,yres:ea,usePixelCenter:fa}=I;let {xmin:ca,ymax:ja}=I;fa&&(ca+=aa/2,ja-=ea/2);if(null==V){for(I=0;I<Z;I++)for(V=0;V<Y;V++)W.push([ca+aa*I,ja-ea*V]);return{points:W}}I=new Uint8Array(Z*Y);if(V.isEnvelope){const {bbox:[ua,pa,xa,va]}=V;for(let Aa=0,ba=0;Aa<Z;Aa++){var la=ca+aa*Aa,na=V.isPannable||la>=ua&&la<=xa;for(var oa=0;oa<Y;oa++,ba++){var qa=ja-ea*oa;na&&qa>=pa&&qa<=va&&(W.push([la,qa]),I[ba]=1)}}return{points:W,mask:I}}la=V.coef;V=[];for(na=0;na<
Y;na++){var sa=ja-ea*na;oa=[];qa=[];for(var ra=0;ra<la.length;ra++){const [ua,pa,xa,va,Aa]=la[ra];sa===xa&&xa===va?(oa.push(ua),oa.push(pa),qa.push(2),qa.push(2)):sa>=xa&&sa<=va&&(oa.push(ua*sa+pa),qa.push(Aa))}sa=oa;if(2<oa.length){ra=2===qa[0]?0:qa[0];let ua=oa[0];sa=[];for(let pa=1;pa<qa.length;pa++)if(2!==qa[pa]||pa===qa.length-1)qa[pa]!==ra&&(sa.push(0===ra?Math.min(ua,oa[pa-1]):Math.max(ua,oa[pa-1])),ra=qa[pa],ua=oa[pa]),pa===qa.length-1&&sa.push(0===qa[pa]?Math.min(ua,oa[pa]):Math.max(ua,oa[pa]));
sa.sort((pa,xa)=>pa-xa)}else oa[0]>oa[1]&&(sa=[oa[1],oa[0]]);V.push(sa)}for(let ua=0,pa=0;ua<Z;ua++)for(la=ca+aa*ua,na=0;na<Y;na++,pa++)if(oa=ja-ea*na,qa=V[na],2===qa.length)la>=qa[0]&&la<=qa[1]&&(W.push([la,oa]),I[pa]=1);else if(2<qa.length){sa=!1;for(ra=0;ra<qa.length;ra+=2)if(la>=qa[ra]&&la<=qa[ra+1]){sa=!0;break}sa&&(W.push([la,oa]),I[pa]=1)}return{points:W,mask:I}}function r(I,V){const [W,Z]=V;for(V=0;V<I.length;V++){const Y=I[V][1];if(Y<W||Y>Z)I[V]=[NaN,NaN]}}function z(I,V){const W=H(I[0].spatialReference);
if(2>I.length||null==W)return I[0];V=V??q(I[0].spatialReference);I=I.filter(fa=>fa.width>V);if(1===I.length)return I[0];let {xmin:Z,xmax:Y,ymin:aa,ymax:ea}=I[0];for(let fa=1;fa<I.length;fa++){const ca=I[fa];Y=ca.xmax+W*fa;aa=Math.min(aa,ca.ymin);ea=Math.max(ea,ca.ymax)}return new J({xmin:Z,xmax:Y,ymin:aa,ymax:ea,spatialReference:I[0].spatialReference})}function y(I,V,W=null,Z=!0){var Y=I.spatialReference;if(Y.equals(V))return I;var aa=S(I);const ea=H(Y,!0);var fa=H(V);if(0===aa||null==ea||null==fa)return aa=
K(I,V,W,Z),null==ea&&null!=fa&&Math.abs(aa.width-fa)<q(V)&&R.isLoaded()&&(Y=c(Y),null!=Y&&Y.poleLocation===C.None&&I.width<(Y.bbox[2]-Y.bbox[0])/2)?F(I,V)||aa:aa;fa=I.clone().normalize();if(1===fa.length&&I.xmax<ea&&I.xmax-ea/2>q(Y)){const {xmin:ca,xmax:ja}=I;for(let la=0;la<=aa;la++)fa[la]=new J({xmin:0===la?ca:-ea/2,xmax:la===aa?ja-ea*la:ea/2,ymin:I.ymin,ymax:I.ymax,spatialReference:Y})}I=fa.map(ca=>K(ca,V,W,Z));return z(I.filter(w.isSome))}function F(I,V){const W=H(V);if(null==W)return null;let {xmin:Z,
ymin:Y,xmax:aa,ymax:ea}=I;var fa=I.spatialReference;I=new u({spatialReference:fa,rings:[[[Z,Y],[aa,Y],[aa,ea],[Z,ea],[Z,Y]]]});I=R.project(I,V);if(2!==I.rings.length||!I.rings[0].length||!I.rings[1].length)return null;({rings:I}=I);fa=q(fa);V=new J({spatialReference:V});for(let ca=0;2>ca;ca++){Z=aa=I[ca][0][0];Y=ea=I[ca][0][1];for(let ja=0;ja<I[ca].length;ja++)Z=Z>I[ca][ja][0]?I[ca][ja][0]:Z,aa=aa<I[ca][ja][0]?I[ca][ja][0]:aa,Y=Y>I[ca][ja][1]?I[ca][ja][1]:Y,ea=ea<I[ca][ja][1]?I[ca][ja][1]:ea;if(0===
ca)V.ymin=Y,V.ymax=ea,V.xmin=Z,V.xmax=aa;else if(V.ymin=Math.min(V.ymin,Y),V.ymax=Math.max(V.ymax,ea),Math.abs(aa-W/2)<fa)V.xmin=Z,V.xmax+=W;else if(Math.abs(Z+W/2)<fa)V.xmax=aa+W;else return null}return V}function K(I,V,W=null,Z=!0,Y=!0){const aa=I.spatialReference;if(aa.equals(V)||!V)return I;k(aa,V,W);const ea=R.project(I,V,W);if(Y&&V.isWebMercator&&ea&&(ea.ymax=Math.min(2.0037508342787E7,ea.ymax),ea.ymin=Math.max(-2.0037508342787E7,ea.ymin),ea.ymin>=ea.ymax))return null;if(!Z||!ea)return ea;var fa=
D(aa,!0);Z=D(V,!0);if(null==fa||null==Z)return ea;Y=q(aa,.001);const ca=q(aa,500);var ja=q(V,.001);if(Math.abs(ea.xmin-Z[0])<ja&&Math.abs(ea.xmax-Z[1])<ja){ja=Math.abs(I.xmin-fa[0]);fa=Math.abs(fa[1]-I.xmax);if(ja<Y&&fa>ca){ea.xmin=Z[0];var la=[];la.push(new p(I.xmax,I.ymin,aa));la.push(new p(I.xmax,(I.ymin+I.ymax)/2,aa));la.push(new p(I.xmax,I.ymax,aa));la=la.map(na=>t(na,V,W)).filter(na=>!isNaN(na?.x)).map(na=>na.x);ea.xmax=Math.max.apply(null,la)}fa<Y&&ja>ca&&(ea.xmax=Z[1],Z=[],Z.push(new p(I.xmin,
I.ymin,aa)),Z.push(new p(I.xmin,(I.ymin+I.ymax)/2,aa)),Z.push(new p(I.xmin,I.ymax,aa)),I=Z.map(na=>t(na,V,W)).filter(na=>!isNaN(na?.x)).map(na=>na.x),ea.xmin=Math.min.apply(null,I))}else I=q(V,.001),Math.abs(ea.xmin-Z[0])<I&&(ea.xmin=Z[0]),Math.abs(ea.xmax-Z[1])<I&&(ea.xmax=Z[1]);return ea}function H(I,V=!1){return I?I.isWebMercator?2*(V?2.0037508342787E7:2.0037508342788905E7):I.wkid&&I.isGeographic?360:2*N[I.wkid]||null:null}function D(I,V=!1){if(I.isGeographic)return[-180,180];I=H(I,V);return null!=
I?[-I/2,I/2]:null}function G(I,V,W,Z){I=(I-V)/W;0!==I-Math.floor(I)?I=Math.floor(I):Z&&--I;return I}function S(I,V=!1){var W=H(I.spatialReference);if(null==W)return 0;const Z=V?0:-(W/2),Y=q(I.spatialReference),aa=!V&&Math.abs(I.xmin+W/2)<Y?-W/2:I.xmin;I=G(!V&&Math.abs(I.xmax-W/2)<Y?W/2:I.xmax,Z,W,!0);W=G(aa,Z,W,!1);return I-W}function A(I){const {projectedExtent:V,srcBufferExtent:W,pixelSize:Z,datumTransformation:Y,rasterTransform:aa}=I;var ea=V.spatialReference;const fa=W.spatialReference;var ca=
k(ea,fa);const {xmin:ja,ymin:la,xmax:na,ymax:oa}=V,qa=H(fa),sa=null!=qa&&(I.hasWrapAround||"gcs-shift"===aa?.type);I=I.spacing||[32,32];var ra=I[0]*Z.x,ua=I[1]*Z.y;const pa=1===I[0],xa=Math.ceil((na-ja)/ra-.1/I[0])+(pa?0:1),va=Math.ceil((oa-la)/ua-.1/I[1])+(pa?0:1);ra=b({cols:xa,rows:va,xmin:ja,ymax:oa,xres:ra,yres:ua,inSR:ea,outSR:fa,datumTransformation:Y,preferPE:4>=I[0],usePixelCenter:pa});ua=[];let Aa,ba=0;const ia=pa?-1:NaN,{xmin:da,xmax:ka,ymax:ma,width:ha,height:ta}=W,wa=q(fa,500),ya=null!=
qa&&0<da&&ka>qa/2;var Ba=!1;ca&&(Ba=c(ea),Ba=null!=Ba&&0<Ba.poleLocation);for(ea=0;ea<xa;ea++){ca=[];for(let Ca=0;Ca<va;Ca++){var za=ra[ea*va+Ca];sa&&za[0]>ka&&za[0]>qa/2-wa?za[0]-=qa:sa&&0===ea&&0>za[0]&&ya&&!aa&&(za[0]+=qa);!za||isNaN(za[0])||isNaN(za[1])?(ua.push(ia),ua.push(ia),ca.push(null),ba++):(aa&&(za=aa.inverseTransform(new p({x:za[0],y:za[1],spatialReference:fa})),za=[za.x,za.y]),ca.push(za),0<ea&&sa&&Aa[Ca]&&za[0]<Aa[Ca][0]&&(za[0]+=qa,Ba&&za[0]>ka&&za[0]>qa&&(za[0]-=qa)),ua.push((za[0]-
da)/ha),ua.push((ma-za[1])/ta))}Aa=ca}return{offsets:ua,error:null,coefficients:null,outofBoundPointCount:ba,spacing:I,size:pa?[xa,va]:[xa-1,va-1]}}function B(I,V,W){const {cols:Z,rows:Y}=V;V=new Float32Array((Z-1)*(Y-1)*12);const aa=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),ea=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let oa=0;oa<Z-1;oa++){for(var fa=0;fa<Y-1;fa++){var ca=oa*Y*2+2*fa,ja=I[ca];const qa=I[ca+1];var la=I[ca+2],na=I[ca+3];ca+=2*Y;const sa=I[ca],ra=I[ca+1],ua=I[ca+2];ca=I[ca+3];let pa=
0,xa=12*(fa*(Z-1)+oa);for(let va=0;3>va;va++)V[xa++]=aa[pa++]*ja+aa[pa++]*la+aa[pa++]*ua;pa=0;for(la=0;3>la;la++)V[xa++]=aa[pa++]*qa+aa[pa++]*na+aa[pa++]*ca;pa=0;for(na=0;3>na;na++)V[xa++]=ea[pa++]*ja+ea[pa++]*sa+ea[pa++]*ua;pa=0;for(ja=0;3>ja;ja++)V[xa++]=ea[pa++]*qa+ea[pa++]*ra+ea[pa++]*ca}if(W)for(fa=0;fa<V.length;fa++)isNaN(V[fa])&&(V[fa]=-1)}return V}function Q(I,V){I=I.clone().normalize();return 1===I.length?I[0]:z(I,V)}function O(I,V){const {pixelSize:W,extent:Z}=I;I=n(Z,V,!1);const Y=Q(Z,
(W.x+W.y)/16);return y(Y,V,I)}var C;(function(I){I[I.None=0]="None";I[I.North=1]="North";I[I.South=2]="South";I[I.Both=3]="Both"})(C||={});const M=(I,V,W,Z=0)=>{if(1===W[0])return[0,0];var Y=1,aa=-1,ea=1,fa=-1;for(var ca=0;ca<I.length;ca+=2)isNaN(I[ca])||(Y=Y>I[ca]?I[ca]:Y,aa=aa>I[ca]?aa:I[ca],ea=ea>I[ca+1]?I[ca+1]:ea,fa=fa>I[ca+1]?fa:I[ca+1]);const {cols:ja,rows:la}=V;V=(aa-Y)/ja/W[0];W=(fa-ea)/la/W[1];Z*=2;ea=0;fa=!1;Y=[0,0];for(aa=0;aa<ja-3;aa++){for(ca=0;ca<la-3;ca++){var na=aa*la*2+2*ca;const oa=
Math.abs(((I[na]+I[na+4]+I[na+4*la]+I[na+4*la+4])/4-I[na+2*la+2])/V);na=Math.abs(((I[na+1]+I[na+5]+I[na+4*la+1]+I[na+4*la+5])/4-I[na+2*la+3])/W);oa+na>ea&&(ea=oa+na,Y=[oa,na]);if(Z&&ea>Z){fa=!0;break}}if(fa)break}return Y},N={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,
53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},U=new Map,X=new Map;m.computeProjectedScales=
function(I,V,W){var Z=W?.tileSize??512,Y=W?.alignGlobalDatasetWithAGOL??!0,aa=!!W?.limitToSrcResolution;const {extent:ea,spatialReference:fa,pixelSize:ca}=I;W=h(new p({x:ca.x,y:ca.y,spatialReference:fa}),V,ea);if(null==W)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ja=(W.x+W.y)/2,la=E.getMetersPerUnitForSR(V);var na=ja*la*96*39.37,oa=V.isGeographic?256/Z*2.958287637958547E8:256/Z*5.91657527591555E8,qa="vector-magdir"===I.dataType||"vector-uv"===I.dataType,
sa=O(I,V),ra=Math.min(Math.ceil(Math.log(Math.min(I.width,I.height)/32)/Math.LN2),Math.ceil(Math.log(oa/2/na)/Math.LN2));if(!qa&&Y&&(V.isGeographic||V.isWebMercator)&&(Y=H(V),qa=0<S(sa)||null!=Y&&sa.width>Y/4,!qa&&null!=Y)){qa=-1;if(3>ra)qa=2**ra*ja*Z;else if(I.storageInfo){const {maximumPyramidLevel:ua=0,pyramidScalingFactor:pa=2}=I.storageInfo;qa=pa**ua*ja*Z}Z=Math.ceil(Y/qa);qa=1===Z||2===Z&&Y/2-sa.xmax<qa}Z=na;I=Math.min(2,Math.max(1.414,I.storageInfo?.pyramidScalingFactor||2));if(qa)Z=oa,oa=
V.isGeographic?1.341104507446289E-6:.29858214164761665,ra=96*oa*la*39.37,V=h(new p({x:oa,y:oa,spatialReference:{wkid:V.isGeographic?4326:3857}}),fa,sa),V.x*=Z/ra,V.y*=Z/ra;else{V={x:ca.x,y:ca.y};for(sa=0;Z<.5005*oa&&sa<ra;)sa++,Z*=I,V.x*=I,V.y*=I;1.001>=Math.max(Z,oa)/Math.min(Z,oa)&&(Z=oa)}oa=[Z];sa=[{x:V.x,y:V.y}];for(na=Math.min(70.5310735,na)/1.001;Z>=na;)Z/=I,V.x/=I,V.y/=I,oa.push(Z),sa.push({x:V.x,y:V.y});if(aa){const ua=.001*ca.x;aa=sa.findIndex(pa=>pa.x>=ca.x-ua&&pa.x<=ca.x+ua);-1<aa?(sa.length=
aa+1,oa.length=aa+1):(aa=sa.findIndex(pa=>pa.x<=ca.x+ua),0<aa&&(sa.length=aa,oa.length=aa))}return{projectedPixelSize:W,scales:oa,srcResolutions:sa,isCustomTilingScheme:!qa}};m.defaultGridSpacing=32;m.defaultProjectionToleranceInPixels=4;m.getDefaultDatumTransformationForDataset=n;m.getProjectedGridPoints=b;m.getProjectionOffsetGrid=function(I){var V=I.isAdaptive&&null==I.spacing;let W=I.spacing||[32,32],Z=A(I);var Y={cols:Z.size[0]+1,rows:Z.size[1]+1};const aa=0<Z.outofBoundPointCount&&Z.outofBoundPointCount<
Z.offsets.length/2;let ea=Z.outofBoundPointCount===Z.offsets.length/2||V&&aa?[0,0]:M(Z.offsets,Y,W,4);const fa=(ea[0]+ea[1])/2;var ca=I.projectedExtent.spatialReference;const ja=I.srcBufferExtent.spatialReference;V&&(aa||4<fa)&&(g(ca,ja,I.datumTransformation)&&(ca.isGeographic||null!=c(ca)),W=[4,4],Z=A({...I,spacing:W}),Y={cols:Z.size[0]+1,rows:Z.size[1]+1},ea=M(Z.offsets,Y,W,4));Z.error=ea;1<W[0]&&(Z.coefficients=B(Z.offsets,Y,aa));!I.includeGCSGrid||ca.isGeographic||ca.isWebMercator||(ja.isGeographic?
Z.gcsGrid={offsets:Z.offsets,coefficients:Z.coefficients,spacing:W}:(V=c(ca),null==V||V.isEnvelope||(ca&&!ca.isGeographic&&(V=String(ca.wkid||ca.wkt2||ca.wkt),X.has(V)?ca=X.get(V):(ca=(ca.wkid?T.PeFactory.coordsys(ca.wkid):T.PeFactory.fromString(T.PeDefs.PE_TYPE_PROJCS,ca.wkt2||ca.wkt)).getGeogcs().getCode(),X.set(V,ca)),ca=new d({wkid:ca})),ca=y(I.projectedExtent,ca),{offsets:I}=A({...I,srcBufferExtent:ca,spacing:W}),Y=B(I,Y,aa),Z.gcsGrid={offsets:I,coefficients:Y,spacing:W})));return Z};m.getRasterDatasetAlignmentInfo=
function(I){const V=I.storageInfo.origin.x;var W=H(I.spatialReference,!0);if(null==W)return{originX:V,halfWorldWidth:null,pyramidsInfo:null};const Z=W/2,{nativePixelSize:Y,storageInfo:aa,extent:ea}=I,{maximumPyramidLevel:fa,blockWidth:ca,pyramidScalingFactor:ja}=aa;let la=Y.x;const na=[];I=null!=I.transform&&"gcs-shift"===I.transform.type;const oa=V+(I?0:Z);W=I?W-V:Z-V;for(let qa=0;qa<=fa;qa++){const sa=(ea.xmax-V)/la/ca,ra=W/la/ca;na.push({resolutionX:la,blockWidth:ca,datasetColumnCount:0===sa-Math.floor(sa)?
sa:Math.ceil(sa),worldColumnCountFromOrigin:0===ra-Math.floor(ra)?ra:Math.ceil(ra),leftMargin:Math.round(oa/la)%ca,rightPadding:(ca-Math.round(W/la)%ca)%ca,originColumnOffset:Math.floor(oa/la/ca)});la*=ja}return{originX:V,halfWorldWidth:Z,pyramidsInfo:na,hasGCSSShiftTransform:I}};m.getWorldWidth=H;m.getWorldWrapCount=S;m.load=async function(){R.isLoaded()||await R.load()};m.minimumGridSpacing=4;m.projectDatasetExtent=O;m.projectExtent=y;m.projectPoint=t;m.projectPolygon=function(I,V,W){if("extent"===
I.type){const {xmin:Z,ymin:Y,xmax:aa,ymax:ea,spatialReference:fa}=I;I=new u({rings:[[[Z,ea],[aa,ea],[aa,Y],[Z,Y],[Z,ea]]],spatialReference:fa})}if(I.spatialReference.equals(V))return I;k(I.spatialReference,V,W);return R.project(I,V,W)};m.projectResolution=h;m.requirePE=g;m.shiftExtent=function(I){var {spatialReference:V}=I;V=P.getInfo(V);if(!V)return I;const [W,Z]=V.valid;V=Z-W;let Y=0;I.xmin<W?Y=Math.ceil((W-I.xmin)/V):I.xmin>Z&&(Y=-Math.ceil((I.xmin-Z)/V));return new J({spatialReference:I.spatialReference,
xmin:I.xmin+Y*V,ymin:I.ymin,xmax:I.xmax+Y*V,ymax:I.ymax})};m.snapExtent=Q;m.snapPyramid=function(I,V,W){const {storageInfo:Z,pixelSize:Y}=V;var aa=0;let ea=!1;var {pyramidResolutions:fa}=Z,ca="mixed"===Z.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,Z.tileInfo.dpi/96)):1;ca=(I.x+I.y)/2/ca;if(null!=fa&&fa.length){I=fa[fa.length-1];I=(I.x+I.y)/2;var ja=(Y.x+Y.y)/2;if(ca<=ja)aa=0;else if(ca>=I)aa=fa.length,ea=8<ca/I;else{I=ja;for(let la=1;la<=fa.length;la++){ja=(fa[la-1].x+fa[la-1].y)/2;if(ca<=
ja){ca===ja?aa=la:"down"===W?(aa=la-1,ea=8<ca/I):aa="up"===W?la:ca-I>ja-ca||2<ca/I?la:la-1;break}I=ja}}W=0===aa?Y:fa[aa-1];ea&&(fa=Math.min(W.x,W.y),ca=E.getMetersPerUnitForSR(V.spatialReference),19567<fa*ca&&(ea=!1));return{pyramidLevel:aa,pyramidResolution:new p({x:W.x,y:W.y,spatialReference:V.spatialReference}),excessiveReading:ea}}aa=Math.log(I.x/Y.x)/Math.LN2;ca=Math.log(I.y/Y.y)/Math.LN2;fa=V.storageInfo.maximumPyramidLevel||0;aa="down"===W?Math.floor(Math.min(aa,ca)):"up"===W?Math.ceil(Math.max(aa,
ca)):Math.round((aa+ca)/2);0>aa?aa=0:aa>fa&&(ea=aa>fa+3,aa=fa);W=2**aa;V=new p({x:W*V.nativePixelSize.x,y:W*V.nativePixelSize.y,spatialReference:V.spatialReference});return{pyramidLevel:aa,pyramidResolution:V,excessiveReading:ea}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("exports ../../../core/Error ../../../core/maybe ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc ./Lzw ./pixelRangeUtils ../../../chunks/Zlib ./Raw ./TiffDecoder ./utils".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g){async function k(y,F){if(!g.isPlatformLittleEndian)throw new v("rasterCoded:decode","lerc decoder is not supported on big endian platform");await R.load();const {offset:K}=F,{width:H,height:D,pixelType:G,statistics:S,depthCount:A,noDataValues:B,bandMasks:Q,pixels:O,mask:C}=R.decode(y,{inputOffset:K,returnInterleaved:F.returnInterleaved});y=new L({width:H,height:D,pixelType:G.toLowerCase(),pixels:O,mask:C,statistics:S,bandMasks:Q,depthCount:A,noDataValues:B});S?.length||
y.updateStatistics();return y}async function n(y,F){y=await d.decode(y,{...F,noDataValue:null});w.assertIsSome(y);y=new L({width:y.width,height:y.height,pixels:y.pixels,pixelType:y.pixelType.toLowerCase(),mask:y.mask,bandMasks:y.bandMasks,statistics:null});y.updateStatistics();return y}async function h(y,F){y=await d.decodeTileOrStrip(y,F.customOptions);y=new L({width:y.width,height:y.height,pixels:y.pixels,pixelType:y.pixelType.toLowerCase(),mask:y.mask,statistics:null});y.updateStatistics();return y}
function q(y,F){const K=F.pixelType||"u8",H=L.getPixelArrayConstructor(K),D="u8"===K?y:new H(y.buffer),G=[],S=F.planes||1;if(1===S)G.push(D);else for(let A=0;A<S;A++){const B=(F.width||1)*(F.height||y.length),Q=new H(B);for(let O=0;O<B;O++)Q[O]=D[O*S+A];G.push(Q)}y=new L({width:F.width||1,height:F.height||y.length,pixels:G,pixelType:K,statistics:null});y.updateStatistics();return y}function t(y,F){y=(new p.Zlib(new Uint8Array(y))).getBytes();return q(y,F)}function x(y,F){y=P.decode(y,F.offset,F.eof,
!F.isInputBigEndian);return q(y,F)}function b(y,F){y=T.decode(y,F.hasNoZlibMask??void 0);y=new L({width:y.width,height:y.height,pixels:y.pixels,pixelType:"U8",mask:y.mask,statistics:null});y.updateStatistics();return y}function e(y,F){y=new Uint8Array(y);y=new r(y);const {width:K,height:H}=F;F=K*H;y=y.decode();let D=0;var G=0;let S;G=new Uint8Array(F);for(D=0;D<F;D++)G[D]=y[4*D+3];const A=new L({width:K,height:H,pixels:[],pixelType:"U8",mask:G,statistics:[]});for(D=0;3>D;D++){S=new Uint8Array(F);
for(G=0;G<F;G++)S[G]=y[4*G+D];A.addData({pixels:S})}A.updateStatistics();return A}async function a(y,F,K,H){y=await (new E).decode(y,{applyJpegMask:!1,format:F,...K},H);y=new L(y);y.updateStatistics();return y}function c(y){if(null==y)throw new v("rasterCodec:decode","parameter encodeddata is required.");y=new Uint8Array(y,0,10);let F="";255===y[0]&&216===y[1]?F="jpg":137===y[0]&&80===y[1]&&78===y[2]&&71===y[3]?F="png":67===y[0]&&110===y[1]&&116===y[2]&&90===y[3]&&73===y[4]&&109===y[5]&&97===y[6]&&
103===y[7]&&101===y[8]&&32===y[9]?F="lerc":76===y[0]&&101===y[1]&&114===y[2]&&99===y[3]&&50===y[4]&&32===y[5]?F="lerc2":73===y[0]&&73===y[1]&&42===y[2]&&0===y[3]||77===y[0]&&77===y[1]&&0===y[2]&&42===y[3]||73===y[0]&&73===y[1]&&43===y[2]&&0===y[3]||77===y[0]&&77===y[1]&&0===y[2]&&43===y[3]?F="tiff":71===y[0]&&73===y[1]&&70===y[2]?F="gif":66===y[0]&&77===y[1]?F="bmp":String.fromCharCode.apply(null,y).toLowerCase().includes("error")&&(F="error");return F}function f(y){let F=null;switch(y){case "lerc":case "lerc2":F=
k;break;case "jpg":F=b;break;case "png":F=e;break;case "bsq":case "bip":F=(K,H)=>{var D=H.pixelType,G=null;let S=null;switch(D?D.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":S=255;G=Uint8Array;break;case "u16":S=S||65535;G=Uint16Array;break;case "u32":S=S||2**32-1;G=Uint32Array;break;case "s8":S=S||-128;G=Int8Array;break;case "s16":S=S||-32768;G=Int16Array;break;case "s32":S=S||-(2**31);G=Int32Array;break;default:G=Float32Array}({pixelTypeCtor:D}={pixelTypeCtor:G,noDataValue:S});G=
u.decode;K=G(K,{width:H.width,height:H.height,pixelType:D,format:y});H=new L({width:H.width,height:H.height,pixels:K.pixels,pixelType:H.pixelType,mask:K.mask,statistics:null});H.updateStatistics();return H};break;case "tiff":F=n;break;case "deflate":F=t;break;case "lzw":F=x;break;case "error":F=()=>{throw new v("rasterCodec:decode","input data contains error");};break;default:F=()=>{throw new v("rasterCodec:decode","unsupported raster format");}}return F}function l(y,F=1){if(y){var {pixels:K,width:H,
height:D,mask:G}=y;if(K&&0!==K.length){var S=K.length,A=H-1,B=D-1,Q=[],O,C,M=null,N=L.getPixelArrayConstructor(y.pixelType);if(0===F){for(F=0;F<S;F++){var U=K[F];var X=new N(A*B);for(O=0;O<B;O++){var I=O*H;for(C=0;C<A;C++)X[O*A+C]=U[I+C]}Q.push(X)}if(null!=G)for(M=new Uint8Array(A*B),O=0;O<B;O++)for(I=O*H,C=0;C<A;C++)M[O*A+C]=G[I+C]}else{for(F=0;F<S;F++){U=K[F];X=new N(A*B);for(O=0;O<B;O++)for(I=O*H,C=0;C<A;C++)X[O*A+C]=(U[I+C]+U[I+C+1]+U[I+H+C]+U[I+H+C+1])/4;Q.push(X)}if(G)for(M=new Uint8Array(A*
B),O=0;O<B;O++)for(I=O*H,C=0;C<A;C++)M[O*A+C]=Math.min.apply(null,[G[I+C],G[I+C+1],G[I+H+C],G[I+H+C+1]])}y.width=A;y.height=B;y.mask=M;y.pixels=Q}}}var r=function(y){function F(G){var S,A;this.data=G;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(A=null;;){var B=this.readUInt32();var Q=G=void 0;G=[];for(Q=0;4>Q;++Q)G.push(String.fromCharCode(this.data[this.pos++]));G=G.join("");switch(G){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();
this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(B);break;case "fcTL":A&&this.animation.frames.push(A);this.pos+=4;A={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};
G=this.readUInt16();B=this.readUInt16()||100;A.delay=1E3*G/B;A.disposeOp=this.data[this.pos++];A.blendOp=this.data[this.pos++];A.data=[];break;case "IDAT":case "fdAT":"fdAT"===G&&(this.pos+=4,B-=4);G=(null!=A?A.data:void 0)||this.imgData;for(Q=0;0<=B?Q<B:Q>B;0<=B?++Q:--Q)G.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(B);B=255-this.transparency.indexed.length;if(0<B)for(G=0;0<=B?G<B:G>B;0<=B?++G:--G)this.transparency.indexed.push(255);
break;case 0:this.transparency.grayscale=this.read(B)[0];break;case 2:this.transparency.rgb=this.read(B)}break;case "tEXt":Q=this.read(B);B=Q.indexOf(0);G=String.fromCharCode.apply(String,Q.slice(0,B));this.text[G]=String.fromCharCode.apply(String,Q.slice(B+1));break;case "IEND":A&&this.animation.frames.push(A);a:{switch(this.colorType){case 0:case 3:case 4:A=1;break a;case 2:case 6:A=3;break a}A=void 0}this.colors=A;this.hasAlphaChannel=4===(S=this.colorType)||6===S;S=this.colors+(this.hasAlphaChannel?
1:0);this.pixelBitlength=this.bits*S;a:{switch(this.colors){case 1:S="DeviceGray";break a;case 3:S="DeviceRGB";break a}S=void 0}this.colorSpace=S;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=B}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}var K;F.load=function(G,S,A){"function"===typeof S&&(A=S);var B=new XMLHttpRequest;B.open("GET",G,!0);B.responseType="arraybuffer";B.onload=function(){var Q=new Uint8Array(B.response||B.mozResponseArrayBuffer);
Q=new F(Q);"function"===typeof(null!=S?S.getContext:void 0)&&Q.render(S);return"function"===typeof A?A(Q):void 0};return B.send(null)};F.prototype.read=function(G){var S;var A=[];for(S=0;0<=G?S<G:S>G;0<=G?++S:--S)A.push(this.data[this.pos++]);return A};F.prototype.readUInt32=function(){var G=this.data[this.pos++]<<24;var S=this.data[this.pos++]<<16;var A=this.data[this.pos++]<<8;var B=this.data[this.pos++];return G|S|A|B};F.prototype.readUInt16=function(){var G=this.data[this.pos++]<<8;var S=this.data[this.pos++];
return G|S};F.prototype.decodePixels=function(G){var S,A,B,Q,O,C,M,N;null==G&&(G=this.imgData);if(0===G.length)return new Uint8Array(0);G=new p.Zlib(G);G=G.getBytes();var U=this.pixelBitlength/8;var X=U*this.width;var I=new Uint8Array(X*this.height);var V=G.length;for(A=Q=O=0;Q<V;){switch(G[Q++]){case 0:for(B=S=0;S<X;B=S+=1)I[A++]=G[Q++];break;case 1:for(B=C=0;C<X;B=C+=1){S=G[Q++];var W=B<U?0:I[A-U];I[A++]=(S+W)%256}break;case 2:for(B=W=0;W<X;B=W+=1){S=G[Q++];var Z=(B-B%U)/U;C=O&&I[(O-1)*X+Z*U+B%
U];I[A++]=(C+S)%256}break;case 3:for(B=N=0;N<X;B=N+=1)S=G[Q++],Z=(B-B%U)/U,W=B<U?0:I[A-U],C=O&&I[(O-1)*X+Z*U+B%U],I[A++]=(S+Math.floor((W+C)/2))%256;break;case 4:for(B=N=0;N<X;B=N+=1){S=G[Q++];Z=(B-B%U)/U;W=B<U?0:I[A-U];0===O?C=M=0:(C=I[(O-1)*X+Z*U+B%U],M=Z&&I[(O-1)*X+(Z-1)*U+B%U]);var Y=W+C-M;B=Math.abs(Y-W);Z=Math.abs(Y-C);Y=Math.abs(Y-M);W=B<=Z&&B<=Y?W:Z<=Y?C:M;I[A++]=(S+W)%256}break;default:throw Error("Invalid filter algorithm: "+G[Q-1]);}O++}return I};F.prototype.decodePalette=function(){var G,
S,A,B;var Q=this.palette;var O=this.transparency.indexed||[];var C=new Uint8Array((O.length||0)+Q.length);var M=0;Q.length;var N=S=G=0;for(A=Q.length;S<A;N=S+=3)C[M++]=Q[N],C[M++]=Q[N+1],C[M++]=Q[N+2],C[M++]=null!=(B=O[G++])?B:255;return C};F.prototype.copyToImageData=function(G,S){var A,B;var Q=this.colors;var O=null;var C=this.hasAlphaChannel;this.palette.length&&(O=null!=(A=this._decodedPalette)?A:this._decodedPalette=this.decodePalette(),Q=4,C=!0);G=G.data||G;var M=G.length;var N=O||S;A=B=0;if(1===
Q)for(;A<M;)Q=O?4*S[A/4]:B,B=N[Q++],G[A++]=B,G[A++]=B,G[A++]=B,G[A++]=C?N[Q++]:this.transparency.grayscale&&this.transparency.grayscale===B?0:255,B=Q;else for(;A<M;)Q=O?4*S[A/4]:B,G[A++]=N[Q++],G[A++]=N[Q++],G[A++]=N[Q++],G[A++]=C?N[Q++]:this.transparency.rgb&&this.transparency.rgb[1]===N[Q-3]&&this.transparency.rgb[3]===N[Q-2]&&this.transparency.rgb[5]===N[Q-1]?0:255,B=Q};F.prototype.decode=function(){var G=new Uint8Array(this.width*this.height*4);this.copyToImageData(G,this.decodePixels());return G};
var H=(K=y.document&&y.document.createElement("canvas"))&&K.getContext("2d");var D=function(G){H.width=G.width;H.height=G.height;H.clearRect(0,0,G.width,G.height);H.putImageData(G,0,0);G=new Image;G.src=K.toDataURL();return G};F.prototype.decodeFrames=function(G){var S,A;if(this.animation){var B=this.animation.frames;var Q=[];var O=S=0;for(A=B.length;S<A;O=++S){O=B[O];var C=G.createImageData(O.width,O.height);var M=this.decodePixels(new Uint8Array(O.data));this.copyToImageData(C,M);O.imageData=C;
Q.push(O.image=D(C))}return Q}};F.prototype.renderFrame=function(G,S){var A=this.animation.frames;var B=A[S];A=A[S-1];0===S&&G.clearRect(0,0,this.width,this.height);1===(null!=A?A.disposeOp:void 0)?G.clearRect(A.xOffset,A.yOffset,A.width,A.height):2===(null!=A?A.disposeOp:void 0)&&G.putImageData(A.imageData,A.xOffset,A.yOffset);0===B.blendOp&&G.clearRect(B.xOffset,B.yOffset,B.width,B.height);return G.drawImage(B.image,B.xOffset,B.yOffset)};F.prototype.animate=function(G){var S,A=this;var B=0;var Q=
this.animation;var O=Q.numFrames;var C=Q.frames;var M=Q.numPlays;return(S=function(){var N=B++%O;var U=C[N];A.renderFrame(G,N);if(1<O&&B/O<M)return A.animation._timeout=setTimeout(S,U.delay)})()};F.prototype.stopAnimation=function(){var G;return clearTimeout(null!=(G=this.animation)?G._timeout:void 0)};F.prototype.render=function(G){G._png&&G._png.stopAnimation();G._png=this;G.width=this.width;G.height=this.height;G=G.getContext("2d");if(this.animation)return this.decodeFrames(G),this.animate(G);
var S=G.createImageData(this.width,this.height);this.copyToImageData(S,this.decodePixels());return G.putImageData(S,0,0)};return F}(self);const z=new Set(["jpg","png","bmp","gif"]);m.decode=async function(y,F={},K){if(null==y)throw new v("rasterCodec:decode","missing encodeddata parameter.");let H=F.format?.toLowerCase();if(!("bsq"!==H&&"bip"!==H||null!=F.width&&null!=F.height))throw new v("rasterCodec:decode","requires width and height in options parameter.");if("tiff"===H&&F.customOptions)return h(y,
F);if(!H||"bsq"!==H&&"bip"!==H&&"deflate"!==H&&"lzw"!==H)H=c(y);if(F.useCanvas&&z.has(H))return a(y,H,F,K);const D=f(H);F.isPoint&&(F={...F},null!=F.width&&F.width++,null!=F.height&&F.height++);let G;const {offsets:S}=F;if(S&&1<S.length){K=S.map((B,Q)=>D(y.slice(B,S[Q+1]),F));K=await Promise.all(K);G=K[0];G.pixels=K.map(B=>B.pixels[0]);const A=K.map(B=>B.mask);K.some(B=>null!=B)&&(A.forEach((B,Q)=>{null==B&&(A[Q]=(new Uint8Array(G.width*G.height)).fill(255))}),G.bandMasks=A,G.mask=L.combineBandMasks(A));
G.updateStatistics()}else G=await D(y,{...F,offset:S?.[0]??F.offset});"jpg"!==H&&null!=F.noDataValue&&1===G.depthCount&&J.convertNoDataToMask(G,F.noDataValue,{customFloatTolerance:F.tolerance});F.isPoint&&l(G);return G};m.getFormat=function(y){y=c(y);"lerc2"===y?y="lerc":"error"===y&&(y="");return y};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define(["../../../core/Error","../../../core/promiseUtils","../../../chunks/Zlib"],
function(m,v,w){class L{constructor(E){this._ctx=this._canvas=null;E&&(this._canvas=E.canvas,this._ctx=E.ctx||E.canvas&&E.canvas.getContext("2d"))}decode(E,T,R){if(!E||10>E.byteLength)throw new m("imagecanvasdecoder: decode","required a valid encoded data as input.");let {width:P=0,height:J=0,format:p}=T;const {applyJpegMask:u}=T;if(u&&(!P||!J))throw new m("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((d,g)=>{let k=null;
"jpg"===p&&u&&(k=L._getMask(E,{width:P,height:J}));const n=new Blob([new Uint8Array(E)],{type:"jpg"==="image/"+p?"jpeg":p}),h=URL.createObjectURL(n),q=new Image;let t;q.src=h;q.onload=()=>{URL.revokeObjectURL(h);if(v.isAborted(R))g(v.createAbortError());else{P=q.width;J=q.height;if(this._canvas&&this._ctx){if(this._canvas.width!==P||this._canvas.height!==J)this._canvas.width=P,this._canvas.height=J;this._ctx.clearRect(0,0,P,J)}else this._canvas=document.createElement("canvas"),this._canvas.width=
P,this._canvas.height=J,this._ctx=this._canvas.getContext("2d");this._ctx.drawImage(q,0,0);var x=this._ctx.getImageData(0,0,P,J);t=x.data;var b;if(T.renderOnCanvas){if(k)for(b=0;b<k.length;b++)t[4*b+3]=k[b]?255:0;this._ctx.putImageData(x,0,0);d(null)}else{x=P*J;var e=new Uint8Array(x),a=new Uint8Array(x),c=new Uint8Array(x);if(k)for(b=0;b<x;b++)e[b]=t[4*b],a[b]=t[4*b+1],c[b]=t[4*b+2];else for(k=new Uint8Array(x),b=0;b<x;b++)e[b]=t[4*b],a[b]=t[4*b+1],c[b]=t[4*b+2],k[b]=t[4*b+3];d({width:P,height:J,
pixels:[e,a,c],mask:k,pixelType:"u8"})}}};q.onerror=()=>{URL.revokeObjectURL(h);g("cannot load image")}})}static _getMask(E,T){let R=null;try{var P=new Uint8Array(E);E=0;var J=P.length-2;for(E=Math.ceil(P.length/2);E<J&&(255!==P[E]||217!==P[E+1]);E++);E+=2;if(E<P.length-1){const p=(new w.Zlib(P.subarray(E))).getBytes();R=new Uint8Array(T.width*T.height);T=0;for(P=0;P<p.length;P++)for(J=7;0<=J;J--)R[T++]=p[P]>>J&1}}catch(p){}return R}}return L})},"esri/chunks/Zlib":function(){define(["exports","./_commonjsHelpers"],
function(m,v){var w={exports:{}};(function(L){(function(E){E=E();void 0!==E&&(L.exports=E)})(function(){var E=function(){function T(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}T.prototype={ensureBuffer:function(R){var P=this.buffer,J=P?P.byteLength:0;if(R<J)return P;for(var p=512;p<R;)p<<=1;R=new Uint8Array(p);for(p=0;p<J;++p)R[p]=P[p];return this.buffer=R},getByte:function(){for(var R=this.pos;this.bufferLength<=R;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},
getBytes:function(R){var P=this.pos;if(R){this.ensureBuffer(P+R);for(R=P+R;!this.eof&&this.bufferLength<R;)this.readBlock();var J=this.bufferLength;R>J&&(R=J)}else{for(;!this.eof;)this.readBlock();R=this.bufferLength}this.pos=R;return this.buffer.subarray(P,R)},lookChar:function(){for(var R=this.pos;this.bufferLength<=R;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var R=this.pos;this.bufferLength<=R;){if(this.eof)return null;
this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(R,P,J){for(var p=R+P;this.bufferLength<=p&&!this.eof;)this.readBlock();return new Stream(this.buffer,R,P,J)},skip:function(R){R||=1;this.pos+=R},reset:function(){this.pos=0}};return T}();return function(){function T(g){throw Error(g);}function R(g){var k=0,n=g[k++],h=g[k++];-1!=n&&-1!=h||T("Invalid header in flate stream");8!=(n&15)&&T("Unknown compression method in flate stream");0!=((n<<8)+h)%31&&T("Bad FCHECK in flate stream");
h&32&&T("FDICT bit set in flate stream");this.bytes=g;this.bytesPos=k;this.codeBuf=this.codeSize=0;E.call(this)}if(!self||!self.Uint32Array)return null;var P=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),p=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,
393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),u=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,
524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,
524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,
524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,
524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,
524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,
524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,
524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],d=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];R.prototype=Object.create(E.prototype);R.prototype.getBits=function(g){for(var k=
this.codeSize,n=this.codeBuf,h=this.bytes,q=this.bytesPos,t;k<g;)"undefined"==typeof(t=h[q++])&&T("Bad encoding in flate stream"),n|=t<<k,k+=8;this.codeBuf=n>>g;this.codeSize=k-=g;this.bytesPos=q;return n&(1<<g)-1};R.prototype.getCode=function(g){var k=g[0],n=g[1];g=this.codeSize;for(var h=this.codeBuf,q=this.bytes,t=this.bytesPos;g<n;){var x;"undefined"==typeof(x=q[t++])&&T("Bad encoding in flate stream");h|=x<<g;g+=8}n=k[h&(1<<n)-1];k=n>>16;n&=65535;(0==g||g<k||0==k)&&T("Bad encoding in flate stream");
this.codeBuf=h>>k;this.codeSize=g-k;this.bytesPos=t;return n};R.prototype.generateHuffmanTable=function(g){for(var k=g.length,n=0,h=0;h<k;++h)g[h]>n&&(n=g[h]);for(var q=1<<n,t=new Uint32Array(q),x=1,b=0,e=2;x<=n;++x,b<<=1,e<<=1)for(var a=0;a<k;++a)if(g[a]==x){var c=0,f=b;for(h=0;h<x;++h)c=c<<1|f&1,f>>=1;for(h=c;h<q;h+=e)t[h]=x<<16|a;++b}return[t,n]};R.prototype.readBlock=function(){function g(c,f,l,r,z){for(c=c.getBits(l)+r;0<c--;)f[b++]=z}var k=this.getBits(3);k&1&&(this.eof=!0);k>>=1;if(0==k){var n=
this.bytes,h=this.bytesPos,q;"undefined"==typeof(q=n[h++])&&T("Bad block header in flate stream");var t=q;"undefined"==typeof(q=n[h++])&&T("Bad block header in flate stream");t|=q<<8;"undefined"==typeof(q=n[h++])&&T("Bad block header in flate stream");k=q;"undefined"==typeof(q=n[h++])&&T("Bad block header in flate stream");(k|q<<8)!=(~t&65535)&&T("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;q=this.bufferLength;k=this.ensureBuffer(q+t);this.bufferLength=t=q+t;for(var x=
q;x<t;++x){if("undefined"==typeof(q=n[h++])){this.eof=!0;break}k[x]=q}this.bytesPos=h}else{if(1==k)h=u,q=d;else if(2==k){k=this.getBits(5)+257;q=this.getBits(5)+1;n=this.getBits(4)+4;h=Array(P.length);for(var b=0;b<n;)h[P[b++]]=this.getBits(3);h=this.generateHuffmanTable(h);b=n=0;q=k+q;for(t=Array(q);b<q;)x=this.getCode(h),16==x?g(this,t,2,3,n):17==x?g(this,t,3,3,n=0):18==x?g(this,t,7,11,n=0):t[b++]=n=x;h=this.generateHuffmanTable(t.slice(0,k));q=this.generateHuffmanTable(t.slice(k,q))}else T("Unknown block type in flate stream");
t=(k=this.buffer)?k.length:0;for(x=this.bufferLength;;){var e=this.getCode(h);if(256>e)x+1>=t&&(k=this.ensureBuffer(x+1),t=k.length),k[x++]=e;else{if(256==e){this.bufferLength=x;break}e-=257;e=J[e];var a=e>>16;0<a&&(a=this.getBits(a));n=(e&65535)+a;e=this.getCode(q);e=p[e];a=e>>16;0<a&&(a=this.getBits(a));e=(e&65535)+a;x+n>=t&&(k=this.ensureBuffer(x+n),t=k.length);for(a=0;a<n;++a,++x)k[x]=k[x-e]}}}};return R}()})})(w);v=v.getDefaultExportFromCjs(w.exports);m.Zlib=v})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["../../../chunks/Jpg",
"../../../chunks/Zlib"],function(m,v){class w{static decode(L,E=!1){const T=new Uint8Array(L);L=new m.JpegImage;L.parse(T);const {width:R,height:P,numComponents:J,eof:p}=L,u=L.getData(R,P,!0),d=R*P;L=null;let g=0,k=0,n=0;if(!E&&p<T.length-1)try{var h=(new v.Zlib(T.subarray(p))).getBytes();L=new Uint8Array(d);for(g=E=0;g<h.length;g++)for(n=7;0<=n;n--)L[E++]=h[g]>>n&1}catch{}if(1===J&&u.length===R*P)h=new Uint8Array(u.buffer),h=[h,h,h];else{h=[];for(g=0;3>g;g++)h.push(new Uint8Array(d));for(k=n=0;k<
d;k++)for(g=0;3>g;g++)h[g][k]=u[n++]}return{width:R,height:P,pixels:h,mask:L}}}return w})},"esri/chunks/Jpg":function(){define(["exports","./_commonjsHelpers"],function(m,v){var w={exports:{}};(function(L){(function(E){E=E();void 0!==E&&(L.exports=E)})(function(){var E=function(){function T(R){this.message="JPEG error: "+R}T.prototype=Error();T.prototype.name="JpegError";return T.constructor=T}();return function(){function T(){this.decodeTransform=null;this.colorTransform=-1}function R(d,g){for(var k=
0,n=[],h,q,t=16;0<t&&!d[t-1];)t--;n.push({children:[],index:0});var x=n[0],b;for(h=0;h<t;h++){for(q=0;q<d[h];q++){x=n.pop();for(x.children[x.index]=g[k];0<x.index;)x=n.pop();x.index++;for(n.push(x);n.length<=h;)n.push(b={children:[],index:0}),x.children[x.index]=b.children,x=b;k++}h+1<t&&(n.push(b={children:[],index:0}),x.children[x.index]=b.children,x=b)}return n[0].children}function P(d,g,k,n,h,q,t,x,b){function e(){if(0<G)return G--,D>>G&1;D=d[g++];if(255===D){var Z=d[g++];if(Z)throw new E("unexpected marker "+
(D<<8|Z).toString(16));}G=7;return D>>>7}function a(Z){for(;;){Z=Z[e()];if("number"===typeof Z)return Z;if("object"!==typeof Z)throw new E("invalid huffman sequence");}}function c(Z){for(var Y=0;0<Z;)Y=Y<<1|e(),Z--;return Y}function f(Z){if(1===Z)return 1===e()?1:-1;var Y=c(Z);return Y>=1<<Z-1?Y:Y+(-1<<Z)+1}function l(Z,Y){var aa=a(Z.huffmanTableDC);aa=0===aa?0:f(aa);Z.blockData[Y]=Z.pred+=aa;for(aa=1;64>aa;){var ea=a(Z.huffmanTableAC),fa=ea&15;ea>>=4;if(0===fa){if(15>ea)break;aa+=16}else aa+=ea,
Z.blockData[Y+u[aa]]=f(fa),aa++}}function r(Z,Y){var aa=a(Z.huffmanTableDC);aa=0===aa?0:f(aa)<<b;Z.blockData[Y]=Z.pred+=aa}function z(Z,Y){Z.blockData[Y]|=e()<<b}function y(Z,Y){if(0<S)S--;else for(var aa=q;aa<=t;){var ea=a(Z.huffmanTableAC),fa=ea&15;ea>>=4;if(0===fa){if(15>ea){S=c(ea)+(1<<ea)-1;break}aa+=16}else aa+=ea,Z.blockData[Y+u[aa]]=f(fa)*(1<<b),aa++}}function F(Z,Y){for(var aa=q,ea=0,fa;aa<=t;){fa=u[aa];switch(A){case 0:ea=a(Z.huffmanTableAC);fa=ea&15;ea>>=4;if(0===fa)15>ea?(S=c(ea)+(1<<
ea),A=4):(ea=16,A=1);else{if(1!==fa)throw new E("invalid ACn encoding");B=f(fa);A=ea?2:3}continue;case 1:case 2:Z.blockData[Y+fa]?Z.blockData[Y+fa]+=e()<<b:(ea--,0===ea&&(A=2===A?3:0));break;case 3:Z.blockData[Y+fa]?Z.blockData[Y+fa]+=e()<<b:(Z.blockData[Y+fa]=B<<b,A=0);break;case 4:Z.blockData[Y+fa]&&(Z.blockData[Y+fa]+=e()<<b)}aa++}4===A&&(S--,0===S&&(A=0))}var K=k.mcusPerLine,H=g,D=0,G=0,S=0,A=0,B,Q=n.length,O,C,M,N;x=k.progressive?0===q?0===x?r:z:0===x?y:F:l;var U=0;k=1===Q?n[0].blocksPerLine*
n[0].blocksPerColumn:K*k.mcusPerColumn;for(var X,I;U<k;){var V=h?Math.min(k-U,h):k;for(O=0;O<Q;O++)n[O].pred=0;S=0;if(1===Q){var W=n[0];for(N=0;N<V;N++)x(W,64*((W.blocksPerLine+1)*(U/W.blocksPerLine|0)+U%W.blocksPerLine)),U++}else for(N=0;N<V;N++){for(O=0;O<Q;O++)for(W=n[O],X=W.h,I=W.v,C=0;C<I;C++)for(M=0;M<X;M++)x(W,64*((W.blocksPerLine+1)*((U/K|0)*W.v+C)+(U%K*W.h+M)));U++}G=0;(W=p(d,g))&&W.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+W.invalid),g=W.offset);W=W&&W.marker;
if(!W||65280>=W)throw new E("marker was not found");if(65488<=W&&65495>=W)g+=2;else break}(W=p(d,g))&&W.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+W.invalid),g=W.offset);return g-H}function J(d,g){d=g.blocksPerLine;for(var k=g.blocksPerColumn,n=new Int16Array(64),h=0;h<k;h++)for(var q=0;q<d;q++){var t=void 0,x=void 0,b=void 0,e=void 0,a=void 0,c=void 0,f=void 0,l=void 0,r=a=c=e=x=t=void 0,z=void 0,y=void 0,F=void 0,K=64*((g.blocksPerLine+1)*h+q),H=n,D=g.quantizationTable,
G=g.blockData;if(!D)throw new E("missing required Quantization Table.");for(var S=0;64>S;S+=8)t=G[K+S],l=G[K+S+1],f=G[K+S+2],c=G[K+S+3],a=G[K+S+4],e=G[K+S+5],b=G[K+S+6],x=G[K+S+7],t*=D[S],0===(l|f|c|a|e|b|x)?(t=5793*t+512>>10,H[S]=t,H[S+1]=t,H[S+2]=t,H[S+3]=t,H[S+4]=t,H[S+5]=t,H[S+6]=t,H[S+7]=t):(l*=D[S+1],f*=D[S+2],c*=D[S+3],a*=D[S+4],e*=D[S+5],b*=D[S+6],x*=D[S+7],F=5793*t+128>>8,y=5793*a+128>>8,z=f,r=b,a=2896*(l-x)+128>>8,x=2896*(l+x)+128>>8,c<<=4,e<<=4,F=F+y+1>>1,y=F-y,t=3784*z+1567*r+128>>8,z=
1567*z-3784*r+128>>8,r=t,a=a+e+1>>1,e=a-e,x=x+c+1>>1,c=x-c,F=F+r+1>>1,r=F-r,y=y+z+1>>1,z=y-z,t=2276*a+3406*x+2048>>12,a=3406*a-2276*x+2048>>12,x=t,t=799*c+4017*e+2048>>12,c=4017*c-799*e+2048>>12,e=t,H[S]=F+x,H[S+7]=F-x,H[S+1]=y+e,H[S+6]=y-e,H[S+2]=z+c,H[S+5]=z-c,H[S+3]=r+a,H[S+4]=r-a);for(D=0;8>D;++D)t=H[D],l=H[D+8],f=H[D+16],c=H[D+24],a=H[D+32],e=H[D+40],b=H[D+48],x=H[D+56],0===(l|f|c|a|e|b|x)?(t=5793*t+8192>>14,t=-2040>t?0:2024<=t?255:t+2056>>4,G[K+D]=t,G[K+D+8]=t,G[K+D+16]=t,G[K+D+24]=t,G[K+D+
32]=t,G[K+D+40]=t,G[K+D+48]=t,G[K+D+56]=t):(F=5793*t+2048>>12,y=5793*a+2048>>12,z=f,r=b,a=2896*(l-x)+2048>>12,x=2896*(l+x)+2048>>12,F=(F+y+1>>1)+4112,y=F-y,t=3784*z+1567*r+2048>>12,z=1567*z-3784*r+2048>>12,r=t,a=a+e+1>>1,e=a-e,x=x+c+1>>1,c=x-c,F=F+r+1>>1,r=F-r,y=y+z+1>>1,z=y-z,t=2276*a+3406*x+2048>>12,a=3406*a-2276*x+2048>>12,x=t,t=799*c+4017*e+2048>>12,c=4017*c-799*e+2048>>12,e=t,t=F+x,x=F-x,l=y+e,b=y-e,f=z+c,e=z-c,c=r+a,a=r-a,t=16>t?0:4080<=t?255:t>>4,l=16>l?0:4080<=l?255:l>>4,f=16>f?0:4080<=f?
255:f>>4,c=16>c?0:4080<=c?255:c>>4,a=16>a?0:4080<=a?255:a>>4,e=16>e?0:4080<=e?255:e>>4,b=16>b?0:4080<=b?255:b>>4,x=16>x?0:4080<=x?255:x>>4,G[K+D]=t,G[K+D+8]=l,G[K+D+16]=f,G[K+D+24]=c,G[K+D+32]=a,G[K+D+40]=e,G[K+D+48]=b,G[K+D+56]=x)}return g.blockData}function p(d,g,k){var n=d.length-1;k=k<g?k:g;if(g>=n)return null;var h=d[g]<<8|d[g+1];if(65472<=h&&65534>=h)return{invalid:null,marker:h,offset:g};for(g=d[k]<<8|d[k+1];!(65472<=g&&65534>=g);){if(++k>=n)return null;g=d[k]<<8|d[k+1]}return{invalid:h.toString(16),
marker:g,offset:k}}if(!self||!self.Uint8ClampedArray)return null;var u=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);T.prototype={parse:function(d){function g(){var D=d[h]<<8|d[h+1];h+=2;return D}function k(){var D=g();D=h+D-2;var G=p(d,D,h);G&&G.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+G.invalid),D=G.offset);D=
d.subarray(h,D);h+=D.length;return D}function n(D){for(var G=Math.ceil(D.samplesPerLine/8/D.maxH),S=Math.ceil(D.scanLines/8/D.maxV),A=0;A<D.components.length;A++){H=D.components[A];var B=Math.ceil(Math.ceil(D.samplesPerLine/8)*H.h/D.maxH),Q=Math.ceil(Math.ceil(D.scanLines/8)*H.v/D.maxV);H.blockData=new Int16Array(64*S*H.v*(G*H.h+1));H.blocksPerLine=B;H.blocksPerColumn=Q}D.mcusPerLine=G;D.mcusPerColumn=S}var h=0,q=null,t=null,x=[],b=[],e=[],a=g();if(65496!==a)throw new E("SOI not found");for(a=g();65497!==
a;){switch(a){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var c=k();65504===a&&74===c[0]&&70===c[1]&&73===c[2]&&70===c[3]&&0===c[4]&&(q={version:{major:c[5],minor:c[6]},densityUnits:c[7],xDensity:c[8]<<8|c[9],yDensity:c[10]<<8|c[11],thumbWidth:c[12],thumbHeight:c[13],thumbData:c.subarray(14,14+3*c[12]*c[13])});65518===a&&65===c[0]&&100===c[1]&&111===c[2]&&
98===c[3]&&101===c[4]&&(t={version:c[5]<<8|c[6],flags0:c[7]<<8|c[8],flags1:c[9]<<8|c[10],transformCode:c[11]});break;case 65499:a=g()+h-2;for(var f;h<a;){var l=d[h++],r=new Uint16Array(64);if(0===l>>4)for(c=0;64>c;c++)f=u[c],r[f]=d[h++];else if(1===l>>4)for(c=0;64>c;c++)f=u[c],r[f]=g();else throw new E("DQT - invalid table spec");x[l&15]=r}break;case 65472:case 65473:case 65474:if(z)throw new E("Only single frame JPEGs supported");g();var z={};z.extended=65473===a;z.progressive=65474===a;z.precision=
d[h++];z.scanLines=g();z.samplesPerLine=g();z.components=[];z.componentIds={};c=d[h++];for(a=r=l=0;a<c;a++){f=d[h];var y=d[h+1]>>4;var F=d[h+1]&15;l<y&&(l=y);r<F&&(r=F);y=z.components.push({h:y,v:F,quantizationId:d[h+2],quantizationTable:null});z.componentIds[f]=y-1;h+=3}z.maxH=l;z.maxV=r;n(z);break;case 65476:f=g();for(a=2;a<f;){l=d[h++];r=new Uint8Array(16);for(c=y=0;16>c;c++,h++)y+=r[c]=d[h];F=new Uint8Array(y);for(c=0;c<y;c++,h++)F[c]=d[h];a+=17+y;(0===l>>4?e:b)[l&15]=R(r,F)}break;case 65501:g();
var K=g();break;case 65498:g();f=d[h++];c=[];for(a=0;a<f;a++){l=z.componentIds[d[h++]];var H=z.components[l];l=d[h++];H.huffmanTableDC=e[l>>4];H.huffmanTableAC=b[l&15];c.push(H)}a=d[h++];f=d[h++];l=d[h++];a=P(d,h,z,c,K,a,f,l>>4,l&15);h+=a;break;case 65535:255!==d[h]&&h--;break;default:if(255===d[h-3]&&192<=d[h-2]&&254>=d[h-2])h-=3;else throw new E("unknown marker "+a.toString(16));}a=g()}this.width=z.samplesPerLine;this.height=z.scanLines;this.jfif=q;this.eof=h;this.adobe=t;this.components=[];for(a=
0;a<z.components.length;a++){H=z.components[a];if(q=x[H.quantizationId])H.quantizationTable=q;this.components.push({output:J(z,H),scaleX:H.h/z.maxH,scaleY:H.v/z.maxV,blocksPerLine:H.blocksPerLine,blocksPerColumn:H.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(d,g){var k=this.width/d,n=this.height/g,h,q,t=0,x=this.components.length,b=d*g*x,e=new Uint8ClampedArray(b),a=new Uint32Array(d);for(q=0;q<x;q++){var c=this.components[q];var f=c.scaleX*k;var l=
c.scaleY*n;t=q;var r=c.output;var z=c.blocksPerLine+1<<3;for(h=0;h<d;h++)c=0|h*f,a[h]=(c&4294967288)<<3|c&7;for(f=0;f<g;f++)for(c=0|f*l,c=z*(c&4294967288)|(c&7)<<3,h=0;h<d;h++)e[t]=r[c+a[h]],t+=x}if(g=this.decodeTransform)for(q=0;q<b;)for(d=c=0;c<x;c++,q++,d+=2)e[q]=(e[q]*g[d]>>8)+g[d+1];return e},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(d){for(var g,
k,n,h=0,q=d.length;h<q;h+=3)g=d[h],k=d[h+1],n=d[h+2],d[h]=g-179.456+1.402*n,d[h+1]=g+135.459-.344*k-.714*n,d[h+2]=g-226.816+1.772*k;return d},_convertYcckToRgb:function(d){for(var g,k,n,h,q=0,t=0,x=d.length;t<x;t+=4)g=d[t],k=d[t+1],n=d[t+2],h=d[t+3],d[q++]=-122.67195406894+k*(-6.60635669420364E-5*k+4.37130475926232E-4*n-5.4080610064599E-5*g+4.8449797120281E-4*h-.154362151871126)+n*(-9.57964378445773E-4*n+8.17076911346625E-4*g-.00477271405408747*h+1.53380253221734)+g*(9.61250184130688E-4*g-.00266257332283933*
h+.48357088451265)+h*(-3.36197177618394E-4*h+.484791561490776),d[q++]=107.268039397724+k*(2.19927104525741E-5*k-6.40992018297945E-4*n+6.59397001245577E-4*g+4.26105652938837E-4*h-.176491792462875)+n*(-7.78269941513683E-4*n+.00130872261408275*g+7.70482631801132E-4*h-.151051492775562)+g*(.00126935368114843*g-.00265090189010898*h+.25802910206845)+h*(-3.18913117588328E-4*h-.213742400323665),d[q++]=-20.810012546947+k*(-5.70115196973677E-4*k-2.63409051004589E-5*n+.0020741088115012*g-.00288260236853442*h+
.814272968359295)+n*(-1.53496057440975E-5*n-1.32689043961446E-4*g+5.60833691242812E-4*h-.195152027534049)+g*(.00174418132927582*g-.00255243321439347*h+.116935020465145)+h*(-3.43531996510555E-4*h+.24165260232407);return d},_convertYcckToCmyk:function(d){for(var g,k,n,h=0,q=d.length;h<q;h+=4)g=d[h],k=d[h+1],n=d[h+2],d[h]=434.456-g-1.402*n,d[h+1]=119.541-g+.344*k+.714*n,d[h+2]=481.816-g-1.772*k;return d},_convertCmykToRgb:function(d){for(var g,k,n,h,q=0,t=1/255,x=0,b=d.length;x<b;x+=4)g=d[x]*t,k=d[x+
1]*t,n=d[x+2]*t,h=d[x+3]*t,d[q++]=255+g*(-4.387332384609988*g+54.48615194189176*k+18.82290502165302*n+212.25662451639585*h-285.2331026137004)+k*(1.7149763477362134*k-5.6096736904047315*n-17.873870861415444*h-5.497006427196366)+n*(-2.5217340131683033*n-21.248923337353073*h+17.5119270841813)-h*(21.86122147463605*h+189.48180835922747),d[q++]=255+g*(8.841041422036149*g+60.118027045597366*k+6.871425592049007*n+31.159100130055922*h-79.2970844816548)+k*(-15.310361306967817*k+17.575251261109482*n+131.35250912493976*
h-190.9453302588951)+n*(4.444339102852739*n+9.8632861493405*h-24.86741582555878)-h*(20.737325471181034*h+187.80453709719578),d[q++]=255+g*(.8842522430003296*g+8.078677503112928*k+30.89978309703729*n-.23883238689178934*h-14.183576799673286)+k*(10.49593273432072*k+63.02378494754052*n+50.606957656360734*h-112.23884253719248)+n*(.03296041114873217*n+115.60384449646641*h-193.58209356861505)-h*(22.33816807309886*h+180.12613974708367);return d},getData:function(d,g,k){if(4<this.numComponents)throw new E("Unsupported color mode");
d=this._getLinearizedBlockData(d,g);if(1===this.numComponents&&k){k=d.length;g=new Uint8ClampedArray(3*k);for(var n=0,h=0;h<k;h++){var q=d[h];g[n++]=q;g[n++]=q;g[n++]=q}return g}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(d);if(4===this.numComponents){if(this._isColorConversionNeeded())return k?this._convertYcckToRgb(d):this._convertYcckToCmyk(d);if(k)return this._convertCmykToRgb(d)}return d}};return T}()})})(w);v=v.getDefaultExportFromCjs(w.exports);m.JpegImage=
v})},"esri/layers/support/rasterFormats/Lerc":function(){define(["require","exports","../../../assets"],function(m,v,w){function L(p,u,d){d.set(p.slice(u,u+d.length))}function E(p){const {_malloc:u,_free:d,_lerc_getBlobInfo:g,_lerc_getDataRanges:k,_lerc_decode_4D:n,asm:h}=p;let q;const t=Object.values(h).find(b=>b&&"buffer"in b&&b.buffer===p.HEAPU8.buffer),x=b=>{b=b.map(c=>(c>>3<<3)+16);var e=b.reduce((c,f)=>c+f),a=u(e);q=new Uint8Array(t.buffer);e=b[0];b[0]=a;for(a=1;a<b.length;a++){const c=b[a];
b[a]=b[a-1]+e;e=c}return b};J.getBlobInfo=b=>{var e=new Uint8Array(48),a=new Uint8Array(24);const [c,f,l]=x([b.length,e.length,a.length]);q.set(b,c);q.set(e,f);q.set(a,l);var r=g(c,b.length,f,l,12,3);if(r)throw d(c),Error(`lerc-getBlobInfo: error code is ${r}`);q=new Uint8Array(t.buffer);L(q,f,e);L(q,l,a);e=new Uint32Array(e.buffer);var z=new Float64Array(a.buffer);const [y,F,,K,H,D,G,S,A,B,Q]=e;a={version:y,depthCount:B,width:K,height:H,validPixelCount:G,bandCount:D,blobSize:S,maskCount:A,dataType:F,
minValue:z[0],maxValue:z[1],maxZerror:z[2],statistics:[],bandCountWithNoData:Q};if(Q&&1<B)return d(c),a;if(1===B&&1===D)return d(c),a.statistics.push({minValue:z[0],maxValue:z[1]}),a;r=B*D*8;var O=new Uint8Array(r),C=new Uint8Array(r);e=c;var M=z=0;let N=!1;q.byteLength<c+2*r?(d(c),N=!0,[e,z,M]=x([b.length,r,r]),q.set(b,e)):[z,M]=x([r,r]);q.set(O,z);q.set(C,M);if(r=k(e,b.length,B,D,z,M))throw d(e),N||d(z),Error(`lerc-getDataRanges: error code is ${r}`);q=new Uint8Array(t.buffer);L(q,z,O);L(q,M,C);
b=new Float64Array(O.buffer);r=new Float64Array(C.buffer);C=a.statistics;for(O=0;O<D;O++)if(1<B){M=b.slice(O*B,(O+1)*B);const U=r.slice(O*B,(O+1)*B),X=Math.min.apply(null,M),I=Math.max.apply(null,U);C.push({minValue:X,maxValue:I,depthStats:{minValues:M,maxValues:U}})}else C.push({minValue:b[O],maxValue:r[O]});d(e);N||d(z);return a};J.decode=(b,e)=>{const {maskCount:a,depthCount:c,bandCount:f,width:l,height:r,dataType:z,bandCountWithNoData:y}=e;var F=T[z],K=l*r;e=new Uint8Array(K*f);F=new Uint8Array(K*
c*f*F.size);K=new Uint8Array(f);var H=new Uint8Array(8*f);const [D,G,S,A,B]=x([b.length,e.length,F.length,K.length,H.length]);q.set(b,D);q.set(e,G);q.set(F,S);q.set(K,A);q.set(H,B);if(b=n(D,b.length,a,G,c,l,r,f,z,S,A,B))throw d(D),Error(`lerc-decode: error code is ${b}`);q=new Uint8Array(t.buffer);L(q,S,F);L(q,G,e);b=null;if(y){L(q,A,K);L(q,B,H);b=[];H=new Float64Array(H.buffer);for(let Q=0;Q<K.length;Q++)b.push(K[Q]?H[Q]:null)}d(D);return{data:F,maskData:e,noDataValues:b}}}const T=[{pixelType:"S8",
size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,
1.7976931348623157E308]}];let R=null,P=!1;const J={getBlobInfo:null,decode:null};v.decode=function(p,u={}){var d=u.inputOffset??0;p=p instanceof Uint8Array?p.subarray(d):new Uint8Array(p,d);d=J.getBlobInfo(p);const {data:g,maskData:k,noDataValues:n}=J.decode(p,d),{width:h,height:q,bandCount:t,depthCount:x,dataType:b,maskCount:e,statistics:a}=d;var c=T[b],f=new c.ctor(g.buffer);p=[];d=[];const l=h*q;var r=l*x;for(var z=0;z<t;z++){var y=f.subarray(z*r,(z+1)*r);if(u.returnInterleaved)p.push(y);else{a:{var F=
l,K=x;if(2>K)break a;const H=new c.ctor(F*K);for(let D=0,G=0;D<F;D++)for(let S=0,A=D;S<K;S++,A+=F)H[A]=y[G++];y=H}p.push(y)}d.push(k.subarray(z*r,(z+1)*r))}f=0===e?null:1===e?d[0]:new Uint8Array(l);if(1<e)for(f.set(d[0]),r=1;r<d.length;r++)for(z=d[r],y=0;y<l;y++)f[y]&=z[y];({noDataValue:u}=u);r=null!=u&&c.range[0]<=u&&c.range[1]>=u;if(0<e&&r)for(r=0;r<t;r++)for(z=p[r],y=d[r]||f,F=0;F<l;F++)0===y[F]&&(z[F]=u);({pixelType:c}=c);return{width:h,height:q,bandCount:t,pixelType:c,depthCount:x,statistics:a,
pixels:p,mask:f,bandMasks:e===t&&1<t?d:null,noDataValues:n}};v.getBlobInfo=function(p,u={}){p=p instanceof Uint8Array?p.subarray(u.inputOffset??0):new Uint8Array(p,u.inputOffset??0);return J.getBlobInfo(p)};v.isLoaded=function(){return P};v.load=function(){return R?R:R=(new Promise((p,u)=>m(["../../../chunks/lerc-wasm"],p,u))).then(p=>p.lercWasm).then(({default:p})=>p({locateFile:u=>w.getAssetUrl(`esri/layers/support/rasterFormats/${u}`)})).then(p=>{E(p);P=!0})};v.pixelTypeInfoMap=T;Object.defineProperty(v,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/Lzw":function(){define(["exports"],function(m){function v(T,R,P,J=!0){if(0!==R%4||0!==P%4){var p=new ArrayBuffer(4*Math.ceil(P/4));p=new Uint8Array(p);T=new Uint8Array(T,R,P);if(J)for(J=0;J<p.length;J+=4)p[J]=T[J+3],p[J+1]=T[J+2],p[J+2]=T[J+1],p[J+3]=T[J];else p.set(T);return new Uint32Array(p.buffer)}if(J){J=new Uint8Array(T,R,P);p=new Uint8Array(J.length);for(T=0;T<p.length;T+=4)p[T]=J[T+3],p[T+1]=J[T+2],p[T+2]=J[T+1],p[T+
3]=J[T];return new Uint32Array(p.buffer)}return new Uint32Array(T,R,P/4)}function w(){const T=[];for(let R=0;257>=R;R++)T[R]=[R];return T}function L(T,R){for(let P=0;P<R.length;P++)T.push(R[P])}const E=new Set;E.add(511);E.add(1023);E.add(2047);E.add(4095);E.add(8191);m.decode=function(T,R,P,J=!0){T=v(T,R,P,J);R=9;J=w();let p=32,u=J.length,d=[],g=1,k=T[0],n=0;const h=T.length;P=8*(4*h-P);const q=[];for(;null!=k;){if(p>=R)p-=R,n=k>>>32-R,k<<=R;else{n=k>>>32-p;k=T[g++];var t=R-p;p=32-t;n=(n<<t)+(k>>>
p);k<<=t}if(257===n)break;if(256===n)R=9,J=w(),u=J.length,d=[];else{t=J[n];if(null==t){if(n>J.length)throw Error("data integrity issue: code does not exist on code page");d.push(d[0]);J[u++]=d.slice();L(q,d)}else L(q,t),d.push(t[0]),1<d.length&&(J[u++]=d.slice()),d=t.slice();E.has(u)&&R++;0===p&&(k=T[g++],p=32);if(g>h||g===h&&p<=P)break}}return new Uint8Array(q)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/Raw":function(){define(function(){const m=
w=>{let L=1;switch(w){case Uint8Array:case Int8Array:L=1;break;case Uint16Array:case Int16Array:L=2;break;case Uint32Array:case Int32Array:case Float32Array:L=4;break;case Float64Array:L=8}return L};class v{static decode(w,L){var E=L.pixelType;const T=[],R=L.width*L.height;var P=Math.floor(w.byteLength/(L.width*L.height*m(L.pixelType)));const {bandIds:J,format:p}=L;L=J?.length||Math.floor(w.byteLength/(L.width*L.height*m(L.pixelType)));var u=w.byteLength-w.byteLength%(R*m(E)),d=new E(w,0,R*P);let g,
k,n,h,q=null;if("bip"===p)for(g=0;g<L;g++){n=new E(R);h=J?J[g]:g;for(k=0;k<R;k++)n[k]=d[k*P+h];T.push(n)}else if("bsq"===p)for(g=0;g<L;g++)h=J?J[g]:g,T.push(d.subarray(h*R,(h+1)*R));if(u<w.byteLength-1)if(w=w.slice(u),8*w.byteLength<R)q=null;else{w=new Uint8Array(w,0,Math.ceil(R/8));E=new Uint8Array(R);for(u=d=u=L=P=0;u<w.length-1;u++)for(L=w[u],d=7;0<=d;d--)E[P++]=L>>d&1;for(d=7;P<R-1;)L=w[w.length-1],E[P++]=L>>d&1,d--;q=E}return{pixels:T,mask:q}}}return v})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("exports ../rasterDatasets/byteStreamUtils ../../../chunks/Jpg ./Lerc ./Lzw ./pixelRangeUtils ./TiffTags ./utils ../../../chunks/Zlib".split(" "),
function(m,v,w,L,E,T,R,P,J){function p(A,B){let Q="unknown";3===A?Q=64===B?"f64":"f32":1===A?1===B?Q="u1":2===B?Q="u2":4===B?Q="u4":8>=B?Q="u8":16>=B?Q="u16":32>=B&&(Q="u32"):2===A&&(8>=B?Q="s8":16>=B?Q="s16":32>=B&&(Q="s32"));return Q}function u(A){let B=null;switch(A?A.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":B=Uint8Array;break;case "u16":B=Uint16Array;break;case "u32":B=Uint32Array;break;case "s8":B=Int8Array;break;case "s16":B=Int16Array;break;case "s32":B=Int32Array;break;
case "f64":B=Float64Array;break;default:B=Float32Array}return B}function d(A,B){return{x:B[0]*A.x+B[1]*A.y+B[2],y:B[3]*A.x+B[4]*A.y+B[5]}}function g(A,B){return A.get(B)?.values?.[0]}function k(A,B,Q,O=0,C=R.tiffTags,M=4){var N=8===M;const U=N?r(new DataView(A,Q,8),0,B):(new DataView(A,Q,2)).getUint16(0,B),X=4+2*M;var I=N?8:2;N=I+U*X;if(Q+N>A.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:N};const V=Q+N+4<=A.byteLength?z(new DataView(A,Q+N,8===M?8:4),0,B,8===M):null;Q+=I;I=
new Map;let W,Z,Y,aa=0,ea=0;for(let ca=0;ca<U;ca++){var fa=new DataView(A,Q+X*ca,X);W=fa.getUint16(0,B);Y=fa.getUint16(2,B);Z=R.getTagName(W,C);const ja=[];2===M?(aa=fa.getUint16(4,B),ea=fa.getUint16(6,B)):4===M?(aa=fa.getUint32(4,B),ea=fa.getUint32(8,B)):8===M&&(aa=z(fa,4,B,!0),ea=z(fa,12,B,!0),ja.push(fa.getUint32(12,B)),ja.push(fa.getUint32(16,B)));fa={id:W,type:Y,valueCount:aa,valueOffset:ea,valueOffsets:ja,values:null};b(A,B,fa,O,!1,M);I.set(Z,fa)}return{success:!0,ifd:I,nextIFD:V,requiredBufferSize:N}}
function n(A,B){if(1!==B&&2!==B&&4!==B)return A;const Q=new Uint8Array(A),O=8/B;A=new Uint8Array(A.byteLength*O);let C=0;const M=2**B-1;for(let N=0;N<Q.length;N++){const U=Q[N];for(let X=0;X<O;X++)A[C++]=U<<B*X>>>8-B&M}return A.buffer}function h(A,B,Q){const O=new w.JpegImage;O.parse(A);O.colorTransform=6===Q?-1:0;A=O.getData(O.width,O.height,1!==B&&4!==B);return new Uint8Array(A.buffer)}function q(A){A=(new J.Zlib(A)).getBytes();var B=new ArrayBuffer(A.length);B=new Uint8Array(B);B.set(A);return B}
async function t(A,B,Q,O,C){var M=P.isPlatformLittleEndian===B,N=g(Q,"BITSPERSAMPLE"),U=g(Q,"SAMPLESPERPIXEL")??1,X=g(Q,"PHOTOMETRICINTERPRETATION"),I=g(Q,"SAMPLEFORMAT")??1,V=p(I,N),W=g(Q,"COMPRESSION")??1,Z=u(V);if(34887===W)return await L.load(),L.decode(A,{inputOffset:O}).pixels[0];if(1===W)X=A.slice(O,O+C),B=new Uint8Array(X);else if(8===W||32946===W)B=new Uint8Array(A,O,C),B=q(B),X=B.buffer;else if(6===W)B=new Uint8Array(A,O,C),B=h(B,U,X),X=B.buffer;else if(7===W){const Y=Q.get("JPEGTABLES").values,
aa=Y.length-2;B=new Uint8Array(aa+C-2);for(let ea=0;ea<aa;ea++)B[ea]=Y[ea];A=new Uint8Array(A,O+2,C-2);for(O=0;O<A.length;O++)B[aa+O]=A[O];B=h(B,U,X);X=B.buffer}else if(5===W)B=E.decode(A,O,C,B),X=B.buffer;else throw Error("tiff-decode: unsupport compression "+W);X=n(X,N);if("u8"!==V&&"s8"!==V&&!M)switch(X=new ArrayBuffer(B.length),M=new Uint8Array(X),V){case "u16":case "s16":for(V=0;V<B.length;V+=2)M[V]=B[V+1],M[V+1]=B[V];break;case "u32":case "s32":case "f32":for(V=0;V<B.length;V+=4)M[V]=B[V+3],
M[V+1]=B[V+2],M[V+2]=B[V+1],M[V+3]=B[V]}N=new Z(X);M=g(Q,"PREDICTOR")??1;V=g(Q,"TILEWIDTH");B=g(Q,"TILELENGTH");if(1<M&&(5===W||8===W||32946===W)&&V&&B){W=a(Q);Z=new Z(N.length);Z.set(N);Q=3===I&&3===M;W=W?1:U;U=Q?4:1;I=V*U*W;Q&&(Z=new Uint8Array(Z.buffer));for(M=0;M<B;M++)for(N=M*I,X=W;X<I;X++)Z[N+X]+=Z[N+X-W];if(Q){Q=new Uint8Array(Z.length);W*=V;for(V=0;V<B;V++)for(M=V*I,N=0;N<W;N++)for(X=0;X<U;X++)Q[M+N*U+X]=Z[M+N+(U-X-1)*W];N=new Float32Array(Q.buffer)}else N=Z}return N}async function x(A,B,
Q){const O=Q.get("TILEOFFSETS")?.values;if(void 0===O)return null;const C=Q.get("TILEBYTECOUNTS")?.values,{width:M,height:N,pixelType:U,tileWidth:X,tileHeight:I}=e([Q]);var V=a(Q,B);const W=g(Q,"SAMPLESPERPIXEL")||B.planes;var Z=M*N,Y=g(Q,"BITSPERSAMPLE"),aa=34887===(g(Q,"COMPRESSION")??1),ea=u(U);const fa=[];for(var ca=0;ca<W;ca++)fa.push(new ea(Z));let ja,la,na,oa,qa,sa,ra,ua,pa;ea=Math.ceil(M/X);Z=(new Uint8Array(Z)).fill(255);ca=!1;if(0===Y%8)if(aa&&V&&1<W)for(V=Math.round(O.length/W),Y=0;Y<V;Y++){var xa=
Math.floor(Y/ea)*I;na=Y%ea*X;oa=xa*M+na;for(aa=0;aa<W;aa++){var va=Y*W+aa;0===C[va]?(va=null,ca=!0):va=await t(A,B.littleEndian,Q,O[va],C[va]);sa=0;qa=oa;ua=Math.min(X,M-na);ra=Math.min(I,N-xa);pa=fa[aa];for(ja=0;ja<ra;ja++)for(qa=oa+ja*M,sa=ja*X,la=0;la<ua;la++,qa++,sa++)va?pa[qa]=va[sa]:Z[qa]=0}}else for(Y=0;Y<O.length;Y++)for(xa=Math.floor(Y/ea)*I,na=Y%ea*X,oa=xa*M+na,0===C[Y]?(va=null,ca=!0):va=await t(A,B.littleEndian,Q,O[Y],C[Y]),sa=0,qa=oa,ua=Math.min(X,M-na),ra=Math.min(I,N-xa),xa=0;xa<W;xa++)if(pa=
fa[xa],V||aa)for(ja=0;ja<ra;ja++)for(qa=oa+ja*M,sa=X*I*xa+ja*X,la=0;la<ua;la++,qa++,sa++)va?pa[qa]=va[sa]:Z[qa]=0;else for(ja=0;ja<ra;ja++)for(qa=oa+ja*M,sa=ja*X*W+xa,la=0;la<ua;la++,qa++,sa+=W)va?pa[qa]=va[sa]:Z[qa]=0;return{width:M,height:N,pixelType:U,pixels:fa,mask:ca?Z:void 0}}function b(A,B,Q,O=0,C=!1,M=4){if(Q.values)return!0;var N=Q.type,U=Q.valueCount,X=Q.valueOffset;let I=[];var V=H[N],W=8*V,Z=U*V,Y=U*H[N]*8,aa=8===M?64:32;M=Q.valueOffsets;if(Y>aa&&Z>(C?A.byteLength:A?A.byteLength-X+O:0))return Q.offlineOffsetSize=
[X,Z],Q.values=null,!1;if(Y<=aa)if(B||(32>=aa?X>>>=32-Y:(A=M?.length?M[0]:X>>>0,B=M?.length?M[1]:Math.round((X-A)/4294967296),32>=Y?(X=A>>>32-Y,M[0]=X):(X=A*2**(32-Y)+(B>>>32-Y),M[0]=A,M[1]=B>>>32-Y))),1===U&&W===aa)I=[X];else if(64===aa)for(A=M?.length?M[0]:X>>>0,X=M?.length?M[1]:Math.round((X-A)/4294967296),B=A,V=32,A=1;A<=U;A++)Z=32-W*A%32,V<W?(Z=B<<Z>>>32-V,Y=X<<32-V>>>32-V,B=X,I.push(Z+Y*2**(W-V)),V-=32-(W-V)):(I.push(B<<Z>>>32-W),V-=W),0===V&&(V=32,B=X);else for(A=1;A<=U;A++)I.push(X<<32-W*
A>>>32-W);else for(X-=O,C&&(X=0),U=X;U<X+Z;U+=V){switch(N){case 1:W=(new DataView(A,U,1)).getUint8(0);break;case 2:W=(new DataView(A,U,1)).getUint8(0);break;case 3:W=(new DataView(A,U,2)).getUint16(0,B);break;case 4:case 13:W=(new DataView(A,U,4)).getUint32(0,B);break;case 5:W=(new DataView(A,U,4)).getUint32(0,B)/(new DataView(A,U+4,4)).getUint32(0,B);break;case 6:W=(new DataView(A,U,1)).getInt8(0);break;case 7:W=(new DataView(A,U,1)).getUint8(0);break;case 8:W=(new DataView(A,U,2)).getInt16(0,B);
break;case 9:W=(new DataView(A,U,4)).getInt32(0,B);break;case 10:W=(new DataView(A,U,4)).getInt32(0,B)/(new DataView(A,U+4,4)).getInt32(0,B);break;case 11:W=(new DataView(A,U,4)).getFloat32(0,B);break;case 12:W=(new DataView(A,U,8)).getFloat64(0,B);break;case 16:case 18:W=r(new DataView(A,U,8),0,B);break;case 17:M=new DataView(A,U,8);Y=(W=B)?M.getInt32(0,W):M.getUint32(0,W);M=W?M.getUint32(4,W):M.getInt32(4,W);aa=0<=(W?Y:M)?1:-1;W?Y*=aa:M*=aa;W=aa*(W?4294967296*M+Y:4294967296*Y+M);break;default:W=
null}I.push(W)}if(2===N){N="";X=I;I=[];for(A=0;A<X.length;A++)0===X[A]&&""!==N?(I.push(N),N=""):N+=String.fromCharCode(X[A]);""===N&&0!==I.length||I.push(N)}Q.values=I;return!0}function e(A){var B=A[0];const Q=g(B,"TILEWIDTH"),O=g(B,"TILELENGTH"),C=g(B,"IMAGEWIDTH"),M=g(B,"IMAGELENGTH");var N=g(B,"BITSPERSAMPLE");const U=g(B,"SAMPLESPERPIXEL");var X=g(B,"SAMPLEFORMAT")??1;const I=p(X,N),V=a(B);var W=B.get("GDAL_NODATA")?.values;let Z=null;W?.length&&(Z=W.map(pa=>parseFloat(pa)),Z.some(pa=>isNaN(pa))&&
(Z=null));var Y=g(B,"COMPRESSION")??1;switch(Y){case 1:W="NONE";break;case 2:case 3:case 4:case 32771:W="CCITT";break;case 5:W="LZW";break;case 6:case 7:W="JPEG";break;case 32773:W="PACKBITS";break;case 8:case 32946:W="DEFLATE";break;case 34712:W="JPEG2000";break;case 34887:W="LERC";break;default:W=String(Y)}let aa=!0,ea="";D.has(Y)||(aa=!1,ea+="unsupported tag compression "+Y);3<X&&(aa=!1,ea+="unsupported tag sampleFormat "+X);1!==N&&2!==N&&4!==N&&0!==N%8&&(aa=!1,ea+="unsupported tag bitsPerSample "+
N);N=B.get("GEOASCIIPARAMS")?.values?.[0];if(N){var fa=(fa=N.split("|").find(pa=>pa.includes("ESRI PE String \x3d ")))?fa.replace("ESRI PE String \x3d ",""):"";fa=fa.startsWith("COMPD_CS")||fa.startsWith("PROJCS")||fa.startsWith("GEOGCS")?{wkid:null,wkt:fa}:null}X=B.get("GEOTIEPOINTS")?.values;N=B.get("GEOPIXELSCALE")?.values;Y=B.get("GEOTRANSMATRIX")?.values;var ca=B.has("GEOKEYDIRECTORY")?B.get("GEOKEYDIRECTORY").data:null,ja=!1;B=!1;if(ca){ja=2===g(ca,"GTRasterTypeGeoKey");var la=g(ca,"GTModelTypeGeoKey");
2===la?(ca=g(ca,"GeographicTypeGeoKey"),1024<=ca&&32766>=ca&&(fa={wkid:ca}),fa||32767!==ca||(B=!0,fa={wkid:4326})):1===la&&(ca=g(ca,"ProjectedCSTypeGeoKey"),1024<=ca&&32766>=ca&&(fa={wkid:ca}))}let na;N&&X&&6<=X.length?(na=[N[0],0,X[3]-X[0]*N[0],0,-Math.abs(N[1]),X[4]-X[1]*N[1]],ja&&(na[2]-=.5*na[0]+.5*na[1],na[5]-=.5*na[3]+.5*na[4])):Y&&16===Y.length&&(na=ja?[Y[0],Y[1],Y[3]-.5*Y[0],Y[4],Y[5],Y[7]-.5*Y[5]]:[Y[0],Y[1],Y[3],Y[4],Y[5],Y[7]]);if(na){X=[{x:0,y:M},{x:0,y:0},{x:C,y:M},{x:C,y:0}];ca=ja=Number.POSITIVE_INFINITY;
let pa=la=Number.NEGATIVE_INFINITY;for(let xa=0;xa<X.length;xa++)Y=d(X[xa],na),ja=Y.x>ja?ja:Y.x,la=Y.x<la?la:Y.x,ca=Y.y>ca?ca:Y.y,pa=Y.y<pa?pa:Y.y;X={xmin:ja,xmax:la,ymin:ca,ymax:pa,spatialReference:fa}}else X={xmin:-.5,ymin:.5-M,xmax:C-.5,ymax:.5,spatialReference:fa};B&&(400<X.xmax-X.xmin||361<Math.max(Math.abs(X.xmin),Math.abs(X.xmax)))&&(fa=null,X.spatialReference=null);fa=c(A);let oa;let qa,sa;if(0<fa.length){qa=Math.round(Math.log(C/g(fa[0],"IMAGEWIDTH"))/Math.LN2);var ra=fa[fa.length-1];sa=
Math.round(Math.log(C/g(ra,"IMAGEWIDTH"))/Math.LN2);oa=g(ra,"TILEWIDTH");ra=g(ra,"TILELENGTH")}oa=null!=sa&&0<sa?oa||Q:null;ra=null!=sa&&0<sa?ra||O:null;let ua;Q&&(ua=[{maxCol:Math.ceil(C/Q)-1,maxRow:Math.ceil(M/O)-1,minRow:0,minCol:0}],fa.forEach(pa=>{ua.push({maxCol:Math.ceil(g(pa,"IMAGEWIDTH")/g(pa,"TILEWIDTH"))-1,maxRow:Math.ceil(g(pa,"IMAGELENGTH")/g(pa,"TILELENGTH"))-1,minRow:0,minCol:0})}));Y=A[0].get("GDAL_METADATA")?.values?.[0];Y=S(Y);ea+=" "+K({width:C,height:M,tileWidth:Q,tileHeight:O,
planes:U,ifds:A});A=f(A).length===fa.length+1;return{width:C,height:M,tileWidth:Q,tileHeight:O,planes:U,isBSQ:V,pixelType:I,compression:W,noData:Z,hasMaskBand:A,isSupported:aa,message:ea,extent:X,isPseudoGeographic:B,affine:N?null:na,firstPyramidLevel:qa,maximumPyramidLevel:sa,pyramidBlockWidth:oa,pyramidBlockHeight:ra,tileBoundary:ua,metadata:Y}}function a(A,B){return(A=A.get("PLANARCONFIGURATION")?.values)?2===A[0]:B?B.isBSQ:!1}function c(A){return A.filter(B=>1===g(B,"NEWSUBFILETYPE"))}function f(A){return A.filter(B=>
{const Q=4===((g(B,"NEWSUBFILETYPE")??0)&4);B=4===g(B,"PHOTOMETRICINTERPRETATION");return Q&&B})}function l(A){const {littleEndian:B,isBigTiff:Q,firstIFDPos:O}=y(A);var C=O;const M=[];do if(C=F(A,B,C,0,R.tiffTags,Q?8:4),C.success)M.push(C.ifd),C=C.nextIFD;else break;while(0<C);A=e(M);C=c(M);const N=f(M);return{...A,littleEndian:B,isBigTiff:Q,ifds:M,pyramidIFDs:C,maskIFDs:N}}function r(A,B,Q){const O=A.getUint32(B,Q);A=A.getUint32(B+4,Q);return Q?4294967296*A+O:4294967296*O+A}function z(A,B,Q,O){return O?
r(A,B,Q):A.getUint32(B,Q)}function y(A){var B=new DataView(A,0,16),Q=B.getUint16(0,!1);A=null;if(18761===Q)A=!0;else if(19789===Q)A=!1;else throw Error("unexpected endianess byte");var O=B.getUint16(2,A);if(42!==O&&43!==O)throw Error("unexpected tiff identifier");Q=4;if(O=43===O){const C=B.getUint16(Q,A);Q+=2;if(8!==C)throw Error("unsupported bigtiff version");if(0!==B.getUint16(Q,A))throw Error("unsupported bigtiff version");Q+=2}B=z(B,Q,A,O);return{littleEndian:A,isBigTiff:O,firstIFDPos:B}}function F(A,
B,Q,O=0,C=R.tiffTags,M=4){Q=k(A,B,Q,O,C,M);let N;const U=Q.ifd;U&&(R.ifdTags.forEach((X,I)=>{U.has(I)&&(N=U.get(I),N.data=k(A,B,N.valueOffset-O,O,X).ifd)}),U.has("GEOKEYDIRECTORY")&&(N=U.get("GEOKEYDIRECTORY"),(C=N.values)&&4<C.length&&(C=C[0]+"."+C[1]+"."+C[2],N.data=k(A,B,N.valueOffset+6-O,O,R.geoKeys,2).ifd,N.data&&N.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[C]}))),U.has("XMP")&&(N=U.get("XMP"),C=N.values,"number"===typeof C[0]&&7===N.type&&(N.values=[v.bytesToUTF8(new Uint8Array(C))])));
return Q}function K(A){const {width:B,height:Q,tileHeight:O,tileWidth:C}=A,M=A.planes,N=C?C*O:B*Q;A=g(A.ifds[0],"BITSPERSAMPLE");let U="";N*M>2**30/(8<A?A/8:1)&&(U=C?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported");return U}const H=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],D=new Set([1,5,6,7,8,34712,34887]),G=(A,B,Q)=>{if(!(A&&0<A.length&&B&&Q))return null;let O,C,M;const N=A[0].length,U=A.length,X=new Uint8Array(N);for(let V=0;V<
U;V++)if(O=A[V],C=B[V],M=Q[V],0===V)for(var I=0;I<N;I++)X[I]=O[I]<C||O[I]>M?0:1;else for(I=0;I<N;I++)X[I]&&(X[I]=O[I]<C||O[I]>M?0:1);return X},S=A=>{if(!A)return null;var B=A.match(/<Item(.*?)Item>/gi);if(!B||0===B.length)return null;A=new Map;var Q;for(var O=0;O<B.length;O++){var C=B[O];var M=C.slice(6,C.indexOf("\x3e"));var N=C.indexOf("sample\x3d");-1<N&&(Q=C.slice(N+8,C.indexOf('"',N+8)));N=C.indexOf("name\x3d");-1<N&&(M=C.slice(N+6,C.indexOf('"',N+6)));M&&(C=C.slice(C.indexOf("\x3e")+1,C.indexOf("\x3c/Item\x3e")).trim(),
null!=Q?A.has(M)?A.get(M)[Q]=C:A.set(M,[C]):A.set(M,C));Q=null}B=A.get("STATISTICS_MINIMUM");M=A.get("STATISTICS_MAXIMUM");O=A.get("STATISTICS_MEAN");C=A.get("STATISTICS_STDDEV");Q=null;if(B&&M)for(Q=[],N=0;N<B.length;N++)Q.push({min:parseFloat(B[N]),max:parseFloat(M[N]),avg:O&&parseFloat(O[N]),stddev:C&&parseFloat(C[N])});M=A.get("BandName");O=A.get("WavelengthMin");C=A.get("WavelengthMax");B=null;if(M)for(B=[],N=0;N<M.length;N++)B.push({BandName:M[N],WavelengthMin:O&&parseFloat(O[N]),WavelengthMax:C&&
parseFloat(C[N])});M=A.get("DataType");return{statistics:Q,bandProperties:B,dataType:M,rawMetadata:A}};m.decode=async function(A,B={}){var Q=B.pyramidLevel||0,O=B.headerInfo||l(A);const {ifds:C,noData:M}=O;if(0===C.length)throw Error("no valid image file directory");var N=K(O);if(N)throw N;N=null;var U=-1===Q?C[C.length-1]:C[Q];B=M??B.noDataValue;if(O.tileWidth)N=await x(A,O,U);else{{const sa=P.isPlatformLittleEndian===O.littleEndian,ra=U.get("STRIPOFFSETS")?.values;if(void 0===ra)N=null;else{var {width:X,
height:I,pixelType:V}=e([U]);Q=g(U,"SAMPLESPERPIXEL")||O.planes;var W=g(U,"PHOTOMETRICINTERPRETATION");N=X*I;var Z=g(U,"BITSPERSAMPLE"),Y=u(V),aa=new Y(N*Q),ea=U.get("STRIPBYTECOUNTS")?.values,fa=g(U,"ROWSPERSTRIP"),ca=g(U,"COMPRESSION")??1;var ja=fa;if(0===Z%8)for(U=0;U<ra.length;U++){var la=U*fa*X*Q;ja=(U+1)*fa>I?I-U*fa:fa;if("u8"===V||"s8"===V||sa)if(8===ca||32946===ca){var na=new Uint8Array(A,ra[U],ea[U]);na=q(na);var oa=na.buffer}else 6===ca?(na=new Uint8Array(A,ra[U],ea[U]),na=h(na,Q,W),oa=
na.buffer):5===ca?(na=E.decode(A,ra[U],ea[U],O.littleEndian),oa=na.buffer):(ea[U]!==ja*X*Q*Z/8&&console.log("strip byte counts is different than expected"),oa=A.slice(ra[U],ra[U]+ea[U]));else{if(6===ca||8===ca||32946===ca){na=new Uint8Array(A,ra[U],ea[U]);var qa=q(na);oa=qa.buffer}else ea[U]!==ja*X*Q*Z/8&&console.log("strip byte counts is different than expected"),oa=new ArrayBuffer(ea[U]),na=new Uint8Array(A,ra[U],ea[U]),qa=new Uint8Array(oa);switch(V){case "u16":case "s16":for(ja=0;ja<na.length;ja+=
2)qa[ja]=na[ja+1],qa[ja+1]=na[ja];break;case "u32":case "s32":case "f32":for(ja=0;ja<na.length;ja+=4)qa[ja]=na[ja+3],qa[ja+1]=na[ja+2],qa[ja+2]=na[ja+1],qa[ja+3]=na[ja]}}oa=n(oa,Z);ja=new Y(oa);aa.set(ja,la)}W=[];if(1===Q)W.push(aa);else for(U=0;U<Q;U++){O=new Y(N);for(A=0;A<N;A++)O[A]=aa[A*Q+U];W.push(O)}N={width:X,height:I,pixelType:V,pixels:W}}}}if(!N)return N;null!=B&&T.convertNoDataToMask(N,B);return N};m.decodeTileOrStrip=async function(A,B){const {headerInfo:Q,ifd:O,offsets:C,sizes:M}=B;var N=
[];for(var U=0;U<C.length;U++){0===M[U]?1:0;var X=await t(A,Q.littleEndian,O,C[U],M[U]||A.byteLength);N.push(X)}var I=a(O,Q);A=g(O,"BITSPERSAMPLE");U=g(O,"SAMPLEFORMAT")??1;U=p(U,A);var V=g(O,"SAMPLESPERPIXEL")||Q.planes;const W=u(U);X=g(O,"TILEWIDTH");const Z=g(O,"TILELENGTH");var Y=g(O,"COMPRESSION")??1;const aa=X*Z;A=[];let ea=N[0];const fa=34887===Y;for(let ca=0;ca<V;ca++){Y=new W(aa);if(N.length===V)ea=N[ca],ea.length===aa&&(Y=ea);else if(ea.length)if(I||fa)Y=ea.length===aa?ea:ea.slice(aa*ca,
aa*(ca+1));else for(let ja=0;ja<aa;ja++)Y[ja]=ea[ja*V+ca];A.push(Y)}N=Q.noData?Q.noData[0]:B.noDataValue;I=(V=Q.metadata?Q.metadata.statistics:null)?V.map(ca=>ca.min):null;V=V?V.map(ca=>ca.max):null;U={pixelType:U,width:X,height:Z,pixels:A,noDataValue:N};null!=N?T.convertNoDataToMask(U,N):I&&V&&B.applyMinMaxConstraint&&(U.mask=G(A,I,V));return U};m.getImageInfo=e;m.getMaskIFDs=f;m.getPyramidIFDs=c;m.isBSQConfig=a;m.parseFieldValues=b;m.parseHeader=l;m.parseIFD=F;m.parseSignature=y;Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["exports"],function(m){m.bytesToUTF8=function(v,w){let L=0,E="",T=0,R=0;const P=v.length;for(;L<P;)if(R=v[L++],T=R>>4,8>T?T=1:15===T?(T=4,R=(R&7)<<18|(v[L++]&63)<<12|(v[L++]&63)<<6|v[L++]&63):14===T?(T=3,R=(R&15)<<12|(v[L++]&63)<<6|v[L++]&63):(T=2,R=(R&31)<<6|v[L++]&63),0!==R||w)E+=String.fromCharCode(R);return E};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/TiffTags":function(){define(function(){const m=
(()=>{const E=[];E[254]="NEWSUBFILETYPE";E[255]="SUBFILETYPE";E[256]="IMAGEWIDTH";E[257]="IMAGELENGTH";E[258]="BITSPERSAMPLE";E[259]="COMPRESSION";E[262]="PHOTOMETRICINTERPRETATION";E[263]="THRESHHOLDING";E[264]="CELLWIDTH";E[265]="CELLLENGTH";E[266]="FILLORDER";E[269]="DOCUMENTNAME";E[270]="IMAGEDESCRIPTION";E[271]="MAKE";E[272]="MODEL";E[273]="STRIPOFFSETS";E[274]="ORIENTATION";E[277]="SAMPLESPERPIXEL";E[278]="ROWSPERSTRIP";E[279]="STRIPBYTECOUNTS";E[280]="MINSAMPLEVALUE";E[281]="MAXSAMPLEVALUE";
E[282]="XRESOLUTION";E[283]="YRESOLUTION";E[284]="PLANARCONFIGURATION";E[285]="PAGENAME";E[286]="XPOSITION";E[287]="YPOSITION";E[288]="FREEOFFSETS";E[289]="FREEBYTECOUNTS";E[290]="GRAYRESPONSEUNIT";E[291]="GRAYRESPONSECURVE";E[292]="T4OPTIONS";E[293]="T6OPTIONS";E[296]="RESOLUTIONUNIT";E[297]="PAGENUMBER";E[300]="COLORRESPONSEUNIT";E[301]="TRANSFERFUNCTION";E[305]="SOFTWARE";E[306]="DATETIME";E[315]="ARTIST";E[316]="HOSTCOMPUTER";E[317]="PREDICTOR";E[318]="WHITEPOINT";E[319]="PRIMARYCHROMATICITIES";
E[320]="COLORMAP";E[321]="HALFTONEHINTS";E[322]="TILEWIDTH";E[323]="TILELENGTH";E[324]="TILEOFFSETS";E[325]="TILEBYTECOUNTS";E[326]="BADFAXLINES";E[327]="CLEANFAXDATA";E[328]="CONSECUTIVEBADFAXLINES";E[330]="SUBIFD";E[332]="INKSET";E[333]="INKNAMES";E[334]="NUMBEROFINKS";E[336]="DOTRANGE";E[337]="TARGETPRINTER";E[338]="EXTRASAMPLES";E[339]="SAMPLEFORMAT";E[340]="SMINSAMPLEVALUE";E[341]="SMAXSAMPLEVALUE";E[342]="TRANSFERRANGE";E[347]="JPEGTABLES";E[512]="JPEGPROC";E[513]="JPEGIFOFFSET";E[514]="JPEGIFBYTECOUNT";
E[515]="JPEGRESTARTINTERVAL";E[517]="JPEGLOSSLESSPREDICTORS";E[518]="JPEGPOINTTRANSFORM";E[519]="JPEGQTABLES";E[520]="JPEGDCTABLES";E[521]="JPEGACTABLES";E[529]="YCBCRCOEFFICIENTS";E[530]="YCBCRSUBSAMPLING";E[531]="YCBCRPOSITIONING";E[532]="REFERENCEBLACKWHITE";E[700]="XMP";E[33550]="GEOPIXELSCALE";E[33922]="GEOTIEPOINTS";E[33432]="COPYRIGHT";E[42112]="GDAL_METADATA";E[42113]="GDAL_NODATA";E[50844]="RPCCOEFFICIENT";E[34264]="GEOTRANSMATRIX";E[34735]="GEOKEYDIRECTORY";E[34736]="GEODOUBLEPARAMS";E[34737]=
"GEOASCIIPARAMS";E[34665]="EXIFIFD";E[34853]="GPSIFD";E[40965]="INTEROPERABILITYIFD";return E})(),v=(()=>{const E=m.slice();E[36864]="ExifVersion";E[40960]="FlashpixVersion";E[40961]="ColorSpace";E[42240]="Gamma";E[37121]="ComponentsConfiguration";E[37122]="CompressedBitsPerPixel";E[40962]="PixelXDimension";E[40963]="PixelYDimension";E[37500]="MakerNote";E[37510]="UserComment";E[40964]="RelatedSoundFile";E[36867]="DateTimeOriginal";E[36868]="DateTimeDigitized";E[36880]="OffsetTime";E[36881]="OffsetTimeOriginal";
E[36882]="OffsetTimeDigitized";E[37520]="SubSecTime";E[37521]="SubSecTimeOriginal";E[37522]="SubSecTimeDigitized";E[37888]="Temperature";E[37889]="Humidity";E[37890]="Pressure";E[37891]="WaterDepth";E[37892]="Acceleration";E[37893]="CameraElevationAngle";E[42016]="ImageUniqueID";E[42032]="CameraOwnerName";E[42033]="BodySerialNumber";E[42034]="LensSpecification";E[42035]="LensMake";E[42036]="LensModel";E[42037]="LensSerialNumber";E[33434]="ExposureTime";E[33437]="FNumber";E[34850]="ExposureProgram";
E[34852]="SpectralSensitivity";E[34855]="PhotographicSensitivity";E[34856]="OECF";E[34864]="SensitivityType";E[34865]="StandardOutputSensitivity";E[34866]="RecommendedExposureIndex";E[34867]="ISOSpeed";E[34868]="ISOSpeedLatitudeyyy";E[34869]="ISOSpeedLatitudezzz";E[37377]="ShutterSpeedValue";E[37378]="ApertureValue";E[37379]="BrightnessValue";E[37380]="ExposureBiasValue";E[37381]="MaxApertureValue";E[37382]="SubjectDistance";E[37383]="MeteringMode";E[37384]="LightSource";E[37385]="Flash";E[37386]=
"FocalLength";E[37396]="SubjectArea";E[41483]="FlashEnergy";E[41484]="SpatialFrequencyResponse";E[41486]="FocalPlaneXResolution";E[41487]="FocalPlaneYResolution";E[41488]="FocalPlaneResolutionUnit";E[41492]="SubjectLocation";E[41493]="ExposureIndex";E[41495]="SensingMethod";E[41728]="FileSource";E[41729]="SceneType";E[41730]="CFAPattern";E[41985]="CustomRendered";E[41986]="ExposureMode";E[41987]="WhiteBalance";E[41988]="DigitalZoomRatio";E[41989]="FocalLengthIn35mmFilm";E[41990]="SceneCaptureType";
E[41991]="GainControl";E[41992]="Contrast";E[41993]="Saturation";E[41994]="Sharpness";E[41995]="DeviceSettingDescription";E[41996]="SubjectDistanceRange";return E})(),w=(()=>{const E=[];E[1024]="GTModelTypeGeoKey";E[1025]="GTRasterTypeGeoKey";E[1026]="GTCitationGeoKey";E[2048]="GeographicTypeGeoKey";E[2049]="GeogCitationGeoKey";E[2050]="GeogGeodeticDatumGeoKey";E[2051]="GeogPrimeMeridianGeoKey";E[2052]="GeogLinearUnitsGeoKey";E[2053]="GeogLinearUnitSizeGeoKey";E[2054]="GeogAngularUnitsGeoKey";E[2055]=
"GeogAngularUnitSizeGeoKey";E[2056]="GeogEllipsoidGeoKey";E[2057]="GeogSemiMajorAxisGeoKey";E[2058]="GeogSemiMinorAxisGeoKey";E[2059]="GeogInvFlatteningGeoKey";E[2061]="GeogPrimeMeridianLongGeoKey";E[2060]="GeogAzimuthUnitsGeoKey";E[3072]="ProjectedCSTypeGeoKey";E[3073]="PCSCitationGeoKey";E[3074]="ProjectionGeoKey";E[3075]="ProjCoordTransGeoKey";E[3076]="ProjLinearUnitsGeoKey";E[3077]="ProjLinearUnitSizeGeoKey";E[3078]="ProjStdParallel1GeoKey";E[3079]="ProjStdParallel2GeoKey";E[3080]="ProjNatOriginLongGeoKey";
E[3081]="ProjNatOriginLatGeoKey";E[3082]="ProjFalseEastingGeoKey";E[3083]="ProjFalseNorthingGeoKey";E[3084]="ProjFalseOriginLongGeoKey";E[3085]="ProjFalseOriginLatGeoKey";E[3086]="ProjFalseOriginEastingGeoKey";E[3087]="ProjFalseOriginNorthingGeoKey";E[3088]="ProjCenterLongGeoKey";E[3090]="ProjCenterEastingGeoKey";E[3091]="ProjCenterNorthingGeoKey";E[3092]="ProjScaleAtNatOriginGeoKey";E[3093]="ProjScaleAtCenterGeoKey";E[3094]="ProjAzimuthAngleGeoKey";E[3095]="ProjStraightVertPoleLongGeoKey";E[4096]=
"VerticalCSTypeGeoKey";E[4097]="VerticalCitationGeoKey";E[4098]="VerticalDatumGeoKey";E[4099]="VerticalUnitsGeoKey";return E})(),L=new Map;L.set("EXIFIFD",v);L.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{tiffTags:m,ifdTags:L,geoKeys:w,getTagName:(E,T)=>{T=(T||m)[E];void 0===T&&(T="unknown"+String(E));return T}}})},"esri/layers/support/rasterFormats/utils":function(){define(["exports"],function(m){const v=new ArrayBuffer(4),w=new Uint8Array(v);(new Uint32Array(v))[0]=1;m.isPlatformLittleEndian=1===w[0];Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),
function(m,v,w,L,E,T,R){class P{constructor(p,u){this.item=p;this.controller=u;this.promise=null}}class J{constructor(p){this._task=this._schedule=null;this._deferreds=new E;this._controllers=new E;this._processingItems=new E;this._pausedSignal=R.signal(!1);this.concurrency=1;p.concurrency&&(this.concurrency=p.concurrency);this._queue=new L(p.peeker);this.process=p.process;const u=p.scheduler;p.priority&&u&&(this._task=u.registerTask(p.priority,this))}destroy(){this.clear();this._schedule=v.removeMaybe(this._schedule);
this._task=v.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(p){(p=this._controllers.get(p))&&p.abort()}clear(){this._queue.clear();const p=[];this._controllers.forEach(u=>p.push(u));this._controllers.clear();p.forEach(u=>u.abort());this._processingItems.clear();this._cancelNext()}forEach(p){this._deferreds.forEach((u,d)=>p(d))}get(p){return(p=this._deferreds.get(p))?p.promise:void 0}isOngoing(p){return this._processingItems.has(p)}has(p){return this._deferreds.has(p)}pause(){this._pausedSignal.value||
(this._pausedSignal.value=!0,this._cancelNext())}push(p,u){const d=this.get(p);if(d)return d;const g=new AbortController;let k=null;u&&(k=w.onAbort(u,()=>g.abort()));const n=()=>{h.remove();null!=k&&k.remove();this._removeItem(p);this._queue.remove(p);this._scheduleNext()},h=w.onAbortOrThrow(g.signal,()=>{const t=this._processingItems.get(p);t&&t.controller.abort();n();q.reject(w.createAbortError())}),q=w.createResolver();this._deferreds.set(p,q);this._controllers.set(p,g);q.promise.then(n,n);this._queue.push(p);
this._scheduleNext();return q.promise}last(){return this._queue.last()}lastPromise(){const p=this.last();return p?this.get(p):null}peek(){return this._queue.peek()}popLast(){const p=this._queue.popLast();p&&this._removeItem(p);return p}reset(){const p=[];this._processingItems.forEach(u=>p.push(u));this._processingItems.clear();for(const u of p)this._queue.push(u.item),u.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const p=
[];for(;this._queue.length;)p.push(this._queue.pop());this.clear();return p}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(p){for(;!p.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),p.madeProgress()}_removeItem(p){this._deferreds.delete(p);this._controllers.delete(p);this._processingItems.delete(p)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||
(this._schedule=T.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(p,u){this._canProcessFulfillment(p)&&(this._scheduleNext(),this._deferreds.get(p.item).resolve(u))}_processError(p,u){this._canProcessFulfillment(p)&&(this._scheduleNext(),this._deferreds.get(p.item).reject(u))}_canProcessFulfillment(p){return this._deferreds.get(p.item)&&
this._processingItems.get(p.item)===p?!0:!1}_process(p){if(null!=p){var u=new AbortController,d=new P(p,u);this._processingItems.set(p,d);try{var g=this.process(p,u.signal)}catch(k){this._processError(d,k)}w.isPromiseLike(g)?(d.promise=g,g.then(k=>this._processResult(d,k),k=>this._processError(d,k))):this._processResult(d,g)}}get test(){return{update:p=>this.runTask(p)}}}m.QueueProcessor=J;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/clipUtils":function(){define(["require",
"exports","../../../core/unitUtils","../../../geometry/Extent","../PixelBlock"],function(m,v,w,L,E){function T(J,p,u){if(!J)return J;const {width:d,height:g}=J,k=p.width/d,n=p.height/g,{xmin:h,ymax:q}=p;if("extent"===u.type){p=(u.xmin-h)/k;var t=(u.xmax-h)/k,x=(q-u.ymax)/n;u=(q-u.ymin)/n;u=[[[p,x],[p,u],[t,u],[t,x],[p,x]]]}else u=u.rings.map(e=>e.map(([a,c])=>[(a-h)/k,(q-c)/n]));p=document.createElement("canvas");p.width=d;p.height=g;const b=p.getContext("2d");b.fillStyle="#f00";b.beginPath();u.forEach(e=>
{b.moveTo(e[0][0],e[0][1]);for(let a=0;a<e.length;a++)b.lineTo(e[a][0],e[a][1]);b.closePath()});b.fill();u=b.getImageData(0,0,d,g).data;p=J.mask;t=d*g;x=new Uint8Array(t);for(let e=0;e<t;e++)if(!p||p[e])x[e]=127<u[4*e+3]?255:0;return new E({pixelType:J.pixelType,width:d,height:g,mask:x,maskIsAlpha:!1,pixels:[...J.pixels]})}function R(J,p,u){const {width:d,height:g}=J,k=new Uint8Array(d*g);var n=p.width/d,h=p.height/g;if(.5>u.width/n||.5>u.height/h)return new E({pixelType:J.pixelType,width:d,height:g,
mask:k,pixels:[...J.pixels]});const {xmin:q,xmax:t,ymin:x,ymax:b}=p,{xmin:e,xmax:a,ymin:c,ymax:f}=u;p=Math.max(q,e);var l=Math.min(t,a);u=Math.max(x,c);var r=Math.min(b,f),z=.5*n,y=.5*h;if(l-p<z||r-u<y||l<q+z||p>t-z||u>b-y||r<x+y)return new E({pixelType:J.pixelType,width:d,height:g,mask:k,pixels:[...J.pixels]});p=Math.max(0,(p-q)/n);l=Math.min(d,Math.max(0,(l-q)/n));r=Math.max(0,(b-r)/h);y=Math.min(g,Math.max(0,(b-u)/h));h=Math.round(p);n=Math.round(l)-1;z=Math.round(r);u=Math.round(y)-1;if(h===n&&
.5<p%1&&.5>l%1||z===u&&.5<r%1&&.5>y%1)return new E({pixelType:J.pixelType,width:d,height:g,mask:k,pixels:[...J.pixels]});if(0===h&&0===z&&n===d&&u===g)return J;p=J.mask;for(l=z;l<=u;l++)for(r=h;r<=n;r++)z=l*d+r,k[z]=p?p[z]:255;return new E({pixelType:J.pixelType,width:d,height:g,mask:k,pixels:[...J.pixels]})}function P(J,p,u){const {width:d,height:g}=J,k=new Uint8Array(d*g),n=p.width/d,h=p.height/g,{xmin:q,ymax:t}=p;({paths:p}=u);u=J.mask;for(let c=0;c<p.length;c++){const f=p[c];for(let l=0;l<f.length-
1;l++){const [r,z]=f[l],[y,F]=f[l+1];let K=Math.floor((t-z)/h),H=Math.floor((t-F)/h);if(H<K){var x=K;K=H;H=x}K=Math.max(0,K);H=Math.min(g-1,H);x=(y-r)/(F-z);for(let D=K;D<=H;D++){var b=D===K?Math.max(z,F):(g+1-D)*h,e=D===H?Math.min(z,F):b-h;b=F===z?Math.floor((r-q)/n):Math.floor((x*(b-z)+r-q)/n);e=F===z?Math.floor((y-q)/n):Math.floor((x*(e-z)+r-q)/n);if(e<b){var a=b;b=e;e=a}a=D*d;b=Math.max(0,b);e=Math.min(d-1,e);for(b=a+b;b<=a+e;b++)k[b]=u?u[b]:255}}}return new E({pixelType:J.pixelType,width:d,height:g,
mask:k,pixels:[...J.pixels]})}v.clip=async function(J,p,u){if("extent"===u.type)return R(J,p,u);const {width:d,height:g}=J,k=new Uint8Array(d*g),{contains:n,intersects:h}=await new Promise((q,t)=>m(["../../../geometry/geometryEngine"],q,t));return h(p,u)?"polyline"===u.type?P(J,p,u):n(u,p)?J:T(J,p,u):new E({pixelType:J.pixelType,width:d,height:g,mask:k,maskIsAlpha:!1,pixels:[...J.pixels]})};v.snapToRaster=function(J,p,u,d=!0){var {spatialReference:g}=J;if(!u.spatialReference.equals(g)){var k=w.getMetersPerUnitForSR(u.spatialReference),
n=w.getMetersPerUnitForSR(g);k!==n&&(k/=n,u={x:u.x*k,y:u.y*k})}const {x:h,y:q}=u;let {xmin:t,xmax:x,ymax:b,ymin:e}="extent"===p.type?p:p.extent;const {xmin:a,ymax:c}=J.extent;d?(t=a+(t>a?h*Math.round((t-a)/h):0),b=c-(b<c?q*Math.round((c-b)/q):0),x=a+(x>a?h*Math.round((x-a)/h):0),e=c-(e<c?q*Math.round((c-e)/q):0),g=new L({xmin:t,ymax:b,xmax:x,ymin:e,spatialReference:g}),J=Math.round(g.width/h),p=Math.round(g.height/q)):(J=Math.floor((x-t)/h+.8),p=Math.floor((b-e)/q+.8),t=a+(t>a?h*Math.floor((t-a)/
h+.1):0),b=c-(b<c?q*Math.floor((c-b)/q+.1):0),g=new L({xmin:t,ymax:b,xmax:t+J*h,ymin:b-p*q,spatialReference:g}));return{extent:g,width:J,height:p}};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/rasterFunctionHelper":function(){define("exports ../../../core/colorUtils ../../../core/Error ../../../core/lang ./ArithmeticFunction ./AspectFunction ./BandArithmeticFunction ./ClipFunction ./ColormapFunction ./CompositeBandFunction ./ContrastBrightnessFunction ./ConvolutionFunction ./CurvatureFunction ./ExtractBandFunction ./GrayscaleFunction ./LocalFunction ./MaskFunction ./NDVIFunction ./RemapFunction ./SlopeFunction ./StatisticsFunction ./StatisticsHistogramFunction ./StretchFunction ./TableFunction".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e,a,c,f){function l(C,M){({rasterFunctionArguments:C}=C);C&&(C.rasters||[C.raster]).forEach(N=>{N&&"number"!==typeof N&&("string"===typeof N?N.startsWith("http")&&(M.includes(N)||M.push(N)):"rasterFunctionArguments"in N&&l(N,M))})}function r(C,M){return"rasters"===M[0]&&Array.isArray(C.rasters)?C.rasters:M.map(N=>C[N])}function z(C){return!!(C&&"object"===typeof C&&C.rasterFunction&&C.rasterFunctionArguments)}function y(C){const {rasterFunction:M,rasterFunctionArguments:N}=
C,U={};for(const I in N){let V=N[I];var X=I.toLowerCase();if("rasters"===X&&Array.isArray(V))U.rasters=V.map(W=>z(W)?y(W):W);else switch(z(V)&&(V=y(V)),X){case "dra":U.dra=V;break;case "pspower":U.psPower=V;break;case "pszfactor":U.psZFactor=V;break;case "bandids":U.bandIds=V;break;default:X=I[0].toLowerCase()+I.slice(1),U[X]=V}}"Local"!==M||U.rasters?.length||(U.rasters=["$$"]);return{...C,rasterFunctionArguments:U}}function F(C,M){const {rasterFunction:N,rasterFunctionArguments:U}=C;var X=C.outputPixelType?.toLowerCase();
if(null==N||!O.has(N))throw new w("raster-function-helper",`unsupported raster function: ${N}`);var I=O.get(N);C=("function"===typeof I.ctor?I.ctor:I.ctor["default"]).fromJSON({...C,outputPixelType:X});({rasterArgumentNames:X}=C);I=[];const V=r(U,X),W="rasters"===X[0],Z=[];for(let Y=0;Y<V.length;Y++){const aa=V[Y];let ea;null==aa||"string"===typeof aa&&aa.startsWith("$")?I.push(M?.raster):"string"===typeof aa?M[aa]&&I.push(M[aa]):"number"!==typeof aa&&"rasterFunction"in aa&&(ea=F(aa,M),W||(C.functionArguments[X[Y]]=
ea),I.push(ea));W&&Z.push(ea??aa)}W&&(C.functionArguments.rasters=Z);M&&(C.sourceRasters=I,M=M.raster?.url)&&(C.mainPrimaryRasterId=M);return C}function K(C,M){if(C&&M)for(const N in C){const U=C[N];U&&"object"===typeof U&&"type"in U&&("RasterFunctionTemplate"===U.type?K(U.arguments,M):"RasterFunctionVariable"===U.type&&null!=M[U.name]&&(U.value=M[U.name]))}}function H(C,M){if(!C||"object"!==typeof C)return C;const {value:N}=C;if(!N||"object"!==typeof N)return C.isDataset?"$$":N;if(Array.isArray(N))return 0===
N.length?[]:N.map(X=>"object"===typeof X&&"RasterFunctionVariable"===X.type?H(X,M):X);if("value"in N&&["number","string","boolean"].includes(typeof N.value))return N.value;if(C.isDataset&&"Scalar"!==N.type)return"$$";if(!("type"in N))return N;C=N;switch(N.type){case "Scalar":C=N.value;break;case "AlgorithmicColorRamp":C=D(N);break;case "MultiPartColorRamp":C={type:"multipart",colorRamps:N.ArrayOfColorRamp.map(D)};break;case "ArgumentArray":if(N.elements?.length&&"RasterStatistics"!==N.elements[0].type){C=
[];for(let X=0;X<N.elements.length;X++){const I=N.elements[X];var {type:U}=I;if(U)if("RasterFunctionTemplate"===U)({renderingRule:U}=G(I,M)),C.push(U),null!=I._object_id&&M.set(I._object_id,U);else if("RasterFunctionVariable"===U)U=H(I,M),C.push(U),null!=I._object_id&&M.set(I._object_id,U);else throw new w("raster-function-helper","unsupported raster function json.");else C.push(I)}}else C=N.elements}null!=N._object_id&&M.set(N._object_id,C);return C}function D(C){const M=C.algorithm??"esriHSVAlgorithm";
let {FromColor:N,ToColor:U}=C;if(!Array.isArray(N)){const {r:X,g:I,b:V}=v.toRGB({h:N.Hue,s:N.Saturation,v:N.Value});N=[X,I,V,N.AlphaValue]}if(!Array.isArray(U)){const {r:X,g:I,b:V}=v.toRGB({h:U.Hue,s:U.Saturation,v:U.Value});U=[X,I,V,U.AlphaValue]}return{type:"algorithmic",algorithm:M,fromColor:N,toColor:U}}function G(C,M,N){N&&K(C,N);M={renderingRule:{},templates:M};S(C,M);return M}function S(C,M){if(C&&M.renderingRule){var {renderingRule:N,templates:U}=M,{function:X,arguments:I,_object_id:V}=C;
if(X&&I){null!=V&&U.set(V,N);N.rasterFunction=X.type.replace("Function","");N.outputPixelType=X.pixelType;C={};N.rasterFunctionArguments=C;for(const W in I)"type"!==W&&"object_id"!==W&&"_object_ref_id"!==W&&((M=I[W])&&"object"===typeof M&&"type"in M&&("RasterFunctionTemplate"===M.type||"RasterFunctionVariable"===M.type)?("RasterFunctionVariable"===M.type?C[W]=H(M,U):(N.rasterFunctionArguments[W]={},S(M,{renderingRule:N.rasterFunctionArguments[W],templates:U})),null!=M._object_id&&U.set(M._object_id,
C[W])):C[W]=M);C.DEM&&!C.Raster&&(C.Raster=C.DEM,delete C.DEM);switch(N.rasterFunction){case "Stretch":B(C);break;case "Colormap":"randomcolorramp"===C.ColorRamp?.type?.toLowerCase()&&(delete C.ColorRamp,C.ColormapName="Random");0===C.ColorSchemeType&&delete C.ColorRamp;break;case "Convolution":null!=C.ConvolutionType&&(C.Type=C.ConvolutionType,delete C.ConvolutionType);break;case "Mask":Q(C)}}}}function A(C){const {renderingRule:M,templates:N}=C;if("object"===typeof M&&M?.rasterFunctionArguments&&
N.size){({rasterFunctionArguments:C}=M);for(const U in C){const X=C[U],I="_object_ref_id"===U?X:X&&"object"===typeof X&&"_object_ref_id"in X?X._object_ref_id:null;if(null!=I){if(!N.has(I))throw new w("raster-function-helper",`unsupported raster function json. _object_ref_id: ${I} does not exist`);const V=N.get(I);"_object_ref_id"!==U?C[U]=V:V&&"object"===typeof V&&Object.assign(C,V)}else X&&"object"===typeof X&&(X.rasterFunctionArguments&&A({renderingRule:X,templates:N}),Array.isArray(X)&&X.forEach((V,
W)=>{if("object"===typeof V)if(null!=V._object_ref_id){if(!N.has(V._object_ref_id))throw new w("raster-function-helper",`unsupported raster function json. _object_ref_id: ${X} does not exist`);const Z=N.get(I);Z&&"object"===typeof Z?Object.assign(V,Z):X[W]=Z}else A({renderingRule:V,templates:N})}))}}}function B(C){C.Statistics?.length&&"object"===typeof C.Statistics&&(C.Statistics=C.Statistics.map(M=>[M.min,M.max,M.mean,M.standardDeviation]));null!=C.NumberOfStandardDeviation&&(C.NumberOfStandardDeviations=
C.NumberOfStandardDeviation,delete C.NumberOfStandardDeviation)}function Q(C){C.NoDataValues?.length&&"string"===typeof C.NoDataValues[0]&&(C.NoDataValues=C.NoDataValues.filter(M=>""!==M).map(M=>Number(M)))}const O=new Map;O.set("Arithmetic",{desc:"Arithmetic Function",ctor:E,rasterArgumentNames:["rasters"]});O.set("Aspect",{desc:"Aspect Function",ctor:T,rasterArgumentNames:["raster"]});O.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:R,rasterArgumentNames:["raster"]});O.set("Colormap",
{desc:"Colormap Function",ctor:J,rasterArgumentNames:["raster"]});O.set("CompositeBand",{desc:"CompositeBand Function",ctor:p,rasterArgumentNames:["rasters"]});O.set("Convolution",{desc:"Convolution Function",ctor:d,rasterArgumentNames:["raster"]});O.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:u,rasterArgumentNames:["raster"]});O.set("ExtractBand",{desc:"ExtractBand Function",ctor:k,rasterArgumentNames:["raster"]});O.set("Curvature",{desc:"Curvature Function",ctor:g,rasterArgumentNames:["raster"]});
O.set("Grayscale",{desc:"Grayscale Function",ctor:n,rasterArgumentNames:["raster"]});O.set("Clip",{desc:"Clip Function",ctor:P,rasterArgumentNames:["raster"]});O.set("Local",{desc:"Local Function",ctor:h,rasterArgumentNames:["rasters"]});O.set("Mask",{desc:"Mask Function",ctor:q,rasterArgumentNames:["raster"]});O.set("NDVI",{desc:"NDVI Function",ctor:t,rasterArgumentNames:["raster"]});O.set("Remap",{desc:"Remap Function",ctor:x,rasterArgumentNames:["raster"]});O.set("Slope",{desc:"Slope Function",
ctor:b,rasterArgumentNames:["raster"]});O.set("Statistics",{desc:"Focal Statistics Function",ctor:e,rasterArgumentNames:["raster"]});O.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:a,rasterArgumentNames:["raster"]});O.set("Stretch",{desc:"Stretch Function",ctor:c,rasterArgumentNames:["raster"]});O.set("Table",{desc:"Attribute Table Function",ctor:f,rasterArgumentNames:["raster"]});m.create=function(C,M){M=M??{};C=L.clone(C);if("function"in C&&"arguments"in C&&C.arguments){const N=
new Map;C=G(C,N,M);A(C);if(!C.renderingRule)throw new w("raster-function-helper","Unsupported raster function json.");C=C.renderingRule}if("rasterFunction"in C)return C=y(C),F(C,M);throw new w("raster-function-helper","unsupported raster function json.");};m.getPrimaryRasterUrls=l;m.getRasterValues=r;m.getSupportedFunctions=function(){const C=new Set;O.forEach((M,N)=>C.add(N));return C};m.register=function(C,M,N=["raster"],U=""){O.set(C,{desc:U,ctor:M,rasterArgumentNames:N})};Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/ArithmeticFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./ArithmeticFunctionArguments ./BaseRasterFunction ./localUtils".split(" "),function(m,v,w,L,E,T,R,P,J,p){w=class extends J{constructor(){super(...arguments);this.functionName=
"Arithmetic";this.functionArguments=null;this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){var {operation:u}=this.functionArguments;if(1>u||6<u)return{success:!1,supportsGPU:!1,error:"unsupported operation"};u=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(u.pixelType);u.pixelType=this.outputPixelType;this._removeStatsHistColormapVAT(u);this.rasterInfo=u;return{success:!0,supportsGPU:3>=u.bandCount}}_processPixels(u){({pixelBlocks:u}=u);return null==
u?.[0]||null==u?.[1]?null:p.arithmetic(u,this.functionArguments.operation,this.outputPixelType)}_getWebGLParameters(){var {operation:u}=this.functionArguments;u=" plus minus times divide power mod".split(" ")[u];var d=this.outputPixelType??"f32";let [g,k]=R.getPixelValueRange(d);if(d=R.isIntegerPixelType(d))g-=1E-4,k+=1E-4;return{imageCount:2,operationName:u,domainRange:[g,k],isOutputRounded:d}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);
m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ArithmeticFunction")],w)})},"esri/layers/support/rasterFunctions/ArithmeticFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;w=P=class extends R{constructor(){super(...arguments);this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new P({raster:this.raster,raster2:this.raster2,operation:this.operation})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,"operation",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"raster2",void 0);m.__decorate([v.property({readOnly:!0})],w.prototype,"rasters",null);return w=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ArithmeticFunctionArguments")],
w)})},"esri/layers/support/rasterFunctions/BaseFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(m,v,w,L,E,T,R){v=class extends v.JSONSupport{constructor(){super(...arguments);this.raster=void 0}};m.__decorate([w.property({json:{write:!0}})],v.prototype,"raster",void 0);return v=
m.__decorate([R.subclass("esri.layers.support.rasterFunctions.AspectFunctionArguments")],v)})},"esri/layers/support/rasterFunctions/BaseRasterFunction":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../PixelBlock ../RasterInfo".split(" "),function(m,v,w,L,E,T,R,P,J){const p=new Set("slope aspect curvature hillshade shadedrelief statistics".split(" "));
v=class extends v.JSONSupport{constructor(){super(...arguments);this.functionArguments=null;this.readingBufferSize=0;this.id=-1;this.isNoopProcess=!1;this.rawInputBandIds=[];this.rawSourceRasterInfos=null;this.isInputBandIdsSwizzled=!1;this.swizzledBandSelection=[];this.isBranch=!1;this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){var u=this.getWebGLProcessorDefinition();if(!u)return null;const d=[u];({parameters:u}=u);for(u=u.rasters||
u.raster&&[u.raster];u?.length;){d.unshift(...u);var g=[];for(var k=0;k<u.length;k++){var {parameters:n}=u[k];n=n.rasters||n.raster&&[n.raster];n?.length&&g.push(...n)}u=g}for(u=d.length-1;0<=u;u--)d[u].isNoopProcess&&d.splice(u,1);u=!1;for(g=0;g<d.length;g++)k=d[g],k.id=d.length-g-1,{rasters:k}=k.parameters,u=u||null!=k&&1<k.length;g=d.some(({name:h})=>p.has(h.toLowerCase()));({rawSourceRasterInfos:k}=this);return{functions:d,hasBranches:u,hasFocalFunction:g,isSourceSingleBand:1===k?.[0]?.bandCount}}bind(u,
d=!1,g=-1){this.id=g+1;g=this._getRasterValues();let k=!0;for(let h=0;h<g.length;h++){var n=g[h];if(null!=n&&this._isRasterFunctionValue(n)){n=n.bind(u,d,this.id+h);if(!n.success)return this._bindingResult=n;k=k&&n.supportsGPU}}if(!this.rasterInfo||d)return this.sourceRasterInfos=this._getSourceRasterInfos(u),this._bindingResult=this._bindSourceRasters(),this._bindingResult.success&&this._patchRasterInfo(),this._bindingResult.supportsGPU=k&&this._bindingResult.supportsGPU,this.processInputBandIds(),
this._bindingResult;this._bindingResult={success:!0,supportsGPU:!0};this.processInputBandIds();return this._bindingResult}process(u){var d=this._getRasterValues();d=0===d.length?u.pixelBlocks??u.primaryPixelBlocks:d.map(g=>this._readRasterValue(g,u));return this._processPixels({...u,pixelBlocks:d})}processInputBandIds(){var u=this._getRasterValues().filter(this._isRasterFunctionValue);if(1<u.length)return this.rawInputBandIds=u.map(g=>g.processInputBandIds()[0]),this.isInputBandIdsSwizzled=this.rawInputBandIds.some((g,
k)=>g!==k),u=u.filter(g=>"ExtractBand"===g.functionName),u.length&&u.forEach((g,k)=>{g.isInputBandIdsSwizzled=!0;g.swizzledBandSelection=[k,k,k]}),this.rawInputBandIds;var d=u[0];if(d){if(u=d.processInputBandIds(),d.isInputBandIdsSwizzled)return this.rawInputBandIds=u}else{u=[];({bandCount:d}=this.sourceRasterInfos[0]);for(let g=0;g<d;g++)u.push(g)}u=this._getInputBandIds(u);this.isInputBandIdsSwizzled=u.some((g,k)=>g!==k);return this.rawInputBandIds=u}getPrimaryRasters(){const u=[],d=[];this._getPrimaryRasters(this,
u,d);return{rasters:u,rasterIds:d}}getWebGLProcessorDefinition(){const u=this._getWebGLParameters(),{raster:d,rasters:g}=this.functionArguments;g&&Array.isArray(g)&&g.length?(u.rasters=g.map(k=>this._isRasterFunctionValue(k)?k.getWebGLProcessorDefinition():"number"===typeof k?{name:"Constant",parameters:{value:k},pixelType:"f32",id:-1,isNoopProcess:!1}:{name:"Identity",parameters:{value:k},pixelType:"f32",id:-1,isNoopProcess:!1}),u.rasters.some(k=>null!=k)||(u.rasters=null)):this._isRasterFunctionValue(d)&&
(u.raster=d.getWebGLProcessorDefinition());return{name:this.functionName,parameters:u,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){const u=[];"Clip"===this.functionName&&u.push(this.functionArguments);const {raster:d,rasters:g}=this.functionArguments;if(g&&Array.isArray(g)&&g.length)g.forEach(k=>{this._isRasterFunctionValue(k)&&(k=k.getClippingGeometries(),u.push(...k))});else if(this._isRasterFunctionValue(d)){const k=d.getClippingGeometries();
u.push(...k)}return u}_getOutputPixelType(u){return"unknown"===this.outputPixelType?u:this.outputPixelType??u}_getWebGLParameters(){return{}}_getInputBandIds(u){return u}_removeStatsHistColormapVAT(u){u.statistics=null;u.histograms=null;u.colormap=null;u.attributeTable=null}_getRasterValues(){const {rasterArgumentNames:u}=this;return"rasters"===u[0]?this.functionArguments.rasters??[]:u.flatMap(d=>this.functionArguments[d])}_getSourceRasterInfos(u){const d=this._getRasterValues(),{rasterInfos:g,rasterIds:k}=
u;if(0===d.length)return g;const n=d.map(q=>{if(q&&"object"===typeof q&&"bind"in q&&q.rasterInfo)return q.rasterInfo;if("string"===typeof q&&k.includes(q))return g[k.indexOf(q)];if("number"!==typeof q)return g[0]}),h=n.find(q=>q)??g[0];n.forEach((q,t)=>{void 0===q&&(n[t]=h)});return n}_getPrimaryRasterId(u){return u?.rasterId}_getPrimaryRasters(u,d=[],g=[]){for(let n=0;n<u.sourceRasters.length;n++){var k=u.sourceRasters[n];if("number"!==typeof k)if("bind"in k)this._getPrimaryRasters(k,d,g);else{const h=
this._getPrimaryRasterId(k);null==h||g.includes(h)||(this.mainPrimaryRasterId===h?(d.unshift(k),g.unshift(h)):(d.push(k),g.push(h)))}}}_isRasterFunctionValue(u){return null!=u&&"object"===typeof u&&"getWebGLProcessorDefinition"in u}_readRasterValue(u,d){var {primaryPixelBlocks:g}=d;if(null==u||"$$"===u)return u=g[0],null==u?null:u.clone();if("string"===typeof u)return u=d.primaryRasterIds.indexOf(u),-1===u?null:g[u];if("number"===typeof u){g=g[0];if(null==g)return null;const {width:k,height:n,pixelType:h}=
g;g=new Float32Array(k*n);g.fill(u);u=Array(this.sourceRasterInfos[0].bandCount).fill(g);return new P({width:k,height:n,pixelType:h,pixels:u})}return u.process(d)}_patchRasterInfo(){const {rasterInfo:u}=this;if(u?.keyProperties){var {bandCount:d,keyProperties:g,statistics:k,histograms:n}=u,h=g.BandProperties;h&&h.length!==d&&(u.keyProperties={...g,BandProperties:void 0});k&&k.length!==d&&(u.statistics=k.length>d?k.slice(0,d):null);n&&n.length!==d&&(u.histograms=n.length>d?n.slice(0,d):null);g.BAND_COUNT&&
Number(g.BAND_COUNT)!==d&&(u.keyProperties={...g,BAND_COUNT:"string"===typeof g.BAND_COUNT?String(d):d})}}};m.__decorate([w.property({json:{write:!0}})],v.prototype,"functionName",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,"functionArguments",void 0);m.__decorate([w.property()],v.prototype,"rasterArgumentNames",void 0);m.__decorate([w.property({json:{write:!0}}),L.cast(u=>u?.toLowerCase())],v.prototype,"outputPixelType",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,
"mainPrimaryRasterId",void 0);m.__decorate([w.property()],v.prototype,"sourceRasters",void 0);m.__decorate([w.property({type:[J],json:{write:!0}})],v.prototype,"sourceRasterInfos",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,"rasterInfo",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,"readingBufferSize",void 0);m.__decorate([w.property({json:{write:!0}})],v.prototype,"id",void 0);m.__decorate([w.property()],v.prototype,"isNoopProcess",void 0);m.__decorate([w.property()],
v.prototype,"supportsGPU",null);m.__decorate([w.property()],v.prototype,"rawInputBandIds",void 0);m.__decorate([w.property()],v.prototype,"rawSourceRasterInfos",void 0);m.__decorate([w.property()],v.prototype,"isInputBandIdsSwizzled",void 0);m.__decorate([w.property()],v.prototype,"swizzledBandSelection",void 0);m.__decorate([w.property()],v.prototype,"isBranch",void 0);m.__decorate([w.property({readOnly:!0})],v.prototype,"flatWebGLFunctionChain",null);m.__decorate([w.property()],v.prototype,"_bindingResult",
void 0);return v=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.BaseRasterFunction")],v)})},"esri/layers/support/RasterInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ./RasterBandInfo ./RasterSensorInfo ./RasterStorageInfo".split(" "),function(m,v,w,L,E,T,R,P,J,p,u,
d){var g;v=g=class extends v.JSONSupport{constructor(k){super(k);this.extent=this.colormap=this.bandCount=this.attributeTable=null;this.format=void 0;this.histograms=this.width=this.height=null;this.keyProperties={};this.pixelType=this.pixelSize=this.noDataValue=this.multidimensionalInfo=null;this.isPseudoSpatialReference=!1;this.transform=this.storageInfo=this.statistics=this.spatialReference=null}get bandInfos(){var k=this.keyProperties.BandProperties,{bandCount:n}=this;if(!k?.length||k.length<
n){k=[];for(let h=1;h<=n;h++)k.push(new p({name:"band_"+h}));return k}n=k.map(h=>p.fromJSON(h));for(k=0;k<n.length;k++)n[k].name=n[k].name||"band_"+(k+1);return n}get dataType(){const k=this.keyProperties?.DataType?.toLowerCase()??"generic";return"stdtime"===k?"standard-time":k}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(k){k&&this._set("nativeExtent",k)}get nativePixelSize(){if(null==this.transform||!this.transform.affectsPixelSize)return this.pixelSize;const k=
this.nativeExtent;return{x:k.width/this.width,y:k.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return u.fromJSON(this.keyProperties)}clone(){return new g({attributeTable:w.clone(this.attributeTable),bandCount:this.bandCount,colormap:w.clone(this.colormap),extent:w.clone(this.extent),nativePixelSize:w.clone(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:w.clone(this.histograms),
keyProperties:w.clone(this.keyProperties),multidimensionalInfo:w.clone(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:w.clone(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:w.clone(this.spatialReference),statistics:w.clone(this.statistics),storageInfo:w.clone(this.storageInfo),transform:w.clone(this.transform)})}};m.__decorate([L.property({json:{write:!0}})],v.prototype,"attributeTable",void 0);m.__decorate([L.property({json:{write:!0}})],
v.prototype,"bandCount",void 0);m.__decorate([L.property({readOnly:!0})],v.prototype,"bandInfos",null);m.__decorate([L.property({json:{write:!0}})],v.prototype,"colormap",void 0);m.__decorate([L.property({type:String,readOnly:!0})],v.prototype,"dataType",null);m.__decorate([L.property({type:P,json:{write:!0}})],v.prototype,"extent",void 0);m.__decorate([L.property({type:P,json:{write:!0}})],v.prototype,"nativeExtent",null);m.__decorate([L.property({json:{write:!0}})],v.prototype,"nativePixelSize",
null);m.__decorate([L.property({json:{write:!0}})],v.prototype,"format",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"height",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"width",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"hasMultidimensionalTranspose",null);m.__decorate([L.property({json:{write:!0}})],v.prototype,"histograms",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"keyProperties",void 0);m.__decorate([L.property({json:{write:!0}})],
v.prototype,"multidimensionalInfo",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"noDataValue",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"pixelSize",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"pixelType",void 0);m.__decorate([L.property()],v.prototype,"isPseudoSpatialReference",void 0);m.__decorate([L.property({readOnly:!0})],v.prototype,"sensorInfo",null);m.__decorate([L.property({type:J,json:{write:!0}})],v.prototype,"spatialReference",
void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"statistics",void 0);m.__decorate([L.property({type:d,json:{write:!0}})],v.prototype,"storageInfo",void 0);m.__decorate([L.property({json:{write:!0}})],v.prototype,"transform",void 0);return v=g=m.__decorate([R.subclass("esri.layers.support.RasterInfo")],v)})},"esri/layers/support/RasterBandInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(m,v,w,L,E,T,R){function P(p){p=Number(p);return isNaN(p)?void 0:p}var J;v=J=class extends v.JSONSupport{constructor(){super(...arguments);this.name=null;this.solarIrradiance=this.reflectanceGain=this.reflectanceBias=this.radianceGain=this.radianceBias=this.maxWavelength=this.minWavelength=void 0}clone(){return new J({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,
reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};m.__decorate([w.property({json:{name:"BandName",write:!0}})],v.prototype,"name",void 0);m.__decorate([w.property({json:{name:"WavelengthMin",read:{reader:P},write:!0}})],v.prototype,"minWavelength",void 0);m.__decorate([w.property({json:{name:"WavelengthMax",read:{reader:P},write:!0}})],v.prototype,"maxWavelength",void 0);m.__decorate([w.property({json:{name:"RadianceBias",read:{reader:P},write:!0}})],v.prototype,"radianceBias",
void 0);m.__decorate([w.property({json:{name:"RadianceGain",read:{reader:P},write:!0}})],v.prototype,"radianceGain",void 0);m.__decorate([w.property({json:{name:"ReflectanceBias",read:{reader:P},write:!0}})],v.prototype,"reflectanceBias",void 0);m.__decorate([w.property({json:{name:"ReflectanceGain",read:{reader:P},write:!0}})],v.prototype,"reflectanceGain",void 0);m.__decorate([w.property({json:{name:"SolarIrradiance",read:{reader:P},write:!0}})],v.prototype,"solarIrradiance",void 0);return v=J=
m.__decorate([R.subclass("esri.layers.support.RasterBandInfo")],v)})},"esri/layers/support/RasterSensorInfo":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer".split(" "),function(m,v,w,L,E,T,R,P,J){function p(d){d=Number(d);return isNaN(d)?void 0:
d}var u;v=u=class extends v.JSONSupport{constructor(){super(...arguments);this.productName=this.cloudCover=this.acquisitionDate=void 0;this.sensorName=null;this.sunElevation=this.sunAzimuth=this.sensorElevation=this.sensorAzimuth=void 0}readAcquisitionDate(d){return new Date(d)}writeAcquisitionDate(d,g){g.AcquisitionDate=d.getTime()}clone(){return new u({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,
sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};m.__decorate([w.property({json:{name:"AcquisitionDate",write:!0}})],v.prototype,"acquisitionDate",void 0);m.__decorate([R.reader("acquisitionDate")],v.prototype,"readAcquisitionDate",null);m.__decorate([J.writer("acquisitionDate")],v.prototype,"writeAcquisitionDate",null);m.__decorate([w.property({json:{name:"CloudCover",read:{reader:p},write:!0}})],v.prototype,"cloudCover",void 0);m.__decorate([w.property({json:{name:"ProductName",
write:!0}})],v.prototype,"productName",void 0);m.__decorate([w.property({json:{name:"SensorName",write:!0}})],v.prototype,"sensorName",void 0);m.__decorate([w.property({json:{name:"SensorAzimuth",read:{reader:p},write:!0}})],v.prototype,"sensorAzimuth",void 0);m.__decorate([w.property({json:{name:"SensorElevation",read:{reader:p},write:!0}})],v.prototype,"sensorElevation",void 0);m.__decorate([w.property({json:{name:"SunAzimuth",read:{reader:p},write:!0}})],v.prototype,"sunAzimuth",void 0);m.__decorate([w.property({json:{name:"SunElevation",
read:{reader:p},write:!0}})],v.prototype,"sunElevation",void 0);return v=u=m.__decorate([P.subclass("esri.layers.support.RasterSensorInfo")],v)})},"esri/layers/support/rasterFunctions/localUtils":function(){define(["exports","../PixelBlock","../rasterFunctionConstants","../rasterFormats/pixelRangeUtils"],function(m,v,w,L){function E(ba,ia=!1){var da=ba.map(ha=>ha.mask);const ka=da.filter(ha=>null!=ha);ba=ba[0].pixels[0].length;if(0===ka.length||ia&&ka.length!==da.length)return(new Uint8Array(ba)).fill(255);
da=new Uint8Array(ka[0]);if(1===ka.length)return da;if(!ia){for(ia=1;ia<ka.length;ia++){ba=ka[ia];for(var ma=0;ma<da.length;ma++)da[ma]&&(da[ma]=ba[ma]?255:0)}return da}for(ia=1;ia<ka.length;ia++)for(ba=ka[ia],ma=0;ma<da.length;ma++)0===da[ma]&&(da[ma]=ba[ma]?255:0);return da}function T(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]+ma[ha];return da}function R(ba,ia,da){[ba]=ba;ia=v.createEmptyBand("f32",ba.length);ia.set(ba);
return ia}function P(ba,ia,da){[ba]=ba;const ka=ba.length;da=v.createEmptyBand(da,ka);for(let ma=0;ma<ka;ma++)if(!ia||ia[ma])da[ma]=ba[ma]*ba[ma];return da}function J(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]-ma[ha];return da}function p(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]*ma[ha];return da}function u(ba,ia,da){[ba]=ba;const ka=ba.length;
da=v.createEmptyBand(da,ka);for(let ma=0;ma<ka;ma++)if(!ia||ia[ma])da[ma]=Math.sign(ba[ma])*Math.floor(Math.abs(ba[ma]));return da}function d(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]/ma[ha];return da}function g(ba,ia,da){return d(ba,ia,"f32")}function k(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=Math.floor(ka[ha]/ma[ha]);return da}function n(ba,ia,
da,ka){ba=ba[0];const ma=ba.length;da=v.createEmptyBand(da,ma);if(ka===w.localTrigonometricOperation.atanh){for(ka=0;ka<ma;ka++)if(ia[ka]){var ha=ba[ka];1<=Math.abs(ha)?ia[ka]=0:da[ka]=Math.atanh(ha)}return da}ka=ka===w.localTrigonometricOperation.asin?Math.asin:Math.acos;for(ha=0;ha<ma;ha++)if(ia[ha]){const ta=ba[ha];1<Math.abs(ta)?ia[ha]=0:da[ha]=ka(ta)}return da}function h(ba,ia,da,ka){[ba]=ba;const ma=ba.length;da=v.createEmptyBand(da,ma);for(let ha=0;ha<ma;ha++)if(!ia||ia[ha])da[ha]=ka(ba[ha]);
return da}function q(ba,ia,da,ka){const [ma,ha]=ba;ba=ma.length;da=v.createEmptyBand(da,ba);for(let ta=0;ta<ba;ta++)if(!ia||ia[ta])da[ta]=ka(ma[ta],ha[ta]);return da}function t(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]&ma[ha];return da}function x(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]<<ma[ha];return da}function b(ba,ia,da){[ba]=ba;const ka=
ba.length;da=v.createEmptyBand(da,ka);for(let ma=0;ma<ka;ma++)if(!ia||ia[ma])da[ma]=~ba[ma];return da}function e(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]|ma[ha];return da}function a(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]>>ma[ha];return da}function c(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||
ia[ha])da[ha]=ka[ha]^ma[ha];return da}function f(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]&&ma[ha]?1:0;return da}function l(ba,ia,da){[ba]=ba;const ka=ba.length;da=v.createEmptyBand(da,ka);for(let ma=0;ma<ka;ma++)if(!ia||ia[ma])da[ma]=ba[ma]?0:1;return da}function r(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]||ma[ha]?1:0;return da}function z(ba,
ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=(ka[ha]?1:0)^(ma[ha]?1:0);return da}function y(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]===ma[ha]?1:0;return da}function F(ba,ia,da,ka){[ba]=ba;const ma=ba.length;da=v.createEmptyBand(da,ma);const ha=ka===Math.E;for(let ta=0;ta<ma;ta++)if(!ia||ia[ta])da[ta]=ha?Math.exp(ba[ta]):ka**ba[ta];return da}function K(ba,
ia,da){return F(ba,ia,da,10)}function H(ba,ia,da){return F(ba,ia,da,2)}function D(ba,ia,da){return F(ba,ia,da,Math.E)}function G(ba,ia,da,ka){[ba]=ba;const ma=ba.length;da=v.createEmptyBand(da,ma);for(let ha=0;ha<ma;ha++)if(!ia||ia[ha])0>=ba[ha]?ia[ha]=0:da[ha]=ka(ba[ha]);return da}function S(ba,ia,da){return G(ba,ia,da,Math.log10)}function A(ba,ia,da){return G(ba,ia,da,Math.log2)}function B(ba,ia,da){return G(ba,ia,da,Math.log)}function Q(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,
ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]>ma[ha]?1:0;return da}function O(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]>=ma[ha]?1:0;return da}function C(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]<ma[ha]?1:0;return da}function M(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=
ka[ha]<=ma[ha]?1:0;return da}function N(ba,ia,da){[ba]=ba;ba=ba.length;da=v.createEmptyBand(da,ba);if(!ia)return da;for(let ka=0;ka<ba;ka++)da[ka]=ia[ka]?0:1;return da}function U(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]%ma[ha];return da}function X(ba,ia,da){[ba]=ba;const ka=ba.length;da=v.createEmptyBand(da,ka);for(let ma=0;ma<ka;ma++)if(!ia||ia[ma])da[ma]=-ba[ma];return da}function I(ba,ia,da){const [ka,ma]=ba;ba=ka.length;
da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)if(!ia||ia[ha])da[ha]=ka[ha]===ma[ha]?0:1;return da}function V(ba,ia,da){const [ka,ma]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);const ha=new Uint8Array(ba);for(let ta=0;ta<ba;ta++)null!=ia&&!ia[ta]||0!==ka[ta]||(da[ta]=ma[ta],ha[ta]=255);return{band:da,mask:ha}}function W(ba,ia,da){const [ka,ma,ha]=ba;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ta=0;ta<ba;ta++)if(!ia||ia[ta])da[ta]=ka[ta]?ma[ta]:ha[ta];return da}function Z(ba,ia,da){const ka=
ba.length;if(2>ka)return ba[0];const [ma]=ba,ha=ma.length;da=v.createEmptyBand(da,ha);for(let ta=0;ta<ha;ta++)if(!ia||ia[ta]){let wa=ma[ta];for(let ya=1;ya<ka;ya++){const Ba=ba[ya][ta];wa<Ba&&(wa=Ba)}da[ta]=wa}return da}function Y(ba,ia,da){const ka=ba.length;if(2>ka)return ba[0];const [ma]=ba,ha=ma.length;da=v.createEmptyBand(da,ha);for(let ta=0;ta<ha;ta++)if(!ia||ia[ta]){let wa=ma[ta];for(let ya=1;ya<ka;ya++){const Ba=ba[ya][ta];wa>Ba&&(wa=Ba)}da[ta]=wa}return da}function aa(ba,ia,da){const ka=
ba.length;if(2>ka)return ba[0];const [ma]=ba,ha=ma.length;da=v.createEmptyBand(da,ha);for(let ta=0;ta<ha;ta++)if(!ia||ia[ta]){let wa=ma[ta],ya=wa;for(let Ba=1;Ba<ka;Ba++){const za=ba[Ba][ta];ya<za?ya=za:wa>za&&(wa=za)}da[ta]=ya-wa}return da}function ea(ba,ia,da){const ka=ba.length;if(2>ka)return ba[0];var [ma]=ba;ma=ma.length;da=v.createEmptyBand(da,ma);for(let ha=0;ha<ma;ha++)if(!ia||ia[ha]){let ta=0;for(let wa=0;wa<ka;wa++)ta+=ba[wa][ha];da[ha]=ta/ka}return da}function fa(ba,ia,da){const ka=ba.length;
if(2>ka)return ba[0];var [ma]=ba;ma=ma.length;da=v.createEmptyBand(da,ma);for(let ha=0;ha<ma;ha++)if(!ia||ia[ha])for(let ta=0;ta<ka;ta++)da[ha]+=ba[ta][ha];return da}function ca(ba,ia,da){const ka=ba.length;if(2>ka)return ba[0];var [ma]=ba;ma=ma.length;da=v.createEmptyBand(da,ma);for(let wa=0;wa<ma;wa++)if(!ia||ia[wa]){const ya=new Float32Array(ka);let Ba=0;for(var ha=0;ha<ka;ha++){var ta=ba[ha];Ba+=ta[wa];ya[ha]=ta[wa]}Ba/=ka;ha=0;for(ta=0;ta<ka;ta++)ha+=(ya[ta]-Ba)**2;da[wa]=Math.sqrt(ha/ka)}return da}
function ja(ba,ia,da){const ka=ba.length;if(2>ka)return ba[0];const ma=Math.floor(ka/2);var [ha]=ba;ha=ha.length;da=v.createEmptyBand(da,ha);const ta=new Float32Array(ka),wa=1===ka%2;for(let ya=0;ya<ha;ya++)if(!ia||ia[ya]){for(let Ba=0;Ba<ka;Ba++)ta[Ba]=ba[Ba][ya];ta.sort();da[ya]=wa?ta[ma]:(ta[ma]+ta[ma-1])/2}return da}function la(ba,ia,da){const [ka,ma]=ba;if(null==ma)return ka;ba=ka.length;da=v.createEmptyBand(da,ba);for(let ha=0;ha<ba;ha++)ia[ha]&&(ka[ha]===ma[ha]?da[ha]=ka[ha]:ia[ha]=0);return da}
function na(ba,ia,da){const ka=ba.length;if(2>=ka)return la(ba,ia,da);const ma=ba[0].length;da=v.createEmptyBand(da,ma);const ha=new Map;for(let wa=0;wa<ma;wa++)if(!ia||ia[wa]){ha.clear();let ya;for(var ta=0;ta<ka;ta++)ya=ba[ta][wa],ha.set(ya,ha.has(ya)?ha.get(ya)+1:1);let Ba=ta=0;for(const za of ha.keys())ta=ha.get(za),ta>Ba&&(Ba=ta,ya=za);da[wa]=ya}return da}function oa(ba,ia,da){const ka=ba.length;if(2>=ka)return la(ba,ia,da);const ma=ba[0].length;da=v.createEmptyBand(da,ma);const ha=new Map;for(let wa=
0;wa<ma;wa++)if(!ia||ia[wa]){ha.clear();let ya;for(var ta=0;ta<ka;ta++)ya=ba[ta][wa],ha.set(ya,ha.has(ya)?ha.get(ya)+1:1);ta=0;let Ba=ba.length;for(const za of ha.keys())ta=ha.get(za),ta<Ba&&(Ba=ta,ya=za);da[wa]=ya}return da}function qa(ba,ia,da){const ka=ba.length;if(2>ka)return ba[0];var [ma]=ba;ma=ma.length;da=v.createEmptyBand(da,ma);const ha=new Set;for(let ta=0;ta<ma;ta++)if(!ia||ia[ta]){ha.clear();let wa;for(let ya=0;ya<ka;ya++)wa=ba[ya][ta],ha.add(wa);da[ta]=ha.size}return da}function sa(ba,
ia,da,ka){let [ma,ha]=L.getPixelValueRange(da);if(da=L.isIntegerPixelType(da))ma-=1E-5,ha+=1E-5;for(let ta=0;ta<ia.length;ta++)if(ia[ta]){const wa=ba[ta];isNaN(wa)||wa<ma||wa>ha?ia[ta]=0:ka[ta]=da?Math.round(wa):wa}}function ra(ba,ia,da={}){pa.size||(pa.set(4,Math.sqrt),pa.set(6,Math.acos),pa.set(7,Math.asin),pa.set(8,Math.atan),pa.set(9,Math.atanh),pa.set(10,Math.abs),pa.set(21,Math.cos),pa.set(22,Math.cosh),pa.set(48,Math.floor),pa.set(49,Math.ceil),pa.set(51,Math.sin),pa.set(52,Math.sinh),pa.set(56,
Math.tan),pa.set(57,Math.tanh),pa.set(59,Math.acosh),pa.set(60,Math.asinh),pa.set(65,Math.floor),xa.set(5,Math.pow),xa.set(61,Math.atan2),va.set(1,T),va.set(2,J),va.set(3,p),va.set(11,t),va.set(12,x),va.set(13,b),va.set(14,e),va.set(15,a),va.set(16,c),va.set(17,f),va.set(18,l),va.set(19,r),va.set(20,z),va.set(23,d),va.set(24,y),va.set(25,D),va.set(26,K),va.set(27,H),va.set(28,Q),va.set(29,O),va.set(30,u),va.set(31,N),va.set(32,R),va.set(33,C),va.set(34,M),va.set(35,B),va.set(36,S),va.set(37,A),va.set(44,
U),va.set(45,X),va.set(46,I),va.set(53,P),va.set(64,g),va.set(65,k),va.set(76,W),va.set(78,W),Aa.set(38,na),Aa.set(39,Z),Aa.set(40,ea),Aa.set(41,ja),Aa.set(42,Y),Aa.set(43,oa),Aa.set(47,aa),Aa.set(54,ca),Aa.set(55,fa),Aa.set(58,qa),Aa.set(66,na),Aa.set(67,Z),Aa.set(68,ea),Aa.set(69,ja),Aa.set(70,Y),Aa.set(71,oa),Aa.set(72,aa),Aa.set(73,ca),Aa.set(74,fa),Aa.set(75,qa));var ka=E(ba,66<=ia&&75>=ia);const {outputPixelType:ma="f32"}=da,ha=!Aa.has(ia)||da.processAsMultiband,ta=ha?ba[0].pixels.length:1;
da=[];for(let Ba=0;Ba<ta;Ba++){var wa=Aa.has(ia)&&!ha?ba.flatMap(za=>za.pixels):ba.map(za=>za.pixels[Ba]),ya=!0;ia===w.localConditionalOperation.setNull?(ka=V(wa,ka,ma),wa=ka.band,ka=ka.mask,ya=!1):va.has(ia)?wa=va.get(ia)(wa,ka,"f64"):pa.has(ia)?wa=ia===w.localTrigonometricOperation.asin||ia===w.localTrigonometricOperation.acos||ia===w.localTrigonometricOperation.atanh?n(wa,ka,"f64",ia):h(wa,ka,"f64",pa.get(ia)):xa.has(ia)?wa=q(wa,ka,"f64",xa.get(ia)):Aa.has(ia)?wa=Aa.get(ia)(wa,ka,"f64"):(wa=wa[0],
ya=!1);ya&&ia!==w.localLogicalOperation.isNull&&!ua.has(ia)&&(ya=v.createEmptyBand(ma,wa.length),ka||=(new Uint8Array(wa.length)).fill(255),sa(wa,ka,ma,ya),wa=ya);da.push(wa)}ba=ba[0];return new v({width:ba.width,height:ba.height,pixelType:ma,mask:ia===w.localLogicalOperation.isNull?null:ka,pixels:da})}const ua=new Map([[w.localTrigonometricOperation.acos,{domain:[0,Math.PI],isInteger:!1}],[w.localTrigonometricOperation.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[w.localTrigonometricOperation.atan,
{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[w.localTrigonometricOperation.cos,{domain:[-1,1],isInteger:!1}],[w.localTrigonometricOperation.sin,{domain:[-1,1],isInteger:!1}],[w.localLogicalOperation.booleanAnd,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.booleanNot,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.booleanOr,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.booleanXOr,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.equalTo,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.notEqual,
{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.greaterThan,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.greaterThanEqual,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.lessThan,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.lessThanEqual,{domain:[0,1],isInteger:!0}],[w.localLogicalOperation.isNull,{domain:[0,1],isInteger:!0}]]),pa=new Map,xa=new Map,va=new Map,Aa=new Map;m.arithmetic=function(ba,ia,da){ia=[null,1,2,3,23,5,44][ia]??1;return ra(ba,ia,{outputPixelType:da})};
m.getOutputDomain=function(ba){return ua.get(ba)};m.local=ra;m.operandsCount=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctionConstants":function(){define(["exports"],function(m){const v={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,
exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65},w={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},L={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},E={majority:38,
max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75},T={setNull:50,conditional:78},R={...v,...w,...L,...E,...T};m.arithmeticOperation={plus:1,minus:2,multiply:3,divide:4,power:5,mod:6};m.bandIndexType={userDefined:0,NDVI:1,SAVI:2,TSAVI:3,MSAVI:4,GEMI:5,PVI:6,GVITM:7,
Sultan:8,VARI:9,GNDVI:10,SR:11,NDVIRe:12,SRRe:13,MTVI2:14,RTVICore:15,CIRe:16,CIG:17,NDWI:18,EVI:19,ironOxide:20,ferrousMinerals:21,clayMinerals:22,WNDWI:23,BAI:24,NBR:25,NDBI:26,NDMI:27,NDSI:28,MNDWI:29};m.cellStatisticalOperation=E;m.clippingType={outside:1,inside:2};m.colorRampName={aspect:"Aspect",blackToWhite:"Black to White",blueBright:"Blue Bright",blueLightToDark:"Blue Light to Dark",blueGreenBright:"Blue-Green Bright",blueGreenLightToDark:"Blue-Green Light to Dark",brownLightToDark:"Brown Light to Dark",
brownToBlueGreenDivergingBright:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark:"Brown to Blue Green Diverging, Dark",coefficientBias:"Coefficient Bias",coldToHotDiverging:"Cold to Hot Diverging",conditionNumber:"Condition Number",cyanToPurple:"Cyan to Purple",cyanLightToBlueDark:"Cyan-Light to Blue-Dark",distance:"Distance",elevation1:"Elevation #1",elevation2:"Elevation #2",errors:"Errors",grayLightToDark:"Gray Light to Dark",greenBright:"Green Bright",greenLightToDark:"Green Light to Dark",
greenToBlue:"Green to Blue",orangeBright:"Orange Bright",orangeLightToDark:"Orange Light to Dark",partialSpectrum:"Partial Spectrum",partialSpectrum1Diverging:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark:"Pink to YellowGreen Diverging, Dark",precipitation:"Precipitation",prediction:"Prediction",purpleBright:"Purple Bright",purpleToGreenDivergingBright:"Purple to Green Diverging, Bright",
purpleToGreenDivergingDark:"Purple to Green Diverging, Dark",purpleBlueBright:"Purple-Blue Bright",purpleBlueLightToDark:"Purple-Blue Light to Dark",purpleRedBright:"Purple-Red Bright",purpleRedLightToDark:"Purple-Red Light to Dark",redBright:"Red Bright",redLightToDark:"Red Light to Dark",redToBlueDivergingBright:"Red to Blue Diverging, Bright",redToBlueDivergingDark:"Red to Blue Diverging, Dark",redToGreen:"Red to Green",redToGreenDivergingBright:"Red to Green Diverging, Bright",redToGreenDivergingDark:"Red to Green Diverging, Dark",
slope:"Slope",spectrumFullBright:"Spectrum-Full Bright",spectrumFullDark:"Spectrum-Full Dark",spectrumFullLight:"Spectrum-Full Light",surface:"Surface",temperature:"Temperature",whiteToBlack:"White to Black",yellowToDarkRed:"Yellow to Dark Red",yellowToGreenToDarkBlue:"Yellow to Green to Dark Blue",yellowToRed:"Yellow to Red",yellowGreenBright:"Yellow-Green Bright",yellowGreenLightToDark:"Yellow-Green Light to Dark"};m.colormapName={random:"Random",NDVI:"NDVI",NDVI2:"NDVI2",NDVI3:"NDVI3",elevation:"Elevation",
gray:"Gray",hillshade:"Hillshade"};m.convolutionKernel={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255};m.curvatureType=
{standard:0,platform:1,profile:2};m.localArithmeticOperation=v;m.localConditionalOperation=T;m.localLogicalOperation=w;m.localOperators=R;m.localTrigonometricOperation=L;m.missingBandAction={bestMatch:0,fail:1};m.noDataInterpretation={matchAny:0,matchAll:1};m.slopeType={degree:1,percentRise:2,adjusted:3};m.statisticsType={min:1,max:2,mean:3,standardDeviation:4,median:5,majority:6,minority:7};m.stretchType={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/AspectFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./AspectFunctionArguments ./BaseRasterFunction ./surfaceUtils".split(" "),function(m,v,w,L,E,T,R,P,J){w=class extends P{constructor(){super(...arguments);this.functionName="Aspect";this.functionArguments=
null;this.rasterArgumentNames=["raster"];this.isGCS=!1}_bindSourceRasters(){var p=this.sourceRasterInfos[0];this.isGCS=p.spatialReference?.isGeographic??!1;this.outputPixelType=this._getOutputPixelType("f32");p=p.clone();p.pixelType=this.outputPixelType;p.statistics=[{min:-1,max:360,avg:180,stddev:30}];p.histograms=null;p.colormap=null;p.attributeTable=null;p.bandCount=1;this.rasterInfo=p;return{success:!0,supportsGPU:!0}}_processPixels(p){const u=p.pixelBlocks?.[0];if(null==u)return null;const {extent:d,
primaryPixelSizes:g}=p;p=g?.[0];return J.aspect(u,{resolution:null==p?d?{x:d.width/u.width,y:d.height/u.height}:{x:1,y:1}:p})}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:R,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"isGCS",void 0);return w=
m.__decorate([T.subclass("esri.layers.support.rasterFunctions.AspectFunction")],w)})},"esri/layers/support/rasterFunctions/AspectFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),function(m,v,w,L,E,T,R){var P;v=P=class extends R{clone(){return new P({raster:this.raster})}};return v=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.AspectFunctionArguments")],
v)})},"esri/layers/support/rasterFunctions/surfaceUtils":function(){define(["exports","../PixelBlock","./pixelUtils"],function(m,v,w){function L(P){let {altitude:J,azimuth:p}=P;const {hillshadeType:u,pixelSizePower:d=1,pixelSizeFactor:g=1,scalingType:k,isGCS:n,resolution:h}=P;var q="multi-directional"===u?2*P.zFactor:P.zFactor;const {x:t,y:x}=h;P=q/(8*t);var b=q/(8*x);n&&.001<q&&(P/=R,b/=R);"adjusted"===k&&(n?(P=t*R,b=x*R,P=(q+P**d*g)/(8*P),b=(q+b**d*g)/(8*b)):(P=(q+t**d*g)/(8*t),b=(q+x**d*g)/(8*
x)));var e=(90-J)*Math.PI/180;q=Math.cos(e);let a=(360-p+90)*Math.PI/180,c=Math.sin(e)*Math.cos(a);e=Math.sin(e)*Math.sin(a);const f=[315,270,225,360,180,0],l=[60,60,60,60,60,90];var r=new Float32Array([3,5,3,2,1,4]);const z=r.reduce((D,G)=>D+G);r=r.map(D=>D/z);const y="multi-directional"===u?f.length:1,F=new Float32Array(6),K=new Float32Array(6),H=new Float32Array(6);if("multi-directional"===u)for(let D=0;D<y;D++)J=l[D],p=f[D],e=(90-J)*Math.PI/180,q=Math.cos(e),a=(360-p+90)*Math.PI/180,c=Math.sin(e)*
Math.cos(a),e=Math.sin(e)*Math.sin(a),F[D]=q,K[D]=c,H[D]=e;else F.fill(q),K.fill(c),H.fill(e);return{resolution:h,factor:[P,b],sinZcosA:c,sinZsinA:e,cosZ:q,sinZcosAs:K,sinZsinAs:H,cosZs:F,weights:r,hillshadeType:["traditional","multi-directional"].indexOf(u)}}function E(P,J){const {width:p,height:u}=P;var d=p*u;const g=new Uint8Array(d),k=null!=P.mask;let n;if(k){n=new Uint8Array(P.mask);for(var h=0;h<n.length;h++)n[h]&&(g[h]=1,n[h]=1)}P=P.pixels[0];h=new Float32Array(d);const q=new Float32Array(d);
let t=0;if(J){({resolution:x}=J);var x=x?(x.x+x.y)/2:1;t=200*J.zFactor/(x*x);x=new Float32Array(d)}J=J?.curvatureType;let b;let e;for(d=1;d<u-1;d++){const F=d*p;for(let K=1;K<p-1;K++){const H=F+K;if(!n||0!==n[H]){if(n){if(7>n[H-p-1]+n[H-p]+n[H-p+1]+n[H-1]+n[H+1]+n[H+p-1]+n[H+p]+n[H+p+1]){g[H]=0;continue}var a=n[H-p-1]?P[H-p-1]:P[H];var c=n[H-p]?P[H-p]:P[H];var f=n[H-p+1]?P[H-p+1]:P[H];var l=n[H-1]?P[H-1]:P[H];var r=n[H+1]?P[H+1]:P[H];b=n[H+p-1]?P[H+p-1]:P[H];var z=n[H+p]?P[H+p]:P[H];e=n[H+p+1]?P[H+
p+1]:P[H]}else a=P[H-p-1],c=P[H-p],f=P[H-p+1],l=P[H-1],r=P[H+1],b=P[H+p-1],z=P[H+p],e=P[H+p+1];h[H]=f+r+r+e-(a+l+l+b);q[H]=b+z+z+e-(a+c+c+f);if(null!=x){var y=P[H];const D=.5*(l+r)-y;y=.5*(c+z)-y;"standard"===J?x[H]=-t*(D+y):(a=(-a+f+b-e)/4,l=(-l+r)/2,c=(c-z)/2,z=l*l,r=c*c,(f=z+r)&&(x[H]="profile"===J?t*(D*z+y*r+a*l*c)/f:-t*(D*r+y*z-a*l*c)/f))}}}}return{outMask:k?g:null,dzxs:h,dzys:q,curvatures:x}}function T(P,J,p){for(var u=0;u<p;u++)P[u*J]=P[u*J+1],P[(u+1)*J-1]=P[(u+1)*J-2];for(u=1;u<J-1;u++)P[u]=
P[u+J],P[u+(p-1)*J]=P[u+(p-2)*J]}const R=1/111E3;m.aspect=function(P,J={}){if(!w.isValidPixelBlock(P))return P;var {resolution:p}=J;J=p?1/p.x:1;p=p?1/p.y:1;const {dzxs:u,dzys:d,outMask:g}=E(P),{width:k,height:n}=P,h=new Float32Array(k*n);for(let t=1;t<n-1;t++){const x=t*k;for(let b=1;b<k-1;b++){var q=x+b;if(!g||g[q]){const e=u[q]*J;q=d[q]*p;let a=-1;if(0!==e||0!==q)a=90-57.29578*Math.atan2(q,-e),0>a&&(a+=360),360===a?a=0:360<a&&(a%=360);h[x+b]=a}}}T(h,k,n);return new v({width:k,height:n,pixels:[h],
mask:g,pixelType:"f32",validPixelCount:P.validPixelCount,statistics:[{minValue:-1,maxValue:360}]})};m.calculateHillshadeParams=L;m.curvature=function(P,J){if(!w.isValidPixelBlock(P))return P;const {curvatures:p,outMask:u}=E(P,J),{width:d,height:g}=P;T(p,d,g);P=new v({width:d,height:g,pixels:[p],mask:u,pixelType:"f32",validPixelCount:P.validPixelCount});P.updateStatistics();return P};m.gcsFactor=R;m.hillshade=function(P,J){if(!w.isValidPixelBlock(P))return P;const {factor:p,sinZcosA:u,sinZsinA:d,cosZ:g,
sinZcosAs:k,sinZsinAs:n,cosZs:h,weights:q}=L(J),[t,x]=p;J="traditional"===J.hillshadeType;const {width:b,height:e}=P,a=new Uint8Array(b*e),{dzxs:c,dzys:f,outMask:l}=E(P);for(let z=1;z<e-1;z++){const y=z*b;for(let F=1;F<b-1;F++){const K=y+F;if(!l||l[K]){var r=c[K]*t;const H=f[K]*x,D=Math.sqrt(1+r*r+H*H);let G=0;if(J)r=255*(g+d*H-u*r)/D,0>r&&(r=0),G=r;else{const S=n.length;for(let A=0;A<S;A++){let B=255*(h[A]+n[A]*H-k[A]*r)/D;0>B&&(B=0);G+=B*q[A]}}a[K]=G&255}}}T(a,b,e);return new v({width:b,height:e,
pixels:[a],mask:l,pixelType:"u8",validPixelCount:P.validPixelCount,statistics:[{minValue:0,maxValue:255}]})};m.slope=function(P,J){if(!w.isValidPixelBlock(P))return P;var p=J.zFactor,u=J.pixelSizePower??1,d=J.pixelSizeFactor??1;const g=J.slopeType;var k=J.isGCS;const {x:n,y:h}=J.resolution;J=p/(8*n);let q=p/(8*h);k&&1E-4>Math.abs(p-1)&&(J/=R,q/=R);"adjusted"===g&&(J=(p+n**u*d)/(8*n),q=(p+h**u*d)/(8*h));const {dzxs:t,dzys:x,outMask:b}=E(P),{width:e,height:a}=P;p=new Float32Array(e*a);for(u=1;u<a-1;u++)for(d=
u*e,k=1;k<e-1;k++){var c=d+k;if(!b||b[c]){var f=t[c]*J;c=x[c]*q;f=Math.sqrt(f*f+c*c);p[d+k]="percent-rise"===g?100*f:57.2957795*Math.atan(f)}}T(p,e,a);P=new v({width:e,height:a,pixels:[p],mask:b,pixelType:"f32",validPixelCount:P.validPixelCount});P.updateStatistics();return P};m.tintHillshade=function(P,J,p,u){if(w.isValidPixelBlock(P)&&w.isValidPixelBlock(J)){var {min:d,max:g}=u;u=P.pixels[0];var {pixels:k,mask:n}=J;J=k[0];var h=255.00001/(g-d),q=new Uint8ClampedArray(J.length),t=new Uint8ClampedArray(J.length),
x=new Uint8ClampedArray(J.length),b=p.length-1;for(let c=0;c<J.length;c++){if(n&&0===n[c])continue;var e=Math.floor((J[c]-d)*h);const [f,l]=p[0>e?0:e>b?b:e];var a=u[c];e=a*l;const r=e*(1-Math.abs(f%2-1));a-=e;switch(Math.floor(f)){case 0:q[c]=e+a;t[c]=r+a;x[c]=a;break;case 1:q[c]=r+a;t[c]=e+a;x[c]=a;break;case 2:q[c]=a;t[c]=e+a;x[c]=r+a;break;case 3:q[c]=a;t[c]=r+a;x[c]=e+a;break;case 4:q[c]=r+a;t[c]=a;x[c]=e+a;break;case 5:case 6:q[c]=e+a,t[c]=a,x[c]=r+a}}P.pixels=[q,t,x];P.updateStatistics()}};
Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/BandArithmeticFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BandArithmeticFunctionArguments ./bandIndexUtils ./BaseRasterFunction".split(" "),function(m,v,w,L,E,T,R,P,J){const p=new Set(["vari","mtvi2","rtvi-core","evi"]);w=class extends J{constructor(){super(...arguments);
this.functionName="BandArithmetic";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");var u=this.sourceRasterInfos[0];if(2>u.bandCount)return{success:!1,supportsGPU:!1,error:"band-arithmetic-function: source raster has insufficient amount of raster bands"};u=u.clone();u.pixelType=this.outputPixelType;u.bandCount="sultan"===this.functionArguments.method?3:1;this._removeStatsHistColormapVAT(u);u.keyProperties={...u.keyProperties,
BandProperties:void 0};this.rasterInfo=u;return{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(u){u=u.pixelBlocks?.[0];if(null==u)return u;const {method:d,bandIndexes:g}=this.functionArguments,k=g.split(" ").map(n=>parseFloat(n));return P.calculateBandIndex(u,{method:d,bandIndexes:k,equation:g})}_getWebGLParameters(){const u=this.functionArguments.bandIndexes.split(" ").map(n=>parseFloat(n)-1);2===u.length&&u.push(0);var d=this.isInputBandIdsSwizzled?
[0,1,2]:u;const g=new Float32Array(3);({method:k}=this.functionArguments);switch(k){case "gndvi":case "nbr":case "ndbi":case "ndvi":case "ndvi-re":case "ndsi":case "ndmi":case "mndwi":d=P.getBandMatrix3([d[0],d[1],0]);var k="ndxi";break;case "ndwi":d=P.getBandMatrix3([d[1],d[0],0]);k="ndxi";break;case "sr":case "sr-re":case "iron-oxide":case "ferrous-minerals":case "clay-minerals":d=P.getBandMatrix3([d[0],d[1],0]);k="sr";break;case "ci-g":case "ci-re":d=P.getBandMatrix3([d[0],d[1],0]);k="ci";break;
case "savi":d=P.getBandMatrix3([d[0],d[1],0]);k="savi";g[0]=u[2]+1;break;case "tsavi":d=P.getBandMatrix3([d[0],d[1],0]);k="tsavi";g[0]=u[2]+1;g[1]=u[3]+1;g[2]=u[4]+1;break;case "msavi":d=P.getBandMatrix3([d[0],d[1],0]);k="msavi";break;case "gemi":d=P.getBandMatrix3([d[0],d[1],0]);k="gemi";break;case "pvi":d=P.getBandMatrix3([d[0],d[1],0]);k="tsavi";g[0]=u[2]+1;g[1]=u[3]+1;break;case "vari":d=P.getBandMatrix3([d[0],d[1],d[2]]);k="vari";break;case "mtvi2":d=P.getBandMatrix3([d[0],d[1],d[2]]);k="mtvi";
break;case "rtvi-core":d=P.getBandMatrix3([d[0],d[1],d[2]]);k="rtvicore";break;case "evi":d=P.getBandMatrix3([d[0],d[1],d[2]]);k="evi";break;case "wndwi":d=P.getBandMatrix3([d[0],d[1],0]);k="wndwi";g[0]=u[3]?u[3]+1:.5;break;case "bai":d=P.getBandMatrix3([d[1],d[0],0]);k="bai";break;default:d=P.getBandMatrix3([0,1,2]),k="custom"}return{bandIndexMat3:d,indexType:k,adjustments:g}}_getInputBandIds(u){if("custom"===this.functionArguments.method)return u;var d=this.functionArguments.bandIndexes.split(" ").map(n=>
parseFloat(n)-1);const g=u.length;d=d.map(n=>n>=g?g-1:n);const k=p.has(this.functionArguments.method)?3:2;d=d.slice(0,k).map(n=>u[n]);2===d.length&&d.push(0);return d}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:R,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.BandArithmeticFunction")],
w)})},"esri/layers/support/rasterFunctions/BandArithmeticFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./bandIndexUtils ./BaseFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P,J){var p;L=p=class extends J{constructor(){super(...arguments);this.method="custom"}clone(){return new p({method:this.method,
bandIndexes:this.bandIndexes,raster:v.clone(this.raster)})}};m.__decorate([w.property({json:{type:String,write:!0}})],L.prototype,"bandIndexes",void 0);m.__decorate([T.enumeration(P.bandIndexMethodMap)],L.prototype,"method",void 0);return L=p=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],L)})},"esri/layers/support/rasterFunctions/bandIndexUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./customBandIndexUtils","./pixelUtils"],
function(m,v,w,L,E){function T(a,c,f){const l=f.length,r=new Float32Array(l);for(let z=0;z<l;z++)if(null==a||a[z]){const y=c[z],F=f[z],K=y+F;K&&(r[z]=(y-F)/K)}return[r]}function R(a,c,f){const l=f.length,r=new Float32Array(l);for(let z=0;z<l;z++)if(null==a||a[z]){const y=c[z],F=f[z];F&&(r[z]=y/F)}return[r]}function P(a,c,f){const l=c.length,r=new Float32Array(l);for(let z=0;z<l;z++)if(null==a||a[z]){const y=c[z],F=f[z];F&&(r[z]=y/F-1)}return[r]}function J(a,c,f,l){const r=f.length,z=new Float32Array(r);
for(let y=0;y<r;y++)if(null==a||a[y]){const F=f[y],K=c[y],H=K+F+l;H&&(z[y]=(K-F)/H*(1+l))}return[z]}function p(a,c,f,l,r,z){const y=f.length,F=new Float32Array(y);z=-r*l+z*(1+l*l);for(let K=0;K<y;K++)if(null==a||a[K]){const H=f[K],D=c[K],G=r*D+H+z;G&&(F[K]=l*(D-l*H-r)/G)}return[F]}function u(a,c,f){const l=f.length,r=new Float32Array(l);for(let z=0;z<l;z++)if(null==a||a[z]){const y=c[z],F=2*y+1;r[z]=.5*(F-Math.sqrt(F*F-8*(y-f[z])))}return[r]}function d(a,c,f){const l=f.length,r=new Float32Array(l);
for(let y=0;y<l;y++)if(null==a||a[y]){const F=f[y];var z=c[y];1!==F&&0!==z+F+.5&&(z=(2*(z*z-F*F)+1.5*z+.5*F)/(z+F+.5),r[y]=z*(1-.25*z)-(F-.125)/(1-F))}return[r]}function g(a,c,f,l,r){const z=f.length,y=new Float32Array(z),F=1/Math.sqrt(1+l*l);for(let K=0;K<z;K++)if(null==a||a[K])y[K]=(c[K]-l*f[K]-r)*F;return[y]}function k(a,c){const [f,l,r,z,y,F]=c;c=f.length;const K=new Float32Array(c);for(let H=0;H<c;H++)if(null==a||a[H])K[H]=-.2848*f[H]-.2435*l[H]-.5436*r[H]+.7243*z[H]+.084*y[H]-.18*F[H];return[K]}
function n(a,c){const [f,l,r,z,y]=c;c=f.length;const F=new Float32Array(c),K=new Float32Array(c),H=new Float32Array(c);for(let D=0;D<c;D++)if(null==a||a[D])F[D]=y[D]?z[D]/y[D]*100:0,K[D]=f[D]?z[D]/f[D]*100:0,H[D]=r[D]?l[D]/r[D]*(z[D]/r[D])*100:0;return[F,K,H]}function h(a,c){const [f,l,r]=c;c=f.length;const z=new Float32Array(c);for(let y=0;y<c;y++)if(null==a||a[y])for(y=0;y<c;y++){const F=f[y],K=l[y],H=K+F-r[y];H&&(z[y]=(K-F)/H)}return[z]}function q(a,c){const [f,l,r]=c;c=f.length;const z=new Float32Array(c);
for(let y=0;y<c;y++)if(null==a||a[y])for(y=0;y<c;y++){const F=f[y],K=l[y],H=r[y],D=Math.sqrt((2*F+1)**2-(6*F-5*Math.sqrt(K))-.5);D&&(z[y]=1.5*(1.2*(F-H)-2.5*(K-H))/D)}return[z]}function t(a,c){const [f,l,r]=c;c=f.length;const z=new Float32Array(c);for(let y=0;y<c;y++)if(null==a||a[y])for(y=0;y<c;y++){const F=f[y];z[y]=100*(F-l[y])-10*(F-r[y])}return[z]}function x(a,c){const [f,l,r]=c;c=f.length;const z=new Float32Array(c);for(let y=0;y<c;y++)if(null==a||a[y])for(y=0;y<c;y++){const F=f[y],K=l[y],H=
F+6*K-7.5*r[y]+1;H&&(z[y]=2.5*(F-K)/H)}return[z]}function b(a,c,f=.5){const [l,r,z]=c;c=r.length;const y=new Float32Array(c);for(let F=0;F<c;F++)if(null==a||a[F])for(F=0;F<c;F++){const K=l[F],H=r[F],D=z[F],G=K+f*H+(1-f)*D;G&&(y[F]=(K-f*H-(1-f)*D)/G)}return[y]}function e(a,c,f){const l=f.length,r=new Float32Array(l);for(let z=0;z<l;z++)if(null==a||a[z])for(z=0;z<l;z++){const y=(.1-c[z])**2+(.06-f[z])**2;y&&(r[z]=1/y)}return[r]}v=new v.JSONMap({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",
6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});m.bandIndexMethodMap=v;m.calculateBandIndex=function(a,c){if(!E.isValidPixelBlock(a))return a;const {equation:f,method:l}=c;c=c.bandIndexes.map(F=>F-1);const {pixels:r,mask:z}=a;switch(l){case "gndvi":case "nbr":case "ndbi":case "ndvi":case "ndvi-re":case "ndsi":case "ndmi":case "mndwi":c=
T(z,r[c[0]],r[c[1]]);break;case "ndwi":c=T(z,r[c[1]],r[c[0]]);break;case "sr":case "sr-re":case "iron-oxide":case "ferrous-minerals":case "clay-minerals":c=R(z,r[c[0]],r[c[1]]);break;case "ci-g":case "ci-re":c=P(z,r[c[0]],r[c[1]]);break;case "savi":c=J(z,r[c[0]],r[c[1]],c[2]+1);break;case "tsavi":c=p(z,r[c[0]],r[c[1]],c[2]+1,c[3]+1,c[4]+1);break;case "msavi":c=u(z,r[c[0]],r[c[1]]);break;case "gemi":c=d(z,r[c[0]],r[c[1]]);break;case "pvi":c=g(z,r[c[0]],r[c[1]],c[2]+1,c[3]+1);break;case "gvitm":c=k(z,
[r[c[0]],r[c[1]],r[c[2]],r[c[3]],r[c[4]],r[c[5]]]);break;case "sultan":c=n(z,[r[c[0]],r[c[1]],r[c[2]],r[c[3]],r[c[4]]]);break;case "vari":c=h(z,[r[c[0]],r[c[1]],r[c[2]]]);break;case "mtvi2":c=q(z,[r[c[0]],r[c[1]],r[c[2]]]);break;case "rtvi-core":c=t(z,[r[c[0]],r[c[1]],r[c[2]]]);break;case "evi":c=x(z,[r[c[0]],r[c[1]],r[c[2]]]);break;case "wndwi":c=b(z,[r[c[0]],r[c[1]],r[c[2]]],c[3]?c[3]+1:.5);break;case "bai":c=e(z,r[c[0]],r[c[1]]);break;case "custom":c=L.calculateCustomBandIndex(z,r,f);break;default:return a}const y=
null!=z?new Uint8Array(z.length):null;null!=z&&null!=y&&y.set(z);a=new w({width:a.width,height:a.height,pixelType:"f32",pixels:c,mask:y});a.updateStatistics();return a};m.calculateNDVI=function(a,c,f,l){const {mask:r,pixels:z,width:y,height:F}=a;a=z[f];c=z[c];f=c.length;const K=l?new Uint8Array(f):new Float32Array(f),H=l?100:1,D=l?100.5:0;for(let G=0;G<f;G++)if(null==r||r[G]){const S=a[G],A=c[G],B=S+A;B&&(K[G]=(S-A)/B*H+D)}l=new w({width:y,height:F,mask:r,pixelType:l?"u8":"f32",pixels:[K]});l.updateStatistics();
return l};m.getBandMatrix3=function(a){const c=new Float32Array(9);c[3*a[0]]=1;c[3*a[1]+1]=1;c[3*a[2]+2]=1;return c};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/customBandIndexUtils":function(){define(["exports","../../../core/has"],function(m,v){function w(E,T){return E.toLowerCase().startsWith("b")?T[parseInt(E.slice(1),10)-1]:parseFloat(E)}const L=new Set("+-*/()".split(""));m.calculateCustomBandIndex=function(E,T,R){R=R.replaceAll(" ","");
R.startsWith("-")&&(R="0"+R);R.startsWith("+")&&(R=R.slice(1,R.length));R=R.split("");var P=[],J=[],p="";for(var u=0;u<R.length;u++){const n=R[u];L.has(n)?(p.length&&J.push(w(p,T)),P.push(n),p=""):p=p.concat(n)}p.length&&J.push(w(p,T));let {ops:d,nums:g}={ops:P,nums:J};if(0===d.length){E=1===g.length?g[0]:T[0];if(E instanceof Float32Array)return[E];var k=new Float32Array(T[0].length);"number"===typeof E?k.fill(E):k.set(E);return[k]}for(;0<d.length;){k=d;if(1===k.length)k={opIndex:0,numIndex:0};else{P=
R=0;for(T=0;T<k.length;T++)if("("===k[T])R=T;else if(")"===k[T]){P=T;break}J=0===P?k:k.slice(R+1,P);T=-1;for(p=0;p<J.length;p++)if("*"===J[p]||"/"===J[p]){T=p;break}if(!(-1<T))for(p=0;p<J.length;p++)if("+"===J[p]||"-"===J[p]){T=p;break}0<P&&(T+=R+1);R=0;for(P=0;P<T;P++)"("===k[P]&&R++;k={opIndex:T,numIndex:T-R}}const {numIndex:n,opIndex:h}=k;P=R=T=void 0;k=E;p=d[h];J=g[n];u=g[n+1];if("number"===typeof J&&"number"===typeof u)k=J+u;else{"number"===typeof J?(T=u,P=T.length,R=new Float32Array(P),R.fill(J)):
(P=J.length,R=J,u.constructor===Number?(T=new Float32Array(P),T.fill(u)):T=u);J=new Float32Array(P);switch(p){case "+":for(p=0;p<P;p++)if(null==k||k[p])J[p]=R[p]+T[p];break;case "-":for(p=0;p<P;p++)if(null==k||k[p])J[p]=R[p]-T[p];break;case "*":for(p=0;p<P;p++)if(null==k||k[p])J[p]=R[p]*T[p];break;case "/":for(p=0;p<P;p++)(null==k||k[p])&&T[p]&&(J[p]=R[p]/T[p]);break;case "(":case ")":throw Error("encountered error with custom band index equation");}k=J}if(1===d.length)break;else{T=d;T.splice(h,1);
P=R=0;do{P=R=0;for(J=0;J<T.length;J++)if("("===T[J])R=J;else if(")"===T[J]){P=J;break}P===R+1&&T.splice(R,2)}while(P===R+1);d=T;g.splice(n,2,k)}}return[k]};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/ClipFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./ClipFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P){w=class extends R{constructor(){super(...arguments);this.functionName="Clip";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isNoopProcess=!0}_bindSourceRasters(){const J=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(J.pixelType);J.pixelType=this.outputPixelType;this.rasterInfo=J;return{success:!0,supportsGPU:!0}}_processPixels(J){return J.pixelBlocks?.[0]}_getWebGLParameters(){const {clippingGeometry:J,clippingType:p}=
this.functionArguments;return{clippingGeometry:J.toJSON(),clippingType:p}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property()],w.prototype,"isNoopProcess",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ClipFunction")],
w)})},"esri/layers/support/rasterFunctions/ClipFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/jsonMap ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/jsonUtils ./BaseFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P,J,p){var u;w=new w.JSONMap({1:"outside",2:"inside"},{useNumericKeys:!0});p=u=class extends p{constructor(){super(...arguments);
this.clippingType="outside"}clone(){return new u({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};m.__decorate([L.property({types:v.geometryTypes,json:{read:J.fromJSON,write:!0}})],p.prototype,"clippingGeometry",void 0);m.__decorate([L.property({json:{read:w.read,write:w.write}})],p.prototype,"clippingType",void 0);return p=u=m.__decorate([P.subclass("esri.layers.support.rasterFunctions.ClipFunctionArguments")],p)})},"esri/layers/support/rasterFunctions/ColormapFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./ColormapFunctionArguments ./colormaps ../../../renderers/support/colorRampUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){w=class extends P{constructor(){super(...arguments);this.functionName="Colormap";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isNoopProcess=!0}_bindSourceRasters(){var d=this.sourceRasterInfos[0];if(1<d.bandCount)return{success:!1,supportsGPU:!1,error:"colormap-function: source data must be single band"};let {colormap:g,colormapName:k,colorRamp:n,colorRampName:h}=this.functionArguments;if(!g?.length)if(n)g=u.convertColorRampToColormap(n,{interpolateAlpha:!0});
else if(h){var q=u.getColorRampJSON(h);q&&(g=u.convertColorRampToColormap(q))}else k&&(g=p.getColormapByName(k));if(!g?.length)return{success:!1,supportsGPU:!1,error:"colormap-function: missing colormap argument"};q=this._getOutputPixelType(d.pixelType);this.outputPixelType=q.startsWith("f")?"s32":q;d=d.clone();d.pixelType=this.outputPixelType;d.colormap=g;d.bandCount=1;this.rasterInfo=d;return{success:!0,supportsGPU:!0}}_processPixels(d){d=d.pixelBlocks?.[0];if(!d||R.isIntegerPixelType(d.pixelType))return d;
d=d.clone();d.clamp(this.outputPixelType);return d}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:J,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property()],w.prototype,"isNoopProcess",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"indexedColormap",void 0);return w=
m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ColormapFunction")],w)})},"esri/layers/support/rasterFunctions/ColormapFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments ../../../renderers/support/colorRampUtils ../../../rest/support/colorRamps".split(" "),
function(m,v,w,L,E,T,R,P,J){var p;R=p=class extends R{castColormapName(u){if(!u)return null;u=u.toLowerCase();return P.rasterColormapNames.includes(u)?u:null}readColorRamp(u){return J.fromJSON(u)}readColorRampName(u,d){return u?(d=P.colorRampDict.jsonValues.find(g=>g.toLowerCase()===u.toLowerCase()))?P.colorRampDict.fromJSON(d):null:null}clone(){return new p({colormap:v.clone(this.colormap),colormapName:this.colormapName,colorRamp:this.colorRamp?.clone(),colorRampName:this.colorRampName})}};m.__decorate([w.property({type:[[Number]],
json:{write:!0}})],R.prototype,"colormap",void 0);m.__decorate([w.property({type:String,json:{write:!0}})],R.prototype,"colormapName",void 0);m.__decorate([L.cast("colormapName")],R.prototype,"castColormapName",null);m.__decorate([w.property({types:J.types,json:{write:!0}})],R.prototype,"colorRamp",void 0);m.__decorate([E.reader("colorRamp")],R.prototype,"readColorRamp",null);m.__decorate([w.property({type:P.colorRampDict.apiValues,json:{type:P.colorRampDict.jsonValues,write:P.colorRampDict.write}})],
R.prototype,"colorRampName",void 0);m.__decorate([E.reader("colorRampName")],R.prototype,"readColorRampName",null);return R=p=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],R)})},"esri/layers/support/rasterFunctions/colormaps":function(){define(["exports","../../../renderers/support/colorRampUtils"],function(m,v){function w(P,J){const p=[],u=[];for(let d=0;d<P.length-1;d++)p.push({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:P[d].slice(1),toColor:P[d+
1].slice(1)}),u.push(P[d+1][0]-P[d][0]);P=P[P.length-1][0];J=J??u;return v.convertColorRampToColors({type:"multipart",colorRamps:p},{numColors:P,weights:J})}function L(){const P=w([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let J=P.length;256>J;J++)P.push([6,27,7]);return P}function E(){const P=[];for(let J=0;256>J;J++){const p=[];for(let u=0;3>u;u++)p.push(Math.round(255*Math.random()));
P.push(p)}return P}const T=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,
5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,
111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,
247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,
101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,
57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],R=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,
0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,
0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,
238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,
173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,
130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],
[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];m.getColormapByName=function(P){let J;switch(P){case "elevation":J=w([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,
20,20,20]]);break;case "gray":J=v.convertColorRampToColors({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:[0,0,0],toColor:[255,255,255]});break;case "hillshade":J=w([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495]);break;case "ndvi":J=T;break;case "ndvi2":J=L();break;case "ndvi3":J=R;break;case "random":J=E()}return J?J=J.map((p,u)=>[u,...p]):null};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/CompositeBandFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./CompositeBandFunctionArguments ./pixelUtils".split(" "),
function(m,v,w,L,E,T,R,P,J){w=class extends R{constructor(){super(...arguments);this.functionName="CompositeBand";this.functionArguments=null;this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){var {sourceRasterInfos:p}=this,u=p[0];this.outputPixelType=this._getOutputPixelType(u.pixelType);u=u.clone();u.attributeTable=null;u.colormap=null;u.pixelType=this.outputPixelType;u.bandCount=p.map(({bandCount:d})=>d).reduce((d,g)=>d+g);if(p.every(({statistics:d})=>null!=d&&d.length)){const d=[];p.forEach(({statistics:g})=>
null!=g&&d.push(...g));u.statistics=d}if(p.every(({histograms:d})=>null!=d&&d.length)){const d=[];p.forEach(({histograms:g})=>null!=g&&d.push(...g));u.histograms=d}1<u.bandCount&&(u.colormap=null,u.attributeTable=null);p=p.every(d=>d.keyProperties.BandProperties?.length)?p.flatMap(d=>d.keyProperties.BandProperties):void 0;u.keyProperties={...u.keyProperties,BandProperties:p};this.rasterInfo=u;return{success:!0,supportsGPU:3>=u.bandCount}}_processPixels(p){({pixelBlocks:p}=p);return p&&null!=p?.[0]?
J.compositeBands(p):null}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.CompositeBandFunction")],w)})},"esri/layers/support/rasterFunctions/CompositeBandFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P){var J;L=J=class extends P{constructor(){super(...arguments);this.rasters=[]}writeRasters(p,u){u.rasters=p.map(d=>"number"===typeof d||"string"===typeof d?d:d.toJSON())}clone(){return new J({rasters:v.clone(this.rasters)})}};m.__decorate([w.property({json:{write:!0}})],L.prototype,"rasters",void 0);m.__decorate([R.writer("rasters")],L.prototype,"writeRasters",null);return L=J=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],L)})},
"esri/layers/support/rasterFunctions/ContrastBrightnessFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./ContrastBrightnessFunctionArguments ./pixelUtils ./stretchUtils".split(" "),function(m,v,w,L,E,T,R,P,J,p){w=class extends R{constructor(){super(...arguments);this.functionName="ContrastBrightness";this.functionArguments=
null;this.rasterArgumentNames=["raster"];this.lookup=null}_bindSourceRasters(){var {sourceRasterInfos:u}=this;u=u[0];if("u8"!==u.pixelType)return{success:!1,supportsGPU:!1,error:"Only unsigned 8 bit raster is supported by ContrastBrightness function."};this.outputPixelType=this._getOutputPixelType("u8");u=u.clone();this._removeStatsHistColormapVAT(u);this.rasterInfo=u;const {contrastOffset:d,brightnessOffset:g}=this.functionArguments;this.lookup=p.createContrastBrightnessLUT(d,g);return{success:!0,
supportsGPU:!0}}_processPixels(u){u=u.pixelBlocks?.[0];return null==u?null:J.lookupPixels(u,{lut:u.pixels.map(()=>this.lookup),offset:0,outputPixelType:"u8"})}_getWebGLParameters(){const {contrastOffset:u,brightnessOffset:d}=this.functionArguments;return{contrastOffset:u,brightnessOffset:d}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",
void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"lookup",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ContrastBrightnessFunction")],w)})},"esri/layers/support/rasterFunctions/ContrastBrightnessFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;w=P=class extends R{constructor(){super(...arguments);this.brightnessOffset=this.contrastOffset=0}clone(){return new P({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,"contrastOffset",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"brightnessOffset",void 0);return w=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ContrastBrightnessFunctionArguments")],
w)})},"esri/layers/support/rasterFunctions/stretchUtils":function(){define(["exports","../../../core/maybe","../PixelBlock","../rasterFormats/pixelRangeUtils","../../../renderers/support/stretchRendererUtils"],function(m,v,w,L,E){function T(g,k=256){k=Math.min(k,256);const {size:n,counts:h}=g;g=new Uint8Array(n);var q=h.reduce((a,c)=>a+c/k,0);let t=0;var x=0;let b=0,e=q;for(let a=0;a<n;a++)if(b+=h[a],!(a<n-1&&b+h[a+1]<e)){for(;t<k-1&&e<b;)t++,e+=q;for(;x<=a;x++)g[x]=t;x=a+1}for(q=x;q<n;q++)g[q]=k-
1;return g}function R(g,k){g=Math.min(Math.max(g,-100),100);k=Math.min(Math.max(k??0,-100),100);let n=0,h=0;const q=new Uint8Array(256);for(n=0;256>n;n++)0<g&&100>g?h=(200*n-25500+510*k)/(2*(100-g))+128:0>=g&&-100<g?h=(200*n-25500+510*k)*(100+g)/2E4+128:100===g?(h=200*n-25500+256*(100-g)+510*k,h=0<h?255:0):-100===g&&(h=128),q[n]=255<h?255:0>h?0:h;return q}function P(g,k,n,h){let q=Infinity,t=-Infinity;var x=0,b=0,e=0,a=0;const c=g.length;var f=new Map,l=[];for(let r=0;r<c;r++){const z=g[r];if(!k||
k[r]){l.push(z);const y=(f.get(z)??0)+1;f.set(z,y);y>a&&(a=y,e=z);q=z<q?z:q;t=z>t?z:t;x+=z;b++}}if(0===b)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};x/=b;a=0;for(f=0;f<c;f++)if(!k||k[f])a+=(g[f]-x)**2;f=k?k.filter(r=>r).length:c;a=1>=f?0:Math.sqrt(a/(f-1));l.sort((r,z)=>r-z);f=b>>>1;e={min:q,max:t,avg:x,stddev:a,mode:e,median:b%2?l[Math.floor(f)]:(l[f-1]+l[f])/2};if(!h)return{statistics:e,histogram:null};if(["u8","s8","u4","u2","u1"].includes(n)){b=t-q+1;n=new Uint32Array(b);
for(h=0;h<c;h++)k&&!k[h]||n[g[h]-q]++;return{statistics:e,histogram:{min:q-.5,max:t+.5,size:b,counts:n}}}n=new Uint32Array(256);h=(t-q)/256;if(0===h)return{statistics:e,histogram:{min:q,max:t,size:1,counts:(new Uint32Array(1)).fill(b)}};b=new Uint32Array(257);for(l=0;l<c;l++)k&&!k[l]||b[Math.floor((g[l]-q)/h)]++;for(g=0;255>g;g++)n[g]=b[g];n[255]=b[255]+b[256];return{statistics:e,histogram:{min:q,max:t,size:256,counts:n}}}function J(g){if(!g?.pixels?.length)return null;const {pixels:k,mask:n,bandMasks:h,
pixelType:q}=g,t=g.width*g.height,x=k.length,b=[],e=[];let a,c;for(let H=0;H<x;H++){var f=new Uint32Array(256);var l=k[H],r=h?.[H]??n;if("u8"===q){a=255;c=0;if(r)for(var z=0;z<t;z++){if(r[z]){var y=l[z];a=y<a?y:a;c=y>c?y:c;f[y]++}}else for(r=0;r<t;r++)z=l[r],a=z<a?z:a,c=z>c?z:c,f[z]++;f=f.slice(a,c+1)}else{y=!1;g.statistics||(g.updateStatistics(),y=!0);var F=g.statistics;a=F[H].minValue;c=F[H].maxValue;z=(c-a)/256;if(0===z)for(!F||g.validPixelCount||y||g.updateStatistics(),l=(g.validPixelCount||g.width*
g.height)/256,r=0;256>r;r++)f[r]=Math.round(l*(r+1))-Math.round(l*r);else{y=new Uint32Array(257);for(F=0;F<t;F++)r&&!r[F]||y[Math.floor((l[F]-a)/z)]++;for(l=0;255>l;l++)f[l]=y[l];f[255]=y[255]+y[256]}}z="u8"===q?a-.5:a;y="u8"===q?c+.5:c;b.push({min:z,max:y,size:f.length,counts:f});r=F=l=0;for(var K=0;K<f.length;K++)l+=f[K],F+=K*f[K];F/=l;for(K=0;K<f.length;K++)r+=f[K]*(K-F)**2;f=(y-z)/f.length;e.push({min:a,max:c,avg:(F+("u8"===q?0:.5))*f+a,stddev:Math.sqrt(r/(l-1))*f})}return{statistics:e,histograms:b}}
function p(g,k){if(null==k||0===k.length)return g;const n=Math.max.apply(null,k),{minCutOff:h,maxCutOff:q,outMin:t,outMax:x,histogramLut:b}=g;return h.length===k.length||h.length<=n?g:{minCutOff:k.map(e=>h[e]),maxCutOff:k.map(e=>q[e]),histogramLut:b?k.map(e=>b[e]):null,outMin:t,outMax:x}}function u(g,k){const n=new Float32Array(g);for(let h=0;h<g;h++)n[h]=1<k[h]?2<k[h]?6.5+(k[h]-2)**2.5:6.5+100*(2-k[h])**4:1;return n}const d=[.299,.587,.114];m.computeGammaCorrection=u;m.computeGammaValues=function(g,
k,n){const h=[];for(let e=0;e<k.length;e++){var q=0,t=0,x=0;"min"in k[e]?{min:q,max:t,avg:x}=k[e]:[q,t,x]=k[e];x=x??0;"u8"!==g&&(x=255*(x-q)/(t-q));n&&(x*=d[e]);q=h;t=q.push;if(0>=x||255<=x)x=1;else{var b=0;150!==x&&(b=150>=x?45*Math.cos(.01047*x):17*Math.sin(.021*x));b=Math.log((x+b)/255);0===b?x=1:(x=Math.log(x/255)/b,x=isNaN(x)?1:Math.min(9.9,Math.max(.01,x)))}t.call(q,x)}return h};m.computeStatisticsHistograms=function(g){const {pixels:k,mask:n,pixelType:h,bandMasks:q}=g;var t=k.map((x,b)=>P(x,
q?.[b]??n,h,!0));g=t.map(({statistics:x})=>x);t=t.map(({histogram:x})=>x);return{statistics:g,histograms:t}};m.createContrastBrightnessLUT=R;m.createHistogramEqualizationLUT=T;m.createStretchLUT=function(g){const {minCutOff:k,maxCutOff:n,gamma:h,pixelType:q,rounding:t}=g,x=g.outMin||0,b=g.outMax||255;if(!["u8","u16","s8","s16"].includes(q))return null;const e=k.length;let a,c,f=0;"s8"===q?f=-127:"s16"===q&&(f=-32767);let l=256;["u16","s16"].includes(q)&&(l=65536);var r=[],z=[];const y=b-x;for(a=0;a<
e;a++)z[a]=n[a]-k[a],r[a]=0===z[a]?0:y/z[a];let F;const K=[];let H,D;if(h&&h.length>=e)for(r=u(e,h),a=0;a<e;a++){D=[];for(c=0;c<l;c++)if(0===z[a])D[c]=x;else{var G=c+f;F=(G-k[a])/z[a];H=1;1<h[a]&&(H-=(1/y)**(F*r[a]));G<n[a]&&G>k[a]?(G=H*y*F**(1/h[a])+x,D[c]="floor"===t?Math.floor(G):"round"===t?Math.round(G):G):D[c]=G>=n[a]?b:x}K[a]=D}else for(a=0;a<e;a++){D=[];for(c=0;c<l;c++)G=c+f,G<=k[a]?D[c]=x:G>=n[a]?D[c]=b:(z=(G-k[a])*r[a]+x,D[c]="floor"===t?Math.floor(z):"round"===t?Math.round(z):z);K[a]=D}if(null!=
g.contrastOffset)for(g=R(g.contrastOffset,g.brightnessOffset),a=0;a<e;a++)for(D=K[a],c=0;c<l;c++)D[c]=g[D[c]];return{lut:K,offset:f}};m.estimateStatisticsFromHistograms=function(g){const k=[];for(let t=0;t<g.length;t++){const {min:x,max:b,size:e,counts:a}=g[t];let c=0;var n=0;for(var h=0;h<e;h++)c+=a[h],n+=h*a[h];n/=c;h=0;for(var q=0;q<e;q++)h+=a[q]*(q-n)**2;q=(b-x)/e;k.push({min:x,max:b,avg:(n+.5)*q+x,stddev:Math.sqrt(h/(c-1))*q})}return k};m.estimateStatisticsHistograms=J;m.getStretchCutoff=function(g,
k){const {pixelBlock:n,bandIds:h,returnHistogramLut:q,rasterInfo:t}=k;var x=null;k=null;var b=g.stretchType;"number"===typeof b&&(b=E.stretchTypeFunctionEnum[b]);g.dra?"minMax"===b&&n?.statistics?x=n.statistics.map(G=>[G.minValue,G.maxValue,0,0]):(k=J(n),x=null!=k?k.statistics:null,k=null!=k?k.histograms:null):(x=g.statistics?.length?g.statistics:t.statistics,k="histograms"in g?g.histograms:void 0,k||(k=t.histograms));"percentClip"!==b&&"histogramEqualization"!==b||k?.length||(b="minMax");var e=x?.length||
k?.length||t.bandCount;const a=[],c=[];let f,l,r;x&&!Array.isArray(x[0])&&(x=x.map(G=>[G.min,G.max,G.avg,G.stddev]));const [z,y]=L.getPixelValueRange(t.pixelType);if(!x?.length){x=[];for(l=0;l<e;l++)x.push([z,y,1,1]);"standardDeviation"===b&&(b="minMax")}switch(b){case "none":for(l=0;l<e;l++)a[l]=z,c[l]=y;break;case "minMax":for(l=0;l<e;l++){var F=x[l];a[l]=F[0];c[l]=F[1]}break;case "standardDeviation":({numberOfStandardDeviations:F=2}=g);for(l=0;l<e;l++){var K=x[l];a[l]=K[2]-F*K[3];c[l]=K[2]+F*K[3];
a[l]<K[0]&&(a[l]=K[0]);c[l]>K[1]&&(c[l]=K[1])}break;case "histogramEqualization":v.assertIsSome(k);for(l=0;l<e;l++)a[l]=k[l].min,c[l]=k[l].max;break;case "percentClip":v.assertIsSome(k);for(l=0;l<k.length;l++){x=k[l];K=new Uint32Array(x.size);var H=[...x.counts];20<=H.length&&(H[0]=H[1]=H[2]=H[H.length-1]=H[H.length-2]=0);F=0;e=(x.max-x.min)/x.size;f=-.5===x.min&&1===e?.5:0;for(r=0;r<x.size;r++)F+=H[r],K[r]=F;H=(g.minPercent||0)*F/100;a[l]=x.min+f;for(r=0;r<x.size;r++)if(K[r]>H){a[l]=x.min+e*(r+f);
break}H=(1-(g.maxPercent||0)/100)*F;c[l]=x.max+f;for(r=x.size-2;0<=r;r--)if(K[r]<H){c[l]=x.min+e*(r+2-f);break}c[l]<a[l]&&(x=a[l],a[l]=c[l],c[l]=x)}break;default:for(l=0;l<e;l++)F=x[l],a[l]=F[0],c[l]=F[1]}let D;"histogramEqualization"===b?(v.assertIsSome(k),b=k[0].size||256,g=0,q&&(D=k.map(G=>T(G)))):(b=g.max||255,g=g.min||0);return p({minCutOff:a,maxCutOff:c,outMax:b,outMin:g,histogramLut:D},h)};m.stretch=function(g,k){if(!g?.pixels?.length)return g;const {mask:n,bandMasks:h,width:q,height:t,pixels:x}=
g,{minCutOff:b,maxCutOff:e,gamma:a}=k;var c=k.outMin||0;const f=k.outMax||255,l=q*t,r=k.outputPixelType||"u8";g=g.pixels.map(()=>w.createEmptyBand(r,l));const z=g.length;var y=f-c,F=[],K=[];for(var H=0;H<z;H++)K[H]=e[H]-b[H],F[H]=0===K[H]?0:y/K[H];H=r.startsWith("u")||r.startsWith("s");k=!!k.isRenderer;if(a&&a.length>=z){F=u(z,a);for(var D=0;D<z;D++){var G=h?.[D]??n;for(let A=0;A<l;A++)if(null==G||G[A]){if(0===K[D]){g[D][A]=c;continue}var S=x[D][A];const B=(S-b[D])/K[D];let Q=1;1<a[D]&&(Q-=(1/y)**
(B*F[D]));S<e[D]&&S>b[D]?(S=Q*y*B**(1/a[D])+c,g[D][A]=k?Math.floor(S):H?Math.round(S):S):g[D][A]=S>=e[D]?f:c}}}else for(y=0;y<z;y++)for(K=h?.[y]??n,D=0;D<l;D++)if(null==K||K[D])G=x[y][D],G<e[y]&&G>b[y]?(G=(G-b[y])*F[y]+c,g[y][D]=k?Math.floor(G):H?Math.round(G):G):g[y][D]=G>=e[y]?f:c;c=new w({width:q,height:t,mask:n,bandMasks:h,pixels:g,pixelType:r});c.updateStatistics();return c};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/ConvolutionFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFunctionConstants ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./ConvolutionFunctionArguments ./convolutionUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){w=class extends J{constructor(){super(...arguments);this.functionName="Convolution";this.rasterArgumentNames=["raster"]}get _normalizedKernel(){const {kernel:d,convolutionType:g}=this.functionArguments,k=d.reduce((n,h)=>n+h);return-1===g||0===k||1===k?d:d.map(n=>n/k)}_bindSourceRasters(){const {convolutionType:d,rows:g,cols:k,kernel:n}=this.functionArguments;if(!Object.values(R.convolutionKernel).includes(d))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${d}`};
if(d!==R.convolutionKernel.none&&g*k!==n.length)return{success:!1,supportsGPU:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};var h=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(h.pixelType);h=h.clone();h.pixelType=this.outputPixelType;const q=[R.convolutionKernel.none,R.convolutionKernel.sharpen,R.convolutionKernel.sharpen2,R.convolutionKernel.sharpening3x3,R.convolutionKernel.sharpening5x5];if(-1===d||"u8"!==this.outputPixelType&&
!q.includes(d))h.statistics=null,h.histograms=null;h.colormap=null;h.attributeTable=null;this.rasterInfo=h;return{success:!0,supportsGPU:25>=n.length}}_processPixels(d){d=d.pixelBlocks?.[0];if(null==d||this.functionArguments.convolutionType===R.convolutionKernel.none)return d;const {rows:g,cols:k}=this.functionArguments,{_normalizedKernel:n}=this;return u.convolute(d,{kernel:n,rows:g,cols:k,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const d=new Float32Array(25);d.set(this._normalizedKernel);
return{kernelRows:this.functionArguments.rows,kernelCols:this.functionArguments.cols,kernel:d,clampRange:P.getPixelValueRange(this.outputPixelType)}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:p,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property()],w.prototype,"_normalizedKernel",
null);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ConvolutionFunction")],w)})},"esri/layers/support/rasterFunctions/ConvolutionFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../rasterFunctionConstants ./BaseFunctionArguments ./convolutionUtils".split(" "),function(m,v,w,L,E,T,R,P,J){var p;L=p=class extends P{constructor(){super(...arguments);
this.cols=this.rows=3;this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(u){this._set("convolutionType",u);const d=J.convolutionKernels.get(u);d&&u!==R.convolutionKernel.userDefined&&u!==R.convolutionKernel.none&&(u=Math.sqrt(d.length),this._set("kernel",d),this._set("cols",u),this._set("rows",u))}clone(){return new p({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:v.clone(this.raster)})}};m.__decorate([w.property({json:{type:Number,write:!0}})],
L.prototype,"rows",void 0);m.__decorate([w.property({json:{type:Number,write:!0}})],L.prototype,"cols",void 0);m.__decorate([w.property({json:{name:"type",type:Number,write:!0}})],L.prototype,"convolutionType",null);m.__decorate([w.property({json:{type:[Number],write:!0}})],L.prototype,"kernel",void 0);return L=p=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],L)})},"esri/layers/support/rasterFunctions/convolutionUtils":function(){define(["exports","../PixelBlock",
"../rasterFunctionConstants","./mirror"],function(m,v,w,L){function E(p){const u=Math.sqrt(p.length),d=p.slice(0,u),g=[1];for(let k=1;k<u;k++){let n=null;for(let h=0;h<u;h++){const q=p[h+k*u],t=p[h];if(null==n)if(0===t){if(q)return{separable:!1,row:null,col:null}}else n=q/t;else if(q/t!==n)return{separable:!1,row:null,col:null}}if(null==n)return{separable:!1,row:null,col:null};g.push(n)}return{separable:!0,row:d,col:g}}function T(p,u,d,g,k,n,h){const q=new Float32Array(u*d),t=n.length,x=h?0:g,b=h?
g:0;h=h?1:u;for(let e=x;e<d-x;e++){const a=e*u;for(let c=b;c<u-b;c++){if(k&&!k[a+c])continue;let f=0;for(let l=0;l<t;l++)f+=p[a+c+(l-g)*h]*n[l];q[a+c]=f}}return q}function R(p,u,d=!0){const {pixels:g,width:k,height:n,pixelType:h,mask:q}=p;p=g.length;const t=[],{kernel:x,rows:b,cols:e}=u;for(u=0;u<p;u++){var a=g[u],c=k,f=n,l=b,r=e,z=q,y=x;const F=new Float32Array(c*f),K=Math.floor(l/2),H=Math.floor(r/2);for(let D=K;D<f-K;D++){const G=D*c;for(let S=H;S<c-H;S++){if(z&&!z[G+S])continue;let A=0;for(let B=
0;B<l;B++)for(let Q=0;Q<r;Q++)A+=a[G+S+(B-K)*c+Q-H]*y[B*r+Q];F[G+S]=A}}a=F;d&&L.mirror(a,k,n,b,e);t.push(a)}return new v({width:k,height:n,pixelType:h,pixels:t,mask:q})}function P(p,u,d,g=!0){const {pixels:k,width:n,height:h,pixelType:q,mask:t}=p;p=k.length;const x=[],b=u.length,e=d.length,a=Math.floor(b/2),c=Math.floor(e/2);for(let f=0;f<p;f++){let l=T(k[f],n,h,a,t,u,!0);l=T(l,n,h,c,t,d,!1);g&&L.mirror(l,n,h,b,e);x.push(l)}return new v({width:n,height:h,pixelType:q,pixels:x,mask:t})}const J=new Map;
J.set(w.convolutionKernel.none,[0,0,0,0,1,0,0,0,0]);J.set(w.convolutionKernel.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]);J.set(w.convolutionKernel.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]);J.set(w.convolutionKernel.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]);J.set(w.convolutionKernel.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]);J.set(w.convolutionKernel.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]);J.set(w.convolutionKernel.gradientWest,[-1,0,1,-2,0,2,-1,0,1]);J.set(w.convolutionKernel.gradientEast,
[1,0,-1,2,0,-2,1,0,-1]);J.set(w.convolutionKernel.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]);J.set(w.convolutionKernel.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]);J.set(w.convolutionKernel.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]);J.set(w.convolutionKernel.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]);J.set(w.convolutionKernel.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]);J.set(w.convolutionKernel.smoothing5x5,
[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]);J.set(w.convolutionKernel.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]);J.set(w.convolutionKernel.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]);J.set(w.convolutionKernel.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]);J.set(w.convolutionKernel.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]);J.set(w.convolutionKernel.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]);J.set(w.convolutionKernel.sobelVertical,
[-1,0,1,-2,0,2,-1,0,1]);J.set(w.convolutionKernel.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]);J.set(w.convolutionKernel.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]);J.set(w.convolutionKernel.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);m.convolute=function(p,u){const d=E(u.kernel),g=!1!==u.mirrorEdges;p=d.separable?P(p,d.row,d.col,g):R(p,u,g);({outputPixelType:u}=u);u&&p.clamp(u);return p};m.convoluteSeparable=P;m.convolutionKernels=J;m.separateKernels=E;Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/mirror":function(){define(["exports"],function(m){m.mirror=function(v,w,L,E,T){E=Math.floor(E/2);for(var R=0;R<E;R++)for(var P=0;P<w;P++)v[R*w+P]=v[(T-1-R)*w+P],v[(L-1-R)*w+P]=v[(L-T+R)*w+P];E=Math.floor(T/2);for(R=0;R<L;R++){P=R*w;for(let J=0;J<E;J++)v[P+J]=v[P+T-1-J],v[P+w-J-1]=v[P+w+J-T]}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/CurvatureFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./CurvatureFunctionArguments ./surfaceUtils".split(" "),
function(m,v,w,L,E,T,R,P,J){w=class extends R{constructor(){super(...arguments);this.functionName="Curvature";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const p=this.sourceRasterInfos[0].clone();p.pixelType=this.outputPixelType;p.bandCount=1;this._removeStatsHistColormapVAT(p);this.rasterInfo=p;this.isGCS=p.spatialReference?.isGeographic??!1;return{success:!0,supportsGPU:!0}}_processPixels(p){const u=
p.pixelBlocks?.[0];if(null==u)return null;const {zFactor:d,curvatureType:g}=this.functionArguments,{extent:k,primaryPixelSizes:n}=p;p=n?.[0];return J.curvature(u,{zFactor:this.isGCS&&1<=d?d*J.gcsFactor:d,curvatureType:g,resolution:null==p?k?{x:k.width/u.width,y:k.height/u.height}:{x:1,y:1}:p})}_getWebGLParameters(){const {zFactor:p,curvatureType:u}=this.functionArguments;return{curvatureType:u,zFactor:this.isGCS&&1<=p?p*J.gcsFactor:p}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],
w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"isGCS",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.CurvatureFunction")],w)})},"esri/layers/support/rasterFunctions/CurvatureFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P,J,p){var u;const d=new v.JSONMap({0:"standard",1:"platform",2:"profile"},{useNumericKeys:!0});v=u=class extends p{constructor(){super(...arguments);this.curvatureType="standard";this.zFactor=1}readCurvatureType(g,k){return d.fromJSON(k.type??k.curvatureType??0)}clone(){return new u({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};m.__decorate([w.property({json:{write:{target:"type"}}}),R.enumeration(d)],v.prototype,"curvatureType",void 0);m.__decorate([P.reader("curvatureType",
["type","curvatureType"])],v.prototype,"readCurvatureType",null);m.__decorate([w.property({type:Number,json:{write:!0}})],v.prototype,"zFactor",void 0);return v=u=m.__decorate([J.subclass("esri.layers.support.rasterFunctions.CurvatureFunctionArguments")],v)})},"esri/layers/support/rasterFunctions/ExtractBandFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./bandIndexUtils ./BaseRasterFunction ./ExtractBandFunctionArguments ./pixelUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p){w=class extends P{constructor(){super(...arguments);this.functionName="ExtractBand";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const {functionArguments:u,sourceRasterInfos:d}=this;var g=d[0];const {method:k,bandNames:n,bandWavelengths:h,bandIds:q,missingBandAction:t}=u,x=n?.length&&("name"===k||"id"!==k&&!q?.length),b=h?.length&&("wavelength"===k||"id"!==k&&!q?.length);var e=t===p.MissingBandAction.fail;e=x?this._matchBandNames(g,
n):b?this._matchBandWavelengths(g,h,e):this._matchBandIds(g,q,e);if(null==e)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${x?"band names":b?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=e;this.functionArguments.method="id";this.outputPixelType=this._getOutputPixelType("f32");g=g.clone();g.pixelType=this.outputPixelType;g.bandCount=e.length;const {statistics:a,histograms:c}=g;null!=a&&a.length&&(g.statistics=e.map(l=>a[l]||a[a.length-
1]));null!=c&&c.length&&(g.histograms=e.map(l=>c[l]||c[c.length-1]));let f=g.keyProperties?.BandProperties;f?.length&&(f=e.map(l=>l>=f.length?f[f.length-1]:f[l]),g.keyProperties={...g.keyProperties,BandProperties:f});this.rasterInfo=g;return{success:!0,supportsGPU:3>=g.bandCount}}_processPixels(u){u=u.pixelBlocks?.[0];if(null==u)return null;const d=u.pixels.length,g=this.functionArguments.bandIds.map(k=>k>=d?d-1:k);return u.extractBands(g)}_getWebGLParameters(){let u;if(this.isInputBandIdsSwizzled)u=
this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{u=[...this.functionArguments.bandIds];0===u.length?u=[0,1,2]:3>u.length&&(u[1]=u[1]??u[0],u[2]=u[2]??u[1]);for(let d=0;3>d;d++)u[d]=Math.min(u[d],2)}return{bandIndexMat3:R.getBandMatrix3(u)}}_getInputBandIds(u){const d=u.length;return this.functionArguments.bandIds.map(g=>g>=d?d-1:g).map(g=>u[g])}_matchBandNames(u,d){u=u.bandInfos.map(({name:k})=>k.toLowerCase());const g=[];for(let k=0;k<d.length;k++){const n=d[k].toLowerCase();
let h=u.indexOf(n);-1===h&&"nearinfrared"===n&&(h=u.findIndex(q=>q.startsWith("nearinfrared_1")),-1===h&&(h=u.findIndex(q=>q.startsWith("nearinfrared"))));if(-1===h)return null;g.push(h)}return g}_matchBandIds(u,d,g){const {bandCount:k}=u;return!d?.length||g&&d.some(n=>0>n||n>=k)?null:d}_matchBandWavelengths(u,d,g){var {bandInfos:k}=u;u=[];for(var n=0;n<k.length;n++){const {minWavelength:h,maxWavelength:q}=k[n];if(!h||!q)return null;u.push({minWavelength:h,maxWavelength:q})}({wavelengthMatchTolerance:k}=
this.functionArguments);n=[];for(let h=0;h<d.length;h++){const q=d[h];let t=!1,x=-1,b=Number.MAX_VALUE;for(let e=0;e<u.length;e++){const a=u[e],c=Math.abs(q-(a.minWavelength+a.maxWavelength)/2);q>=a.minWavelength&&q<=a.maxWavelength?c<b&&(t=!0,x=e,b=c):!t&&c<b&&(x=e,b=c)}!t&&k&&b<k&&(t=!0);if(!t&&g)return null;n.push(x)}return n}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:J,json:{write:!0,name:"rasterFunctionArguments"}})],
w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.ExtractBandFunction")],w)})},"esri/layers/support/rasterFunctions/ExtractBandFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments ./pixelUtils".split(" "),
function(m,v,w,L,E,T,R,P,J){var p;w=p=class extends P{constructor(){super(...arguments);this.bandIds=[];this.bandNames=[];this.bandWavelengths=[];this.missingBandAction=J.MissingBandAction.bestMatch}clone(){return new p({bandIds:this.bandIds?.slice(),bandNames:this.bandNames?.slice(),bandWavelengths:this.bandWavelengths?.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,
"bandIds",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"bandNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"bandWavelengths",void 0);m.__decorate([T.enumeration({0:"name",1:"wavelength",2:"id"})],w.prototype,"method",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"missingBandAction",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"wavelengthMatchTolerance",void 0);return w=p=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],
w)})},"esri/layers/support/rasterFunctions/GrayscaleFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./conversionUtils ./GrayscaleFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P,J){w=class extends R{constructor(){super(...arguments);this.functionName="Grayscale";this.functionArguments=null;this.rasterArgumentNames=
["raster"]}get _normalizedWeights(){const {conversionParameters:p}=this.functionArguments,u=p.reduce((d,g)=>d+g);return p.map(d=>d/u)}_bindSourceRasters(){var {conversionParameters:p}=this.functionArguments;if(!p?.length)return{success:!1,supportsGPU:!1,error:"missing valid conversion parameters."};const u=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(u.pixelType);u.pixelType=this.outputPixelType;p=3===p.length||3===u.bandCount&&3<p.length;u.bandCount=1;this._removeStatsHistColormapVAT(u);
this.rasterInfo=u;return{success:!0,supportsGPU:p}}_processPixels(p){p=p.pixelBlocks?.[0];return null==p?null:P.grayscale(p,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:J,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",
void 0);m.__decorate([v.property()],w.prototype,"_normalizedWeights",null);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.GrayscaleFunction")],w)})},"esri/layers/support/rasterFunctions/conversionUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(m,v,w){m.grayscale=function(L,E,T){const {pixels:R,width:P,height:J,mask:p,bandMasks:u}=L;var d=P*J;const g=u?.length?v.combineBandMasks(u):p,k=Math.min(E.length,R.length),n=T.startsWith("f");
L=!n&&T!==L.pixelType;const [h,q]=w.getPixelValueRange(T);d=v.createEmptyBand(T,d);for(let t=0;t<J;t++){let x=t*P;for(let b=0;b<P;b++,x++)if(!g||g[x]){let e=0;for(let a=0;a<k;a++)e+=E[a]*R[a][x];n||(e=Math.round(e),L&&(e=e>q?q:e<h?h:e));d[x]=e}}E=new v({width:P,height:J,pixels:[d],pixelType:T,mask:g});E.updateStatistics();return E};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/GrayscaleFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;w=P=class extends R{clone(){return new P({conversionParameters:[...this.conversionParameters],raster:this.raster})}};m.__decorate([v.property({type:[Number],json:{write:!0}})],w.prototype,"conversionParameters",void 0);return w=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.GrayscaleFunctionArguments")],w)})},"esri/layers/support/rasterFunctions/LocalFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFunctionConstants ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./LocalFunctionArguments ./localUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){w=class extends J{constructor(){super(...arguments);this.functionName="Local";this.functionArguments=null;this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){var {sourceRasterInfos:d}=this,g=d[0];const {bandCount:k}=g,{processAsMultiband:n}=this.functionArguments;if(d.some(t=>t.bandCount!==k))return{success:!1,supportsGPU:!1,error:"local-function: input rasters do not have same band count"};const {operation:h,rasters:q}=this.functionArguments;d=u.operandsCount[h];
if(!(999===d||q.length===d||1>=q.length&&1===d))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${d}`};g=g.clone();g.bandCount=999!==d||n?k:1;this._removeStatsHistColormapVAT(g);this._updateStatistics(g);this._updatePixelType(g);this.rasterInfo=g;return{success:!0,supportsGPU:1===g.bandCount&&3>=d&&(11>h||16<h)}}_processPixels(d){({pixelBlocks:d}=d);return null==d||d.some(g=>null==g)?null:u.local(d,this.functionArguments.operation,
{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}_getWebGLParameters(){const {operation:d}=this.functionArguments,g=u.operandsCount[d],k=Object.keys(R.localOperators).find(t=>R.localOperators[t]===d)?.toLowerCase()??"undefined";var n=this.outputPixelType??"f32";let [h,q]=P.getPixelValueRange(n);if(n=P.isIntegerPixelType(n))h-=1E-4,q+=1E-4;return{imageCount:g,operationName:k,domainRange:[h,q],isOutputRounded:n}}_updateStatistics(d){var g=
this.sourceRasterInfos[0];const {operation:k}=this.functionArguments,n=u.getOutputDomain(k)?.domain;if(n)for(d.statistics=[],g=0;g<d.bandCount;g++)d.statistics[g]={min:n[0],max:n[1],avg:(n[0]+n[1])/2,stddev:(n[0]+n[1])/10};else 45===k&&g.statistics?.length&&(d.statistics=g.statistics.map(h=>({min:-h.max,max:-h.min,avg:null!=h.avg?-h.avg:void 0,stddev:null!=h.stddev?-h.stddev:void 0})))}_updatePixelType(d){const {statistics:g,pixelType:k}=this.sourceRasterInfos[0];var {operation:n}=this.functionArguments;
const {domain:h,isInteger:q}=u.getOutputDomain(n)??{domain:null,isInteger:!1};var t="f32";h&&q?t=P.getIntegerPixelType(h[0],h[1]):30===n?t=(n=g?.[0])?P.getIntegerPixelType(n.min,n.max):P.isIntegerPixelType(k)?k:"s32":45===n&&P.isIntegerPixelType(k)&&(t=g?.map(({max:x})=>-x),n=g?.map(({min:x})=>-x),t=t?.length?Math.min(...t):null,n=n?.length?Math.min(...n):null,t=null!=t&&null!=n?P.getIntegerPixelType(t,n):k.startsWith("s")?k.replace("s","u"):"u1"===k||"u2"===k||"u4"===k?"s8":"u8"===k?"s16":"s32");
d.pixelType=this.outputPixelType=this._getOutputPixelType(t)}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:p,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.LocalFunction")],w)})},"esri/layers/support/rasterFunctions/LocalFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P){var J;L=J=class extends P{constructor(){super(...arguments);this.rasters=[];this.processAsMultiband=!0}writeRasters(p,u){u.rasters=p.map(d=>"number"===typeof d||"string"===typeof d?d:d.toJSON())}clone(){return new J({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:v.clone(this.rasters)})}};m.__decorate([w.property({json:{write:!0}})],L.prototype,"operation",void 0);m.__decorate([w.property({json:{write:!0}})],L.prototype,"rasters",void 0);m.__decorate([R.writer("rasters")],
L.prototype,"writeRasters",null);m.__decorate([w.property({json:{write:!0}})],L.prototype,"processAsMultiband",void 0);return L=J=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.LocalFunctionArguments")],L)})},"esri/layers/support/rasterFunctions/MaskFunction":function(){define("../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./MaskFunctionArguments ./pixelUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p){L=class extends P{constructor(){super(...arguments);this.functionName="Mask";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){var u=this.sourceRasterInfos[0].clone();const {pixelType:d}=u;this.outputPixelType=this._getOutputPixelType(d);u.pixelType=this.outputPixelType;this.rasterInfo=u;const {includedRanges:g,normalizedNoDataValues:k}=this.functionArguments;if(!g?.length&&!k?.length)return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};
let n=[];for(let h=0;h<u.bandCount;h++){const q=p.createMaskLUT(d,g?.slice(2*h,2*h+2),k?.[h]);if(null==q){n=null;break}n.push(q)}this.lookups=n;u=null!=k&&k.every(h=>h?.length===k[0]?.length);return{success:!0,supportsGPU:(!g||g.length<=2*p.maxMapSizeGpu)&&(!k||u&&k[0].length<=p.maxMapSizeGpu)}}_processPixels(u){u=u.pixelBlocks?.[0];if(null==u)return null;const {outputPixelType:d,lookups:g}=this,{includedRanges:k,noDataInterpretation:n,normalizedNoDataValues:h}=this.functionArguments;return p.mask(u,
{includedRanges:k,noDataValues:h,outputPixelType:d,matchAll:n===p.NoDataInterpretation.matchAll,lookups:g})}_getWebGLParameters(){const {includedRanges:u,normalizedNoDataValues:d}=this.functionArguments,g=new Float32Array(p.maxMapSizeGpu);g.fill(v.numberMaxFloat32);d?.[0]?.length&&g.set(d[0]);const k=new Float32Array(p.maxMapSizeGpu);for(let n=0;n<k.length;n+=2)k[n]=u?.[n]??-v.numberMaxFloat32,k[n+1]=u?.[n+1]??v.numberMaxFloat32;u&&u.length&&k.set(u);return{bandCount:this.sourceRasterInfos[0].bandCount,
noDataValues:g,includedRanges:k}}};m.__decorate([w.property({json:{write:!0,name:"rasterFunction"}})],L.prototype,"functionName",void 0);m.__decorate([w.property({type:J,json:{write:!0,name:"rasterFunctionArguments"}})],L.prototype,"functionArguments",void 0);m.__decorate([w.property()],L.prototype,"rasterArgumentNames",void 0);m.__decorate([w.property({json:{write:!0}})],L.prototype,"lookups",void 0);return L=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.MaskFunction")],L)})},"esri/layers/support/rasterFunctions/MaskFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments ./pixelUtils".split(" "),
function(m,v,w,L,E,T,R,P){var J;w=J=class extends R{constructor(){super(...arguments);this.noDataValues=this.includedRanges=null;this.noDataInterpretation=P.NoDataInterpretation.matchAny}get normalizedNoDataValues(){var {noDataValues:p}=this;if(!p?.length)return null;let u=!1;p=p.map(d=>"number"===typeof d?(u=!0,[d]):"string"===typeof d?(d=d.trim().split(" ").filter(g=>""!==g.trim()).map(g=>Number(g)),u=u||0<d.length,0===d.length?null:d):null);return u?p:null}clone(){return new J({includedRanges:this.includedRanges?.slice()??
[],noDataValues:this.noDataValues?.slice()??[],noDataInterpretation:this.noDataInterpretation})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,"includedRanges",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"noDataValues",void 0);m.__decorate([v.property()],w.prototype,"normalizedNoDataValues",null);m.__decorate([v.property({json:{write:!0}})],w.prototype,"noDataInterpretation",void 0);return w=J=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.MaskFunctionArguments")],
w)})},"esri/layers/support/rasterFunctions/NDVIFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./bandIndexUtils ./BaseRasterFunction ./NDVIFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P,J){w=class extends P{constructor(){super(...arguments);this.functionName="NDVI";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const {scientificOutput:p,
visibleBandID:u,infraredBandID:d}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(p?"f32":"u8");var g=this.sourceRasterInfos[0];const k=Math.max(u,d);if(2>g.bandCount||k>=g.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};g=g.clone();g.pixelType=this.outputPixelType;g.colormap=null;g.histograms=null;g.bandCount=1;g.keyProperties={...g.keyProperties,BandProperties:void 0};const [n,h,q,t]=p?[-1,1,0,.1]:[0,200,
100,10];g.statistics=[{min:n,max:h,avg:q,stddev:t}];this.rasterInfo=g;return{success:!0,supportsGPU:!0}}_processPixels(p){p=p.pixelBlocks?.[0];if(null==p)return null;const {visibleBandID:u,infraredBandID:d,scientificOutput:g}=this.functionArguments;return R.calculateNDVI(p,u,d,!g)}_getWebGLParameters(){const {visibleBandID:p,infraredBandID:u,scientificOutput:d}=this.functionArguments;return{bandIndexMat3:R.getBandMatrix3(this.isInputBandIdsSwizzled?[0,1,2]:[u,p,0]),scaled:!d}}_getInputBandIds(p){const {visibleBandID:u,
infraredBandID:d}=this.functionArguments;return[d,u,0].map(g=>p[g])}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:J,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.NDVIFunction")],w)})},"esri/layers/support/rasterFunctions/NDVIFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;w=P=class extends R{constructor(){super(...arguments);this.visibleBandID=0;this.infraredBandID=1;this.scientificOutput=!1}clone(){const {visibleBandID:J,infraredBandID:p,scientificOutput:u}=this;return new P({visibleBandID:J,infraredBandID:p,scientificOutput:u})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,"visibleBandID",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"infraredBandID",void 0);m.__decorate([v.property({json:{write:!0}})],
w.prototype,"scientificOutput",void 0);return w=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],w)})},"esri/layers/support/rasterFunctions/RemapFunction":function(){define("../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./pixelUtils ./RemapFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){L=class extends J{constructor(){super(...arguments);this.functionName="Remap";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.lookup=null}_bindSourceRasters(){const d=this.sourceRasterInfos[0].clone(),{pixelType:g}=d;this.outputPixelType=this._getOutputPixelType(g);d.pixelType=this.outputPixelType;d.colormap=null;d.histograms=null;d.bandCount=1;d.attributeTable=null;const {statistics:k}=d,{allowUnmatched:n,outputValues:h,inputRanges:q,noDataRanges:t,
isLastInputRangeInclusive:x}=this.functionArguments;if(null!=k&&k.length&&h?.length)if(n){var b=Math.min.apply(null,[...h,k[0].min]),e=Math.max.apply(null,[...h,k[0].max]);d.statistics=[{...k[0],min:b,max:e}]}else{e=b=h[0];for(let a=0;a<h.length;a++)b=b>h[a]?h[a]:b,e=e>h[a]?e:h[a];d.statistics=[{...k[0],min:b,max:e}]}this.rasterInfo=d;this.lookup=n?null:p.createRemapLUT({srcPixelType:g,inputRanges:q,outputValues:h,noDataRanges:t,allowUnmatched:n,isLastInputRangeInclusive:x,outputPixelType:this.outputPixelType});
return{success:!0,supportsGPU:(!h||h.length<=p.maxMapSizeGpu)&&(!t||t.length<=p.maxMapSizeGpu)}}_processPixels(d){d=d.pixelBlocks?.[0];if(null==d)return null;const {lookup:g,outputPixelType:k}=this;if(g){const b=p.lookupPixels(d,{lut:[g.lut],offset:g.offset,outputPixelType:k});null!=b&&g.mask&&(b.mask=p.lookupBandValues(d.pixels[0],d.mask,g.mask,g.offset,"u8"));return b}const {inputRanges:n,outputValues:h,noDataRanges:q,allowUnmatched:t,isLastInputRangeInclusive:x}=this.functionArguments;return p.remap(d,
{inputRanges:n,outputValues:h,noDataRanges:q,outputPixelType:k,allowUnmatched:t,isLastInputRangeInclusive:x})}_getWebGLParameters(){const {allowUnmatched:d,noDataRanges:g,isLastInputRangeInclusive:k}=this.functionArguments,n=new Float32Array(3*p.maxMapSizeGpu);var h=this.functionArguments.inputRanges??[],q=this.functionArguments.outputValues??[];const t=q.length;for(let x=0;x<p.maxMapSizeGpu;x++)if(n[3*x]=h[2*x]??v.numberMaxFloat32-1,n[3*x+1]=h[2*x+1]??v.numberMaxFloat32,n[3*x+2]=q[x]??0,x<t&&(0<
x&&(n[3*x]-=1E-5),x<t-1||!k))n[3*x+1]-=1E-5;h=new Float32Array(2*p.maxMapSizeGpu);h.fill(v.numberMaxFloat32);g?.length&&h.set(g);q=P.getPixelValueRange(this.outputPixelType);return{allowUnmatched:d,rangeMaps:n,noDataRanges:h,clampRange:q}}};m.__decorate([w.property({json:{write:!0,name:"rasterFunction"}})],L.prototype,"functionName",void 0);m.__decorate([w.property({type:u,json:{write:!0,name:"rasterFunctionArguments"}})],L.prototype,"functionArguments",void 0);m.__decorate([w.property()],L.prototype,
"rasterArgumentNames",void 0);m.__decorate([w.property({json:{write:!0}})],L.prototype,"lookup",void 0);return L=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.RemapFunction")],L)})},"esri/layers/support/rasterFunctions/RemapFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;w=P=class extends R{constructor(){super(...arguments);this.noDataRanges=this.outputValues=this.inputRanges=null;this.isLastInputRangeInclusive=this.allowUnmatched=!1}clone(){return new P({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};m.__decorate([v.property({json:{write:!0}})],w.prototype,"inputRanges",void 0);m.__decorate([v.property({json:{write:!0}})],
w.prototype,"outputValues",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"noDataRanges",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"allowUnmatched",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"isLastInputRangeInclusive",void 0);return w=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.RemapFunctionArguments")],w)})},"esri/layers/support/rasterFunctions/SlopeFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./SlopeFunctionArguments ./surfaceUtils".split(" "),
function(m,v,w,L,E,T,R,P,J){w=class extends R{constructor(){super(...arguments);this.functionName="Slope";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const p=this.sourceRasterInfos[0].clone();p.pixelType=this.outputPixelType;p.statistics="percent-rise"!==this.functionArguments.slopeType?[{min:0,max:90,avg:1,stddev:1}]:null;p.histograms=null;p.colormap=null;p.attributeTable=null;p.bandCount=
1;this.rasterInfo=p;this.isGCS=p.spatialReference?.isGeographic??!1;return{success:!0,supportsGPU:!0}}_processPixels(p){const u=p.pixelBlocks?.[0];if(null==u)return null;const {zFactor:d,slopeType:g,pixelSizePower:k,pixelSizeFactor:n}=this.functionArguments,{isGCS:h}=this,{extent:q,primaryPixelSizes:t}=p;p=t?.[0];return J.slope(u,{zFactor:d,slopeType:g,pixelSizePower:k,pixelSizeFactor:n,isGCS:h,resolution:null==p?q?{x:q.width/u.width,y:q.height/u.height}:{x:1,y:1}:p})}_getWebGLParameters(){const {zFactor:p,
slopeType:u,pixelSizeFactor:d,pixelSizePower:g}=this.functionArguments;return{zFactor:this.isGCS&&1<=p?p*J.gcsFactor:p,slopeType:u,pixelSizeFactor:d??0,pixelSizePower:g??0}}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],
w.prototype,"isGCS",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.SlopeFunction")],w)})},"esri/layers/support/rasterFunctions/SlopeFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P,J){var p;v=new v.JSONMap({1:"degree",2:"percent-rise",3:"adjusted"},{useNumericKeys:!0});J=p=class extends J{constructor(){super(...arguments);this.slopeType="degree";this.zFactor=1;this.pixelSizePower=.664;this.pixelSizeFactor=.024;this.removeEdgeEffect=!1}clone(){return new p({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};m.__decorate([R.enumeration(v)],
J.prototype,"slopeType",void 0);m.__decorate([w.property({type:Number,json:{write:!0}})],J.prototype,"zFactor",void 0);m.__decorate([w.property({type:Number,json:{name:"psPower",write:!0}})],J.prototype,"pixelSizePower",void 0);m.__decorate([w.property({type:Number,json:{name:"psZFactor",write:!0}})],J.prototype,"pixelSizeFactor",void 0);m.__decorate([w.property({type:Boolean,json:{write:!0}})],J.prototype,"removeEdgeEffect",void 0);return J=p=m.__decorate([P.subclass("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],
J)})},"esri/layers/support/rasterFunctions/StatisticsFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./focalStatUtils ./StatisticsFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P,J,p){w=class extends P{constructor(){super(...arguments);this.functionName="Statistics";this.rasterArgumentNames=
["raster"]}_bindSourceRasters(){const {type:u}=this.functionArguments.toJSON();if(1>u||7<u)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${u}`};var d=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(d.pixelType);d=d.clone();d.pixelType=this.outputPixelType;const {statisticsType:g}=this.functionArguments;"stddev"===g&&this._removeStatsHistColormapVAT(d);this.rasterInfo=d;return{success:!0,supportsGPU:3>=d.bandCount&&5>
u}}_processPixels(u){u=u.pixelBlocks?.[0];if(null==u)return u;const {statisticsType:d,rows:g,cols:k,fillNoDataOnly:n}=this.functionArguments;return J.computeFocalStatistics(u,{kernelRows:g,kernelCols:k,fillNoDataOnly:n,outputPixelType:this.outputPixelType,statisticsType:d,mirrorEdges:!0})}_getWebGLParameters(){const {rows:u,cols:d,statisticsType:g,fillNoDataOnly:k}=this.functionArguments;return{fillNoDataOnly:k,kernelRows:u,kernelCols:d,statisticsType:g,clampRange:R.getPixelValueRange(this.outputPixelType)}}};
m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:p,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.StatisticsFunction")],w)})},"esri/layers/support/rasterFunctions/focalStatUtils":function(){define(["exports","../../../core/has","../../../core/jsonMap",
"../PixelBlock","./mirror"],function(m,v,w,L,E){function T(R,P){const {fillNoDataOnly:J}=P,{band:p,width:u,height:d,mask:g,outBand:k}=R;if(J&&!g)k.set(p);else{var {kernelRows:n,kernelCols:h}=P;R=Math.floor(n/2);P=Math.floor(h/2);var q=k.slice(),t=new Uint32Array(u*d);for(var x=R;x<d-R;x++){var b=x*u;for(var e=P;e<u-P;e++){if(J&&g&&g[b+e])continue;const a=[];for(let c=0;c<n;c++)for(let f=0;f<h;f++){const l=b+e+(c-R)*u+f-P;g&&!g[l]||a.push(p[l])}a.length&&(a.sort((c,f)=>c-f),g?(q[b+e]=a[Math.floor((a.length-
1)/2)],t[b+e]=a.length):k[b+e]=a[Math.floor((a.length-1)/2)])}}if(g)for(x=R;x<d-R;x++)for(b=x*u,e=P;e<u-P;e++)!t[b+e]||J&&g[b+e]||(k[b+e]=q[b+e],g[b+e]=255)}}v=new w.JSONMap({1:"min",2:"max",3:"mean",4:"stddev",5:"median",6:"majority",7:"minority"},{useNumericKeys:!0});m.computeFocalStatistics=function(R,P){const {mask:J}=R,{fillNoDataOnly:p}=P;if(p&&!J)return R;const {pixels:u,width:d,height:g,bandMasks:k,pixelType:n}=R,h=u.length,q=d*g,t=[],{kernelRows:x,kernelCols:b,statisticsType:e,mirrorEdges:a}=
P;if(p&&!J)return R;const c=P.outputPixelType??n,f=[];for(let K=0;K<h;K++){const H=u[K],D=L.createEmptyBand(c,q);p&&D.set(H);const G=(k?.[K]??J)?.slice()??null,S={band:H,width:d,height:g,mask:G,outBand:D};switch(e){case "min":case "max":a:{var l=P;const {fillNoDataOnly:A}=l,{band:B,width:Q,height:O,mask:C,outBand:M}=S;if(A&&!C){M.set(B);break a}const {kernelRows:N,kernelCols:U,statisticsType:X}=l,I=Math.floor(N/2),V=Math.floor(U/2),W="min"===X,Z=M.slice(),Y=new Uint32Array(Q*O);for(let aa=I;aa<O-
I;aa++){const ea=aa*Q;for(let fa=V;fa<Q-V;fa++){let ca=W?Number.MAX_VALUE:-Number.MAX_VALUE,ja=0;for(let la=0;la<N;la++)for(let na=0;na<U;na++){const oa=ea+fa+(la-I)*Q+na-V;if(!C||C[oa])ca=W?Math.min(ca,B[oa]):Math.max(ca,B[oa]),ja++}C?(Z[ea+fa]=0===ja?0:ca,Y[ea+fa]=ja):M[ea+fa]=0===ja?0:ca}}if(C)for(let aa=I;aa<O-I;aa++){const ea=aa*Q;for(let fa=V;fa<Q-V;fa++)!Y[ea+fa]||A&&C[ea+fa]||(M[ea+fa]=Z[ea+fa],C[ea+fa]=255)}}break;case "mean":case "stddev":a:{var r=P;const {fillNoDataOnly:A}=r,{band:B,width:Q,
height:O,mask:C,outBand:M}=S;if(A&&!C){M.set(B);break a}const {statisticsType:N,kernelRows:U,kernelCols:X}=r,I="stddev"===N,V=Q*O,W=new Float64Array(V),Z=new Float64Array(V),Y=new Uint32Array(V);for(let na=0;na<O;na++){const oa=na*Q;let qa=0,sa=0,ra=0;for(let ua=0;ua<X;ua++)if(!C||C[oa+ua])qa+=B[oa+ua],I&&(sa+=B[oa+ua]**2),ra++;W[oa]=qa;Z[oa]=sa;Y[oa]=ra;for(let ua=1;ua<=Q-X;ua++){const pa=oa+ua-1,xa=pa+X;C?(C[pa]&&(ra--,qa-=B[pa],I&&(sa-=B[pa]**2)),C[xa]&&(ra++,qa+=B[xa],I&&(sa+=B[xa]**2))):(qa-=
B[pa],qa+=B[xa],I&&(sa-=B[pa]**2,sa+=B[xa]**2));W[oa+ua]=qa;Y[oa+ua]=ra;I&&(Z[oa+ua]=sa)}}const aa=new Float64Array(V),ea=new Float64Array(V),fa=new Uint32Array(V),ca=U*Q;for(let na=0;na<=Q-X;na++){let oa=0,qa=0,sa=0;for(let ra=0;ra<U;ra++){const ua=ra*Q+na;oa+=W[ua];sa+=Y[ua];I&&(qa+=Z[ua])}aa[na]=oa;ea[na]=qa;fa[na]=sa;for(let ra=1;ra<=O-U;ra++){const ua=(ra-1)*Q+na,pa=ua+ca;oa-=W[ua];oa+=W[pa];sa-=Y[ua];sa+=Y[pa];I&&(qa-=Z[ua],qa+=Z[pa]);aa[ra*Q+na]=oa;ea[ra*Q+na]=qa;fa[ra*Q+na]=sa}}const ja=Math.floor(U/
2),la=Math.floor(X/2);for(let na=ja;na<O-ja;na++){const oa=na*Q;for(let qa=la;qa<Q-la;qa++){const sa=(na-ja)*Q+qa-la,ra=fa[sa];if(0===ra||A&&(!C||C[oa+qa]))continue;const ua=aa[sa]/ra;M[oa+qa]=I?Math.sqrt((ea[sa]-aa[sa]*ua)/ra):ua;C&&(C[oa+qa]=255)}}}break;case "median":T(S,P);break;case "majority":case "minority":a:{var z=P;const {fillNoDataOnly:A}=z,{band:B,width:Q,height:O,mask:C,outBand:M}=S;if(A&&!C){M.set(B);break a}const {kernelRows:N,kernelCols:U}=z,X=Math.floor(N/2),I=Math.floor(U/2),V="majority"===
z.statisticsType,W=N*U,Z=M.slice(),Y=new Uint32Array(Q*O);for(let aa=X;aa<O-X;aa++){const ea=aa*Q;for(let fa=I;fa<Q-I;fa++){if(A&&C&&C[ea+fa])continue;const ca=new Map;for(let oa=0;oa<N;oa++)for(let qa=0;qa<U;qa++){const sa=ea+fa+(oa-X)*Q+qa-I;if(C&&!C[sa])continue;const ra=B[sa];ca.set(ra,ca.has(ra)?ca.get(ra)+1:1)}if(0===ca.size)continue;let ja=0,la=0,na=V?0:W+1;for(const oa of ca.keys())la=ca.get(oa),V===la>na&&(na=la,ja=oa);C?(Z[ea+fa]=ja,Y[ea+fa]=ca.size):M[ea+fa]=ja}}if(C)for(let aa=X;aa<O-
X;aa++){const ea=aa*Q;for(let fa=I;fa<Q-I;fa++)!Y[ea+fa]||A&&C[ea+fa]||(M[ea+fa]=Z[ea+fa],C[ea+fa]=255)}}}a&&!p&&E.mirror(D,d,g,x,b);t.push(D);G&&f.push(G)}let y=f[0]??J;f.length!==h&&(f.length=0);1<h&&k?.length&&(y=L.combineBandMasks(k));const F=new L({pixelType:c,width:d,height:g,pixels:t,bandMasks:k&&f.length?f:null,mask:y});F.updateStatistics();return F};m.statisticsTypeMap=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/StatisticsFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments ./focalStatUtils".split(" "),
function(m,v,w,L,E,T,R,P,J){var p;L=p=class extends P{constructor(){super(...arguments);this.cols=this.rows=3;this.fillNoDataOnly=!1;this.statisticsType="min"}clone(){return new p({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:v.clone(this.raster)})}};m.__decorate([w.property({json:{write:!0,read:{source:["kernelRows","rows"],reader:(u,d)=>Number(u??d?.kernelRows??3)}}})],L.prototype,"rows",void 0);m.__decorate([w.property({json:{write:!0,
read:{source:["kernelCols","cols"],reader:(u,d)=>Number(u??d?.kernelCols??3)}}})],L.prototype,"cols",void 0);m.__decorate([w.property({json:{write:!0}})],L.prototype,"fillNoDataOnly",void 0);m.__decorate([w.property({json:{read:{source:["statisticsType","type"],reader:(u,d)=>J.statisticsTypeMap.fromJSON(d?.statisticsType??d?.type)??"min"},write:{target:"type"}}}),T.enumeration(J.statisticsTypeMap)],L.prototype,"statisticsType",void 0);return L=p=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.StatisticsFunctionArguments")],
L)})},"esri/layers/support/rasterFunctions/StatisticsHistogramFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./StatisticsHistogramFunctionArguments".split(" "),function(m,v,w,L,E,T,R,P){w=class extends R{constructor(){super(...arguments);this.functionName="StatisticsHistogram";this.functionArguments=null;this.rasterArgumentNames=
["raster"];this.isNoopProcess=!0}_bindSourceRasters(){var J=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");J=J.clone();const {statistics:p,histograms:u}=this.functionArguments;u&&(J.histograms=u);p&&(J.statistics=p);this.rasterInfo=J;return{success:!0,supportsGPU:!0}}_processPixels(J){return J.pixelBlocks?.[0]}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],
w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"indexedColormap",void 0);m.__decorate([v.property()],w.prototype,"isNoopProcess",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.StatisticsHistogramFunction")],w)})},"esri/layers/support/rasterFunctions/StatisticsHistogramFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P,J){var p;L=p=class extends J{constructor(){super(...arguments);this.histograms=this.statistics=null}readStatistics(u,d){if(!u?.length)return null;const g=[];u.forEach(k=>{g.push({min:k.min,max:k.max,avg:k.avg??k.mean,stddev:k.stddev??k.standardDeviation})});return g}writeStatistics(u,d,g){if(u?.length){var k=[];u.forEach(n=>{n={...n,mean:n.avg,standardDeviation:n.stddev};delete n.avg;delete n.stddev;k.push(n)});d[g]=k}}clone(){return new p({statistics:v.clone(this.statistics),
histograms:v.clone(this.histograms)})}};m.__decorate([w.property({json:{write:!0}})],L.prototype,"statistics",void 0);m.__decorate([T.reader("statistics")],L.prototype,"readStatistics",null);m.__decorate([P.writer("statistics")],L.prototype,"writeStatistics",null);m.__decorate([w.property({json:{write:!0}})],L.prototype,"histograms",void 0);return L=p=m.__decorate([R.subclass("esri.layers.support.rasterFunctions.StatisticsHistogramFunctionArguments")],L)})},"esri/layers/support/rasterFunctions/StretchFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./pixelUtils ./StretchFunctionArguments ./stretchUtils".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u){w=class extends P{constructor(){super(...arguments);this.functionName="Stretch";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.cutOffs=this.lookup=null}_bindSourceRasters(){this.cutOffs=this.lookup=null;var d=this.sourceRasterInfos[0];const {pixelType:g}=d;var {functionArguments:k}=this;const {dynamicRangeAdjustment:n,gamma:h,useGamma:q}=k;if(!n&&["u8","u16","s8","s16"].includes(g)){k=u.getStretchCutoff(k.toJSON(),{rasterInfo:d});const t=R.isIntegerPixelType(this.outputPixelType)?
"round":"float";this.lookup=u.createStretchLUT({pixelType:g,...k,gamma:q?h:null,rounding:t});this.cutOffs=k}else n||(this.cutOffs=u.getStretchCutoff(k.toJSON(),{rasterInfo:d}));this.outputPixelType=this._getOutputPixelType(g);d=d.clone();d.pixelType=this.outputPixelType;this._removeStatsHistColormapVAT(d);"u8"===this.outputPixelType&&(d.keyProperties.DataType="processed");this.rasterInfo=d;return{success:!0,supportsGPU:!n}}_processPixels(d){d=d.pixelBlocks?.[0];if(null==d)return d;var {lookup:g}=
this;if(g)return J.lookupPixels(d,{...g,outputPixelType:this.rasterInfo.pixelType});({functionArguments:g}=this);const k=this.cutOffs||u.getStretchCutoff(g.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:d});return u.stretch(d,{...k,gamma:g.useGamma?g.gamma:null,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const {outputMin:d=0,outputMax:g=255,gamma:k,useGamma:n}=this.functionArguments,h=2<=this.rasterInfo.bandCount?3:1,q=n&&k?.length?u.computeGammaCorrection(h,k):[1,1,1],
{minCutOff:t,maxCutOff:x}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===t.length&&(t[1]=t[2]=t[0],x[1]=x[2]=x[0]);const b=new Float32Array(h);var e;for(e=0;e<h;e++)b[e]=(g-d)/(x[e]-t[e]);e=R.isIntegerPixelType(this.outputPixelType);return{bandCount:h,outMin:d,outMax:g,minCutOff:t,maxCutOff:x,factor:b,useGamma:n,gamma:n&&k?k:[1,1,1],gammaCorrection:n&&q?q:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:e,type:"stretch"}}};m.__decorate([v.property({json:{write:!0,
name:"rasterFunction"}})],w.prototype,"functionName",void 0);m.__decorate([v.property({type:p,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"lookup",void 0);m.__decorate([v.property({json:{write:!0}})],w.prototype,"cutOffs",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.StretchFunction")],w)})},"esri/layers/support/rasterFunctions/StretchFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P,J,p){var u;v=new v.JSONMap({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",9:"sigmoid"},{useNumericKeys:!0});p=u=class extends p{constructor(){super(...arguments);this.dynamicRangeAdjustment=this.computeGamma=!1;this.gamma=[];this.statistics=this.histograms=null;this.stretchType="none";this.useGamma=!1}writeStatistics(d,g,k){d?.length&&(Array.isArray(d[0])||(d=d.map(n=>[n.min,n.max,n.avg,n.stddev])),g[k]=d)}clone(){return new u({stretchType:this.stretchType,
outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:w.clone(this.statistics),gamma:w.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:w.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};m.__decorate([L.property({type:Boolean,json:{write:!0}})],p.prototype,
"computeGamma",void 0);m.__decorate([L.property({type:Boolean,json:{name:"dra",write:!0}})],p.prototype,"dynamicRangeAdjustment",void 0);m.__decorate([L.property({type:[Number],json:{write:!0}})],p.prototype,"gamma",void 0);m.__decorate([L.property()],p.prototype,"histograms",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],p.prototype,"maxPercent",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],p.prototype,"minPercent",void 0);m.__decorate([L.property({type:Number,
json:{write:!0}})],p.prototype,"numberOfStandardDeviations",void 0);m.__decorate([L.property({type:Number,json:{name:"max",write:!0}})],p.prototype,"outputMax",void 0);m.__decorate([L.property({type:Number,json:{name:"min",write:!0}})],p.prototype,"outputMin",void 0);m.__decorate([L.property({type:Number,json:{write:!0}})],p.prototype,"sigmoidStrengthLevel",void 0);m.__decorate([L.property({json:{type:[[Number]],write:!0}})],p.prototype,"statistics",void 0);m.__decorate([J.writer("statistics")],p.prototype,
"writeStatistics",null);m.__decorate([R.enumeration(v)],p.prototype,"stretchType",void 0);m.__decorate([L.property({type:Boolean,json:{write:!0}})],p.prototype,"useGamma",void 0);return p=u=m.__decorate([P.subclass("esri.layers.support.rasterFunctions.StretchFunctionArguments")],p)})},"esri/layers/support/rasterFunctions/TableFunction":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./TableFunctionArguments".split(" "),
function(m,v,w,L,E,T,R,P){w=class extends R{constructor(){super(...arguments);this.functionName="Table";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isNoopProcess=!0}_bindSourceRasters(){var J=this.sourceRasterInfos[0];if(1<J.bandCount||J.pixelType.startsWith("f"))return{success:!1,supportsGPU:!1,error:"table-function: Source data must be single band and integer pixel type."};const {attributeTableAsRecordSet:p}=this.functionArguments;if(!p)return{success:!1,supportsGPU:!1,
error:"table-function: Missing attributeTableAsRecordSet argument."};this.outputPixelType=this._getOutputPixelType(J.pixelType);J=J.clone();J.pixelType=this.outputPixelType;J.bandCount=1;"thematic"!==J.dataType&&(J.keyProperties=J.keyProperties?{...J.keyProperties,DataType:"thematic"}:{DataType:"thematic"});this.rasterInfo=J;return{success:!0,supportsGPU:!0}}_processPixels(J){return J.pixelBlocks?.[0]}};m.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],w.prototype,"functionName",
void 0);m.__decorate([v.property({type:P,json:{write:!0,name:"rasterFunctionArguments"}})],w.prototype,"functionArguments",void 0);m.__decorate([v.property()],w.prototype,"rasterArgumentNames",void 0);m.__decorate([v.property()],w.prototype,"isNoopProcess",void 0);return w=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.TableFunction")],w)})},"esri/layers/support/rasterFunctions/TableFunctionArguments":function(){define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./BaseFunctionArguments".split(" "),
function(m,v,w,L,E,T,R){var P;L=P=class extends R{constructor(){super(...arguments);this.attributeTableAsRecordSet=null}clone(){return new P({attributeTableAsRecordSet:v.clone(this.attributeTableAsRecordSet)})}};m.__decorate([w.property({json:{write:!0}})],L.prototype,"attributeTableAsRecordSet",void 0);return L=P=m.__decorate([T.subclass("esri.layers.support.rasterFunctions.TableFunctionArguments")],L)})},"esri/renderers/support/rasterRendererHelper":function(){define("exports ../../Color ../../rasterRenderers ../../core/unitUtils ../../layers/support/Field ../FlowRenderer ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./rasterRendererChecks ./UniqueValueInfo ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b){function e(C,M){C=a(C,M?.variableName);const {bandCount:N}=C;let {bandIds:U,stretchType:X}=M||{};U?.some(Y=>Y>=N)&&(U=null);let I=C.statistics,V=C.histograms;1<N?(U=U?.length?U:c(C),I=null==I?null:U?.map(Y=>I[Y]),V=null==V?null:U?.map(Y=>V[Y])):U=[0];null==X&&(X=l(C));let W=!1;switch(X){case "none":W=!1;break;case "percent-clip":W=!V?.length;break;default:W=!I?.length}var {dataType:Z}=C;Z=1===U?.length&&Q.has(Z)?A:null;Z=new n({stretchType:X,dynamicRangeAdjustment:W,
colorRamp:Z,outputMin:0,outputMax:255,gamma:1===U?.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===X?Z.maxPercent=Z.minPercent=.25:"standard-deviation"===X&&(Z.numberOfStandardDeviations=2);if(!W&&(null!=C.multidimensionalInfo||M?.includeStatisticsInStretch))if("percent-clip"===X)Z.histograms=V;else if("min-max"===X||"standard-deviation"===X)Z.statistics=I;return Z}function a(C,M){var {multidimensionalInfo:N}=C;if(!M||!N)return C;N=N.variables.find(U=>U.name===M);if(!N)return C;C=C.clone();if(N){const {statistics:U,
histograms:X}=N;U?.length&&(C.statistics=U.map(I=>({min:I.min,max:I.max,avg:I.avg,stddev:I.stddev})));X?.length&&(C.histograms=X)}return C}function c(C){const M=C.bandCount;if(1===M)return null;if(2===M)return[0];({bandInfos:C}=C);let N;if(C.length===M){const {red:U,green:X,blue:I,nir:V}=f(C);null!=U&&null!=X&&null!=I?N=[U,X,I]:null!=V&&null!=U&&null!=X&&(N=[V,U,X])}!N&&3<=M&&(N=[0,1,2]);return N}function f(C){const M={};for(let X=0;X<C.length;X++){var N=C[X],U=N.name.toLowerCase();"red"===U?M.red=
X:"green"===U?M.green=X:"blue"===U?M.blue=X:"nearinfrared"===U||"nearinfrared_1"===U||"nir"===U?M.nir=X:N.maxWavelength&&N.minWavelength&&(U=N.minWavelength,N=N.maxWavelength,null==M.blue&&410<=U&&480>=U&&480<=N&&540>=N?M.blue=X:null==M.green&&490<=U&&560>=U&&560<=N&&610>=N?M.green=X:null==M.red&&595<=U&&670>=U&&660<=N&&730>=N?M.red=X:null==M.nir&&700<=U&&860>=U&&800<=N&&950>=N&&(M.nir=X))}return M}function l(C){let M="percent-clip";const {pixelType:N,dataType:U,histograms:X,statistics:I,multidimensionalInfo:V}=
C;C=Q.has(U)||"generic"===U&&null!=V;"u8"!==N||"processed"!==U&&null!=X&&null!=I?"u8"===N||"elevation"===U||C?M="min-max":null!=X?M="percent-clip":null!=I&&(M="min-max"):M="none";return M}function r(C,M,N,U){if(!p.isUVRendererSupported(C,M))return null;const {attributeTable:X,statistics:I}=C,V=z(X,M),W=F(X,"red"),Z=F(X,"green"),Y=F(X,"blue");C=new R;const aa=[],ea=new Set,fa=!!(W&&Z&&Y);if(null!=X)X.features.forEach(ca=>{var ja=ca.attributes[V.name];ea.has(ca.attributes[V.name])||null==ja||(ea.add(ja),
ja=!fa||"single"!==W.type&&"double"!==W.type||"single"!==Z.type&&"double"!==Z.type||"single"!==Y.type&&"double"!==Y.type||X.features.some(la=>1<la.attributes[W.name]||1<la.attributes[Z.name]||1<la.attributes[Y.name])?1:255,aa.push(new u({value:ca.attributes[V.name],label:ca.attributes[V.name]+"",symbol:{type:"simple-fill",style:"solid",outline:null,color:fa?new v([ca.attributes[W.name]*ja,ca.attributes[Z.name]*ja,ca.attributes[Y.name]*ja,1]):new v([0,0,0,0])}})))});else if(I?.[0])for(M=I[0].min;M<=
I[0].max;M++)aa.push(new u({value:M,label:M.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new v([0,0,0,0])}}));aa.sort((ca,ja)=>ca.value&&"string"===typeof ca.value.valueOf()?0:ca.value>ja.value?1:-1);if(!fa){const ca=J.convertColorRampToColormap(B,{numColors:aa.length});aa.forEach((ja,la)=>ja.symbol.color=new v(ca[la].slice(1,4)));C.colorRamp=B}if(N||U){const ca=N||J.convertColorRampToColormap(U,{numColors:aa.length}).map(ja=>ja.slice(1));aa.forEach((ja,la)=>ja.symbol.color=
new v(ca[la]));C.colorRamp=U}return new h({field:V.name,uniqueValueInfos:aa,authoringInfo:C})}function z(C,M,N){let U;null!=C?(U=M?C.fields.find(X=>M.toLowerCase()===X.name.toLowerCase()):y(C.fields),U||(N||(U=C.fields.find(X=>"string"===X.type)),U||=F(C,"value"))):U=new E({name:"value"});return U}function y(C){let M;for(let N=0;N<C.length;N++){const U=C[N].name.toLowerCase();if("string"===C[N].type){if(U.startsWith("class")){M=C[N];break}null==M&&(U.endsWith("name")||U.endsWith("type"))&&(M=C[N])}}return M}
function F(C,M){return null==C?null:C.fields.find(N=>N.name.toLowerCase()===M)}function K(C){if(!p.isColormapRendererSupported(C))return null;let M;const {attributeTable:N,colormap:U}=C;if(null!=N){const X=F(N,"value"),I=z(N,null,!0);"string"===I.type&&(M={},N.features.forEach(V=>{V=V.attributes;M[V[X.name]]=I?V[I.name]:V[X.name]}))}return q.createFromColormap(U,M)}function H(C,M,N){let U=0,X=0;null!=C.attributeTable?(C=C.attributeTable,U=X=C.features[0].attributes[M.name],C.features.forEach(I=>{I=
I.attributes[M.name];I<U&&(U=I);I>X&&(X=I)})):null!=C.histograms&&(C=C.histograms,U=C[0].min,X=C[0].max);return(X-U)/N}function D(C){if(!p.isVectorFieldRendererSupported(C))return null;if(null!=C.statistics&&C.statistics.length&&("vector-magdir"===C.dataType||"vector-uv"===C.dataType)){const {minMagnitude:N,maxMagnitude:U}=S(C.dataType,C.statistics);var M=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:N,maxDataValue:U}]}C=null!=C.multidimensionalInfo?O.get(C.multidimensionalInfo.variables[0].unit):
null;M=new b({visualVariables:M,inputUnit:C,rotationType:"geographic"});M.visualVariables=[...M.sizeVariables,...M.rotationVariables];return M}function G(C){return{color:C.symbolLayers[0].material?.color,type:"esriSFS",style:"esriSFSSolid"}}function S(C,M){if("vector-magdir"===C)C=M[0].min,M=M[0].max;else{const N=M[0].min,U=M[0].max,X=M[1].min;M=M[1].max;C=0;M=Math.max(Math.abs(N),Math.abs(X),Math.abs(U),Math.abs(M))}return{minMagnitude:C,maxMagnitude:M}}const A=k.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,
0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),B=k.fromJSON(J.predefinedJsonColorRamps[0]),Q=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" ")),O=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);m.createClassBreaksRenderer=function(C,M){C=a(C,M?.variableName);const {attributeTable:N}=
C;if(!p.isClassBreaksSupported(C))return null;const U=null!=C.histograms?C.histograms[0]:null,X=null!=M?.numClasses&&isFinite(M?.numClasses)?M.numClasses:5,I=new R({classificationMethod:M?.classificationMethod,colorRamp:M?.colorRamp});let V=M?.field||"value";const W=[],Z=[],Y=null!=N,aa=Y&&N.fields.find(la=>"count"===la.name.toLowerCase()),ea=Y?N.fields.find(la=>la.name.toLowerCase()===V.toLowerCase()):void 0;if(ea&&Y){V=ea.name;const la=N.features.length;let na=0;N.features.forEach(oa=>na+=(aa?oa.attributes[aa.name]:
50)/la);N.features.forEach(oa=>{const qa=oa.attributes[ea.name];oa=aa?oa.attributes[aa.name]:50;if(0<oa){Z.push(oa);oa=Math.max(1,Math.round(oa/la/na*1E3));for(let sa=0;sa<oa;sa++)W.push(qa)}})}else{var {pixelType:fa}=C;const la=(U.max-U.min)/U.size,na=(fa=fa.includes("s")||fa.includes("u"))&&1===la?Math.floor(U.min+.5):U.min,oa=fa&&1===la?Math.floor(U.max-.5):U.max,qa=U.size;let sa=0,ra;U.counts.forEach(ua=>sa+=ua/qa);U.counts.forEach((ua,pa)=>{if(0<ua)for(Z.push(ua),ua=Math.max(1,Math.round(ua/
qa/sa*1E3)),ra=Y?N.features[pa].attributes[ea.name]:0===pa?na:pa===qa-1?oa:U.min+la*(pa+.5),pa=0;pa<ua;pa++)W.push(ra)})}fa=M?.classificationMethod||"natural-breaks";let ca=M?.definedInterval;"defined-interval"!==fa||ca||(ca=H(C,ea,X));C=g.createGenerateRendererClassBreaks({values:W,valueFrequency:Z,normalizationTotal:null,definition:new d({classificationMethod:fa,breakCount:X,definedInterval:ca})});let ja=M?.colors;ja||(M=M?.colorRamp||A,I.colorRamp=M,ja=J.convertColorRampToColormap(M,{numColors:C.classBreaks.length,
interpolateAlpha:!0}).map(la=>la.slice(1)));M=C.classBreaks.map((la,na)=>new P({minValue:la.minValue,maxValue:la.maxValue,label:la.label,symbol:{type:"simple-fill",color:ja[na]}}));return new x({field:V,classBreakInfos:M,authoringInfo:I})};m.createColormapRenderer=K;m.createDefaultRenderer=function(C,M){const {attributeTable:N,colormap:U}=C;if(p.isVectorFieldRendererSupported(C)){var X=D(C);if(null!=X)return X}return null!=U&&(X=K(C),null!=X)||null!=N&&(X=r(C),null!=X)?X:e(C,M)};m.createFlowRenderer=
function(C){if(!p.isFlowRendererSupported(C))return null;let M;if(null!=C.statistics&&0<C.statistics.length&&("vector-magdir"===C.dataType||"vector-uv"===C.dataType)){const {minMagnitude:N,maxMagnitude:U}=S(C.dataType,C.statistics);M=[{type:"color",field:"Magnitude",stops:[{value:N,color:"#1020C0"},{value:U,color:"#C02010"}]}]}return new T({visualVariables:M})};m.createShadedReliefRenderer=function(C,M="traditional"){if(!p.isShadedReliefRendererSupported(C))return null;({extent:C}=C);C=C.width*L.getMetersPerUnitForSR(C.spatialReference);
return new t({hillshadeType:M,scalingType:5E6<C?"adjusted":"none"})};m.createStretchRenderer=e;m.createUVRenderer=r;m.createVectorFieldRenderer=D;m.estimateMagnitudeRange=S;m.getBandNames=function(C,M){const N=C.bandInfos.map(({name:U})=>U);return M?.length?M.map(U=>N[U]):N};m.getClassField=z;m.getDefaultBandCombination=c;m.getDefaultInterpolation=function(C,M,N){const U=["nearest","bilinear","cubic","majority"].find(X=>X===N?.toLowerCase());return"Map"===M?U??"bilinear":"standard-time"===C.dataType?
U??"nearest":"thematic"===C.dataType||C.attributeTable||C.colormap?"nearest"===U||"majority"===U?U:"nearest":U??"bilinear"};m.getDefinedInterval=H;m.getField=F;m.getSupportedRendererTypes=function(C,M=!1){const N=["raster-stretch"];p.isColormapRendererSupported(C,M)&&N.push("raster-colormap");p.isUVRendererSupported(C)&&N.push("unique-value");p.isClassBreaksSupported(C,M)&&N.push("class-breaks");p.isShadedReliefRendererSupported(C)&&N.push("raster-shaded-relief");p.isVectorFieldRendererSupported(C)&&
N.push("vector-field");p.isFlowRendererSupported(C)&&N.push("flow");return N};m.getVariableRasterInfo=a;m.getWellKnownBandIndexes=f;m.normalizeRendererJSON=function(C){if("uniqueValue"===C.type){var M=C.uniqueValueInfos;M?.[0].symbol?.symbolLayers?.length&&(C.uniqueValueInfos=M?.map(N=>({value:N.value,label:N.label,symbol:N.symbol?G(N.symbol):null})));return C}"classBreaks"===C.type&&(M=C.classBreakInfos,M[0].symbol?.symbolLayers?.length&&(C.classBreakInfos=M.map(N=>({classMinValue:N.classMinValue,
classMaxValue:N.classMaxValue,label:N.label,symbol:N.symbol?G(N.symbol):null}))));return C};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rasterRendererChecks":function(){define(["exports"],function(m){function v(w){return["u8","s8"].includes(w.pixelType)&&null!=w.statistics?.[0]?.min&&null!=w.statistics[0]?.max&&1===w.bandCount}m.isClassBreaksSupported=function(w,L=!1){const {attributeTable:E,bandCount:T}=w;return 1===T&&(!L||null!=E||null!=w.histograms)};
m.isColormapRendererSupported=function(w,L=!1){const {bandCount:E,colormap:T,pixelType:R}=w;return 1===E&&(!!T?.length||!L&&"u8"===R)};m.isFlowRendererSupported=function(w){({dataType:w}=w);return"vector-uv"===w||"vector-magdir"===w};m.isShadedReliefRendererSupported=function(w){const {bandCount:L,dataType:E,pixelType:T}=w;return"elevation"===E||"generic"===E&&1===L&&("s16"===T||"s32"===T||"f32"===T||"f64"===T)};m.isSingleBand8BitRasterWithStats=v;m.isUVRendererSupported=function(w,L){const {attributeTable:E,
bandCount:T}=w;return null==E&&v(w)?!0:null==E||1<T||L&&null==E.fields.find(R=>R.name.toLowerCase()===L.toLowerCase())?!1:!0};m.isVectorFieldRendererSupported=function(w){({dataType:w}=w);return"vector-uv"===w||"vector-magdir"===w};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(m,v,w,L,E,T,R,P,J){E=new v.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});v=new v.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});w=class extends w.JSONSupport{constructor(p){super(p);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(p){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",p)}set definedInterval(p){"defined-interval"===this.classificationMethod&&this._set("definedInterval",p)}};m.__decorate([P.enumeration({classBreaksDef:"class-breaks-definition"})],w.prototype,"type",void 0);m.__decorate([L.property({json:{write:!0}})],w.prototype,
"breakCount",void 0);m.__decorate([L.property({json:{write:!0}})],w.prototype,"classificationField",void 0);m.__decorate([L.property({type:String,json:{read:E.read,write:E.write}})],w.prototype,"classificationMethod",void 0);m.__decorate([L.property({json:{write:!0}})],w.prototype,"normalizationField",void 0);m.__decorate([L.property({json:{read:v.read,write:v.write}})],w.prototype,"normalizationType",void 0);m.__decorate([L.property({value:null,json:{write:!0}})],w.prototype,"standardDeviationInterval",
null);m.__decorate([L.property({value:null,json:{write:!0}})],w.prototype,"definedInterval",null);return w=m.__decorate([J.subclass("esri.rest.support.ClassBreaksDefinition")],w)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(m,v){function w(d){var g=d.definition;const {classificationMethod:k,normalizationType:n,definedInterval:h}=g;g=g.breakCount??1;const q=[];var t=d.values;if(0===t.length)return[];t=t.sort((f,l)=>f-l);var x=t[0],b=t[t.length-
1];if("equal-interval"===k)if(t.length>=g){t=(b-x)/g;d=x;for(var e=1;e<g;e++){var a=Number((x+e*t).toFixed(6));q.push({minValue:d,maxValue:a,label:L(d,a,n)});d=a}q.push({minValue:d,maxValue:b,label:L(d,b,n)})}else t.forEach(f=>{q.push({minValue:f,maxValue:f,label:L(f,f,n)})});else if("natural-breaks"===k){t=E(t);d=T(t.uniqueValues,d.valueFrequency||t.valueFrequency,g);for(e=1;e<g;e++)t.uniqueValues.length>e&&(a=Number(t.uniqueValues[d[e]].toFixed(6)),q.push({minValue:x,maxValue:a,label:L(x,a,n)}),
x=a);q.push({minValue:x,maxValue:b,label:L(x,b,n)})}else if("quantile"===k)if(t.length>=g&&x!==b){d=Math.ceil(t.length/g);e=0;for(a=1;a<g;a++){var c=d+e-1;c>t.length&&(c=t.length-1);0>c&&(c=0);q.push({minValue:x,maxValue:t[c],label:L(x,t[c],n)});x=t[c];e+=d;d=Math.ceil((t.length-e)/(g-a))}q.push({minValue:x,maxValue:b,label:L(x,b,n)})}else for(g=-1,b=0;b<t.length;b++)x=t[b],x!==g&&(g=x,q.push({minValue:g,maxValue:x,label:L(g,x,n)}),g=x);else if("standard-deviation"===k)if(d=J(t),e=p(t,d),0===e)q.push({minValue:t[0],
maxValue:t[0],label:L(t[0],t[0],n)});else{t=P(x,b,g,d,e)*e;e=0;for(a=g;1<=a;a--)c=Number((d-(a-.5)*t).toFixed(6)),q.push({minValue:x,maxValue:c,label:L(x,c,n)}),x=c,e++;a=Number((d+.5*t).toFixed(6));q.push({minValue:x,maxValue:a,label:L(x,a,n)});x=a;e++;for(c=1;c<=g;c++)a=e===2*g?b:Number((d+(c+.5)*t).toFixed(6)),q.push({minValue:x,maxValue:a,label:L(x,a,n)}),x=a,e++}else if("defined-interval"===k){if(!h)return q;g=t[0];b=t[t.length-1];t=Math.ceil((b-g)/h);x=g;for(d=1;d<t;d++)e=Number((g+d*h).toFixed(6)),
q.push({minValue:x,maxValue:e,label:L(x,e,n)}),x=e;q.push({minValue:x,maxValue:b,label:L(x,b,n)})}return q}function L(d,g,k){let n=null;return n=d===g?k&&"percent-of-total"===k?d+"%":d.toString():k&&"percent-of-total"===k?d+"% - "+g+"%":d+" - "+g}function E(d){const g=[],k=[];let n=Number.MIN_VALUE,h=1,q=-1;for(let t=0;t<d.length;t++){const x=d[t];x===n?(h++,k[q]=h):null!==x&&(g.push(x),n=x,h=1,k.push(h),q++)}return{uniqueValues:g,valueFrequency:k}}function T(d,g,k){var n=d.length;const h=[];k>n&&
(k=n);for(var q=0;q<k;q++)h.push(Math.round(q*n/k-1));h.push(n-1);q=R(h,d,g,k);n=q.mean;q=q.sdcm;var t=k,x=0,b=0;let e=0,a=0,c=!0;for(let l=0;2>l&&c;l++){0===l&&(c=!1);for(var f=0;f<t-1;f++)for(;h[f+1]+1!==h[f+2];)if(h[f+1]+=1,x=u(f,h,d,g),e=x.sbMean,x=x.sbSdcm,b=u(f+1,h,d,g),a=b.sbMean,b=b.sbSdcm,x+b<q[f]+q[f+1])q[f]=x,q[f+1]=b,n[f]=e,n[f+1]=a,c=!0;else{--h[f+1];break}for(f=t-1;0<f;f--)for(;h[f]!==h[f-1]+1;)if(--h[f],x=u(f-1,h,d,g),e=x.sbMean,x=x.sbSdcm,b=u(f,h,d,g),a=b.sbMean,b=b.sbSdcm,x+b<q[f-
1]+q[f])q[f-1]=x,q[f]=b,n[f-1]=e,n[f]=a,c=!0;else{h[f]+=1;break}}c&&(q=R(h,d,g,k));return h}function R(d,g,k,n){let h=[];var q=[],t=[];let x=0;const b=[],e=[];for(var a=0;a<n;a++){var c=u(a,d,g,k);b.push(c.sbMean);e.push(c.sbSdcm);x+=e[a]}c=x;for(a=!0;a||x<c;){a=!1;h=[];for(q=0;q<n;q++)h.push(d[q]);for(t=0;t<n;t++)for(c=d[t]+1;c<=d[t+1];c++)if(q=g[c],0<t&&c!==d[t+1]&&Math.abs(q-b[t])>Math.abs(q-b[t-1]))d[t]=c;else if(t<n-1&&d[t]!==c-1&&Math.abs(q-b[t])>Math.abs(q-b[t+1])){d[t+1]=c-1;break}c=x;x=0;
q=[];t=[];for(let f=0;f<n;f++){q.push(b[f]);t.push(e[f]);const l=u(f,d,g,k);b[f]=l.sbMean;e[f]=l.sbSdcm;x+=e[f]}}if(x>c){for(g=0;g<n;g++)d[g]=h[g],b[g]=q[g],e[g]=t[g];x=c}return{mean:b,sdcm:e}}function P(d,g,k,n,h){d=Math.max(n-d,g-n)/h/k;return 1<=d?1:.5<=d?.5:.25}function J(d){let g=0;for(let k=0;k<d.length;k++)g+=d[k];return g/=d.length}function p(d,g){let k=0;for(let n=0;n<d.length;n++){const h=d[n];k+=(h-g)*(h-g)}k/=d.length;return Math.sqrt(k)}function u(d,g,k,n){var h=0,q=0;for(var t=g[d]+
1;t<=g[d+1];t++){const x=n[t];h+=k[t]*x;q+=x}0>=q&&v.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");h/=q;q=0;for(t=g[d]+1;t<=g[d+1];t++)q+=n[t]*(k[t]-h)**2;return{sbMean:h,sbSdcm:q}}m.createGenerateRendererClassBreaks=function(d){const {normalizationTotal:g}=d;return{classBreaks:w(d),normalizationTotal:g}};m.createGenerateRendererUniqueValues=function(d){d=E(d);const g=[],k=d.uniqueValues.length;for(let n=0;n<k;n++){const h=d.uniqueValues[n];g.push({value:h,
count:d.valueFrequency[n],label:h.toString()})}return{uniqueValues:g}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/RasterSymbolizer":function(){define("../../chunks/tslib.es6 ../../core/colorUtils ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../../layers/support/rasterFunctions/stretchUtils ../../layers/support/rasterFunctions/surfaceUtils ./colorRampUtils ./rasterRendererChecks".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k){function n(h){return p.isValidPixelBlock(h)&&0!==h.validPixelCount}w=class extends w.JSONSupport{constructor(h){super(h)}bind(){const {rendererJSON:h}=this;if(!h)return{success:!1};this.lookup={rendererJSON:{}};let q;switch(h.type){case "uniqueValue":q=this._updateUVRenderer(h);break;case "rasterColormap":q=this._updateColormapRenderer(h);break;case "rasterStretch":q=this._updateStretchRenderer(h);break;case "classBreaks":q=this._updateClassBreaksRenderer(h);
break;case "rasterShadedRelief":q=this._updateShadedReliefRenderer(h);break;case "vectorField":q=this._updateVectorFieldRenderer();break;case "flowRenderer":q=this._updateFlowRenderer()}return q}symbolize(h){let q=h?.pixelBlock;if(!n(q))return q;if(h.simpleStretchParams&&"rasterStretch"===this.rendererJSON.type)return this.simpleStretch(q,h.simpleStretchParams);try{3<q.pixels.length&&(q=q.extractBands(h.bandIds??[0,1,2]));let t;switch(this.rendererJSON.type){case "uniqueValue":case "rasterColormap":t=
this._symbolizeColormap(q);break;case "classBreaks":t=this._symbolizeClassBreaks(q);break;case "rasterStretch":t=this._symbolizeStretch(q,h.bandIds);break;case "rasterShadedRelief":const x=h.extent;t=this._symbolizeShadedRelief(q,{isGCS:x.spatialReference.isGeographic,resolution:{x:(x.xmax-x.xmin)/q.width,y:(x.ymax-x.ymin)/q.height}})}return t}catch(t){return L.getLogger(this).error("symbolize",t.message),q}}simpleStretch(h,q){if(!n(h))return h;try{return 3<h.pixels.length&&(h=h.extractBands([0,1,
2])),u.stretch(h,{...q,isRenderer:!0})}catch(t){return L.getLogger(this).error("symbolize",t.message),h}}generateWebGLParameters(h){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const {indexedColormap:e,offset:a}=this.lookup.colormapLut||{};return{colormap:e,colormapOffset:a,type:"lut"}}const {pixelBlock:q,isGCS:t,resolution:x,bandIds:b}=h;({rendererJSON:h}=this);return"rasterStretch"===h.type?this._generateStretchWebGLParams(q,h,b):"rasterShadedRelief"===h.type?
this._generateShadedReliefWebGLParams(h,t,x??void 0):"vectorField"===h.type?this._generateVectorFieldWebGLParams(h):null}_isLUTChanged(h){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const q=this.rendererJSON.colorRamp;if(h)return JSON.stringify(q)!==JSON.stringify(this.lookup.rendererJSON.colorRamp);({...this.rendererJSON});({...this.lookup.rendererJSON})}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(h){return this._isLUTChanged()&&
!this.bind().success?h:p.colorize(h,this.lookup.colormapLut)}_symbolizeClassBreaks(h){const {canUseIndexedLUT:q}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?h:q?p.colorize(h,this.lookup.colormapLut):p.remapColor(h,this.lookup.remapLut??[])}_symbolizeStretch(h,q){const {rasterInfo:t}=this,{pixelType:x,bandCount:b}=t,e=this.rendererJSON;var a=["u8","u16","s8","s16"].includes(x);let c;var {dra:f}=e;({gamma:l}=this.lookup);if("histogramEqualization"===
e.stretchType){a=f?null:this.lookup?.histogramLut;q=u.getStretchCutoff(e,{rasterInfo:t,pixelBlock:h,bandIds:q,returnHistogramLut:!a});var l=u.stretch(h,{...q,gamma:l,isRenderer:!0});l=p.lookupPixels(l,{lut:f?q.histogramLut:a,offset:0})}else if(a){if(f)f=u.getStretchCutoff(e,{rasterInfo:t,pixelBlock:h,bandIds:q}),c=u.createStretchLUT({pixelType:x,...f,gamma:l,rounding:"floor"});else{if(this._isLUTChanged()&&!this.bind().success)return h;c=this.lookup?this.lookup.stretchLut:null}if(!c)return h;1<b&&
null!=q&&q.length===h?.pixels.length&&c?.lut.length===b&&(c={lut:q.map(r=>c.lut[r]),offset:c.offset});l=p.lookupPixels(h,c)}else f=u.getStretchCutoff(e,{rasterInfo:t,pixelBlock:h,bandIds:q}),l=u.stretch(h,{...f,gamma:l,isRenderer:!0});if(e.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return h;l=p.colorize(l,this.lookup?.colormapLut)}return l}_symbolizeShadedRelief(h,q){var t=this.rendererJSON;q=d.hillshade(h,{...t,...q});if(!t.colorRamp||this._isLUTChanged(!0)&&!this.bind().success)return q;
t=this.lookup?this.lookup.hsvMap:null;if(!t)return q;d.tintHillshade(q,h,t,this.rasterInfo.statistics?.[0]??{min:0,max:8E3});return q}_isVectorFieldData(){const {bandCount:h,dataType:q}=this.rasterInfo;return 2===h&&("vector-magdir"===q||"vector-uv"===q)}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?
{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(h){const {bandCount:q,attributeTable:t,pixelType:x}=this.rasterInfo,b=h.field1;if(!b)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const e=h.defaultSymbol;var a=1===q&&["u8","s8"].includes(x);if(!k.isUVRendererSupported(this.rasterInfo,b)&&!a)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};
const c=[];if(null!=t){const f=t.fields.find(l=>"value"===l.name.toLowerCase());if(!f)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};t.features.forEach(l=>{const r=h.uniqueValueInfos?.find(z=>String(z.value)===String(l.attributes[b]))?.symbol?.color;r?c.push([l.attributes[f.name]].concat(r)):e&&c.push([l.attributes[f.name]].concat(e.color))})}else{if("value"!==b.toLowerCase())return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};
h.uniqueValueInfos?.forEach(f=>{const l=f?.symbol?.color;l?c.push([parseInt(""+f.value,10)].concat(l)):e&&c.push([parseInt(""+f.value,10)].concat(e?.color))})}if(0===c.length)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};a=p.createColormapLUT({colormap:c});this.lookup={rendererJSON:h,colormapLut:a};this.canRenderInWebGL=this._isColormapSupportedByWebGL(a?.indexedColormap);return{success:!0}}_updateColormapRenderer(h){if(!k.isColormapRendererSupported(this.rasterInfo))return{success:!1,
error:"Unsupported data; the data source does not have a colormap."};var q=h.colormapInfos.map(t=>[t.value].concat(t.color)).sort((t,x)=>t[0]-x[0]);if(!q||0===q.length)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};q=p.createColormapLUT({colormap:q});this.lookup={rendererJSON:h,colormapLut:q};this.canRenderInWebGL=this._isColormapSupportedByWebGL(q?.indexedColormap);return{success:!0}}_updateShadedReliefRenderer(h){if(!k.isShadedReliefRendererSupported(this.rasterInfo))return{success:!1,
error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(h.colorRamp){var q=g.convertColorRampToColormap(h.colorRamp,{interpolateAlpha:!0});q=p.createColormapLUT({colormap:q});const t=[],x=q.indexedColormap;for(let b=0;b<x.length;b+=4){const e=v.toHSV({r:x[b],g:x[b+1],b:x[b+2]});t.push([e.h/60,e.s/100,255*e.v/100])}this.lookup={rendererJSON:h,colormapLut:q,hsvMap:t}}else this.lookup=null;this.canRenderInWebGL=!0;
return{success:!0}}_analyzeClassBreaks(h){const {attributeTable:q,pixelType:t}=this.rasterInfo,x=null!=q?q.fields.find(a=>"value"===a.name.toLowerCase()):null,b=null!=q?q.fields.find(a=>a.name.toLowerCase()===h.field.toLowerCase()):null,e=null!=x&&null!==b;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(t)||e,tableValueField:x,tableBreakField:b}}_updateClassBreaksRenderer(h){var {attributeTable:q}=this.rasterInfo;const {canUseIndexedLUT:t,tableValueField:x,tableBreakField:b}=this._analyzeClassBreaks(h);
var e=h.classBreakInfos;if(!e?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};e=e.sort((r,z)=>r.classMaxValue-z.classMaxValue);var a=e[e.length-1],c=h.minValue;if(!t){var f=[];for(var l=0;l<e.length;l++)f.push({value:e[l].classMinValue??c,mappedColor:e[l].symbol.color}),c=e[l].classMaxValue;f.push({value:a.classMaxValue,mappedColor:a.symbol.color});this.lookup={rendererJSON:h,remapLut:f};this.canRenderInWebGL=!1;return{success:!0}}f=
[];if(null!=q&&null!=x&&null!==b&&x!==b){a=x.name;const r=b.name,z=e[e.length-1],{classMaxValue:y}=z;c=h.minValue;for(l of q.features){q=l.attributes[a];const F=l.attributes[r],K=F===y?z:F<c?null:e.find(({classMaxValue:H})=>H>F);K&&f.push([q].concat(K.symbol.color))}}else{c=Math.floor(h.minValue);for(l=0;l<e.length;l++){for(q=e[l];c<q.classMaxValue;c++)f.push([c].concat(q.symbol.color));c=Math.ceil(q.classMaxValue)}a.classMaxValue===c&&f.push([a.classMaxValue].concat(a.symbol.color))}e=p.createColormapLUT({colormap:f,
fillUnspecified:!1});this.lookup={rendererJSON:h,colormapLut:e};this.canRenderInWebGL=this._isColormapSupportedByWebGL(e?.indexedColormap);return{success:!0}}_isColormapSupportedByWebGL(h){return!!h?.length&&16384>=h.length}_isHistogramRequired(h){return"percentClip"===h||"histogramEqualization"===h}_isValidRasterStatistics(h){return null!=h&&0<h.length&&null!=h[0].min&&null!=h[0].max}_updateStretchRenderer(h){let {stretchType:q,dra:t}=h;if(!("none"===q||h.statistics?.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||
t))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};var x=h.histograms||this.rasterInfo.histograms;!this._isHistogramRequired(h.stretchType)||x?.length||t||(q="minMax");const {computeGamma:b,useGamma:e,colorRamp:a}=h;let {gamma:c}=h;e&&b&&!c?.length&&(c=u.computeGammaValues(this.rasterInfo.pixelType,h.statistics?.length?h.statistics:this.rasterInfo.statistics));var f=this.rasterInfo.pixelType;const l=!t&&["u8","u16",
"s8","s16"].includes(f);"histogramEqualization"===q?(f=x.map(r=>u.createHistogramEqualizationLUT(r)),this.lookup={rendererJSON:h,histogramLut:f}):l&&(x=u.getStretchCutoff(h,{rasterInfo:this.rasterInfo}),f=u.createStretchLUT({pixelType:f,...x,gamma:e?c:null,rounding:"floor"}),this.lookup={rendererJSON:h,stretchLut:f});a&&!this._isStretchColorRampNoop(a)&&(f=g.convertColorRampToColormap(a,{interpolateAlpha:!0}),this.lookup||(this.lookup={rendererJSON:h}),this.lookup.colormapLut=p.createColormapLUT({colormap:f}),
this.lookup.rendererJSON=h);this.lookup.gamma=e&&c?.length?c:null;this.canRenderInWebGL=!0;return{success:!0}}_isStretchColorRampNoop(h){return"algorithmic"===h.type&&["0,0,0,255","0,0,0"].includes(h.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(h.toColor.join(","))}_generateStretchWebGLParams(h,q,t){let x=null,b=null;var e=this.lookup?.colormapLut;q.colorRamp&&e&&(x=e.indexedColormap,b=e.offset);"histogramEqualization"===q.stretchType&&(q={...q,stretchType:"minMax"});({gamma:e}=
this.lookup);const a=!!(q.useGamma&&e&&e.some(K=>1!==K)),{minCutOff:c,maxCutOff:f,outMin:l,outMax:r}=u.getStretchCutoff(q,{rasterInfo:this.rasterInfo,pixelBlock:h,bandIds:t});var z=0;null!=h&&(z=h.getPlaneCount(),2===z&&(h=h.clone(),h.statistics=[h.statistics[0]],h.pixels=[h.pixels[0]]));({bandCount:h}=this.rasterInfo);t=Math.min(3,t?.length||z||h,h);h=new Float32Array(t);z=x||a?1:255;let y;for(y=0;y<c.length;y++)h[y]=f[y]===c[y]?0:(r-l)/(f[y]-c[y])/z;const F=new Float32Array(t);if(a&&e)for(y=0;y<
t;y++)F[y]=1<e[y]?2<e[y]?6.5+(e[y]-2)**2.5:6.5+100*(2-e[y])**4:1;return{bandCount:t,outMin:l/z,outMax:r/z,minCutOff:c,maxCutOff:f,factor:h,useGamma:a,gamma:a?e:[1,1,1],gammaCorrection:a?F:[1,1,1],colormap:x,colormapOffset:b,stretchType:q.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(h,q=!1,t={x:0,y:0}){let x=null,b=null;const e=this.lookup?.colormapLut;h.colorRamp&&e&&(x=e.indexedColormap,b=e.offset);q=d.calculateHillshadeParams({...h,isGCS:q,resolution:t});t=this.rasterInfo.statistics?.[0];
return{...q,minValue:t?.min??0,maxValue:t?.max??8E3,hillshadeType:"traditional"===h.hillshadeType?0:1,type:"hillshade",colormap:x,colormapOffset:b}}_generateVectorFieldWebGLParams(h){const {style:q,inputUnit:t,outputUnit:x,visualVariables:b,symbolTileSize:e,flowRepresentation:a}=h;let c;var f=this.rasterInfo.statistics?.[0].min??0,l=this.rasterInfo.statistics?.[0].max??50,r=b?.find(F=>"sizeInfo"===F.type)??{type:"sizeInfo",field:"Magnitude",maxDataValue:l,maxSize:.8*e,minDataValue:f,minSize:.2*e},
z=r.minDataValue??f,y=r.maxDataValue??l;l=null!=r.maxSize&&null!=r.minSize?[r.minSize/e,r.maxSize/e]:[.2,.8];"wind_speed"===q&&(l[0]=l[1]=(l[0]+l[1])/2);f=null!=z&&null!=y?[z,y]:null;if("classified_arrow"===q)if(null!=z&&null!=y&&null!=r)for(c=[],z=(r.maxDataValue-r.minDataValue)/5,y=0;6>y;y++)c.push(r.minDataValue+z*y);else c=[0,1E-6,3.5,7,10.5,14];r="flow_to"===a===("ocean_current_kn"===q||"ocean_current_m"===q)?0:Math.PI;z=b?.find(F=>"rotationInfo"===F.type);return{breakValues:c,dataRange:f,inputUnit:t,
outputUnit:x,symbolTileSize:e,symbolPercentRange:l,style:q||"single_arrow",rotation:r,rotationType:this.rasterInfo.storageInfo?.tileInfo&&"vector-uv"===this.rasterInfo.dataType?"geographic":z?.rotationType||h.rotationType,type:"vectorField"}}};m.__decorate([E.property({json:{write:!0}})],w.prototype,"rendererJSON",void 0);m.__decorate([E.property({type:J,json:{write:!0}})],w.prototype,"rasterInfo",void 0);m.__decorate([E.property({json:{write:!0}})],w.prototype,"lookup",void 0);m.__decorate([E.property()],
w.prototype,"canRenderInWebGL",void 0);return w=m.__decorate([P.subclass("esri.renderers.support.RasterSymbolizer")],w)})},"esri/rest/support/ImageHistogramParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/deprecate ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/jsonUtils ../../layers/support/MosaicRule ../../layers/support/RasterFunction ../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n){var h;E=h=class extends E.JSONSupport{constructor(){super(...arguments);this.pixelSize=this.rasterFunction=this.mosaicRule=this.geometry=null;this.raster=void 0;this.timeExtent=null}writeGeometry(q,t,x){null!=q&&(t.geometryType=d.getJsonType(q),t[x]=q.toJSON())}get renderingRule(){L.deprecatedProperty(R.getLogger(this),"renderingRule",{replacement:"rasterFunction",version:"4.27",warnOnce:!0});return this._get("rasterFunction")}set renderingRule(q){L.deprecatedProperty(R.getLogger(this),
"renderingRule",{replacement:"rasterFunction",version:"4.27",warnOnce:!0});this._set("rasterFunction",q)}clone(){return new h(T.clone({geometry:this.geometry,mosaicRule:this.mosaicRule,rasterFunction:this.rasterFunction,pixelSize:this.pixelSize,raster:this.raster,timeExtent:this.timeExtent}))}};m.__decorate([P.property({types:v.geometryTypes,json:{read:d.fromJSON}})],E.prototype,"geometry",void 0);m.__decorate([u.writer("geometry")],E.prototype,"writeGeometry",null);m.__decorate([P.property({type:g,
json:{write:!0}})],E.prototype,"mosaicRule",void 0);m.__decorate([P.property({type:k})],E.prototype,"renderingRule",null);m.__decorate([P.property({type:k,json:{write:!0,name:"renderingRule"}})],E.prototype,"rasterFunction",void 0);m.__decorate([P.property({type:n,json:{write:!0}})],E.prototype,"pixelSize",void 0);m.__decorate([P.property({json:{write:!0}})],E.prototype,"raster",void 0);m.__decorate([P.property({type:w,json:{read:{source:"time"},write:{target:"time"}}})],E.prototype,"timeExtent",
void 0);return E=h=m.__decorate([p.subclass("esri.rest.support.ImageHistogramParameters")],E)})},"esri/layers/support/MosaicRule":function(){define("../../chunks/tslib.es6 ../../core/deprecate ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../geometry/Point ./DimensionalDefinition ./RasterFunction".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n){var h;const q=w.strict()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),t=w.strict()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});w=h=class extends L.JSONSupport{constructor(x){super(x);this.ascending=!0;this.where=
this.viewpoint=this.sortValue=this.sortField=this.operation=this.objectIds=this.multidimensionalDefinition=this.method=this.lockRasterIds=this.itemRasterFunction=null}readAscending(x,b){return null!=b.ascending?b.ascending:null!=b.sortAscending?b.sortAscending:!0}get itemRenderingRule(){v.deprecatedProperty(T.getLogger(this),"itemRenderingRule",{replacement:"itemRasterFunction",version:"4.27",warnOnce:!0});return this._get("itemRasterFunction")}set itemRenderingRule(x){v.deprecatedProperty(T.getLogger(this),
"itemRenderingRule",{replacement:"itemRasterFunction",version:"4.27",warnOnce:!0});this._set("itemRasterFunction",x)}readMethod(x,b){x=b.mosaicMethod||b.defaultMosaicMethod;switch(x?x.toLowerCase().replace("esrimosaic",""):""){case "byattribute":case "attribute":x="esriMosaicAttribute";break;case "lockraster":x="esriMosaicLockRaster";break;case "center":x="esriMosaicCenter";break;case "northwest":x="esriMosaicNorthwest";break;case "nadir":x="esriMosaicNadir";break;case "viewpoint":x="esriMosaicViewpoint";
break;case "seamline":x="esriMosaicSeamline";break;case "none":x="esriMosaicNone";break;default:x="esriMosaicNone"}return t.fromJSON(x)}writeMultidimensionalDefinition(x,b,e){null!=x&&(x=x.filter(({variableName:a,dimensionName:c})=>a&&"*"!==a||c),x.length&&(b[e]=x.map(a=>a.toJSON())))}readOperation(x,b){x=b.mosaicOperation;b=b.mosaicOperator?.toLowerCase();b=x||(b?q.toJSON(b):null);return q.fromJSON(b)||"first"}castSortValue(x){return null==x||"string"===typeof x||"number"===typeof x?x:`${x}`}clone(){return new h({ascending:this.ascending,
itemRasterFunction:E.clone(this.itemRasterFunction),lockRasterIds:E.clone(this.lockRasterIds),method:this.method,multidimensionalDefinition:E.clone(this.multidimensionalDefinition),objectIds:E.clone(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:E.clone(this.viewpoint),where:this.where})}};m.__decorate([R.property({type:Boolean,json:{write:!0}})],w.prototype,"ascending",void 0);m.__decorate([J.reader("ascending",["ascending","sortAscending"])],
w.prototype,"readAscending",null);m.__decorate([R.property({type:n,json:{name:"itemRenderingRule",write:!0}})],w.prototype,"itemRasterFunction",void 0);m.__decorate([R.property({type:n})],w.prototype,"itemRenderingRule",null);m.__decorate([R.property({type:[d.Integer],json:{write:{overridePolicy(){return{enabled:"lock-raster"===this.method}}}}})],w.prototype,"lockRasterIds",void 0);m.__decorate([R.property({type:String,json:{type:t.jsonValues,write:{target:"mosaicMethod",writer:t.write}}})],w.prototype,
"method",void 0);m.__decorate([J.reader("method",["mosaicMethod","defaultMosaicMethod"])],w.prototype,"readMethod",null);m.__decorate([R.property({type:[k],json:{write:!0}})],w.prototype,"multidimensionalDefinition",void 0);m.__decorate([u.writer("multidimensionalDefinition")],w.prototype,"writeMultidimensionalDefinition",null);m.__decorate([R.property({type:[d.Integer],json:{name:"fids",write:!0}})],w.prototype,"objectIds",void 0);m.__decorate([R.property({json:{type:q.jsonValues,read:{reader:q.read},
write:{target:"mosaicOperation",writer:q.write}}})],w.prototype,"operation",void 0);m.__decorate([J.reader("operation",["mosaicOperation","mosaicOperator"])],w.prototype,"readOperation",null);m.__decorate([R.property({type:String,json:{write:{overridePolicy(){return{enabled:"attribute"===this.method}}}}})],w.prototype,"sortField",void 0);m.__decorate([R.property({type:[String,Number],json:{write:{allowNull:!0,overridePolicy(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],w.prototype,
"sortValue",void 0);m.__decorate([P.cast("sortValue")],w.prototype,"castSortValue",null);m.__decorate([R.property({type:g,json:{write:!0}})],w.prototype,"viewpoint",void 0);m.__decorate([R.property({type:String,json:{write:!0}})],w.prototype,"where",void 0);return w=h=m.__decorate([p.subclass("esri.layers.support.MosaicRule")],w)})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(m,v,w,L,E,T,R,P,J){function p(b,e){const a=g(e.data,e.width,e.height,b.smoothing);return b.interpolate?(c,f)=>{const l=Math.floor(c),r=Math.floor(f);if(0>l||l>=e.width||0>r||r>=e.height)return[0,0];c-=l;f-=r;const z=l<e.width-1?l+1:l,y=r<e.height-1?r+1:r;return[(a[2*(r*e.width+l)]*(1-f)+a[2*(y*e.width+l)]*f)*(1-c)+(a[2*(r*e.width+z)]*(1-f)+a[2*(y*e.width+z)]*f)*c,(a[2*(r*e.width+l)+1]*(1-f)+a[2*(y*e.width+l)+1]*f)*(1-c)+(a[2*(r*e.width+z)+1]*(1-f)+a[2*(y*e.width+z)+1]*f)*c]}:(c,f)=>{c=Math.round(c);
f=Math.round(f);return 0>c||c>=e.width||0>f||f>=e.height?[0,0]:[a[2*(f*e.width+c)],a[2*(f*e.width+c)+1]]}}function u(b,e,a,c,f,l,r,z,y){const F=[];let K=0,[H,D]=e(a,c);H*=b.velocityScale;D*=b.velocityScale;F.push({x:a,y:c,t:K,speed:Math.sqrt(H*H+D*D)});for(let A=0;A<b.verticesPerLine;A++){let [B,Q]=e(a,c);B*=b.velocityScale;Q*=b.velocityScale;const O=Math.sqrt(B*B+Q*Q);if(O<b.minSpeedThreshold)break;const C=B/O,M=Q/O;a+=C*b.segmentLength;c+=M*b.segmentLength;K+=b.segmentLength/O;if(Math.acos(C*G+
M*S)>b.maxTurnAngle)break;if(b.collisions){var G=Math.round(a*y);var S=Math.round(c*y);if(0>G||G>r-1||0>S||S>z-1)break;const N=l[S*r+G];if(-1!==N&&N!==f)break;l[S*r+G]=f}F.push({x:a,y:c,t:K,speed:O});G=C;S=M}return F}function d(b,e,a,c){const f=[],l=new R,r=1/Math.max(b.lineCollisionWidth,1),z=Math.round(a*r),y=Math.round(c*r),F=new Int32Array(z*y);for(var K=0;K<F.length;K++)F[K]=-1;K=[];for(let H=0;H<c;H+=b.lineSpacing)for(let D=0;D<a;D+=b.lineSpacing)K.push({x:D,y:H,sort:l.getFloat()});K.sort((H,
D)=>H.sort-D.sort);for(const {x:H,y:D}of K)l.getFloat()<b.density&&(a=u(b,e,H,D,f.length,F,z,y,r),2>a.length||f.push(a));return f}function g(b,e,a,c){if(0===c)return b;const f=Math.round(3*c),l=Array(2*f+1);var r=0;for(var z=-f;z<=f;z++){var y=Math.exp(-z*z/(c*c));l[z+f]=y;r+=y}for(c=-f;c<=f;c++)l[c+f]/=r;r=new Float32Array(b.length);for(c=0;c<a;c++)for(z=0;z<e;z++){var F=y=0;for(var K=-f;K<=f;K++)if(!(0>z+K||z+K>=e)){var H=l[K+f];y+=H*b[2*(c*e+(z+K))];F+=H*b[2*(c*e+(z+K))+1]}r[2*(c*e+z)]=y;r[2*(c*
e+z)+1]=F}b=new Float32Array(b.length);for(c=0;c<e;c++)for(z=0;z<a;z++){F=y=0;for(K=-f;K<=f;K++)0>z+K||z+K>=a||(H=l[K+f],y+=H*r[2*((z+K)*e+c)],F+=H*r[2*((z+K)*e+c)+1]);b[2*(z*e+c)]=y;b[2*(z*e+c)+1]=F}return b}function k(b,e){const a=new R;var c=b.reduce((z,y)=>z+y.length,0);c=new Float32Array(4*c);const f=Array(b.length);let l=0,r=0;for(const z of b){b=l;for(const y of z)c[4*l]=y.x,c[4*l+1]=y.y,c[4*l+2]=y.t,c[4*l+3]=y.speed,l++;f[r++]={startVertex:b,numberOfVertices:z.length,totalTime:z[z.length-
1].t,timeSeed:e?a.getFloat():0}}return{lineVertices:c,lineDescriptors:f}}function n(b,e){function a(G,S,A,B,Q,O,C,M){const N=9*y;let U=0;z[N+U++]=G;z[N+U++]=S;z[N+U++]=1;z[N+U++]=A;z[N+U++]=O;z[N+U++]=C;z[N+U++]=B/2;z[N+U++]=Q/2;z[N+U++]=M;y++;z[N+U++]=G;z[N+U++]=S;z[N+U++]=-1;z[N+U++]=A;z[N+U++]=O;z[N+U++]=C;z[N+U++]=-B/2;z[N+U++]=-Q/2;z[N+U++]=M;y++}const {lineVertices:c,lineDescriptors:f}=b;var l=b=0;for(var r of f)b+=2*r.numberOfVertices,l+=6*(r.numberOfVertices-1);const z=new Float32Array(9*
b);r=new Uint32Array(l);let y=0;b=0;for(const G of f){const {totalTime:S,timeSeed:A}=G;let B=l=null,Q=null;var F=null,K=null,H=null;for(let O=0;O<G.numberOfVertices;O++){F=c[4*(G.startVertex+O)];const C=c[4*(G.startVertex+O)+1],M=c[4*(G.startVertex+O)+2],N=c[4*(G.startVertex+O)+3];let U=null,X=null;var D=null;let I=null;0<O&&(U=F-l,X=C-B,D=Math.sqrt(U*U+X*X),U/=D,X/=D,1<O?(K=U+K,H=X+H,D=Math.sqrt(K*K+H*H),K/=D,H/=D,D=Math.min(1/(K*U+H*X),e),K*=D,H*=D,D=-H,I=K):(D=-X,I=U),null!==D&&null!==I&&(a(l,
B,Q,D,I,S,A,N),r[b++]=y-2,r[b++]=y,r[b++]=y-1,r[b++]=y,r[b++]=y+1,r[b++]=y-1));l=F;B=C;Q=M;K=U;H=X;F=N}a(l,B,Q,-H,K,S,A,F)}return{vertexData:z,indexData:r}}function h(b){function e(W,Z){var Y=M+U,aa=N+X,ea=Math.sqrt(Y*Y+aa*aa);Y/=ea;aa/=ea;var fa=M*Y+N*aa,ca=U+I,ja=X+V;ea=Math.sqrt(ca*ca+ja*ja);ca/=ea;ja/=ea;var la=U*ca+X*ja;ea=D;var na=G,oa=S,qa=A;aa=-(aa/fa);Y/=fa;fa=B;var sa=Q,ra=O,ua=C;ja=-(ja/la);ca/=la;la=16*K;let pa=0;for(const xa of[1,2])for(const va of[1,2,3,4])y[la+pa++]=ea,y[la+pa++]=na,
y[la+pa++]=oa,y[la+pa++]=qa,y[la+pa++]=fa,y[la+pa++]=sa,y[la+pa++]=ra,y[la+pa++]=ua,y[la+pa++]=xa,y[la+pa++]=va,y[la+pa++]=W,y[la+pa++]=Z,y[la+pa++]=aa/2,y[la+pa++]=Y/2,y[la+pa++]=ja/2,y[la+pa++]=ca/2,K++;F[H++]=K-8;F[H++]=K-7;F[H++]=K-6;F[H++]=K-7;F[H++]=K-5;F[H++]=K-6;F[H++]=K-4;F[H++]=K-3;F[H++]=K-2;F[H++]=K-3;F[H++]=K-1;F[H++]=K-2}function a(W,Z,Y,aa,ea,fa){M=U;N=X;U=I;X=V;null==M&&null==N&&(M=U,N=X);if(null!=B&&null!=Q){I=W-B;V=Z-Q;const ca=Math.sqrt(I*I+V*V);I/=ca;V/=ca}null!=M&&null!=N&&e(ea,
fa);D=B;G=Q;S=O;A=C;B=W;Q=Z;O=Y;C=aa}function c(W,Z){M=U;N=X;U=I;X=V;null==M&&null==N&&(M=U,N=X);null!=M&&null!=N&&e(W,Z)}const {lineVertices:f,lineDescriptors:l}=b;let r=b=0;for(var z of l){const W=z.numberOfVertices-1;b+=8*W;r+=12*W}const y=new Float32Array(16*b),F=new Uint32Array(r);let K=0,H=0,D,G,S,A,B,Q,O,C,M,N,U,X,I,V;for(const W of l){V=I=X=U=N=M=C=O=Q=B=A=S=G=D=null;const {totalTime:Z,timeSeed:Y}=W;for(z=0;z<W.numberOfVertices;z++)a(f[4*(W.startVertex+z)],f[4*(W.startVertex+z)+1],f[4*(W.startVertex+
z)+2],f[4*(W.startVertex+z)+3],Z,Y);c(Z,Y)}return{vertexData:y,indexData:F}}function q(b,e){const a=e.pixels,{width:c,height:f}=e,l=new Float32Array(c*f*2),r=e.mask||new Uint8Array(c*f*2);e.mask||r.fill(255);if("vector-uv"===b)for(b=0;b<c*f;b++)l[2*b]=a[0][b],l[2*b+1]=-a[1][b];else if("vector-magdir"===b)for(b=0;b<c*f;b++){e=a[0][b];const z=E.deg2rad(a[1][b]),y=Math.sin(z-Math.PI/2);l[2*b]=Math.cos(z-Math.PI/2)*e;l[2*b+1]=y*e}return{data:l,mask:r,width:c,height:f}}async function t(b,e,a,c,f,l){const r=
{requestProjectedLocalDirections:!0,signal:l};null!=f&&(r.timeExtent=f);if("imagery"===b.type)return await b.load({signal:l}),f=b.rasterInfo.dataType,b=await b.fetchImage(e,a,c,r),null==b?.pixelData?.pixelBlock?{data:new Float32Array(a*c*2),mask:new Uint8Array(a*c),width:a,height:c}:q(f,b.pixelData.pixelBlock);await b.load({signal:l});f=b.serviceRasterInfo.dataType;b=await b.fetchPixels(e,a,c,r);return null==b?.pixelBlock?{data:new Float32Array(a*c*2),mask:new Uint8Array(a*c),width:a,height:c}:q(f,
b.pixelBlock)}const x=()=>L.getLogger("esri.views.2d.engine.flow.dataUtils");m.createAnimatedLinesData=k;m.createFlowMesh=async function(b,e,a,c){const f=performance.now();var l=p(e,a);const r=performance.now();a=d(e,l,a.width,a.height);e=performance.now();l=k(a,!0);a=performance.now();b="Streamlines"===b?n(l,10):h(l);l=performance.now();w("esri-2d-profiler")&&(x().info("I.1","_createFlowFieldFromData (ms)",Math.round(r-f)),x().info("I.2","_getStreamlines (ms)",Math.round(e-r)),x().info("I.3","createAnimatedLinesData (ms)",
Math.round(a-e)),x().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(l-a)),x().info("I.5","createFlowMesh (ms)",Math.round(l-f)),x().info("I.6","Mesh size (bytes)",b.vertexData.buffer.byteLength+b.indexData.buffer.byteLength));await Promise.resolve();T.throwIfAborted(c);return b};m.createParticlesMesh=h;m.createStreamlinesMesh=n;m.loadImagery=async function(b,e,a,c,f,l){const r=performance.now();var z=P.getInfo(e.spatialReference);if(!z)return a=await t(b,e,a,c,f,l),w("esri-2d-profiler")&&
x().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-r)),w("esri-2d-profiler")&&x().info("I.9","Number of parts",1),a;const [y,F]=z.valid,K=Math.ceil(e.width/(F-y)),H=e.width/K,D=Math.round(a/K);let G=e.xmin;const S=[];z=performance.now();for(let A=0;A<K;A++){const B=new J({xmin:G,xmax:G+H,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});S.push(t(b,B,D,c,f,l));G+=H}b=await Promise.all(S);w("esri-2d-profiler")&&x().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-
z));w("esri-2d-profiler")&&x().info("I.9","Number of parts",b.length);c={data:new Float32Array(a*c*2),mask:new Uint8Array(a*c),width:a,height:c};e=0;for(const A of b){for(b=0;b<A.height;b++)for(f=0;f<A.width;f++)e+f>=a||(c.data[2*(b*a+e+f)]=A.data[2*(b*A.width+f)],c.data[2*(b*a+e+f)+1]=A.data[2*(b*A.width+f)+1],c.mask[b*a+e+f]=A.mask[b*A.width+f]);e+=A.width}w("esri-2d-profiler")&&x().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-r));return c};Object.defineProperty(m,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/rasterDatasets/RasterFactory":function(){define("../../../core/Error ./CloudRaster ./CovJSONRaster ./ImageAuxRaster ./ImageServerRaster ./InMemoryRaster ./MRFRaster ./TIFFRaster".split(" "),function(m,v,w,L,E,T,R,P){const J=new Map;J.set("CRF",{desc:"Cloud Raster Format",constructor:v});J.set("MRF",{desc:"Meta Raster Format",constructor:R});J.set("TIFF",{desc:"GeoTIFF",constructor:P});J.set("RasterTileServer",{desc:"Raster Tile Server",constructor:E});J.set("JPG",
{desc:"JPG Raster Format",constructor:L});J.set("PNG",{desc:"PNG Raster Format",constructor:L});J.set("GIF",{desc:"GIF Raster Format",constructor:L});J.set("BMP",{desc:"BMP Raster Format",constructor:L});J.set("CovJSON",{desc:"COVJSON Raster Format",constructor:w});J.set("MEMORY",{desc:"In Memory Raster Format",constructor:T});class p{static get supportedFormats(){const u=new Set;J.forEach((d,g)=>u.add(g));return u}static async open(u){const {url:d,ioConfig:g,source:k,sourceJSON:n}=u;let h=u.datasetFormat??
g?.datasetFormat;null==h&&(d.includes(".")?h=d.slice(d.lastIndexOf(".")+1).toUpperCase():"coverage"===k?.type?.toLowerCase()?h="CovJSON":k?.extent&&k.pixelblocks&&(h="MEMORY"));"OVR"===h||"TIF"===h?h="TIFF":"JPG"===h||"JPEG"===h||"JFIF"===h?h="JPG":"COVJSON"===h&&(h="CovJSON");d.toLowerCase().includes("/imageserver")&&!d.toLowerCase().includes("/wcsserver")&&(h="RasterTileServer");var q={bandIds:null,sampling:null};const t={url:d,source:k,sourceJSON:n,datasetFormat:h,ioConfig:g??q};Object.keys(t).forEach(a=>
{null==t[a]&&delete t[a]});if(h){if(!this.supportedFormats.has(h))throw new m("rasterfactory:open","not a supported format "+h);if("CRF"===h&&!g?.enableCRF)throw new m("rasterfactory:open",`cannot open raster: ${d}`);q=new (J.get(h).constructor)(t);await q.open({signal:u.signal});return q}const x=Array.from(J.keys()).filter(a=>"CovJSON"!==a&&"Memory"!==a);let b=0;const e=()=>{h=x[b++];if(!h||"CRF"===h&&!g?.enableCRF)return null;const a=new (J.get(h).constructor)(t);return a.open({signal:u.signal}).then(()=>
a).catch(()=>e())};return e()}static register(u,d,g){J.has(u.toUpperCase())||J.set(u.toUpperCase(),{desc:d,constructor:g})}}return p})},"esri/layers/support/rasterDatasets/CloudRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../LOD ../RasterInfo ../RasterStorageInfo ../TileInfo ./BaseRaster ./DBFParser ../rasterTransforms/utils ../../../rest/support/FeatureSet ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x){const b=new Map;b.set("int16","esriFieldTypeSmallInteger");b.set("int32","esriFieldTypeInteger");b.set("int64","esriFieldTypeInteger");b.set("float32","esriFieldTypeSingle");b.set("float64","esriFieldTypeDouble");b.set("text","esriFieldTypeString");v=class extends g{constructor(){super(...arguments);this.storageInfo=null;this.datasetFormat="CRF"}async open(e){await this.init();({data:e}=await this.request(this.url+"/conf.json",{signal:e?.signal}));if(!this._validateHeader(e))throw new w("cloudraster:open",
"Invalid or unsupported conf.json.");this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);const {storageInfo:a,rasterInfo:c}=this._parseHeader(e);"thematic"===c.dataType&&(e=await this._fetchAuxiliaryInformation(),c.attributeTable=e);this._set("storageInfo",a);this._set("rasterInfo",c);this.ioConfig.retryCount=this.ioConfig.retryCount||0}async fetchRawTile(e,a,c,f={}){var {transposeInfo:l}=this.rasterInfo.storageInfo,{transposedVariableName:r}=f;e=(l=!(!l||!r))?0:this.rasterInfo.storageInfo.maximumPyramidLevel-
e;if(0>e)return null;r=this._buildCacheFilePath(e,a,c,f.multidimensionalDefinition,r);a=this._getIndexRecordFromBundle(a,c,l);c=await this.request(r,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:f.signal});if(!c)return null;c=new Uint8Array(c.data);a=this._getTileEndAndContentType(c,a);if(0===a.recordSize)return null;f=await this.request(r,{range:{from:a.position,to:a.position+a.recordSize},responseType:"array-buffer",signal:f.signal});if(!f)return null;const [z,
y]=this._getTileSize(l);return this.decodePixelBlock(f.data,{width:z,height:y,planes:null,pixelType:null,returnInterleaved:l})}_validateHeader(e){const a="origin extent geodataXform LODInfos blockWidth blockHeight bandCount pixelType pixelSizeX pixelSizeY format packetSize".split(" ");return e&&"RasterInfo"===e.type&&!a.some(c=>!e[c])}_parseHeader(e){var a="u1 u2 u4 u8 s8 u16 s16 u32 s32 f32 f64".split(" ")[e.pixelType];const {bandCount:c,colormap:f,blockWidth:l,blockHeight:r,firstPyramidLevel:z,
maximumPyramidLevel:y}=e,F=e.statistics?.map(W=>({min:W.min,max:W.max,avg:W.mean,stddev:W.standardDeviation,median:W.median,mode:W.mode})),K=e.histograms?.[0]?.counts?.length?e.histograms:null;var H=e.extent.spatialReference,D=e.geodataXform?.spatialReference;H=new q(H?.wkid||H?.wkt||H?.wkt2?H:D);D=new t({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:H});const G=new x({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:H}),S=Math.round((D.xmax-D.xmin)/G.x),
A=Math.round((D.ymax-D.ymin)/G.y),B=this._parseTransform(e.geodataXform),Q=B?D:null;B&&(D=B.forwardTransform(D),G.x=(D.xmax-D.xmin)/S,G.y=(D.ymax-D.ymin)/A);const O=e.properties??{};var C=e.format.toLowerCase().replace("cache/","");const M=new x(e.origin.x,e.origin.y,H);let N;var U;if(f?.colors)for(N=[],U=0;U<f.colors.length;U++){var X=f.colors[U];var I=f.values?f.values[U]:U;N.push([I,X&255,X<<16>>>24,X<<8>>>24,X>>>24])}X=e.LODInfos;I=[];for(U=0;U<X.levels.length;U++)I.push(new J({level:X.levels[U],
resolution:X.resolutions[U],scale:96/.0254*X.resolutions[U]}));X=new d({dpi:96,lods:I,format:C,origin:M,size:[l,r],spatialReference:H});C={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64};I=[{maxCol:Math.ceil(S/l)-1,maxRow:Math.ceil(A/r)-1,minCol:0,minRow:0}];let V=2;if(0<y)for(U=0;U<y;U++)I.push({maxCol:Math.ceil(S/V/l)-1,maxRow:Math.ceil(A/V/r)-1,minCol:0,minRow:0}),V*=2;e=e.mdInfo;U=null;e&&O._yxs&&(U=O._yxs,U={packetSize:U.PacketSize,tileSize:[U.TileXSize,U.TileYSize]});
a=new p({width:S,height:A,pixelType:a,bandCount:c,extent:D,nativeExtent:Q,transform:B,spatialReference:H,pixelSize:G,keyProperties:O,statistics:F,histograms:K,multidimensionalInfo:e,colormap:N,storageInfo:new u({blockWidth:l,blockHeight:r,pyramidBlockWidth:l,pyramidBlockHeight:r,origin:M,tileInfo:X,transposeInfo:U,firstPyramidLevel:z,maximumPyramidLevel:y,blockBoundary:I})});return{storageInfo:C,rasterInfo:a}}_parseTransform(e){if(!n.isTransformSupported(e))throw new w("cloudraster:open","the data contains unsupported geodata transform types");
e=n.readTransform(e);if("identity"===e.type)return null;if("polynomial"!==e.type||!e.forwardCoefficients?.length||!e.inverseCoefficients?.length)throw new w("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return e}async _fetchAuxiliaryInformation(e){var a=this.request(this.url+"/conf.vat.json",{signal:e}).then(f=>f.data).catch(()=>null);e=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:e}).then(f=>
f.data).catch(()=>null);a=await Promise.all([a,e]);let c;if(a[0]){e=a[0].fields;const f=a[0].values;if(e&&f){e=e.map(r=>({type:"OID"===r.name?"esriFieldTypeOID":b.get(r.type),name:r.name,alias:r.alias||r.name}));const l=f.map(r=>({attributes:r}));e&&f&&(c={fields:e,features:l})}}!c&&a[1]&&(c=k.parse(a[1]).recordSet);return h.fromJSON(c)}_buildCacheFilePath(e,a,c,f,l){var r=this._getPackageSize(!!l);c=Math.floor(c/r)*r;a="R"+this._toHexString4(Math.floor(a/r)*r)+"C"+this._toHexString4(c);r="L";r=10<=
e?r+e.toString():r+("0"+e.toString());({multidimensionalInfo:e}=this.rasterInfo);const z=f?.[0];if(null==e||!z)return`${this.url}/_alllayers/${r}/${a}.bundle`;f="_yxs";if(!l){f=e.variables.find(y=>y.name===z.variableName).dimensions[0].values.indexOf(z.values[0]).toString(16);e=4-f.length;for(c=0;c<e;c++)f="0"+f;f="S"+f}l=this._getVariableFolderName(l||z.variableName);return`${this.url}/_alllayers/${l}/${f}/${r}/${a}.bundle`}_getPackageSize(e=!1){const {transposeInfo:a}=this.rasterInfo.storageInfo;
return e&&null!=a?a.packetSize??0:this.storageInfo.packetSize}_getTileSize(e=!1){const {storageInfo:a}=this.rasterInfo,{transposeInfo:c}=a;return e&&null!=c?c.tileSize:a.tileInfo.size}_getVariableFolderName(e){e=e.trim();return""===e?"_v":e.replaceAll(/[\{|\}\-]/g,"_").replace("\\*","_v")}_getIndexRecordFromBundle(e,a,c=!1){c=this._getPackageSize(c);e=e%c*c+a%c;if(0>e)throw Error("Invalid level / row / col");return e*this.storageInfo.recordSize+64}_getTileEndAndContentType(e,a){e=e.subarray(a,a+8);
a=0;let c;for(c=0;5>c;c++)a|=(e[c]&255)<<8*c;const f=a&0xffffffffff;a=0;for(c=5;8>c;c++)a|=(e[c]&255)<<8*(c-5);return{position:f,recordSize:a&0xffffffffff}}_toHexString4(e){e=e.toString(16);if(4!==e.length){let a=4-e.length;for(;0<a--;)e="0"+e}return e}};m.__decorate([L.property({readOnly:!0})],v.prototype,"storageInfo",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0);return v=m.__decorate([P.subclass("esri.layers.support.rasterDatasets.CloudRaster")],
v)})},"esri/layers/support/rasterDatasets/DBFParser":function(){define(["./byteStreamUtils"],function(m){function v(L){var E=L.fields;L=L.records;const T=E.some(u=>"oid"===u.name.toLowerCase())?"OBJECTID":"OID";E=[{name:T,type:"esriFieldTypeOID",alias:"OID"}].concat(E.map(u=>({name:u.name,type:"esriFieldType"+u.typeName,alias:u.name})));const R=E.map(u=>u.name),P=[];let J=0,p=0;L.forEach(u=>{const d={};d[T]=J++;for(p=1;p<R.length;p++)d[R[p]]=u[p-1];P.push({attributes:d})});return{displayFieldName:"",
fields:E,features:P}}class w{static get supportedVersions(){return[5]}static parse(L){var E=new DataView(L),T=E.getUint8(0)&3;if(3!==T)return{header:{version:T},recordSet:null};const R=E.getUint32(4,!0);var P=E.getUint16(8,!0);const J=E.getUint16(10,!0);P={version:T,recordCount:R,headerByteCount:P,recordByteCount:J};let p=32;const u=[],d=[];if(3===T){for(;13!==E.getUint8(p);)T=String.fromCharCode(E.getUint8(p+11)).trim(),u.push({name:m.bytesToUTF8(new Uint8Array(L,p,11)),type:T,typeName:"String Date Double Boolean String Integer".split(" ")["CDFLMN".split("").indexOf(T)],
length:E.getUint8(p+16)}),p+=32;p+=1;if(0<u.length)for(;d.length<R&&L.byteLength-p>J;){const g=[];32===E.getUint8(p)?(p+=1,u.forEach(k=>{if("C"===k.type)g.push(m.bytesToUTF8(new Uint8Array(L,p,k.length)).trim());else if("N"===k.type)g.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(L,p,k.length)).trim(),10));else if("F"===k.type)g.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(L,p,k.length)).trim()));else if("D"===k.type){const n=String.fromCharCode.apply(null,new Uint8Array(L,
p,k.length)).trim();g.push(new Date(parseInt(n.substring(0,4),10),parseInt(n.substring(4,6),10)-1,parseInt(n.substring(6,8),10)))}p+=k.length}),d.push(g)):p+=J}}E=v({fields:u,records:d});return{header:P,fields:u,records:d,recordSet:E}}}return w})},"esri/layers/support/rasterTransforms/utils":function(){define(["exports","./GCSShiftTransform","./IdentityTransform","./PolynomialTransform"],function(m,v,w,L){const E={GCSShiftXform:v,IdentityXform:w,PolynomialXform:L},T=Object.keys(E);m.isTransformSupported=
function(R){return!R||T.includes(R?.type)};m.readTransform=function(R){if(!R?.type)return null;var P=E[R?.type];return P?(P=new P,P.read(R),P):null};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterTransforms/GCSShiftTransform":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./BaseRasterTransform".split(" "),
function(m,v,w,L,E,T,R,P){var J;w=J=class extends P{constructor(){super(...arguments);this.type="gcs-shift";this.tolerance=1E-8}forwardTransform(p){p=p.clone();if("point"===p.type)return p.x>180+this.tolerance&&(p.x-=360),p;p.xmin>=180-this.tolerance?(p.xmax-=360,p.xmin-=360):p.xmax>180+this.tolerance&&(p.xmin=-180,p.xmax=180);return p}inverseTransform(p){p=p.clone();if("point"===p.type)return p.x<-this.tolerance&&(p.x+=360),p;p.xmin<-this.tolerance&&(p.xmin+=360,p.xmax+=360);return p}clone(){return new J({tolerance:this.tolerance})}};
m.__decorate([T.enumeration({GCSShiftXform:"gcs-shift"})],w.prototype,"type",void 0);m.__decorate([v.property()],w.prototype,"tolerance",void 0);return w=J=m.__decorate([R.subclass("esri.layers.support.rasterTransforms.GCSShiftTransform")],w)})},"esri/layers/support/rasterTransforms/BaseRasterTransform":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(m,v,w,L,E,T,R){v=class extends v.JSONSupport{get affectsPixelSize(){return!1}forwardTransform(P){return P}inverseTransform(P){return P}};m.__decorate([w.property()],v.prototype,"affectsPixelSize",null);m.__decorate([w.property({json:{write:!0}})],v.prototype,"spatialReference",void 0);return v=m.__decorate([R.subclass("esri.layers.support.rasterTransforms.BaseRasterTransform")],v)})},"esri/layers/support/rasterTransforms/IdentityTransform":function(){define("../../../chunks/tslib.es6 ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./BaseRasterTransform".split(" "),
function(m,v,w,L,E,T,R,P){var J;v=J=class extends P{constructor(){super(...arguments);this.type="identity"}clone(){return new J}};m.__decorate([T.enumeration({IdentityXform:"identity"})],v.prototype,"type",void 0);return v=J=m.__decorate([R.subclass("esri.layers.support.rasterTransforms.IdentityTransform")],v)})},"esri/layers/support/rasterTransforms/PolynomialTransform":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ./BaseRasterTransform ../../../geometry/Point ../../../geometry/Extent".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g){function k(q,t,x){const {x:b,y:e}=t;if(2>x)return{x:q[0]+b*q[2]+e*q[4],y:q[1]+b*q[3]+e*q[5]};if(2===x){t=b*b;x=e*e;var a=b*e;return{x:q[0]+b*q[2]+e*q[4]+t*q[6]+a*q[8]+x*q[10],y:q[1]+b*q[3]+e*q[5]+t*q[7]+a*q[9]+x*q[11]}}t=b*b;x=e*e;a=b*e;const c=t*b,f=t*e,l=b*x,r=e*x;return{x:q[0]+b*q[2]+e*q[4]+t*q[6]+a*q[8]+x*q[10]+c*q[12]+f*q[14]+l*q[16]+r*q[18],y:q[1]+b*q[3]+e*q[5]+t*q[7]+a*q[9]+x*q[11]+c*q[13]+f*q[15]+l*q[17]+r*q[19]}}function n(q,t,x){const {xmin:b,ymin:e,xmax:a,
ymax:c,spatialReference:f}=t;t=[];if(2>x)t.push({x:b,y:c}),t.push({x:a,y:c}),t.push({x:b,y:e}),t.push({x:a,y:e});else{var l=10;for(var r=0;r<l;r++)t.push({x:b,y:e+(c-e)*r/(l-1)}),t.push({x:a,y:e+(c-e)*r/(l-1)});l=8;for(r=1;r<=l;r++)t.push({x:b+(a-b)*r/l,y:e}),t.push({x:b+(a-b)*r/l,y:c})}t=t.map(z=>k(q,z,x));l=t.map(z=>z.x);t=t.map(z=>z.y);return new g({xmin:Math.min.apply(null,l),xmax:Math.max.apply(null,l),ymin:Math.min.apply(null,t),ymax:Math.max.apply(null,t),spatialReference:f})}var h;v=h=class extends u{constructor(){super(...arguments);
this.polynomialOrder=1;this.type="polynomial"}readForwardCoefficients(q,t){const {coeffX:x,coeffY:b}=t;if(!x?.length||!b?.length||x.length!==b.length)return null;q=[];for(t=0;t<x.length;t++)q.push(x[t]),q.push(b[t]);return q}writeForwardCoefficients(q,t,x){x=[];const b=[];for(let e=0;e<q?.length;e++)0===e%2?x.push(q[e]):b.push(q[e]);t.coeffX=x;t.coeffY=b}get inverseCoefficients(){var q=this._get("inverseCoefficients"),t=this._get("forwardCoefficients");if(!q&&t&&2>this.polynomialOrder){const [x,b,
e,a,c,f]=t;q=e*f-c*a;t=c*a-e*f;q=[(c*b-x*f)/q,(e*b-x*a)/t,f/q,a/t,-c/q,-e/t]}return q}set inverseCoefficients(q){this._set("inverseCoefficients",q)}readInverseCoefficients(q,t){const {inverseCoeffX:x,inverseCoeffY:b}=t;if(!x?.length||!b?.length||x.length!==b.length)return null;q=[];for(t=0;t<x.length;t++)q.push(x[t]),q.push(b[t]);return q}writeInverseCoefficients(q,t,x){x=[];const b=[];for(let e=0;e<q?.length;e++)0===e%2?x.push(q[e]):b.push(q[e]);t.inverseCoeffX=x;t.inverseCoeffY=b}get affectsPixelSize(){return 0<
this.polynomialOrder}forwardTransform(q){if("point"===q.type){const t=k(this.forwardCoefficients,q,this.polynomialOrder);return new d({x:t.x,y:t.y,spatialReference:q.spatialReference})}return n(this.forwardCoefficients,q,this.polynomialOrder)}inverseTransform(q){if("point"===q.type){const t=k(this.inverseCoefficients,q,this.polynomialOrder);return new d({x:t.x,y:t.y,spatialReference:q.spatialReference})}return n(this.inverseCoefficients,q,this.polynomialOrder)}clone(){return new h({polynomialOrder:this.polynomialOrder,
forwardCoefficients:this.forwardCoefficients?[...this.forwardCoefficients]:null,inverseCoefficients:this.inverseCoefficients?[...this.inverseCoefficients]:null})}};m.__decorate([w.property({json:{write:!0}})],v.prototype,"polynomialOrder",void 0);m.__decorate([w.property()],v.prototype,"forwardCoefficients",void 0);m.__decorate([P.reader("forwardCoefficients",["coeffX","coeffY"])],v.prototype,"readForwardCoefficients",null);m.__decorate([p.writer("forwardCoefficients")],v.prototype,"writeForwardCoefficients",
null);m.__decorate([w.property({json:{write:!0}})],v.prototype,"inverseCoefficients",null);m.__decorate([P.reader("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],v.prototype,"readInverseCoefficients",null);m.__decorate([p.writer("inverseCoefficients")],v.prototype,"writeInverseCoefficients",null);m.__decorate([w.property()],v.prototype,"affectsPixelSize",null);m.__decorate([R.enumeration({PolynomialXform:"polynomial"})],v.prototype,"type",void 0);return v=h=m.__decorate([J.subclass("esri.layers.support.rasterTransforms.PolynomialTransform")],
v)})},"esri/layers/support/rasterDatasets/CovJSONRaster":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRaster ./covJSONParser ./InMemoryRaster ../rasterFunctions/stretchUtils ../../../rest/support/FeatureSet".split(" "),function(m,v,w,L,E,T,R,P,J,p,u,d){L=class extends P{constructor(){super(...arguments);this.datasetFormat=
"CovJSON"}async open(g){await this.init();const {extent:k,pixelBlocks:n,multidimensionalInfo:h,attributeTable:q,bandNames:t}=await this._fetchData(g),{statistics:x,histograms:b}=u.computeStatisticsHistograms(n[0]);g=t?.map(a=>({BandName:a}));g={DataType:q?"Thematic":h?"Scientific":"Generic",BandProperties:g};g=new p({source:{extent:k,pixelBlocks:n,attributeTable:q?d.fromJSON(q):null,multidimensionalInfo:h,statistics:x,histograms:b,keyProperties:g,isPseudoSpatialReference:!1}});await g.open();this._inMemoryRaster=
g;const e=this.source?"":this.url.slice(this.url.lastIndexOf("/")+1);this._set("datasetName",e.slice(0,e.indexOf(".")));this._set("rasterInfo",g.rasterInfo)}fetchRawTile(g,k,n,h={}){return this._inMemoryRaster.fetchRawTile(g,k,n,h)}async _fetchData(g){g=this.source??(await this.request(this.url,{signal:g?.signal})).data;if("coverage"!==g.type?.toLowerCase()||"grid"!==g.domain?.domainType?.toLowerCase())throw new v("imagery-tile-layer:open-coverage-json","Only coverage with Grid domain type is supported");
if(!g.ranges)throw new v("imagery-tile-layer:open-coverage-json","Missing ranges in the grid coverage data");if(!g.domain.referencing?.length)throw new v("imagery-tile-layer:open-coverage-json","Missing domain referencing in the grid coverage data");const k=Object.values(g.ranges);for(let n=0;n<k.length;n++){const {axisNames:h,shape:q,type:t,values:x}=k[n];if(!("ndarray"===t.toLowerCase()&&x?.length&&h?.length&&q?.length))throw new v("imagery-tile-layer:open-coverage-json","Only ranges with valid NdArray, axisNames, shape, and inline values are supported");
if(!J.isXAxis(h[h.length-1])||!J.isYAxis(h[h.length-2]))throw new v("imagery-tile-layer:open-coverage-json","Only row-major ordered pixel values are supported. X axis must be the last axis.");}return J.parseGridCoverage(g)}};m.__decorate([w.property({type:String,json:{write:!0}})],L.prototype,"datasetFormat",void 0);m.__decorate([w.property({constructOnly:!0})],L.prototype,"source",void 0);return L=m.__decorate([R.subclass("esri.layers.support.rasterDatasets.CovJSONRaster")],L)})},"esri/layers/support/rasterDatasets/covJSONParser":function(){define("exports ../../../Color ../../../geometry ../../../geometry/Extent ../../../intl/locale ../PixelBlock ../rasterFormats/pixelRangeUtils ../../../geometry/SpatialReference".split(" "),
function(m,v,w,L,E,T,R,P){function J(h){return["x","e","east","long","longitude"].includes(h.toLowerCase())}function p(h){return["y","n","west","lat","latitude"].includes(h.toLowerCase())}function u(h){const {axes:q}=h.domain,t=Object.keys(q);var x=[];const b=[];let e=-1,a=-1,c=[];for(let F=0;F<t.length;F++){const K=t[F];J(K)?e=F:p(K)&&(a=F);var f=q[K];const H=[];if("values"in f)f.values.forEach(D=>H.push("string"===typeof D?(new Date(D)).getTime():D)),f=H[1]-H[0],x.push([H[0]-.5*f,H[H.length-1]+
.5*f]),b.push(f);else{const {start:D,stop:G,num:S}=f;f=(G-D)/(S-1);x.push([D-.5*f,G+.5*f]);b.push(f);for(let A=0;A<S;A++)H.push(D+f*A)}c.push({name:K,values:H,extent:[H[0],H[H.length-1]]})}-1<e&&-1===a?a=0===e?1:0:-1<a&&-1===e?e=0===a?1:0:-1===a&&-1===e&&(e=0,a=1);c=c.filter((F,K)=>!(K===e||K===a));({referencing:h}=h.domain);h=h.find(F=>F.coordinates.includes(t[e])).system.id;h=h?.slice(h.lastIndexOf("/")+1);h=new P({wkid:null==h||"CRS84"===h?4326:Number(h)});const [l,r]=x[e],[z,y]=x[a];x=new L({xmin:l,
xmax:r,ymin:z,ymax:y,spatialReference:h});return{width:Math.round(x.width/b[e]),height:Math.round(x.height/b[a]),extent:x,dimensions:c}}function d(h){const q=E.getLanguage();return q?h[q]??Object.values(h)[0]:Object.values(h)[0]}function g(h){const q={};({parameters:h}=h);if(!h)return q;for(const [t,x]of Object.entries(h)){const {type:b,description:e,unit:a,categoryEncoding:c,observedProperty:f}=x;if("Parameter"===b&&(q[t]={},e&&(q[t].description=d(e)),a&&(q[t].unit=a.label?d(a.label):null,q[t].symbol=
a.symbol?.value),c)){const l=Object.entries(c).map((z,y)=>({OID:y,Value:Number(z[1]),ClassName:z[0].slice(z[0].lastIndexOf("/")+1),Count:1}));let r=!1;f?.categories?.length&&(f.categories.forEach(z=>{if(z.id){var y=z.id.slice(z.id.lastIndexOf("/")+1),F=l.find(H=>H.ClassName===y);if(F){var K=z.label?d(z.label):null;F.Label=K;z.preferredColor&&(z=v.fromHex(z.preferredColor))&&(r=!0,F.Red=z.r,F.Green=z.g,F.Blue=z.b)}}}),r&&l.forEach(z=>{null==z.Red&&(z.Red=Math.round(255*Math.random()),z.Green=Math.round(255*
Math.random()),z.Blue=Math.round(255*Math.random()))}));h={objectIdFieldName:"",fields:[{name:"OID",type:"esriFieldTypeOID",alias:"OID",domain:null},{name:"Value",type:"esriFieldTypeInteger",alias:"Value",domain:null},{name:"Count",type:"esriFieldTypeDouble",alias:"Count",domain:null},{name:"ClassName",type:"esriFieldTypeString",alias:"ClassName",domain:null,length:50},{name:"Label",type:"esriFieldTypeString",alias:"Label",domain:null,length:50}],features:l.map(z=>({attributes:z}))};r&&h.fields.push({name:"Red",
type:"esriFieldTypeInteger",alias:"Red",domain:null},{name:"Green",type:"esriFieldTypeInteger",alias:"Green",domain:null},{name:"Blue",type:"esriFieldTypeInteger",alias:"Blue",domain:null});q[t].attributeTable=h}}return q}function k(h){let q=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let x=0;x<h.length;x++){const b=h[x];null!=b&&(b<q&&(q=b),b>t&&(t=b))}return R.getIntegerPixelType(q,t)}function n(h,q,t){const x=h.map((a,c)=>({name:a,count:q[c]})).sort((a,c)=>a.name>c.name?-1:1);var b=(a=>c=>a*=c.count)(1);
b=[...x.slice(1),{name:"",count:1}].reverse().map(b).reverse();let e=0;for(let a=h.length-1;0<=a;a--){const c=x.findIndex(({name:f})=>f===h[a]);e+=t%q[a]*b[c];t=Math.floor(t/q[a])}return e}m.isXAxis=J;m.isYAxis=p;m.parseGridCoverage=function(h){const {width:q,height:t,extent:x,dimensions:b}=u(h);var {ranges:e}=h;const a=Object.keys(e).sort((K,H)=>K<H?-1:1);var c=[];for(var f=0;f<a.length;f++){var l=a[f];b?.length&&c.push({name:l,dimensions:b})}const r=g(h);c.forEach(K=>r[K.name]&&Object.assign(K,
r[K.name]));h=c.length?{variables:c}:void 0;c=[];for(f=0;f<a.length;f++){const {values:K,dataType:H,axisNames:D,shape:G}=e[a[f]];l=2<G.length?f*G.slice(0,-2).reduce((C,M)=>C*M):0;const S=D.slice(0,-2),A=G.slice(0,-2),B="float"===H?"f32":k(K),Q=q*t,O=K.length/Q;for(let C=0;C<O;C++){var z=T.createEmptyBand(B,Q),y=(new Uint8Array(Q)).fill(255);let M=!1;var F=C*Q;for(let N=0;N<Q;N++){const U=K[F+N];null==U?(y[N]=0,M=!0):z[N]=U}0===f||b?.length?(z=new T({width:q,height:t,mask:M?y:null,pixels:[z],pixelType:B}),
z.updateStatistics(),b?.length?(y=n(S,A,C),c[y+l]=z):c.push(z)):(F=c[C],F.pixels.push(z),M?F.mask&&(F.mask=T.combineBandMasks([F.mask,y])):F.mask=M?y:null)}}e=Object.values(r).find(K=>K.attributeTable)?.attributeTable;return{extent:x,pixelBlocks:c,multidimensionalInfo:h,attributeTable:e,bandNames:h?void 0:a}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/InMemoryRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../DimensionalDefinition ../RasterInfo ./BaseRaster ./multidimensionalUtils ../rasterFunctions/pixelUtils ../rasterFunctions/stretchUtils ../../../geometry/Extent ../../../geometry/SpatialReference".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q){v=class extends d{constructor(){super(...arguments);this.datasetFormat="MEMORY";this.source=null}get url(){return""}async open(t){await this.init();const x=this.source,{pixelBlocks:b,attributeTable:e,statistics:a,histograms:c,name:f,nativeExtent:l,transform:r}=x,z=b[0],{width:y,height:F,pixelType:K}=z;var H=x.extent??new h({xmin:-.5,ymin:.5,xmax:y-.5,ymax:F-.5,spatialReference:new q({wkid:3857})});const D=x.isPseudoSpatialReference??!x.extent,G={x:H.width/
y,y:H.height/F},S={...x.keyProperties};e&&(S.DataType="Thematic");H=new u({width:y,height:F,pixelType:K,extent:H,nativeExtent:l,attributeTable:e,transform:r,pixelSize:G,spatialReference:H.spatialReference,bandCount:z.pixels.length,keyProperties:S,multidimensionalInfo:x.multidimensionalInfo,statistics:a,isPseudoSpatialReference:D,histograms:c});this.ioConfig.skipMapInfo&&this.updateImageSpaceRasterInfo(H);this.createRemoteDatasetStorageInfo(H,512,512);this._set("rasterInfo",H);this.updateTileInfo();
H.multidimensionalInfo?await this._buildMDimStats(x.pixelBlocks,H.multidimensionalInfo):await this._buildInMemoryRaster(z,{width:512,height:512},t);H.multidimensionalInfo||(this.source=null);this.datasetName=f}fetchRawTile(t,x,b,e={}){if(!this._pixelBlockTiles){const {rasterInfo:a}=this,[c,f]=a.storageInfo.tileInfo.size,{sliceId:l}=e,{pixelBlocks:r}=this.source;t={pixelBlock:null==l?r[0]:r[l],useBilinear:"thematic"!==a.dataType,tileSize:{width:c,height:f},level:t,row:x,col:b};e=this.rasterJobHandler?
this.rasterJobHandler.clipTile(t,e):k.clipTile(t);return Promise.resolve(e)}e=this._pixelBlockTiles.get(`${t}/${x}/${b}`);return Promise.resolve(e)}async _buildInMemoryRaster(t,x,b){const {rasterInfo:e}=this;var a=e.storageInfo.maximumPyramidLevel??0,c="thematic"!==e.dataType;c=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:x,maximumPyramidLevel:a,useBilinear:c},b):Promise.resolve(k.split(t,x,a,c));x=null!=e.statistics;a=null!=e.histograms;t=this.ioConfig.skipStatistics||
x?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},b):Promise.resolve(n.estimateStatisticsHistograms(t));t=await L.eachAlways([c,t]);if(!t[0].value&&t[1].value)throw new w("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=t[0].value;x||(e.statistics=t[1].value?.statistics);a||(e.histograms=t[1].value?.histograms)}async _buildMDimStats(t,x,b){for(let a=0;a<x.variables.length;a++){const c=
x.variables[a];if(!c.statistics){var e=c.dimensions.map(f=>new p({variableName:c.name,dimensionName:f.name,values:[f.values?.[0]??f.extent?.[0]],isSlice:!0}));e=g.getSliceIndex(e,x);e=null==e?null:t[e];null!=e&&(e=this.rasterJobHandler?await this.rasterJobHandler.computeStatisticsHistograms({pixelBlock:e},b):n.computeStatisticsHistograms(e),c.statistics=e.statistics,c.histograms||(c.histograms=e.histograms))}}}};m.__decorate([E.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",
void 0);m.__decorate([E.property()],v.prototype,"source",void 0);m.__decorate([E.property()],v.prototype,"url",null);return v=m.__decorate([J.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],v)})},"esri/layers/support/rasterDatasets/ImageAuxRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/has ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRaster ./InMemoryRaster ./pamParser ../rasterFormats/RasterCodec ../rasterFunctions/stretchUtils ../rasterTransforms/PolynomialTransform ../../../geometry/SpatialReference ../../../geometry/Extent".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q){v=class extends p{async open(t){await this.init();var x=await this._fetchData(t);let {spatialReference:b,statistics:e,histograms:a,transform:c}=await this._fetchAuxiliaryData(t);(t=!b)&&(b=new h({wkid:3857}));a?.length&&null==e&&(e=k.estimateStatisticsFromHistograms(a));const {width:f,height:l}=x;let r=new q({xmin:-.5,ymin:.5-l,xmax:f-.5,ymax:.5,spatialReference:b});const z=c?c.forwardTransform(r):r;var y=!0;c&&(y=(y=c.forwardCoefficients)&&0===y[1]&&0===
y[2])&&(c=null,r=z);x=new u({source:{extent:z,nativeExtent:r,transform:c,pixelBlocks:[x],statistics:e,histograms:a,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:t},ioConfig:{sampling:"closest",skipStatistics:!0}});this.ioConfig.skipMapInfo&&(x.ioConfig.skipMapInfo=!0);await x.open();x.source=null;this._set("rasterInfo",x.rasterInfo);this._inMemoryRaster=x}fetchRawTile(t,x,b,e={}){return this._inMemoryRaster.fetchRawTile(t,x,b,e)}async _fetchData(t){({data:t}=await this.request(this.url,
{responseType:"array-buffer",signal:t?.signal}));var x=g.getFormat(t).toUpperCase();if("JPG"===x||"PNG"===x||"GIF"===x||"BMP"===x)this._set("datasetFormat",x);else throw new w("image-aux-raster:open","the data is not a supported format");x=x.toLowerCase();const b="gif"===x||"bmp"===x||!L("ios");t=await this.decodePixelBlock(t,{format:x,useCanvas:b,hasNoZlibMask:!0});if(null==t)throw new w("image-aux-raster:open","the data cannot be decoded");return t}async _fetchAuxiliaryData(t){t=t?.signal;const {skipExtensions:x=
[],skipMapInfo:b}=this.ioConfig;var e=b||x.includes("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:t}),a=this.datasetFormat;a=(a="JPG"===a?"jgw":"PNG"===a?"pgw":"BMP"===a?"bpw":null)&&x.includes(a)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+a,{responseType:"text",signal:t});e=await E.eachAlways([e,a]);if(t?.aborted)throw E.createAbortError();t=d.parsePAMInfo(e[0].value?.data);t.transform||(e=e[1].value?e[1].value.data.split("\n").slice(0,6).map(c=>
Number(c)):null,t.transform=6===e?.length?new n({forwardCoefficients:[e[4],e[5],e[0],-e[1],e[2],-e[3]]}):null);return t}};m.__decorate([T.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0);return v=m.__decorate([J.subclass("esri.layers.support.rasterDatasets.ImageAuxRaster")],v)})},"esri/layers/support/rasterDatasets/pamParser":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../geometry/support/spatialReferenceUtils ./xmlUtilities ../rasterTransforms/PolynomialTransform ../../../geometry/SpatialReference".split(" "),
function(m,v,w,L,E,T,R){function P(g,k){if(!g||!k)return null;const n=[];for(let h=0;h<g.length;h++)n.push(g[h]),n.push(k[h]);return n}function J(g){var k=E.getElement(g,"GeodataXform");g=E.getElementNumericValue(k,"SpatialReference/WKID")||E.getElementValue(k,"SpatialReference/WKT");g=u(g);if("typens:PolynomialXform"!==k.getAttribute("xsi:type"))return{spatialReference:g,transform:null};var n=E.getElementNumericValue(k,"PolynomialOrder")??1,h=E.getElementNumericValues(k,"CoeffX/Double");const q=
E.getElementNumericValues(k,"CoeffY/Double");var t=E.getElementNumericValues(k,"InverseCoeffX/Double");k=E.getElementNumericValues(k,"InverseCoeffY/Double");h=P(h,q);t=P(t,k);n=h&&t&&h.length&&t.length?new T({spatialReference:g,polynomialOrder:n,forwardCoefficients:h,inverseCoefficients:t}):null;return{spatialReference:g,transform:n}}function p(g){const k=E.getElementNumericValue(g,"NoDataValue");var n=E.getElement(g,"Histograms/HistItem");const h=E.getElementNumericValue(n,"HistMin"),q=E.getElementNumericValue(n,
"HistMax"),t=E.getElementNumericValue(n,"BucketCount");n=E.getElementValue(n,"HistCounts")?.split("|").map(c=>Number(c));let x,b,e,a;E.getElements(g,"Metadata/MDI").forEach(c=>{const f=Number(c.textContent??c.nodeValue);switch(c.getAttribute("key").toUpperCase()){case "STATISTICS_MINIMUM":x=f;break;case "STATISTICS_MAXIMUM":b=f;break;case "STATISTICS_MEAN":e=f;break;case "STATISTICS_STDDEV":a=f}});g=E.getElementNumericValue(g,"Metadata/SourceBandIndex");return{noDataValue:k,histogram:n?.length&&null!=
h&&null!=q?{min:h,max:q,size:t||n.length,counts:n}:null,sourceBandIndex:g,statistics:null!=x&&null!=b?{min:x,max:b,avg:e,stddev:a}:null}}function u(g){if(!g)return null;var k=Number(g);if(!isNaN(k)&&0!==k)return new R({wkid:k});g=String(g).trim();if(L.isWKT2(g))return new R({wkt2:g});var n=g.toUpperCase();if(n.startsWith("COMPD_CS")){if(!n.includes("VERTCS")||!n.includes("GEOGCS")&&!n.startsWith("PROJCS"))return null;k=n.indexOf("VERTCS");const h=n.indexOf("PROJCS");n=-1<h?h:n.indexOf("GEOGCS");if(-1===
n)return null;n=g.slice(n,g.lastIndexOf("]",k)+1).trim();g=g.slice(k,g.lastIndexOf("]")).trim();k=(k=d(n))?new R({wkid:k}):new R({wkt:n});if(g=d(g))k.vcsWkid=g;return k}if(!n.startsWith("GEOGCS")&&!n.startsWith("PROJCS"))return null;k=d(g);return 0!==k?new R({wkid:k}):new R({wkt:g})}function d(g){var k=g.replaceAll("]","[").replaceAll('"',"").split("[").map(h=>h.trim()).filter(h=>""!==h);k=k[k.length-1].split(",");const n=k[0]?.toLowerCase();return"epsg"!==n&&"esri"!==n||!g.endsWith('"]]')||(g=Number(k[1]),
isNaN(g)||0===g)?0:g}m.parsePAMInfo=function(g){if("pamdataset"!==g?.documentElement.tagName?.toLowerCase())return{};const k={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};g.documentElement.childNodes.forEach(n=>{if(1===n.nodeType)if(E.isSameTagIgnoreNS(n,"SRS"))k.spatialReference||(n=E.getElementValue(n),k.spatialReference=u(n));else if(E.isSameTagIgnoreNS(n,"Metadata"))if("xml:ESRI"===n.getAttribute("domain")){const {spatialReference:h,transform:q}=
J(n);k.transform=q;k.spatialReference||(k.spatialReference=h)}else E.getElements(n,"MDI").forEach(h=>k.metadata[h.getAttribute("key")]=E.getElementValue(h));else E.isSameTagIgnoreNS(n,"PAMRasterBand")&&(n=p(n),null!=n.sourceBandIndex&&null==k.rasterBands[n.sourceBandIndex]?k.rasterBands[n.sourceBandIndex]=n:k.rasterBands.push(n))});g=k.rasterBands;g.length&&(k.statistics=g[0].statistics?g.map(n=>n.statistics).filter(w.isSome):null,k.histograms=g[0].histogram?g.map(n=>n.histogram).filter(w.isSome):
null);return k};m.parseSpatialReference=u;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/xmlUtilities":function(){define(["exports"],function(m){function v(T,R){if(!T||!R)return[];var P=R;R.includes("/")?(P=R.slice(0,R.indexOf("/")),R=R.slice(R.indexOf("/")+1)):R="";const J=[];if(R){T=v(T,P);for(P=0;P<T.length;P++)v(T[P],R).forEach(p=>J.push(p));return J}R=T.getElementsByTagNameNS("*",P);if(!R||0===R.length)return[];for(T=0;T<R.length;T++)J.push(R[T]||
R.item(T));return J}function w(T,R){if(!T||!R)return null;let P=R;R.includes("/")?(P=R.slice(0,R.indexOf("/")),R=R.slice(R.indexOf("/")+1)):R="";T=v(T,P);return 0<T.length?R?w(T[0],R):T[0]:null}function L(T,R=null){if(T=R?w(T,R):T)if(T=T.textContent||T.nodeValue)return T.trim();return null}function E(T,R){T=v(T,R);R=[];let P;for(let J=0;J<T.length;J++)if(P=T[J].textContent||T[J].nodeValue)P=P.trim(),""!==P&&R.push(P);return R}m.getElement=w;m.getElementNumericValue=function(T,R){T=L(T,R);return Number(T)};
m.getElementNumericValues=function(T,R){return E(T,R).map(P=>Number(P))};m.getElementValue=L;m.getElementValues=E;m.getElements=v;m.getNodeNameIgnoreNS=function(T){return T.nodeName.slice(T.nodeName.lastIndexOf(":")+1)};m.getSpaceDelimitedNumericValues=function(T,R=null){return L(T,R)?.split(" ").map(P=>Number(P))??[]};m.isSameTagIgnoreNS=function(T,R){T=T?.nodeName?.toLowerCase();R=R.toLowerCase();return T.slice(T.lastIndexOf(":")+1)===R};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/rasterDatasets/ImageServerRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/urlUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../RasterInfo ../RasterStorageInfo ../TileInfo ../TilemapCache ./BaseRaster ../rasterFunctions/pixelUtils ../rasterTransforms/GCSShiftTransform ../../../rest/imageService/fetchRasterInfo ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/Extent".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e){function a(c,f){if(!c)return null;const {minScale:l,maxScale:r,minLOD:z,maxLOD:y}=f;if(null!=z&&null!=y)return g.fromJSON({...c,lods:c.lods.filter(({level:F})=>null!=F&&F>=z&&F<=y)});if(0!==l&&0!==r){const F=l?Math.round(1E4*l)/1E4:Infinity,K=r?Math.round(1E4*r)/1E4:-Infinity;return g.fromJSON({...c,lods:c.lods.filter(H=>{H=Math.round(1E4*H.scale)/1E4;return H<=F&&H>=K})})}return g.fromJSON(c)}v=class extends n{constructor(){super(...arguments);
this._levelOffset=0;this._slices=this._tilemapCache=null;this.datasetFormat="RasterTileServer";this.tileType=null}async open(c){await this.init();var f=c?.signal;c=this.sourceJSON?{data:this.sourceJSON}:await this.request(this.url,{query:{f:"json"},signal:f});c.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=c=c.data;if(!c)throw new w("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!c.tileInfo)throw new w("imageserverraster:open","use ImageryLayer to open non-tiled image services");
this._fixScaleInServiceInfo();var l="jpg jpeg png png8 png24 png32 mixed".split(" ");this.tileType=c.cacheType;null==this.tileType&&(l.includes(c.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===c.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster");this.datasetName=c.name?.slice(c.name.indexOf("/")+1)??"";f=await this._fetchRasterInfo({signal:f});if(null==f)throw new w("image-server-raster:open","cannot initialize image service");t.patchServiceInfo(f,c);l="Map"===
this.tileType?a(c.tileInfo,c):g.fromJSON(c.tileInfo);L.assertIsSome(l);const [r,z]=this._computeMinMaxLOD(f,l),{extent:y,pixelSize:F}=f,K=.5/f.width*F.x,H=Math.max(F.x,F.y),{lods:D}=l;if("Map"!==this.tileType&&0!==c.maxScale||Math.abs(F.x-F.y)>K||!D.some(U=>Math.abs(U.resolution-H)<K))F.x=F.y=r.resolution,f.width=Math.ceil((y.xmax-y.xmin)/F.x-.1),f.height=Math.ceil((y.ymax-y.ymin)/F.y-.1);const G=r.level-z.level,[S,A]=l.size,B=[],Q=[];D.forEach((U,X)=>{U.level>=z.level&&U.level<=r.level&&B.push({x:U.resolution,
y:U.resolution});X<D.length-1&&Q.push(Math.round(10*U.resolution/D[X+1].resolution)/10)});B.sort((U,X)=>U.x-X.x);const O=this.computeBlockBoundary(y,S,A,l.origin,B,G),C=1<B.length?B.slice(1):null;var M;c.transposeInfo&&(M={tileSize:[c.transposeInfo.rows,c.transposeInfo.cols],packetSize:f.keyProperties?._yxs.PacketSize??0});const N=1>=Q.length||3<=Q.length&&Q.slice(0,-1).every(U=>U===Q[0])?Q[0]??2:Math.round(10/(z.resolution/r.resolution)**(-1/G))/10;f.storageInfo=new d({blockWidth:l.size[0],blockHeight:l.size[1],
pyramidBlockWidth:l.size[0],pyramidBlockHeight:l.size[1],pyramidResolutions:C,pyramidScalingFactor:N,compression:l.format,origin:l.origin,firstPyramidLevel:1,maximumPyramidLevel:G,tileInfo:l,transposeInfo:M,blockBoundary:O});this._fixGCSShift(f);this._set("rasterInfo",f);c.capabilities.toLowerCase().includes("tilemap")&&(M={tileInfo:f.storageInfo.tileInfo,parsedUrl:E.urlToObject(this.url),url:this.url,tileServers:[]},this._tilemapCache=new k.TilemapCache({layer:M}))}async fetchRawTile(c,f,l,r={}){const {storageInfo:z,
extent:y}=this.rasterInfo;var {transposeInfo:F}=z,K=null!=F&&!!r.transposedVariableName;if(this._slices&&!K&&null==r.sliceId)return null;({data:r}=await this.request(`${this.url}/tile/${K?0:z.maximumPyramidLevel-c+this._levelOffset}/${f}/${l}`,{query:this._slices?K?{variable:r.transposedVariableName}:{sliceId:r.sliceId||0}:null,responseType:"array-buffer",signal:r.signal}));if(!r)return null;F=K?F.tileSize:z.tileInfo.size;K=await this.decodePixelBlock(r,{width:F[0],height:F[1],planes:null,pixelType:null,
isPoint:"Elevation"===this.tileType,returnInterleaved:K,noDataValue:this.rasterInfo.noDataValue});if(null==K)return null;F=z.blockBoundary[c];if("jpg"!==z.compression||l>F.minCol&&l<F.maxCol&&f>F.minRow&&f<F.maxRow)return K;const {origin:H,blockWidth:D,blockHeight:G}=z,{x:S,y:A}=this.getPyramidPixelSize(c);var B=Math.round((y.xmin-H.x)/S)%D;c=Math.round((y.xmax-H.x)/S)%D||D;var Q=Math.round((H.y-y.ymax)/A)%G;r=Math.round((H.y-y.ymin)/A)%G||G;B=l===F.minCol?B:0;Q=f===F.minRow?Q:0;h.setValidBoundary(K,
{x:B,y:Q},{width:(l===F.maxCol?c:D)-B,height:(f===F.maxRow?r:G)-Q});return K}getSliceIndex(c){if(!this._slices||null==c||0===c.length)return null;for(let f=0;f<this._slices.length;f++){const l=this._slices[f].multidimensionalDefinition;if(l.length===c.length&&!l.some(r=>{var z=c.find(F=>r.variableName===F.variableName&&F.dimensionName===r.dimensionName);if(!z)return!0;const y=Array.isArray(r.values[0])?`${r.values[0][0]}-${r.values[0][1]}`:r.values[0];z=Array.isArray(z.values[0])?`${z.values[0][0]}-${z.values[0][1]}`:
z.values[0];return y!==z}))return f}return null}async fetchVariableStatisticsHistograms(c,f){var l=this.request(this.url+"/statistics",{query:{variable:c,f:"json"},signal:f}).then(r=>r.data?.statistics);c=this.request(this.url+"/histograms",{query:{variable:c,f:"json"},signal:f}).then(r=>r.data?.histograms);l=await Promise.all([l,c]);l[0]&&l[0].forEach(r=>{r.avg=r.mean;r.stddev=r.standardDeviation});l[1]?.[0]?.counts?.length||(l[1]=null);return{statistics:l[0]||null,histograms:l[1]||null}}async computeBestPyramidLevelForLocation(c,
f={}){if(!this._tilemapCache)return 0;c=this.identifyPixelLocation(c,0,f.datumTransformation);if(null===c)return null;let l=0;var {maximumPyramidLevel:r}=this.rasterInfo.storageInfo;r=r-l+this._levelOffset;const z=c.srcLocation;for(;0<=r;){try{if("available"===await this._tilemapCache.fetchAvailability(r,c.row,c.col,f))break}catch{}r--;l++;c=this.identifyPixelLocation(z,l,f.datumTransformation);if(null===c)return null}return-1===r||null==c?null:l}async _fetchRasterInfo(c){var f=this.sourceJSON;if("Map"===
this.tileType){c=f.fullExtent||f.extent;var l=Math.ceil((c.xmax-c.xmin)/f.pixelSizeX-.1);const r=Math.ceil((c.ymax-c.ymin)/f.pixelSizeY-.1),z=x.fromJSON(f.spatialReference||c.spatialReference);f=new b({x:f.pixelSizeX,y:f.pixelSizeY,spatialReference:z});return new u({width:l,height:r,bandCount:3,extent:e.fromJSON(c),spatialReference:z,pixelSize:f,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}})}({signal:l}=c);c=t.fetchServiceRasterInfo(this.url,this.sourceJSON,{signal:l,query:this.ioConfig.customFetchParameters});
f=f.hasMultidimensions?this.request(`${this.url}/slices`,{query:{f:"json"},signal:l}).then(r=>r.data?.slices).catch(()=>null):null;f=await Promise.all([c,f]);this._slices=f[1];return f[0]}_fixScaleInServiceInfo(){const {sourceJSON:c}=this;c.minScale&&0>c.minScale&&(c.minScale=0);c.maxScale&&0>c.maxScale&&(c.maxScale=0)}_fixGCSShift(c){const {extent:f,spatialReference:l}=c;-1<f.xmin&&181<f.xmax&&l?.wkid&&l.isGeographic&&(c.nativeExtent=c.extent,c.transform=new q,c.extent=c.transform.forwardTransform(f))}_computeMinMaxLOD(c,
f){const {pixelSize:l}=c,r=.5/c.width*l.x;({lods:c}=f);var z=f.lodAt(Math.max.apply(null,c.map(H=>H.level)));f=f.lodAt(Math.min.apply(null,c.map(H=>H.level)));var {tileType:y}=this;if("Map"===y)return this._levelOffset=c[0].level,[z,f];if("Raster"===y)return[c.find(H=>H.resolution===l.x)??z,f];const {minScale:F,maxScale:K}=this.sourceJSON;y=z;0<K&&((y=c.find(H=>Math.abs(H.scale-K)<r))||(y=c.filter(H=>H.scale>K).sort((H,D)=>H.scale>D.scale?1:-1)[0]??z));z=f;0<F&&(z=c.find(H=>Math.abs(H.scale-F)<r)??
f,this._levelOffset=z.level-f.level);return[y,z]}};m.__decorate([T.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0);m.__decorate([T.property()],v.prototype,"tileType",void 0);return v=m.__decorate([p.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],v)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/ByteSizeUnit ../../core/Error ../../core/handleUtils ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./TileKey ./Tilemap".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b){var e;m.TilemapCache=e=class extends L{constructor(a){super(a);this._pendingTilemapRequests={};this.request=w;this.size=32;this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new P.LRUCache(2*E.ByteSizeUnit.MEGABYTES);this.addHandles([u.watch(()=>{const {layer:a}=this;return[a?.parsedUrl,a?.tileServers,a?.apiKey,a?.customParameters]},()=>this._initializeTilemapDefinition(),u.initial)])}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??
this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}fetchTilemap(a,c,f,l){if(!this.layer.tileInfo.lodAt(a)||a<this.effectiveMinLOD||a>this.effectiveMaxLOD)return Promise.reject(new T("tilemap-cache:level-unavailable",`Level ${a} is unavailable in the service`));const r=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,c,f,r))return Promise.resolve(a);const z=l?.signal;l={...l,signal:null};return new Promise((y,F)=>{p.onAbort(z,()=>F(p.createAbortError()));const K=b.tilemapDefinitionId(r);
let H=this._pendingTilemapRequests[K];if(!H){H=b.Tilemap.fromDefinition(r,l).then(G=>{this._tilemapCache.put(K,G,G.byteSize);return G});const D=()=>{delete this._pendingTilemapRequests[K]};this._pendingTilemapRequests[K]=H;H.then(D,D)}H.then(y,F)})}getAvailability(a,c,f){return!this.layer.tileInfo.lodAt(a)||a<this.effectiveMinLOD||a>this.effectiveMaxLOD?"unavailable":(a=this._tilemapFromCache(a,c,f,this._tmpTilemapDefinition))?a.getAvailability(c,f):"unknown"}fetchAvailability(a,c,f,l){return!this.layer.tileInfo.lodAt(a)||
a<this.effectiveMinLOD||a>this.effectiveMaxLOD?Promise.reject(new T("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:f})):this.fetchTilemap(a,c,f,l).catch(r=>r).then(r=>{if(r instanceof b.Tilemap){r=r.getAvailability(c,f);if("unavailable"===r)throw new T("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:f});return r}if(p.isAbortError(r))throw r;return"unknown"})}fetchAvailabilityUpsample(a,c,f,l,r){l.level=a;l.row=c;l.col=f;const z=this.layer.tileInfo;z.updateTileInfo(l);
const y=this.fetchAvailability(a,c,f,r).catch(F=>{if(p.isAbortError(F))throw F;if(z.upsampleTile(l))return this.fetchAvailabilityUpsample(l.level,l.row,l.col,l,r);throw F;});this._fetchAvailabilityUpsamplePrefetch(l.id,a,c,f,r,y);return y}async _fetchAvailabilityUpsamplePrefetch(a,c,f,l,r,z){if(this._prefetchingEnabled&&null!=a){var y=`prefetch-${a}`;if(!this.hasHandles(y)){var F=new AbortController;z.then(()=>F.abort(),()=>F.abort());var K=!1;z=R.makeHandle(()=>{K||(K=!0,F.abort())});this.addHandles(z,
y);await d.waitTicks(10,F.signal).catch(()=>{});K||(K=!0,this.removeHandles(y));if(!p.isAborted(F))for(a=new x.TileKey(a,c,f,l),r={...r,signal:F.signal},c=this.layer.tileInfo,f=0;e._prefetches.length<e._maxPrefetch&&c.upsampleTile(a);++f){const H=this.fetchAvailability(a.level,a.row,a.col,r);e._prefetches.push(H);l=()=>{e._prefetches.removeUnordered(H)};H.then(l,l)}}}}_initializeTilemapDefinition(){if(this.layer.parsedUrl){var {parsedUrl:a,apiKey:c,customParameters:f}=this.layer;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:a.path,query:g.objectToQuery({...a.query,...f,token:c??a.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}}_tilemapFromCache(a,c,f,l){l.level=a;l.row=c-c%this.size;l.col=f-f%this.size;a=b.tilemapDefinitionId(l);return this._tilemapCache.get(a)}get test(){const a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(c){a._prefetchingEnabled=c},hasTilemap(c,
f,l){return!!a._tilemapFromCache(c,f,l,a._tmpTilemapDefinition)}}}};m.TilemapCache._maxPrefetch=4;m.TilemapCache._prefetches=new J({initialSize:e._maxPrefetch});v.__decorate([k.property({constructOnly:!0})],m.TilemapCache.prototype,"layer",void 0);v.__decorate([k.property({constructOnly:!0})],m.TilemapCache.prototype,"minLOD",void 0);v.__decorate([k.property({constructOnly:!0})],m.TilemapCache.prototype,"maxLOD",void 0);v.__decorate([k.property({constructOnly:!0})],m.TilemapCache.prototype,"request",
void 0);v.__decorate([k.property({constructOnly:!0})],m.TilemapCache.prototype,"size",void 0);m.TilemapCache=e=v.__decorate([t.subclass("esri.layers.support.TilemapCache")],m.TilemapCache);Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(m){m.ByteSizeUnit=void 0;var v=m.ByteSizeUnit||(m.ByteSizeUnit={});v[v.KILOBYTES=1024]="KILOBYTES";v[v.MEGABYTES=1048576]="MEGABYTES";v[v.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Tilemap":function(){define("exports ../../request ../../core/arrayUtils ../../core/Error ../../core/lang ../../core/typedArrayUtil ../../geometry/support/UintArray".split(" "),function(m,v,w,L,E,T,R){function P(p){if(p.service.tileServers?.length){var u=p.service.tileServers;u=`${u&&u.length?u[p.row%u.length]:p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`}else u=`${p.service.url}/tilemap/${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`;
(p=p.service.query)&&(u=`${u}?${p}`);return u}class J{constructor(p){this._validateJSON(p);const {location:u,data:d}=p;this.location=Object.freeze(E.clone(u));let g=p=!0;const k=R.newUintArray(Math.ceil(this.location.width*this.location.height/32));let n=0;for(let h=0;h<d.length;h++){const q=h%32;d[h]?(g=!1,k[n]|=1<<q):p=!1;31===q&&++n}g?(this._availability="unavailable",this.byteSize=40):p?(this._availability="available",this.byteSize=40):(this._availability=k,this.byteSize=40+T.estimateSize(k))}getAvailability(p,
u){if("unavailable"===this._availability||"available"===this._availability)return this._availability;p=(p-this.location.top)*this.location.width+(u-this.location.left);u=p>>5;const d=this._availability;return 0>u||u>d.length?"unknown":d[u]&1<<p%32?"available":"unavailable"}static fromDefinition(p,u){const d=p.service.request||v,{row:g,col:k,width:n,height:h}=p,q={query:{f:"json"}};u=u?{...q,...u}:q;return d(P(p),u).then(t=>t.data).catch(t=>{if(t&&t.details&&422===t.details.httpStatus)return{location:{top:g,
left:k,width:n,height:h},valid:!0,data:w.constant(n*h,0)};throw t;}).then(t=>{if(t.location&&(t.location.top!==g||t.location.left!==k||t.location.width!==n||t.location.height!==h))throw new L("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:g,left:k,width:n,height:h}});return J.fromJSON(t)})}static fromJSON(p){return Object.freeze(new J(p))}_validateJSON(p){if(!p?.location)throw new L("tilemap:missing-location","Location missing from tilemap response");
if(!1===p.valid)throw new L("tilemap:invalid","Tilemap response was marked as invalid");if(!p.data)throw new L("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(p.data))throw new L("tilemap:data-mismatch","Data must be an array of numbers");if(p.data.length!==p.location.width*p.location.height)throw new L("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");}}m.Tilemap=J;m.tilemapDefinitionId=function(p){return`${p.level}/${p.row}/${p.col}/${p.width}/${p.height}`};
Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UintArray":function(){define(["exports","../../core/typedArrayUtil"],function(m,v){m.newUintArray=function(w,L=!1){return w<=v.nativeArrayMaxSize?L?Array(w).fill(0):Array(w):new Uint32Array(w)};m.uintArrayFrom=function(w){return(v.isArray(w)?w.length:w.byteLength/8)<=v.nativeArrayMaxSize?Array.from(w):new Uint32Array(w)};m.uintSubArray=function(w,L,E){return Array.isArray(w)?w.slice(L,L+E):w.subarray(L,L+E)};Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/imageService/fetchRasterInfo":function(){define("exports ../../request ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../layers/support/RasterInfo ../utils ../support/FeatureSet".split(" "),function(m,v,w,L,E,T,R,P){async function J(p,u,d){p=R.parseUrl(p);const {rasterFunction:g,sourceJSON:k}=u||{};u=g?JSON.stringify(g.rasterFunctionDefinition||g):null;u=R.encode({...p.query,renderingRule:u,f:"json"});u=R.asValidOptions(u,
d);p=p.path;d=k||await v(p,u).then(l=>l.data);var n=d.hasRasterAttributeTable?v(`${p}/rasterAttributeTable`,u):null,h=d.hasColormap?v(`${p}/colormap`,u):null,q=d.hasHistograms?v(`${p}/histograms`,u):null,t=10.3<=d.currentVersion?v(`${p}/keyProperties`,u):null;p=d.hasMultidimensions?v(`${p}/multidimensionalInfo`,u):null;n=await Promise.allSettled([n,h,q,t,p]);p=null;if(d.minValues&&d.minValues.length===d.bandCount)for(p=[],u=0;u<d.minValues.length;u++)p.push({min:d.minValues[u],max:d.maxValues[u],
avg:d.meanValues[u],stddev:d.stdvValues[u]});h=w.fromJSON(d.extent);u=Math.ceil(h.width/d.pixelSizeX-.1);h=Math.ceil(h.height/d.pixelSizeY-.1);q=E.fromJSON(d.spatialReference||d.extent.spatialReference);t="fulfilled"===n[0].status?n[0].value?.data:null;t=t?.features?.length?P.fromJSON(t):null;var x="fulfilled"===n[1].status?n[1].value?.data.colormap:null;x=x?.length?x:null;var b="fulfilled"===n[2].status?n[2].value?.data.histograms:null;b=b?.[0]?.counts?.length?b:null;const e="fulfilled"===n[3].status?
n[3].value?.data??{}:{};n="fulfilled"===n[4].status?n[4].value?.data.multidimensionalInfo:null;(n=n?.variables?.length?n:null)&&n.variables.forEach(l=>{l.statistics?.length&&l.statistics.forEach(r=>{r.avg=r.mean;r.stddev=r.standardDeviation})});const {defaultVariable:a,serviceDataType:c}=d;a&&a!==e.DefaultVariable&&(e.DefaultVariable=a);c?.includes("esriImageServiceDataTypeVector")&&!c.includes(e.DataType)&&(e.DataType=c.replace("esriImageServiceDataType",""));let f=d.noDataValue;d.noDataValues?.length&&
d.noDataValues.some(l=>l!==f)&&(f=d.noDataValues);return new T({width:u,height:h,bandCount:d.bandCount,extent:w.fromJSON(d.extent),spatialReference:q,pixelSize:new L({x:d.pixelSizeX,y:d.pixelSizeY,spatialReference:q}),pixelType:d.pixelType.toLowerCase(),statistics:p,attributeTable:t,colormap:x,histograms:b,keyProperties:e,noDataValue:f,multidimensionalInfo:n})}m.fetchServiceRasterInfo=function(p,u,d){return J(p,{sourceJSON:u},d)};m.generateRasterInfo=function(p,u,d){return J(p,{rasterFunction:u},
d)};m.patchServiceInfo=function(p,u){p.attributeTable||(u.hasRasterAttributeTable=!1);p.histograms||(u.hasHistograms=!1);p.colormap||(u.hasColormap=!1);p.multidimensionalInfo||(u.hasMultidimensions=!1)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/MRFRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../PixelBlock ../RasterInfo ../RasterStorageInfo ./BaseRaster ./pamParser ./xmlUtilities ../rasterFormats/utils ../rasterFunctions/stretchUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x){const b=new Map;b.set("Int8","s8");b.set("UInt8","u8");b.set("Int16","s16");b.set("UInt16","u16");b.set("Int32","s32");b.set("UInt32","u32");b.set("Float32","f32");b.set("Float64","f32");b.set("Double64","f32");const e=new Map;e.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"});e.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"});e.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"});
e.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});v=class extends d{constructor(){super(...arguments);this._storageIndex=this._files=null;this.datasetFormat="MRF"}async open(a){await this.init();this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);var c=a?a.signal:null,f=await this.request(this.url,{responseType:"xml",signal:c});const {rasterInfo:l,files:r}=this._parseHeader(f.data),{skipMapInfo:z,skipExtensions:y=[]}=this.ioConfig;y.includes("aux.xml")||z||(a=await this._fetchAuxiliaryData(a),
null!=a&&(l.statistics=a.statistics??l.statistics,(l.histograms=a.histograms)&&null==l.statistics&&(l.statistics=h.estimateStatisticsFromHistograms(a.histograms))));z&&this.updateImageSpaceRasterInfo(l);this._set("rasterInfo",l);this._files=r;c=await this.request(r.index,{responseType:"array-buffer",signal:c});this._storageIndex=this._parseIndex(c.data);const {blockWidth:F,blockHeight:K}=this.rasterInfo.storageInfo;c=this.rasterInfo.storageInfo.pyramidScalingFactor;const {width:H,height:D}=this.rasterInfo;
a=[];f=this._getBandSegmentCount();let G=0,S=-1;for(;G<this._storageIndex.length;){S++;const A=Math.ceil(H/F/c**S)-1,B=Math.ceil(D/K/c**S)-1;G+=(A+1)*(B+1)*f*4;a.push({maxRow:B,maxCol:A,minCol:0,minRow:0})}this.rasterInfo.storageInfo.blockBoundary=a;0<S&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=S);this.updateTileInfo()}async fetchRawTile(a,c,f,l={}){const {blockWidth:r,blockHeight:z,blockBoundary:y}=this.rasterInfo.storageInfo;var F=y[a];if(!F||
F.maxRow<c||F.maxCol<f||F.minRow>c||F.minCol>f)return null;const {bandCount:K,pixelType:H}=this.rasterInfo,{ranges:D,actualTileWidth:G,actualTileHeight:S}=this._getTileLocation(a,c,f);if(!D||0===D.length)return null;if(0===D[0].from&&0===D[0].to)return a=new Uint8Array(r*z),new J({width:r,height:z,pixels:null,mask:a,validPixelCount:0});({bandIds:c}=this.ioConfig);f=this._getBandSegmentCount();F=[];for(a=a=0;a<f;a++)c&&!c.includes(a)||F.push(this.request(this._files.data,{range:{from:D[a].from,to:D[a].to},
responseType:"array-buffer",signal:l.signal}));l=await Promise.all(F);a=l.map(Q=>Q.data.byteLength).reduce((Q,O)=>Q+O);F=new Uint8Array(a);const A=[];let B=0;for(a=0;a<f;a++)A.push(B),F.set(new Uint8Array(l[a].data),B),B+=l[a].data.byteLength;a=e.get(this.rasterInfo.storageInfo.compression).decoderFormat;c=await this.decodePixelBlock(F.buffer,{width:r,height:z,format:a,planes:c?.length||K,offsets:A,pixelType:H});if(null==c)return null;({noDataValue:f}=this.rasterInfo);if(null!=f&&"lerc"!==a&&!c.mask&&
(f=f[0],null!=f)){l=c.width*c.height;F=new Uint8Array(l);if(1E24<Math.abs(f))for(a=0;a<l;a++)1E-6<Math.abs((c.pixels[0][a]-f)/f)&&(F[a]=1);else for(a=0;a<l;a++)c.pixels[0][a]!==f&&(F[a]=1);c.mask=F}l=f=0;if(G!==r||S!==z)if(F=c.mask)for(a=0;a<z;a++)for(l=a*r,f=a<S?G:0;f<r;f++)F[l+f]=0;else for(F=new Uint8Array(r*z),c.mask=F,a=0;a<S;a++)for(l=a*r,f=0;f<G;f++)F[l+f]=1;return c}_parseIndex(a){if(0<a.byteLength%16)throw Error("invalid array buffer must be multiples of 16");let c,f,l,r,z;if(n.isPlatformLittleEndian){c=
new Uint8Array(a);l=new ArrayBuffer(a.byteLength);f=new Uint8Array(l);for(r=0;r<a.byteLength/4;r++)for(z=0;4>z;z++)f[4*r+z]=c[4*r+3-z];a=new Uint32Array(l)}else a=new Uint32Array(a);return a}_getBandSegmentCount(){return e.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}_getTileLocation(a,c,f){const {blockWidth:l,blockHeight:r,pyramidScalingFactor:z}=this.rasterInfo.storageInfo,{width:y,height:F}=this.rasterInfo,K=this._getBandSegmentCount();let H,D;var G,S=0;
let A=0;for(G=0;G<a;G++)A=z**G,H=Math.ceil(y/l/A),D=Math.ceil(F/r/A),S+=H*D;A=z**a;H=Math.ceil(y/l/A);D=Math.ceil(F/r/A);S=4*(S+(c*H+f))*K;a=this._storageIndex.subarray(S,S+4*K);S=G=0;const B=[];for(let Q=0;Q<K;Q++)G=a[4*Q]*2**32+a[4*Q+1],S=G+a[4*Q+2]*2**32+a[4*Q+3],B.push({from:G,to:S});return{ranges:B,actualTileWidth:f<H-1?l:Math.ceil(y/A)-l*(H-1),actualTileHeight:c<D-1?r:Math.ceil(F/A)-r*(D-1)}}_parseHeader(a){var c=k.getElement(a,"MRF_META/Raster");if(!c)throw new w("mrf:open","not a valid MRF format");
var f=k.getElement(c,"Size"),l=parseInt(f.getAttribute("x"),10),r=parseInt(f.getAttribute("y"),10);const z=parseInt(f.getAttribute("c"),10);f=(k.getElementValue(c,"Compression")||"none").toLowerCase();if(!e.has(f))throw new w("mrf:open","currently does not support compression "+f);var y=k.getElementValue(c,"DataType")||"UInt8";const F=b.get(y);if(null==F)throw new w("mrf:open","currently does not support pixel type "+y);var K=k.getElement(c,"PageSize");y=parseInt(K.getAttribute("x"),10);K=parseInt(K.getAttribute("y"),
10);c=k.getElement(c,"DataValues");let H;c&&(c=c.getAttribute("NoData"),null!=c&&(H=c.trim().split(" ").map(O=>parseFloat(O))));if(k.getElement(a,"MRF_META/CachedSource"))throw new w("mrf:open","currently does not support MRF referencing other data files");var D=k.getElement(a,"MRF_META/GeoTags"),G=k.getElement(D,"BoundingBox");c=!1;if(null!=G){var S=parseFloat(G.getAttribute("minx"));var A=parseFloat(G.getAttribute("miny")),B=parseFloat(G.getAttribute("maxx"));G=parseFloat(G.getAttribute("maxy"));
var Q=k.getElementValue(D,"Projection")||"";D=q.WGS84;"LOCAL_CS[]"!==Q?Q.toLowerCase().startsWith("epsg:")?(Q=Number(Q.slice(5)),isNaN(Q)||0===Q||(D=new q({wkid:Q}))):D=g.parseSpatialReference(Q)??q.WGS84:(c=!0,D=new q({wkid:3857}));S=new t(S,A,B,G);S.spatialReference=D}else c=!0,S=new t({xmin:-.5,ymin:.5-r,xmax:l-.5,ymax:.5,spatialReference:new q({wkid:3857})});A=k.getElement(a,"MRF_META/Rsets");B=parseInt(A?.getAttribute("scale")||"2",10);A=S.spatialReference;y=new u({origin:new x({x:S.xmin,y:S.ymax,
spatialReference:A}),blockWidth:y,blockHeight:K,pyramidBlockWidth:y,pyramidBlockHeight:K,compression:f,pyramidScalingFactor:B});K=new x({x:S.width/l,y:S.height/r,spatialReference:A});l=new p({width:l,height:r,extent:S,isPseudoSpatialReference:c,spatialReference:A,bandCount:z,pixelType:F,pixelSize:K,noDataValue:H,storageInfo:y});r=k.getElementValue(a,"datafile");a=k.getElementValue(a,"IndexFile");a={mrf:this.url,index:a||this.url.replace(".mrf",".idx"),data:r||this.url.replace(".mrf",e.get(f).blobExtension)};
return{rasterInfo:l,files:a}}async _fetchAuxiliaryData(a){try{const {data:c}=await this.request(this.url+".aux.xml",{responseType:"xml",signal:a?.signal});return g.parsePAMInfo(c)}catch{return null}}};m.__decorate([L.property()],v.prototype,"_files",void 0);m.__decorate([L.property()],v.prototype,"_storageIndex",void 0);m.__decorate([L.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0);return v=m.__decorate([P.subclass("esri.layers.support.rasterIO.MRFRaster")],v)})},"esri/layers/support/rasterDatasets/TIFFRaster":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../RasterInfo ../RasterStorageInfo ./BaseRaster ./DBFParser ./pamParser ../rasterFormats/TiffDecoder ../rasterFormats/TiffTags ../rasterFunctions/stretchUtils ../rasterTransforms/PolynomialTransform ../../../rest/support/FeatureSet ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(m,v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e){v=class extends u{constructor(){super(...arguments);this._headerInfo=this._files=null;this._bufferSize=1048576;this.datasetFormat="TIFF"}async open(a){await this.init();var c=a?a.signal:null,{data:f}=await this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:c});if(!f)throw new L("tiffraster:open","failed to open url "+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1,this.url.lastIndexOf("."));
const {littleEndian:l,firstIFDPos:r,isBigTiff:z}=k.parseSignature(f);var y=[];await this._readIFDs(y,f,l,r,0,z?8:4,c);const {imageInfo:F,rasterInfo:K}=this._parseIFDs(y);c=k.getPyramidIFDs(y);f=k.getMaskIFDs(y);this._headerInfo={littleEndian:l,isBigTiff:z,ifds:y,pyramidIFDs:c,maskIFDs:f,...F};this._set("rasterInfo",K);if(!F.isSupported)throw new L("tiffraster:open","this tiff is not supported: "+F.message);if(!F.tileWidth)throw new L("tiffraster:open","none-tiled tiff is not optimized for access, convert to COG and retry.");
K.isPseudoSpatialReference&&E.getLogger(this).warn("The spatial reference for this tiff is unsupported. Only EPSG spatial reference codes and Esri WKTs are supported.");c=y[0].get("PREDICTOR")?.values?.[0];if(3===y[0].get("SAMPLEFORMAT")?.values?.[0]&&2===c)throw new L("tiffraster:open","unsupported horizontal difference encoding. Predictor\x3d3 is supported for floating point data");const {skipMapInfo:H,skipExtensions:D=[]}=this.ioConfig;D.includes("aux.xml")||H||(y=await this._fetchAuxiliaryMetaData(a),
null!=y&&this._processPAMInfo(y,K));D.includes("vat.dbf")||1!==K.bandCount||"u8"!==K.pixelType||H||(K.attributeTable=await this._fetchAuxiliaryTable(a),null!=K.attributeTable&&(K.keyProperties.DataType="thematic"));H&&this.updateImageSpaceRasterInfo(K);this.updateTileInfo()}async fetchRawTile(a,c,f,l={}){if(!this._headerInfo?.isSupported||this.isBlockOutside(a,c,f))return null;const r=await this._fetchRawTiffTile(a,c,f,!1,l);null!=r&&this._headerInfo.hasMaskBand&&(a=await this._fetchRawTiffTile(a,
c,f,!0,l),null!=a&&a.pixels[0]instanceof Uint8Array&&(r.mask=a.pixels[0]));return r}_parseIFDs(a){const c=k.getImageInfo(a),{width:f,height:l,tileWidth:r,tileHeight:z,planes:y,pixelType:F,compression:K,firstPyramidLevel:H,maximumPyramidLevel:D,pyramidBlockWidth:G,pyramidBlockHeight:S,tileBoundary:A,affine:B,metadata:Q}=c;let O=g.parseSpatialReference(c.extent.spatialReference?.wkt||c.extent.spatialReference?.wkid);var C=!!c.isPseudoGeographic;null==O&&(C=!0,O=new x({wkid:3857}));const M=new b({...c.extent,
spatialReference:O});var N=M?new e({x:M.xmin,y:M.ymax,spatialReference:O}):new e({x:0,y:0});N=new p({blockWidth:r,blockHeight:z,pyramidBlockWidth:G,pyramidBlockHeight:S,compression:K,origin:N,firstPyramidLevel:H,maximumPyramidLevel:D,blockBoundary:A});const U=new e({x:(M.xmax-M.xmin)/f,y:(M.ymax-M.ymin)/l,spatialReference:O}),X=Q?{BandProperties:Q.bandProperties,DataType:Q.dataType}:{};let I=null;var V=a[0].get("PHOTOMETRICINTERPRETATION")?.values?.[0];a=a[0].get("COLORMAP")?.values;if(3>=V&&3<a?.length&&
0===a.length%3){I=[];V=a.length/3;for(let W=0;W<V;W++)I.push([W,a[W]>>>8,a[W+V]>>>8,a[W+2*V]>>>8])}C=new J({width:f,height:l,bandCount:y,pixelType:F,pixelSize:U,storageInfo:N,spatialReference:O,isPseudoSpatialReference:C,keyProperties:X,extent:M,colormap:I,statistics:Q?Q.statistics:null});B?.length&&(C.nativeExtent=new b({xmin:-.5,ymin:.5-l,xmax:f-.5,ymax:.5,spatialReference:O}),C.transform=new q({polynomialOrder:1,forwardCoefficients:[B[2]+B[0]/2,B[5]-B[3]/2,B[0],B[3],-B[1],-B[4]]}),C.extent=C.transform.forwardTransform(C.nativeExtent),
C.pixelSize=new e({x:(M.xmax-M.xmin)/f,y:(M.ymax-M.ymin)/l,spatialReference:O}),N.origin.x=-.5,N.origin.y=.5);return{imageInfo:c,rasterInfo:C}}_processPAMInfo(a,c){c.statistics=a.statistics??c.statistics;(c.histograms=a.histograms)&&null==c.statistics&&(c.statistics=h.estimateStatisticsFromHistograms(a.histograms));if(a.transform&&null==c.transform){c.transform=a.transform;c.nativeExtent=c.extent;const f=c.transform.forwardTransform(c.nativeExtent);c.pixelSize=new e({x:(f.xmax-f.xmin)/c.width,y:(f.ymax-
f.ymin)/c.height,spatialReference:c.spatialReference});c.extent=f}c.isPseudoSpatialReference&&a.spatialReference&&(c.spatialReference=a.spatialReference,c.extent.spatialReference=c.nativeExtent.spatialReference=c.storageInfo.origin.spatialReference=c.spatialReference)}async _readIFDs(a,c,f,l,r,z=4,y){if(!l)return null;if(l>=c.byteLength||0>l)c=(await this.request(this.url,{range:{from:l+r,to:l+r+this._bufferSize},responseType:"array-buffer",signal:y})).data,r=l+r,l=0;l=await this._readIFD(c,f,l,r,
n.tiffTags,z,y);a.push(l.ifd);if(!l.nextIFD)return null;await this._readIFDs(a,c,f,l.nextIFD-r,r,z,y)}async _readIFD(a,c,f,l,r=n.tiffTags,z=4,y){if(!a)return null;f=k.parseIFD(a,c,f,l,r,z);if(f.success){const F=[];f.ifd?.forEach(K=>{K.values||F.push(K)});0<F.length&&(z=F.map(K=>K.offlineOffsetSize).filter(w.isSome),r=Math.min.apply(null,z.map(K=>K[0])),Math.min.apply(null,z.map(K=>K[0]+K[1]))-r<=this._bufferSize&&({data:z}=await this.request(this.url,{range:{from:r,to:r+this._bufferSize},responseType:"array-buffer",
signal:y}),a=z,l=r,F.forEach(K=>k.parseFieldValues(a,c,K,l))));f.ifd?.has("GEOKEYDIRECTORY")&&(r=f.ifd.get("GEOKEYDIRECTORY"),(z=r?.values)&&4<z.length&&(z=z[0]+"."+z[1]+"."+z[2],y=await this._readIFD(a,c,r.valueOffset+6-l,l,n.geoKeys,2,y),r.data=y.ifd,r.data&&r.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[z]})));return f}if(f.requiredBufferSize&&f.requiredBufferSize!==a.byteLength)return a=(await this.request(this.url,{range:{from:l,to:l+f.requiredBufferSize+4},responseType:"array-buffer",
signal:y})).data,a.byteLength<f.requiredBufferSize?null:this._readIFD(a,c,0,l,n.tiffTags,4,y)}async _fetchRawTiffTile(a,c,f,l,r={}){c=this._getTileLocation(a,c,f,l);if(!c)return null;const {ranges:z,actualTileWidth:y,actualTileHeight:F,ifd:K}=c;c=z.map(S=>this.request(this.url,{range:S,responseType:"array-buffer",signal:r.signal}));c=await Promise.all(c);f=c.map(S=>S.data.byteLength).reduce((S,A)=>S+A);f=1===c.length?c[0].data:new ArrayBuffer(f);l=[0];var H=[0];if(1<c.length){const S=new Uint8Array(f);
for(let A=0,B=0;A<c.length;A++){const Q=c[A].data;S.set(new Uint8Array(Q),B);l[A]=B;B+=Q.byteLength;H[A]=Q.byteLength}}const {blockWidth:D,blockHeight:G}=this.getBlockWidthHeight(a);a=await this.decodePixelBlock(f,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:K,offsets:l,sizes:H},width:D,height:G,planes:null,pixelType:null});if(null==a)return null;if(y!==D||F!==G)if(H=a.mask)for(c=0;c<G;c++)for(l=c*D,f=c<F?y:0;f<D;f++)H[l+f]=0;else for(H=new Uint8Array(D*G),a.mask=H,c=0;c<F;c++)for(l=
c*D,f=0;f<y;f++)H[l+f]=1;return a}_getTileLocation(a,c,f,l=!1){const {firstPyramidLevel:r,blockBoundary:z}=this.rasterInfo.storageInfo;var y=0===a?0:a-(r-1);({_headerInfo:a}=this);if(!a)return null;l=l?a.maskIFDs[y]:0===y?a?.ifds[0]:a?.pyramidIFDs[y-1];if(!l)return null;var F=k.isBSQConfig(l,a);a=l.get("TILEOFFSETS")?.values;if(void 0===a)return null;const K=l.get("TILEBYTECOUNTS")?.values,{minRow:H,minCol:D,maxRow:G,maxCol:S}=z[y];if(c>G||f>S||c<H||f<D)return null;y=l.get("IMAGEWIDTH")?.values?.[0];
const A=l.get("IMAGELENGTH")?.values?.[0],B=l.get("TILEWIDTH")?.values?.[0],Q=l.get("TILELENGTH")?.values?.[0],O=[];if(F){({bandCount:F}=this.rasterInfo);for(let C=0;C<F;C++){const M=C*(G+1)*(S+1)+c*(S+1)+f;O[C]={from:a[M],to:a[M]+K[M]-1}}}else F=c*(S+1)+f,O.push({from:a[F],to:a[F]+K[F]-1});for(a=0;a<O.length;a++)if(null==O[a].from||!O[a].to||0>O[a].to)return null;return{ranges:O,ifd:l,actualTileWidth:f===S?y%B||B:B,actualTileHeight:c===G?A%Q||Q:Q}}async _fetchAuxiliaryMetaData(a){try{const {data:c}=
await this.request(this.url+".aux.xml",{responseType:"xml",signal:a?.signal});return g.parsePAMInfo(c)}catch{return null}}async _fetchAuxiliaryTable(a){try{const {data:c}=await this.request(this.url+".vat.dbf",{responseType:"array-buffer",signal:a?.signal}),f=d.parse(c);return f?.recordSet?t.fromJSON(f.recordSet):null}catch{return null}}};m.__decorate([T.property()],v.prototype,"_files",void 0);m.__decorate([T.property()],v.prototype,"_headerInfo",void 0);m.__decorate([T.property()],v.prototype,"_bufferSize",
void 0);m.__decorate([T.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0);return v=m.__decorate([P.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],v)})},"*noref":1}});
define("require ../chunks/tslib.es6 ../PopupTemplate ../core/Clonable ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./Layer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/ImageryTileMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/Field ./support/rasterEnums ./support/RasterFunction ./support/rasterDatasets/FunctionRaster ./support/rasterDatasets/RasterFactory ./support/rasterFunctions/rasterFunctionHelper ../support/popupUtils ../webdoc/interfaces".split(" "),function(m,
v,w,L,E,T,R,P,J,p,u,d,g,k,n,h,q,t,x,b,e,a,c,f,l,r,z,y,F,K,H,D,G,S){L=class extends t.BlendLayer(f.ScaleRangeLayer(e.OperationalLayer(a.PortalLayer(x.CustomParametersMixin(b.ImageryTileMixin(l.TemporalLayer(q.ArcGISService(c.RefreshableLayer(R.MultiOriginJSONMixin(L.ClonableMixin(h))))))))))){constructor(...A){super(...A);this._primaryRasters=[];this.interpolation=this.bandIds=null;this.legendEnabled=!0;this.isReference=null;this.listMode="show";this.version=this.sourceJSON=null;this.type="imagery-tile";
this.operationalLayerType="ArcGISTiledImageServiceLayer";this.popupEnabled=!0;this.fields=this.popupTemplate=null;this.source=void 0;this._debouncedSaveOperations=P.debounce(async(B,Q,O)=>{const {save:C,saveAs:M}=await new Promise((N,U)=>m(["./save/imageryUtils"],N,U));switch(B){case S.SaveOperationType.SAVE:return C(this,Q);case S.SaveOperationType.SAVE_AS:return M(this,O,Q)}})}normalizeCtorArgs(A,B){return"string"===typeof A?{url:A,...B}:A}load(A){const B=null!=A?A.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},
A).catch(P.throwIfAbortError).then(()=>this._openRaster(B)));return Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){var A=new z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"}),B=new z({name:"Raster.ServicePixelValue.Raw",alias:"Raw Pixel Value",domain:null,editable:!1,length:50,type:"string"});A=[A,B];({serviceRasterInfo:B}=this);var Q=B?.attributeTable;if(Q=null!=Q?Q.fields:null)Q=Q.filter(O=>
"oid"!==O.type&&"value"!==O.name.toLowerCase()).map(O=>{const C=O.clone();C.name="Raster."+O.name;return C}),A.push(...Q);Q=B?.dataType;B=B?.multidimensionalInfo;"vector-magdir"!==Q&&"vector-uv"!==Q||null==B||(B=B.variables[0].unit?.trim(),A.push(new z({name:"Raster.Magnitude",alias:"Magnitude"+(B?` (${B})`:""),domain:null,editable:!1,type:"double"})),A.push(new z({name:"Raster.Direction",alias:"Direction (\u00b0)",domain:null,editable:!1,type:"double"})));return A}createPopupTemplate(A){const {rasterFields:B}=
this,Q=new Set(B.map(({name:O})=>O).filter(O=>"raster.servicepixelvalue.raw"!==O.toLowerCase()));return G.createPopupTemplate({fields:B,title:this.title},{...A,visibleFieldNames:Q})}async generateRasterInfo(A,B){A=u.ensureClass(F,A);if(!A)return this.serviceRasterInfo;try{const {rasterInfo:Q}=await this._openFunctionRaster(A,B);return Q}catch(Q){if(Q instanceof E)throw Q;throw new E("imagery-tile-layer","the given raster function is not supported");}}async save(A){return this._debouncedSaveOperations(S.SaveOperationType.SAVE,
A)}async saveAs(A,B){return this._debouncedSaveOperations(S.SaveOperationType.SAVE_AS,B,A)}write(A,B){const Q=this._primaryRasters[0]??this.raster;if(this.loaded?"RasterTileServer"===Q.datasetFormat&&("Raster"===Q.tileType||"Map"===Q.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return super.write(A,B);B?.messages&&B.messages.push(new E("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${`${B.origin}/${B.layerContainerType||
"operational-layers"}`}'`,{layer:this}));return null}async _openRaster(A){let B=!1;if(this.raster)await this._openFromRaster(this.raster,A),B="Function"===this.raster.datasetFormat;else{const {url:Q,rasterFunction:O,source:C}=this;if(!Q&&!C)throw new E("imagery-tile-layer:open","missing url or source parameter");C?await this._openFromSource(C,A):O?await this._openFromUrlWithRasterFunction(Q,O,A):await this._openFromUrl(Q,A)}A=this.raster.rasterInfo;if(!A)throw new E("imagery-tile-layer:load","cannot load resources on "+
this.url);this._set("serviceRasterInfo",B?A:this._primaryRasters[0].rasterInfo);this._set("spatialReference",A.spatialReference);this.sourceJSON=this.sourceJSON||this.raster.sourceJSON;null!=this.sourceJSON?this.read("Map"===this.raster.tileType&&null!=this.sourceJSON.minLOD&&null!=this.sourceJSON.maxLOD?this.sourceJSON:{...this.sourceJSON,minScale:0,maxScale:0},{origin:"service"}):this.read({tileInfo:this.serviceRasterInfo.storageInfo.tileInfo.toJSON()},{origin:"service"});this.title||(this.title=
this.raster.datasetName);"Map"===this.raster.tileType&&(this.popupEnabled=!1);this._configDefaultSettings();this.addHandles(J.watch(()=>this.customParameters,Q=>{this.raster&&(this.raster.ioConfig.customFetchParameters=Q)}))}async _openFromRaster(A,B){A.rasterInfo||await A.open({signal:B});this._primaryRasters="Function"===A.datasetFormat?A.primaryRasters.rasters:[A];this.url||(this.url=this._primaryRasters[0].url)}async _openFromUrlWithRasterFunction(A,B,Q){A=[A];B&&D.getPrimaryRasterUrls(B.toJSON(),
A);const O=await Promise.all(A.map(M=>H.open({url:M,sourceJSON:this.sourceJSON,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},signal:Q}))),C=O.findIndex(M=>null==M);if(-1<C)throw new E("imagery-tile-layer:open",`cannot open raster: ${A[C]}`);this._primaryRasters=O;return this._initializeWithFunctionRaster(B)}async _openFromUrl(A,B){B=await H.open({url:A,sourceJSON:this.sourceJSON,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},
signal:B});if(null==B)throw new E("imagery-tile-layer:open",`cannot open raster: ${A}`);this._primaryRasters=[B];this.raster=B}async _openFromSource(A,B){const Q="coverage"===A.type?.toLowerCase()?"CovJSON":A.extent&&A.pixelBlock?"MEMORY":null;if(!Q)throw new E("imagery-tile-layer:open","the tiled imagery data source is not supported");"MEMORY"===Q&&(A={extent:A.extent,pixelBlocks:[A.pixelBlock]});A=await H.open({url:"",source:A,datasetFormat:Q,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},
signal:B});if(null==A)throw new E("imagery-tile-layer:open","the tiled imagery data source is not supported");this._primaryRasters=[A];this.rasterFunction?await this._initializeWithFunctionRaster(this.rasterFunction):this.raster=A}async _openFunctionRaster(A,B){const Q={raster:this._primaryRasters[0]};1<this._primaryRasters.length&&this._primaryRasters.forEach(O=>Q[O.url]=O);A=D.create(A.functionDefinition?.toJSON()??A.toJSON(),Q);A=new K({rasterFunction:A});await A.open(B);return A}async _initializeWithFunctionRaster(A,
B){try{this.raster=await this._openFunctionRaster(A,B)}catch(Q){Q instanceof E&&T.getLogger(this).error("imagery-tile-layer:open",Q.message),T.getLogger(this).warn("imagery-tile-layer:open","the raster function cannot be applied and is removed"),this._set("rasterFunction",null),this.raster=this._primaryRasters[0]}}};v.__decorate([p.property({clonable:!1})],L.prototype,"_primaryRasters",void 0);v.__decorate([p.property({type:[u.Integer],json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===
this.raster.tileType||"0,1,2"!==this.bandIds?.join(",")}}}}})],L.prototype,"bandIds",void 0);v.__decorate([p.property({json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),k.enumeration(y.interpolationKebab)],L.prototype,"interpolation",void 0);v.__decorate([p.property(r.legendEnabled)],L.prototype,"legendEnabled",void 0);v.__decorate([p.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],
L.prototype,"isReference",void 0);v.__decorate([p.property({type:["show","hide"]})],L.prototype,"listMode",void 0);v.__decorate([p.property({json:{read:!0,write:!0}})],L.prototype,"blendMode",void 0);v.__decorate([p.property()],L.prototype,"sourceJSON",void 0);v.__decorate([p.property({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],L.prototype,"version",void 0);v.__decorate([p.property({readOnly:!0,json:{read:!1}})],L.prototype,"type",void 0);v.__decorate([p.property({type:["ArcGISTiledImageServiceLayer"]})],
L.prototype,"operationalLayerType",void 0);v.__decorate([p.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(A,B){return!B.disablePopup}},write:{target:"disablePopup",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer(A,B,Q){B[Q]=!A}}}})],L.prototype,"popupEnabled",void 0);v.__decorate([p.property({type:w,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],
L.prototype,"popupTemplate",void 0);v.__decorate([p.property({readOnly:!0})],L.prototype,"defaultPopupTemplate",null);v.__decorate([p.property({readOnly:!0,type:[z]})],L.prototype,"fields",void 0);v.__decorate([p.property({readOnly:!0,type:[z]})],L.prototype,"rasterFields",null);v.__decorate([p.property({constructOnly:!0})],L.prototype,"source",void 0);return L=v.__decorate([n.subclass("esri.layers.ImageryTileLayer")],L)});