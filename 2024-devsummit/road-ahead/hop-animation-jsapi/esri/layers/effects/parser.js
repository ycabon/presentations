// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../colorUtils ../../core/Error ./effects ../../chunks/_commonjsHelpers ./utils".split(" "),function(Y,P,A,J,Ca,Z){function aa(f){let h;if(!f)return[];try{h=Da.parse(f)}catch(r){throw new A("effect:invalid-syntax","Invalid effect syntax",{value:f,error:r});}return h.map(r=>Ea(r))}function Ea(f){try{switch(f.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var h=1;K(f.parameters,1);1===f.parameters.length&&(h=E(f.parameters[0]));
return new J.ColorMatrixEffect(f.name,h);case "opacity":return h=1,K(f.parameters,1),1===f.parameters.length&&(h=E(f.parameters[0])),new J.OpacityEffect(h);case "hue-rotate":h=0;K(f.parameters,1);if(1===f.parameters.length){var r=f.parameters[0];if("quantity"!==r.type||!(0===r.value&&null===r.unit||r.unit&&null!=S[r.unit]))throw new A("effect:type-error",`Expected <angle>, Actual: ${Q(r)}`,{term:r});h=r.value*S[r.unit]||0}return new J.HueRotateEffect(h);case "blur":return h=0,K(f.parameters,1),1===
f.parameters.length&&(h=T(f.parameters[0]),L(h,f.parameters[0])),new J.BlurEffect(h);case "drop-shadow":const q=[];let y=null;for(const C of f.parameters)if("color"===C.type){q.length&&Object.freeze(q);if(y)throw new A("effect:type-error","Accepts only one color",{});a:{r=void 0;var e=C;switch(e.colorType){case "hex":y=P.hex2rgba(e.value);break a;case "named":y=ba(e.value);break a;case "function":h=e.value;K(h.parameters,4);if(Fa.test(h.name))r=[E(h.parameters[0]),E(h.parameters[1]),E(h.parameters[2]),
h.parameters[3]?E(h.parameters[3]):1];else if(Ga.test(h.name)){e=P;var p=e.hsla2rgba,n=h.parameters[0],u=n;if("quantity"!==u.type||null!==u.unit)throw new A("effect:type-error",`Expected <double>, Actual: ${Q(u)}`,{term:u});L(n.value,n);r=p.call(e,n.value,E(h.parameters[1]),E(h.parameters[2]),h.parameters[3]?E(h.parameters[3]):1)}else throw new A("effect:syntax-error",`Invalid color function '${h.name}'`,{colorFunction:h});y=r;break a}y=void 0}}else{const g=T(C);if(Object.isFrozen(q))throw new A("effect:type-error",
"\x3clength\x3e parameters not consecutive",{lengths:q});q.push(g);3===q.length&&L(g,C)}if(2>q.length||3<q.length)throw new A("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${q.length}}`,{lengths:q});return new J.DropShadowEffect(q[0],q[1],q[2]||0,y||ba("black"));case "bloom":return h=1,n=p=0,K(f.parameters,3),f.parameters[0]&&(h=E(f.parameters[0])),f.parameters[1]&&(p=T(f.parameters[1]),L(p,f.parameters[1])),f.parameters[2]&&(n=E(f.parameters[2])),new J.BloomEffect(h,p,n)}}catch(q){throw q.details.filter=
f,q;}throw new A("effect:unknown-effect",`Effect '${f.name}' is not supported`,{effect:f});}function K(f,h){if(f.length>h)throw new A("effect:type-error",`Function supports up to ${h} parameters, Actual: ${f.length}`,{parameters:f});}function Q(f){if("color"===f.type)return"\x3ccolor\x3e";if(f.unit){if(f.unit in U)return"\x3clength\x3e";if(f.unit in S)return"\x3cangle\x3e";if("%"===f.unit)return"\x3cpercentage\x3e"}return"\x3cdouble\x3e"}function L(f,h){if(0>f)throw new A("effect:type-error",`Negative values are not allowed, Actual: ${f}`,
{term:h});}function E(f){if("quantity"!==f.type||null!==f.unit&&"%"!==f.unit)throw new A("effect:type-error",`Expected <double> or <percentage>, Actual: ${Q(f)}`,{term:f});const h=f.value;L(h,f);return"%"===f.unit?.01*h:h}function T(f){if("quantity"!==f.type||!(0===f.value&&null===f.unit||f.unit&&null!=U[f.unit]))throw new A("effect:type-error",`Expected <length>, Actual: ${Q(f)}`,{term:f});return f.value*U[f.unit]||0}function ba(f){if(!P.isNamedColor(f))throw new A("effect:unknown-color",`color '${f}' isn't valid`,
{namedColor:f});return P.getNamedColorCopy(f)}var ca={exports:{}};(function(f){(function(h,r){f.exports&&(f.exports=r())})(Ca.commonjsGlobal,function(){function h(e,p,n,u){e=Error.call(this,e);Object.setPrototypeOf&&Object.setPrototypeOf(e,h.prototype);e.expected=p;e.found=n;e.location=u;e.name="SyntaxError";return e}function r(e,p,n){n=n||" ";if(e.length>p)return e;p-=e.length;n+=n.repeat(p);return e+n.slice(0,p)}(function(e,p){function n(){this.constructor=e}n.prototype=p.prototype;e.prototype=
new n})(h,Error);h.prototype.format=function(e){var p="Error: "+this.message;if(this.location){var n=null,u;for(u=0;u<e.length;u++)if(e[u].source===this.location.source){n=e[u].text.split(/\r\n|\n|\r/g);break}e=this.location.start;u=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(e):e;var q=this.location.source+":"+u.line+":"+u.column;if(n){var y=this.location.end,C=r("",u.line.toString().length," ");n=n[e.line-1];y=(e.line===y.line?y.column:n.length+
1)-e.column||1;p+="\n --\x3e "+q+"\n"+C+" |\n"+u.line+" | "+n+"\n"+C+" | "+r("",e.column-1," ")+r("",y,"^")}else p+="\n at "+q}return p};h.buildMessage=function(e,p){function n(g){return g.charCodeAt(0).toString(16).toUpperCase()}function u(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function q(g){return g.replace(/\\/g,
"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function y(g){return C[g.type](g)}var C={literal:function(g){return'"'+u(g.text)+'"'},class:function(g){var w=g.parts.map(function(B){return Array.isArray(B)?q(B[0])+"-"+q(B[1]):q(B)});return"["+(g.inverted?"^":"")+w.join("")+"]"},
any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};return"Expected "+function(g){g=g.map(y);var w,B;g.sort();if(0<g.length){for(B=w=1;w<g.length;w++)g[w-1]!==g[w]&&(g[B]=g[w],B++);g.length=B}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}(e)+" but "+(p?'"'+u(p)+'"':"end of input")+" found."};return{SyntaxError:h,parse:function(e,p){function n(k,a){return{type:"literal",
text:k,ignoreCase:a}}function u(k,a,d){return{type:"class",parts:k,inverted:a,ignoreCase:d}}function q(k){return{type:"other",description:k}}function y(k){var a=R[k],d;if(!a){for(d=k-1;!R[d];)d--;a=R[d];for(a={line:a.line,column:a.column};d<k;)10===e.charCodeAt(d)?(a.line++,a.column=1):a.column++,d++;R[k]=a}return a}function C(k,a,d){var l=y(k),z=y(a);k={source:M,start:{offset:k,line:l.line,column:l.column},end:{offset:a,line:z.line,column:z.column}};d&&M&&"function"===typeof M.offset&&(k.start=M.offset(k.start),
k.end=M.offset(k.end));return k}function g(k){c<F||(c>F&&(F=c,V=[]),V.push(k))}function w(){m++;var k=c;x();if(e.substr(c,4)===da){var a=da;c+=4}else a=b,0===m&&g(Ha);a!==b?(x(),t=k,k=[]):(c=k,k=b);m--;k===b&&0===m&&g(Ia);if(k===b)if(k=[],a=B(),a!==b)for(;a!==b;)k.push(a),a=B();else k=b;return k}function B(){var k=c;x();m++;var a=c;var d=ea();if(d!==b){if(40===e.charCodeAt(c)){var l=Ja;c++}else l=b,0===m&&g(Ka);l!==b?(t=a,a=d):(c=a,a=b)}else c=a,a=b;m--;a===b&&(d=b,0===m&&g(La));if(a!==b){x();d=c;
l=W();if(l!==b){var z=[];var v=c;var N=x();if(44===e.charCodeAt(c)){var G=fa;c++}else G=b,0===m&&g(ha);G===b&&(G=null);var X=x();var O=W();O!==b?v=N=[N,G,X,O]:(c=v,v=b);for(;v!==b;)z.push(v),v=c,N=x(),44===e.charCodeAt(c)?(G=fa,c++):(G=b,0===m&&g(ha)),G===b&&(G=null),X=x(),O=W(),O!==b?v=N=[N,G,X,O]:(c=v,v=b);t=d;d=0<z.length?[l].concat(Ma(z,3)):[l]}else c=d,d=b;d===b&&(d=null);x();41===e.charCodeAt(c)?(l=Na,c++):(l=b,0===m&&g(Oa));l!==b?(x(),t=k,k={type:"function",name:a,parameters:d||[]}):(c=k,k=
b)}else c=k,k=b;return k}function W(){var k=c;m++;var a=c;x();var d=D();if(d!==b){if(37===e.charCodeAt(c)){var l=Pa;c++}else l=b,0===m&&g(Qa);l!==b?(t=a,a={value:d,unit:"%"}):(c=a,a=b)}else c=a,a=b;m--;a===b&&0===m&&g(Ra);a===b&&(m++,a=c,x(),d=D(),d!==b?(e.substr(c,2)===ia?(l=ia,c+=2):(l=b,0===m&&g(Sa)),l!==b?(t=a,a={value:d,unit:"px"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ja?(l=ja,c+=2):(l=b,0===m&&g(Ta)),l!==b?(t=a,a={value:d,unit:"cm"}):(c=a,a=b)):(c=a,a=b),a===b&&
(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ka?(l=ka,c+=2):(l=b,0===m&&g(Ua)),l!==b?(t=a,a={value:d,unit:"mm"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===la?(l=la,c+=2):(l=b,0===m&&g(Va)),l!==b?(t=a,a={value:d,unit:"in"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ma?(l=ma,c+=2):(l=b,0===m&&g(Wa)),l!==b?(t=a,a={value:d,unit:"pt"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===na?(l=na,c+=2):(l=b,0===m&&g(Xa)),l!==b?(t=a,a={value:d,unit:"pc"}):
(c=a,a=b)):(c=a,a=b)))))),m--,a===b&&0===m&&g(Ya),a===b&&(m++,a=c,d=D(),d!==b?(e.substr(c,3)===oa?(l=oa,c+=3):(l=b,0===m&&g(Za)),l!==b?(t=a,a={value:d,unit:"deg"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,3)===pa?(l=pa,c+=3):(l=b,0===m&&g($a)),l!==b?(t=a,a={value:d,unit:"rad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,4)===qa?(l=qa,c+=4):(l=b,0===m&&g(ab)),l!==b?(t=a,a={value:d,unit:"grad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,4)===ra?(l=ra,c+=
4):(l=b,0===m&&g(bb)),l!==b?(t=a,a={value:d,unit:"turn"}):(c=a,a=b)):(c=a,a=b)))),m--,a===b&&(d=b,0===m&&g(cb)),a===b&&(m++,a=c,x(),d=D(),d!==b?(t=a,a={value:d,unit:null}):(c=a,a=b),m--,a===b&&0===m&&g(db))));a!==b&&(t=k,a={type:"quantity",value:a.value,unit:a.unit});k=a;if(k===b){k=c;m++;a=c;35===e.charCodeAt(c)?(d=eb,c++):(d=b,0===m&&g(fb));if(d!==b){d=[];sa.test(e.charAt(c))?(l=e.charAt(c),c++):(l=b,0===m&&g(ta));if(l!==b)for(;l!==b;)d.push(l),sa.test(e.charAt(c))?(l=e.charAt(c),c++):(l=b,0===
m&&g(ta));else d=b;d!==b?(t=a,a={type:"hex",value:e.substring(t,c)}):(c=a,a=b)}else c=a,a=b;a===b&&(a=c,d=B(),d!==b&&(t=a,d={type:"function",value:d}),a=d,a===b&&(a=c,d=ea(),d!==b&&(t=a,d={type:"named",value:e.substring(t,c)}),a=d));m--;a===b&&(d=b,0===m&&g(gb));a!==b&&(t=k,a={type:"color",colorType:a.type,value:a.value});k=a}return k}function x(){m++;var k=[];if(ua.test(e.charAt(c))){var a=e.charAt(c);c++}else a=b,0===m&&g(va);for(;a!==b;)k.push(a),ua.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===
m&&g(va));m--;a=b;0===m&&g(hb);return k}function ea(){m++;var k=c;var a=[];if(wa.test(e.charAt(c))){var d=e.charAt(c);c++}else d=b,0===m&&g(xa);if(d!==b)for(;d!==b;)a.push(d),wa.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===m&&g(xa));else a=b;a!==b&&(t=k,a=e.substring(t,c));k=a;m--;k===b&&(a=b,0===m&&g(ib));return k}function D(){var k=c;ya.test(e.charAt(c))?(e.charAt(c),c++):0===m&&g(za);var a=c;var d=[];if(H.test(e.charAt(c))){var l=e.charAt(c);c++}else l=b,0===m&&g(I);for(;l!==b;)d.push(l),H.test(e.charAt(c))?
(l=e.charAt(c),c++):(l=b,0===m&&g(I));46===e.charCodeAt(c)?(l=jb,c++):(l=b,0===m&&g(kb));if(l!==b){var z=[];if(H.test(e.charAt(c))){var v=e.charAt(c);c++}else v=b,0===m&&g(I);if(v!==b)for(;v!==b;)z.push(v),H.test(e.charAt(c))?(v=e.charAt(c),c++):(v=b,0===m&&g(I));else z=b;z!==b?a=d=[d,l,z]:(c=a,a=b)}else c=a,a=b;if(a===b)if(a=[],H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===m&&g(I)),d!==b)for(;d!==b;)a.push(d),H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===m&&g(I));else a=b;if(a!==b){d=c;101===
e.charCodeAt(c)?(l=lb,c++):(l=b,0===m&&g(mb));if(l!==b){ya.test(e.charAt(c))?(z=e.charAt(c),c++):(z=b,0===m&&g(za));z===b&&(z=null);v=[];H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===m&&g(I));if(a!==b)for(;a!==b;)v.push(a),H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===m&&g(I));else v=b;v!==b?d=l=[l,z,v]:(c=d,d=b)}else c=d,d=b;d===b&&(d=null);t=k;k=parseFloat(e.substring(t,c))}else c=k,k=b;return k}function Ma(k,a){return k.map(function(d){return d[a]})}p=void 0!==p?p:{};var b={},M=p.grammarSource,
Aa={start:w},Ba=w,da="none",Na=")",fa=",",Ja="(",Pa="%",ia="px",ja="cm",ka="mm",la="in",ma="pt",na="pc",oa="deg",pa="rad",qa="grad",ra="turn",eb="#",jb=".",lb="e",ua=/^[ \t\n\r]/,wa=/^[a-z\-]/,sa=/^[0-9a-fA-F]/,ya=/^[+\-]/,H=/^[0-9]/,Ia=q("none"),Ha=n("none",!1),Oa=n(")",!1),ha=n(",",!1),hb=q("whitespace"),va=u([" ","\t","\n","\r"],!1,!1),La=q("function"),Ka=n("(",!1),ib=q("identifier"),xa=u([["a","z"],"-"],!1,!1),Ra=q("percentage"),Qa=n("%",!1),Ya=q("length"),Sa=n("px",!1),Ta=n("cm",!1),Ua=n("mm",
!1),Va=n("in",!1),Wa=n("pt",!1),Xa=n("pc",!1),cb=q("angle"),Za=n("deg",!1),$a=n("rad",!1),ab=n("grad",!1),bb=n("turn",!1),db=q("number"),gb=q("color"),fb=n("#",!1),ta=u([["0","9"],["a","f"],["A","F"]],!1,!1),za=u(["+","-"],!1,!1),I=u([["0","9"]],!1,!1),kb=n(".",!1),mb=n("e",!1),c=0,t=0,R=[{line:1,column:1}],F=0,V=[],m=0;if("startRule"in p){if(!(p.startRule in Aa))throw Error("Can't start parsing from rule \""+p.startRule+'".');Ba=Aa[p.startRule]}p=Ba();if(p!==b&&c===e.length)return p;p!==b&&c<e.length&&
g({type:"end"});throw function(k,a,d){return new h(h.buildMessage(k,a),k,a,d)}(V,F<e.length?e.charAt(F):null,F<e.length?C(F,F+1):C(F,F));}}})})(ca);var Da=ca.exports;const S={deg:1,grad:.9,rad:180/Math.PI,turn:360},U={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72},Fa=/^rgba?/i,Ga=/^hsla?/i;Y.parse=function(f){if(!f||0===f.length)return null;if("string"===typeof f)return(f=aa(f))&&0!==f.length?f:null;f=f.map(h=>{if(!Number.isFinite(h.scale)||0>=h.scale)throw new A("effect:invalid-scale","scale must be finite and greater than 0",
{stop:h});return{scale:h.scale,effects:aa(h.value)}});f.sort((h,r)=>r.effects.length-h.effects.length);for(let h=0;h<f.length-1;h++){if(!Z.canInterpolateEffects(f[h].effects,f[h+1].effects))throw new A("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:f[h].effects,b:f[h+1].effects});Z.normalizeEffects(f[h].effects,f[h+1].effects)}f.sort((h,r)=>r.scale-h.scale);return f};Object.defineProperty(Y,Symbol.toStringTag,{value:"Module"})});