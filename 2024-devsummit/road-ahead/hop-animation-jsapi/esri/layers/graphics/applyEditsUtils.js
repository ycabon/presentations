// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../Graphic ../../core/Error ../../core/Logger ../../core/unitUtils ../../core/urlUtils ../../geometry/projection ../../geometry/support/jsonUtils ./editingSupport".split(" "),function(f,x,y,r,t,z,u,A,v){async function w(b,a){const {feature:c,attachment:d}=a,{globalId:e,name:l,contentType:m,data:g,uploadId:k}=d;a={globalId:e};c&&("attributes"in c?a.parentGlobalId=c.attributes?.[b.globalIdField]:c.globalId&&(a.parentGlobalId=c.globalId));if(k)a.uploadId=k;else if(g){if(b=await z.parseData(g))a.contentType=
b.mediaType,a.data=b.data;g instanceof File&&(a.name=g.name)}l&&(a.name=l);m&&(a.contentType=m);return a}function h(b){const a=!0===b.success?null:b.error||{code:void 0,description:void 0};return{objectId:b.objectId,globalId:b.globalId,error:a?new y("feature-layer-source:edit-failure",a.description,{code:a.code}):null}}function n(b,a){return new x({attributes:b.attributes,geometry:A.fromJSON({...b.geometry,spatialReference:a})})}f.createEditedFeatures=function(b,a){return{adds:b?.adds?.map(c=>n(c,
a))||[],updates:b?.updates?.map(c=>({original:n(c[0],a),current:n(c[1],a)}))||[],deletes:b?.deletes?.map(c=>n(c,a))||[],spatialReference:a}};f.createFeatureEditResult=h;f.getAttachmentEditsJSON=async function(b,a){const c=await Promise.all((a.addAttachments??[]).map(e=>w(b,e))),d=await Promise.all((a.updateAttachments??[]).map(e=>w(b,e)));a=a.deleteAttachments??[];return c.length||d.length||a.length?{adds:c,updates:d,deletes:[...a]}:null};f.getFeatureIds=function(b,a,c){if(!a||0===a.length)return[];
if(c&&v.isFeatureIdentifierArrayWithGlobalId(a))return a.map(e=>e.globalId);if(v.isFeatureIdentifierArrayWithObjectId(a))return a.map(e=>e.objectId);const d=c?b.globalIdField:b.objectIdField;return d?a.map(e=>e.getAttribute(d)):[]};f.getFeatureJSON=async function(b,a,c){var {geometry:d}=a;a={...a.attributes};if(null!=c&&"mesh"===d?.type){({transformFieldRoles:c}=c);const {origin:e,spatialReference:l,transform:m}=d;b=b.spatialReference;await u.initializeProjection(l,b);const g=u.project(e,b);a[c.originX]=
g.x;a[c.originY]=g.y;a[c.originZ]=g.z??0;if(null!=m){const {translation:k,scale:q,rotation:p}=m;({vertexSpace:d}=d);d="georeferenced"===d.type?1:t.getMetersPerCartesianUnitForSR(l)/t.getMetersPerCartesianUnitForSR(b);a[c.translationX]=k[0]*d;a[c.translationY]=k[2]*d;a[c.translationZ]=-k[1]*d;a[c.scaleX]=q[0];a[c.scaleY]=q[2];a[c.scaleZ]=q[1];a[c.rotationX]=p[0];a[c.rotationY]=p[2];a[c.rotationZ]=-p[1];a[c.rotationDeg]=p[3]}return{attributes:a}}return null==d?{attributes:a}:"mesh"===d.type||"extent"===
d.type?null:{geometry:d.toJSON(),attributes:a}};f.isProtectedOrPrivateVersionError=function(b){b=b.details.raw;const a=+b.extendedCode;return 500===+b.code&&(-2147217144===a||-2147467261===a)};f.unpackEditResultData=function(b){var a=b?.assetMaps;if(a){for(const c of a.addResults)c.success||r.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`);for(const c of a.updateResults)c.success||r.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`)}a=
b?.attachments;a={addFeatureResults:b?.addResults?.map(h)??[],updateFeatureResults:b?.updateResults?.map(h)??[],deleteFeatureResults:b?.deleteResults?.map(h)??[],addAttachmentResults:a?.addResults?a.addResults.map(h):[],updateAttachmentResults:a?.updateResults?a.updateResults.map(h):[],deleteAttachmentResults:a?.deleteResults?a.deleteResults.map(h):[]};b?.editMoment&&(a.editMoment=b.editMoment);return a};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});