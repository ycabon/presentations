// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(e,f,g,h){function k(a,b,c){d.minX=b[0];d.minY=b[1];d.maxX=b[2];d.maxY=b[3];a.search(d,c)}const d={minX:0,minY:0,maxX:0,maxY:0};class l{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new g.PooledRBush(9,f("esri-csp-restrictions")?a=>({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}):["[0]","[1]","[2]","[3]"]);
this._loadIndex=()=>{if(this._indexInvalid){const a=Array(this._idByBounds.size);let b=0;this._idByBounds.forEach((c,m)=>{a[b++]=m});this._indexInvalid=!1;this._index.clear();this._index.load(a)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(a=>this._idByBounds.has(a))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const a=h.empty();for(const b of this._boundsById.values())b&&(a[0]=Math.min(b[0],a[0]),a[1]=Math.min(b[1],
a[1]),a[2]=Math.max(b[2],a[2]),a[3]=Math.max(b[3],a[3]));return a}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(a){const b=this._boundsById.get(a);this._boundsById.delete(a);b&&(this._idByBounds.delete(b),this._indexInvalid||this._index.remove(b))}forEachInBounds(a,b){this._loadIndex();k(this._index,a,c=>b(this._idByBounds.get(c)))}get(a){return this._boundsById.get(a)}has(a){return this._boundsById.has(a)}invalidateIndex(){this._indexInvalid||
(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(a,b){if(!this._indexInvalid){const c=this._boundsById.get(a);c&&(this._index.remove(c),this._idByBounds.delete(c))}this._boundsById.set(a,b);b&&(this._idByBounds.set(b,a),this._indexInvalid||(this._boundsToLoad.push(b),5E4<this._boundsToLoad.length&&this._loadIndex()))}}e.BoundsStore=l;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});