// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(f,u,v,h,m,e,g){function n(c,a){if(!a)return null;if("x"in a){var b={x:0,y:0};[b.x,b.y]=c(a.x,a.y,k);null!=a.z&&(b.z=a.z);null!=a.m&&(b.m=a.m);return b}return"xmin"in a?(b={xmin:0,ymin:0,xmax:0,ymax:0},[b.xmin,b.ymin]=c(a.xmin,a.ymin,k),[b.xmax,b.ymax]=
c(a.xmax,a.ymax,k),a.hasZ&&(b.zmin=a.zmin,b.zmax=a.zmax,b.hasZ=!0),a.hasM&&(b.mmin=a.mmin,b.mmax=a.mmax,b.hasM=!0),b):"rings"in a?{rings:p(a.rings,c),hasM:a.hasM,hasZ:a.hasZ}:"paths"in a?{paths:p(a.paths,c),hasM:a.hasM,hasZ:a.hasZ}:"points"in a?{points:q(a.points,c),hasM:a.hasM,hasZ:a.hasZ}:null}function p(c,a){const b=[];for(const d of c)b.push(q(d,a));return b}function q(c,a){const b=[];for(const d of c)c=a(d[0],d[1],[0,0]),b.push(c),2<d.length&&c.push(d[2]),3<d.length&&c.push(d[3]);return b}const k=
[0,0],r=n.bind(null,g.lngLatToXY),t=n.bind(null,g.xyToLngLat);class w{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(c,a,b,d){if(!c?.length||!a||!b||e.equals(a,b))return c;c={geometries:c,inSpatialReference:a,outSpatialReference:b,geographicTransformation:d,resolve:v.createResolver()};this._jobs.push(c);this._timer??(this._timer=setTimeout(this._process,10));return c.resolve.promise}_process(){this._timer=null;const c=this._jobs.shift();if(c){var {geometries:a,
inSpatialReference:b,outSpatialReference:d,resolve:l,geographicTransformation:x}=c;g.canProject(b,d)?e.isWebMercator(d)?l(a.map(r)):l(a.map(t)):l(h.projectMany(m.jsonAdapter,a,b,d,x,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const y=new w;f.checkProjectionSupport=async function(c,a){c&&a&&(c=Array.isArray(c)?c.map(b=>null!=b.geometry?b.geometry.spatialReference:null).filter(u.isSome):[c],await h.initializeProjection(c.map(b=>({source:b,dest:a}))))};f.project=function(c,
a,b,d){if(!c)return c;b||(b=a,a=c.spatialReference);return e.isValid(a)&&e.isValid(b)&&!e.equals(a,b)?g.canProject(a,b)?(c=e.isWebMercator(b)?r(c):t(c),c.spatialReference=b,c):h.projectMany(m.jsonAdapter,[c],a,b,null,d)[0]:c};f.projectMany=function(c,a,b,d){return y.push(c,a,b,d)};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});