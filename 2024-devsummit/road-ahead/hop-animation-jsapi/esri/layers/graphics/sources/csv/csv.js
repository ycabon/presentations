// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/date","../../../../core/number","../../../support/fieldUtils"],function(l,C,D,m){function*r(a,d,b){let c=0;for(;c<=a.length;){var e=a.indexOf(d,c);e=a.substring(c,-1<e?e:void 0);c+=e.length+d.length;if(!b||e.trim())yield e}}function t(a){const d=a.includes("\r\n")?"\r\n":"\n";return r(a,d,!0)}function p(a,d){return r(a,d,!1)}function*u(a,d,b,c=()=>Object.create(null)){var e=t(a);e.next();var f="";a="";let g=0,h=c(),k=0;a:for(const q of e){e=p(q,b);for(const v of e)if(f+=
a+v,a="",g+=w(v),0===g%2){if(0<g)if(f=x.exec(f))h[d[k]]=f[1].replaceAll(y,'"'),k++;else{h=c();k=0;f="";g=0;continue a}else h[d[k]]=f,k++;f="";g=0}else a=b;0===g?(yield h,h=c(),k=0):a="\n"}}function z(a,d){a=n(a,d).filter(b=>null!=b);d=a.map(b=>m.normalizeFieldName(b));for(let b=d.length-1;0<=b;b--)d[b]||(d.splice(b,1),a.splice(b,1));return{names:d,aliases:a}}function n(a,d){if(!a?.length)return[];const b=[];var c="";let e="",f=0;a=p(a,d);for(const g of a)c+=e+g,e="",f+=w(g),0===f%2?(0<f?(c=x.exec(c))&&
b.push(c[1].replaceAll(y,'"')):b.push(c),c="",f=0):e=d;return b}function w(a){let d=0,b;for(b=a.indexOf('"',0);0<=b;)d++,b=a.indexOf('"',b+1);return d}function E(a,d,b){d=m.normalizeFieldName(d)?.toLowerCase();b=m.normalizeFieldName(b)?.toLowerCase();const c=a.map(e=>e.toLowerCase());d=d?a[c.indexOf(d)]:null;b=b?a[c.indexOf(b)]:null;return{longitudeFieldName:d||a[c.indexOf(F.find(e=>c.includes(e)))],latitudeFieldName:b||a[c.indexOf(G.find(e=>c.includes(e)))]}}function A(a){if(!a.length)return"string";
const d=/[^+\-.,0-9]/;return a.map(b=>{if(""!==b){if(!d.test(b)){let c=B(b);if(!isNaN(c))return/[.,]/.test(b)||!Number.isInteger(c)||214783647<c||-214783648>c?"double":"integer";if(b.includes("E"))if(c=Number(b),Number.isNaN(c)){if(b.includes(",")&&(b=b.replace(",","."),c=Number(b),!Number.isNaN(c)))return"double"}else return"double"}return C.isDateString(b)?"date":"string"}}).reduce((b,c)=>{if(void 0===b)return c;if(void 0===c)return b;if(b===c)return c;if("string"===b||"string"===c)return"string";
if("double"===b||"double"===c)return"double"})}const x=/^\s*"([\S\s]*)"\s*$/,y=/""/g,H=[","," ",";","|","\t"],B=function(){const a=D._parseInfo(),d=new RegExp("^"+a.regexp+"$"),b=new RegExp("["+a.group+"\\s\\xa0]","g"),c=a.factor;return e=>{e=d.exec(e);a.factor=c;if(!e)return NaN;let f=e[1];if(!e[1]){if(!e[2])return NaN;f=e[2];a.factor*=-1}f=f.replace(b,"").replace(a.decimal,".");return+f*a.factor}}(),G="lat latitude latitude83 latdecdeg lat_dd y ycenter point_y".split(" "),F="lon lng long longitude longitude83 longdecdeg long_dd x xcenter point_x".split(" ");
l.extractFieldNamesAndAliasesFromRow=z;l.inferDelimiterAndLocationInfo=function(a,d,b){a=a.trim();d=d?.trim();var c=[],e=Array.from(new Set([b?.delimiter,...H])).filter(f=>null!=f);for(const f of e){e=n(a,f).length;const g=n(d,f).length??e;1<e&&c.push({weight:Math.min(e,g),delimiter:f})}d=c.sort(({weight:f},{weight:g})=>g-f).map(({delimiter:f})=>f);for(const f of d)if(c=z(a,f).names,c=E(c,b?.longitudeField,b?.latitudeField),c.longitudeFieldName&&c.latitudeFieldName)return{delimiter:f,locationInfo:c};
return{delimiter:d[0],locationInfo:null}};l.inferFieldType=A;l.inferFields=function(a,d,b,c,e){const f=[];d=u(a,b,d);a=[];for(var g of d){if(10===a.length)break;a.push(g)}for(g=0;g<b.length;g++){const k=b[g];d=c[g];if(k===e.longitudeFieldName||k===e.latitudeFieldName)f.push({name:k,type:"esriFieldTypeDouble",alias:d});else{var h=a.map(q=>q[k]);switch(A(h)){case "integer":h="esriFieldTypeInteger";break;case "double":h="esriFieldTypeDouble";break;case "date":h="esriFieldTypeDate";break;default:h="esriFieldTypeString"}f.push({name:k,
type:h,alias:d,length:m.getFieldDefaultLength(h)})}}return f};l.parseNumber=B;l.parseRows=u;l.readRowParts=p;l.readRows=t;l.splitSingleRow=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});