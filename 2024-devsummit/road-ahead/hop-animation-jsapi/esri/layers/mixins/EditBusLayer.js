// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/tslib.es6 ../../core/Evented ../../core/lang ../../core/promiseUtils ../../core/Logger ../../core/has ../../core/Error ../../core/accessorSupport/decorators/subclass ../../versionManagement/support/versionManagementUtils".split(" "),function(f,D,E,l,F,J,K,L,G,w){function x(a){return n.on("apply-edits",new WeakRef(a))}function y(a){return n.on("update-moment",new WeakRef(a))}function k(a){return null!=a&&"object"===typeof a&&"gdbVersion"in a}function p(a,d,g){a=(new URL(a)).host;
a=w.defaultVersionNameLookup.get(a);return(!d||d===a)&&(!g||g===a)||d===g}const n=new E.EventEmitter,z=Symbol("esri.layers.mixins.EditBusLayer");f.EditBusLayer=a=>{a=class extends a{constructor(...g){super(...g);this[d]=!0;this._applyEditsHandler=c=>{const {serviceUrl:e,layerId:q,gdbVersion:m,mayReceiveServiceEdits:u,result:v}=c;c=e===this.url;const r=null!=q&&null!=this.layerId&&q===this.layerId,H=k(this),I=k(this)&&p(e,m,this.gdbVersion);!c||H&&!I||!r&&!u||(c=v.then(b=>{if(r&&(b.addedFeatures.length||
b.updatedFeatures.length||b.deletedFeatures.length||b.addedAttachments.length||b.updatedAttachments.length||b.deletedAttachments.length))return this.emit("edits",l.clone(b)),b;const A=b.editedFeatures?.find(({layerId:t})=>t===this.layerId);if(A){const {adds:t,updates:B,deletes:C}=A.editedFeatures;b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map(({attributes:h})=>({objectId:this.objectIdField&&h[this.objectIdField],globalId:this.globalIdField&&h[this.globalIdField]})):
[],deletedFeatures:C?C.map(({attributes:h})=>({objectId:this.objectIdField&&h[this.objectIdField],globalId:this.globalIdField&&h[this.globalIdField]})):[],updatedFeatures:B?B.map(({current:{attributes:h}})=>({objectId:this.objectIdField&&h[this.objectIdField],globalId:this.globalIdField&&h[this.globalIdField]})):[],editedFeatures:l.clone(b.editedFeatures),exceededTransferLimit:!1,historicMoment:l.clone(b.historicMoment)};this.emit("edits",b);return b}return{edits:null,addedAttachments:[],deletedAttachments:[],
updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:l.clone(b.editedFeatures),exceededTransferLimit:!1,historicMoment:l.clone(b.historicMoment)}}).then(b=>{"historicMoment"in this&&this.historicMoment!==b.historicMoment&&w.isVersionInEditSession(e,m)&&(this.historicMoment=b.historicMoment);return b}),this.emit("apply-edits",{result:c}))};this._updateMomentHandler=c=>{const {serviceUrl:e,gdbVersion:q,moment:m}=c;c=e===this.url;const u=k(this),v=k(this)&&p(e,
q,this.gdbVersion),r=k(this)&&!p(e,this.gdbVersion,null);c&&u&&v&&r&&"historicMoment"in this&&this.historicMoment!==m&&(this.historicMoment=m)};this.when().then(()=>{this.addHandles(x(this._applyEditsHandler));"historicMoment"in this&&this.addHandles(y(this._updateMomentHandler))},()=>{})}};var d=z;return a=D.__decorate([G.subclass("esri.layers.mixins.EditBusLayer")],a)};f.emitApplyEditsEvent=function(a,d,g=null,c=!1){const e=F.createResolver();n.emit("apply-edits",{serviceUrl:a,layerId:d,gdbVersion:g,
mayReceiveServiceEdits:null==d?!0:c,result:e.promise});return e};f.emitUpdateMomentEvent=function(a,d,g=null,c){n.emit("update-moment",{serviceUrl:a,layerId:d,gdbVersion:g,moment:c})};f.isEditBusLayer=function(a){return null!=a&&"object"===typeof a&&z in a};f.isLayerWithGDBVersion=k;f.onApplyEditsEvent=x;f.onUpdateMomentEvent=y;f.versionMatches=p;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});