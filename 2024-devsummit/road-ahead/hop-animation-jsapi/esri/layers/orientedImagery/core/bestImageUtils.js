// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/support/Ellipsoid","../../../geometry/support/pointUtils","./ExposurePoint"],function(v,B,C,D){function E(c,a,q){a.z??(a.z=0);a.elevation??(a.elevation=0);return l=>{var e=l.attributes,m=c?"3d":"2d";e="isOblique"in e?e:new D(e);const {isOblique:F,isSpherical:G,isNadir:H}=e,{hfovWeight:w,vfovWeight:x,distanceWeight:y}=G?{hfovWeight:"2d"===m?0:1,vfovWeight:"2d"===m?0:.6,distanceWeight:"2d"===m?1:.5}:H?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:F?{hfovWeight:1,
vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1};var k=l.attributes;const {cameraHeight:u,cameraHeading:r,cameraPitch:t,farDistance:I,horizontalFieldOfView:z,verticalFieldOfView:A,isOblique:J}=k;var b=k.geometry;m=180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI;e=C.distance(a,b);var n=z,h=A;let f;var d=!1;if(c){f=c.heading;var g=c.tilt;h=n=180;d=!0}else!J||10>t?(f=r,g=t,d=!1):(f=q.attributes.cameraHeading,g=t,d=!0,n=180);180<f&&(f-=360);var p=1;b.spatialReference.isWebMercator&&
(p=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*b.y/B.earth.radius))));p=Math.sqrt((Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2)/p)**2+((a.z??0)-(a.elevation??0)-u)**2);b=90-180*Math.atan2(a.y-b.y,a.x-b.x)/Math.PI;n=(180<Math.abs(b-f)?Math.abs(360-Math.abs(b-f)):Math.abs(b-f))/n;k=180*Math.acos((k.cameraHeight-(a.z??0)+(a.elevation??0))/p)/Math.PI;g=Math.abs(k-g)/h;h=p/Math.sqrt(I**2+u**2);h=4*h+1;g=w*(4*n+1)+x*(4*g+1)+y*h;d?(d=180<r?r-360:r,d=w*((180<Math.abs(b-d)?Math.abs(360-Math.abs(b-d)):Math.abs(b-
d))/z*4+1)+x*(Math.abs(k-t)/A*4+1)+y*h):d=g;return{suitability:g,trueSuitability:d,feature:l,angle:m,distance:e,verticalAngle:Math.abs(180*Math.atan(e/u)/Math.PI)}}}v.calculateSuitabilities=function(c){const {camera:a,features:q,selectedPoint:l}=c;if(!q.length)return[];c.currentImage??(c.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});c=E(a,l,c.currentImage);return q.map(c)};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});