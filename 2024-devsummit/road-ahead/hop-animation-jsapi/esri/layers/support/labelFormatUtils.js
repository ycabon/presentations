// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(m,n,w,x,r,y,z,t,u,A){function v(a,e){if(null==a)return"";const g=e.domain;if(g)if("codedValue"===g.type||"coded-value"===g.type)for(var f of g.codedValues){if(f.code===a)return f.name}else if("range"===g.type){const {max:h,min:b}=z.getDomainRange(e);f=+a;if(null!=b&&null!=h&&b<=f&&f<=h)return g.name}t.isDateField(e)?
a=r.formatDate(a,r.convertDateFormatToIntlOptions("short-date")):t.isNumericField(e)&&(a=y.formatNumber(+a));return a||""}const p=()=>w.getLogger("esri.layers.support.labelFormatUtils"),q={type:"simple",evaluate(){return null}},B={getAttribute(a,e){return a.field(e)}};m.createLabelFunction=async function(a,e,g){if(!a||!a.symbol||!e)return q;const f=a.where,h=u.getLabelExpression(a);if("arcade"===h.type){const b=await A.createLabelExpression(h.expression,g,e);if(null==b)return q;a={type:"arcade",evaluate(d,
c){try{const k="attributes"in d?b.repurposeFeature(d):d;k.contextTimeZone=c??null;const l=b.evaluate({$view:{timeZone:c},$feature:k},b.services);if(null!=l)return l.toString()}catch(k){p().error(new n("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:k,feature:d,expression:h}))}return null},needsHydrationToEvaluate(){return null==u.getSingleFieldArcadeExpression(h.expression)}}}else a={type:"simple",evaluate(b){return h.expression.replaceAll(/{[^}]*}/g,
d=>{var c=d.slice(1,-1);c=e.get(c);if(!c)return d;d=null;"attributes"in b?b&&b.attributes&&(d=b.attributes[c.name]):d=b.field(c.name);return null==d?"":v(d,c)})}};if(f){let b;try{b=await x.parseWhereClause(f,e)}catch(c){return p().error(new n("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:f,error:c})),q}const d=a.evaluate;a.evaluate=(c,k)=>{const l="attributes"in c?void 0:B;try{if(b.testFeature(c,l))return d(c,k)}catch(C){p().error(new n("bad-where-clause",
"Encountered an error when evaluating where clause for feature",{where:f,feature:c,error:C}))}return null}}return a};m.formatField=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});