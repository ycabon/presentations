// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(function(){class f{constructor(a=15E3,b=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=a;this._interval=Math.min(a,b)}decreaseRefCount(a,b){a=a+"/"+b;b=this._cachedBlocks;if(b.has(a)){const c=b.get(a);c.refCount--;0>=c.refCount&&(b.delete(a),c.controller&&c.controller.abort());return c.refCount}return 0}getBlock(a,b){a=a+"/"+b;b=this._cachedBlocks;if(b.has(a)){const c=b.get(a);c.ts=Date.now();c.refCount++;b.delete(a);b.set(a,c);return c.block}return null}putBlock(a,
b,c,d){const e=this._cachedBlocks;a=a+"/"+b;e.has(a)?(c=e.get(a),c.ts=Date.now(),c.refCount++):e.set(a,{block:c,ts:Date.now(),refCount:1,controller:d});this._trim();this._updateTimer()}deleteBlock(a,b){const c=this._cachedBlocks;a=a+"/"+b;c.has(a)&&c.delete(a)}updateMaxSize(a){this._size=a;this._trim()}empty(){this._cachedBlocks.clear();this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null==this._timer){var a=this._cachedBlocks;this._timer=setInterval(()=>{const b=
Array.from(a),c=Date.now();for(let d=0;d<b.length;d++)if(b[d][1].ts<=c-this._duration)a.delete(b[d][0]);else break;0===a.size&&this._clearTimer()},this._interval)}}_trim(){const a=this._cachedBlocks;if(!(-1===this._size||this._size>=a.size)){var b=Array.from(a);for(let c=0;c<b.length-this._size;c++)a.delete(b[c][0])}}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}return f});