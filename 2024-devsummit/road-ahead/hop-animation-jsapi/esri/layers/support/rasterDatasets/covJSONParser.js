// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../Color ../../../geometry ../../../geometry/Extent ../../../intl/locale ../PixelBlock ../rasterFormats/pixelRangeUtils ../../../geometry/SpatialReference".split(" "),function(B,J,T,K,L,D,M,N){function F(a){return["x","e","east","long","longitude"].includes(a.toLowerCase())}function G(a){return["y","n","west","lat","latitude"].includes(a.toLowerCase())}function O(a){const {axes:f}=a.domain,m=Object.keys(f);var n=[];const k=[];let g=-1,b=-1,e=[];for(let h=0;h<m.length;h++){const l=
m[h];F(l)?g=h:G(l)&&(b=h);var d=f[l];const p=[];if("values"in d)d.values.forEach(r=>p.push("string"===typeof r?(new Date(r)).getTime():r)),d=p[1]-p[0],n.push([p[0]-.5*d,p[p.length-1]+.5*d]),k.push(d);else{const {start:r,stop:w,num:C}=d;d=(w-r)/(C-1);n.push([r-.5*d,w+.5*d]);k.push(d);for(let y=0;y<C;y++)p.push(r+d*y)}e.push({name:l,values:p,extent:[p[0],p[p.length-1]]})}-1<g&&-1===b?b=0===g?1:0:-1<b&&-1===g?g=0===b?1:0:-1===b&&-1===g&&(g=0,b=1);e=e.filter((h,l)=>!(l===g||l===b));({referencing:a}=a.domain);
a=a.find(h=>h.coordinates.includes(m[g])).system.id;a=a?.slice(a.lastIndexOf("/")+1);a=new N({wkid:null==a||"CRS84"===a?4326:Number(a)});const [t,u]=n[g],[c,q]=n[b];n=new K({xmin:t,xmax:u,ymin:c,ymax:q,spatialReference:a});return{width:Math.round(n.width/k[g]),height:Math.round(n.height/k[b]),extent:n,dimensions:e}}function E(a){const f=L.getLanguage();return f?a[f]??Object.values(a)[0]:Object.values(a)[0]}function P(a){const f={};({parameters:a}=a);if(!a)return f;for(const [m,n]of Object.entries(a)){const {type:k,
description:g,unit:b,categoryEncoding:e,observedProperty:d}=n;if("Parameter"===k&&(f[m]={},g&&(f[m].description=E(g)),b&&(f[m].unit=b.label?E(b.label):null,f[m].symbol=b.symbol?.value),e)){const t=Object.entries(e).map((c,q)=>({OID:q,Value:Number(c[1]),ClassName:c[0].slice(c[0].lastIndexOf("/")+1),Count:1}));let u=!1;d?.categories?.length&&(d.categories.forEach(c=>{if(c.id){var q=c.id.slice(c.id.lastIndexOf("/")+1),h=t.find(p=>p.ClassName===q);if(h){var l=c.label?E(c.label):null;h.Label=l;c.preferredColor&&
(c=J.fromHex(c.preferredColor))&&(u=!0,h.Red=c.r,h.Green=c.g,h.Blue=c.b)}}}),u&&t.forEach(c=>{null==c.Red&&(c.Red=Math.round(255*Math.random()),c.Green=Math.round(255*Math.random()),c.Blue=Math.round(255*Math.random()))}));a={objectIdFieldName:"",fields:[{name:"OID",type:"esriFieldTypeOID",alias:"OID",domain:null},{name:"Value",type:"esriFieldTypeInteger",alias:"Value",domain:null},{name:"Count",type:"esriFieldTypeDouble",alias:"Count",domain:null},{name:"ClassName",type:"esriFieldTypeString",alias:"ClassName",
domain:null,length:50},{name:"Label",type:"esriFieldTypeString",alias:"Label",domain:null,length:50}],features:t.map(c=>({attributes:c}))};u&&a.fields.push({name:"Red",type:"esriFieldTypeInteger",alias:"Red",domain:null},{name:"Green",type:"esriFieldTypeInteger",alias:"Green",domain:null},{name:"Blue",type:"esriFieldTypeInteger",alias:"Blue",domain:null});f[m].attributeTable=a}}return f}function Q(a){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let n=0;n<a.length;n++){const k=a[n];null!=k&&(k<f&&
(f=k),k>m&&(m=k))}return M.getIntegerPixelType(f,m)}function R(a,f,m){const n=a.map((b,e)=>({name:b,count:f[e]})).sort((b,e)=>b.name>e.name?-1:1);var k=(b=>e=>b*=e.count)(1);k=[...n.slice(1),{name:"",count:1}].reverse().map(k).reverse();let g=0;for(let b=a.length-1;0<=b;b--){const e=n.findIndex(({name:d})=>d===a[b]);g+=m%f[b]*k[e];m=Math.floor(m/f[b])}return g}B.isXAxis=F;B.isYAxis=G;B.parseGridCoverage=function(a){const {width:f,height:m,extent:n,dimensions:k}=O(a);var {ranges:g}=a;const b=Object.keys(g).sort((l,
p)=>l<p?-1:1);var e=[];for(var d=0;d<b.length;d++){var t=b[d];k?.length&&e.push({name:t,dimensions:k})}const u=P(a);e.forEach(l=>u[l.name]&&Object.assign(l,u[l.name]));a=e.length?{variables:e}:void 0;e=[];for(d=0;d<b.length;d++){const {values:l,dataType:p,axisNames:r,shape:w}=g[b[d]];t=2<w.length?d*w.slice(0,-2).reduce((v,x)=>v*x):0;const C=r.slice(0,-2),y=w.slice(0,-2),H="float"===p?"f32":Q(l),z=f*m,S=l.length/z;for(let v=0;v<S;v++){var c=D.createEmptyBand(H,z),q=(new Uint8Array(z)).fill(255);let x=
!1;var h=v*z;for(let A=0;A<z;A++){const I=l[h+A];null==I?(q[A]=0,x=!0):c[A]=I}0===d||k?.length?(c=new D({width:f,height:m,mask:x?q:null,pixels:[c],pixelType:H}),c.updateStatistics(),k?.length?(q=R(C,y,v),e[q+t]=c):e.push(c)):(h=e[v],h.pixels.push(c),x?h.mask&&(h.mask=D.combineBandMasks([h.mask,q])):h.mask=x?q:null)}}g=Object.values(u).find(l=>l.attributeTable)?.attributeTable;return{extent:n,pixelBlocks:e,multidimensionalInfo:a,attributeTable:g,bandNames:a?void 0:b}};Object.defineProperty(B,Symbol.toStringTag,
{value:"Module"})});