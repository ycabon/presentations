// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry ../../../core/arrayUtils ../../../geometry/support/spatialReferenceUtils ./xmlUtilities ../rasterTransforms/PolynomialTransform ../../../geometry/SpatialReference".split(" "),function(m,B,t,x,e,y,g){function u(b,c){if(!b||!c)return null;const a=[];for(let d=0;d<b.length;d++)a.push(b[d]),a.push(c[d]);return a}function z(b){var c=e.getElement(b,"GeodataXform");b=e.getElementNumericValue(c,"SpatialReference/WKID")||e.getElementValue(c,"SpatialReference/WKT");b=n(b);
if("typens:PolynomialXform"!==c.getAttribute("xsi:type"))return{spatialReference:b,transform:null};var a=e.getElementNumericValue(c,"PolynomialOrder")??1,d=e.getElementNumericValues(c,"CoeffX/Double");const h=e.getElementNumericValues(c,"CoeffY/Double");var f=e.getElementNumericValues(c,"InverseCoeffX/Double");c=e.getElementNumericValues(c,"InverseCoeffY/Double");d=u(d,h);f=u(f,c);a=d&&f&&d.length&&f.length?new y({spatialReference:b,polynomialOrder:a,forwardCoefficients:d,inverseCoefficients:f}):
null;return{spatialReference:b,transform:a}}function A(b){const c=e.getElementNumericValue(b,"NoDataValue");var a=e.getElement(b,"Histograms/HistItem");const d=e.getElementNumericValue(a,"HistMin"),h=e.getElementNumericValue(a,"HistMax"),f=e.getElementNumericValue(a,"BucketCount");a=e.getElementValue(a,"HistCounts")?.split("|").map(k=>Number(k));let p,q,v,w;e.getElements(b,"Metadata/MDI").forEach(k=>{const l=Number(k.textContent??k.nodeValue);switch(k.getAttribute("key").toUpperCase()){case "STATISTICS_MINIMUM":p=
l;break;case "STATISTICS_MAXIMUM":q=l;break;case "STATISTICS_MEAN":v=l;break;case "STATISTICS_STDDEV":w=l}});b=e.getElementNumericValue(b,"Metadata/SourceBandIndex");return{noDataValue:c,histogram:a?.length&&null!=d&&null!=h?{min:d,max:h,size:f||a.length,counts:a}:null,sourceBandIndex:b,statistics:null!=p&&null!=q?{min:p,max:q,avg:v,stddev:w}:null}}function n(b){if(!b)return null;var c=Number(b);if(!isNaN(c)&&0!==c)return new g({wkid:c});b=String(b).trim();if(x.isWKT2(b))return new g({wkt2:b});var a=
b.toUpperCase();if(a.startsWith("COMPD_CS")){if(!a.includes("VERTCS")||!a.includes("GEOGCS")&&!a.startsWith("PROJCS"))return null;c=a.indexOf("VERTCS");const d=a.indexOf("PROJCS");a=-1<d?d:a.indexOf("GEOGCS");if(-1===a)return null;a=b.slice(a,b.lastIndexOf("]",c)+1).trim();b=b.slice(c,b.lastIndexOf("]")).trim();c=(c=r(a))?new g({wkid:c}):new g({wkt:a});if(b=r(b))c.vcsWkid=b;return c}if(!a.startsWith("GEOGCS")&&!a.startsWith("PROJCS"))return null;c=r(b);return 0!==c?new g({wkid:c}):new g({wkt:b})}
function r(b){var c=b.replaceAll("]","[").replaceAll('"',"").split("[").map(d=>d.trim()).filter(d=>""!==d);c=c[c.length-1].split(",");const a=c[0]?.toLowerCase();return"epsg"!==a&&"esri"!==a||!b.endsWith('"]]')||(b=Number(c[1]),isNaN(b)||0===b)?0:b}m.parsePAMInfo=function(b){if("pamdataset"!==b?.documentElement.tagName?.toLowerCase())return{};const c={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};b.documentElement.childNodes.forEach(a=>{if(1===a.nodeType)if(e.isSameTagIgnoreNS(a,
"SRS"))c.spatialReference||(a=e.getElementValue(a),c.spatialReference=n(a));else if(e.isSameTagIgnoreNS(a,"Metadata"))if("xml:ESRI"===a.getAttribute("domain")){const {spatialReference:d,transform:h}=z(a);c.transform=h;c.spatialReference||(c.spatialReference=d)}else e.getElements(a,"MDI").forEach(d=>c.metadata[d.getAttribute("key")]=e.getElementValue(d));else e.isSameTagIgnoreNS(a,"PAMRasterBand")&&(a=A(a),null!=a.sourceBandIndex&&null==c.rasterBands[a.sourceBandIndex]?c.rasterBands[a.sourceBandIndex]=
a:c.rasterBands.push(a))});b=c.rasterBands;b.length&&(c.statistics=b[0].statistics?b.map(a=>a.statistics).filter(t.isSome):null,c.histograms=b[0].histogram?b.map(a=>a.histogram).filter(t.isSome):null);return c};m.parseSpatialReference=n;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});