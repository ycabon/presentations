// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error","../../../geometry/Extent","./xmlUtilities"],function(t,x,q,a){function m(c){return c.indexOf("?")===c.length-1?c.substring(0,c.length-1):c}function u(c){const e={};for(let g=0;g<c.childNodes.length;g++){var b=c.childNodes[g];if(1===b.nodeType){var d=a.getNodeNameIgnoreNS(b).toLowerCase();switch(d){case "title":case "abstract":e[d]=a.getElementValue(b);break;case "identifier":e.id=a.getElementValue(b);break;case "wgs84boundingbox":d=a.getSpaceDelimitedNumericValues(b,
"LowerCorner");b=a.getSpaceDelimitedNumericValues(b,"UpperCorner");e.lonLatEnvelope=new q({xmin:d[0],ymin:d[1],xmax:b[0],ymax:b[1],spatialReference:{wkid:4326}});break;case "coveragesummary":e.coverageSummaries=e.coverageSummaries||[],e.coverageSummaries.push(u(b))}}}return e}function v(c,e){if(c.coverageSummaries)for(let b=0;b<c.coverageSummaries.length;b++)c.coverageSummaries[b]["abstract"]=c.coverageSummaries[b]["abstract"]||c["abstract"],c.coverageSummaries[b].lonLatEnvelope=c.coverageSummaries[b].lonLatEnvelope||
c.lonLatEnvelope,c.coverageSummaries[b].title=c.coverageSummaries[b].title||c.title,v(c.coverageSummaries[b],e);null!=c.id&&e.push(c)}function w(c){const e=a.getElement(c.querySelector("Operation[name\x3dGetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",b=a.getElement(c.querySelector("Operation[name\x3dDescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"";c=a.getElement(c.querySelector("Operation[name\x3dGetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:m(e),
describeCoverage:m(b),getCoverage:m(c)}}t.parseCapabilities=function(c,e=null){var b=null;b="string"===typeof c?(new DOMParser).parseFromString(c,"text/xml"):c;c=b.documentElement.getAttribute("version");e=(c||e||"1.0.0").slice(0,3);if("2.0"===e){var d=b,g=a.getElement(d,"ServiceIdentification");b=a.getElementValue(g,"Title");e=a.getElementValues(g,"ServiceTypeVersion");g=a.getElementValues(g,"Profile");var f=a.getElement(d,"OperationsMetadata");f=w(f);var k=a.getElements(d,"Contents/CoverageSummary"),
l=[];for(let r=0;r<k.length;r++){var p=k[r];const y=a.getElementValue(p,"CoverageId");var n=a.getElement(p,"WGS84BoundingBox"),h=void 0;n&&(h=a.getSpaceDelimitedNumericValues(n,"LowerCorner"),n=a.getSpaceDelimitedNumericValues(n,"UpperCorner"),h=new q({xmin:h[0],ymin:h[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}}));p=a.getElementValue(p,"CoverageSubtype")||"RectifiedGridCoverage";l.push({id:y,lonLatEnvelope:h,coverageSubType:p})}d=a.getElement(d,"ServiceMetadata");h=a.getElementValues(d,"formatSupported");
d=a.getElementValues(d,"interpolationSupported").concat(a.getElementValues(d,"InterpolationSupported"));b={name:b,supportedVersions:e,supportedFormats:h,supportedInterpolations:d,onlineResources:f,profiles:g,coverages:l}}else if("1.1"===e){f=b;b=a.getElementValue(f,"ServiceIdentification/Title");e=a.getElementValues(f,"ServiceIdentification/ServiceTypeVersion");g=a.getElement(f,"OperationsMetadata");g=w(g);h=[];f=a.getElement(f,"Contents");for(l=0;l<f.childNodes.length;l++)d=f.childNodes[l],1===d.nodeType&&
a.isSameTagIgnoreNS(d,"CoverageSummary")&&v(u(d),h);f=a.getElementValues(f,"SupportedFormat");b={name:b,onlineResources:g,coverages:h,supportedVersions:e,supportedFormats:f}}else if("1.0"===e){g=b;b=a.getElementValue(g,"Service/name");f=a.getElement(g,"Capability");e=a.getElement(f,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"";h=a.getElement(f,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"";f=a.getElement(f,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??
"";e={getCapabilities:m(e),describeCoverage:m(h),getCoverage:m(f)};g=a.getElements(g,"CoverageOfferingBrief");h=[];for(f=0;f<g.length;f++)d=g[f],l=a.getElementValue(d,"name"),k=a.getElements(d,"pos"),d=a.getSpaceDelimitedNumericValues(k[0]),k=a.getSpaceDelimitedNumericValues(k[1]),d=new q({xmin:d[0],ymin:d[1],xmax:k[0],ymax:k[1],spatialReference:{wkid:4326}}),h.push({id:l,lonLatEnvelope:d});b={name:b,onlineResources:e,coverages:h,supportedVersions:["1.0.0"]}}else throw new x("wcsraster:parsecapabilities",
"the capabilities version is not supported");b.capabilitiesVersion=c;return b};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});