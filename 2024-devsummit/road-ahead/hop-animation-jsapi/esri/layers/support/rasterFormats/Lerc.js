// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../assets"],function(R,F,S){function y(c,l,e){e.set(c.slice(l,l+e.length))}function T(c){const {_malloc:l,_free:e,_lerc_getBlobInfo:J,_lerc_getDataRanges:K,_lerc_decode_4D:L,asm:I}=c;let f;const x=Object.values(I).find(a=>a&&"buffer"in a&&a.buffer===c.HEAPU8.buffer),z=a=>{a=a.map(h=>(h>>3<<3)+16);var d=a.reduce((h,m)=>h+m),k=l(d);f=new Uint8Array(x.buffer);d=a[0];a[0]=k;for(k=1;k<a.length;k++){const h=a[k];a[k]=a[k-1]+d;d=h}return a};H.getBlobInfo=a=>{var d=new Uint8Array(48),
k=new Uint8Array(24);const [h,m,u]=z([a.length,d.length,k.length]);f.set(a,h);f.set(d,m);f.set(k,u);var b=J(h,a.length,m,u,12,3);if(b)throw e(h),Error(`lerc-getBlobInfo: error code is ${b}`);f=new Uint8Array(x.buffer);y(f,m,d);y(f,u,k);d=new Uint32Array(d.buffer);var g=new Float64Array(k.buffer);const [p,n,,q,w,r,D,A,B,t,E]=d;k={version:p,depthCount:t,width:q,height:w,validPixelCount:D,bandCount:r,blobSize:A,maskCount:B,dataType:n,minValue:g[0],maxValue:g[1],maxZerror:g[2],statistics:[],bandCountWithNoData:E};
if(E&&1<t)return e(h),k;if(1===t&&1===r)return e(h),k.statistics.push({minValue:g[0],maxValue:g[1]}),k;b=t*r*8;var v=new Uint8Array(b),G=new Uint8Array(b);d=h;var C=g=0;let M=!1;f.byteLength<h+2*b?(e(h),M=!0,[d,g,C]=z([a.length,b,b]),f.set(a,d)):[g,C]=z([b,b]);f.set(v,g);f.set(G,C);if(b=K(d,a.length,t,r,g,C))throw e(d),M||e(g),Error(`lerc-getDataRanges: error code is ${b}`);f=new Uint8Array(x.buffer);y(f,g,v);y(f,C,G);a=new Float64Array(v.buffer);b=new Float64Array(G.buffer);G=k.statistics;for(v=
0;v<r;v++)if(1<t){C=a.slice(v*t,(v+1)*t);const P=b.slice(v*t,(v+1)*t),U=Math.min.apply(null,C),V=Math.max.apply(null,P);G.push({minValue:U,maxValue:V,depthStats:{minValues:C,maxValues:P}})}else G.push({minValue:a[v],maxValue:b[v]});e(d);M||e(g);return k};H.decode=(a,d)=>{const {maskCount:k,depthCount:h,bandCount:m,width:u,height:b,dataType:g,bandCountWithNoData:p}=d;var n=N[g],q=u*b;d=new Uint8Array(q*m);n=new Uint8Array(q*h*m*n.size);q=new Uint8Array(m);var w=new Uint8Array(8*m);const [r,D,A,B,t]=
z([a.length,d.length,n.length,q.length,w.length]);f.set(a,r);f.set(d,D);f.set(n,A);f.set(q,B);f.set(w,t);if(a=L(r,a.length,k,D,h,u,b,m,g,A,B,t))throw e(r),Error(`lerc-decode: error code is ${a}`);f=new Uint8Array(x.buffer);y(f,A,n);y(f,D,d);a=null;if(p){y(f,B,q);y(f,t,w);a=[];w=new Float64Array(w.buffer);for(let E=0;E<q.length;E++)a.push(q[E]?w[E]:null)}e(r);return{data:n,maskData:d,noDataValues:a}}}const N=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,
range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}];let O=null,Q=!1;const H={getBlobInfo:null,
decode:null};F.decode=function(c,l={}){var e=l.inputOffset??0;c=c instanceof Uint8Array?c.subarray(e):new Uint8Array(c,e);e=H.getBlobInfo(c);const {data:J,maskData:K,noDataValues:L}=H.decode(c,e),{width:I,height:f,bandCount:x,depthCount:z,dataType:a,maskCount:d,statistics:k}=e;var h=N[a],m=new h.ctor(J.buffer);c=[];e=[];const u=I*f;var b=u*z;for(var g=0;g<x;g++){var p=m.subarray(g*b,(g+1)*b);if(l.returnInterleaved)c.push(p);else{a:{var n=u,q=z;if(2>q)break a;const w=new h.ctor(n*q);for(let r=0,D=
0;r<n;r++)for(let A=0,B=r;A<q;A++,B+=n)w[B]=p[D++];p=w}c.push(p)}e.push(K.subarray(g*b,(g+1)*b))}m=0===d?null:1===d?e[0]:new Uint8Array(u);if(1<d)for(m.set(e[0]),b=1;b<e.length;b++)for(g=e[b],p=0;p<u;p++)m[p]&=g[p];({noDataValue:l}=l);b=null!=l&&h.range[0]<=l&&h.range[1]>=l;if(0<d&&b)for(b=0;b<x;b++)for(g=c[b],p=e[b]||m,n=0;n<u;n++)0===p[n]&&(g[n]=l);({pixelType:h}=h);return{width:I,height:f,bandCount:x,pixelType:h,depthCount:z,statistics:k,pixels:c,mask:m,bandMasks:d===x&&1<x?e:null,noDataValues:L}};
F.getBlobInfo=function(c,l={}){c=c instanceof Uint8Array?c.subarray(l.inputOffset??0):new Uint8Array(c,l.inputOffset??0);return H.getBlobInfo(c)};F.isLoaded=function(){return Q};F.load=function(){return O?O:O=(new Promise((c,l)=>R(["../../../chunks/lerc-wasm"],c,l))).then(c=>c.lercWasm).then(({default:c})=>c({locateFile:l=>S.getAssetUrl(`esri/layers/support/rasterFormats/${l}`)})).then(c=>{T(c);Q=!0})};F.pixelTypeInfoMap=N;Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});