// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./MaskFunctionArguments ./pixelUtils".split(" "),function(k,m,l,f,t,u,p,q,r,g){f=class extends q{constructor(){super(...arguments);this.functionName="Mask";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){var a=this.sourceRasterInfos[0].clone();
const {pixelType:h}=a;this.outputPixelType=this._getOutputPixelType(h);a.pixelType=this.outputPixelType;this.rasterInfo=a;const {includedRanges:d,normalizedNoDataValues:b}=this.functionArguments;if(!d?.length&&!b?.length)return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let c=[];for(let e=0;e<a.bandCount;e++){const n=g.createMaskLUT(h,d?.slice(2*e,2*e+2),b?.[e]);if(null==n){c=null;break}c.push(n)}this.lookups=c;a=null!=b&&b.every(e=>e?.length===b[0]?.length);
return{success:!0,supportsGPU:(!d||d.length<=2*g.maxMapSizeGpu)&&(!b||a&&b[0].length<=g.maxMapSizeGpu)}}_processPixels(a){a=a.pixelBlocks?.[0];if(null==a)return null;const {outputPixelType:h,lookups:d}=this,{includedRanges:b,noDataInterpretation:c,normalizedNoDataValues:e}=this.functionArguments;return g.mask(a,{includedRanges:b,noDataValues:e,outputPixelType:h,matchAll:c===g.NoDataInterpretation.matchAll,lookups:d})}_getWebGLParameters(){const {includedRanges:a,normalizedNoDataValues:h}=this.functionArguments,
d=new Float32Array(g.maxMapSizeGpu);d.fill(m.numberMaxFloat32);h?.[0]?.length&&d.set(h[0]);const b=new Float32Array(g.maxMapSizeGpu);for(let c=0;c<b.length;c+=2)b[c]=a?.[c]??-m.numberMaxFloat32,b[c+1]=a?.[c+1]??m.numberMaxFloat32;a&&a.length&&b.set(a);return{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:d,includedRanges:b}}};k.__decorate([l.property({json:{write:!0,name:"rasterFunction"}})],f.prototype,"functionName",void 0);k.__decorate([l.property({type:r,json:{write:!0,name:"rasterFunctionArguments"}})],
f.prototype,"functionArguments",void 0);k.__decorate([l.property()],f.prototype,"rasterArgumentNames",void 0);k.__decorate([l.property({json:{write:!0}})],f.prototype,"lookups",void 0);return f=k.__decorate([p.subclass("esri.layers.support.rasterFunctions.MaskFunction")],f)});