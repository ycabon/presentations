// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./pixelUtils ./StretchFunctionArguments ./stretchUtils".split(" "),function(h,m,d,x,y,t,q,u,v,w,k){d=class extends u{constructor(){super(...arguments);this.functionName="Stretch";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.cutOffs=
this.lookup=null}_bindSourceRasters(){this.cutOffs=this.lookup=null;var a=this.sourceRasterInfos[0];const {pixelType:b}=a;var {functionArguments:c}=this;const {dynamicRangeAdjustment:e,gamma:l,useGamma:p}=c;if(!e&&["u8","u16","s8","s16"].includes(b)){c=k.getStretchCutoff(c.toJSON(),{rasterInfo:a});const f=q.isIntegerPixelType(this.outputPixelType)?"round":"float";this.lookup=k.createStretchLUT({pixelType:b,...c,gamma:p?l:null,rounding:f});this.cutOffs=c}else e||(this.cutOffs=k.getStretchCutoff(c.toJSON(),
{rasterInfo:a}));this.outputPixelType=this._getOutputPixelType(b);a=a.clone();a.pixelType=this.outputPixelType;this._removeStatsHistColormapVAT(a);"u8"===this.outputPixelType&&(a.keyProperties.DataType="processed");this.rasterInfo=a;return{success:!0,supportsGPU:!e}}_processPixels(a){a=a.pixelBlocks?.[0];if(null==a)return a;var {lookup:b}=this;if(b)return v.lookupPixels(a,{...b,outputPixelType:this.rasterInfo.pixelType});({functionArguments:b}=this);const c=this.cutOffs||k.getStretchCutoff(b.toJSON(),
{rasterInfo:this.sourceRasterInfos[0],pixelBlock:a});return k.stretch(a,{...c,gamma:b.useGamma?b.gamma:null,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const {outputMin:a=0,outputMax:b=255,gamma:c,useGamma:e}=this.functionArguments,l=2<=this.rasterInfo.bandCount?3:1,p=e&&c?.length?k.computeGammaCorrection(l,c):[1,1,1],{minCutOff:f,maxCutOff:n}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===f.length&&(f[1]=f[2]=f[0],n[1]=n[2]=n[0]);const r=new Float32Array(l);var g;
for(g=0;g<l;g++)r[g]=(b-a)/(n[g]-f[g]);g=q.isIntegerPixelType(this.outputPixelType);return{bandCount:l,outMin:a,outMax:b,minCutOff:f,maxCutOff:n,factor:r,useGamma:e,gamma:e&&c?c:[1,1,1],gammaCorrection:e&&p?p:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:g,type:"stretch"}}};h.__decorate([m.property({json:{write:!0,name:"rasterFunction"}})],d.prototype,"functionName",void 0);h.__decorate([m.property({type:w,json:{write:!0,name:"rasterFunctionArguments"}})],d.prototype,"functionArguments",
void 0);h.__decorate([m.property()],d.prototype,"rasterArgumentNames",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"lookup",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"cutOffs",void 0);return d=h.__decorate([t.subclass("esri.layers.support.rasterFunctions.StretchFunction")],d)});