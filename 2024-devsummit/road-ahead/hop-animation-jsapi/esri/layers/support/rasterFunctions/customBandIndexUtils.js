// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/has"],function(n,t){function p(g,b){return g.toLowerCase().startsWith("b")?b[parseInt(g.slice(1),10)-1]:parseFloat(g)}const r=new Set("+-*/()".split(""));n.calculateCustomBandIndex=function(g,b,c){c=c.replaceAll(" ","");c.startsWith("-")&&(c="0"+c);c.startsWith("+")&&(c=c.slice(1,c.length));c=c.split("");var f=[],d=[],a="";for(var h=0;h<c.length;h++){const k=c[h];r.has(k)?(a.length&&d.push(p(a,b)),f.push(k),a=""):a=a.concat(k)}a.length&&d.push(p(a,b));let {ops:l,nums:m}=
{ops:f,nums:d};if(0===l.length){g=1===m.length?m[0]:b[0];if(g instanceof Float32Array)return[g];var e=new Float32Array(b[0].length);"number"===typeof g?e.fill(g):e.set(g);return[e]}for(;0<l.length;){e=l;if(1===e.length)e={opIndex:0,numIndex:0};else{f=c=0;for(b=0;b<e.length;b++)if("("===e[b])c=b;else if(")"===e[b]){f=b;break}d=0===f?e:e.slice(c+1,f);b=-1;for(a=0;a<d.length;a++)if("*"===d[a]||"/"===d[a]){b=a;break}if(!(-1<b))for(a=0;a<d.length;a++)if("+"===d[a]||"-"===d[a]){b=a;break}0<f&&(b+=c+1);
c=0;for(f=0;f<b;f++)"("===e[f]&&c++;e={opIndex:b,numIndex:b-c}}const {numIndex:k,opIndex:q}=e;f=c=b=void 0;e=g;a=l[q];d=m[k];h=m[k+1];if("number"===typeof d&&"number"===typeof h)e=d+h;else{"number"===typeof d?(b=h,f=b.length,c=new Float32Array(f),c.fill(d)):(f=d.length,c=d,h.constructor===Number?(b=new Float32Array(f),b.fill(h)):b=h);d=new Float32Array(f);switch(a){case "+":for(a=0;a<f;a++)if(null==e||e[a])d[a]=c[a]+b[a];break;case "-":for(a=0;a<f;a++)if(null==e||e[a])d[a]=c[a]-b[a];break;case "*":for(a=
0;a<f;a++)if(null==e||e[a])d[a]=c[a]*b[a];break;case "/":for(a=0;a<f;a++)(null==e||e[a])&&b[a]&&(d[a]=c[a]/b[a]);break;case "(":case ")":throw Error("encountered error with custom band index equation");}e=d}if(1===l.length)break;else{b=l;b.splice(q,1);f=c=0;do{f=c=0;for(d=0;d<b.length;d++)if("("===b[d])c=d;else if(")"===b[d]){f=d;break}f===c+1&&b.splice(c,2)}while(f===c+1);l=b;m.splice(k,2,e)}}return[e]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});