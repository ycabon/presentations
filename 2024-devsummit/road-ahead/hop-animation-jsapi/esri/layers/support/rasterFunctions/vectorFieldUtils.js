// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(A,da,H,M){function I(a,c){return C.get(a)/C.get(c)||1}function N(a,c="geographic"){const [b,d]=a;a=Math.sqrt(b*b+d*d);let e=Math.atan2(d,b)*O;e=(360+e)%360;"geographic"===c&&(e=(450-e)%360);return[a,e]}function Y(a,c="geographic"){let b=a[1];"geographic"===c&&(b=(450-b)%360);b%=360;a=a[0];return[a*Math.cos(b/O),a*Math.sin(b/O)]}function P(a,c,b="geographic",d=1){if(!M.isValidPixelBlock(a))return a;const {pixels:e,width:f,
height:u}=a;var p=f*u;const n=e[0],g=e[1],k=a.pixelType.startsWith("f")?a.pixelType:"f32",l=H.createEmptyBand(k,p);p=H.createEmptyBand(k,p);let h=0;for(let t=0;t<u;t++)for(let m=0;m<f;m++)"vector-uv"===c?([l[h],p[h]]=N([n[h],g[h]],b),l[h]*=d):([l[h],p[h]]=Y([n[h],g[h]],b),l[h]*=d,p[h]*=d),h++;a=new H({pixelType:k,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:[l,p]});a.updateStatistics();return a}function Z(a=0,c=0,b=Math.PI,d=!0){d&&(b=
(2*Math.PI-b)%(2*Math.PI));d=d?-1:1;const e=-7*d,f=-2*d,u=-16*d,[p,n]=z(0,c+13*d,b,21.75),[g,k]=z(a-5.5,c+e,b,21.75),[l,h]=z(a+5.5,c+e,b,21.75),[t,m]=z(a-1.5,c+f,b,21.75),[r,q]=z(a+1.5,c+f,b,21.75),[w,x]=z(a-1.5,c+u,b,21.75),[v,y]=z(a+1.5,c+u,b,21.75);return[p,n,g,k,t,m,r,q,l,h,w,x,v,y]}function ea(a=0,c=Math.PI,b=!0){b&&(c=(2*Math.PI-c)%(2*Math.PI));var d=b?-1:1,e=5*d;const f=20*d,u=25*d;d*=2;const p=b?1:-1;b=5*p;let [n,g]=[0+b,0-f],[k,l]=[n+2*p,g],[h,t]=[k-0*p,l+d],[m,r]=[0-b,0-u],[q,w]=[m+0*p,
r-d],x=Math.ceil(a/5),v=Math.floor(x/10);x-=8*v;a=[];const y=[];for(let Q=0;Q<x/2;Q++,v--){0>=v&&1===x%2&&Q===(x-1)/2&&(m=0,q=m+0*p,r=(r+g)/2,w=r-d);const [aa,ba]=z(m,r,c,45);if(0<v){const [R,S]=z(k,r,c,45),[T,U]=z(n,g,c,45);a.push(R);a.push(S);a.push(aa);a.push(ba);a.push(T);a.push(U)}else{const [R,S]=z(k,l,c,45),[T,U]=z(h,t,c,45),[fa,ha]=z(q,w,c,45);y.push(aa);y.push(ba);y.push(fa);y.push(ha);y.push(T);y.push(U);y.push(R);y.push(S)}r+=e;g+=e;l+=e;t+=e;w+=e}const [B,J]=z(0+b,0+f,c,45);e=7*p;const [K,
D]=z(0+e,0+f,c,45),[E,V]=z(0+b,0-u,c,45),[W,ia]=z(0+e,0-u,c,45);return{pennants:a,barbs:y,shaft:[B,J,K,D,E,V,W,ia]}}function z(a,c,b,d=1){return[Math.sqrt(a*a+c*c)/d,(2*Math.PI+(2*Math.PI+Math.atan2(c,a))%(2*Math.PI)-b)%(2*Math.PI)]}function F(a,c,b,d){b=I(d||"knots",b);for(d=1;d<c.length;d++)if(d===c.length-1){if(a<c[d]*b)break}else if(a<=c[d]*b)break;return Math.min(d-1,c.length-2)}function ja(a,c,b,d,e){let f=0;switch(c){case "beaufort_kn":f=F(a,L,"knots",b);break;case "beaufort_km":f=F(a,L,"kilometer-per-hour",
b);break;case "beaufort_ft":f=F(a,L,"feet-per-second",b);break;case "beaufort_m":f=F(a,L,"meter-per-second",b);break;case "classified_arrow":f=F(a,e??[],d,b);break;case "ocean_current_m":f=F(a,ka,"meter-per-second",b);break;case "ocean_current_kn":f=F(a,la,"knots",b)}return f}function ma(a,c){const {style:b,inputUnit:d,outputUnit:e,breakValues:f}=c,u=G.fromJSON(d),p=G.fromJSON(e);let n=0,g=0;const {width:k,height:l,mask:h}=a,t=a.pixels[0];a=a.pixels[1];var m=null!=h?h.filter(w=>0<w).length:k*l;const r=
new Float32Array(42*m);m=new Uint32Array(15*m);c=c.invertDirection?Z(0,0,0,!1):na;for(let w=0;w<l;w++)for(let x=0;x<k;x++){var q=w*k+x;if(!h||h[w*k+x]){const v=(a[q]+360)%360/180*Math.PI,y=ja(t[q],b,u,p,f);for(let B=0;B<c.length;B+=2)r[n++]=(x+.5)/k,r[n++]=(w+.5)/l,r[n++]=c[B],r[n++]=c[B+1]+v,r[n++]=y,r[n++]=t[q];q=7*(n/42-1);m[g++]=q;m[g++]=q+1;m[g++]=q+2;m[g++]=q+0;m[g++]=q+4;m[g++]=q+3;m[g++]=q+0;m[g++]=q+2;m[g++]=q+3;m[g++]=q+2;m[g++]=q+5;m[g++]=q+3;m[g++]=q+5;m[g++]=q+6;m[g++]=q+3}}return{vertexData:r,
indexData:m}}function ca(a,c){let b=0,d=0;const {width:e,height:f,mask:u}=a;a=a.pixels[0];const p=[],n=[];var g=G.fromJSON(c.inputUnit);g=I(g,"knots");c="wind_speed"===c.style?5:Number.MAX_VALUE;for(let l=0;l<f;l++)for(let h=0;h<e;h++){var k=a[l*e+h]*g;if((!u||u[l*e+h])&&k<c){for(let t=0;4>t;t++)p[b++]=(h+.5)/e,p[b++]=(l+.5)/f,p[b++]=2>t?-.5:.5,p[b++]=0===t%2?-.5:.5,p[b++]=0,p[b++]=k;k=4*(b/24-1);n[d++]=k;n[d++]=k+1;n[d++]=k+2;n[d++]=k+1;n[d++]=k+2;n[d++]=k+3}}return{vertexData:new Float32Array(p),
indexData:new Uint32Array(n)}}const C=new Map;C.set("meter-per-second",1);C.set("kilometer-per-hour",.277778);C.set("knots",.514444);C.set("feet-per-second",.3048);C.set("mile-per-hour",.44704);const O=180/Math.PI,G=new da.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),na=Z(0,0,0),L=[0,1,3,6,10,16,21,27,33,40,47,55,63],ka=[0,.5,1,1.5,2],la=[0,.25,.5,1,1.5,2,2.5,3,3.5,
4],X=[];A.convertToLocalDirections=function(a,c,b,d="geographic"){if(!M.isValidPixelBlock(a)||null==b)return a;a="vector-magdir"===c?a.clone():P(a,c);const e=a.pixels[1];for(let f=0;f<e.length;f++)e[f]="geographic"===d?(e[f]+b[f]+270)%360:(e[f]+360-b[f])%360;return"vector-magdir"===c?a:P(a,"vector-magdir")};A.convertVectorFieldData=P;A.convertVectorFieldUnit=function(a,c,b=1){if(1===b||!M.isValidPixelBlock(a))return a;a=a.clone();const {pixels:d,width:e,height:f}=a,u=d[0],p=d[1];let n=0;for(let g=
0;g<f;g++)for(let k=0;k<e;k++)"vector-uv"===c?(u[n]*=b,p[n]*=b):u[n]*=b,n++;a.updateStatistics();return a};A.createVFMesh=function(a,c){if("simple_scalar"===c.style)c=ca(a,c);else if("wind_speed"===c.style){if(0===X.length)for(var b=0;30>b;b++)X.push(ea(5*b,0,!c.invertDirection));c=G.fromJSON(c.inputUnit);c=I(c,"knots");const {width:u,height:p,mask:n}=a;b=a.pixels[0];a=a.pixels[1];const g=[],k=[];let l=0,h=0;for(let t=0;t<p;t++)for(let m=0;m<u;m++){var d=t*u+m,e=b[d]*c;if((!n||n[t*u+m])&&5<=e){const r=
(a[d]+360)%360/180*Math.PI,{pennants:q,barbs:w,shaft:x}=X[Math.min(Math.floor(e/5),29)];if(0===q.length+w.length)continue;d=g.length/6;const v=(m+.5)/u,y=(t+.5)/p;for(var f=0;f<q.length;f+=2)g[l++]=v,g[l++]=y,g[l++]=q[f],g[l++]=q[f+1]+r,g[l++]=0,g[l++]=e;for(f=0;f<w.length;f+=2)g[l++]=v,g[l++]=y,g[l++]=w[f],g[l++]=w[f+1]+r,g[l++]=0,g[l++]=e;for(f=0;f<x.length;f+=2)g[l++]=v,g[l++]=y,g[l++]=x[f],g[l++]=x[f+1]+r,g[l++]=0,g[l++]=e;for(e=0;e<q.length/6;e++)k[h++]=d,k[h++]=d+1,k[h++]=d+2,d+=3;for(e=0;e<
w.length/8;e++)k[h++]=d,k[h++]=d+1,k[h++]=d+2,k[h++]=d+1,k[h++]=d+2,k[h++]=d+3,d+=4;k[h++]=d+0;k[h++]=d+1;k[h++]=d+2;k[h++]=d+1;k[h++]=d+3;k[h++]=d+2;d+=4}}c={vertexData:new Float32Array(g),indexData:new Uint32Array(k)}}else c=ma(a,c);return c};A.createVFMeshScalar=ca;A.getUnitConversionFactor=I;A.sampleVectorField=function(a,c,b,d=[0,0],e=.5){const {width:f,height:u,mask:p}=a,[n,g]=a.pixels,[k,l]=d;a=Math.round((f-k)/b);d=Math.round((u-l)/b);var h=a*d;const t=new Float32Array(h),m=new Float32Array(h);
h=new Uint8Array(h);c="vector-uv"===c;for(let q=0;q<d;q++)for(let w=0;w<a;w++){let x=0;const v=q*a+w,y=Math.max(0,q*b+l),B=Math.max(0,w*b+k),J=Math.min(u,y+b),K=Math.min(f,B+b);for(let D=y;D<J;D++)for(let E=B;E<K;E++){var r=D*f+E;if(!p||p[r]){x++;r=c?[n[r],g[r]]:[n[r],(360+g[r])%360];const [V,W]=c?r:Y(r);t[v]+=V;m[v]+=W}}if(x>=(J-y)*(K-B)*(1-e)){h[v]=1;const [D,E]=N([t[v]/x,m[v]/x]);t[v]=D;m[v]=E}else h[v]=0,t[v]=0,m[v]=0}b=new H({width:a,height:d,pixels:[t,m],mask:h});b.updateStatistics();return b};
A.snapImageToSymbolTile=function(a,c,b,d,e){if(null==e||!e.spatialReference.equals(a.spatialReference))return{extent:a,width:Math.round(c/d),height:Math.round(b/d),resolution:a.width/c};const f=e.xmin;e=e.ymax;c=(a.xmax-a.xmin)/c*d;b=(a.ymax-a.ymin)/b*d;a.xmin=f+Math.floor((a.xmin-f)/c)*c;a.xmax=f+Math.ceil((a.xmax-f)/c)*c;a.ymin=e+Math.floor((a.ymin-e)/b)*b;a.ymax=e+Math.ceil((a.ymax-e)/b)*b;return{extent:a,width:Math.round(a.width/c),height:Math.round(a.height/b),resolution:(c+b)/2}};A.unitKebabDict=
G;A.uvComponentToVector=N;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});