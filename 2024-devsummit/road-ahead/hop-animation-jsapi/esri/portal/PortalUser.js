// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),function(q,d,n,c,e,u,v,w,r,t,p){var m;c=m=class extends c.JSONSupport{constructor(...a){super(...a);this.userType=this.username=this.units=this.sourceJSON=this.roleId=this.role=this.region=this.privileges=this.preferredView=this.portal=this.orgId=this.modified=
this.fullName=this.email=this.description=this.culture=this.created=this.access=null}get thumbnailUrl(){const a=this.url,b=this.thumbnail;return a&&b?this.portal.normalizeUrl(`${a}/info/${b}?f=json`):null}get userContentUrl(){const a=this.portal?.restUrl;return a?`${a}/content/users/${this.username}`:null}get url(){const a=this.portal?.restUrl;return a?`${a}/community/users/${this.username}`:null}addItem(a){const b=a&&a.item;var f=a?.data;a=a?.folder;const g={method:"post"};b&&(g.query=b.createPostQuery(),
null!=f&&("string"===typeof f?g.query.text=f:"object"===typeof f&&(g.query.text=JSON.stringify(f))));f=this.userContentUrl;a&&(f+="/"+("string"===typeof a?a:a.id));return this.portal.request(f+"/addItem",g).then(h=>{b.id=h.id;b.portal=this.portal;return b.loaded?b.reload():b.load()})}deleteItem(a){let b=this.userContentUrl;a.ownerFolder&&(b+="/"+a.ownerFolder);return this.portal.request(b+`/items/${a.id}/delete`,{method:"post"}).then(()=>{a.id=null;a.portal=null})}deleteItems(a){const b=this.userContentUrl+
"/deleteItems";var f=a.map(g=>g.id);return f.length?(f={method:"post",query:{items:f.join(",")}},this.portal.request(b,f).then(()=>{a.forEach(g=>{g.id=null;g.portal=null})})):Promise.resolve(void 0)}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then(a=>a&&a.folders?a.folders.map(b=>{b=t.fromJSON(b);b.portal=this.portal;return b}):[])}fetchGroups(){return this.portal.request(this.url??"").then(a=>a&&a.groups?a.groups.map(b=>{b=p.fromJSON(b);b.portal=this.portal;
return b}):[])}fetchItems(a){const b=a??{};let f=this.userContentUrl??"";b.folder&&(f+="/"+b.folder.id);let g;return(new Promise((h,l)=>q(["./PortalItem"],k=>h(Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"}))),l))).then(({default:h})=>{g=h;return this.portal.request(f,{query:{folders:!1,num:b.num||10,start:b.start||1,sortField:b.sortField||"created",sortOrder:b.sortOrder||"asc"}})}).then(h=>{let l;return h?.items?(l=h.items.map(k=>{k=g.fromJSON(k);
k.portal=this.portal;return k}),Promise.all(l.map(k=>k.load())).catch(k=>k).then(()=>({items:l,nextStart:h.nextStart,total:h.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(a=>a.tags)}getThumbnailUrl(a){let b=this.thumbnailUrl;b&&a&&(b+=`&w=${a}`);return b}queryFavorites(a){return this.favGroupId?(this._favGroup||(this._favGroup=new p({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(a)):Promise.reject(new n("internal:unknown",
"Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new n("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented");}static fromJSON(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");const b=new m;b.sourceJSON=a;b.read(a);return b}};d.__decorate([e.property()],c.prototype,"access",void 0);d.__decorate([e.property({type:Date})],c.prototype,"created",void 0);d.__decorate([e.property()],c.prototype,"culture",void 0);d.__decorate([e.property()],
c.prototype,"description",void 0);d.__decorate([e.property()],c.prototype,"email",void 0);d.__decorate([e.property()],c.prototype,"favGroupId",void 0);d.__decorate([e.property()],c.prototype,"fullName",void 0);d.__decorate([e.property({type:Date})],c.prototype,"modified",void 0);d.__decorate([e.property()],c.prototype,"orgId",void 0);d.__decorate([e.property()],c.prototype,"portal",void 0);d.__decorate([e.property()],c.prototype,"preferredView",void 0);d.__decorate([e.property()],c.prototype,"privileges",
void 0);d.__decorate([e.property()],c.prototype,"region",void 0);d.__decorate([e.property()],c.prototype,"role",void 0);d.__decorate([e.property()],c.prototype,"roleId",void 0);d.__decorate([e.property()],c.prototype,"sourceJSON",void 0);d.__decorate([e.property()],c.prototype,"thumbnail",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"thumbnailUrl",null);d.__decorate([e.property()],c.prototype,"units",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"userContentUrl",null);
d.__decorate([e.property({readOnly:!0})],c.prototype,"url",null);d.__decorate([e.property()],c.prototype,"username",void 0);d.__decorate([e.property()],c.prototype,"userType",void 0);return c=m=d.__decorate([r.subclass("esri.portal.PortalUser")],c)});