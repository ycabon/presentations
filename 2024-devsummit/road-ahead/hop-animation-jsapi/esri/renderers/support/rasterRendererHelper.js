// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../rasterRenderers ../../core/unitUtils ../../layers/support/Field ../FlowRenderer ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./rasterRendererChecks ./UniqueValueInfo ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),function(k,B,na,
X,Y,Z,I,aa,E,r,J,ba,ca,K,da,ea,fa,ha,ia,ja){function L(a,b){a=F(a,b?.variableName);const {bandCount:d}=a;let {bandIds:c,stretchType:e}=b||{};c?.some(p=>p>=d)&&(c=null);let f=a.statistics,g=a.histograms;1<d?(c=c?.length?c:M(a),f=null==f?null:c?.map(p=>f[p]),g=null==g?null:c?.map(p=>g[p])):c=[0];null==e&&(e=ka(a));let q=!1;switch(e){case "none":q=!1;break;case "percent-clip":q=!g?.length;break;default:q=!f?.length}var {dataType:l}=a;l=1===c?.length&&N.has(l)?O:null;l=new da({stretchType:e,dynamicRangeAdjustment:q,
colorRamp:l,outputMin:0,outputMax:255,gamma:1===c?.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===e?l.maxPercent=l.minPercent=.25:"standard-deviation"===e&&(l.numberOfStandardDeviations=2);if(!q&&(null!=a.multidimensionalInfo||b?.includeStatisticsInStretch))if("percent-clip"===e)l.histograms=g;else if("min-max"===e||"standard-deviation"===e)l.statistics=f;return l}function F(a,b){var {multidimensionalInfo:d}=a;if(!b||!d)return a;d=d.variables.find(c=>c.name===b);if(!d)return a;a=a.clone();if(d){const {statistics:c,
histograms:e}=d;c?.length&&(a.statistics=c.map(f=>({min:f.min,max:f.max,avg:f.avg,stddev:f.stddev})));e?.length&&(a.histograms=e)}return a}function M(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];({bandInfos:a}=a);let d;if(a.length===b){const {red:c,green:e,blue:f,nir:g}=P(a);null!=c&&null!=e&&null!=f?d=[c,e,f]:null!=g&&null!=c&&null!=e&&(d=[g,c,e])}!d&&3<=b&&(d=[0,1,2]);return d}function P(a){const b={};for(let e=0;e<a.length;e++){var d=a[e],c=d.name.toLowerCase();"red"===c?b.red=
e:"green"===c?b.green=e:"blue"===c?b.blue=e:"nearinfrared"===c||"nearinfrared_1"===c||"nir"===c?b.nir=e:d.maxWavelength&&d.minWavelength&&(c=d.minWavelength,d=d.maxWavelength,null==b.blue&&410<=c&&480>=c&&480<=d&&540>=d?b.blue=e:null==b.green&&490<=c&&560>=c&&560<=d&&610>=d?b.green=e:null==b.red&&595<=c&&670>=c&&660<=d&&730>=d?b.red=e:null==b.nir&&700<=c&&860>=c&&800<=d&&950>=d&&(b.nir=e))}return b}function ka(a){let b="percent-clip";const {pixelType:d,dataType:c,histograms:e,statistics:f,multidimensionalInfo:g}=
a;a=N.has(c)||"generic"===c&&null!=g;"u8"!==d||"processed"!==c&&null!=e&&null!=f?"u8"===d||"elevation"===c||a?b="min-max":null!=e?b="percent-clip":null!=f&&(b="min-max"):b="none";return b}function Q(a,b,d,c){if(!r.isUVRendererSupported(a,b))return null;const {attributeTable:e,statistics:f}=a,g=G(e,b),q=z(e,"red"),l=z(e,"green"),p=z(e,"blue");a=new I;const t=[],w=new Set,v=!!(q&&l&&p);if(null!=e)e.features.forEach(m=>{var n=m.attributes[g.name];w.has(m.attributes[g.name])||null==n||(w.add(n),n=!v||
"single"!==q.type&&"double"!==q.type||"single"!==l.type&&"double"!==l.type||"single"!==p.type&&"double"!==p.type||e.features.some(h=>1<h.attributes[q.name]||1<h.attributes[l.name]||1<h.attributes[p.name])?1:255,t.push(new J({value:m.attributes[g.name],label:m.attributes[g.name]+"",symbol:{type:"simple-fill",style:"solid",outline:null,color:v?new B([m.attributes[q.name]*n,m.attributes[l.name]*n,m.attributes[p.name]*n,1]):new B([0,0,0,0])}})))});else if(f?.[0])for(b=f[0].min;b<=f[0].max;b++)t.push(new J({value:b,
label:b.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new B([0,0,0,0])}}));t.sort((m,n)=>m.value&&"string"===typeof m.value.valueOf()?0:m.value>n.value?1:-1);if(!v){const m=E.convertColorRampToColormap(R,{numColors:t.length});t.forEach((n,h)=>n.symbol.color=new B(m[h].slice(1,4)));a.colorRamp=R}if(d||c){const m=d||E.convertColorRampToColormap(c,{numColors:t.length}).map(n=>n.slice(1));t.forEach((n,h)=>n.symbol.color=new B(m[h]));a.colorRamp=c}return new ea({field:g.name,uniqueValueInfos:t,
authoringInfo:a})}function G(a,b,d){let c;null!=a?(c=b?a.fields.find(e=>b.toLowerCase()===e.name.toLowerCase()):la(a.fields),c||(d||(c=a.fields.find(e=>"string"===e.type)),c||=z(a,"value"))):c=new Y({name:"value"});return c}function la(a){let b;for(let d=0;d<a.length;d++){const c=a[d].name.toLowerCase();if("string"===a[d].type){if(c.startsWith("class")){b=a[d];break}null==b&&(c.endsWith("name")||c.endsWith("type"))&&(b=a[d])}}return b}function z(a,b){return null==a?null:a.fields.find(d=>d.name.toLowerCase()===
b)}function S(a){if(!r.isColormapRendererSupported(a))return null;let b;const {attributeTable:d,colormap:c}=a;if(null!=d){const e=z(d,"value"),f=G(d,null,!0);"string"===f.type&&(b={},d.features.forEach(g=>{g=g.attributes;b[g[e.name]]=f?g[f.name]:g[e.name]}))}return fa.createFromColormap(c,b)}function T(a,b,d){let c=0,e=0;null!=a.attributeTable?(a=a.attributeTable,c=e=a.features[0].attributes[b.name],a.features.forEach(f=>{f=f.attributes[b.name];f<c&&(c=f);f>e&&(e=f)})):null!=a.histograms&&(a=a.histograms,
c=a[0].min,e=a[0].max);return(e-c)/d}function U(a){if(!r.isVectorFieldRendererSupported(a))return null;if(null!=a.statistics&&a.statistics.length&&("vector-magdir"===a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:d,maxMagnitude:c}=H(a.dataType,a.statistics);var b=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:d,maxDataValue:c}]}a=null!=a.multidimensionalInfo?ma.get(a.multidimensionalInfo.variables[0].unit):null;b=new ja({visualVariables:b,inputUnit:a,rotationType:"geographic"});
b.visualVariables=[...b.sizeVariables,...b.rotationVariables];return b}function V(a){return{color:a.symbolLayers[0].material?.color,type:"esriSFS",style:"esriSFSSolid"}}function H(a,b){if("vector-magdir"===a)a=b[0].min,b=b[0].max;else{const d=b[0].min,c=b[0].max,e=b[1].min;b=b[1].max;a=0;b=Math.max(Math.abs(d),Math.abs(e),Math.abs(c),Math.abs(b))}return{minMagnitude:a,maxMagnitude:b}}const O=K.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],
toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),R=K.fromJSON(E.predefinedJsonColorRamps[0]),N=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" ")),ma=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);k.createClassBreaksRenderer=function(a,b){a=F(a,b?.variableName);const {attributeTable:d}=a;if(!r.isClassBreaksSupported(a))return null;
const c=null!=a.histograms?a.histograms[0]:null,e=null!=b?.numClasses&&isFinite(b?.numClasses)?b.numClasses:5,f=new I({classificationMethod:b?.classificationMethod,colorRamp:b?.colorRamp});let g=b?.field||"value";const q=[],l=[],p=null!=d,t=p&&d.fields.find(h=>"count"===h.name.toLowerCase()),w=p?d.fields.find(h=>h.name.toLowerCase()===g.toLowerCase()):void 0;if(w&&p){g=w.name;const h=d.features.length;let A=0;d.features.forEach(u=>A+=(t?u.attributes[t.name]:50)/h);d.features.forEach(u=>{const C=u.attributes[w.name];
u=t?u.attributes[t.name]:50;if(0<u){l.push(u);u=Math.max(1,Math.round(u/h/A*1E3));for(let D=0;D<u;D++)q.push(C)}})}else{var {pixelType:v}=a;const h=(c.max-c.min)/c.size,A=(v=v.includes("s")||v.includes("u"))&&1===h?Math.floor(c.min+.5):c.min,u=v&&1===h?Math.floor(c.max-.5):c.max,C=c.size;let D=0,W;c.counts.forEach(x=>D+=x/C);c.counts.forEach((x,y)=>{if(0<x)for(l.push(x),x=Math.max(1,Math.round(x/C/D*1E3)),W=p?d.features[y].attributes[w.name]:0===y?A:y===C-1?u:c.min+h*(y+.5),y=0;y<x;y++)q.push(W)})}v=
b?.classificationMethod||"natural-breaks";let m=b?.definedInterval;"defined-interval"!==v||m||(m=T(a,w,e));a=ca.createGenerateRendererClassBreaks({values:q,valueFrequency:l,normalizationTotal:null,definition:new ba({classificationMethod:v,breakCount:e,definedInterval:m})});let n=b?.colors;n||(b=b?.colorRamp||O,f.colorRamp=b,n=E.convertColorRampToColormap(b,{numColors:a.classBreaks.length,interpolateAlpha:!0}).map(h=>h.slice(1)));b=a.classBreaks.map((h,A)=>new aa({minValue:h.minValue,maxValue:h.maxValue,
label:h.label,symbol:{type:"simple-fill",color:n[A]}}));return new ia({field:g,classBreakInfos:b,authoringInfo:f})};k.createColormapRenderer=S;k.createDefaultRenderer=function(a,b){const {attributeTable:d,colormap:c}=a;if(r.isVectorFieldRendererSupported(a)){var e=U(a);if(null!=e)return e}return null!=c&&(e=S(a),null!=e)||null!=d&&(e=Q(a),null!=e)?e:L(a,b)};k.createFlowRenderer=function(a){if(!r.isFlowRendererSupported(a))return null;let b;if(null!=a.statistics&&0<a.statistics.length&&("vector-magdir"===
a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:d,maxMagnitude:c}=H(a.dataType,a.statistics);b=[{type:"color",field:"Magnitude",stops:[{value:d,color:"#1020C0"},{value:c,color:"#C02010"}]}]}return new Z({visualVariables:b})};k.createShadedReliefRenderer=function(a,b="traditional"){if(!r.isShadedReliefRendererSupported(a))return null;({extent:a}=a);a=a.width*X.getMetersPerUnitForSR(a.spatialReference);return new ha({hillshadeType:b,scalingType:5E6<a?"adjusted":"none"})};k.createStretchRenderer=
L;k.createUVRenderer=Q;k.createVectorFieldRenderer=U;k.estimateMagnitudeRange=H;k.getBandNames=function(a,b){const d=a.bandInfos.map(({name:c})=>c);return b?.length?b.map(c=>d[c]):d};k.getClassField=G;k.getDefaultBandCombination=M;k.getDefaultInterpolation=function(a,b,d){const c=["nearest","bilinear","cubic","majority"].find(e=>e===d?.toLowerCase());return"Map"===b?c??"bilinear":"standard-time"===a.dataType?c??"nearest":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===c||"majority"===
c?c:"nearest":c??"bilinear"};k.getDefinedInterval=T;k.getField=z;k.getSupportedRendererTypes=function(a,b=!1){const d=["raster-stretch"];r.isColormapRendererSupported(a,b)&&d.push("raster-colormap");r.isUVRendererSupported(a)&&d.push("unique-value");r.isClassBreaksSupported(a,b)&&d.push("class-breaks");r.isShadedReliefRendererSupported(a)&&d.push("raster-shaded-relief");r.isVectorFieldRendererSupported(a)&&d.push("vector-field");r.isFlowRendererSupported(a)&&d.push("flow");return d};k.getVariableRasterInfo=
F;k.getWellKnownBandIndexes=P;k.normalizeRendererJSON=function(a){if("uniqueValue"===a.type){var b=a.uniqueValueInfos;b?.[0].symbol?.symbolLayers?.length&&(a.uniqueValueInfos=b?.map(d=>({value:d.value,label:d.label,symbol:d.symbol?V(d.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,b[0].symbol?.symbolLayers?.length&&(a.classBreakInfos=b.map(d=>({classMinValue:d.classMinValue,classMaxValue:d.classMaxValue,label:d.label,symbol:d.symbol?V(d.symbol):null}))));return a};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})});