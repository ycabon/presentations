// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../request ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../layers/support/RasterInfo ../utils ../support/FeatureSet".split(" "),function(l,e,x,z,A,B,r,C){async function y(c,b,a){c=r.parseUrl(c);const {rasterFunction:t,sourceJSON:D}=b||{};b=t?JSON.stringify(t.rasterFunctionDefinition||t):null;b=r.encode({...c.query,renderingRule:b,f:"json"});b=r.asValidOptions(b,a);c=c.path;a=D||await e(c,b).then(f=>f.data);var d=a.hasRasterAttributeTable?e(`${c}/rasterAttributeTable`,
b):null,g=a.hasColormap?e(`${c}/colormap`,b):null,m=a.hasHistograms?e(`${c}/histograms`,b):null,h=10.3<=a.currentVersion?e(`${c}/keyProperties`,b):null;c=a.hasMultidimensions?e(`${c}/multidimensionalInfo`,b):null;d=await Promise.allSettled([d,g,m,h,c]);c=null;if(a.minValues&&a.minValues.length===a.bandCount)for(c=[],b=0;b<a.minValues.length;b++)c.push({min:a.minValues[b],max:a.maxValues[b],avg:a.meanValues[b],stddev:a.stdvValues[b]});g=x.fromJSON(a.extent);b=Math.ceil(g.width/a.pixelSizeX-.1);g=Math.ceil(g.height/
a.pixelSizeY-.1);m=A.fromJSON(a.spatialReference||a.extent.spatialReference);h="fulfilled"===d[0].status?d[0].value?.data:null;h=h?.features?.length?C.fromJSON(h):null;var n="fulfilled"===d[1].status?d[1].value?.data.colormap:null;n=n?.length?n:null;var p="fulfilled"===d[2].status?d[2].value?.data.histograms:null;p=p?.[0]?.counts?.length?p:null;const k="fulfilled"===d[3].status?d[3].value?.data??{}:{};d="fulfilled"===d[4].status?d[4].value?.data.multidimensionalInfo:null;(d=d?.variables?.length?d:
null)&&d.variables.forEach(f=>{f.statistics?.length&&f.statistics.forEach(q=>{q.avg=q.mean;q.stddev=q.standardDeviation})});const {defaultVariable:u,serviceDataType:v}=a;u&&u!==k.DefaultVariable&&(k.DefaultVariable=u);v?.includes("esriImageServiceDataTypeVector")&&!v.includes(k.DataType)&&(k.DataType=v.replace("esriImageServiceDataType",""));let w=a.noDataValue;a.noDataValues?.length&&a.noDataValues.some(f=>f!==w)&&(w=a.noDataValues);return new B({width:b,height:g,bandCount:a.bandCount,extent:x.fromJSON(a.extent),
spatialReference:m,pixelSize:new z({x:a.pixelSizeX,y:a.pixelSizeY,spatialReference:m}),pixelType:a.pixelType.toLowerCase(),statistics:c,attributeTable:h,colormap:n,histograms:p,keyProperties:k,noDataValue:w,multidimensionalInfo:d})}l.fetchServiceRasterInfo=function(c,b,a){return y(c,{sourceJSON:b},a)};l.generateRasterInfo=function(c,b,a){return y(c,{rasterFunction:b},a)};l.patchServiceInfo=function(c,b){c.attributeTable||(b.hasRasterAttributeTable=!1);c.histograms||(b.hasHistograms=!1);c.colormap||
(b.hasColormap=!1);c.multidimensionalInfo||(b.hasMultidimensions=!1)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});