// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../kernel ../request ../core/Error ../core/jsonMap ../core/screenUtils ../core/urlUtils ../geometry/Polygon ../layers/support/fieldUtils ../layers/support/floorFilterUtils ../renderers/visualVariables/support/visualVariableUtils ./utils ./geoprocessor/execute ./geoprocessor/submitJob ./support/fileFormat ./support/layoutTemplate ./support/printTaskUtils ./support/PrintTemplate ./support/reportTemplate".split(" "),function(y,D,J,Q,K,w,z,R,S,T,U,E,V,W,X,Y,u,Z,aa){async function L(a,
b){b=b||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};var d=a.template||new Z;null==d.showLabels&&(d.showLabels=!0);var c=d.exportOptions,f=Y.toJSON(d.layout);if(c){var h={dpi:c.dpi};if("map_only"===f.toLowerCase()||""===f){var e=c.width;c=c.height;h.outputSize=null!=e&&null!=c?[e,c]:void 0}}e=d.layoutOptions;let g;if(e){if("Miles"===e.scalebarUnit||"Kilometers"===e.scalebarUnit){var k="Kilometers";var m="Miles"}else if("Meters"===e.scalebarUnit||"Feet"===e.scalebarUnit)k="Meters",m="Feet";
g={titleText:e.titleText,authorText:e.authorText,copyrightText:e.copyrightText,customTextElements:e.customTextElements,elementOverrides:e.elementOverrides,scaleBarOptions:{metricUnit:M.toJSON(k),metricLabel:k?N[k]:void 0,nonMetricUnit:M.toJSON(m),nonMetricLabel:m?N[m]:void 0}}}k=null;e?.legendLayers&&(k=e.legendLayers.map(n=>{var l=n.layerId;b.legendLayerNameMap[l]=n.title;l={id:l};n.subLayerIds&&(l.subLayerIds=n.subLayerIds);return l}));m=await ba(a,d,b);if(m.operationalLayers){const n=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),
l=/[\u0600-\u06FF]/;e=q=>{const r=q.text;q=q.font;const p=q?.family?.toLowerCase();r&&q&&("arial"===p||"arial unicode ms"===p)&&(q.family=n.test(r)?"Arial Unicode MS":"Arial","normal"!==q.style&&l.test(r)&&(q.family="Arial Unicode MS"))};c=()=>{throw new Q("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap");};for(const q of m.operationalLayers)if(q.featureCollection?.layers)for(const r of q.featureCollection.layers){if(r.layerDefinition?.drawingInfo?.renderer?.symbol){const p=
r.layerDefinition.drawingInfo.renderer;"esriTS"===p.symbol.type?e(p.symbol):"CIMSymbolReference"!==p.symbol.type||b.is11xService||c()}if(r.featureSet?.features)for(const p of r.featureSet.features)p.symbol&&("esriTS"===p.symbol.type?e(p.symbol):"CIMSymbolReference"!==p.symbol.type||b.is11xService||c())}else!b.is11xService&&q.layerDefinition?.drawingInfo?.renderer&&JSON.stringify(q.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&c()}a.outSpatialReference&&(m.mapOptions.spatialReference=
a.outSpatialReference.toJSON());Object.assign(m,{exportOptions:h,layoutOptions:g||{}});Object.assign(m.layoutOptions,{legendOptions:{operationalLayers:null!=k?k:b.legendLayers.slice()}});b.legendLayers.length=0;C.set(b.gpServerUrl,b);h={Web_Map_as_JSON:JSON.stringify(m),Format:X.toJSON(d.format),Layout_Template:f,Layout_Item_ID:void 0,Report_Template:aa.toJSON(d.report),Report_Item_ID:void 0};d.layoutItem&&(delete h.Layout_Template,f=d.layoutItem,await f.load(),"public"!==f.access&&D.id&&await D.id.getCredential(b.gpServerUrl),
h.Layout_Item_ID=JSON.stringify({id:f.id}));d.reportItem&&(delete h.Report_Template,d=d.reportItem,await d.load(),"public"!==d.access&&D.id&&await D.id.getCredential(b.gpServerUrl),h.Report_Item_ID=JSON.stringify({id:d.id}));a.extraParameters&&Object.assign(h,a.extraParameters);return h}async function ba(a,b,d){var c=a.view;let f=c.spatialReference;const h={operationalLayers:await ca(c,b,d)};b.includeTables&&(h.tables=await da(c));a=d.ssExtent||a.extent||c.extent;f&&f.isWrappable&&(a=a.clone()._normalize(!0),
f=a.spatialReference);h.mapOptions={extent:a&&a.toJSON(),spatialReference:f&&f.toJSON(),showAttribution:b.attributionVisible};d.ssExtent=null;c.background&&(h.background=c.background.toJSON());c.rotation&&(h.mapOptions.rotation=-c.rotation);b.scalePreserved&&(h.mapOptions.scale=b.outScale||c.scale);null!=c.timeExtent&&(d=null!=c.timeExtent.start?c.timeExtent.start.getTime():null,c=null!=c.timeExtent.end?c.timeExtent.end.getTime():null,h.mapOptions.time=[d,c]);b.reportOptions&&(h.reportOptions=b.reportOptions);
return h}function I(a){const b=a.lastIndexOf("/GPServer/");0<b&&(a=a.slice(0,b+9));return a}async function ca(a,b,d){const c=[],f={layerView:null,printTemplate:b,view:a};let h=0;b.scalePreserved&&(h=b.outScale||a.scale);var e=u.getVisibleLayerViews(a,h);for(const n of e)if(e=n.layer,e.loaded&&"group"!==e?.type){var g=void 0;f.layerView=n;if(u.isScreenshotRequired(n))g=await A(e,f,d);else if(u.isBingMapsLayer(e))g={culture:e.culture,key:e.key,type:`BingMaps${"aerial"===e.style?"Aerial":"hybrid"===
e.style?"Hybrid":"Road"}`};else if(u.isCSVLayer(e))g=await ea(e,f,d);else if("feature"===e?.type)g=await fa(e,f,d);else if("geojson"===e?.type)g=await ha(e,f,d);else if("graphics"===e?.type)g=await ia(e,f,d);else if("imagery"===e?.type){var k=void 0;g=e;var m=d;g.legendEnabled&&m.legendLayers.push({id:g.id});k=g.write();k={layerType:k.layerType,customParameters:k.customParameters};k.bandIds=g.bandIds;k.compressionQuality=g.compressionQuality;k.format=g.format;k.interpolation=g.interpolation;if(g.mosaicRule||
g.definitionExpression)k.mosaicRule=g.exportImageServiceParameters.mosaicRule.toJSON();if(g.rasterFunction||g.renderer)if(m.is11xService)g.rasterFunction&&(k.renderingRule=g.rasterFunction.toJSON()),g.renderer&&(k.layerDefinition=k.layerDefinition||{},k.layerDefinition.drawingInfo=k.layerDefinition.drawingInfo||{},k.layerDefinition.drawingInfo.renderer=g.renderer.toJSON());else if(m=g.exportImageServiceParameters.combineRendererWithRenderingRule())k.renderingRule=m.toJSON();B(k,g);g=k}else"imagery-tile"===
e?.type?g=await ja(e,f,d):"kml"===e?.type?g=await ka(e,f,d):"map-image"===e?.type?g=la(e,f,d):"map-notes"===e?.type?g=await ma(f,d):"open-street-map"===e?.type?g={type:"OpenStreetMap"}:"stream"===e?.type?g=await na(e,f,d):"tile"===e?.type?(k=void 0,g=e,g.legendEnabled&&d.legendLayers.push({id:g.id}),k=g.write(),k={layerType:k.layerType,customParameters:k.customParameters},B(k,g),g=k):"vector-tile"===e?.type?g=await oa(e,f,d):"web-tile"===e?.type?(g={type:"WebTiledLayer",urlTemplate:e.urlTemplate?.replace(/\${/g,
"{"),credits:e.copyright},e.subDomains&&0<e.subDomains.length&&(g.subDomains=e.subDomains)):"wms"===e?.type?g=pa(e,d):"wmts"===e?.type?(g=e.activeLayer,g={type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:g.imageFormat,layer:g.id,style:g.styleId,tileMatrixSet:g.tileMatrixSetId,url:z.normalize(e.url)}):g=await A(e,f,d);g&&(Array.isArray(g)?c.push(...g):(g.id=e.id,g.title=d.legendLayerNameMap[e.id]||e.title,g.opacity=n.fullOpacity,g.minScale=e.minScale||
0,g.maxScale=e.maxScale||0,u.isBlendLayer(e)&&e.blendMode&&"normal"!==e.blendMode&&(g.blendMode=e.blendMode),c.push(g)))}if(h)for(const n of c)n.minScale=0,n.maxScale=0;a.graphics?.length&&(a=await v(null,a.graphics,b,d))&&c.push(a);return c}async function ea(a,b,d){a.legendEnabled&&d.legendLayers.push({id:a.id});var c=b.layerView;b=b.printTemplate;if(!d.is11xService||c.filter||a.portalItem&&"public"!==a.portalItem.access)return c=await F(c),v(a,c,b,d);d={type:"CSV"};a.write(d,{origin:"web-map"});
delete d.popupInfo;delete d.layerType;d.showLabels=b.showLabels&&a.labelsVisible;return d}async function v(a,b,d,c){let f;const h=u.createPolygonLayer(),e=u.createPolylineLayer(),g=u.createPointLayer(),k=u.createMultipointLayer(),m=u.createPointLayer();m.layerDefinition.name="textLayer";delete m.layerDefinition.drawingInfo;if(a){"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass?h.layerDefinition.name=e.layerDefinition.name=g.layerDefinition.name=k.layerDefinition.name=
c.legendLayerNameMap[a.id]||a.get("arcgisProps.title")||a.title:"esri.layers.GraphicsLayer"===a.declaredClass&&(b=a.graphics.items);if(a.renderer){var n=a.renderer.toJSON(),l=h.layerDefinition.drawingInfo;l&&(l.renderer=n);if(l=e.layerDefinition.drawingInfo)l.renderer=n;if(l=g.layerDefinition.drawingInfo)l.renderer=n;if(l=k.layerDefinition.drawingInfo)l.renderer=n}if(d.showLabels&&a.labelsVisible&&"function"===typeof a.write&&(n=a.write({},{origin:"web-map"}).layerDefinition?.drawingInfo?.labelingInfo)){f=
!0;if(l=h.layerDefinition.drawingInfo)l.labelingInfo=n;if(l=e.layerDefinition.drawingInfo)l.labelingInfo=n;if(l=g.layerDefinition.drawingInfo)l.labelingInfo=n;if(l=k.layerDefinition.drawingInfo)l.labelingInfo=n}}a?.renderer||f||(delete h.layerDefinition.drawingInfo,delete e.layerDefinition.drawingInfo,delete g.layerDefinition.drawingInfo,delete k.layerDefinition.drawingInfo);n=a?.fieldsIndex;l=a?.renderer;if(n){var q=new Set;f&&await S.collectLabelingFields(q,a);l&&"function"===typeof l.collectRequiredFields&&
await l.collectRequiredFields(q,n);q=Array.from(q);n=n.fields.map(p=>p.toJSON());h.layerDefinition.fields=n;e.layerDefinition.fields=n;g.layerDefinition.fields=n;k.layerDefinition.fields=n}n=b?.length;for(let p=0;p<n;p++){const t=b[p]||b.at(p);if(!1!==t.visible&&t.geometry&&(l=t.toJSON(),l.hasOwnProperty("popupTemplate")&&delete l.popupTemplate,l.geometry?.z&&delete l.geometry.z,!l.symbol?.outline||"esriCLS"!==l.symbol.outline.type||c.is11xService)){!c.is11xService&&l.symbol?.outline?.color?.[3]&&
(l.symbol.outline.color[3]=255);var r=a?.renderer&&("valueExpression"in a.renderer&&a.renderer.valueExpression||"hasVisualVariables"in a.renderer&&a.renderer.hasVisualVariables());if(!l.symbol&&a?.renderer&&r&&!c.is11xService){r=a.renderer;const x=await r.getSymbolAsync(t);if(!x)continue;l.symbol=x.toJSON();"hasVisualVariables"in r&&r.hasVisualVariables()&&u.applyVisualVariables(l.symbol,{renderer:r,graphic:t,symbol:x})}l.symbol&&(l.symbol.angle||delete l.symbol.angle,G(l.symbol)?l.symbol=await H(l.symbol,
c):l.symbol.text&&delete l.attributes);if((!d||!d.forceFeatureAttributes)&&q?.length){r={};for(const x of q)l.attributes?.hasOwnProperty(x)&&(r[x]=l.attributes[x]);l.attributes=r}"polygon"===t.geometry.type?h.featureSet.features.push(l):"polyline"===t.geometry.type?e.featureSet.features.push(l):"point"===t.geometry.type?l.symbol?.text?m.featureSet.features.push(l):g.featureSet.features.push(l):"multipoint"===t.geometry.type?k.featureSet.features.push(l):"extent"===t.geometry.type&&(l.geometry=R.fromExtent(t.geometry).toJSON(),
h.featureSet.features.push(l))}}a=[h,e,k,g,m].filter(p=>0<p.featureSet.features.length);for(const p of a){if((b=p.featureSet.features.every(t=>t.symbol))&&(!d||!d.forceFeatureAttributes))for(const t of p.featureSet.features)delete t.attributes;b&&delete p.layerDefinition.drawingInfo;p.layerDefinition.drawingInfo?.renderer&&await O(p.layerDefinition.drawingInfo.renderer,c)}return a.length?{featureCollection:{layers:a},showLabels:f}:null}async function fa(a,b,d){const c=a.renderer;var f=parseFloat(d.cimVersion);
if("binning"===a.featureReduction?.type||"cluster"===a.featureReduction?.type&&(!d.is11xService||2.9>f)||"pie-chart"===c?.type||"dot-density"===c?.type&&(!d.is11xService||2.6>f))return A(a,b,d);a.legendEnabled&&d.legendLayers.push({id:a.id});f=b.layerView;const {printTemplate:h,view:e}=b;b=c&&("valueExpression"in c&&c.valueExpression||"hasVisualVariables"in c&&c.hasVisualVariables());const g="feature-layer"!==a.source?.type&&"ogc-feature"!==a.source?.type;if(!d.is11xService&&b||f.filter||g||!c||"field"in
c&&null!=c.field&&("string"!==typeof c.field||!a.getField(c.field)))f=await F(f),b=await v(a,f,h,d);else if(b=a.write(),b={id:b.id,title:b.title,url:b.url,layerType:b.layerType,customParameters:b.customParameters,layerDefinition:b.layerDefinition,charts:h.includeCharts?b.charts:void 0},b.showLabels=h.showLabels&&a.labelsVisible,B(b,a),b.layerDefinition?.drawingInfo?.renderer&&(delete b.layerDefinition.minScale,delete b.layerDefinition.maxScale,await O(b.layerDefinition.drawingInfo.renderer,d),"visualVariables"in
c&&c.visualVariables&&c.visualVariables[0]&&(a=c.visualVariables[0],"size"===a.type&&a.maxSize&&"number"!==typeof a.maxSize&&a.minSize&&"number"!==typeof a.minSize&&(a=U.getSizeRangeAtScale(a,e.scale),b.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=a.minSize,b.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=a.maxSize))),a=T.getFloorFilterClause(f))b.layerDefinition||(b.layerDefinition={}),b.layerDefinition.definitionExpression=b.layerDefinition.definitionExpression?
`(${b.layerDefinition.definitionExpression}) AND (${a})`:a;return b}async function ha(a,b,d){if("binning"===a.featureReduction?.type||"cluster"===a.featureReduction?.type)return A(a,b,d);a.legendEnabled&&d.legendLayers.push({id:a.id});const c=await F(b.layerView);return v(a,c,b.printTemplate,d)}async function ia(a,{printTemplate:b},d){return v(a,null,b,d)}async function ja(a,b,d){if("flow"===a.renderer?.type)return A(a,b,d);a.legendEnabled&&d.legendLayers.push({id:a.id});b=a.write()||{};b={bandIds:b.bandIds,
customParameters:b.customParameters,interpolation:b.interpolation,layerDefinition:b.layerDefinition,layerType:"ArcGISImageServiceLayer"};B(b,a);return b}async function ka(a,b,d){const c=b.printTemplate;if(d.is11xService)return d={type:"kml"},a.write(d,{origin:"web-map"}),delete d.layerType,d.url=z.normalize(a.url),d;const f=[],h=b.layerView;h.allVisibleMapImages.forEach((e,g)=>{g={id:`${a.id}_image${g}`,type:"image",title:a.id,minScale:a.minScale||0,maxScale:a.maxScale||0,opacity:h.fullOpacity,extent:e.extent};
"data:image/png;base64,"===e.href.substr(0,22)?g.imageData=e.href.substr(22):g.url=e.href;f.push(g)});b=[...h.allVisiblePoints.items,...h.allVisiblePolylines.items,...h.allVisiblePolygons.items];d={id:a.id,...(await v(null,b,c,d))};f.push(d);return f}function la(a,{view:b},d){let c;const f={id:a.id,subLayerIds:[]};let h=[];const e=b.scale,g=k=>{var m=0===e;const n=0===k.minScale||e<=k.minScale,l=0===k.maxScale||e>=k.maxScale;k.visible&&(m||n&&l)&&(k.sublayers?k.sublayers.forEach(g):(m=k.toExportImageJSON(),
h.unshift({id:k.id,name:k.title,layerDefinition:{drawingInfo:m.drawingInfo,definitionExpression:m.definitionExpression,source:m.source}}),f.subLayerIds.push(k.id)))};a.sublayers&&a.sublayers.forEach(g);h.length&&(h=h.map(({id:k,name:m,layerDefinition:n})=>({id:k,name:m,layerDefinition:n})),c=(k=>({layerType:k.layerType,customParameters:k.customParameters}))(a.write()),c.layers=h,c.visibleLayers=a.capabilities?.exportMap?.supportsDynamicLayers?void 0:f.subLayerIds,B(c,a),a.legendEnabled&&d.legendLayers.push(f));
return c}async function ma({layerView:a,printTemplate:b},d){const c=[];a=a.layer;if(null!=a.featureCollections)for(var f of a.featureCollections){var h=await v(f,f.source,b,d);h&&c.push(...h.featureCollection.layers)}else if(null!=a.sublayers)for(h of a.sublayers)(f=await v(null,h.graphics,b,d))&&c.push(...f.featureCollection.layers);return{featureCollection:{layers:c}}}async function A(a,{printTemplate:b,view:d},c){const f={type:"image"};a={format:"png",ignoreBackground:!0,layers:[a],rotation:0};
const h=c.ssExtent||d.extent.clone();let e=96,g=!0,k=!0;if(b.exportOptions){const m=b.exportOptions;null!=m.dpi&&0<m.dpi&&(e=m.dpi);null!=m.width&&0<m.width&&(g=m.width%2===d.width%2);null!=m.height&&0<m.height&&(k=m.height%2===d.height%2)}"map-only"!==b.layout||!b.scalePreserved||b.outScale&&b.outScale!==d.scale||96!==e||g&&k||(a.area={x:0,y:0,width:d.width,height:d.height},g||--a.area.width,k||--a.area.height,c.ssExtent||(b=d.toMap(w.createScreenPoint(a.area.width,a.area.height)),h.ymin=b.y,h.xmax=
b.x,c.ssExtent=h));f.extent=h.clone()._normalize(!0).toJSON();d=await d.takeScreenshot(a);f.imageData=z.dataComponents(d.dataUrl)?.data;return f}async function na(a,{layerView:b,printTemplate:d},c){a.legendEnabled&&c.legendLayers.push({id:a.id});b=await F(b);return v(a,b,d,c)}async function da(a){const b=[],d=[];for(const c of a.map.allTables)"feature"!==c.type||c.loaded||d.push(c.load());d.length&&await Promise.allSettled(d);for(const c of a.map.allTables)"feature"===c.type&&c.loaded&&c.isTable&&
"feature-layer"===c.source?.type&&(a=c.write(),a={id:a.id,title:a.title,customParameters:a.customParameters,layerDefinition:{definitionExpression:a.layerDefinition?.definitionExpression},url:a.url},B(a,c),b.push(a));return b.length?b:void 0}async function oa(a,b,d){if(d.is11xService&&a.serviceUrl&&a.styleUrl){const c=E.getToken(a.styleUrl,a.apiKey),f=E.getToken(a.serviceUrl,a.apiKey);if(!c&&!f||"2.1.0"!==d.cimVersion)return b={type:"VectorTileLayer"},b.styleUrl=z.normalize(a.styleUrl),b.token=c,f!==
c&&(b.additionalTokens=[{url:a.serviceUrl,token:f}]),b}return A(a,b,d)}function pa(a,b){let d;const c=[],f=h=>{h.visible&&(h.sublayers?h.sublayers.forEach(f):h.name&&c.unshift(h.name))};a.sublayers&&a.sublayers.forEach(f);c.length&&(a.legendEnabled&&b.legendLayers.push({id:a.id,subLayerIds:c}),d={type:"wms",customLayerParameters:a.customLayerParameters,customParameters:a.customParameters,transparentBackground:a.imageTransparency,visibleLayers:c,url:z.normalize(a.url),version:a.version});return d}
function B(a,b){b.url&&(a.url=z.normalize(a.url||b.url),a.token=E.getToken(a.url,b.apiKey))}async function H(a,b){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=1024;b.canvas.height=1024;b=b.canvas.getContext("2d");if(a.path){var d=new Path2D(a.path);d.closePath();b.fillStyle=Array.isArray(a.color)?`rgba(${a.color[0]},${a.color[1]},${a.color[2]},${a.color[3]/255})`:"rgb(0,0,0)";b.fill(d);var c=u.getContextBoundingBox(b);if(!c)return null;b.clearRect(0,0,1024,1024);var f=w.pt2px(a.size)/
Math.max(c.width,c.height);b.scale(f,f);var h=1024/f;b.translate(h/2-c.width/2-c.x,h/2-c.height/2-c.y);Array.isArray(a.color)&&b.fill(d);a.outline?.width&&Array.isArray(a.outline.color)&&(h=a.outline,b.lineWidth=w.pt2px(h.width)/f,b.lineJoin="round",b.strokeStyle=`rgba(${h.color[0]},${h.color[1]},${h.color[2]},${h.color[3]/255})`,b.stroke(d),c.width+=b.lineWidth,c.height+=b.lineWidth);c.width*=f;c.height*=f;f=b.getImageData(512-c.width/2,512-c.height/2,Math.ceil(c.width),Math.ceil(c.height));d=f.width;
c=f.height;b.canvas.width=d;b.canvas.height=c;b.putImageData(f,0,0)}else f=(await J("image/svg+xml"===a.contentType?"data:image/svg+xml;base64,"+a.imageData:a.url,{responseType:"image"})).data,d=w.pt2px(a.width),c=w.pt2px(a.height),b.canvas.width=d,b.canvas.height=c,b.drawImage(f,0,0,b.canvas.width,b.canvas.height);return{type:"esriPMS",imageData:b.canvas.toDataURL("image/png").substr(22),angle:a.angle,contentType:"image/png",height:w.px2pt(c),width:w.px2pt(d),xoffset:a.xoffset,yoffset:a.yoffset}}
async function O(a,b){const d=a.type;if("simple"===d&&G(a.symbol))a.symbol=await H(a.symbol,b);else if("uniqueValue"===d||"classBreaks"===d)if(G(a.defaultSymbol)&&(a.defaultSymbol=await H(a.defaultSymbol,b)),a=a["uniqueValue"===d?"uniqueValueInfos":"classBreakInfos"])for(const c of a)G(c.symbol)&&(c.symbol=await H(c.symbol,b))}async function F(a){return a.queryFeatures(a.createQuery()).then(b=>b.features)}function G(a){return a&&(a.path||"image/svg+xml"===a.contentType||a.url?.endsWith(".svg"))}const N=
{Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},M=new K.JSONMap({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),P=new K.JSONMap({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),C=new Map;y.execute=async function(a,b,d){const c=I(a);let f=C.get(c);return Promise.resolve().then(()=>{if(f)return{data:f.gpMetadata};f={gpServerUrl:c,is11xService:!1,legendLayerNameMap:{},legendLayers:[]};return J(c,E.asValidOptions({f:"json"},d))}).then(h=>
{f.gpMetadata=h.data;f.cimVersion=f.gpMetadata.cimVersion;f.is11xService=!!f.cimVersion;C.set(c,f);return L(b,f)}).then(h=>{const e=f.gpMetadata?.executionType?P.fromJSON(f.gpMetadata.executionType):"sync";let g;const k=m=>"sync"===e?m.results?.[0]?.value:g.fetchResultData("Output_File",null,d).then(n=>n.value);return"async"===e?W.submitJob(a,h,void 0,d).then(m=>{g=m;return m.waitForJobCompletion({interval:b.updateDelay}).then(k)}):V.execute(a,h,void 0,d).then(k)})};y.getGpPrintParams=L;y.getGpServerUrl=
I;y.getMode=async function(a){a=I(a);a=C.get(a);return a.gpMetadata?.executionType?P.fromJSON(a.gpMetadata.executionType):"sync"};y.printCacheMap=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});