// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../request","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils"],function(f,n,p,q){function h(a,b){a=a.toJSON();a.objectIds&&(a.objectIds=a.objectIds.join(","));a.orderByFields&&(a.orderByFields=a.orderByFields.join(","));a.outFields&&!b?.returnCountOnly?a.outFields.includes("*")?a.outFields="*":a.outFields=a.outFields.join(","):delete a.outFields;a.outSR&&(a.outSR=p.srToRESTValue(a.outSR));a.dynamicDataSource&&(a.layer=JSON.stringify({source:a.dynamicDataSource}),
delete a.dynamicDataSource);return a}async function k(a,b,c={},d){b=q.mapParameters({...a.query,f:"json",...d,...h(b,d)});return n(a.path+"/queryRelatedRecords",{...c,query:{...c.query,...b}})}f.executeRelationshipQuery=async function(a,b,c){a=await k(a,b,c);b=a.data;c=b.geometryType;const d=b.spatialReference,g={};for(const e of b.relatedRecordGroups){const l={fields:void 0,objectIdFieldName:void 0,geometryType:c,spatialReference:d,hasZ:!!b.hasZ,hasM:!!b.hasM,features:e.relatedRecords};if(null!=
e.objectId)g[e.objectId]=l;else for(const m of Object.keys(e))"relatedRecords"!==m&&(g[e[m]]=l)}return{...a,data:g}};f.executeRelationshipQueryForCount=async function(a,b,c){a=await k(a,b,c,{returnCountOnly:!0});b=a.data;c={};for(const d of b.relatedRecordGroups)null!=d.objectId&&(c[d.objectId]=d.count);return{...a,data:c}};f.toQueryStringParameters=h;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});