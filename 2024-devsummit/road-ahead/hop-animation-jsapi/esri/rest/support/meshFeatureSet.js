// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../geometry/Extent ../../geometry/Mesh ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/MeshGeoreferencedVertexSpace ../../geometry/support/MeshLocalVertexSpace ../../geometry/support/MeshTransform ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet".split(" "),function(m,x,y,q,z,A,r,B,C,D,E,F,t,G,H){function I(a){return({attributes:b})=>
{if(!b)return{};if(!a)return b;for(const d in b)a.has(d)||delete b[d];return b}}function u(a,b,d,e,c){c=c.get(a.attributes[b]);if(null==c)return n().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",a),null;if(!a.geometry)return n().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",a),null;const {originPoint:h,originVector:g}=J(a,d,e);b=A.fromJSON(a.geometry);b.spatialReference=d;a=K(a.attributes,e);d=c.projectVertices?
new D({origin:g}):new E({origin:g});a:{c=Array.from(c.files.values());e=[];for(f of c){if(f.status!==k.COMPLETED){var f=null;break a}c=[];for(const l of f.parts){if(!l){f=null;break a}c.push(new t.ServiceAssetPart(l.url,l.hash))}e.push(new t.ServiceAsset(f.name,f.mimeType,c))}f=e}return f?r.createWithExternalSource(h,f,{extent:b,transform:a,vertexSpace:d}):r.createIncomplete(h,{extent:b,transform:a,vertexSpace:d})}function J({attributes:a},b,{transformFieldRoles:d}){const e=a[d.originX],c=a[d.originY];
a=a[d.originZ];return{originPoint:new B({x:e,y:c,z:a,spatialReference:b}),originVector:z.fromValues(e,c,a)}}function K(a,{transformFieldRoles:b}){return new F({translation:[a[b.translationX],-a[b.translationZ],a[b.translationY]],rotationAxis:[a[b.rotationX],-a[b.rotationZ],a[b.rotationY]],rotationAngle:a[b.rotationDeg],scale:[a[b.scaleX],a[b.scaleZ],a[b.scaleY]]})}function v(a,b){const d=new Map;for(const c of b){var e=c.parentGlobalId;if(null==e)continue;const h=c.assetName,g=c.assetType;b=c.assetHash;
const f=c.assetURL,l=c.conversionStatus,L=c.seqNo,w=G.getFormatIdMimeType(g,a.supportedFormats);w?(e=q.getOrCreateMapValue(d,e,()=>({projectVertices:c.flags.includes("PROJECT_VERTICES"),files:new Map})),q.getOrCreateMapValue(e.files,h,()=>{a:switch(l){case "COMPLETED":case "SUBMITTED":var p=k.COMPLETED;break a;case "INPROGRESS":p=k.PENDING;break a;default:p=k.FAILED}return{name:h,type:g,mimeType:w,status:p,parts:[]}}).parts[L]={hash:b,url:f}):n().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${g}, but it does not list it as a supported type`)}return d}
const n=()=>y.getLogger("esri.rest.support.meshFeatureSet");var k;(function(a){a[a.FAILED=0]="FAILED";a[a.PENDING=1]="PENDING";a[a.COMPLETED=2]="COMPLETED"})(k||={});m.assetMapFromAssetMapsJSON=v;m.extractMesh=u;m.meshFeatureSetFromJSON=function(a,b,d){var e=d.features;d.features=[];delete d.geometryType;const c=H.fromJSON(d);c.geometryType="mesh";if(!d.assetMaps)return c;const h=v(b,d.assetMaps),g=a.sourceSpatialReference??C.WGS84;d=d.globalIdFieldName;({outFields:a}=a);a=null!=a&&0<a.length?I(a.includes("*")?
null:new Set(a)):()=>({});for(const f of e)e=u(f,d,g,b,h),null!=e&&c.features.push(new x({geometry:e,attributes:a(f)}));return c};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});