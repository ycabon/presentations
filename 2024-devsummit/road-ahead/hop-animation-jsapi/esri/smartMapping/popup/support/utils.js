// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/arrayUtils ../../../core/has ../../../intl/messages ../../../intl/substitute ../../../layers/support/fieldUtils ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/RelationshipContent ../../../popup/content/TextContent ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../../../renderers/support/utils ../../../renderers/visualVariables/support/visualVariableUtils ../../support/adapters/support/utils".split(" "),
function(m,v,I,w,r,z,J,K,L,M,A,N,O,B,C,x,D,E,F){function y(a){return"hasVisualVariables"in a&&a.hasVisualVariables()?a.visualVariables.filter(b=>E.viewScaleRE.test(b.valueExpression)||"target"in b&&"outline"===b.target?!1:!0):[]}function p(a,b){return b?F.getFeatureReductionFields(a)?.find(n=>n.name.toLowerCase()===b.toLowerCase()):null}function q(a,b,n){let d=null;if(n){const e=a.featureReduction;e&&"popupTemplate"in e&&e.popupTemplate&&(d=e.popupTemplate.fieldInfos)}else"popupTemplate"in a&&a.popupTemplate&&
(d=a.popupTemplate.fieldInfos);const g=n?p(a,b):a.getField(b);let f=null;d&&d.some(e=>e&&e.fieldName.toLowerCase()===g?.name.toLowerCase()?(f=e.clone(),!0):!1);f||(a=z.numericTypes.includes(g.type),b="integer"===g.type||"small-integer"===g.type,f=new x({fieldName:g.name,isEditable:g.editable,visible:!0,format:a?{places:b?0:2,digitSeparator:!0}:null}));f.label||(f.label=g.alias);return f}function t(a){const {expression:b,title:n,returnType:d}=a;return new C({name:`expr${G++}`,expression:b,title:n,
returnType:d})}function u(a){return new x({fieldName:`${"expression/"}${a.name}`,visible:!0,format:"number"===a.returnType?{places:2,digitSeparator:!0}:null})}let G=0;m.expressionFieldPrefix="expression/";m.getContentFromFieldInfos=async function(a,b,n){const {fieldInfos:d,expressionInfos:g}=b;b=await w.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");if(2<d.length)return[new A({fieldInfos:d})];const f=[];for(const k of d){const h=k.fieldName;let c=k.label;if(!c){var e=n?p(a,h):a.getField(h);
if(e)c=e.alias||h;else if(g){const l=h.split("expression/")[1];(e=g[g.findIndex(H=>H.name===l)])&&(c=e.title||e.name)}}f.push(new B({text:r.substitute(b.fieldInfo,{fieldLabel:c,fieldValue:`{${h}}`})}))}return f};m.getExpressionInfo=t;m.getFieldAndExpressionInfos=async function(a){const b=await w.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),{renderer:n,layer:d,normFieldExpressionTemplate:g,isFeatureReduction:f}=a;a=[];const e=[];var k=D.getAttributes(n,y);for(const c of k)if("field"===
c.type)a.push(q(d,c.field,f));else if("normalized-field"===c.type){var h=f?p(d,c.field):d.getField(c.field);const l=f?p(d,c.normalizationField):d.getField(c.normalizationField);k=`\n      $feature["${h.name}"];\n      $feature["${l.name}"];\n      ${"percentage"===g?`($feature["${h.name}"] / $feature["${l.name}"]) * 100;`:`$feature["${h.name}"] / $feature["${l.name}"];`}\n      `;h="percentage"===g?r.substitute(b.normFieldLabelAsPercent,{expression1:h.alias,expression2:l.alias}):r.substitute(b.normFieldLabel,
{expression1:h.alias,expression2:l.alias});k=t({type:"expression",expression:k,title:h,returnType:"number"});a.push(u(k),q(d,c.field,f),q(d,c.normalizationField,f));e.push(k)}else"expression"===c.type&&(k=t(c),a.push(u(k)),e.push(k));return{fieldInfos:v.unique(a,(c,l)=>c.fieldName===l.fieldName),expressionInfos:v.unique(e,(c,l)=>c.expression===l.expression)}};m.getFieldInfo=q;m.getFieldInfoFromExpressionInfo=u;m.getPrimaryVisualVariables=y;m.hasNormalizedField=function(a){return"normalizationField"in
a&&a.normalizationField?!0:"hasVisualVariables"in a&&a.hasVisualVariables()&&a.visualVariables.some(b=>!!("normalizationField"in b&&b.normalizationField))};m.resetSuffixForTests=function(a){};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});