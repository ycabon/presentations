// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../renderers/PointCloudClassBreaksRenderer ../../renderers/PointCloudRenderer ../../renderers/PointCloudRGBRenderer ../../renderers/PointCloudStretchRenderer ../../renderers/PointCloudUniqueValueRenderer ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Logger ../../core/Error ../../core/lang ../../intl/messages ../../layers/support/fieldUtils ../../renderers/support/LegendOptions ../../renderers/support/utils ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/uniqueValues ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/type".split(" "),
function(D,fa,ha,ia,ja,S,ka,la,ma,na,oa,pa,qa,T,ra,sa,n,I,U,J,V,z,W,X,e,K,Y,A,r,E){async function Z(a){if(!a?.layer||!a.field&&!a.valueExpression)throw new n("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&!a.view)throw new n("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&Y.verifyBinningParams(a,"type-renderer");const b={...a,layer:a.layer};b.symbolType=b.symbolType||
"2d";b.numTypes=null==b.numTypes?10:b.numTypes;b.defaultSymbolEnabled??(b.defaultSymbolEnabled=!0);b.sortBy??(b.sortBy="count");b.sortEnabled??(b.sortEnabled=!0);b.statistics=I.clone(b.statistics);var c=a.forBinning?r.binningCapableLayerTypes:r.featureCapableLayerTypes;a=r.createLayerAdapter(b.layer,c,a.forBinning);if(!a)throw new n("type-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(c).join(", "));b.layer=a;await a.load(null!=b.signal?{signal:b.signal}:
null);c=a.geometryType;b.outlineOptimizationEnabled="polygon"===c?b.outlineOptimizationEnabled:!1;b.sizeOptimizationEnabled="point"===c||"multipoint"===c||"polyline"===c?b.sizeOptimizationEnabled:!1;if("mesh"===c)b.symbolType="3d-volumetric",b.colorMixMode=b.colorMixMode||"replace",b.edgesType=b.edgesType||"none";else{if("3d-volumetric-uniform"===b.symbolType&&"point"!==c)throw new n("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(b.symbolType.includes("3d-volumetric")&&
(!b.view||"3d"!==b.view.type))throw new n("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}c=await A.getFieldsList({field:b.field,field2:b.field2,field3:b.field3,valueExpression:b.valueExpression});if(a=e.verifyBasicFieldValidity(a,c,"type-renderer:invalid-parameters"))throw a;return b}async function aa(a){if(!a?.layer||!a.field)throw new n("type-point-cloud-class-renderer:missing-parameters",
"'layer' and 'field' parameters are required");a={...a,layer:a.layer};a.statistics=I.clone(a.statistics);var b=[r.LayerType.PointCloudLayer],c=r.createLayerAdapter(a.layer,b);if(!c)throw new n("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(b).join(", "));a.layer=c;a.density=a.density||25;a.size=a.size||"100%";if(!e.isValidPointSize(a.size))throw new n("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");
await c.load(null!=a.signal?{signal:a.signal}:null);b=await A.getFieldsList({field:a.field});if(c=e.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))throw c;return a}async function L(a){let b=a.typeScheme,c=null;var d=null;d=await e.getBasemapInfo(a.basemap,a.view);c=null!=d.basemapId?d.basemapId:null;d=null!=d.basemapTheme?d.basemapTheme:null;if(b)return{scheme:E.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=E.getSchemes({basemapTheme:d,geometryType:a.geometryType,
theme:a.theme,worldScale:a.worldScale,view:a.view}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}function M(a,b){return a.label<b.label?-1:a.label>b.label?1:0}function N(a,b){return a.value<b.value?-1:a.value>b.value?1:0}function ba(a,b){let c=b.count-a.count;0===c&&(c=M(a,b));return c}function ca(a,b){let c=b.count-a.count;0===c&&(c=N(a,b));return c}function O(a,b,c){let d;"count"===b?(d=ca,c&&"codedValues"in c&&c.codedValues&&(d=ba)):"value"===b&&
(d=N,c&&"codedValues"in c&&c.codedValues&&(d=M));d&&a.sort(d)}async function da(a,b,c,d){var m=await U.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const {field:p,field2:t,field3:q}=b;a=a.uniqueValueInfos;var f=b.layer,k=p?f.getField(p):null;const P=k?f.getFieldDomain(k.name):null,F=-1===b.numTypes?a.length:b.numTypes,u=f.geometryType,G=await L({basemap:b.basemap,geometryType:u,typeScheme:b.typeScheme,worldScale:!!b.symbolType?.includes("3d-volumetric"),view:b.view}),v=G.scheme,h=new T({field:p,
field2:t,field3:q,fieldDelimiter:p&&t?A.fieldDelimiter:null}),Q=[],R=[],w={value:null,domain:P,fieldInfo:k};a.forEach((g,y)=>{w.value=g.value;g.label=z.createUniqueValueLabel(w);g=g.value;(null===g||"string"===typeof g&&g.toLowerCase().includes("\x3cnull\x3e"))&&Q.unshift(y)});for(var x of Q)R.unshift(a.splice(x,1)[0]);!1!==b.sortEnabled&&O(a,b.sortBy,P);k&&(A.isAnyDateField(k)||J.isTimeOnlyField(k))&&(x=a.filter((g,y)=>y<F).map(g=>g.value),x=J.isTimeOnlyField(k)?null:z.calculateDateFormatInterval(x),
w.dateFormatOptions={fieldType:k.type,format:x?z.dateFormatIntervalOptions[x]:void 0},b.view&&(f=f.layer,w.dateFormatOptions.timeZoneOptions={layerTimeZone:"preferredTimeZone"in f?f.preferredTimeZone:null,viewTimeZone:b.view.timeZone,datesInUnknownTimezone:"datesInUnknownTimezone"in f&&f.datesInUnknownTimezone}));f=c?.opacity;let H=e.createColors(v.colors,a.length);const B=e.getSymbolSizeFromScheme(v,u),C=e.getSymbolOutlineFromScheme(v,u,f);a.forEach((g,y)=>{w.value=g.value;g.label=z.createUniqueValueLabel(w);
g.symbol=e.createSymbol(u,{type:b.symbolType,color:H[y],size:B,outline:C,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}})});b.valueExpression&&(h.valueExpression=b.valueExpression,h.valueExpressionTitle=b.valueExpressionTitle);b.legendOptions&&(h.legendOptions=new V.LegendOptions(b.legendOptions));H=e.createColors(v.colors,F);for(f=0;f<F;f++)(k=a[f])&&h.addUniqueValueInfo({value:k.value,label:k.label,symbol:e.createSymbol(u,{type:b.symbolType,color:H[f],size:B,outline:C,meshInfo:{colorMixMode:b.colorMixMode,
edgesType:b.edgesType}})});b.defaultSymbolEnabled&&(h.defaultSymbol=e.createSymbol(u,{type:b.symbolType,color:v.noDataColor,size:B,outline:C,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),h.defaultLabel=m.other);for(var l of R)l.symbol=e.createSymbol(u,{type:b.symbolType,color:v.noDataColor,size:B,outline:C,meshInfo:{colorMixMode:b.colorMixMode,edgesType:b.edgesType}}),a.push(l);m=[];l=h.uniqueValueInfos?.length??0;l=l===a.length?-1:l;if(-1<l)for(;l<a.length;l++)m.push({...a[l]});
c?.visualVariables?.length&&(h.visualVariables=c.visualVariables.map(g=>g.clone()));d?.minSize&&(h.visualVariables?h.visualVariables.push(d.minSize):h.visualVariables=[d.minSize]);return{renderer:h,uniqueValueInfos:a,excludedUniqueValueInfos:m,typeScheme:E.cloneScheme(v),basemapId:G.basemapId,basemapTheme:G.basemapTheme}}async function ea(a,b){a=a.uniqueValueInfos;b=(await L({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:b}))?.scheme;const c="point-cloud-class"===b?.theme,
d=c?b.colors:e.createColors(b?.colors??[],a.length);O(a,"value");return a.map((m,p)=>{const t=m.value;let q=null;c?(q=d[t])||(q=d[d.length-1]):q=d[p];return{values:[t],color:q,label:m.label}})}D.createPCClassRenderer=async function(a){a=await aa(a);const b=null!=a.statistics?a.statistics:await K({layer:a.layer,field:a.field,signal:a.signal});return{renderer:new S({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:e.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:await ea(b,a.typeScheme)})}};
D.createRenderer=async function(a){a=await Z(a);const {layer:b,view:c,signal:d}=a,m={layer:b,field:a.field,field2:a.field2,field3:a.field3,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:c,signal:d},[p,t,q]=await Promise.all([null!=a.statistics?a.statistics:K(m),a.outlineOptimizationEnabled?W({layer:b,view:c,signal:d}).catch(e.errorCallback):null,a.sizeOptimizationEnabled?X({layer:b,view:c,signal:d}).catch(e.errorCallback):null]);return da(p,a,t,q)};Object.defineProperty(D,
Symbol.toStringTag,{value:"Module"})});