// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker".split(" "),function(h,f,g,l,d,k){class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(a,b,c,n,p){return new m(a,b,c)}}e.instance=null;class m extends l.PathEffectCursor{constructor(a,b,c){super(a,!0,!0);this._firstCurve=null;this._walker=new k.GeometryWalker;this._walker.updateTolerance(c);this._endings=b.lineDashEnding;this._customDashPos=
-(b.offsetAlongLine??0)*c;this._offsetAtEnd=(b.customEndingOffset??0)*c;this._pattern=new k.DashPattern;this._pattern.init(b.dashTemplate,!0);this._pattern.scale(c)}processPath(a){if(0===this._pattern.length())return this.iteratePath=!1,a=g.collectPath(a),f.GeometryCursor.fromJSONCIM({paths:[a]});if(!this.iteratePath){var b=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case d.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case d.LineDashEnding.FullGap:this.isClosed||
(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case d.LineDashEnding.NoConstraint:this.isClosed||(b=!1);break;case d.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var c=a.pathLength();if(this._pattern.isEmpty()||c<.1*this._pattern.length()||!this._walker.init(a,this._pattern,b))return a=g.collectPath(a),f.GeometryCursor.fromJSONCIM({paths:[a]})}if(this.iteratePath)a=this._pattern.nextValue();else{switch(this._endings){default:b=.5*this._pattern.firstValue();
break;case d.LineDashEnding.HalfGap:b=.5*-this._pattern.lastValue();break;case d.LineDashEnding.FullGap:b=-this._pattern.lastValue();break;case d.LineDashEnding.FullPattern:b=0;break;case d.LineDashEnding.NoConstraint:case d.LineDashEnding.Custom:b=-this._customDashPos}a=b/this._pattern.length();a-=Math.floor(a);b=a*this._pattern.length();this._pattern.reset();a=this._pattern.nextValue();for(c=!1;b>=a;)b-=a,a=this._pattern.nextValue(),c=!c;a-=b;c?(this._walker.nextPosition(a),a=this._pattern.nextValue()):
this.isClosed&&(this._firstCurve=this._walker.nextCurve(a),a=this._pattern.nextValue(),this._walker.nextPosition(a),a=this._pattern.nextValue())}if(b=this._walker.nextCurve(a))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)b.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else a=this._pattern.nextValue(),!this._walker.nextPosition(a)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&
(b.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,b=this._firstCurve,this._firstCurve=null;b?.reset();return b}}h.EffectDashes=e;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});