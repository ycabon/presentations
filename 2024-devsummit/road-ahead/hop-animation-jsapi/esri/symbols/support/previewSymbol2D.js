// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../core/colorUtils ../../core/Error ../../core/fontUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./textUtils".split(" "),function(u,B,C,L,M,n,q,p,N,v){function D(a,b){const d=O.getContext("2d"),c=[];b&&(b.weight&&c.push(b.weight),b.size&&c.push(b.size+"px"),b.family&&c.push(b.family));d.font=c.join(" ");return d.measureText(a).width}function P(a){if(0===a.length)return 0;if(2<a.length){const b=n.px2pt(1),d=parseFloat(a);switch(a.slice(-2)){case "px":return d;
case "pt":return d*b;case "in":return 72*d*b;case "pc":return 12*d*b;case "mm":return d*Q*b;case "cm":return d*R*b}}return parseFloat(a)}function r(a){var b=a?.size;a=null!=b&&"object"===typeof b&&"width"in b?n.pt2px(b.width):null;b=null!=b&&"object"===typeof b&&"height"in b?n.pt2px(b.height):null;return{width:a,height:b}}async function S(a,b){const d=b.fill,c=a.color;"pattern"===d?.type&&c&&"picture-fill"!==a.type&&(a=await q.getPatternUrlWithColor(d.src,c.toCss(!0)),d.src=a,b.fill=d)}async function T(a,
b,d,c){if("font"in a&&a.font&&"text"===b.shape.type){try{await M.loadFont(a.font)}catch{}({width:a}=r(c));c=/[\uE600-\uE6FF]/.test(b.shape.text);null!=a||c||(d[0]=D(b.shape.text,{weight:b.font?.weight,size:b.font?.size,family:b.font?.family}))}}function U(a,b,d,c,k){if(null!=a.haloColor&&null!=a.haloSize){k.masking??(k.masking=d.map(()=>[]));const h=n.pt2px(a.haloSize);c[0]+=h;c[1]+=h;d.unshift([{...b,fill:null,stroke:{color:a.haloColor,width:2*h,join:"round",cap:"round"}}]);k.masking.unshift([{shape:{type:"rect",
x:0,y:0,width:c[0]+2*v.backgroundPadding,height:c[1]+2*v.backgroundPadding},fill:[255,255,255],stroke:null},{...b,fill:[0,0,0,0],stroke:null}])}if(null!=a.backgroundColor||null!=a.borderLineColor)c[0]+=2*v.backgroundPadding,c[1]+=2*v.backgroundPadding,d.unshift([{shape:{type:"rect",x:0,y:0,width:c[0],height:c[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:n.pt2px(a.borderLineSize)}}]),k.masking?.unshift([])}function E(a,b){return a>b?"dark":"light"}function F(a,b){var d="number"===
typeof b?.size?b?.size:null,c=null!=d?n.pt2px(d):null,k=null!=b?.maxSize?n.pt2px(b.maxSize):null;d=null!=b?.rotation?b.rotation:"angle"in a?a.angle:null;var h=q.getFill(a),l=q.getStroke(a);"dark"!==G(a,245)||b?.ignoreWhiteSymbols||(l={width:.75,...l,color:"#bdc3c7"});h={shape:null,fill:h,stroke:l,offset:[0,0]};l?.width&&(l.width=Math.min(l.width,V));var g=l?.width||0,m=null==b?.size?!1:null!=b?.scale?b?.scale:!0,e=0,f=0;let t=!1;switch(a.type){case "simple-marker":l=a.style;const {width:z,height:W}=
r(b);f=e=c=z===W&&null!=z?z:null!=c?c:Math.min(n.pt2px(a.size),k||w);switch(l){case "circle":h.shape={type:"circle",cx:0,cy:0,r:.5*c};m||(e+=g,f+=g);break;case "cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[e,.5*f]},{command:"M",values:[.5*e,0]},{command:"L",values:[.5*e,f]}]};break;case "diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[.5*e,0]},{command:"L",values:[e,.5*f]},{command:"L",values:[.5*e,f]},{command:"Z",values:[]}]};
m||(e+=g,f+=g);break;case "square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[e,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};m||(e+=g,f+=g);d&&(t=!0);break;case "triangle":h.shape={type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[e,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};m||(e+=g,f+=g);d&&(t=!0);break;case "x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,f]},
{command:"M",values:[e,0]},{command:"L",values:[0,f]}]};d&&(t=!0);break;case "path":h.shape={type:"path",path:a.path||""},m||(e+=g,f+=g),d&&(t=!0),m=!0}break;case "simple-line":const {width:H,height:I}=r(b);m=q.getDashArray(l).reduce((X,Y)=>X+Y,0);a=null!=I?I:null!=c?c:g;m=null!=H?H:m||Z;l&&(l.width=a);e=m;f=a;m=!0;h.shape={type:"path",path:[{command:"M",values:[a/2,f/2]},{command:"L",values:[e-a/2,f/2]}]};break;case "picture-fill":case "simple-fill":a="object"===typeof b?.symbolConfig&&!!b?.symbolConfig?.isSquareFill;
const {width:x,height:y}=r(b);e=!a&&x!==y||null==x?null!=c?c:aa:x;f=!a&&x!==y||null==y?e:y;m||(e+=g,f+=g);m=!0;h.shape=a?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[e,f]},{command:"L",values:[0,f]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:p.shapes.fill[0];break;case "picture-marker":e=Math.min(n.pt2px(a.width),k||w);k=Math.min(n.pt2px(a.height),k||w);const {width:A,height:ba}=r(b);f=A===ba&&null!=A?A:null!=c?c:Math.max(e,k);c=e/k;e=1>=
c?Math.ceil(f*c):f;f=1>=c?f:Math.ceil(f/c);h.shape={type:"image",x:-Math.round(e/2),y:-Math.round(f/2),width:e,height:f,src:a.url||""};d&&(t=!0);break;case "text":l=b?.overrideText||a.text||"Aa";g=a.font;const {width:ca,height:J}=r(b);c=null!=J?J:null!=c?c:Math.min(n.pt2px(g.size),k||w);e=D(l,{weight:g.weight,size:c,family:g.family});k=/[\uE600-\uE6FF]/.test(l);e=ca??(k?c:e);f=c;let K=.25*P((g?c:0).toString());k&&(K+=5);h.shape={type:"text",text:l,x:a.xoffset||0,y:a.yoffset||K,align:"middle",alignBaseline:a.verticalAlignment,
decoration:g&&g.decoration,rotated:a.rotated,kerning:a.kerning};h.font=g&&{size:c,style:g.style,decoration:g.decoration,weight:g.weight,family:g.family}}return{shapeDescriptor:h,size:[e,f],renderOptions:{node:b?.node,scale:m,opacity:b?.opacity,rotation:d,useRotationSize:t,effectView:b?.effectView,ariaLabel:b?.ariaLabel}}}function G(a,b=225){var d=q.getFill(a);a=q.getStroke(a);d=!d||"type"in d?null:new B(d);a=a?.color?new B(a?.color):null;d=d?E(C.getColorLuminance(d),b):null;return(a=a?E(C.getColorLuminance(a),
b):null)?d?d===a?d:225<=b?"light":"dark":a:d}const aa=p.SymbolSizeDefaults.size,w=p.SymbolSizeDefaults.maxSize,V=p.SymbolSizeDefaults.maxOutlineSize,Z=p.SymbolSizeDefaults.lineWidth,O=document.createElement("canvas"),Q=7.2/2.54,R=72/2.54;u.getContrastingBackgroundTheme=G;u.getRenderSymbolParameters=F;u.previewSymbol2D=async function(a,b){const {shapeDescriptor:d,size:c,renderOptions:k}=F(a,b);if(!d.shape)throw new L("symbolPreview: renderPreviewHTML2D","symbol not supported.");await S(a,d);await T(a,
d,c,b);const h=[[d]];"object"===typeof b?.symbolConfig&&b?.symbolConfig?.applyColorModulation&&(b=.6*c[0],h.unshift([{...d,offset:[-b,0],fill:p.adjustColorBrightness(d.fill,-.3)}]),h.push([{...d,offset:[b,0],fill:p.adjustColorBrightness(d.fill,.3)}]),c[0]+=2*b,k.scale=!1);"text"===a.type&&U(a,d,h,c,k);return N.renderSymbol(h,c,k)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});