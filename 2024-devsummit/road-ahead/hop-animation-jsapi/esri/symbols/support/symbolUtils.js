// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../../core/has ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils ../../widgets/Legend/styles/support/relationshipUtils ../../widgets/Legend/support/relationshipRampUtils".split(" "),function(u,t,I,z,D,E,A,q,F,G){function H(a,b){if(b&&(a.style.filter=q.getCSSFilterFromEffectList(b),b=b.effects))for(const c of b)if("drop-shadow"===c?.type){0>c.offsetX?a.style.marginLeft=`${Math.abs(c.offsetX)}px`:a.style.marginRight=`${c.offsetX}px`;break}}async function B(a,
b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=await new Promise((d,e)=>u(["./previewWebStyleSymbol"],d,e));return c(a,B,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=await new Promise((d,e)=>u(["./previewSymbol3D"],d,e)),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=await new Promise((d,e)=>u(["./previewSymbol2D"],d,e)),
c(a,b);case "cim":return{previewCIMSymbol:c}=await new Promise((d,e)=>u(["./previewCIMSymbol"],d,e)),c(a,b)}}function x(a){return a&&"opacity"in a?a.opacity*x(a.parent):1}let v=null;const C=[255,255,255];t.getDisplayedColor=async function(a,b){if(a){var c=a.layer,d=a.sourceLayer,e=x(c??d);if(null!=a.symbol&&(null==b||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await q.fetchWebStyleSymbol(a.symbol,b):a.symbol.clone(),q.getColorFromSymbol(a,e);if(d=(c=b?.renderer||(c&&"renderer"in
c?c.renderer:void 0)||(d&&"renderer"in d?d.renderer:void 0))&&"getSymbolAsync"in c?await c.getSymbolAsync(a,b):void 0){d="web-style"===d.type?await q.fetchWebStyleSymbol(d,b):d.clone();d=q.getColorFromSymbol(d,e);if(!(c&&"visualVariables"in c)||"visualVariables"in c&&!c.visualVariables||"visualVariables"in c&&!c.visualVariables?.length)return d;"arcadeRequiredForVisualVariables"in c&&c.arcadeRequiredForVisualVariables&&null==b?.arcade&&(b={...b},b.arcade=await z.loadArcade());var {getColor:m,getOpacity:h}=
await new Promise((f,n)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],f,n)),k=[],l=[];for(var g of c.visualVariables)switch(g.type){case "color":k.push(g);break;case "opacity":l.push(g)}g=(g=0<k.length?k[k.length-1]:null)?m(g,a,b):d;a=(c=0<l.length?l[l.length-1]:null)?h(c,a,b):null;null!=e&&(a=null!=a?a*e:e);return g?q.applyOpacityToColor(g,a):null}}};t.getDisplayedSymbol=async function(a,b){if(a){var c=a.sourceLayer,d=(null!=b&&(b.useSourceLayer??!1)?c:a.layer)??c;c=x(d);if(null!=
a.symbol&&(null==b||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await q.fetchWebStyleSymbol(a.symbol,{...b,cache:null!=b?b.webStyleCache:null}):a.symbol.clone(),q.applyColorToSymbol(a,null,c),a;var e=(null!=b?b.renderer:null)??(d&&"renderer"in d?d.renderer:null);if(d=e&&"getSymbolAsync"in e?await e.getSymbolAsync(a,b):null){d="web-style"===d.type?await d.fetchSymbol({...b,cache:null!=b?b.webStyleCache:null}):d.clone();if(!(e&&"visualVariables"in e&&e.visualVariables?.length))return q.applyColorToSymbol(d,
null,c),d;"arcadeRequiredForVisualVariables"in e&&e.arcadeRequiredForVisualVariables&&null==b?.arcade&&(b={...b},b.arcade=await z.loadArcade());var {getColor:m,getOpacity:h,getAllSizes:k,getRotationAngle:l}=await new Promise((w,y)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],w,y)),g=[],f=[],n=[],p=[];for(var r of e.visualVariables)switch(r.type){case "color":g.push(r);break;case "opacity":f.push(r);break;case "rotation":p.push(r);break;case "size":r.target||n.push(r)}r=(r=!!g.length&&
g[g.length-1])?m(r,a,b):null;f=(f=!!f.length&&f[f.length-1])?h(f,a,b):null;null!=c&&(f=null!=f?f*c:c);q.applyColorToSymbol(d,r,f);n.length&&(c=k(n,a,b),await q.applySizesToSymbol(d,c));for(const w of p)q.applyRotationToSymbol(d,l(w,a,b),w.axis);return d}}};t.renderColorRampPreviewHTML=function(a,b={}){var c="horizontal"===b.align;const d=b.width??(c?75:24),e=b.height??(c?24:75);var m=b.gradient??!0,h=window.devicePixelRatio,k=d*h,l=e*h;h=document.createElement("canvas");h.width=k;h.height=l;h.ariaLabel=
b.ariaLabel??null;h.style.width=`${d}px`;h.style.height=`${e}px`;const g=h.getContext("2d");var f=c?k:0;const n=c?0:l;if(m){const p=g.createLinearGradient(0,0,f,n);c=a.length;const r=1===c?0:1/(c-1);a.forEach((w,y)=>p.addColorStop(y*r,w.toString()));g.fillStyle=p;g.fillRect(0,0,k,l)}else{k=c?k/a.length:k;l=c?l:l/a.length;f=m=0;for(const p of a)g.fillStyle=p.toString(),g.fillRect(m,f,k,l),m=c?m+k:0,f=c?0:f+l}a=document.createElement("div");a.style.width=`${d}px`;a.style.height=`${e}px`;H(a,b?.effectList);
a.appendChild(h);return a};t.renderDotDensityPreviewHTML=function(a,b,c){const {backgroundColor:d,outline:e,dotSize:m}=a;var h=c?.swatchSize||E.SymbolSizeDefaults.size;const k=Math.round(h*h/Math.max(m,.5)**2*.8),l=window.devicePixelRatio;a=document.createElement("canvas");const g=h*l;a.width=g;a.height=g;a.style.width=`${a.width/l}px`;a.style.height=`${a.height/l}px`;const f=a.getContext("2d");d&&(f.fillStyle=d.toCss(!0),f.fillRect(0,0,g,g),f.fill());f.fillStyle=b?.toCss(!0)??"";if(v&&v.length/2===
k)for(b=0;b<2*k;b+=2)f.fillRect(v[b],v[b+1],m*l,m*l),f.fill();else for(v=[],b=0;b<2*k;b+=2){const n=Math.floor(Math.random()*(g-0+1)),p=Math.floor(Math.random()*(g-0+1));v.push(n,p);f.fillRect(n,p,m*l,m*l);f.fill()}e&&(e.color&&(f.strokeStyle=e.color.toCss(!0)),f.lineWidth=e.width,f.strokeRect(0,0,g,g));h=new Image(h,h);h.src=a.toDataURL();h.ariaLabel=c?.ariaLabel??null;h.alt=c?.ariaLabel??"";return h};t.renderPieChartPreviewHTML=function(a,b={}){const c=b.radius||40;var d=2*Math.PI*c,e=a.length;
const m=d/e,h=[],k=D.getStroke(b.outline);null!=k?.width&&(k.width*=2);(k||b.backgroundColor)&&h.push({shape:{type:"circle",cx:c,cy:c,r:c},fill:b.backgroundColor,stroke:k,offset:[0,0]});const l=b.values,g=l&&l.length===e&&100===l.reduce((n,p)=>n+p,0),f=[0];for(let n=0;n<e;n++){let p=null;g&&(p=l[n]*d/100,f.push(p+f[n]));h.push({shape:{type:"circle",cx:c,cy:c,r:c/2},fill:[0,0,0,0],stroke:{width:c,dashArray:`${(p??m)/2} ${d}`,dashoffset:`-${g?f[n]/2:m/2*n}`,color:a[n]},offset:[0,0]})}e=null;a=2*c+(k?.width||
0);if(d=b.holePercentage)k&&h.push({shape:{type:"circle",cx:c,cy:c,r:c*d},fill:null,stroke:k,offset:[0,0]}),e=a/2,e=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:C,stroke:k?{...k,color:C}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:c*d},fill:[0,0,0],stroke:null,offset:[0,0]}]];return A.renderSymbol([h],[a,a],{effectView:b.effectList,ignoreStrokeWidth:!0,masking:e,rotation:-90,ariaLabel:b.ariaLabel})};t.renderPreviewHTML=B;t.renderRelationshipRampPreviewHTML=function(a,b={}){const c=a?.authoringInfo;
if("relationship"!==c?.type||!c?.numClasses||!a.uniqueValueInfos)return null;const {focus:d,numClasses:e}=c,m=G.getRelationshipRampElement({focus:d,numClasses:e,infos:a.uniqueValueInfos});a=b?.node||document.createElement("div");A.renderOnce(a,()=>F.renderRelationshipRamp(m,b.id||"relationship",{opacity:b.opacity||1,effectList:b.effectList,ariaLabel:b.ariaLabel}));return a};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});