// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(p,x,q,y,k,z,A,B,t){class u{constructor(a){this._params=a;this.animated=!1}isCompatible(a){if(!(a instanceof u&&q.timeExtentsEqual(this._params.timeExtent,a._params.timeExtent)))return!1;let f;return f=(f=(f=this._params.loadImagery===
a._params.loadImagery)&&this._params.color.kind===a._params.color.kind)&&this._params.opacity.kind===a._params.opacity.kind}async load(a,f){const {extent:b,size:e}=a;x.throwIfAborted(f);a=await this._params.loadImagery(b,e[0],e[1],this._params.timeExtent,f);return new v(a,{color:this._params.color,opacity:this._params.opacity})}render(a,f,b){({context:a}=a);const {program:e}=b;a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);
a.useProgram(e);e.setUniformMatrix3fv("u_dvsMat3",f.dvsMat3);a.bindTexture(b.texture,0);e.setUniform1i("u_texture",0);e.setUniform1f("u_Min",b.min);e.setUniform1f("u_Max",b.max);q.setUniforms(e,"color","vec4",this._params.color);q.setUniforms(e,"opacity","float",this._params.opacity);a.bindVAO(b.vertexArray);a.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4)}}const m=new Map;m.set("a_position",0);m.set("a_texcoord",1);const C={geometry:[new t.VertexElementDescriptor("a_position",2,k.DataType.UNSIGNED_SHORT,
0,8),new t.VertexElementDescriptor("a_texcoord",2,k.DataType.UNSIGNED_SHORT,4,8)]},D={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:m};class v{constructor(a,f){this._flowData=a;this._values=f}attach(a){var {context:f}=a;const {width:b,height:e}=this._flowData;var r={geometry:y.BufferObject.createVertex(f,k.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,b,0,1,1,0,e,0,0,b,e,1,0]))};r=new B.VertexArrayObject(f,m,C,r);var h=[];"ramp"===this._values.color.kind&&h.push("vvColor");"ramp"===
this._values.opacity.kind&&h.push("vvOpacity");a=a.painter.materialManager.getProgram(D,h);h=1E6;let n=-1E6;for(var g=0;g<e;g++)for(var c=0;c<b;c++)if(0!==this._flowData.mask[g*b+c]){var d=this._flowData.data[2*(g*b+c)],l=this._flowData.data[2*(g*b+c)+1];d=Math.sqrt(d*d+l*l);h=Math.min(h,d);n=Math.max(n,d)}g=new Uint8Array(4*b*e);for(c=0;c<e;c++)for(d=0;d<b;d++)if(0!==this._flowData.mask[c*b+d]){l=this._flowData.data[2*(c*b+d)];const w=this._flowData.data[2*(c*b+d)+1];g[4*(c*b+d)]=(Math.sqrt(l*l+
w*w)-h)/(n-h)*255;g[4*(c*b+d)+1]=0;g[4*(c*b+d)+2]=0;g[4*(c*b+d)+3]=255}else g[4*(c*b+d)]=0,g[4*(c*b+d)+1]=0,g[4*(c*b+d)+2]=0,g[4*(c*b+d)+3]=0;c=new A.TextureDescriptor;c.internalFormat=k.PixelFormat.RGBA;c.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;c.flipped=!0;c.width=b;c.height=e;f=new z.Texture(f,c,g);this.vertexArray=r;this.program=a;this.texture=f;this.min=h;this.max=n;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}p.Imagery=
u;p.ImageryResources=v;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});