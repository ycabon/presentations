// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(k,p,g,l,e,q,h){class m{constructor(a){this._params=a}get animated(){return 0<this._params.flowSpeed}isCompatible(a){return a instanceof m?g.areStreamlinesCompatible(this._params,a._params):!1}async load(a,c){const {extent:d,size:b}=a;p.throwIfAborted(c);a=await this._params.loadImagery(d,
b[0],b[1],this._params.timeExtent,c);const {vertexData:r,indexData:t}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,a,c);return new n(r,t,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(a,c,d){({context:a}=a);const {program:b}=d;a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);a.useProgram(b);b.setUniform1f("u_time",c.time);b.setUniform1f("u_trailLength",
this._params.trailLength);b.setUniform1f("u_flowSpeed",this._params.flowSpeed);b.setUniform1f("u_featheringSize",this._params.featheringSize);b.setUniform1f("u_featheringOffset",this._params.featheringOffset);b.setUniform1f("u_introFade",this._params.introFade?1:0);b.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);b.setUniform1f("u_decayRate",this._params.decayRate);b.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);b.setUniformMatrix3fv("u_displayViewMat3",c.displayViewMat3);g.setUniforms(b,"color",
"vec4",this._params.color);g.setUniforms(b,"opacity","float",this._params.opacity);g.setUniforms(b,"size","float",this._params.size);a.bindVAO(d.vertexArray);a.drawElements(e.PrimitiveType.TRIANGLES,d.indexCount,e.DataType.UNSIGNED_INT,0)}}const f=new Map;f.set("a_xyts0",0);f.set("a_xyts1",1);f.set("a_typeIdDurationSeed",2);f.set("a_extrudeInfo",3);const u={geometry:[new h.VertexElementDescriptor("a_xyts0",4,e.DataType.FLOAT,0,64),new h.VertexElementDescriptor("a_xyts1",4,e.DataType.FLOAT,16,64),
new h.VertexElementDescriptor("a_typeIdDurationSeed",4,e.DataType.FLOAT,32,64),new h.VertexElementDescriptor("a_extrudeInfo",4,e.DataType.FLOAT,48,64)]},v={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:f};class n{constructor(a,c,d){this._vertexData=a;this._indexData=c;this._values=d}attach(a){var {context:c}=a,d=l.BufferObject.createVertex(c,e.Usage.STATIC_DRAW,this._vertexData);const b=l.BufferObject.createIndex(c,e.Usage.STATIC_DRAW,this._indexData);c=new q.VertexArrayObject(c,
f,u,{geometry:d},b);d=[];"ramp"===this._values.color.kind&&d.push("vvColor");"ramp"===this._values.opacity.kind&&d.push("vvOpacity");"ramp"===this._values.size.kind&&d.push("vvSize");a=a.painter.materialManager.getProgram(v,d);this.vertexArray=c;this.program=a;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}k.Particles=m;k.ParticlesResources=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});