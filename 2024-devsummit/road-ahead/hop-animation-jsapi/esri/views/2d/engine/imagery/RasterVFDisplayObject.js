// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(m,w,c,p,h,k,q,r,n,f,t){class u extends q.DisplayObject{constructor(b=null){super();this._symbolizerParameters=this._source=
null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=b}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(b){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(b)&&
(this._symbolizerParameters=b,this.invalidateVAO())}get source(){return this._source}set source(b){this._source=b;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(b){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:a}=this.symbolizerParameters;switch(a){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":a=
k.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(b.context,a)};break;case "simple_scalar":a=k.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(b.context,a)};break;case "wind_speed":a=k.createVFMesh(this.source,this.symbolizerParameters);a=this._createVectorFieldVAO(b.context,a);const g=k.createVFMeshScalar(this.source,this.symbolizerParameters);b=this._createVectorFieldVAO(b.context,g);this.vaoData=
{magdir:a,scalar:b}}}this.ready();this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:p.create()}}setTransform(b){const a=c.identity(this.transforms.displayViewScreenMat3),[g,l]=b.toScreenNoRotation([0,0],[this.x,this.y]);var d=this.resolution/this.pixelRatio/b.resolution;const e=d*this.width;d*=this.height;const v=Math.PI*this.rotation/180;c.translate(a,a,h.fromValues(g,l));c.translate(a,a,h.fromValues(e/2,d/2));c.rotate(a,a,-v);c.translate(a,a,h.fromValues(-e/2,-d/2));c.scaleByVec2(a,
a,h.fromValues(e,d));c.multiply(this.transforms.displayViewScreenMat3,b.displayViewMat3,a)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(b,a){const {vertexData:g,indexData:l}=a;a=n.BufferObject.createVertex(b,f.Usage.STATIC_DRAW,new Float32Array(g));const d=n.BufferObject.createIndex(b,f.Usage.STATIC_DRAW,new Uint32Array(l)),e=r.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:f.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:f.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:f.DataType.FLOAT,normalized:!1}]});return{vao:new t.VertexArrayObject(b,e.attributes,e.bufferLayouts,{geometry:a},d),elementCount:l.length}}}m.RasterVFDisplayObject=u;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});