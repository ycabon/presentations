// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../enums","../GeometryUtils","./core"],function(q,u,v,w){class x{constructor(c,b,f){this._rows=Math.ceil(b/f);this._columns=Math.ceil(c/f);this._cellSize=f;this.cells=Array(this._rows);for(c=0;c<this._rows;c++)for(this.cells[c]=Array(this._columns),b=0;b<this._columns;b++)this.cells[c][b]=[]}getCell(c,b){b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._rows-1);c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._columns-1);return this.cells[b]&&this.cells[b][c]||null}getCellSpan(c,
b,f,a){return[Math.min(Math.max(Math.floor(c/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(a/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}q.GridIndex=x;q.deserializeSymbols=function(c,b,f,a,l,k,g){const d=b[a++];for(let t=0;t<d;t++){const h=new w.VTLSymbol(k,g);h.xTile=
b[a++];h.yTile=b[a++];h.hash=b[a++];h.priority=b[a++];h.featureIndex=b[a++];var e=b[a++];for(var m=0;m<e;m++){const n=b[a++],p=b[a++],r=b[a++],y=b[a++],z=!!b[a++],A=b[a++],B=f[a++],C=f[a++],D=b[a++],E=b[a++];h.colliders.push({xTile:n,yTile:p,dxPixels:r,dyPixels:y,hard:z,partIndex:A,width:D,height:E,minLod:B,maxLod:C})}e=c[a++];for(m=0;m<e;m++)h.textVertexRanges.push([c[a++],c[a++]]);e=c[a++];for(m=0;m<e;m++)h.iconVertexRanges.push([c[a++],c[a++]]);l.push(h)}return a};q.isSearchCircleOverlapingSymbol=
function(c,b,f,a){var l=c.colliders;let k,g,d;for(const e of l)if(c.unique.show&&c.unique.parts[e.partIndex].show&&(l=e.xScreen-a[0]+e.dxScreen,k=e.yScreen-a[1]+e.dyScreen,g=l+e.width,d=k+e.height,v.isCircleOverlapingRect(f,b.x,b.y,l,k,g,d)))return!0;return!1};q.tileCoordChange=function(c,b,f,a,l,k){f-=l;if(0<=f)return(b>>f)+(a-(k<<f))*(c>>f);f=-f;return b-(k-(a<<f))*(c>>f)<<f};q.writeOpacityToBuffers=function(c,b,f){for(const [m,t]of c.symbols){{var a=c,l=b,k=f,g=t;const h=a.layerData.get(m);if(h.type===
u.BucketType.SYMBOL){for(const n of g){g=n.unique;var d=void 0;if(n.selectedForRendering){var e=g.parts[0];d=e.startOpacity;e=e.targetOpacity;a.allSymbolsFadingOut=a.allSymbolsFadingOut&&0===e;d=k?Math.floor(127*d)|e<<7:e?255:0;d|=d<<24|d<<16|d<<8}else d=0;for(const [p,r]of n.iconVertexRanges)for(e=p;e<p+r;e+=4)h.iconOpacity[e/4]=d;n.selectedForRendering?(d=g.parts[1],g=d.startOpacity,d=d.targetOpacity,a.allSymbolsFadingOut=a.allSymbolsFadingOut&&0===d,g=k?Math.floor(127*g)|d<<7:d?255:0,d=g<<24|g<<
16|g<<8|g):d=0;for(const [p,r]of n.textVertexRanges)for(g=p;g<p+r;g+=4)h.textOpacity[g/4]=d}h.lastOpacityUpdate=l;h.opacityChanged=!0}}}};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});