// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(k,B,p,q,u,v,n,w,r,C,h,y,D){function x(a){a=a?.getGeometry();if(null==a)return null;let c=Infinity,b=Infinity,d=-Infinity,e=-Infinity;for(const g of a)if(g)for(const f of g)c=Math.min(c,
f.x),b=Math.min(b,f.y),d=Math.max(d,f.x),e=Math.max(e,f.y);return B.fromValues(c,b,d,e)}k.CapType=void 0;(function(a){a[a.BUTT=0]="BUTT";a[a.ROUND=1]="ROUND";a[a.SQUARE=2]="SQUARE";a[a.UNKNOWN=4]="UNKNOWN"})(k.CapType||(k.CapType={}));class E{constructor(a,c,b,d,e,g){this.layer=a;this.feature=c;this.bounds=b;this.normalizationRatio=d;this.normalizationOffsetX=e;this.normalizationOffsetY=g}}class t{constructor(a,c,b,d){this.type=a;this.typeName=c.type;this.id=c.id;this.source=c.source;this.sourceLayer=
c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=b;this.uid=d;switch(a){case h.StyleLayerType.BACKGROUND:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case h.StyleLayerType.FILL:this._layoutDefinition=h.StyleDefinition.fillLayoutDefinition;this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case h.StyleLayerType.LINE:this._layoutDefinition=
h.StyleDefinition.lineLayoutDefinition;this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case h.StyleLayerType.SYMBOL:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case h.StyleLayerType.CIRCLE:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==
this._featureFilter?this._featureFilter:this._featureFilter=C.createFilter(this.filter)}getLayoutProperty(a){return this._layoutProperties[a]}getPaintProperty(a){return this._paintProperties[a]}getLayoutValue(a,c,b){let d;const e=this._layoutProperties[a];e&&(d=e.getValue(c,b));void 0===d&&(d=this._layoutDefinition[a]["default"]);return d}getPaintValue(a,c,b){let d;const e=this._paintProperties[a];e&&(d=e.getValue(c,b));void 0===d&&(d=this._paintDefinition[a]["default"]);return d}isPainterDataDriven(){const a=
this._paintProperties;if(a)for(const c in a)if(a[c].isDataDriven)return!0;return!1}isIntersectingFeature(a,c,b,d,e,g,f){return!1}getFeatureInflatedBounds(a,c,b,d){return null}_parseLayout(a){const c={};for(const b in a){const d=this._layoutDefinition[b];d&&(c[b]=new y(d,a[b]))}return c}_parsePaint(a){const c={};for(const b in a){const d=this._paintDefinition[b];d&&(c[b]=new y(d,a[b]))}return c}computeAttributesKey(a,c,b,d){let e=0,g=0;for(const f of c){c=3;if(!f||f!==d){const {isLayout:l,isOptional:m}=
b[f];c=l?this.getLayoutProperty(f):this.getPaintProperty(f);c=c?.interpolator?2:c?.isDataDriven?1:m&&!c?3:0}g|=c<<e;e+=2}return g<<3|a}}class F extends t{constructor(a,c,b,d){super(a,c,b,d);this.backgroundMaterial=new u.VTLBackgroundMaterial(this.computeAttributesKey(p.ShaderProgramType.BACKGROUND,u.VTLBackgroundMaterial.ATTRIBUTES,u.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class G extends t{constructor(a,c,b,d){super(a,c,b,d);a=this.getPaintProperty("fill-color");c=this.getPaintProperty("fill-opacity");
b=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=a?.isDataDriven;this.hasDataDrivenOpacity=c?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||b?.isDataDriven;c=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!c;this.hasDataDrivenOutlineColor=c?.isDataDriven;this.hasDataDrivenOutline=c?c.isDataDriven:a?a.isDataDriven:!1;this.hasDataDrivenOutline=(c?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;
this.fillMaterial=new n.VTLFillMaterial(this.computeAttributesKey(p.ShaderProgramType.FILL,n.VTLFillMaterial.ATTRIBUTES,n.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new n.VTLOutlineMaterial(this.computeAttributesKey(p.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_FILL:n.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:n.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(a,
c,b,d){b=x(a);if(!b)return null;a=this.getPaintValue("fill-translate",c,a);d*=Math.max(a[0],a[1]);b[0]-=d;b[2]-=d;b[1]+=d;b[3]+=d;return b}isIntersectingFeature(a,c,b,d,e,g,f){const l=d.getGeometry();if(!l)return!1;const m=8/f.normalizationRatio;a=a/f.normalizationRatio+f.normalizationOffsetX;c=c/f.normalizationRatio+f.normalizationOffsetY;d=q.translateAnchor(this.getPaintValue("fill-translate",e,d),this.getPaintValue("fill-translate-anchor",e,d),g,8);a-=m*d.x;c-=m*d.y;return q.pointInPolygon(a,c,
l)?!0:q.distanceFromToPolylineWithinThreshold(a,c,l,m*b)}}class H extends t{constructor(a,c,b,d){super(a,c,b,d);a=this.getPaintProperty("line-pattern");this.lineMaterial=new w.VTLLineMaterial(this.computeAttributesKey(p.ShaderProgramType.LINE,w.VTLLineMaterial.ATTRIBUTES,w.VTLLineMaterial.ATTRIBUTES_INFO,a?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||
this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(a=this.getPaintProperty("line-width"),!a||"number"===typeof a&&.5*a<D.thinLineHalfWidthThreshold)&&(a=this.getPaintProperty("line-offset"),
!a||"number"===typeof a&&0===a)&&(this.canUseThinTessellation=!0)}getDashKey(a,c){switch(c){case k.CapType.BUTT:c="Butt";break;case k.CapType.ROUND:c="Round";break;case k.CapType.SQUARE:c="Square";break;default:c="Butt"}return`dasharray-[${a.toString()}]-${c}`}getFeatureInflatedBounds(a,c,b,d){b=x(a);if(!b)return null;var e=this.getPaintValue("line-translate",c,a);e=d*Math.max(e[0],e[1]);b[0]-=e;b[2]-=e;b[1]+=e;b[3]+=e;e=d*Math.abs(this.getPaintValue("line-offset",c,a)||0);a=this.getPaintValue("line-width",
c,a);d*=a/2;b[0]-=e+d;b[1]-=e+d;b[2]+=e+d;b[3]+=e+d;return b}isIntersectingFeature(a,c,b,d,e,g,f){let l=d.getGeometry();if(!l)return!1;const m=8/f.normalizationRatio;a=a/f.normalizationRatio+f.normalizationOffsetX;c=c/f.normalizationRatio+f.normalizationOffsetY;g=q.translateAnchor(this.getPaintValue("line-translate",e,d),this.getPaintValue("line-translate-anchor",e,d),g,8);a-=m*g.x;c-=m*g.y;g=m*this.getPaintValue("line-offset",e,d)||0;0!==g&&(l=q.offsetLine(l,-g));d=this.getPaintValue("line-width",
e,d);return q.distanceFromToPolylineWithinThreshold(a,c,l,m*(b+d/2))}}class I extends t{constructor(a,c,b,d){super(a,c,b,d);this.iconMaterial=new r.VTLIconMaterial(this.computeAttributesKey(p.ShaderProgramType.ICON,r.VTLIconMaterial.ATTRIBUTES,r.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new r.VTLTextMaterial(this.computeAttributesKey(p.ShaderProgramType.TEXT,r.VTLTextMaterial.ATTRIBUTES,r.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||
this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||
this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class J extends t{constructor(a,c,b,d){super(a,c,b,d);this.circleMaterial=new v.VTLCircleMaterial(this.computeAttributesKey(p.ShaderProgramType.CIRCLE,v.VTLCircleMaterial.ATTRIBUTES,v.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(a,c,b,d){b=x(a);if(!b)return null;var e=this.getPaintValue("circle-translate",c,a);e=Math.max(e[0],e[1]);b[0]-=e;b[2]-=e;b[1]+=e;b[3]+=e;a=8*(this.getPaintValue("circle-radius",
c,a)+this.getPaintValue("circle-stroke-width",c,a));d*=a/2;b[0]-=d;b[1]-=d;b[2]+=d;b[3]+=d;return b}isIntersectingFeature(a,c,b,d,e,g,f){var l=d.getGeometry();if(!l)return!1;const m=8/f.normalizationRatio;a=a/f.normalizationRatio+f.normalizationOffsetX;c=c/f.normalizationRatio+f.normalizationOffsetY;b*=m;g=q.translateAnchor(this.getPaintValue("circle-translate",e,d),this.getPaintValue("circle-translate-anchor",e,d),g,m);d=m*(this.getPaintValue("circle-radius",e,d)+this.getPaintValue("circle-stroke-width",
e,d));for(const z of l)if(z)for(const A of z)if(l=A.x+g.x,e=A.y+g.y,Math.sqrt((a-l)*(a-l)+(c-e)*(c-e))-b<=d)return!0;return!1}}class K{constructor(a,c,b){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",c);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",c);this.keepUpright=a.getLayoutValue("icon-keep-upright",c);this.optional=a.getLayoutValue("icon-optional",c);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",c);this.rotationAlignment===h.RotationAlignment.AUTO&&
(this.rotationAlignment=b?h.RotationAlignment.MAP:h.RotationAlignment.VIEWPORT);b=a.getLayoutProperty("icon-anchor");b?.isDataDriven?this._anchorProp=b:this.anchor=a.getLayoutValue("icon-anchor",c);b=a.getLayoutProperty("icon-offset");b?.isDataDriven?this._offsetProp=b:this.offset=a.getLayoutValue("icon-offset",c);b=a.getLayoutProperty("icon-padding");b?.isDataDriven?this._paddingProp=b:this.padding=a.getLayoutValue("icon-padding",c);b=a.getLayoutProperty("icon-rotate");b?.isDataDriven?this._rotateProp=
b:this.rotate=a.getLayoutValue("icon-rotate",c);b=a.getLayoutProperty("icon-size");b?.isDataDriven?this._sizeProp=b:this.size=a.getLayoutValue("icon-size",c)}update(a,c){this._anchorProp&&(this.anchor=this._anchorProp.getValue(a,c));this._offsetProp&&(this.offset=this._offsetProp.getValue(a,c));this._paddingProp&&(this.padding=this._paddingProp.getValue(a,c));this._rotateProp&&(this.rotate=this._rotateProp.getValue(a,c));this._sizeProp&&(this.size=this._sizeProp.getValue(a,c))}}class L{constructor(a,
c,b){this.allowOverlap=a.getLayoutValue("text-allow-overlap",c);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",c);this.keepUpright=a.getLayoutValue("text-keep-upright",c);this.optional=a.getLayoutValue("text-optional",c);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",c);this.rotationAlignment===h.RotationAlignment.AUTO&&(this.rotationAlignment=b?h.RotationAlignment.MAP:h.RotationAlignment.VIEWPORT);b=a.getLayoutProperty("text-anchor");b?.isDataDriven?this._anchorProp=
b:this.anchor=a.getLayoutValue("text-anchor",c);b=a.getLayoutProperty("text-justify");b?.isDataDriven?this._justifyProp=b:this.justify=a.getLayoutValue("text-justify",c);b=a.getLayoutProperty("text-letter-spacing");b?.isDataDriven?this._letterSpacingProp=b:this.letterSpacing=a.getLayoutValue("text-letter-spacing",c);b=a.getLayoutProperty("text-line-height");b?.isDataDriven?this._lineHeightProp=b:this.lineHeight=a.getLayoutValue("text-line-height",c);b=a.getLayoutProperty("text-max-angle");b?.isDataDriven?
this._maxAngleProp=b:this.maxAngle=a.getLayoutValue("text-max-angle",c);b=a.getLayoutProperty("text-max-width");b?.isDataDriven?this._maxWidthProp=b:this.maxWidth=a.getLayoutValue("text-max-width",c);b=a.getLayoutProperty("text-offset");b?.isDataDriven?this._offsetProp=b:this.offset=a.getLayoutValue("text-offset",c);b=a.getLayoutProperty("text-padding");b?.isDataDriven?this._paddingProp=b:this.padding=a.getLayoutValue("text-padding",c);b=a.getLayoutProperty("text-rotate");b?.isDataDriven?this._rotateProp=
b:this.rotate=a.getLayoutValue("text-rotate",c);b=a.getLayoutProperty("text-size");b?.isDataDriven?this._sizeProp=b:this.size=a.getLayoutValue("text-size",c);b=a.getLayoutProperty("text-writing-mode");b?.isDataDriven?this._writingModeProp=b:this.writingMode=a.getLayoutValue("text-writing-mode",c)}update(a,c){this._anchorProp&&(this.anchor=this._anchorProp.getValue(a,c));this._justifyProp&&(this.justify=this._justifyProp.getValue(a,c));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(a,
c));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(a,c));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(a,c));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(a,c));this._offsetProp&&(this.offset=this._offsetProp.getValue(a,c));this._paddingProp&&(this.padding=this._paddingProp.getValue(a,c));this._rotateProp&&(this.rotate=this._rotateProp.getValue(a,c));this._sizeProp&&(this.size=this._sizeProp.getValue(a,c));this._writingModeProp&&(this.writingMode=
this._writingModeProp.getValue(a,c))}}k.BackgroundStyleLayer=F;k.CircleStyleLayer=J;k.FillStyleLayer=G;k.IconLayout=K;k.IndexItem=E;k.LineStyleLayer=H;k.StyleLayer=t;k.SymbolStyleLayer=I;k.TextLayout=L;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});