// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../request ../../../../../core/lang ../../../../../core/MapUtils ../../../../../core/promiseUtils ../../../../../core/urlUtils".split(" "),function(g,m,n,p,e,h){function q(a,b){return p.getOrCreateMapValue(k,a,()=>new r(a)).getData(b).finally(()=>k.delete(a))}class r{constructor(a){this._tileUrl=a;this._abortController=this._promise=null;this._abortOptions=[]}getData(a){if(null==this._promise||e.isAborted(this._abortController?.signal))this._promise=this._makeRequest(this._tileUrl);
const b=this._abortOptions;b.push(a);e.onAbort(a,()=>{b.every(c=>e.isAborted(c))&&this._abortController.abort()});return this._promise.then(c=>n.clone(c))}async _makeRequest(a){this._abortController=new AbortController;({data:a}=await m(a,{responseType:"array-buffer",signal:this._abortController.signal}));return a}}const k=new Map;g.request=function(a,b,c,l,t){a=h.urlToObject(a);const d=a.query;if(d)for(const [f,u]of Object.entries(d))switch(u){case "{x}":d[f]=l.toString();break;case "{y}":d[f]=c.toString();
break;case "{z}":d[f]=b.toString()}b=h.addQueryParameters(a.path.replaceAll(/\{z\}/gi,b.toString()).replaceAll(/\{y\}/gi,c.toString()).replaceAll(/\{x\}/gi,l.toString()),{...a.query});return q(b,t)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});