// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(k,l,m,n,p,f,q){class h extends p.DisplayObject{constructor(b,a){super();this._clip=a;this._cache={};this.stage=b;this._handle=m.watch(()=>a.version,()=>this._invalidate());this.ready()}static fromClipArea(b,a){return new h(b,a)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),
this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL();this._handle.remove()}getVAO(b,a,c,d){const [g,e]=a.size;if("geometry"===this._clip.type||this._lastWidth!==g||this._lastHeight!==e)this._lastWidth=g,this._lastHeight=e,this._destroyGL();if(null==this._cache.vao){a=this._createMesh(a,this._clip);const r=a.getIndexBuffer(b),t=a.getVertexBuffers(b);this._cache.mesh=a;this._cache.vao=new q.VertexArrayObject(b,c,d,t,r)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:n.create()}}_invalidate(){this._destroyGL();
this.requestRender()}_createScreenRect(b,a){const [c,d]=b.size;b="string"===typeof a.left?parseFloat(a.left)/100*c:a.left;const g="string"===typeof a.right?parseFloat(a.right)/100*c:a.right,e="string"===typeof a.top?parseFloat(a.top)/100*d:a.top;a="string"===typeof a.bottom?parseFloat(a.bottom)/100*d:a.bottom;return{x:b,y:e,width:Math.max(c-g-b,0),height:Math.max(d-a-e,0)}}_createMesh(b,a){switch(a.type){case "rect":return f.fromRect(this._createScreenRect(b,a));case "path":return f.fromPath(a);case "geometry":return f.fromGeometry(b,
a);default:return l.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new k("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),f.fromRect({x:0,y:0,width:1,height:1})}}}return h});