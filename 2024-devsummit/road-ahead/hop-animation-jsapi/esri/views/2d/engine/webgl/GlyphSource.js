// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["../../../../request","../../../../core/pbf"],function(h,k){class l{constructor(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:const b=a.getMessage();for(;b.next();)switch(b.tag()){case 3:const c=b.getMessage();let d,e,g,f,m,n,p;for(;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:e=c.getBytes();break;case 3:g=c.getUInt32();break;case 4:f=c.getUInt32();break;case 5:m=c.getSInt32();break;case 6:n=c.getSInt32();break;case 7:p=c.getUInt32();break;default:c.skip()}c.release();
d&&(this._metrics[d]={width:g,height:f,left:m,top:n,advance:p},this._bitmaps[d]=e);break;default:b.skip()}b.release();break;default:a.skip()}}getMetrics(a){return this._metrics[a]}getBitmap(a){return this._bitmaps[a]}}class q{constructor(){this._ranges=[]}getRange(a){return this._ranges[a]}addRange(a,b){this._ranges[a]=b}}class r{constructor(a){this._glyphInfo={};this._baseURL=a}getRange(a,b,c){const d=this._getFontStack(a);if(d.getRange(b))return Promise.resolve();const e=256*b,g=e+255;a=this._baseURL.replace("{fontstack}",
a).replace("{range}",e+"-"+g);return h(a,{responseType:"array-buffer",...c}).then(f=>{d.addRange(b,new l(new k(new Uint8Array(f.data),new DataView(f.data))))})}async preloadASCIIRange(a){const b=this._getFontStack(a);a=this._baseURL.replace("{fontstack}",a).replace("{range}","0-255");a=await h(a,{responseType:"array-buffer"});a=new l(new k(new Uint8Array(a.data),new DataView(a.data)));for(let c=0;255>=c;c++)b.getRange(c)||b.addRange(c,a)}getGlyph(a,b){if(a=this._getFontStack(a))if(a=a.getRange(Math.floor(b/
256)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}_getFontStack(a){let b=this._glyphInfo[a];b||=this._glyphInfo[a]=new q;return b}}return r});