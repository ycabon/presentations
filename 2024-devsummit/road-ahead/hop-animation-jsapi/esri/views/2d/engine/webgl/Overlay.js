// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../symbols/cim/enums ../DisplayObject ./animatedFormats/utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexArrayObject".split(" "),
function(u,v,w,q,x,l,y,z,A,n,B,C,r,p,t,D,E){function F(b){return b?{...b,playAnimation:b.playing,repeatType:b.repeatType?G[b.repeatType]:void 0}:{}}const m=y.create(),G={none:n.AnimatedSymbolRepeatType.None,loop:n.AnimatedSymbolRepeatType.Loop,oscillate:n.AnimatedSymbolRepeatType.Oscillate};class H extends B.DisplayObject{constructor(b){super();this.elementView=b;this.isWrapAround=!1;this.perspectiveTransform=A.create();this._playHandle=null;this._vertices=new Float32Array(20);this._handles=[];this._handles.push(l.watch(()=>
this.elementView.element.opacity,c=>this.opacity=c,l.initial),l.watch(()=>[this.elementView.coords],()=>{this.requestRender()},l.initial),l.watch(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._playHandle?.remove();this.texture=q.disposeMaybe(this.texture);this.requestRender()},l.initial),l.when(()=>this.elementView.element.loaded,()=>{const c=this.elementView.element;this.ready();"video"===c.type&&null!=c.content&&this._handles.push(v.on(c.content,
"play",()=>this.requestRender()))},l.initial));b.element.load().catch(c=>{w.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new u("element-load-error","Element cannot be displayed",{element:b,error:c}))})}getMesh(b){throw Error("Method not implemented.");}destroy(){this._playHandle?.remove();this._handles.forEach(b=>b.remove());this.texture=q.disposeMaybe(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(b){const {context:c}=b,a=this.elementView.element.content;if(null!=
a){var d=a instanceof HTMLImageElement;const k=a instanceof HTMLVideoElement;var h=d?a.naturalWidth:k?a.videoWidth:a.width;d=d?a.naturalHeight:k?a.videoHeight:a.height;this._updatePerspectiveTransform(h,d);if(this.texture)k&&!a.paused&&(this.texture.setData(a),this.requestRender(),this.texture.generateMipmap());else{const f=new D.TextureDescriptor;f.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;f.preMultiplyAlpha=!0;f.width=h;f.height=d;"getFrame"in a?(h=e=>{this.texture?this.texture.setData(e):this.texture=
new t.Texture(c,f,e);this.requestRender()},"animationOptions"in this.elementView.element&&(this._playHandle=C.play(a,F(this.elementView.element.animationOptions),null,h))):this.texture=new t.Texture(c,f,a);this.texture.generateMipmap();k&&!a.paused&&this.requestRender()}}super.beforeRender(b)}_createTransforms(){return null}updateDrawCoords(b,c){var a=this.elementView.coords;if(null!=a){var [d,h,k,f]=a.rings[0];a=this._vertices;var {x:e,y:g}=b;(b=0!==c)?a.set([h[0]-e,h[1]-g,d[0]-e,d[1]-g,k[0]-e,k[1]-
g,f[0]-e,f[1]-g,f[0]-e,f[1]-g,h[0]+c-e,h[1]-g,h[0]+c-e,h[1]-g,d[0]+c-e,d[1]-g,k[0]+c-e,k[1]-g,f[0]+c-e,f[1]-g]):a.set([h[0]-e,h[1]-g,d[0]-e,d[1]-g,k[0]-e,k[1]-g,f[0]-e,f[1]-g]);this.isWrapAround=b}}getVAO(b,c,a){if(null==this.elementView.coords)return null;var d=this._vertices;this._vao?this._geometryVbo.setData(d):(this._geometryVbo=r.BufferObject.createVertex(b,p.Usage.DYNAMIC_DRAW,d),d=r.BufferObject.createVertex(b,p.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),
this._vao=new E.VertexArrayObject(b,a,c,{geometry:this._geometryVbo,tex:d}));return this._vao}_updatePerspectiveTransform(b,c){const a=this._vertices;x.getProjectiveTransform(m,[0,0,b,0,0,c,b,c],[a[0],a[1],a[4],a[5],a[2],a[3],a[6],a[7]]);z.set(this.perspectiveTransform,m[6]/m[8]*b,m[7]/m[8]*c)}}return H});