// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],function(k,m,n,p,q){const d=p("esri-2d-profiler");class r{constructor(a,f){this._events=new n;this._entries=new Map;this._timings=new m(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(d){this._ext=q.createDisjointTimerQuery(a.gl,{});this._debugOutput=f;var c=a.gl;if(this.enableCommandLogging)for(var e in c)if("function"===
typeof c[e]){const g=c[e],b=e.includes("draw");c[e]=(...h)=>{this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:e,args:h,isDrawCommand:b});this._currentSummary&&(this._currentSummary.commands++,b&&this._currentSummary.drawCommands++);return g.apply(c,h)}}}}get enableCommandLogging(){return!("object"===typeof d&&d.disableCommands)}recordContainerStart(a){d&&(this._currentContainer=a)}recordContainerEnd(){d&&(this._currentContainer=null)}recordPassStart(a){d&&
(this._currentPass=a,this._initSummary())}recordPassEnd(){d&&(this._currentPass=null,this._emitSummary())}recordBrushStart(a){d&&(this._currentBrush=a)}recordBrushEnd(){d&&(this._currentBrush=null)}recordStart(a){if(d&&null!=this._ext){if(this._entries.has(a)){const b=this._entries.get(a);var f=this._ext.resultAvailable(b.query),c=this._ext.disjoint();if(f&&!c){f=this._ext.getResult(b.query)/1E6;c=0;if(null!=this._timings.enqueue(f)){c=this._timings.entries;const h=c.length;let l=0;for(var e of c)l+=
e;c=l/h}e=f.toFixed(2);f=c?c.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${a}, ${e} ms (${f} last 10 avg)\n${b.commandsLen} Commands (${b.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(b.summaries),console.log("Commands: ",b.commands),console.groupEnd()):console.log(`Frame report for ${a}, ${e} ms (${f} last 10 avg)`);this._debugOutput.innerHTML=`${e} (${f})`}for(const h of b.handles)h.remove();this._ext.deleteQuery(b.query);this._entries.delete(a)}const g=
{name:a,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(g.handles.push(this._events.on("command",b=>{g.commandsLen++;g.commands.push(b);b.isDrawCommand&&g.drawCommands++})),g.handles.push(this._events.on("summary",b=>{g.summaries.push(b)})));this._ext.beginTimeElapsed(g.query);this._entries.set(a,g)}}recordEnd(a){d&&null!=this._ext&&this._entries.has(a)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&
(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}k.Profiler=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});