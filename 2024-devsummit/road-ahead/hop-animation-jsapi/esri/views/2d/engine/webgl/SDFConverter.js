// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["../../../../core/floatRGBA","../../../../core/promiseUtils"],function(r,p){class t{constructor(a){this._svg=null;this.size=a;const g=document.createElement("canvas");g.width=g.height=a;this._context=g.getContext("2d",{willReadFrequently:!1});this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=
this._d=this._z=this._v=null;this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(a,g,d,h=31){this._initSVG();const k=this.createSVGString(a,g);return new Promise((c,b)=>{const e=new Image;e.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);e.onload=()=>{e.onload=null;this._context.clearRect(0,0,this.size,this.size);this._context.drawImage(e,0,0,this.size,this.size);var l=this._context.getImageData(0,0,this.size,this.size);const q=new Uint8Array(this.size*this.size*
4);for(let n=0;n<this.size*this.size;n++){const m=l.data[4*n+3]/255;this._gridOuter[n]=1===m?0:0===m?1E20:Math.max(0,.5-m)**2;this._gridInner[n]=1===m?1E20:0===m?0:Math.max(0,m-.5)**2}this._edt(this._gridOuter,this.size,this.size);this._edt(this._gridInner,this.size,this.size);for(l=0;l<this.size*this.size;l++)r.packFloatRGBA(.5-(this._gridOuter[l]-this._gridInner[l])/(2*h),q,4*l);c(q)};const f=d?.signal;if(f)p.onAbort(f,()=>b(p.createAbortError()))})}_initSVG(){if(!this._svg){const a=document.createElementNS("http://www.w3.org/2000/svg",
"svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("aria-hidden","true");a.setAttribute("role","presentation");document.body.appendChild(a);this._svg=a}return this._svg}createSVGString(a,g){const d=this._initSVG(),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",a);d.appendChild(h);a=h.getBBox();var k=a.width/a.height;const c=this.size/2;let b,e;1<k?(b=c/a.width,e=this.size/4,k=c-1/k*c/2):(b=
c/a.height,e=c-c*k/2,k=this.size/4);h.setAttribute("style",`transform: matrix(${b}, 0, 0, ${b}, ${-a.x*b+e}, ${-a.y*b+k})`);h.setAttribute("stroke-width",`${.5/b}`);g=`<svg style="fill:${g?"red":"none"}; stroke:${g?"none":"red"}" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${d.innerHTML}</svg>`;d.removeChild(h);return g}_edt(a,g,d){const h=this._f,k=this._d,c=this._v,b=this._z;for(var e=0;e<g;e++){for(var f=0;f<d;f++)h[f]=a[f*g+e];this._edt1d(h,k,c,b,d);for(f=0;f<
d;f++)a[f*g+e]=k[f]}for(e=0;e<d;e++){for(f=0;f<g;f++)h[f]=a[e*g+f];this._edt1d(h,k,c,b,g);for(f=0;f<g;f++)a[e*g+f]=Math.sqrt(k[f])}}_edt1d(a,g,d,h,k){d[0]=0;h[0]=-1E20;h[1]=1E20;for(let c=1,b=0;c<k;c++){let e=(a[c]+c*c-(a[d[b]]+d[b]*d[b]))/(2*c-2*d[b]);for(;e<=h[b];)b--,e=(a[c]+c*c-(a[d[b]]+d[b]*d[b]))/(2*c-2*d[b]);b++;d[b]=c;h[b]=e;h[b+1]=1E20}for(let c=0,b=0;c<k;c++){for(;h[b+1]<c;)b++;g[c]=(c-d[b])*(c-d[b])+a[d[b]]}}}return t});