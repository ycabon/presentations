// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/promiseUtils","./definitions"],function(k,h,l){class m{constructor(b){this._queue=[];this._refreshable=b}destroy(){this._queue=[]}enqueueTextureUpdate(b,c){const a=h.createResolver(),e=l.textureUploadManagerChunkSize,f=Math.ceil(b.height/e);h.throwIfAborted(c);for(let d=0;d<f;d++){const g=d===f-1;this._queue.push({type:"chunk",request:b,resolver:a,chunk:d,chunkOffset:d*e,destHeight:g?b.height-e*d:e,chunkIsLast:g,options:c})}h.onAbortOrThrow(c,d=>a.reject(d));return a.promise}upload(){let b=
0;for(;this._queue.length;){var c=performance.now();const a=this._queue.shift();if(a&&(null==a.options.signal||!a.options.signal.aborted)){switch(a.type){case "chunk":this._uploadChunk(a);break;case "no-chunk":this._uploadNoChunk(a)}c=performance.now()-c;b+=c;if(b+c>=l.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(b){const {request:c,resolver:a,chunkOffset:e,chunkIsLast:f,destHeight:d}=b,{data:g,texture:n,width:p}=c;null!=g&&(n.updateData(0,0,
e,p,d,g,e),f&&a.resolve())}_uploadNoChunk(b){const {request:c,resolver:a}=b,{data:e,texture:f}=c;f.setData(e);a.resolve()}}k.TextureUploadManager=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});