// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],function(h,m,n,a){const g={nearest:{defines:[],samplingMode:a.TextureSamplingMode.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};class p extends n{constructor(){super(...arguments);this._desc={vsPath:"raster/bitmap",
fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:b}){b.setBlendingEnabled(!0);b.setColorMask(!0,!0,!0,!0);b.setStencilWriteMask(0);b.setStencilTestEnabled(!0)}draw(b,c){const {context:f,renderingOptions:k,painter:q,requestRender:l,allowDelayedRender:r}=b;if(c.source&&c.isReady){if("dynamic"===k.samplingMode){({state:e}=b);var d=c.resolution/c.pixelRatio/e.resolution;const t=Math.round(b.pixelRatio)!==b.pixelRatio;var e=e.rotation||
1.05<d||.95>d||t||c.isSourceScaled||c.rotation?g.bilinear:g.nearest}else e=g[k.samplingMode];d=q.materialManager.getProgram(this._desc,e.defines);if(r&&null!=l&&!d.compiled)l();else{b.timeline.begin(this.name);"additive"===c.blendFunction?f.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE):f.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA,a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setStencilFunction(a.CompareFunction.EQUAL,
c.stencilRef,255);this._quad||(this._quad=new m(f,[0,0,1,0,0,1,1,1]));var {coordScale:u,computedOpacity:v,transforms:w}=c;c.setSamplingProfile(e);c.bind(b.context,h.textureBindingBitmap);f.useProgram(d);d.setUniformMatrix3fv("u_dvsMat3",w.displayViewScreenMat3);d.setUniform1i("u_texture",h.textureBindingBitmap);d.setUniform2fv("u_coordScale",u);d.setUniform1f("u_opacity",v);this._quad.draw();b.timeline.end(this.name)}}}}return p});