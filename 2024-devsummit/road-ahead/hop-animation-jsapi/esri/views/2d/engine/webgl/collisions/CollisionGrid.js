// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../definitions","../../../layers/features/support/StaticBitSet"],function(h,g,k,m){class n{constructor(a,b,c){this._debugMap=new Map;this._width=a*c;this._height=b*c;this._pixelRatio=c;a=Math.ceil(this._width/1);b=Math.ceil(this._height/1);this._cols=a;this._rows=b;this._cells=m.StaticBitSet.create(a*b)}insertMetrics(a){const b=this._hasCollision(a);0===b&&this._markMetrics(a);return b}getCellId(a,b){return a+b*this._cols}has(a){return this._cells.has(a)}hasRange(a,
b){return this._cells.hasRange(a,b)}set(a){this._cells.set(a)}setRange(a,b){this._cells.setRange(a,b)}_collide(a,b,c,d){a-=c/2;b-=d/2;c=a+c;var e=b+d;if(0>c||0>e||a>this._width||b>this._height)return 1;d=g.clamp(Math.floor(a/1),0,this._cols);var f=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);b=g.clamp(Math.ceil(e/1),0,this._rows);for(c=f;c<=b;c++)for(e=d;e<=a;e++)if(f=this.getCellId(e,c),this.has(f))return 2;return 0}_mark(a,b,c,d,e){a-=c/2;b-=d/2;c=a+c;var f=b+d;d=
g.clamp(Math.floor(a/1),0,this._cols);var l=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);b=g.clamp(Math.ceil(f/1),0,this._rows);for(c=l;c<=b;c++)for(f=d;f<=a;f++)l=this.getCellId(f,c),this._debugMap.set(l,e),this.set(l);return!1}_hasCollision(a){let b=0;for(const {computedX:c,computedY:d,width:e,height:f}of a.bounds)switch(this._collide(c,d,(e+k.labelPlacementOffsetPadding)*this._pixelRatio,(f+k.labelPlacementOffsetPadding)*this._pixelRatio)){case 2:return 2;case 1:b++}return b===
a.bounds.length?1:0}_markMetrics(a){for(const {computedX:b,computedY:c,width:d,height:e}of a.bounds)this._mark(b,c,(d+k.labelPlacementOffsetPadding)*this._pixelRatio,(e+k.labelPlacementOffsetPadding)*this._pixelRatio,a.entityTexel)}}h.CollisionBitsetGrid=n;h.hasCollision=2;h.none=0;h.outsideExtent=1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});