// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/has","../definitions","../VertexStream","./Effect"],function(n,p,q,r,t){class u extends t.Effect{constructor(){super(...arguments);this.defines=[];this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(c,d){if(d?.size){var {context:a,renderingOptions:b}=c;this._quad||(this._quad=new r(a,[0,0,1,0,0,1,1,1]));var k=a.getBoundFramebufferObject(),{x:e,y:l,width:m,
height:f}=a.getViewport(),g=d.getBlock(q.AttributeDataType.Animation);if(null!=g){var h=d.getUniforms(a);a.setViewport(0,0,d.size,d.size);d=h.filterFlags;var v=h.animation,w=p("featurelayer-animation-enabled")?b.labelsAnimationTime:1;h=g.getFBO(a,1);a.unbindTexture(h.colorTexture);this._computeDelta(c,h,v,d,w);g=g.getFBO(a);a.unbindTexture(g.colorTexture);this._updateAnimationState(c,h,g);a.bindFramebuffer(k);a.setViewport(e,l,m,f)}}}_computeDelta(c,d,a,b,k){const {context:e,painter:l,displayLevel:m}=
c,f=l.materialManager.getProgram(this._desc,["delta"]);e.bindFramebuffer(d);e.setColorMask(!0,!0,!0,!0);e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT);e.useProgram(f);if(!("type"in b.texture&&"type"in a.texture))throw Error("InternalError: Expected to find texture");e.bindTexture(b.texture,b.unit);e.bindTexture(a.texture,a.unit);f.setUniform1i("u_maskTexture",b.unit);f.setUniform1i("u_sourceTexture",a.unit);f.setUniform1f("u_timeDelta",c.deltaTime);f.setUniform1f("u_animationTime",k);f.setUniform1f("u_zoomLevel",
Math.round(10*m));this._quad.draw()}_updateAnimationState(c,d,a){const {context:b,painter:k}=c;c=k.materialManager.getProgram(this._desc,["update"]);b.bindTexture(d.colorTexture,1);b.useProgram(c);c.setUniform1i("u_sourceTexture",1);b.bindFramebuffer(a);b.setColorMask(!0,!0,!0,!0);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._quad.draw()}}n.AnimationEffect=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});