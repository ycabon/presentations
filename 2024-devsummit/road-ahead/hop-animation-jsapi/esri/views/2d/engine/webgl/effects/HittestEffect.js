// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../definitions","./Effect","../../../../webgl/enums"],function(k,g,m,l){class n extends m.Effect{constructor(){super(...arguments);this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:b},a,e=g.hittestRadius){if(!a.length)return null;a=a.shift();const h=a.x,d=a.y;this._outstanding=a;return{type:"hittest",distance:e*b,position:[h,d]}}bind(b){const {context:a,attributeView:e}=b;e.size&&(b=e.getBlock(g.AttributeDataType.GPGPU),
null!=b&&(b=b.getFBO(a),a.setViewport(0,0,e.size,e.size),a.bindFramebuffer(b),a.setColorMask(!0,!0,!0,!0),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT)))}unbind(){}draw(b){if(null!=this._outstanding){var a=this._outstanding;this._outstanding=null;this._resolve(b,a.resolvers)}}async _resolve(b,a){const {context:e,attributeView:h}=b;b=h.getBlock(g.AttributeDataType.GPGPU);if(null==b)a.forEach(c=>c.resolve([]));else{var d=b.getFBO(e);b=new Uint8Array(d.width*d.height*
4);try{await d.readPixelsAsync(0,0,d.width,d.height,l.PixelFormat.RGBA,l.PixelType.UNSIGNED_BYTE,b)}catch(c){a.forEach(f=>f.resolve([]));return}d=[];for(let c=0;c<b.length;c+=4){const f=b[c+3];b[c]&&d.push({id:c/4,directHits:f})}d.sort((c,f)=>f.directHits===c.directHits?f.id-c.id:f.directHits-c.directHits);var p=d.map(c=>c.id);a.forEach(c=>c.resolve(p))}}}k.HittestEffect=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});