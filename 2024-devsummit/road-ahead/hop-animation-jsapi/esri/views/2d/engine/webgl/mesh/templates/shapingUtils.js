// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(C,v,y,w,I,G,K,A){function B(a,b){a.forEach(c=>w.transformMat2d(c,c,b));return{topLeft:a[0],topRight:a[1],bottomLeft:a[2],bottomRight:a[3]}}const L=Math.PI/180;class H{constructor(a,b,c,
d){this._rotationT=y.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const e=c.rect,f=new Float32Array(8);a*=d;b*=d;const g=c.code?e.width*d:c.metrics.width,q=c.code?e.height*d:c.metrics.height;this.width=g;this.height=q;f[0]=a;f[1]=b;f[2]=a+g;f[3]=b;f[4]=a;f[5]=b+q;f[6]=a+g;f[7]=b+q;this._data=f;this._setTextureCoords(e);this._scale=d;this._mosaic=c;this.x=a;this.y=b;this.maxOffset=Math.max(a+g,b+q)}get mosaic(){return this._mosaic}set angle(a){this._angle=
a;v.fromRotation(this._rotationT,-a);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:e,
width:f}=this._mosaic.metrics;var a=f*this._scale,b=Math.abs(e)*this._scale,c=new Float32Array(8);c[0]=this.x;c[1]=this.y;c[2]=this.x+a;c[3]=this.y;c[4]=this.x;c[5]=this.y+b;c[6]=this.x+a;c[7]=this.y+b;a=v.multiply(y.create(),this._rotationT,this._transform);y.transformMany(c,c,a);b=a=Infinity;let g=0;var d=0;for(let q=0;4>q;q++){const m=c[2*q],l=c[2*q+1];a=Math.min(a,m);b=Math.min(b,l);g=Math.max(g,m);d=Math.max(d,l)}c=g-a;d-=b;this._bounds=new A(a+c/2,b+d/2,c,d)}return this._bounds}setTransform(a){this._transform=
a;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const a=v.multiply(y.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];w.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,a);w.transformMat2d(this._offsets.topRight,this._offsets.topRight,a);w.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,a);w.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,a)}_setTextureCoords({x:a,y:b,width:c,height:d}){this._texcoords={topLeft:[a,b],topRight:[a+c,b],bottomLeft:[a,b+d],bottomRight:[a+c,b+d]}}}class J{constructor(a,b,c){this._rotation=0;this._decorate(a,b,c);this.glyphs=
a;this.bounds=this._createBounds(a);this.isMultiline=1<b.length;this._hasRotation=0!==c.angle;this._transform=this._createGlyphTransform(this.bounds,c);if((this._borderLineSizePx=c.borderLineSizePx)||c.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const d of a)d.setTransform(this._transform)}setRotation(a){if(0!==a||0!==this._rotation){this._rotation=a;var b=this._transform;a=v.fromRotation(y.create(),a);v.multiply(b,a,b);for(const c of this.glyphs)c.setTransform(this._transform)}}_decorate(a,
b,c){if(c.decoration&&"none"!==c.decoration&&a.length){var d=c.scale;c="underline"===c.decoration?26:16;var e=a[0].textureBinding;for(const m of b){const l=m.startX*d,k=m.startY*d;b=a;var f=b.push;var g=(m.width+m.glyphWidthEnd)*d;var q=e;g={code:0,page:0,sdf:!0,rect:new K(0,0,11,8),textureBinding:q,metrics:{advance:0,height:4,width:g,left:0,top:0}};f.call(b,new H(l,k+c*d,g,1))}}}shapeBackground(a){const b=(1.5+(this._borderLineSizePx||0))/2;var c=this._borderLineSizePx?b:0;const {xmin:d,ymin:e,xmax:f,
ymax:g,x:q,y:m,width:l,height:k}=this.bounds,h=[d-8,e-8],n=[f+8,e-8],p=[d-8,g+8],r=[f+8,g+8],D=B([[h[0]-b,h[1]-b],[n[0]+b,n[1]-b],[h[0]+c,h[1]+c],[n[0]-c,n[1]+c]],a),t=B([[p[0]+c,p[1]-c],[r[0]-c,r[1]-c],[p[0]-b,p[1]+b],[r[0]+b,r[1]+b]],a),u=B([[h[0]-b,h[1]-b],[h[0]+c,h[1]+c],[p[0]-b,p[1]+b],[p[0]+c,p[1]-c]],a);c=B([[n[0]-c,n[1]+c],[n[0]+b,n[1]-b],[r[0]-c,r[1]-c],[r[0]+b,r[1]+b]],a);a={main:B([h,n,p,r],a),top:D,bot:t,left:u,right:c};return[new A(q,m,l+2*b,k+2*b),a]}get boundsT(){var a=this.bounds;
const b=w.set(I.create(),a.x,a.y);w.transformMat2d(b,b,this._transform);return this._hasRotation?(a=Math.max(a.width,a.height),new A(b[0],b[1],a,a)):new A(b[0],b[1],a.width,a.height)}_createBounds(a){let b=Infinity,c=Infinity,d=0;var e=0;for(const f of a)b=Math.min(b,f.xTopLeft),c=Math.min(c,f.yTopLeft),d=Math.max(d,f.xBottomRight),e=Math.max(e,f.yBottomRight);a=d-b;e-=c;return new A(b+a/2,c+e/2,a,e)}_createGlyphTransform(a,b){const c=L*b.angle,d=y.create(),e=I.create();v.translate(d,d,w.set(e,b.xOffset,
-b.yOffset));b.useCIMAngleBehavior?v.rotate(d,d,c):(v.translate(d,d,w.set(e,a.x,a.y)),v.rotate(d,d,c),v.translate(d,d,w.set(e,-a.x,-a.y)));return d}}class E{constructor(a,b,c,d,e,f){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(b,c));this.end=Math.max(0,Math.max(b,c));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=e;this.yMax=f}}C.ShapedGlyph=H;C.ShapingInfo=J;C.shapeGlyphs=function(a,b){const c=b.scale,d=[],{glyphs:e,isRightToLeft:f}=
a;a=[];var g=1/b.scale*b.maxLineWidth;var q=f?e.length-1:0;var m=f?-1:e.length,l=f?-1:1,k=q,h=0,n=0,p=k;let r=p,D=0,t=Infinity,u=0;for(;k!==m;){const {code:z,metrics:x}=e[k];var F=Math.abs(x.top);10!==z&&32!==z&&(t=Math.min(t,F),u=Math.max(u,F+x.height));10===z?(k!==q&&(a.push(new E(e,p,k-l,h,t,u)),t=Infinity,u=0),h=0,p=k+l,r=k+l,n=0):32===z?(r=k+l,n=0,D=x.advance,h+=x.advance):(h>g&&(r!==p?(F=r-2*l,h-=D,a.push(new E(e,p,F,h-n,t,u)),t=Infinity,u=0,p=r,h=n):(a.push(new E(e,p,k-l,h,t,u)),t=Infinity,
u=0,r=p=k,h=0)),h+=x.advance,n+=x.advance);k+=l}g=new E(e,p,k-l,h,t,u);0<=g.start&&g.end<e.length&&a.push(g);for(g=0;g<a.length;g++);m=a[0].yMin;q=a[a.length-1].yMax+b.lineHeight*(a.length-1)+("underline"===b.decoration?4:0)-m;g=G.getXAnchorDirection(b.horizontalAlignment);l=G.getYAnchorDirection(b.verticalAlignment);k=l===G.VAlign.Baseline?1:0;q=(1-k)*-m+q/2*(k?0:l-1)+-22*(k?1:0);for(m=0;m<a.length;m++){const {start:z,end:x,width:M}=a[m];l=M/2*(g+1)*-1-3;k=m*b.lineHeight+q-3;a[m].startX=l;a[m].startY=
k;for(h=z;h<=x;h++)n=e[h],10!==n.code&&(p=new H(l+n.metrics.left,k-n.metrics.top,n,c),l+=n.metrics.advance,d.push(p))}return new J(d,a,b)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});