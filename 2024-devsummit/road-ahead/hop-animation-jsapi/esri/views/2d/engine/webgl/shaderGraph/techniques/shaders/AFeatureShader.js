// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../../highlightReasons ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(k,f,p,e,a,q,r,t,h,u){class l extends e.VertexInput{}f.__decorate([e.location(0,a.Vec3)],l.prototype,"id",void 0);f.__decorate([e.location(1,a.Float)],l.prototype,"bitset",void 0);f.__decorate([e.location(2,a.Vec2)],l.prototype,"pos",void 0);class m extends e.ComputeVertexInput{}f.__decorate([e.location(14,
a.Vec2)],m.prototype,"nextPos1",void 0);f.__decorate([e.location(15,a.Vec2)],m.prototype,"nextPos2",void 0);class v extends e.FragmentInput{}class g extends e.GraphShaderModule{clip(b,d){let c=new a.Float(0);b=this.storage.getFilterFlags(b);c=c.add(a.float(2).multiply(a.float(1).subtract(h.getFilterBit(b,0))));this.inside?c=c.add(a.float(2).multiply(a.float(1).subtract(h.getFilterBit(b,1)))):this.outside?c=c.add(a.float(2).multiply(h.getFilterBit(b,1))):this.highlight&&(c=c.add(a.float(2).multiply(a.float(1).subtract(this._checkHighlight(b)))));
null!=d&&(b=(new a.Float(1)).subtract(a.step(d.x,this.view.currentZoom)),d=a.step(d.y,this.view.currentZoom),c=c.add((new a.Float(2)).multiply(b.add(d))));return c}getFragmentOutput(b,d,c=new a.Float(1/255)){const n=new e.FragmentOutput;n.glFragColor=this._maybeWriteHittest(d)??this._maybeHighlight(b,c)??b;return n}_maybeHighlight(b,d){return this.highlight?new a.Vec4(b.rgb,a.step(d,b.a)):null}_checkHighlight(b){let d=this._checkHighlightBit(b,0);for(let c=1;c<p.highlightReasons.length;c++)d=d.add(this._checkHighlightBit(b,
c));return a.step(new a.Float(.1),d.add(this.highlight.highlightAll))}_checkHighlightBit(b,d){return h.getHighlightBit(b,d).multiply(h.getBit(this.highlight.activeReasons,d))}maybeRunHittest(b,d,c){if(null==this.hittestRequest)return null;c=this.hittest(b,d,c);d=a.ifElse(a.greaterThanEqual(c,this.hittestRequest.distance),new a.Float(2),new a.Float(0));b=this.storage.getAttributeDataCoords(b.id);b=h.uvToClip(b);c=new a.Vec4(new a.Float(1/255),0,0,a.step(new a.Float(0),c).divide(255));return{glPointSize:new a.Float(1),
glPosition:new a.Vec4(b,d,1),color:c}}_maybeWriteHittest(b){return null!=this.hittestRequest?b.color:null}}f.__decorate([e.define],g.prototype,"inside",void 0);f.__decorate([e.define],g.prototype,"outside",void 0);f.__decorate([e.option(r.ShaderHighlight)],g.prototype,"highlight",void 0);f.__decorate([e.uniform(q.EntityStorage)],g.prototype,"storage",void 0);f.__decorate([e.uniform(u.ViewInfo)],g.prototype,"view",void 0);f.__decorate([e.option(t.ShaderHittest)],g.prototype,"hittestRequest",void 0);
k.AFeatureShader=g;k.BaseHittestVertexInput=m;k.FeatureFragmentInput=v;k.FeatureVertexInput=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});