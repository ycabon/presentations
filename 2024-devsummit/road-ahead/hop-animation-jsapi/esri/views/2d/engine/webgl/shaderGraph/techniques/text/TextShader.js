// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(u,d,w,e,b,x,r,B,C,y,D,E,F,G,H,I,J,z){const K=360/254;class l extends x.FeatureVertexInput{}d.__decorate([e.location(3,b.Vec4)],l.prototype,"color",void 0);d.__decorate([e.location(4,b.Vec2)],l.prototype,"offset",void 0);d.__decorate([e.location(5,b.Vec2)],l.prototype,"textureUV",void 0);d.__decorate([e.location(6,b.Float)],l.prototype,"fontSize",void 0);d.__decorate([e.location(7,b.Float)],l.prototype,"referenceSize",void 0);d.__decorate([e.location(8,b.Float)],l.prototype,"haloFontSize",
void 0);d.__decorate([e.location(9,b.Vec4)],l.prototype,"haloColor",void 0);d.__decorate([e.location(10,b.Vec2)],l.prototype,"zoomRange",void 0);d.__decorate([e.location(11,b.Float)],l.prototype,"clipAngle",void 0);d.__decorate([e.location(12,b.Vec4)],l.prototype,"referenceSymbol",void 0);class A extends x.FeatureFragmentInput{}class h extends x.AFeatureShader{constructor(){super(...arguments);this.isLabel=this.isBackgroundPass=this.isHaloPass=!1}clipLabel(a,c,f){c=c.multiply(K);c=b.abs(this.view.rotation.subtract(c));
var g=b.min((new b.Float(360)).subtract(c),c);c=new b.Float(0);const p=b.floor(this.view.currentZoom.multiply(w.minMaxZoomPrecisionFactor)).divide(w.minMaxZoomPrecisionFactor);var m=a.x;a=a.y;m=(new b.Float(1)).subtract(b.step(m,p)).multiply(2);g=b.step(new b.Float(90),g).multiply(2);a=(new b.Float(2)).multiply((new b.Float(1)).subtract(b.step(p,a)));c=c.add(f.multiply(m));c=c.add(f.multiply(g));return c=c.add(a)}vertex(a){var c=y.getBit(a.bitset,r.bitsetTextIsBackground),f=(new b.Float(1)).subtract(c);
let g=a.fontSize,p=g.divide(r.sdfFontSize);var m=this.isHaloPass?a.haloColor:this._getVertexColor(a),n=y.getBit(a.bitset,r.bitsetTextIsLineLabel);m=this.isLabel?m.multiply(b.max(this.storage.getAnimationValue(a.id),n)):m;var v=this.view.displayViewScreenMat3.multiply(new b.Vec3(a.pos.xy,1));n=a.offset.xy;if(this.isLabel){if(!a.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");var t=a.referenceSymbol,q=t.xy,k=t.z;t=this._unpackDirection(t.w);k=z.getVisualVariableSize(this,
a.id,k).divide(2);k=t.multiply(k.add(w.labelPlacementOffsetPadding));n=n.add(q).add(k)}else q=z.getVisualVariableSize(this,a.id,a.referenceSize).divide(a.referenceSize),g=g.multiply(q),p=p.multiply(q),n=n.multiply(q),n=z.getVisualVariableRotation(this,a.id).multiply(new b.Vec3(n,0)).xy;k=y.getBit(a.bitset,r.bitsetTextIsMapAligned);q=this._getViewRotationMatrix(k).multiply(new b.Vec3(n,0));k=this.isLabel?this.clipLabel(a.zoomRange,a.clipAngle,k):this.clip(a.id,a.zoomRange);k=this.isBackgroundPass?
k.add(f.multiply(2)):k.add(c.multiply(2));c=new b.Vec4(v.xy.add(q.xy),k,1);f=a.textureUV.divide(this.mosaicInfo.size);v=new b.Float(0);this.isHaloPass&&(v=a.haloFontSize.divide(p).divide(r.maxSdfDistance));q=(new b.Float(.105*r.sdfFontSize)).divide(g);return{glPosition:c,color:m,size:p,textureUV:f,antialiasingWidth:q,haloDistanceOffset:v,...this.maybeRunHittest(a,{},{fontSize:g,offset:n})}}_getViewRotationMatrix(a){const c=this.view.displayViewMat3,f=this.view.displayMat3,g=(new b.Float(1)).subtract(a);
return c.multiply(a).add(f.multiply(g))}fragment(a){var c=new b.Float(.25),f=(new b.Float(1)).subtract(c);c=b.texture2D(this.mosaicInfo.texture,a.textureUV).a;f=f.subtract(a.haloDistanceOffset);this.highlight&&(f=f.divide(2));const g=a.antialiasingWidth;c=b.smoothstep(f.subtract(g),f.add(g),c);return this.getFragmentOutput(a.color.multiply(c),a)}hittest(a,c,{fontSize:f,offset:g}){const {viewMat3:p,tileMat3:m}=this.view;a=p.multiply(m).multiply(new b.Vec3(a.pos,1)).add(m.multiply(new b.Vec3(g,0)));
return B.hittestMarker(a.xy,f.divide(2),this.hittestRequest.position)}_unpackDirection(a){var c=new b.Int(a);a=b.bitRShift(c,new b.Int(2));c=b.bitAnd(c,new b.Int(3));return new b.Vec2((new b.Float(a)).subtract(1),(new b.Float(c)).subtract(1))}_getVertexColor(a){var c=a.color;this.visualVariableColor&&(c=this.storage.getColorValue(a.id),c=this.visualVariableColor.getColor(c,a.color,new b.Bool(!1)));this.visualVariableOpacity&&(a=this.storage.getOpacityValue(a.id),a=this.visualVariableOpacity.getOpacity(a),
c=c.multiply(a));return c}}d.__decorate([e.option(D.VisualVariableColor)],h.prototype,"visualVariableColor",void 0);d.__decorate([e.option(E.VisualVariableOpacity)],h.prototype,"visualVariableOpacity",void 0);d.__decorate([e.option(F.VisualVariableRotation)],h.prototype,"visualVariableRotation",void 0);d.__decorate([e.option(G.VisualVariableSizeMinMaxValue)],h.prototype,"visualVariableSizeMinMaxValue",void 0);d.__decorate([e.option(H.VisualVariableSizeScaleStops)],h.prototype,"visualVariableSizeScaleStops",
void 0);d.__decorate([e.option(I.VisualVariableSizeStops)],h.prototype,"visualVariableSizeStops",void 0);d.__decorate([e.option(J.VisualVariableSizeUnitValue)],h.prototype,"visualVariableSizeUnitValue",void 0);d.__decorate([e.uniform(C.MosaicInfo)],h.prototype,"mosaicInfo",void 0);d.__decorate([e.define],h.prototype,"isHaloPass",void 0);d.__decorate([e.define],h.prototype,"isBackgroundPass",void 0);d.__decorate([e.define],h.prototype,"isLabel",void 0);d.__decorate([d.__param(0,e.input(l))],h.prototype,
"vertex",null);d.__decorate([d.__param(0,e.input(A))],h.prototype,"fragment",null);u.TextFragmentInput=A;u.TextShader=h;u.TextVertexInput=l;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});