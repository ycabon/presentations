// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../shaderGraph/techniques/mesh/createMeshWriter","./Matcher"],function(k,h,n){class l extends n.FeatureMatcher{constructor(a,c){super();this._defaultSymbolSortKey=0;this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fields=a;this._separator=c||""}static async fromMatcherSchema(a,c,b,e){var d=b.expression?[a.createComputedField({expression:b.expression})]:[b.field?a.createComputedField({field:b.field}):null,b.field2?a.createComputedField({field:b.field2}):null,
b.field3?a.createComputedField({field:b.field3}):null];d=(await Promise.all(d)).filter(f=>!!f);const g=new l(d,b.fieldDelimiter);d=await h.createMeshWriterGroupFromSchema(a,c,b.defaultSymbol,e);g.setDefault(d);d=await h.createMeshWriterGroupFromSchema(a,c,b.backgroundFill,e);g.setBackgroundFill(d);await Promise.all(b.map.map(async(f,p)=>{const m=await h.createMeshWriterGroupFromSchema(a,c,f.symbol,e);"\x3cNull\x3e"===f.value?g.setNullResult(m):g.add(f.value,m,p+1)}));return g}setNullResult(a){this._nullResult=
a}getSortKey(a,c){a=this._getValueFromFields(a,c);return null==a||""===a||"\x3cNull\x3e"===a?0:(a=this._resultsMap.get(a.toString()))?a.sortKey:this._defaultSymbolSortKey}add(a,c,b){this._resultsMap.set(a.toString(),{meshWriters:c,sortKey:b});this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,b+1)}size(){return super.size()+this._resultsMap.size}doMatch(a,c){a=this._getValueFromFields(a,c);return null===this._nullResult||null!=a&&""!==a&&"\x3cNull\x3e"!==a?null==a?null:this._resultsMap.get(a.toString())?.meshWriters:
this._nullResult}_getValueFromFields(a,c){const b=[];for(const e of this._fields){const d=e.read(a,c);null==d||""===d?b.push("\x3cNull\x3e"):b.push(d)}return b.join(this._separator)}}k.MapMatcher=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});