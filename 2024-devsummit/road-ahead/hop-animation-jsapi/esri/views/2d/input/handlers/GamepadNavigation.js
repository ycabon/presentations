// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/scheduling ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),function(f,k,g,l,h,m,e){class n extends m.InputHandler{constructor(a){super(!0);this._view=a;this._frameTask=null;this._watchHandles=new k;this._currentDevice=null;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._handle=this.registerIncoming("gamepad",b=>this._handleGamePadEvent(b));
this._handle.pause()}onInstall(a){super.onInstall(a);this._watchHandles.add([g.watch(()=>this._view.navigation.gamepad?.enabled,b=>{b?(this._handle.resume(),this._frameTask||(this._frameTask=l.addFrameTask({update:c=>this._frameUpdate(c.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},g.initial)])}onUninstall(){this._watchHandles.removeAll();this._frameTask&&(this._frameTask.remove(),this._frameTask=null);super.onUninstall()}_handleGamePadEvent(a){const b=
this._view.navigation.gamepad.device;b&&a.data.device!==b||this._currentDevice&&this._currentDevice!==a.data.device||("end"===a.data.action?(this._currentDevice=null,e.resetTransformation(this._transformation)):(this._currentDevice=a.data.device,e.extractTransformation(a.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(a){const b=this._transformation;if(!e.isZeroTransformation(b)){var c=this._view.viewpoint.clone(),d=.7*this._view.navigation.gamepad.velocityFactor*a;h.translateBy(c,
c,[b.translation[0]*d,-b.translation[1]*d]);d=this._view.size;h.scaleAndRotateBy(c,c,1+6E-4*b.translation[2]*a,this._view.constraints.rotationEnabled?.06*-b.heading*a:0,[d[0]/2,d[1]],d);a=this._view.constraints.constrain(c,this._view.viewpoint);this._view.viewpoint=a}}}f.GamepadNavigation=n;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});