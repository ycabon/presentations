// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ControlPointsTransformTool ./TransformTool".split(" "),function(c,e,p,k,f,x,y,z,q,m,r){const h={redo:"r",undo:"z"};c.MediaTransformToolsWrapper=class extends p{constructor(a){super(a);this._activeTool=this._advancedModeTransformTool=
this._controlPointsTransformTool=this._transformTool=null;this._sharedUndoStack=[];this._sharedRedoStack=[];this._originalOpacity=null;this.activeHandle=0}initialize(){const {view:a,mediaElement:d,preserveAspectRatio:t,snapRotation:u,advancedMode:g}=this;this._originalOpacity=d.opacity;this._transformTool=new r.TransformTool({target:d,view:a,preserveAspectRatio:t,snapRotation:u});this._controlPointsTransformTool=new m.ControlPointsTransformTool({mediaElement:d,view:a});this._advancedModeTransformTool=
new m.ControlPointsTransformTool({mediaElement:g.mediaElement,view:g.view});this._transformTool.setSharedUndoStack(this._sharedUndoStack);this._transformTool.setSharedRedoStack(this._sharedRedoStack);this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack);this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack);this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack);this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const l=
d.georeference,n=g.mediaElement.georeference;g.view.tools.addMany([this._advancedModeTransformTool]);"controlPoints"in n&&"controlPoints"in l&&this.addHandles([g.view.on("key-down",b=>{b.key===h.undo&&this.canUndo()&&(this.undo(),b.stopPropagation());b.key===h.redo&&this.canRedo()&&(this.redo(),b.stopPropagation())}),g.view.on("focus",async b=>{this._controlPointsTransformTool.removeHighlightActiveHandle();this._advancedModeTransformTool.highlightActiveHandle()}),k.watch(()=>n.controlPoints,b=>{l.controlPoints=
b.map(({sourcePoint:v},w)=>({sourcePoint:v,mapPoint:l.controlPoints[w].mapPoint}));this._activeTool?.refresh()}),k.watch(()=>this._controlPointsTransformTool.activeHandle,b=>{this._advancedModeTransformTool.updateActiveHandle(b);this.activeHandle=b}),k.watch(()=>this._advancedModeTransformTool.activeHandle,b=>{this._controlPointsTransformTool.updateActiveHandle(b);this.activeHandle=b})]);this.addHandles([a.on("key-down",b=>{b.key===h.undo&&this.canUndo()&&(this.undo(),b.stopPropagation());b.key===
h.redo&&this.canRedo()&&(this.redo(),b.stopPropagation())}),a.on("focus",async b=>{this._advancedModeTransformTool.removeHighlightActiveHandle();this._controlPointsTransformTool.highlightActiveHandle()})]);a.tools.addMany([this._transformTool,this._controlPointsTransformTool]);this._activeTool=a.activeTool=this._transformTool;a.focus()}destroy(){this._transformTool?.destroy();this._controlPointsTransformTool?.destroy();this._sharedRedoStack=this._sharedUndoStack=this._activeTool=this._advancedModeTransformTool=
this._controlPointsTransformTool=this._transformTool=null}canUndo(){return 0<this._sharedUndoStack.length}canRedo(){return 0<this._sharedRedoStack.length}undo(){if(0<this._sharedUndoStack.length){const {tool:a,operation:d}=this._sharedUndoStack.pop();a!==this._activeTool&&a.refresh();d.undo();a.updateGraphics();this._sharedRedoStack.push({tool:a,operation:d});this._activeTool!==a&&this._activeTool?.refresh()}}redo(){if(0<this._sharedRedoStack.length){const {tool:a,operation:d}=this._sharedRedoStack.pop();
a!==this._activeTool&&a.refresh();d.apply();a.updateGraphics();this._sharedUndoStack.push({tool:a,operation:d});this._activeTool!==a&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset();this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this._activeTool=this.view.activeTool=this._controlPointsTransformTool;this._activeTool.refresh();await this.advancedMode.view.when();this.advancedMode.view.activeTool=this._advancedModeTransformTool;this._originalOpacity=
this._controlPointsTransformTool.mediaElement.opacity;this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this._activeTool=this.view.activeTool=this._transformTool;this._activeTool.refresh();this.advancedMode.view.activeTool=null;this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};e.__decorate([f.property()],c.MediaTransformToolsWrapper.prototype,"activeHandle",void 0);e.__decorate([f.property({constructOnly:!0})],c.MediaTransformToolsWrapper.prototype,
"advancedMode",void 0);e.__decorate([f.property()],c.MediaTransformToolsWrapper.prototype,"preserveAspectRatio",void 0);e.__decorate([f.property()],c.MediaTransformToolsWrapper.prototype,"snapRotation",void 0);e.__decorate([f.property({constructOnly:!0,nonNullable:!0})],c.MediaTransformToolsWrapper.prototype,"mediaElement",void 0);e.__decorate([f.property({constructOnly:!0})],c.MediaTransformToolsWrapper.prototype,"view",void 0);c.MediaTransformToolsWrapper=e.__decorate([q.subclass("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],
c.MediaTransformToolsWrapper);c.keys=h;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});