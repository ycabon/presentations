// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/Handles ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Manipulation ./utils ../../../../draw/support/drawUtils ../../../../interactive/dragEventPipeline ../../../../interactive/GraphicManipulator ../../../../interactive/editGeometry/interfaces ../../../../interactive/editGeometry/operations/UpdateVertices ../../../../interactive/editGeometry/support/editPlaneUtils".split(" "),function(g,p,q,r,h,t,u,k,v,l,w,x){class y extends h.Manipulation{constructor(b){super();
this._handles=new p;this._originCache=r.create();this._view=b.view;this._tool=b.tool;this._graphic=b.graphic;this._snapRotation=b.snapRotation;this._manipulator=this._createManipulator();this._handles.add([this._manipulator.events.on("grab-changed",d=>t.onGrabChangedHandle(d,this._manipulator))]);this.forEachManipulator(d=>this._tool.manipulators.add(d))}destroy(){this._handles.destroy();this.forEachManipulator(b=>{this._tool.manipulators.remove(b);b.destroy()});this._originCache=this._handles=this._graphic=
this._snapRotation=this._manipulator=this._view=this._tool=null}forEachManipulator(b){b(this._manipulator,h.ManipulatorType.ROTATE)}createDragPipeline(b,d){let e=null,f=null;return k.createManipulatorDragEventPipeline(this._manipulator,(m,z)=>{z.next(a=>{if("start"===a.action){m.cursor="grabbing";const c=b();e=c.plane;f=c.editGeometryOperations}return a}).next(k.screenToMap(this._view)).next(a=>({...a,rotateAngle:u.getRotationAngle(a.mapStart,a.mapEnd,{x:e.origin[0],y:e.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),
this._snapRotation.next).next(a=>{var c=q.copy(this._originCache,e.origin);const n=[];for(const A of f.data.components)n.push(...A.vertices);c=f.rotateVertices(n,c,a.rotateAngle,"start"===a.action?l.AccumulationBehavior.NEW_STEP:l.AccumulationBehavior.ACCUMULATE_STEPS,w.AccumulationType.REPLACE);x.apply(c,e);d(a,c);return a}).next(a=>{"end"===a.action&&(m.cursor="grab");return a})})}_createManipulator(){return new v.GraphicManipulator({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}
g.RotateManipulation=y;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});