// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/subclass".split(" "),function(g,m,q,p,r,d,u){m=class extends m{constructor(){super(...arguments);this.isAggregate=!0}getEffectivePopupTemplate(y){return this.popupTemplate?this.popupTemplate:(y=this.sourceLayer?.featureReduction)&&"popupTemplate"in y&&y.popupEnabled?y.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};
g.__decorate([q.property({type:Boolean})],m.prototype,"isAggregate",void 0);return m=g.__decorate([u.subclass("esri.AggregateGraphic")],m)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(g,m,q,p,r,d,u,y){m=class extends m{constructor(n){super(n);this._filter=null;
this.duration=q("mapview-transitions-duration");this._excludedEffectView=new y.EffectView(n);this._includedEffectView=new y.EffectView(n)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(n){this._get("featureEffect")!==n&&this._transitionTo(n)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(n){this._set("scale",
n);this._excludedEffectView.scale=n;this._includedEffectView.scale=n}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(n,l){this._set("scale",l);this.transitioning?(this._includedEffectView.transitionStep(n,l),this._excludedEffectView.transitionStep(n,l),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=l,this._includedEffectView.scale=l)}endTransitions(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();
this._filter=null}_transitionTo(n){const l=this._get("featureEffect"),a=n?.includedEffect,b=n?.excludedEffect,c=this._includedEffectView.canTransitionTo(a)&&this._excludedEffectView.canTransitionTo(b);this._includedEffectView.effect=a;this._excludedEffectView.effect=b;this._set("featureEffect",n);this._filter=n?.filter||l?.filter||null;c||this.endTransitions()}};g.__decorate([p.property()],m.prototype,"_filter",void 0);g.__decorate([p.property()],m.prototype,"_excludedEffectView",void 0);g.__decorate([p.property()],
m.prototype,"_includedEffectView",void 0);g.__decorate([p.property()],m.prototype,"duration",void 0);g.__decorate([p.property()],m.prototype,"excludedEffects",null);g.__decorate([p.property()],m.prototype,"featureEffect",null);g.__decorate([p.property()],m.prototype,"filter",null);g.__decorate([p.property()],m.prototype,"hasEffects",null);g.__decorate([p.property()],m.prototype,"includedEffects",null);g.__decorate([p.property({value:0})],m.prototype,"scale",null);g.__decorate([p.property()],m.prototype,
"transitioning",null);return m=g.__decorate([u.subclass("esri.layers.effects.FeatureEffectView")],m)})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(g,m,q,p,r,d,u,y,n,
l,a){q=class extends l{constructor(){super(...arguments);this.features=[]}readFeatures(b,c){c=a.fromJSON(c.spatialReference);const t=[];for(let D=0;D<b.length;D++){var h=b[D];const x=m.fromJSON(h);var w=h.geometry?.spatialReference;null==x.geometry||w||(x.geometry.spatialReference=c);h=h.aggregateGeometries;w=x.aggregateGeometries;if(h&&null!=w)for(const f in w){const v=w[f],z=h[f]?.spatialReference;null==v||z||(v.spatialReference=c)}t.push(x)}return t}};g.__decorate([p.property({type:[m],json:{write:!0}})],
q.prototype,"features",void 0);g.__decorate([y.reader("features")],q.prototype,"readFeatures",null);return q=g.__decorate([n.subclass("esri.rest.support.AggregateFeatureSet")],q)})},"esri/views/2d/engine/webgl/shaderGraph/techniques/InstanceStore":function(){define(["../../../../../../core/string","./TechniqueInstance","./mesh/instanceIdUtils"],function(g,m,q){class p{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}updateStart(){this._instanceByIdNext=
new Map}updateEnd(){if(!this._instanceByIdNext)throw Error("InternalError: Found updateEnd call without corresponding updateStart");for(var r of this._instanceById.keys())this._instanceByIdNext.has(r)||this._instanceById.delete(r);for(const [d,u]of this._instanceByIdNext.entries())(r=this._instanceById.get(d))?r.setInput(u.getInput()):this._instanceById.set(d,u);this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(r,d,u){var y=`${r.registryName}`;for(const n in d){const l=
d[n];if("object"===typeof l&&"geometry"===n)for(const a in l)y+=`.${n}.${a}.${null!=l[a]}`;else y+=`.${n}.${null!=d[n]}`}if(null!=u)for(const n in u)u[n]&&(y+=`-${n}`);y=g.numericHash(y);if(this._instanceByIdNext)return r=new m.TechniqueInstance(q.castInstanceId(y),r,r.meshWriter.name,d,u),this._instanceByIdNext.set(y,r),r;this._instanceById.has(y)||(r=new m.TechniqueInstance(q.castInstanceId(y),r,r.meshWriter.name,d,u),this._instanceById.set(y,r));return this._instanceById.get(y)}getInstance(r){return this._instanceById.get(r)}}
return p})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c,t,h,w,D){const x=q.ofType({key:"type",base:null,typeMap:{rect:h,path:D,geometry:w}});g.LayerView2DMixin=f=>{f=class extends f{constructor(){super(...arguments);this.attached=!1;this.clips=new x;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const v=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&v&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new r("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([d.watch(()=>this.suspended,z=>{this.container&&(this.container.visible=!z)},d.syncAndInitial),d.watch(()=>this.updateSuspended,z=>{this.view&&!z&&this.updateRequested&&this.view.requestUpdate()},d.syncAndInitial),d.watch(()=>this.layer?.opacity??
1,z=>{this.container&&(this.container.opacity=z)},d.syncAndInitial),d.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",z=>{this.container&&(this.container.blendMode=z)},d.syncAndInitial),d.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,z=>{this.container&&(this.container.effect=z)},d.syncAndInitial),d.watch(()=>this.highlightOptions,z=>this.container.highlightOptions=z,d.syncAndInitial),d.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},d.syncAndInitial),d.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:z})=>{z=null!=z?this.isVisibleAtScale(z):!1;z!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",z)},d.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(z=>{z===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const v=this.view?.spatialReference;return null==v||this.supportsSpatialReference(v)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(v){const z=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!z)return!0;const {minScale:e,maxScale:A}=z;return b.isInScaleRange(v,e,A)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(v){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
v),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(v)))}hitTest(v,z){return Promise.resolve(null)}supportsSpatialReference(v){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const v=super.getSuspendInfo(),z=!this.spatialReferenceSupported,e=this.visibleAtCurrentScale;z&&(v.spatialReferenceNotSupported=z);e&&(v.outsideScaleRange=e);return v}addAttachHandles(v){this.addHandles(v,"attach")}};
m.__decorate([u.property()],f.prototype,"attached",void 0);m.__decorate([u.property({type:x,set(v){v=p.referenceSetter(v,this._get("clips"),x);this._set("clips",v)}})],f.prototype,"clips",void 0);m.__decorate([u.property()],f.prototype,"container",void 0);m.__decorate([u.property()],f.prototype,"moving",void 0);m.__decorate([u.property({readOnly:!0})],f.prototype,"spatialReferenceSupported",null);m.__decorate([u.property({readOnly:!0})],f.prototype,"updateParameters",void 0);m.__decorate([u.property()],
f.prototype,"updateRequested",void 0);m.__decorate([u.property()],f.prototype,"updateSuspended",null);m.__decorate([u.property()],f.prototype,"updating",null);m.__decorate([u.property()],f.prototype,"view",void 0);m.__decorate([u.property({readOnly:!0})],f.prototype,"visibleAtCurrentScale",void 0);m.__decorate([u.property({type:t})],f.prototype,"highlightOptions",void 0);return f=m.__decorate([a.subclass("esri.views.2d.layers.LayerView2D")],f)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(g,m,q){function p(r,d){d=q.getMetersPerUnitForSR(d);return r/(d*q.inchesPerMeter*96)}g.getExtentForScale=function(r,d){const u=r.extent;r=r.width-(r.padding?r.padding.left+r.padding.right:0);d=p(d,u.spatialReference);return u.clone().expand(d*r/u.width)};g.getResolutionForScale=p;g.getResolutionInMetersForScale=function(r){return r/(96*q.inchesPerMeter)};g.getScale=function(r,d){d=
d||r.extent;r=r.width;const u=q.getMetersPerUnitForSR(d?.spatialReference);return d&&r?d.width/r*u*q.inchesPerMeter*96:0};g.getScaleForResolution=function(r,d){d=q.getMetersPerUnitForSR(d);return r*d*q.inchesPerMeter*96};g.isInScaleRange=function(r,d,u){if(d=0===d||m.floatEqualAbsolute(r,d)||r<d)d=0===u||m.floatEqualAbsolute(r,u)||r>u;return d};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(g,m,q,p,r,d,u){var y;q=y=class extends u{constructor(n){super(n);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new y({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};g.__decorate([m.property({type:[Number,String],json:{write:!0}})],q.prototype,"left",void 0);g.__decorate([m.property({type:[Number,String],
json:{write:!0}})],q.prototype,"right",void 0);g.__decorate([m.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);g.__decorate([m.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);return q=y=g.__decorate([d.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,m,q,p,r,d,u){m=class extends m.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};g.__decorate([q.property({readOnly:!0})],m.prototype,"version",null);return m=g.__decorate([u.subclass("esri.views.layers.support.ClipArea")],m)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b){var c;m={base:y,key:"type",typeMap:{extent:a,polygon:b}};l=c=class extends l{constructor(t){super(t);this.type="geometry";this.geometry=null}clone(){return new c({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};g.__decorate([q.property({types:m,json:{read:n.fromJSON,write:!0}})],l.prototype,"geometry",void 0);return l=c=g.__decorate([u.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(g,m,q,p,r,d,u){q=class extends u{constructor(y){super(y);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};g.__decorate([m.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);return q=g.__decorate([d.subclass("esri.views.layers.support.Path")],q)})},"esri/views/2d/layers/features/FeatureContainer":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/support/UpdatingHandles ../../engine/AFeatureContainer ../../engine/webgl/enums ./RenderState ../support/util".split(" "),
function(g,m,q,p,r,d,u,y,n){class l{constructor(b,c){this.id=b;this.version=c;this._resolver=p.createResolver();this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve();this._done=!0}destroy(){this._resolver.reject()}}class a extends d.AFeatureContainer{constructor(b){super(b.view.featuresTilingScheme);this.updatingHandles=new r.UpdatingHandles;this._hitTestsRequests=[];this._visibleTiles=new Set;this._subscriptions=new Map;this._layerView=
b}renderChildren(b){for(const c of this.children)c.setTransform(b.state);super.renderChildren(b);this.attributeView.update();this.hasAnimation&&b.painter.effects.integrate.draw(b,b.attributeView);switch(b.drawPhase){case u.WGLDrawPhase.MAP:return this._renderMapPhase(b);case u.WGLDrawPhase.HIGHLIGHT:return this._renderHighlightPhase(b);case u.WGLDrawPhase.LABEL:return this._renderLabelPhase(b)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return 0<
this._layerView.labelingCollisionInfos.length}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance({drawPhase:b}){if(null==this._instanceStore)return null;let c=0,t=null;for(const h of this._instanceStore.values())h.techniqueRef.drawPhase&b&&(c++,h.techniqueRef.postProcessingEnabled&&(t=h));return 1<c?null:t}_getOverrideStencilRef({drawPhase:b}){if(null==this._instanceStore)return null;let c=null;for(const t of this._instanceStore.values()){if(!(t.techniqueRef.drawPhase&
b))continue;const {overrideStencilRef:h}=t.techniqueRef;if(null==c)c=h;else if(c!==h){c=null;break}}return c}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(b=>this._visibleTiles.has(b.key.id)):[]}initializeAttributeView(b){this.attributeView.initialize(b)}async updateAttributeView(b){await this.updatingHandles.addPromise(this.attributeView.requestUpdate(b));this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(b){for(const {tileId:c,
version:t}of b.subscribe)if(this._subscriptions.has(c))this._subscriptions.get(c).version=t;else{const h=new l(c,t);this._subscriptions.set(c,h);this.updatingHandles.addPromise(h.promise)}for(const c of b.unsubscribe)this._subscriptions.get(c)?.destroy(),this._subscriptions.delete(c),this.removeTile(c)}isDone(b){return this._renderState?this._renderState.isTileDone(b):!1}async updateRenderState(b){m("esri-2d-update-debug")&&console.debug(`Version[${b}] FeatureContainer.updateRenderState`);this._renderStateNext=
new y.RenderState(this._stage,b,this._tileInfoView)}getDisplayStatistics(b,c){return(b=this._statisticsByLevel.get(b))?b.get(c):null}updateStatistics(b,c){let t=this._statisticsByLevel.get(b);t||(t=new Map,this._statisticsByLevel.set(b,t));for(const h of c)t.set(h.fieldName,{minValue:h.minValue,maxValue:h.maxValue})}editStart(){this.attributeView.lockTextureUpload();this._renderState?.lockUploads()}editEnd(){this.attributeView.unlockTextureUpload();this._renderState?.unlockUploads();this.requestRender()}updateStart(){this.attributeView.lockTextureUpload()}updateEnd(b,
c){this.attributeView.unlockTextureUpload();m("esri-2d-update-debug")&&console.debug(`Version[${c}] FeatureContainer.update`);this.requestRender();this._store=b;this._renderStateNext&&(m("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null)}setVisibleTiles(b){this._visibleTiles=b}async onMessage(b,c){p.throwIfAborted(c);if(this._subscriptions.has(b.id))if(c=
this._subscriptions.get(b.id),c.version!==b.subscriptionVesrion)m("esri-2d-update-debug")&&console.debug(`Version[${`${b.subscriptionVesrion} != ${c.version}`}] Tile[${b.id}] FeatureContainer - Dropping message, outdated version]`,b);else{c=this._renderStateNext??this._renderState;if(!c)throw Error("InternalError: No renderState defined");c.version!==b.version&&console.error(`InternalError: Version mismatch. [renderState: ${c.version}, message: ${b.version}]`);c.updateTile(b);b.end&&this._subscriptions.get(b.id).end();
this.requestRender();this._layerView.view.labelManager.requestUpdate();this._layerView.requestUpdate()}}removeTile(b){if(this._renderState||this._renderStateNext)this._renderState&&this._renderState.removeTile(b),this._renderStateNext&&this._renderStateNext.removeTile(b)}hitTest(b){let c=this._hitTestsRequests.find(({x:h,y:w})=>h===b.x&&w===b.y);const t=p.createResolver();c?c.resolvers.push(t):(c={x:b.x,y:b.y,resolvers:[t]},this._hitTestsRequests.push(c));this.requestRender();return t.promise}get hasAnimation(){return this.hasLabels}updateTransitionProperties(b,
c){super.updateTransitionProperties(b,c);this._layerView.featureEffectView.transitionStep(b,c);this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(b){const {minScale:c,maxScale:t}=this._layer.effectiveScaleRange,h=b.state.scale;h<=(c||Infinity)&&h>=t&&super.doRender(b)}afterRender(b){super.afterRender(b);this._hitTestsRequests.length&&this.requestRender()}setStencilReference(b){const c=this._getOverrideStencilRef(b);if(null!=c)for(const t of this.children)t.stencilRef=c(t);
else super.setStencilReference(b)}_renderMapPhase(b){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(b),this._renderInsideEffect(b)):this._renderFeatures(b,u.FeatureSelection.All);0<this._hitTestsRequests.length&&this._renderHittest(b)}_renderHighlightPhase(b){this.hasHighlight&&n.renderHighlight(b,!1,c=>{this._renderFeatures(c,u.FeatureSelection.Highlight)})}_renderLabelPhase(b){this._renderFeatures(b,u.FeatureSelection.All)}_renderInsideEffect(b){const c=b.painter.effects.insideEffect;
c.bind(b);this._renderFeatures(b,u.FeatureSelection.InsideEffect);c.draw(b,this._layerView.featureEffectView.includedEffects);c.unbind()}_renderOutsideEffect(b){const c=b.painter.effects.outsideEffect;c.bind(b);this._renderFeatures(b,u.FeatureSelection.OutsideEffect);c.draw(b,this._layerView.featureEffectView.excludedEffects);c.unbind()}_renderHittest(b){const {context:c}=b,t=b.painter.effects.hittest,h=c.getBoundFramebufferObject(),w=c.getViewport(),D=b.passOptions;t.bind(b);b.passOptions=t.createOptions(b,
this._hitTestsRequests);this._renderFeatures(b,u.FeatureSelection.All);t.draw(b);t.unbind();c.bindFramebuffer(h);c.restoreViewport(w);b.passOptions=D}_renderFeatures(b,c){for(const h of this.children)if(h.visible){var t=m("featurelayer-force-marker-text-draw-order")?u.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT:u.FeatureBatchingStrategy.BATCHING;t=h.getDisplayList(b.drawPhase,this._instanceStore,t);b.selection=c;t?.render(b)}c=this._getExclusivePostprocessingInstance(b);null!=c&&c.techniqueRef.postProcess(b,
c)}}g.FeatureContainer=a;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/RenderState":function(){define("exports ../../../../core/has ../../../../geometry/support/aaBoundingRect ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/FeatureTile ./support/tileUtils".split(" "),function(g,m,q,p,r,d,u,y,n){class l{constructor(a,b,c){this.stage=a;this.version=b;this._tileInfoView=c;this._tiles=new Map;
this._pendingUpdates=[];this._locked=!1}destroy(){}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(a){this._tiles.clear();for(const b of a)this._tiles.set(b.key.id,b)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1;for(const a of this._pendingUpdates)this.updateTile(a);this._pendingUpdates=[]}updateTile(a){if(this._locked)this._pendingUpdates.push(a);else{m("esri-2d-update-debug")&&console.debug(`Version[${a.version}] Tile[${a.id}] Chunk[${a.debugInfo?.chunkId??
"\x3cEnsureEnd\x3e"}] RenderState.updateTile [${a.type}]`,a);var b=this._ensureTile(a.id);if("update"===a.type){const [w,...D]=a.modify;b.onMessage({type:"update",modify:w,remove:a.remove,end:a.end});for(const x of D){var c=this._tiles.get(x.tileId);if(c)c.onMessage({type:"update",modify:x,remove:a.remove,end:!1,isPixelBuffer:!0})}}else if(null==a.append)b.onMessage({type:"append",clear:a.clear,debugInfo:a.debugInfo,end:a.end});else{var [t,...h]=a.append;b.onMessage({type:"append",clear:a.clear,append:t,
debugInfo:a.debugInfo,end:a.end});for(c of h)if(a=this._tiles.get(c.tileId))a.onMessage({type:"update",modify:c,remove:[],sort:!1,end:!1,isPixelBuffer:!0})}}}removeTile(a){const b=this._tiles.get(a);m("esri-2d-update-debug")&&console.debug(`Tile[${a}] RenderState.removeTile`);b?.destroy();this._tiles.delete(a)}isTileDone(a){return(a=this._tiles.get(a.id))?a.isReady:!1}_ensureTile(a){if(!this._tiles.has(a)){const b=this._createTile(a);this._copyPixelBufferedEntitiesInto(b);this._tiles.set(a,b)}return this._tiles.get(a)}_createTile(a){m("esri-2d-update-debug")&&
console.debug(`Version[${this.version}] Tile[${a}] RenderState.createTile`);a=new r(a);const b=this._tileInfoView.getTileBounds(q.create(),a),c=this._tileInfoView.getTileResolution(a.level);a=new y.FeatureTile(a,c,b[0],b[3]);a.stage=this.stage;return a}_copyPixelBufferedEntitiesInto(a){let b=7;for(let t=-1;1>=t;t++)for(let h=-1;1>=h;h++)if(0!==t||0!==h){var c=n.getPow2NeighborKey(a.key,h,t,this._tileInfoView.tileInfo.isWrappable).id;c=this._tiles.get(c);null!=c&&a.copyPixelBufferedEntitesFrom(c,1<<
b,h,t);b--}}}g.RenderState=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(g){g.getPow2NeighborKey=function(m,q,p,r){m=m.clone();const d=1<<m.level;q=m.col+q;p=m.row+p;r&&0>q?(m.col=q+d,--m.world):q>=d?(m.col=q-d,m.world+=1):m.col=q;m.row=p;return m};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports",
"../../../../core/workers/workers"],function(g,m){class q{constructor(p){this._connection=p;this.pipeline=this._connection.createInvokeProxy();this.features=this._connection.createInvokeProxy("features");this.aggregates=this._connection.createInvokeProxy("aggregates");this.processor=this._connection.createInvokeProxy("processor");this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}g.FeaturePipelineWorkerProxy=
q;g.createFeaturePipelineWorkerProxy=async function(p){p=await m.open("FeaturePipelineWorker",{client:p,strategy:"dedicated"});return new q(p)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,m,q,p,r,d,u,y,n,l){g.FeatureSourceEventLog=class extends q{constructor(){super(...arguments);this.events=new p;this._updatingStrategy=!0;this._tileToEvent=new r;this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(a){switch(a.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(a);
break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,outstanding:0};this._strategyInfo=a.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",a);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),
a.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const a of this._tileToEvent.values())if("loaded"!==a[a.length-1].type)return!1;return!0}_handleTileEvent(a){switch(a.type){case "subscribe":this._tileToEvent.set(a.tile,[a]);break;case "unsubscribe":this._tileToEvent.delete(a.tile);break;case "loaded":var b=this._tileToEvent.get(a.tile);if(!b)break;b.push(a);this._tileToEvent.set(a.tile,b);break;case "error":if(b=
this._tileToEvent.get(a.tile))b.push(a),this._tileToEvent.set(a.tile,b),this.events.emit("error",a)}}};m.__decorate([d.property({readOnly:!0})],g.FeatureSourceEventLog.prototype,"hasAllFeatures",null);m.__decorate([d.property({readOnly:!0})],g.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);m.__decorate([d.property({readOnly:!0})],g.FeatureSourceEventLog.prototype,"hasFullGeometries",null);m.__decorate([d.property()],g.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0);m.__decorate([d.property()],
g.FeatureSourceEventLog.prototype,"_strategyInfo",void 0);m.__decorate([d.property()],g.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);g.FeatureSourceEventLog=m.__decorate([l.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],g.FeatureSourceEventLog);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y,n){class l{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){a=this.layer;const b=d.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:d.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(a){var b=this.layer,c=b.parent;a=p.getEffectiveLayerCapabilities(c);const {capabilities:t,editingInfo:h,objectIdField:w,globalIdField:D,datesInUnknownTimezone:x,orderBy:f,subtypeField:v,parsedUrl:z}=c,e=c.fieldsIndex.toJSON(),A=e.fields,
C=b.fullExtent?.toJSON(),G=r.getEffectiveGeometryType(b);c=c.timeInfo?.toJSON();b=b.spatialReference.toJSON();const E=m.clone(z);let H=w;if(f?.length){const I=!f[0].valueExpression&&f[0].field;I&&(H=I)}return{type:"feature-service",isSourceHosted:q.isHostedAgolService(E.path),timeReferenceUnknownClient:x,subtypeField:v,globalIdField:D,maxRecordCount:t.query.maxRecordCount,tileMaxRecordCount:t.query.tileMaxRecordCount,capabilities:t,effectiveCapabilities:a,fields:A,fieldsIndex:e,fullExtent:C,geometryType:G,
objectIdField:w,source:E,timeInfo:c,spatialReference:b,orderByFields:H,lastEditDate:h?.lastEditDate?.getTime()}}createSourceSchema(a,b,c){const {definitionExpression:t,customParameters:h,timeExtent:w,apiKey:D}=this.layer.parent;return u.createFeatureSourceSchema(a,{definitionExpression:t,customParameters:h,timeExtent:w},b,c,D)}createProcessorSchema(a,b,c){const {parent:{fields:t,geometryType:h,orderBy:w,objectIdField:D},renderer:x,labelingInfo:f,labelsVisible:v}=this.layer,z={featureReduction:null,
fields:t.map(e=>e.toJSON()),geometryType:h,labelingInfo:f,labelsVisible:v,objectIdField:D,orderBy:w??"default",renderer:x?.clone()};return y.createSimpleProcessorSchema(a,b,z,c)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(a){const {parent:b,parent:{definitionExpression:c,apiKey:t},renderer:h}=this.layer;a=this.layer.labelsVisible?this.layer.labelingInfo:null;const w=JSON.stringify(b.customParameters),D=JSON.stringify(b.orderBy);return{apiKey:t,
customParameters:w,definitionExpression:c,labelingInfo:a,orderBy:D,renderer:h}}setGraphicOrigin(a){a.origin={type:"catalog",layer:this.layer}}}g.CatalogFootprintLayerAdapter=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],function(g){g.getEffectiveGeometryType=function(m){switch(m.geometryType){case "point":return"esriGeometryPoint";case "polyline":return"esriGeometryPolyline";case "polygon":return"esriGeometryPolygon";
case "multipatch":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";default:return null}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils","./featureReductionUtils","../../support/visualVariableSimpleUtils"],function(g,m,q,p){function r(d){return u=>m.pt2px(p.getSizeForValueSimple(u,d))}g.createLabelVVEvaluator=function(d){d=null!=d&&
"visualVariables"in d&&d.visualVariables;if(!d)return null;for(const u of d)if("size"===u.type)return r(u);return null};g.getFeatureReductionDeconflictionEnabled=function(d,u){d=q.getEffectiveFeatureReduction(d,u);if(d?.labelsVisible&&d.labelingInfo?.length)return d.labelingInfo.every(y=>"none"!==y.deconflictionStrategy)};g.getLayerDeconflictionEnabled=function(d){return(d.labelsVisible&&d.labelingInfo?.every(u=>"none"!==u.deconflictionStrategy))??!1};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],function(g){g.getEffectiveFeatureReduction=function(m,q){return(m=m.featureReduction)&&"selection"!==m.type?!("maxScale"in m&&m.maxScale)||m.maxScale<q.scale?m:null:null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],
function(g,m,q,p){function r(n,l){switch(l.transformationType){case p.TransformationType.Additive:var a=d(l.minSize,n);return n+(a||l.minDataValue);case p.TransformationType.Constant:return a=l.stops,a=a?.length&&a[0].size,null==a&&(a=l.minSize),d(a,n);case p.TransformationType.ClampedLinear:a=l.minDataValue;var b=l.maxDataValue,c=(n-a)/(b-a),t=d(l.minSize,n);l=d(l.maxSize,n);n=n<=a?t:n>=b?l:t+c*(l-t);return n;case p.TransformationType.Proportional:return a=n/l.minDataValue,b=d(l.minSize,n),n=d(l.maxSize,
n),m.clamp(a*b,b,n);case p.TransformationType.Stops:{const [h,w,D]=u(n,l.cache.ipData);h===w?n=d(l.stops[h].size,n):(a=d(l.stops[h].size,n),n=d(l.stops[w].size,n),n=a+(n-a)*D)}return n;case p.TransformationType.RealWorldSize:return a=q.meterIn[l.valueUnit],b=d(l.minSize,n),c=d(l.maxSize,n),{valueRepresentation:l}=l,t=null,t="area"===l?2*Math.sqrt(n/y)/a:"radius"===l||"distance"===l?2*n/a:n/a,m.clamp(t,b,c);case p.TransformationType.Identity:return n;case p.TransformationType.Unknown:return null}}
function d(n,l){return"number"===typeof n?n:r(l,n)}function u(n,l){if(l){var a=0,b=l.length-1;l.some((c,t)=>{if(n<c)return b=t,!0;a=t;return!1});return[a,b,(n-l[a])/(l[b]-l[a])]}}const y=Math.PI;g.getSizeForValueSimple=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports","../../../../../core/sql"],function(g,m){g.createFeatureSourceSchema=function(q,p,r,d,u){const y=m.sqlAnd(p.definitionExpression,null!=
p.subtypeCode?`${p.subtypeField} = ${p.subtypeCode}`:null),n=p.customParameters??{};u&&(n.token=u);return{type:"feature",sourceRefreshVersion:d,service:q,tileInfoJSON:r.tileInfoJSON,availableFields:r.availableFields,dataFilter:{definitionExpression:y,gdbVersion:p.gdbVersion,historicMoment:p.historicMoment?.getTime(),outSpatialReference:r.outSpatialReference.toJSON(),timeExtent:p.timeExtent?.toJSON(),customParameters:n}}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define("exports ../../../../../../core/screenUtils ../../../../../../layers/support/OrderByInfo ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema".split(" "),
function(g,m,q,p,r,d,u){async function y(c,t){var h=t.renderer;const w=u.createVisualVariableUniforms(h);h=await r.createMatcherSchema(c,h);c=await p.createLabelMatcherSchema(c,t,w);return{symbology:h,labels:c}}function n(c,t){return c.fields.map(h=>({...h.toJSON(),type:l(h,t)}))}function l(c,t){const {onStatisticExpression:h,onStatisticField:w,statisticType:D}=c;switch(D){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":return h?({returnType:c}=
h,c?"string"===c?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"):(c=t.find(x=>x.name===w))?c.type:"esriFieldTypeString"}}async function a(c,t,h,w,D){w=n(c,w.fields);var x=c.renderer;const f=await r.createMatcherSchema(t,x),v=d.createStorageSchema(x,[null,null]);x=u.createVisualVariableUniforms(x);t=await p.createLabelMatcherSchema(t,{geometryType:"polygon",labelingInfo:c.labelingInfo,labelsVisible:c.labelsVisible},x);return{storage:v,mesh:{displayRefreshVersion:D,strategy:{type:"binning",
fields:w,fixedBinLevel:c.fixedBinLevel,featureFilter:h.filters[0]},factory:{labels:t,symbology:f},sortKey:null}}}async function b(c,t,h,w,D){const x=n(c,w.fields),f=c.getEffectiveRenderer(),v={type:"cluster",feature:await r.createMatcherSchema(t,f),cluster:await r.createMatcherSchema(t,f)},z=u.createVisualVariableUniforms(f);t={type:"cluster",feature:await p.createLabelMatcherSchema(t,w,z),cluster:await p.createLabelMatcherSchema(t,{geometryType:"point",labelingInfo:c.labelingInfo,labelsVisible:c.labelsVisible},
z)};return{storage:d.createStorageSchema(f,[null,null]),mesh:{displayRefreshVersion:D,strategy:{type:"cluster",fields:x,featureFilter:h.filters[0],clusterRadius:m.pt2px(c.clusterRadius/2)},factory:{labels:t,symbology:v},sortKey:null}}}g.createSimpleProcessorSchema=async function(c,t,h,w){var D=h.featureReduction;if(D)switch(D.type){case "binning":return a(D,c,t,h,w);case "cluster":return b(D,c,t,h,w)}D=h.orderBy;var x=h.renderer;x=null!=x&&"unique-value"===x.type&&x.orderByClassesEnabled;"default"!==
D||x||(D=[new q({field:h.objectIdField,order:"descending"})]);"default"!==D&&D.length?(D=D[0],x="ascending"===D.order?"asc":"desc",D=D.field?{field:D.field,order:x}:D.valueExpression?{expression:D.valueExpression,order:x}:null):D=x?{byRenderer:!0,order:"asc"}:null;t=d.createStorageSchema(h.renderer,t.filters);c=await y(c,h);return{storage:t,mesh:{displayRefreshVersion:w,strategy:{type:"feature"},factory:c,sortKey:D}}};g.getAggregateFields=n;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],function(g,m,q,p){async function r(d,u,y,n){d=await p.createSymbolMeshSchemas(u,{path:`${y}`,schemaOptions:d,uniforms:n});return{maxScale:u.maxScale,minScale:u.minScale,expression:u.labelExpressionInfo?.expression??u.labelExpression,where:u.where,meshes:d}}g.createLabelMatcherSchema=async function(d,
u,y){var n=u.labelsVisible&&u.labelingInfo||[];u=q.getEffectiveGeometryType(u);n=m.validateLabelingInfo(n,u);return{type:"label",classes:await Promise.all(n.map((l,a)=>r(d,l,a,y)))}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define("exports ../../../../../../../symbols ../../../../../../../core/screenUtils ../../../../../../../renderers/support/heatmapUtils ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/SDFHelper ../../../../../engine/webgl/alignmentUtils ../../../../../engine/webgl/color ../../../../../engine/webgl/definitions ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../schemaUtils ../VisualVariablesSchema ./ComplexSymbolSchema ../../../../../../../symbols/SimpleFillSymbol".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c,t,h){async function w(e,A){if(!e)return[];switch(e.type){case "simple-fill":return v(e,A);case "picture-fill":{var {outline:C}=e;const {uniforms:Q,schemaOptions:Y}=A;var {store:G}=Y,E=[];const Z=r.CIMSymbolHelper.createPictureFillRasterizationParam(e);if(Z){var {width:H,height:I,xoffset:O,yoffset:M,xscale:N,yscale:P}=e;e={color:[255,255,255,255],sprite:Z,height:I,aspectRatio:H/I,offsetX:O,offsetY:M,scaleX:N,scaleY:P,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,
scaleProportionally:!1,effects:null,scaleInfo:null};"solid"===C?.style?e=[G.ensureInstance(a.Techniques.complexOutlineFill,{geometry:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableSizeScaleStops:Q.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{...e,...f(C,!!Q.visualVariableSizeOutlineScaleStops)}})]:(G=G.ensureInstance(a.Techniques.complexFill,
{geometry:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity}},{zoomRange:!1}),E.push(G.createMeshInfo({params:e})),C&&E.push(...z(C,A,!0)),e=E)}else e=[]}return e;case "simple-marker":return x(e,A);case "picture-marker":{const {uniforms:Q,schemaOptions:Y}=A;({store:A}=Y);A=A.ensureInstance(a.Techniques.marker,{geometry:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue,visualVariableRotation:Q.visualVariableRotation}},{zoomRange:!1});e=(C=r.CIMSymbolHelper.createPictureMarkerRasterizationParam(e))?[A.createMeshInfo({params:{type:"picture",color:[255,255,255,255],height:e.height,width:e.width,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,outlineColor:null,outlineSize:0,referenceSize:e.height,sprite:C,
overrideOutlineColor:!1,hasSizeVV:t.hasSizeVVUniform(Q),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:c.getMaxSizeVVSize(Q)}})]:[]}return e;case "simple-line":return z(e,A,!1);case "text":const {uniforms:L,schemaOptions:U}=A;({store:A}=U);return[A.ensureInstance(a.Techniques.text,{geometry:{visualVariableColor:L.visualVariableColor,visualVariableOpacity:L.visualVariableOpacity,visualVariableRotation:L.visualVariableRotation,visualVariableSizeMinMaxValue:L.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:L.visualVariableSizeScaleStops,visualVariableSizeStops:L.visualVariableSizeStops,visualVariableSizeUnitValue:L.visualVariableSizeUnitValue}},{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}).createMeshInfo({params:{boxBackgroundColor:e.backgroundColor?.toArray(),boxBorderLineColor:e.borderLineColor?.toArray(),boxBorderLineSize:e.borderLineSize??0,color:e.color?.toArray()??[0,0,0,0],offsetX:e.xoffset,offsetY:e.yoffset,postAngle:e.angle,fontSize:e.font.size,decoration:e.font.decoration,
haloColor:e.haloColor?.toArray()??[0,0,0,0],haloFontSize:e.haloSize??0,lineWidth:e.lineWidth,lineHeightRatio:e.lineHeight,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:e.font.toJSON(),textString:e.text,symbol:r.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(e)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,minPixelBuffer:c.getMaxSizeVVSize(L),
repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})];case "label":const {schemaOptions:T,uniforms:R}=A;({store:E}=T);A=e.symbol;const {allowOverrun:V,repeatLabel:aa,repeatLabelDistance:ba}=e;C={maxScale:e.maxScale??0,minScale:e.minScale??0};E=E.ensureInstance(a.Techniques.label,{geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:R.visualVariableRotation,visualVariableSizeMinMaxValue:R.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:R.visualVariableSizeScaleStops,
visualVariableSizeStops:R.visualVariableSizeStops,visualVariableSizeUnitValue:R.visualVariableSizeUnitValue}},{zoomRange:!0,clipAngle:!0,referenceSymbol:!0});const [ca,da]=y.getAlignmentFromPlacement(e.labelPlacement);return[E.createMeshInfo({params:{boxBackgroundColor:A.backgroundColor?.toArray(),boxBorderLineColor:A.borderLineColor?.toArray(),boxBorderLineSize:A.borderLineSize??0,color:A.color?.toArray()??[0,0,0,0],offsetX:A.xoffset,offsetY:A.yoffset,postAngle:A.angle,fontSize:A.font.size,decoration:A.font.decoration,
haloColor:A.haloColor?.toArray()??[0,0,0,0],haloFontSize:A.haloSize??0,lineWidth:A.lineWidth,lineHeightRatio:A.lineHeight,horizontalAlignment:ca,verticalAlignment:da,repeatLabel:aa,repeatLabelDistance:q.pt2px(ba),allowOverrun:V,labelPosition:e.labelPosition,scaleInfo:C,minPixelBuffer:c.getMaxSizeVVSize(R),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:A.font.toJSON(),textString:A.text,symbol:r.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(A),primitiveName:"label-override"},
overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.labelExpressionInfo?.expression??e.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,isLineLabel:!1}})];case "cim":return t.createComplexSymbolInstances(e.data,A);case "web-style":return e=await e.fetchCIMSymbol(),t.createComplexSymbolInstances(e.data,A);default:throw Error(`symbol not supported ${e.type}`);
}}function D(e){if("path"===e.style){if(null==e.path)throw Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:e.path,asFill:!0}}}const A=r.CIMSymbolHelper.fromSimpleMarker(e);if("outline"in e&&e.outline&&(e=e.outline.style,"solid"!==e&&"none"!==e)){if(!A||!A.symbolLayers)throw Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:A.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",
resource:u.getSDFInfo(A),overrides:[]}}async function x(e,A){const {uniforms:C,schemaOptions:G}=A;var {store:E}=G;if("path"===e.style)return e=r.CIMSymbolHelper.fromSimpleMarker(e),t.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:e},A);A=E.ensureInstance(a.Techniques.marker,{geometry:{visualVariableColor:C.visualVariableColor,visualVariableOpacity:C.visualVariableOpacity,visualVariableSizeMinMaxValue:C.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:C.visualVariableSizeScaleStops,
visualVariableSizeStops:C.visualVariableSizeStops,visualVariableSizeUnitValue:C.visualVariableSizeUnitValue,visualVariableRotation:C.visualVariableRotation}},{zoomRange:!1});E=D(e);let H=e.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===E.resource.type&&(H=[255,255,255,255]);const I=e.size,O=null!=C.visualVariableColor&&("cross"===e.style||"x"===e.style);return[A.createMeshInfo({params:{type:"simple",color:H,height:I,width:I*("triangle"===e.style?124/116:1),offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,
outlineColor:e.outline?.color?.toArray()??[0,0,0,0],outlineSize:e.outline?.width??1,referenceSize:I,sprite:E,overrideOutlineColor:O,hasSizeVV:t.hasSizeVVUniform(C),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:c.getMaxSizeVVSize(C)}})]}function f(e,A){const C=e.width;return{outlineColor:e.color?.toArray()||[0,0,0,1],width:C,referenceWidth:C,capType:e.cap??"round",joinType:e.join??"round",miterLimit:e.miterLimit,hasSizeVV:A}}function v(e,A){var {style:C}=e;if(C&&"none"!==
C&&"solid"!==C){{const {uniforms:H,schemaOptions:I}=A;var {store:G}=I;C=e.color?.toArray()??[0,0,0,0];var E={type:"sprite-rasterization-param",resource:{type:"fill-style",style:e.style},overrides:[]};"solid"===e.outline?.style?e=[G.ensureInstance(a.Techniques.patternOutlineFill,{geometry:{visualVariableColor:H.visualVariableColor,visualVariableOpacity:H.visualVariableOpacity,visualVariableSizeScaleStops:H.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,
visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:C,...f(e.outline,!!H.visualVariableSizeOutlineScaleStops),sprite:E,scaleInfo:null,effects:null}})]:(C=[],G=G.ensureInstance(a.Techniques.patternFill,{geometry:{visualVariableColor:H.visualVariableColor,visualVariableOpacity:H.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:e.color?.toArray()??[0,0,0,0],sprite:E,scaleInfo:null,effects:null}}),C.push(G),e.outline&&C.push(...z(e.outline,A,!0)),e=C)}return e}{const {uniforms:H,
schemaOptions:I}=A;({store:G}=I);E=e.color?.toArray()??[0,0,0,0];"solid"===e.outline?.style?e=[G.ensureInstance(a.Techniques.outlineFill,{geometry:{visualVariableColor:H.visualVariableColor,visualVariableOpacity:H.visualVariableOpacity,visualVariableSizeScaleStops:H.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:"none"!==e.style?E:[0,0,0,0],...f(e.outline,!!H.visualVariableSizeOutlineScaleStops),
scaleInfo:null,effects:null}})]:(C=[],G=G.ensureInstance(a.Techniques.fill,{geometry:{visualVariableColor:H.visualVariableColor,visualVariableOpacity:H.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:E,scaleInfo:null,effects:null}}),C.push(G),e.outline&&C.push(...z(e.outline,A,!0)),e=C)}return e}function z(e,A,C){const {color:G,style:E,width:H,cap:I,join:O}=e;var {schemaOptions:M}=A,{store:N}=M;M=[];var P=C?{...c.noVisualVariables,visualVariableSizeScaleStops:A.uniforms.visualVariableSizeOutlineScaleStops}:
A.uniforms;C={geometry:{visualVariableColor:P.visualVariableColor,visualVariableOpacity:P.visualVariableOpacity,visualVariableSizeMinMaxValue:P.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:P.visualVariableSizeScaleStops,visualVariableSizeStops:P.visualVariableSizeStops,visualVariableSizeUnitValue:P.visualVariableSizeUnitValue}};P={color:null!=G&&"none"!==E?G.toArray():[0,0,0,0],width:H,referenceWidth:H,capType:I,joinType:O,miterLimit:e.miterLimit,hasSizeVV:t.hasSizeVVUniform(P),effects:null,
scaleInfo:null};null==E||"solid"===E||"none"===E?(N=N.ensureInstance(a.Techniques.line,C,{zoomRange:!1}).createMeshInfo({params:P}),M.push(N)):(N=N.ensureInstance(a.Techniques.texturedLine,C,{zoomRange:!1}).createMeshInfo({params:{...P,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:r.slsDashToTemplateArray(E,I),capStyle:r.capTypeToEnum(I)},overrides:[]}}}),M.push(N));if(null!=e.marker){N=M.push;C=e.marker;const {uniforms:L,
schemaOptions:U}=A;({store:A}=U);A=A.ensureInstance(a.Techniques.marker,{geometry:{visualVariableColor:L.visualVariableColor,visualVariableOpacity:L.visualVariableOpacity,visualVariableSizeMinMaxValue:L.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:L.visualVariableSizeScaleStops,visualVariableSizeStops:L.visualVariableSizeStops,visualVariableSizeUnitValue:L.visualVariableSizeUnitValue,visualVariableRotation:L.visualVariableRotation}},{zoomRange:!1});P=D(C);const T=6*e.width,R=C.color?.toArray()??
e.color?.toArray()??[0,0,0,0],V="cross"===C.style||"x"===C.style;switch(C.placement){case "begin-end":C=d.ExtremityPlacement.Both;break;case "begin":C=d.ExtremityPlacement.JustBegin;break;case "end":C=d.ExtremityPlacement.JustEnd;break;default:C=d.ExtremityPlacement.None}C={type:"cim-marker-placement-info",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:C,offsetAlongLine:0},overrides:[]};e=[A.createMeshInfo({params:{type:"simple",color:R,height:T,width:T,
offsetX:0,offsetY:0,angle:0,outlineColor:R,outlineSize:V?e.width:0,referenceSize:T/6,sprite:P,overrideOutlineColor:V&&null!=L.visualVariableColor,hasSizeVV:t.hasSizeVVUniform(L),placement:C,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:c.getMaxSizeVVSize(L)}})];N.call(M,...e)}return M}g.createDotDensityMeshSchemas=async function(e,A){var {schemaOptions:C}=A;({store:C}=C);var G=Array(l.dotDensityMaxFields),E=Array(l.dotDensityMaxFields/4);for(var H=0;H<l.dotDensityMaxFields;H++){const I=
H<e.attributes.length?e.attributes[H].color:null;G[H]=[0,0,0,0];n.writeColor(G[H],I)}for(H=0;H<l.dotDensityMaxFields/4;H++)E[H]=[0,0,0,0],E[H][0]=4*H<e.attributes.length?1:0,E[H][1]=4*H+1<e.attributes.length?1:0,E[H][2]=4*H+2<e.attributes.length?1:0,E[H][3]=4*H+3<e.attributes.length?1:0;G=C.ensureInstance(a.Techniques.dotDensity,{isActive:E,colors:G,dotValue:e.dotValue,dotScale:e.referenceScale,blending:e.dotBlendingEnabled,dotSize:e.dotSize,seed:e.seed},{}).createMeshInfo({params:{effects:null}});
C=[];e.backgroundColor&&(E=new h({color:e.backgroundColor,outline:null}),E=await w(E,A),C.push(...E));C.push(G);e.outline&&(e=z(e.outline,A,!0),C.push(...e));return C};g.createHeatmapMeshSchemas=async function(e,A){({store:A}=A);const {radius:C,minDensity:G,maxDensity:E,referenceScale:H,field:I,valueExpression:O,colorStops:M}=e;e=p.generateGradient(M);return[A.ensureInstance(a.Techniques.heatmap,{radius:q.pt2px(C),minDensity:G,maxDensity:E,referenceScale:H,isFieldActive:!(!I&&!O),gradient:e,gradientHash:e.join(",")},
{}).createMeshInfo({params:{effects:null}})]};g.createLineInstance=z;g.createPieChartMeshSchemas=function(e,A){var {store:C}=A;const G=e.outline?.width||1,E=c.createVisualVariableUniforms(e);C=C.ensureInstance(a.Techniques.pieChart,{geometry:{outlineWidth:Math.round(q.pt2px(G)),defaultColor:b.premultiplyColor(e.defaultColor),outlineColor:b.premultiplyColor(e.outline?.color),othersColor:b.premultiplyColor(e.othersCategory?.color),donutRatio:e.holePercentage,sectorThreshold:e.othersCategory?.threshold||
0,colors:e.attributes.map(H=>b.premultiplyColor(H.color)),visualVariableOpacity:E.visualVariableOpacity,visualVariableSizeMinMaxValue:E.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:E.visualVariableSizeScaleStops,visualVariableSizeStops:E.visualVariableSizeStops,visualVariableSizeUnitValue:E.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:e.attributes.length},{}).createMeshInfo({params:{size:e.size,outlineWidth:G,effects:null,scaleInfo:null}});return[...(e.backgroundFillSymbol?
v(e.backgroundFillSymbol,{schemaOptions:A,path:"",uniforms:c.noVisualVariables}):[]),C]};g.createSymbolMeshSchemas=w;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],function(g,m,q){async function p(l,a){var b=a.getSymbols();b=b.length?b[0]:null;a=m.createVisualVariableUniforms(a);return{type:"simple",meshes:await q.createSymbolMeshSchemas(b,
{schemaOptions:l,uniforms:a,path:"renderer.symbol"})}}async function r(l,a){const b=m.createVisualVariableUniforms(a);return{type:"dot-density",meshes:await q.createDotDensityMeshSchemas(a,{schemaOptions:l,uniforms:b,path:"renderer.symbol"})}}async function d(l,a){const b=m.createVisualVariableUniforms(a);var c=a.backgroundFillSymbol,t=a.normalizationType;t="log"===t?"esriNormalizeByLog":"percent-of-total"===t?"esriNormalizeByPercentOfTotal":"field"===t?"esriNormalizeByField":null;var h=a.classBreakInfos.map(async D=>
({meshes:await q.createSymbolMeshSchemas(D.symbol,{path:`renderer-stop-${D.minValue}-${D.maxValue}`,schemaOptions:l,uniforms:b}),min:D.minValue,max:D.maxValue}));h=(await Promise.all(h)).sort((D,x)=>D.min-x.min);c=await q.createSymbolMeshSchemas(c,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...m.noVisualVariables,visualVariableSizeOutlineScaleStops:b.visualVariableSizeOutlineScaleStops}});const w=await q.createSymbolMeshSchemas(a.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",
uniforms:b});return{type:"interval",field:a.field,expression:a.valueExpression,backgroundFill:c,defaultSymbol:w,intervals:h,normalizationField:a.normalizationField,normalizationTotal:a.normalizationTotal,normalizationType:t,isMaxInclusive:a.isMaxInclusive}}async function u(l,a){const b=[],c=m.createVisualVariableUniforms(a),t=await q.createSymbolMeshSchemas(a.backgroundFillSymbol,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...m.noVisualVariables,visualVariableSizeOutlineScaleStops:c.visualVariableSizeOutlineScaleStops}}),
h=await q.createSymbolMeshSchemas(a.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:c});for(const w of a.uniqueValueInfos??[]){const D=await q.createSymbolMeshSchemas(w.symbol,{path:`renderer-unique-value-${w.value}`,schemaOptions:l,uniforms:c});b.push({value:""+w.value,symbol:D})}return{type:"map",field:a.field,expression:a.valueExpression,field2:a.field2,field3:a.field3,fieldDelimiter:a.fieldDelimiter,backgroundFill:t,defaultSymbol:h,map:b}}async function y(l,a){return{type:"heatmap",
meshes:await q.createHeatmapMeshSchemas(a,l)}}async function n(l,a){return{type:"pie-chart",meshes:q.createPieChartMeshSchemas(a,l)}}g.createMatcherSchema=async function(l,a){if(!a)return{type:"simple",meshes:[]};switch(a.type){case "simple":return p(l,a);case "dot-density":return r(l,a);case "class-breaks":return d(l,a);case "unique-value":return u(l,a);case "dictionary":l=m.createVisualVariableUniforms(a);const b=a.scaleExpression;return{type:"dictionary",fieldMap:a.fieldMap,scaleExpression:null!=
b&&"1"!==b?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:a.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:l};case "heatmap":return y(l,a);case "pie-chart":return n(l,a)}};g.createSimpleMatcherSchemaFromSymbol=async function(l,a,b){return{type:"simple",meshes:await q.createSymbolMeshSchemas(a,{schemaOptions:l,path:b,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,
visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c){class t{constructor(h){this.layer=h}getLabelingDeconflictionInfo(h){const w=this.layer;h=l.getFeatureReductionDeconflictionEnabled(w,h)??l.getLayerDeconflictionEnabled(w);return[{vvEvaluators:{0:l.createLabelVVEvaluator(w.renderer)},deconflictionEnabled:h}]}async createServiceOptions(h){var w=this.layer;const D=r.getEffectiveLayerCapabilities(w),{capabilities:x,editingInfo:f,objectIdField:v,typeIdField:z,globalIdField:e,datesInUnknownTimezone:A,orderBy:C,subtypeField:G,
refreshInterval:E}=w,H=w.fieldsIndex.toJSON(),I=H.fields,O=w.fullExtent?.toJSON(),M=n.getEffectiveGeometryType(w),N=w.timeInfo?.toJSON(),P=w.spatialReference.toJSON(),L=w.types?.map(V=>V.toJSON()),U=q.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(U.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let T=this.layer.objectIdField;if(C?.length){var R=!C[0].valueExpression&&C[0].field;R&&(T=R)}R=null==f?.lastEditDate&&0<E;h=(R=m("featurelayer-snapshot-enabled")&&"point"===
w.geometryType&&x?.query.supportsPagination&&!x?.operations.supportsEditing&&!R)&&u.exceedsMinimumSnapshotCoverage(h,w.fullExtent);w=p.isHostedAgolService(U.path);return{type:"feature-service",supportsSnapshotMinThreshold:R,supportsSnapshotMaxThreshold:h,snapshotCountThresholds:{min:m("featurelayer-snapshot-point-min-threshold"),max:m("featurelayer-snapshot-point-max-threshold")},isSourceHosted:w,typeIdField:z??void 0,types:L,timeReferenceUnknownClient:A,subtypeField:G,globalIdField:e,maxRecordCount:x.query.maxRecordCount,
tileMaxRecordCount:x.query.tileMaxRecordCount,capabilities:x,effectiveCapabilities:D,fields:I,fieldsIndex:H,fullExtent:O,geometryType:M,objectIdField:v,source:U,timeInfo:N,spatialReference:P,orderByFields:T,lastEditDate:f?.lastEditDate?.getTime()}}createSourceSchema(h,w,D){const {definitionExpression:x,customParameters:f,gdbVersion:v,historicMoment:z,subtypeCode:e,subtypeField:A,timeExtent:C,apiKey:G}=this.layer;return a.createFeatureSourceSchema(h,{definitionExpression:x,customParameters:f,gdbVersion:v,
historicMoment:z,subtypeCode:e,subtypeField:A,timeExtent:C},w,D,G)}createProcessorSchema(h,w,D){const {fields:x,renderer:f,geometryType:v,labelingInfo:z,labelsVisible:e,orderBy:A,objectIdField:C}=this.layer,G={fields:x.map(E=>E.toJSON()),renderer:f?.clone(),featureReduction:d.getEffectiveFeatureReduction(this.layer,w),geometryType:v,labelingInfo:z,labelsVisible:e,objectIdField:C,orderBy:A??"default"};return b.createSimpleProcessorSchema(h,w,G,D)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}hasFilters(h){return y.hasFloorFilter(this.layer,
h)}addFilters(h,w){return y.addFloorFilter(this.layer,h,w)}getUpdateHashProperties(h){var w=this.layer;const {definitionExpression:D,renderer:x,gdbVersion:f,apiKey:v,subtypeCode:z}=w,e=this.layer.labelsVisible?this.layer.labelingInfo:null,A=w.historicMoment?.getTime()??void 0,C=JSON.stringify(w.customParameters),G=d.getEffectiveFeatureReduction(w,h)?.toJSON();w=JSON.stringify(w.orderBy);h=y.hasFloorFilter(this.layer,h)?h.floors:null;return{apiKey:v,customParameters:C,definitionExpression:D,featureReduction:G,
floors:h,gdbVersion:f,historicMoment:A,labelingInfo:e,orderBy:w,renderer:x,subtypeCode:z}}}g.FeatureLayerAdapter=t;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],function(g,m){g.exceedsMinimumSnapshotCoverage=function(q,p){q=q.extent;q=p?.clone().intersection(q);q=null!=q?q.width*q.height:0;p=p?p.width*p.height:0;p=0===p?0:q/p;q=m("featurelayer-snapshot-point-coverage");
return!isNaN(p)&&p>=q};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports","../../../../../core/sql","../../../../../layers/support/FeatureFilter"],function(g,m,q){function p(r,d,u){if(null==r.floorInfo||!u.floors?.length)return d;u=u.floors;const {floorField:y,viewAllLevelIds:n}=r.floorInfo;n.length&&(u=n);r=u.filter(l=>""!==l).map(l=>"'"+l+"'");r.push("''");d?.includes(y)&&(u=new RegExp("AND \\("+
y+".*NULL\\)","g"),d=d.replace(u,""),u=new RegExp("\\("+y+".*NULL\\)","g"),d=d.replace(u,""),d=d.replaceAll(/\s+/g," ").trim());r=("("+y+" IN ({ids}) OR "+y+" IS NULL)").replace("{ids}",r.join(", "));return m.sqlAnd(d,r)}g.addFloorFilter=function(r,d,u){r=p(r,d?.where,u);if(!r)return d;d??=new q;d.where=r;return d};g.hasFloorFilter=function(r,d){return null!=r.floorInfo&&(0<r.floorInfo.viewAllLevelIds.length||0<d.floors.length)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define("exports ../../../../../core/Error ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y,n){class l{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=d.getFeatureReductionDeconflictionEnabled(b,a)??d.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:d.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;a=q.getEffectiveLayerCapabilities(b);const {capabilities:c,objectIdField:t}=b,h=b.fieldsIndex.toJSON(),w=h.fields,D=null!=b.fullExtent?b.fullExtent.toJSON():null,x=r.getEffectiveGeometryType(b),
f=b.timeInfo?.toJSON(),v=b.spatialReference.toJSON();if(!("openPorts"in b.source))throw new m("source-not-supported");b=await b.source.openPorts();return{type:"memory",maxRecordCount:c.query.maxRecordCount,tileMaxRecordCount:c.query.tileMaxRecordCount,capabilities:c,effectiveCapabilities:a,fields:w,fieldsIndex:h,fullExtent:D,geometryType:x,objectIdField:t,source:b,timeInfo:f,spatialReference:v,orderByFields:t}}createSourceSchema(a,b,c){const {definitionExpression:t,timeExtent:h}=this.layer;return u.createFeatureSourceSchema(a,
{definitionExpression:t,timeExtent:h,customParameters:null},b,c,null)}createProcessorSchema(a,b,c){const {fields:t,renderer:h,geometryType:w,labelingInfo:D,labelsVisible:x,orderBy:f,objectIdField:v}=this.layer,z={fields:t.map(e=>e.toJSON()),renderer:h?.clone(),featureReduction:p.getEffectiveFeatureReduction(this.layer,b),geometryType:w,labelingInfo:D,labelsVisible:x,objectIdField:v,orderBy:f??"default"};return y.createSimpleProcessorSchema(a,b,z,c)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(a){const b=
this.layer,{definitionExpression:c,renderer:t}=b,h=this.layer.labelsVisible?this.layer.labelingInfo:null;a=p.getEffectiveFeatureReduction(b,a)?.toJSON();return{orderBy:JSON.stringify(b.orderBy),definitionExpression:c,renderer:t,labelingInfo:h,featureReduction:a}}}g.InMemoryLayerAdapter=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define("exports ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y){class n{constructor(l){this.layer=l}getLabelingDeconflictionInfo(l){const a=this.layer;l=r.getFeatureReductionDeconflictionEnabled(a,l)??r.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:r.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:l}]}async createServiceOptions(l){var a=this.layer;l=m.getEffectiveLayerCapabilities(a);const {capabilities:b,objectIdField:c}=a,t=a.fieldsIndex.toJSON(),h=t.fields,w=null!=a.fullExtent?a.fullExtent.toJSON():null,D=p.getEffectiveGeometryType(a),
x=a.spatialReference.toJSON();a=await a.source.openPorts();return{type:"memory",maxRecordCount:b.query.maxRecordCount,tileMaxRecordCount:b.query.tileMaxRecordCount,capabilities:b,effectiveCapabilities:l,fields:h,fieldsIndex:t,fullExtent:w,geometryType:D,objectIdField:c,source:a,spatialReference:x,orderByFields:c}}createSourceSchema(l,a,b){const {definitionExpression:c}=this.layer;return d.createFeatureSourceSchema(l,{definitionExpression:c,customParameters:null},a,b,null)}createProcessorSchema(l,
a,b){const {fields:c,renderer:t,geometryType:h,labelingInfo:w,labelsVisible:D,objectIdField:x}=this.layer,f={fields:c.map(v=>v.toJSON()),renderer:t?.clone(),featureReduction:q.getEffectiveFeatureReduction(this.layer,a),geometryType:h,labelingInfo:w,labelsVisible:D,objectIdField:x,orderBy:"default"};return u.createSimpleProcessorSchema(l,a,f,b)}get hasRequiredSupport(){return y.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(l){const a=this.layer,{definitionExpression:b,renderer:c}=
a,t=this.layer.labelsVisible?this.layer.labelingInfo:null;l=q.getEffectiveFeatureReduction(a,l)?.toJSON();return{definitionExpression:b,renderer:c,labelingInfo:t,featureReduction:l}}}g.KnowledgeGraphSublayerAdapter=n;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y,n){class l{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=d.getFeatureReductionDeconflictionEnabled(b,a)??d.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:d.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;a=q.getEffectiveLayerCapabilities(b);const {capabilities:c,objectIdField:t}=b,h=b.fieldsIndex.toJSON(),w=h.fields,D=b.fullExtent?.toJSON(),x=r.getEffectiveGeometryType(b),
f=b.timeInfo?.toJSON(),v=b.spatialReference.toJSON();b=b.source.getSource();const z=this.layer.objectIdField,e=m.clone(c);e.query.maxRecordCount=b.maxRecordCount;return{type:"ogc",maxRecordCount:e.query.maxRecordCount,tileMaxRecordCount:e.query.tileMaxRecordCount,capabilities:e,effectiveCapabilities:a,fields:w,fieldsIndex:h,fullExtent:D,geometryType:x,objectIdField:t,source:b,timeInfo:f,spatialReference:v,orderByFields:z}}createSourceSchema(a,b,c){const {customParameters:t,timeExtent:h,apiKey:w}=
this.layer;return u.createFeatureSourceSchema(a,{customParameters:t,timeExtent:h},b,c,w)}createProcessorSchema(a,b,c){const {fields:t,renderer:h,geometryType:w,labelingInfo:D,labelsVisible:x,orderBy:f,objectIdField:v}=this.layer,z={fields:t.map(e=>e.toJSON()),renderer:h?.clone(),featureReduction:p.getEffectiveFeatureReduction(this.layer,b),geometryType:w,labelingInfo:D,labelsVisible:x,objectIdField:v,orderBy:f??"default"};return y.createSimpleProcessorSchema(a,b,z,c)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(a){var b=
this.layer;const {renderer:c,apiKey:t}=b,h=this.layer.labelsVisible?this.layer.labelingInfo:null,w=JSON.stringify(b.customParameters);a=p.getEffectiveFeatureReduction(b,a)?.toJSON();b=JSON.stringify(b.orderBy);return{apiKey:t,customParameters:w,featureReduction:a,labelingInfo:h,orderBy:b,renderer:c}}}g.OGCFeatureLayerAdapter=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c){class t{constructor(h){this.layer=h}getLabelingDeconflictionInfo(h){const w=this.layer;h=l.getFeatureReductionDeconflictionEnabled(w,h)??l.getLayerDeconflictionEnabled(w);return[{vvEvaluators:{0:l.createLabelVVEvaluator(w.renderer)},deconflictionEnabled:h}]}async createServiceOptions(h){var w=this.layer;const D=r.getEffectiveLayerCapabilities(w),{capabilities:x,objectIdField:f,globalIdField:v,orderBy:z,refreshInterval:e}=w,A=w.fieldsIndex.toJSON(),C=A.fields,G=
w.fullExtent?.toJSON(),E=n.getEffectiveGeometryType(w),H=w.timeInfo?.toJSON(),I=w.spatialReference.toJSON(),O=q.clone(this.layer.parsedUrl);let M=this.layer.objectIdField;if(z?.length){var N=!z[0].valueExpression&&z[0].field;N&&(M=N)}N=0<e;h=(N=m("featurelayer-snapshot-enabled")&&"point"===w.geometryType&&x?.query.supportsPagination&&!x?.operations.supportsEditing&&!N)&&u.exceedsMinimumSnapshotCoverage(h,w.fullExtent);w=p.isHostedAgolService(O.path);return{type:"feature-service",supportsSnapshotMinThreshold:N,
supportsSnapshotMaxThreshold:h,snapshotCountThresholds:{min:m("featurelayer-snapshot-point-min-threshold"),max:m("featurelayer-snapshot-point-max-threshold")},isSourceHosted:w,globalIdField:v,maxRecordCount:x.query.maxRecordCount,tileMaxRecordCount:x.query.tileMaxRecordCount,capabilities:x,effectiveCapabilities:D,fields:C,fieldsIndex:A,fullExtent:G,geometryType:E,objectIdField:f,source:O,timeInfo:H,spatialReference:I,orderByFields:M,timeReferenceUnknownClient:!1}}createSourceSchema(h,w,D){const {definitionExpression:x,
customParameters:f,timeExtent:v}=this.layer;return a.createFeatureSourceSchema(h,{definitionExpression:x,customParameters:f,timeExtent:v},w,D,null)}createProcessorSchema(h,w,D){const {fields:x,renderer:f,geometryType:v,labelingInfo:z,labelsVisible:e,orderBy:A,objectIdField:C}=this.layer,G={fields:x.map(E=>E.toJSON()),renderer:f?.clone(),featureReduction:d.getEffectiveFeatureReduction(this.layer,w),geometryType:v,labelingInfo:z,labelsVisible:e,objectIdField:C,orderBy:A??"default"};return b.createSimpleProcessorSchema(h,
w,G,D)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}hasFilters(h){return y.hasFloorFilter(this.layer,h)}addFilters(h,w){return y.addFloorFilter(this.layer,h,w)}getUpdateHashProperties(h){var w=this.layer;const {definitionExpression:D,renderer:x}=w,f=this.layer.labelsVisible?this.layer.labelingInfo:null,v=JSON.stringify(w.customParameters),z=d.getEffectiveFeatureReduction(w,h)?.toJSON();w=JSON.stringify(w.orderBy);h=y.hasFloorFilter(this.layer,h)?h.floors:null;return{orderBy:w,
definitionExpression:D,renderer:x,labelingInfo:f,featureReduction:z,customParameters:v,floors:h}}}g.OrientedImageryLayerAdapter=t;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(g,m,q,p,r,d){class u{constructor(y){this.layer=y}getLabelingDeconflictionInfo(y){const n=
this.layer;y=p.getFeatureReductionDeconflictionEnabled(n,y)??p.getLayerDeconflictionEnabled(n);return[{vvEvaluators:{0:p.createLabelVVEvaluator(n.renderer)},deconflictionEnabled:y}]}async createServiceOptions(y){var n=this.layer;({objectIdField:y}=n);const l=n.fields.map(c=>c.toJSON()),a=q.getEffectiveGeometryType(n),b=n.timeInfo?.toJSON()||null;n=n.spatialReference?n.spatialReference.toJSON():null;return{fields:l,fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:a,objectIdField:y,timeInfo:b,
source:this.layer.parsedUrl,spatialReference:n}}createSourceSchema(y,n,l){const {definitionExpression:a,geometryDefinition:b,customParameters:c}=this.layer;return{type:"stream",sourceRefreshVersion:l,service:y,tileInfoJSON:n.tileInfoJSON,availableFields:n.availableFields,dataFilter:{geometryDefinition:b?.toJSON(),definitionExpression:a,outSpatialReference:n.outSpatialReference.toJSON(),customParameters:c??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,
purgeOptions:this.layer.purgeOptions.toJSON()}}}createProcessorSchema(y,n,l){const {fields:a,renderer:b,geometryType:c,labelingInfo:t,labelsVisible:h,objectIdField:w}=this.layer,D={fields:a.map(x=>x.toJSON()),renderer:b?.clone(),featureReduction:m.getEffectiveFeatureReduction(this.layer,n),geometryType:c,labelingInfo:t,labelsVisible:h,objectIdField:w,orderBy:"default"};return r.createSimpleProcessorSchema(y,n,D,l)}get hasRequiredSupport(){return d.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(y){var n=
this.layer;const {definitionExpression:l,renderer:a}=n,b=this.layer.labelsVisible?this.layer.labelingInfo:null,c=JSON.stringify(n.customParameters);y=m.getEffectiveFeatureReduction(n,y)?.toJSON();n=`${JSON.stringify(n.geometryDefinition)}${n.definitionExpression}`;return{definitionExpression:l,renderer:a,labelingInfo:b,featureReduction:y,customParameters:c,streamFilter:n}}}g.StreamLayerAdapter=u;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../core/mathUtils ../../../../../core/sql ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/FeatureFilter ../../../../../layers/support/layerUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SubtypeProcessorSchema".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c,t){function h(x,f){return x.sublayers.some(v=>!w(v,f))}function w(x,f){return x.visible&&(0===x.minScale||p.floatEqualAbsolute(f.scale,x.minScale)||f.scale<x.minScale)&&(0===x.maxScale||p.floatEqualAbsolute(f.scale,x.maxScale)||f.scale>x.maxScale)}class D{constructor(x){this.layer=x}getLabelingDeconflictionInfo(x){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(f=>b.getLayerDeconflictionEnabled(f))}]}async createServiceOptions(x){var f=this.layer;
const v=y.getEffectiveLayerCapabilities(f),{capabilities:z,datesInUnknownTimezone:e,editingInfo:A,globalIdField:C,objectIdField:G,refreshInterval:E,subtypeField:H}=f,I=f.fieldsIndex.toJSON(),O=I.fields,M=f.fullExtent?.toJSON(),N=a.getEffectiveGeometryType(f),P=f.timeInfo?.toJSON(),L=f.spatialReference.toJSON(),U=q.clone(this.layer.parsedUrl);var T=null==A?.lastEditDate&&0<E;x=(T=m("featurelayer-snapshot-enabled")&&"point"===f.geometryType&&z?.query.supportsPagination&&!z?.operations.supportsEditing&&
!T)&&n.exceedsMinimumSnapshotCoverage(x,f.fullExtent);f=d.isHostedAgolService(U.path);return{type:"feature-service",supportsSnapshotMinThreshold:T,supportsSnapshotMaxThreshold:x,snapshotCountThresholds:{min:m("featurelayer-snapshot-point-min-threshold"),max:m("featurelayer-snapshot-point-max-threshold")},isSourceHosted:f,timeReferenceUnknownClient:e,subtypeField:H,globalIdField:C,maxRecordCount:z.query.maxRecordCount,tileMaxRecordCount:z.query.tileMaxRecordCount,capabilities:z,effectiveCapabilities:v,
fields:O,fieldsIndex:I,fullExtent:M,geometryType:N,objectIdField:G,source:U,timeInfo:P,spatialReference:L,orderByFields:G,lastEditDate:A?.lastEditDate?.getTime()}}createSourceSchema(x,f,v){const {definitionExpression:z,customParameters:e,gdbVersion:A,historicMoment:C,subtypeField:G,timeExtent:E,apiKey:H}=this.layer;var I=this.layer.sublayers.map(O=>O.subtypeCode).join(",");I={definitionExpression:r.sqlAnd(z,this.layer.sublayers.length?`${this.layer.subtypeField} IN (${I})`:"1\x3d2"),customParameters:e,
gdbVersion:A,historicMoment:C,subtypeField:G,timeExtent:E};return c.createFeatureSourceSchema(x,I,f,v,H)}createProcessorSchema(x,f,v){const z={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,e=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible,renderer:e.renderer,subtypeCode:e.subtypeCode,orderBy:null}))};return t.createSubtypeProcessorSchema(x,f,z,v)}hasFilters(x){return l.hasFloorFilter(this.layer,
x)||h(this.layer,x)}addFilters(x,f){x=l.addFloorFilter(this.layer,x,f);var v=this.layer.sublayers.filter(z=>!w(z,f)).map(z=>z.subtypeCode);if(!v.length)return x;x??=new u;v=`NOT ${this.layer.subtypeField} IN (${v.join(",")})`;x.where=r.sqlAnd(x.where,v);return x}get hasRequiredSupport(){return!0}getUpdateHashProperties(x){var f=this.layer;const {definitionExpression:v,gdbVersion:z,apiKey:e}=f,A=f.historicMoment?.getTime()??void 0;f=JSON.stringify(f.customParameters);x=l.hasFloorFilter(this.layer,
x)?x.floors:null;const C="sublayers"in this.layer&&this.layer.sublayers.items.reduce((G,E)=>G+`${E.visible?1:0}.${JSON.stringify(E.renderer)}.${E.labelsVisible}\n.${JSON.stringify(E.labelingInfo)}`,"");return{gdbVersion:z,definitionExpression:v,historicMoment:A,customParameters:f,apiKey:e,sublayerHash:C,floors:x}}setGraphicOrigin(x){var f=this.layer.fieldsIndex.get(this.layer.subtypeField);const v=x.attributes[f.name];f=this.layer.sublayers.find(z=>z.subtypeCode===v);x.layer=x.sourceLayer=f}}g.SubtypeGroupLayerAdapter=
D;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define("exports ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema ../../../../../webgl/capabilities".split(" "),function(g,m,q,p,r,d){async function u(l,{subtypeField:a,sublayers:b}){const c=await Promise.all(b.map(({renderer:t})=>q.createMatcherSchema(l,t)));return{type:"subtype",subtypeField:a,renderers:b.reduce((t,{subtypeCode:h},
w)=>({...t,[h]:c[w]}),{})}}function y(l,a){const b=d.getWebGLCapabilities();return{type:"subtype",filters:l.filters,capabilities:{maxTextureSize:b.maxTextureSize},subtypeField:a.subtypeField,target:"feature",bindings:a.sublayers.reduce((c,{renderer:t,subtypeCode:h})=>{t=p.createVVBindings(t);return{...c,[h]:t}},{})}}async function n(l,{subtypeField:a,sublayers:b}){const c=await Promise.all(b.map(t=>{const h=r.createVisualVariableUniforms(t.renderer);return m.createLabelMatcherSchema(l,{...t,geometryType:t.geometryType??
null},h)}));return{type:"subtype",subtypeField:a,renderers:b.reduce((t,{subtypeCode:h},w)=>({...t,[h]:c[w]}),{})}}g.createSubtypeProcessorSchema=async function(l,a,b,c){return{storage:y(a,b),mesh:{displayRefreshVersion:c,strategy:{type:"feature"},factory:{symbology:await u(l,b),labels:await n(l,b)},sortKey:null}}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../engine/highlightReasons"],function(g,
m){class q{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(p,r){for(const d of p)p=this._idToCounters.get(d),p||(p=new Map,this._idToCounters.set(d,p)),p.set(r,(p.get(r)||0)+1)}deleteReason(p,r){for(const d of p){p=this._idToCounters.get(d);if(!p)continue;let u=p.get(r);if(null==u)break;u--;0<u?p.set(r,u):p.delete(r);0===p.size&&this._idToCounters.delete(d)}}getHighestReason(p){p=this._idToCounters.get(p);if(!p)return null;let r=null;for(const d of m.highlightReasons)p.get(d)&&
(r=d);return r?r:null}ids(){return this._idToCounters.keys()}}g.HighlightCounter=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports","./TileKey"],function(g,m){function q(d,u){const y=new Set;for(const n of d instanceof Set?d.values():d.keys())u.has(n)||y.add(n);return y}class p{constructor(d){this.version=d}}class r{constructor(d){this._subscriptions=new Map;this._visible=new Set;this._paused=new Set;
this._version=0;this._config=d}destroy(){}get _coverageSet(){const d=this._coverage?Array.from(this._coverage.keys()).map(u=>u.id):[];return new Set(d)}suspend(){this._suspendedOverage=this._coverage;this._coverage=null;this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(d){this._version+=1%Number.MAX_SAFE_INTEGER;this._updateCoverage(d);this._updateSubscriptions();return new Set(this._visible)}_updateCoverage(d){this._coverage=
this._config.tileInfoView.getTileCoverage(d.state,0,!0,"closest")}_updateSubscriptions(){var d=this._coverageSet;const u=this._updateVisibility();var y=q(u,d);const n=q(this._subscriptions,u),l=q(d,this._subscriptions);d=q(n,d);y=q(y,d);y=q(y,this._paused);this._visible=u;for(const a of l.values())this._subscriptions.set(a,new p(this._version));for(const a of y.values())this._paused.add(a);for(const a of d.values())this._subscriptions.delete(a),this._paused.delete(a);(l.size||d.size||y.size)&&this._sendUpdateSubscriptions(l,
d,y)}_sendUpdateSubscriptions(d,u,y){d=Array.from(d.values()).map(n=>({tileId:n,version:this._subscriptions.get(n).version}));this._config.updateSubscriptions({subscribe:d,unsubscribe:Array.from(u.values()),pause:Array.from(y.values()),tileInfoJSON:this._config.tileInfoView.tileInfo.toJSON()})}_updateVisibility(){const d=new Set;if(!this._coverage)return d;for(const u of this._coverage.keys())this._config.isDone(u)?d.add(u.id):this._addVisibleParent(d,u)||this._addVisibleChildren(d,u)||d.add(u.id);
return d}_addVisibleParent(d,u){let y=!1;for(const n of this._visible.values())(new m(n)).containsChild(u)&&(d.add(n),y=!0);return y}_addVisibleChildren(d,u){let y=!1;for(const n of this._visible.values()){const l=new m(n);u.containsChild(l)&&(d.add(n),y=!0)}return y}}g.FeatureTileSubscriptionManager=r;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(g,m,q,p,r,d,u,y,n,l,a,b,c,t,h,w,D){return x=>{x=class extends x{constructor(...f){super(...f);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([r.watch(()=>{const f=this.layer;return[f&&"elevationInfo"in f?f.elevationInfo?.featureExpressionInfo:null,f&&"displayField"in f?f.displayField:null,f&&"timeInfo"in f&&f.timeInfo,f&&"renderer"in f&&f.renderer,f&&"labelingInfo"in
f&&f.labelingInfo,f&&"floorInfo"in f&&f.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),r.syncAndInitial),r.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),r.on(()=>{const f=this.layer;return f&&"sublayers"in f?f.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:f,layer:{fieldsIndex:v},requiredFields:z}=this;return"outFields"in f&&f.outFields?c.fixFields(v,
[...c.unpackFieldNames(v,f.outFields),...z]):c.fixFields(v,z)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(f){this._override("featureEffect",f)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(f){q.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(f){throw Error("missing implementation");}createQuery(){var f=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};f=null!=this.filter?this.filter.createQuery(f):new h(f);if("feature"===this.layer.type){const v=t.getFloorFilterClause(this);null!=v&&(f.where=f.where?`(${f.where}) AND (${v})`:v)}null!=this.timeExtent&&(f.timeExtent=null!=f.timeExtent?f.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return f}createAggregateQuery(){return new h({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(f,
v){throw Error("missing implementation");}queryObjectIds(f,v){throw Error("missing implementation");}queryFeatureCount(f,v){throw Error("missing implementation");}queryExtent(f,v){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(f,v){this._validateFetchPopupFeatures(f,v);return this._fetchPopupFeatures(f,v)}_loadArcadeModules(f){return f.expressionInfos?.length||Array.isArray(f.content)&&f.content.some(v=>"expression"===v.type)?w.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const f=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",f);f.then(()=>{this._updatingRequiredFieldsPromise===f&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var f="3d"===this.view.type,{layer:v,layer:{fieldsIndex:z,objectIdField:e}}=this,A="renderer"in v&&v.renderer,C="orderBy"in v&&v.orderBy,G="featureReduction"in v?v.featureReduction:null,E=new Set;A=await Promise.allSettled([A?A.collectRequiredFields(E,z):null,c.collectLabelingFields(E,
v),f&&"elevationInfo"in v?c.collectElevationFields(E,v):null,null!=this.filter?c.collectFilterFields(E,v,this.filter):null,f||null==this.featureEffect?null:c.collectFilterFields(E,v,this.featureEffect.filter),!f&&G?c.collectFeatureReductionFields(E,v,G):null,!f&&C?c.collectOrderByInfos(E,v,C):null]);"timeInfo"in v&&v.timeInfo&&this.timeExtent&&c.collectFields(E,v.fieldsIndex,[v.timeInfo.startField,v.timeInfo.endField]);"feature"===v.type&&(v.floorInfo&&c.collectFields(E,v.fieldsIndex,[v.floorInfo.floorField]),
f&&null!=v.infoFor3D&&(null==v.globalIdField&&q.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),c.collectFields(E,v.fieldsIndex,[v.globalIdField])));"subtype-group"===v.type&&(c.collectField(E,z,v.subtypeField),C=v.sublayers.map(H=>Promise.all([H.renderer?.collectRequiredFields(E,z),c.collectLabelingFields(E,H)])),await Promise.allSettled(C));"catalog-footprint"===v.type&&c.collectFields(E,z,[v.parent.itemSourceField,v.parent.itemTypeField]);for(const H of A)"rejected"===H.status&&
q.getLogger(this).error(H.reason);c.collectField(E,z,e);f&&"displayField"in v&&v.displayField&&c.collectField(E,z,v.displayField);f=Array.from(E).sort();this._set("requiredFields",f)}}_validateFetchPopupFeatures(f,v){if(null!=v)for(const z of f){f=z.origin&&"layer"in z.origin?z.origin.layer:z.layer;if("popupEnabled"in f&&!f.popupEnabled)throw new m("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:f});if(z.isAggregate){const e="featureReduction"in f?f.featureReduction:null;if(!(e&&
"popupTemplate"in e&&e.popupEnabled&&e.popupTemplate))throw new m("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:f});}else if("popupTemplate"in f&&!D.getFetchPopupTemplate(f,v))throw new m("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:f});}}_popupFeatureHasRequiredFields(f,v){return c.featureHasFields(v,f)}async _fetchPopupFeatures(f,v){const z=Array(f.length),e=new Map,A=await this._createPopupQuery(f.map(G=>G.origin?.layer??G.layer),v);
for(let G=0;G<f.length;G++){const E=f[G];if(E.isAggregate){z[G]=E;continue}var C=E.origin?.layer??E.layer;if(!(C&&"popupEnabled"in C))continue;const H=c.unpackFieldNames(this.layer.fieldsIndex,A.outFields);C=D.getFetchPopupTemplate(C,v);if(null==C)continue;const I=await this._loadArcadeModules(C);p.throwIfAborted(v);I&&I.arcadeUtils.hasGeometryOperations(C)||!this._popupFeatureHasRequiredFields(E,H)?e.set(E.getObjectId(),{graphic:E,index:G}):z[G]=E}if("stream"===this.layer.type||0===e.size)return z.filter(Boolean);
A.objectIds=Array.from(e.keys());try{const G=await this.layer.queryFeatures(A,v);for(const E of G.features){const {graphic:{geometry:H,origin:I},index:O}=e.get(E.getObjectId());let M;(M=E).geometry||(M.geometry=H);E.origin=I;z[O]=E}}catch{}return z.filter(Boolean)}async _createPopupQuery(f,v){const z=this.layer.createQuery(),e=new Set;var A=!1;f=f??[this.layer];for(const C of f)if("popupEnabled"in C&&(f=D.getFetchPopupTemplate(C,v),null!=f)){A=await this._loadArcadeModules(f);p.throwIfAborted(v);
A=A&&A.arcadeUtils.hasGeometryOperations(f);A=!("point"!==this.layer.geometryType&&!A);f=await D.getRequiredFields(this.layer,f);p.throwIfAborted(v);for(const G of f)e.add(G)}z.returnGeometry=A;z.returnZ=A;z.returnM=A;z.outFields=Array.from(e);z.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(v=t.getFloorFilterClause(this),null!=v&&(z.where=z.where?`(${z.where}) AND (${v})`:v));return z}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?
!1:!0}getTest(){return{createPopupQuery:f=>this._createPopupQuery(void 0,f)}}get test(){return this.getTest()}};g.__decorate([d.property()],x.prototype,"_updatingRequiredFieldsPromise",void 0);g.__decorate([d.property({readOnly:!0})],x.prototype,"availableFields",null);g.__decorate([d.property({readOnly:!0})],x.prototype,"dataUpdating",void 0);g.__decorate([d.property({type:a})],x.prototype,"featureEffect",null);g.__decorate([d.property({type:b})],x.prototype,"filter",void 0);g.__decorate([d.property(l.combinedViewLayerTimeExtentProperty)],
x.prototype,"timeExtent",void 0);g.__decorate([d.property()],x.prototype,"layer",void 0);g.__decorate([d.property({type:Number})],x.prototype,"maximumNumberOfFeatures",null);g.__decorate([d.property({readOnly:!0,type:Boolean})],x.prototype,"maximumNumberOfFeaturesExceeded",null);g.__decorate([d.property({readOnly:!0})],x.prototype,"requiredFields",void 0);g.__decorate([d.property()],x.prototype,"suspended",void 0);g.__decorate([d.property()],x.prototype,"view",void 0);return x=g.__decorate([n.subclass("esri.views.layers.FeatureLayerView")],
x)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(g){function m(q,p){if(!q?.length)return null;q=q.filter(r=>""!==r).map(r=>`'${r}'`);q.push("''");return`${p} IN (${q.join(",")}) OR ${p} IS NULL`}g.getFloorFilterClause=function(q){const p=q.layer;return"floorInfo"in p&&p.floorInfo?.floorField&&"floors"in q.view?m(q.view.floors,p.floorInfo.floorField):null};g.getLayerFloorFilterClause=function(q,p){return"floorInfo"in p&&p.floorInfo?.floorField?m(q,p.floorInfo.floorField):
null};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(g,m){function q(p,r){return p.popupTemplate?p.popupTemplate:null!=r&&r.defaultPopupTemplateEnabled&&null!=p.defaultPopupTemplate?p.defaultPopupTemplate:null}g.getFetchPopupTemplate=q;g.getRequiredFields=async function(p,r=p.popupTemplate){if(null==r)return[];const d=await r.getRequiredFields(p.fieldsIndex);({lastEditInfoEnabled:r}=
r);const {objectIdField:u,typeIdField:y,globalIdField:n,relationships:l}=p;if(d.includes("*"))return["*"];r=r?m.getFeatureEditFields(p):[];const a=m.fixFields(p.fieldsIndex,[...d,...r]);y&&a.push(y);a&&u&&p.fieldsIndex?.has(u)&&!a.includes(u)&&a.push(u);a&&n&&p.fieldsIndex?.has(n)&&!a.includes(n)&&a.push(n);l&&l.forEach(b=>{({keyField:b}=b);a&&b&&p.fieldsIndex?.has(b)&&!a.includes(b)&&a.push(b)});return a};g.hasPopupTemplate=function(p,r){return null!=q(p,{defaultPopupTemplateEnabled:r})};Object.defineProperty(g,
Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(g,m,q,p,r,d,u,y){return n=>{n=class extends n{initialize(){this.addHandles(p.on(()=>this.layer,"refresh",l=>{this.doRefresh(l.dataChanged).catch(a=>{q.isAbortError(a)||m.getLogger(this).error(a)})}),
"RefreshableLayerView")}};return n=g.__decorate([y.subclass("esri.layers.mixins.RefreshableLayerView")],n)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/highlightReasons ../engine/webgl/shaderGraph/techniques/InstanceStore ./LayerView2D ./features/FeatureContainer ./features/FeaturePipelineWorkerProxy ./features/FeatureSourceEventLog ./features/layerAdapters/CatalogFootprintLayerAdapter ./features/layerAdapters/FeatureLayerAdapter ./features/layerAdapters/InMemoryLayerAdapter ./features/layerAdapters/KnowledgeGraphSublayerAdapter ./features/layerAdapters/OGCFeatureLayerAdapter ./features/layerAdapters/OrientedImageryLayerAdapter ./features/layerAdapters/StreamLayerAdapter ./features/layerAdapters/SubtypeGroupLayerAdapter ./features/schema/processor/symbols/ComplexSymbolSchema ./support/FeatureCommandQueue ./support/HighlightCounter ../tiling/FeatureTileSubscriptionManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../../geometry/Extent".split(" "),function(g,
m,q,p,r,d,u,y,n,l,a,b,c,t,h,w,D,x,f,v,z,e,A,C,G,E,H,I,O,M,N,P,L,U,T,R,V,aa,ba,ca,da,Q,Y,Z,fa,ha){function ia(k,B){const F=new Set;k&&k.forEach(K=>F.add(K));B&&B.forEach(K=>F.add(K));return F.has("*")?["*"]:Array.from(F)}q=class extends Y(fa(H.LayerView2DMixin(Z))){constructor(){super(...arguments);this._commandsQueue=new ca({process:k=>{switch(k.type){case "processed-edit":return this._doEdit(k);case "update":return this._doUpdate()}}});this._visibilityOverrides=new Set;this._highlightCounter=new da.HighlightCounter;
this._updateHighlight=c.debounce(async()=>{const k=[];for(const F of this._highlightCounter.ids()){var B=this._highlightCounter.getHighestReason(F);B=G.getHighlightBits(B);k.push({objectId:F,highlightFlags:B})}this._worker.processor.setHighlight(k)});this._lastAvailableFields=[];this._instanceStore=new E;this.eventLog=new M.FeatureSourceEventLog;this._displayRefreshVersion=this._sourceRefreshVersion=1;this._pipelineUpdating=!1;this._fields=null;this.featureEffectView=new x}destroy(){this._worker?.destroy();
this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(this._initProxy());this.featureEffectView.featureEffect=this.featureEffect;this.featureEffectView.endTransitions()}async _initProxy(){var k=this.layer;if("isTable"in k&&k.isTable)throw new y("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:k});if("mesh"===k.geometryType)throw new y("featurelayerview:geometry-type-not-supported",`Geometry type of ${k.geometryType} is not supported`,{layer:k});
if(("feature"===k.type||"subtype-group"===k.type)&&!1===z.getEffectiveLayerCapabilities(k)?.operations.supportsQuery)throw new y("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:k});this._worker&&this._worker.destroy();k=this._createClientOptions();this._worker=await O.createFeaturePipelineWorkerProxy(k)}get hasAllFeatures(){return this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const k=
this.layerAdapter.getLabelingDeconflictionInfo(this.view),B=this.layer.geometryType,F=!this.suspended;return k.map(({vvEvaluators:K,deconflictionEnabled:J})=>({container:this.featureContainer,vvEvaluators:K,deconflictionEnabled:J,geometryType:B,visible:F}))}get layerAdapter(){switch(this.layer.type){case "feature":return"memory"===this.layer.source.type?new L.InMemoryLayerAdapter(this.layer):new P.FeatureLayerAdapter(this.layer);case "geojson":case "csv":case "wfs":return new L.InMemoryLayerAdapter(this.layer);
case "subtype-group":return new aa.SubtypeGroupLayerAdapter(this.layer);case "ogc-feature":return new T.OGCFeatureLayerAdapter(this.layer);case "stream":return new V.StreamLayerAdapter(this.layer);case "oriented-imagery":return new R.OrientedImageryLayerAdapter(this.layer);case "knowledge-graph-sublayer":return new U.KnowledgeGraphSublayerAdapter(this.layer);case "catalog-footprint":return new N.CatalogFootprintLayerAdapter(this.layer);default:u.neverReached(this.layer)}return null}get updateHash(){if(!this.layerAdapter)return null;
const {availableFields:k,_displayRefreshVersion:B,timeExtent:F,clips:K,filter:J,featureEffect:S,_sourceRefreshVersion:W,view:{timeZone:X}}=this,ea=JSON.stringify(K),ja=S?.toJSON(),ka=J?.toJSON();return JSON.stringify({availableFields:k,clipsHash:ea,displayRefreshVersion:B,effectHash:ja,filterHash:ka,sourceRefreshVersion:W,timeExtent:F,timeZone:X,...this.layerAdapter.getUpdateHashProperties(this.view)})}getDisplayStatistics(k,B){return this.featureContainer.getDisplayStatistics(k,B)}async queryHeatmapStatistics(k){return this._worker.pipeline.queryHeatmapStatistics(k)}highlight(k,
B="highlight"){let F;k instanceof p?F=[k.getObjectId()]:"number"===typeof k||"string"===typeof k?F=[k]:d.isCollection(k)&&0<k.length?F=k.map(J=>J?.getObjectId()).toArray():Array.isArray(k)&&0<k.length&&(F="number"===typeof k[0]||"string"===typeof k[0]?k:k.map(J=>J?.getObjectId()));const K=F?.filter(r.isSome);if(!K?.length)return n.makeHandle();this._addHighlight(K,B);return n.makeHandle(()=>this._removeHighlight(K,B))}hasHighlight(){return!this._highlightCounter.empty}async hitTest(k,B){B=await this.featureContainer.hitTest(B);
if(0===B.length)return null;l("featurelayer-force-marker-text-draw-order")&&B.sort((J,S)=>J-S);const {features:F,aggregates:K}=await this._worker.processor.getDisplayFeatures(B);return[...K.map(J=>this._createGraphicHit(k,m.fromJSON(J))),...F.map(J=>this._createGraphicHit(k,p.fromJSON(J)))]}queryStatistics(){return this._worker.pipeline.queryStatistics()}async querySummaryStatistics(k,B,F){B={...B,scale:this.view.scale};return this._worker.features.executeQueryForSummaryStatistics(this._cleanUpQuery(k),
B,F)}async queryAggregateSummaryStatistics(k,B,F){B={...B,scale:this.view.scale};return this._worker.aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(k),B,F)}async queryUniqueValues(k,B,F){B={...B,scale:this.view.scale};return this._worker.features.executeQueryForUniqueValues(this._cleanUpQuery(k),B,F)}async queryAggregateUniqueValues(k,B,F){B={...B,scale:this.view.scale};return this._worker.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(k),B,F)}async queryClassBreaks(k,
B,F){B={...B,scale:this.view.scale};return this._worker.features.executeQueryForClassBreaks(this._cleanUpQuery(k),B,F)}async queryAggregateClassBreaks(k,B,F){B={...B,scale:this.view.scale};return this._worker.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(k),B,F)}async queryHistogram(k,B,F){B={...B,scale:this.view.scale};return this._worker.features.executeQueryForHistogram(this._cleanUpQuery(k),B,F)}async queryAggregateHistogram(k,B,F){B={...B,scale:this.view.scale};return this._worker.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(k),
B,F)}queryFeatures(k,B){return this.queryFeaturesJSON(k,B).then(F=>{F=A.fromJSON(F);F.features.forEach(K=>this._setLayersForFeature(K));return F})}async queryVisibleFeatures(k,B){k=await this._worker.pipeline.queryVisibleFeatures(this._cleanUpQuery(k),B);k=A.fromJSON(k);k.features.forEach(F=>this._setLayersForFeature(F));return k}async queryAggregates(k,B){k=await this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(k),B);k=e.fromJSON(k);k.features.forEach(F=>this._setLayersForFeature(F));
return k}queryAggregateIds(k,B){return this._worker.aggregates.executeQueryForIds(this._cleanUpAggregateQuery(k),B)}queryAggregateCount(k,B){return this._worker.aggregates.executeQueryForCount(this._cleanUpAggregateQuery(k),B)}queryAggregateJSON(k,B){return this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(k),B)}queryFeaturesJSON(k,B){return this._worker.features.executeQuery(this._cleanUpQuery(k),B)}queryObjectIds(k,B){return this._worker.features.executeQueryForIds(this._cleanUpQuery(k),
B)}queryFeatureCount(k,B){return this._worker.features.executeQueryForCount(this._cleanUpQuery(k),B)}async queryExtent(k,B){k=await this._worker.features.executeQueryForExtent(this._cleanUpQuery(k),B);return{count:k.count,extent:ha.fromJSON(k.extent)}}async getSampleFeatures(k){return this._worker.pipeline.getSampleFeatures(k)}setVisibility(k,B){B?this._visibilityOverrides.delete(k):this._visibilityOverrides.add(k);this._update()}update(k){this._subscriptionManager&&(k=this._subscriptionManager.update(k),
this.featureContainer.setVisibleTiles(k))}attach(){l("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach");this.featureContainer=new I.FeatureContainer(this);this.container.addChild(this.featureContainer);this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._subscriptionManager=new Q.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:k=>{this.featureContainer.updateSubscriptions(k);this._worker.pipeline.updateSubscriptions(k)},
isDone:k=>this.featureContainer.isDone(k)});this.requestUpdate();this.addAttachHandles([t.watch(()=>this.updateHash,()=>this._update(),t.initial),t.watch(()=>this.updateSuspended,k=>{k||this._subscriptionManager.resume()})]);"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",k=>this._edit(k)))}detach(){l("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach");this._fields=null;this.featureContainer.destroy();this._commandsQueue.clear();
this.container.removeAllChildren();this._subscriptionManager=b.destroyMaybe(this._subscriptionManager);this._worker.pipeline.onDetach()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const k="renderer"in this.layer&&null!=this.layer.renderer,B=this._commandsQueue.updateTracking.updating,F=null!=this._updatingRequiredFieldsPromise,K=this.featureContainer.updatingHandles.updating,J=k&&(B||F)||K||this._pipelineUpdating||this.dataUpdating;
if(l("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${J}\n  -> hasRenderer ${k}\n  -> updatingRequiredFields ${F}\n  -> hasPendingCommand ${B}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${K}\n`);for(const S of this.featureContainer.subscriptions())console.log(`    -> Tile[${S.id}] Done: ${S.done}`)}return J}_createClientOptions(){const k=this;return{get container(){return k.featureContainer},setUpdating:B=>{this._set("_pipelineUpdating",
B.pipeline);this._set("dataUpdating",B.data)},emitEvent:B=>{this.emit(B.name,B.event)},get eventLog(){return k.eventLog},fetch:B=>Promise.all(B.map(F=>k.view.stage.painter.textureManager.rasterizeItem(F))),fetchDictionary:B=>Promise.all(B.map(F=>this._fetchDictionaryRequest(F)))}}async _fetchDictionaryRequest(k){try{if("subtype-group"===this.layer.type)throw Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const B=this.layer.renderer;if(!B||"dictionary"!==B.type)throw Error("InternalError: Expected layer to have a DictionaryRenderer");
const F=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==F.type)throw Error("InternalError: Expected schema to be of type 'dictionary'");const K={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this._instanceStore,scaleExpression:F.scaleExpression};this._fields||(this._fields=this.layer.fields.map(W=>W.toJSON()));const J=F.visualVariableUniforms,S=await B.getSymbolAsync(k.feature,{fields:this._fields});return S&&
S.data?{type:"dictionary-response",meshes:await ba.createComplexSymbolInstances(S.data,{uniforms:J,path:"renderer",schemaOptions:K})}:{type:"dictionary-response",meshes:[]}}catch(B){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(k){k=C.from(k)||this.createQuery();k.outSpatialReference||(k.outSpatialReference=this.view.spatialReference);return k.toJSON()}_cleanUpAggregateQuery(k){k=C.from(k)||this.createAggregateQuery();k.outSpatialReference||(k.outSpatialReference=this.view.spatialReference);
const B=k.objectIds??[];for(const F of k.aggregateIds??[])B.push(F);k.objectIds=B;k.aggregateIds=[];return k.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(k){if(this.updateSuspended)this._subscriptionManager.suspend();else if(this._validateEdit(k))return this._commandsQueue.push({type:"edit",edits:k})}async doRefresh(k){this.attached&&(this.updateSuspended&&k||(k?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=
(this._sourceRefreshVersion+1)%4294967294+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%4294967294+1}_validateEdit(k){const B="globalIdField"in this.layer&&this.layer.globalIdField,F=k.deletedFeatures.some(J=>-1===J.objectId||!J.objectId),K=B&&this.availableFields.includes(B);return F&&!K?(a.getLogger(this).error(new y("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${B} to be included the layer's outFields for updates to be reflected on the map`)),
null):k}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone());try{if(await this._updateRequiredFields(),!this.destroyed&&this.layerAdapter?.hasRequiredSupport&&this._subscriptionManager){var k=this._instanceStore;k.updateStart();var B=this.featureEffect,F={store:k,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},K=await this.layerAdapter.createServiceOptions(this.view),
J=this._createViewSchemaConfig(),S={source:this.layerAdapter.createSourceSchema(K,J,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(F,J,this._displayRefreshVersion)},W=D.diff(this._lastSchema,S);if(W){this._lastSchema=S;this._fields=null;var X=Math.round(performance.now());l("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${X}] FeatureLayerView2D._doUpdate`,{changes:W});this.featureContainer.updateStart();F=[];Array.isArray(K.source)&&(F=K.source);
await this._worker.pipeline.updateSchema(S,X,{transferList:F});k.updateEnd();this.featureEffectView.featureEffect=B;this.featureEffectView.endTransitions();this.featureContainer.updateEnd(k,X);l("esri-2d-update-debug")&&console.debug(`Version[${X}] FeatureLayerView2D.updateEnd`);this.requestUpdate()}else this.featureContainer.requestRender(),k.updateEnd(),this.featureEffectView.featureEffect=B}}catch(ea){l("esri-2d-update-debug")&&console.error("Encountered an error during update",ea)}}async _doEdit(k){try{this.featureContainer.editStart(),
await this._worker.pipeline.onEdits(k),this.featureContainer.editEnd()}catch(B){c.isAbortError(B)}}get hasFilter(){const k=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||0<this._visibilityOverrides.size||k}_getEffectiveAvailableFields(k){this._lastAvailableFields=k=ia(this._lastAvailableFields,k);return v.packFields(this.layer.fieldsIndex,k)}_createViewSchemaConfig(){var k=this.view,B=this.layerAdapter,F=this.timeExtent,K=this._visibilityOverrides,J=
this.filter;J&&=J.clone();const S=null!=J?J.timeExtent:null;if(F=null!=F&&null!=S?F.intersection(S):F||S)J??=new f,J.timeExtent=F;J=B.addFilters?.(J,k)??J;k=J?.toJSON()??null;K.size&&(k??=(new f).toJSON(),k.hiddenIds=Array.from(K));K=this.featureEffect?.filter?.toJSON()??null;K=[k,K];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:K,outSpatialReference:this.view.spatialReference,tileInfoJSON:this.view.featuresTilingScheme.tileInfo.toJSON(),scale:this.view.scale}}_addHighlight(k,
B){this._highlightCounter.addReason(k,B);this._updateHighlight().catch(F=>{c.isAbortError(F)||a.getLogger(this).error(F)})}_removeHighlight(k,B){this._highlightCounter.deleteReason(k,B);this._updateHighlight().catch(F=>{c.isAbortError(F)||a.getLogger(this).error(F)})}_setLayersForFeature(k){k.layer=k.sourceLayer=this.layer;this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(k)}_createGraphicHit(k,B){this._setLayersForFeature(B);null!=B.geometry&&(B.geometry.spatialReference=this.view.spatialReference);
return{type:"graphic",graphic:B,layer:this.layer,mapPoint:k}}};g.__decorate([h.property()],q.prototype,"_worker",void 0);g.__decorate([h.property()],q.prototype,"_commandsQueue",void 0);g.__decorate([h.property()],q.prototype,"_sourceRefreshVersion",void 0);g.__decorate([h.property()],q.prototype,"_displayRefreshVersion",void 0);g.__decorate([h.property({readOnly:!0})],q.prototype,"_pipelineUpdating",void 0);g.__decorate([h.property({readOnly:!0})],q.prototype,"hasAllFeatures",null);g.__decorate([h.property({readOnly:!0})],
q.prototype,"hasAllFeaturesInView",null);g.__decorate([h.property({readOnly:!0})],q.prototype,"hasFullGeometries",null);g.__decorate([h.property()],q.prototype,"featureEffectView",void 0);g.__decorate([h.property()],q.prototype,"labelingCollisionInfos",null);g.__decorate([h.property()],q.prototype,"layerAdapter",null);g.__decorate([h.property()],q.prototype,"updateHash",null);g.__decorate([h.property()],q.prototype,"updating",void 0);return q=g.__decorate([w.subclass("esri.views.2d.layers.FeatureLayerView2D")],
q)});