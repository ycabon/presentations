// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(n,L,F,y,v,C,S,J,R,T,M,p,z){F=class extends F{constructor(){super(...arguments);
this._loadImagery=(I,A,t,q,D)=>M.loadImagery(this.layer,I,A,t,q,D);this._createFlowMesh=(I,A,t,q)=>this.layer.createFlowMesh({meshType:I,flowData:t,simulationSettings:A},{signal:q});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:I}=this,A=()=>{this._loadImagery=(t,q,D,V,a)=>M.loadImagery(I,t,q,D,V,a);this._updateVisualization()};"multidimensionalDefinition"in
I?this.addHandles(y.watch(()=>I.multidimensionalDefinition,A)):this.addHandles([y.watch(()=>I.mosaicRule,A),y.watch(()=>I.rasterFunction,A),y.watch(()=>I.definitionExpression,A)]);this.container=new p;this._strategy=new z({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(I){I.stationary?this._strategy.update(I):this.layerView.requestUpdate()}hitTest(I){return new L({attributes:{},
geometry:I.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var I=this.layer.renderer;null!=I&&"flow"===I.type&&(I=T(I,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=I,this.layerView.requestUpdate())}};n.__decorate([v.property()],F.prototype,"_strategy",void 0);n.__decorate([v.property()],F.prototype,"attached",void 0);n.__decorate([v.property()],F.prototype,"container",void 0);n.__decorate([v.property()],
F.prototype,"layer",void 0);n.__decorate([v.property()],F.prototype,"layerView",void 0);n.__decorate([v.property()],F.prototype,"type",void 0);n.__decorate([v.property()],F.prototype,"updating",null);n.__decorate([v.property()],F.prototype,"timeExtent",void 0);return F=n.__decorate([R.subclass("esri.views.2d.engine.flow.FlowView2D")],F)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(n,
L,F,y,v){return function(C,S){const {flowSpeed:J,trailLength:R}=C,T=n.getFlowSimulationSettings(C);let M=null;const p={opacity:n.getOpacity(C),size:n.getSize(C)};let z=n.getColor(C);"none"===C.background?p.color=z:("constant"===z.kind&&(z={kind:"ramp",stops:[0,1],values:[0,0,0,1,z.value[0],z.value[1],z.value[2],z.value[3]],count:2}),M=new L.Imagery({loadImagery:S.loadImagery,timeExtent:S.timeExtent,color:z,opacity:{kind:"constant",value:[1]}}),p.color=n.getForegroundColor());S={loadImagery:S.loadImagery,
createFlowMesh:S.createFlowMesh,simulationSettings:T,timeExtent:S.timeExtent,trailLength:R,flowSpeed:J,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:p.color,opacity:p.opacity,size:p.size};C="butt"===C.trailCap||4>=n.getMax(n.getSize(C))?new v(S):new F.Particles(S);return null!=M?new y.Stack([M,C]):C}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils"],function(n,L){function F(J){return"constant"===J.kind?J.value[0]:
J.values[J.values.length-1]}function y(J){J=J.toRgba();return[J[0]/255,J[1]/255,J[2]/255,J[3]]}function v(J){if(!J.hasVisualVariables("size"))return{kind:"constant",value:[L.pt2px(J.trailWidth)]};const R=J.getVisualVariablesForType("size")[0];J=[];const T=[];if(R.stops){for(M of R.stops)J.push(M.value),T.push(L.pt2px(M.size));var M=R.stops.length}else J.push(R.minDataValue,R.maxDataValue),T.push(L.pt2px(R.minSize),L.pt2px(R.maxSize)),M=2;return{kind:"ramp",stops:J,values:T,count:M}}function C(J,R,
T,M){switch(R){case "int":J.setUniform1iv(T,M);break;case "float":J.setUniform1fv(T,M);break;case "vec2":J.setUniform2fv(T,M);break;case "vec3":J.setUniform3fv(T,M);break;case "vec4":J.setUniform4fv(T,M)}}function S(J,R){return J===R?!0:null!=J&&null!=R?J.equals(R):!1}n.areStreamlinesCompatible=function(J,R){var T=J.simulationSettings,M=R.simulationSettings;let p;p=(p=(p=(p=(p=(p=(p=(p=(p=(p=(p=T.collisions===M.collisions)&&T.density===M.density)&&T.interpolate===M.interpolate)&&T.lineCollisionWidth===
M.lineCollisionWidth)&&T.lineSpacing===M.lineSpacing)&&T.maxTurnAngle===M.maxTurnAngle)&&T.minSpeedThreshold===M.minSpeedThreshold)&&T.segmentLength===M.segmentLength)&&T.smoothing===M.smoothing)&&T.velocityScale===M.velocityScale)&&T.verticesPerLine===M.verticesPerLine;return p&&S(J.timeExtent,R.timeExtent)?T=(T=(T=(T=(T=J.loadImagery===R.loadImagery)&&J.createFlowMesh===R.createFlowMesh)&&J.color.kind===R.color.kind)&&J.opacity.kind===R.opacity.kind)&&J.size.kind===R.size.kind:!1};n.getColor=function(J){if(!J.hasVisualVariables("color"))return{kind:"constant",
value:y(J.color)};J=J.getVisualVariablesForType("color")[0];const R=[],T=[];for(const M of J.stops)R.push(M.value),Array.prototype.push.apply(T,y(M.color));return{kind:"ramp",stops:R,values:T,count:J.stops.length}};n.getFlowSimulationSettings=function(J){var R=v(J);R=F(R);const T=Math.max(R/2,5),M=Math.round(L.pt2px(J.maxPathLength)/T)+1,{density:p}=J;return{smoothing:L.pt2px(J.smoothing),interpolate:!0,velocityScale:"flow-from"===J.flowRepresentation?1:-1,verticesPerLine:M,minSpeedThreshold:.001,
segmentLength:T,maxTurnAngle:1,collisions:!0,lineCollisionWidth:R,lineSpacing:10,density:p}};n.getForegroundColor=function(J){return{kind:"constant",value:[.1,.1,.1,1]}};n.getMax=F;n.getOpacity=function(J){if(!J.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};J=J.getVisualVariablesForType("opacity")[0];const R=[],T=[];for(const M of J.stops)R.push(M.value),T.push(M.opacity);return{kind:"ramp",stops:R,values:T,count:J.stops.length}};n.getSize=v;n.setUniform=C;n.setUniforms=function(J,
R,T,M){"constant"===M.kind?C(J,T,`u_${R}`,M.value):(C(J,"float",`u_${R}_stops`,M.stops),C(J,T,`u_${R}_values`,M.values),J.setUniform1i(`u_${R}_count`,M.count))};n.timeExtentsEqual=S;n.toRgba=y;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(n,L,F,y,v,C,S,J,R){class T{constructor(A){this._params=A;this.animated=!1}isCompatible(A){if(!(A instanceof T&&F.timeExtentsEqual(this._params.timeExtent,A._params.timeExtent)))return!1;let t;return t=(t=(t=this._params.loadImagery===A._params.loadImagery)&&this._params.color.kind===A._params.color.kind)&&this._params.opacity.kind===A._params.opacity.kind}async load(A,t){const {extent:q,size:D}=A;L.throwIfAborted(t);A=await this._params.loadImagery(q,D[0],D[1],this._params.timeExtent,t);
return new I(A,{color:this._params.color,opacity:this._params.opacity})}render(A,t,q){({context:A}=A);const {program:D}=q;A.setFaceCullingEnabled(!1);A.setBlendingEnabled(!0);A.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);A.useProgram(D);D.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3);A.bindTexture(q.texture,0);D.setUniform1i("u_texture",0);D.setUniform1f("u_Min",q.min);D.setUniform1f("u_Max",q.max);F.setUniforms(D,"color","vec4",this._params.color);F.setUniforms(D,"opacity",
"float",this._params.opacity);A.bindVAO(q.vertexArray);A.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,4)}}const M=new Map;M.set("a_position",0);M.set("a_texcoord",1);const p={geometry:[new R.VertexElementDescriptor("a_position",2,v.DataType.UNSIGNED_SHORT,0,8),new R.VertexElementDescriptor("a_texcoord",2,v.DataType.UNSIGNED_SHORT,4,8)]},z={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:M};class I{constructor(A,t){this._flowData=A;this._values=t}attach(A){var {context:t}=A;const {width:q,
height:D}=this._flowData;var V={geometry:y.BufferObject.createVertex(t,v.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,q,0,1,1,0,D,0,0,q,D,1,0]))};V=new J.VertexArrayObject(t,M,p,V);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");A=A.painter.materialManager.getProgram(z,a);a=1E6;let b=-1E6;for(var e=0;e<D;e++)for(var g=0;g<q;g++)if(0!==this._flowData.mask[e*q+g]){var d=this._flowData.data[2*(e*q+g)],f=this._flowData.data[2*(e*q+g)+
1];d=Math.sqrt(d*d+f*f);a=Math.min(a,d);b=Math.max(b,d)}e=new Uint8Array(4*q*D);for(g=0;g<D;g++)for(d=0;d<q;d++)if(0!==this._flowData.mask[g*q+d]){f=this._flowData.data[2*(g*q+d)];const h=this._flowData.data[2*(g*q+d)+1];e[4*(g*q+d)]=(Math.sqrt(f*f+h*h)-a)/(b-a)*255;e[4*(g*q+d)+1]=0;e[4*(g*q+d)+2]=0;e[4*(g*q+d)+3]=255}else e[4*(g*q+d)]=0,e[4*(g*q+d)+1]=0,e[4*(g*q+d)+2]=0,e[4*(g*q+d)+3]=0;g=new S.TextureDescriptor;g.internalFormat=v.PixelFormat.RGBA;g.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;g.flipped=
!0;g.width=q;g.height=D;t=new C.Texture(t,g,e);this.vertexArray=V;this.program=A;this.texture=t;this.min=a;this.max=b;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}n.Imagery=T;n.ImageryResources=I;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(n,L,F,y,v,C,S){class J{constructor(z){this._params=z}get animated(){return 0<this._params.flowSpeed}isCompatible(z){return z instanceof J?F.areStreamlinesCompatible(this._params,z._params):!1}async load(z,I){const {extent:A,size:t}=z;L.throwIfAborted(I);z=await this._params.loadImagery(A,t[0],t[1],this._params.timeExtent,I);const {vertexData:q,indexData:D}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,z,I);return new p(q,D,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(z,I,A){({context:z}=z);const {program:t}=A;z.setFaceCullingEnabled(!1);z.setBlendingEnabled(!0);z.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);z.useProgram(t);t.setUniform1f("u_time",I.time);t.setUniform1f("u_trailLength",this._params.trailLength);t.setUniform1f("u_flowSpeed",this._params.flowSpeed);t.setUniform1f("u_featheringSize",this._params.featheringSize);t.setUniform1f("u_featheringOffset",this._params.featheringOffset);t.setUniform1f("u_introFade",
this._params.introFade?1:0);t.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);t.setUniform1f("u_decayRate",this._params.decayRate);t.setUniformMatrix3fv("u_dvsMat3",I.dvsMat3);t.setUniformMatrix3fv("u_displayViewMat3",I.displayViewMat3);F.setUniforms(t,"color","vec4",this._params.color);F.setUniforms(t,"opacity","float",this._params.opacity);F.setUniforms(t,"size","float",this._params.size);z.bindVAO(A.vertexArray);z.drawElements(v.PrimitiveType.TRIANGLES,A.indexCount,v.DataType.UNSIGNED_INT,
0)}}const R=new Map;R.set("a_xyts0",0);R.set("a_xyts1",1);R.set("a_typeIdDurationSeed",2);R.set("a_extrudeInfo",3);const T={geometry:[new S.VertexElementDescriptor("a_xyts0",4,v.DataType.FLOAT,0,64),new S.VertexElementDescriptor("a_xyts1",4,v.DataType.FLOAT,16,64),new S.VertexElementDescriptor("a_typeIdDurationSeed",4,v.DataType.FLOAT,32,64),new S.VertexElementDescriptor("a_extrudeInfo",4,v.DataType.FLOAT,48,64)]},M={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:R};class p{constructor(z,
I,A){this._vertexData=z;this._indexData=I;this._values=A}attach(z){var {context:I}=z,A=y.BufferObject.createVertex(I,v.Usage.STATIC_DRAW,this._vertexData);const t=y.BufferObject.createIndex(I,v.Usage.STATIC_DRAW,this._indexData);I=new C.VertexArrayObject(I,R,T,{geometry:A},t);A=[];"ramp"===this._values.color.kind&&A.push("vvColor");"ramp"===this._values.opacity.kind&&A.push("vvOpacity");"ramp"===this._values.size.kind&&A.push("vvSize");z=z.painter.materialManager.getProgram(M,A);this.vertexArray=
I;this.program=z;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}n.Particles=J;n.ParticlesResources=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(n){class L{constructor(y){this._styles=y}get animated(){return this._styles.reduce((y,v)=>y||v.animated,!1)}isCompatible(y){if(!(y instanceof L)||this._styles.length!==
y._styles.length)return!1;const v=this._styles.length;for(let C=0;C<v;C++)if(!this._styles[C].isCompatible(y._styles[C]))return!1;return!0}async load(y,v){const C=await Promise.all(this._styles.map(S=>S.load(y,v)));return new F(C)}render(y,v,C){for(let S=0;S<this._styles.length;S++)this._styles[S].render(y,v,C.resources[S])}}class F{constructor(y){this.resources=y}attach(y){for(const v of this.resources)v.attach(y)}detach(){for(const y of this.resources)y.detach()}get ready(){return this.resources.reduce((y,
v)=>y&&v.ready,!0)}}n.Stack=L;n.StackResources=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(n,L,F,y,v,C){class S{constructor(p){this._params=p}get animated(){return 0<this._params.flowSpeed}isCompatible(p){return p instanceof
S?L.areStreamlinesCompatible(this._params,p._params):!1}async load(p,z){const {extent:I,size:A}=p;n.throwIfAborted(z);p=await this._params.loadImagery(I,A[0],A[1],this._params.timeExtent,z);const {vertexData:t,indexData:q}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,p,z);return new M(t,q,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(p,z,I){({context:p}=p);const {program:A}=I;p.setFaceCullingEnabled(!1);p.setBlendingEnabled(!0);
p.setBlendFunction(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);p.useProgram(A);A.setUniform1f("u_time",z.time);A.setUniform1f("u_trailLength",this._params.trailLength);A.setUniform1f("u_flowSpeed",this._params.flowSpeed);A.setUniform1f("u_featheringSize",this._params.featheringSize);A.setUniform1f("u_featheringOffset",this._params.featheringOffset);A.setUniform1f("u_introFade",this._params.introFade?1:0);A.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);A.setUniform1f("u_decayRate",
this._params.decayRate);A.setUniformMatrix3fv("u_dvsMat3",z.dvsMat3);A.setUniformMatrix3fv("u_displayViewMat3",z.displayViewMat3);L.setUniforms(A,"color","vec4",this._params.color);L.setUniforms(A,"opacity","float",this._params.opacity);L.setUniforms(A,"size","float",this._params.size);p.bindVAO(I.vertexArray);p.drawElements(y.PrimitiveType.TRIANGLES,I.indexCount,y.DataType.UNSIGNED_INT,0)}}const J=new Map;J.set("a_positionAndSide",0);J.set("a_timeInfo",1);J.set("a_extrude",2);J.set("a_speed",3);
const R={geometry:[new C.VertexElementDescriptor("a_positionAndSide",3,y.DataType.FLOAT,0,36),new C.VertexElementDescriptor("a_timeInfo",3,y.DataType.FLOAT,12,36),new C.VertexElementDescriptor("a_extrude",2,y.DataType.FLOAT,24,36),new C.VertexElementDescriptor("a_speed",1,y.DataType.FLOAT,32,36)]},T={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:J};class M{constructor(p,z,I){this._vertexData=p;this._indexData=z;this._values=I}attach(p){var {context:z}=p,I=F.BufferObject.createVertex(z,
y.Usage.STATIC_DRAW,this._vertexData);const A=F.BufferObject.createIndex(z,y.Usage.STATIC_DRAW,this._indexData);z=new v.VertexArrayObject(z,J,R,{geometry:I},A);I=[];"ramp"===this._values.color.kind&&I.push("vvColor");"ramp"===this._values.opacity.kind&&I.push("vvOpacity");"ramp"===this._values.size.kind&&I.push("vvSize");p=p.painter.materialManager.getProgram(T,I);this.vertexArray=z;this.program=p;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}
return S})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(n,L,F,y,v,C,S,J,R){function T(a,b){const e=z(b.data,b.width,b.height,a.smoothing);return a.interpolate?(g,d)=>{const f=Math.floor(g),h=Math.floor(d);if(0>f||f>=b.width||0>h||
h>=b.height)return[0,0];g-=f;d-=h;const k=f<b.width-1?f+1:f,m=h<b.height-1?h+1:h;return[(e[2*(h*b.width+f)]*(1-d)+e[2*(m*b.width+f)]*d)*(1-g)+(e[2*(h*b.width+k)]*(1-d)+e[2*(m*b.width+k)]*d)*g,(e[2*(h*b.width+f)+1]*(1-d)+e[2*(m*b.width+f)+1]*d)*(1-g)+(e[2*(h*b.width+k)+1]*(1-d)+e[2*(m*b.width+k)+1]*d)*g]}:(g,d)=>{g=Math.round(g);d=Math.round(d);return 0>g||g>=b.width||0>d||d>=b.height?[0,0]:[e[2*(d*b.width+g)],e[2*(d*b.width+g)+1]]}}function M(a,b,e,g,d,f,h,k,m){const r=[];let w=0,[u,B]=b(e,g);u*=
a.velocityScale;B*=a.velocityScale;r.push({x:e,y:g,t:w,speed:Math.sqrt(u*u+B*B)});for(let Q=0;Q<a.verticesPerLine;Q++){let [N,Y]=b(e,g);N*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(N*N+Y*Y);if(X<a.minSpeedThreshold)break;const da=N/X,ba=Y/X;e+=da*a.segmentLength;g+=ba*a.segmentLength;w+=a.segmentLength/X;if(Math.acos(da*E+ba*O)>a.maxTurnAngle)break;if(a.collisions){var E=Math.round(e*m);var O=Math.round(g*m);if(0>E||E>h-1||0>O||O>k-1)break;const aa=f[O*h+E];if(-1!==aa&&aa!==d)break;f[O*
h+E]=d}r.push({x:e,y:g,t:w,speed:X});E=da;O=ba}return r}function p(a,b,e,g){const d=[],f=new S,h=1/Math.max(a.lineCollisionWidth,1),k=Math.round(e*h),m=Math.round(g*h),r=new Int32Array(k*m);for(var w=0;w<r.length;w++)r[w]=-1;w=[];for(let u=0;u<g;u+=a.lineSpacing)for(let B=0;B<e;B+=a.lineSpacing)w.push({x:B,y:u,sort:f.getFloat()});w.sort((u,B)=>u.sort-B.sort);for(const {x:u,y:B}of w)f.getFloat()<a.density&&(e=M(a,b,u,B,d.length,r,k,m,h),2>e.length||d.push(e));return d}function z(a,b,e,g){if(0===g)return a;
const d=Math.round(3*g),f=Array(2*d+1);var h=0;for(var k=-d;k<=d;k++){var m=Math.exp(-k*k/(g*g));f[k+d]=m;h+=m}for(g=-d;g<=d;g++)f[g+d]/=h;h=new Float32Array(a.length);for(g=0;g<e;g++)for(k=0;k<b;k++){var r=m=0;for(var w=-d;w<=d;w++)if(!(0>k+w||k+w>=b)){var u=f[w+d];m+=u*a[2*(g*b+(k+w))];r+=u*a[2*(g*b+(k+w))+1]}h[2*(g*b+k)]=m;h[2*(g*b+k)+1]=r}a=new Float32Array(a.length);for(g=0;g<b;g++)for(k=0;k<e;k++){r=m=0;for(w=-d;w<=d;w++)0>k+w||k+w>=e||(u=f[w+d],m+=u*h[2*((k+w)*b+g)],r+=u*h[2*((k+w)*b+g)+1]);
a[2*(k*b+g)]=m;a[2*(k*b+g)+1]=r}return a}function I(a,b){const e=new S;var g=a.reduce((k,m)=>k+m.length,0);g=new Float32Array(4*g);const d=Array(a.length);let f=0,h=0;for(const k of a){a=f;for(const m of k)g[4*f]=m.x,g[4*f+1]=m.y,g[4*f+2]=m.t,g[4*f+3]=m.speed,f++;d[h++]={startVertex:a,numberOfVertices:k.length,totalTime:k[k.length-1].t,timeSeed:b?e.getFloat():0}}return{lineVertices:g,lineDescriptors:d}}function A(a,b){function e(E,O,Q,N,Y,X,da,ba){const aa=9*m;let ea=0;k[aa+ea++]=E;k[aa+ea++]=O;k[aa+
ea++]=1;k[aa+ea++]=Q;k[aa+ea++]=X;k[aa+ea++]=da;k[aa+ea++]=N/2;k[aa+ea++]=Y/2;k[aa+ea++]=ba;m++;k[aa+ea++]=E;k[aa+ea++]=O;k[aa+ea++]=-1;k[aa+ea++]=Q;k[aa+ea++]=X;k[aa+ea++]=da;k[aa+ea++]=-N/2;k[aa+ea++]=-Y/2;k[aa+ea++]=ba;m++}const {lineVertices:g,lineDescriptors:d}=a;var f=a=0;for(var h of d)a+=2*h.numberOfVertices,f+=6*(h.numberOfVertices-1);const k=new Float32Array(9*a);h=new Uint32Array(f);let m=0;a=0;for(const E of d){const {totalTime:O,timeSeed:Q}=E;let N=f=null,Y=null;var r=null,w=null,u=null;
for(let X=0;X<E.numberOfVertices;X++){r=g[4*(E.startVertex+X)];const da=g[4*(E.startVertex+X)+1],ba=g[4*(E.startVertex+X)+2],aa=g[4*(E.startVertex+X)+3];let ea=null,ka=null;var B=null;let c=null;0<X&&(ea=r-f,ka=da-N,B=Math.sqrt(ea*ea+ka*ka),ea/=B,ka/=B,1<X?(w=ea+w,u=ka+u,B=Math.sqrt(w*w+u*u),w/=B,u/=B,B=Math.min(1/(w*ea+u*ka),b),w*=B,u*=B,B=-u,c=w):(B=-ka,c=ea),null!==B&&null!==c&&(e(f,N,Y,B,c,O,Q,aa),h[a++]=m-2,h[a++]=m,h[a++]=m-1,h[a++]=m,h[a++]=m+1,h[a++]=m-1));f=r;N=da;Y=ba;w=ea;u=ka;r=aa}e(f,
N,Y,-u,w,O,Q,r)}return{vertexData:k,indexData:h}}function t(a){function b(x,G){var P=ba+ea,H=aa+ka,U=Math.sqrt(P*P+H*H);P/=U;H/=U;var W=ba*P+aa*H,K=ea+c,ca=ka+l;U=Math.sqrt(K*K+ca*ca);K/=U;ca/=U;var Z=ea*K+ka*ca;U=B;var ja=E,ia=O,ha=Q;H=-(H/W);P/=W;W=N;var la=Y,ma=X,na=da;ca=-(ca/Z);K/=Z;Z=16*w;let fa=0;for(const pa of[1,2])for(const qa of[1,2,3,4])m[Z+fa++]=U,m[Z+fa++]=ja,m[Z+fa++]=ia,m[Z+fa++]=ha,m[Z+fa++]=W,m[Z+fa++]=la,m[Z+fa++]=ma,m[Z+fa++]=na,m[Z+fa++]=pa,m[Z+fa++]=qa,m[Z+fa++]=x,m[Z+fa++]=
G,m[Z+fa++]=H/2,m[Z+fa++]=P/2,m[Z+fa++]=ca/2,m[Z+fa++]=K/2,w++;r[u++]=w-8;r[u++]=w-7;r[u++]=w-6;r[u++]=w-7;r[u++]=w-5;r[u++]=w-6;r[u++]=w-4;r[u++]=w-3;r[u++]=w-2;r[u++]=w-3;r[u++]=w-1;r[u++]=w-2}function e(x,G,P,H,U,W){ba=ea;aa=ka;ea=c;ka=l;null==ba&&null==aa&&(ba=ea,aa=ka);if(null!=N&&null!=Y){c=x-N;l=G-Y;const K=Math.sqrt(c*c+l*l);c/=K;l/=K}null!=ba&&null!=aa&&b(U,W);B=N;E=Y;O=X;Q=da;N=x;Y=G;X=P;da=H}function g(x,G){ba=ea;aa=ka;ea=c;ka=l;null==ba&&null==aa&&(ba=ea,aa=ka);null!=ba&&null!=aa&&b(x,
G)}const {lineVertices:d,lineDescriptors:f}=a;let h=a=0;for(var k of f){const x=k.numberOfVertices-1;a+=8*x;h+=12*x}const m=new Float32Array(16*a),r=new Uint32Array(h);let w=0,u=0,B,E,O,Q,N,Y,X,da,ba,aa,ea,ka,c,l;for(const x of f){l=c=ka=ea=aa=ba=da=X=Y=N=Q=O=E=B=null;const {totalTime:G,timeSeed:P}=x;for(k=0;k<x.numberOfVertices;k++)e(d[4*(x.startVertex+k)],d[4*(x.startVertex+k)+1],d[4*(x.startVertex+k)+2],d[4*(x.startVertex+k)+3],G,P);g(G,P)}return{vertexData:m,indexData:r}}function q(a,b){const e=
b.pixels,{width:g,height:d}=b,f=new Float32Array(g*d*2),h=b.mask||new Uint8Array(g*d*2);b.mask||h.fill(255);if("vector-uv"===a)for(a=0;a<g*d;a++)f[2*a]=e[0][a],f[2*a+1]=-e[1][a];else if("vector-magdir"===a)for(a=0;a<g*d;a++){b=e[0][a];const k=v.deg2rad(e[1][a]),m=Math.sin(k-Math.PI/2);f[2*a]=Math.cos(k-Math.PI/2)*b;f[2*a+1]=m*b}return{data:f,mask:h,width:g,height:d}}async function D(a,b,e,g,d,f){const h={requestProjectedLocalDirections:!0,signal:f};null!=d&&(h.timeExtent=d);if("imagery"===a.type)return await a.load({signal:f}),
d=a.rasterInfo.dataType,a=await a.fetchImage(b,e,g,h),null==a?.pixelData?.pixelBlock?{data:new Float32Array(e*g*2),mask:new Uint8Array(e*g),width:e,height:g}:q(d,a.pixelData.pixelBlock);await a.load({signal:f});d=a.serviceRasterInfo.dataType;a=await a.fetchPixels(b,e,g,h);return null==a?.pixelBlock?{data:new Float32Array(e*g*2),mask:new Uint8Array(e*g),width:e,height:g}:q(d,a.pixelBlock)}const V=()=>y.getLogger("esri.views.2d.engine.flow.dataUtils");n.createAnimatedLinesData=I;n.createFlowMesh=async function(a,
b,e,g){const d=performance.now();var f=T(b,e);const h=performance.now();e=p(b,f,e.width,e.height);b=performance.now();f=I(e,!0);e=performance.now();a="Streamlines"===a?A(f,10):t(f);f=performance.now();F("esri-2d-profiler")&&(V().info("I.1","_createFlowFieldFromData (ms)",Math.round(h-d)),V().info("I.2","_getStreamlines (ms)",Math.round(b-h)),V().info("I.3","createAnimatedLinesData (ms)",Math.round(e-b)),V().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(f-e)),V().info("I.5","createFlowMesh (ms)",
Math.round(f-d)),V().info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();C.throwIfAborted(g);return a};n.createParticlesMesh=t;n.createStreamlinesMesh=A;n.loadImagery=async function(a,b,e,g,d,f){const h=performance.now();var k=J.getInfo(b.spatialReference);if(!k)return e=await D(a,b,e,g,d,f),F("esri-2d-profiler")&&V().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-h)),F("esri-2d-profiler")&&V().info("I.9","Number of parts",
1),e;const [m,r]=k.valid,w=Math.ceil(b.width/(r-m)),u=b.width/w,B=Math.round(e/w);let E=b.xmin;const O=[];k=performance.now();for(let Q=0;Q<w;Q++){const N=new R({xmin:E,xmax:E+u,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});O.push(D(a,N,B,g,d,f));E+=u}a=await Promise.all(O);F("esri-2d-profiler")&&V().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-k));F("esri-2d-profiler")&&V().info("I.9","Number of parts",a.length);g={data:new Float32Array(e*g*2),mask:new Uint8Array(e*
g),width:e,height:g};b=0;for(const Q of a){for(a=0;a<Q.height;a++)for(d=0;d<Q.width;d++)b+d>=e||(g.data[2*(a*e+b+d)]=Q.data[2*(a*Q.width+d)],g.data[2*(a*e+b+d)+1]=Q.data[2*(a*Q.width+d)+1],g.mask[a*e+b+d]=Q.mask[a*Q.width+d]);b+=Q.width}F("esri-2d-profiler")&&V().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-h));return g};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums",
"../webgl/WGLContainer"],function(n,L,F){class y extends F{constructor(){super(...arguments);this.flowStyle=null}doRender(v){super.doRender(v)}prepareRenderPasses(v){const C=v.registerRenderPass({name:"flow",brushes:[n],target:()=>this.children,drawPhase:L.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(v),C]}}return y})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(n,
L,F){class y extends L{constructor(){super(...arguments);this._visualState={time:0,dvsMat3:n.create(),displayViewMat3:n.create()}}dispose(){}prepareState(v){({context:v}=v);v.setColorMask(!0,!0,!0,!0);v.setStencilFunction(F.CompareFunction.EQUAL,0,255)}draw(v,C){const {requestRender:S,allowDelayedRender:J}=v,{displayData:R}=C;if(null!=R&&("loaded"===R.state.name&&R.attach(v),"attached"===R.state.name)){var T=R.state.resources;J&&!T.ready&&null!=S?S():(this._visualState.time=v.time/1E3,this._visualState.dvsMat3=
C.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=v.state.displayViewMat3,R.flowStyle.render(v,this._visualState,T),R.flowStyle.animated&&null!=S&&S())}}}return y})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p,z,I){function A(t,q){const D=new M({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference});var V=t.xmax-t.xmin;const a=t.ymax-t.ymin,b=Math.abs(Math.cos(v.deg2rad(q))),e=Math.abs(Math.sin(v.deg2rad(q)));q=b*V+e*a;V=e*V+b*a;t=new I({xmin:D.x-q/2,ymin:D.y-V/2,xmax:D.x+q/2,ymax:D.y+V/2,spatialReference:t.spatialReference});t.centerAt(D);return t}L=class extends F{constructor(t){super(t);this._flowDisplayObject=new z.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){var {flowStyle:q}=this.flowContainer;if(null==q)this._clear();else{var {extent:D,rotation:V,resolution:a,pixelRatio:b}=t.state;t=A(D,V);t.expand(1.15);q=new p(q,t,[Math.round((t.xmax-t.xmin)/a),Math.round((t.ymax-t.ymin)/a)],b);if(null!=this._loading){if(this._loading.update(q))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(q)||(q.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},e=>{C.isAbortError(e)||(y.getLogger(this).error("A resource failed to load.",e),this._loading=null)}),this._loading=q)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};n.__decorate([S.property()],L.prototype,"_loading",void 0);
n.__decorate([S.property()],L.prototype,"flowContainer",void 0);n.__decorate([S.property()],L.prototype,"updating",null);return L=n.__decorate([T.subclass("esri.views.2d.engine.flow.FlowStrategy")],L)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(n){class L{constructor(F,y,v,C){this.state={name:"created"};this.flowStyle=F;this.extent=y;this.size=v;this.pixelRatio=C}async load(){const F=new AbortController;this.state={name:"loading",abortController:F};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},F.signal)}}attach(F){if("loaded"!==this.state.name)n.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var y=this.state.resources;y.attach(F);this.state={name:"attached",resources:y}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(F){if(!this.flowStyle.isCompatible(F.flowStyle)||!this.extent.equals(F.extent)||this.size[0]!==F.size[0]||this.size[1]!==F.size[1]||this.pixelRatio!==F.pixelRatio)return!1;this.flowStyle=F.flowStyle;return!0}}return L})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],function(n,L,F,y,v){class C extends v.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(S){this._displayData=S;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(S){var {displayData:J}=this;if(null!=J){var R=[0,0];S.toScreen(R,[J.extent.xmin,J.extent.ymax]);J=(J.extent.xmax-J.extent.xmin)/J.size[0]/S.resolution;var T=L.deg2rad(S.rotation),{displayViewScreenMat3:M}=this.transforms;F.fromTranslation(M,[-1,1,0]);F.scale(M,
M,[2/(S.size[0]*S.pixelRatio),-2/(S.size[1]*S.pixelRatio),1]);F.translate(M,M,[R[0],R[1],0]);F.rotate(M,M,T);F.scale(M,M,[J*S.pixelRatio,J*S.pixelRatio,1])}}_createTransforms(){return{displayViewScreenMat3:y.create()}}}n.FlowDisplayObject=C;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p,z,I,A,t,q){const D=F.ofType({key:"type",base:null,typeMap:{rect:A,path:q,geometry:t}});n.LayerView2DMixin=V=>{V=class extends V{constructor(){super(...arguments);this.attached=!1;this.clips=new D;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new v("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new z.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([C.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b)},C.syncAndInitial),C.watch(()=>this.updateSuspended,b=>{this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},C.syncAndInitial),C.watch(()=>this.layer?.opacity??
1,b=>{this.container&&(this.container.opacity=b)},C.syncAndInitial),C.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},C.syncAndInitial),C.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},C.syncAndInitial),C.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,C.syncAndInitial),C.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},C.syncAndInitial),C.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},C.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const a=this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(a){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const {minScale:e,maxScale:g}=b;return p.isInScaleRange(a,e,g)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
a),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(a)))}hitTest(a,b){return Promise.resolve(null)}supportsSpatialReference(a){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const a=super.getSuspendInfo(),b=!this.spatialReferenceSupported,e=this.visibleAtCurrentScale;b&&(a.spatialReferenceNotSupported=b);e&&(a.outsideScaleRange=e);return a}addAttachHandles(a){this.addHandles(a,"attach")}};
L.__decorate([S.property()],V.prototype,"attached",void 0);L.__decorate([S.property({type:D,set(a){a=y.referenceSetter(a,this._get("clips"),D);this._set("clips",a)}})],V.prototype,"clips",void 0);L.__decorate([S.property()],V.prototype,"container",void 0);L.__decorate([S.property()],V.prototype,"moving",void 0);L.__decorate([S.property({readOnly:!0})],V.prototype,"spatialReferenceSupported",null);L.__decorate([S.property({readOnly:!0})],V.prototype,"updateParameters",void 0);L.__decorate([S.property()],
V.prototype,"updateRequested",void 0);L.__decorate([S.property()],V.prototype,"updateSuspended",null);L.__decorate([S.property()],V.prototype,"updating",null);L.__decorate([S.property()],V.prototype,"view",void 0);L.__decorate([S.property({readOnly:!0})],V.prototype,"visibleAtCurrentScale",void 0);L.__decorate([S.property({type:I})],V.prototype,"highlightOptions",void 0);return V=L.__decorate([M.subclass("esri.views.2d.layers.LayerView2D")],V)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(n,L,F){function y(v,C){C=F.getMetersPerUnitForSR(C);return v/(C*F.inchesPerMeter*96)}n.getExtentForScale=function(v,C){const S=v.extent;v=v.width-(v.padding?v.padding.left+v.padding.right:0);C=y(C,S.spatialReference);return S.clone().expand(C*v/S.width)};n.getResolutionForScale=y;n.getResolutionInMetersForScale=function(v){return v/(96*F.inchesPerMeter)};n.getScale=function(v,C){C=
C||v.extent;v=v.width;const S=F.getMetersPerUnitForSR(C?.spatialReference);return C&&v?C.width/v*S*F.inchesPerMeter*96:0};n.getScaleForResolution=function(v,C){C=F.getMetersPerUnitForSR(C);return v*C*F.inchesPerMeter*96};n.isInScaleRange=function(v,C,S){if(C=0===C||L.floatEqualAbsolute(v,C)||v<C)C=0===S||L.floatEqualAbsolute(v,S)||v>S;return C};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(n,L,F,y,v,C,S){var J;F=J=class extends S{constructor(R){super(R);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new J({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};n.__decorate([L.property({type:[Number,String],json:{write:!0}})],F.prototype,"left",void 0);n.__decorate([L.property({type:[Number,String],
json:{write:!0}})],F.prototype,"right",void 0);n.__decorate([L.property({type:[Number,String],json:{write:!0}})],F.prototype,"top",void 0);n.__decorate([L.property({type:[Number,String],json:{write:!0}})],F.prototype,"bottom",void 0);return F=J=n.__decorate([C.subclass("esri.views.layers.support.ClipRect")],F)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(n,L,F,y,v,C,S){L=class extends L.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};n.__decorate([F.property({readOnly:!0})],L.prototype,"version",null);return L=n.__decorate([S.subclass("esri.views.layers.support.ClipArea")],L)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p){var z;L={base:J,key:"type",typeMap:{extent:M,polygon:p}};T=z=class extends T{constructor(I){super(I);this.type="geometry";this.geometry=null}clone(){return new z({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};n.__decorate([F.property({types:L,json:{read:R.fromJSON,write:!0}})],T.prototype,"geometry",void 0);return T=z=n.__decorate([S.subclass("esri.views.layers.support.Geometry")],T)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(n,L,F,y,v,C,S){F=class extends S{constructor(J){super(J);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};n.__decorate([L.property({type:[[[Number]]],json:{write:!0}})],F.prototype,"path",void 0);return F=n.__decorate([C.subclass("esri.views.layers.support.Path")],F)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./AGraphicContainer ../support/util".split(" "),
function(n,L,F,y,v,C,S,J,R){L=class extends J.AGraphicContainer{get hasHighlight(){return this.children.some(T=>T.hasData)}renderChildren(T){T.drawPhase===S.WGLDrawPhase.HIGHLIGHT&&(this.attributeView.update(),this.children.some(M=>M.hasData)&&(super.renderChildren(T),T.context.setColorMask(!0,!0,!0,!0),R.renderHighlight(T,!0,M=>{this._renderChildren(M,S.FeatureSelection.All)})))}};return L=n.__decorate([C.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],L)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p,z,I){F=class extends F{constructor(){super(...arguments);this.attached=!1;this.container=new p.Container;this.updateRequested=!1;this.type="imagery";this._bitmapView=new M.BitmapContainer}destroy(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(A){this.strategy.update(A).catch(t=>{v.isAbortError(t)||y.getLogger(this).error(t)})}hitTest(A){return new L({attributes:{},geometry:A.clone(),
layer:this.layer})}attach(){this.container.addChild(this._bitmapView);this.strategy=new I({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren();this.updateRequested=
!1}redraw(){this.strategy.updateExports(async A=>{const {source:t}=A;if(t&&!(t instanceof ImageBitmap)){var q=await this.layer.applyRenderer({extent:t.extent,pixelBlock:t.originalPixelBlock??t.pixelBlock});t.filter=D=>this.layer.pixelFilter?this.layer.applyFilter(D):{...q,extent:t.extent}}}).catch(A=>{v.isAbortError(A)||y.getLogger(this).error(A)})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;
var A=this.strategy.bitmaps;if(1===A.length&&A[0].source)return{extent:A[0].source.extent,pixelBlock:A[0].source.originalPixelBlock};if(1<A.length){const t=this.view.extent;A=A.map(q=>q.source).filter(q=>q.extent&&q.extent.intersects(t)).map(q=>({extent:q.extent,pixelBlock:q.originalPixelBlock}));A=T.mosaicPixelData(A,t);return null!=A?{extent:A.extent,pixelBlock:A.pixelBlock}:null}return null}async _fetchImage(A,t,q,D){D=D||{};D.timeExtent=this.timeExtent;D.requestAsImageElement=!0;D.returnImageBitmap=
!0;A=await this.layer.fetchImage(A,t,q,D);if(A.imageBitmap)return A.imageBitmap;D=await this.layer.applyRenderer(A.pixelData,{signal:D.signal});D=new z(D.pixelBlock,D.extent?.clone(),A.pixelData.pixelBlock);D.filter=V=>this.layer.applyFilter(V);return D}};n.__decorate([C.property()],F.prototype,"attached",void 0);n.__decorate([C.property()],F.prototype,"container",void 0);n.__decorate([C.property()],F.prototype,"layer",void 0);n.__decorate([C.property()],F.prototype,"strategy",void 0);n.__decorate([C.property()],
F.prototype,"timeExtent",void 0);n.__decorate([C.property()],F.prototype,"view",void 0);n.__decorate([C.property()],F.prototype,"updateRequested",void 0);n.__decorate([C.property()],F.prototype,"updating",null);n.__decorate([C.property()],F.prototype,"type",void 0);return F=n.__decorate([R.subclass("esri.views.2d.layers.imagery.ImageryView2D")],F)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(n,L,F){function y(a){return null!=
a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function v(a,b,e,g,d){const f=a.length;d=L.createEmptyBand(d,f);if(b)for(let h=0;h<f;h++)b[h]&&(d[h]=e[a[h]-g]);else for(b=0;b<f;b++)d[b]=e[a[b]-g];return d}function C(a,b,e,g){const d=null!=e&&2<=e.length?new Set(e):null;e=1===e?.length?e[0]:null;const f=!!b?.length;for(let h=0;h<a.length;h++)if(g[h]){const k=a[h];if(f){let m=!1;for(let r=0;r<b.length;r+=2)if(k>=b[r]&&k<=b[r+1]){m=!0;break}m||(g[h]=0)}g[h]&&(k===e||
d?.has(k))&&(g[h]=0)}}function S(a,b){const e=a[0].length;for(let g=0;g<e;g++)if(b[g]){let d=!1;for(let f=0;f<a.length;f++)if(a[f][g]){d=!0;break}d||(b[g]=0)}}function J(a,b){const e=a[0].length;for(let g=0;g<e;g++)if(b[g]){let d=!1;for(let f=0;f<a.length;f++)if(0===a[f][g]){d=!0;break}d&&(b[g]=0)}}function R(a,b,e,g,d,f,h,k){return{xmin:d<=e*a?0:d<e*a+a?d-e*a:a,ymin:f<=g*b?0:f<g*b+b?f-g*b:b,xmax:d+h<=e*a?0:d+h<e*a+a?d+h-e*a:a,ymax:f+k<=g*b?0:f+k<g*b+b?f+k-g*b:b}}function T(a,b,e,g,d,f){const {width:h,
height:k}=e.block,{x:m,y:r}=e.offset,{width:w,height:u}=e.mosaic;e=R(h,k,g,d,m,r,w,u);let B=0;var E=0;if(f){var O=f.hasGCSSShiftTransform?360:f.halfWorldWidth??0,Q=h*f.resolutionX;const N=f.startX+g*Q;N<O&&N+Q>O?E=f.rightPadding:N>=O&&(B=f.leftMargin-f.rightPadding,E=0)}e.xmax-=E;if("number"===typeof b)for(f=e.ymin;f<e.ymax;f++)for(E=(d*k+f-r)*w+(g*h-m)+B,O=e.xmin;O<e.xmax;O++)a[E+O]=b;else for(f=e.ymin;f<e.ymax;f++)for(E=(d*k+f-r)*w+(g*h-m)+B,O=f*h,Q=e.xmin;Q<e.xmax;Q++)a[E+Q]=b[O+Q]}function M(a,
b,e={}){const {clipOffset:g,clipSize:d,alignmentInfo:f,blockWidths:h}=e;if(h)return p(a,b,{blockWidths:h});var k=a.find(da=>y(da));if(null==k)return null;e=d?d.width:b.width;const m=d?d.height:b.height;var r=k.width,w=k.height;const u=b.width/r,B=b.height/w;b={offset:g||{x:0,y:0},mosaic:d||b,block:{width:r,height:w}};r=k.pixelType;var E=L.getPixelArrayConstructor(r);k=k.pixels.length;w=[];for(var O=0;O<k;O++){var Q=new E(e*m);for(var N=0;N<B;N++)for(var Y=0;Y<u;Y++){var X=a[N*u+Y];y(X)&&(X=X.pixels[O],
T(Q,X,b,Y,N,f))}w.push(Q)}E=a.some(da=>null==da||null!=da.mask&&0<da.mask.length);Q=a.some(da=>da?.bandMasks&&1<da.bandMasks.length);E=E?new Uint8Array(e*m):void 0;Q=Q?[]:void 0;if(E){for(O=0;O<B;O++)for(N=0;N<u;N++)Y=a[O*u+N],X=null!=Y?Y.mask:null,null!=X?T(E,X,b,N,O,f):Y?T(E,255,b,N,O,f):T(E,0,b,N,O,f);if(Q)for(O=0;O<k;O++){N=new Uint8Array(e*m);for(Y=0;Y<B;Y++)for(X=0;X<u;X++){const da=a[Y*u+X],ba=da?.bandMasks?.[O]??da?.mask;null!=ba?T(N,ba,b,X,Y,f):da?T(N,255,b,X,Y,f):T(N,0,b,X,Y,f)}Q.push(N)}}a=
new L({width:e,height:m,pixels:w,pixelType:r,bandMasks:Q,mask:E});a.updateStatistics();return a}function p(a,b,e){const g=a.find(N=>null!=N);if(null==g)return null;var d=a.some(N=>null!=N?!!N.mask:!0);const {width:f,height:h}=b;b=d?new Uint8Array(f*h):null;({blockWidths:e}=e);const k=[],m=g.getPlaneCount(),r=L.getPixelArrayConstructor(g.pixelType);if(d)for(let N=0,Y=0;N<a.length;Y+=e[N],N++)if(d=a[N],y(d)){var w=d.mask;for(var u=0;u<h;u++)for(var B=0;B<e[N];B++)b[u*f+B+Y]=null==w?255:w[u*d.width+
B]}w=(d=a.some(N=>N?.bandMasks&&1<N.bandMasks.length))?[]:void 0;u=f*h;for(B=0;B<m;B++){const N=new r(u),Y=d?new Uint8Array(u):void 0;for(let X=0,da=0;X<a.length;da+=e[X],X++){const ba=a[X];if(y(ba)){var E=ba.pixels[B];if(null!=E){for(var O=0;O<h;O++)for(var Q=0;Q<e[X];Q++)N[O*f+Q+da]=E[O*ba.width+Q];if(Y)for(E=ba.bandMasks?.[B]??ba.mask,O=0;O<h;O++)for(Q=0;Q<e[X];Q++)Y[O*f+Q+da]=E?E[O*ba.width+Q]:255}}}k.push(N);w&&Y&&w.push(Y)}a=new L({width:f,height:h,mask:b,bandMasks:w,pixels:k,pixelType:g.pixelType});
a.updateStatistics();return a}function z(a){if(!y(a))return null;const b=a.clone(),{width:e,height:g,pixels:d}=a;var f=d[0];const h=b.pixels[0];a=a.mask;for(let r=2;r<g-1;r++){const w=new Map;for(var k=r-2;k<r+2;k++)for(var m=0;4>m;m++){const u=k*e+m;t(w,f[u],a?a[u]:1)}h[r*e]=I(w);h[r*e+1]=h[r*e+2]=h[r*e];for(k=3;k<e-1;k++)m=(r-2)*e+k+1,t(w,f[m],a?a[m]:1),m=(r-1)*e+k+1,t(w,f[m],a?a[m]:1),m=r*e+k+1,t(w,f[m],a?a[m]:1),m=(r+1)*e+k+1,t(w,f[m],a?a[m]:1),m=(r-2)*e+k-3,A(w,f[m],a?a[m]:1),m=(r-1)*e+k-3,A(w,
f[m],a?a[m]:1),m=r*e+k-3,A(w,f[m],a?a[m]:1),m=(r+1)*e+k-3,A(w,f[m],a?a[m]:1),h[r*e+k]=I(w);h[r*e+k+1]=h[r*e+k]}for(f=0;f<e;f++)h[f]=h[e+f]=h[2*e+f],h[(g-1)*e+f]=h[(g-2)*e+f];b.updateStatistics();return b}function I(a){if(0===a.size)return 0;let b=0,e=-1,g=0;const d=a.keys();let f=d.next();for(;!f.done;)g=a.get(f.value),g>b&&(e=f.value,b=g),f=d.next();return e}function A(a,b,e){0!==e&&(e=a.get(b),1===e?a.delete(b):a.set(b,e-1))}function t(a,b,e){0!==e&&a.set(b,a.has(b)?a.get(b)+1:1)}function q(a,b,
e){let {x:g,y:d}=b;const {width:f,height:h}=e;if(0===g&&0===d&&h===a.height&&f===a.width)return a;const {width:k,height:m}=a;b=Math.max(0,d);const r=Math.max(0,g),w=Math.min(g+f,k),u=Math.min(d+h,m);if(0>w||0>u||!y(a))return null;g=Math.max(0,-g);d=Math.max(0,-d);var {pixels:B}=a,E=f*h,O=B.length;const Q=[];for(var N=0;N<O;N++){var Y=B[N],X=L.createEmptyBand(a.pixelType,E);for(let da=b;da<u;da++){const ba=da*k;let aa=(da+d-b)*f+g;for(let ea=r;ea<w;ea++)X[aa++]=Y[ba+ea]}Q.push(X)}B=new Uint8Array(E);
E=a.mask;for(O=b;O<u;O++)for(N=O*k,Y=(O+d-b)*f+g,X=r;X<w;X++)B[Y++]=E?E[N+X]:1;a=new L({width:e.width,height:e.height,pixelType:a.pixelType,pixels:Q,mask:B});a.updateStatistics();return a}function D(a,b=!0){if(!y(a))return null;const {pixels:e,width:g,height:d,mask:f,pixelType:h}=a;a=[];const k=Math.round(g/2),m=Math.round(d/2),r=d-1,w=g-1;for(var u=0;u<e.length;u++){var B=e[u],E=L.createEmptyBand(h,k*m),O=0;for(var Q=0;Q<d;Q+=2)for(var N=0;N<g;N+=2){var Y=B[Q*g+N];if(b){var X=N===w?Y:B[Q*g+N+1];
const da=Q===r?Y:B[Q*g+N+g],ba=N===w?da:Q===r?X:B[Q*g+N+g+1];E[O++]=(Y+X+da+ba)/4}else E[O++]=Y}a.push(E)}u=null;if(null!=f)for(u=new Uint8Array(k*m),B=0,E=0;E<d;E+=2)for(O=0;O<g;O+=2)Q=f[E*g+O],b?(N=O===w?Q:f[E*g+O+1],Y=E===r?Q:f[E*g+O+g],X=O===w?Y:E===r?N:f[E*g+O+g+1],u[B++]=Q*N*Y*X?1:0):u[B++]=Q;return new L({width:k,height:m,pixelType:h,pixels:a,mask:u})}function V(a,b,e,g,d=0){const {width:f,height:h}=a,{width:k,height:m}=b;a=g.cols;g=g.rows;b=Math.ceil(k/a-.1/a);const r=Math.ceil(m/g-.1/g);
let w,u,B,E,O;const Q=b*a;var N=Q*r*g;const Y=new Float32Array(N),X=new Float32Array(N),da=new Uint32Array(N),ba=new Uint32Array(N);let aa=0,ea,ka;for(let x=0;x<r;x++)for(let G=0;G<b;G++){var c=12*(x*b+G);N=e[c];w=e[c+1];u=e[c+2];B=e[c+3];E=e[c+4];O=e[c+5];for(var l=0;l<g;l++){aa=(x*g+l)*Q+G*a;ka=(l+.5)/g;for(let P=0;P<l;P++)ea=(P+.5)/a,Y[aa+P]=(N*ea+w*ka+u)*f+d,X[aa+P]=(B*ea+E*ka+O)*h+d,da[aa+P]=Math.floor(Y[aa+P]),ba[aa+P]=Math.floor(X[aa+P])}c+=6;N=e[c];w=e[c+1];u=e[c+2];B=e[c+3];E=e[c+4];O=e[c+
5];for(c=0;c<g;c++)for(aa=(x*g+c)*Q+G*a,ka=(c+.5)/g,l=c;l<a;l++)ea=(l+.5)/a,Y[aa+l]=(N*ea+w*ka+u)*f+d,X[aa+l]=(B*ea+E*ka+O)*h+d,da[aa+l]=Math.floor(Y[aa+l]),ba[aa+l]=Math.floor(X[aa+l])}return{offsets_x:Y,offsets_y:X,offsets_xi:da,offsets_yi:ba,gridWidth:Q}}n.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(n.NoDataInterpretation||(n.NoDataInterpretation={}));n.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(n.MissingBandAction||
(n.MissingBandAction={}));n.approximateTransform=function(a,b,e,g,d="nearest"){if(!y(a))return null;"majority"===d&&(a=z(a));const {pixels:f,mask:h,bandMasks:k,pixelType:m}=a,r=a.width;var w=a.height;const u=L.getPixelArrayConstructor(m),B=f.length,{width:E,height:O}=b;a=!1;for(var Q=0;Q<e.length;Q+=3)-1===e[Q]&&-1===e[Q+1]&&-1===e[Q+2]&&(a=!0);const {offsets_x:N,offsets_y:Y,offsets_xi:X,offsets_yi:da,gridWidth:ba}=V({width:r,height:w},b,e,g,"majority"===d?.5:0);let aa;b=(ka,c,l,x)=>{const G=ka instanceof
Float32Array||ka instanceof Float64Array?0:.5;for(let P=0;P<O;P++){aa=P*ba;for(let H=0;H<E;H++){if(0>N[aa]||0>Y[aa])ka[P*E+H]=0;else if(x)ka[P*E+H]=c[X[aa]+da[aa]*r];else{const U=Math.floor(N[aa]),W=Math.floor(Y[aa]),K=Math.ceil(N[aa]),ca=Math.ceil(Y[aa]),Z=N[aa]-U,ja=Y[aa]-W;ka[P*E+H]=!l||l[U+W*r]&&l[K+W*r]&&l[U+ca*r]&&l[K+ca*r]?(1-ja)*((1-Z)*c[U+W*r]+Z*c[K+W*r])+ja*((1-Z)*c[U+ca*r]+Z*c[K+ca*r])+G:c[X[aa]+da[aa]*r]}aa++}}};e=[];g=k?.length===B;w=[];for(Q=0;Q<B;Q++){if(g){var ea=new Uint8Array(E*
O);b(ea,k[Q],k[Q],!0);w.push(ea)}ea=new u(E*O);b(ea,f[Q],g?k[Q]:h,"nearest"===d||"majority"===d);e.push(ea)}d=new L({width:E,height:O,pixelType:m,pixels:e,bandMasks:g?w:void 0});if(null!=h)d.mask=new Uint8Array(E*O),b(d.mask,h,h,!0);else if(a)for(d.mask=new Uint8Array(E*O),a=0;a<E*O;a++)d.mask[a]=0>N[a]||0>Y[a]?0:1;d.updateStatistics();return d};n.clip=q;n.clipTile=function(a){const {pixelBlock:b,tileSize:e,level:g,row:d,col:f,useBilinear:h}=a;if(!y(b))return null;const {width:k,height:m}=e;var r=
2**g;a=r*k;r*=m;a=q(b,{y:d*r,x:f*a},{width:a,height:r});if(!a)return null;for(r=g;0<r;r--)a=D(a,h);return a};n.colorize=function(a,b){if(!y(a)||!b||!b.indexedColormap&&!b.indexed2DColormap)return a;const e=a.clone();var g=e.pixels;let d=e.mask;const f=e.width*e.height;if(1!==g.length)return a;const {indexedColormap:h,indexed2DColormap:k,offset:m,alphaSpecified:r}=b;a=0;g=g[0];b=new Uint8Array(g.length);const w=new Uint8Array(g.length),u=new Uint8Array(g.length);var B=0;if(h){const E=h.length-1;if(null!=
d)for(a=0;a<f;a++)d[a]&&(B=4*(g[a]-m),B<m||B>E?d[a]=0:(b[a]=h[B],w[a]=h[B+1],u[a]=h[B+2],d[a]=h[B+3]));else{d=new Uint8Array(f);for(a=0;a<f;a++)B=4*(g[a]-m),B<m||B>E?d[a]=0:(b[a]=h[B],w[a]=h[B+1],u[a]=h[B+2],d[a]=h[B+3]);e.mask=d}}else if(k)if(null!=d)for(a=0;a<f;a++)d[a]&&(B=k[g[a]],b[a]=B[0],w[a]=B[1],u[a]=B[2],d[a]=B[3]);else{d=new Uint8Array(f);for(a=0;a<f;a++)B=k[g[a]],b[a]=B[0],w[a]=B[1],u[a]=B[2],d[a]=B[3];e.mask=d}e.pixels=[b,w,u];e.statistics=null;e.pixelType="u8";e.maskIsAlpha=r;return e};
n.compositeBands=function(a){if(!a?.length||a.some(m=>!y(m)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:b,height:e,pixelType:g}=a[0];if(a.some(m=>m.width!==b||m.height!==e))return null;const d=a.map(({mask:m})=>m).filter(m=>null!=m);let f=null;d.length&&(f=new Uint8Array(b*e),f.set(d[0]),1<d.length&&J(d.slice(1),f));const h=[];a.forEach(({pixels:m})=>h.push(...m));const k=[];a.map(({statistics:m})=>m).filter(m=>m?.length).forEach(m=>k.push(...m));return new L({pixelType:g,
width:b,height:e,mask:f,pixels:h,statistics:k.length?k:null})};n.createColormapLUT=function(a){if(a){var b=a.colormap;if(b&&0!==b.length){b=b.sort((r,w)=>r[0]-w[0]);var e=0;0>b[0][0]&&(e=b[0][0]);var g=Math.max(256,b[b.length-1][0]-e+1),d=new Uint8Array(4*g),f=[],h=0,k=0,m=5===b[0].length;if(65536<g)return b.forEach(r=>{f[r[0]-e]=m?r.slice(1):r.slice(1).concat([255])}),{indexed2DColormap:f,offset:e,alphaSpecified:m};if(a.fillUnspecified)for(a=b[k],h=a[0]-e;h<g;h++)d[4*h]=a[1],d[4*h+1]=a[2],d[4*h+
2]=a[3],d[4*h+3]=m?a[4]:255,h===a[0]-e&&(a=k===b.length-1?a:b[++k]);else for(h=0;h<b.length;h++)a=b[h],k=4*(a[0]-e),d[k]=a[1],d[k+1]=a[2],d[k+2]=a[3],d[k+3]=m?a[4]:255;return{indexedColormap:d,offset:e,alphaSpecified:m}}}};n.createMaskLUT=function(a,b,e){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var g=a.includes("16")?65536:256;a=a.includes("s")?-g/2:0;g=new Uint8Array(g);if(b)for(let f=0;f<b.length;f++){var d=Math.ceil(b[2*f]-a);const h=Math.floor(b[2*f+1]-a);for(;d<=h;d++)g[d]=255}else g.fill(255);
if(e)for(b=0;b<e.length;b++)g[e[b]-a]=0;return{lut:g,offset:a}};n.createRemapLUT=function(a){const {srcPixelType:b,inputRanges:e,outputValues:g,allowUnmatched:d,noDataRanges:f,isLastInputRangeInclusive:h,outputPixelType:k}=a;if("u8"!==b&&"s8"!==b&&"u16"!==b&&"s16"!==b)return null;var m=b.includes("16")?65536:256;a=b.includes("s")?-m/2:0;const r=L.createEmptyBand(k,m);m=new Uint8Array(m);d&&m.fill(255);const [w,u]=F.getPixelValueRange(k);if(e?.length&&g?.length){var B=e.map(N=>N-1E-6);B[0]=e[0];h&&
(B[B.length-1]=e[e.length-1]);for(var E=0;E<B.length;E++){var O=g[E]>u?u:g[E]<w?w:g[E],Q=Math.ceil(B[2*E]-a);const N=Math.floor(B[2*E+1]-a);for(;Q<=N;Q++)r[Q]=O,m[Q]=255}}if(f?.length)for(B=0;B<f.length;B++)for(O=Math.ceil(f[2*B]-a),E=Math.floor(f[2*B+1]-a);O<=E;O++)m[O]=0;return{lut:r,offset:a,mask:m}};n.extractBands=function(a,b){return b?.length&&y(a)?a.extractBands(b):a};n.getClipBounds=R;n.getLocalArithmeticNorthRotations=function(a,b){const {coefficients:e,spacing:g}=b,{offsets_x:d,offsets_y:f,
gridWidth:h}=V(a,a,e,{rows:g[0],cols:g[1]}),{width:k,height:m}=a;a=new Float32Array(k*m);b=180/Math.PI;for(let u=0;u<m;u++)for(let B=0;B<k;B++){var r=u*h+B,w=0===u?r:r-h;const E=u===m-1?r:r+h;r=d[w]-d[E];w=f[E]-f[w];isNaN(r)||isNaN(w)?a[u*k+B]=90:(w=Math.atan2(w,r)*b,w=(360+w)%360,a[u*k+B]=w)}return a};n.interpolateOffsets=V;n.isValidPixelBlock=y;n.lookupBandValues=v;n.lookupPixels=function(a,b){if(!y(a))return null;const {pixels:e,mask:g}=a,d=e.length;let f=b.lut;const {offset:h}=b;f&&1===f[0].length&&
(f=e.map(()=>f));const k=[];b=b.outputPixelType||"u8";for(let m=0;m<d;m++){const r=v(e[m],g,f[m],h||0,b);k.push(r)}a=new L({width:a.width,height:a.height,pixels:k,mask:g,pixelType:b});a.updateStatistics();return a};n.mask=function(a,b){if(!y(a))return null;const {width:e,height:g,pixels:d}=a;var f=e*g;const h=new Uint8Array(f);a.mask?h.set(a.mask):h.fill(255);a=d.length;const {includedRanges:k,noDataValues:m,outputPixelType:r,matchAll:w,lookups:u}=b;if(u){f=[];for(b=0;b<a;b++){var B=u[b];B=v(d[b],
h,B.lut,B.offset||0,"u8");f.push(B)}1===f.length?h.set(f[0]):w?S(f,h):J(f,h)}else if(w){b=[];for(B=0;B<a;B++){const E=new Uint8Array(f);E.set(h);C(d[B],k?.slice(2*B,2*B+2),m?.[B],E);b.push(E)}1===b.length?h.set(b[0]):S(b,h)}else for(f=0;f<a;f++)C(d[f],k?.slice(2*f,2*f+2),m?.[f],h);return new L({width:e,height:g,pixelType:r,pixels:d,mask:h})};n.maxMapSizeGpu=6;n.mosaic=M;n.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var e=a.find(u=>u.pixelBlock);if(null==e?.pixelBlock)return null;
var g=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width;const d=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,f=.01*Math.min(g,d),h=a.sort((u,B)=>Math.abs(u.extent.ymax-B.extent.ymax)>f?B.extent.ymax-u.extent.ymax:Math.abs(u.extent.xmin-B.extent.xmin)>f?u.extent.xmin-B.extent.xmin:0);var k=Math.min.apply(null,h.map(u=>u.extent.xmin));const m=Math.min.apply(null,h.map(u=>u.extent.ymin)),r=Math.max.apply(null,h.map(u=>u.extent.xmax)),w=Math.max.apply(null,h.map(u=>u.extent.ymax));a={x:Math.round((b.xmin-
k)/g),y:Math.round((w-b.ymax)/d)};k={width:Math.round((r-k)/g),height:Math.round((w-m)/d)};g={width:Math.round((b.xmax-b.xmin)/g),height:Math.round((b.ymax-b.ymin)/d)};if(Math.round(k.width/e.pixelBlock.width)*Math.round(k.height/e.pixelBlock.height)!==h.length||0>a.x||0>a.y||k.width<g.width||k.height<g.height)return null;e=h.map(u=>u.pixelBlock);e=M(e,k,{clipOffset:a,clipSize:g});return{extent:b,pixelBlock:e}};n.remap=function(a,b){if(!y(a))return null;const {width:e,height:g}=a,{inputRanges:d,outputValues:f,
outputPixelType:h,noDataRanges:k,allowUnmatched:m,isLastInputRangeInclusive:r}=b;b=a.pixels[0];const w=L.createEmptyBand(h,b.length),u=a.mask,B=new Uint8Array(e*g);u?B.set(u):B.fill(255);const E=a.pixelType.startsWith("f")?1E-6:0;a=d.map(aa=>aa-E);a[0]=d[0];a[a.length-1]=d[d.length-1]+(r?1E-6:0);var O=d.length/2;const [Q,N]=F.getPixelValueRange(h);for(var Y=0;Y<g;Y++)for(var X=0;X<e;X++){var da=Y*e+X;if(B[da]){var ba=b[da];let aa=!1;for(let ea=O-1;0<=ea;ea--)if(ba===a[2*ea]||ba>a[2*ea]&&ba<a[2*ea+
1]){w[da]=f[ea];aa=!0;break}aa||(m?w[da]=ba>N?N:ba<Q?Q:ba:B[da]=0)}}if(a=k?.length)for(O=0;O<g;O++)for(Y=0;Y<e;Y++)if(X=O*e+Y,!u||u[X])for(da=b[X],ba=0;ba<a;ba+=2)if(da>=k[ba]&&da<=k[ba+1]){w[X]=0;B[X]=0;break}return new L({width:e,height:g,pixelType:h,pixels:[w],mask:B})};n.remapColor=function(a,b){if(!y(a))return null;a=a.clone();var {pixels:e}=a;const g=a.width*a.height,d=b.length,f=Math.floor(d/2),h=b[Math.floor(f)];e=e[0];let k,m,r,w,u,B,E=!1;const O=new Uint8Array(g),Q=new Uint8Array(g),N=new Uint8Array(g);
let Y=a.mask;const X=4===b[0].mappedColor.length;Y||(Y=new Uint8Array(g),Y.fill(X?255:1),a.mask=Y);for(u=0;u<g;u++)if(Y[u]){k=e[u];E=!1;B=f;m=h;r=0;for(w=d-1;1<w-r;){if(k===m.value){E=!0;break}k>m.value?r=B:w=B;B=Math.floor((r+w)/2);m=b[Math.floor(B)]}E||(k===b[r].value?(m=b[r],E=!0):k===b[w].value?(m=b[w],E=!0):k<b[r].value?(E=!1,m=null):k>b[r].value&&(k<b[w].value?(m=b[r],E=!0):w===d-1?(E=!1,m=null):(m=b[w],E=!0)));E?(O[u]=m.mappedColor[0],Q[u]=m.mappedColor[1],N[u]=m.mappedColor[2],Y[u]=m.mappedColor[3]):
O[u]=Q[u]=N[u]=Y[u]=0}a.pixels=[O,Q,N];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};n.resampleByMajority=z;n.setValidBoundary=function(a,b,e){if(!y(a))return null;const {width:g,height:d}=a,f=b.x;b=b.y;const h=e.width+f;e=e.height+b;if(0>f||0>b||h>g||e>d||0===f&&0===b&&h===g&&e===d)return a;a.mask||(a.mask=new Uint8Array(g*d));const k=a.mask;for(let m=0;m<d;m++){const r=m*g;for(let w=0;w<g;w++)k[r+w]=m<b||m>=e||w<f||w>=h?0:1}a.updateStatistics();return a};n.split=function(a,b,e=0,g=!0){if(!y(a))return null;
const {width:d,height:f}=b;let {width:h,height:k}=a;const m=new Map,r={x:0,y:0};e=1+e;for(let w=0;w<e;w++){const u=Math.ceil(h/d),B=Math.ceil(k/f);for(let E=0;E<B;E++){r.y=E*f;for(let O=0;O<u;O++){r.x=O*d;const Q=q(a,r,b);m.set(`${w}/${E}/${O}`,Q)}}w<e-1&&(a=D(a,g));h=Math.round(h/2);k=Math.round(k/2)}return m};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(n,L,F,y,v,C,S,J,R,T){var M;F=M=class extends F.JSONSupport{static createEmptyBand(p,z){return new (M.getPixelArrayConstructor(p))(z)}static combineBandMasks(p){if(2>p.length)return p[0];const z=p[0].length,I=(new Uint8Array(z)).fill(255);for(let A=0;A<p.length;A++){const t=p[A];for(let q=0;q<z;q++)t[q]||(I[q]=0)}return I}static getPixelArrayConstructor(p){let z;switch(p){case "u1":case "u2":case "u4":case "u8":z=Uint8Array;break;case "u16":z=Uint16Array;break;case "u32":z=Uint32Array;break;
case "s8":z=Int8Array;break;case "s16":z=Int16Array;break;case "s32":z=Int32Array;break;case "f32":z=Float32Array;break;case "f64":z=Float64Array;break;case "c64":case "c128":case "unknown":z=Float32Array}return z}constructor(p){super(p);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(p){if(!p)return"f32";p=p.toLowerCase();["u1","u2","u4"].includes(p)?p="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(p)||
(p="f32");return p}getPlaneCount(){return this.pixels?.length}addData(p){if(!p.pixels||p.pixels.length!==this.width*this.height)throw new L("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(p.pixels);this.statistics.push(p.statistics??new R.SimpleBandStatistics)}getAsRGBA(){const p=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(p);
break;default:this._fillFrom8Bit(p)}return new Uint8ClampedArray(p)}getAsRGBAFloat(){const p=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(p);return p}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(I=>this._calculateBandStatistics(I,this.mask));var p=this.mask,z=0;if(null!=p)for(let I=0;I<p.length;I++)p[I]&&z++;else z=this.width*this.height;this.validPixelCount=z}}clamp(p){if(p&&"f64"!==p&&"f32"!==p&&this.pixels){var [z,I]=T.getPixelValueRange(p),A=this.pixels,
t=this.width*this.height,q=A.length,D=[];for(let e=0;e<q;e++){var V=M.createEmptyBand(p,t);var a=A[e];for(let g=0;g<t;g++){var b=a[g];V[g]=b>I?I:b<z?z:b}D.push(V)}this.pixels=D;this.pixelType=p}}extractBands(p){const {pixels:z,statistics:I}=this;if(null==p||0===p.length||!z||0===z.length)return this;var A=z.length;const t=p.some(e=>e>=z.length),q=A===p.length&&!p.some((e,g)=>e!==g);if(t||q)return this;A=this.bandMasks?.length===A?p.map(e=>this.bandMasks[e]):void 0;let {mask:D,validPixelCount:V}=this;
const {width:a,height:b}=this;A?.length&&(D=M.combineBandMasks(A),V=D.filter(e=>!!e).length);return new M({pixelType:this.pixelType,width:a,height:b,mask:D,bandMasks:A,validPixelCount:V,maskIsAlpha:this.maskIsAlpha,pixels:p.map(e=>z[e]),statistics:I&&p.map(e=>I[e])})}clone(){const p=new M({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(p.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):
this.mask.slice(0));this.bandMasks&&(p.bandMasks=this.bandMasks.map(A=>new Uint8Array(A)));let z;const I=M.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){p.pixels=[];const A=!!this.pixels[0].slice;for(z=0;z<this.pixels.length;z++)p.pixels[z]=A?this.pixels[z].slice(0,this.pixels[z].length):new I(this.pixels[z])}if(this.statistics)for(p.statistics=[],z=0;z<this.statistics.length;z++)p.statistics[z]=y.clone(this.statistics[z]);p.premultiplyAlpha=this.premultiplyAlpha;
return p}_fillFrom8Bit(p){const {mask:z,maskIsAlpha:I,premultiplyAlpha:A,pixels:t}=this;if(p&&t?.length){var q,D;var V=q=D=t[0];3<=t.length?(q=t[1],D=t[2]):2===t.length&&(q=t[1]);var a=new Uint32Array(p),b=this.width*this.height;if(V.length!==b)v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=z&&z.length===b)if(I)for(p=0;p<b;p++){const e=z[p];if(e){const g=e/255;a[p]=A?e<<24|D[p]*g<<16|q[p]*g<<8|V[p]*g:e<<24|D[p]<<16|q[p]<<8|V[p]}}else for(p=
0;p<b;p++)z[p]&&(a[p]=-16777216|D[p]<<16|q[p]<<8|V[p]);else for(p=0;p<b;p++)a[p]=-16777216|D[p]<<16|q[p]<<8|V[p]}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(p){const {pixels:z,mask:I,statistics:A}=this;if(p&&z?.length){var t=this.pixelType,q=1,D=0;q=1;if(A&&0<A.length){for(var V of A)null!=V.minValue&&(D=Math.min(D,V.minValue)),null!=V.maxValue&&null!=V.minValue&&(q=Math.max(q,V.maxValue-V.minValue));q=255/q}else q=255,
"s8"===t?(D=-128,q=127):"u16"===t?q=65535:"s16"===t?(D=-32768,q=32767):"u32"===t?q=4294967295:"s32"===t?(D=-2147483648,q=2147483647):"f32"===t?(D=-3.4*1E39,q=3.4*1E39):"f64"===t&&(D=-Number.MAX_VALUE,q=Number.MAX_VALUE),q=255/(q-D);p=new Uint32Array(p);t=this.width*this.height;var a,b,e;V=a=b=z[0];if(V.length!==t)return v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=z.length)if(a=z[1],3<=z.length&&(b=z[2]),null!=I&&I.length===t)for(e=0;e<t;e++)I[e]&&
(p[e]=-16777216|(b[e]-D)*q<<16|(a[e]-D)*q<<8|(V[e]-D)*q);else for(e=0;e<t;e++)p[e]=-16777216|(b[e]-D)*q<<16|(a[e]-D)*q<<8|(V[e]-D)*q;else if(null!=I&&I.length===t)for(e=0;e<t;e++)a=(V[e]-D)*q,I[e]&&(p[e]=-16777216|a<<16|a<<8|a);else for(e=0;e<t;e++)a=(V[e]-D)*q,p[e]=-16777216|a<<16|a<<8|a}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(p){const {pixels:z,mask:I}=this;if(!p||!z?.length)return v.getLogger(this).error("getAsRGBAFloat()",
"Unable to convert to RGBA. The input pixel block is empty.");let A,t,q,D;A=t=q=z[0];3<=z.length?(t=z[1],q=z[2]):2===z.length&&(t=z[1]);const V=this.width*this.height;if(A.length!==V)return v.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=I&&I.length===V)for(D=0;D<V;D++)p[a++]=A[D],p[a++]=t[D],p[a++]=q[D],p[a++]=I[D]&1;else for(D=0;D<V;D++)p[a++]=A[D],p[a++]=t[D],p[a++]=q[D],p[a++]=1}_calculateBandStatistics(p,z){let I=Infinity,A=
-Infinity;const t=p.length;let q,D=0;if(null!=z)for(q=0;q<t;q++)z[q]&&(D=p[q],I=D<I?D:I,A=D>A?D:A);else for(q=0;q<t;q++)D=p[q],I=D<I?D:I,A=D>A?D:A;return new R.SimpleBandStatistics(I,A)}};n.__decorate([C.property({json:{write:!0}})],F.prototype,"width",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"height",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"pixelType",void 0);n.__decorate([S.cast("pixelType")],F.prototype,"castPixelType",null);n.__decorate([C.property({json:{write:!0}})],
F.prototype,"validPixelCount",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"mask",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"maskIsAlpha",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"pixels",void 0);n.__decorate([C.property()],F.prototype,"premultiplyAlpha",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"statistics",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"depthCount",void 0);n.__decorate([C.property({json:{write:!0}})],
F.prototype,"noDataValues",void 0);n.__decorate([C.property({json:{write:!0}})],F.prototype,"bandMasks",void 0);return F=M=n.__decorate([J.subclass("esri.layers.support.PixelBlock")],F)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(n){class L{constructor(F=null,y=null,v=null){this.minValue=F;this.maxValue=y;this.noDataValue=v}}n.SimpleBandStatistics=L;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],
function(n){function L(y){return F[y]??[-3.4028234663852886E38,3.4028234663852886E38]}const F={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};n.convertNoDataToMask=function(y,v,C){if(!(y.depthCount&&1<y.depthCount)){var {pixels:S,statistics:J,pixelType:R}=y,T=S[0].length,M=y.bandMasks??
[];T=y.mask??(new Uint8Array(T)).fill(255);var p="f32"===R||"f64"===R,z=L(R),I=!1;for(let q=0;q<S.length;q++){const D="number"===typeof v?v:v[q];if(null==D)continue;var A=J?.[q]?.maxValue??z[1];if((J?.[q]?.minValue??z[0])>D+Number.EPSILON||A<D-Number.EPSILON)continue;A=M[q]||T.slice();const V=S[q];var t=C?.customFloatTolerance;if(p&&0!==t){t||=9.999999E37<=Math.abs(D)?2E-7*Math.abs(D):"f32"===R?2**-23:Number.EPSILON;for(let a=0;a<V.length;a++)A[a]&&Math.abs(V[a]-D)<t&&(V[a]=0,A[a]=0,T[a]=0,I=!0)}else for(t=
0;t<V.length;t++)A[t]&&V[t]===D&&(V[t]=0,A[t]=0,T[t]=0,I=!0);M[q]=A}I&&(y.bandMasks=y.bandMasks||1<y.pixels.length?M:null,y.mask=T);I&&"updateStatistics"in y&&y.updateStatistics()}};n.getIntegerPixelType=function(y,v){return null==y||null==v?"s32":0>y?-128<=y&&128>v?"s8":-32768<=y&&32768>v?"s16":"s32":256>v?"u8":65536>v?"u16":"u32"};n.getPixelValueRange=L;n.isIntegerPixelType=function(y){return(y?.startsWith("s")||y?.startsWith("u"))??!1};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p,z,I,A){const t=R.create(),q=[0,0],D=new A(0,0,0,0);L=class extends L{constructor(V){super(V);this._imagePromise=null;this.bitmaps=[];this.hidpi=!1;this.imageMaxHeight=this.imageMaxWidth=2048;this.imageNormalizationSupported=this.imageRotationSupported=!1;this.update=y.debounce(async(a,b)=>{y.throwIfAborted(b);if(a.stationary&&!this.destroyed){var e=a.state,g=T.getInfo(e.spatialReference);a=this.hidpi?a.pixelRatio:1;var d=this.imageNormalizationSupported&&e.worldScreenWidth&&
e.worldScreenWidth<e.size[0],f=this.imageMaxWidth??0,h=this.imageMaxHeight??0;d?(q[0]=e.worldScreenWidth,q[1]=e.size[1]):this.imageRotationSupported?(q[0]=e.size[0],q[1]=e.size[1]):p.getOuterSize(q,e);g=g&&(e.extent.xmin<g.valid[0]||e.extent.xmax>g.valid[1]);var k=!this.imageNormalizationSupported&&g,m=!(Math.floor(q[0]*a)>f||Math.floor(q[1]*a)>h)&&!k,r=this.imageRotationSupported?e.rotation:0;g=this.container.children.slice();m?(d=d?e.paddedViewState.center:e.center,this._imagePromise&&console.error("Image promise was not defined!"),
this._imagePromise=this._singleExport(e,q,d,e.resolution,r,a,b)):(d=Math.min(f,h),k&&(d=Math.min(e.worldScreenWidth,d)),this._imagePromise=this._tiledExport(e,d,a,b));try{const w=await this._imagePromise??[];y.throwIfAborted(b);b=[];this._imagePromise=null;if(!this.destroyed){this.bitmaps=w;for(const u of g)w.includes(u)||b.push(u.fadeOut().then(()=>{u.remove();u.destroy()}));for(const u of w)b.push(u.fadeIn());await Promise.all(b)}}catch(w){this._imagePromise=null,y.throwIfAbortError(w)}}},5E3);
this.updateExports=y.debounce(async a=>{const b=[];for(const e of this.container.children){if(!e.visible||!e.stage)return;b.push(a(e).then(()=>{e.invalidateTexture();e.requestRender()}))}this._imagePromise=y.eachAlways(b).then(()=>this._imagePromise=null);await this._imagePromise})}destroy(){this.bitmaps.forEach(V=>V.destroy());this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(V,a,b,e,g,d){b=await this.fetchSource(V,Math.floor(a*g),Math.floor(b*g),{rotation:e,
pixelRatio:g,signal:d});y.throwIfAborted(d);const f=new z.Bitmap(null,!0);f.x=V.xmin;f.y=V.ymax;f.resolution=V.width/a;f.rotation=e;f.pixelRatio=g;f.opacity=0;this.container.addChild(f);await f.setSourceAsync(b,d);y.throwIfAborted(d);return f}async _singleExport(V,a,b,e,g,d,f){p.getBBox(t,b,e,a);V=R.toExtent(t,V.spatialReference);return[await this._export(V,a[0],a[1],g,d,f)]}_tiledExport(V,a,b,e){var g=M.create({size:a,spatialReference:V.spatialReference,scales:[V.scale]});const d=new I(g);g=d.getTileCoverage(V);
if(!g)return null;const f=[];g.forEach((h,k,m,r)=>{D.set(h,k,m,0);d.getTileBounds(t,D);const w=R.toExtent(t,V.spatialReference);f.push(this._export(w,a,a,0,b,e).then(u=>{0!==r&&(D.set(h,k,m,r),d.getTileBounds(t,D),u.x=t[0],u.y=t[3]);return u}))});return Promise.all(f)}};n.__decorate([v.property()],L.prototype,"_imagePromise",void 0);n.__decorate([v.property()],L.prototype,"bitmaps",void 0);n.__decorate([v.property()],L.prototype,"container",void 0);n.__decorate([v.property()],L.prototype,"fetchSource",
void 0);n.__decorate([v.property()],L.prototype,"hidpi",void 0);n.__decorate([v.property()],L.prototype,"imageMaxWidth",void 0);n.__decorate([v.property()],L.prototype,"imageMaxHeight",void 0);n.__decorate([v.property()],L.prototype,"imageRotationSupported",void 0);n.__decorate([v.property()],L.prototype,"imageNormalizationSupported",void 0);n.__decorate([v.property()],L.prototype,"requestUpdate",void 0);n.__decorate([v.property()],L.prototype,"updating",null);return L=n.__decorate([J.subclass("esri.views.2d.layers.support.ExportStrategy")],
L)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(n){const L=Math.PI/180;n.getBBox=function(F,y,v,C){const [S,J]=y,[R,T]=C;y=.5*v;F[0]=S-y*R;F[1]=J-y*T;F[2]=S+y*R;F[3]=J+y*T;return F};n.getOuterSize=function(F,y){var v=y.rotation*L;const C=Math.abs(Math.cos(v));v=Math.abs(Math.sin(v));const [S,J]=y.size;F[0]=Math.round(J*v+S*C);F[1]=Math.round(J*C+S*v);return F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p,z,I,A,t,q){y=class extends y{constructor(){super(...arguments);this.attached=!1;this.container=new t.RasterVFContainer;this.type="imageryVF";this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};this._fetchpixels=async(D,V,a,b)=>{const e=await this._projectFullExtentPromise,{symbolTileSize:g}=this.layer.renderer,{extent:d,width:f,height:h}=A.snapImageToSymbolTile(D,V,a,g,e);if(null!=e&&!e.intersects(D))return{extent:d,pixelBlock:null};D=
{bbox:`${d.xmin}, ${d.ymin}, ${d.xmax}, ${d.ymax}`,exportParametersVersion:this.layer.exportImageServiceParameters.version,symbolTileSize:g,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(D)&&(V=this.getPixelData(),null!=V&&`${V.extent.xmin}, ${V.extent.ymin}, ${V.extent.xmax}, ${V.extent.ymax}`===D.bbox))return V;({pixelData:b}=await this.layer.fetchImage(d,f,h,{timeExtent:this.timeExtent,requestAsImageElement:!1,signal:b}));this._dataParameters=D;b=b?.pixelBlock;if(null==
b)return{extent:d,pixelBlock:null};b="vector-uv"===this.layer.rasterInfo.dataType?A.convertVectorFieldData(b,"vector-uv"):b;return{extent:d,pixelBlock:b}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new q({container:this.container,fetchPixels:this._fetchpixels});this.addHandles(S.watch(()=>this.layer.renderer,D=>this._updateSymbolizerParams(D),S.syncAndInitial),"attach")}detach(){this._strategy.destroy();
this.container.children.forEach(D=>D.destroy());this.container.removeAllChildren();this.removeHandles("attach");this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const D=this.container.children[0]?.rawPixelData;if(this.updating||!D)return null;const {extent:V,pixelBlock:a}=D;return{extent:V,pixelBlock:a}}hitTest(D){return new L({attributes:{},geometry:D.clone(),layer:this.layer})}update(D){this._strategy.update(D,this._symbolizerParams).catch(V=>{C.isAbortError(V)||
v.getLogger(this).error(V)})}redraw(){const {renderer:D}=this.layer;D&&(this._updateSymbolizerParams(D),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(D){const V=this._dataParameters.time===D.time,a=this._dataParameters.symbolTileSize===D.symbolTileSize,b=this._dataParameters.bbox===D.bbox;return this._dataParameters.exportParametersVersion===D.exportParametersVersion&&V&&a&&b}async _getProjectedFullExtent(D){try{return I.projectExtent(this.layer.fullExtent,D)}catch(V){try{const a=
(await F(this.layer.url,{query:{option:"footprints",outSR:z.srToRESTValue(D),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return a?p.fromJSON(a):null}catch{return null}}}_updateSymbolizerParams(D){"vector-field"===D.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}};n.__decorate([J.property()],y.prototype,"attached",void 0);n.__decorate([J.property()],y.prototype,"container",void 0);n.__decorate([J.property()],y.prototype,"layer",
void 0);n.__decorate([J.property()],y.prototype,"timeExtent",void 0);n.__decorate([J.property()],y.prototype,"type",void 0);n.__decorate([J.property()],y.prototype,"view",void 0);n.__decorate([J.property()],y.prototype,"updating",null);return y=n.__decorate([M.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],y)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M,p){function z(c,l,x){return!S.canProjectWithoutEngine(c,l,x)}function I(c,l,x){if((c=z(c,l,x))&&!S.isLoaded())throw new y("rasterprojectionhelper-project","projection engine is not loaded");return c}function A(c,l,x){I(c.spatialReference,l);return x?S.getTransformation(l,c.spatialReference,c):S.getTransformation(c.spatialReference,l,c)}function t(c,l,x,G=null){const P=c.spatialReference;if(P.equals(l))return c;I(P,l,G);x=x.center;x=new R({xmin:x.x-c.x/2,xmax:x.x+c.x/
2,ymin:x.y-c.y/2,ymax:x.y+c.y/2,spatialReference:P});G=S.project(x,l,G);x=u(l);null==G||null!=x&&G.width>=x?(l=v.getMetersPerUnitForSR(P)/v.getMetersPerUnitForSR(l),c={x:c.x*l,y:c.y*l}):c={x:G.width,y:G.height};return c}function q(c,l=.01){return v.getMetersPerUnitForSR(c)?l/v.getMetersPerUnitForSR(c):0}function D(c,l,x=null,G=!0){const P=c.spatialReference;if(P.equals(l))return c;I(P,l,x);x=S.project(c,l,x);if(!G||!x)return x;V([c],[x],P,l);return x}function V(c,l,x,G){const P=B(x,!0),H=B(G,!0);
x=q(x,500);G=q(G,500);if(x&&null!=P&&null!=H)for(let U=0;U<c.length;U++){const W=l[U];if(!W)continue;const {x:K}=c[U],{x:ca}=W;ca>=H[1]-G&&Math.abs(K-P[0])<x?W.x-=H[1]-H[0]:ca<=H[0]+G&&Math.abs(K-P[1])<x&&(W.x+=H[1]-H[0])}}function a(c){const {inSR:l,outSR:x,datumTransformation:G,preferPE:P}=c;if(l.equals(x))return{points:c}=f(c,null),c;if(l.isWebMercator&&x.isWGS84||l.isWGS84&&x.isWebMercator){const {cols:K,rows:ca,xres:Z,yres:ja,usePixelCenter:ia,inSR:ha,outSR:la}=c;let {xmin:ma,ymax:na}=c;ia&&
(ma+=Z/2,na-=ja/2);c=[];const fa=[];var H=Math.max(K,ca);for(var U=0;U<H;U++){var W=S.project(new T({x:ma+Z*Math.min(K,U),y:na-ja*Math.min(ca,U),spatialReference:ha}),la);U<=K&&c.push(W.x);U<=ca&&fa.push(W.y)}H=[];for(U=0;U<K;U++)for(W=0;W<ca;W++)H.push([c[U],fa[W]]);return H}return I(l,x,G)&&P&&(l.isGeographic||null!=g(l))?e(c):b(c)}function b(c){var {points:l}=f(c,null);const {inSR:x,outSR:G,datumTransformation:P}=c;c=l.map(H=>new T(H[0],H[1],x));l=S.project(c,G,P);P&&V(c,l,x,G);return l.map(H=>
H?[H.x,H.y]:[NaN,NaN])}function e(c){const {inSR:l,outSR:x,datumTransformation:G}=c;var P=g(l);const {points:H,mask:U}=f(c,P);l.isGeographic||(c=l.wkid?C.PeFactory.coordsys(l.wkid):C.PeFactory.fromString(l.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,l.wkt2||l.wkt),C.PeCSTransformations.projToGeog(c,H.length,H));if(null!=G&&G.steps.length){var W;x.isGeographic&&(W=H.map(([K])=>179.9955<K?1:-179.9955>K?-1:0));G.steps.forEach(K=>{const ca=K.wkid?C.PeFactory.geogtran(K.wkid):C.PeFactory.fromString(C.PeDefs.PE_TYPE_GEOGTRAN,
K.wkt);C.PeGTTransformations.geogToGeog(ca,H.length,H,null,K.isInverse?C.PeDefs.PE_TRANSFORM_2_TO_1:C.PeDefs.PE_TRANSFORM_1_TO_2)});if(W)for(c=0;c<H.length;c++){P=W[c];const K=H[c][0],ca=179.9955<K?1:-179.9955>K?-1:0;P&&ca&&P!==ca&&(H[c][0]=0<P?K+360:K-360)}}x.isGeographic||(W=g(x,!0),h(H,null!=W&&W.isEnvelope?[W.bbox[1],W.bbox[3]]:[-90,90]),W=x.wkid?C.PeFactory.coordsys(x.wkid):C.PeFactory.fromString(x.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,x.wkt2||x.wkt),C.PeCSTransformations.geogToProj(W,
H.length,H));W=H;if(U&&H.length!==U.length){W=[];for(let K=0,ca=0;K<U.length;K++)U[K]?W.push(H[ca++]):W.push([NaN,NaN])}return W}function g(c,l=!1){var x=c.wkid||c.wkt2||c.wkt;if(!x||c.isGeographic)return null;x=String(x);if(ea.has(x))return x=ea.get(x),l?x?.gcs:x?.pcs;var G=c.wkid?C.PeFactory.coordsys(c.wkid):C.PeFactory.fromString(c.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,c.wkt2||c.wkt);c=q(c,1E-4);c=d(G,c);G=d(G,0,!0);ea.set(x,{pcs:c,gcs:G});return l?G:c}function d(c,l=0,x=
!1){var G=C.PePCSInfo.generate(c),P=x?c.horizonGcsGenerate():c.horizonPcsGenerate();if(!G||!P?.length)return null;c=!1;var H=P.find(Z=>1===Z.getInclusive()&&1===Z.getKind());if(!H){H=P.find(Z=>1===Z.getInclusive()&&0===Z.getKind());if(!H)return null;c=!0}x=x?0:(2===G.getNorthPoleLocation()?1:0)|(2===G.getSouthPoleLocation()?2:0);G=G.isPannableRectangle();H=H.getCoord();if(c)return{isEnvelope:c,isPannable:G,vertices:H,coef:null,bbox:[H[0][0]-l,H[0][1]-l,H[1][0]+l,H[1][1]+l],poleLocation:x};l=0;c=[];
let [U,W]=H[0],[K,ca]=H[0];for(let Z=0,ja=H.length;Z<ja;Z++){l++;l===ja&&(l=0);const [ia,ha]=H[Z],[la,ma]=H[l];if(ma===ha)c.push([ia,la,ha,ma,2]);else{P=(la-ia)/(ma-ha||1E-4);const na=ia-P*ha;ha<ma?c.push([P,na,ha,ma,0]):c.push([P,na,ma,ha,1])}U=U<ia?U:ia;W=W<ha?W:ha;K=K>ia?K:ia;ca=ca>ha?ca:ha}return{isEnvelope:!1,isPannable:G,vertices:H,coef:c,bbox:[U,W,K,ca],poleLocation:x}}function f(c,l){const x=[],{cols:G,rows:P,xres:H,yres:U,usePixelCenter:W}=c;let {xmin:K,ymax:ca}=c;W&&(K+=H/2,ca-=U/2);if(null==
l){for(c=0;c<G;c++)for(l=0;l<P;l++)x.push([K+H*c,ca-U*l]);return{points:x}}c=new Uint8Array(G*P);if(l.isEnvelope){const {bbox:[na,fa,pa,qa]}=l;for(let ra=0,sa=0;ra<G;ra++){var Z=K+H*ra,ja=l.isPannable||Z>=na&&Z<=pa;for(var ia=0;ia<P;ia++,sa++){var ha=ca-U*ia;ja&&ha>=fa&&ha<=qa&&(x.push([Z,ha]),c[sa]=1)}}return{points:x,mask:c}}Z=l.coef;l=[];for(ja=0;ja<P;ja++){var la=ca-U*ja;ia=[];ha=[];for(var ma=0;ma<Z.length;ma++){const [na,fa,pa,qa,ra]=Z[ma];la===pa&&pa===qa?(ia.push(na),ia.push(fa),ha.push(2),
ha.push(2)):la>=pa&&la<=qa&&(ia.push(na*la+fa),ha.push(ra))}la=ia;if(2<ia.length){ma=2===ha[0]?0:ha[0];let na=ia[0];la=[];for(let fa=1;fa<ha.length;fa++)if(2!==ha[fa]||fa===ha.length-1)ha[fa]!==ma&&(la.push(0===ma?Math.min(na,ia[fa-1]):Math.max(na,ia[fa-1])),ma=ha[fa],na=ia[fa]),fa===ha.length-1&&la.push(0===ha[fa]?Math.min(na,ia[fa]):Math.max(na,ia[fa]));la.sort((fa,pa)=>fa-pa)}else ia[0]>ia[1]&&(la=[ia[1],ia[0]]);l.push(la)}for(let na=0,fa=0;na<G;na++)for(Z=K+H*na,ja=0;ja<P;ja++,fa++)if(ia=ca-U*
ja,ha=l[ja],2===ha.length)Z>=ha[0]&&Z<=ha[1]&&(x.push([Z,ia]),c[fa]=1);else if(2<ha.length){la=!1;for(ma=0;ma<ha.length;ma+=2)if(Z>=ha[ma]&&Z<=ha[ma+1]){la=!0;break}la&&(x.push([Z,ia]),c[fa]=1)}return{points:x,mask:c}}function h(c,l){const [x,G]=l;for(l=0;l<c.length;l++){const P=c[l][1];if(P<x||P>G)c[l]=[NaN,NaN]}}function k(c,l){const x=u(c[0].spatialReference);if(2>c.length||null==x)return c[0];l=l??q(c[0].spatialReference);c=c.filter(W=>W.width>l);if(1===c.length)return c[0];let {xmin:G,xmax:P,
ymin:H,ymax:U}=c[0];for(let W=1;W<c.length;W++){const K=c[W];P=K.xmax+x*W;H=Math.min(H,K.ymin);U=Math.max(U,K.ymax)}return new R({xmin:G,xmax:P,ymin:H,ymax:U,spatialReference:c[0].spatialReference})}function m(c,l,x=null,G=!0){var P=c.spatialReference;if(P.equals(l))return c;var H=O(c);const U=u(P,!0);var W=u(l);if(0===H||null==U||null==W)return H=w(c,l,x,G),null==U&&null!=W&&Math.abs(H.width-W)<q(l)&&S.isLoaded()&&(P=g(P),null!=P&&P.poleLocation===da.None&&c.width<(P.bbox[2]-P.bbox[0])/2)?r(c,l)||
H:H;W=c.clone().normalize();if(1===W.length&&c.xmax<U&&c.xmax-U/2>q(P)){const {xmin:K,xmax:ca}=c;for(let Z=0;Z<=H;Z++)W[Z]=new R({xmin:0===Z?K:-U/2,xmax:Z===H?ca-U*Z:U/2,ymin:c.ymin,ymax:c.ymax,spatialReference:P})}c=W.map(K=>w(K,l,x,G));return k(c.filter(F.isSome))}function r(c,l){const x=u(l);if(null==x)return null;let {xmin:G,ymin:P,xmax:H,ymax:U}=c;var W=c.spatialReference;c=new M({spatialReference:W,rings:[[[G,P],[H,P],[H,U],[G,U],[G,P]]]});c=S.project(c,l);if(2!==c.rings.length||!c.rings[0].length||
!c.rings[1].length)return null;({rings:c}=c);W=q(W);l=new R({spatialReference:l});for(let K=0;2>K;K++){G=H=c[K][0][0];P=U=c[K][0][1];for(let ca=0;ca<c[K].length;ca++)G=G>c[K][ca][0]?c[K][ca][0]:G,H=H<c[K][ca][0]?c[K][ca][0]:H,P=P>c[K][ca][1]?c[K][ca][1]:P,U=U<c[K][ca][1]?c[K][ca][1]:U;if(0===K)l.ymin=P,l.ymax=U,l.xmin=G,l.xmax=H;else if(l.ymin=Math.min(l.ymin,P),l.ymax=Math.max(l.ymax,U),Math.abs(H-x/2)<W)l.xmin=G,l.xmax+=x;else if(Math.abs(G+x/2)<W)l.xmax=H+x;else return null}return l}function w(c,
l,x=null,G=!0,P=!0){const H=c.spatialReference;if(H.equals(l)||!l)return c;I(H,l,x);const U=S.project(c,l,x);if(P&&l.isWebMercator&&U&&(U.ymax=Math.min(2.0037508342787E7,U.ymax),U.ymin=Math.max(-2.0037508342787E7,U.ymin),U.ymin>=U.ymax))return null;if(!G||!U)return U;var W=B(H,!0);G=B(l,!0);if(null==W||null==G)return U;P=q(H,.001);const K=q(H,500);var ca=q(l,.001);if(Math.abs(U.xmin-G[0])<ca&&Math.abs(U.xmax-G[1])<ca){ca=Math.abs(c.xmin-W[0]);W=Math.abs(W[1]-c.xmax);if(ca<P&&W>K){U.xmin=G[0];var Z=
[];Z.push(new T(c.xmax,c.ymin,H));Z.push(new T(c.xmax,(c.ymin+c.ymax)/2,H));Z.push(new T(c.xmax,c.ymax,H));Z=Z.map(ja=>D(ja,l,x)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x);U.xmax=Math.max.apply(null,Z)}W<P&&ca>K&&(U.xmax=G[1],G=[],G.push(new T(c.xmin,c.ymin,H)),G.push(new T(c.xmin,(c.ymin+c.ymax)/2,H)),G.push(new T(c.xmin,c.ymax,H)),c=G.map(ja=>D(ja,l,x)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x),U.xmin=Math.min.apply(null,c))}else c=q(l,.001),Math.abs(U.xmin-G[0])<c&&(U.xmin=G[0]),Math.abs(U.xmax-G[1])<
c&&(U.xmax=G[1]);return U}function u(c,l=!1){return c?c.isWebMercator?2*(l?2.0037508342787E7:2.0037508342788905E7):c.wkid&&c.isGeographic?360:2*aa[c.wkid]||null:null}function B(c,l=!1){if(c.isGeographic)return[-180,180];c=u(c,l);return null!=c?[-c/2,c/2]:null}function E(c,l,x,G){c=(c-l)/x;0!==c-Math.floor(c)?c=Math.floor(c):G&&--c;return c}function O(c,l=!1){var x=u(c.spatialReference);if(null==x)return 0;const G=l?0:-(x/2),P=q(c.spatialReference),H=!l&&Math.abs(c.xmin+x/2)<P?-x/2:c.xmin;c=E(!l&&
Math.abs(c.xmax-x/2)<P?x/2:c.xmax,G,x,!0);x=E(H,G,x,!1);return c-x}function Q(c){const {projectedExtent:l,srcBufferExtent:x,pixelSize:G,datumTransformation:P,rasterTransform:H}=c;var U=l.spatialReference;const W=x.spatialReference;var K=I(U,W);const {xmin:ca,ymin:Z,xmax:ja,ymax:ia}=l,ha=u(W),la=null!=ha&&(c.hasWrapAround||"gcs-shift"===H?.type);c=c.spacing||[32,32];var ma=c[0]*G.x,na=c[1]*G.y;const fa=1===c[0],pa=Math.ceil((ja-ca)/ma-.1/c[0])+(fa?0:1),qa=Math.ceil((ia-Z)/na-.1/c[1])+(fa?0:1);ma=a({cols:pa,
rows:qa,xmin:ca,ymax:ia,xres:ma,yres:na,inSR:U,outSR:W,datumTransformation:P,preferPE:4>=c[0],usePixelCenter:fa});na=[];let ra,sa=0;const wa=fa?-1:NaN,{xmin:xa,xmax:va,ymax:ya,width:za,height:Aa}=x,Ba=q(W,500),Ca=null!=ha&&0<xa&&va>ha/2;var ta=!1;K&&(ta=g(U),ta=null!=ta&&0<ta.poleLocation);for(U=0;U<pa;U++){K=[];for(let ua=0;ua<qa;ua++){var oa=ma[U*qa+ua];la&&oa[0]>va&&oa[0]>ha/2-Ba?oa[0]-=ha:la&&0===U&&0>oa[0]&&Ca&&!H&&(oa[0]+=ha);!oa||isNaN(oa[0])||isNaN(oa[1])?(na.push(wa),na.push(wa),K.push(null),
sa++):(H&&(oa=H.inverseTransform(new T({x:oa[0],y:oa[1],spatialReference:W})),oa=[oa.x,oa.y]),K.push(oa),0<U&&la&&ra[ua]&&oa[0]<ra[ua][0]&&(oa[0]+=ha,ta&&oa[0]>va&&oa[0]>ha&&(oa[0]-=ha)),na.push((oa[0]-xa)/za),na.push((ya-oa[1])/Aa))}ra=K}return{offsets:na,error:null,coefficients:null,outofBoundPointCount:sa,spacing:c,size:fa?[pa,qa]:[pa-1,qa-1]}}function N(c,l,x){const {cols:G,rows:P}=l;l=new Float32Array((G-1)*(P-1)*12);const H=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),U=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let ia=0;ia<G-1;ia++){for(var W=0;W<P-1;W++){var K=ia*P*2+2*W,ca=c[K];const ha=c[K+1];var Z=c[K+2],ja=c[K+3];K+=2*P;const la=c[K],ma=c[K+1],na=c[K+2];K=c[K+3];let fa=0,pa=12*(W*(G-1)+ia);for(let qa=0;3>qa;qa++)l[pa++]=H[fa++]*ca+H[fa++]*Z+H[fa++]*na;fa=0;for(Z=0;3>Z;Z++)l[pa++]=H[fa++]*ha+H[fa++]*ja+H[fa++]*K;fa=0;for(ja=0;3>ja;ja++)l[pa++]=U[fa++]*ca+U[fa++]*la+U[fa++]*na;fa=0;for(ca=0;3>ca;ca++)l[pa++]=U[fa++]*ha+U[fa++]*ma+U[fa++]*K}if(x)for(W=0;W<l.length;W++)isNaN(l[W])&&
(l[W]=-1)}return l}function Y(c,l){c=c.clone().normalize();return 1===c.length?c[0]:k(c,l)}function X(c,l){const {pixelSize:x,extent:G}=c;c=A(G,l,!1);const P=Y(G,(x.x+x.y)/16);return m(P,l,c)}var da;(function(c){c[c.None=0]="None";c[c.North=1]="North";c[c.South=2]="South";c[c.Both=3]="Both"})(da||={});const ba=(c,l,x,G=0)=>{if(1===x[0])return[0,0];var P=1,H=-1,U=1,W=-1;for(var K=0;K<c.length;K+=2)isNaN(c[K])||(P=P>c[K]?c[K]:P,H=H>c[K]?H:c[K],U=U>c[K+1]?c[K+1]:U,W=W>c[K+1]?W:c[K+1]);const {cols:ca,
rows:Z}=l;l=(H-P)/ca/x[0];x=(W-U)/Z/x[1];G*=2;U=0;W=!1;P=[0,0];for(H=0;H<ca-3;H++){for(K=0;K<Z-3;K++){var ja=H*Z*2+2*K;const ia=Math.abs(((c[ja]+c[ja+4]+c[ja+4*Z]+c[ja+4*Z+4])/4-c[ja+2*Z+2])/l);ja=Math.abs(((c[ja+1]+c[ja+5]+c[ja+4*Z+1]+c[ja+4*Z+5])/4-c[ja+2*Z+3])/x);ia+ja>U&&(U=ia+ja,P=[ia,ja]);if(G&&U>G){W=!0;break}}if(W)break}return P},aa={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7},ea=new Map,ka=new Map;n.computeProjectedScales=function(c,l,x){var G=x?.tileSize??512,P=x?.alignGlobalDatasetWithAGOL??!0,H=!!x?.limitToSrcResolution;const {extent:U,spatialReference:W,pixelSize:K}=c;x=t(new T({x:K.x,y:K.y,spatialReference:W}),l,U);if(null==x)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ca=(x.x+x.y)/2,Z=v.getMetersPerUnitForSR(l);var ja=ca*Z*96*39.37,ia=l.isGeographic?256/G*2.958287637958547E8:
256/G*5.91657527591555E8,ha="vector-magdir"===c.dataType||"vector-uv"===c.dataType,la=X(c,l),ma=Math.min(Math.ceil(Math.log(Math.min(c.width,c.height)/32)/Math.LN2),Math.ceil(Math.log(ia/2/ja)/Math.LN2));if(!ha&&P&&(l.isGeographic||l.isWebMercator)&&(P=u(l),ha=0<O(la)||null!=P&&la.width>P/4,!ha&&null!=P)){ha=-1;if(3>ma)ha=2**ma*ca*G;else if(c.storageInfo){const {maximumPyramidLevel:na=0,pyramidScalingFactor:fa=2}=c.storageInfo;ha=fa**na*ca*G}G=Math.ceil(P/ha);ha=1===G||2===G&&P/2-la.xmax<ha}G=ja;
c=Math.min(2,Math.max(1.414,c.storageInfo?.pyramidScalingFactor||2));if(ha)G=ia,ia=l.isGeographic?1.341104507446289E-6:.29858214164761665,ma=96*ia*Z*39.37,l=t(new T({x:ia,y:ia,spatialReference:{wkid:l.isGeographic?4326:3857}}),W,la),l.x*=G/ma,l.y*=G/ma;else{l={x:K.x,y:K.y};for(la=0;G<.5005*ia&&la<ma;)la++,G*=c,l.x*=c,l.y*=c;1.001>=Math.max(G,ia)/Math.min(G,ia)&&(G=ia)}ia=[G];la=[{x:l.x,y:l.y}];for(ja=Math.min(70.5310735,ja)/1.001;G>=ja;)G/=c,l.x/=c,l.y/=c,ia.push(G),la.push({x:l.x,y:l.y});if(H){const na=
.001*K.x;H=la.findIndex(fa=>fa.x>=K.x-na&&fa.x<=K.x+na);-1<H?(la.length=H+1,ia.length=H+1):(H=la.findIndex(fa=>fa.x<=K.x+na),0<H&&(la.length=H,ia.length=H))}return{projectedPixelSize:x,scales:ia,srcResolutions:la,isCustomTilingScheme:!ha}};n.defaultGridSpacing=32;n.defaultProjectionToleranceInPixels=4;n.getDefaultDatumTransformationForDataset=A;n.getProjectedGridPoints=a;n.getProjectionOffsetGrid=function(c){var l=c.isAdaptive&&null==c.spacing;let x=c.spacing||[32,32],G=Q(c);var P={cols:G.size[0]+
1,rows:G.size[1]+1};const H=0<G.outofBoundPointCount&&G.outofBoundPointCount<G.offsets.length/2;let U=G.outofBoundPointCount===G.offsets.length/2||l&&H?[0,0]:ba(G.offsets,P,x,4);const W=(U[0]+U[1])/2;var K=c.projectedExtent.spatialReference;const ca=c.srcBufferExtent.spatialReference;l&&(H||4<W)&&(z(K,ca,c.datumTransformation)&&(K.isGeographic||null!=g(K)),x=[4,4],G=Q({...c,spacing:x}),P={cols:G.size[0]+1,rows:G.size[1]+1},U=ba(G.offsets,P,x,4));G.error=U;1<x[0]&&(G.coefficients=N(G.offsets,P,H));
!c.includeGCSGrid||K.isGeographic||K.isWebMercator||(ca.isGeographic?G.gcsGrid={offsets:G.offsets,coefficients:G.coefficients,spacing:x}:(l=g(K),null==l||l.isEnvelope||(K&&!K.isGeographic&&(l=String(K.wkid||K.wkt2||K.wkt),ka.has(l)?K=ka.get(l):(K=(K.wkid?C.PeFactory.coordsys(K.wkid):C.PeFactory.fromString(C.PeDefs.PE_TYPE_PROJCS,K.wkt2||K.wkt)).getGeogcs().getCode(),ka.set(l,K)),K=new p({wkid:K})),K=m(c.projectedExtent,K),{offsets:c}=Q({...c,srcBufferExtent:K,spacing:x}),P=N(c,P,H),G.gcsGrid={offsets:c,
coefficients:P,spacing:x})));return G};n.getRasterDatasetAlignmentInfo=function(c){const l=c.storageInfo.origin.x;var x=u(c.spatialReference,!0);if(null==x)return{originX:l,halfWorldWidth:null,pyramidsInfo:null};const G=x/2,{nativePixelSize:P,storageInfo:H,extent:U}=c,{maximumPyramidLevel:W,blockWidth:K,pyramidScalingFactor:ca}=H;let Z=P.x;const ja=[];c=null!=c.transform&&"gcs-shift"===c.transform.type;const ia=l+(c?0:G);x=c?x-l:G-l;for(let ha=0;ha<=W;ha++){const la=(U.xmax-l)/Z/K,ma=x/Z/K;ja.push({resolutionX:Z,
blockWidth:K,datasetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ma-Math.floor(ma)?ma:Math.ceil(ma),leftMargin:Math.round(ia/Z)%K,rightPadding:(K-Math.round(x/Z)%K)%K,originColumnOffset:Math.floor(ia/Z/K)});Z*=ca}return{originX:l,halfWorldWidth:G,pyramidsInfo:ja,hasGCSSShiftTransform:c}};n.getWorldWidth=u;n.getWorldWrapCount=O;n.load=async function(){S.isLoaded()||await S.load()};n.minimumGridSpacing=4;n.projectDatasetExtent=X;n.projectExtent=m;n.projectPoint=
D;n.projectPolygon=function(c,l,x){if("extent"===c.type){const {xmin:G,ymin:P,xmax:H,ymax:U,spatialReference:W}=c;c=new M({rings:[[[G,U],[H,U],[H,P],[G,P],[G,U]]],spatialReference:W})}if(c.spatialReference.equals(l))return c;I(c.spatialReference,l,x);return S.project(c,l,x)};n.projectResolution=t;n.requirePE=z;n.shiftExtent=function(c){var {spatialReference:l}=c;l=J.getInfo(l);if(!l)return c;const [x,G]=l.valid;l=G-x;let P=0;c.xmin<x?P=Math.ceil((x-c.xmin)/l):c.xmin>G&&(P=-Math.ceil((c.xmin-G)/l));
return new R({spatialReference:c.spatialReference,xmin:c.xmin+P*l,ymin:c.ymin,xmax:c.xmax+P*l,ymax:c.ymax})};n.snapExtent=Y;n.snapPyramid=function(c,l,x){const {storageInfo:G,pixelSize:P}=l;var H=0;let U=!1;var {pyramidResolutions:W}=G,K="mixed"===G.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,G.tileInfo.dpi/96)):1;K=(c.x+c.y)/2/K;if(null!=W&&W.length){c=W[W.length-1];c=(c.x+c.y)/2;var ca=(P.x+P.y)/2;if(K<=ca)H=0;else if(K>=c)H=W.length,U=8<K/c;else{c=ca;for(let Z=1;Z<=W.length;Z++){ca=(W[Z-
1].x+W[Z-1].y)/2;if(K<=ca){K===ca?H=Z:"down"===x?(H=Z-1,U=8<K/c):H="up"===x?Z:K-c>ca-K||2<K/c?Z:Z-1;break}c=ca}}x=0===H?P:W[H-1];U&&(W=Math.min(x.x,x.y),K=v.getMetersPerUnitForSR(l.spatialReference),19567<W*K&&(U=!1));return{pyramidLevel:H,pyramidResolution:new T({x:x.x,y:x.y,spatialReference:l.spatialReference}),excessiveReading:U}}H=Math.log(c.x/P.x)/Math.LN2;K=Math.log(c.y/P.y)/Math.LN2;W=l.storageInfo.maximumPyramidLevel||0;H="down"===x?Math.floor(Math.min(H,K)):"up"===x?Math.ceil(Math.max(H,
K)):Math.round((H+K)/2);0>H?H=0:H>W&&(U=H>W+3,H=W);x=2**H;l=new T({x:x*l.nativePixelSize.x,y:x*l.nativePixelSize.y,spatialReference:l.spatialReference});return{pyramidLevel:H,pyramidResolution:l,excessiveReading:U}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(n,L,F,y){function v(d,f){return t.get(d)/t.get(f)||1}function C(d,f="geographic"){const [h,
k]=d;d=Math.sqrt(h*h+k*k);let m=Math.atan2(k,h)*q;m=(360+m)%360;"geographic"===f&&(m=(450-m)%360);return[d,m]}function S(d,f="geographic"){let h=d[1];"geographic"===f&&(h=(450-h)%360);h%=360;d=d[0];return[d*Math.cos(h/q),d*Math.sin(h/q)]}function J(d,f,h="geographic",k=1){if(!y.isValidPixelBlock(d))return d;const {pixels:m,width:r,height:w}=d;var u=r*w;const B=m[0],E=m[1],O=d.pixelType.startsWith("f")?d.pixelType:"f32",Q=F.createEmptyBand(O,u);u=F.createEmptyBand(O,u);let N=0;for(let Y=0;Y<w;Y++)for(let X=
0;X<r;X++)"vector-uv"===f?([Q[N],u[N]]=C([B[N],E[N]],h),Q[N]*=k):([Q[N],u[N]]=S([B[N],E[N]],h),Q[N]*=k,u[N]*=k),N++;d=new F({pixelType:O,width:d.width,height:d.height,mask:d.mask,validPixelCount:d.validPixelCount,maskIsAlpha:d.maskIsAlpha,pixels:[Q,u]});d.updateStatistics();return d}function R(d=0,f=0,h=Math.PI,k=!0){k&&(h=(2*Math.PI-h)%(2*Math.PI));k=k?-1:1;const m=-7*k,r=-2*k,w=-16*k,[u,B]=M(0,f+13*k,h,21.75),[E,O]=M(d-5.5,f+m,h,21.75),[Q,N]=M(d+5.5,f+m,h,21.75),[Y,X]=M(d-1.5,f+r,h,21.75),[da,ba]=
M(d+1.5,f+r,h,21.75),[aa,ea]=M(d-1.5,f+w,h,21.75),[ka,c]=M(d+1.5,f+w,h,21.75);return[u,B,E,O,Y,X,da,ba,Q,N,aa,ea,ka,c]}function T(d=0,f=Math.PI,h=!0){h&&(f=(2*Math.PI-f)%(2*Math.PI));var k=h?-1:1,m=5*k;const r=20*k,w=25*k;k*=2;const u=h?1:-1;h=5*u;let [B,E]=[0+h,0-r],[O,Q]=[B+2*u,E],[N,Y]=[O-0*u,Q+k],[X,da]=[0-h,0-w],[ba,aa]=[X+0*u,da-k],ea=Math.ceil(d/5),ka=Math.floor(ea/10);ea-=8*ka;d=[];const c=[];for(let ca=0;ca<ea/2;ca++,ka--){0>=ka&&1===ea%2&&ca===(ea-1)/2&&(X=0,ba=X+0*u,da=(da+E)/2,aa=da-k);
const [Z,ja]=M(X,da,f,45);if(0<ka){const [ia,ha]=M(O,da,f,45),[la,ma]=M(B,E,f,45);d.push(ia);d.push(ha);d.push(Z);d.push(ja);d.push(la);d.push(ma)}else{const [ia,ha]=M(O,Q,f,45),[la,ma]=M(N,Y,f,45),[na,fa]=M(ba,aa,f,45);c.push(Z);c.push(ja);c.push(na);c.push(fa);c.push(la);c.push(ma);c.push(ia);c.push(ha)}da+=m;E+=m;Q+=m;Y+=m;aa+=m}const [l,x]=M(0+h,0+r,f,45);m=7*u;const [G,P]=M(0+m,0+r,f,45),[H,U]=M(0+h,0-w,f,45),[W,K]=M(0+m,0-w,f,45);return{pennants:d,barbs:c,shaft:[l,x,G,P,H,U,W,K]}}function M(d,
f,h,k=1){return[Math.sqrt(d*d+f*f)/k,(2*Math.PI+(2*Math.PI+Math.atan2(f,d))%(2*Math.PI)-h)%(2*Math.PI)]}function p(d,f,h,k){h=v(k||"knots",h);for(k=1;k<f.length;k++)if(k===f.length-1){if(d<f[k]*h)break}else if(d<=f[k]*h)break;return Math.min(k-1,f.length-2)}function z(d,f,h,k,m){let r=0;switch(f){case "beaufort_kn":r=p(d,a,"knots",h);break;case "beaufort_km":r=p(d,a,"kilometer-per-hour",h);break;case "beaufort_ft":r=p(d,a,"feet-per-second",h);break;case "beaufort_m":r=p(d,a,"meter-per-second",h);
break;case "classified_arrow":r=p(d,m??[],k,h);break;case "ocean_current_m":r=p(d,b,"meter-per-second",h);break;case "ocean_current_kn":r=p(d,e,"knots",h)}return r}function I(d,f){const {style:h,inputUnit:k,outputUnit:m,breakValues:r}=f,w=D.fromJSON(k),u=D.fromJSON(m);let B=0,E=0;const {width:O,height:Q,mask:N}=d,Y=d.pixels[0];d=d.pixels[1];var X=null!=N?N.filter(aa=>0<aa).length:O*Q;const da=new Float32Array(42*X);X=new Uint32Array(15*X);f=f.invertDirection?R(0,0,0,!1):V;for(let aa=0;aa<Q;aa++)for(let ea=
0;ea<O;ea++){var ba=aa*O+ea;if(!N||N[aa*O+ea]){const ka=(d[ba]+360)%360/180*Math.PI,c=z(Y[ba],h,w,u,r);for(let l=0;l<f.length;l+=2)da[B++]=(ea+.5)/O,da[B++]=(aa+.5)/Q,da[B++]=f[l],da[B++]=f[l+1]+ka,da[B++]=c,da[B++]=Y[ba];ba=7*(B/42-1);X[E++]=ba;X[E++]=ba+1;X[E++]=ba+2;X[E++]=ba+0;X[E++]=ba+4;X[E++]=ba+3;X[E++]=ba+0;X[E++]=ba+2;X[E++]=ba+3;X[E++]=ba+2;X[E++]=ba+5;X[E++]=ba+3;X[E++]=ba+5;X[E++]=ba+6;X[E++]=ba+3}}return{vertexData:da,indexData:X}}function A(d,f){let h=0,k=0;const {width:m,height:r,
mask:w}=d;d=d.pixels[0];const u=[],B=[];var E=D.fromJSON(f.inputUnit);E=v(E,"knots");f="wind_speed"===f.style?5:Number.MAX_VALUE;for(let Q=0;Q<r;Q++)for(let N=0;N<m;N++){var O=d[Q*m+N]*E;if((!w||w[Q*m+N])&&O<f){for(let Y=0;4>Y;Y++)u[h++]=(N+.5)/m,u[h++]=(Q+.5)/r,u[h++]=2>Y?-.5:.5,u[h++]=0===Y%2?-.5:.5,u[h++]=0,u[h++]=O;O=4*(h/24-1);B[k++]=O;B[k++]=O+1;B[k++]=O+2;B[k++]=O+1;B[k++]=O+2;B[k++]=O+3}}return{vertexData:new Float32Array(u),indexData:new Uint32Array(B)}}const t=new Map;t.set("meter-per-second",
1);t.set("kilometer-per-hour",.277778);t.set("knots",.514444);t.set("feet-per-second",.3048);t.set("mile-per-hour",.44704);const q=180/Math.PI,D=new L.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),V=R(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],b=[0,.5,1,1.5,2],e=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],g=[];n.convertToLocalDirections=function(d,f,h,k="geographic"){if(!y.isValidPixelBlock(d)||
null==h)return d;d="vector-magdir"===f?d.clone():J(d,f);const m=d.pixels[1];for(let r=0;r<m.length;r++)m[r]="geographic"===k?(m[r]+h[r]+270)%360:(m[r]+360-h[r])%360;return"vector-magdir"===f?d:J(d,"vector-magdir")};n.convertVectorFieldData=J;n.convertVectorFieldUnit=function(d,f,h=1){if(1===h||!y.isValidPixelBlock(d))return d;d=d.clone();const {pixels:k,width:m,height:r}=d,w=k[0],u=k[1];let B=0;for(let E=0;E<r;E++)for(let O=0;O<m;O++)"vector-uv"===f?(w[B]*=h,u[B]*=h):w[B]*=h,B++;d.updateStatistics();
return d};n.createVFMesh=function(d,f){if("simple_scalar"===f.style)f=A(d,f);else if("wind_speed"===f.style){if(0===g.length)for(var h=0;30>h;h++)g.push(T(5*h,0,!f.invertDirection));f=D.fromJSON(f.inputUnit);f=v(f,"knots");const {width:w,height:u,mask:B}=d;h=d.pixels[0];d=d.pixels[1];const E=[],O=[];let Q=0,N=0;for(let Y=0;Y<u;Y++)for(let X=0;X<w;X++){var k=Y*w+X,m=h[k]*f;if((!B||B[Y*w+X])&&5<=m){const da=(d[k]+360)%360/180*Math.PI,{pennants:ba,barbs:aa,shaft:ea}=g[Math.min(Math.floor(m/5),29)];if(0===
ba.length+aa.length)continue;k=E.length/6;const ka=(X+.5)/w,c=(Y+.5)/u;for(var r=0;r<ba.length;r+=2)E[Q++]=ka,E[Q++]=c,E[Q++]=ba[r],E[Q++]=ba[r+1]+da,E[Q++]=0,E[Q++]=m;for(r=0;r<aa.length;r+=2)E[Q++]=ka,E[Q++]=c,E[Q++]=aa[r],E[Q++]=aa[r+1]+da,E[Q++]=0,E[Q++]=m;for(r=0;r<ea.length;r+=2)E[Q++]=ka,E[Q++]=c,E[Q++]=ea[r],E[Q++]=ea[r+1]+da,E[Q++]=0,E[Q++]=m;for(m=0;m<ba.length/6;m++)O[N++]=k,O[N++]=k+1,O[N++]=k+2,k+=3;for(m=0;m<aa.length/8;m++)O[N++]=k,O[N++]=k+1,O[N++]=k+2,O[N++]=k+1,O[N++]=k+2,O[N++]=
k+3,k+=4;O[N++]=k+0;O[N++]=k+1;O[N++]=k+2;O[N++]=k+1;O[N++]=k+3;O[N++]=k+2;k+=4}}f={vertexData:new Float32Array(E),indexData:new Uint32Array(O)}}else f=I(d,f);return f};n.createVFMeshScalar=A;n.getUnitConversionFactor=v;n.sampleVectorField=function(d,f,h,k=[0,0],m=.5){const {width:r,height:w,mask:u}=d,[B,E]=d.pixels,[O,Q]=k;d=Math.round((r-O)/h);k=Math.round((w-Q)/h);var N=d*k;const Y=new Float32Array(N),X=new Float32Array(N);N=new Uint8Array(N);f="vector-uv"===f;for(let ba=0;ba<k;ba++)for(let aa=
0;aa<d;aa++){let ea=0;const ka=ba*d+aa,c=Math.max(0,ba*h+Q),l=Math.max(0,aa*h+O),x=Math.min(w,c+h),G=Math.min(r,l+h);for(let P=c;P<x;P++)for(let H=l;H<G;H++){var da=P*r+H;if(!u||u[da]){ea++;da=f?[B[da],E[da]]:[B[da],(360+E[da])%360];const [U,W]=f?da:S(da);Y[ka]+=U;X[ka]+=W}}if(ea>=(x-c)*(G-l)*(1-m)){N[ka]=1;const [P,H]=C([Y[ka]/ea,X[ka]/ea]);Y[ka]=P;X[ka]=H}else N[ka]=0,Y[ka]=0,X[ka]=0}h=new F({width:d,height:k,pixels:[Y,X],mask:N});h.updateStatistics();return h};n.snapImageToSymbolTile=function(d,
f,h,k,m){if(null==m||!m.spatialReference.equals(d.spatialReference))return{extent:d,width:Math.round(f/k),height:Math.round(h/k),resolution:d.width/f};const r=m.xmin;m=m.ymax;f=(d.xmax-d.xmin)/f*k;h=(d.ymax-d.ymin)/h*k;d.xmin=r+Math.floor((d.xmin-r)/f)*f;d.xmax=r+Math.ceil((d.xmax-r)/f)*f;d.ymin=m+Math.floor((d.ymin-m)/h)*h;d.ymax=m+Math.ceil((d.ymax-m)/h)*h;return{extent:d,width:Math.round(d.width/f),height:Math.round(d.height/h),resolution:(f+h)/2}};n.unitKebabDict=D;n.uvComponentToVector=C;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(n,L,F,y){class v extends y{constructor(){super(...arguments);this.symbolTypes=["triangle"]}prepareRenderPasses(C){const S=C.registerRenderPass({name:"imagery (vf)",brushes:[L],target:()=>this.children,drawPhase:F.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(C),S]}doRender(C){this.visible&&C.drawPhase===
F.WGLDrawPhase.MAP&&this.symbolTypes.forEach(S=>{C.renderPass=S;super.doRender(C)})}}n.RasterVFContainer=v;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],function(n,L){const F=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,
.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),y=new Float32Array([0,92/255,230/255,1]),v={beaufort_ft:F,beaufort_m:F,beaufort_km:F,
beaufort_mi:F,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,
.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,
.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,
.6941176470588235,.6941176470588235,1]),simple_scalar:y,single_arrow:y,wind_speed:new Float32Array([0,0,0,1])},C=[0,20];class S extends n{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:J}){J.setBlendingEnabled(!0);J.setBlendFunctionSeparate(L.BlendFactor.ONE,
L.BlendFactor.ONE_MINUS_SRC_ALPHA,L.BlendFactor.ONE,L.BlendFactor.ONE_MINUS_SRC_ALPHA);J.setColorMask(!0,!0,!0,!0);J.setStencilWriteMask(0);J.setStencilTestEnabled(!0);J.setStencilOp(L.StencilOperation.KEEP,L.StencilOperation.KEEP,L.StencilOperation.REPLACE)}draw(J,R){if(null!=R.source&&0!==R.source.validPixelCount){var {context:T,timeline:M}=J;M.begin(this.name);T.setStencilFunction(L.CompareFunction.EQUAL,R.stencilRef,255);R.updateVectorFieldVAO(J);if("scalar"===J.renderPass){var p=R.vaoData.scalar;
p&&this._drawScalars(J,R,p.vao,p.elementCount)}else(p=R.vaoData.magdir)&&this._drawTriangles(J,R,p.vao,p.elementCount);M.end(this.name)}}_drawTriangles(J,R,T,M){const {context:p,painter:z,requestRender:I,allowDelayedRender:A}=J,{symbolizerParameters:t}=R;var q=t.dataRange?["dataRange"]:[];"geographic"===t.rotationType&&q.push("rotationGeographic");q=z.materialManager.getProgram(this._desc.magdir,q);if(A&&null!=I&&!q.compiled)I();else{p.useProgram(q);var {coordScale:D,opacity:V,transforms:a}=R;q.setUniform2fv("u_coordScale",
D);q.setUniform1f("u_opacity",V);q.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);var {style:b,dataRange:e,rotation:g,symbolPercentRange:d}=t;q.setUniform4fv("u_colors",v[b]);q.setUniform2fv("u_dataRange",e||C);q.setUniform1f("u_rotation",g);q.setUniform2fv("u_symbolPercentRange",d);J=this._getSymbolSize(J,R);q.setUniform2fv("u_symbolSize",J);p.bindVAO(T);p.drawElements(L.PrimitiveType.TRIANGLES,M,L.DataType.UNSIGNED_INT,0)}}_drawScalars(J,R,T,M){const {context:p,painter:z,requestRender:I,
allowDelayedRender:A}=J,{symbolizerParameters:t}=R;var q=[];"wind_speed"===t.style?q.push("innerCircle"):t.dataRange&&q.push("dataRange");"geographic"===t.rotationType&&q.push("rotationGeographic");q=z.materialManager.getProgram(this._desc.scalar,q);if(A&&null!=I&&!q.compiled)I();else{p.useProgram(q);var {coordScale:D,opacity:V,transforms:a}=R;q.setUniform2fv("u_coordScale",D);q.setUniform1f("u_opacity",V);q.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);var {dataRange:b,symbolPercentRange:e}=
t;q.setUniform2fv("u_dataRange",b||C);q.setUniform2fv("u_symbolPercentRange",e);J=this._getSymbolSize(J,R);q.setUniform2fv("u_symbolSize",J);p.bindVAO(T);p.drawElements(L.PrimitiveType.TRIANGLES,M,L.DataType.UNSIGNED_INT,0)}}_getSymbolSize(J,R){J=R.key?2**(J.displayLevel-R.key.level):R.resolution/J.state.resolution;const {symbolTileSize:T}=R.symbolizerParameters;return[T/(Math.round((R.width-R.offset[0])/T)*T)/J,T/(Math.round((R.height-R.offset[1])/T)*T)/J]}}return S})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(n,L,F,y,v,C,S,J,R,T){L=class extends L{constructor(M){super(M);this._loading=null;this.update=y.debounce((p,z)=>this._update(p,z).catch(I=>{y.isAbortError(I)||F.getLogger(this).error(I)}))}get updating(){return!!this._loading}redraw(M){if(this.container.children.length){var p=this.container.children[0];p.symbolizerParameters=M;p.invalidateVAO();this.container.symbolTypes="wind_speed"===M.style?["scalar","triangle"]:"simple_scalar"===M.style?["scalar"]:["triangle"];this.container.requestRender()}}async _update(M,
p,z){if(M.stationary){var {extent:I,spatialReference:A}=M.state,t=new R({xmin:I.xmin,ymin:I.ymin,xmax:I.xmax,ymax:I.ymax,spatialReference:A}),[q,D]=M.state.size;this._loading=this.fetchPixels(t,q,D,z);z=await this._loading;this._addToDisplay(z,p,M.state);this._loading=null}}_addToDisplay(M,p,z){if(null==M.pixelBlock)this.container.children.forEach(q=>q.destroy()),this.container.removeAllChildren();else{var {extent:I,pixelBlock:A}=M,t=new T.RasterVFDisplayObject(A);t.offset=[0,0];t.symbolizerParameters=
p;t.rawPixelData=M;t.invalidateVAO();t.x=I.xmin;t.y=I.ymax;t.pixelRatio=z.pixelRatio;t.rotation=z.rotation;t.resolution=z.resolution;t.width=A.width*p.symbolTileSize;t.height=A.height*p.symbolTileSize;this.container.children.forEach(q=>q.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===p.style?["scalar","triangle"]:"simple_scalar"===p.style?["scalar"]:["triangle"];this.container.addChild(t)}}};n.__decorate([v.property()],L.prototype,"fetchPixels",void 0);n.__decorate([v.property()],
L.prototype,"container",void 0);n.__decorate([v.property()],L.prototype,"_loading",void 0);n.__decorate([v.property()],L.prototype,"updating",null);return L=n.__decorate([J.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],L)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(n,L,F,y,v,C,S,J,R,T,M){class p extends S.DisplayObject{constructor(z=null){super();this._symbolizerParameters=this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=z}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(z){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(z)&&(this._symbolizerParameters=z,this.invalidateVAO())}get source(){return this._source}set source(z){this._source=z;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(z){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:I}=this.symbolizerParameters;
switch(I){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":I=C.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(z.context,I)};break;case "simple_scalar":I=C.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(z.context,I)};break;case "wind_speed":I=C.createVFMesh(this.source,
this.symbolizerParameters);I=this._createVectorFieldVAO(z.context,I);const A=C.createVFMeshScalar(this.source,this.symbolizerParameters);z=this._createVectorFieldVAO(z.context,A);this.vaoData={magdir:I,scalar:z}}}this.ready();this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:y.create()}}setTransform(z){const I=F.identity(this.transforms.displayViewScreenMat3),[A,t]=z.toScreenNoRotation([0,0],[this.x,this.y]);var q=this.resolution/this.pixelRatio/z.resolution;const D=q*this.width;
q*=this.height;const V=Math.PI*this.rotation/180;F.translate(I,I,v.fromValues(A,t));F.translate(I,I,v.fromValues(D/2,q/2));F.rotate(I,I,-V);F.translate(I,I,v.fromValues(-D/2,-q/2));F.scaleByVec2(I,I,v.fromValues(D,q));F.multiply(this.transforms.displayViewScreenMat3,z.displayViewMat3,I)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(z,I){const {vertexData:A,indexData:t}=I;I=R.BufferObject.createVertex(z,T.Usage.STATIC_DRAW,new Float32Array(A));const q=R.BufferObject.createIndex(z,
T.Usage.STATIC_DRAW,new Uint32Array(t)),D=J.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:T.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:T.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:T.DataType.FLOAT,normalized:!1}]});return{vao:new M.VertexArrayObject(z,D.attributes,D.bufferLayouts,{geometry:I},q),elementCount:t.length}}}n.RasterVFDisplayObject=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/ImageryLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),function(n,L,F,y,v,C,S,J,R,T,M,p){return z=>{z=class extends z{constructor(){super(...arguments);this.view=null}async fetchPopupFeaturesAtLocation(I,
A){const {layer:t}=this;if(!I)throw new L("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t});var {popupEnabled:q}=t;const D=p.getFetchPopupTemplate(t,A);if(!q||null==D)throw new L("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:q,popupTemplate:D});const V=await D.getRequiredFields();F.throwIfAborted(A);q=new M;q.timeExtent=this.timeExtent;q.geometry=I;q.outFields=V;q.outSpatialReference=I.spatialReference;const {resolution:a,
spatialReference:b}=this.view;I="2d"===this.view.type?new R(a,a,b):new R(.5*a,.5*a,b);const {returnTopmostRaster:e,showNoDataRecords:g}=D.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return t.queryVisibleRasters(q,{returnDomainValues:!0,returnTopmostRaster:e,pixelSize:I,showNoDataRecords:g,signal:A?.signal}).then(d=>d)}canResume(){return!super.canResume()||this.timeExtent?.isEmpty?!1:!0}};n.__decorate([y.property()],z.prototype,"layer",void 0);n.__decorate([y.property()],z.prototype,
"suspended",void 0);n.__decorate([y.property(T.combinedViewLayerTimeExtentProperty)],z.prototype,"timeExtent",void 0);n.__decorate([y.property()],z.prototype,"view",void 0);return z=n.__decorate([J.subclass("esri.views.layers.ImageryLayerView")],z)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(n,L){function F(y,v){return y.popupTemplate?y.popupTemplate:null!=v&&v.defaultPopupTemplateEnabled&&null!=y.defaultPopupTemplate?y.defaultPopupTemplate:
null}n.getFetchPopupTemplate=F;n.getRequiredFields=async function(y,v=y.popupTemplate){if(null==v)return[];const C=await v.getRequiredFields(y.fieldsIndex);({lastEditInfoEnabled:v}=v);const {objectIdField:S,typeIdField:J,globalIdField:R,relationships:T}=y;if(C.includes("*"))return["*"];v=v?L.getFeatureEditFields(y):[];const M=L.fixFields(y.fieldsIndex,[...C,...v]);J&&M.push(J);M&&S&&y.fieldsIndex?.has(S)&&!M.includes(S)&&M.push(S);M&&R&&y.fieldsIndex?.has(R)&&!M.includes(R)&&M.push(R);T&&T.forEach(p=>
{({keyField:p}=p);M&&p&&y.fieldsIndex?.has(p)&&!M.includes(p)&&M.push(p)});return M};n.hasPopupTemplate=function(y,v){return null!=F(y,{defaultPopupTemplateEnabled:v})};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(n,
L,F,y,v,C,S,J){return R=>{R=class extends R{initialize(){this.addHandles(y.on(()=>this.layer,"refresh",T=>{this.doRefresh(T.dataChanged).catch(M=>{F.isAbortError(M)||L.getLogger(this).error(M)})}),"RefreshableLayerView")}};return R=n.__decorate([J.subclass("esri.layers.mixins.RefreshableLayerView")],R)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/handleUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(n,
L,F,y,v,C,S,J,R,T,M,p,z,I,A,t,q,D,V,a){S=class extends D(a(z.LayerView2DMixin(V))){constructor(){super(...arguments);this._exportImageVersion=-1;this._highlightGraphics=new M.GraphicsCollection;this._highlightView=void 0;this.subview=this.layer=null}get pixelData(){const {subview:b}=this;return this.updating||!b?null:"getPixelData"in b?b.getPixelData():null}update(b){this.subview?.update(b)}attach(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.view&&(this._highlightView=new I({view:this.view,
graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new A(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([v.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},v.sync),v.watch(()=>this.timeExtent,b=>{const {subview:e}=this;e&&(e.timeExtent=b,"redraw"in e?this.requestUpdate():e.redrawOrRefetch())},v.sync),
this.layer.on("redraw",()=>{const {subview:b}=this;b&&("redraw"in b?b.redraw():b.redrawOrRefetch())}),v.watch(()=>this.layer.renderer,()=>this._setSubView())])}detach(){this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(b,e){if(!((Array.isArray(b)?b[0]:F.isCollection(b)?
b.at(0):b)instanceof L))return y.makeHandle();let g=[];Array.isArray(b)||F.isCollection(b)?g=b.map(d=>d.clone()):b instanceof L&&(g=[b.clone()]);this._highlightGraphics.addMany(g);return y.makeHandle(()=>this._highlightGraphics.removeMany(g))}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||this.subview.updating||!!this._highlightView?.updating}_setSubView(){if(this.view){var b=this.layer.renderer?.type,e="imagery";"vector-field"===b?e="imageryVF":"flow"===b&&(e="flow");if(this.subview){({type:b}=
this.subview);if(b===e){this._attachSubview(this.subview);"flow"===b?this.subview.redrawOrRefetch():"imagery"===b&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===e?new t({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===e?new q({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new p({layer:this.layer,layerView:this});this._attachSubview(this.subview);
this.requestUpdate()}}_attachSubview(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0))}_detachSubview(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)}};n.__decorate([C.property()],S.prototype,"pixelData",null);n.__decorate([C.property()],S.prototype,"subview",void 0);return S=n.__decorate([T.subclass("esri.views.2d.layers.ImageryLayerView2D")],S)});