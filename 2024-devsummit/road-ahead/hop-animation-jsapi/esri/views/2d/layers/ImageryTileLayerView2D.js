// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],function(l,E,h){function k(n,q,y){const B=q.shift();0===y.length&&y.push({sliceId:-1,multidimensionalDefinition:[]});const A=y.length;for(let J=0;J<A;J++){const a=y.shift().multidimensionalDefinition;B.values?.forEach(e=>{y.push({sliceId:-1,multidimensionalDefinition:[...a,{variableName:n,dimensionName:B.name,values:[e]}]})})}q.length&&k(n,
q,y)}function v(n,q){return Array.isArray(n)?q[0]===q[1]?n[0]===q[0]||n[1]===q[0]:n[0]>=q[0]&&n[0]<=q[1]&&n[1]>=q[0]&&n[1]<=q[1]:n>=q[0]&&n<=q[1]}function u(n,q){return n[0]<=q[0]&&n[1]>=q[0]||n[0]<=q[1]&&n[1]>=q[1]||n[0]>=q[0]&&n[1]<=q[1]}function D(n){return 1===n.length?[n[0],n[0]]:[n[0],n[n.length-1]]}function F(n,q,y){if(!q?.subsetDefinitions?.length)return n;if(y){const {variables:A}=q;if(A.length&&!A.includes(y))return null;q=q.subsetDefinitions.find(J=>J.dimensionName===n.name&&J.variableName===
y);if(!q?.values?.length)return n;q=D(q.values)}else q=q.dimensions.find(({name:A})=>A===n.name)?.extent;const B=q;if(!B?.length)return n;q=n.values.filter(A=>v(A,B));return{...n,extent:[...B],values:q}}function x(n,q,y){if(!q?.subsetDefinitions?.length)return!1;const {variables:B}=q;if(B.length&&n.some(({variableName:A})=>A&&!B.includes(A)))return!0;for(let A=0;A<n.length;A++){const J=n[A],a=q.subsetDefinitions.find(e=>(""===J.variableName||e.variableName===J.variableName)&&e.dimensionName===J.dimensionName);
if(a?.values.length){const e=D(a.values);if(!J.isSlice&&2===J.values.length&&!Array.isArray(J.values[0])&&J.values[0]!==J.values[1]&&y){if(!u(J.values,e))return!0}else if(J.values.some(d=>!v(d,e)))return!0}}return!1}function C(n,q){var y=n.dimensions.find(({name:a})=>"StdTime"===a);if(null==y||null==q.start&&null==q.end)return q;q=q.clone();const {start:B,end:A}=q.toJSON(),J=B===A?[B]:null!=B&&null!=A?[B,A]:[B??A];if(2===J.length&&y?.extent.length&&(J[0]=Math.max(J[0],y.extent[0]),J[1]=Math.min(J[1],
y.extent[1]??y.extent[0]),J[1]<J[0]))return null;y=new h({variableName:"",dimensionName:"StdTime",isSlice:1===J.length,values:J});if(x([y],n,!0))return null;q.start=new Date(J[0]);q.end=new Date(J[1]??J[0]);return q}function m(n,q={}){const {multidimensionalInfo:y,keyProperties:B}=n;if(null==y)return null;const {variableName:A,multidimensionalSubset:J,multidimensionalDefinition:a}=q;n=null!=a?a[0]?.variableName:null;const e=A||n||B?.DefaultVariable;({variables:n}=y);J?.variables?.length&&(n=n.filter(({name:d})=>
J.variables.includes(d)));return e?n.find(({name:d})=>d===e)??n[0]:n[0]}function b(n,q){var {values:y}=q;if(y?.length){q=Array.isArray(y[0]);var B=Array.isArray(n);return q!==B?-1:q&&B?y.findIndex(J=>J[0]===n[0]&&J[1]===n[1]):y.indexOf(n)}({extent:B}=q);if(Array.isArray(n)||n<B[0]||n>B[1])return-1;y=q.interval||1;if("ISO8601"!==q.unit)return Math.round((n-B[0])/y);B=B[0];let A=-1;switch(q.intervalUnit?.toLowerCase()||"seconds"){case "seconds":A=Math.round((n-B)/1E3/y);break;case "minutes":A=Math.round((n-
B)/6E4/y);break;case "hours":A=Math.round((n-B)/36E5/y);break;case "days":A=Math.round((n-B)/864E5/y);break;case "months":q=(new Date(n)).getUTCFullYear()-(new Date(B)).getUTCFullYear();y=(new Date(B)).getUTCMonth();B=(new Date(n)).getUTCMonth();A=0===q?B-y:B+11-y+12*(q-1);break;case "years":A=Math.round(((new Date(n)).getUTCFullYear()-(new Date(B)).getUTCFullYear())/y);break;case "decades":A=Math.round(((new Date(n)).getUTCFullYear()-(new Date(B)).getUTCFullYear())/10/y)}return A}function r(n){var q=
n.values?.length;if(q)return q;const {extent:y,unit:B}=n;q=n.interval||1;var A=y?y[1]-y[0]:0;if("ISO8601"!==B)return Math.round(A/q);switch(n.intervalUnit?.toLowerCase()??"seconds"){case "seconds":q=Math.round(A/1E3/q);break;case "minutes":q=Math.round(A/6E4/q);break;case "hours":q=Math.round(A/36E5/q);break;case "days":q=Math.round(A/864E5/q);break;case "months":n=(new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear();q=(new Date(y[0])).getUTCMonth();A=(new Date(y[1])).getUTCMonth();
q=0===n?A-q+1:A+11-q+12*(n-1)+1;break;case "years":q=Math.round(((new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear())/q);break;case "decades":q=Math.round(((new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear())/10/q);break;default:q=0}return q}l.createSlices=function(n,q){const y=[];let B=0;(q?n.variables.filter(A=>A.name.toLowerCase()===q.toLowerCase()):[...n.variables].sort((A,J)=>A.name>J.name?1:-1)).forEach(A=>{const J=[],a=[...A.dimensions].sort((e,d)=>e.name>d.name?
-1:1);k(A.name,a,J);J.forEach(e=>{y.push({...e,sliceId:B++})})});return y};l.getDefaultMultidimensionalDefinition=function(n,q={}){var y=m(n,q);if(!y)return null;n=[];const {dimensions:B,name:A}=y;if(0===B.length)return[new h({variableName:A,dimensionName:"",values:[],isSlice:!0})];for(y=0;y<B.length;y++){const J=F(B[y],q.multidimensionalSubset,A);if(!J)return null;const {values:a,extent:e}=J;let d=a?.[0]??e[0];"stdz"===J.name.toLowerCase()&&!J.hasRanges&&Math.abs(e[1])<=Math.abs(e[0])&&(d=a?.length?
a[a.length-1]:e[1]);n.push(new h({variableName:A,dimensionName:J.name,values:[d],isSlice:q.useRangeForRangedDimensionInfo?!!J.hasRanges:!0}))}return n};l.getDefaultVariableInfo=m;l.getSliceIds=function(n,q,y){let B=n;q&&(q=[...q].sort((A,J)=>A.dimensionName<J.dimensionName?-1:1),q.forEach(({dimensionName:A,values:J,isSlice:a})=>{J.length&&(B=B.filter(e=>{e=e.multidimensionalDefinition.find(p=>p.dimensionName===A);if(null==e)return!1;const d=e.values[0];return"number"===typeof d?"number"===typeof J[0]?
J.includes(d):J.some(p=>p[0]<=d&&p[1]>=d):"number"===typeof J[0]?J.some(p=>d[0]<=p&&d[1]>=p):a?J.some(p=>p[0]===d[0]&&p[0]===d[1]):J.some(p=>p[0]>=d[0]&&p[0]<=d[1]||p[1]>=d[0]&&p[1]<=d[1]||p[0]<d[0]&&p[1]>d[1])}))}));if(B.length&&null!=y?.start&&null!=y.end){const A=y.start.getTime(),J=y.end.getTime(),a=B[0].multidimensionalDefinition.findIndex(e=>"StdTime"===e.dimensionName);-1<a&&(B=B.filter(e=>{e=e.multidimensionalDefinition[a].values[0];return A<=e&&J>=e}))}return B.map(A=>A.sliceId)};l.getSliceIndex=
function(n,q){let y=0;var B=n[0].variableName;q=[...q.variables].sort((J,a)=>J.name>a.name?1:-1);for(var A=0;A<q.length;A++){const J=q[A],a=[...J.dimensions].sort((e,d)=>e.name>d.name?-1:1);if(J.name!==B)y+=a.map(e=>r(e)).reduce((e,d)=>e*d);else{B=a.map(e=>r(e));q=a.length;for(let e=0;e<q;e++){A=n.find(d=>d.dimensionName===a[e].name);if(null==A)return null;A=b(A.values[0],a[e]);if(-1===A)return null;B.shift();y=e===q-1?y+A:y+A*B.reduce((d,p)=>d*p)}break}}return y};l.getSubsetVariablesFromMdInfo=function(n,
q){if(null==q||null==n)return null;q=q.variables.map(y=>({...y}));n?.variables?.length&&(q=q.filter(({name:y})=>n.variables.includes(y)),q.forEach(y=>{y.dimensions=y.dimensions.map(B=>F(B,n,y.name)).filter(E.isSome)}));return q};l.hasExcludedVariableOrDimension=x;l.intersectMultimensionalSubset=function(n,q){if(null==n)return{isOutside:!1};const {geometry:y,timeExtent:B,multidimensionalDefinition:A}=q;q=null;if(null!=B&&(q=C(n,B),null==q))return{isOutside:!0};const {areaOfInterest:J}=n;if(J&&y){const a=
"point"===y.type?y:"extent"===y.type?y.center:"polygon"===y.type?y.centroid:null;if(a&&!J.contains(a))return{isOutside:!0}}return null!=A&&A.length&&x(A,n,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:y,timeExtent:q,multidimensionalDefinition:A}}};l.isMultiSliceOrRangeDefinition=function(n){return n?.length?n.some(q=>{if(null==q.values)return!0;const y=q.values.length;return 0===y||1<y||!q.isSlice&&Array.isArray(q.values[0])}):!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(l,E,h,k,v,u){var D;E=D=class extends E.JSONSupport{constructor(F){super(F);this.dimensionName=this.variableName=null;this.values=[];this.isSlice=!1}clone(){return new D({variableName:this.variableName,dimensionName:this.dimensionName,
values:h.clone(this.values),isSlice:this.isSlice})}};l.__decorate([k.property({type:String,json:{write:!0}})],E.prototype,"variableName",void 0);l.__decorate([k.property({type:String,json:{write:!0}})],E.prototype,"dimensionName",void 0);l.__decorate([k.property({type:v.types.array(v.types.oneOf([v.types.native(Number),v.types.array(v.types.native(Number))])),json:{write:!0}})],E.prototype,"values",void 0);l.__decorate([k.property({type:Boolean,json:{write:!0}})],E.prototype,"isSlice",void 0);return E=
D=l.__decorate([u.subclass("esri.layers.support.DimensionalDefinition")],E)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(l,
E,h,k,v,u,D,F,x,C,m,b,r){h=class extends h{constructor(){super(...arguments);this._loadImagery=(n,q,y,B,A)=>m.loadImagery(this.layer,n,q,y,B,A);this._createFlowMesh=(n,q,y,B)=>this.layer.createFlowMesh({meshType:n,flowData:y,simulationSettings:q},{signal:B});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:n}=this,q=()=>{this._loadImagery=(y,B,A,J,a)=>
m.loadImagery(n,y,B,A,J,a);this._updateVisualization()};"multidimensionalDefinition"in n?this.addHandles(k.watch(()=>n.multidimensionalDefinition,q)):this.addHandles([k.watch(()=>n.mosaicRule,q),k.watch(()=>n.rasterFunction,q),k.watch(()=>n.definitionExpression,q)]);this.container=new b;this._strategy=new r({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(n){n.stationary?
this._strategy.update(n):this.layerView.requestUpdate()}hitTest(n){return new E({attributes:{},geometry:n.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var n=this.layer.renderer;null!=n&&"flow"===n.type&&(n=C(n,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=n,this.layerView.requestUpdate())}};l.__decorate([v.property()],h.prototype,"_strategy",void 0);l.__decorate([v.property()],h.prototype,
"attached",void 0);l.__decorate([v.property()],h.prototype,"container",void 0);l.__decorate([v.property()],h.prototype,"layer",void 0);l.__decorate([v.property()],h.prototype,"layerView",void 0);l.__decorate([v.property()],h.prototype,"type",void 0);l.__decorate([v.property()],h.prototype,"updating",null);l.__decorate([v.property()],h.prototype,"timeExtent",void 0);return h=l.__decorate([x.subclass("esri.views.2d.engine.flow.FlowView2D")],h)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils",
"./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(l,E,h,k,v){return function(u,D){const {flowSpeed:F,trailLength:x}=u,C=l.getFlowSimulationSettings(u);let m=null;const b={opacity:l.getOpacity(u),size:l.getSize(u)};let r=l.getColor(u);"none"===u.background?b.color=r:("constant"===r.kind&&(r={kind:"ramp",stops:[0,1],values:[0,0,0,1,r.value[0],r.value[1],r.value[2],r.value[3]],count:2}),m=new E.Imagery({loadImagery:D.loadImagery,timeExtent:D.timeExtent,color:r,
opacity:{kind:"constant",value:[1]}}),b.color=l.getForegroundColor());D={loadImagery:D.loadImagery,createFlowMesh:D.createFlowMesh,simulationSettings:C,timeExtent:D.timeExtent,trailLength:x,flowSpeed:F,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:b.color,opacity:b.opacity,size:b.size};u="butt"===u.trailCap||4>=l.getMax(l.getSize(u))?new v(D):new h.Particles(D);return null!=m?new k.Stack([m,u]):u}})},"esri/views/2d/engine/flow/utils":function(){define(["exports",
"../../../../core/screenUtils"],function(l,E){function h(F){return"constant"===F.kind?F.value[0]:F.values[F.values.length-1]}function k(F){F=F.toRgba();return[F[0]/255,F[1]/255,F[2]/255,F[3]]}function v(F){if(!F.hasVisualVariables("size"))return{kind:"constant",value:[E.pt2px(F.trailWidth)]};const x=F.getVisualVariablesForType("size")[0];F=[];const C=[];if(x.stops){for(m of x.stops)F.push(m.value),C.push(E.pt2px(m.size));var m=x.stops.length}else F.push(x.minDataValue,x.maxDataValue),C.push(E.pt2px(x.minSize),
E.pt2px(x.maxSize)),m=2;return{kind:"ramp",stops:F,values:C,count:m}}function u(F,x,C,m){switch(x){case "int":F.setUniform1iv(C,m);break;case "float":F.setUniform1fv(C,m);break;case "vec2":F.setUniform2fv(C,m);break;case "vec3":F.setUniform3fv(C,m);break;case "vec4":F.setUniform4fv(C,m)}}function D(F,x){return F===x?!0:null!=F&&null!=x?F.equals(x):!1}l.areStreamlinesCompatible=function(F,x){var C=F.simulationSettings,m=x.simulationSettings;let b;b=(b=(b=(b=(b=(b=(b=(b=(b=(b=(b=C.collisions===m.collisions)&&
C.density===m.density)&&C.interpolate===m.interpolate)&&C.lineCollisionWidth===m.lineCollisionWidth)&&C.lineSpacing===m.lineSpacing)&&C.maxTurnAngle===m.maxTurnAngle)&&C.minSpeedThreshold===m.minSpeedThreshold)&&C.segmentLength===m.segmentLength)&&C.smoothing===m.smoothing)&&C.velocityScale===m.velocityScale)&&C.verticesPerLine===m.verticesPerLine;return b&&D(F.timeExtent,x.timeExtent)?C=(C=(C=(C=(C=F.loadImagery===x.loadImagery)&&F.createFlowMesh===x.createFlowMesh)&&F.color.kind===x.color.kind)&&
F.opacity.kind===x.opacity.kind)&&F.size.kind===x.size.kind:!1};l.getColor=function(F){if(!F.hasVisualVariables("color"))return{kind:"constant",value:k(F.color)};F=F.getVisualVariablesForType("color")[0];const x=[],C=[];for(const m of F.stops)x.push(m.value),Array.prototype.push.apply(C,k(m.color));return{kind:"ramp",stops:x,values:C,count:F.stops.length}};l.getFlowSimulationSettings=function(F){var x=v(F);x=h(x);const C=Math.max(x/2,5),m=Math.round(E.pt2px(F.maxPathLength)/C)+1,{density:b}=F;return{smoothing:E.pt2px(F.smoothing),
interpolate:!0,velocityScale:"flow-from"===F.flowRepresentation?1:-1,verticesPerLine:m,minSpeedThreshold:.001,segmentLength:C,maxTurnAngle:1,collisions:!0,lineCollisionWidth:x,lineSpacing:10,density:b}};l.getForegroundColor=function(F){return{kind:"constant",value:[.1,.1,.1,1]}};l.getMax=h;l.getOpacity=function(F){if(!F.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};F=F.getVisualVariablesForType("opacity")[0];const x=[],C=[];for(const m of F.stops)x.push(m.value),C.push(m.opacity);
return{kind:"ramp",stops:x,values:C,count:F.stops.length}};l.getSize=v;l.setUniform=u;l.setUniforms=function(F,x,C,m){"constant"===m.kind?u(F,C,`u_${x}`,m.value):(u(F,"float",`u_${x}_stops`,m.stops),u(F,C,`u_${x}_values`,m.values),F.setUniform1i(`u_${x}_count`,m.count))};l.timeExtentsEqual=D;l.toRgba=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(l,E,h,k,v,u,D,F,x){class C{constructor(q){this._params=q;this.animated=!1}isCompatible(q){if(!(q instanceof C&&h.timeExtentsEqual(this._params.timeExtent,q._params.timeExtent)))return!1;let y;return y=(y=(y=this._params.loadImagery===q._params.loadImagery)&&this._params.color.kind===q._params.color.kind)&&this._params.opacity.kind===q._params.opacity.kind}async load(q,y){const {extent:B,size:A}=q;E.throwIfAborted(y);q=await this._params.loadImagery(B,A[0],A[1],this._params.timeExtent,y);
return new n(q,{color:this._params.color,opacity:this._params.opacity})}render(q,y,B){({context:q}=q);const {program:A}=B;q.setFaceCullingEnabled(!1);q.setBlendingEnabled(!0);q.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);q.useProgram(A);A.setUniformMatrix3fv("u_dvsMat3",y.dvsMat3);q.bindTexture(B.texture,0);A.setUniform1i("u_texture",0);A.setUniform1f("u_Min",B.min);A.setUniform1f("u_Max",B.max);h.setUniforms(A,"color","vec4",this._params.color);h.setUniforms(A,"opacity",
"float",this._params.opacity);q.bindVAO(B.vertexArray);q.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,4)}}const m=new Map;m.set("a_position",0);m.set("a_texcoord",1);const b={geometry:[new x.VertexElementDescriptor("a_position",2,v.DataType.UNSIGNED_SHORT,0,8),new x.VertexElementDescriptor("a_texcoord",2,v.DataType.UNSIGNED_SHORT,4,8)]},r={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:m};class n{constructor(q,y){this._flowData=q;this._values=y}attach(q){var {context:y}=q;const {width:B,
height:A}=this._flowData;var J={geometry:k.BufferObject.createVertex(y,v.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,B,0,1,1,0,A,0,0,B,A,1,0]))};J=new F.VertexArrayObject(y,m,b,J);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");q=q.painter.materialManager.getProgram(r,a);a=1E6;let e=-1E6;for(var d=0;d<A;d++)for(var p=0;p<B;p++)if(0!==this._flowData.mask[d*B+p]){var g=this._flowData.data[2*(d*B+p)],c=this._flowData.data[2*(d*B+p)+
1];g=Math.sqrt(g*g+c*c);a=Math.min(a,g);e=Math.max(e,g)}d=new Uint8Array(4*B*A);for(p=0;p<A;p++)for(g=0;g<B;g++)if(0!==this._flowData.mask[p*B+g]){c=this._flowData.data[2*(p*B+g)];const t=this._flowData.data[2*(p*B+g)+1];d[4*(p*B+g)]=(Math.sqrt(c*c+t*t)-a)/(e-a)*255;d[4*(p*B+g)+1]=0;d[4*(p*B+g)+2]=0;d[4*(p*B+g)+3]=255}else d[4*(p*B+g)]=0,d[4*(p*B+g)+1]=0,d[4*(p*B+g)+2]=0,d[4*(p*B+g)+3]=0;p=new D.TextureDescriptor;p.internalFormat=v.PixelFormat.RGBA;p.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;p.flipped=
!0;p.width=B;p.height=A;y=new u.Texture(y,p,d);this.vertexArray=J;this.program=q;this.texture=y;this.min=a;this.max=e;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}l.Imagery=C;l.ImageryResources=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(l,E,h,k,v,u,D){class F{constructor(r){this._params=r}get animated(){return 0<this._params.flowSpeed}isCompatible(r){return r instanceof F?h.areStreamlinesCompatible(this._params,r._params):!1}async load(r,n){const {extent:q,size:y}=r;E.throwIfAborted(n);r=await this._params.loadImagery(q,y[0],y[1],this._params.timeExtent,n);const {vertexData:B,indexData:A}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,r,n);return new b(B,A,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(r,n,q){({context:r}=r);const {program:y}=q;r.setFaceCullingEnabled(!1);r.setBlendingEnabled(!0);r.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);r.useProgram(y);y.setUniform1f("u_time",n.time);y.setUniform1f("u_trailLength",this._params.trailLength);y.setUniform1f("u_flowSpeed",this._params.flowSpeed);y.setUniform1f("u_featheringSize",this._params.featheringSize);y.setUniform1f("u_featheringOffset",this._params.featheringOffset);y.setUniform1f("u_introFade",
this._params.introFade?1:0);y.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);y.setUniform1f("u_decayRate",this._params.decayRate);y.setUniformMatrix3fv("u_dvsMat3",n.dvsMat3);y.setUniformMatrix3fv("u_displayViewMat3",n.displayViewMat3);h.setUniforms(y,"color","vec4",this._params.color);h.setUniforms(y,"opacity","float",this._params.opacity);h.setUniforms(y,"size","float",this._params.size);r.bindVAO(q.vertexArray);r.drawElements(v.PrimitiveType.TRIANGLES,q.indexCount,v.DataType.UNSIGNED_INT,
0)}}const x=new Map;x.set("a_xyts0",0);x.set("a_xyts1",1);x.set("a_typeIdDurationSeed",2);x.set("a_extrudeInfo",3);const C={geometry:[new D.VertexElementDescriptor("a_xyts0",4,v.DataType.FLOAT,0,64),new D.VertexElementDescriptor("a_xyts1",4,v.DataType.FLOAT,16,64),new D.VertexElementDescriptor("a_typeIdDurationSeed",4,v.DataType.FLOAT,32,64),new D.VertexElementDescriptor("a_extrudeInfo",4,v.DataType.FLOAT,48,64)]},m={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:x};class b{constructor(r,
n,q){this._vertexData=r;this._indexData=n;this._values=q}attach(r){var {context:n}=r,q=k.BufferObject.createVertex(n,v.Usage.STATIC_DRAW,this._vertexData);const y=k.BufferObject.createIndex(n,v.Usage.STATIC_DRAW,this._indexData);n=new u.VertexArrayObject(n,x,C,{geometry:q},y);q=[];"ramp"===this._values.color.kind&&q.push("vvColor");"ramp"===this._values.opacity.kind&&q.push("vvOpacity");"ramp"===this._values.size.kind&&q.push("vvSize");r=r.painter.materialManager.getProgram(m,q);this.vertexArray=
n;this.program=r;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}l.Particles=F;l.ParticlesResources=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(l){class E{constructor(k){this._styles=k}get animated(){return this._styles.reduce((k,v)=>k||v.animated,!1)}isCompatible(k){if(!(k instanceof E)||this._styles.length!==
k._styles.length)return!1;const v=this._styles.length;for(let u=0;u<v;u++)if(!this._styles[u].isCompatible(k._styles[u]))return!1;return!0}async load(k,v){const u=await Promise.all(this._styles.map(D=>D.load(k,v)));return new h(u)}render(k,v,u){for(let D=0;D<this._styles.length;D++)this._styles[D].render(k,v,u.resources[D])}}class h{constructor(k){this.resources=k}attach(k){for(const v of this.resources)v.attach(k)}detach(){for(const k of this.resources)k.detach()}get ready(){return this.resources.reduce((k,
v)=>k&&v.ready,!0)}}l.Stack=E;l.StackResources=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(l,E,h,k,v,u){class D{constructor(b){this._params=b}get animated(){return 0<this._params.flowSpeed}isCompatible(b){return b instanceof
D?E.areStreamlinesCompatible(this._params,b._params):!1}async load(b,r){const {extent:n,size:q}=b;l.throwIfAborted(r);b=await this._params.loadImagery(n,q[0],q[1],this._params.timeExtent,r);const {vertexData:y,indexData:B}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,b,r);return new m(y,B,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(b,r,n){({context:b}=b);const {program:q}=n;b.setFaceCullingEnabled(!1);b.setBlendingEnabled(!0);
b.setBlendFunction(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);b.useProgram(q);q.setUniform1f("u_time",r.time);q.setUniform1f("u_trailLength",this._params.trailLength);q.setUniform1f("u_flowSpeed",this._params.flowSpeed);q.setUniform1f("u_featheringSize",this._params.featheringSize);q.setUniform1f("u_featheringOffset",this._params.featheringOffset);q.setUniform1f("u_introFade",this._params.introFade?1:0);q.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);q.setUniform1f("u_decayRate",
this._params.decayRate);q.setUniformMatrix3fv("u_dvsMat3",r.dvsMat3);q.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3);E.setUniforms(q,"color","vec4",this._params.color);E.setUniforms(q,"opacity","float",this._params.opacity);E.setUniforms(q,"size","float",this._params.size);b.bindVAO(n.vertexArray);b.drawElements(k.PrimitiveType.TRIANGLES,n.indexCount,k.DataType.UNSIGNED_INT,0)}}const F=new Map;F.set("a_positionAndSide",0);F.set("a_timeInfo",1);F.set("a_extrude",2);F.set("a_speed",3);
const x={geometry:[new u.VertexElementDescriptor("a_positionAndSide",3,k.DataType.FLOAT,0,36),new u.VertexElementDescriptor("a_timeInfo",3,k.DataType.FLOAT,12,36),new u.VertexElementDescriptor("a_extrude",2,k.DataType.FLOAT,24,36),new u.VertexElementDescriptor("a_speed",1,k.DataType.FLOAT,32,36)]},C={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:F};class m{constructor(b,r,n){this._vertexData=b;this._indexData=r;this._values=n}attach(b){var {context:r}=b,n=h.BufferObject.createVertex(r,
k.Usage.STATIC_DRAW,this._vertexData);const q=h.BufferObject.createIndex(r,k.Usage.STATIC_DRAW,this._indexData);r=new v.VertexArrayObject(r,F,x,{geometry:n},q);n=[];"ramp"===this._values.color.kind&&n.push("vvColor");"ramp"===this._values.opacity.kind&&n.push("vvOpacity");"ramp"===this._values.size.kind&&n.push("vvSize");b=b.painter.materialManager.getProgram(C,n);this.vertexArray=r;this.program=b;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}
return D})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(l,E,h,k,v,u,D,F,x){function C(a,e){const d=r(e.data,e.width,e.height,a.smoothing);return a.interpolate?(p,g)=>{const c=Math.floor(p),t=Math.floor(g);if(0>c||c>=e.width||0>t||
t>=e.height)return[0,0];p-=c;g-=t;const w=c<e.width-1?c+1:c,z=t<e.height-1?t+1:t;return[(d[2*(t*e.width+c)]*(1-g)+d[2*(z*e.width+c)]*g)*(1-p)+(d[2*(t*e.width+w)]*(1-g)+d[2*(z*e.width+w)]*g)*p,(d[2*(t*e.width+c)+1]*(1-g)+d[2*(z*e.width+c)+1]*g)*(1-p)+(d[2*(t*e.width+w)+1]*(1-g)+d[2*(z*e.width+w)+1]*g)*p]}:(p,g)=>{p=Math.round(p);g=Math.round(g);return 0>p||p>=e.width||0>g||g>=e.height?[0,0]:[d[2*(g*e.width+p)],d[2*(g*e.width+p)+1]]}}function m(a,e,d,p,g,c,t,w,z){const H=[];let I=0,[K,L]=e(d,p);K*=
a.velocityScale;L*=a.velocityScale;H.push({x:d,y:p,t:I,speed:Math.sqrt(K*K+L*L)});for(let U=0;U<a.verticesPerLine;U++){let [R,Y]=e(d,p);R*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(R*R+Y*Y);if(X<a.minSpeedThreshold)break;const da=R/X,ba=Y/X;d+=da*a.segmentLength;p+=ba*a.segmentLength;I+=a.segmentLength/X;if(Math.acos(da*N+ba*S)>a.maxTurnAngle)break;if(a.collisions){var N=Math.round(d*z);var S=Math.round(p*z);if(0>N||N>t-1||0>S||S>w-1)break;const aa=c[S*t+N];if(-1!==aa&&aa!==g)break;c[S*
t+N]=g}H.push({x:d,y:p,t:I,speed:X});N=da;S=ba}return H}function b(a,e,d,p){const g=[],c=new D,t=1/Math.max(a.lineCollisionWidth,1),w=Math.round(d*t),z=Math.round(p*t),H=new Int32Array(w*z);for(var I=0;I<H.length;I++)H[I]=-1;I=[];for(let K=0;K<p;K+=a.lineSpacing)for(let L=0;L<d;L+=a.lineSpacing)I.push({x:L,y:K,sort:c.getFloat()});I.sort((K,L)=>K.sort-L.sort);for(const {x:K,y:L}of I)c.getFloat()<a.density&&(d=m(a,e,K,L,g.length,H,w,z,t),2>d.length||g.push(d));return g}function r(a,e,d,p){if(0===p)return a;
const g=Math.round(3*p),c=Array(2*g+1);var t=0;for(var w=-g;w<=g;w++){var z=Math.exp(-w*w/(p*p));c[w+g]=z;t+=z}for(p=-g;p<=g;p++)c[p+g]/=t;t=new Float32Array(a.length);for(p=0;p<d;p++)for(w=0;w<e;w++){var H=z=0;for(var I=-g;I<=g;I++)if(!(0>w+I||w+I>=e)){var K=c[I+g];z+=K*a[2*(p*e+(w+I))];H+=K*a[2*(p*e+(w+I))+1]}t[2*(p*e+w)]=z;t[2*(p*e+w)+1]=H}a=new Float32Array(a.length);for(p=0;p<e;p++)for(w=0;w<d;w++){H=z=0;for(I=-g;I<=g;I++)0>w+I||w+I>=d||(K=c[I+g],z+=K*t[2*((w+I)*e+p)],H+=K*t[2*((w+I)*e+p)+1]);
a[2*(w*e+p)]=z;a[2*(w*e+p)+1]=H}return a}function n(a,e){const d=new D;var p=a.reduce((w,z)=>w+z.length,0);p=new Float32Array(4*p);const g=Array(a.length);let c=0,t=0;for(const w of a){a=c;for(const z of w)p[4*c]=z.x,p[4*c+1]=z.y,p[4*c+2]=z.t,p[4*c+3]=z.speed,c++;g[t++]={startVertex:a,numberOfVertices:w.length,totalTime:w[w.length-1].t,timeSeed:e?d.getFloat():0}}return{lineVertices:p,lineDescriptors:g}}function q(a,e){function d(N,S,U,R,Y,X,da,ba){const aa=9*z;let ea=0;w[aa+ea++]=N;w[aa+ea++]=S;w[aa+
ea++]=1;w[aa+ea++]=U;w[aa+ea++]=X;w[aa+ea++]=da;w[aa+ea++]=R/2;w[aa+ea++]=Y/2;w[aa+ea++]=ba;z++;w[aa+ea++]=N;w[aa+ea++]=S;w[aa+ea++]=-1;w[aa+ea++]=U;w[aa+ea++]=X;w[aa+ea++]=da;w[aa+ea++]=-R/2;w[aa+ea++]=-Y/2;w[aa+ea++]=ba;z++}const {lineVertices:p,lineDescriptors:g}=a;var c=a=0;for(var t of g)a+=2*t.numberOfVertices,c+=6*(t.numberOfVertices-1);const w=new Float32Array(9*a);t=new Uint32Array(c);let z=0;a=0;for(const N of g){const {totalTime:S,timeSeed:U}=N;let R=c=null,Y=null;var H=null,I=null,K=null;
for(let X=0;X<N.numberOfVertices;X++){H=p[4*(N.startVertex+X)];const da=p[4*(N.startVertex+X)+1],ba=p[4*(N.startVertex+X)+2],aa=p[4*(N.startVertex+X)+3];let ea=null,ka=null;var L=null;let f=null;0<X&&(ea=H-c,ka=da-R,L=Math.sqrt(ea*ea+ka*ka),ea/=L,ka/=L,1<X?(I=ea+I,K=ka+K,L=Math.sqrt(I*I+K*K),I/=L,K/=L,L=Math.min(1/(I*ea+K*ka),e),I*=L,K*=L,L=-K,f=I):(L=-ka,f=ea),null!==L&&null!==f&&(d(c,R,Y,L,f,S,U,aa),t[a++]=z-2,t[a++]=z,t[a++]=z-1,t[a++]=z,t[a++]=z+1,t[a++]=z-1));c=H;R=da;Y=ba;I=ea;K=ka;H=aa}d(c,
R,Y,-K,I,S,U,H)}return{vertexData:w,indexData:t}}function y(a){function e(M,O){var T=ba+ea,P=aa+ka,V=Math.sqrt(T*T+P*P);T/=V;P/=V;var W=ba*T+aa*P,Q=ea+f,ca=ka+G;V=Math.sqrt(Q*Q+ca*ca);Q/=V;ca/=V;var Z=ea*Q+ka*ca;V=L;var ja=N,ia=S,ha=U;P=-(P/W);T/=W;W=R;var la=Y,ma=X,na=da;ca=-(ca/Z);Q/=Z;Z=16*I;let fa=0;for(const pa of[1,2])for(const qa of[1,2,3,4])z[Z+fa++]=V,z[Z+fa++]=ja,z[Z+fa++]=ia,z[Z+fa++]=ha,z[Z+fa++]=W,z[Z+fa++]=la,z[Z+fa++]=ma,z[Z+fa++]=na,z[Z+fa++]=pa,z[Z+fa++]=qa,z[Z+fa++]=M,z[Z+fa++]=
O,z[Z+fa++]=P/2,z[Z+fa++]=T/2,z[Z+fa++]=ca/2,z[Z+fa++]=Q/2,I++;H[K++]=I-8;H[K++]=I-7;H[K++]=I-6;H[K++]=I-7;H[K++]=I-5;H[K++]=I-6;H[K++]=I-4;H[K++]=I-3;H[K++]=I-2;H[K++]=I-3;H[K++]=I-1;H[K++]=I-2}function d(M,O,T,P,V,W){ba=ea;aa=ka;ea=f;ka=G;null==ba&&null==aa&&(ba=ea,aa=ka);if(null!=R&&null!=Y){f=M-R;G=O-Y;const Q=Math.sqrt(f*f+G*G);f/=Q;G/=Q}null!=ba&&null!=aa&&e(V,W);L=R;N=Y;S=X;U=da;R=M;Y=O;X=T;da=P}function p(M,O){ba=ea;aa=ka;ea=f;ka=G;null==ba&&null==aa&&(ba=ea,aa=ka);null!=ba&&null!=aa&&e(M,
O)}const {lineVertices:g,lineDescriptors:c}=a;let t=a=0;for(var w of c){const M=w.numberOfVertices-1;a+=8*M;t+=12*M}const z=new Float32Array(16*a),H=new Uint32Array(t);let I=0,K=0,L,N,S,U,R,Y,X,da,ba,aa,ea,ka,f,G;for(const M of c){G=f=ka=ea=aa=ba=da=X=Y=R=U=S=N=L=null;const {totalTime:O,timeSeed:T}=M;for(w=0;w<M.numberOfVertices;w++)d(g[4*(M.startVertex+w)],g[4*(M.startVertex+w)+1],g[4*(M.startVertex+w)+2],g[4*(M.startVertex+w)+3],O,T);p(O,T)}return{vertexData:z,indexData:H}}function B(a,e){const d=
e.pixels,{width:p,height:g}=e,c=new Float32Array(p*g*2),t=e.mask||new Uint8Array(p*g*2);e.mask||t.fill(255);if("vector-uv"===a)for(a=0;a<p*g;a++)c[2*a]=d[0][a],c[2*a+1]=-d[1][a];else if("vector-magdir"===a)for(a=0;a<p*g;a++){e=d[0][a];const w=v.deg2rad(d[1][a]),z=Math.sin(w-Math.PI/2);c[2*a]=Math.cos(w-Math.PI/2)*e;c[2*a+1]=z*e}return{data:c,mask:t,width:p,height:g}}async function A(a,e,d,p,g,c){const t={requestProjectedLocalDirections:!0,signal:c};null!=g&&(t.timeExtent=g);if("imagery"===a.type)return await a.load({signal:c}),
g=a.rasterInfo.dataType,a=await a.fetchImage(e,d,p,t),null==a?.pixelData?.pixelBlock?{data:new Float32Array(d*p*2),mask:new Uint8Array(d*p),width:d,height:p}:B(g,a.pixelData.pixelBlock);await a.load({signal:c});g=a.serviceRasterInfo.dataType;a=await a.fetchPixels(e,d,p,t);return null==a?.pixelBlock?{data:new Float32Array(d*p*2),mask:new Uint8Array(d*p),width:d,height:p}:B(g,a.pixelBlock)}const J=()=>k.getLogger("esri.views.2d.engine.flow.dataUtils");l.createAnimatedLinesData=n;l.createFlowMesh=async function(a,
e,d,p){const g=performance.now();var c=C(e,d);const t=performance.now();d=b(e,c,d.width,d.height);e=performance.now();c=n(d,!0);d=performance.now();a="Streamlines"===a?q(c,10):y(c);c=performance.now();h("esri-2d-profiler")&&(J().info("I.1","_createFlowFieldFromData (ms)",Math.round(t-g)),J().info("I.2","_getStreamlines (ms)",Math.round(e-t)),J().info("I.3","createAnimatedLinesData (ms)",Math.round(d-e)),J().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(c-d)),J().info("I.5","createFlowMesh (ms)",
Math.round(c-g)),J().info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();u.throwIfAborted(p);return a};l.createParticlesMesh=y;l.createStreamlinesMesh=q;l.loadImagery=async function(a,e,d,p,g,c){const t=performance.now();var w=F.getInfo(e.spatialReference);if(!w)return d=await A(a,e,d,p,g,c),h("esri-2d-profiler")&&J().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-t)),h("esri-2d-profiler")&&J().info("I.9","Number of parts",
1),d;const [z,H]=w.valid,I=Math.ceil(e.width/(H-z)),K=e.width/I,L=Math.round(d/I);let N=e.xmin;const S=[];w=performance.now();for(let U=0;U<I;U++){const R=new x({xmin:N,xmax:N+K,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});S.push(A(a,R,L,p,g,c));N+=K}a=await Promise.all(S);h("esri-2d-profiler")&&J().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-w));h("esri-2d-profiler")&&J().info("I.9","Number of parts",a.length);p={data:new Float32Array(d*p*2),mask:new Uint8Array(d*
p),width:d,height:p};e=0;for(const U of a){for(a=0;a<U.height;a++)for(g=0;g<U.width;g++)e+g>=d||(p.data[2*(a*d+e+g)]=U.data[2*(a*U.width+g)],p.data[2*(a*d+e+g)+1]=U.data[2*(a*U.width+g)+1],p.mask[a*d+e+g]=U.mask[a*U.width+g]);e+=U.width}h("esri-2d-profiler")&&J().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-t));return p};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums",
"../webgl/WGLContainer"],function(l,E,h){class k extends h{constructor(){super(...arguments);this.flowStyle=null}doRender(v){super.doRender(v)}prepareRenderPasses(v){const u=v.registerRenderPass({name:"flow",brushes:[l],target:()=>this.children,drawPhase:E.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(v),u]}}return k})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(l,
E,h){class k extends E{constructor(){super(...arguments);this._visualState={time:0,dvsMat3:l.create(),displayViewMat3:l.create()}}dispose(){}prepareState(v){({context:v}=v);v.setColorMask(!0,!0,!0,!0);v.setStencilFunction(h.CompareFunction.EQUAL,0,255)}draw(v,u){const {requestRender:D,allowDelayedRender:F}=v,{displayData:x}=u;if(null!=x&&("loaded"===x.state.name&&x.attach(v),"attached"===x.state.name)){var C=x.state.resources;F&&!C.ready&&null!=D?D():(this._visualState.time=v.time/1E3,this._visualState.dvsMat3=
u.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=v.state.displayViewMat3,x.flowStyle.render(v,this._visualState,C),x.flowStyle.animated&&null!=D&&D())}}}return k})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b,r,n){function q(y,B){const A=new m({x:(y.xmax+y.xmin)/2,y:(y.ymax+y.ymin)/2,spatialReference:y.spatialReference});var J=y.xmax-y.xmin;const a=y.ymax-y.ymin,e=Math.abs(Math.cos(v.deg2rad(B))),d=Math.abs(Math.sin(v.deg2rad(B)));B=e*J+d*a;J=d*J+e*a;y=new n({xmin:A.x-B/2,ymin:A.y-J/2,xmax:A.x+B/2,ymax:A.y+J/2,spatialReference:y.spatialReference});y.centerAt(A);return y}E=class extends h{constructor(y){super(y);this._flowDisplayObject=new r.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(y){var {flowStyle:B}=this.flowContainer;if(null==B)this._clear();else{var {extent:A,rotation:J,resolution:a,pixelRatio:e}=y.state;y=q(A,J);y.expand(1.15);B=new b(B,y,[Math.round((y.xmax-y.xmin)/a),Math.round((y.ymax-y.ymin)/a)],e);if(null!=this._loading){if(this._loading.update(B))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(B)||(B.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},d=>{u.isAbortError(d)||(k.getLogger(this).error("A resource failed to load.",d),this._loading=null)}),this._loading=B)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};l.__decorate([D.property()],E.prototype,"_loading",void 0);
l.__decorate([D.property()],E.prototype,"flowContainer",void 0);l.__decorate([D.property()],E.prototype,"updating",null);return E=l.__decorate([C.subclass("esri.views.2d.engine.flow.FlowStrategy")],E)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(l){class E{constructor(h,k,v,u){this.state={name:"created"};this.flowStyle=h;this.extent=k;this.size=v;this.pixelRatio=u}async load(){const h=new AbortController;this.state={name:"loading",abortController:h};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},h.signal)}}attach(h){if("loaded"!==this.state.name)l.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var k=this.state.resources;k.attach(h);this.state={name:"attached",resources:k}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(h){if(!this.flowStyle.isCompatible(h.flowStyle)||!this.extent.equals(h.extent)||this.size[0]!==h.size[0]||this.size[1]!==h.size[1]||this.pixelRatio!==h.pixelRatio)return!1;this.flowStyle=h.flowStyle;return!0}}return E})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],function(l,E,h,k,v){class u extends v.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(D){this._displayData=D;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(D){var {displayData:F}=this;if(null!=F){var x=[0,0];D.toScreen(x,[F.extent.xmin,F.extent.ymax]);F=(F.extent.xmax-F.extent.xmin)/F.size[0]/D.resolution;var C=E.deg2rad(D.rotation),{displayViewScreenMat3:m}=this.transforms;h.fromTranslation(m,[-1,1,0]);h.scale(m,
m,[2/(D.size[0]*D.pixelRatio),-2/(D.size[1]*D.pixelRatio),1]);h.translate(m,m,[x[0],x[1],0]);h.rotate(m,m,C);h.scale(m,m,[F*D.pixelRatio,F*D.pixelRatio,1])}}_createTransforms(){return{displayViewScreenMat3:k.create()}}}l.FlowDisplayObject=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b,r,n,q,y,B){const A=h.ofType({key:"type",base:null,typeMap:{rect:q,path:B,geometry:y}});l.LayerView2DMixin=J=>{J=class extends J{constructor(){super(...arguments);this.attached=!1;this.clips=new A;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new v("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new r.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([u.watch(()=>this.suspended,e=>{this.container&&(this.container.visible=!e)},u.syncAndInitial),u.watch(()=>this.updateSuspended,e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},u.syncAndInitial),u.watch(()=>this.layer?.opacity??
1,e=>{this.container&&(this.container.opacity=e)},u.syncAndInitial),u.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",e=>{this.container&&(this.container.blendMode=e)},u.syncAndInitial),u.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,e=>{this.container&&(this.container.effect=e)},u.syncAndInitial),u.watch(()=>this.highlightOptions,e=>this.container.highlightOptions=e,u.syncAndInitial),u.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},u.syncAndInitial),u.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:e})=>{e=null!=e?this.isVisibleAtScale(e):!1;e!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",e)},u.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const a=this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(a){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!e)return!0;const {minScale:d,maxScale:p}=e;return b.isInScaleRange(a,d,p)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
a),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(a)))}hitTest(a,e){return Promise.resolve(null)}supportsSpatialReference(a){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const a=super.getSuspendInfo(),e=!this.spatialReferenceSupported,d=this.visibleAtCurrentScale;e&&(a.spatialReferenceNotSupported=e);d&&(a.outsideScaleRange=d);return a}addAttachHandles(a){this.addHandles(a,"attach")}};
E.__decorate([D.property()],J.prototype,"attached",void 0);E.__decorate([D.property({type:A,set(a){a=k.referenceSetter(a,this._get("clips"),A);this._set("clips",a)}})],J.prototype,"clips",void 0);E.__decorate([D.property()],J.prototype,"container",void 0);E.__decorate([D.property()],J.prototype,"moving",void 0);E.__decorate([D.property({readOnly:!0})],J.prototype,"spatialReferenceSupported",null);E.__decorate([D.property({readOnly:!0})],J.prototype,"updateParameters",void 0);E.__decorate([D.property()],
J.prototype,"updateRequested",void 0);E.__decorate([D.property()],J.prototype,"updateSuspended",null);E.__decorate([D.property()],J.prototype,"updating",null);E.__decorate([D.property()],J.prototype,"view",void 0);E.__decorate([D.property({readOnly:!0})],J.prototype,"visibleAtCurrentScale",void 0);E.__decorate([D.property({type:n})],J.prototype,"highlightOptions",void 0);return J=E.__decorate([m.subclass("esri.views.2d.layers.LayerView2D")],J)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(l,E,h){function k(v,u){u=h.getMetersPerUnitForSR(u);return v/(u*h.inchesPerMeter*96)}l.getExtentForScale=function(v,u){const D=v.extent;v=v.width-(v.padding?v.padding.left+v.padding.right:0);u=k(u,D.spatialReference);return D.clone().expand(u*v/D.width)};l.getResolutionForScale=k;l.getResolutionInMetersForScale=function(v){return v/(96*h.inchesPerMeter)};l.getScale=function(v,u){u=
u||v.extent;v=v.width;const D=h.getMetersPerUnitForSR(u?.spatialReference);return u&&v?u.width/v*D*h.inchesPerMeter*96:0};l.getScaleForResolution=function(v,u){u=h.getMetersPerUnitForSR(u);return v*u*h.inchesPerMeter*96};l.isInScaleRange=function(v,u,D){if(u=0===u||E.floatEqualAbsolute(v,u)||v<u)u=0===D||E.floatEqualAbsolute(v,D)||v>D;return u};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(l,E,h,k,v,u,D){var F;h=F=class extends D{constructor(x){super(x);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new F({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};l.__decorate([E.property({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0);l.__decorate([E.property({type:[Number,String],
json:{write:!0}})],h.prototype,"right",void 0);l.__decorate([E.property({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0);l.__decorate([E.property({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0);return h=F=l.__decorate([u.subclass("esri.views.layers.support.ClipRect")],h)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(l,E,h,k,v,u,D){E=class extends E.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};l.__decorate([h.property({readOnly:!0})],E.prototype,"version",null);return E=l.__decorate([D.subclass("esri.views.layers.support.ClipArea")],E)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b){var r;E={base:F,key:"type",typeMap:{extent:m,polygon:b}};C=r=class extends C{constructor(n){super(n);this.type="geometry";this.geometry=null}clone(){return new r({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};l.__decorate([h.property({types:E,json:{read:x.fromJSON,write:!0}})],C.prototype,"geometry",void 0);return C=r=l.__decorate([D.subclass("esri.views.layers.support.Geometry")],C)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(l,E,h,k,v,u,D){h=class extends D{constructor(F){super(F);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};l.__decorate([E.property({type:[[[Number]]],json:{write:!0}})],h.prototype,"path",void 0);return h=l.__decorate([u.subclass("esri.views.layers.support.Path")],h)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util ../../../layers/support/Geometry".split(" "),
function(l,E,h,k,v,u,D,F,x,C){h=class extends F.BaseImageryTileSubView2D{constructor(){super(...arguments);this.type="raster"}attach(){super.attach();this.container=new D.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()}detach(){super.detach();this.container.removeAllChildren();this.container=null}canUseWebGLForProcessing(){const {symbolizer:m}=this.layer;var b=m.lookup?.colormapLut?.indexedColormap;b=b&&b.length>
this._maxIndexedColormapSize;return this.useWebGLForProcessing&&m.canRenderInWebGL&&!b&&!("majority"===this.layer.interpolation&&x.canUseMajorityInterpolationOnDataSource(this.layer))}fetchTile(m,b){return this.layer.fetchTile(m.level,m.row,m.col,b)}updateRasterFunctionParameters(){const {clips:m,view:b}=this.layerView;null!=this._geometry&&m.remove(this._geometry);const {raster:r,type:n}=this.layer;if("Function"===r.datasetFormat){var q=r.getClippingGeometry(b.spatialReference);q&&(q=new C({geometry:q}),
m.add(q),this._geometry=q)}({container:q}=this);if("Function"!==r.datasetFormat||"wcs"===n)q.rasterFunctionChain=null,q.children.forEach(p=>{({bitmap:p}=p);p&&(p.suspended=!0,p.processed=!1,p.projected&&(p.invalidateTexture(),p.rasterTexture=null))}),this._rasterFunctionState="na";else{var y=this._rasterFunctionState,{rasterFunction:B,primaryRasters:A}=r,J=B.supportsGPU&&(!A||1>=A.rasters.length),a=J?B.flatWebGLFunctionChain:null,{renderer:e}=this.layer;J=!J||!a?.functions.length||"raster-stretch"===
e?.type&&e.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();q.rasterFunctionChain=J?null:a;var d=null==B?"na":q.rasterFunctionChain?"gpu":"cpu";q.children.forEach(p=>{({bitmap:p}=p);p&&(p.suspended=y!==d,p.processed=!1,p.processedTexture=null)});this._rasterFunctionState=d}}async updateTileSource(m,b){const r=this._getBandIds(),n=this._getLayerInterpolation(),q=this.canUseWebGLForProcessing(),{source:y,globalSymbolizerParams:B,suspended:A,coords:J,resolution:a}=b;b=this.layerView.hasTilingEffects?
B:b.symbolizerParams;({bitmap:m}=m);[m.x,m.y]=J;m.resolution=a;if(null!=y?.pixelBlock){var e={extent:y.extent,pixelBlock:y.pixelBlock,srcPixelSize:y.srcTilePixelSize};m.rawPixelData=e;q?(m.source=y.pixelBlock,m.isRendereredSource=!1):(e=await this.layer.applyRenderer(e,"stretch"===B?.type?B:void 0),m.source=e,m.isRendereredSource=!0);m.symbolizerParameters=q?b:null;m.transformGrid=q?y.transformGrid:null}else e=this.createEmptyTilePixelBlock(),m.source=e,m.symbolizerParameters=q?b:null,m.transformGrid=
null;m.bandIds=q?r:null;m.width=this._tileInfoView.tileInfo.size[0];m.height=this._tileInfoView.tileInfo.size[1];m.interpolation=n;m.suspended=A;m.invalidateTexture()}async updateTileSymbolizerParameters(m,b){const {local:r,global:n}=b;b=this._getBandIds();const q=this._getLayerInterpolation(),y=this.canUseWebGLForProcessing();({bitmap:m}=m);const {rawPixelData:B}=m;y||null==B?(m.isRendereredSource&&null!=B&&(m.source=B.pixelBlock),m.isRendereredSource=!1):(m.source=await this.layer.applyRenderer(B,
"stretch"===n?.type?n:void 0),m.isRendereredSource=!0);m.symbolizerParameters=y?this.layerView.hasTilingEffects?n:r:null;m.bandIds=y?b:null;m.interpolation=q;m.suspended=!1}_getLayerInterpolation(){const {interpolation:m,renderer:b}=this.layer;if(!b)return m;const r=b.type;return"raster-colormap"===r||"unique-value"===r||"class-breaks"===r?"nearest":"raster-stretch"===b.type&&null!=b.colorRamp?"bilinear"===m||"cubic"===m?"bilinear":"nearest":m}};l.__decorate([E.property()],h.prototype,"container",
void 0);l.__decorate([E.property()],h.prototype,"layer",void 0);l.__decorate([E.property()],h.prototype,"type",void 0);return h=l.__decorate([u.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],h)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ./BrushRasterBitmap ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),function(l,E,h,k,v,u,D){class F extends D{constructor(){super(...arguments);
this.isCustomTilingScheme=!1}createTile(x){const C=this._getTileBounds(x),[m,b]=this._tileInfoView.tileInfo.size,r=this._tileInfoView.getTileResolution(x.level);return new v.RasterTile(x,r,C[0],C[3],m,b)}prepareRenderPasses(x){const C=x.registerRenderPass({name:"imagery (tile)",brushes:[k],target:()=>this.children.map(m=>m.bitmap),drawPhase:u.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(x),C]}doRender(x){if(this.visible&&x.drawPhase===u.WGLDrawPhase.MAP){var {rasterFunctionChain:C}=this;
if(C){if(!C.hasFocalFunction){const [m,b]=this._tileInfoView.tileInfo.size;x.renderPass="raster";x.rasterFunction={name:"Reproject",parameters:{targetImageSize:[m,b],requireNNEdge:C.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1};super.doRender(x)}if(C?.functions.length){const {functions:m,hasBranches:b}=C;for(C=0;C<m.length;C++){const r=m[C];"Constant"!==r.name&&"Identity"!==r.name&&(x.renderPass="raster",x.rasterFunction=r,x.hasBranches=b,super.doRender(x))}}x.rasterFunction=null;x.renderPass=
"bitmap"}else x.renderPass="raster-bitmap";super.doRender(x)}}_getTileBounds(x){const C=this._tileInfoView.getTileBounds(E.create(),x);if(this.isCustomTilingScheme&&x.world){var {tileInfo:m}=this._tileInfoView,b=h.getWorldWidth(m.spatialReference);if(b){var r=m.lodAt(x.level);if(!r)return C;({resolution:r}=r);m=(b=b/r%m.size[0])?(m.size[0]-b)*r:0;C[0]-=m*x.world;C[2]-=m*x.world}}return C}}l.RasterTileContainer=F;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushRasterBitmap":function(){define("../../../../core/maybe ./RasterBitmap ./colorizer/rasterColorizer ./processor/rasterProcessor ../webgl/definitions ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/rasterUtils".split(" "),
function(l,E,h,k,v,u,D,F,x,C){class m extends D{constructor(){super(...arguments);this.name="raster";this._quad=null;this._rendererUniformInfos=new Map;this._fbo=null}dispose(){l.disposeMaybe(this._quad);l.disposeMaybe(this._fbo)}prepareState(b){const {context:r,renderPass:n}=b;b="raster"===n;r.setBlendingEnabled(!b);r.setBlendFunctionSeparate(F.BlendFactor.ONE,F.BlendFactor.ONE_MINUS_SRC_ALPHA,F.BlendFactor.ONE,F.BlendFactor.ONE_MINUS_SRC_ALPHA);r.setColorMask(!0,!0,!0,!0);r.setStencilWriteMask(0);
r.setStencilTestEnabled(!b)}draw(b,r){if(E.hasSource(r)&&!r.suspended){var {renderPass:n}=b;if("raster-bitmap"===n)this._drawBitmap(b,r);else{if("raster"===n)return this._process(b,r);this._drawBitmap(b,r,!0)}}}_process(b,r){var {rasterFunction:n}=b;n="Reproject"===n.name;if(!(n?r.rasterTexture&&r.projected:r.processed)){var {timeline:q,context:y}=b;q.begin(this.name);var B=y.getBoundFramebufferObject(),A=y.getViewport();n||(r.processedTexture=l.disposeMaybe(r.processedTexture));y.setStencilFunction(F.CompareFunction.EQUAL,
r.stencilRef,255);r.updateTexture(b);this._initQuad(y);var [J,a]=r.getRasterTextureSize(n),{isStandardRasterTileSize:e,fbo:d}=this._getRasterFBO(y,J,a);k.process(b,this._quad,d,r);e||d.dispose();y.bindFramebuffer(B);y.setViewport(A.x,A.y,A.width,A.height);q.end(this.name)}}_drawBitmap(b,r,n=!1){const {timeline:q,context:y}=b;q.begin(this.name);y.setStencilFunction(F.CompareFunction.EQUAL,r.stencilRef,255);r.updateTexture(b);if(n&&!r.processedTexture){r.updateProcessedTexture();if(!r.processedTexture){q.end(this.name);
return}r.processed=!0}this._initBitmapCommonUniforms(r);var B=r.symbolizerParameters.type;const A=h.getColorizer(B),{requestRender:J,allowDelayedRender:a}=b,{defines:e,program:d}=A.createProgram(b,r,r.projected&&n);a&&null!=J&&!d.compiled?J():(y.useProgram(d),B=this._getUniformInfos(B,y,d,e),this._quad||(this._quad=new u(y,[0,0,1,0,0,1,1,1])),A.bindTextureAndUniforms(b,d,r,B,n),this._quad.draw(),q.end(this.name))}_initBitmapCommonUniforms(b){if(!b.commonUniforms){const r=C.getBasicGridUniforms(1,
[0,0]),{transformGrid:n,width:q,height:y}=b,B=C.getCommonUniforms(n,[q,y],[b.source.width,b.source.height],1,!1);b.commonUniforms={...r,...B,u_coordScale:b.coordScale}}}_getRasterFBO(b,r,n){const q=r===v.tileSize&&n===v.tileSize;return q?(this._fbo||(this._fbo=this._createNewFBO(b,r,n)),{isStandardRasterTileSize:q,fbo:this._fbo}):{isStandardRasterTileSize:q,fbo:this._createNewFBO(b,r,n)}}_createNewFBO(b,r,n){r=k.createTextureDescriptor(r,n);return new x.FramebufferObject(b,r)}_initQuad(b){this._quad||
(this._quad=new u(b,[0,0,1,0,0,1,1,1]))}_getUniformInfos(b,r,n,q){b=0<q.length?b+"-"+q.join("-"):b;if(this._rendererUniformInfos.has(b))return this._rendererUniformInfos.get(b);r=C.getUniformLocationInfos(r,n);this._rendererUniformInfos.set(b,r);return r}}return m})},"esri/views/2d/engine/imagery/RasterBitmap":function(){define("exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../DisplayObject ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),
function(l,E,h,k,v,u,D,F){const x={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class C extends u.DisplayObject{constructor(b=null,r=null,n=null){super();this._colormapTextureInvalidated=this._textureInvalidated=!0;this._colormap=this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null;
this._supportsBilinearTexture=!0;this._processedTexture=null;this.functionTextures=[];this.projected=!1;this.stencilRef=0;this.coordScale=[1,1];this._processed=!1;this.height=this._symbolizerParameters=null;this.isRendereredSource=!1;this.pixelRatio=1;this.rotation=this.resolution=0;this.rawPixelData=this._source=null;this._suspended=!1;this.width=this._transformGrid=this._interpolation=this._bandIds=null;this.y=this.x=0;this.source=b;this.transformGrid=r;this.interpolation=n}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(b){this._processedTexture!==
b&&(this._disposeTextures(!0),this._processedTexture=b)}get rasterTexture(){return this._rasterTexture}set rasterTexture(b){this._rasterTexture!==b&&(this._rasterTexture?.dispose(),this._rasterTexture=b);null==b&&(this.projected=!1)}get processed(){return this._processed}set processed(b){this._processed=b;b||(E.disposeMaybe(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||x}set symbolizerParameters(b){this._symbolizerParameters!==b&&(this._symbolizerParameters=
b,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(b){this._source!==b&&(this._source=b,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(b){this._suspended&&!b&&this.stage&&(this.ready(),this.requestRender());this._suspended=b}get bandIds(){return this._bandIds}set bandIds(b){this._bandIds=
b;this._isBandIdschanged(b)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(b){this._interpolation=b;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(b||"nearest")?D.TextureSamplingMode.LINEAR:D.TextureSamplingMode.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(b){this._transformGrid!==b&&(this._transformGrid=b,this._transformGridTexture=E.disposeMaybe(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||
(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(b=!1){b=b||this.projected;return[b?this.width:this.source?.width||this.width,b?this.height:this.source?.height||this.height]}getRasterCellSize(){const b=this.rawPixelData?.srcPixelSize,{projected:r,resolution:n}=this;return b&&!r?[b.x,b.y]:[n,n]}_createTransforms(){return{displayViewScreenMat3:k.create()}}setTransform(b){const r=h.identity(this.transforms.displayViewScreenMat3),[n,q]=b.toScreenNoRotation([0,0],[this.x,this.y]);
var y=this.resolution/this.pixelRatio/b.resolution;const B=y*this.width;y*=this.height;const A=Math.PI*this.rotation/180;h.translate(r,r,v.fromValues(n,q));h.translate(r,r,v.fromValues(B/2,y/2));h.rotate(r,r,-A);h.translate(r,r,v.fromValues(-B/2,-y/2));h.scaleByVec2(r,r,v.fromValues(B,y));h.multiply(this.transforms.displayViewScreenMat3,b.displayViewMat3,r)}getTextures({forProcessing:b=!1,useProcessedTexture:r=!1}={}){const n=r?this._processedTexture??this._rasterTexture:this._rasterTexture,q=[],
y=[];if(!n)return{names:q,textures:y};this._transformGridTexture&&!this.projected&&(y.push(this._transformGridTexture),q.push("u_transformGrid"));if(r)return y.push(n),q.push("u_image"),this._colormapTexture&&(y.push(this._colormapTexture),q.push("u_colormap")),{names:q,textures:y};y.push(n);q.push("u_image");this._colormapTexture&&!b&&(y.push(this._colormapTexture),q.push("u_colormap"));return{names:q,textures:y}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:b}){if(this.stage){var r=
this._isValidSource(this.source);r&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(b));this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(b),this._rasterTexture&&(r?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=F.createTransformTexture(b,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}updateProcessedTexture(){const {functionTextures:b}=
this;0!==b.length&&(this.processedTexture=b.shift(),b.forEach(r=>r?.dispose()),b.length=0)}_createOrDestroyRasterTexture(b){const r=this.source?.extractBands(this.bandIds);if(this._isValidSource(r)){var n=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(n)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!b.capabilities.textureFloat?.textureFloatLinear;n=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=
F.createRasterTexture(b,r,n,this.isRendereredSource||!b.capabilities.textureFloat?.textureFloat);this._processed=this.projected=!1;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)}_isBandIdschanged(b){const r=this._rasterTextureBandIds;return!(null==r&&null==b||r&&b&&r.join("")===b.join(""))}_isValidSource(b){return null!=b&&0<b.pixels?.length}_getTextureSamplingMethod(b){var {type:r}=
this.symbolizerParameters;r="lut"===r||"hillshade"===r||"stretch"===r&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||r||"bilinear"!==b&&"cubic"!==b?"nearest":"bilinear"}_updateColormapTexture(b){const r=this._colormap,n=this.symbolizerParameters.colormap;if(!n)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!r)this._colormapTexture=F.createColormapTexture(b,n),this._colormap=n;else if(n.length!==r.length||
n.some((q,y)=>q!==r[y]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=F.createColormapTexture(b,n),this._colormap=n}_disposeTextures(b=!1){!this._transformGridTexture||b&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null);!b&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormap=this._colormapTexture=null,this._colormapTextureInvalidated=!0);!b&&this._rasterTexture&&(this._rasterTexture.dispose(),
this._rasterTextureBandIds=this._rasterTexture=null);this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}class m extends C{get source(){return this._source}}l.RasterBitmap=C;l.RasterBitmapWithSource=m;l.hasSource=function(b){return null!=b.source};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],
function(l,E,h,k,v){l.createColormapTexture=function(u,D){const F=new v.TextureDescriptor;F.internalFormat=h.PixelFormat.RGBA;F.width=D.length/4;F.height=1;F.samplingMode=h.TextureSamplingMode.NEAREST;F.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new k.Texture(u,F,D)};l.createRasterTexture=function(u,D,F="nearest",x=!1){const C=(x=!(x&&"u8"===D.pixelType))?h.PixelType.FLOAT:h.PixelType.UNSIGNED_BYTE,m=null==D.pixels||0===D.pixels.length?null:x?D.getAsRGBAFloat():D.getAsRGBA(),b=u.capabilities.textureFloat?.textureFloatLinear,
r=new v.TextureDescriptor;r.width=D.width;r.height=D.height;r.internalFormat=x?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;r.samplingMode=!b||"bilinear"!==F&&"cubic"!==F?h.TextureSamplingMode.NEAREST:h.TextureSamplingMode.LINEAR;r.dataType=C;r.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new k.Texture(u,r,m)};l.createTransformTexture=function(u,D){const {spacing:F,offsets:x,coefficients:C,size:[m,b]}=D;var r=1<F[0];D=new v.TextureDescriptor;D.width=r?4*m:m;D.height=b;D.internalFormat=h.SizedPixelFormat.RGBA32F;
D.dataType=h.PixelType.FLOAT;D.samplingMode=h.TextureSamplingMode.NEAREST;D.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;const n=new Float32Array(r?m*b*16:2*x.length);if(r&&null!=C)for(let q=0,y=0;q<C.length;q++)n[y++]=C[q],2===q%3&&(n[y++]=1);else for(r=0;r<b;r++)for(let q=0;q<m;q++){const y=4*(r*m+q),B=2*(q*b+r);n[y]=x[B];n[y+1]=x[B+1];n[y+3]=-1===x[B]?0:1}return new k.Texture(u,D,n)};l.getBasicGridUniforms=function(u,D){return{u_scale:u,u_offset:D}};l.getColormapUniforms=function(u,D){return{u_colormapOffset:D||
0,u_colormapMaxIndex:u?u.length/4-1:0}};l.getCommonUniforms=function(u,D,F,x=1,C=!0){return{u_flipY:C,u_applyTransform:!!u,u_opacity:x,u_transformSpacing:u?u.spacing:E.ZEROS,u_transformGridSize:u?u.size:E.ZEROS,u_targetImageSize:D,u_srcImageSize:F}};l.getShadedReliefUniforms=function(u){return{u_hillshadeType:u.hillshadeType,u_sinZcosAs:u.sinZcosAs,u_sinZsinAs:u.sinZsinAs,u_cosZs:u.cosZs,u_weights:u.weights,u_factor:u.factor,u_minValue:u.minValue,u_maxValue:u.maxValue}};l.getStretchUniforms=function(u){return{u_bandCount:u.bandCount,
u_minOutput:u.outMin,u_maxOutput:u.outMax,u_minCutOff:u.minCutOff,u_maxCutOff:u.maxCutOff,u_factor:u.factor,u_useGamma:u.useGamma,u_gamma:u.gamma,u_gammaCorrection:u.gammaCorrection}};l.getUniformLocationInfos=function(u,D){u=u.gl;D=D.glName;const F=new Map;if(null==D)return F;const x=u.getProgramParameter(D,u.ACTIVE_UNIFORMS);let C;for(let m=0;m<x;m++)(C=u.getActiveUniform(D,m))&&F.set(C.name,{location:u.getUniformLocation(D,C.name),info:C});return F};l.setTextures=function(u,D,F,x){F.length===x.length&&
(x.some(C=>null==C)||F.some(C=>null==C)||F.forEach((C,m)=>{D.setUniform1i(C,m);u.bindTexture(x[m],m)}))};l.setUniforms=function(u,D,F){Object.keys(F).forEach(x=>{var C=D.get(x)||D.get(x+"[0]");if(C){var m=F[x];if(null!==C&&null!=m)switch({info:C}=C,C.type){case h.UniformType.FLOAT:1<C.size?u.setUniform1fv(x,m):u.setUniform1f(x,m);break;case h.UniformType.FLOAT_VEC2:u.setUniform2fv(x,m);break;case h.UniformType.FLOAT_VEC3:u.setUniform3fv(x,m);break;case h.UniformType.FLOAT_VEC4:u.setUniform4fv(x,m);
break;case h.UniformType.FLOAT_MAT3:u.setUniformMatrix3fv(x,m);break;case h.UniformType.FLOAT_MAT4:u.setUniformMatrix4fv(x,m);break;case h.UniformType.INT:1<C.size?u.setUniform1iv(x,m):u.setUniform1i(x,m);break;case h.UniformType.BOOL:u.setUniform1i(x,m?1:0);break;case h.UniformType.INT_VEC2:case h.UniformType.BOOL_VEC2:u.setUniform2iv(x,m);break;case h.UniformType.INT_VEC3:case h.UniformType.BOOL_VEC3:u.setUniform3iv(x,m);break;case h.UniformType.INT_VEC4:case h.UniformType.BOOL_VEC4:u.setUniform4iv(x,
m)}}})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/rasterColorizer":function(){define(["exports","./lut","./shadedrelief","./stretch"],function(l,E,h,k){const v=new Map;v.set("lut",E);v.set("hillshade",h);v.set("stretch",k);l.getColorizer=function(u){return v.get(u)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/lut":function(){define(["./utils","../../../../webgl/rasterUtils"],function(l,
E){const h={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(k,v,u){v=u?[]:l.getProjectionDefines(v.transformGrid);k=k.painter.materialManager.getProgram(h,v);return{defines:v,program:k}},bindTextureAndUniforms:function(k,v,u,D,F=!1){const {names:x,textures:C}=u.getTextures({useProcessedTexture:F});E.setTextures(k.context,v,x,C);E.setUniforms(v,D,u.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",u.transforms.displayViewScreenMat3);
const {colormap:m,colormapOffset:b}=u.symbolizerParameters;k=E.getColormapUniforms(m,b);E.setUniforms(v,D,k)}}})},"esri/views/2d/engine/imagery/colorizer/utils":function(){define(["exports"],function(l){l.getInterpolationDefines=function(E,h,k){k=!k.capabilities.textureFloat?.textureFloatLinear;const v=[];"cubic"===E?v.push("bicubic"):"bilinear"===E&&(h?(v.push("bilinear"),v.push("nnedge")):k&&v.push("bilinear"));return v};l.getProjectionDefines=function(E){const h=[];E&&(h.push("applyProjection"),
1===E.spacing[0]&&h.push("lookupProjection"));return h};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/shadedrelief":function(){define(["./utils","../../../../webgl/rasterUtils"],function(l,E){const h={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(k,v,u){const {colormap:D}=v.symbolizerParameters;u=u?[]:l.getProjectionDefines(v.transformGrid);v=l.getInterpolationDefines(v.interpolation,
!0,k.context);v=[...u,...v];null!=D&&v.push("applyColormap");k=k.painter.materialManager.getProgram(h,v);return{defines:v,program:k}},bindTextureAndUniforms:function(k,v,u,D,F=!1){const {names:x,textures:C}=u.getTextures({useProcessedTexture:F});E.setTextures(k.context,v,x,C);E.setUniforms(v,D,u.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",u.transforms.displayViewScreenMat3);k=u.symbolizerParameters;const {colormap:m,colormapOffset:b}=k;null!=m&&(u=E.getColormapUniforms(m,b),E.setUniforms(v,
D,u));k=E.getShadedReliefUniforms(k);E.setUniforms(v,D,k)}}})},"esri/views/2d/engine/imagery/colorizer/stretch":function(){define(["./utils","../../../../webgl/rasterUtils"],function(l,E){const h={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(k,v,u){const {colormap:D,bandCount:F}=v.symbolizerParameters;var x=u?[]:l.getProjectionDefines(v.transformGrid);const C=l.getInterpolationDefines(v.interpolation,1===F,k.context);
x=[...x,...C];v.isRendereredSource&&!u?x.push("noop"):null!=D&&x.push("applyColormap");k=k.painter.materialManager.getProgram(h,x);return{defines:x,program:k}},bindTextureAndUniforms:function(k,v,u,D,F=!1){const {names:x,textures:C}=u.getTextures({useProcessedTexture:F});E.setTextures(k.context,v,x,C);E.setUniforms(v,D,u.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",u.transforms.displayViewScreenMat3);k=u.symbolizerParameters;const {colormap:m,colormapOffset:b}=k;null!=m&&(u=E.getColormapUniforms(m,
b),E.setUniforms(v,D,u));k=E.getStretchUniforms(k);E.setUniforms(v,D,k)}}})},"esri/views/2d/engine/imagery/processor/rasterProcessor":function(){define("exports ./aspectProcessor ./bandArithmeticProcessor ./compositeBandProcessor ./contrastProcessor ./convolutionProcessor ./curvatureProcessor ./extractBandProcessor ./focalStatisticsProcessor ./grayscaleProcessor ./localProcessor ./maskProcessor ./ndviProcessor ./remapProcessor ./reprojectProcessor ./slopeProcessor ./stretchProcessor ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b,r,n,q,y,B,A,J,a){function e(p,g){const c=new a.TextureDescriptor;c.width=p;c.height=g;c.internalFormat=A.SizedPixelFormat.RGBA32F;c.samplingMode=A.TextureSamplingMode.NEAREST;c.dataType=A.PixelType.FLOAT;c.isImmutable=!0;c.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;return c}const d=new Map;d.set("arithmetic",m);d.set("aspect",E);d.set("bandarithmetic",h);d.set("compositeband",k);d.set("convolution",u);d.set("contrastbrightness",v);d.set("curvature",D);d.set("extractband",
F);d.set("statistics",x);d.set("grayscale",C);d.set("local",m);d.set("mask",b);d.set("ndvi",r);d.set("remap",n);d.set("slope",y);d.set("stretch",B);l.createTextureDescriptor=e;l.process=function(p,g,c,t){const w=p.rasterFunction.name.toLowerCase();var z="reproject"===w?q:d.get(w.toLowerCase());if(null!=z){{const {context:L,requestRender:N,allowDelayedRender:S}=p;var H=z.createProgram(p,t);S&&null!=N&&!H.compiled?(N(),H=null):(L.bindFramebuffer(c),L.setViewport(0,0,c.width,c.height),L.useProgram(H))}if(H){z.bindTextureAndUniforms(p,
H,t);({interpolation:z}=t);"reproject"===w&&(t.interpolation="nearest");g.draw();var [I,K]=t.getRasterTextureSize("reproject"===w);g=e(I,K);g=new J.Texture(p.context,g);c.copyToTexture(0,0,I,K,0,0,g);"reproject"===w?(t.rasterTexture=g,t.projected=!0,t.interpolation=z):t.functionTextures[p.hasBranches?p.rasterFunction.id:0]=g}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/aspectProcessor":function(){define(["./utils"],function(l){const E=
{vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){return h.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);h=v.getRasterTextureSize();k.setUniform2fv("u_srcImageSize",h);v=v.getRasterCellSize();k.setUniform2fv("u_cellSize",v)}}})},"esri/views/2d/engine/imagery/processor/utils":function(){define(["exports","../../../../webgl/rasterUtils"],
function(l,E){function h(u,D,F){const {context:x,rasterFunction:C,hasBranches:m}=u;({raster:u}=C.parameters);E.setTextures(x,D,["u_image"],[F.functionTextures[m?u?.id??-1:0]??F.rasterTexture])}const k=[1,1],v=[2,0,0,0,2,0,-1,-1,0];l.setCoordsAndTransforms=function(u){u.setUniform2fv("u_coordScale",k);u.setUniformMatrix3fv("u_dvsMat3",v)};l.setMultipleImageTextures=function(u,D,F){var {rasters:x}=u.rasterFunction.parameters;if(x){if(2>x.length)return h(u,D,F);var C=x.filter(m=>"Constant"!==m.name).map(m=>
null!=m.id&&"Identity"!==m.name?F.functionTextures[m.id]:F.rasterTexture);E.setTextures(u.context,D,["u_image","u_image1","u_image2"].slice(0,C.length),C);if(C.length!==x.length)if(2===x.length)C=x.findIndex(m=>"Constant"===m.name),u=0===C?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:x}=x[C].parameters,D.setUniform1f("u_image1Const",x),D.setUniformMatrix3fv("u_imageSwap",u);else if(3===x.length){const m=[];x.forEach((b,r)=>"Constant"===b.name&&m.push(r));1===m.length?({value:x}=x[m[0]].parameters,
D.setUniform1f("u_image1Const",x),D.setUniformMatrix3fv("u_imageSwap",0===m[0]?[0,1,0,0,0,1,1,0,0]:1===m[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])):2===m.length&&({value:u}=x[m[0]].parameters,D.setUniform1f("u_image1Const",u),{value:u}=x[m[1]].parameters,D.setUniform1f("u_image2Const",u),x=x.findIndex(b=>"Constant"!==b.name),D.setUniformMatrix3fv("u_imageSwap",0===x?[1,0,0,0,1,0,0,0,1]:1===x?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0]))}}};l.setSingleImageTextures=h;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/imagery/processor/bandArithmeticProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h;({indexType:h}=u.parameters);return v.materialManager.getProgram(E,[h])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);({bandIndexMat3:h}=
h.rasterFunction.parameters);k.setUniformMatrix3fv("u_bandIndexMat3",h)}}})},"esri/views/2d/engine/imagery/processor/compositeBandProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){k=h.rasterFunction.parameters.rasters.filter(u=>"Constant"===u.name);const v=[];k.length&&(v.push("oneConstant"),2===k.length&&v.push("twoConstant"));return h.painter.materialManager.getProgram(E,
v)},bindTextureAndUniforms:function(h,k,v){l.setMultipleImageTextures(h,k,v);l.setCoordsAndTransforms(k)}}})},"esri/views/2d/engine/imagery/processor/contrastProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){return h.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);
const {contrastOffset:u,brightnessOffset:D}=h.rasterFunction.parameters;k.setUniform1f("u_contrastOffset",u);k.setUniform1f("u_brightnessOffset",D)}}})},"esri/views/2d/engine/imagery/processor/convolutionProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h,{kernelRows:D,kernelCols:F}=u.parameters;return v.materialManager.getProgram(E,
[{name:"rows",value:D},{name:"cols",value:F}])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);k.setUniform2fv("u_srcImageSize",[v.width,v.height]);const {kernel:u,clampRange:D}=h.rasterFunction.parameters;k.setUniform1fv("u_kernel",u);k.setUniform2fv("u_clampRange",D)}}})},"esri/views/2d/engine/imagery/processor/curvatureProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h;({curvatureType:h}=u.parameters);return v.materialManager.getProgram(E,[h])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);const u=v.getRasterTextureSize();k.setUniform2fv("u_srcImageSize",u);({zFactor:h}=h.rasterFunction.parameters);v=v.getRasterCellSize();k.setUniform1f("u_zlFactor",200*h/v[0]/v[1])}}})},"esri/views/2d/engine/imagery/processor/extractBandProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){return h.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);({bandIndexMat3:h}=h.rasterFunction.parameters);k.setUniformMatrix3fv("u_bandIndexMat3",h)}}})},"esri/views/2d/engine/imagery/processor/focalStatisticsProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h,{kernelRows:D,kernelCols:F,fillNoDataOnly:x,statisticsType:C}=u.parameters;h=[{name:"rows",value:D},{name:"cols",value:F},C];x&&h.push("fill");return v.materialManager.getProgram(E,h)},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);k.setUniform2fv("u_srcImageSize",
[v.width,v.height]);({clampRange:h}=h.rasterFunction.parameters);k.setUniform2fv("u_clampRange",h)}}})},"esri/views/2d/engine/imagery/processor/grayscaleProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){return h.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);
({weights:h}=h.rasterFunction.parameters);k.setUniform3fv("u_weights",h)}}})},"esri/views/2d/engine/imagery/processor/localProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h){const {painter:k,rasterFunction:v}=h,{imageCount:u,operationName:D,rasters:F,isOutputRounded:x}=v.parameters;h=[D.toLowerCase()];2===u&&h.push("twoImages");const C=F.filter(m=>"Constant"===
m.name);C.length&&(h.push("oneConstant"),2===C.length&&h.push("twoConstant"));x&&h.push("roundOutput");return k.materialManager.getProgram(E,h)},bindTextureAndUniforms:function(h,k,v){l.setMultipleImageTextures(h,k,v);l.setCoordsAndTransforms(k);({domainRange:h}=h.rasterFunction.parameters);k.setUniform2fv("u_domainRange",h)}}})},"esri/views/2d/engine/imagery/processor/maskProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h;return v.materialManager.getProgram(E,1<u.parameters.bandCount?["multiBand"]:[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);const {includedRanges:u,noDataValues:D}=h.rasterFunction.parameters;k.setUniform1fv("u_includedRanges",u);k.setUniform1fv("u_noDataValues",D)}}})},"esri/views/2d/engine/imagery/processor/ndviProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h;return v.materialManager.getProgram(E,u.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);({bandIndexMat3:h}=h.rasterFunction.parameters);k.setUniformMatrix3fv("u_bandIndexMat3",h)}}})},"esri/views/2d/engine/imagery/processor/remapProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){return h.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);const {noDataRanges:u,rangeMaps:D,allowUnmatched:F,clampRange:x}=h.rasterFunction.parameters;k.setUniform1fv("u_noDataRanges",u);k.setUniform1fv("u_rangeMaps",D);k.setUniform1f("u_unmatchMask",
F?1:0);k.setUniform2fv("u_clampRange",x)}}})},"esri/views/2d/engine/imagery/processor/reprojectProcessor":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../webgl/rasterUtils"],function(l,E){const h={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(k,v){const {painter:u}=k,D=[],{interpolation:F,transformGrid:x}=v;k=k.rasterFunction?.parameters;"cubic"===F?D.push("bicubic"):
"bilinear"===F&&(D.push("bilinear"),k?.requireNNEdge&&D.push("nnedge"));x&&(D.push("applyProjection"),1===x.spacing[0]&&D.push("lookupProjection"));return u.materialManager.getProgram(h,D)},bindTextureAndUniforms:function(k,v,u){const {names:D,textures:F}=u.getTextures({forProcessing:!0});E.setTextures(k.context,v,D,F);v.setUniform1f("u_scale",1);v.setUniform2fv("u_offset",[0,0]);v.setUniform2fv("u_coordScale",[1,1]);v.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]);v.setUniform1i("u_flipY",
0);v.setUniform1f("u_opacity",1);const {width:x,height:C,source:m,transformGrid:b}=u;v.setUniform2fv("u_srcImageSize",[m.width,m.height]);v.setUniform2fv("u_targetImageSize",[x,C]);v.setUniform2fv("u_transformSpacing",b?b.spacing:l.ZEROS);v.setUniform2fv("u_transformGridSize",b?b.size:l.ZEROS)}}})},"esri/views/2d/engine/imagery/processor/slopeProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",
1]])};return{createProgram:function(h,k){const {painter:v,rasterFunction:u}=h;({slopeType:h}=u.parameters);return v.materialManager.getProgram(E,"percent-rise"===h?["percentRise"]:[])},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);const u=v.getRasterTextureSize();k.setUniform2fv("u_srcImageSize",u);v=v.getRasterCellSize();k.setUniform2fv("u_cellSize",v);const {zFactor:D,slopeType:F,pixelSizePower:x,pixelSizeFactor:C}=h.rasterFunction.parameters;
k.setUniform1f("u_zFactor",D);k.setUniform1f("u_pixelSizePower","adjusted"===F?x:0);k.setUniform1f("u_pixelSizeFactor","adjusted"===F?C:0)}}})},"esri/views/2d/engine/imagery/processor/stretchProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,k){const {useGamma:v,bandCount:u,isOutputRounded:D}=h.rasterFunction.parameters;k=[];v&&k.push("useGamma");1<
u&&k.push("multiBand");D&&k.push("roundOutput");return h.painter.materialManager.getProgram(E,k)},bindTextureAndUniforms:function(h,k,v){l.setSingleImageTextures(h,k,v);l.setCoordsAndTransforms(k);const {width:u,height:D}=v;h=h.rasterFunction.parameters;k.setUniform2fv("u_srcImageSize",[u,D]);k.setUniform1f("u_minOutput",h.outMin);k.setUniform1f("u_maxOutput",h.outMax);k.setUniform1fv("u_factor",h.factor);k.setUniform1fv("u_minCutOff",h.minCutOff);k.setUniform1fv("u_maxCutOff",h.maxCutOff);k.setUniform1fv("u_gamma",
h.gamma);k.setUniform1fv("u_gammaCorrection",h.gammaCorrection)}}})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(l,E,h,k){class v extends k.TiledDisplayObject{constructor(u,D,F,x,C,m,b=null){super(u,D,F,x,C,m);this.bitmap=null;this.bitmap=new h.RasterBitmap(b,null,null);this.bitmap.coordScale=[C,m];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();
this.bitmap.destroy();this.stage=this.bitmap=null}set stencilRef(u){this.bitmap.stencilRef=u}get stencilRef(){return this.bitmap.stencilRef}setTransform(u){super.setTransform(u);this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:E.create(),tileMat3:E.create()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}l.RasterTile=v;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b,r,n,q,y,B,A,J,a,e,d,p){const g=[0,0];l.BaseImageryTileSubView2D=class extends k{constructor(){super(...arguments);this._updatingHandles=new m.UpdatingHandles;this._blockCacheRegistryId=this._blockCacheRegistryUrl=this._fetchQueue=this._tileInfoView=this._tileStrategy=this._emptyTilePixelBlock=null;this._srcResolutions=[];this.previousLOD=null;this._needBlockCacheUpdate=!1;this._abortController=this._symbolizerParams=this._globalSymbolizerParams=null;this._isCustomTilingScheme=
!1;this._maxIndexedColormapSize=0;this._rasterFunctionState="na";this.attached=this._globalUpdateRequested=!1;this.timeExtent=null;this.redrawOrRefetch=u.debounce(async(c={})=>{const t=this._rasterFunctionState;c.reprocess&&(await this._updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters());if(this.previousLOD&&!this.layerView.suspended){var w=this._rasterFunctionState,{type:z}=this;return c.refetch||"raster"!==z&&c.reprocess||"cpu"===w||"cpu"===t?this._updatingHandles.addPromise(this.doRefresh()):
this._updatingHandles.addPromise(this._redrawImage(c.signal))}})}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(c){this._set("useWebGLForProcessing",c)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(c){if(this._tileStrategy&&this.useProgressiveUpdate!==c){this._tileStrategy.destroy();this.container.removeAllChildren();const t=this._getCacheSize(c);this._tileStrategy=
new a({cachePolicy:"purge",acquireTile:w=>this.acquireTile(w),releaseTile:w=>this.releaseTile(w),cacheSize:t,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",c);this.layerView.requestUpdate()}}update(c){this._fetchQueue.pause();this._fetchQueue.state=c.state;this._tileStrategy.update(c);this._fetchQueue.resume();const {extent:t,resolution:w,scale:z}=c.state;c=this._tileInfoView.getClosestInfoForScale(z);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const H=
this._srcResolutions[c.level],I=t.toJSON?t:p.fromJSON(t);q.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,I,w,H,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;this.previousLOD?.level!==c.level&&(this.previousLOD=c,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),
this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const c=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(c);this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){this._maxIndexedColormapSize=4*(d.getWebGLCapabilities().maxTextureSize||4096);this._initializeTileInfo();
this._tileInfoView=new B(this.layerView.tileInfo,this.layerView.fullExtent);var c=this._computeFetchConcurrency();this._fetchQueue=new J({tileInfoView:this._tileInfoView,concurrency:c,process:(t,w)=>this._fetchTile(t,w)});c=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new a({cachePolicy:"purge",acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),cacheSize:c,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy();
this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;q.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(c){c=this.container.createTile(c);this._updatingHandles.addPromise(this._enqueueTileFetch(c));this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;
return c}releaseTile(c){this._fetchQueue.abort(c.key.id);this.container.removeChild(c);c.once("detach",()=>{c.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()}createEmptyTilePixelBlock(c=null){const t=null==c||c.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;c=c||this._tileInfoView.tileInfo.size;const [w,z]=c;c=new r({width:w,height:z,pixels:[new Uint8Array(w*z)],mask:new Uint8Array(w*z),pixelType:"u8"});
t&&(this._emptyTilePixelBlock=c);return c}_getBandIds(){if(!("rasterFunctionChain"in this.container&&this.container.rasterFunctionChain))return this.layer.bandIds;const {bandIds:c,raster:t}=this.layer,w="rasterFunction"in t?t.rasterFunction.rawInputBandIds:null;return c?.length&&w?.length&&1!==t.rasterInfo.bandCount?c.map(z=>w[Math.min(z,w.length-1)]):c||w}updateRasterFunctionParameters(){}_fetchTile(c,t){t=null!=t?t.signal:null;const w=this.canUseWebGLForProcessing(),{layerView:z}=this,{tileInfo:H}=
z,I=!H.isWrappable&&null!=y.getWorldWidth(z.view.spatialReference);return this.fetchTile(c,{allowPartialFill:!0,datumTransformation:z.datumTransformation,interpolation:w?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:w&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:t,srcResolution:this._srcResolutions[c.level],timeExtent:z.timeExtent,tileInfo:H,disableWrapAround:I})}_getCacheSize(c){return c?
40:0}_initializeTileInfo(){const {layerView:c}=this;var t=c.view.spatialReference;if(this._canUseLayerLODs()){const {origin:S,lods:U}=this.layer.tileInfo;var w=U.map(({scale:R})=>R);t=n.create({spatialReference:t,size:e.tileSize,scales:w,origin:S});c.set("tileInfo",t);this._srcResolutions=U.map(({resolution:R})=>({x:R,y:R}))}else{var {scales:z,srcResolutions:H,isCustomTilingScheme:I}=y.computeProjectedScales(this.layer.serviceRasterInfo,t,{tileSize:e.tileSize,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1});
w=n.create({spatialReference:t,size:e.tileSize,scales:z});var K=0===w.origin.x,{xmin:L,ymax:N}=c.fullExtent;if(K||I&&w.origin.x>L)w.origin=new b({x:L,y:N,spatialReference:t});this._isCustomTilingScheme=I;c.set("tileInfo",w);this._srcResolutions=H??[]}}_canUseLayerLODs(){const {layer:c,layerView:t}=this;if("Map"!==c.raster.tileType)return!1;const {lods:w}=c.tileInfo,z=t.view.constraints?.effectiveLODs;return z?.length===w.length&&z.every(({scale:H},I)=>.001>Math.abs(H-w[I].scale))}_computeFetchConcurrency(){var {blockBoundary:c}=
this.layer.serviceRasterInfo.storageInfo;c=c[c.length-1];return 64<(c.maxCol-c.minCol+1)*(c.maxRow-c.minRow+1)?2:10}async _enqueueTileFetch(c,t){if(!this._fetchQueue.has(c.key.id)){try{const w=await this._fetchQueue.push(c.key),z=this._getBandIds();let H=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){H=!1;try{await this._redrawImage(this._abortController?.signal)}catch(L){u.isAbortError(L)&&
v.getLogger(this).error(L)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const I=this._tileInfoView.getTileCoords(g,c.key),K=this._tileInfoView.getTileResolution(c.key);await this.updateTileSource(c,{source:w,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:H,bandIds:z,coords:I,resolution:K});c.once("attach",()=>
this.layerView.requestUpdate());this.container.addChild(c)}catch(w){u.isAbortError(w)||v.getLogger(this).error(w)}this.layerView.requestUpdate()}}async _redrawImage(c){0!==this.container.children.length&&(await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(c):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),c=this.container.children.map(async t=>this.updateTileSymbolizerParameters(t,{local:this._symbolizerParams,global:this._globalSymbolizerParams})),
await Promise.allSettled(c),this.container.requestRender())}async _updateGlobalSymbolizerParams(c){c=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:c});if(c?.pixelBlock){var {resolution:t}=this.previousLOD,w=this._getBandIds();c=this.layer.symbolizer.generateWebGLParameters({pixelBlock:c.pixelBlock.extractBands(w),isGCS:this.layerView.view.spatialReference.isGeographic,
resolution:{x:t,y:t},bandIds:w});!this.canUseWebGLForProcessing()&&c&&"stretch"===c.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(c.factor=c.factor.map(z=>255*z),c.outMin=Math.round(255*c.outMin),c.outMax=Math.round(255*c.outMax));this._globalSymbolizerParams=c}}_updateSymbolizerParams(){const {resolution:c}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,
resolution:{x:c,y:c},bandIds:t})}_updateBlockCacheRegistry(c=!1){const {layer:t,layerView:w}=this,{raster:z}=t;var {multidimensionalDefinition:H}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:w.timeExtent});H=z.rasterInfo.multidimensionalInfo?z.getSliceIndex(H):null;H=q.getRasterId(z.rasterId,H);if(H!==this._blockCacheRegistryUrl){null!=this._blockCacheRegistryUrl&&q.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryId=
q.register(H,z.rasterInfo);if(c){({view:c}=w);const I=this._tileInfoView.getClosestInfoForScale(c.scale);q.update(H,this._blockCacheRegistryId,c.extent,c.resolution,this._srcResolutions[I.level],z.ioConfig.sampling)}this._blockCacheRegistryUrl=H}}async doRefresh(){if(this.attached&&this.previousLOD&&!this.layerView.suspended){await this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var c=[];this._globalUpdateRequested=
this.layerView.hasTilingEffects||!this.useProgressiveUpdate;this._tileStrategy.refresh(t=>c.push(this._enqueueTileFetch(t)));await this._updatingHandles.addPromise(Promise.allSettled(c))}}};E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"attached",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"container",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,
"layer",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"layerView",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"type",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);E.__decorate([D.property()],l.BaseImageryTileSubView2D.prototype,
"updating",null);l.BaseImageryTileSubView2D=E.__decorate([C.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],l.BaseImageryTileSubView2D);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(l,E,h,k,v,u,D,F,x,C){var m;h=m=class extends h.JSONSupport{static createEmptyBand(b,r){return new (m.getPixelArrayConstructor(b))(r)}static combineBandMasks(b){if(2>b.length)return b[0];const r=b[0].length,n=(new Uint8Array(r)).fill(255);for(let q=0;q<b.length;q++){const y=b[q];for(let B=0;B<r;B++)y[B]||(n[B]=0)}return n}static getPixelArrayConstructor(b){let r;switch(b){case "u1":case "u2":case "u4":case "u8":r=Uint8Array;break;case "u16":r=Uint16Array;break;case "u32":r=Uint32Array;break;
case "s8":r=Int8Array;break;case "s16":r=Int16Array;break;case "s32":r=Int32Array;break;case "f32":r=Float32Array;break;case "f64":r=Float64Array;break;case "c64":case "c128":case "unknown":r=Float32Array}return r}constructor(b){super(b);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(b){if(!b)return"f32";b=b.toLowerCase();["u1","u2","u4"].includes(b)?b="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(b)||
(b="f32");return b}getPlaneCount(){return this.pixels?.length}addData(b){if(!b.pixels||b.pixels.length!==this.width*this.height)throw new E("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(b.pixels);this.statistics.push(b.statistics??new x.SimpleBandStatistics)}getAsRGBA(){const b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(b);
break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)}getAsRGBAFloat(){const b=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(n=>this._calculateBandStatistics(n,this.mask));var b=this.mask,r=0;if(null!=b)for(let n=0;n<b.length;n++)b[n]&&r++;else r=this.width*this.height;this.validPixelCount=r}}clamp(b){if(b&&"f64"!==b&&"f32"!==b&&this.pixels){var [r,n]=C.getPixelValueRange(b),q=this.pixels,
y=this.width*this.height,B=q.length,A=[];for(let d=0;d<B;d++){var J=m.createEmptyBand(b,y);var a=q[d];for(let p=0;p<y;p++){var e=a[p];J[p]=e>n?n:e<r?r:e}A.push(J)}this.pixels=A;this.pixelType=b}}extractBands(b){const {pixels:r,statistics:n}=this;if(null==b||0===b.length||!r||0===r.length)return this;var q=r.length;const y=b.some(d=>d>=r.length),B=q===b.length&&!b.some((d,p)=>d!==p);if(y||B)return this;q=this.bandMasks?.length===q?b.map(d=>this.bandMasks[d]):void 0;let {mask:A,validPixelCount:J}=this;
const {width:a,height:e}=this;q?.length&&(A=m.combineBandMasks(q),J=A.filter(d=>!!d).length);return new m({pixelType:this.pixelType,width:a,height:e,mask:A,bandMasks:q,validPixelCount:J,maskIsAlpha:this.maskIsAlpha,pixels:b.map(d=>r[d]),statistics:n&&b.map(d=>n[d])})}clone(){const b=new m({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):
this.mask.slice(0));this.bandMasks&&(b.bandMasks=this.bandMasks.map(q=>new Uint8Array(q)));let r;const n=m.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=[];const q=!!this.pixels[0].slice;for(r=0;r<this.pixels.length;r++)b.pixels[r]=q?this.pixels[r].slice(0,this.pixels[r].length):new n(this.pixels[r])}if(this.statistics)for(b.statistics=[],r=0;r<this.statistics.length;r++)b.statistics[r]=k.clone(this.statistics[r]);b.premultiplyAlpha=this.premultiplyAlpha;
return b}_fillFrom8Bit(b){const {mask:r,maskIsAlpha:n,premultiplyAlpha:q,pixels:y}=this;if(b&&y?.length){var B,A;var J=B=A=y[0];3<=y.length?(B=y[1],A=y[2]):2===y.length&&(B=y[1]);var a=new Uint32Array(b),e=this.width*this.height;if(J.length!==e)v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=r&&r.length===e)if(n)for(b=0;b<e;b++){const d=r[b];if(d){const p=d/255;a[b]=q?d<<24|A[b]*p<<16|B[b]*p<<8|J[b]*p:d<<24|A[b]<<16|B[b]<<8|J[b]}}else for(b=
0;b<e;b++)r[b]&&(a[b]=-16777216|A[b]<<16|B[b]<<8|J[b]);else for(b=0;b<e;b++)a[b]=-16777216|A[b]<<16|B[b]<<8|J[b]}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(b){const {pixels:r,mask:n,statistics:q}=this;if(b&&r?.length){var y=this.pixelType,B=1,A=0;B=1;if(q&&0<q.length){for(var J of q)null!=J.minValue&&(A=Math.min(A,J.minValue)),null!=J.maxValue&&null!=J.minValue&&(B=Math.max(B,J.maxValue-J.minValue));B=255/B}else B=255,
"s8"===y?(A=-128,B=127):"u16"===y?B=65535:"s16"===y?(A=-32768,B=32767):"u32"===y?B=4294967295:"s32"===y?(A=-2147483648,B=2147483647):"f32"===y?(A=-3.4*1E39,B=3.4*1E39):"f64"===y&&(A=-Number.MAX_VALUE,B=Number.MAX_VALUE),B=255/(B-A);b=new Uint32Array(b);y=this.width*this.height;var a,e,d;J=a=e=r[0];if(J.length!==y)return v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=r.length)if(a=r[1],3<=r.length&&(e=r[2]),null!=n&&n.length===y)for(d=0;d<y;d++)n[d]&&
(b[d]=-16777216|(e[d]-A)*B<<16|(a[d]-A)*B<<8|(J[d]-A)*B);else for(d=0;d<y;d++)b[d]=-16777216|(e[d]-A)*B<<16|(a[d]-A)*B<<8|(J[d]-A)*B;else if(null!=n&&n.length===y)for(d=0;d<y;d++)a=(J[d]-A)*B,n[d]&&(b[d]=-16777216|a<<16|a<<8|a);else for(d=0;d<y;d++)a=(J[d]-A)*B,b[d]=-16777216|a<<16|a<<8|a}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(b){const {pixels:r,mask:n}=this;if(!b||!r?.length)return v.getLogger(this).error("getAsRGBAFloat()",
"Unable to convert to RGBA. The input pixel block is empty.");let q,y,B,A;q=y=B=r[0];3<=r.length?(y=r[1],B=r[2]):2===r.length&&(y=r[1]);const J=this.width*this.height;if(q.length!==J)return v.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=n&&n.length===J)for(A=0;A<J;A++)b[a++]=q[A],b[a++]=y[A],b[a++]=B[A],b[a++]=n[A]&1;else for(A=0;A<J;A++)b[a++]=q[A],b[a++]=y[A],b[a++]=B[A],b[a++]=1}_calculateBandStatistics(b,r){let n=Infinity,q=
-Infinity;const y=b.length;let B,A=0;if(null!=r)for(B=0;B<y;B++)r[B]&&(A=b[B],n=A<n?A:n,q=A>q?A:q);else for(B=0;B<y;B++)A=b[B],n=A<n?A:n,q=A>q?A:q;return new x.SimpleBandStatistics(n,q)}};l.__decorate([u.property({json:{write:!0}})],h.prototype,"width",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"height",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"pixelType",void 0);l.__decorate([D.cast("pixelType")],h.prototype,"castPixelType",null);l.__decorate([u.property({json:{write:!0}})],
h.prototype,"validPixelCount",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"mask",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"maskIsAlpha",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"pixels",void 0);l.__decorate([u.property()],h.prototype,"premultiplyAlpha",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"statistics",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"depthCount",void 0);l.__decorate([u.property({json:{write:!0}})],
h.prototype,"noDataValues",void 0);l.__decorate([u.property({json:{write:!0}})],h.prototype,"bandMasks",void 0);return h=m=l.__decorate([F.subclass("esri.layers.support.PixelBlock")],h)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(l){class E{constructor(h=null,k=null,v=null){this.minValue=h;this.maxValue=k;this.noDataValue=v}}l.SimpleBandStatistics=E;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],
function(l){function E(k){return h[k]??[-3.4028234663852886E38,3.4028234663852886E38]}const h={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};l.convertNoDataToMask=function(k,v,u){if(!(k.depthCount&&1<k.depthCount)){var {pixels:D,statistics:F,pixelType:x}=k,C=D[0].length,m=k.bandMasks??
[];C=k.mask??(new Uint8Array(C)).fill(255);var b="f32"===x||"f64"===x,r=E(x),n=!1;for(let B=0;B<D.length;B++){const A="number"===typeof v?v:v[B];if(null==A)continue;var q=F?.[B]?.maxValue??r[1];if((F?.[B]?.minValue??r[0])>A+Number.EPSILON||q<A-Number.EPSILON)continue;q=m[B]||C.slice();const J=D[B];var y=u?.customFloatTolerance;if(b&&0!==y){y||=9.999999E37<=Math.abs(A)?2E-7*Math.abs(A):"f32"===x?2**-23:Number.EPSILON;for(let a=0;a<J.length;a++)q[a]&&Math.abs(J[a]-A)<y&&(J[a]=0,q[a]=0,C[a]=0,n=!0)}else for(y=
0;y<J.length;y++)q[y]&&J[y]===A&&(J[y]=0,q[y]=0,C[y]=0,n=!0);m[B]=q}n&&(k.bandMasks=k.bandMasks||1<k.pixels.length?m:null,k.mask=C);n&&"updateStatistics"in k&&k.updateStatistics()}};l.getIntegerPixelType=function(k,v){return null==k||null==v?"s32":0>k?-128<=k&&128>v?"s8":-32768<=k&&32768>v?"s16":"s32":256>v?"u8":65536>v?"u16":"u32"};l.getPixelValueRange=E;l.isIntegerPixelType=function(k){return(k?.startsWith("s")||k?.startsWith("u"))??!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports","../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper","../../../geometry/Point"],function(l,E,h,k,v){function u(x,C){return(x=D.get(x))?x[C]??null:null}const D=new Map,F=new h;l.decreaseRefCount=function(x,C,m){const b=D.get(x);if(!b)return null==C?F.decreaseRefCount(x,m):0;if(null==C||null==b[C])return F.decreaseRefCount(x,m);C=b[C]?.cache;x=C?.get(m);if(C&&x){x.refCount--;if(0===x.refCount){C.delete(m);
for(C=0;C<b.length;C++)b[C]?.cache.delete(m);x.controller&&x.controller.abort()}return x.refCount}return 0};l.deleteBlock=function(x,C,m){const b=D.get(x);b?null==C||null==b[C]?F.deleteBlock(x,m):b[C]?.cache.delete(m):null==C&&F.deleteBlock(x,m)};l.deleteRaster=function(x){D.delete(x)};l.getBlock=function(x,C,m){const b=D.get(x);if(!b)return null==C?F.getBlock(x,m):null;if(null==C||null==b[C]){for(C=0;C<b.length;C++){var r=b[C]?.cache.get(m);if(r)return r.refCount++,r.block}return F.getBlock(x,m)}if(x=
b[C]?.cache.get(m))return x.refCount++,x.block;for(x=0;x<b.length;x++){if(x===C||!b[x])continue;r=b[x]?.cache;const n=r?.get(m);if(r&&n)return n.refCount++,r.set(m,n),n.block}return null};l.getRasterId=function(x,C){return null==C?x:`${x}?sliceId=${C}`};l.putBlock=function(x,C,m,b,r=null){const n=D.get(x);if(n)if(null==C||null==n[C])F.putBlock(x,m,b,r);else{var q={refCount:1,block:b,isResolved:!1,isRejected:!1,controller:r};b.then(()=>q.isResolved=!0).catch(()=>q.isRejected=!0);n[C]?.cache.set(m,
q)}else null==C&&F.putBlock(x,m,b,r)};l.register=function(x,C){C={extent:null,rasterInfo:C,cache:new Map};const m=D.get(x);if(m)return m.push(C),m.length-1;D.set(x,[C]);return 0};l.unregister=function(x,C){const m=D.get(x);m&&(m[C]=null,m.some(b=>null!=b)||D.delete(x))};l.update=function(x,C,m,b,r,n,q=null){if(x=u(x,C)){C=x.extent;var {cache:y,rasterInfo:B}=x;if(!C||C.xmin!==m.xmin||C.xmax!==m.xmax||C.ymin!==m.ymin||C.ymax!==m.ymax){b=b??0;C=m.clone().normalize();var {spatialReference:A,transform:J}=
B,a=new Set;for(let t=0;t<C.length;t++){var e=C[t];if(e.xmax-e.xmin<=b||e.ymax-e.ymin<=b)continue;var d=k.projectExtent(e,A,q);null!=J&&(d=J.inverseTransform(d));var p=new v({x:b,y:b,spatialReference:e.spatialReference});if(null==r&&(r=k.projectResolution(p,A,e,q),!r))return;const {pyramidLevel:w,pyramidResolution:z,excessiveReading:H}=k.snapPyramid(r,B,n||"closest");if(H)return;({storageInfo:e}=B);var {origin:g}=e;p=Math.max(0,Math.floor((d.xmin-g.x)/z.x));g=Math.max(0,Math.floor((g.y-d.ymax)/z.y));
const I=0<w?e.pyramidBlockWidth:e.blockWidth,K=0<w?e.pyramidBlockHeight:e.blockHeight;e=Math.max(0,Math.floor(p/I)-1);var c=Math.max(0,Math.floor(g/K)-1);p=Math.floor((p+Math.ceil((d.xmax-d.xmin)/z.x-.1)-1)/I)+1;d=Math.floor((g+Math.ceil((d.ymax-d.ymin)/z.y-.1)-1)/K)+1;for(g=c;g<=d;g++)for(c=e;c<=p;c++)a.add(`${w}/${g}/${c}`)}y.forEach((t,w)=>{a.has(w)||(t=y.get(w),(null==t||t.isResolved||t.isRejected)&&y.delete(w))});x.extent={xmin:m.xmin,ymin:m.ymin,xmax:m.xmax,ymax:m.ymax}}}};Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){class l{constructor(E=15E3,h=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=E;this._interval=Math.min(E,h)}decreaseRefCount(E,h){E=E+"/"+h;h=this._cachedBlocks;if(h.has(E)){const k=h.get(E);k.refCount--;0>=k.refCount&&(h.delete(E),k.controller&&k.controller.abort());return k.refCount}return 0}getBlock(E,h){E=E+"/"+h;h=this._cachedBlocks;if(h.has(E)){const k=
h.get(E);k.ts=Date.now();k.refCount++;h.delete(E);h.set(E,k);return k.block}return null}putBlock(E,h,k,v){const u=this._cachedBlocks;E=E+"/"+h;u.has(E)?(k=u.get(E),k.ts=Date.now(),k.refCount++):u.set(E,{block:k,ts:Date.now(),refCount:1,controller:v});this._trim();this._updateTimer()}deleteBlock(E,h){const k=this._cachedBlocks;E=E+"/"+h;k.has(E)&&k.delete(E)}updateMaxSize(E){this._size=E;this._trim()}empty(){this._cachedBlocks.clear();this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null==
this._timer){var E=this._cachedBlocks;this._timer=setInterval(()=>{const h=Array.from(E),k=Date.now();for(let v=0;v<h.length;v++)if(h[v][1].ts<=k-this._duration)E.delete(h[v][0]);else break;0===E.size&&this._clearTimer()},this._interval)}}_trim(){const E=this._cachedBlocks;if(!(-1===this._size||this._size>=E.size)){var h=Array.from(E);for(let k=0;k<h.length-this._size;k++)E.delete(h[k][0])}}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}return l})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m,b){function r(f,G,M){return!D.canProjectWithoutEngine(f,G,M)}function n(f,G,M){if((f=r(f,G,M))&&!D.isLoaded())throw new k("rasterprojectionhelper-project","projection engine is not loaded");return f}function q(f,G,M){n(f.spatialReference,G);return M?D.getTransformation(G,f.spatialReference,f):D.getTransformation(f.spatialReference,G,f)}function y(f,G,M,O=null){const T=f.spatialReference;if(T.equals(G))return f;n(T,G,O);M=M.center;M=new x({xmin:M.x-f.x/2,xmax:M.x+f.x/
2,ymin:M.y-f.y/2,ymax:M.y+f.y/2,spatialReference:T});O=D.project(M,G,O);M=K(G);null==O||null!=M&&O.width>=M?(G=v.getMetersPerUnitForSR(T)/v.getMetersPerUnitForSR(G),f={x:f.x*G,y:f.y*G}):f={x:O.width,y:O.height};return f}function B(f,G=.01){return v.getMetersPerUnitForSR(f)?G/v.getMetersPerUnitForSR(f):0}function A(f,G,M=null,O=!0){const T=f.spatialReference;if(T.equals(G))return f;n(T,G,M);M=D.project(f,G,M);if(!O||!M)return M;J([f],[M],T,G);return M}function J(f,G,M,O){const T=L(M,!0),P=L(O,!0);
M=B(M,500);O=B(O,500);if(M&&null!=T&&null!=P)for(let V=0;V<f.length;V++){const W=G[V];if(!W)continue;const {x:Q}=f[V],{x:ca}=W;ca>=P[1]-O&&Math.abs(Q-T[0])<M?W.x-=P[1]-P[0]:ca<=P[0]+O&&Math.abs(Q-T[1])<M&&(W.x+=P[1]-P[0])}}function a(f){const {inSR:G,outSR:M,datumTransformation:O,preferPE:T}=f;if(G.equals(M))return{points:f}=c(f,null),f;if(G.isWebMercator&&M.isWGS84||G.isWGS84&&M.isWebMercator){const {cols:Q,rows:ca,xres:Z,yres:ja,usePixelCenter:ia,inSR:ha,outSR:la}=f;let {xmin:ma,ymax:na}=f;ia&&
(ma+=Z/2,na-=ja/2);f=[];const fa=[];var P=Math.max(Q,ca);for(var V=0;V<P;V++){var W=D.project(new C({x:ma+Z*Math.min(Q,V),y:na-ja*Math.min(ca,V),spatialReference:ha}),la);V<=Q&&f.push(W.x);V<=ca&&fa.push(W.y)}P=[];for(V=0;V<Q;V++)for(W=0;W<ca;W++)P.push([f[V],fa[W]]);return P}return n(G,M,O)&&T&&(G.isGeographic||null!=p(G))?d(f):e(f)}function e(f){var {points:G}=c(f,null);const {inSR:M,outSR:O,datumTransformation:T}=f;f=G.map(P=>new C(P[0],P[1],M));G=D.project(f,O,T);T&&J(f,G,M,O);return G.map(P=>
P?[P.x,P.y]:[NaN,NaN])}function d(f){const {inSR:G,outSR:M,datumTransformation:O}=f;var T=p(G);const {points:P,mask:V}=c(f,T);G.isGeographic||(f=G.wkid?u.PeFactory.coordsys(G.wkid):u.PeFactory.fromString(G.isGeographic?u.PeDefs.PE_TYPE_GEOGCS:u.PeDefs.PE_TYPE_PROJCS,G.wkt2||G.wkt),u.PeCSTransformations.projToGeog(f,P.length,P));if(null!=O&&O.steps.length){var W;M.isGeographic&&(W=P.map(([Q])=>179.9955<Q?1:-179.9955>Q?-1:0));O.steps.forEach(Q=>{const ca=Q.wkid?u.PeFactory.geogtran(Q.wkid):u.PeFactory.fromString(u.PeDefs.PE_TYPE_GEOGTRAN,
Q.wkt);u.PeGTTransformations.geogToGeog(ca,P.length,P,null,Q.isInverse?u.PeDefs.PE_TRANSFORM_2_TO_1:u.PeDefs.PE_TRANSFORM_1_TO_2)});if(W)for(f=0;f<P.length;f++){T=W[f];const Q=P[f][0],ca=179.9955<Q?1:-179.9955>Q?-1:0;T&&ca&&T!==ca&&(P[f][0]=0<T?Q+360:Q-360)}}M.isGeographic||(W=p(M,!0),t(P,null!=W&&W.isEnvelope?[W.bbox[1],W.bbox[3]]:[-90,90]),W=M.wkid?u.PeFactory.coordsys(M.wkid):u.PeFactory.fromString(M.isGeographic?u.PeDefs.PE_TYPE_GEOGCS:u.PeDefs.PE_TYPE_PROJCS,M.wkt2||M.wkt),u.PeCSTransformations.geogToProj(W,
P.length,P));W=P;if(V&&P.length!==V.length){W=[];for(let Q=0,ca=0;Q<V.length;Q++)V[Q]?W.push(P[ca++]):W.push([NaN,NaN])}return W}function p(f,G=!1){var M=f.wkid||f.wkt2||f.wkt;if(!M||f.isGeographic)return null;M=String(M);if(ea.has(M))return M=ea.get(M),G?M?.gcs:M?.pcs;var O=f.wkid?u.PeFactory.coordsys(f.wkid):u.PeFactory.fromString(f.isGeographic?u.PeDefs.PE_TYPE_GEOGCS:u.PeDefs.PE_TYPE_PROJCS,f.wkt2||f.wkt);f=B(f,1E-4);f=g(O,f);O=g(O,0,!0);ea.set(M,{pcs:f,gcs:O});return G?O:f}function g(f,G=0,M=
!1){var O=u.PePCSInfo.generate(f),T=M?f.horizonGcsGenerate():f.horizonPcsGenerate();if(!O||!T?.length)return null;f=!1;var P=T.find(Z=>1===Z.getInclusive()&&1===Z.getKind());if(!P){P=T.find(Z=>1===Z.getInclusive()&&0===Z.getKind());if(!P)return null;f=!0}M=M?0:(2===O.getNorthPoleLocation()?1:0)|(2===O.getSouthPoleLocation()?2:0);O=O.isPannableRectangle();P=P.getCoord();if(f)return{isEnvelope:f,isPannable:O,vertices:P,coef:null,bbox:[P[0][0]-G,P[0][1]-G,P[1][0]+G,P[1][1]+G],poleLocation:M};G=0;f=[];
let [V,W]=P[0],[Q,ca]=P[0];for(let Z=0,ja=P.length;Z<ja;Z++){G++;G===ja&&(G=0);const [ia,ha]=P[Z],[la,ma]=P[G];if(ma===ha)f.push([ia,la,ha,ma,2]);else{T=(la-ia)/(ma-ha||1E-4);const na=ia-T*ha;ha<ma?f.push([T,na,ha,ma,0]):f.push([T,na,ma,ha,1])}V=V<ia?V:ia;W=W<ha?W:ha;Q=Q>ia?Q:ia;ca=ca>ha?ca:ha}return{isEnvelope:!1,isPannable:O,vertices:P,coef:f,bbox:[V,W,Q,ca],poleLocation:M}}function c(f,G){const M=[],{cols:O,rows:T,xres:P,yres:V,usePixelCenter:W}=f;let {xmin:Q,ymax:ca}=f;W&&(Q+=P/2,ca-=V/2);if(null==
G){for(f=0;f<O;f++)for(G=0;G<T;G++)M.push([Q+P*f,ca-V*G]);return{points:M}}f=new Uint8Array(O*T);if(G.isEnvelope){const {bbox:[na,fa,pa,qa]}=G;for(let ra=0,sa=0;ra<O;ra++){var Z=Q+P*ra,ja=G.isPannable||Z>=na&&Z<=pa;for(var ia=0;ia<T;ia++,sa++){var ha=ca-V*ia;ja&&ha>=fa&&ha<=qa&&(M.push([Z,ha]),f[sa]=1)}}return{points:M,mask:f}}Z=G.coef;G=[];for(ja=0;ja<T;ja++){var la=ca-V*ja;ia=[];ha=[];for(var ma=0;ma<Z.length;ma++){const [na,fa,pa,qa,ra]=Z[ma];la===pa&&pa===qa?(ia.push(na),ia.push(fa),ha.push(2),
ha.push(2)):la>=pa&&la<=qa&&(ia.push(na*la+fa),ha.push(ra))}la=ia;if(2<ia.length){ma=2===ha[0]?0:ha[0];let na=ia[0];la=[];for(let fa=1;fa<ha.length;fa++)if(2!==ha[fa]||fa===ha.length-1)ha[fa]!==ma&&(la.push(0===ma?Math.min(na,ia[fa-1]):Math.max(na,ia[fa-1])),ma=ha[fa],na=ia[fa]),fa===ha.length-1&&la.push(0===ha[fa]?Math.min(na,ia[fa]):Math.max(na,ia[fa]));la.sort((fa,pa)=>fa-pa)}else ia[0]>ia[1]&&(la=[ia[1],ia[0]]);G.push(la)}for(let na=0,fa=0;na<O;na++)for(Z=Q+P*na,ja=0;ja<T;ja++,fa++)if(ia=ca-V*
ja,ha=G[ja],2===ha.length)Z>=ha[0]&&Z<=ha[1]&&(M.push([Z,ia]),f[fa]=1);else if(2<ha.length){la=!1;for(ma=0;ma<ha.length;ma+=2)if(Z>=ha[ma]&&Z<=ha[ma+1]){la=!0;break}la&&(M.push([Z,ia]),f[fa]=1)}return{points:M,mask:f}}function t(f,G){const [M,O]=G;for(G=0;G<f.length;G++){const T=f[G][1];if(T<M||T>O)f[G]=[NaN,NaN]}}function w(f,G){const M=K(f[0].spatialReference);if(2>f.length||null==M)return f[0];G=G??B(f[0].spatialReference);f=f.filter(W=>W.width>G);if(1===f.length)return f[0];let {xmin:O,xmax:T,
ymin:P,ymax:V}=f[0];for(let W=1;W<f.length;W++){const Q=f[W];T=Q.xmax+M*W;P=Math.min(P,Q.ymin);V=Math.max(V,Q.ymax)}return new x({xmin:O,xmax:T,ymin:P,ymax:V,spatialReference:f[0].spatialReference})}function z(f,G,M=null,O=!0){var T=f.spatialReference;if(T.equals(G))return f;var P=S(f);const V=K(T,!0);var W=K(G);if(0===P||null==V||null==W)return P=I(f,G,M,O),null==V&&null!=W&&Math.abs(P.width-W)<B(G)&&D.isLoaded()&&(T=p(T),null!=T&&T.poleLocation===da.None&&f.width<(T.bbox[2]-T.bbox[0])/2)?H(f,G)||
P:P;W=f.clone().normalize();if(1===W.length&&f.xmax<V&&f.xmax-V/2>B(T)){const {xmin:Q,xmax:ca}=f;for(let Z=0;Z<=P;Z++)W[Z]=new x({xmin:0===Z?Q:-V/2,xmax:Z===P?ca-V*Z:V/2,ymin:f.ymin,ymax:f.ymax,spatialReference:T})}f=W.map(Q=>I(Q,G,M,O));return w(f.filter(h.isSome))}function H(f,G){const M=K(G);if(null==M)return null;let {xmin:O,ymin:T,xmax:P,ymax:V}=f;var W=f.spatialReference;f=new m({spatialReference:W,rings:[[[O,T],[P,T],[P,V],[O,V],[O,T]]]});f=D.project(f,G);if(2!==f.rings.length||!f.rings[0].length||
!f.rings[1].length)return null;({rings:f}=f);W=B(W);G=new x({spatialReference:G});for(let Q=0;2>Q;Q++){O=P=f[Q][0][0];T=V=f[Q][0][1];for(let ca=0;ca<f[Q].length;ca++)O=O>f[Q][ca][0]?f[Q][ca][0]:O,P=P<f[Q][ca][0]?f[Q][ca][0]:P,T=T>f[Q][ca][1]?f[Q][ca][1]:T,V=V<f[Q][ca][1]?f[Q][ca][1]:V;if(0===Q)G.ymin=T,G.ymax=V,G.xmin=O,G.xmax=P;else if(G.ymin=Math.min(G.ymin,T),G.ymax=Math.max(G.ymax,V),Math.abs(P-M/2)<W)G.xmin=O,G.xmax+=M;else if(Math.abs(O+M/2)<W)G.xmax=P+M;else return null}return G}function I(f,
G,M=null,O=!0,T=!0){const P=f.spatialReference;if(P.equals(G)||!G)return f;n(P,G,M);const V=D.project(f,G,M);if(T&&G.isWebMercator&&V&&(V.ymax=Math.min(2.0037508342787E7,V.ymax),V.ymin=Math.max(-2.0037508342787E7,V.ymin),V.ymin>=V.ymax))return null;if(!O||!V)return V;var W=L(P,!0);O=L(G,!0);if(null==W||null==O)return V;T=B(P,.001);const Q=B(P,500);var ca=B(G,.001);if(Math.abs(V.xmin-O[0])<ca&&Math.abs(V.xmax-O[1])<ca){ca=Math.abs(f.xmin-W[0]);W=Math.abs(W[1]-f.xmax);if(ca<T&&W>Q){V.xmin=O[0];var Z=
[];Z.push(new C(f.xmax,f.ymin,P));Z.push(new C(f.xmax,(f.ymin+f.ymax)/2,P));Z.push(new C(f.xmax,f.ymax,P));Z=Z.map(ja=>A(ja,G,M)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x);V.xmax=Math.max.apply(null,Z)}W<T&&ca>Q&&(V.xmax=O[1],O=[],O.push(new C(f.xmin,f.ymin,P)),O.push(new C(f.xmin,(f.ymin+f.ymax)/2,P)),O.push(new C(f.xmin,f.ymax,P)),f=O.map(ja=>A(ja,G,M)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x),V.xmin=Math.min.apply(null,f))}else f=B(G,.001),Math.abs(V.xmin-O[0])<f&&(V.xmin=O[0]),Math.abs(V.xmax-O[1])<
f&&(V.xmax=O[1]);return V}function K(f,G=!1){return f?f.isWebMercator?2*(G?2.0037508342787E7:2.0037508342788905E7):f.wkid&&f.isGeographic?360:2*aa[f.wkid]||null:null}function L(f,G=!1){if(f.isGeographic)return[-180,180];f=K(f,G);return null!=f?[-f/2,f/2]:null}function N(f,G,M,O){f=(f-G)/M;0!==f-Math.floor(f)?f=Math.floor(f):O&&--f;return f}function S(f,G=!1){var M=K(f.spatialReference);if(null==M)return 0;const O=G?0:-(M/2),T=B(f.spatialReference),P=!G&&Math.abs(f.xmin+M/2)<T?-M/2:f.xmin;f=N(!G&&
Math.abs(f.xmax-M/2)<T?M/2:f.xmax,O,M,!0);M=N(P,O,M,!1);return f-M}function U(f){const {projectedExtent:G,srcBufferExtent:M,pixelSize:O,datumTransformation:T,rasterTransform:P}=f;var V=G.spatialReference;const W=M.spatialReference;var Q=n(V,W);const {xmin:ca,ymin:Z,xmax:ja,ymax:ia}=G,ha=K(W),la=null!=ha&&(f.hasWrapAround||"gcs-shift"===P?.type);f=f.spacing||[32,32];var ma=f[0]*O.x,na=f[1]*O.y;const fa=1===f[0],pa=Math.ceil((ja-ca)/ma-.1/f[0])+(fa?0:1),qa=Math.ceil((ia-Z)/na-.1/f[1])+(fa?0:1);ma=a({cols:pa,
rows:qa,xmin:ca,ymax:ia,xres:ma,yres:na,inSR:V,outSR:W,datumTransformation:T,preferPE:4>=f[0],usePixelCenter:fa});na=[];let ra,sa=0;const wa=fa?-1:NaN,{xmin:xa,xmax:va,ymax:ya,width:za,height:Aa}=M,Ba=B(W,500),Ca=null!=ha&&0<xa&&va>ha/2;var ta=!1;Q&&(ta=p(V),ta=null!=ta&&0<ta.poleLocation);for(V=0;V<pa;V++){Q=[];for(let ua=0;ua<qa;ua++){var oa=ma[V*qa+ua];la&&oa[0]>va&&oa[0]>ha/2-Ba?oa[0]-=ha:la&&0===V&&0>oa[0]&&Ca&&!P&&(oa[0]+=ha);!oa||isNaN(oa[0])||isNaN(oa[1])?(na.push(wa),na.push(wa),Q.push(null),
sa++):(P&&(oa=P.inverseTransform(new C({x:oa[0],y:oa[1],spatialReference:W})),oa=[oa.x,oa.y]),Q.push(oa),0<V&&la&&ra[ua]&&oa[0]<ra[ua][0]&&(oa[0]+=ha,ta&&oa[0]>va&&oa[0]>ha&&(oa[0]-=ha)),na.push((oa[0]-xa)/za),na.push((ya-oa[1])/Aa))}ra=Q}return{offsets:na,error:null,coefficients:null,outofBoundPointCount:sa,spacing:f,size:fa?[pa,qa]:[pa-1,qa-1]}}function R(f,G,M){const {cols:O,rows:T}=G;G=new Float32Array((O-1)*(T-1)*12);const P=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),V=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let ia=0;ia<O-1;ia++){for(var W=0;W<T-1;W++){var Q=ia*T*2+2*W,ca=f[Q];const ha=f[Q+1];var Z=f[Q+2],ja=f[Q+3];Q+=2*T;const la=f[Q],ma=f[Q+1],na=f[Q+2];Q=f[Q+3];let fa=0,pa=12*(W*(O-1)+ia);for(let qa=0;3>qa;qa++)G[pa++]=P[fa++]*ca+P[fa++]*Z+P[fa++]*na;fa=0;for(Z=0;3>Z;Z++)G[pa++]=P[fa++]*ha+P[fa++]*ja+P[fa++]*Q;fa=0;for(ja=0;3>ja;ja++)G[pa++]=V[fa++]*ca+V[fa++]*la+V[fa++]*na;fa=0;for(ca=0;3>ca;ca++)G[pa++]=V[fa++]*ha+V[fa++]*ma+V[fa++]*Q}if(M)for(W=0;W<G.length;W++)isNaN(G[W])&&
(G[W]=-1)}return G}function Y(f,G){f=f.clone().normalize();return 1===f.length?f[0]:w(f,G)}function X(f,G){const {pixelSize:M,extent:O}=f;f=q(O,G,!1);const T=Y(O,(M.x+M.y)/16);return z(T,G,f)}var da;(function(f){f[f.None=0]="None";f[f.North=1]="North";f[f.South=2]="South";f[f.Both=3]="Both"})(da||={});const ba=(f,G,M,O=0)=>{if(1===M[0])return[0,0];var T=1,P=-1,V=1,W=-1;for(var Q=0;Q<f.length;Q+=2)isNaN(f[Q])||(T=T>f[Q]?f[Q]:T,P=P>f[Q]?P:f[Q],V=V>f[Q+1]?f[Q+1]:V,W=W>f[Q+1]?W:f[Q+1]);const {cols:ca,
rows:Z}=G;G=(P-T)/ca/M[0];M=(W-V)/Z/M[1];O*=2;V=0;W=!1;T=[0,0];for(P=0;P<ca-3;P++){for(Q=0;Q<Z-3;Q++){var ja=P*Z*2+2*Q;const ia=Math.abs(((f[ja]+f[ja+4]+f[ja+4*Z]+f[ja+4*Z+4])/4-f[ja+2*Z+2])/G);ja=Math.abs(((f[ja+1]+f[ja+5]+f[ja+4*Z+1]+f[ja+4*Z+5])/4-f[ja+2*Z+3])/M);ia+ja>V&&(V=ia+ja,T=[ia,ja]);if(O&&V>O){W=!0;break}}if(W)break}return T},aa={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7},ea=new Map,ka=new Map;l.computeProjectedScales=function(f,G,M){var O=M?.tileSize??512,T=M?.alignGlobalDatasetWithAGOL??!0,P=!!M?.limitToSrcResolution;const {extent:V,spatialReference:W,pixelSize:Q}=f;M=y(new C({x:Q.x,y:Q.y,spatialReference:W}),G,V);if(null==M)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ca=(M.x+M.y)/2,Z=v.getMetersPerUnitForSR(G);var ja=ca*Z*96*39.37,ia=G.isGeographic?256/O*2.958287637958547E8:
256/O*5.91657527591555E8,ha="vector-magdir"===f.dataType||"vector-uv"===f.dataType,la=X(f,G),ma=Math.min(Math.ceil(Math.log(Math.min(f.width,f.height)/32)/Math.LN2),Math.ceil(Math.log(ia/2/ja)/Math.LN2));if(!ha&&T&&(G.isGeographic||G.isWebMercator)&&(T=K(G),ha=0<S(la)||null!=T&&la.width>T/4,!ha&&null!=T)){ha=-1;if(3>ma)ha=2**ma*ca*O;else if(f.storageInfo){const {maximumPyramidLevel:na=0,pyramidScalingFactor:fa=2}=f.storageInfo;ha=fa**na*ca*O}O=Math.ceil(T/ha);ha=1===O||2===O&&T/2-la.xmax<ha}O=ja;
f=Math.min(2,Math.max(1.414,f.storageInfo?.pyramidScalingFactor||2));if(ha)O=ia,ia=G.isGeographic?1.341104507446289E-6:.29858214164761665,ma=96*ia*Z*39.37,G=y(new C({x:ia,y:ia,spatialReference:{wkid:G.isGeographic?4326:3857}}),W,la),G.x*=O/ma,G.y*=O/ma;else{G={x:Q.x,y:Q.y};for(la=0;O<.5005*ia&&la<ma;)la++,O*=f,G.x*=f,G.y*=f;1.001>=Math.max(O,ia)/Math.min(O,ia)&&(O=ia)}ia=[O];la=[{x:G.x,y:G.y}];for(ja=Math.min(70.5310735,ja)/1.001;O>=ja;)O/=f,G.x/=f,G.y/=f,ia.push(O),la.push({x:G.x,y:G.y});if(P){const na=
.001*Q.x;P=la.findIndex(fa=>fa.x>=Q.x-na&&fa.x<=Q.x+na);-1<P?(la.length=P+1,ia.length=P+1):(P=la.findIndex(fa=>fa.x<=Q.x+na),0<P&&(la.length=P,ia.length=P))}return{projectedPixelSize:M,scales:ia,srcResolutions:la,isCustomTilingScheme:!ha}};l.defaultGridSpacing=32;l.defaultProjectionToleranceInPixels=4;l.getDefaultDatumTransformationForDataset=q;l.getProjectedGridPoints=a;l.getProjectionOffsetGrid=function(f){var G=f.isAdaptive&&null==f.spacing;let M=f.spacing||[32,32],O=U(f);var T={cols:O.size[0]+
1,rows:O.size[1]+1};const P=0<O.outofBoundPointCount&&O.outofBoundPointCount<O.offsets.length/2;let V=O.outofBoundPointCount===O.offsets.length/2||G&&P?[0,0]:ba(O.offsets,T,M,4);const W=(V[0]+V[1])/2;var Q=f.projectedExtent.spatialReference;const ca=f.srcBufferExtent.spatialReference;G&&(P||4<W)&&(r(Q,ca,f.datumTransformation)&&(Q.isGeographic||null!=p(Q)),M=[4,4],O=U({...f,spacing:M}),T={cols:O.size[0]+1,rows:O.size[1]+1},V=ba(O.offsets,T,M,4));O.error=V;1<M[0]&&(O.coefficients=R(O.offsets,T,P));
!f.includeGCSGrid||Q.isGeographic||Q.isWebMercator||(ca.isGeographic?O.gcsGrid={offsets:O.offsets,coefficients:O.coefficients,spacing:M}:(G=p(Q),null==G||G.isEnvelope||(Q&&!Q.isGeographic&&(G=String(Q.wkid||Q.wkt2||Q.wkt),ka.has(G)?Q=ka.get(G):(Q=(Q.wkid?u.PeFactory.coordsys(Q.wkid):u.PeFactory.fromString(u.PeDefs.PE_TYPE_PROJCS,Q.wkt2||Q.wkt)).getGeogcs().getCode(),ka.set(G,Q)),Q=new b({wkid:Q})),Q=z(f.projectedExtent,Q),{offsets:f}=U({...f,srcBufferExtent:Q,spacing:M}),T=R(f,T,P),O.gcsGrid={offsets:f,
coefficients:T,spacing:M})));return O};l.getRasterDatasetAlignmentInfo=function(f){const G=f.storageInfo.origin.x;var M=K(f.spatialReference,!0);if(null==M)return{originX:G,halfWorldWidth:null,pyramidsInfo:null};const O=M/2,{nativePixelSize:T,storageInfo:P,extent:V}=f,{maximumPyramidLevel:W,blockWidth:Q,pyramidScalingFactor:ca}=P;let Z=T.x;const ja=[];f=null!=f.transform&&"gcs-shift"===f.transform.type;const ia=G+(f?0:O);M=f?M-G:O-G;for(let ha=0;ha<=W;ha++){const la=(V.xmax-G)/Z/Q,ma=M/Z/Q;ja.push({resolutionX:Z,
blockWidth:Q,datasetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ma-Math.floor(ma)?ma:Math.ceil(ma),leftMargin:Math.round(ia/Z)%Q,rightPadding:(Q-Math.round(M/Z)%Q)%Q,originColumnOffset:Math.floor(ia/Z/Q)});Z*=ca}return{originX:G,halfWorldWidth:O,pyramidsInfo:ja,hasGCSSShiftTransform:f}};l.getWorldWidth=K;l.getWorldWrapCount=S;l.load=async function(){D.isLoaded()||await D.load()};l.minimumGridSpacing=4;l.projectDatasetExtent=X;l.projectExtent=z;l.projectPoint=
A;l.projectPolygon=function(f,G,M){if("extent"===f.type){const {xmin:O,ymin:T,xmax:P,ymax:V,spatialReference:W}=f;f=new m({rings:[[[O,V],[P,V],[P,T],[O,T],[O,V]]],spatialReference:W})}if(f.spatialReference.equals(G))return f;n(f.spatialReference,G,M);return D.project(f,G,M)};l.projectResolution=y;l.requirePE=r;l.shiftExtent=function(f){var {spatialReference:G}=f;G=F.getInfo(G);if(!G)return f;const [M,O]=G.valid;G=O-M;let T=0;f.xmin<M?T=Math.ceil((M-f.xmin)/G):f.xmin>O&&(T=-Math.ceil((f.xmin-O)/G));
return new x({spatialReference:f.spatialReference,xmin:f.xmin+T*G,ymin:f.ymin,xmax:f.xmax+T*G,ymax:f.ymax})};l.snapExtent=Y;l.snapPyramid=function(f,G,M){const {storageInfo:O,pixelSize:T}=G;var P=0;let V=!1;var {pyramidResolutions:W}=O,Q="mixed"===O.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,O.tileInfo.dpi/96)):1;Q=(f.x+f.y)/2/Q;if(null!=W&&W.length){f=W[W.length-1];f=(f.x+f.y)/2;var ca=(T.x+T.y)/2;if(Q<=ca)P=0;else if(Q>=f)P=W.length,V=8<Q/f;else{f=ca;for(let Z=1;Z<=W.length;Z++){ca=(W[Z-
1].x+W[Z-1].y)/2;if(Q<=ca){Q===ca?P=Z:"down"===M?(P=Z-1,V=8<Q/f):P="up"===M?Z:Q-f>ca-Q||2<Q/f?Z:Z-1;break}f=ca}}M=0===P?T:W[P-1];V&&(W=Math.min(M.x,M.y),Q=v.getMetersPerUnitForSR(G.spatialReference),19567<W*Q&&(V=!1));return{pyramidLevel:P,pyramidResolution:new C({x:M.x,y:M.y,spatialReference:G.spatialReference}),excessiveReading:V}}P=Math.log(f.x/T.x)/Math.LN2;Q=Math.log(f.y/T.y)/Math.LN2;W=G.storageInfo.maximumPyramidLevel||0;P="down"===M?Math.floor(Math.min(P,Q)):"up"===M?Math.ceil(Math.max(P,
Q)):Math.round((P+Q)/2);0>P?P=0:P>W&&(V=P>W+3,P=W);M=2**P;G=new C({x:M*G.nativePixelSize.x,y:M*G.nativePixelSize.y,spatialReference:G.spatialReference});return{pyramidLevel:P,pyramidResolution:G,excessiveReading:V}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(l,E,h,k,v,u,D,F,x,C){k=class extends C.BaseImageryTileSubView2D{constructor(){super(...arguments);this._handle=null;this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(m,b){b={...b,interpolation:"nearest",requestProjectedLocalDirections:!0};m=await this.layer.fetchTile(m.level,m.row,m.col,b);"vector-magdir"===this.layer.serviceRasterInfo.dataType&&m?.pixelBlock&&(m.pixelBlock=await this.layer.convertVectorFieldData(m.pixelBlock,b));return m}updateTileSource(m,b){const r=
b.symbolizerParams,{tileData:n}=m;n.key=m.key;n.width=this._tileInfoView.tileInfo.size[0];n.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:m}=r);({source:b}=b);n.offset=this._getTileSymbolOffset(n.key,m);null!=b?.pixelBlock?(n.rawPixelData={extent:b.extent,pixelBlock:b.pixelBlock},n.symbolizerParameters=r,n.source=this._sampleVectorFieldData(b.pixelBlock,r,n.offset)):(b=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo.size[0]-n.offset[0])/m),Math.round((this._tileInfoView.tileInfo.size[1]-
n.offset[1])/m)]),n.source=b,n.symbolizerParameters=r);n.invalidateVAO();return Promise.resolve()}updateTileSymbolizerParameters(m,b){var r=b.local;({symbolTileSize:b}=r);({tileData:m}=m);m.offset=this._getTileSymbolOffset(m.key,b);const n=m.symbolizerParameters.symbolTileSize;m.symbolizerParameters=r;r=m.rawPixelData?.pixelBlock;null!=r&&n!==b&&(m.source=this._sampleVectorFieldData(r,m.symbolizerParameters,m.offset));return Promise.resolve()}attach(){super.attach();this.container=new x.RasterVFTileContainer(this._tileInfoView);
this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=E.watch(()=>this.layer.renderer,m=>this._updateSymbolType(m))}detach(){super.detach();this.container.removeAllChildren();this._handle?.remove();this.container=this._handle=null}_getTileSymbolOffset(m,b){const r=m.col*this._tileInfoView.tileInfo.size[0]%b;m=m.row*this._tileInfoView.tileInfo.size[1]%b;return[r>b/2?b-r:-r,m>b/2?b-m:-m]}_sampleVectorFieldData(m,b,r){({symbolTileSize:b}=
b);return F.sampleVectorField(m,"vector-uv",b,r)}_updateSymbolType(m){"vector-field"===m.type&&(this.container.symbolTypes="wind-barb"===m.style?["scalar","triangle"]:"simple-scalar"===m.style?["scalar"]:["triangle"])}};l.__decorate([h.property()],k.prototype,"container",void 0);l.__decorate([h.property()],k.prototype,"layer",void 0);l.__decorate([h.property()],k.prototype,"type",void 0);return k=l.__decorate([D.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],k)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports",
"../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(l,E,h,k){function v(g,c){return y.get(g)/y.get(c)||1}function u(g,c="geographic"){const [t,w]=g;g=Math.sqrt(t*t+w*w);let z=Math.atan2(w,t)*B;z=(360+z)%360;"geographic"===c&&(z=(450-z)%360);return[g,z]}function D(g,c="geographic"){let t=g[1];"geographic"===c&&(t=(450-t)%360);t%=360;g=g[0];return[g*Math.cos(t/B),g*Math.sin(t/B)]}function F(g,c,t="geographic",w=1){if(!k.isValidPixelBlock(g))return g;const {pixels:z,width:H,height:I}=g;
var K=H*I;const L=z[0],N=z[1],S=g.pixelType.startsWith("f")?g.pixelType:"f32",U=h.createEmptyBand(S,K);K=h.createEmptyBand(S,K);let R=0;for(let Y=0;Y<I;Y++)for(let X=0;X<H;X++)"vector-uv"===c?([U[R],K[R]]=u([L[R],N[R]],t),U[R]*=w):([U[R],K[R]]=D([L[R],N[R]],t),U[R]*=w,K[R]*=w),R++;g=new h({pixelType:S,width:g.width,height:g.height,mask:g.mask,validPixelCount:g.validPixelCount,maskIsAlpha:g.maskIsAlpha,pixels:[U,K]});g.updateStatistics();return g}function x(g=0,c=0,t=Math.PI,w=!0){w&&(t=(2*Math.PI-
t)%(2*Math.PI));w=w?-1:1;const z=-7*w,H=-2*w,I=-16*w,[K,L]=m(0,c+13*w,t,21.75),[N,S]=m(g-5.5,c+z,t,21.75),[U,R]=m(g+5.5,c+z,t,21.75),[Y,X]=m(g-1.5,c+H,t,21.75),[da,ba]=m(g+1.5,c+H,t,21.75),[aa,ea]=m(g-1.5,c+I,t,21.75),[ka,f]=m(g+1.5,c+I,t,21.75);return[K,L,N,S,Y,X,da,ba,U,R,aa,ea,ka,f]}function C(g=0,c=Math.PI,t=!0){t&&(c=(2*Math.PI-c)%(2*Math.PI));var w=t?-1:1,z=5*w;const H=20*w,I=25*w;w*=2;const K=t?1:-1;t=5*K;let [L,N]=[0+t,0-H],[S,U]=[L+2*K,N],[R,Y]=[S-0*K,U+w],[X,da]=[0-t,0-I],[ba,aa]=[X+0*K,
da-w],ea=Math.ceil(g/5),ka=Math.floor(ea/10);ea-=8*ka;g=[];const f=[];for(let ca=0;ca<ea/2;ca++,ka--){0>=ka&&1===ea%2&&ca===(ea-1)/2&&(X=0,ba=X+0*K,da=(da+N)/2,aa=da-w);const [Z,ja]=m(X,da,c,45);if(0<ka){const [ia,ha]=m(S,da,c,45),[la,ma]=m(L,N,c,45);g.push(ia);g.push(ha);g.push(Z);g.push(ja);g.push(la);g.push(ma)}else{const [ia,ha]=m(S,U,c,45),[la,ma]=m(R,Y,c,45),[na,fa]=m(ba,aa,c,45);f.push(Z);f.push(ja);f.push(na);f.push(fa);f.push(la);f.push(ma);f.push(ia);f.push(ha)}da+=z;N+=z;U+=z;Y+=z;aa+=
z}const [G,M]=m(0+t,0+H,c,45);z=7*K;const [O,T]=m(0+z,0+H,c,45),[P,V]=m(0+t,0-I,c,45),[W,Q]=m(0+z,0-I,c,45);return{pennants:g,barbs:f,shaft:[G,M,O,T,P,V,W,Q]}}function m(g,c,t,w=1){return[Math.sqrt(g*g+c*c)/w,(2*Math.PI+(2*Math.PI+Math.atan2(c,g))%(2*Math.PI)-t)%(2*Math.PI)]}function b(g,c,t,w){t=v(w||"knots",t);for(w=1;w<c.length;w++)if(w===c.length-1){if(g<c[w]*t)break}else if(g<=c[w]*t)break;return Math.min(w-1,c.length-2)}function r(g,c,t,w,z){let H=0;switch(c){case "beaufort_kn":H=b(g,a,"knots",
t);break;case "beaufort_km":H=b(g,a,"kilometer-per-hour",t);break;case "beaufort_ft":H=b(g,a,"feet-per-second",t);break;case "beaufort_m":H=b(g,a,"meter-per-second",t);break;case "classified_arrow":H=b(g,z??[],w,t);break;case "ocean_current_m":H=b(g,e,"meter-per-second",t);break;case "ocean_current_kn":H=b(g,d,"knots",t)}return H}function n(g,c){const {style:t,inputUnit:w,outputUnit:z,breakValues:H}=c,I=A.fromJSON(w),K=A.fromJSON(z);let L=0,N=0;const {width:S,height:U,mask:R}=g,Y=g.pixels[0];g=g.pixels[1];
var X=null!=R?R.filter(aa=>0<aa).length:S*U;const da=new Float32Array(42*X);X=new Uint32Array(15*X);c=c.invertDirection?x(0,0,0,!1):J;for(let aa=0;aa<U;aa++)for(let ea=0;ea<S;ea++){var ba=aa*S+ea;if(!R||R[aa*S+ea]){const ka=(g[ba]+360)%360/180*Math.PI,f=r(Y[ba],t,I,K,H);for(let G=0;G<c.length;G+=2)da[L++]=(ea+.5)/S,da[L++]=(aa+.5)/U,da[L++]=c[G],da[L++]=c[G+1]+ka,da[L++]=f,da[L++]=Y[ba];ba=7*(L/42-1);X[N++]=ba;X[N++]=ba+1;X[N++]=ba+2;X[N++]=ba+0;X[N++]=ba+4;X[N++]=ba+3;X[N++]=ba+0;X[N++]=ba+2;X[N++]=
ba+3;X[N++]=ba+2;X[N++]=ba+5;X[N++]=ba+3;X[N++]=ba+5;X[N++]=ba+6;X[N++]=ba+3}}return{vertexData:da,indexData:X}}function q(g,c){let t=0,w=0;const {width:z,height:H,mask:I}=g;g=g.pixels[0];const K=[],L=[];var N=A.fromJSON(c.inputUnit);N=v(N,"knots");c="wind_speed"===c.style?5:Number.MAX_VALUE;for(let U=0;U<H;U++)for(let R=0;R<z;R++){var S=g[U*z+R]*N;if((!I||I[U*z+R])&&S<c){for(let Y=0;4>Y;Y++)K[t++]=(R+.5)/z,K[t++]=(U+.5)/H,K[t++]=2>Y?-.5:.5,K[t++]=0===Y%2?-.5:.5,K[t++]=0,K[t++]=S;S=4*(t/24-1);L[w++]=
S;L[w++]=S+1;L[w++]=S+2;L[w++]=S+1;L[w++]=S+2;L[w++]=S+3}}return{vertexData:new Float32Array(K),indexData:new Uint32Array(L)}}const y=new Map;y.set("meter-per-second",1);y.set("kilometer-per-hour",.277778);y.set("knots",.514444);y.set("feet-per-second",.3048);y.set("mile-per-hour",.44704);const B=180/Math.PI,A=new E.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),J=x(0,
0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],e=[0,.5,1,1.5,2],d=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],p=[];l.convertToLocalDirections=function(g,c,t,w="geographic"){if(!k.isValidPixelBlock(g)||null==t)return g;g="vector-magdir"===c?g.clone():F(g,c);const z=g.pixels[1];for(let H=0;H<z.length;H++)z[H]="geographic"===w?(z[H]+t[H]+270)%360:(z[H]+360-t[H])%360;return"vector-magdir"===c?g:F(g,"vector-magdir")};l.convertVectorFieldData=F;l.convertVectorFieldUnit=function(g,c,t=1){if(1===t||!k.isValidPixelBlock(g))return g;
g=g.clone();const {pixels:w,width:z,height:H}=g,I=w[0],K=w[1];let L=0;for(let N=0;N<H;N++)for(let S=0;S<z;S++)"vector-uv"===c?(I[L]*=t,K[L]*=t):I[L]*=t,L++;g.updateStatistics();return g};l.createVFMesh=function(g,c){if("simple_scalar"===c.style)c=q(g,c);else if("wind_speed"===c.style){if(0===p.length)for(var t=0;30>t;t++)p.push(C(5*t,0,!c.invertDirection));c=A.fromJSON(c.inputUnit);c=v(c,"knots");const {width:I,height:K,mask:L}=g;t=g.pixels[0];g=g.pixels[1];const N=[],S=[];let U=0,R=0;for(let Y=0;Y<
K;Y++)for(let X=0;X<I;X++){var w=Y*I+X,z=t[w]*c;if((!L||L[Y*I+X])&&5<=z){const da=(g[w]+360)%360/180*Math.PI,{pennants:ba,barbs:aa,shaft:ea}=p[Math.min(Math.floor(z/5),29)];if(0===ba.length+aa.length)continue;w=N.length/6;const ka=(X+.5)/I,f=(Y+.5)/K;for(var H=0;H<ba.length;H+=2)N[U++]=ka,N[U++]=f,N[U++]=ba[H],N[U++]=ba[H+1]+da,N[U++]=0,N[U++]=z;for(H=0;H<aa.length;H+=2)N[U++]=ka,N[U++]=f,N[U++]=aa[H],N[U++]=aa[H+1]+da,N[U++]=0,N[U++]=z;for(H=0;H<ea.length;H+=2)N[U++]=ka,N[U++]=f,N[U++]=ea[H],N[U++]=
ea[H+1]+da,N[U++]=0,N[U++]=z;for(z=0;z<ba.length/6;z++)S[R++]=w,S[R++]=w+1,S[R++]=w+2,w+=3;for(z=0;z<aa.length/8;z++)S[R++]=w,S[R++]=w+1,S[R++]=w+2,S[R++]=w+1,S[R++]=w+2,S[R++]=w+3,w+=4;S[R++]=w+0;S[R++]=w+1;S[R++]=w+2;S[R++]=w+1;S[R++]=w+3;S[R++]=w+2;w+=4}}c={vertexData:new Float32Array(N),indexData:new Uint32Array(S)}}else c=n(g,c);return c};l.createVFMeshScalar=q;l.getUnitConversionFactor=v;l.sampleVectorField=function(g,c,t,w=[0,0],z=.5){const {width:H,height:I,mask:K}=g,[L,N]=g.pixels,[S,U]=
w;g=Math.round((H-S)/t);w=Math.round((I-U)/t);var R=g*w;const Y=new Float32Array(R),X=new Float32Array(R);R=new Uint8Array(R);c="vector-uv"===c;for(let ba=0;ba<w;ba++)for(let aa=0;aa<g;aa++){let ea=0;const ka=ba*g+aa,f=Math.max(0,ba*t+U),G=Math.max(0,aa*t+S),M=Math.min(I,f+t),O=Math.min(H,G+t);for(let T=f;T<M;T++)for(let P=G;P<O;P++){var da=T*H+P;if(!K||K[da]){ea++;da=c?[L[da],N[da]]:[L[da],(360+N[da])%360];const [V,W]=c?da:D(da);Y[ka]+=V;X[ka]+=W}}if(ea>=(M-f)*(O-G)*(1-z)){R[ka]=1;const [T,P]=u([Y[ka]/
ea,X[ka]/ea]);Y[ka]=T;X[ka]=P}else R[ka]=0,Y[ka]=0,X[ka]=0}t=new h({width:g,height:w,pixels:[Y,X],mask:R});t.updateStatistics();return t};l.snapImageToSymbolTile=function(g,c,t,w,z){if(null==z||!z.spatialReference.equals(g.spatialReference))return{extent:g,width:Math.round(c/w),height:Math.round(t/w),resolution:g.width/c};const H=z.xmin;z=z.ymax;c=(g.xmax-g.xmin)/c*w;t=(g.ymax-g.ymin)/t*w;g.xmin=H+Math.floor((g.xmin-H)/c)*c;g.xmax=H+Math.ceil((g.xmax-H)/c)*c;g.ymin=z+Math.floor((g.ymin-z)/t)*t;g.ymax=
z+Math.ceil((g.ymax-z)/t)*t;return{extent:g,width:Math.round(g.width/c),height:Math.round(g.height/t),resolution:(c+t)/2}};l.unitKebabDict=A;l.uvComponentToVector=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(l,E,h){function k(a){return null!=a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function v(a,e,d,
p,g){const c=a.length;g=E.createEmptyBand(g,c);if(e)for(let t=0;t<c;t++)e[t]&&(g[t]=d[a[t]-p]);else for(e=0;e<c;e++)g[e]=d[a[e]-p];return g}function u(a,e,d,p){const g=null!=d&&2<=d.length?new Set(d):null;d=1===d?.length?d[0]:null;const c=!!e?.length;for(let t=0;t<a.length;t++)if(p[t]){const w=a[t];if(c){let z=!1;for(let H=0;H<e.length;H+=2)if(w>=e[H]&&w<=e[H+1]){z=!0;break}z||(p[t]=0)}p[t]&&(w===d||g?.has(w))&&(p[t]=0)}}function D(a,e){const d=a[0].length;for(let p=0;p<d;p++)if(e[p]){let g=!1;for(let c=
0;c<a.length;c++)if(a[c][p]){g=!0;break}g||(e[p]=0)}}function F(a,e){const d=a[0].length;for(let p=0;p<d;p++)if(e[p]){let g=!1;for(let c=0;c<a.length;c++)if(0===a[c][p]){g=!0;break}g&&(e[p]=0)}}function x(a,e,d,p,g,c,t,w){return{xmin:g<=d*a?0:g<d*a+a?g-d*a:a,ymin:c<=p*e?0:c<p*e+e?c-p*e:e,xmax:g+t<=d*a?0:g+t<d*a+a?g+t-d*a:a,ymax:c+w<=p*e?0:c+w<p*e+e?c+w-p*e:e}}function C(a,e,d,p,g,c){const {width:t,height:w}=d.block,{x:z,y:H}=d.offset,{width:I,height:K}=d.mosaic;d=x(t,w,p,g,z,H,I,K);let L=0;var N=
0;if(c){var S=c.hasGCSSShiftTransform?360:c.halfWorldWidth??0,U=t*c.resolutionX;const R=c.startX+p*U;R<S&&R+U>S?N=c.rightPadding:R>=S&&(L=c.leftMargin-c.rightPadding,N=0)}d.xmax-=N;if("number"===typeof e)for(c=d.ymin;c<d.ymax;c++)for(N=(g*w+c-H)*I+(p*t-z)+L,S=d.xmin;S<d.xmax;S++)a[N+S]=e;else for(c=d.ymin;c<d.ymax;c++)for(N=(g*w+c-H)*I+(p*t-z)+L,S=c*t,U=d.xmin;U<d.xmax;U++)a[N+U]=e[S+U]}function m(a,e,d={}){const {clipOffset:p,clipSize:g,alignmentInfo:c,blockWidths:t}=d;if(t)return b(a,e,{blockWidths:t});
var w=a.find(da=>k(da));if(null==w)return null;d=g?g.width:e.width;const z=g?g.height:e.height;var H=w.width,I=w.height;const K=e.width/H,L=e.height/I;e={offset:p||{x:0,y:0},mosaic:g||e,block:{width:H,height:I}};H=w.pixelType;var N=E.getPixelArrayConstructor(H);w=w.pixels.length;I=[];for(var S=0;S<w;S++){var U=new N(d*z);for(var R=0;R<L;R++)for(var Y=0;Y<K;Y++){var X=a[R*K+Y];k(X)&&(X=X.pixels[S],C(U,X,e,Y,R,c))}I.push(U)}N=a.some(da=>null==da||null!=da.mask&&0<da.mask.length);U=a.some(da=>da?.bandMasks&&
1<da.bandMasks.length);N=N?new Uint8Array(d*z):void 0;U=U?[]:void 0;if(N){for(S=0;S<L;S++)for(R=0;R<K;R++)Y=a[S*K+R],X=null!=Y?Y.mask:null,null!=X?C(N,X,e,R,S,c):Y?C(N,255,e,R,S,c):C(N,0,e,R,S,c);if(U)for(S=0;S<w;S++){R=new Uint8Array(d*z);for(Y=0;Y<L;Y++)for(X=0;X<K;X++){const da=a[Y*K+X],ba=da?.bandMasks?.[S]??da?.mask;null!=ba?C(R,ba,e,X,Y,c):da?C(R,255,e,X,Y,c):C(R,0,e,X,Y,c)}U.push(R)}}a=new E({width:d,height:z,pixels:I,pixelType:H,bandMasks:U,mask:N});a.updateStatistics();return a}function b(a,
e,d){const p=a.find(R=>null!=R);if(null==p)return null;var g=a.some(R=>null!=R?!!R.mask:!0);const {width:c,height:t}=e;e=g?new Uint8Array(c*t):null;({blockWidths:d}=d);const w=[],z=p.getPlaneCount(),H=E.getPixelArrayConstructor(p.pixelType);if(g)for(let R=0,Y=0;R<a.length;Y+=d[R],R++)if(g=a[R],k(g)){var I=g.mask;for(var K=0;K<t;K++)for(var L=0;L<d[R];L++)e[K*c+L+Y]=null==I?255:I[K*g.width+L]}I=(g=a.some(R=>R?.bandMasks&&1<R.bandMasks.length))?[]:void 0;K=c*t;for(L=0;L<z;L++){const R=new H(K),Y=g?
new Uint8Array(K):void 0;for(let X=0,da=0;X<a.length;da+=d[X],X++){const ba=a[X];if(k(ba)){var N=ba.pixels[L];if(null!=N){for(var S=0;S<t;S++)for(var U=0;U<d[X];U++)R[S*c+U+da]=N[S*ba.width+U];if(Y)for(N=ba.bandMasks?.[L]??ba.mask,S=0;S<t;S++)for(U=0;U<d[X];U++)Y[S*c+U+da]=N?N[S*ba.width+U]:255}}}w.push(R);I&&Y&&I.push(Y)}a=new E({width:c,height:t,mask:e,bandMasks:I,pixels:w,pixelType:p.pixelType});a.updateStatistics();return a}function r(a){if(!k(a))return null;const e=a.clone(),{width:d,height:p,
pixels:g}=a;var c=g[0];const t=e.pixels[0];a=a.mask;for(let H=2;H<p-1;H++){const I=new Map;for(var w=H-2;w<H+2;w++)for(var z=0;4>z;z++){const K=w*d+z;y(I,c[K],a?a[K]:1)}t[H*d]=n(I);t[H*d+1]=t[H*d+2]=t[H*d];for(w=3;w<d-1;w++)z=(H-2)*d+w+1,y(I,c[z],a?a[z]:1),z=(H-1)*d+w+1,y(I,c[z],a?a[z]:1),z=H*d+w+1,y(I,c[z],a?a[z]:1),z=(H+1)*d+w+1,y(I,c[z],a?a[z]:1),z=(H-2)*d+w-3,q(I,c[z],a?a[z]:1),z=(H-1)*d+w-3,q(I,c[z],a?a[z]:1),z=H*d+w-3,q(I,c[z],a?a[z]:1),z=(H+1)*d+w-3,q(I,c[z],a?a[z]:1),t[H*d+w]=n(I);t[H*d+w+
1]=t[H*d+w]}for(c=0;c<d;c++)t[c]=t[d+c]=t[2*d+c],t[(p-1)*d+c]=t[(p-2)*d+c];e.updateStatistics();return e}function n(a){if(0===a.size)return 0;let e=0,d=-1,p=0;const g=a.keys();let c=g.next();for(;!c.done;)p=a.get(c.value),p>e&&(d=c.value,e=p),c=g.next();return d}function q(a,e,d){0!==d&&(d=a.get(e),1===d?a.delete(e):a.set(e,d-1))}function y(a,e,d){0!==d&&a.set(e,a.has(e)?a.get(e)+1:1)}function B(a,e,d){let {x:p,y:g}=e;const {width:c,height:t}=d;if(0===p&&0===g&&t===a.height&&c===a.width)return a;
const {width:w,height:z}=a;e=Math.max(0,g);const H=Math.max(0,p),I=Math.min(p+c,w),K=Math.min(g+t,z);if(0>I||0>K||!k(a))return null;p=Math.max(0,-p);g=Math.max(0,-g);var {pixels:L}=a,N=c*t,S=L.length;const U=[];for(var R=0;R<S;R++){var Y=L[R],X=E.createEmptyBand(a.pixelType,N);for(let da=e;da<K;da++){const ba=da*w;let aa=(da+g-e)*c+p;for(let ea=H;ea<I;ea++)X[aa++]=Y[ba+ea]}U.push(X)}L=new Uint8Array(N);N=a.mask;for(S=e;S<K;S++)for(R=S*w,Y=(S+g-e)*c+p,X=H;X<I;X++)L[Y++]=N?N[R+X]:1;a=new E({width:d.width,
height:d.height,pixelType:a.pixelType,pixels:U,mask:L});a.updateStatistics();return a}function A(a,e=!0){if(!k(a))return null;const {pixels:d,width:p,height:g,mask:c,pixelType:t}=a;a=[];const w=Math.round(p/2),z=Math.round(g/2),H=g-1,I=p-1;for(var K=0;K<d.length;K++){var L=d[K],N=E.createEmptyBand(t,w*z),S=0;for(var U=0;U<g;U+=2)for(var R=0;R<p;R+=2){var Y=L[U*p+R];if(e){var X=R===I?Y:L[U*p+R+1];const da=U===H?Y:L[U*p+R+p],ba=R===I?da:U===H?X:L[U*p+R+p+1];N[S++]=(Y+X+da+ba)/4}else N[S++]=Y}a.push(N)}K=
null;if(null!=c)for(K=new Uint8Array(w*z),L=0,N=0;N<g;N+=2)for(S=0;S<p;S+=2)U=c[N*p+S],e?(R=S===I?U:c[N*p+S+1],Y=N===H?U:c[N*p+S+p],X=S===I?Y:N===H?R:c[N*p+S+p+1],K[L++]=U*R*Y*X?1:0):K[L++]=U;return new E({width:w,height:z,pixelType:t,pixels:a,mask:K})}function J(a,e,d,p,g=0){const {width:c,height:t}=a,{width:w,height:z}=e;a=p.cols;p=p.rows;e=Math.ceil(w/a-.1/a);const H=Math.ceil(z/p-.1/p);let I,K,L,N,S;const U=e*a;var R=U*H*p;const Y=new Float32Array(R),X=new Float32Array(R),da=new Uint32Array(R),
ba=new Uint32Array(R);let aa=0,ea,ka;for(let M=0;M<H;M++)for(let O=0;O<e;O++){var f=12*(M*e+O);R=d[f];I=d[f+1];K=d[f+2];L=d[f+3];N=d[f+4];S=d[f+5];for(var G=0;G<p;G++){aa=(M*p+G)*U+O*a;ka=(G+.5)/p;for(let T=0;T<G;T++)ea=(T+.5)/a,Y[aa+T]=(R*ea+I*ka+K)*c+g,X[aa+T]=(L*ea+N*ka+S)*t+g,da[aa+T]=Math.floor(Y[aa+T]),ba[aa+T]=Math.floor(X[aa+T])}f+=6;R=d[f];I=d[f+1];K=d[f+2];L=d[f+3];N=d[f+4];S=d[f+5];for(f=0;f<p;f++)for(aa=(M*p+f)*U+O*a,ka=(f+.5)/p,G=f;G<a;G++)ea=(G+.5)/a,Y[aa+G]=(R*ea+I*ka+K)*c+g,X[aa+G]=
(L*ea+N*ka+S)*t+g,da[aa+G]=Math.floor(Y[aa+G]),ba[aa+G]=Math.floor(X[aa+G])}return{offsets_x:Y,offsets_y:X,offsets_xi:da,offsets_yi:ba,gridWidth:U}}l.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(l.NoDataInterpretation||(l.NoDataInterpretation={}));l.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(l.MissingBandAction||(l.MissingBandAction={}));l.approximateTransform=function(a,e,d,p,g="nearest"){if(!k(a))return null;
"majority"===g&&(a=r(a));const {pixels:c,mask:t,bandMasks:w,pixelType:z}=a,H=a.width;var I=a.height;const K=E.getPixelArrayConstructor(z),L=c.length,{width:N,height:S}=e;a=!1;for(var U=0;U<d.length;U+=3)-1===d[U]&&-1===d[U+1]&&-1===d[U+2]&&(a=!0);const {offsets_x:R,offsets_y:Y,offsets_xi:X,offsets_yi:da,gridWidth:ba}=J({width:H,height:I},e,d,p,"majority"===g?.5:0);let aa;e=(ka,f,G,M)=>{const O=ka instanceof Float32Array||ka instanceof Float64Array?0:.5;for(let T=0;T<S;T++){aa=T*ba;for(let P=0;P<N;P++){if(0>
R[aa]||0>Y[aa])ka[T*N+P]=0;else if(M)ka[T*N+P]=f[X[aa]+da[aa]*H];else{const V=Math.floor(R[aa]),W=Math.floor(Y[aa]),Q=Math.ceil(R[aa]),ca=Math.ceil(Y[aa]),Z=R[aa]-V,ja=Y[aa]-W;ka[T*N+P]=!G||G[V+W*H]&&G[Q+W*H]&&G[V+ca*H]&&G[Q+ca*H]?(1-ja)*((1-Z)*f[V+W*H]+Z*f[Q+W*H])+ja*((1-Z)*f[V+ca*H]+Z*f[Q+ca*H])+O:f[X[aa]+da[aa]*H]}aa++}}};d=[];p=w?.length===L;I=[];for(U=0;U<L;U++){if(p){var ea=new Uint8Array(N*S);e(ea,w[U],w[U],!0);I.push(ea)}ea=new K(N*S);e(ea,c[U],p?w[U]:t,"nearest"===g||"majority"===g);d.push(ea)}g=
new E({width:N,height:S,pixelType:z,pixels:d,bandMasks:p?I:void 0});if(null!=t)g.mask=new Uint8Array(N*S),e(g.mask,t,t,!0);else if(a)for(g.mask=new Uint8Array(N*S),a=0;a<N*S;a++)g.mask[a]=0>R[a]||0>Y[a]?0:1;g.updateStatistics();return g};l.clip=B;l.clipTile=function(a){const {pixelBlock:e,tileSize:d,level:p,row:g,col:c,useBilinear:t}=a;if(!k(e))return null;const {width:w,height:z}=d;var H=2**p;a=H*w;H*=z;a=B(e,{y:g*H,x:c*a},{width:a,height:H});if(!a)return null;for(H=p;0<H;H--)a=A(a,t);return a};
l.colorize=function(a,e){if(!k(a)||!e||!e.indexedColormap&&!e.indexed2DColormap)return a;const d=a.clone();var p=d.pixels;let g=d.mask;const c=d.width*d.height;if(1!==p.length)return a;const {indexedColormap:t,indexed2DColormap:w,offset:z,alphaSpecified:H}=e;a=0;p=p[0];e=new Uint8Array(p.length);const I=new Uint8Array(p.length),K=new Uint8Array(p.length);var L=0;if(t){const N=t.length-1;if(null!=g)for(a=0;a<c;a++)g[a]&&(L=4*(p[a]-z),L<z||L>N?g[a]=0:(e[a]=t[L],I[a]=t[L+1],K[a]=t[L+2],g[a]=t[L+3]));
else{g=new Uint8Array(c);for(a=0;a<c;a++)L=4*(p[a]-z),L<z||L>N?g[a]=0:(e[a]=t[L],I[a]=t[L+1],K[a]=t[L+2],g[a]=t[L+3]);d.mask=g}}else if(w)if(null!=g)for(a=0;a<c;a++)g[a]&&(L=w[p[a]],e[a]=L[0],I[a]=L[1],K[a]=L[2],g[a]=L[3]);else{g=new Uint8Array(c);for(a=0;a<c;a++)L=w[p[a]],e[a]=L[0],I[a]=L[1],K[a]=L[2],g[a]=L[3];d.mask=g}d.pixels=[e,I,K];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=H;return d};l.compositeBands=function(a){if(!a?.length||a.some(z=>!k(z)))return null;if(1===a.length)return a[0]?.clone()??
null;const {width:e,height:d,pixelType:p}=a[0];if(a.some(z=>z.width!==e||z.height!==d))return null;const g=a.map(({mask:z})=>z).filter(z=>null!=z);let c=null;g.length&&(c=new Uint8Array(e*d),c.set(g[0]),1<g.length&&F(g.slice(1),c));const t=[];a.forEach(({pixels:z})=>t.push(...z));const w=[];a.map(({statistics:z})=>z).filter(z=>z?.length).forEach(z=>w.push(...z));return new E({pixelType:p,width:e,height:d,mask:c,pixels:t,statistics:w.length?w:null})};l.createColormapLUT=function(a){if(a){var e=a.colormap;
if(e&&0!==e.length){e=e.sort((H,I)=>H[0]-I[0]);var d=0;0>e[0][0]&&(d=e[0][0]);var p=Math.max(256,e[e.length-1][0]-d+1),g=new Uint8Array(4*p),c=[],t=0,w=0,z=5===e[0].length;if(65536<p)return e.forEach(H=>{c[H[0]-d]=z?H.slice(1):H.slice(1).concat([255])}),{indexed2DColormap:c,offset:d,alphaSpecified:z};if(a.fillUnspecified)for(a=e[w],t=a[0]-d;t<p;t++)g[4*t]=a[1],g[4*t+1]=a[2],g[4*t+2]=a[3],g[4*t+3]=z?a[4]:255,t===a[0]-d&&(a=w===e.length-1?a:e[++w]);else for(t=0;t<e.length;t++)a=e[t],w=4*(a[0]-d),g[w]=
a[1],g[w+1]=a[2],g[w+2]=a[3],g[w+3]=z?a[4]:255;return{indexedColormap:g,offset:d,alphaSpecified:z}}}};l.createMaskLUT=function(a,e,d){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var p=a.includes("16")?65536:256;a=a.includes("s")?-p/2:0;p=new Uint8Array(p);if(e)for(let c=0;c<e.length;c++){var g=Math.ceil(e[2*c]-a);const t=Math.floor(e[2*c+1]-a);for(;g<=t;g++)p[g]=255}else p.fill(255);if(d)for(e=0;e<d.length;e++)p[d[e]-a]=0;return{lut:p,offset:a}};l.createRemapLUT=function(a){const {srcPixelType:e,
inputRanges:d,outputValues:p,allowUnmatched:g,noDataRanges:c,isLastInputRangeInclusive:t,outputPixelType:w}=a;if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;var z=e.includes("16")?65536:256;a=e.includes("s")?-z/2:0;const H=E.createEmptyBand(w,z);z=new Uint8Array(z);g&&z.fill(255);const [I,K]=h.getPixelValueRange(w);if(d?.length&&p?.length){var L=d.map(R=>R-1E-6);L[0]=d[0];t&&(L[L.length-1]=d[d.length-1]);for(var N=0;N<L.length;N++){var S=p[N]>K?K:p[N]<I?I:p[N],U=Math.ceil(L[2*N]-a);const R=
Math.floor(L[2*N+1]-a);for(;U<=R;U++)H[U]=S,z[U]=255}}if(c?.length)for(L=0;L<c.length;L++)for(S=Math.ceil(c[2*L]-a),N=Math.floor(c[2*L+1]-a);S<=N;S++)z[S]=0;return{lut:H,offset:a,mask:z}};l.extractBands=function(a,e){return e?.length&&k(a)?a.extractBands(e):a};l.getClipBounds=x;l.getLocalArithmeticNorthRotations=function(a,e){const {coefficients:d,spacing:p}=e,{offsets_x:g,offsets_y:c,gridWidth:t}=J(a,a,d,{rows:p[0],cols:p[1]}),{width:w,height:z}=a;a=new Float32Array(w*z);e=180/Math.PI;for(let K=
0;K<z;K++)for(let L=0;L<w;L++){var H=K*t+L,I=0===K?H:H-t;const N=K===z-1?H:H+t;H=g[I]-g[N];I=c[N]-c[I];isNaN(H)||isNaN(I)?a[K*w+L]=90:(I=Math.atan2(I,H)*e,I=(360+I)%360,a[K*w+L]=I)}return a};l.interpolateOffsets=J;l.isValidPixelBlock=k;l.lookupBandValues=v;l.lookupPixels=function(a,e){if(!k(a))return null;const {pixels:d,mask:p}=a,g=d.length;let c=e.lut;const {offset:t}=e;c&&1===c[0].length&&(c=d.map(()=>c));const w=[];e=e.outputPixelType||"u8";for(let z=0;z<g;z++){const H=v(d[z],p,c[z],t||0,e);w.push(H)}a=
new E({width:a.width,height:a.height,pixels:w,mask:p,pixelType:e});a.updateStatistics();return a};l.mask=function(a,e){if(!k(a))return null;const {width:d,height:p,pixels:g}=a;var c=d*p;const t=new Uint8Array(c);a.mask?t.set(a.mask):t.fill(255);a=g.length;const {includedRanges:w,noDataValues:z,outputPixelType:H,matchAll:I,lookups:K}=e;if(K){c=[];for(e=0;e<a;e++){var L=K[e];L=v(g[e],t,L.lut,L.offset||0,"u8");c.push(L)}1===c.length?t.set(c[0]):I?D(c,t):F(c,t)}else if(I){e=[];for(L=0;L<a;L++){const N=
new Uint8Array(c);N.set(t);u(g[L],w?.slice(2*L,2*L+2),z?.[L],N);e.push(N)}1===e.length?t.set(e[0]):D(e,t)}else for(c=0;c<a;c++)u(g[c],w?.slice(2*c,2*c+2),z?.[c],t);return new E({width:d,height:p,pixelType:H,pixels:g,mask:t})};l.maxMapSizeGpu=6;l.mosaic=m;l.mosaicPixelData=function(a,e){if(!a||0===a.length)return null;var d=a.find(K=>K.pixelBlock);if(null==d?.pixelBlock)return null;var p=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width;const g=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,c=.01*
Math.min(p,g),t=a.sort((K,L)=>Math.abs(K.extent.ymax-L.extent.ymax)>c?L.extent.ymax-K.extent.ymax:Math.abs(K.extent.xmin-L.extent.xmin)>c?K.extent.xmin-L.extent.xmin:0);var w=Math.min.apply(null,t.map(K=>K.extent.xmin));const z=Math.min.apply(null,t.map(K=>K.extent.ymin)),H=Math.max.apply(null,t.map(K=>K.extent.xmax)),I=Math.max.apply(null,t.map(K=>K.extent.ymax));a={x:Math.round((e.xmin-w)/p),y:Math.round((I-e.ymax)/g)};w={width:Math.round((H-w)/p),height:Math.round((I-z)/g)};p={width:Math.round((e.xmax-
e.xmin)/p),height:Math.round((e.ymax-e.ymin)/g)};if(Math.round(w.width/d.pixelBlock.width)*Math.round(w.height/d.pixelBlock.height)!==t.length||0>a.x||0>a.y||w.width<p.width||w.height<p.height)return null;d=t.map(K=>K.pixelBlock);d=m(d,w,{clipOffset:a,clipSize:p});return{extent:e,pixelBlock:d}};l.remap=function(a,e){if(!k(a))return null;const {width:d,height:p}=a,{inputRanges:g,outputValues:c,outputPixelType:t,noDataRanges:w,allowUnmatched:z,isLastInputRangeInclusive:H}=e;e=a.pixels[0];const I=E.createEmptyBand(t,
e.length),K=a.mask,L=new Uint8Array(d*p);K?L.set(K):L.fill(255);const N=a.pixelType.startsWith("f")?1E-6:0;a=g.map(aa=>aa-N);a[0]=g[0];a[a.length-1]=g[g.length-1]+(H?1E-6:0);var S=g.length/2;const [U,R]=h.getPixelValueRange(t);for(var Y=0;Y<p;Y++)for(var X=0;X<d;X++){var da=Y*d+X;if(L[da]){var ba=e[da];let aa=!1;for(let ea=S-1;0<=ea;ea--)if(ba===a[2*ea]||ba>a[2*ea]&&ba<a[2*ea+1]){I[da]=c[ea];aa=!0;break}aa||(z?I[da]=ba>R?R:ba<U?U:ba:L[da]=0)}}if(a=w?.length)for(S=0;S<p;S++)for(Y=0;Y<d;Y++)if(X=S*
d+Y,!K||K[X])for(da=e[X],ba=0;ba<a;ba+=2)if(da>=w[ba]&&da<=w[ba+1]){I[X]=0;L[X]=0;break}return new E({width:d,height:p,pixelType:t,pixels:[I],mask:L})};l.remapColor=function(a,e){if(!k(a))return null;a=a.clone();var {pixels:d}=a;const p=a.width*a.height,g=e.length,c=Math.floor(g/2),t=e[Math.floor(c)];d=d[0];let w,z,H,I,K,L,N=!1;const S=new Uint8Array(p),U=new Uint8Array(p),R=new Uint8Array(p);let Y=a.mask;const X=4===e[0].mappedColor.length;Y||(Y=new Uint8Array(p),Y.fill(X?255:1),a.mask=Y);for(K=
0;K<p;K++)if(Y[K]){w=d[K];N=!1;L=c;z=t;H=0;for(I=g-1;1<I-H;){if(w===z.value){N=!0;break}w>z.value?H=L:I=L;L=Math.floor((H+I)/2);z=e[Math.floor(L)]}N||(w===e[H].value?(z=e[H],N=!0):w===e[I].value?(z=e[I],N=!0):w<e[H].value?(N=!1,z=null):w>e[H].value&&(w<e[I].value?(z=e[H],N=!0):I===g-1?(N=!1,z=null):(z=e[I],N=!0)));N?(S[K]=z.mappedColor[0],U[K]=z.mappedColor[1],R[K]=z.mappedColor[2],Y[K]=z.mappedColor[3]):S[K]=U[K]=R[K]=Y[K]=0}a.pixels=[S,U,R];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};l.resampleByMajority=
r;l.setValidBoundary=function(a,e,d){if(!k(a))return null;const {width:p,height:g}=a,c=e.x;e=e.y;const t=d.width+c;d=d.height+e;if(0>c||0>e||t>p||d>g||0===c&&0===e&&t===p&&d===g)return a;a.mask||(a.mask=new Uint8Array(p*g));const w=a.mask;for(let z=0;z<g;z++){const H=z*p;for(let I=0;I<p;I++)w[H+I]=z<e||z>=d||I<c||I>=t?0:1}a.updateStatistics();return a};l.split=function(a,e,d=0,p=!0){if(!k(a))return null;const {width:g,height:c}=e;let {width:t,height:w}=a;const z=new Map,H={x:0,y:0};d=1+d;for(let I=
0;I<d;I++){const K=Math.ceil(t/g),L=Math.ceil(w/c);for(let N=0;N<L;N++){H.y=N*c;for(let S=0;S<K;S++){H.x=S*g;const U=B(a,H,e);z.set(`${I}/${N}/${S}`,U)}}I<d-1&&(a=A(a,p));t=Math.round(t/2);w=Math.round(w/2)}return z};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),function(l,E,
h,k,v,u){class D extends u{constructor(){super(...arguments);this.isCustomTilingScheme=!1;this.symbolTypes=["triangle"]}createTile(F){const x=this._tileInfoView.getTileBounds(E.create(),F),[C,m]=this._tileInfoView.tileInfo.size,b=this._tileInfoView.getTileResolution(F.level);return new k.RasterVFTile(F,b,x[0],x[3],C,m)}prepareRenderPasses(F){const x=F.registerRenderPass({name:"imagery (vf tile)",brushes:[h],target:()=>this.children.map(C=>C.tileData),drawPhase:v.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(F),
x]}doRender(F){this.visible&&F.drawPhase===v.WGLDrawPhase.MAP&&this.symbolTypes.forEach(x=>{F.renderPass=x;super.doRender(F)})}}l.RasterVFTileContainer=D;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],function(l,E){const h=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,
.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),k=new Float32Array([0,
92/255,230/255,1]),v={beaufort_ft:h,beaufort_m:h,beaufort_km:h,beaufort_mi:h,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,
.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,
1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:k,single_arrow:k,wind_speed:new Float32Array([0,0,0,1])},u=[0,20];class D extends l{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:F}){F.setBlendingEnabled(!0);
F.setBlendFunctionSeparate(E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA,E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA);F.setColorMask(!0,!0,!0,!0);F.setStencilWriteMask(0);F.setStencilTestEnabled(!0);F.setStencilOp(E.StencilOperation.KEEP,E.StencilOperation.KEEP,E.StencilOperation.REPLACE)}draw(F,x){if(null!=x.source&&0!==x.source.validPixelCount){var {context:C,timeline:m}=F;m.begin(this.name);C.setStencilFunction(E.CompareFunction.EQUAL,x.stencilRef,255);x.updateVectorFieldVAO(F);if("scalar"===
F.renderPass){var b=x.vaoData.scalar;b&&this._drawScalars(F,x,b.vao,b.elementCount)}else(b=x.vaoData.magdir)&&this._drawTriangles(F,x,b.vao,b.elementCount);m.end(this.name)}}_drawTriangles(F,x,C,m){const {context:b,painter:r,requestRender:n,allowDelayedRender:q}=F,{symbolizerParameters:y}=x;var B=y.dataRange?["dataRange"]:[];"geographic"===y.rotationType&&B.push("rotationGeographic");B=r.materialManager.getProgram(this._desc.magdir,B);if(q&&null!=n&&!B.compiled)n();else{b.useProgram(B);var {coordScale:A,
opacity:J,transforms:a}=x;B.setUniform2fv("u_coordScale",A);B.setUniform1f("u_opacity",J);B.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);var {style:e,dataRange:d,rotation:p,symbolPercentRange:g}=y;B.setUniform4fv("u_colors",v[e]);B.setUniform2fv("u_dataRange",d||u);B.setUniform1f("u_rotation",p);B.setUniform2fv("u_symbolPercentRange",g);F=this._getSymbolSize(F,x);B.setUniform2fv("u_symbolSize",F);b.bindVAO(C);b.drawElements(E.PrimitiveType.TRIANGLES,m,E.DataType.UNSIGNED_INT,0)}}_drawScalars(F,
x,C,m){const {context:b,painter:r,requestRender:n,allowDelayedRender:q}=F,{symbolizerParameters:y}=x;var B=[];"wind_speed"===y.style?B.push("innerCircle"):y.dataRange&&B.push("dataRange");"geographic"===y.rotationType&&B.push("rotationGeographic");B=r.materialManager.getProgram(this._desc.scalar,B);if(q&&null!=n&&!B.compiled)n();else{b.useProgram(B);var {coordScale:A,opacity:J,transforms:a}=x;B.setUniform2fv("u_coordScale",A);B.setUniform1f("u_opacity",J);B.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);
var {dataRange:e,symbolPercentRange:d}=y;B.setUniform2fv("u_dataRange",e||u);B.setUniform2fv("u_symbolPercentRange",d);F=this._getSymbolSize(F,x);B.setUniform2fv("u_symbolSize",F);b.bindVAO(C);b.drawElements(E.PrimitiveType.TRIANGLES,m,E.DataType.UNSIGNED_INT,0)}}_getSymbolSize(F,x){F=x.key?2**(F.displayLevel-x.key.level):x.resolution/F.state.resolution;const {symbolTileSize:C}=x.symbolizerParameters;return[C/(Math.round((x.width-x.offset[0])/C)*C)/F,C/(Math.round((x.height-x.offset[1])/C)*C)/F]}}
return D})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterVFDisplayObject","../webgl/TiledDisplayObject"],function(l,E,h,k,v){class u extends v.TiledDisplayObject{constructor(D,F,x,C,m,b,r=null){super(D,F,x,C,m,b);this.tileData=new k.RasterVFDisplayObject(r);this.tileData.coordScale=[m,b];this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy();this.tileData.destroy();
this.stage=this.tileData=null}set stencilRef(D){this.tileData.stencilRef=D}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:h.create(),tileMat3:h.create()}}setTransform(D){super.setTransform(D);const F=this.resolution/(D.resolution*D.pixelRatio),x=this.transforms.tileMat3,[C,m]=this.tileData.offset,[b,r]=D.toScreenNoRotation([0,0],[this.x+C*this.resolution,this.y-m*this.resolution]),{symbolTileSize:n}=this.tileData.symbolizerParameters;E.set(x,Math.round((this.width-
this.tileData.offset[0])/n)*n/this.rangeX*F,0,0,0,Math.round((this.height-this.tileData.offset[1])/n)*n/this.rangeY*F,0,b,r,1);E.multiply(this.transforms.displayViewScreenMat3,D.displayViewMat3,x);this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}l.RasterVFTile=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(l,E,h,k,v,u,D,F,x,C,m){class b extends D.DisplayObject{constructor(r=null){super();this._symbolizerParameters=this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=r}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(r){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(r)&&(this._symbolizerParameters=r,this.invalidateVAO())}get source(){return this._source}set source(r){this._source=r;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(r){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:n}=this.symbolizerParameters;
switch(n){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":n=u.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(r.context,n)};break;case "simple_scalar":n=u.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(r.context,n)};break;case "wind_speed":n=u.createVFMesh(this.source,
this.symbolizerParameters);n=this._createVectorFieldVAO(r.context,n);const q=u.createVFMeshScalar(this.source,this.symbolizerParameters);r=this._createVectorFieldVAO(r.context,q);this.vaoData={magdir:n,scalar:r}}}this.ready();this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:k.create()}}setTransform(r){const n=h.identity(this.transforms.displayViewScreenMat3),[q,y]=r.toScreenNoRotation([0,0],[this.x,this.y]);var B=this.resolution/this.pixelRatio/r.resolution;const A=B*this.width;
B*=this.height;const J=Math.PI*this.rotation/180;h.translate(n,n,v.fromValues(q,y));h.translate(n,n,v.fromValues(A/2,B/2));h.rotate(n,n,-J);h.translate(n,n,v.fromValues(-A/2,-B/2));h.scaleByVec2(n,n,v.fromValues(A,B));h.multiply(this.transforms.displayViewScreenMat3,r.displayViewMat3,n)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(r,n){const {vertexData:q,indexData:y}=n;n=x.BufferObject.createVertex(r,C.Usage.STATIC_DRAW,new Float32Array(q));const B=x.BufferObject.createIndex(r,
C.Usage.STATIC_DRAW,new Uint32Array(y)),A=F.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:C.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:C.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:C.DataType.FLOAT,normalized:!1}]});return{vao:new m.VertexArrayObject(r,A.attributes,A.bufferLayouts,{geometry:n},B),elementCount:y.length}}}l.RasterVFDisplayObject=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(l,E,h,k,v,u,D,F,x,C,m){return b=>{b=class extends b{constructor(){super(...arguments);this._rasterFieldPrefix=
"Raster.";this.tileInfo=this.view=this.layer=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return C.projectDatasetExtent(this.layer.serviceRasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return C.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(r){return!!C.projectDatasetExtent(this.layer.serviceRasterInfo,
r)}async fetchPopupFeaturesAtLocation(r,n){const {layer:q}=this;if(!r)throw new h("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:q});var {popupEnabled:y}=q;const B=m.getFetchPopupTemplate(q,n);if(!y||null==B)throw new h("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:y,popupTemplate:B});y=[];const {value:A,magdirValue:J,processedValue:a}=await q.identify(r,{timeExtent:this.timeExtent,signal:n?.signal});let e=
"";if(A&&A.length){e="imagery-tile"===q.type&&q.hasStandardTime()&&null!=A[0]?A.map(p=>q.getStandardTimeValue(p)).join(", "):A.join(", ");r={ObjectId:0};r["Raster.ServicePixelValue"]="imagery-tile"===q.type&&"Function"===q.raster.datasetFormat?a?.join(", "):e;r["Raster.ServicePixelValue.Raw"]=e;n=q.serviceRasterInfo.attributeTable;if(null!=n){const {fields:p,features:g}=n,c=p.find(({name:t})=>"value"===t.toLowerCase());if(n=c?g.find(t=>String(t.attributes[c.name])===e):null)for(var d in n.attributes)n.attributes.hasOwnProperty(d)&&
(r[this._rasterFieldPrefix+d]=n.attributes[d])}d=q.serviceRasterInfo.dataType;if("vector-magdir"===d||"vector-uv"===d)r["Raster.Magnitude"]=J?.[0],r["Raster.Direction"]=J?.[1];d=new E(this.fullExtent.clone(),null,r);d.layer=q;d.sourceLayer=d.layer;y.push(d)}return y}};l.__decorate([k.property()],b.prototype,"layer",void 0);l.__decorate([k.property(x.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);l.__decorate([k.property()],b.prototype,"view",void 0);l.__decorate([k.property()],
b.prototype,"fullExtent",null);l.__decorate([k.property()],b.prototype,"tileInfo",void 0);l.__decorate([k.property({readOnly:!0})],b.prototype,"hasTilingEffects",null);l.__decorate([k.property()],b.prototype,"datumTransformation",null);return b=l.__decorate([F.subclass("esri.views.layers.ImageryTileLayerView")],b)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(l,E){function h(k,v){return k.popupTemplate?k.popupTemplate:null!=
v&&v.defaultPopupTemplateEnabled&&null!=k.defaultPopupTemplate?k.defaultPopupTemplate:null}l.getFetchPopupTemplate=h;l.getRequiredFields=async function(k,v=k.popupTemplate){if(null==v)return[];const u=await v.getRequiredFields(k.fieldsIndex);({lastEditInfoEnabled:v}=v);const {objectIdField:D,typeIdField:F,globalIdField:x,relationships:C}=k;if(u.includes("*"))return["*"];v=v?E.getFeatureEditFields(k):[];const m=E.fixFields(k.fieldsIndex,[...u,...v]);F&&m.push(F);m&&D&&k.fieldsIndex?.has(D)&&!m.includes(D)&&
m.push(D);m&&x&&k.fieldsIndex?.has(x)&&!m.includes(x)&&m.push(x);C&&C.forEach(b=>{({keyField:b}=b);m&&b&&k.fieldsIndex?.has(b)&&!m.includes(b)&&m.push(b)});return m};l.hasPopupTemplate=function(k,v){return null!=h(k,{defaultPopupTemplateEnabled:v})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(l,E,h,k,v,u,D,F){return x=>{x=class extends x{initialize(){this.addHandles(k.on(()=>this.layer,"refresh",C=>{this.doRefresh(C.dataChanged).catch(m=>{h.isAbortError(m)||E.getLogger(this).error(m)})}),"RefreshableLayerView")}};return x=l.__decorate([F.subclass("esri.layers.mixins.RefreshableLayerView")],x)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(l,
E,h,k,v,u,D,F,x,C,m,b,r,n,q,y,B){u=class extends q(B(m.LayerView2DMixin(y))){constructor(){super(...arguments);this._useProgressiveUpdate=this._useWebGLForProcessing=!0;this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(A){this._useWebGLForProcessing=A;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=A)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(A){this._useProgressiveUpdate=
A;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=A)}get displayParameters(){const {layer:A}=this,J=this._get("displayParameters");return A.renderer?{bandIds:A.bandIds,renderer:A.renderer,interpolation:A.interpolation,multidimensionalDefinition:A.multidimensionalDefinition,rasterFunction:"imagery-tile"===A.type?A.rasterFunction:null}:J}update(A){this.subview?.update(A);this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage();
this._updateSubview();this.addAttachHandles([k.watch(()=>this.displayParameters,(A,J)=>{const a=A.interpolation!==J?.interpolation&&("majority"===A.interpolation||"majority"===J?.interpolation)&&n.canUseMajorityInterpolationOnDataSource(this.layer),e=A.renderer!==J?.renderer&&this._getSubviewType(J?.renderer)!==this._getSubviewType(A.renderer);e&&this._updateSubview();const d=A.rasterFunction!==J?.rasterFunction,p=d&&!this._useWebGLForProcessing;this.subview.redrawOrRefetch({refetch:A.multidimensionalDefinition!==
J?.multidimensionalDefinition||a||e||p,reprocess:d}).catch(g=>{h.isAbortError(g)||E.getLogger(this).error(g)});this.notifyChange("updating")}),k.watch(()=>this.layer.multidimensionalSubset??null,(A,J)=>{const {multidimensionalDefinition:a}=this.layer;null!=a&&x.hasExcludedVariableOrDimension(a,A)!==x.hasExcludedVariableOrDimension(a,J)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(e=>{h.isAbortError(e)||E.getLogger(this).error(e)}),this.notifyChange("updating"))},k.sync),k.watch(()=>this.timeExtent,
()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch({refetch:!0}).catch(A=>{h.isAbortError(A)||E.getLogger(this).error(A)})},k.initial)])}detach(){this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){var {renderer:A}=this.layer;
if(A){A=this._getSubviewType(A);if(this.subview){if(this.subview.type===A){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}var {layer:J}=this;A="rasterVF"===A?new r({layer:J,layerView:this}):"flow"===A?new C({layer:J,layerView:this}):new b({layer:J,layerView:this});"useWebGLForProcessing"in A&&(A.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in A&&(A.useProgressiveUpdate=this._useProgressiveUpdate);"previousLOD"in
A&&({subview:J}=this,A.previousLOD=J&&"previousLOD"in J?J.previousLOD:null);this._attachSubview(A);this.subview=A;this.requestUpdate()}}_attachSubview(A){A&&!A.attached&&(A.attach(),A.attached=!0,this.container.addChildAt(A.container,0))}_detachSubview(A){A?.attached&&(this.container.removeChild(A.container),A.detach(),A.attached=!1)}_getSubviewType(A){A=A?.type;return"vector-field"===A?"rasterVF":"flow"===A?"flow":"raster"}};l.__decorate([v.property()],u.prototype,"subview",void 0);l.__decorate([v.property()],
u.prototype,"useWebGLForProcessing",null);l.__decorate([v.property()],u.prototype,"useProgressiveUpdate",null);l.__decorate([v.property({readOnly:!0})],u.prototype,"displayParameters",null);return u=l.__decorate([F.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],u)});