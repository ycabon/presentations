// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(d,b,q,x,k,a,p,l,A,C,H,g){d.MediaElementView=class extends q{constructor(e){super(e)}get bounds(){const e=
this.coords;return null==e?.extent?null:H.fromExtent(e.extent)}get coords(){return C.projectOrLoad(this.element.georeference?.coords,this.spatialReference).geometry}get normalizedCoords(){return A.fromJSON(g.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?H.fromExtent(e):null}};b.__decorate([x.property()],d.MediaElementView.prototype,"spatialReference",void 0);b.__decorate([x.property()],d.MediaElementView.prototype,
"element",void 0);b.__decorate([x.property()],d.MediaElementView.prototype,"bounds",null);b.__decorate([x.property()],d.MediaElementView.prototype,"coords",null);b.__decorate([x.property()],d.MediaElementView.prototype,"normalizedCoords",null);b.__decorate([x.property()],d.MediaElementView.prototype,"normalizedBounds",null);d.MediaElementView=b.__decorate([l.subclass("esri.layers.support.MediaElementView")],d.MediaElementView);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../symbols/cim/enums ../DisplayObject ./animatedFormats/utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexArrayObject".split(" "),
function(d,b,q,x,k,a,p,l,A,C,H,g,e,r,G,L,J){function I(f){return f?{...f,playAnimation:f.playing,repeatType:f.repeatType?v[f.repeatType]:void 0}:{}}const w=p.create(),v={none:C.AnimatedSymbolRepeatType.None,loop:C.AnimatedSymbolRepeatType.Loop,oscillate:C.AnimatedSymbolRepeatType.Oscillate};class t extends H.DisplayObject{constructor(f){super();this.elementView=f;this.isWrapAround=!1;this.perspectiveTransform=A.create();this._playHandle=null;this._vertices=new Float32Array(20);this._handles=[];this._handles.push(a.watch(()=>
this.elementView.element.opacity,m=>this.opacity=m,a.initial),a.watch(()=>[this.elementView.coords],()=>{this.requestRender()},a.initial),a.watch(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._playHandle?.remove();this.texture=x.disposeMaybe(this.texture);this.requestRender()},a.initial),a.when(()=>this.elementView.element.loaded,()=>{const m=this.elementView.element;this.ready();"video"===m.type&&null!=m.content&&this._handles.push(b.on(m.content,
"play",()=>this.requestRender()))},a.initial));f.element.load().catch(m=>{q.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new d("element-load-error","Element cannot be displayed",{element:f,error:m}))})}getMesh(f){throw Error("Method not implemented.");}destroy(){this._playHandle?.remove();this._handles.forEach(f=>f.remove());this.texture=x.disposeMaybe(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(f){const {context:m}=f,n=this.elementView.element.content;if(null!=
n){var y=n instanceof HTMLImageElement;const z=n instanceof HTMLVideoElement;var B=y?n.naturalWidth:z?n.videoWidth:n.width;y=y?n.naturalHeight:z?n.videoHeight:n.height;this._updatePerspectiveTransform(B,y);if(this.texture)z&&!n.paused&&(this.texture.setData(n),this.requestRender(),this.texture.generateMipmap());else{const F=new L.TextureDescriptor;F.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;F.preMultiplyAlpha=!0;F.width=B;F.height=y;"getFrame"in n?(B=D=>{this.texture?this.texture.setData(D):this.texture=
new G.Texture(m,F,D);this.requestRender()},"animationOptions"in this.elementView.element&&(this._playHandle=g.play(n,I(this.elementView.element.animationOptions),null,B))):this.texture=new G.Texture(m,F,n);this.texture.generateMipmap();z&&!n.paused&&this.requestRender()}}super.beforeRender(f)}_createTransforms(){return null}updateDrawCoords(f,m){var n=this.elementView.coords;if(null!=n){var [y,B,z,F]=n.rings[0];n=this._vertices;var {x:D,y:E}=f;(f=0!==m)?n.set([B[0]-D,B[1]-E,y[0]-D,y[1]-E,z[0]-D,z[1]-
E,F[0]-D,F[1]-E,F[0]-D,F[1]-E,B[0]+m-D,B[1]-E,B[0]+m-D,B[1]-E,y[0]+m-D,y[1]-E,z[0]+m-D,z[1]-E,F[0]+m-D,F[1]-E]):n.set([B[0]-D,B[1]-E,y[0]-D,y[1]-E,z[0]-D,z[1]-E,F[0]-D,F[1]-E]);this.isWrapAround=f}}getVAO(f,m,n){if(null==this.elementView.coords)return null;var y=this._vertices;this._vao?this._geometryVbo.setData(y):(this._geometryVbo=e.BufferObject.createVertex(f,r.Usage.DYNAMIC_DRAW,y),y=e.BufferObject.createVertex(f,r.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),
this._vao=new J.VertexArrayObject(f,n,m,{geometry:this._geometryVbo,tex:y}));return this._vao}_updatePerspectiveTransform(f,m){const n=this._vertices;k.getProjectiveTransform(w,[0,0,f,0,0,m,f,m],[n[0],n[1],n[4],n[5],n[2],n[3],n[6],n[7]]);l.set(this.perspectiveTransform,w[6]/w[8]*f,w[7]/w[8]*m)}}return t})},"esri/core/perspectiveUtils":function(){define("exports ./libs/gl-matrix-2/math/mat3 ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/math/vec2 ../chunks/vec32 ./libs/gl-matrix-2/factories/vec3f64".split(" "),
function(d,b,q,x,k,a){function p(g,e,r,G,L,J,I,w,v){b.set(g,e,G,J,r,L,I,1,1,1);k.set(l,w,v,1);b.adjoint(A,g);const [t,f,m]=k.transformMat3(l,l,b.transpose(A,A));b.set(A,t,0,0,0,f,0,0,0,m);return b.multiply(g,A,g)}const l=a.create(),A=q.create(),C=q.create(),H=q.create();d.getProjectiveTransform=function(g,e,r){p(C,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);p(H,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]);b.multiply(g,b.adjoint(C,C),H);0!==g[8]&&(g[0]/=g[8],g[1]/=g[8],g[2]/=g[8],g[3]/=g[8],g[4]/=g[8],g[5]/=
g[8],g[6]/=g[8],g[7]/=g[8],g[8]/=g[8]);return g};d.transformProjective=function(g,e,r){k.set(l,e[0],e[1],1);k.transformMat3(l,l,b.transpose(A,r));return 0===l[2]?x.set(g,l[0],l[1]):x.set(g,l[0]/l[2],l[1]/l[2])};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],function(d){function b(){return[1,0,0,0,1,0,0,0,1]}function q(l){return[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8]]}function x(l,A,C,H,g,e,r,G,L){return[l,
A,C,H,g,e,r,G,L]}function k(l,A){return new Float64Array(l,A,9)}const a=b(),p=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a,clone:q,create:b,createView:k,fromValues:x},Symbol.toStringTag,{value:"Module"}));d.IDENTITY=a;d.clone=q;d.create=b;d.createView=k;d.fromValues=x;d.mat3f64=p;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),
function(d,b,q,x,k,a,p,l,A,C,H){class g extends H{constructor(){super(...arguments);this._localOrigin=d.createScreenPoint(0,0);this._viewStateId=-1;this._dvsMat3=q.create()}get dvsMat3(){return this._dvsMat3}beforeRender(e){this._updateMatrices(e);this._updateOverlays(e,this.children);for(const r of this.children)r.beforeRender(e)}prepareRenderPasses(e){const r=e.registerRenderPass({name:"overlay",brushes:[A.brushes.overlay],target:()=>this.children,drawPhase:C.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),
r]}_updateMatrices(e){var {state:r}=e;const {id:G,size:L,pixelRatio:J,resolution:I,rotation:w,viewpoint:v,displayMat3:t}=r;if(this._viewStateId!==G){e=Math.PI/180*w;var f=J*L[0],m=J*L[1],{x:n,y}=v.targetGeometry;r=a.normalizeMapX(n,r.spatialReference);this._localOrigin.x=r;this._localOrigin.y=y;r=I*f;var B=I*m,z=b.identity(this._dvsMat3);b.multiply(z,z,t);b.translate(z,z,x.fromValues(f/2,m/2));b.scale(z,z,k.fromValues(f/r,-m/B,1));b.rotate(z,z,-e);this._viewStateId=G}}_updateOverlays(e,r){const {state:G}=
e,{rotation:L,spatialReference:J,worldScreenWidth:I,size:w,viewpoint:v}=G;e=this._localOrigin;let t=0;var f=p.getInfo(J);if(f&&J.isWrappable){var m=180/Math.PI*L,n=Math.round(w[0]*Math.abs(Math.cos(m))+w[1]*Math.abs(Math.sin(m)));const [B,z]=f.valid;f=l.getWorldWidth(J);const {x:F,y:D}=v.targetGeometry;m=[0,0];G.toScreen(m,[F,D]);const E=[0,0];n=n>I?.5*I:.5*n;var y=Math.floor((F+.5*f)/f);const V=B+y*f;y=z+y*f;const S=[m[0]+n,0];G.toMap(E,S);E[0]>y&&(t=f);S[0]=m[0]-n;G.toMap(E,S);E[0]<V&&(t=-f);for(const O of r){r=
O.elementView.bounds;if(null==r)continue;const [T,,U]=r;T<B&&U>B?O.updateDrawCoords(e,f):U>z&&T<z?O.updateDrawCoords(e,-f):O.updateDrawCoords(e,t)}}else for(m of r)m.updateDrawCoords(e,t)}}return g})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(d,b,q,x,k,a,p,l,A,C,H,g,e,r,G,L,J){const I=q.ofType({key:"type",base:null,typeMap:{rect:G,path:J,geometry:L}});d.LayerView2DMixin=w=>{w=class extends w{constructor(){super(...arguments);this.attached=!1;this.clips=new I;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const v=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&v&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new k("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new e.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([a.watch(()=>this.suspended,t=>{this.container&&(this.container.visible=!t)},a.syncAndInitial),a.watch(()=>this.updateSuspended,t=>{this.view&&!t&&this.updateRequested&&this.view.requestUpdate()},a.syncAndInitial),a.watch(()=>this.layer?.opacity??
1,t=>{this.container&&(this.container.opacity=t)},a.syncAndInitial),a.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",t=>{this.container&&(this.container.blendMode=t)},a.syncAndInitial),a.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,t=>{this.container&&(this.container.effect=t)},a.syncAndInitial),a.watch(()=>this.highlightOptions,t=>this.container.highlightOptions=t,a.syncAndInitial),a.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},a.syncAndInitial),a.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:t})=>{t=null!=t?this.isVisibleAtScale(t):!1;t!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",t)},a.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(t=>{t===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const v=this.view?.spatialReference;return null==v||this.supportsSpatialReference(v)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(v){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;const {minScale:f,maxScale:m}=t;return g.isInScaleRange(v,f,m)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(v){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
v),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(v)))}hitTest(v,t){return Promise.resolve(null)}supportsSpatialReference(v){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const v=super.getSuspendInfo(),t=!this.spatialReferenceSupported,f=this.visibleAtCurrentScale;t&&(v.spatialReferenceNotSupported=t);f&&(v.outsideScaleRange=f);return v}addAttachHandles(v){this.addHandles(v,"attach")}};
b.__decorate([p.property()],w.prototype,"attached",void 0);b.__decorate([p.property({type:I,set(v){v=x.referenceSetter(v,this._get("clips"),I);this._set("clips",v)}})],w.prototype,"clips",void 0);b.__decorate([p.property()],w.prototype,"container",void 0);b.__decorate([p.property()],w.prototype,"moving",void 0);b.__decorate([p.property({readOnly:!0})],w.prototype,"spatialReferenceSupported",null);b.__decorate([p.property({readOnly:!0})],w.prototype,"updateParameters",void 0);b.__decorate([p.property()],
w.prototype,"updateRequested",void 0);b.__decorate([p.property()],w.prototype,"updateSuspended",null);b.__decorate([p.property()],w.prototype,"updating",null);b.__decorate([p.property()],w.prototype,"view",void 0);b.__decorate([p.property({readOnly:!0})],w.prototype,"visibleAtCurrentScale",void 0);b.__decorate([p.property({type:r})],w.prototype,"highlightOptions",void 0);return w=b.__decorate([H.subclass("esri.views.2d.layers.LayerView2D")],w)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(d,b,q){function x(k,a){a=q.getMetersPerUnitForSR(a);return k/(a*q.inchesPerMeter*96)}d.getExtentForScale=function(k,a){const p=k.extent;k=k.width-(k.padding?k.padding.left+k.padding.right:0);a=x(a,p.spatialReference);return p.clone().expand(a*k/p.width)};d.getResolutionForScale=x;d.getResolutionInMetersForScale=function(k){return k/(96*q.inchesPerMeter)};d.getScale=function(k,a){a=
a||k.extent;k=k.width;const p=q.getMetersPerUnitForSR(a?.spatialReference);return a&&k?a.width/k*p*q.inchesPerMeter*96:0};d.getScaleForResolution=function(k,a){a=q.getMetersPerUnitForSR(a);return k*a*q.inchesPerMeter*96};d.isInScaleRange=function(k,a,p){if(a=0===a||b.floatEqualAbsolute(k,a)||k<a)a=0===p||b.floatEqualAbsolute(k,p)||k>p;return a};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,b,q,x,k,a,p){var l;q=l=class extends p{constructor(A){super(A);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};d.__decorate([b.property({type:[Number,String],json:{write:!0}})],q.prototype,"left",void 0);d.__decorate([b.property({type:[Number,String],
json:{write:!0}})],q.prototype,"right",void 0);d.__decorate([b.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);d.__decorate([b.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);return q=l=d.__decorate([a.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,b,q,x,k,a,p){b=class extends b.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};d.__decorate([q.property({readOnly:!0})],b.prototype,"version",null);return b=d.__decorate([p.subclass("esri.views.layers.support.ClipArea")],b)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(d,b,q,x,k,a,p,l,A,C,H,g){var e;b={base:l,key:"type",typeMap:{extent:H,polygon:g}};C=e=class extends C{constructor(r){super(r);this.type="geometry";this.geometry=null}clone(){return new e({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};d.__decorate([q.property({types:b,json:{read:A.fromJSON,write:!0}})],C.prototype,"geometry",void 0);return C=e=d.__decorate([p.subclass("esri.views.layers.support.Geometry")],C)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,b,q,x,k,a,p){q=class extends p{constructor(l){super(l);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};d.__decorate([b.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);return q=d.__decorate([a.subclass("esri.views.layers.support.Path")],q)})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../core/Logger ../../../symbols ../../../core/Collection ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/Error ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../core/colorUtils ../../../config ../../../symbols/Font ../../../core/ObjectPool ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/Axis ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/TileClipper ../../../symbols/cim/effects/EffectAddControlPoints ../../../symbols/cim/effects/EffectArrow ../../../symbols/cim/effects/EffectBuffer ../../../symbols/cim/effects/EffectControlMeasureLine ../../../symbols/cim/effects/EffectCut ../../../symbols/cim/effects/EffectDashes ../../../symbols/cim/effects/EffectDonut ../../../symbols/cim/effects/EffectJog ../../../symbols/cim/effects/EffectMove ../../../symbols/cim/effects/EffectOffset ../../../symbols/cim/effects/EffectReverse ../../../symbols/cim/effects/EffectRotate ../../../symbols/cim/effects/EffectScale ../../../symbols/cim/effects/EffectWave ../../../symbols/cim/placements/PlacementAlongLineSameSize ../../../symbols/cim/placements/PlacementAtExtremities ../../../symbols/cim/placements/PlacementAtRatioPositions ../../../symbols/cim/placements/PlacementInsidePolygon ../../../symbols/cim/placements/PlacementOnLine ../../../symbols/cim/placements/PlacementOnVertices ../../../symbols/cim/placements/PlacementPolygonCenter ../../../symbols/cim/enums ../../../core/mathUtils ../engine/webgl/definitions ../../../core/libs/gl-matrix-2/factories/vec2f32 ../engine/webgl/alignmentUtils ../../../symbols/support/defaults ../../../symbols/cim/OverrideHelper ../../../core/floatRGBA ../../../layers/effects/EffectView ../engine/DisplayObject ./support/util ../../../core/Evented ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../core/libs/gl-matrix-2/factories/vec4f32 ../../webgl/checkWebGLError ../../webgl/enums ../../webgl/FramebufferObject ../../../chunks/builtins ../../webgl/GLObjectType ../../webgl/Texture ../engine/webgl/shaders/BackgroundPrograms ../engine/webgl/DefaultVertexAttributeLayouts ../tiling/TileKey ../engine/webgl/DisplayEntity ../engine/webgl/number ../engine/webgl/PooledUint32Array ../engine/webgl/shaders/TileInfoPrograms ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/enums ../engine/webgl/shaders/BitBlitPrograms ../../../request ../../../core/urlUtils ../../../core/pbf ../engine/webgl/shaders/StencilPrograms ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../chunks/earcut ../../../geometry/support/aaBoundingBox ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/support/normalizeUtilsCommon ../../../geometry/SpatialReference ../../../geometry/support/Ellipsoid ../../../kernel ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView".split(" "),function(d,
b,q,x,k,a,p,l,A,C,H,g,e,r,G,L,J,I,w,v,t,f,m,n,y,B,z,F,D,E,V,S,O,T,U,fa,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Y,Z,aa,ba,ca,da){function W(c,h,u){c.getTileBounds(M,h.key,!0);P.xmin=M[0];P.ymin=M[1];P.xmax=M[2];P.ymax=M[3];return y.extentIntersectsPolygon(P,u)}let R=class extends ca.LayerView2DMixin(da){constructor(){super(...arguments);
this._tileStrategy=this._fetchQueue=this._overlayContainer=null;this._elementReferences=new Map;this.layer=this._debugGraphicsView=null;this.elements=new G}attach(){this.addAttachHandles([w.on(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(c=>this._updateTile(c));this.requestUpdate()}),w.on(()=>this.layer.effectiveSource,"change",({element:c})=>this._elementUpdateHandler(c))]);this._overlayContainer=new ba;this.container.addChild(this._overlayContainer);this._fetchQueue=
new Y({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(c,h)=>this._queryElements(c,h)});this._tileStrategy=new Z({cachePolicy:"purge",resampling:!0,acquireTile:c=>this._acquireTile(c),releaseTile:c=>this._releaseTile(c),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()}detach(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();this._elementReferences.clear();
this._debugGraphicsView?.destroy()}supportsSpatialReference(c){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(c){this._tileStrategy.update(c);this._debugGraphicsView?.update(c)}async hitTest(c,h){h=[];var u=c.normalize();u=[u.x,u.y];for(const {projectedElement:{normalizedCoords:K,element:Q}}of this._elementReferences.values())null!=K&&n.ringsContainsCoords(K.rings,u)&&h.push({type:"media",element:Q,layer:this.layer,mapPoint:c,sourcePoint:Q.toSource(c)});
return h.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset();this._tileStrategy.refresh(c=>this._updateTile(c))}_acquireTile(c){c=new ea(c.clone());this._updateTile(c);return c}_updateTile(c){this._updatingHandles.addPromise(this._fetchQueue.push(c.key).then(h=>{const [u,K]=c.setElements(h);this._referenceElements(c,u);this._dereferenceElements(c,K);this.requestUpdate()},h=>{I.isAbortError(h)||e.getLogger(this).error(h)}))}_releaseTile(c){this._fetchQueue.abort(c.key.id);
c.elements&&this._dereferenceElements(c,c.elements);this.requestUpdate()}async _queryElements(c,h){const u=this.layer.effectiveSource;if(null==u)return[];this.view.featuresTilingScheme.getTileBounds(M,c,!0);c=new T({xmin:M[0],ymin:M[1],xmax:M[2],ymax:M[3],spatialReference:this.view.spatialReference});return u.queryElements(c,h)}_referenceElements(c,h){if(null!=this.layer.source)for(const u of h)this._referenceElement(c,u)}_referenceElement(c,h){J.getOrCreateMapValue(this._elementReferences,h.uid,
()=>{const u=new B.MediaElementView({element:h,spatialReference:this.view.spatialReference}),K=new aa(u);this._overlayContainer.addChild(K);this.elements.add(h);return{tiles:new Set,projectedElement:u,overlay:K,debugGraphic:null}}).tiles.add(c)}_dereferenceElements(c,h){for(const u of h)this._dereferenceElement(c,u)}_dereferenceElement(c,h){const u=this._elementReferences.get(h.uid);u.tiles.delete(c);u.tiles.size||(this._overlayContainer.removeChild(u.overlay),u.overlay.destroy(),u.projectedElement.destroy(),
this._elementReferences.delete(h.uid),this.elements.remove(h),this._debugGraphicsView?.graphics.remove(u.debugGraphic))}_elementUpdateHandler(c){var h=this._elementReferences.get(c.uid);if(h){const Q=h.projectedElement.normalizedCoords;if(null==Q)this._overlayContainer.removeChild(h.overlay),h.overlay.destroy(),h.projectedElement.destroy(),this._elementReferences.delete(c.uid),this.elements.remove(c),this._debugGraphicsView?.graphics.remove(h.debugGraphic);else{var u=[],K=[];for(const N of this._tileStrategy.tiles){const X=
W(this.view.featuresTilingScheme,N,Q);h.tiles.has(N)?X||K.push(N):X&&u.push(N)}for(const N of u)this._referenceElement(N,c);for(const N of K)this._dereferenceElement(N,c);h=this._elementReferences.get(c.uid);h?.debugGraphic&&(h.debugGraphic.geometry=h.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:h.debugGraphic,property:"geometry"}))}}else if(h=(new B.MediaElementView({element:c,spatialReference:this.view.spatialReference})).normalizedCoords,null!=h)for(u of this._tileStrategy.tiles)W(this.view.featuresTilingScheme,
u,h)&&this._referenceElement(u,c)}};d.__decorate([v.property()],R.prototype,"layer",void 0);d.__decorate([v.property({readOnly:!0})],R.prototype,"elements",void 0);R=d.__decorate([f.subclass("esri.views.2d.layers.MediaLayerView2D")],R);const M=m.create(),P={xmin:0,ymin:0,xmax:0,ymax:0};class ea{constructor(c){this.key=c;this.elements=null;this.isReady=!1;this.visible=!0}setElements(c){const h=[],u=new Set(this.elements);this.elements=c;for(const K of c)u.has(K)?u.delete(K):h.push(K);this.isReady=
!0;return[h,Array.from(u)]}destroy(){}}return R});