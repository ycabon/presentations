// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(d,f,h,c,a,b,e,l){d.BitmapTileLayerView2D=m=>{m=class extends m{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new l.BitmapTileContainer(this._tileInfoView);
this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren();this._bitmapView=null}};return m=f.__decorate([e.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],m)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(d,f,h,c,a,b,e,l,m,k,g,u,y,w,x,J,P){const K=h.ofType({key:"type",base:null,typeMap:{rect:x,path:P,geometry:J}});d.LayerView2DMixin=G=>{G=class extends G{constructor(){super(...arguments);this.attached=!1;this.clips=new K;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const B=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&B&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new a("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new y.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([b.watch(()=>this.suspended,z=>{this.container&&(this.container.visible=!z)},b.syncAndInitial),b.watch(()=>this.updateSuspended,z=>{this.view&&!z&&this.updateRequested&&this.view.requestUpdate()},b.syncAndInitial),b.watch(()=>this.layer?.opacity??
1,z=>{this.container&&(this.container.opacity=z)},b.syncAndInitial),b.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",z=>{this.container&&(this.container.blendMode=z)},b.syncAndInitial),b.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,z=>{this.container&&(this.container.effect=z)},b.syncAndInitial),b.watch(()=>this.highlightOptions,z=>this.container.highlightOptions=z,b.syncAndInitial),b.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},b.syncAndInitial),b.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:z})=>{z=null!=z?this.isVisibleAtScale(z):!1;z!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",z)},b.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(z=>{z===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const B=this.view?.spatialReference;return null==B||this.supportsSpatialReference(B)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(B){const z=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!z)return!0;const {minScale:N,maxScale:O}=z;return u.isInScaleRange(B,N,O)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(B){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
B),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(B)))}hitTest(B,z){return Promise.resolve(null)}supportsSpatialReference(B){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const B=super.getSuspendInfo(),z=!this.spatialReferenceSupported,N=this.visibleAtCurrentScale;z&&(B.spatialReferenceNotSupported=z);N&&(B.outsideScaleRange=N);return B}addAttachHandles(B){this.addHandles(B,"attach")}};
f.__decorate([e.property()],G.prototype,"attached",void 0);f.__decorate([e.property({type:K,set(B){B=c.referenceSetter(B,this._get("clips"),K);this._set("clips",B)}})],G.prototype,"clips",void 0);f.__decorate([e.property()],G.prototype,"container",void 0);f.__decorate([e.property()],G.prototype,"moving",void 0);f.__decorate([e.property({readOnly:!0})],G.prototype,"spatialReferenceSupported",null);f.__decorate([e.property({readOnly:!0})],G.prototype,"updateParameters",void 0);f.__decorate([e.property()],
G.prototype,"updateRequested",void 0);f.__decorate([e.property()],G.prototype,"updateSuspended",null);f.__decorate([e.property()],G.prototype,"updating",null);f.__decorate([e.property()],G.prototype,"view",void 0);f.__decorate([e.property({readOnly:!0})],G.prototype,"visibleAtCurrentScale",void 0);f.__decorate([e.property({type:w})],G.prototype,"highlightOptions",void 0);return G=f.__decorate([g.subclass("esri.views.2d.layers.LayerView2D")],G)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(d,f,h){function c(a,b){b=h.getMetersPerUnitForSR(b);return a/(b*h.inchesPerMeter*96)}d.getExtentForScale=function(a,b){const e=a.extent;a=a.width-(a.padding?a.padding.left+a.padding.right:0);b=c(b,e.spatialReference);return e.clone().expand(b*a/e.width)};d.getResolutionForScale=c;d.getResolutionInMetersForScale=function(a){return a/(96*h.inchesPerMeter)};d.getScale=function(a,b){b=
b||a.extent;a=a.width;const e=h.getMetersPerUnitForSR(b?.spatialReference);return b&&a?b.width/a*e*h.inchesPerMeter*96:0};d.getScaleForResolution=function(a,b){b=h.getMetersPerUnitForSR(b);return a*b*h.inchesPerMeter*96};d.isInScaleRange=function(a,b,e){if(b=0===b||f.floatEqualAbsolute(a,b)||a<b)b=0===e||f.floatEqualAbsolute(a,e)||a>e;return b};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,f,h,c,a,b,e){var l;h=l=class extends e{constructor(m){super(m);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};d.__decorate([f.property({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0);d.__decorate([f.property({type:[Number,String],
json:{write:!0}})],h.prototype,"right",void 0);d.__decorate([f.property({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0);d.__decorate([f.property({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0);return h=l=d.__decorate([b.subclass("esri.views.layers.support.ClipRect")],h)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(d,f,h,c,a,b,e){f=class extends f.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};d.__decorate([h.property({readOnly:!0})],f.prototype,"version",null);return f=d.__decorate([e.subclass("esri.views.layers.support.ClipArea")],f)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(d,f,h,c,a,b,e,l,m,k,g,u){var y;f={base:l,key:"type",typeMap:{extent:g,polygon:u}};k=y=class extends k{constructor(w){super(w);this.type="geometry";this.geometry=null}clone(){return new y({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};d.__decorate([h.property({types:f,json:{read:m.fromJSON,write:!0}})],k.prototype,"geometry",void 0);return k=y=d.__decorate([e.subclass("esri.views.layers.support.Geometry")],k)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(d,f,h,c,a,b,e){h=class extends e{constructor(l){super(l);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};d.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],h.prototype,"path",void 0);return h=d.__decorate([b.subclass("esri.views.layers.support.Path")],h)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./AGraphicContainer ../support/util".split(" "),
function(d,f,h,c,a,b,e,l,m){f=class extends l.AGraphicContainer{get hasHighlight(){return this.children.some(k=>k.hasData)}renderChildren(k){k.drawPhase===e.WGLDrawPhase.HIGHLIGHT&&(this.attributeView.update(),this.children.some(g=>g.hasData)&&(super.renderChildren(k),k.context.setColorMask(!0,!0,!0,!0),m.renderHighlight(k,!0,g=>{this._renderChildren(g,e.FeatureSelection.All)})))}};return f=d.__decorate([b.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],f)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],
function(d){function f(h){const c=document.createElement("canvas");[c.width,c.height]=h;return c}d.createBlankImage=f;d.resampleImage=function(h,c,a,b){if(a.level===b.level)return c;const e=h.tileInfo.size;var l=h.getTileResolution(a.level),m=h.getTileResolution(b.level),k=h.getLODInfoAt(b.level),g=k.getXForColumn(b.col);b=k.getYForRow(b.row);k=h.getLODInfoAt(a.level);h=k.getXForColumn(a.col);const u=k.getYForRow(a.row);k=(c instanceof HTMLImageElement?c.naturalWidth:c.width)/e[0];a=(c instanceof
HTMLImageElement?c.naturalHeight:c.height)/e[1];g=Math.round((g-h)/l*k);b=Math.round(-(b-u)/l*a);h=Math.round(m/l*e[0]*k);l=Math.round(m/l*e[1]*a);m=f(e);m.getContext("2d").drawImage(c,g,b,h,l,0,0,e[0],e[1]);return m};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(d,f,h,c,a,b,e,l){return m=>{m=class extends m{initialize(){this.addHandles(c.on(()=>this.layer,"refresh",k=>{this.doRefresh(k.dataChanged).catch(g=>{h.isAbortError(g)||f.getLogger(this).error(g)})}),"RefreshableLayerView")}};return m=d.__decorate([l.subclass("esri.layers.mixins.RefreshableLayerView")],m)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/fieldUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ./popupUtils".split(" "),
function(d,f,h,c,a,b,e,l,m,k,g,u,y,w,x,J,P,K,G,B,z,N,O,D,S,R,T){function Z(n,p,r){const C=[];if(!n)return C;const A=v=>{var q=0===v.minScale||p<=v.minScale;const E=0===v.maxScale||p>=v.maxScale;v.visible&&q&&E&&(v.sublayers?v.sublayers.forEach(A):v.popupEnabled&&(q=T.getFetchPopupTemplate(v,{...r,defaultPopupTemplateEnabled:!1}),null!=q&&C.unshift({sublayer:v,popupTemplate:q})))};n.map(A);return C}function U(n){return n.expressionInfos?.length||Array.isArray(n.content)&&n.content.some(p=>"expression"===
p.type)?S.loadArcade():Promise.resolve()}async function V(n,p){if(n.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(p.map(({sublayer:r})=>r.load().then(()=>r.capabilities.operations.supportsQuery)))}catch{return!1}}async function aa(n,p,r){const C=n.renderer;C&&"defaultSymbol"in C&&!C.defaultSymbol&&(p=C.valueExpression?await Promise.all(p.map(A=>C.getSymbolAsync(A,r).then(v=>v?A:null))).then(A=>A.filter(v=>null!=v)):p.filter(A=>null!=C.getSymbol(A)));return p}let W=
null;f.MapServiceLayerViewHelper=class extends a{constructor(n){super(n);this._featuresResolutions=new WeakMap;this.highlightGraphicUpdated=this.highlightGraphics=null;this.updateHighlightedFeatures=u.debounce(async p=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(p).catch(()=>{}))})}initialize(){const n=p=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(p).catch(()=>{}));this.updateHighlightedFeatures(this._highlightGeometriesResolution)};
this.addHandles([y.on(()=>this.highlightGraphics,"change",p=>n(p.added),{onListenerAdd:p=>n(p)})])}async fetchPopupFeaturesAtLocation(n,p){const {layerView:{layer:r,view:{scale:C}}}=this;if(!n)throw new l("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:r});const A=Z(r.sublayers,C,p);if(!A.length)return[];const v=await V(r,A);if(!((r.capabilities?.operations?.supportsIdentify??!0)&&10.5<=r.version||v))throw new l("fetchPopupFeatures:not-supported","query operation is disabled for this service",
{layer:r});return v?this._fetchPopupFeaturesUsingQueries(n,A,p):this._fetchPopupFeaturesUsingIdentify(n,A,p)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(n){const p=this.highlightGraphics;if(!p)return m.makeHandle();let r=null;n instanceof c?r=[n]:e.isCollection(n)&&0<n.length?r=n.toArray():Array.isArray(n)&&0<n.length&&(r=n);r=r?.filter(b.isSome);if(!r?.length)return m.makeHandle();for(const C of r)n=C.sourceLayer,null!=n&&"geometryType"in n&&"point"===n.geometryType&&(C.visible=
!1);p.addMany(r);return m.makeHandle(()=>p.removeMany(r??[]))}async _updateHighlightedFeaturesSymbols(n){const {layerView:{view:p},highlightGraphics:r,highlightGraphicUpdated:C}=this;if(r&&C)for(const A of n){const v=A.sourceLayer&&"renderer"in A.sourceLayer&&A.sourceLayer.renderer;A.sourceLayer&&"geometryType"in A.sourceLayer&&"point"===A.sourceLayer.geometryType&&v&&"getSymbolAsync"in v&&v.getSymbolAsync(A).then(async q=>{q||=new R;let E=null;const H="visualVariables"in v?v.visualVariables?.find(I=>
"size"===I.type):void 0;H&&(W||(W=(await new Promise((I,L)=>d(["../../../renderers/visualVariables/support/visualVariableUtils"],I,L))).getSize),E=W(H,A,{view:p.type,scale:p.scale,shape:"simple-marker"===q.type?q.style:null}));E||="width"in q&&"height"in q&&null!=q.width&&null!=q.height?Math.max(q.width,q.height):"size"in q?q.size:16;r.includes(A)&&(A.symbol=new R({style:"square",size:E,xoffset:"xoffset"in q?q.xoffset:0,yoffset:"yoffset"in q?q.yoffset:0}),C(A,"symbol"),A.visible=!0)})}}async _updateHighlightedFeaturesGeometries(n){const {layerView:{layer:p,
view:r},highlightGraphics:C,highlightGraphicUpdated:A}=this;this._highlightGeometriesResolution=n;if(A&&C?.length&&p.capabilities.operations.supportsQuery){var v=this._getTargetResolution(n);n=new Map;for(var q of C)(!this._featuresResolutions.has(q)||this._featuresResolutions.get(q)>v)&&g.getOrCreateMapValue(n,q.sourceLayer,()=>new Map).set(q.getObjectId(),q);q=Array.from(n,([E,H])=>{const I=E.createQuery();I.objectIds=[...H.keys()];I.outFields=[E.objectIdField];I.returnGeometry=!0;I.maxAllowableOffset=
v;I.outSpatialReference=r.spatialReference;return E.queryFeatures(I)});q=await Promise.all(q);if(!this.destroyed)for(const {features:E}of q)for(const H of E)(q=n.get(H.sourceLayer).get(H.getObjectId()))&&C.includes(q)&&(q.geometry=H.geometry,A(q,"geometry"),this._featuresResolutions.set(q,v))}}_getTargetResolution(n){const p=n*w.getMetersPerUnitForSR(this.layerView.view.spatialReference),r=p/16;return 10>=r?0:n/p*r}async _fetchPopupFeaturesUsingIdentify(n,p,r){n=await this._createIdentifyParameters(n,
p,r);if(null==n)return[];({results:r}=await O.identify(this.layerView.layer.parsedUrl,n,r));return r.map(C=>C.feature)}async _createIdentifyParameters(n,p,r){const {floors:C,layer:A,timeExtent:v,view:{spatialReference:q,scale:E}}=this.layerView;if(!p.length)return null;await Promise.all(p.map(({sublayer:X})=>X.load(r).catch(()=>{})));p=Math.min(k("mapservice-popup-identify-max-tolerance"),A.allSublayers.reduce((X,ba)=>ba.renderer?N.calculateTolerance({renderer:ba.renderer,pointerType:r?.pointerType}):
X,2));var H=this.createFetchPopupFeaturesQueryGeometry(n,p);const I=G.getResolutionForScale(E,q),L=Math.round(H.width/I);H=new K({xmin:H.center.x-I*L,ymin:H.center.y-I*L,xmax:H.center.x+I*L,ymax:H.center.y+I*L,spatialReference:H.spatialReference});return new D({floors:C,gdbVersion:"gdbVersion"in A?A.gdbVersion:void 0,geometry:n,height:L,layerOption:"popup",mapExtent:H,returnGeometry:!0,spatialReference:q,sublayers:A.sublayers,timeExtent:v,tolerance:p,width:L})}async _fetchPopupFeaturesUsingQueries(n,
p,r){const {layerView:{floors:C,timeExtent:A}}=this;p=p.map(async({sublayer:v,popupTemplate:q})=>{await v.load(r).catch(()=>{});if(v.capabilities&&!v.capabilities.operations.supportsQuery)return[];var E=v.createQuery(),H=N.calculateTolerance({renderer:v.renderer,pointerType:r?.pointerType}),I=this.createFetchPopupFeaturesQueryGeometry(n,H),L=new Set;const [X]=await Promise.all([T.getRequiredFields(v,q),v.renderer?.collectRequiredFields(L,v.fieldsIndex)]);u.throwIfAborted(r);B.collectFields(L,v.fieldsIndex,
X);L=Array.from(L).sort();E.geometry=I;E.outFields=L;E.timeExtent=A;C&&(L=C.clone(),L=z.getLayerFloorFilterClause(L,v),null!=L&&(E.where=E.where?`(${E.where}) AND (${L})`:L));H=this._getTargetResolution(I.width/H);I=await U(q);u.throwIfAborted(r);q="point"===v.geometryType||I&&I.arcadeUtils.hasGeometryOperations(q);q||(E.maxAllowableOffset=H);({features:E}=await v.queryFeatures(E,r));q=q?0:H;E=await aa(v,E,r);for(const ba of E)this._featuresResolutions.set(ba,q);return E});return(await Promise.allSettled(p)).reduce((v,
q)=>"fulfilled"===q.status?[...v,...q.value]:v,[]).filter(b.isSome)}};h.__decorate([x.property({constructOnly:!0})],f.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);h.__decorate([x.property({constructOnly:!0})],f.MapServiceLayerViewHelper.prototype,"layerView",void 0);h.__decorate([x.property({constructOnly:!0})],f.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);h.__decorate([x.property({constructOnly:!0})],f.MapServiceLayerViewHelper.prototype,
"highlightGraphicUpdated",void 0);h.__decorate([x.property({constructOnly:!0})],f.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);f.MapServiceLayerViewHelper=h.__decorate([P.subclass("esri.views.layers.support.MapService")],f.MapServiceLayerViewHelper);f.collectPopupProviders=Z;f.isMapServiceLayerView=function(n,p){return"tile"===p.type||"map-image"===p.type};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],
function(d){function f(h,c){if(!h?.length)return null;h=h.filter(a=>""!==a).map(a=>`'${a}'`);h.push("''");return`${c} IN (${h.join(",")}) OR ${c} IS NULL`}d.getFloorFilterClause=function(h){const c=h.layer;return"floorInfo"in c&&c.floorInfo?.floorField&&"floors"in h.view?f(h.view.floors,c.floorInfo.floorField):null};d.getLayerFloorFilterClause=function(h,c){return"floorInfo"in c&&c.floorInfo?.floorField?f(h,c.floorInfo.floorField):null};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},
"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(d){function f(a,b){return b?"xoffset"in b&&b.xoffset?Math.max(a,Math.abs(b.xoffset)):"yoffset"in b&&b.yoffset?Math.max(a,Math.abs(b.yoffset||0)):a:a}function h(a,b){if("number"===typeof a)return a;if(a?.stops?.length){a=a.stops;let e=b=0;for(let l=0;l<a.length;l++){const m=a[l].size;"number"===typeof m&&(b+=m,e++)}return b/e}return b}function c(a,b){if(!b)return a;b=b.filter(m=>"size"===m.type).map(m=>{const {maxSize:k,
minSize:g}=m;return(h(k,a)+h(g,a))/2});let e=0;const l=b.length;if(0===l)return a;for(let m=0;m<l;m++)e+=b[m];return Math.max(Math.floor(e/l),a)}d.calculateTolerance=function(a){const b=a?.renderer;a="touch"===a?.pointerType?9:6;if(!b)return a;a="visualVariables"in b?c(a,b.visualVariables):a;if("simple"===b.type)return f(a,b.symbol);if("unique-value"===b.type){let e=a;b.uniqueValueInfos?.forEach(l=>{e=f(e,l.symbol)});return e}if("class-breaks"===b.type){let e=a;b.classBreakInfos.forEach(l=>{e=f(e,
l.symbol)});return e}return a};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/rest/identify":function(){define("exports ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),function(d,f,h,c,a,b,e){function l(g){g=g.data;g.results=g.results||[];g.exceededTransferLimit=!!g.exceededTransferLimit;g.results=g.results.map(u=>e.fromJSON(u));return g}function m(g){return g=b.from(g)}function k(g,
u){function y(x){w.set(x.id,x);x.sublayers&&x.sublayers.forEach(y)}if(!u?.length)return g;const w=new Map;u.forEach(y);for(const x of g.results)x.feature.sourceLayer=w.get(x.layerId);return g}d.identify=async function(g,u,y){u=m(u);const w=u.geometry?[u.geometry]:[],x=c.parseUrl(g);x.path+="/identify";return h.normalizeCentralMeridian(w).then(J=>{J=a.identifyToIdentifyRESTParameters(u,{geometry:J?.[0]});J=c.encode({...x.query,f:"json",...J});J=c.asValidOptions(J,y);return f(x.path,J).then(l).then(P=>
k(P,u.sublayers))})};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),function(d,f,h,c,a,b,e){function l(k){const {mapExtent:g,floors:u,width:y,sublayers:w,layerIds:x,layerOption:J,gdbVersion:P}=k;var K=w?.find(D=>null!=
D.layer)?.layer?.serviceSublayers;const G="popup"===J;k={};const B=c.getScale({extent:g,width:y,spatialReference:g?.spatialReference}),z=[],N=D=>{const S=0===B,R=0===D.minScale||B<=D.minScale,T=0===D.maxScale||B>=D.maxScale;D.visible&&(S||R&&T)&&(D.sublayers?D.sublayers.forEach(N):!1!==x?.includes(D.id)&&(!G||D.popupTemplate&&D.popupEnabled)&&z.unshift(D))};w?.forEach(N);if(w&&!z.length)k.layerIds=[];else{K=e.isExportDynamic(z,K,P);var O=z.map(D=>{const S=b.getLayerFloorFilterClause(u,D);return D.toExportImageJSON(S)});
if(K)k.dynamicLayers=JSON.stringify(O);else if(w?(K=z.map(({id:D})=>D),x&&(K=K.filter(D=>x.includes(D))),k.layerIds=K):x?.length&&(k.layerIds=x),K=m(u,z),null!=K&&K.length){O={};for(const D of K)D.definitionExpression&&(O[D.id]=D.definitionExpression);Object.keys(O).length&&(k.layerDefs=JSON.stringify(O))}}return k}function m(k,g){const u=!!k?.length;g=g.filter(y=>null!=y.definitionExpression||u&&null!=y.floorInfo);return g.length?g.map(y=>{var w=b.getLayerFloorFilterClause(k,y);w=f.sqlAnd(w,y.definitionExpression);
return{id:y.id,definitionExpression:w??void 0}}):null}d.identifyToIdentifyRESTParameters=function(k,g){const {dpi:u,gdbVersion:y,geometry:w,geometryPrecision:x,height:J,historicMoment:P,layerOption:K,mapExtent:G,maxAllowableOffset:B,returnFieldName:z,returnGeometry:N,returnUnformattedValues:O,returnZ:D,spatialReference:S,timeExtent:R,tolerance:T,width:Z}=k.toJSON(),{dynamicLayers:U,layerDefs:V,layerIds:aa}=l(k);g=null!=g?.geometry?g.geometry:null;k={historicMoment:P,geometryPrecision:x,maxAllowableOffset:B,
returnFieldName:z,returnGeometry:N,returnUnformattedValues:O,returnZ:D,tolerance:T};g=g&&g.toJSON()||w;k.imageDisplay=`${Z},${J},${u}`;y&&(k.gdbVersion=y);g&&(delete g.spatialReference,k.geometry=JSON.stringify(g),k.geometryType=h.getJsonType(g));if(g=S??g?.spatialReference??G?.spatialReference)k.sr=a.srToRESTValue(g);k.time=R?[R.start,R.end].join():null;if(G){const {xmin:W,ymin:n,xmax:p,ymax:r}=G;k.mapExtent=`${W},${n},${p},${r}`}V&&(k.layerDefs=V);U&&!V&&(k.dynamicLayers=U);k.layers="popup"===K?
"visible":K;aa&&!U&&(k.layers+=`:${aa.join(",")}`);return k};d.toDynamicLayersJSON=l;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(d,f){function h(c,a){if(!c?.length||null==a)return!0;a=a.slice().reverse().flatten(({sublayers:l})=>l&&l.toArray().reverse()).map(l=>l.id).toArray();if(c.length>a.length)return!1;let b=0;const e=a.length;for(const {id:l}of c){for(;b<
e&&a[b]!==l;)b++;if(b>=e)return!1}return!0}d.isExportDynamic=function(c,a,b){return c.some(e=>{const l=e.source;return!(!l||"map-layer"===l.type&&l.mapLayerId===e.id&&(null==l.gdbVersion||l.gdbVersion===b))||e.originIdOf("renderer")>f.OriginId.SERVICE||e.originIdOf("labelingInfo")>f.OriginId.SERVICE||e.originIdOf("opacity")>f.OriginId.SERVICE||e.originIdOf("labelsVisible")>f.OriginId.SERVICE})?!0:!h(c,a)};d.isSublayerOverhaul=function(c){return!!c&&c.some(a=>null!=a.minScale||null!=a.layerDefinition?.minScale)};
d.shouldWriteSublayerStructure=function(c,a,b){return a.flatten(({sublayers:e})=>e).length!==c.length||c.some(e=>e.originIdOf("minScale")>b||e.originIdOf("maxScale")>b||e.originIdOf("renderer")>b||e.originIdOf("labelingInfo")>b||e.originIdOf("opacity")>b||e.originIdOf("labelsVisible")>b||e.originIdOf("source")>b)?!0:!h(c,a)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/jsonUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),
function(d,f,h,c,a,b,e,l,m,k,g,u,y){var w;c=w=class extends c.JSONSupport{static from(x){return b.ensureClass(w,x)}constructor(x){super(x);this.dpi=96;this.geometryPrecision=this.geometry=this.gdbVersion=this.floors=null;this.height=400;this.layerIds=this.historicMoment=null;this.layerOption="top";this.maxAllowableOffset=this.mapExtent=null;this.returnFieldName=!0;this.returnM=this.returnGeometry=!1;this.returnUnformattedValues=!0;this.returnZ=!1;this.tolerance=this.timeExtent=this.sublayers=this.spatialReference=
null;this.width=400}writeHistoricMoment(x,J){J.historicMoment=x&&x.getTime()}};d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"dpi",void 0);d.__decorate([a.property()],c.prototype,"floors",void 0);d.__decorate([a.property({type:String,json:{write:!0}})],c.prototype,"gdbVersion",void 0);d.__decorate([a.property({types:f.geometryTypes,json:{read:g.fromJSON,write:!0}})],c.prototype,"geometry",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"geometryPrecision",
void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"height",void 0);d.__decorate([a.property({type:Date})],c.prototype,"historicMoment",void 0);d.__decorate([k.writer("historicMoment")],c.prototype,"writeHistoricMoment",null);d.__decorate([a.property({type:[Number],json:{write:!0}})],c.prototype,"layerIds",void 0);d.__decorate([a.property({type:["top","visible","all","popup"],json:{write:!0}})],c.prototype,"layerOption",void 0);d.__decorate([a.property({type:u,json:{write:!0}})],
c.prototype,"mapExtent",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"maxAllowableOffset",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnFieldName",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnGeometry",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnM",void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnUnformattedValues",
void 0);d.__decorate([a.property({type:Boolean,json:{write:!0}})],c.prototype,"returnZ",void 0);d.__decorate([a.property({type:y,json:{write:!0}})],c.prototype,"spatialReference",void 0);d.__decorate([a.property()],c.prototype,"sublayers",void 0);d.__decorate([a.property({type:h,json:{write:!0}})],c.prototype,"timeExtent",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"tolerance",void 0);d.__decorate([a.property({type:Number,json:{write:!0}})],c.prototype,"width",void 0);
return c=w=d.__decorate([m.subclass("esri.rest.support.IdentifyParameters")],c)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),function(d,
f,h,c,a,b,e,l,m,k,g,u){f=class extends c.JSONSupport{constructor(y){super(y);this.layerName=this.layerId=this.feature=this.displayFieldName=null}readFeature(y,w){return h.fromJSON({attributes:{...w.attributes},geometry:{...w.geometry}})}writeFeature(y,w){if(y){var {attributes:x,geometry:J}=y;x&&(w.attributes={...x});null!=J&&(w.geometry=J.toJSON(),w.geometryType=u.typeKebabDictionary.toJSON(J.type))}}};d.__decorate([a.property({type:String,json:{write:!0}})],f.prototype,"displayFieldName",void 0);
d.__decorate([a.property({type:h})],f.prototype,"feature",void 0);d.__decorate([m.reader("feature",["attributes","geometry"])],f.prototype,"readFeature",null);d.__decorate([g.writer("feature")],f.prototype,"writeFeature",null);d.__decorate([a.property({type:Number,json:{write:!0}})],f.prototype,"layerId",void 0);d.__decorate([a.property({type:String,json:{write:!0}})],f.prototype,"layerName",void 0);return f=d.__decorate([k.subclass("esri.rest.support.IdentifyResult")],f)})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(d,f){function h(c,a){return c.popupTemplate?c.popupTemplate:null!=a&&a.defaultPopupTemplateEnabled&&null!=c.defaultPopupTemplate?c.defaultPopupTemplate:null}d.getFetchPopupTemplate=h;d.getRequiredFields=async function(c,a=c.popupTemplate){if(null==a)return[];const b=await a.getRequiredFields(c.fieldsIndex);({lastEditInfoEnabled:a}=a);const {objectIdField:e,typeIdField:l,globalIdField:m,relationships:k}=c;if(b.includes("*"))return["*"];a=a?f.getFeatureEditFields(c):
[];const g=f.fixFields(c.fieldsIndex,[...b,...a]);l&&g.push(l);g&&e&&c.fieldsIndex?.has(e)&&!g.includes(e)&&g.push(e);g&&m&&c.fieldsIndex?.has(m)&&!g.includes(m)&&g.push(m);k&&k.forEach(u=>{({keyField:u}=u);g&&u&&c.fieldsIndex?.has(u)&&!g.includes(u)&&g.push(u)});return g};d.hasPopupTemplate=function(c,a){return null!=h(c,{defaultPopupTemplateEnabled:a})};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../geometry",
"../../core/unitUtils","../../renderers/support/clickToleranceUtils","../../geometry/Extent"],function(d,f,h,c,a){function b(l,m,k,g=new a){let u=0;if("2d"===k.type)u=m*(k.resolution??0);else if("3d"===k.type){var y=k.overlayPixelSizeInMapUnits(l),w=k.basemapSpatialReference;u=null==w||w.equals(k.spatialReference)?m*y:h.getMetersPerUnitForSR(w)/h.getMetersPerUnitForSR(k.spatialReference)}m=l.x-u;y=l.y-u;w=l.x+u;l=l.y+u;({spatialReference:k}=k);g.xmin=Math.min(m,w);g.ymin=Math.min(y,l);g.xmax=Math.max(m,
w);g.ymax=Math.max(y,l);g.spatialReference=k;return g}const e=new a;d.createQueryGeometry=b;d.intersectsDrapedGeometry=function(l,m,k){l=k.toMap(l);if(null==l)return!1;const g=c.calculateTolerance();return b(l,g,k,e).intersects(m)};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../core/colorUtils ../../../config ../../../core/mathUtils ../../../geometry/Extent ../../../symbols/Font ../../../core/ObjectPool ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/Axis ../../../geometry/support/TileClipper ../../../symbols/cim/effects/EffectAddControlPoints ../../../symbols/cim/effects/EffectArrow ../../../symbols/cim/effects/EffectBuffer ../../../symbols/cim/effects/EffectControlMeasureLine ../../../symbols/cim/effects/EffectCut ../../../symbols/cim/effects/EffectDashes ../../../symbols/cim/effects/EffectDonut ../../../symbols/cim/effects/EffectJog ../../../symbols/cim/effects/EffectMove ../../../symbols/cim/effects/EffectOffset ../../../symbols/cim/effects/EffectReverse ../../../symbols/cim/effects/EffectRotate ../../../symbols/cim/effects/EffectScale ../../../symbols/cim/effects/EffectWave ../../../symbols/cim/placements/PlacementAlongLineSameSize ../../../symbols/cim/placements/PlacementAtExtremities ../../../symbols/cim/placements/PlacementAtRatioPositions ../../../symbols/cim/placements/PlacementInsidePolygon ../../../symbols/cim/placements/PlacementOnLine ../../../symbols/cim/placements/PlacementOnVertices ../../../symbols/cim/placements/PlacementPolygonCenter ../../../symbols/cim/enums ../engine/webgl/definitions ../../../core/libs/gl-matrix-2/factories/vec2f32 ../engine/webgl/alignmentUtils ../../../symbols/support/defaults ../../../symbols/cim/OverrideHelper ../../../core/floatRGBA ../../../layers/effects/EffectView ../engine/DisplayObject ./support/util ../../../core/Evented ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../core/libs/gl-matrix-2/factories/vec4f32 ../../webgl/checkWebGLError ../../webgl/enums ../../webgl/FramebufferObject ../../../chunks/builtins ../../webgl/GLObjectType ../../webgl/Texture ../engine/webgl/shaders/BackgroundPrograms ../engine/webgl/DefaultVertexAttributeLayouts ../tiling/TileKey ../engine/webgl/DisplayEntity ../engine/webgl/number ../engine/webgl/PooledUint32Array ../engine/webgl/shaders/TileInfoPrograms ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/enums ../engine/webgl/shaders/BitBlitPrograms ../../../request ../../../core/urlUtils ../../../core/pbf ../engine/webgl/shaders/StencilPrograms ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../core/asyncUtils ../../../core/Collection ../../../core/accessorSupport/watch ../../../core/accessorSupport/tracking/SimpleTrackingTarget ../../../chunks/earcut ../../../geometry/support/aaBoundingBox ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/support/normalizeUtilsCommon ../../../geometry/SpatialReference ../../../geometry/support/Ellipsoid ../../../geometry ../../../kernel ../navigation/MapViewNavigation ../engine/webgl/shaders/MagnifierPrograms ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils".split(" "),function(d,
f,h,c,a,b,e,l,m,k,g,u,y,w,x,J,P,K,G,B,z,N,O,D,S,R,T,Z,U,V,aa,W,n,p,r,C,A,v,q,E,H,I,L,X,ba,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,ha,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,ja,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,ka,la,ma,da,na,oa,pa,qa,ra,ia,sa){const ta=[0,0];let fa=class extends ra(ka.BitmapTileLayerView2D(la.LayerView2DMixin(qa))){constructor(){super(...arguments);this._fetchQueue=null;this._highlightGraphics=new k.GraphicsCollection;this.layer=
this._tileStrategy=this._popupHighlightHelper=this._highlightView=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(t){this._fetchQueue.pause();this._fetchQueue.state=t.state;this._tileStrategy.update(t);this._fetchQueue.resume();this._highlightView?.processUpdate(t)}attach(){const t="tileServers"in this.layer?this.layer.tileServers:null,F=this.tilemapCache;this._tileInfoView=
new na(this.layer.tileInfo,this.layer.fullExtent,F?.effectiveMinLOD,F?.effectiveMaxLOD);this._fetchQueue=new oa({tileInfoView:this._tileInfoView,concurrency:t&&10*t.length||10,process:(M,Q)=>this.fetchTile(M,Q)});this._tileStrategy=new pa({cachePolicy:"keep",resampling:this.resampling,acquireTile:M=>this.acquireTile(M),releaseTile:M=>this.releaseTile(M),tileInfoView:this._tileInfoView});if(ia.isMapServiceLayerView(this,this.layer)){const M=this._highlightView=new ja({view:this.view,graphics:this._highlightGraphics,
requestUpdateCallback:()=>this.requestUpdate(),container:new ma(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container);this._popupHighlightHelper=new ia.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(Q,Y)=>sa.createQueryGeometry(Q,Y,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(Q,Y)=>{M.graphicUpdateHandler({graphic:Q,property:Y})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate();
this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()}));super.attach()}detach(){super.detach();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._popupHighlightHelper?.destroy();this._highlightView?.destroy();this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}async fetchPopupFeaturesAtLocation(t,F){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,
F):[]}highlight(t){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(t):f.makeHandle()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return m.equals(this.layer.tileInfo?.spatialReference,t)}async doRefresh(){this.attached&&(this.suspended?(this._tileStrategy.clear(),this.requestUpdate()):(this._fetchQueue.reset(),this._tileStrategy.refresh(t=>this._updatingHandles.addPromise(this._enqueueTileFetch(t)))))}acquireTile(t){t=
this._bitmapView.createTile(t);const F=t.bitmap;[F.x,F.y]=this._tileInfoView.getTileCoords(ta,t.key);F.resolution=this._tileInfoView.getTileResolution(t.key);[F.width,F.height]=this._tileInfoView.tileInfo.size;this._updatingHandles.addPromise(this._enqueueTileFetch(t));this._bitmapView.addChild(t);this.requestUpdate();return t}releaseTile(t){this._fetchQueue.abort(t.key.id);this._bitmapView.removeChild(t);t.once("detach",()=>t.destroy());this.requestUpdate()}async fetchTile(t,F={}){var M=this.tilemapCache;
const {signal:Q,resamplingLevel:Y=0}=F;if(!M)try{return await this._fetchImage(t,Q)}catch(ca){if(!c.isAbortError(ca)&&!this.resampling)return da.createBlankImage(this._tileInfoView.tileInfo.size);if(3>Y&&(M=this._tileInfoView.getTileParentId(t.id)))return M=new ha(M),F=await this.fetchTile(M,{...F,resamplingLevel:Y+1}),da.resampleImage(this._tileInfoView,F,M,t);throw ca;}F=new ha(0,0,0,0);let ea;try{await M.fetchAvailabilityUpsample(t.level,t.row,t.col,F,{signal:Q});if(F.level!==t.level&&!this.resampling)return da.createBlankImage(this._tileInfoView.tileInfo.size);
ea=await this._fetchImage(F,Q)}catch(ca){if(c.isAbortError(ca))throw ca;ea=await this._fetchImage(t,Q)}return this.resampling?da.resampleImage(this._tileInfoView,ea,F,t):ea}async _enqueueTileFetch(t){if(!this._fetchQueue.has(t.key.id)){try{const F=await this._fetchQueue.push(t.key);t.bitmap.source=F;t.bitmap.width=this._tileInfoView.tileInfo.size[0];t.bitmap.height=this._tileInfoView.tileInfo.size[1];t.once("attach",()=>this.requestUpdate())}catch(F){c.isAbortError(F)||h.getLogger(this).error(F)}this.requestUpdate()}}async _fetchImage(t,
F){return this.layer.fetchImageBitmapTile(t.level,t.row,t.col,{signal:F})}};d.__decorate([a.property()],fa.prototype,"resampling",null);d.__decorate([a.property()],fa.prototype,"tilemapCache",null);return fa=d.__decorate([l.subclass("esri.views.2d.layers.TileLayerView2D")],fa)});