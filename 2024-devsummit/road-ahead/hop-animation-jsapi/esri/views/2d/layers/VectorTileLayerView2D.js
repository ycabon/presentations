// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),function(y,z,B,d,e,f,c,b,g){function l(t){return()=>t.abort()}class p{constructor(t,k,q,r){this._layer=t;this._styleRepository=k;this.devicePixelRatio=q;this._sourceDataMaxLOD=r;this._inputSignalEventListener=this._startOptionsInputSignal=
this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=z.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=
this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(t){this._requestSprite(t);var k=this._layer.currentStyleInfo.glyphsUrl;k=new c(k?d.addQueryParameters(k,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,1024,k);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then(q=>{this._layer&&
(this._connection?.close(),this._connection=q,this._layer&&!this._connection.closed&&(q=q.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},t),Promise.all(q).catch(r=>B.throwIfNotAbortError(r))))})}_requestSprite(t){this._spriteSourceAbortController?.abort();const k=new AbortController;this._spriteSourceAbortController=k;const q=t?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);
this._startOptionsInputSignal=null;q&&(this._inputSignalEventListener=l(k),q.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:r}=k;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...t,signal:r});this._spriteSourcePromise.then(C=>{B.throwIfAbortError(r);this._spriteMosaic=new b(1024,1024,250);this._spriteMosaic.setSpriteSource(C)})}async updateStyle(t){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",
t))}setSpriteSource(t){const k=new b(1024,1024,250);k.setSpriteSource(t);this._spriteMosaic=k;this._spriteSourcePromise=Promise.resolve(t);this._spriteSourceAbortController=null;return k}async setStyle(t,k,q){await this._broadcastPromise;this._styleRepository=t;this._sourceDataMaxLOD=q;this._requestSprite();t=new c(this._layer.currentStyleInfo.glyphsUrl?d.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,
1024,t);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:k,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(t,k){t=await this._getRefKeys(t,k);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),t,k)}async fetchTilePBFs(t){const k=Object.keys(this._layer.sourceNameToSource),q={};t=await this._getRefKeys(t,q);const r=[],C=[];for(let G=0;G<t.length;G++)if(null==t[G].value||null==k[G])C.push(null);else{const w=t[G].value,D=this._getTilePayload(w,
k[G],q);D.then(E=>{r.push({...E,key:w})});C.push(D)}return Promise.all(C).then(()=>r)}async parseTileData(t,k){const q=t&&t.data;if(!q)return null;const {sourceName2DataAndRefKey:r,transferList:C}=q;return 0===Object.keys(r).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:t.styleLayerUIDs},{...k,transferList:C}))}async getSprites(t){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(t)}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,
t.codePoints)}async _getTilePayload(t,k,q){t=g.pool.acquire(t.id);const r=this._layer.sourceNameToSource[k],{level:C,row:G,col:w}=t;g.pool.release(t);try{return{protobuff:await r.requestTile(C,G,w,q),sourceName:k}}catch(D){if(B.isAbortError(D))throw D;return{protobuff:null,sourceName:k}}}async _getRefKeys(t,k){const q=this._layer.sourceNameToSource,r=[];for(const C in q){const G=q[C].getRefKey(t,k);r.push(G)}return B.eachAlways(r)}_getSourcesData(t,k,q){const r=[];for(let C=0;C<k.length;C++)if(null==
k[C].value||null==t[C])r.push(null);else{const G=this._getTilePayload(k[C].value,t[C],q);r.push(G)}return B.eachAlways(r).then(C=>{const G={},w=[];for(let D=0;D<C.length;D++){const E=C[D].value;E&&E.protobuff&&0<E.protobuff.byteLength&&(G[E.sourceName]={refKey:k[D].value.id,protobuff:E.protobuff},w.push(E.protobuff))}return{sourceName2DataAndRefKey:G,transferList:w}})}}y.TileHandler=p;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack",
"../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(y,z,B,d,e){class f{constructor(c,b,g){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=c;this.height=b;this._glyphSource=g;this._binPack=new y(c-4,b-4);this._glyphData.push(new Uint8Array(c*b));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(c,b){const g=[],l=this._glyphSource,
p=new Set,t=1/256;for(const q of b)p.add(Math.floor(q*t));const k=[];p.forEach(q=>{const r=c+q;this._rangePromises.has(r)?k.push(this._rangePromises.get(r)):(q=l.getRange(c,q).then(()=>{this._rangePromises["delete"](r)},()=>{this._rangePromises["delete"](r)}),this._rangePromises.set(r,q),k.push(q))});return Promise.all(k).then(()=>{let q=this._glyphIndex[c];q||(q={},this._glyphIndex[c]=q);for(const D of b){var r=q[D];if(r){g[D]={sdf:!0,rect:r.rect,metrics:r.metrics,page:r.page,code:D};continue}var C=
l.getGlyph(c,D);if(!C?.metrics)continue;r=C.metrics;let E;if(0===r.width)E=new z(0,0,0,0);else{const H=r.width+6,L=r.height+6;var G=H%4?4-H%4:4,w=L%4?4-L%4:4;1===G&&(G=5);1===w&&(w=5);E=this._binPack.allocate(H+G,L+w);E.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new y(this.width-4,this.height-
4),E=this._binPack.allocate(H+G,L+w));G=this._glyphData[this._currentPage];C=C.bitmap;let O;if(C)for(let h=0;h<L;h++){w=H*h;O=this.width*(E.y+h+1)+E.x;for(let n=0;n<H;n++)G[O+n+1]=C.at(w+n)}}q[D]={rect:E,metrics:r,tileIDs:null,page:this._currentPage};g[D]={sdf:!0,rect:E,metrics:r,page:this._currentPage,code:D};this._dirties[this._currentPage]=!0}return g})}removeGlyphs(c){for(const b in this._glyphIndex){const g=this._glyphIndex[b];if(!g)continue;let l;for(const p in g)if(l=g[p],l.tileIDs["delete"](c),
0===l.tileIDs.size){const t=this._glyphData[l.page],k=l.rect;let q,r;for(let C=0;C<k.height;C++)for(q=this.width*(k.y+C)+k.x,r=0;r<k.width;r++)t[q+r]=0;delete g[p];this._dirties[l.page]=!0}}}bind(c,b,g,l=0){if(!this._textures[g]){var p=new e.TextureDescriptor;p.pixelFormat=B.PixelFormat.ALPHA;p.wrapMode=B.TextureWrapMode.CLAMP_TO_EDGE;p.width=this.width;p.height=this.height;this._textures[g]=new d.Texture(c,p,new Uint8Array(this.width*this.height))}p=this._textures[g];p.setSamplingMode(b);this._dirties[g]&&
p.setData(this._glyphData[g]);c.bindTexture(p,l);this._dirties[g]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const c of this._textures)c&&c.dispose();this._textures.length=0}}return f})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(y){class z{constructor(B,d){this._height=this._width=0;this._free=[];this._width=B;this._height=d;this._free.push(new y(0,0,B,d))}get width(){return this._width}get height(){return this._height}allocate(B,
d){if(B>this._width||d>this._height)return new y;let e=null,f=-1;for(let c=0;c<this._free.length;++c){const b=this._free[c];B<=b.width&&d<=b.height&&(null===e||b.y<=e.y&&b.x<=e.x)&&(e=b,f=c)}if(null===e)return new y;this._free.splice(f,1);e.width<e.height?(e.width>B&&this._free.push(new y(e.x+B,e.y,e.width-B,d)),e.height>d&&this._free.push(new y(e.x,e.y+d,e.width,e.height-d))):(e.width>B&&this._free.push(new y(e.x+B,e.y,e.width-B,e.height)),e.height>d&&this._free.push(new y(e.x,e.y+d,B,e.height-d)));
return new y(e.x,e.y,B,d)}release(B){for(let d=0;d<this._free.length;++d){const e=this._free[d];if(e.y===B.y&&e.height===B.height&&e.x+e.width===B.x)e.width+=B.width;else if(e.x===B.x&&e.width===B.width&&e.y+e.height===B.y)e.height+=B.height;else if(B.y===e.y&&B.height===e.height&&B.x+B.width===e.x)e.x=B.x,e.width+=B.width;else if(B.x===e.x&&B.width===e.width&&B.y+B.height===e.y)e.y=B.y,e.height+=B.height;else continue;this._free.splice(d,1);this.release(B)}this._free.push(B)}}return z})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request",
"../../../../core/pbf"],function(y,z){class B{constructor(c){this._metrics=[];if(c){for(var b=new Map,g=0;c.next();)switch(c.tag()){case 1:const p=c.getMessage();for(;p.next();)switch(p.tag()){case 3:var l=p.getMessage();let t,k,q,r,C,G,w;for(;l.next();)switch(l.tag()){case 1:t=l.getUInt32();break;case 2:k=l.getBytes();break;case 3:q=l.getUInt32();break;case 4:r=l.getUInt32();break;case 5:C=l.getSInt32();break;case 6:G=l.getSInt32();break;case 7:w=l.getUInt32();break;default:l.skip()}l.release();
t&&(l=k?.length??0,this._metrics[t]={width:q,height:r,left:C,top:G,advance:w,startOffset:g,length:l},b.set(t,k),g+=l);break;default:p.skip()}p.release();break;default:c.skip()}c=new Uint8Array(g);g=this._metrics;for(const [p,t]of b){const {startOffset:k,length:q}=g[p];if(t)for(b=0;b<q;++b)c[k+b]=t[b]}this._allBitmaps=c}else this._allBitmaps=null}getMetrics(c){return this._metrics[c]}getBitmap(c){if(this._allBitmaps&&(c=this._metrics[c],void 0!==c)){var {startOffset:b,length:g}=c;if(0!==g)return new f(this._allBitmaps,
b,g)}}}class d{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(c){return this._ranges[c]}addRange(c,b){this._ranges[c]=b}}class e{constructor(c){this._glyphInfo={};this._baseURL=c}getRange(c,b){const g=this._getFontStack(c);if(g.getRange(b))return Promise.resolve();const l=256*b,p=l+255;if(this._baseURL)return c=this._baseURL.replace("{fontstack}",c).replace("{range}",l+"-"+p),y(c,{responseType:"array-buffer"}).then(t=>{g.addRange(b,new B(new z(new Uint8Array(t.data),new DataView(t.data))))}).catch(()=>
{g.addRange(b,new B)});g.addRange(b,new B);return Promise.resolve()}getGlyph(c,b){if(c=this._getFontStack(c))if(c=c.getRange(Math.floor(b/256)))return{metrics:c.getMetrics(b),bitmap:c.getBitmap(b)}}_getFontStack(c){let b=this._glyphInfo[c];b||=this._glyphInfo[c]=new d;return b}}class f{constructor(c,b,g){this._array=c;this._start=b;this.length=g}at(c){return 0<=c&&c<this.length?this._array[this._start+c]:void 0}}return e})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(y,z,B,d,e,f){class c{constructor(b,g,l=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=b||0>=g)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=b;this._pageHeight=g;0<l&&(this._maxItemSize=l);this._binPack=new z(b-4,g-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const b of this._textures)b&&b.dispose();this._textures.length=0}getWidth(b){return b>=this._size.length?-1:this._size[b][0]}getHeight(b){return b>=this._size.length?-1:this._size[b][1]}getPageSize(b){return b>=this._size.length?null:this._size[b]}setSpriteSource(b){this.dispose();this.pixelRatio=b.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);const g=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=g;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=b}getSpriteItem(b,g=!1){var l=this._mosaicRects[b];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let p;b&&b.startsWith("dasharray-")?([l,p]=this._rasterizeDash(b),g=!0):l=this._sprites.getSpriteInfo(b);if(!l?.width||!l.height||0>l.width||0>l.height)return null;const t=l.width,k=l.height,[q,r,C]=this._allocateImage(t,k);if(0>=
q.width)return null;this._copy(q,l,r,C,g,p);l={type:"sprite",rect:q,width:t,height:k,sdf:l.sdf,simplePattern:!1,rasterizationScale:l.pixelRatio,page:r};return this._mosaicRects[b]=l}getSpriteItems(b){const g={};for(const l of b)g[l.name]=this.getSpriteItem(l.name,l.repeat);return g}getMosaicItemPosition(b,g){g=(b=this.getSpriteItem(b,g))&&b.rect;if(!g)return null;g.width=b.width;g.height=b.height;return{tl:[g.x+2,g.y+2],br:[g.x+2+b.width,g.y+2+b.height],page:b.page}}bind(b,g,l=0,p=0){if(!(l>=this._size.length||
l>=this._mosaicsData.length)){if(!this._textures[l]){var t=new f.TextureDescriptor;t.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;t.width=this._size[l][0];t.height=this._size[l][1];this._textures[l]=new e.Texture(b,t,new Uint8Array(this._mosaicsData[l].buffer))}t=this._textures[l];t.setSamplingMode(g);this._dirties[l]&&t.setData(new Uint8Array(this._mosaicsData[l].buffer));b.bindTexture(t,p);this._dirties[l]=!1}}static _copyBits(b,g,l,p,t,k,q,r,C,G,w){let D=p*g+l;q=r*k+q;if(w)for(q-=k,w=-1;w<=G;w++,D=
((w+G)%G+p)*g+l,q+=k)for(r=-1;r<=C;r++)t[q+r]=b[D+(r+C)%C];else for(l=0;l<G;l++){for(p=0;p<C;p++)t[q+p]=b[D+p];D+=g;q+=k}}_copy(b,g,l,p,t,k){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(l>=this._mosaicsData.length)){var q=new Uint32Array(k?k.buffer:this._sprites.image.buffer),r=this._mosaicsData[l];r&&q||console.error("Source or target images are uninitialized!");c._copyBits(q,k?g.width:this._sprites.width,g.x,g.y,r,p[0],b.x+2,b.y+2,g.width,g.height,t);this._dirties[l]=!0}}_allocateImage(b,
g){b+=2;g+=2;var l=Math.max(b,g);if(this._maxItemSize&&this._maxItemSize<l)return l=new B(0,0,b,g),this._mosaicsData.push(new Uint32Array(b*g)),this._dirties.push(!0),this._size.push([b,g]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[b,g]];l=b%4?4-b%4:4;let p=g%4?4-g%4:4;1===l&&(l=5);1===p&&(p=5);l=this._binPack.allocate(b+l,g+p);return 0>=l.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*
this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-4,this._pageHeight-4),this._allocateImage(b,g)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(b){var g=b.match(/\[(.*?)\]/);if(!g)return null;g=g[1].split(",").map(Number);b=b.slice(b.lastIndexOf("-")+1);const [l,p,t]=y.rasterizeDash(g,b);b=new Uint8Array(l.buffer);return[{x:0,y:0,width:p,height:t,sdf:!0,pixelRatio:1},
b]}}return c})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../geometry/support/aaBoundingRect","../../tiling/TileCoverage","../../tiling/TileKey"],function(y,z,B,d,e){const f=(b,g)=>b+1/(1<<2*g);class c{constructor(b,g){this._tiles=new Map;this._tileCache=new z.LRUCache(40,l=>l.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=b.acquireTile;this.releaseTile=b.releaseTile;this.tileInfoView=b.tileInfoView;
this._container=g}destroy(){for(const [,b]of this._tiles)b.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null}update(b){this._updateCacheSize(b);const g=this.tileInfoView;b=g.getTileCoverage(b.state,0,!0,"smallest");if(!b)return!0;const {spans:l,lodInfo:p}=b,{level:t}=p,k=this._tiles,q=new Set,r=new Set;for(const {row:G,colFrom:w,colTo:D}of l)for(let E=w;E<=D;E++){const H=e.getId(t,G,p.normalizeCol(E),p.getWorldForColumn(E)),L=this._getOrAcquireTile(H);q.add(H);L.processed()?
this._addToContainer(L):r.add(new e(H))}for(const [G,w]of k)w.isCoverage=q.has(G);for(var C of r)this._findPlaceholdersForMissingTiles(C,q);C=!1;for(const [G,w]of k)w.neededForCoverage=q.has(G),w.neededForCoverage||w.isHoldingForFade&&g.intersects(b,w.key)&&q.add(G),w.isFading&&(C=!0);for(const [G]of this._tiles)q.has(G)||this._releaseTile(G);d.pool.release(b);return!C}clear(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(b,
g,l,p,t){const k=[0,0],q=[0,0];p.toMap(k,b-l,g+l);p.toMap(q,b+l,g-l);g=B.fromValues(Math.min(k[0],q[0]),Math.min(k[1],q[1]),Math.max(k[0],q[0]),Math.max(k[1],q[1]));l=B.create();b=[];for(const [,r]of this._visibleTiles)this.tileInfoView.getTileBounds(l,r.key),B.intersects(g,l)&&b.push(r);if(null!=t&&0<t.length){const r=new Set(b.map(C=>C.id));t=t.filter(C=>!r.has(C.tileKey.id)).map(C=>this._visibleTiles.get(C.tileKey.id)).filter(C=>void 0!==C);b.push(...t)}return b}_findPlaceholdersForMissingTiles(b,
g){var l=[];for(const [,p]of this._tiles)this._addPlaceholderChild(l,p,b,g);l=l.reduce(f,0);1E-6>Math.abs(1-l)||this._addPlaceholderParent(b.id,g)}_addPlaceholderChild(b,g,l,p){if(!(g.key.level<=l.level)&&g.hasData()){var t=g.key,k=t.level-l.level;l.row===t.row>>k&&l.col===t.col>>k&&l.world===t.world&&(this._addToContainer(g),p.add(g.id),b.push(g.key.level-l.level))}}_addPlaceholderParent(b,g){const l=this._tiles;for(;;){{const [t,k,q,r]=b.split("/");b=parseInt(t,10);b=0===b?null:`${b-1}/${parseInt(k,
10)>>1}/${parseInt(q,10)>>1}/${parseInt(r,10)}`}if(!b||g.has(b))break;const p=l.get(b);if(p&&p.hasData()){this._addToContainer(p);g.add(p.id);break}}}_getOrAcquireTile(b){let g=this._tiles.get(b);if(g)return g;(g=this._tileCache.pop(b))||(g=this.acquireTile(new e(b)));this._tiles.set(b,g);return g}_releaseTile(b){const g=this._tiles.get(b);this.releaseTile(g);this._removeFromContainer(g);this._tiles.delete(b);g.hasData()?this._tileCache.put(b,g,1):g.dispose()}_addToContainer(b){let g;const l=[],p=
this._container;if(!p.contains(b)){var t=this._visibleTiles;for(const [,k]of t)this._canConnectDirectly(b,k)&&l.push(k),null==g&&this._canConnectDirectly(k,b)&&(g=k);if(null!=g){for(const k of l)g.childrenTiles.delete(k),b.childrenTiles.add(k),k.parentTile=b;g.childrenTiles.add(b);b.parentTile=g}else for(const k of l)b.childrenTiles.add(k),k.parentTile=b;t.set(b.id,b);p.addChild(b)}}_removeFromContainer(b){this._visibleTiles.delete(b.id);this._container.removeChild(b);if(null!=b.parentTile){b.parentTile.childrenTiles.delete(b);
for(const g of b.childrenTiles)null!=b.parentTile&&b.parentTile.childrenTiles.add(g)}for(const g of b.childrenTiles)g.parentTile=b.parentTile;b.parentTile=null;b.childrenTiles.clear()}_canConnectDirectly(b,g){b=b.key;let {level:l,row:p,col:t,world:k}=g.key;for(g=this._visibleTiles;0<l;){l--;p>>=1;t>>=1;if(b.level===l&&b.row===p&&b.col===t&&b.world===k)return!0;if(g.has(`${l}/${p}/${t}/${k}`))break}return!1}_updateCacheSize(b){b=b.state.size;if(b[0]!==this._viewSize[0]||b[1]!==this._viewSize[1]){var g=
Math.ceil(b[0]/512)+1,l=Math.ceil(b[1]/512)+1;this._viewSize[0]=b[0];this._viewSize[1]=b[1];this._tileCache.maxSize=5*g*l}}}y.TileManager=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(y,z,B,d,e,f,c,
b){class g extends b.TiledDisplayObject{constructor(p,t,k,q,r,C,G,w=null){super(p,t,k,q,r,C,4096,4096);this.styleRepository=G;this._memCache=w;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=
0;this._processed=!1;this._referenced=1;this.id=p.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<c.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(p){this.changeDataImpl(p);this.requestRender();
this.ready();this._processed=!0}deleteLayerData(p){let t=!1;for(const k of p)if(p=this.layerData.get(k))this._memoryUsedByLayerData-=p.memoryUsed,p.type===e.BucketType.SYMBOL&&this.symbols.delete(k)&&(t=!0),p.destroy(),this.layerData.delete(k);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);t&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&
(this.featureIndex=null,l.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(p){this.featureIndex?.clear();let t=!1;if(p){const {bucketsWithData:k,emptyBuckets:q}=p;p=this._createRenderBuckets(k);
if(q&&0<q.byteLength){const r=new Uint32Array(q);for(const C of r)this._deleteLayerData(C)}for(const [r,C]of p)this._deleteLayerData(r),C.type===e.BucketType.SYMBOL&&(this.symbols.set(r,C.symbols),t=!0),this._memoryUsedByLayerData+=C.memoryUsed,this.layerData.set(r,C);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const [,k]of this.layerData)k.type===e.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(p){this.stage=
{context:p,trashDisplayObject(t){t.processDetach()},untrashDisplayObject(){return!1}}}setTransform(p){super.setTransform(p);var t=this.resolution/(p.resolution*p.pixelRatio);const k=this.width/this.rangeX*t;t*=this.height/this.rangeY;const q=[0,0];p.toScreen(q,[this.x,this.y]);const r=this.transforms.tileUnitsToPixels;B.identity(r);B.translate(r,r,q);B.rotate(r,r,Math.PI*p.rotation/180);B.scale(r,r,[k,t,1])}_createTransforms(){return{displayViewScreenMat3:d.create(),tileMat3:d.create(),tileUnitsToPixels:d.create()}}static _destroyRenderBuckets(p){if(p){var t=
new Set;for(const k of p.values())t.has(k)||(k.destroy(),t.add(k));p.clear()}}_createRenderBuckets(p){const t=new Map,k=new Map;for(const q of p){p=this._deserializeBucket(q,k);for(const r of p.layerUIDs)t.set(r,p)}return t}_deserializeBucket(p,t){let k=t.get(p);if(k)return k;switch((new Uint32Array(p))[0]){case e.BucketType.FILL:k=new f.FillRenderBucket(p,this.styleRepository);break;case e.BucketType.LINE:k=new f.LineRenderBucket(p,this.styleRepository);break;case e.BucketType.SYMBOL:k=new f.SymbolRenderBucket(p,
this.styleRepository,this);break;case e.BucketType.CIRCLE:k=new f.CircleRenderBucket(p,this.styleRepository)}t.set(p,k);return k}_deleteLayerData(p){if(this.layerData.has(p)){var t=this.layerData.get(p);this._memoryUsedByLayerData-=t.memoryUsed;t.destroy();this.layerData.delete(p)}}}const l=new Map;y.VectorTile=g;y.printAllocations=function(){l.forEach((p,t)=>{console.log(`\n${t.key}:`);p[0].forEach(k=>console.log(k));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");p[1].forEach(k=>console.log(k))})};
Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(y,z,B,d,e,f,c,b,g,l,p,t){class k{constructor(w,D){this.layerUIDs=[];this.isDestroyed=
!1;this._data=w;let E=1;w=new Uint32Array(w);this.layerUIDs=[];const H=w[E++];for(let L=0;L<H;L++)this.layerUIDs[L]=w[E++];this.bufferDataOffset=E;D&&(this.layer=D.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(w){null!=this._data&&(this.doPrepareForRendering(w,this._data,this.bufferDataOffset),
this._data=null)}}class q extends k{constructor(w,D){super(w,D);this.type=b.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.lineIndexStart=w[D++];this.lineIndexCount=w[D++];const E=w[D++];if(0<E){this.patternMap=new Map;for(let H=0;H<E;H++){const L=w[D++],O=w[D++],h=w[D++];this.patternMap.set(L,[O,h])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/
3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D);D=new Int32Array(H.buffer);var L=H[E++];D=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,L));E+=L;L=H[E++];H=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,L));E+=L;E=this.layer.lineMaterial;this.vao=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},H)}}class r extends k{constructor(w,D){super(w,D);this.type=
b.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.fillIndexStart=w[D++];this.fillIndexCount=w[D++];this.outlineIndexStart=w[D++];this.outlineIndexCount=w[D++];const E=w[D++];if(0<E){this.patternMap=new Map;for(let H=0;H<E;H++){const L=w[D++],O=w[D++],h=w[D++];this.patternMap.set(L,[O,h])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??
0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=z.disposeMaybe(this.fillVAO);this.outlineVAO=z.disposeMaybe(this.outlineVAO)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D),L=new Int32Array(H.buffer),O=H[E++];D=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,O));E+=O;var h=H[E++];O=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,
4*E,h));E+=h;h=H[E++];L=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,h));E+=h;h=H[E++];H=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));E+=h;h=this.layer;E=h.fillMaterial;h=h.outlineMaterial;this.fillVAO=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},O);this.outlineVAO=new t.VertexArrayObject(w,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:L},H)}}class C extends k{constructor(w,D,E){super(w,
D);this.type=b.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];D=new Uint32Array(w);const H=new Int32Array(w);w=new Float32Array(w);let L=this.bufferDataOffset;this.isIconSDF=!!D[L++];var O=D[L++],h=D[L++],n=D[L++];O=new e(O,h,n,0);h=D[L++];for(n=0;n<h;n++){var m=D[L++],u=D[L++],A=D[L++];this.iconPerPageElementsMap.set(m,[u,A])}h=D[L++];for(n=0;n<h;n++)m=
D[L++],u=D[L++],A=D[L++],this.glyphPerPageElementsMap.set(m,[u,A]);h=D[L++];n=D[L++];this.iconOpacity=new Int32Array(h);this.textOpacity=new Int32Array(n);this.bufferDataOffset=L=g.deserializeSymbols(D,H,w,L,this.symbols,E,O)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+B.estimateSize(this.iconOpacity)+B.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let w=
0;for(const [,D]of this.iconPerPageElementsMap)w+=D[1];for(const [,D]of this.glyphPerPageElementsMap)w+=D[1];return w/3}doDestroy(){this.iconVAO=z.disposeMaybe(this.iconVAO);this.textVAO=z.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var w=this.iconOpacity,D=this.iconVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===D.usedMemory&&D.setSubData(w,0,0,w.length);w=this.textOpacity;D=this.textVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===D.usedMemory&&
D.setSubData(w,0,0,w.length)}}doPrepareForRendering(w,D,E){var H=new Uint32Array(D),L=new Int32Array(H.buffer),O=H[E++];D=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,O));E+=O;var h=H[E++];O=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));E+=h;h=H[E++];L=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,h));E+=h;h=H[E++];H=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));
E+=h;E=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,this.iconOpacity.buffer);h=l.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,this.textOpacity.buffer);var n=this.layer;const m=n.iconMaterial;n=n.textMaterial;this.iconVAO=new t.VertexArrayObject(w,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:D,opacity:E},O);this.textVAO=new t.VertexArrayObject(w,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:L,opacity:h},H)}}class G extends k{constructor(w,D){super(w,D);this.type=b.BucketType.CIRCLE;
this.circleIndexCount=this.circleIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.circleIndexStart=w[D++];this.circleIndexCount=w[D++];this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D);D=new Int32Array(H.buffer);var L=H[E++];D=l.BufferObject.createVertex(w,
p.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,L));E+=L;L=H[E++];H=l.BufferObject.createIndex(w,p.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,L));E+=L;E=this.layer.circleMaterial;this.vao=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},H)}}y.CircleRenderBucket=G;y.FillRenderBucket=r;y.LineRenderBucket=q;y.RenderBucketBase=k;y.SymbolRenderBucket=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports",
"../enums","../GeometryUtils","./core"],function(y,z,B,d){class e{constructor(f,c,b){this._rows=Math.ceil(c/b);this._columns=Math.ceil(f/b);this._cellSize=b;this.cells=Array(this._rows);for(f=0;f<this._rows;f++)for(this.cells[f]=Array(this._columns),c=0;c<this._columns;c++)this.cells[f][c]=[]}getCell(f,c){c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._rows-1);f=Math.min(Math.max(Math.floor(f/this._cellSize),0),this._columns-1);return this.cells[c]&&this.cells[c][f]||null}getCellSpan(f,
c,b,g){return[Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}y.GridIndex=e;y.deserializeSymbols=function(f,c,b,g,l,p,t){const k=c[g++];for(let C=0;C<k;C++){const G=new d.VTLSymbol(p,t);G.xTile=
c[g++];G.yTile=c[g++];G.hash=c[g++];G.priority=c[g++];G.featureIndex=c[g++];var q=c[g++];for(var r=0;r<q;r++){const w=c[g++],D=c[g++],E=c[g++],H=c[g++],L=!!c[g++],O=c[g++],h=b[g++],n=b[g++],m=c[g++],u=c[g++];G.colliders.push({xTile:w,yTile:D,dxPixels:E,dyPixels:H,hard:L,partIndex:O,width:m,height:u,minLod:h,maxLod:n})}q=f[g++];for(r=0;r<q;r++)G.textVertexRanges.push([f[g++],f[g++]]);q=f[g++];for(r=0;r<q;r++)G.iconVertexRanges.push([f[g++],f[g++]]);l.push(G)}return g};y.isSearchCircleOverlapingSymbol=
function(f,c,b,g){var l=f.colliders;let p,t,k;for(const q of l)if(f.unique.show&&f.unique.parts[q.partIndex].show&&(l=q.xScreen-g[0]+q.dxScreen,p=q.yScreen-g[1]+q.dyScreen,t=l+q.width,k=p+q.height,B.isCircleOverlapingRect(b,c.x,c.y,l,p,t,k)))return!0;return!1};y.tileCoordChange=function(f,c,b,g,l,p){b-=l;if(0<=b)return(c>>b)+(g-(p<<b))*(f>>b);b=-b;return c-(p-(g<<b))*(f>>b)<<b};y.writeOpacityToBuffers=function(f,c,b){for(const [r,C]of f.symbols){{var g=f,l=c,p=b,t=C;const G=g.layerData.get(r);if(G.type===
z.BucketType.SYMBOL){for(const w of t){t=w.unique;var k=void 0;if(w.selectedForRendering){var q=t.parts[0];k=q.startOpacity;q=q.targetOpacity;g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===q;k=p?Math.floor(127*k)|q<<7:q?255:0;k|=k<<24|k<<16|k<<8}else k=0;for(const [D,E]of w.iconVertexRanges)for(q=D;q<D+E;q+=4)G.iconOpacity[q/4]=k;w.selectedForRendering?(k=t.parts[1],t=k.startOpacity,k=k.targetOpacity,g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===k,t=p?Math.floor(127*t)|k<<7:k?255:0,k=t<<24|t<<
16|t<<8|t):k=0;for(const [D,E]of w.textVertexRanges)for(t=D;t<D+E;t+=4)G.textOpacity[t/4]=k}G.lastOpacityUpdate=l;G.opacityChanged=!0}}}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){class z{constructor(d,e){this.sourceTile=e;this.hash=this.yTile=this.xTile=0;this.priority=1;this.featureIndex=0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=d}}class B{constructor(){this.tileSymbols=
[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}y.VTLSymbol=z;y.VTLUniqueSymbol=B;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(y,z,B,d,e,f,c,b,g,l){function p(k,q){if(k){const r=k.getLayoutProperty("visibility");if(!r||r.getValue()!==d.Visibility.NONE&&(void 0===k.minzoom||k.minzoom<q+1E-6)&&(void 0===k.maxzoom||k.maxzoom>=q-1E-6))return!0}return!1}class t extends c{constructor(k){super(k);this._backgroundTiles=[]}destroy(){this.removeAllChildren();this._spriteMosaic?.dispose();this._spriteMosaic=null;this._glyphMosaic?.dispose();this._glyphMosaic=null;null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=
null);this._styleRepository=null;this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(k,q,r,C){this._spriteMosaic=k;this._glyphMosaic=q;this._styleRepository=r;this._tileInfoView=C;null==this._symbolFader&&(this._symbolFader=new B.SymbolFader(this._styleRepository,this.children));this._symbolFader.styleRepository=r}setSpriteMosaic(k){this._spriteMosaic?.dispose();
this._spriteMosaic=k}deleteStyleLayers(k){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(k)}createRenderParams(k){return{...super.createRenderParams(k),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(k){!this.visible||k.drawPhase!==e.WGLDrawPhase.MAP&&k.drawPhase!==e.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||super.doRender(k)}addChild(k){super.addChild(k);null!=this._symbolFader?
this._symbolFader.addTile(k):k.decluttered=!0;this.requestRender();return k}removeChild(k){null!=this._symbolFader&&this._symbolFader.removeTile(k);this.requestRender();return super.removeChild(k)}renderChildren(k){const {drawPhase:q}=k;q===e.WGLDrawPhase.DEBUG?super.renderChildren(k):this._doRender(k)}removeAllChildren(){for(let k=0;k<this.children.length;k++){const q=this.children[k];null!=this._symbolFader&&this._symbolFader.removeTile(q);q.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(k=>
k.neededForCoverage&&k.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(k){const {context:q}=k;var r=this._styleRepository;if(r){var C=r.layers;0<r.backgroundBucketIds.length&&(k.renderPass="background",this._renderBackgroundLayers(k,r.backgroundBucketIds));super.renderChildren(k);k.drawPhase===e.WGLDrawPhase.MAP&&this._fade(k.displayLevel,k.state);if((r=this.children.filter(w=>w.visible&&w.hasData()))&&0!==r.length){for(var G of r)G.triangleCount=
0;q.setStencilWriteMask(0);q.setColorMask(!0,!0,!0,!0);q.setStencilOp(l.StencilOperation.KEEP,l.StencilOperation.KEEP,l.StencilOperation.REPLACE);q.setStencilTestEnabled(!0);q.setBlendingEnabled(!1);q.setDepthTestEnabled(!0);q.setDepthWriteEnabled(!0);q.setDepthFunction(l.CompareFunction.LEQUAL);q.setClearDepth(1);q.clear(q.gl.DEPTH_BUFFER_BIT);k.renderPass="opaque";for(G=C.length-1;0<=G;G--)this._renderStyleLayer(C[G],k,r);q.setDepthWriteEnabled(!1);q.setBlendingEnabled(!0);q.setBlendFunctionSeparate(l.BlendFactor.ONE,
l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);k.renderPass="translucent";for(G=0;G<C.length;G++)this._renderStyleLayer(C[G],k,r);q.bindVAO();q.setStencilTestEnabled(!0);q.setBlendingEnabled(!0);for(const w of r)w.debugInfo.display.triangleCount=w.triangleCount}else q.bindVAO(),q.setStencilTestEnabled(!0),q.setBlendingEnabled(!0)}}_fade(k,q){null!=this._symbolFader&&(this._symbolFader.update(k,q)||this.requestRender())}_renderStyleLayer(k,q,r){const {painter:C,
renderPass:G}=q;if(void 0!==k){var w=k.getLayoutProperty("visibility");if(!w||w.getValue()!==d.Visibility.NONE){switch(k.type){case d.StyleLayerType.BACKGROUND:return;case d.StyleLayerType.FILL:if("opaque"!==G&&"translucent"!==q.renderPass)return;var D="vtlFill";break;case d.StyleLayerType.LINE:if("translucent"!==G)return;D="vtlLine";break;case d.StyleLayerType.CIRCLE:if("translucent"!==G)return;D="vtlCircle";break;case d.StyleLayerType.SYMBOL:if("translucent"!==G)return;D="vtlSymbol"}r=k.type===
d.StyleLayerType.SYMBOL?r.filter(E=>E.decluttered):r.filter(E=>E.neededForCoverage);if("vtlSymbol"!==D&&(w=q.displayLevel,0===r.length||void 0!==k.minzoom&&k.minzoom>=w+1E-6||void 0!==k.maxzoom&&k.maxzoom<w-1E-6))return;w=k.uid;q.styleLayerUID=w;q.styleLayer=k;for(const E of r)if(E.layerData.has(w)){C.renderObjects(q,r,D);break}}}}_renderBackgroundLayers(k,q){const {context:r,displayLevel:C,painter:G,state:w}=k,D=this._styleRepository;var E=!1;for(var H of q)if(D.getLayerById(H).type===d.StyleLayerType.BACKGROUND&&
p(D.getLayerById(H),C)){E=!0;break}if(E){E=this._tileInfoView.getTileCoverage(k.state,0,!0,"smallest");var {spans:L,lodInfo:O}=E,{level:h}=O,n=z.create();H=[];if(this._renderPasses){var m=this._renderPasses[0];null!=this._clippingInfos&&(m.brushes[0].prepareState(k),m.brushes[0].drawMany(k,this._clippingInfos))}m=this._backgroundTiles;var u=0;for(const {row:I,colFrom:K,colTo:N}of L)for(let J=K;J<=N;J++){if(u<m.length){var A=m[u];A.key.set(h,I,O.normalizeCol(J),O.getWorldForColumn(J));this._tileInfoView.getTileBounds(n,
A.key,!1);A.x=n[0];A.y=n[3];A.resolution=this._tileInfoView.getTileResolution(h)}else{A=new g(h,I,O.normalizeCol(J),O.getWorldForColumn(J));const Q=this._tileInfoView.getTileBounds(z.create(),A),R=this._tileInfoView.getTileResolution(h);A=new f.RenderableTile(A,R,Q[0],Q[3],512,512,4096,4096);m.push(A)}A.setTransform(w);H.push(A);u++}r.setStencilWriteMask(0);r.setColorMask(!0,!0,!0,!0);r.setStencilOp(l.StencilOperation.KEEP,l.StencilOperation.KEEP,l.StencilOperation.REPLACE);r.setStencilFunction(l.CompareFunction.EQUAL,
0,255);r.setStencilTestEnabled(!0);for(const I of q)q=D.getLayerById(I),q.type===d.StyleLayerType.BACKGROUND&&p(q,C)&&(k.styleLayerUID=q.uid,k.styleLayer=q,G.renderObjects(k,H,"vtlBackground"));b.pool.release(E)}}}y.VectorTileContainer=t;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../core/signal ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(y,z,B,d,e,f,c,b,g){class l{constructor(p,t){this.styleRepository=p;this._tileToHandle=new Map;this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._offsetFromScreenCenter=[0,0];this._completed=!1;this._fading=z.signal(!1);this._symbolRepository=new c.SymbolRepository(4096,t,()=>new d.VTLUniqueSymbol);this._symbolDeclutterer=new f.SymbolDeclutterer(t,this._symbolRepository,(k,q,r)=>this._createCollisionJob(k,
q,r),(k,q)=>{k.allSymbolsFadingOut=!0;k.lastOpacityUpdate=q;b.writeOpacityToBuffers(k,q,!0);k.decluttered=!0;k.requestRender()},(k,q)=>this.styleRepository.getStyleLayerByUID(k.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(q.styleLayerUID).z,k=>{k=this.styleRepository.getStyleLayerByUID(k);return this._zoom+1E-6<k.minzoom||this._zoom-1E-6>=k.maxzoom?!1:(k=k.getLayoutProperty("visibility"))&&k.getValue()===g.Visibility.NONE?!1:!0})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(p,
t,k){this.updateDecluttererViewState();return new e.CollisionJob(p,t,k,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(p){p.decluttered=!1;this._tileToHandle.set(p,p.on("symbols-changed",()=>{this._symbolRepository.add(p);this.restartDeclutter()}));this._symbolRepository.add(p);this.restartDeclutter()}removeTile(p){const t=this._tileToHandle.get(p);t&&(this._symbolRepository.removeTile(p),
this.restartDeclutter(),t.remove(),this._tileToHandle.delete(p))}update(p,t){this._zoom=p;this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};p=[0,0];t.toScreen(p,t.center);const k=[0,0];t.toScreen(k,this._declutterViewState.center);this._offsetFromScreenCenter[0]=p[0]-k[0];this._offsetFromScreenCenter[1]=p[1]-k[1];this._continueDeclutter();return this._completed}restartDeclutter(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()}clear(){this._completed=
!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(p=>p.remove());this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(p){this._symbolRepository.deleteStyleLayers(p)}_continueDeclutter(){if(!this._completed||
this.stale)this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(B.declutterBudget))&&this._scheduleNotifyStable()}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this._fading.value=
!1},1.5*B.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom;this._declutterViewState.center[0]=this._viewState.center[0];this._declutterViewState.center[1]=this._viewState.center[1];this._declutterViewState.rotation=this._viewState.rotation;this._declutterViewState.scale=this._viewState.scale;this._declutterViewState.size[0]=
this._viewState.size[0];this._declutterViewState.size[1]=this._viewState.size[1];this._offsetFromScreenCenter[0]=0;this._offsetFromScreenCenter[1]=0}}y.SymbolFader=l;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32","./config","./util","../style/StyleDefinition"],function(y,z,B,d,e){class f{constructor(c,b,g,l,p,t){this._symbols=c;this._styleRepository=
l;this._zoom=p;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new d.GridIndex(b,g,B.collisionGridCellSize);this._si=Math.sin(Math.PI*t/180);this._co=Math.cos(Math.PI*t/180);for(const k of c)for(const q of k.symbols)this._allNeededMatrices.has(q.tile)||this._allNeededMatrices.set(q.tile,z.clone(q.tile.transforms.tileUnitsToPixels))}work(c){const b=this._gridIndex,g=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,
this._currentSymbolCursor=0){const E=this._symbols[this._currentLayerCursor],H=this._getProperties(E.styleLayerUID);for(;this._currentSymbolCursor<E.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-g>c)return!1;var l=E.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;var p=l,t=this._si,k=this._co,q=this._allNeededMatrices.get(l.tile),r=this._zoom;const {iconRotationAlignment:L,textRotationAlignment:O,iconTranslate:h,iconTranslateAnchor:n,
textTranslate:m,textTranslateAnchor:u}=H;var C=0;for(const J of p.colliders){const [Q,R]=0===J.partIndex?h:m;var G=0===J.partIndex?n:u,w=J.minLod<=r&&r<=J.maxLod;C+=w?0:1;J.enabled=w;J.xScreen=J.xTile*q[0]+J.yTile*q[3]+q[6];J.yScreen=J.xTile*q[1]+J.yTile*q[4]+q[7];G===e.TranslateAnchor.MAP?(J.xScreen+=k*Q-t*R,J.yScreen+=t*Q+k*R):(J.xScreen+=Q,J.yScreen+=R);e.RotationAlignment.VIEWPORT===(0===J.partIndex?L:O)?(J.dxScreen=J.dxPixels,J.dyScreen=J.dyPixels):(J.dxScreen=k*(J.dxPixels+J.width/2)-t*(J.dyPixels+
J.height/2)-J.width/2,J.dyScreen=t*(J.dxPixels+J.width/2)+k*(J.dyPixels+J.height/2)-J.height/2)}0<p.colliders.length&&C===p.colliders.length&&(p.unique.show=!1);p=l.unique;if(!p.show)continue;const {iconAllowOverlap:A,iconIgnorePlacement:I,textAllowOverlap:K,textIgnorePlacement:N}=H;for(const J of l.colliders)if(J.enabled&&(t=p.parts[J.partIndex],t.show)){if(k=!(J.partIndex?K:A))a:{k=J.xScreen+J.dxScreen;q=J.yScreen+J.dyScreen;r=k+J.width;C=q+J.height;const [Q,R,V,aa]=b.getCellSpan(k,q,r,C);for(G=
R;G<=aa;G++)for(w=Q;w<=V;w++){var D=b.cells[G][w];for(const Y of D){D=Y.xScreen+Y.dxScreen;const ba=Y.yScreen+Y.dyScreen,ea=D+Y.width,W=ba+Y.height;if(!(r<D||k>ea||C<ba||q>W)){k=!0;break a}}}k=!1}k&&(J.hard?p.show=!1:t.show=!1)}if(p.show)for(const J of l.colliders){if(!J.enabled)continue;if(J.partIndex?N:I)continue;if(!p.parts[J.partIndex].show)continue;l=J.xScreen+J.dxScreen;t=J.yScreen+J.dyScreen;const [Q,R,V,aa]=this._gridIndex.getCellSpan(l,t,l+J.width,t+J.height);for(l=R;l<=aa;l++)for(t=Q;t<=
V;t++)this._gridIndex.cells[l][t].push(J)}}}return!0}_getProperties(c){var b=this._styleProps.get(c);if(b)return b;b=this._zoom;const g=this._styleRepository.getStyleLayerByUID(c);var l=g.getLayoutValue("symbol-placement",b)!==e.SymbolPlacement.POINT;let p=g.getLayoutValue("icon-rotation-alignment",b);p===e.RotationAlignment.AUTO&&(p=l?e.RotationAlignment.MAP:e.RotationAlignment.VIEWPORT);let t=g.getLayoutValue("text-rotation-alignment",b);t===e.RotationAlignment.AUTO&&(t=l?e.RotationAlignment.MAP:
e.RotationAlignment.VIEWPORT);l=g.getPaintValue("icon-translate",b);const k=g.getPaintValue("icon-translate-anchor",b),q=g.getPaintValue("text-translate",b),r=g.getPaintValue("text-translate-anchor",b);b={iconAllowOverlap:g.getLayoutValue("icon-allow-overlap",b),iconIgnorePlacement:g.getLayoutValue("icon-ignore-placement",b),textAllowOverlap:g.getLayoutValue("text-allow-overlap",b),textIgnorePlacement:g.getLayoutValue("text-ignore-placement",b),iconRotationAlignment:p,textRotationAlignment:t,iconTranslateAnchor:k,
iconTranslate:l,textTranslateAnchor:r,textTranslate:q};this._styleProps.set(c,b);return b}}y.CollisionJob=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(y,z){function B(e,f){if(e.priority-f.priority)return e.priority-f.priority;const c=e.tile.key,b=f.tile.key;return c.world-b.world?c.world-b.world:c.level-b.level?c.level-b.level:c.row-b.row?c.row-b.row:c.col-b.col?
c.col-b.col:e.xTile-f.xTile?e.xTile-f.xTile:e.yTile-f.yTile}class d{get running(){return this._running}constructor(e,f,c,b,g,l){this._visibleTiles=e;this._symbolRepository=f;this._createCollisionJob=c;this._assignTileSymbolsOpacity=b;this._symbolLayerSorter=g;this._isLayerVisible=l;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(e,f){this._screenWidth===e&&
this._screenHeight===f||this.restart();this._screenWidth=e;this._screenHeight=f}restart(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(e){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var f=performance.now();if(!this._selectionJob.work(e))return!1;this._selectionJobCompleted=!0;e=Math.max(0,e-(performance.now()-
f));if(0===e)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){f=performance.now();if(!this._collisionJob.work(e))return!1;this._collisionJobCompleted=!0;e=Math.max(0,e-(performance.now()-f));if(0===e)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){f=performance.now();if(!this._opacityJob.work(e))return!1;this._opacityJobCompleted=
!0;e=Math.max(0,e-(performance.now()-f));if(0===e)return!1}this._running=!1;return!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let p=0;p<e.length;p++){const t=e[p];for(let k=0;k<t.uniqueSymbols.length;k++){const q=t.uniqueSymbols[k];for(const r of q.tileSymbols)r.selectedForRendering=!1}}const f=[];let c=0,b=0;const g=this._isLayerVisible,l=this._symbolLayerSorter;return{work:function(p){const t=performance.now();for(;b<e.length;b++,c=0){const q=e[b];var k=q.styleLayerUID;
if(!g(k)){f[b]||(f[b]={styleLayerUID:k,symbols:[]});continue}f[b]=f[b]||{styleLayerUID:k,symbols:[]};const r=f[b];for(;c<q.uniqueSymbols.length;c++){k=q.uniqueSymbols[c];if(99===c%100&&performance.now()-t>p)return!1;let C=null,G=!1,w=!1;for(const D of k.tileSymbols)if(!w||!G){const E=D.tile;if(!C||E.isCoverage||E.neededForCoverage&&!G){C=D;if(E.neededForCoverage||E.isCoverage)w=!0;E.isCoverage&&(G=!0)}}C.selectedForRendering=!0;if(w){r.symbols.push(C);k.show=!0;for(const D of k.parts)D.show=!0}else k.show=
!1}}for(const q of f)q.symbols.sort(B);return!0},get sortedSymbols(){return f.sort(l)}}}_createOpacityJob(){function e(g,l){var p=g.symbols;for(const [,k]of p){var t=k;p=l;for(const q of t){t=q.unique;for(const r of t.parts)r.startOpacity+=(p-r.startTime)/z.fadeDuration*(.5<r.targetOpacity?1:-1),r.startOpacity=Math.min(Math.max(r.startOpacity,0),1),r.startTime=p,r.targetOpacity=t.show&&r.show?1:0}}f(g,l);for(const k of g.childrenTiles)e(k,l)}const f=this._assignTileSymbolsOpacity,c=this._visibleTiles;
let b=0;return{work(g){const l=performance.now();for(;b<c.length;b++){if(performance.now()-l>g)return!1;const p=c[b];if(null!=p.parentTile)continue;const t=performance.now();e(p,t)}return!0}}}}y.SymbolDeclutterer=d;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(y,z){class B{constructor(d,e,f){this.tileCoordRange=d;this._visibleTiles=e;this._createUnique=f;this._tiles=new Map;
this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(d,e){this._uniqueSymbolLayerArray=null;let f=this._tiles.get(d.id);f||(f={symbols:new Map},this._tiles.set(d.id,f));var c=new Map;if(e)for(var b of e)f.symbols.has(b)&&(c.set(b,f.symbols.get(b)),f.symbols.delete(b));else for(var [g]of d.layerData)f.symbols.has(g)&&
(c.set(g,f.symbols.get(g)),f.symbols.delete(g));this._removeSymbols(c);e=d.symbols;c=new Map;for(const [l,p]of e)if(b=p.length,32<=b){g=this.tileCoordRange;do g/=2,b/=4;while(8<b&&64<g);b=new z.GridIndex(this.tileCoordRange,this.tileCoordRange,g);c.set(l,{flat:p,index:b});f.symbols.set(l,{flat:p,index:b});for(const t of p)b.getCell(t.xTile,t.yTile).push(t)}else c.set(l,{flat:p}),f.symbols.set(l,{flat:p});this._addSymbols(d.key,e)}deleteStyleLayers(d){this._uniqueSymbolLayerArray=null;for(const [e,
f]of this._tiles){const c=new Map;for(const b of d)f.symbols.has(b)&&(c.set(b,f.symbols.get(b)),f.symbols.delete(b));this._removeSymbols(c);0===f.symbols.size&&this._tiles.delete(e)}}removeTile(d){this._uniqueSymbolLayerArray=null;const e=this._tiles.get(d.id);if(e){var f=new Map;for(const [c]of d.symbols)e.symbols.has(c)&&(f.set(c,e.symbols.get(c)),e.symbols.delete(c));this._removeSymbols(f);0===e.symbols.size&&this._tiles.delete(d.id)}}querySymbols(d,e,f,c){c=[];var b=this.uniqueSymbols;for(const l of b){b=
l.styleLayerUID;var g=l.uniqueSymbols;for(const p of g)(g=p.tileSymbols.find(t=>t.selectedForRendering))&&z.isSearchCircleOverlapingSymbol(g,d,e*(window.devicePixelRatio||1),f)&&c.push({vtlSymbol:g,styleLayerUID:b,tileKey:g.tile.key})}return c}_removeSymbols(d){for(const [f,{flat:c}]of d)for(const b of c){d=b.unique;var e=d.tileSymbols;const g=e.length-1;for(let l=0;l<g;l++)if(e[l]===b){e[l]=e[g];break}e.length=g;0===g&&(e=this._uniqueSymbolsReferences.get(f),e.delete(d),0===e.size&&this._uniqueSymbolsReferences.delete(f));
b.unique=null}}_addSymbols(d,e){if(0!==e.size){var f=this._visibleTiles;for(const c of f)c.parentTile||c.key.world!==d.world||c.key.level===d.level&&!c.key.equals(d)||this._matchSymbols(c,d,e);for(const [c,b]of e)for(const g of b)null==g.unique&&(d=this._createUnique(),g.unique=d,d.tileSymbols.push(g),e=this._uniqueSymbolsReferences.get(c),e||(e=new Set,this._uniqueSymbolsReferences.set(c,e)),e.add(d))}}_matchSymbols(d,e,f){if(d.key.level>e.level){var c=d.key.level-e.level;if(d.key.row>>c!==e.row||
d.key.col>>c!==e.col)return}if(e.level>d.key.level&&(c=e.level-d.key.level,e.row>>c!==d.key.row||e.col>>c!==d.key.col))return;if(e.equals(d.key))for(var b of d.childrenTiles)this._matchSymbols(b,e,f);else{b=new Map;for(const [p,t]of f){var g=[];for(const q of t)f=z.tileCoordChange(this.tileCoordRange,q.xTile,e.level,e.col,d.key.level,d.key.col),c=z.tileCoordChange(this.tileCoordRange,q.yTile,e.level,e.row,d.key.level,d.key.row),0<=f&&f<this.tileCoordRange&&0<=c&&c<this.tileCoordRange&&g.push({symbol:q,
xTransformed:f,yTransformed:c});f=[];c=d.key.level<e.level?1:1<<d.key.level-e.level;const k=this._tiles.get(d.id).symbols.get(p);if(k){const q=k.flat;for(const r of g){var l=!1;let C;const G=r.xTransformed,w=r.yTransformed;C=null!=k.index?k.index.getCell(G,w):q;g=r.symbol;const D=g.hash;for(const E of C)if(D===E.hash&&Math.abs(G-E.xTile)<=c&&Math.abs(w-E.yTile)<=c){l=E.unique;g.unique=l;l.tileSymbols.push(g);l=!0;break}l||f.push(g)}}0<f.length&&b.set(p,f)}for(const p of d.childrenTiles)this._matchSymbols(p,
e,b)}}_createUniqueSymbolLayerArray(){var d=this._uniqueSymbolsReferences;const e=Array(d.size);let f=0;for(const [c,b]of d){const g=Array(b.size);d=0;for(const l of b)g[d++]=l;e[f]={styleLayerUID:c,uniqueSymbols:g};f++}return e}}y.SymbolRepository=B;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(y,z,B){class d extends B.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:z.create(),
tileMat3:z.create()}}}y.RenderableTile=d;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileFeatureIndex":function(){define("../../../../Graphic ../../../../core/MapUtils ../../../../core/pbf ../../../../core/libs/rbush/PooledRBush ./enums ./Feature ./GeometryUtils ./SourceLayerData ./style/StyleLayer".split(" "),function(y,z,B,d,e,f,c,b,g){const l=(k,q)=>{const r=k.vtlSymbol.sourceTile,C=q.vtlSymbol.sourceTile;return r.level!==C.level?r.level-
C.level:r.row!==C.row?r.row-C.row:r.col!==C.col?r.col-C.col:k.styleLayerUID-q.styleLayerUID};class p{constructor(k,q,r,C,G){this.tileKey=k;this._tileHandler=this._styleRepository=this._index=null;this._tileKeyToPBF=new Map;this._tileLayerData=q;this._styleRepository=r;this._tileHandler=C;this._parentLayer=G}static create(k,q,r,C,G){return new p(k,q,r,C,G)}clear(){this._index?.clear();this._tileKeyToPBF.clear()}async queryAttributes(k,q,r,C,G){if(0===this._tileLayerData.size||!this._styleRepository||
!this._tileHandler)return[];null===this._index&&(this._index=new d.PooledRBush(100,t),await this._indexLayers());const w=[];this._queryIndex(w,k,q,r,this.tileKey.level,C);G&&0<G?.length&&await this._getSymbolsAttributes(w,G);return w}async _indexLayers(){const k=this.tileKey,q=this._styleRepository.layers,r=await this._getTilePayload(k);for(const [G,w]of this._tileLayerData){const D=q[G];var C=r.find(L=>L.sourceName===D.source);if(!C)continue;const {protobuff:E,key:H}=C;w.type!==e.BucketType.SYMBOL&&
(C=1<<k.level-H.level,this._indexLayer(D,E,k.level,C,k.row-H.row*C,k.col-H.col*C))}}_indexLayer(k,q,r,C,G,w){const D=k.sourceLayer,E=k.getFeatureFilter(),H=r+1,L=c.getTileMargins(r);for(q=new B(new Uint8Array(q),new DataView(q));q.next();)switch(q.tag()){case 3:var O=q.getMessage();const u=new b(O);O.release();if(u.name!==D)continue;O=u.getData();var h=u.extent/C;const A=h*w-L,I=h*G-L,K=A+h+2*L,N=I+h+2*L,J=h/512,Q=4096/h,R=h*w;for(h*=G;O.nextTag(2);){var n=O.getMessage();const V=new f(n,u);n.release();
if(!E||E.filter(V,r)){var m=V.values||{};n=m._minzoom;m=m._maxzoom;n&&n>=10*H||m&&m<=10*r||(n=k.getFeatureInflatedBounds(V,r,u.extent,J),null==n||n[0]>K||n[1]>N||n[2]<A||n[3]<I||(n[0]=(n[0]-R)*Q,n[1]=(n[1]-h)*Q,n[2]=(n[2]-R)*Q,n[3]=(n[3]-h)*Q,this._index.insert(new g.IndexItem(k,V,n,Q,R,h))))}}break;default:q.skip()}}async _getSymbolsAttributes(k,q){if(!q||0===q.length)return k;var r=[];q.sort(l);let C=q[0].styleLayerUID;var G=0;for(var w=0;w<q.length;w++)C!==q[w].styleLayerUID&&(r.push({from:G,to:w,
styleLayerUID:C,sourceTileKey:q[w].vtlSymbol.sourceTile}),G=w,C=q[w].styleLayerUID);r.push({from:G,to:q.length,styleLayerUID:C,sourceTileKey:q[q.length-1].vtlSymbol.sourceTile});G=this._styleRepository.layers;w=null;let D;for(const E of r)r=await this._getTilePayload(E.sourceTileKey),D=G[E.styleLayerUID],(w=!!D&&r.find(H=>H.sourceName===D.source))&&this._addSymbolsAttributes(k,q.slice(E.from,E.to).map(H=>H.vtlSymbol),C,w);return k}_addSymbolsAttributes(k,q,r,C){const G=this._styleRepository.layers,
w=C.key,D=this.tileKey,E=1<<D.level-w.level;this._getSymbolAttributes(C.protobuff,q,r,E,D.row-w.row*E,D.col-w.col*E).forEach(H=>{const {attributes:L,tilePoint:O}=H;k.push({layerId:G[r].id,layerIndex:r,graphic:new y({attributes:L,origin:{type:"vector-tile",layerId:G[r].id,layerIndex:r,layer:this._parentLayer}}),tilePoint:O})})}_getSymbolAttributes(k,q,r,C,G,w){const D=[],E=this._styleRepository.layers;let H=0;q.sort((n,m)=>n.featureIndex-m.featureIndex);for(k=new B(new Uint8Array(k),new DataView(k));k.next();)switch(k.tag()){case 3:var L=
k.getMessage();const n=new b(L);L.release();if(n.name!==E[r].sourceLayer)continue;L=n.getData();var O=n.extent/C;const m=4096/O,u=O*w;O*=G;let A=0;for(;L.nextTag(2);){const I=L.getMessage();if(A++===q[H].featureIndex){var h=new f(I,n);const K=h.values;h=h.getGeometry();D.push({attributes:K,tilePoint:null!=h?[m*(h[0][0].x-u),m*(h[0][0].y-O)]:null});H++}I.release();if(H===q.length)return D}break;default:k.skip()}return D}_queryIndex(k,q,r,C,G,w){const D=8*C*(window.devicePixelRatio||1);this._index?.search({minX:q-
D,minY:r-D,maxX:q+D,maxY:r+D},E=>{const {layer:H,feature:L}=E;H.isIntersectingFeature(q,r,C,L,G,w,E)&&k.push({layerId:H.id,layerIndex:H.uid,tilePoint:null,graphic:new y({attributes:L.values,origin:{type:"vector-tile",layerId:E.layer.id,layerIndex:E.layer.uid,layer:this._parentLayer}})})});return k}async _getTilePayload(k){return z.getOrCreateMapValue(this._tileKeyToPBF,k.id,()=>this._tileHandler.fetchTilePBFs(k)).then(q=>q)}}const t=k=>({minX:k.bounds[0],minY:k.bounds[1],maxX:k.bounds[2],maxY:k.bounds[3]});
return p})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../PooledArray","../../../chunks/quickselect"],function(y,z,B,d){function e(h,n){f(h,0,h.children.length,n,h)}function f(h,n,m,u,A){A||=new L([]);A.minX=Infinity;A.minY=Infinity;A.maxX=-Infinity;A.maxY=-Infinity;for(let I=n,K;I<m;I++)K=h.children[I],c(A,h.leaf?u(K):K);return A}function c(h,n){h.minX=Math.min(h.minX,n.minX);h.minY=Math.min(h.minY,n.minY);h.maxX=Math.max(h.maxX,n.maxX);h.maxY=Math.max(h.maxY,
n.maxY)}function b(h,n){return h.minX-n.minX}function g(h,n){return h.minY-n.minY}function l(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function p(h){return h.maxX-h.minX+(h.maxY-h.minY)}function t(h,n){return h.minX<=n.minX&&h.minY<=n.minY&&n.maxX<=h.maxX&&n.maxY<=h.maxY}function k(h,n){return n.minX<=h.maxX&&n.minY<=h.maxY&&n.maxX>=h.minX&&n.maxY>=h.minY}function q(h,n,m,u,A){for(n=[n,m];n.length;){m=n.pop();const I=n.pop();if(m-I<=u)continue;const K=I+Math.ceil((m-I)/u/2)*u;d.quickselect(h,K,I,m,
A);n.push(I,K,K,m)}}class r{constructor(h=9,n){this._compareMinX=b;this._compareMinY=g;this._toBBox=m=>m;this._maxEntries=Math.max(4,h||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));n&&("function"===typeof n?this._toBBox=n:this._initFormat(n));this.clear()}destroy(){this.clear();C.prune();G.prune();w.prune();D.prune()}all(h){this._all(this._data,h)}search(h,n){let m=this._data;const u=this._toBBox;if(k(h,m))for(C.clear();m;){for(let A=0,I=m.children.length;A<I;A++){const K=m.children[A],
N=m.leaf?u(K):K;k(h,N)&&(m.leaf?n(K):t(h,N)?this._all(K,n):C.push(K))}m=C.pop()}}collides(h){let n=this._data;const m=this._toBBox;if(!k(h,n))return!1;for(C.clear();n;){for(let u=0,A=n.children.length;u<A;u++){const I=n.children[u],K=n.leaf?m(I):I;if(k(h,K)){if(n.leaf||t(h,K))return!0;C.push(I)}}n=C.pop()}return!1}load(h){if(!h.length)return this;if(h.length<this._minEntries){for(let n=0,m=h.length;n<m;n++)this.insert(h[n]);return this}h=this._build(h.slice(0,h.length),0,h.length-1,0);if(this._data.children.length)if(this._data.height===
h.height)this._splitRoot(this._data,h);else{if(this._data.height<h.height){const n=this._data;this._data=h;h=n}this._insert(h,this._data.height-h.height-1,!0)}else this._data=h;return this}insert(h){h&&this._insert(h,this._data.height-1);return this}clear(){this._data=new L([]);return this}remove(h){if(!h)return this;let n=this._data,m=null,u=0,A=!1,I;const K=this._toBBox(h);w.clear();for(D.clear();n||0<w.length;){n||(n=w.pop(),m=w.data[w.length-1],u=D.pop()??0,A=!0);if(n.leaf&&(I=z.indexOf(n.children,
h,n.children.length,n.indexHint),-1!==I)){n.children.splice(I,1);w.push(n);this._condense(w);break}A||n.leaf||!t(n,K)?m?(u++,n=m.children[u],A=!1):n=null:(w.push(n),D.push(u),u=0,m=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(h){this._data=h;return this}_all(h,n){for(G.clear();h;){if(!0===h.leaf)for(const m of h.children)n(m);else G.pushArray(h.children);h=G.pop()??null}}_build(h,n,m,u){var A=m-n+1,I=this._maxEntries;if(A<=I)return h=new L(h.slice(n,m+1)),e(h,this._toBBox),h;
u||(u=Math.ceil(Math.log(A)/Math.log(I)),I=Math.ceil(A/I**(u-1)));const K=new O([]);K.height=u;A=Math.ceil(A/I);I=A*Math.ceil(Math.sqrt(I));for(q(h,n,m,I,this._compareMinX);n<=m;n+=I){const N=Math.min(n+I-1,m);q(h,n,N,A,this._compareMinY);for(let J=n;J<=N;J+=A)K.children.push(this._build(h,J,Math.min(J+A-1,N),u-1))}e(K,this._toBBox);return K}_chooseSubtree(h,n,m,u){for(;;){u.push(n);if(!0===n.leaf||u.length-1===m)break;let A=Infinity,I=Infinity,K=void 0;for(let N=0,J=n.children.length;N<J;N++){const Q=
n.children[N],R=l(Q),V=(Math.max(Q.maxX,h.maxX)-Math.min(Q.minX,h.minX))*(Math.max(Q.maxY,h.maxY)-Math.min(Q.minY,h.minY))-R;V<I?(I=V,A=R<A?R:A,K=Q):V===I&&R<A&&(A=R,K=Q)}n=K||n.children[0]}return n}_insert(h,n,m){var u=this._toBBox;m=m?h:u(h);w.clear();u=this._chooseSubtree(m,this._data,n,w);u.children.push(h);for(c(u,m);0<=n;)if(w.data[n].children.length>this._maxEntries)this._split(w,n),n--;else break;this._adjustParentBBoxes(m,w,n)}_split(h,n){const m=h.data[n];var u=m.children.length;const A=
this._minEntries;this._chooseSplitAxis(m,A,u);(u=this._chooseSplitIndex(m,A,u))?(u=m.children.splice(u,m.children.length-u),u=m.leaf?new L(u):new O(u),u.height=m.height,e(m,this._toBBox),e(u,this._toBBox),n?h.data[n-1].children.push(u):this._splitRoot(m,u)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(h,n){this._data=new O([h,n]);this._data.height=h.height+1;e(this._data,this._toBBox)}_chooseSplitIndex(h,n,m){let u,A,I=void 0;u=A=Infinity;for(let N=
n;N<=m-n;N++){var K=f(h,0,N,this._toBBox);const J=f(h,N,m,this._toBBox),Q=Math.max(0,Math.min(K.maxX,J.maxX)-Math.max(K.minX,J.minX))*Math.max(0,Math.min(K.maxY,J.maxY)-Math.max(K.minY,J.minY));K=l(K)+l(J);Q<u?(u=Q,I=N,A=K<A?K:A):Q===u&&K<A&&(A=K,I=N)}return I}_chooseSplitAxis(h,n,m){const u=h.leaf?this._compareMinX:b,A=h.leaf?this._compareMinY:g,I=this._allDistMargin(h,n,m,u);n=this._allDistMargin(h,n,m,A);I<n&&h.children.sort(u)}_allDistMargin(h,n,m,u){h.children.sort(u);u=this._toBBox;var A=f(h,
0,n,u);const I=f(h,m-n,m,u);let K=p(A)+p(I);for(let N=n;N<m-n;N++){const J=h.children[N];c(A,h.leaf?u(J):J);K+=p(A)}for(m=m-n-1;m>=n;m--)A=h.children[m],c(I,h.leaf?u(A):A),K+=p(I);return K}_adjustParentBBoxes(h,n,m){for(;0<=m;m--)c(n.data[m],h)}_condense(h){for(let n=h.length-1;0<=n;n--){const m=h.data[n];if(0===m.children.length)if(0<n){const u=h.data[n-1],A=u.children;A.splice(z.indexOf(A,m,A.length,u.indexHint),1)}else this.clear();else e(m,this._toBBox)}}_initFormat(h){const n=["return a"," - b",
";"];this._compareMinX=new Function("a","b",n.join(h[0]));this._compareMinY=new Function("a","b",n.join(h[1]));this._toBBox=new Function("a","return {minX: a"+h[0]+", minY: a"+h[1]+", maxX: a"+h[2]+", maxY: a"+h[3]+"};")}}const C=new B,G=new B,w=new B,D=new B({deallocator:void 0});class E{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class H extends E{constructor(){super(...arguments);this.height=1;this.indexHint=new z.PositionHint}}class L extends H{constructor(h){super();
this.children=h;this.leaf=!0}}class O extends H{constructor(h){super();this.children=h;this.leaf=!1}}y.BBox=E;y.PooledRBush=r;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/Feature":function(){define(["../../../../geometry/support/TileClipper"],function(y){var z;(function(d){d[d.moveTo=1]="moveTo";d[d.lineTo=2]="lineTo";d[d.close=7]="close"})(z||={});class B{constructor(d,e,f=0){this.values={};this._geometry=void 0;this._pbfGeometry=null;this.featureIndex=
f;f=e.keys;e=e.values;for(d=d.asUnsafe();d.next();)switch(d.tag()){case 1:this.id=d.getUInt64();break;case 2:const c=d.getMessage().asUnsafe(),b=this.values;for(;!c.empty();){const g=c.getUInt32(),l=c.getUInt32();b[f[g]]=e[l]}c.release();break;case 3:this.type=d.getUInt32();break;case 4:this._pbfGeometry=d.getMessage();break;default:d.skip()}}getGeometry(d){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const e=this._pbfGeometry.asUnsafe();this._pbfGeometry=null;
let f,c;d?d.reset(this.type):f=[];let b=z.moveTo;var g=0;let l=0,p=0;for(;!e.empty();)switch(0===g&&(g=e.getUInt32(),b=g&7,g>>=3),g--,b){case z.moveTo:l+=e.getSInt32();p+=e.getSInt32();d?d.moveTo(l,p):f&&(c&&f.push(c),c=[],c.push(new y.Point(l,p)));break;case z.lineTo:l+=e.getSInt32();p+=e.getSInt32();d?d.lineTo(l,p):c&&c.push(new y.Point(l,p));break;case z.close:d?d.close():c&&!c[0].equals(l,p)&&c.push(c[0].clone());break;default:throw e.release(),Error("Invalid path operation");}let t;d?t=d.result():
f&&(c&&f.push(c),t=f);e.release();return this._geometry=t}}return B})},"esri/views/2d/engine/vectorTiles/SourceLayerData":function(){define(function(){class y{constructor(z){this.extent=4096;this.keys=[];this.values=[];this._pbfLayer=z.clone();for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:this.name=z.getString();break;case 3:this.keys.push(z.getString());break;case 4:this.values.push(z.processMessage(y._parseValue));break;case 5:this.extent=z.getUInt32();break;default:z.skip()}}getData(){return this._pbfLayer}static _parseValue(z){for(;z.next();)switch(z.tag()){case 1:return z.getString();
case 2:return z.getFloat();case 3:return z.getDouble();case 4:return z.getInt64();case 5:return z.getUInt64();case 6:return z.getSInt64();case 7:return z.getBool();default:z.skip()}return null}}return y})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(y,z,B,d,e,f,c,b,g,l,p,t,k){function q(h){h=h?.getGeometry();if(null==h)return null;let n=Infinity,m=Infinity,u=-Infinity,A=-Infinity;for(const I of h)if(I)for(const K of I)n=Math.min(n,K.x),m=Math.min(m,K.y),u=Math.max(u,K.x),A=Math.max(A,K.y);return z.fromValues(n,m,u,A)}y.CapType=void 0;(function(h){h[h.BUTT=0]="BUTT";h[h.ROUND=1]="ROUND";h[h.SQUARE=2]="SQUARE";h[h.UNKNOWN=4]="UNKNOWN"})(y.CapType||(y.CapType={}));class r{constructor(h,n,m,u,A,I){this.layer=h;this.feature=n;this.bounds=
m;this.normalizationRatio=u;this.normalizationOffsetX=A;this.normalizationOffsetY=I}}class C{constructor(h,n,m,u){this.type=h;this.typeName=n.type;this.id=n.id;this.source=n.source;this.sourceLayer=n["source-layer"];this.minzoom=n.minzoom;this.maxzoom=n.maxzoom;this.filter=n.filter;this.layout=n.layout;this.paint=n.paint;this.z=m;this.uid=u;switch(h){case p.StyleLayerType.BACKGROUND:this._layoutDefinition=p.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=p.StyleDefinition.backgroundPaintDefinition;
break;case p.StyleLayerType.FILL:this._layoutDefinition=p.StyleDefinition.fillLayoutDefinition;this._paintDefinition=p.StyleDefinition.fillPaintDefinition;break;case p.StyleLayerType.LINE:this._layoutDefinition=p.StyleDefinition.lineLayoutDefinition;this._paintDefinition=p.StyleDefinition.linePaintDefinition;break;case p.StyleLayerType.SYMBOL:this._layoutDefinition=p.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=p.StyleDefinition.symbolPaintDefinition;break;case p.StyleLayerType.CIRCLE:this._layoutDefinition=
p.StyleDefinition.circleLayoutDefinition,this._paintDefinition=p.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=l.createFilter(this.filter)}getLayoutProperty(h){return this._layoutProperties[h]}getPaintProperty(h){return this._paintProperties[h]}getLayoutValue(h,n,m){let u;const A=this._layoutProperties[h];A&&
(u=A.getValue(n,m));void 0===u&&(u=this._layoutDefinition[h]["default"]);return u}getPaintValue(h,n,m){let u;const A=this._paintProperties[h];A&&(u=A.getValue(n,m));void 0===u&&(u=this._paintDefinition[h]["default"]);return u}isPainterDataDriven(){const h=this._paintProperties;if(h)for(const n in h)if(h[n].isDataDriven)return!0;return!1}isIntersectingFeature(h,n,m,u,A,I,K){return!1}getFeatureInflatedBounds(h,n,m,u){return null}_parseLayout(h){const n={};for(const m in h){const u=this._layoutDefinition[m];
u&&(n[m]=new t(u,h[m]))}return n}_parsePaint(h){const n={};for(const m in h){const u=this._paintDefinition[m];u&&(n[m]=new t(u,h[m]))}return n}computeAttributesKey(h,n,m,u){let A=0,I=0;for(const K of n){n=3;if(!K||K!==u){const {isLayout:N,isOptional:J}=m[K];n=N?this.getLayoutProperty(K):this.getPaintProperty(K);n=n?.interpolator?2:n?.isDataDriven?1:J&&!n?3:0}I|=n<<A;A+=2}return I<<3|h}}class G extends C{constructor(h,n,m,u){super(h,n,m,u);this.backgroundMaterial=new e.VTLBackgroundMaterial(this.computeAttributesKey(B.ShaderProgramType.BACKGROUND,
e.VTLBackgroundMaterial.ATTRIBUTES,e.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class w extends C{constructor(h,n,m,u){super(h,n,m,u);h=this.getPaintProperty("fill-color");n=this.getPaintProperty("fill-opacity");m=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=h?.isDataDriven;this.hasDataDrivenOpacity=n?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||m?.isDataDriven;n=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!n;this.hasDataDrivenOutlineColor=
n?.isDataDriven;this.hasDataDrivenOutline=n?n.isDataDriven:h?h.isDataDriven:!1;this.hasDataDrivenOutline=(n?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new c.VTLFillMaterial(this.computeAttributesKey(B.ShaderProgramType.FILL,c.VTLFillMaterial.ATTRIBUTES,c.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new c.VTLOutlineMaterial(this.computeAttributesKey(B.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_FILL:
c.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:c.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(h,n,m,u){m=q(h);if(!m)return null;h=this.getPaintValue("fill-translate",n,h);u*=Math.max(h[0],h[1]);m[0]-=u;m[2]-=u;m[1]+=u;m[3]+=u;return m}isIntersectingFeature(h,n,m,u,A,I,K){const N=u.getGeometry();if(!N)return!1;const J=8/K.normalizationRatio;h=h/K.normalizationRatio+K.normalizationOffsetX;
n=n/K.normalizationRatio+K.normalizationOffsetY;u=d.translateAnchor(this.getPaintValue("fill-translate",A,u),this.getPaintValue("fill-translate-anchor",A,u),I,8);h-=J*u.x;n-=J*u.y;return d.pointInPolygon(h,n,N)?!0:d.distanceFromToPolylineWithinThreshold(h,n,N,J*m)}}class D extends C{constructor(h,n,m,u){super(h,n,m,u);h=this.getPaintProperty("line-pattern");this.lineMaterial=new b.VTLLineMaterial(this.computeAttributesKey(B.ShaderProgramType.LINE,b.VTLLineMaterial.ATTRIBUTES,b.VTLLineMaterial.ATTRIBUTES_INFO,
h?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;
this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(h=this.getPaintProperty("line-width"),!h||"number"===typeof h&&.5*h<k.thinLineHalfWidthThreshold)&&(h=this.getPaintProperty("line-offset"),!h||"number"===typeof h&&0===h)&&(this.canUseThinTessellation=!0)}getDashKey(h,n){switch(n){case y.CapType.BUTT:n="Butt";break;case y.CapType.ROUND:n="Round";break;case y.CapType.SQUARE:n="Square";break;default:n="Butt"}return`dasharray-[${h.toString()}]-${n}`}getFeatureInflatedBounds(h,n,m,u){m=q(h);if(!m)return null;
var A=this.getPaintValue("line-translate",n,h);A=u*Math.max(A[0],A[1]);m[0]-=A;m[2]-=A;m[1]+=A;m[3]+=A;A=u*Math.abs(this.getPaintValue("line-offset",n,h)||0);h=this.getPaintValue("line-width",n,h);u*=h/2;m[0]-=A+u;m[1]-=A+u;m[2]+=A+u;m[3]+=A+u;return m}isIntersectingFeature(h,n,m,u,A,I,K){let N=u.getGeometry();if(!N)return!1;const J=8/K.normalizationRatio;h=h/K.normalizationRatio+K.normalizationOffsetX;n=n/K.normalizationRatio+K.normalizationOffsetY;I=d.translateAnchor(this.getPaintValue("line-translate",
A,u),this.getPaintValue("line-translate-anchor",A,u),I,8);h-=J*I.x;n-=J*I.y;I=J*this.getPaintValue("line-offset",A,u)||0;0!==I&&(N=d.offsetLine(N,-I));u=this.getPaintValue("line-width",A,u);return d.distanceFromToPolylineWithinThreshold(h,n,N,J*(m+u/2))}}class E extends C{constructor(h,n,m,u){super(h,n,m,u);this.iconMaterial=new g.VTLIconMaterial(this.computeAttributesKey(B.ShaderProgramType.ICON,g.VTLIconMaterial.ATTRIBUTES,g.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new g.VTLTextMaterial(this.computeAttributesKey(B.ShaderProgramType.TEXT,
g.VTLTextMaterial.ATTRIBUTES,g.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class H extends C{constructor(h,n,m,u){super(h,n,m,u);this.circleMaterial=new f.VTLCircleMaterial(this.computeAttributesKey(B.ShaderProgramType.CIRCLE,f.VTLCircleMaterial.ATTRIBUTES,f.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(h,n,m,u){m=q(h);if(!m)return null;var A=
this.getPaintValue("circle-translate",n,h);A=Math.max(A[0],A[1]);m[0]-=A;m[2]-=A;m[1]+=A;m[3]+=A;h=8*(this.getPaintValue("circle-radius",n,h)+this.getPaintValue("circle-stroke-width",n,h));u*=h/2;m[0]-=u;m[1]-=u;m[2]+=u;m[3]+=u;return m}isIntersectingFeature(h,n,m,u,A,I,K){var N=u.getGeometry();if(!N)return!1;const J=8/K.normalizationRatio;h=h/K.normalizationRatio+K.normalizationOffsetX;n=n/K.normalizationRatio+K.normalizationOffsetY;m*=J;I=d.translateAnchor(this.getPaintValue("circle-translate",
A,u),this.getPaintValue("circle-translate-anchor",A,u),I,J);u=J*(this.getPaintValue("circle-radius",A,u)+this.getPaintValue("circle-stroke-width",A,u));for(const Q of N)if(Q)for(const R of Q)if(N=R.x+I.x,A=R.y+I.y,Math.sqrt((h-N)*(h-N)+(n-A)*(n-A))-m<=u)return!0;return!1}}class L{constructor(h,n,m){this.allowOverlap=h.getLayoutValue("icon-allow-overlap",n);this.ignorePlacement=h.getLayoutValue("icon-ignore-placement",n);this.keepUpright=h.getLayoutValue("icon-keep-upright",n);this.optional=h.getLayoutValue("icon-optional",
n);this.rotationAlignment=h.getLayoutValue("icon-rotation-alignment",n);this.rotationAlignment===p.RotationAlignment.AUTO&&(this.rotationAlignment=m?p.RotationAlignment.MAP:p.RotationAlignment.VIEWPORT);m=h.getLayoutProperty("icon-anchor");m?.isDataDriven?this._anchorProp=m:this.anchor=h.getLayoutValue("icon-anchor",n);m=h.getLayoutProperty("icon-offset");m?.isDataDriven?this._offsetProp=m:this.offset=h.getLayoutValue("icon-offset",n);m=h.getLayoutProperty("icon-padding");m?.isDataDriven?this._paddingProp=
m:this.padding=h.getLayoutValue("icon-padding",n);m=h.getLayoutProperty("icon-rotate");m?.isDataDriven?this._rotateProp=m:this.rotate=h.getLayoutValue("icon-rotate",n);m=h.getLayoutProperty("icon-size");m?.isDataDriven?this._sizeProp=m:this.size=h.getLayoutValue("icon-size",n)}update(h,n){this._anchorProp&&(this.anchor=this._anchorProp.getValue(h,n));this._offsetProp&&(this.offset=this._offsetProp.getValue(h,n));this._paddingProp&&(this.padding=this._paddingProp.getValue(h,n));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(h,n));this._sizeProp&&(this.size=this._sizeProp.getValue(h,n))}}class O{constructor(h,n,m){this.allowOverlap=h.getLayoutValue("text-allow-overlap",n);this.ignorePlacement=h.getLayoutValue("text-ignore-placement",n);this.keepUpright=h.getLayoutValue("text-keep-upright",n);this.optional=h.getLayoutValue("text-optional",n);this.rotationAlignment=h.getLayoutValue("text-rotation-alignment",n);this.rotationAlignment===p.RotationAlignment.AUTO&&(this.rotationAlignment=m?p.RotationAlignment.MAP:
p.RotationAlignment.VIEWPORT);m=h.getLayoutProperty("text-anchor");m?.isDataDriven?this._anchorProp=m:this.anchor=h.getLayoutValue("text-anchor",n);m=h.getLayoutProperty("text-justify");m?.isDataDriven?this._justifyProp=m:this.justify=h.getLayoutValue("text-justify",n);m=h.getLayoutProperty("text-letter-spacing");m?.isDataDriven?this._letterSpacingProp=m:this.letterSpacing=h.getLayoutValue("text-letter-spacing",n);m=h.getLayoutProperty("text-line-height");m?.isDataDriven?this._lineHeightProp=m:this.lineHeight=
h.getLayoutValue("text-line-height",n);m=h.getLayoutProperty("text-max-angle");m?.isDataDriven?this._maxAngleProp=m:this.maxAngle=h.getLayoutValue("text-max-angle",n);m=h.getLayoutProperty("text-max-width");m?.isDataDriven?this._maxWidthProp=m:this.maxWidth=h.getLayoutValue("text-max-width",n);m=h.getLayoutProperty("text-offset");m?.isDataDriven?this._offsetProp=m:this.offset=h.getLayoutValue("text-offset",n);m=h.getLayoutProperty("text-padding");m?.isDataDriven?this._paddingProp=m:this.padding=h.getLayoutValue("text-padding",
n);m=h.getLayoutProperty("text-rotate");m?.isDataDriven?this._rotateProp=m:this.rotate=h.getLayoutValue("text-rotate",n);m=h.getLayoutProperty("text-size");m?.isDataDriven?this._sizeProp=m:this.size=h.getLayoutValue("text-size",n);m=h.getLayoutProperty("text-writing-mode");m?.isDataDriven?this._writingModeProp=m:this.writingMode=h.getLayoutValue("text-writing-mode",n)}update(h,n){this._anchorProp&&(this.anchor=this._anchorProp.getValue(h,n));this._justifyProp&&(this.justify=this._justifyProp.getValue(h,
n));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(h,n));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(h,n));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(h,n));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(h,n));this._offsetProp&&(this.offset=this._offsetProp.getValue(h,n));this._paddingProp&&(this.padding=this._paddingProp.getValue(h,n));this._rotateProp&&(this.rotate=this._rotateProp.getValue(h,n));this._sizeProp&&
(this.size=this._sizeProp.getValue(h,n));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(h,n))}}y.BackgroundStyleLayer=G;y.CircleStyleLayer=H;y.FillStyleLayer=w;y.IconLayout=L;y.IndexItem=r;y.LineStyleLayer=D;y.StyleLayer=C;y.SymbolStyleLayer=E;y.TextLayout=O;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(y,z,B,d){class e extends z.VTLMaterial{constructor(f){super(f)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES=[];e.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,B.DataType.BYTE,0,2)];e.ATTRIBUTES_INFO={};y.VTLBackgroundMaterial=e;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,B,d,e){class f{constructor(g){this._locations=new Map;this._key=g}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(g,l,p,t,k){var q=this.getUniforms();for(const r of q){const {name:C,type:G,getValue:w}=r;q=w(p,l,t,k);if(null!==q)switch(G){case "float":g.setUniform1f(C,q);break;case "vec2":g.setUniform2fv(C,
q);break;case "vec4":g.setUniform4fv(C,q)}}}encodeAttributes(g,l,p,t){const k=this.attributesInfo(),q=this.getEncodingInfos(),r=[];let C=0,G=0;for(const D of Object.keys(q)){var w=q[D];const {type:E,precisionFactor:H,isLayout:L}=k[D],O=L?p.getLayoutProperty(D):p.getPaintProperty(D),h=O.interpolator?.getInterpolationRange(l);let n=0;for(const m of w){const {offset:u,bufferElementsToAdd:A}=m;if(0<A){for(w=0;w<A;w++)r.push(0);C+=G;G=m.bufferElementsToAdd}w=t??O.getValue(h?h[n]:l,g);switch(E){case B.EncodingType.R8_SIGNED:case B.EncodingType.R8_UNSIGNED:r[C]|=
this._encodeByte(w*(H||1),8*u);break;case B.EncodingType.R16_SIGNED:case B.EncodingType.R16_UNSIGNED:r[C]|=this._encodeShort(w*(H||1),8*u);break;case B.EncodingType.R8G8_SIGNED:case B.EncodingType.R8G8_UNSIGNED:r[C]|=this._encodeByte(w*(H||1),8*u);r[C]|=this._encodeByte(w*(H||1),8*u+8);break;case B.EncodingType.R16G16_SIGNED:case B.EncodingType.R16G16_UNSIGNED:r[C]|=this._encodeShort(w*(H||1),8*u);r[C]|=this._encodeShort(w*(H||1),8*u+16);break;case B.EncodingType.R8G8B8A8_SIGNED:case B.EncodingType.R8G8B8A8_UNSIGNED:r[C]|=
this._encodeByte(w*(H||1),8*u);r[C]|=this._encodeByte(w*(H||1),8*u+8);r[C]|=this._encodeByte(w*(H||1),8*u+16);r[C]|=this._encodeByte(w*(H||1),8*u+24);break;case B.EncodingType.R8G8B8A8_COLOR:r[C]=this._encodeColor(w);break;case B.EncodingType.R16G16B16A16_DASHARRAY:case B.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(C,r,w);break;default:throw Error("Unsupported encoding type");}n++}}return r}getAtributeState(g){const l=3+2*g;g=0|this._bit(l);return g|=this._bit(l+1)<<1}_buildAttributesInfo(){const g=
[],l={};var p={},t=-1;const k=this.attributesInfo();var q=this.attributes();let r=-1;for(const D of q){r++;q=this.getAtributeState(r);if(q===B.AttributeStatus.UNIFORM||q===B.AttributeStatus.UNUSED)continue;var C=k[D];const E=[];l[D]=E;C=C.type;for(let H=0;H<q;H++){const {dataType:L,bytesPerElement:O,count:h,normalized:n}=f._encodingInfo[C],m=O*h;var G=`${L}-${!0===n}`;let u=p[G],A=0;!u||4<u.count+h?(t++,u={dataIndex:t,count:0,offset:0},4!==h&&(p[G]=u),g.push({location:-1,name:"a_data_"+t,count:h,
type:L,normalized:n}),A=Math.ceil(Math.max(m/4,1))):(G=g[u.dataIndex],G.count+=h,A=Math.ceil(Math.max(G.count*O/4,1))-Math.ceil(Math.max(u.offset/4,1)));E.push({dataIndex:u.dataIndex,offset:u.offset,bufferElementsToAdd:A});u.offset+=m;u.count+=h}}for(const D of g)switch(D.type){case d.DataType.BYTE:case d.DataType.UNSIGNED_BYTE:D.count=4;break;case d.DataType.SHORT:case d.DataType.UNSIGNED_SHORT:D.count+=D.count%2}this._buildVertexBufferLayout(g);p=0;t=this._layoutInfo.geometry;for(var w of t)this._locations.set(w.name,
p++);if(w=this._layoutInfo.opacity)for(const D of w)this._locations.set(D.name,p++);this._buildShaderInfo(g,l);this._propertyEncodingInfo=l}_buildVertexBufferLayout(g){const l={},p=this.geometryInfo();let t=p[0].stride;if(0===g.length)l.geometry=p;else{const k=[];let q=t;for(const r of g)t+=c(r.type)*r.count;for(const r of p)k.push(new e.VertexElementDescriptor(r.name,r.count,r.type,r.offset,t,r.normalized));for(const r of g)k.push(new e.VertexElementDescriptor(r.name,r.count,r.type,q,t,r.normalized)),
q+=c(r.type)*r.count;l.geometry=k}this.opacityInfo()&&(l.opacity=this.opacityInfo());this._layoutInfo=l;this._stride=t}_buildShaderInfo(g,l){let p="\n",t="\n";const k=[];for(var q of g)p+=`attribute ${this._getType(q.count)} ${q.name};\n`;var r=this.attributes();g=this.attributesInfo();q=-1;for(const w of r){q++;const {name:D,type:E,precisionFactor:H,isLayout:L}=g[w];r=H&&1!==H?` * ${1/H}`:"";const {bytesPerElement:O,count:h}=f._encodingInfo[E];var C=n=>`a_data_${n.dataIndex}${b(h,n.offset,O)}`;switch(this.getAtributeState(q)){case B.AttributeStatus.UNIFORM:r=
this._getType(h);var G=`u_${D}`;k.push({name:G,type:r,getValue:(m,u,A,I)=>{A=L?m.getLayoutValue(w,u):m.getPaintValue(w,u);if(E===B.EncodingType.R16G16B16A16_DASHARRAY){m=m.getDashKey(A,m.getLayoutValue("line-cap",u));I=I.getMosaicItemPosition(m,!1);if(null==I)return null;const {tl:K,br:N}=I;return[K[0],N[1],N[0],K[1]]}if(E===B.EncodingType.R16G16B16A16_PATTERN){I=I.getMosaicItemPosition(A,!w.includes("line-"));if(null==I)return null;const {tl:K,br:N}=I;return[K[0],N[1],N[0],K[1]]}return E===B.EncodingType.R8G8B8A8_COLOR?
(I=A[3],[I*A[0],I*A[1],I*A[2],I]):A}});p+=`uniform ${r} ${G};\n`;t+=`${r} ${D} = ${G};\n`;break;case B.AttributeStatus.DATA_DRIVEN:G=C(l[w][0]);t+=`${this._getType(h)} ${D} = ${G}${r};\n`;break;case B.AttributeStatus.INTERPOLATED_DATA_DRIVEN:G=`u_t_${D}`;k.push({name:G,type:"float",getValue:(m,u,A,I)=>(L?m.getLayoutProperty(w):m.getPaintProperty(w)).interpolator.interpolationUniformValue(A,u)});p+=`uniform float ${G};\n`;const n=C(l[w][0]);C=C(l[w][1]);t+=`${this._getType(h)} ${D} = mix(${n}${r}, ${C}${r}, ${G});\n`}}this._shaderHeader=
p;this._shaderMain=t;this._uniforms=k}_bit(g){return(this._key&1<<g)>>g}_getType(g){switch(g){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(g){const l=255*g[3];return z.i8888to32(g[0]*l,g[1]*l,g[2]*l,l)}_encodePattern(g,l,p){if(p?.rect){var t=p.rect,k=p.width;p=p.height;l[g]=this._encodeShort(t.x+2,0);l[g]|=this._encodeShort(t.y+2+p,16);l[g+1]=this._encodeShort(t.x+2+k,0);l[g+1]|=this._encodeShort(t.y+2,16)}}_encodeByte(g,
l){return(g&255)<<l}_encodeShort(g,l){return(g&65535)<<l}}f._encodingInfo={[B.EncodingType.R8_SIGNED]:{dataType:d.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[B.EncodingType.R8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[B.EncodingType.R16_SIGNED]:{dataType:d.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[B.EncodingType.R16_UNSIGNED]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[B.EncodingType.R8G8_SIGNED]:{dataType:d.DataType.BYTE,
bytesPerElement:1,count:2,normalized:!1},[B.EncodingType.R8G8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[B.EncodingType.R16G16_SIGNED]:{dataType:d.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[B.EncodingType.R16G16_UNSIGNED]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[B.EncodingType.R8G8B8A8_SIGNED]:{dataType:d.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[B.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[B.EncodingType.R8G8B8A8_COLOR]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[B.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[B.EncodingType.R16G16B16A16_PATTERN]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const c=g=>{switch(g){case d.DataType.FLOAT:return 4;case d.DataType.INT:return 4;case d.DataType.UNSIGNED_INT:return 4;
case d.DataType.SHORT:return 2;case d.DataType.UNSIGNED_SHORT:return 2;case d.DataType.BYTE:return 1;case d.DataType.UNSIGNED_BYTE:return 1}},b=(g,l,p)=>{l/=p;if(1===g)switch(l){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===g)switch(l){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===g)switch(l){case 0:return".xyz";case 1:return".yzw"}return""};y.VTLMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(function(){class y{constructor(z){this._array=
[];0>=z&&console.error("strideInBytes must be positive!");this._stride=z}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(z,B){return 65535&z|B<<16}static i8888to32(z,B,d,e){return z&255|(B&255)<<8|(d&255)<<16|e<<24}static i8816to32(z,B,d){return z&255|(B&255)<<8|d<<16}}return y})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(y){y.EncodingType=void 0;(function(z){z[z.R8_SIGNED=0]="R8_SIGNED";z[z.R8_UNSIGNED=1]="R8_UNSIGNED";z[z.R16_SIGNED=2]="R16_SIGNED";z[z.R16_UNSIGNED=3]="R16_UNSIGNED";z[z.R8G8_SIGNED=4]="R8G8_SIGNED";z[z.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";z[z.R16G16_SIGNED=6]="R16G16_SIGNED";z[z.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";z[z.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";z[z.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";z[z.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";z[z.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
z[z.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(y.EncodingType||(y.EncodingType={}));y.AttributeStatus=void 0;(function(z){z[z.UNIFORM=0]="UNIFORM";z[z.DATA_DRIVEN=1]="DATA_DRIVEN";z[z.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";z[z.UNUSED=3]="UNUSED"})(y.AttributeStatus||(y.AttributeStatus={}));Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(y,z,B,d,e){class f extends B.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:z.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:z.EncodingType.R8_UNSIGNED,precisionFactor:32}};y.VTLCircleMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,B,d,e){class f extends B.VTLMaterial{constructor(b){super(b)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}
f.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class c extends B.VTLMaterial{constructor(b,g){super(b);this._usefillColor=g}geometryInfo(){return c.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
c.ATTRIBUTES_FILL:c.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?c.ATTRIBUTES_INFO_FILL:c.ATTRIBUTES_INFO_OUTLINE}}c.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];c.ATTRIBUTES_FILL=["fill-color","fill-opacity"];c.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,8),new e.VertexElementDescriptor("a_offset",2,d.DataType.BYTE,4,8),new e.VertexElementDescriptor("a_xnormal",2,d.DataType.BYTE,6,8)];c.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};c.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};y.VTLFillMaterial=f;y.VTLOutlineMaterial=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,B,d,e){class f extends B.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_extrude_offset",
4,d.DataType.BYTE,4,16),new e.VertexElementDescriptor("a_dir_normal",4,d.DataType.BYTE,8,16),new e.VertexElementDescriptor("a_accumulatedDistance",2,d.DataType.UNSIGNED_SHORT,12,16)];f.ATTRIBUTES_INFO={"line-width":{name:"width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:z.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:z.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};y.VTLLineMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,B,d,e){const f=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_vertexOffset",2,d.DataType.SHORT,4,16),new e.VertexElementDescriptor("a_texAngleRange",4,d.DataType.UNSIGNED_BYTE,8,16),new e.VertexElementDescriptor("a_levelInfo",4,d.DataType.UNSIGNED_BYTE,12,16)],c=[new e.VertexElementDescriptor("a_opacityInfo",1,d.DataType.UNSIGNED_BYTE,0,1)];
class b extends B.VTLMaterial{constructor(l){super(l)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return b.ATTRIBUTES}attributesInfo(){return b.ATTRIBUTES_INFO}}b.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");b.ATTRIBUTES_INFO={"icon-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class g extends B.VTLMaterial{constructor(l){super(l)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
g.ATTRIBUTES_INFO={"text-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,isLayout:!0}};y.VTLIconMaterial=
b;y.VTLTextMaterial=g;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(y,z){class B{constructor(d){this._expression=d}filter(d,e){if(!this._expression)return!0;try{return this._expression.evaluate(d,e)}catch(f){return console.log(f.message),!0}}static createFilter(d){if(!d)return null;this.isLegacyFilter(d)&&(d=this.convertLegacyFilter(d));try{const e=y.createExpression(d,
null,z.booleanType);return new B(e)}catch(e){return console.log(e.message),null}}static isLegacyFilter(d){if(!Array.isArray(d)||0===d.length)return!0;switch(d[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===d.length&&"string"===typeof d[1]&&!Array.isArray(d[2]);case "in":return 3<=d.length&&"string"===typeof d[1]&&!Array.isArray(d[2]);case "!in":return!0;case "any":case "all":for(let e=1;e<d.length;e++)if(this.isLegacyFilter(d[e]))return!0;return!1;
case "none":return!0;case "has":return 2===d.length&&("$id"===d[1]||"$type"===d[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(d){if(!Array.isArray(d)||0===d.length)return!0;const e=d[0];if(1===d.length)return"any"!==e;switch(e){case "\x3d\x3d":return B.convertComparison("\x3d\x3d",d[1],d[2]);case "!\x3d":return B.negate(B.convertComparison("\x3d\x3d",d[1],d[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return B.convertComparison(e,d[1],d[2]);case "in":return B.convertIn(d[1],
d.slice(2));case "!in":return B.negate(B.convertIn(d[1],d.slice(2)));case "any":case "all":case "none":return B.convertCombining(e,d.slice(1));case "has":return B.convertHas(d[1]);case "!has":return B.negate(B.convertHas(d[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(d,e,f){switch(e){case "$type":return[d,["geometry-type"],f];case "$id":return[d,["id"],f];default:return[d,["get",e],f]}}static convertIn(d,e){switch(d){case "$type":return["in",["geometry-type"],["literal",
e]];case "$id":return["in",["id"],["literal",e]];default:return["in",["get",d],["literal",e]]}}static convertHas(d){switch(d){case "$type":return!0;case "$id":return["has-id"];default:return["has",d]}}static convertCombining(d,e){return[d].concat(e.map(this.convertLegacyFilter))}static negate(d){return["!",d]}}return B})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(y,z,B,d,e,f,c){function b(a,v,x){var F=typeof a;if("string"===F||"boolean"===F||"number"===F||null===a){if(x)switch(x.kind){case "string":"string"!==F&&(a=X.toString(a));break;case "number":"number"!==F&&(a=X.toNumber(a));break;case "color":a=X.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");F=a[0];if("string"!==typeof F)throw Error("First element of expression must be a string");const M=na[F];if(void 0===M)throw Error(`Invalid expression operator "${F}"`);
if(!M)throw Error(`Unimplemented expression operator "${F}"`);return M.parse(a,v,x)}class g{constructor(a){this._parent=a;this._vars={}}add(a,v){this._vars[a]=v}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class l{constructor(){this.type=c.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new l}evaluate(a,v){return a?.id}}class p{constructor(){this.type=c.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new p}evaluate(a,v){if(!a)return null;switch(a.type){case d.GeometryType.Point:return"Point";case d.GeometryType.LineString:return"LineString";case d.GeometryType.Polygon:return"Polygon";default:return null}}}class t{constructor(){this.type=c.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new t}evaluate(a,v){return a?.values}}class k{constructor(){this.type=c.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new k}evaluate(a,v){return v}}class q{constructor(a,v,x){this._lhs=a;this._rhs=v;this._compare=x;this.type=c.booleanType}static parse(a,v,x){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new q(b(a[1],v),b(a[2],v),x)}evaluate(a,v){return this._compare(this._lhs.evaluate(a,v),this._rhs.evaluate(a,v))}}class r extends q{static parse(a,v){return q.parse(a,v,(x,F)=>x===F)}}class C extends q{static parse(a,
v){return q.parse(a,v,(x,F)=>x!==F)}}class G extends q{static parse(a,v){return q.parse(a,v,(x,F)=>x<F)}}class w extends q{static parse(a,v){return q.parse(a,v,(x,F)=>x<=F)}}class D extends q{static parse(a,v){return q.parse(a,v,(x,F)=>x>F)}}class E extends q{static parse(a,v){return q.parse(a,v,(x,F)=>x>=F)}}class H{constructor(a){this._arg=a;this.type=c.booleanType}static parse(a,v){if(2!==a.length)throw Error('"!" expects 1 argument');return new H(b(a[1],v))}evaluate(a,v){return!this._arg.evaluate(a,
v)}}class L{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,v){const x=[];for(let F=1;F<a.length;F++)x.push(b(a[F],v));return new L(x)}evaluate(a,v){for(const x of this._args)if(!x.evaluate(a,v))return!1;return!0}}class O{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,v){const x=[];for(let F=1;F<a.length;F++)x.push(b(a[F],v));return new O(x)}evaluate(a,v){for(const x of this._args)if(x.evaluate(a,v))return!0;return!1}}class h{constructor(a){this._args=a;this.type=
c.booleanType}static parse(a,v){const x=[];for(let F=1;F<a.length;F++)x.push(b(a[F],v));return new h(x)}evaluate(a,v){for(const x of this._args)if(x.evaluate(a,v))return!1;return!0}}class n{constructor(a,v,x){this.type=a;this._args=v;this._fallback=x}static parse(a,v,x){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let F;const M=[];for(let P=1;P<a.length-1;P+=2){const T=b(a[P],v),S=b(a[P+1],v,x);F||(F=S.type);
M.push({condition:T,output:S})}a=b(a[a.length-1],v,x);F||(F=a.type);return new n(F,M,a)}evaluate(a,v){for(const x of this._args)if(x.condition.evaluate(a,v))return x.output.evaluate(a,v);return this._fallback.evaluate(a,v)}}class m{constructor(a,v){this.type=a;this._args=v}static parse(a,v){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let x;const F=[];for(let M=1;M<a.length;M++){const P=b(a[M],v);x||(x=P.type);F.push(P)}return new m(x,F)}evaluate(a,v){for(const x of this._args){const F=
x.evaluate(a,v);if(null!==F)return F}return null}}class u{constructor(a,v,x,F,M){this.type=a;this._input=v;this._labels=x;this._outputs=F;this._fallback=M}static parse(a,v){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let x;const F=b(a[1],v),M=[],P={};let T;for(let Z=2;Z<a.length-1;Z+=2){var S=a[Z];Array.isArray(S)||(S=[S]);for(const fa of S){S=typeof fa;if("string"!==S&&"number"!==S)throw Error('"match" requires string or number literal as labels');
if(!T)T=S;else if(S!==T)throw Error('"match" requires labels to have the same type');P[fa]=M.length}S=b(a[Z+1],v);x||(x=S.type);M.push(S)}return new u(x,F,P,M,b(a[a.length-1],v))}evaluate(a,v){const x=this._input.evaluate(a,v);return(this._outputs[this._labels[x]]||this._fallback).evaluate(a,v)}}class A{constructor(a,v,x,F,M){this._operator=a;this.type=v;this.interpolation=x;this.input=F;this._stops=M}static parse(a,v,x){const F=a[0];if(5>a.length)throw Error(`"${F}" expects at least 4 arguments`);
const M=a[1];if(!Array.isArray(M)||0===M.length)throw Error(`"${M}" is not a valid interpolation`);switch(M[0]){case "linear":if(1!==M.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==M.length||"number"!==typeof M[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==M.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var P=1;5>P;P++){var T=
M[P];if("number"!==typeof T||0>T||1<T)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${M[0]}"`);}if(1!==a.length%2)throw Error(`"${F}" expects an even number of arguments`);P=b(a[2],v,c.numberType);let S;"interpolate-hcl"===F||"interpolate-lab"===F?S=c.colorType:x&&"value"!==x.kind&&(S=x);x=[];for(T=3;T<a.length;T+=2){const Z=a[T];if("number"!==typeof Z)throw Error(`"${F}" requires stop inputs as literal numbers`);
if(x.length&&x[x.length-1][0]>=Z)throw Error(`"${F}" requires strictly ascending stop inputs`);const fa=b(a[T+1],v,S);S||(S=fa.type);x.push([Z,fa])}if(S&&S!==c.colorType&&S!==c.numberType&&("array"!==S.kind||S.itemType!==c.numberType))throw Error(`"${F}" cannot interpolate type ${c.typeToString(S)}`);return new A(F,S,M,P,x)}evaluate(a,v){var x=this._stops;if(1===x.length)return x[0][1].evaluate(a,v);var F=this.input.evaluate(a,v);if(F<=x[0][0])return x[0][1].evaluate(a,v);if(F>=x[x.length-1][0])return x[x.length-
1][1].evaluate(a,v);let M=0;for(;++M<x.length&&!(F<x[M][0]););const P=A.interpolationRatio(this.interpolation,F,x[M-1][0],x[M][0]);F=x[M-1][1].evaluate(a,v);const T=x[M][1].evaluate(a,v);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(F)&&Array.isArray(T))return F.map((S,Z)=>f.interpolate(S,T[Z],P));if("color"===this.type.kind&&F instanceof z&&T instanceof z)return F=new z(F),a=new z(T),new z([f.interpolate(F.r,a.r,P),f.interpolate(F.g,a.g,P),f.interpolate(F.b,a.b,P),
f.interpolate(F.a,a.a,P)]);if("number"===this.type.kind&&"number"===typeof F&&"number"===typeof T)return f.interpolate(F,T,P);throw Error(`"${this._operator}" cannot interpolate type ${c.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=B.toLCH(F),v=B.toLCH(T),x=v.h-a.h,a=B.toRGB({h:a.h+P*(180<x||-180>x?x-360*Math.round(x/360):x),c:f.interpolate(a.c,v.c,P),l:f.interpolate(a.l,v.l,P)}),new z({a:f.interpolate(F.a,T.a,P),...a});if("interpolate-lab"===this._operator)return a=
B.toLAB(F),v=B.toLAB(T),a=B.toRGB({l:f.interpolate(a.l,v.l,P),a:f.interpolate(a.a,v.a,P),b:f.interpolate(a.b,v.b,P)}),new z({a:f.interpolate(F.a,T.a,P),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,v){const x=this._stops;if(1===x.length||a>=x[x.length-1][0])return 0;let F=0;for(;++F<x.length&&!(a<x[F][0]););return A.interpolationRatio(this.interpolation,v,x[F-1][0],x[F][0])}getInterpolationRange(a){const v=this._stops;if(1===v.length)return a=v[0][0],[a,
a];var x=v[v.length-1][0];if(a>=x)return[x,x];for(x=0;++x<v.length&&!(a<v[x][0]););return[v[x-1][0],v[x][0]]}static interpolationRatio(a,v,x,F){let M=0;"linear"===a[0]?M=A._exponentialInterpolationRatio(v,1,x,F):"exponential"===a[0]?M=A._exponentialInterpolationRatio(v,a[1],x,F):"cubic-bezier"===a[0]&&(M=e.unitBezier(a[1],a[2],a[3],a[4])(A._exponentialInterpolationRatio(v,1,x,F),1E-5));0>M?M=0:1<M&&(M=1);return M}static _exponentialInterpolationRatio(a,v,x,F){F-=x;if(0===F)return 0;a-=x;return 1===
v?a/F:(v**a-1)/(v**F-1)}}class I{constructor(a,v,x){this.type=a;this._input=v;this._stops=x}static parse(a,v){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const x=b(a[1],v,c.numberType);let F;const M=[];M.push([-Infinity,b(a[2],v)]);for(let P=3;P<a.length;P+=2){const T=a[P];if("number"!==typeof T)throw Error('"step" requires stop inputs as literal numbers');if(M.length&&M[M.length-1][0]>=T)throw Error('"step" requires strictly ascending stop inputs');
const S=b(a[P+1],v);F||(F=S.type);M.push([T,S])}return new I(F,x,M)}evaluate(a,v){const x=this._stops;if(1===x.length)return x[0][1].evaluate(a,v);const F=this._input.evaluate(a,v);let M=0;for(;++M<x.length&&!(F<x[M][0]););return this._stops[M-1][1].evaluate(a,v)}}class K{constructor(a,v){this.type=a;this._output=v}static parse(a,v,x){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const F=new g(v);for(let M=
1;M<a.length-1;M+=2){const P=a[M];if("string"!==typeof P)throw Error(`"let" requires a string to define variable names - found ${P}`);F.add(P,b(a[M+1],v))}a=b(a[a.length-1],F,x);return new K(a.type,a)}evaluate(a,v){return this._output.evaluate(a,v)}}class N{constructor(a,v){this.type=a;this.output=v}static parse(a,v,x){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');v=v.get(a[1]);if(!v)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new N(x||c.valueType,v)}evaluate(a,v){return this.output.evaluate(a,v)}}class J{constructor(a,v,x){this.type=a;this._index=v;this._array=x}static parse(a,v){if(3!==a.length)throw Error('"at" expects 2 arguments');const x=b(a[1],v,c.numberType);a=b(a[2],v);return new J(a.type.itemType,x,a)}evaluate(a,v){const x=this._index.evaluate(a,v);a=this._array.evaluate(a,v);if(0>x||x>=a.length)throw Error('"at" index out of bounds');if(x!==Math.floor(x))throw Error('"at" index must be an integer');return a[x]}}
class Q{constructor(a,v){this._key=a;this._obj=v;this.type=c.valueType}static parse(a,v){let x;switch(a.length){case 2:return x=b(a[1],v),new Q(x);case 3:return x=b(a[1],v),a=b(a[2],v),new Q(x,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,v){const x=this._key.evaluate(a,v);return this._obj?this._obj.evaluate(a,v)[x]:a?.values[x]}}class R{constructor(a,v){this._key=a;this._obj=v;this.type=c.booleanType}static parse(a,v){let x;switch(a.length){case 2:return x=b(a[1],v),new R(x);
case 3:return x=b(a[1],v),a=b(a[2],v),new R(x,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,v){const x=this._key.evaluate(a,v);return this._obj?(a=this._obj.evaluate(a,v),x in a):!!a?.values[x]}}class V{constructor(a,v){this._key=a;this._vals=v;this.type=c.booleanType}static parse(a,v){if(3!==a.length)throw Error('"in" expects 2 arguments');return new V(b(a[1],v),b(a[2],v))}evaluate(a,v){const x=this._key.evaluate(a,v);return this._vals.evaluate(a,v).includes(x)}}class aa{constructor(a,
v,x){this._item=a;this._array=v;this._from=x;this.type=c.numberType}static parse(a,v){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const x=b(a[1],v),F=b(a[2],v);return 4===a.length?(a=b(a[3],v,c.numberType),new aa(x,F,a)):new aa(x,F)}evaluate(a,v){const x=this._item.evaluate(a,v),F=this._array.evaluate(a,v);if(this._from){a=this._from.evaluate(a,v);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return F.indexOf(x,a)}return F.indexOf(x)}}class Y{constructor(a){this._arg=
a;this.type=c.numberType}static parse(a,v){if(2!==a.length)throw Error('"length" expects 2 arguments');a=b(a[1],v);return new Y(a)}evaluate(a,v){a=this._arg.evaluate(a,v);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class ba{constructor(a,v,x,F){this.type=a;this._array=v;this._from=x;this._to=F}static parse(a,v){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const x=b(a[1],v),F=b(a[2],v,c.numberType);if(F.type!==
c.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=b(a[3],v,c.numberType);if(a.type!==c.numberType)throw Error('"slice" index must return a number');return new ba(x.type,x,F,a)}return new ba(x.type,x,F)}evaluate(a,v){const x=this._array.evaluate(a,v);if(!Array.isArray(x)&&"string"!==typeof x)throw Error('"slice" input must be an array or a string');const F=this._from.evaluate(a,v);if(0>F||F>=x.length)throw Error('"slice" index out of bounds');if(F!==Math.floor(F))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,v);if(0>a||a>=x.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return x.slice(F,a)}return x.slice(F)}}class ea{constructor(){this.type=c.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new ea}evaluate(a,v){return void 0!==a?.id}}class W{constructor(a,v){this._args=a;this._calculate=v;this.type=c.numberType}static parse(a,v,x){a=a.slice(1).map(F=>
b(F,v));return new W(a,x)}evaluate(a,v){let x;this._args&&(x=this._args.map(F=>F.evaluate(a,v)));return this._calculate(x)}}class oa extends W{static parse(a,v){switch(a.length){case 2:return W.parse(a,v,x=>-x[0]);case 3:return W.parse(a,v,x=>x[0]-x[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends W{static parse(a,v){return W.parse(a,v,x=>{let F=1;for(const M of x)F*=M;return F})}}class qa extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]/x[1]);throw Error('"/" expects 2 arguments');
}}class ra extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]%x[1]);throw Error('"%" expects 2 arguments');}}class sa extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]**x[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends W{static parse(a,v){return W.parse(a,v,x=>{let F=0;for(const M of x)F+=M;return F})}}class U{constructor(a,v){this._args=a;this._calculate=v;this.type=c.numberType}static parse(a,v){const x=a.slice(1).map(F=>b(F,v));return new U(x,
U.ops[a[0]])}evaluate(a,v){let x;this._args&&(x=this._args.map(F=>F.evaluate(a,v)));return this._calculate(x)}}U.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=c.stringType}static parse(a,v){return new ha(a.slice(1).map(x=>b(x,v)))}evaluate(a,v){return this._args.map(x=>x.evaluate(a,v)).join("")}}class da{constructor(a,v){this._arg=a;this._calculate=v;this.type=c.stringType}static parse(a,v){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);v=b(a[1],v);return new da(v,da.ops[a[0]])}evaluate(a,v){return this._calculate(this._arg.evaluate(a,v))}}da.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=c.colorType}static parse(a,v){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(x=>b(x,v));return new ia(a)}evaluate(a,v){const x=this._validate(this._args[0].evaluate(a,v)),F=this._validate(this._args[1].evaluate(a,v));a=this._validate(this._args[2].evaluate(a,v));return new z({r:x,g:F,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=c.colorType}static parse(a,v){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(x=>b(x,v));return new ja(a)}evaluate(a,v){const x=this._validate(this._args[0].evaluate(a,v)),F=this._validate(this._args[1].evaluate(a,v)),M=this._validate(this._args[2].evaluate(a,v));a=this._validateAlpha(this._args[3].evaluate(a,v));return new z({r:x,g:F,b:M,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=c.arrayType(c.numberType,4)}static parse(a,v){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=b(a[1],v);return new ka(a)}evaluate(a,v){return(new z(this._color.evaluate(a,v))).toRgba()}}class ca{constructor(a,v){this.type=a;this._args=v}static parse(a,v){var x=a[0];if(2>a.length)throw Error(`${x} expects at least one argument`);
let F=1,M;if("array"===x){if(2<a.length){switch(a[1]){case "string":M=c.stringType;break;case "number":M=c.numberType;break;case "boolean":M=c.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}F++}else M=c.valueType;if(3<a.length){var P=a[2];if(null!==P&&("number"!==typeof P||0>P||P!==Math.floor(P)))throw Error('"array" length argument must be a positive integer literal');F++}M=c.arrayType(M,P)}else switch(x){case "string":M=c.stringType;break;case "number":M=
c.numberType;break;case "boolean":M=c.booleanType;break;case "object":M=c.objectType}for(x=[];F<a.length;F++)P=b(a[F],v),x.push(P);return new ca(M,x)}evaluate(a,v){let x;for(const F of this._args){const M=F.evaluate(a,v);x=c.getType(M);if(c.matchType(x,this.type))return M}throw Error(`Expected ${c.typeToString(this.type)} but got ${c.typeToString(x)}`);}}class X{constructor(a,v){this.type=a;this._args=v}static parse(a,v){var x=a[0];const F=X.types[x];if(F===c.booleanType||F===c.stringType){if(2!==
a.length)throw Error(`${x} expects one argument`);}else if(2>a.length)throw Error(`${x} expects at least one argument`);x=[];for(let M=1;M<a.length;M++){const P=b(a[M],v);x.push(P)}return new X(F,x)}evaluate(a,v){if(this.type===c.booleanType)return!!this._args[0].evaluate(a,v);if(this.type===c.stringType)return c.valueToString(this._args[0].evaluate(a,v));if(this.type===c.numberType){for(const F of this._args){var x=Number(F.evaluate(a,v));if(!isNaN(x))return x}return null}if(this.type===c.colorType){for(x of this._args)try{const F=
X.toColor(x.evaluate(a,v));if(F instanceof z)return F}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return c.valueToString(a)}static toNumber(a){const v=Number(a);if(isNaN(v))throw Error(`"${a}" is not a number`);return v}static toColor(a){if(a instanceof z)return a;if("string"===typeof a){const v=z.fromString(a);if(v)return v;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return z.fromArray(a);throw Error(`"${a}" is not a color`);}}X.types={"to-boolean":c.booleanType,
"to-color":c.colorType,"to-number":c.numberType,"to-string":c.stringType};class la{constructor(a){this._val=a;this.type=c.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,v){return this._val}}class ma{constructor(a){this._arg=a;this.type=c.stringType}static parse(a,v){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(b(a[1],v))}evaluate(a,v){return c.typeToString(c.getType(this._arg.evaluate(a,v)))}}const na=
{array:ca,boolean:ca,collator:null,format:null,image:null,literal:la,number:ca,"number-format":null,object:ca,string:ca,"to-boolean":X,"to-color":X,"to-number":X,"to-string":X,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":p,id:l,"line-progress":null,properties:t,at:J,get:Q,has:R,in:V,"index-of":aa,length:Y,slice:ba,"!":H,"!\x3d":C,"\x3c":G,"\x3c\x3d":w,"\x3d\x3d":r,"\x3e":D,"\x3e\x3d":E,all:L,any:O,case:n,coalesce:m,match:u,within:null,interpolate:A,"interpolate-hcl":A,"interpolate-lab":A,
step:I,let:K,var:N,concat:ha,downcase:da,"is-supported-script":null,"resolved-locale":null,upcase:da,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:U,acos:U,asin:U,atan:U,ceil:U,cos:U,e:U,floor:U,ln:U,ln2:U,log10:U,log2:U,max:U,min:U,pi:U,round:U,sin:U,sqrt:U,tan:U,zoom:k,"heatmap-density":null,"has-id":ea,none:h};y.ALL=L;y.ANY=O;y.Add=ta;y.Assert=ca;y.At=J;y.Calculate=U;y.Case=n;y.Coalesce=m;y.Coerce=X;y.Concat=ha;y.Div=qa;y.EQ=r;y.GE=E;y.GT=D;y.GeomType=p;y.Get=Q;y.Has=
R;y.HasID=ea;y.ID=l;y.In=V;y.IndexOf=aa;y.Interpolate=A;y.LE=w;y.LT=G;y.Length=Y;y.Let=K;y.Literal=la;y.Match=u;y.Mod=ra;y.Mul=pa;y.NE=C;y.NONE=h;y.NOT=H;y.Pow=sa;y.Properties=t;y.Rgb=ia;y.Rgba=ja;y.Slice=ba;y.Step=I;y.String=da;y.Sub=oa;y.ToRgba=ka;y.TypeOf=ma;y.Var=N;y.Zoom=k;y.createExpression=b;y.ops=na;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(y,z){function B(r,
C){return{kind:"array",itemType:r,n:C}}function d(r){if("array"===r.kind){const C=d(r.itemType);return"number"===typeof r.n?`array<${C}, ${r.n}>`:"value"===r.itemType.kind?"array":`array<${C}>`}return r.kind}function e(r){if(null===r)return c;if("string"===typeof r)return g;if("boolean"===typeof r)return l;if("number"===typeof r)return b;if(r instanceof z)return p;if(Array.isArray(r)){let C;for(const G of r){const w=e(G);if(!C)C=w;else if(C!==w){C=k;break}}return B(C||k,r.length)}return"object"===
typeof r?t:k}function f(r,C){if("array"===C.kind)return"array"===r.kind&&(0===r.n&&"value"===r.itemType.kind||f(r.itemType,C.itemType))&&("number"!==typeof C.n||C.n===r.n);if("value"===C.kind)for(const G of q)if(f(r,G))return!0;return C.kind===r.kind}const c={kind:"null"},b={kind:"number"},g={kind:"string"},l={kind:"boolean"},p={kind:"color"},t={kind:"object"},k={kind:"value"},q=[c,b,g,l,p,t,B(k)];y.arrayType=B;y.booleanType=l;y.colorType=p;y.getType=e;y.matchType=f;y.nullType=c;y.numberType=b;y.objectType=
t;y.stringType=g;y.typeToString=d;y.valueToString=function(r){if(null===r)return"";const C=typeof r;return"string"===C?r:"number"===C||"boolean"===C?String(r):r instanceof z?r.toString():JSON.stringify(r)};y.valueType=k;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(y,z,B,d){class e{constructor(f,c){this.isDataDriven=
!1;this.interpolator=null;switch(f.type){case "number":var b=!0;break;case "color":b=!0;break;case "array":b="number"===f.value;break;default:b=!1}null==c&&(c=f.default);if(Array.isArray(c)&&0<c.length&&B.ops[c[0]]){b={number:d.numberType,color:d.colorType,string:d.stringType,boolean:d.booleanType,enum:d.stringType};try{var g="array"===f.type?d.arrayType(b[f.value]||d.valueType,f.length):b[f.type];const l=B.createExpression(c,null,g);this.getValue=this._buildExpression(l,f);this.isDataDriven=!0;l instanceof
B.Interpolate&&l.input instanceof B.Zoom&&(this.interpolator=l)}catch(l){console.log(l.message),this.getValue=this._buildSimple(f.default)}}else{b&&"interval"===c.type&&(b=!1);if(g=c?.stops&&0<c.stops.length)for(const l of c.stops)l[1]=this._validate(l[1],f);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,f)),g)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,f);break;case "categorical":this.getValue=this._buildCategorical(c,f);break;
default:this.getValue=b?this._buildInterpolate(c,f):this._buildInterval(c,f)}else this.getValue=this._buildIdentity(c,f);else g?this.getValue=b?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,f),this.getValue=this._buildSimple(c))}}_validate(f,c){if("number"===c.type){if(null!=c.minimum&&f<c.minimum)return c.minimum;if(null!=c.maximum&&f>c.maximum)return c.maximum}else"color"===c.type?f=e._parseColor(f):"enum"===c.type?"string"===typeof f&&(f=c.values.indexOf(f)):"array"===
c.type&&"enum"===c.value?f=f.map(b=>"string"===typeof b?c.values.indexOf(b):b):"string"===c.type&&(f=d.valueToString(f));return f}_buildSimple(f){return()=>f}_buildExpression(f,c){return(b,g)=>{try{const l=f.evaluate(g,b);return void 0===l?c.default:this._validate(l,c)}catch(l){return console.log(l.message),c.default}}}_buildIdentity(f,c){return(b,g)=>{let l;g&&(l=g.values[f.property]);void 0!==l&&(l=this._validate(l,c));return null!=l?l:void 0!==f.default?f.default:c.default}}_buildCategorical(f,
c){return(b,g)=>{let l;g&&(l=g.values[f.property]);l=this._categorical(l,f.stops);return void 0!==l?l:void 0!==f.default?f.default:c.default}}_buildInterval(f,c){return(b,g)=>{let l;g&&(l=g.values[f.property]);return"number"===typeof l?this._interval(l,f.stops):void 0!==f.default?f.default:c.default}}_buildInterpolate(f,c){return(b,g)=>{let l;g&&(l=g.values[f.property]);return"number"===typeof l?this._interpolate(l,f.stops,f.base||1):void 0!==f.default?f.default:c.default}}_buildZoomInterpolate(f){return c=>
this._interpolate(c,f.stops,f.base||1)}_buildZoomInterval(f){return c=>this._interval(c,f.stops)}_categorical(f,c){const b=c.length;for(let g=0;g<b;g++)if(c[g][0]===f)return c[g][1]}_interval(f,c){const b=c.length;let g=0;for(let l=0;l<b;l++)if(c[l][0]<=f)g=l;else break;return c[g][1]}_interpolate(f,c,b){const g=c.length;for(let t=0;t<g;t++){const k=c[t];if(k[0]<=f)var l=k;else{var p=k;break}}if(l&&p){c=p[0]-l[0];f-=l[0];b=1===b?f/c:(b**f-1)/(b**c-1);if(Array.isArray(l[1])){l=l[1];p=p[1];f=[];for(c=
0;c<l.length;c++)f.push(z.interpolate(l[c],p[c],b));return f}return z.interpolate(l[1],p[1],b)}if(l)return l[1];if(p)return p[1]}static _isEmpty(f){for(const c in f)if(f.hasOwnProperty(c))return!1;return!0}static _parseColor(f){if(Array.isArray(f))return f;"string"===typeof f&&(f=new y(f));if(f instanceof y&&!this._isEmpty(f))return y.toUnitRGBA(f)}}return e})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(y,z){class B{constructor(d){this._style=
d;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;d.layers||(d.layers=[]);this.version=parseFloat(d.version);if(this.layers=d.layers.map((e,f,c)=>this._create(e,f,c)).filter(e=>!!e))for(d=0;d<this.layers.length;d++){const e=this.layers[d];this._layerByName[e.id]=e;this._uidToLayer.set(e.uid,e);e.type===y.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(d){return(d=this._layerByName[d])?d.isPainterDataDriven():
!1}getStyleLayerId(d){return d>=this.layers.length?null:this.layers[d].id}getStyleLayerByUID(d){return this._uidToLayer.get(d)??null}getStyleLayerIndex(d){return(d=this._layerByName[d])?this.layers.indexOf(d):-1}setStyleLayer(d,e){if(d?.id){var f=this._style;null!=e&&e>=this.layers.length&&(e=this.layers.length-1);var c=!0,b;if(b=this._layerByName[d.id]){const g=this.layers.indexOf(b);e||=g;e===g?(c=!1,b=B._recreateLayer(d,b),this.layers[e]=b,f.layers[e]=d):(this.layers.splice(g,1),f.layers.splice(g,
1),b=this._create(d,e,this.layers),this.layers.splice(e,0,b),f.layers.splice(e,0,d))}else b=this._create(d,e,this.layers),!e||e>=this.layers.length?(this.layers.push(b),f.layers.push(d)):(this.layers.splice(e,0,b),f.layers.splice(e,0,d));this._layerByName[d.id]=b;this._uidToLayer.set(b.uid,b);c&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(d){return(d=this._layerByName[d])?{type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,
filter:d.filter,layout:d.layout,paint:d.paint}:null}deleteStyleLayer(d){const e=this._layerByName[d];e&&(delete this._layerByName[d],this._uidToLayer.delete(e.uid),d=this.layers.indexOf(e),this.layers.splice(d,1),this._style.layers.splice(d,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(d){return this._layerByName[d]}getLayoutProperties(d){return(d=this._layerByName[d])?d.layout:null}getPaintProperties(d){return(d=this._layerByName[d])?d.paint:null}setPaintProperties(d,e){if(d=
this._layerByName[d]){var f=B._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:d.layout,paint:e},d),c=this.layers.indexOf(d);this.layers[c]=f;this._style.layers[c].paint=e;this._layerByName[d.id]=f;this._uidToLayer.set(d.uid,f)}}setLayoutProperties(d,e){if(d=this._layerByName[d]){var f=B._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,
filter:d.filter,layout:e,paint:d.paint},d),c=this.layers.indexOf(d);this.layers[c]=f;this._style.layers[c].layout=e;this._layerByName[d.id]=f;this._uidToLayer.set(d.uid,f)}}setStyleLayerVisibility(d,e){if(d=this._layerByName[d]){var f=d.layout||{};f.visibility=e;e=B._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:f,paint:d.paint},d);var c=this.layers.indexOf(d);this.layers[c]=e;this._style.layers[c].layout=
f;this._layerByName[d.id]=e;this._uidToLayer.set(d.uid,e)}}getStyleLayerVisibility(d){return(d=this._layerByName[d])?d.layout?.visibility??"visible":"none"}_recomputeZValues(){const d=this.layers,e=1/(d.length+1);for(let f=0;f<d.length;f++)d[f].z=1-(1+f)*e}_identifyRefLayers(){const d=[],e=[];let f=0;for(const g of this.layers){const l=g.layout;if(g.type===y.StyleLayerType.FILL){var c=g,b=g.source+"|"+g.sourceLayer;b+="|"+(l?.visibility??"");b+="|"+g.minzoom;b+="|"+g.maxzoom;b+="|"+JSON.stringify(g.filter);
if(c.hasDataDrivenFill||c.hasDataDrivenOutline)b+="|"+f;d.push({key:b,layer:g})}else if(g.type===y.StyleLayerType.LINE){c=g;b=g.paint;b=null!=b&&(null!=b["line-pattern"]||null!=b["line-dasharray"]);let p=g.source+"|"+g.sourceLayer;p+="|"+(l?.visibility??"");p+="|"+g.minzoom;p+="|"+g.maxzoom;p+="|"+JSON.stringify(g.filter);p+="|"+(void 0!==l?l["line-cap"]:"");p+="|"+(void 0!==l?l["line-join"]:"");if(c.hasDataDrivenLine||b)p+="|"+f;e.push({key:p,layer:g})}++f}this._assignRefLayers(d);this._assignRefLayers(e)}_assignRefLayers(d){d.sort((l,
p)=>l.key<p.key?-1:l.key>p.key?1:0);let e,f;const c=d.length;for(let l=0;l<c;l++){const p=d[l];if(p.key===e)p.layer.refLayerId=f;else if(e=p.key,f=p.layer.id,p.layer.type===y.StyleLayerType.FILL){if(!p.layer.getPaintProperty("fill-outline-color"))for(var b=l+1;b<c;b++){var g=d[b];if(g.key===e){if(g.layer.getPaintProperty("fill-outline-color")){d[l]=g;d[b]=p;f=g.layer.id;break}}else break}}else if(p.layer.type===y.StyleLayerType.LINE)for(b=p.layer,g=l+1;g<c;g++){const t=d[g];if(t.key!==e)break;const k=
t.layer;if(b.canUseThinTessellation&&!k.canUseThinTessellation||!b.canUseThinTessellation&&(k.getPaintProperty("line-pattern")||k.getPaintProperty("line-dasharray")))b=k,d[l]=t,d[g]=p,f=t.layer.id}}}_create(d,e,f){e=1-1/(f.length+1)*(1+e);f=this._runningId++;switch(d.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,d,e,f);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,d,e,f);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,d,e,f);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
d,e,f);case "raster":console.warn(`Unsupported vector tile raster layer ${d.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,d,e,f)}return null}static _recreateLayer(d,e){switch(d.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,d,e.z,e.uid);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,d,e.z,e.uid);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,d,e.z,e.uid);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
d,e.z,e.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${d.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,d,e.z,e.uid)}return null}}return B})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,z,B,d,e,f,c,b,g,l,p,t,k,q,r,C,G){const w=B.ofType({key:"type",base:null,typeMap:{rect:r,path:G,geometry:C}});y.LayerView2DMixin=D=>{D=class extends D{constructor(){super(...arguments);this.attached=!1;this.clips=new w;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const E=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&E&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new e("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new k.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([f.watch(()=>this.suspended,H=>{this.container&&(this.container.visible=!H)},f.syncAndInitial),f.watch(()=>this.updateSuspended,H=>{this.view&&!H&&this.updateRequested&&this.view.requestUpdate()},f.syncAndInitial),f.watch(()=>this.layer?.opacity??
1,H=>{this.container&&(this.container.opacity=H)},f.syncAndInitial),f.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",H=>{this.container&&(this.container.blendMode=H)},f.syncAndInitial),f.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,H=>{this.container&&(this.container.effect=H)},f.syncAndInitial),f.watch(()=>this.highlightOptions,H=>this.container.highlightOptions=H,f.syncAndInitial),f.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},f.syncAndInitial),f.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:H})=>{H=null!=H?this.isVisibleAtScale(H):!1;H!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",H)},f.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(H=>{H===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const E=this.view?.spatialReference;return null==E||this.supportsSpatialReference(E)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(E){const H=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!H)return!0;const {minScale:L,maxScale:O}=H;return t.isInScaleRange(E,L,O)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(E){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
E),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(E)))}hitTest(E,H){return Promise.resolve(null)}supportsSpatialReference(E){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const E=super.getSuspendInfo(),H=!this.spatialReferenceSupported,L=this.visibleAtCurrentScale;H&&(E.spatialReferenceNotSupported=H);L&&(E.outsideScaleRange=L);return E}addAttachHandles(E){this.addHandles(E,"attach")}};
z.__decorate([c.property()],D.prototype,"attached",void 0);z.__decorate([c.property({type:w,set(E){E=d.referenceSetter(E,this._get("clips"),w);this._set("clips",E)}})],D.prototype,"clips",void 0);z.__decorate([c.property()],D.prototype,"container",void 0);z.__decorate([c.property()],D.prototype,"moving",void 0);z.__decorate([c.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);z.__decorate([c.property({readOnly:!0})],D.prototype,"updateParameters",void 0);z.__decorate([c.property()],
D.prototype,"updateRequested",void 0);z.__decorate([c.property()],D.prototype,"updateSuspended",null);z.__decorate([c.property()],D.prototype,"updating",null);z.__decorate([c.property()],D.prototype,"view",void 0);z.__decorate([c.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",void 0);z.__decorate([c.property({type:q})],D.prototype,"highlightOptions",void 0);return D=z.__decorate([p.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(y,z,B){function d(e,f){f=B.getMetersPerUnitForSR(f);return e/(f*B.inchesPerMeter*96)}y.getExtentForScale=function(e,f){const c=e.extent;e=e.width-(e.padding?e.padding.left+e.padding.right:0);f=d(f,c.spatialReference);return c.clone().expand(f*e/c.width)};y.getResolutionForScale=d;y.getResolutionInMetersForScale=function(e){return e/(96*B.inchesPerMeter)};y.getScale=function(e,f){f=
f||e.extent;e=e.width;const c=B.getMetersPerUnitForSR(f?.spatialReference);return f&&e?f.width/e*c*B.inchesPerMeter*96:0};y.getScaleForResolution=function(e,f){f=B.getMetersPerUnitForSR(f);return e*f*B.inchesPerMeter*96};y.isInScaleRange=function(e,f,c){if(f=0===f||z.floatEqualAbsolute(e,f)||e<f)f=0===c||z.floatEqualAbsolute(e,c)||e>c;return f};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,B,d,e,f,c){var b;B=b=class extends c{constructor(g){super(g);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};y.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"left",void 0);y.__decorate([z.property({type:[Number,String],
json:{write:!0}})],B.prototype,"right",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"top",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"bottom",void 0);return B=b=y.__decorate([f.subclass("esri.views.layers.support.ClipRect")],B)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(y,z,B,d,e,f,c){z=class extends z.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};y.__decorate([B.property({readOnly:!0})],z.prototype,"version",null);return z=y.__decorate([c.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(y,z,B,d,e,f,c,b,g,l,p,t){var k;z={base:b,key:"type",typeMap:{extent:p,polygon:t}};l=k=class extends l{constructor(q){super(q);this.type="geometry";this.geometry=null}clone(){return new k({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};y.__decorate([B.property({types:z,json:{read:g.fromJSON,write:!0}})],l.prototype,"geometry",void 0);return l=k=y.__decorate([c.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,B,d,e,f,c){B=class extends c{constructor(b){super(b);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};y.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],B.prototype,"path",void 0);return B=y.__decorate([f.subclass("esri.views.layers.support.Path")],B)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(y,z,B){class d extends z{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(e){e=B.pool.acquire(e);const f=0===e.level?null:B.getId(e.level-1,e.row>>1,e.col>>1,e.world);B.pool.release(e);return f}getTileCoverage(e,f,c=!0,b){e=super.getTileCoverage(e,f,c,b);if(!e)return e;const g=1<<e.lodInfo.level;e.spans=e.spans.filter(l=>0<=l.row&&l.row<g);return e}scaleToLevel(e){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[e])return this._levelByScale[e];var f=this._fullCacheLodInfos;
if(e>f[0].scale)return f[0].level;let c;for(let b=0;b<f.length-1;b++)if(c=f[b+1],e>c.scale)return f=f[b],f.level+(f.scale-e)/(f.scale-c.scale);return f[f.length-1].level}_initializeFullCacheLODs(e){e=0===e[0].level?e.map(f=>({level:f.level,resolution:f.resolution,scale:f.scale})):y.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(f=>({level:f.level,resolution:f.resolution,scale:f.scale}));for(let f=0;f<e.length;f++)this._levelByScale[e[f].scale]=e[f].level;
this._fullCacheLodInfos=e}}return d})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileFeatureIndex ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(y,
z,B,d,e,f,c,b,g,l,p,t,k,q,r,C,G,w,D,E,H,L,O,h){function n(m){if(null==m)return 0;switch(m.type){case "partial":return Object.keys(m.diff).length;case "complete":return Math.max(Object.keys(m.oldValue).length,Object.keys(m.newValue).length);case "collection":return Object.keys(m.added).length+Object.keys(m.changed).length+Object.keys(m.removed).length}}c=class extends H.LayerView2DMixin(h){constructor(){super(...arguments);this._styleChanges=[];this._tileHandlerPromise=this._parseQueue=this._fetchQueue=
null;this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}async hitTest(m,u){var A=this._tileHandlerPromise,I=this._vectorTileContainer?.symbolFader;if(A&&this._isTileHandlerReady&&I){await A;A=null;var K=this._vectorTileContainer?.symbolRepository;K&&(A=K.querySymbols(u,2,I.decluttererOffset,{}));u=this._tileManager.getIntersectingTiles(u.x,u.y,2,this.view.state,A);if((!u||0===u.length)&&0===A?.length)return null;m=m.clone().normalize();I=[];K=[];for(const N of u)I.push(this._queryTile(K,
m,2,this.view.state.rotation,N,A?.filter(J=>J.tileKey.id===N.id)));await Promise.all(I);return K}}update(m){this._tileHandlerPromise&&this._isTileHandlerReady&&(m.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=m.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=m.state,this._parseQueue.state=m.state,this._tileManager.update(m)||this.requestUpdate(),
this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const {style:m}=this.layer.currentStyleInfo;this._styleRepository=new E(m);this._tileInfoView=new L(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new G.VectorTileContainer(this.view.featuresTilingScheme);this._tileHandler=new q.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1);this.container.addChild(this._vectorTileContainer);this._start();this.addAttachHandles([this.layer.on("paint-change",
u=>{if(u.isDataDriven)this._styleChanges.push({type:k.StyleUpdateType.PAINTER_CHANGED,data:u}),this.requestUpdate();else{const I=this._styleRepository;var A=I.getLayerById(u.layer);A&&(A=A.type===D.StyleLayerType.SYMBOL,I.setPaintProperties(u.layer,u.paint),A&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}}),this.layer.on("layout-change",u=>{const A=this._styleRepository,I=A.getLayerById(u.layer);if(I){var K=g.diff(I.layout,u.layout);null!=K&&(g.hasDiff(K,
"visibility")&&1===n(K)?(A.setLayoutProperties(u.layer,u.layout),I.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()):(this._styleChanges.push({type:k.StyleUpdateType.LAYOUT_CHANGED,data:u}),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",u=>{const A=this._styleRepository,I=A.getLayerById(u.layer);I&&(A.setStyleLayerVisibility(u.layer,u.visibility),I.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),
this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",u=>{this._styleChanges.push({type:k.StyleUpdateType.LAYER_CHANGED,data:u});this.requestUpdate()}),this.layer.on("delete-style-layer",u=>{this._styleChanges.push({type:k.StyleUpdateType.LAYER_REMOVED,data:u});this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",u=>{this._styleChanges.push({type:k.StyleUpdateType.SPRITES_CHANGED,data:u});u=this._styleRepository.layers;
for(const A of u)switch(A.type){case D.StyleLayerType.SYMBOL:A.getLayoutProperty("icon-image")&&this._styleChanges.push({type:k.StyleUpdateType.LAYOUT_CHANGED,data:{layer:A.id,layout:A.layout}});break;case D.StyleLayerType.LINE:A.getPaintProperty("line-pattern")&&this._styleChanges.push({type:k.StyleUpdateType.PAINTER_CHANGED,data:{layer:A.id,paint:A.paint,isDataDriven:A.isPainterDataDriven()}});break;case D.StyleLayerType.FILL:A.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:k.StyleUpdateType.PAINTER_CHANGED,
data:{layer:A.id,paint:A.paint,isDataDriven:A.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop();this.container.removeAllChildren();this._vectorTileContainer=d.destroyMaybe(this._vectorTileContainer);this._tileHandler=d.destroyMaybe(this._tileHandler)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(m){return t.equals(this.layer.tileInfo?.spatialReference,m)}canResume(){let m=super.canResume();const {currentStyleInfo:u}=
this.layer;if(m&&u?.layerDefinition){const A=this.view.scale,{minScale:I,maxScale:K}=u.layerDefinition;u?.layerDefinition&&(I&&I<A&&(m=!1),K&&K>A&&(m=!1))}return m}isUpdating(){return this.fading}acquireTile(m){const u=this._createVectorTile(m);this._updatingHandles.addPromise(this._fetchQueue.push(u.key).then(A=>this._parseQueue.push({key:u.key,data:A})).then(A=>{u.once("attach",()=>this.requestUpdate());u.setData(A);this.requestUpdate()}).catch(A=>{e.isAbortError(A)||B.getLogger(this).error(A)}));
return u}releaseTile(m){m=m.key.id;this._fetchQueue.abort(m);this._parseQueue.abort(m);this.requestUpdate()}_start(){this._stop();this._tileManager=new r.TileManager({acquireTile:A=>this.acquireTile(A),releaseTile:A=>this.releaseTile(A),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var m=new AbortController,u=this._tileHandler.start({signal:m.signal}).then(()=>{this._fetchQueue=new O({tileInfoView:this._tileInfoView,process:(A,I)=>this._getTileData(A,
I),concurrency:15});this._parseQueue=new O({tileInfoView:this._tileInfoView,process:(A,I)=>this._parseTileData(A,I),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(A=>{this._vectorTileContainer.setStyleResources(A,this._tileHandler.glyphMosaic,this._styleRepository,this.view.featuresTilingScheme);this.requestUpdate()});this._tileHandlerAbortController=m;this._tileHandlerPromise=u}}_stop(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var m=
this._tileHandlerAbortController;m&&m.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue=d.destroyMaybe(this._fetchQueue);this._parseQueue=d.destroyMaybe(this._parseQueue);this._tileManager=d.destroyMaybe(this._tileManager);this._vectorTileContainer.removeAllChildren()}}async _getTileData(m,u){return this._tileHandler.fetchTileData(m,u)}async _parseTileData(m,u){return this._tileHandler.parseTileData(m,u)}async _applyStyleChanges(){this._isTileHandlerReady=!1;this._fetchQueue.pause();
this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var m=this._styleChanges;try{await this._tileHandler.updateStyle(m)}catch(N){B.getLogger(this).error("error applying vector-tiles style update",N.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const u=this._styleRepository,A=new Set;m.forEach(N=>{N.type===k.StyleUpdateType.LAYER_REMOVED&&(N=u.getLayerById(N.data.layer))&&A.add(N.uid)});const I=new Set;
m.forEach(N=>{let J;switch(N.type){case k.StyleUpdateType.PAINTER_CHANGED:u.setPaintProperties(N.data.layer,N.data.paint);J=N.data.layer;break;case k.StyleUpdateType.LAYOUT_CHANGED:u.setLayoutProperties(N.data.layer,N.data.layout);J=N.data.layer;break;case k.StyleUpdateType.LAYER_REMOVED:u.deleteStyleLayer(N.data.layer);return;case k.StyleUpdateType.LAYER_CHANGED:u.setStyleLayer(N.data.layer,N.data.index);J=N.data.layer.id;break;case k.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(N.data.spriteSource))}J&&
(N=u.getLayerById(J))&&I.add(N.uid)});m=this._vectorTileContainer.children;if(0<A.size){const N=Array.from(A);this._vectorTileContainer.deleteStyleLayers(N);for(var K of m)K.deleteLayerData(N)}this._fetchQueue.resume();this._parseQueue.resume();if(0<I.size){const N=Array.from(I);K=[];for(const J of m)m=this._updatingHandles.addPromise(this._fetchQueue.push(J.key).then(Q=>this._parseQueue.push({key:J.key,data:Q,styleLayerUIDs:N})).then(Q=>J.setData(Q))),K.push(m);await Promise.all(K)}this._styleChanges=
[];this._isTileHandlerReady=!0;this.requestUpdate()}async _loadStyle(){var {style:m}=this.layer.currentStyleInfo;m=z.clone(m);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._styleRepository=new E(m);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;var {signal:u}=this._tileHandlerAbortController;try{this._tileHandlerPromise=
this._tileHandler.setStyle(this._styleRepository,m,this.layer.tileInfo.lods.length-1),await this._tileHandlerPromise}catch(A){if(!e.isAbortError(A))throw A;}u.aborted||(m=await this._tileHandler.spriteMosaic,u=this._vectorTileContainer,this._tileInfoView=new L(this.layer.tileInfo,this.layer.fullExtent),u.setStyleResources(m,this._tileHandler.glyphMosaic,this._styleRepository,this.view.featuresTilingScheme),this._tileManager=new r.TileManager({acquireTile:A=>this.acquireTile(A),releaseTile:A=>this.releaseTile(A),
tileInfoView:this._tileInfoView},this._vectorTileContainer));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.requestUpdate()}_createVectorTile(m){const u=this._tileInfoView.getTileBounds(p.create(),m),A=this._tileInfoView.getTileResolution(m.level);return new C.VectorTile(m,A,u[0],u[3],512,512,this._styleRepository)}async _queryTile(m,u,A,I,K,N){if(0!==K.layerData.size){var J=this._ensureTileIndex(K),Q=this._tileInfoView.getTileBounds(p.create(),K.key,!0);A=await J.queryAttributes((u.x-
Q[0])/(Q[2]-Q[0])*4096,4096*(1-(u.y-Q[1])/(Q[3]-Q[1])),A,I,N);for(const R of A)R.graphic.geometry=this._tileToMapPoint(R.tilePoint,K.transforms.tileUnitsToPixels),m.push({type:"graphic",layer:this.layer,graphic:R.graphic,mapPoint:u.clone()});m.sort((R,V)=>V.graphic.origin.layerIndex-R.graphic.origin.layerIndex)}}_tileToMapPoint(m,u){if(!m)return null;const A=this.view.state,I=[0,0];A.toMap(I,[m[0]*u[0]+m[1]*u[3]+u[6],m[0]*u[1]+m[1]*u[4]+u[7]]);return new l({x:I[0],y:I[1],spatialReference:A.spatialReference})}_ensureTileIndex(m){let u=
m.featureIndex;u||(u=w.create(m.key,m.layerData,this._styleRepository,this._tileHandler,this.layer),m.featureIndex=u);return u}};y.__decorate([f.property()],c.prototype,"_isTileHandlerReady",void 0);return c=y.__decorate([b.subclass("esri.views.2d.layers.VectorTileLayerView2D")],c)});