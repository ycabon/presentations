// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/screenUtils":function(){define(["exports"],function(a){function q(k){return k?72*k/96:0}const r=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;a.castRenderScreenPointArray=function(k){return k};a.castRenderScreenPointArray3=function(k){return k};a.castScreenPointArray=function(k){return k};a.createRenderScreenPoint=function(k=0,l=0){return{x:k,y:l}};a.createRenderScreenPointArray=function(k=0,l=0){return[k,l]};a.createRenderScreenPointArray3=function(k=0,l=0,m=0){return[k,l,m]};a.createScreenPoint=
function(k=0,l=0){return{x:k,y:l}};a.createScreenPointArray=function(k=0,l=0){return[k,l]};a.pt2px=function(k){return k?k/72*96:0};a.px2pt=q;a.screenPointArrayToObject=function(k,l){return l?(l.x=k[0],l.y=k[1],l):{x:k[0],y:k[1]}};a.screenPointObjectToArray=function(k,l){return l?(l[0]=k.x,l[1]=k.y,2<l.length&&(l[2]=0),l):[k.x,k.y]};a.toPt=function(k){if("string"===typeof k){var l=k.match(r);if(l){var m=Number(l[1]);l=l[3]&&l[3].toLowerCase();k="-"===k.charAt(0);m="px"===l?q(m):m;return k?-m:m}console.warn("screenUtils.toPt: input not recognized!");
return null}return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v){var y;q=new q.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});r=y=class extends r.JSONSupport{static create(B={}){const {resolutionFactor:t=1,scales:w,size:C=256,spatialReference:z=x.WebMercator,numLODs:D=24}=B;if(!e.isValid(z)){B=[];if(w)for(var H=0;H<w.length;H++){var G=
w[H];B.push(new u({level:H,scale:G,resolution:G}))}else for(H=5E-4,G=D-1;0<=G;G--)B.unshift(new u({level:G,scale:H,resolution:H})),H*=2;return new y({dpi:96,lods:B,origin:new g(0,0,z),size:[C,C],spatialReference:z})}H=e.getInfo(z);B=B.origin?new g({x:B.origin.x,y:B.origin.y,spatialReference:z}):H?new g({x:H.origin[0],y:H.origin[1],spatialReference:z}):new g({x:0,y:0,spatialReference:z});H=1/(39.37*k.getMetersPerUnitForSR(z)*96);G=[];if(w)for(var A=0;A<w.length;A++){var F=w[A];G.push(new u({level:A,
scale:F,resolution:F*H}))}else{var J=e.isGeographic(z)?512/C*5.916575275917094E8:256/C*5.91657527591555E8;A=Math.ceil(D/t);G.push(new u({level:0,scale:J,resolution:J*H}));for(F=1;F<A;F++)J/=2**t,G.push(new u({level:F,scale:J,resolution:J*H}))}return new y({dpi:96,lods:G,origin:B,size:[C,C],spatialReference:z})}constructor(B){super(B);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:B,origin:t}=this;if(B&&t){const w=e.getInfo(B);return B.isWrappable&&
!!w&&Math.abs(w.origin[0]-t.x)<=w.dx}return!1}readOrigin(B,t){return g.fromJSON({spatialReference:t.spatialReference,...B})}set lods(B){const t=[],w=this._levelToLOD={};B&&B.forEach(C=>{t.push(C.scale);w[C.level]=C});this._set("scales",t);this._set("lods",B);this._initializeUpsampleLevels()}readSize(B,t){return[t.cols,t.rows]}writeSize(B,t){t.cols=B[0];t.rows=B[1]}zoomToScale(B){const t=this.scales;if(0>=B)return t[0];if(B>=t.length-1)return t[t.length-1];const w=Math.floor(B);return t[w]/(t[w]/t[w+
1])**(B-w)}scaleToZoom(B){const t=this.scales,w=t.length-1;let C=0;for(;C<w;C++){const z=t[C],D=t[C+1];if(z<=B)break;if(D===B)return C+1;if(z>B&&D<B)return C+Math.log(z/B)/Math.log(z/D)}return C}snapScale(B,t=.95){B=this.scaleToZoom(B);return B%Math.floor(B)>=t?this.zoomToScale(Math.ceil(B)):this.zoomToScale(Math.floor(B))}tileAt(B,t,w,C){var z=this.lodAt(B);if(!z)return null;let D;if("number"===typeof t)D=t,t=w;else{if(e.equals(t.spatialReference,this.spatialReference))D=t.x,t=t.y;else{C=h.project(t,
this.spatialReference);if(null==C)return null;D=C.x;t=C.y}C=w}w=z.resolution*this.size[0];z=z.resolution*this.size[1];C||=new v.TileKey(null,0,0,0,n.create());C.level=B;C.row=Math.floor((this.origin.y-t)/z+.001);C.col=Math.floor((D-this.origin.x)/w+.001);this.updateTileInfo(C);return C}updateTileInfo(B,t=y.ExtrapolateOptions.NONE){var w=this.lodAt(B.level);w||t!==y.ExtrapolateOptions.POWER_OF_TWO||(t=this.lods[this.lods.length-1],t.level<B.level&&(w=t));if(w){var C=B.level-w.level;t=w.resolution*
this.size[0]/2**C;w=w.resolution*this.size[1]/2**C;B.id=`${B.level}/${B.row}/${B.col}`;B.extent||(B.extent=n.create());B.extent[0]=this.origin.x+B.col*t;B.extent[1]=this.origin.y-(B.row+1)*w;B.extent[2]=B.extent[0]+t;B.extent[3]=B.extent[1]+w}}upsampleTile(B){const t=this._upsampleLevels[B.level];if(!t||-1===t.parentLevel)return!1;B.level=t.parentLevel;B.row=Math.floor(B.row/t.factor+.001);B.col=Math.floor(B.col/t.factor+.001);this.updateTileInfo(B);return!0}getTileBounds(B,t){var w=this.lodAt(t.level);
if(null==w)return null;var {resolution:C}=w;w=C*this.size[0];C*=this.size[1];B[0]=this.origin.x+t.col*w;B[1]=this.origin.y-(t.row+1)*C;B[2]=B[0]+w;B[3]=B[1]+C;return B}lodAt(B){return this._levelToLOD?.[B]??null}clone(){return y.fromJSON(this.write({}))}getOrCreateCompatible(B,t){if(256===this.size[0]&&256===this.size[1])return 256===B?this:null;const w=[],C=this.lods.length;for(let z=0;z<C;z++){const D=this.lods[z];w.push(new u({level:D.level,scale:D.scale,resolution:D.resolution*t}))}return new y({size:[B,
B],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:w})}_initializeUpsampleLevels(){const B=this.lods;this._upsampleLevels=[];let t=null;for(let w=0;w<B.length;w++){const C=B[w];this._upsampleLevels[C.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/C.resolution:0};t=C}}};a.__decorate([l.property({type:Number,json:{write:!0}})],r.prototype,"compressionQuality",void 0);a.__decorate([l.property({type:Number,
json:{write:!0}})],r.prototype,"dpi",void 0);a.__decorate([l.property({type:String,json:{read:q.read,write:q.write,origins:{"web-scene":{read:!1,write:!1}}}})],r.prototype,"format",void 0);a.__decorate([l.property({readOnly:!0})],r.prototype,"isWrappable",null);a.__decorate([l.property({type:g,json:{write:!0}})],r.prototype,"origin",void 0);a.__decorate([d.reader("origin")],r.prototype,"readOrigin",null);a.__decorate([l.property({type:[u],value:null,json:{write:!0}})],r.prototype,"lods",null);a.__decorate([l.property({readOnly:!0})],
r.prototype,"scales",void 0);a.__decorate([l.property({cast:B=>Array.isArray(B)?B:"number"===typeof B?[B,B]:[256,256]})],r.prototype,"size",void 0);a.__decorate([d.reader("size",["rows","cols"])],r.prototype,"readSize",null);a.__decorate([p.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],r.prototype,"writeSize",null);a.__decorate([l.property({type:x,json:{write:!0}})],r.prototype,"spatialReference",void 0);r=y=a.__decorate([f.subclass("esri.layers.support.TileInfo")],r);(function(B){B=
B.ExtrapolateOptions||(B.ExtrapolateOptions={});B[B.NONE=0]="NONE";B[B.POWER_OF_TWO=1]="POWER_OF_TWO"})(r||={});return r})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b){var c;q=c=class extends q.JSONSupport{constructor(d){super(d);this.cols=null;this.level=
0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new c({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"cols",void 0);a.__decorate([r.property({type:k.Integer,json:{write:!0}})],q.prototype,"level",void 0);a.__decorate([r.property({type:String,json:{write:!0}})],
q.prototype,"levelValue",void 0);a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"origin",void 0);a.__decorate([r.property({type:Number,json:{write:!0}})],q.prototype,"resolution",void 0);a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"rows",void 0);a.__decorate([r.property({type:Number,json:{write:!0}})],q.prototype,"scale",void 0);
return q=c=a.__decorate([b.subclass("esri.layers.support.LOD")],q)})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class q{constructor(r,k,l,m,b){this.id=r;this.level=k;this.row=l;this.col=m;this.extent=b}}a.TileKey=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,q,r,k,l){const m=new k("0/0/0/0");
class b{static create(f,p){f[1]>p[1]&&([f,p]=[p,f]);const [g,x]=f,[n,e]=p;f=n-g;p=e-x;p=0!==p?f/p:0;const h=(Math.ceil(x)-x)*p,u=(Math.floor(x)-x)*p;return new b(g,Math.floor(x),Math.ceil(e),p,0>f?h:u,0>f?u:h,0>f?n:g,0>f?g:n)}constructor(f,p,g,x,n,e,h,u){this.x=f;this.ymin=p;this.ymax=g;this.invM=x;this.leftAdjust=n;this.rightAdjust=e;this.leftBound=h;this.rightBound=u}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+
this.rightAdjust,this.rightBound)}}const c=[[0,0],[0,0],[0,0],[0,0]];class d{constructor(f,p=null,g=f.lods[0].level,x=f.lods[f.lods.length-1].level){this.tileInfo=f;this.fullExtent=p;this.scales=[];this._infoByScale={};this._infoByLevel={};const n=f.lods.filter(h=>h.level>=g&&h.level<=x);this.minScale=n[0].scale;this.maxScale=n[n.length-1].scale;const e=this._lodInfos=n.map(h=>q.create(f,h,p));n.forEach((h,u)=>{this._infoByLevel[h.level]=e[u];this._infoByScale[h.scale]=e[u];this.scales[u]=h.scale},
this);this._wrap=f.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(f){return this._infoByLevel["number"===typeof f?f:f.level]}getTileBounds(f,p,g=!1){m.set(p);return(p=this._infoByLevel[m.level])?p.getTileBounds(f,m,g):f}getTileCoords(f,p,g=!1){m.set(p);return(p=this._infoByLevel[m.level])?p.getTileCoords(f,m,g):f}getTileCoverage(f,p=192,g=!0,x="closest"){if(!g&&(f.scale>this.minScale||f.scale<this.maxScale))return null;g="closest"===x?this.getClosestInfoForScale(f.scale):
this.getSmallestInfoForScale(f.scale);x=r.pool.acquire(g);const n=this._wrap;var e=Infinity;let h=-Infinity;const u=x.spans;c[0][0]=c[0][1]=c[1][1]=c[3][0]=-p;c[1][0]=c[2][0]=f.size[0]+p;c[2][1]=c[3][1]=f.size[1]+p;for(v of c)f.toMap(v,v),v[0]=g.getColumnForX(v[0]),v[1]=g.getRowForY(v[1]);f=[];var v=3;for(p=0;4>p;p++)c[p][1]===c[v][1]?v=p:(v=b.create(c[p],c[v]),e=Math.min(v.ymin,e),h=Math.max(v.ymax,h),void 0===f[v.ymin]&&(f[v.ymin]=[]),f[v.ymin].push(v),v=p);if(null==e||null==h||100<h-e)return null;
for(p=[];e<h;){null!=f[e]&&(p=p.concat(f[e]));v=Infinity;var y=-Infinity;for(var B=p.length-1;0<=B;B--){var t=p[B];v=Math.min(v,t.getLeftCol());y=Math.max(y,t.getRightCol())}v=Math.floor(v);y=Math.floor(y);if(e>=g.first[1]&&e<=g.last[1])if(n)if(g.size[0]<g.worldSize[0])for(B=Math.floor(y/g.worldSize[0]),t=Math.floor(v/g.worldSize[0]);t<=B;t++)u.push(new l(e,Math.max(g.getFirstColumnForWorld(t),v),Math.min(g.getLastColumnForWorld(t),y)));else u.push(new l(e,v,y));else v>g.last[0]||y<g.first[0]||(v=
Math.max(v,g.first[0]),y=Math.min(y,g.last[0]),u.push(new l(e,v,y)));e+=1;for(v=p.length-1;0<=v;v--)y=p[v],y.ymax>=e?y.incrRow():p.splice(v,1)}return x}getTileParentId(f){m.set(f);f=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>f)return null;this._getTileIdAtLOD(m,this._lodInfos[f],m);return m.id}getTileResolution(f){return(f=this._infoByLevel["object"===typeof f?f.level:f])?f.resolution:-1}getTileScale(f){return(f=this._infoByLevel[f.level])?f.scale:-1}intersects(f,p){m.set(p);p=this._infoByLevel[m.level];
const g=f.lodInfo;if(g.resolution>p.resolution){this._getTileIdAtLOD(m,g,m);var x=g.denormalizeCol(m.col,m.world);for(var n of f.spans)if(n.row===m.row&&n.colFrom<=x&&n.colTo>=x)return!0}if(g.resolution<p.resolution){const [h,u,v,y]=f.spans.reduce((B,t)=>{B[0]=Math.min(B[0],t.row);B[1]=Math.max(B[1],t.row);B[2]=Math.min(B[2],t.colFrom);B[3]=Math.max(B[3],t.colTo);return B},[Infinity,-Infinity,Infinity,-Infinity]);x=p.denormalizeCol(m.col,m.world);f=g.getColumnForX(p.getXForColumn(x));n=g.getRowForY(p.getYForRow(m.row));
x=g.getColumnForX(p.getXForColumn(x+1))-1;p=g.getRowForY(p.getYForRow(m.row+1))-1;return!(f>y||x<v||n>u||p<h)}const e=g.denormalizeCol(m.col,m.world);return f.spans.some(h=>h.row===m.row&&h.colFrom<=e&&h.colTo>=e)}normalizeBounds(f,p,g){f[0]=p[0];f[1]=p[1];f[2]=p[2];f[3]=p[3];this._wrap&&(p=a.getInfo(this.tileInfo.spatialReference),g=-g*(p.valid[1]-p.valid[0]),f[0]+=g,f[2]+=g);return f}getSmallestInfoForScale(f){const p=this.scales;if(this._infoByScale[f])return this._infoByScale[f];if(f>p[0])return this._infoByScale[p[0]];
for(let g=1;g<p.length-1;g++)if(f>p[g]+1E-6)return this._infoByScale[p[g-1]];return this._infoByScale[p[p.length-1]]}getClosestInfoForScale(f){const p=this.scales;if(this._infoByScale[f])return this._infoByScale[f];f=p.reduce((g,x)=>Math.abs(x-f)<Math.abs(g-f)?x:g,p[0]);return this._infoByScale[f]}scaleToLevel(f){const p=this.scales;if(this._infoByScale[f])return this._infoByScale[f].level;for(let g=p.length-1;0<=g;g--)if(f<p[g])return g===p.length-1?this._infoByScale[p[p.length-1]].level:this._infoByScale[p[g]].level+
(p[g]-f)/(p[g]-p[g+1]);return this._infoByScale[p[0]].level}scaleToZoom(f){return this.tileInfo.scaleToZoom(f)}_getTileIdAtLOD(f,p,g){const x=this._infoByLevel[g.level];f.set(g);if(p.resolution<x.resolution)return null;if(p.resolution===x.resolution)return f;f.level=p.level;f.col=Math.floor(g.col*x.resolution/p.resolution+.01);f.row=Math.floor(g.row*x.resolution/p.resolution+.01);return f}}return d})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils",
"./TileKey"],function(a,q){function r(m,b,c){m[0]=b;m[1]=c;return m}const k=new q("0/0/0/0");class l{static create(m,b,c=null){var d=a.getInfo(m.spatialReference);const f=b.origin||[m.origin.x,m.origin.y],p=[m.size[0]*b.resolution,m.size[1]*b.resolution],g=[-Infinity,-Infinity],x=[Infinity,Infinity],n=[Infinity,Infinity];null!=c&&(r(g,Math.max(0,Math.floor((c.xmin-f[0])/p[0])),Math.max(0,Math.floor((f[1]-c.ymax)/p[1]))),r(x,Math.max(0,Math.floor((c.xmax-f[0])/p[0])),Math.max(0,Math.floor((f[1]-c.ymin)/
p[1]))),r(n,x[0]-g[0]+1,x[1]-g[1]+1));const {cols:e,rows:h}=b;!c&&e&&h&&(r(g,e[0],h[0]),r(x,e[1],h[1]),r(n,e[1]-e[0]+1,h[1]-h[0]+1));let u;m.isWrappable?(m=[Math.ceil(Math.round((d.valid[1]-d.valid[0])/b.resolution)/m.size[0]),n[1]],d=[Math.floor((d.origin[0]-f[0])/p[0]),g[1]],c=[m[0]+d[0]-1,x[1]],u=!0):(d=g,c=x,m=n,u=!1);return new l(b.level,b.resolution,b.scale,f,g,x,n,p,d,c,m,u)}constructor(m,b,c,d,f,p,g,x,n,e,h,u){this.level=m;this.resolution=b;this.scale=c;this.origin=d;this.first=f;this.last=
p;this.size=g;this.norm=x;this.worldStart=n;this.worldEnd=e;this.worldSize=h;this.wrap=u}normalizeCol(m){if(!this.wrap)return m;const b=this.worldSize[0];return 0>m?b-1-Math.abs((m+1)%b):m%b}denormalizeCol(m,b){return this.wrap?this.worldSize[0]*b+m:m}getWorldForColumn(m){return this.wrap?Math.floor(m/this.worldSize[0]):0}getFirstColumnForWorld(m){return m*this.worldSize[0]+this.first[0]}getLastColumnForWorld(m){return m*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(m){return(m-this.origin[0])/
this.norm[0]}getXForColumn(m){return this.origin[0]+m*this.norm[0]}getRowForY(m){return(this.origin[1]-m)/this.norm[1]}getYForRow(m){return this.origin[1]-m*this.norm[1]}getTileBounds(m,b,c=!1){k.set(b);var d=c?k.col:this.denormalizeCol(k.col,k.world),f=k.row;b=this.getXForColumn(d);c=this.getYForRow(f+1);d=this.getXForColumn(d+1);f=this.getYForRow(f);m[0]=b;m[1]=c;m[2]=d;m[3]=f;return m}getTileCoords(m,b,c=!1){k.set(b);b=c?k.col:this.denormalizeCol(k.col,k.world);Array.isArray(m)?r(m,this.getXForColumn(b),
this.getYForRow(k.row)):(m.x=this.getXForColumn(b),m.y=this.getYForRow(k.row));return m}}return l})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(a){class q{static getId(r,k,l,m){return"object"===typeof r?`${r.level}/${r.row}/${r.col}/${r.world}`:`${r}/${k}/${l}/${m}`}constructor(r,k,l,m){this.set(r,k,l,m)}get key(){return this}get id(){return this.toString()}set id(r){this.set(r)}get hash(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|
this.level&63}acquire(r,k,l,m){this.set(r,k,l,m)}contains(r){const k=r.level-this.level;return 0<=k&&this.row===r.row>>k&&this.col===r.col>>k&&this.world===r.world}containsChild(r){const k=r.level-this.level;return 0<k&&this.row===r.row>>k&&this.col===r.col>>k&&this.world===r.world}equals(r){return this.level===r.level&&this.row===r.row&&this.col===r.col&&this.world===r.world}clone(){return new q(this)}release(){this.world=this.col=this.row=this.level=0}set(r,k,l,m){if(null==r)this.world=this.col=
this.row=this.level=0;else if("object"===typeof r)this.level=r.level||0,this.row=r.row||0,this.col=r.col||0,this.world=r.world||0;else if("string"===typeof r){const [b,c,d,f]=r.split("/");this.level=parseFloat(b);this.row=parseFloat(c);this.col=parseFloat(d);this.world=parseFloat(f)}else this.level=+r,this.row=+k,this.col=+l,this.world=+m||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new q(this.level-1,this.row>>1,this.col>>
1,this.world)}getNeighborId(r,k){return`${this.level}/${this.row+k}/${this.col+r}/${this.world}`}getChildKeys(){const r=this.level+1,k=this.row<<1,l=this.col<<1,m=this.world;return[new q(r,k,l,m),new q(r,k,l+1,m),new q(r,k+1,l,m),new q(r,k+1,l+1,m)]}compareRowMajor(r){return this.row<r.row?-1:this.row>r.row?1:this.col<r.col?-1:this.col>r.col?1:0}}q.pool=new a(q,null,null,25,50);return q})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool","./TileKey"],function(a,q){class r{constructor(){this.spans=
[]}acquire(k){this.lodInfo=k}release(){this.lodInfo=null;this.spans.length=0}*keys(){const k=this.lodInfo;for(const {row:l,colFrom:m,colTo:b}of this.spans)for(let c=m;c<=b;c++){const d=k.getWorldForColumn(c);yield new q(k.level,l,k.normalizeCol(c),d)}}forEach(k,l){const {spans:m,lodInfo:b}=this,{level:c}=b;if(0!==m.length)for(const {row:d,colFrom:f,colTo:p}of m)for(let g=f;g<=p;g++)k.call(l,c,d,b.normalizeCol(g),b.getWorldForColumn(g))}}r.pool=new a(r);return r})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(q,
r,k){this.row=q;this.colFrom=r;this.colTo=k}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),function(a,q,r,k,l,m,b,c,d,f){function p(h,u){h.length=0;u.forEach(v=>h.push(v));
return h}const g=new Set,x=[],n=new Map,e=[0,0];q=class extends q{constructor(h){super(h);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:h,process:u,strategy:v}=this;this._queue=new f.QueueProcessor({concurrency:h,process:(y,B)=>{y=this._keyToItem.get(y);return u(y,{signal:B})},peeker:"scale-first"===v?y=>this._peekByScaleFirst(y):y=>this._peekByCenterFirst(y)})}destroy(){this.clear();this._queue=r.destroyMaybe(this._queue)}get length(){return this._queue?
this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(h){this._queue.abort("string"===typeof h?h:h.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(h){return"string"===typeof h?this._keyToItem.has(h):this._keyToItem.has(h.id)}isOngoing(h){h="string"===typeof h?h:h.id;return this.has(h)&&this._queue.isOngoing(h)}pause(){this._queue.pause()}push(h){const u=h.key.id;if(this._queue.has(u))return this._queue.get(u);const v=this._queue.push(u),y=()=>{this._keyToItem.delete(u)};
this._keyToItem.set(u,h);v.then(y,y);return v}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(h){if(!this.state)return h.values().next().value;const u=this.tileInfoView;let v=Number.NEGATIVE_INFINITY,y=Number.POSITIVE_INFINITY;h.forEach(z=>{z=this._keyToItem.get(z);const D=this.tileInfoView.getTileScale(z.key);n.has(D)||(n.set(D,[]),v=Math.max(D,v),y=Math.min(D,y));n.get(D).push(z.key);g.add(D)});let B=this.state.scale;n.has(B)||(p(x,g),x.sort((z,D)=>z-D),B=x.reduce((z,
D)=>Math.abs(D-B)<Math.abs(z-B)?D:z,x[0]));B=Math.min(B,v);B=Math.max(B,y);h=n.get(B);const t=u.getClosestInfoForScale(B),w=t.getColumnForX(this.state.center[0]),C=t.getRowForY(this.state.center[1]);h.sort((z,D)=>{const H=t.denormalizeCol(z.col,z.world),G=t.denormalizeCol(D.col,D.world);return Math.sqrt((w-H)*(w-H)+(C-z.row)*(C-z.row))-Math.sqrt((w-G)*(w-G)+(C-D.row)*(C-D.row))});g.clear();n.clear();return h[0].id}_peekByCenterFirst(h){if(!this.state)return h.values().next().value;const u=this.tileInfoView,
v=this.state.center;let y=Number.POSITIVE_INFINITY,B;h.forEach(t=>{t=this._keyToItem.get(t);u.getTileCoords(e,t.key);const w=d.distance(e,v);w<y&&(y=w,B=t.key)});return B.id}};a.__decorate([k.property({constructOnly:!0})],q.prototype,"concurrency",void 0);a.__decorate([k.property({constructOnly:!0})],q.prototype,"process",void 0);a.__decorate([k.property()],q.prototype,"state",void 0);a.__decorate([k.property({constructOnly:!0})],q.prototype,"strategy",void 0);a.__decorate([k.property({constructOnly:!0})],
q.prototype,"tileInfoView",void 0);return q=a.__decorate([c.subclass("esri.views.2d.tiling.TileQueue")],q)})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(a,q){function r(X,ca){X[0]=ca[0];X[1]=ca[1];return X}function k(X,ca,ma){X[0]=ca;X[1]=ma;return X}function l(X,ca,ma){X[0]=ca[0]+ma[0];X[1]=ca[1]+ma[1];return X}function m(X,ca,ma){X[0]=ca[0]-ma[0];X[1]=ca[1]-ma[1];return X}function b(X,ca,ma){X[0]=ca[0]*ma[0];X[1]=ca[1]*ma[1];return X}function c(X,ca,
ma){X[0]=ca[0]/ma[0];X[1]=ca[1]/ma[1];return X}function d(X,ca){X[0]=Math.ceil(ca[0]);X[1]=Math.ceil(ca[1]);return X}function f(X,ca){X[0]=Math.floor(ca[0]);X[1]=Math.floor(ca[1]);return X}function p(X,ca,ma){X[0]=Math.min(ca[0],ma[0]);X[1]=Math.min(ca[1],ma[1]);return X}function g(X,ca,ma){X[0]=Math.max(ca[0],ma[0]);X[1]=Math.max(ca[1],ma[1]);return X}function x(X,ca){X[0]=Math.round(ca[0]);X[1]=Math.round(ca[1]);return X}function n(X,ca,ma){X[0]=ca[0]*ma;X[1]=ca[1]*ma;return X}function e(X,ca,ma,
S){X[0]=ca[0]+ma[0]*S;X[1]=ca[1]+ma[1]*S;return X}function h(X,ca){const ma=ca[0]-X[0];X=ca[1]-X[1];return Math.sqrt(ma*ma+X*X)}function u(X,ca){const ma=ca[0]-X[0];X=ca[1]-X[1];return ma*ma+X*X}function v(X){const ca=X[0];X=X[1];return Math.sqrt(ca*ca+X*X)}function y(X){const ca=X[0];X=X[1];return ca*ca+X*X}function B(X,ca){X[0]=-ca[0];X[1]=-ca[1];return X}function t(X,ca){X[0]=1/ca[0];X[1]=1/ca[1];return X}function w(X,ca){var ma=ca[0];const S=ca[1];ma=ma*ma+S*S;0<ma&&(ma=1/Math.sqrt(ma),X[0]=ca[0]*
ma,X[1]=ca[1]*ma);return X}function C(X,ca){return X[0]*ca[0]+X[1]*ca[1]}function z(X,ca,ma){ca=ca[0]*ma[1]-ca[1]*ma[0];X[0]=X[1]=0;X[2]=ca;return X}function D(X,ca,ma,S){const Y=ca[0];ca=ca[1];X[0]=Y+S*(ma[0]-Y);X[1]=ca+S*(ma[1]-ca);return X}function H(X,ca){ca=ca||1;const ma=2*q.RANDOM()*Math.PI;X[0]=Math.cos(ma)*ca;X[1]=Math.sin(ma)*ca;return X}function G(X,ca,ma){const S=ca[0];ca=ca[1];X[0]=ma[0]*S+ma[2]*ca;X[1]=ma[1]*S+ma[3]*ca;return X}function A(X,ca,ma){const S=ca[0];ca=ca[1];X[0]=ma[0]*S+
ma[2]*ca+ma[4];X[1]=ma[1]*S+ma[3]*ca+ma[5];return X}function F(X,ca,ma){const S=ca[0];ca=ca[1];X[0]=ma[0]*S+ma[3]*ca+ma[6];X[1]=ma[1]*S+ma[4]*ca+ma[7];return X}function J(X,ca,ma){const S=ca[0];ca=ca[1];X[0]=ma[0]*S+ma[4]*ca+ma[12];X[1]=ma[1]*S+ma[5]*ca+ma[13];return X}function K(X,ca,ma,S){const Y=ca[0]-ma[0];ca=ca[1]-ma[1];const ia=Math.sin(S);S=Math.cos(S);X[0]=Y*S-ca*ia+ma[0];X[1]=Y*ia+ca*S+ma[1];return X}function P(X,ca){var ma=X[0];X=X[1];const S=ca[0];ca=ca[1];let Y=ma*ma+X*X;0<Y&&(Y=1/Math.sqrt(Y));
let ia=S*S+ca*ca;0<ia&&(ia=1/Math.sqrt(ia));ma=(ma*S+X*ca)*Y*ia;return 1<ma?0:-1>ma?Math.PI:Math.acos(ma)}function E(X){return"vec2("+X[0]+", "+X[1]+")"}function M(X,ca){return X[0]===ca[0]&&X[1]===ca[1]}function T(X,ca){const ma=X[0];X=X[1];const S=ca[0];ca=ca[1];const Y=q.getEpsilon();return Math.abs(ma-S)<=Y*Math.max(1,Math.abs(ma),Math.abs(S))&&Math.abs(X-ca)<=Y*Math.max(1,Math.abs(X),Math.abs(ca))}function ba(X,ca,ma,S,Y){let ia=ca[0]-ma[0];ma=ca[1]-ma[1];Y=(S[0]*ia+S[1]*ma)*(Y-1);ia=S[0]*Y;
ma=S[1]*Y;X[0]=ca[0]+ia;X[1]=ca[1]+ma;return X}const ea=Object.freeze(Object.defineProperty({__proto__:null,add:l,angle:P,ceil:d,copy:r,cross:z,dist:h,distance:h,div:c,divide:c,dot:C,equals:T,exactEquals:M,floor:f,inverse:t,len:v,length:v,lerp:D,max:g,min:p,mul:b,multiply:b,negate:B,normalize:w,projectAndScale:ba,random:H,rotate:K,round:x,scale:n,scaleAndAdd:e,set:k,sqrDist:u,sqrLen:y,squaredDistance:u,squaredLength:y,str:E,sub:m,subtract:m,transformMat2:G,transformMat2d:A,transformMat3:F,transformMat4:J},
Symbol.toStringTag,{value:"Module"}));a.add=l;a.angle=P;a.ceil=d;a.copy=r;a.cross=z;a.dist=h;a.distance=h;a.div=c;a.divide=c;a.dot=C;a.equals=T;a.exactEquals=M;a.floor=f;a.inverse=t;a.len=v;a.length=v;a.lerp=D;a.max=g;a.min=p;a.mul=b;a.multiply=b;a.negate=B;a.normalize=w;a.projectAndScale=ba;a.random=H;a.rotate=K;a.round=x;a.scale=n;a.scaleAndAdd=e;a.set=k;a.sqrDist=u;a.sqrLen=y;a.squaredDistance=u;a.squaredLength=y;a.str=E;a.sub=m;a.subtract=m;a.transformMat2=G;a.transformMat2d=A;a.transformMat3=
F;a.transformMat4=J;a.vec2=ea;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(a,q,r,k,l,m,b){class c{constructor(f,p){this.item=f;this.controller=p;this.promise=null}}class d{constructor(f){this._task=this._schedule=null;this._deferreds=new l;this._controllers=new l;this._processingItems=
new l;this._pausedSignal=b.signal(!1);this.concurrency=1;f.concurrency&&(this.concurrency=f.concurrency);this._queue=new k(f.peeker);this.process=f.process;const p=f.scheduler;f.priority&&p&&(this._task=p.registerTask(f.priority,this))}destroy(){this.clear();this._schedule=q.removeMaybe(this._schedule);this._task=q.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(f){(f=this._controllers.get(f))&&
f.abort()}clear(){this._queue.clear();const f=[];this._controllers.forEach(p=>f.push(p));this._controllers.clear();f.forEach(p=>p.abort());this._processingItems.clear();this._cancelNext()}forEach(f){this._deferreds.forEach((p,g)=>f(g))}get(f){return(f=this._deferreds.get(f))?f.promise:void 0}isOngoing(f){return this._processingItems.has(f)}has(f){return this._deferreds.has(f)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(f,p){const g=this.get(f);if(g)return g;
const x=new AbortController;let n=null;p&&(n=r.onAbort(p,()=>x.abort()));const e=()=>{h.remove();null!=n&&n.remove();this._removeItem(f);this._queue.remove(f);this._scheduleNext()},h=r.onAbortOrThrow(x.signal,()=>{const v=this._processingItems.get(f);v&&v.controller.abort();e();u.reject(r.createAbortError())}),u=r.createResolver();this._deferreds.set(f,u);this._controllers.set(f,x);u.promise.then(e,e);this._queue.push(f);this._scheduleNext();return u.promise}last(){return this._queue.last()}lastPromise(){const f=
this.last();return f?this.get(f):null}peek(){return this._queue.peek()}popLast(){const f=this._queue.popLast();f&&this._removeItem(f);return f}reset(){const f=[];this._processingItems.forEach(p=>f.push(p));this._processingItems.clear();for(const p of f)this._queue.push(p.item),p.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const f=[];for(;this._queue.length;)f.push(this._queue.pop());this.clear();return f}get running(){return!this._pausedSignal.value&&
0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(f){for(;!f.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),f.madeProgress()}_removeItem(f){this._deferreds.delete(f);this._controllers.delete(f);this._processingItems.delete(f)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=m.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<
this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(f,p){this._canProcessFulfillment(f)&&(this._scheduleNext(),this._deferreds.get(f.item).resolve(p))}_processError(f,p){this._canProcessFulfillment(f)&&(this._scheduleNext(),this._deferreds.get(f.item).reject(p))}_canProcessFulfillment(f){return this._deferreds.get(f.item)&&this._processingItems.get(f.item)===f?!0:!1}_process(f){if(null!=f){var p=new AbortController,
g=new c(f,p);this._processingItems.set(f,g);try{var x=this.process(f,p.signal)}catch(n){this._processError(g,n)}r.isPromiseLike(x)?(g.promise=x,x.then(n=>this._processResult(g,n),n=>this._processError(g,n))):this._processResult(g,x)}}get test(){return{update:f=>this.runTask(f)}}}a.QueueProcessor=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,q){class r{constructor(k=
l=>l.values().next().value){this._peeker=k;this._observable=new q.SimpleObservable;this._items=new Set}get length(){a.trackAccess(this._observable);return this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0!==this.length){for(var k of this._items);return k}}peek(){if(0!==this.length)return this._peeker(this._items)}push(k){this.contains(k)||(this._items.add(k),this._observable.notify())}contains(k){a.trackAccess(this._observable);return this._items.has(k)}pop(){if(0!==
this.length){var k=this.peek();this._items.delete(k);this._observable.notify();return k}}popLast(){if(0!==this.length){var k=this.last();this._items.delete(k);this._observable.notify();return k}}remove(k){this.contains(k)&&(this._items.delete(k),this._observable.notify())}filter(k){const l=this.length;this._items.forEach(m=>{k(m)||this._items.delete(m)});l!==this._items.size&&this._observable.notify();return this}*[Symbol.iterator](){a.trackAccess(this._observable);yield*this._items}}return r})},
"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,q){class r{constructor(k){this._observable=new q.SimpleObservable;this._map=new Map(k)}get size(){a.trackAccess(this._observable);return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(k){(k=this._map.delete(k))&&this._observable.notify();return k}entries(){a.trackAccess(this._observable);return this._map.entries()}forEach(k,
l){a.trackAccess(this._observable);this._map.forEach((m,b)=>k.call(l,m,b,this),l)}get(k){a.trackAccess(this._observable);return this._map.get(k)}has(k){a.trackAccess(this._observable);return this._map.has(k)}keys(){a.trackAccess(this._observable);return this._map.keys()}set(k,l){this._map.set(k,l);this._observable.notify();return this}values(){a.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){a.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}
return r})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,q,r,k){class l{constructor(m,b){this._observable=new k.SimpleObservable;this._value=m;this._equalityFunction=b}get value(){r.trackAccess(this._observable);return this._value}set value(m){this._equalityFunction(m,this._value)||(this._value=m,this._observable.notify())}mutate(m){m(this._value);this._observable.notify()}}a.signal=function(m,b=q.equalsShallow){return new l(m,
b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(a,q,r,k){const l=new k(0,0,0,0),m=new Map,b=[],c=[];class d{constructor(f){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=f.acquireTile;this.releaseTile=
f.releaseTile;this.tileInfoView=f.tileInfoView;null!=f.resampling&&(this.resampling=f.resampling);f.cachePolicy&&(this.cachePolicy=f.cachePolicy);f.coveragePolicy&&(this.coveragePolicy=f.coveragePolicy);null!=f.buffer&&(this.buffer=f.buffer);f.cacheSize&&(this._tileCache=new q(f.cacheSize,this.tileInfoView,p=>{this.releaseTile(p)}))}destroy(){this.tileIndex.clear()}update(f){const {resampling:p,tileIndex:g}=this,{scale:x,center:n,resolution:e}=f.state,{minScale:h,maxScale:u}=this.tileInfoView,v=!f.stationary&&
x>this._previousScale;this._previousScale=x;if(!p&&(x>h||x<u))this.tiles.length=0,this.clear();else if(f=this.tileInfoView.getTileCoverage(f.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:y,lodInfo:B}=f,{level:t}=B;this.tiles.length=0;g.forEach(D=>D.visible=!0);var w=0,C=0;if(0<y.length)for(const {row:D,colFrom:H,colTo:G}of y)for(var z=H;z<=G;z++){w++;const A=l.set(t,D,B.normalizeCol(z),B.getWorldForColumn(z)).id;let F=g.get(A);if(F)F.isReady?(m.set(A,F),C++):v||this._addParentTile(A,
m);else{if(this._tileCache?.has(A)){if(F=this._tileCache.pop(A),this.tileIndex.set(A,F),F.isReady){m.set(A,F);C++;continue}}else F=this.acquireTile(l),this.tileIndex.set(A,F);v||this._addParentTile(A,m)}}w=C===w;for(const [D,H]of g)m.has(D)||(l.set(D),C=this.tileInfoView.intersects(f,l),z="purge"===this.cachePolicy?l.level!==t:l.level>t,!C||!v&&w?!z&&C||b.push(H):H.isReady?z&&"purge"===this.cachePolicy&&this._hasReadyAncestor(l,t)?b.push(H):c.push(H):z&&b.push(H));for(const D of c)D.isReady&&m.set(D.key.id,
D);for(const D of b)this._tileCache?this._tileCache.add(D):this.releaseTile(D),g.delete(D.key.id);for(const D of m.values())this.tiles.push(D);for(const D of g.values())m.has(D.key.id)||(D.visible=!1);this._tileCache?.prune(t,n,e);r.pool.release(f);c.length=0;b.length=0;m.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:f}=this;for(const p of f.values())this.releaseTile(p);f.clear()}refresh(f){for(const p of this.tileIndex.values())this.tiles.includes(p)?f(p):b.push(p);for(const p of b)this.releaseTile(p),
this.tileIndex.delete(p.key.id);this._tileCache?.clear()}updateCacheSize(f){this._tileCache&&(this._tileCache.maxSize=f)}_addParentTile(f,p){let g=null;for(;;){f=this.tileInfoView.getTileParentId(f);if(!f)break;if(this.tileIndex.has(f)){if(g=this.tileIndex.get(f),g?.isReady){p.has(g.key.id)||p.set(g.key.id,g);break}}else if(this._tileCache?.has(f)&&(g=this._tileCache.pop(f),this.tileIndex.set(f,g),g?.isReady)){p.has(g.key.id)||p.set(g.key.id,g);break}}}_hasReadyAncestor(f,p){const g=a.create();this.tileInfoView.getTileBounds(g,
f,!0);for(const x of this.tileIndex.values())if(x.isReady&&x.key.level>=p&&x.key.level<f.level){const n=a.create();this.tileInfoView.getTileBounds(n,x.key,!0);if(a.contains(n,g))return!0}return!1}}return d})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(a){class q{constructor(r,k,l){this.maxSize=r;this._tileInfoView=k;this._removedFunc=l;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=
[]}has(r){return this._tilePerId.has(r)}get(r){return this._tilePerId.get(r)}pop(r){const k=this._tilePerId.get(r);if(k){var l=this._tileKeysPerLevel[k.key.level];this._tilePerId["delete"](r);for(let m=0;m<l.length;m++)if(l[m].id===r){l.splice(m,1);break}k.visible=!0;return k}}add(r){r.visible=!1;const k=r.key,l=k.id;this._tilePerId.has(l)||(this._tilePerId.set(l,r),r=k.level,this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(k))}prune(r,k,l){let m=this._tilePerId.size;
if(!(m<=this.maxSize)){for(var b=this._tileKeysPerLevel.length-1;m>this.maxSize&&0<=b;)b!==r&&(m=this._pruneAroundCenterTile(m,k,l,b)),b--;m>this.maxSize&&(m=this._pruneAroundCenterTile(m,k,l,r))}}_pruneAroundCenterTile(r,k,l,m){m=this._tileKeysPerLevel[m];if(!m||0===m.length)return r;const {size:b,origin:c}=this._tileInfoView.tileInfo,d=l*b[0],f=l*b[1],p=[0,0],g=[0,0];for(m.sort((x,n)=>{p[0]=c.x+d*(x.col+.5);p[1]=c.y-f*(x.row+.5);g[0]=c.x+d*(n.col+.5);g[1]=c.y-f*(n.row+.5);return a.squaredDistance(p,
k)-a.squaredDistance(g,k)});0<m.length&&(l=m.pop(),this._removeTile(l.id),r--,r!==this.maxSize););return r}_removeTile(r){const k=this._tilePerId.get(r);this._removedFunc&&k&&this._removedFunc(k);this._tilePerId["delete"](r)}}return q})},"esri/views/2d/layers/features/PipelineConnectionHandlers":function(){define(["exports"],function(a){class q{constructor(r){this._client=r;this.layerView=this._client.createInvokeProxy();this.container=this._client.createInvokeProxy("container");this.eventLog=this._client.createInvokeProxy("eventLog")}}
a.PipelineConnectionHandlers=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/Processor":function(){define("../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/diffUtils ../../../../core/support/UpdatingHandles ../../../../geometry/SpatialReference ../../../../layers/support/FieldsIndex ../../engine/webgl/mesh/MultiTileMeshData ../../engine/webgl/mesh/factories/FeatureMeshFactory ../../engine/webgl/mesh/factories/ResourceProxy ./processor/BinningStrategy ./processor/ClusterStrategy ./processor/FeatureUpdateStrategy ./support/AttributeStore ./support/ComputedAttributeStorage ../support/UpdateTracking2D ../../../support/QueueProcessor".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u){class v{constructor(y,B){this._connection=y;this._source=B;this._version=1;this._updatingHandles=new l.UpdatingHandles;this._queue=new u.QueueProcessor({concurrency:1,process:t=>this._process(t)});this._proxy=new f.ResourceProxy({fetch:(t,w)=>this._connection.layerView.fetch(t,w),fetchDictionary:(t,w)=>this._connection.layerView.fetchDictionary(t,w)});this._attributeStore=new n.AttributeStore({type:"remote",initialize:t=>r.ignoreAbortErrors(this._connection.container.initializeAttributeView(t)),
update:t=>r.ignoreAbortErrors(this._connection.container.updateAttributeView(t)),render:()=>r.ignoreAbortErrors(this._connection.container.requestRender())});this._updateTracking=new h.UpdateTracking2D({debugName:"Processor"});this._updateTracking.addUpdateTracking("AttributeStore",this._attributeStore.updateTracking)}destroy(){this._proxy.destory();this._strategy?.destroy();this._attributeStore.destroy();this._updateTracking.destroy()}get aggregateQueryEngine(){return this._strategy?.aggregateQueryEngine}get updateTracking(){return this._updateTracking}getDisplayFeatures(y){return this._strategy?
this._strategy.getDisplayFeatures(y):{features:[],aggregates:[]}}getFeatureObjectIdsForAggregate(y){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(y):[]}setHighlight(y){this._strategy?this._attributeStore.setHighlight(y.map(({objectId:B,highlightFlags:t})=>({objectId:B,highlightFlags:t,displayId:this._strategy?.getDisplayIds([B])[0]}))):this._attributeStore.setHighlight(y.map(({objectId:B,highlightFlags:t})=>({objectId:B,highlightFlags:t,displayId:-1})))}onSubscribe(y){this._strategy?.onSubscribe(y)}onUnsubscribe(y){this._strategy?.onUnsubscribe(y)}async update(y,
B,t,w,C){const z=y.processor,D=k.diff(this._schema,z);if(D||w){a("esri-2d-update-debug")&&console.debug(`Version[${this._version}] SymbolProcessor.update`,{changes:D,schema:z});this._schema=z;var H=y.source.service;y=m.fromJSON(y.source.dataFilter.outSpatialReference);var G=new e.ComputedAttributeStorage({fields:new b,spatialReference:y});await this._attributeStore.update(z.storage,G,H,y,B);this._strategy?.invalidateAttributeData();if(w||k.hasDiff(D,"mesh")){k.hasDiff(D,"mesh.strategy")&&await this._updateStrategy(z.mesh.strategy,
y,C);this._updateSortKey(G,"sortKey"in z.mesh?z.mesh.sortKey:null);if(k.hasDiff(D,"mesh.factory")||"dictionary"===z.mesh.factory.symbology.type)this._factory=await d.FeatureMeshFactory.create(G,this._proxy,z.mesh.factory,t);this._invalidate();this._version=B;this._attributeStore.incrementDisplayIdGeneration();return this._connection.container.updateRenderState(this._version)}}}async applyOverride(y){if(this._strategy){var B=this._strategy.applyOverride(y);for await(const t of B)try{await this._process(t)}catch(w){}this._source.applyOverride(y)}}async updateChunks(){return this._updatingHandles.addPromise(this._doUpdateChunks())}async _doUpdateChunks(){if(this._strategy){var y=
this._strategy.updateChunks(),B=[];for await(const t of y)y=this._queue.push(t).catch(w=>r.throwIfNotAbortError(w)),B.push(y);try{await Promise.all(B)}catch(t){}}}async _updateStrategy(y,B,t){this._strategy?.destroy();switch(y.type){case "feature":this._strategy=new x.FeatureUpdateStrategy(this._source,this._attributeStore);break;case "binning":this._strategy=await p.BinningStrategy.create(y,B,this._source,this._attributeStore);break;case "cluster":this._strategy=await g.ClusterStrategy.create(this._connection,
y,B,this._source,this._attributeStore)}for(const w of t)this._strategy.onSubscribe(w)}async _updateSortKey(y,B){this._sortInfo=q.destroyMaybe(this._sortInfo?.computed);null!=B&&(y=B.byRenderer?null:await y.createComputedField(B),this._sortInfo={...B,computed:y})}_invalidate(){this._strategy&&this._strategy.invalidate()}async _process(y){const B=y.subscription;a("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Tile[${B.tile.key.id}, end=${y.end}] Processor._process`);await this._fetchResources(y);
r.throwIfAborted(B.signal);var t=await this._write(y,B.tile.arcadeEvaluationOptions);const {message:w,transferList:C}=t.serialize(B.tile.tileInfoView.tileInfo.isWrappable);t=y.createMessage(w,this._version);r.throwIfAborted(B.signal);await this._connection.container.onMessage(t,{signal:B.signal,transferList:C});a("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Tile[${B.tile.key.id}, end=${y.end}] Processor._process.await`)}async _fetchResources(y){await this._fetchMatcherResources(y);
await this._fetchWriterResources(y)}async _fetchMatcherResources(y){if(y.reader)return this._factory.enqueueMatcherRequests(this._proxy,y.reader)}async _fetchWriterResources(y){if(y.reader){var B=y.reader.getCursor();for(y=y.subscription.tile.arcadeEvaluationOptions;B.next();)this._factory.enqueueWriterRequests(this._proxy,B,y);await this._proxy.fetchEnqueuedResources()}}async _write(y,B){const t=y.subscription.tile;y=y.reader?.getCursor();var w=y?.getSize()??0;w=new c.MultiTileMeshData(t.key.id,
!0,w);if(!y)return w;const C=t.arcadeEvaluationOptions;for(;y.next();){const z=this._getSortKeyValue(y,B);w.entityStart(y.getDisplayId(),z);this._factory.write(w,this._proxy,y,C,t.level);w.entityEnd()}return w}_getSortKeyValue(y,B){if(!this._sortInfo)return 0;const {computed:t,order:w,byRenderer:C}=this._sortInfo;y=C?this._factory.getSortKey(y,B):t?.read(y,B);return null==y||isNaN(y)?0:y*("asc"===w?-1:1)}}return v})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor",
"../Collection","./utils"],function(a,q,r,k){function l(n){return n instanceof r?Object.keys(n.items):n instanceof q?k.getProperties(n).keys():n?Object.keys(n):[]}function m(n,e){return n instanceof r?n.items[e]:n[e]}function b(n,e){return Array.isArray(n)&&Array.isArray(e)?n.length!==e.length:!1}function c(n){return n?n.declaredClass:null}function d(n,e){const h=n.diff;if(h&&"function"===typeof h)return h(n,e);const u=l(n),v=l(e);if(0!==u.length||0!==v.length){if(!u.length||!v.length||b(n,e))return{type:"complete",
oldValue:n,newValue:e};var y=v.filter(w=>!u.includes(w)),B=u.filter(w=>!v.includes(w));B=u.filter(w=>v.includes(w)&&m(n,w)!==m(e,w)).concat(y,B).sort();if((y=c(n))&&x.has(y)&&B.length)return{type:"complete",oldValue:n,newValue:e};var t;y=n instanceof q&&e instanceof q;for(const w of B){B=m(n,w);const C=m(e,w);if((y||"function"!==typeof B&&"function"!==typeof C)&&B!==C&&(null!=B||null!=C)){if(h&&h[w]&&"function"===typeof h[w])B=h[w]?.(B,C);else if(B instanceof Date&&C instanceof Date){if(B.getTime()===
C.getTime())continue;B={type:"complete",oldValue:B,newValue:C}}else B="object"===typeof B&&"object"===typeof C&&c(B)===c(C)?d(B,C):{type:"complete",oldValue:B,newValue:C};null!=B&&(null!=t?t.diff[w]=B:t={type:"partial",diff:{[w]:B}})}}return t}}function f(n,e){if(null==n)return!1;e=e.split(".");for(const h of e){if("complete"===n.type)break;if("partial"===n.type){if(n=n.diff[h],!n)return!1}else return!1}return!0}function p(n,e){for(const h of e)if(f(n,h))return!0;return!1}function g(n){if(null==n)return!0;
switch(n.type){case "complete":return!1;case "collection":for(const e of n.added)if(!g(e))return!1;for(const e of n.removed)if(!g(e))return!1;for(const e of n.changed)if(!g(e))return!1;return!0;case "partial":for(const e in n.diff)if(!g(n.diff[e]))return!1;return!0}}const x=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);a.diff=function(n,e){if("function"!==typeof n&&"function"!==typeof e&&(null!=n||null!=
e))return null==n||null==e||"object"===typeof n&&"object"===typeof e&&c(n)!==c(e)?{type:"complete",oldValue:n,newValue:e}:d(n,e)};a.hasDiff=f;a.hasDiffAny=p;a.hasRootDiff=function(n,e){return f(n,e)};a.hasRootDiffAny=function(n,e){return p(n,e)};a.hasRootDiffOnly=function(n,e){return n?"partial"===n.type?(n=Object.keys(n.diff),1===n.length&&n[0]===e):!1:!1};a.isEmpty=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/support/UpdatingHandles":function(){define("exports ../../chunks/tslib.es6 ../Accessor ../handleUtils ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c){a.UpdatingHandles=class extends r{constructor(){super(...arguments);this.updating=!1;this._scheduleHandleId=this._handleId=0;this._pendingPromises=new Set}destroy(){this.removeAll()}add(d,f,p={}){return this._installWatch(d,f,p,l.watch)}addWhen(d,f,p={}){return this._installWatch(d,f,p,l.when)}addOnCollectionChange(d,f,{initial:p=!1,final:g=!1}={}){const x=++this._handleId;this.addHandles([l.on(d,"after-changes",this._createSyncUpdatingCallback(),l.sync),l.on(d,"change",
f,{onListenerAdd:p?n=>f({added:n.toArray(),removed:[]}):void 0,onListenerRemove:g?n=>f({added:[],removed:n.toArray()}):void 0})],x);return k.makeHandle(()=>this.removeHandles(x))}addPromise(d){if(null==d)return d;const f=++this._handleId;this.addHandles(k.makeHandle(()=>{this._pendingPromises.delete(d)&&(0!==this._pendingPromises.size||this.hasHandles(-42)||this._set("updating",!1))}),f);this._pendingPromises.add(d);this._set("updating",!0);const p=()=>this.removeHandles(f);d.then(p,p);return d}removeAll(){this._pendingPromises.clear();
this.removeAllHandles();this._set("updating",!1)}_installWatch(d,f,p={},g){const x=++this._handleId;p.sync||this._installSyncUpdatingWatch(d,x);d=g(d,f,p);this.addHandles(d,x);return k.makeHandle(()=>this.removeHandles(x))}_installSyncUpdatingWatch(d,f){const p=this._createSyncUpdatingCallback();d=l.watch(d,p,{sync:!0,equals:()=>!1});this.addHandles(d,f);return d}_createSyncUpdatingCallback(){return()=>{this.removeHandles(-42);++this._scheduleHandleId;const d=this._scheduleHandleId;this._get("updating")||
this._set("updating",!0);this.addHandles(m.schedule(()=>{d===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this.removeHandles(-42))}),-42)}}};q.__decorate([b.property({readOnly:!0})],a.UpdatingHandles.prototype,"updating",void 0);a.UpdatingHandles=q.__decorate([c.subclass("esri.core.support.UpdatingHandles")],a.UpdatingHandles);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define("../../core/Error ../../core/JSONSupport ../../core/Logger ../../core/MapUtils ../../core/sql/UnknownTimeZone ./fieldUtils ../../time/timeZoneUtils ../../chunks/datetime".split(" "),
function(a,q,r,k,l,m,b,c){function d(n){return n.trim().toLowerCase()}function f(n){const e=new Map;if(!n.fields)return e;const h=!0===n.datesInUnknownTimezone,{timeInfo:u,editFieldsInfo:v}=n;var y=(u?"startField"in u?u.startField:u.startTimeField:"")??"";const B=(u?"endField"in u?u.endField:u.endTimeField:"")??"",t="dateFieldsTimeZone"in n?n.dateFieldsTimeZone??null:n.dateFieldsTimeReference?b.fromTimeReference(n.dateFieldsTimeReference):null,w=v?"timeZone"in v?v.timeZone??t:v.dateFieldsTimeReference?
b.fromTimeReference(v.dateFieldsTimeReference):t??b.utc:null,C=u?"timeZone"in u?u.timeZone??t:u.timeReference?b.fromTimeReference(u.timeReference):t:null;y=new Map([[d(v?.creationDateField??""),w],[d(v?.editDateField??""),w],[d(y),C],[d(B),C]]);for(const {name:z,type:D}of n.fields)x.has(D)?e.set(z,b.unknown):"date"!==D&&"esriFieldTypeDate"!==D?e.set(z,null):h?e.set(z,b.unknown):(n=y.get(d(z??""))??t,e.set(z,n));return e}const p=new Map;class g{static fromJSON(n){return new g(n.fields,n.timeZoneByFieldName)}static fromLayer(n){return new g(n.fields??
[],f(n))}static fromLayerJSON(n){return new g(n.fields??[],f(n))}constructor(n=[],e){this._fieldsMap=new Map;this._normalizedFieldsMap=new Map;this._dateFieldsSet=new Set;this._numericFieldsSet=new Set;this._requiredFields=null;this.dateFields=[];this.numericFields=[];this.fields=n||[];this._timeZoneByFieldName=e?new Map(e):null;n=[];for(const h of this.fields){e=h?.name;const u=m.normalizeFieldName(e)?.toLowerCase()??"";if(e&&u){const v=d(e);this._fieldsMap.set(e,h);this._fieldsMap.set(v,h);this._normalizedFieldsMap.set(u,
h);n.push(`${v}:${h.type}:${this._timeZoneByFieldName?.get(e)}`);m.isDateField(h)?(this.dateFields.push(h),this._dateFieldsSet.add(h)):m.isNumericField(h)&&(this._numericFieldsSet.add(h),this.numericFields.push(h));m.isObjectIDField(h)||m.isGlobalIDField(h)||(h.editable=null==h.editable||!!h.editable,h.nullable=null==h.nullable||!!h.nullable)}}n.sort();this.uid=n.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const n of this.fields)m.isObjectIDField(n)||m.isGlobalIDField(n)||
n.nullable||void 0!==m.getFieldDefaultValue(n)||this._requiredFields.push(n)}return this._requiredFields}equals(n){return this.uid===n?.uid}has(n){return null!=this.get(n)}get(n){if(n){var e=this._fieldsMap.get(n);if(e)return e;(e=this._fieldsMap.get(d(n))??this._normalizedFieldsMap.get(m.normalizeFieldName(n)?.toLowerCase()??""))&&this._fieldsMap.set(n,e);return e}}getTimeZone(n){n=this.get(n&&"string"!==typeof n?n.name:n);return n?this._timeZoneByFieldName?this._timeZoneByFieldName.get(n.name):
"date"===n.type||"esriFieldTypeDate"===n.type?(r.getLogger("esri.layers.support.FieldsIndex").error(new a("getTimeZone:no-timezone-information",`no time zone information for field '${n.name}'`)),b.utc):x.has(n.type)?b.unknown:null:null}getLuxonTimeZone(n){const e=this.getTimeZone(n);return e?e===b.unknown?l.UnknownTimeZone.instance:e===b.utc?c.FixedOffsetZone.utcInstance:k.getOrCreateMapValue(p,e,()=>c.IANAZone.create(e)):null}isDateField(n){return this._dateFieldsSet.has(this.get(n))}isTimeOnlyField(n){return m.isTimeOnlyField(this.get(n))}isNumericField(n){return this._numericFieldsSet.has(this.get(n))}normalizeFieldName(n){return this.get(n)?.name??
void 0}toJSON(){return{fields:this.fields.map(n=>q.isSerializable(n)?n.toJSON():n),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}const x=new Set("time-only date-only timestamp-offset esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "));return g})},"esri/core/sql/UnknownTimeZone":function(){define(["exports","../../chunks/datetime"],function(a,q){function r(l){return l instanceof q.Zone?l===k.instance?!0:!1:"unknown"===
l?.toString().toLowerCase()?!0:!1}class k{}k.instance=new q.IANAZone("Etc/UTC");a.UnknownTimeZone=k;a.adoptTimeZone=function(l,m){return q.DateTime.fromObject({day:l.day,year:l.year,month:l.month,hour:l.hour,minute:l.minute,second:l.second,millisecond:l.millisecond},{zone:m})};a.isUnknownTimeZone=r;a.substituteUnknownTimezone=function(l){return r(l)?k.instance:l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MultiTileMeshData":function(){define("exports ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ./MeshData ../../../layers/features/support/tileUtils".split(" "),
function(a,q,r,k,l,m,b,c){function d(g){switch(g){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function f(g){switch(g){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class p{constructor(g,x,n=0){this.tileKey=g;this._bufferingEnabled=x;this._sizeHint=n;this._meshes={self:new b.MeshData(this.id,this._sizeHint),neighbors:[]};this._currentEntityOverlaps=this._currentRecordOverlaps=0}get id(){return this.tileKey}vertexCount(){return this._meshes.self.vertexCount()}indexCount(){return this._meshes.self.indexCount()}indexEnsureSize(g){this._meshes.self.indexEnsureSize(g)}entityStart(g,
x=g){this._currentEntityOverlaps=0;this._meshes.self.entityStart(g,x)}entityRecordCount(){return this._meshes.self.entityRecordCount()}entityEnd(){this._meshes.self.entityEnd();if(this._bufferingEnabled)for(let g=0;8>g;g++)this._currentEntityOverlaps&1<<g&&this._meshes.neighbors[g].entityEnd()}recordStart(g,x,n){this._currentRecordOverlaps=0;this._meshes.self.recordStart(g,x,n)}recordEnd(g){return(g=this._meshes.self.recordEnd(this._currentRecordOverlaps))&&0!==this._currentRecordOverlaps?(this._copyIntoNeighbors(),
this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):g}recordBounds(g,x,n,e){this._bufferingEnabled&&this._addOverlap(g,x,n,e)}recordCount(){return this._meshes.self.recordCount()}metricStart(g){this._meshes.self.metricStart(g)}metricBoxWrite(g){this._meshes.self.metricBoxWrite(g)}metricEnd(){this._meshes.self.metricEnd()}vertexWrite(g){this._meshes.self.vertexWrite(g)}vertexWriteF32(g){this._meshes.self.vertexWriteF32(g)}vertexWriteRegion(g){this._meshes.self.vertexWriteRegion(g)}indexWrite(g){this._meshes.self.indexWrite(g)}serialize(g){const x=
{message:[],transferList:[]},n=this._meshes.self.serialize();x.message.push({tileId:this.tileKey,...n.message});x.transferList.push(...n.transferList);this._meshes.neighbors.forEach((e,h)=>{e=e.serialize();var u=1<<h;h=d(u);u=f(u);h=c.getPow2NeighborKey(new r(this.tileKey),h,u,g);x.message.push({tileId:h.id,...e.message});x.transferList.push(...e.transferList)});return x}_addOverlap(g,x,n,e){this._currentRecordOverlaps|=255^((g<0+n?148:g>=m.tileSize-n?41:189)|(x<0+e?224:x>=m.tileSize-e?7:231))}_copyIntoNeighbors(){for(let x=
0;8>x;x++){var g=1<<x;if(this._currentRecordOverlaps&g){this._meshes.neighbors[x]||(this._meshes.neighbors[x]=new b.MeshData(g,Math.floor(this._sizeHint/16)));const n=this._meshes.neighbors[x],e=-d(g)*m.tileSize;g=-f(g)*m.tileSize;n.copyLastFrom(this._meshes.self,e,g)}}}}a.MultiTileMeshData=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],
function(a,q,r,k,l){class m{constructor(b,c=0){this._id=b;this._sizeHint=c;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=0;this._instanceIdToVertexData=new Map;this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new l(Uint32Array,this._sizeHint*q.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const b=
[],c=[],d=this._entities.buffer();for(const f of this._instanceIdToVertexData.values())c.push(f.serialize(b));return{message:{data:c,entities:d},transferList:b}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(b){this._current.writer.vertexEnsureSize(b)}indexEnsureSize(b){this._current.writer.indexEnsureSize(b)}vertexWrite(b){this._current.writer.writeVertex(b)}vertexWriteRegion(b){this._current.writer.writeVertexRegion(b)}vertexWriteF32(b){this._current.writer.writeVertexF32(b)}recordBounds(b,
c,d,f){}indexWrite(b){this._current.writer.writeIndex(b)}metricStart(b){this._current.metric=b}metricEnd(){this._current.metric.bounds.length&&this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(b){this._current.metric.bounds.push(b)}entityStart(b,c=b){this._entityIdIndex=this._entities.push(b);this._entitySortKeyIndex=this._entities.push(c);this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===
this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(b,c,d=0){this._current.writer=this._getVertexWriter(b,c);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=b;this._current.layoutHash=c.hash;this._current.textureKey=d}recordEnd(b=0){const c=this._current.vertexStart,
d=this._current.writer.vertexCount-c;if(!d)return!1;const f=this._current.indexStart,p=this._current.writer.indexCount-f;this._entities.incr(this._entityRecordCountOffset);r.write(this._entities,this._current.instanceId,this._current.textureKey,f,p,c,d,b);return!0}copyLastFrom(b,c,d){var f=b._entities.getValue(b._entityIdIndex),p=this._entities.getValue(this._entityIdIndex);f!==p&&(p=b._entities.getValue(b._entitySortKeyIndex),this.entityStart(f,p));this.recordStart(b._current.instanceId,b._current.writer.layout,
b._current.textureKey);f=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;var g=this._current.vertexStart,x=b._current.vertexStart-g;const n=this._current.writer.indexWriter;p=this._current.writer.vertexWriter;const e=b._current.writer.indexWriter;var h=b._current.writer.vertexWriter;for(let u=b._current.indexStart;u!==e.length;u++){const v=e.getValue(u);n.push(v-x)}for(b=b._current.vertexStart*f;b!==h.length;b++)x=h.getValue(b),p.push(x);b=this._current.writer.layout.position;h=b.packPrecisionFactor??
1;b=b.offset/Uint32Array.BYTES_PER_ELEMENT;c*=h;d*=h;for(g*=f;g<=p.length;g+=f)p.i1616Add(g+b,c,d);this.recordEnd()}_getVertexWriter(b,c){const {stride:d}=c,f=this._instanceIdToVertexData;f.has(b)||f.set(b,new k.VertexDataWriter(b,c,d,this._sizeHint));return f.get(b)}}a.MeshData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(a,q){class r{constructor(k,l){this.id=
k;this.sortKey=l;this.records=[]}serialize(k){k.push(this.id);k.push(this.sortKey);q.serializeList(k,this.records);return k}static deserialize(k){var l=k.readInt32();const m=k.readInt32();l=new r(l,m);l.records=q.deserializeList(k,a)??[];return l}}r.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+a.byteSizeHint;return r})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class a{constructor(q,r,k,l,m,b,c){this.instanceId=q;this.textureKey=r;this.indexStart=k;this.indexCount=l;
this.vertexStart=m;this.vertexCount=b;this.overlaps=c}updateBaseOffsets(q){this.vertexStart+=q.vertexFrom;this.indexStart+=q.indexFrom}clone(){return new a(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(q,r,k,l,m,b,c,d){q.push(r);q.push(k);q.push(l);q.push(m);q.push(b);q.push(c);q.push(d)}serialize(q){q.push(this.instanceId);q.push(this.textureKey);q.push(this.indexStart);q.push(this.indexCount);q.push(this.vertexStart);
q.push(this.vertexCount);q.push(this.overlaps);return q}static deserialize(q){const r=q.readInt32(),k=q.readInt32(),l=q.readInt32(),m=q.readInt32(),b=q.readInt32(),c=q.readInt32();q=q.readInt32();return new a(r,k,l,m,b,c,q)}}a.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return a})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(a){a.deserializeList=function(q,r,k){var l=q.readInt32();l=Array(l);for(let m=0;m<l.length;m++)l[m]=r.deserialize(q,k);return l};
a.serializeList=function(q,r){if(null===r)q.push(0);else{q.push(r.length);for(const k of r)k.serialize(q);return q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(a,q){class r{constructor(k,l,m,b=0){const c=6*b*Uint32Array.BYTES_PER_ELEMENT;b=4*b*m;m/=4;const d=l.attributes.find(f=>"pos"===f.name||"position"===f.name);if(!d)throw Error("InternalError: Unable to find position attribute");
this.layout={...l,position:d};this._indices=new q(Uint32Array,c);this._vertices=new q(Uint32Array,b);this._metrics=new q(Uint32Array,0);this._metricCountOffset=this._metrics.push(0);this._strideInt=m;this._instanceId=k}serialize(k){const l=this._indices.buffer(),m=this._vertices.buffer(),b=this._metrics.length?this._metrics.buffer():null;k.push(l,m);return{instanceId:this._instanceId,layout:this.layout,indices:l,vertices:m,metrics:b}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/
this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(k){this._vertices.ensureSize(k)}indexEnsureSize(k){this._indices.ensureSize(k)}writeIndex(k){this._indices.push(k)}writeVertex(k){this._vertices.push(k)}writeVertexRegion(k){this._vertices.writeRegion(k)}writeVertexF32(k){this._vertices.writeF32(k)}writeMetric(k){this._metrics.incr(this._metricCountOffset);
k.serialize(this._metrics)}}a.VertexDataWriter=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class a{get length(){return this._pos}constructor(q,r){this._pos=0;r=r?this._roundToNearest(r,q.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(r);this._buffer=new q(this._array);this._ctor=q;this._i16View=new Int16Array(this._array)}_roundToNearest(q,r){q=Math.round(q);return 1===r?q:q+(r-q%r)}_ensureSize(q){if(this._pos+
q>=this._buffer.length){q=this._roundToNearest(1.25*(this._array.byteLength+q*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);q=new ArrayBuffer(q);const r=new this._ctor(q);r.set(this._buffer,0);this._array=q;this._buffer=r;this._i16View=new Int16Array(this._array)}}ensureSize(q){this._ensureSize(q)}writeF32(q){this._ensureSize(1);const r=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=q;this._pos++;return r}push(q){this._ensureSize(1);const r=this._pos;this._buffer[this._pos++]=
q;return r}writeFixed(q){this._buffer[this._pos++]=q}setValue(q,r){this._buffer[q]=r}i1616Add(q,r,k){this._i16View[2*q]+=r;this._i16View[2*q+1]+=k}getValue(q){return this._buffer[q]}incr(q){if(this._buffer.length<q)throw Error("Increment index overflows the target buffer");this._buffer[q]++}decr(q){this._buffer[q]--}writeRegion(q){this._ensureSize(q.length);const r=this._pos;this._buffer.set(q,this._pos);this._pos+=q.length;return r}writeManyFrom(q,r,k){for(this._ensureSize(k-r);r!==k;r++)this.writeFixed(q._buffer[r])}buffer(){const q=
this._array.slice(0,4*this._pos);this.destroy();return q}toArray(){return[...this._buffer]}seek(q){this._pos=q}destroy(){this._buffer=this._array=null}}return a})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(a){a.getPow2NeighborKey=function(q,r,k,l){q=q.clone();const m=1<<q.level;r=q.col+r;k=q.row+k;l&&0>r?(q.col=r+m,--q.world):r>=m?(q.col=r-m,q.world+=1):q.col=r;q.row=k;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/FeatureMeshFactory":function(){define(["exports",
"./MeshFactory","../../util/createMatcher"],function(a,q,r){class k extends q.AMeshFactory{static async create(l,m,b,c){const d=await r.createMatcher(l,m,b.symbology,c);l=b.labels?await r.createMatcher(l,m,b.labels,c):null;return new k(d,l)}constructor(l,m){super();this._symbology=l;this._labels=m}destroy(){}async enqueueMatcherRequests(l,m){await Promise.all([this._symbology.fetchResources(l,m),this._labels?.fetchResources(l,m)])}enqueueWriterRequests(l,m,b){var c=this._symbology.match(m,b);if(c){for(const d of c)d.enqueueRequest(l,
m,b);if(this._labels&&(c=this._labels.match(m,b)))for(const d of c)d.enqueueRequest(l,m,b)}}write(l,m,b,c,d){const f=this._symbology.match(b,c);if(f){for(var p of f)p.write(l,m,b,c,d);if(1<=l.entityRecordCount()&&this._labels&&(p=this._labels.match(b,c)))for(const g of p)g.setReferences(f),g.write(l,m,b,c,d)}}getSortKey(l,m){return this._symbology.getSortKey(l,m)}}a.FeatureMeshFactory=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/MeshFactory":function(){define(["exports"],
function(a){class q{}a.AMeshFactory=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/createMatcher":function(){define("exports ./DictionaryMatcher ./IntervalMatcher ./LabelMatcher ./MapMatcher ./Matcher".split(" "),function(a,q,r,k,l,m){async function b(f,p,g,x){switch(g.type){case "simple":case "heatmap":case "dot-density":case "pie-chart":return m.FeatureMatcher.from(f,p,g,x);case "interval":return r.IntervalMatcher.fromIntervalSchema(f,p,g,x);case "dictionary":return q.DictionaryMatcher.fromDictionaryRenderer(f,
g,x);case "label":return k.LabelMatcher.fromLabelSchema(f,p,g,x);case "map":return l.MapMatcher.fromMatcherSchema(f,p,g,x);case "subtype":return c.fromSubtypes(f,p,g,x);case "cluster":return d.fromClusterSchema(f,p,g,x);default:throw Error("Impl");}}class c extends m.FeatureMatcher{constructor(f,p){super();this._subMatchers=f;this._subtypeField=p}static async fromSubtypes(f,p,g,x){const n=new Map,e=[];for(const h in g.renderers){const u=parseInt(h,10),v=b(f,p,g.renderers[h],x).then(y=>n.set(u,y));
e.push(v)}await Promise.all(e);return new c(n,g.subtypeField)}match(f,p){var g=f.readAttribute(this._subtypeField);return(g=this._subMatchers.get(g))?g.match(f,p):null}}class d extends m.FeatureMatcher{static async fromClusterSchema(f,p,g,x){const [n,e]=await Promise.all([b(f,p,g.feature,x),b(f,p,g.cluster,x)]);return new d(n,e)}constructor(f,p){super();this._featureMatcher=f;this._clusterMatcher=p}match(f,p){return 1===f.readAttribute("cluster_count")?this._featureMatcher.match(f,p):this._clusterMatcher.match(f,
p)}}a.ClusterMatcher=d;a.SubtypeMatcher=c;a.createMatcher=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/DictionaryMatcher":function(){define(["exports","../shaderGraph/techniques/mesh/createMeshWriter","./Matcher"],function(a,q,r){class k extends r.FeatureMatcher{static async fromDictionaryRenderer(l,m,b){return new k(l,m,b)}constructor(l,m,b){super();this._storage=l;this._schema=m;this._viewParams=b;this._hashToGroup=new Map}get fieldMap(){return this._schema.fieldMap}async fetchResources(l,
m){m=m.getCursor();const b=[];for(;m.next();)b.push(this._updateMeshWriterGroup(l,m));await Promise.all(b)}match(l,m){l=l.getAttributeHash();return this._hashToGroup.get(l)}async _updateMeshWriterGroup(l,m){var b=m.readLegacyFeatureForDisplay();m=m.getAttributeHash();!this._hashToGroup.has(m)&&(this._hashToGroup.set(m,null),b=await l.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:b}))&&(l=await q.createMeshWriterGroupFromSchema(this._storage,l,b.meshes,this._viewParams),this._hashToGroup.set(m,
l))}}a.DictionaryMatcher=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/createMeshWriter":function(){define(["exports","./instanceIdUtils","./MeshWriterInputEvaluator","./MeshWriterRegistry"],function(a,q,r,k){async function l(m,b,c,d,f,p,g){c=k.meshWriterRegistry[c];m=await r.MeshWriterInputEvaluator.create(m,b,f);d=new c.constructor(d,m,p,g);await d.loadDependencies();return d}a.createMeshWriter=l;a.createMeshWriterDirect=
async function(m,b,c,d,f,p){m=await r.MeshWriterInputEvaluator.create(m,b,f);c=new c(d,m,p,f.params.effects?.effectInfos);await c.loadDependencies();return c};a.createMeshWriterGroupFromSchema=async function(m,b,c,d){return Promise.all(c.map(f=>l(m,b,f.meshWriterName,q.castStrictInstanceId(f.id),f.options,d,f.optionalAttributes)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils":function(){define(["exports"],
function(a){a.castInstanceId=function(q){return q};a.castStrictInstanceId=function(q){return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../grouping ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),function(a,
q,r,k,l,m,b,c){async function d(n,e){const {defaultValue:h,valueExpressionInfo:u,value:v}=e;if(u){const {expression:y}=u;return(n=await n.createComputedField({expression:y}))?{...e,computed:n,defaultValue:h}:null}return{...e,computed:new c.DictionaryValue(v),defaultValue:h}}async function f(n,e){const {defaultValue:h,valueExpressionInfo:u}=e,{expression:v}=u;return(n=await n.createComputedField({expression:v}))?{...e,computed:n,defaultValue:h}:null}const p=n=>"boolean"!==typeof n&&"number"!==typeof n&&
"valueExpressionInfo"in n,g=n=>n.some(e=>{for(const h in e)if(p(e[h]))return!0;return!1});class x{static async create(n,e,h){const u={},v=new Map,y=new Map,B=new Map,t=new Map,w=new Map;for(const D in h.params){var C=h.params[D];if(null==C||"object"!==typeof C)u[D]=C;else if(Array.isArray(C)){if("object"===typeof C[0])throw Error(`InternalError: Cannot handle ${D}. Nested array params are not supported`);u[D]=C}else if("valueExpressionInfo"in C)if(C.value)u[D]=C.value;else{var z=await f(n,C);z?(v.set(D,
z),u[D]=null):u[D]=C.defaultValue}else switch(C.type){case "cim-effect-infos":if(C.effectInfos.some(H=>H.overrides.length)){y.set(D,{effects:await Promise.all(C.effectInfos.map(async H=>{const G=H.overrides.map(A=>d(n,A));return{effect:H.effect,compiledOverrides:(await Promise.all(G)).filter(q.isSome)}}))});break}u[D]=C.effectInfos.map(H=>H.effect);break;case "cim-marker-placement-info":C.overrides.length&&B.set(D,{placementInfo:C,compiledOverrides:(await Promise.all(C.overrides.map(H=>d(n,H)))).filter(q.isSome)});
u[D]=C.placement;break;case "sprite-rasterization-param":case "text-rasterization-param":if(C.overrides.length){z=C.overrides.map(H=>d(n,H));t.set(D,{compiledOverrides:(await Promise.all(z)).filter(q.isSome),rasterizationParam:C,objectIdToResourceId:new Map});continue}if("sprite-rasterization-param"===C.type&&"animated"===C.resource.type){t.set(D,{compiledOverrides:[],rasterizationParam:C,objectIdToResourceId:new Map});continue}u[D]=await e.fetchResourceImmediate({type:"cim-rasterization-info",resource:C.resource})??
null;break;case "cim-marker-transform-param":({params:C}=C);if(g(C)){const H={compiledMarkerInfos:[]};await Promise.all(C.map(async G=>{const A={props:{}};for(const F in G)if(p(G[F])){const J=await f(n,G[F]);A.compiledExpressionMap||(A.compiledExpressionMap=new Map);const K=A.compiledExpressionMap;J&&K.set(F,J)}else A.props[F]=G[F];H.compiledMarkerInfos.push(A)}));w.set(D,H)}else u[D]={type:"cim-marker-transform-info",infos:C};break;default:u[D]=C}}return new x(h,u,v,y,B,t,w)}constructor(n,e,h,u,
v,y,B){this.inputMeshParams=n;this._resolvedMeshParams=e;this._dynamicProperties=h;this._dynamicEffectProperties=u;this._dynamicPlacementProperties=v;this._dynamicAsyncProperties=y;this._dynamicTransformProperties=B;this.evaluator=t=>t}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||
(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(n,e,h){for(const v of this._dynamicAsyncProperties.values()){var u=k.clone(v.rasterizationParam.resource);"animated"===v.rasterizationParam.resource.type&&v.rasterizationParam.resource.randomizeStartTime&&(u.startGroup=m.getStartGroup(e.getObjectId()||0));for(const {primitiveName:y,propertyName:B,computed:t,defaultValue:w,valueExpressionInfo:C}of v.compiledOverrides)try{b.applyComputedValue(u,
y,B,t,e,h,w)}catch(z){l.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new r("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${C?.expression}' (primitive: '${y}', property: '${B}')`,z))}u=n.enqueueRequest({type:"cim-rasterization-info",resource:u});v.objectIdToResourceId.set(e.getObjectId(),u)}}evaluateMeshParams(n,e,h){for(const [y,B]of this._dynamicProperties.entries())this._resolvedMeshParams[y]=B.computed.readWithDefault(e,
h,B.defaultValue);for(const [y,B]of this._dynamicPlacementProperties.entries())for(const {computed:t,defaultValue:w,propertyName:C}of B.compiledOverrides){var u=t.readWithDefault(e,h,w);B.placementInfo.placement[C]=u;this._resolvedMeshParams[y]=B.placementInfo.placement}for(const [y,B]of this._dynamicEffectProperties.entries())for(var v of B.effects){for(const {computed:t,defaultValue:w,propertyName:C}of v.compiledOverrides)u=t.readWithDefault(e,h,w),v.effect[C]=u;this._resolvedMeshParams[y]=B.effects.map(t=>
t.effect)}for(const [y,B]of this._dynamicTransformProperties.entries()){v={type:"cim-marker-transform-info",infos:[]};for(const t of B.compiledMarkerInfos){u={...t.props};if(t.compiledExpressionMap)for(const [w,C]of t.compiledExpressionMap){const z=C.computed.readWithDefault(e,h,C.defaultValue);u[w]="number"===typeof z||"boolean"===typeof z?z:C.defaultValue}v.infos.push(u)}this._resolvedMeshParams[y]=v}for(const [y,B]of this._dynamicAsyncProperties.entries())h=B.objectIdToResourceId.get(e.getObjectId()),
null!=h&&(h=n.getResource(h),this._resolvedMeshParams[y]=h);this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}}a.MeshWriterInputEvaluator=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(a,q){function r(k,l){if("string"===typeof k)k=q.numericHash(k+`-seed(${l})`);else{let m=12;k^=l;do k=107*(k>>8^k)+m|0;while(0!==--m)}return(1+k/-2147483648)/
2}a.getRandomValue=r;a.getStartGroup=function(k){return Math.floor(10*r(k,53290320))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(a,q){function r(k,l,m,b,c,d,f){if(k.primitiveName===l)for(const p in k)if(p===m){l=b?.readWithDefault(c,d,k[p]&&f);"text"===k.type&&(l=l.toString());k[p]=l;return}if("type"in k&&null!=k.type)switch(k.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(k.symbolLayers)for(const p of k.symbolLayers)r(p,
l,m,b,c,d,f);break;case "CIMHatchFill":k.lineSymbol&&r(k.lineSymbol,l,m,b,c,d,f);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if("CIMVectorMarker"===k.type&&k.markerGraphics)for(const p of k.markerGraphics)r(p,l,m,b,c,d,f),r(p.symbol,l,m,b,c,d,f)}}a.applyComputedValue=r;a.vertexLayoutHash=function(k){k=k.map(({name:l,count:m,type:b})=>`${l}.${m}.${b}`).join(",");return q.numericHash(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports",
"./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(k){super();this._value=k}resize(k){}read(k,l){return this._value}readWithDefault(k,l,m){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}a.DictionaryValue=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(a){class q{destroy(){}}a.AComputedField=q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){q={FillMeshWriter:l.FillMeshWriter,DotDensityMeshWriter:q.DotDensityMeshWriter,ComplexFillMeshWriter:r.ComplexFillMeshWriter,PatternFillMeshWriter:b.PatternFillMeshWriter,OutlineFillMeshWriter:m.OutlineFillMeshWriter,PatternOutlineFillMeshWriter:c.PatternOutlineFillMeshWriter,ComplexOutlineFillMeshWriter:k.ComplexOutlineFillMeshWriter,MarkerMeshWriter:x.MarkerMeshWriter,PieChartMeshWriter:n.PieChartMeshWriter,TextMeshWriter:e.TextMeshWriter,LineMeshWriter:p.LineMeshWriter,
TexturedLineMeshWriter:g.TexturedLineMeshWriter,HeatmapMeshWriter:d.HeatmapMeshWriter,LabelMeshWriter:f.LabelMeshWriter};r={};for(const h in q)r[h]={name:h,constructor:q[h]};a.meshWriterRegistry=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(a,q,r){const k={createComputedParams:m=>m,attributes:{id:{type:r.DataType.UNSIGNED_BYTE,
count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},pos:{type:r.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:r.DataType.FLOAT,count:1,packTessellation:({inverseArea:m})=>m}}};class l extends q.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}createTesselationParams(m){return{inverseArea:1/m.readGeometryArea()}}}a.DotDensityMeshWriter=l;a.dotDensityVertexSpec=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports",
"../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(a,q,r,k,l){const m=q("featurelayer-fast-triangulation-enabled");class b extends l.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),r.loadLibtess()])}_write(c,d,f){f=f?.asOptimized()??d.readGeometryForDisplay();if(f=this._clip(f))c.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(c,d,f),c.recordEnd()}_clip(c){return c?
k.clipMarshall(c,this.hasEffects?256:8):null}_writeGeometry(c,d,f){const p=100<f.maxLength,g=[],x=this.createTesselationParams(d);!p&&m&&k.triangulate(g,f)?g.length&&this._writeVertices(c,d,f.coords,x,g):(f=k.triangulateLibtess(f),this._writeVertices(c,d,f,x))}_writeVertices(c,d,f,p,g){const x=d.getDisplayId();d=c.vertexCount();const n=this.hasEffects;let e=0;if(g)for(var h of g){g=f[2*h];var u=f[2*h+1];n&&c.recordBounds(g,u,0,0);this._writeVertex(c,x,g,u,p);e++}else for(h=0;h<f.length;h+=2)g=Math.round(f[h]),
u=Math.round(f[h+1]),n&&c.recordBounds(g,u,0,0),this._writeVertex(c,x,g,u,p),e++;c.indexEnsureSize(e);for(f=0;f<e;f++)c.indexWrite(f+d)}}a.AFillMeshWriter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(a,q,r,k,l,m,b){function c(g,x,n){let e=0;for(let h=1;h<n;h++)e+=(g[2*(x+h)]-g[2*(x+h-1)])*(g[2*(x+h)+1]+g[2*(x+h-1)+1]);return e}function d(g,x,n,e,h){let u=0;for(;n<e;n+=3){const v=2*(g[n]-h),y=2*(g[n+1]-h),B=2*(g[n+2]-h);u+=Math.abs((x[v]-x[B])*(x[y+1]-x[v+1])-(x[v]-x[y])*(x[B+1]-x[v+1]))}return u}const f=new k.TileClipper(0,0,0,1,0),p=new k.TileClipper(0,0,0,1,0);f.setExtent(m.tileSize);p.setExtent(m.tileSize);a.area=c;a.clipLinesMarshall=function(g,x){p.setPixelMargin(x);const n=-x;x=
m.tileSize+x;let e=[];var h=!1;if(!g.nextPath())return null;let u=!0;for(;u;){g.seekPathStart();const v=[];if(!g.pathSize)return null;p.reset(k.GeometryType.LineString);g.nextPoint();let y=g.x,B=g.y;if(h)p.moveTo(y,B);else{if(y<n||y>x||B<n||B>x){h=!0;continue}v.push({x:y,y:B})}let t=!1;for(;g.nextPoint();)if(y=g.x,B=g.y,h)p.lineTo(y,B);else{if(y<n||y>x||B<n||B>x){t=!0;break}v.push({x:y,y:B})}if(t)h=!0;else{if(h){if(h=p.resultWithStarts())for(const w of h)e.push(w)}else e.push({line:v,start:0});u=
g.nextPath();h=!1}}e=e.filter(v=>1<v.line.length);return 0===e.length?null:e};a.clipMarshall=function(g,x){if(null==g)return null;a:{var n=m.tileSize+128;var e=0;for(var h=0;h<g.lengths.length;h++){var u=g.lengths[h];for(var v=0;v<u;v++){const y=g.coords[2*(v+e)],B=g.coords[2*(v+e)+1];if(-128>y||y>n||-128>B||B>n){n=!0;break a}}e+=u}n=!1}if(!n)return g;f.setPixelMargin(x);f.reset(k.GeometryType.Polygon);x=0;for(n=0;n<g.lengths.length;n++){e=g.lengths[n];h=g.coords[2*(0+x)];u=g.coords[2*(0+x)+1];f.moveTo(h,
u);for(v=1;v<e;v++)h=g.coords[2*(v+x)],u=g.coords[2*(v+x)+1],f.lineTo(h,u);f.close();x+=e}n=f.result(!1);if(!n)return null;g=[];x=[];for(const y of n){n=0;for(const B of y)x.push(B.x),x.push(B.y),n++;g.push(n)}return new l(g,x)};a.triangleAreaArray=d;a.triangulate=function(g,x){const {coords:n,lengths:e,hasIndeterminateRingOrder:h}=x;if(h)return!1;x=0;for(var u=0;u<e.length;){let B=u,t=e[u];u=c(n,x,t);for(var v=[];++B<e.length;){var y=e[B];const w=c(n,x+t,y);if(!(0<w))break;u+=w;v.push(x+t);t+=y}y=
g.length;b.bufcut(g,n,x,x+t,v,2,0);v=d(g,n,y,g.length,0);u=Math.abs(u);if(1E-5<Math.abs((v-u)/Math.max(1E-7,u)))return g.length=0,!1;u=B;x+=t}return!0};a.triangulateEarcut=function(g,x,n){const {coords:e,lengths:h,hasIndeterminateRingOrder:u}=x;if(u)return!1;let v=0;for(var y=0;y<h.length;){let t=y,w=h[y];for(y=[];++t<h.length;){var B=h[t];if(!(0<c(e,v+w,B)))break;y.push(v+w-v);w+=B}B=x.coords.slice(2*v,2*(v+w));y=q.earcut(B,y,2);for(const C of y)g.push(C+n+v);y=t;v+=w}return!0};a.triangulateLibtess=
function(g){const {coords:x,lengths:n}=g;({buffer:g}=r.triangulate(x,n));return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(function(){class a{constructor(q=[],r=[],k=!1){this.lengths=q??[];this.coords=r??[];this.hasIndeterminateRingOrder=k}static fromRect(q){const [r,k,l,m]=q;q=l-r;const b=m-k;return new a([5],[r,k,q,0,0,b,-q,0,0,-b])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((q,
r)=>q+r)}forEachVertex(q){let r=0;this.lengths.length||q(this.coords[0],this.coords[1]);for(let k=0;k<this.lengths.length;k++){const l=this.lengths[k];for(let m=0;m<l;m++)q(this.coords[2*(m+r)],this.coords[2*(m+r)+1]);r+=l}}deltaDecode(){const q=this.clone(),{coords:r,lengths:k}=q;let l=0;for(const m of k){for(let b=1;b<m;b++)r[2*(l+b)]+=r[2*(l+b)-2],r[2*(l+b)+1]+=r[2*(l+b)-1];l+=m}return q}clone(q){if(0===this.lengths.length)return new a([],[this.coords[0],this.coords[1]]);var r=2*(0===this.lengths.length?
1:this.lengths.reduce((k,l)=>k+l));r=this.coords.slice(0,r);return q?(q.set(r),new a(this.lengths,q,this.hasIndeterminateRingOrder)):new a(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}}return a})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports"],function(a){function q(t,w,C,z,D,H,G){let A;C=0;for(let F=z,J=D-H;F<D;F+=H)C+=(t[J+w*H]-t[F+w*H])*(t[F+1+w*H]+t[J+1+w*H]),J=F;if(G===0<C)for(;z<D;z+=H)A=m(z+w*H,t[z+w*H],t[z+1+w*H],A);else for(D-=H;D>=z;D-=H)A=
m(D+w*H,t[D+w*H],t[D+1+w*H],A);A&&e(A,A.next)&&(b(A),A=A.next);return A}function r(t,w=t){if(!t)return t;let C;do if(C=!1,t.steiner||!e(t,t.next)&&0!==f(t.prev,t,t.next))t=t.next;else{b(t);t=w=t.prev;if(t===t.next)break;C=!0}while(C||t!==w);return w}function k(t,w,C,z,D,H,G,A){if(t){!A&&H&&(t=d(t,z,D,H));for(var F=t;t.prev!==t.next;){var J=t.prev,K=t.next;if(H)var P=l(t,z,D,H);else a:{P=t;var E=P.prev,M=P;const T=P.next;if(0<=f(E,M,T)){P=!1;break a}let ba=P.next.next;const ea=ba;let X=0;for(;ba!==
P.prev&&(0===X||ba!==ea);){X++;if(g(E.x,E.y,M.x,M.y,T.x,T.y,ba.x,ba.y)&&0<=f(ba.prev,ba,ba.next)){P=!1;break a}ba=ba.next}P=!0}if(P)w.push(J.index/C+G),w.push(t.index/C+G),w.push(K.index/C+G),b(t),F=t=K.next;else if(t=K,t===F){if(!A)k(r(t),w,C,z,D,H,G,1);else if(1===A){A=w;F=C;J=G;K=t;do P=K.prev,E=K.next.next,!e(P,E)&&p(P,K,K.next,E)&&x(P,E)&&x(E,P)&&(A.push(P.index/F+J),A.push(K.index/F+J),A.push(E.index/F+J),b(K),b(K.next),K=t=E),K=K.next;while(K!==t);t=K;k(t,w,C,z,D,H,G,2)}else if(2===A)a:{A=
t;do{for(F=A.next.next;F!==A.prev;){if(J=A.index!==F.index){P=P=P=void 0;J=A;K=F;if(P=J.next.index!==K.index&&J.prev.index!==K.index){b:{P=J;do{if(P.index!==J.index&&P.next.index!==J.index&&P.index!==K.index&&P.next.index!==K.index&&p(P,P.next,J,K)){P=!0;break b}P=P.next}while(P!==J);P=!1}P=!P}if(P=P&&x(J,K)&&x(K,J)){P=J;E=!1;M=(J.x+K.x)/2;K=(J.y+K.y)/2;do P.y>K!==P.next.y>K&&P.next.y!==P.y&&M<(P.next.x-P.x)*(K-P.y)/(P.next.y-P.y)+P.x&&(E=!E),P=P.next;while(P!==J);P=E}J=P}if(J){t=u(A,F);A=r(A,A.next);
t=r(t,t.next);k(A,w,C,z,D,H,G,0);k(t,w,C,z,D,H,G,0);break a}F=F.next}A=A.next}while(A!==t)}break}}}}function l(t,w,C,z){const D=t.prev,H=t.next;if(0<=f(D,t,H))return!1;const G=D.x>t.x?D.x>H.x?D.x:H.x:t.x>H.x?t.x:H.x,A=D.y>t.y?D.y>H.y?D.y:H.y:t.y>H.y?t.y:H.y,F=n(D.x<t.x?D.x<H.x?D.x:H.x:t.x<H.x?t.x:H.x,D.y<t.y?D.y<H.y?D.y:H.y:t.y<H.y?t.y:H.y,w,C,z);w=n(G,A,w,C,z);C=t.prevZ;for(z=t.nextZ;C&&C.z>=F&&z&&z.z<=w;){if(C!==t.prev&&C!==t.next&&g(D.x,D.y,t.x,t.y,H.x,H.y,C.x,C.y)&&0<=f(C.prev,C,C.next))return!1;
C=C.prevZ;if(z!==t.prev&&z!==t.next&&g(D.x,D.y,t.x,t.y,H.x,H.y,z.x,z.y)&&0<=f(z.prev,z,z.next))return!1;z=z.nextZ}for(;C&&C.z>=F;){if(C!==t.prev&&C!==t.next&&g(D.x,D.y,t.x,t.y,H.x,H.y,C.x,C.y)&&0<=f(C.prev,C,C.next))return!1;C=C.prevZ}for(;z&&z.z<=w;){if(z!==t.prev&&z!==t.next&&g(D.x,D.y,t.x,t.y,H.x,H.y,z.x,z.y)&&0<=f(z.prev,z,z.next))return!1;z=z.nextZ}return!0}function m(t,w,C,z){t=v.create(t,w,C);z?(t.next=z.next,t.prev=z,z.next.prev=t,z.next=t):(t.prev=t,t.next=t);return t}function b(t){t.next.prev=
t.prev;t.prev.next=t.next;t.prevZ&&(t.prevZ.nextZ=t.nextZ);t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function c(t,w){let C=w;const z=t.x,D=t.y;let H=-Infinity,G;do{if(D<=C.y&&D>=C.next.y&&C.next.y!==C.y){var A=C.x+(D-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(A<=z&&A>H){H=A;if(A===z){if(D===C.y)return C;if(D===C.next.y)return C.next}G=C.x<C.next.x?C:C.next}}C=C.next}while(C!==w);if(!G)return null;if(z===H)return G.prev;w=G;A=G.x;const F=G.y;let J=Infinity,K;for(C=G.next;C!==w;)z>=C.x&&C.x>=A&&z!==C.x&&g(D<F?z:
H,D,A,F,D<F?H:z,D,C.x,C.y)&&(K=Math.abs(D-C.y)/(z-C.x),(K<J||K===J&&C.x>G.x)&&x(C,t)&&(G=C,J=K)),C=C.next;return G}function d(t,w,C,z){for(var D;D!==t;D=D.next){D=D||t;null===D.z&&(D.z=n(D.x,D.y,w,C,z));if(D.prev.next!==D||D.next.prev!==D)return D.prev.next=D,D.next.prev=D,d(t,w,C,z);D.prevZ=D.prev;D.nextZ=D.next}t.prevZ.nextZ=null;t.prevZ=null;a:for(C=1;;){z=t;w=t=null;let H=0;for(;z;){H++;D=z;let G=0;for(;G<C&&D;G++)D=D.nextZ;let A=C;for(;0<G||0<A&&D;){let F;0===G?(F=D,D=D.nextZ,A--):0!==A&&D?z.z<=
D.z?(F=z,z=z.nextZ,G--):(F=D,D=D.nextZ,A--):(F=z,z=z.nextZ,G--);w?w.nextZ=F:t=F;F.prevZ=w;w=F}z=D}w.nextZ=null;C*=2;if(2>H)break a}return t}function f(t,w,C){return(w.y-t.y)*(C.x-w.x)-(w.x-t.x)*(C.y-w.y)}function p(t,w,C,z){return e(t,w)&&e(C,z)||e(t,z)&&e(C,w)?!0:0<f(t,w,C)!==0<f(t,w,z)&&0<f(C,z,t)!==0<f(C,z,w)}function g(t,w,C,z,D,H,G,A){return 0<=(D-G)*(w-A)-(t-G)*(H-A)&&0<=(t-G)*(z-A)-(C-G)*(w-A)&&0<=(C-G)*(H-A)-(D-G)*(z-A)}function x(t,w){return 0>f(t.prev,t,t.next)?0<=f(t,w,t.next)&&0<=f(t,
t.prev,w):0>f(t,w,t.prev)||0>f(t,t.next,w)}function n(t,w,C,z,D){t=32767*(t-C)*D;w=32767*(w-z)*D;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;w=(w|w<<8)&16711935;w=(w|w<<4)&252645135;w=(w|w<<2)&858993459;return(t|t<<1)&1431655765|((w|w<<1)&1431655765)<<1}function e(t,w){return t.x===w.x&&t.y===w.y}function h(t,w){return t.x-w.x}function u(t,w){const C=v.create(t.index,t.x,t.y),z=v.create(w.index,w.x,w.y),D=t.next,H=w.prev;t.next=w;w.prev=t;C.next=D;D.prev=C;z.next=C;C.prev=z;H.next=
z;z.prev=H;return z}class v{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(t,w,C){const z=B<y.length?y[B++]:new v;z.index=t;z.x=w;z.y=C;z.prev=null;z.next=null;z.z=null;z.prevZ=null;z.nextZ=null;z.steiner=!1;return z}}const y=[];let B=0;for(let t=0;8096>t;t++)y.push(new v);a.bufcut=function(t,w,C,z,D,H,G){B=0;var A=(z-C)*H,F=D&&D.length;const J=F?(D[0]-C)*H:A;var K=q(w,C,z,0,J,H,!0);if(K&&K.next!==K.prev){var P;if(F){const ea=
[];for(let X=0,ca=D.length;X<ca;X++){const ma=q(w,C,z,D[X]*H,X<ca-1?D[X+1]*H:z*H,H,!1);ma===ma.next&&(ma.steiner=!0);F=ea;var E=F.push;let S=ma,Y=ma;do{if(S.x<Y.x||S.x===Y.x&&S.y<Y.y)Y=S;S=S.next}while(S!==ma);E.call(F,Y)}ea.sort(h);for(var M of ea)if(z=M,D=c(z,K))z=u(D,z),r(z,z.next),K=r(D,D.next)}if(A>80*H){var T=A=w[C*H];var ba=P=w[1+C*H];for(M=H;M<J;M+=H)z=w[M+C*H],D=w[M+1+C*H],T=Math.min(T,z),ba=Math.min(ba,D),A=Math.max(A,z),P=Math.max(P,D);P=Math.max(A-T,P-ba);P=0!==P?1/P:0}k(K,t,H,T,ba,P,
G,0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(a,q,r,k,l){class m{constructor(b,c,d,f){this._instanceId=b;this._evaluator=c;this._viewParams=d;this._optionalAttributes=f;this._evaluator.evaluator=p=>this.vertexSpec.createComputedParams(p)}get _vertexPack(){if(!this._cachedVertexPack){const b=
l.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||b.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=b}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(b){this._references=b}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var b;
a:{if(b=this._evaluator.inputMeshParams.params.effects?.effectInfos)for(const c of b)switch(c.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":b=!0;break a}b=!1}b&&await k.loadGeometryEngine()}enqueueRequest(b,c,d){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(b,c,d)}write(b,c,d,f,p){this.ensurePacked(c,d,f);if((c=this.evaluatedMeshParams.effects)&&0!==c.length){if(f=d.readGeometryForDisplay()?.clone()){f=q.GeometryCursor.fromOptimizedCIM(f,
d.geometryType);var g=k.getGeometryEngine();f.invertY();for(c=r.CIMEffectHelper.executeEffects(c,f,b.id||"",g);f=c.next();)f.invertY(),this._write(b,d,f,p)}}else this._write(b,d,void 0,p)}ensurePacked(b,c,d){this._evaluator.hasDynamicProperties&&(b=this._evaluator.evaluateMeshParams(b,c,d),this._vertexPack.pack(b,this._viewParams))}_writeVertex(b,c,d,f,p){this._vertexPack.writeVertex(b,c,d,f,this.evaluatedMeshParams,p)}}a.MeshWriter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(a,q,r,k,l){function m(g){if(k.isPolygon(g))g=[g.rings,"esriGeometryPolygon"];else if(k.isPolyline(g))g=[g.paths,"esriGeometryPolyline"];else if(k.isMultipoint(g))g=[[g.points],"esriGeometryMultipoint"];else if(k.isExtent(g))g=[[[[g.xmin,g.ymin],[g.xmin,g.ymax],[g.xmax,g.ymax],[g.xmax,g.ymin],[g.xmin,g.ymin]]],"esriGeometryEnvelope"];
else if(k.isPoint(g)){const x=[g.x,g.y];g.z&&x.push(g.z);g.m&&x.push(g.m);g=[[[x]],"esriGeometryPoint"]}else g=[[],"esriGeometryPolyline"];return g}class b{static fromOptimized(g,x,n=!1,e=!1,h=1){return(new c).initialize(g,x,n,e,h)}static fromJSON(g,x=!1,n=!1){const [e,h]=m(g);return(new d).initialize(e,h,x,n,1)}static fromOptimizedCIM(g,x,n=!1,e=!1,h=1){return(new f).initialize(g,x,n,e,h)}static fromJSONCIM(g,x=!1,n=!1,e=1){const [h,u]=m(g);return(new p).initialize(h,u,x,n,e)}static fromFeatureSetReader(g){const x=
g.readGeometryForDisplay();g=g.geometryType;return x&&g?this.fromOptimized(x,g):null}static fromFeatureSetReaderCIM(g){const x=g.readGeometryForDisplay();g=g.geometryType;return x&&g?this.fromOptimizedCIM(x,g):null}static createEmptyOptimized(g,x=!1,n=!1,e=1){return(new c).initialize(new l,g,x,n,e)}static createEmptyJSON(g,x=!1,n=!1){return(new d).initialize([],g,x,n,1)}static createEmptyOptimizedCIM(g,x=!1,n=!1,e=1){return(new f).initialize(new l,g,x,n,e)}static createEmptyJSONCIM(g,x=!1,n=!1,e=
1){return(new p).initialize([],g,x,n,e)}asJSON(){const g=r.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:g[0][0][0],ymin:g[0][0][1],xmax:g[0][2][0],ymax:g[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:g.flat()}:"esriGeometryPoint"===this.geometryType?{x:g[0][0][0],y:g[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:g}:{paths:g}}getCurrentRingArea(){if(3>this.pathSize)return 0;let g=0,x,n;this.seekPathStart();if(!this.nextPoint())return 0;
x=this.x;n=this.y;const e=x,h=n;for(;this.nextPoint();)g+=(x-this.x)*(n+this.y),x=this.x,n=this.y;return-.5*(g+(x-e)*(n+h))}invertY(){this.yFactor*=-1}}class c extends b{constructor(){super(...arguments);this._end=-1}initialize(g,x,n,e,h){this.hasZ=n;this.hasM=e;this.geometryType=x;this._stride=2+Number(n)+Number(e);this._geometry=g;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=h;return this}reset(){this.initialize(this._geometry,this.geometryType,
this.hasZ,this.hasM,this.yFactor)}seekPath(g){if(0<=g&&g<this.totalSize){if(this._pathIndex<g)for(;this._pathIndex<g&&this.nextPath(););else if(this._pathIndex>g)for(;this._pathIndex>g&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(g){g=this._pathOffset+g*this._stride;return 0<=g&&g<this._end?(this._pointOffset=g,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=
this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}pathLength(){const g=
this._end,x=this._stride,n=this._geometry.coords;let e=0;for(let h=this._pathOffset+x;h<g;h+=x){const u=n[h]-n[h-x],v=n[h+1]-n[h-x+1];e+=Math.sqrt(u*u+v*v)}return e}startPath(){this._geometry.lengths.push(0)}pushPath(g){this.startPath();this.pushPoints(g)}pushPoint(g){for(let x=0;x<this._stride;++x)this._geometry.coords.push(g[x]);this._geometry.lengths[this.totalSize-1]++}pushXY(g,x){this._geometry.coords.push(g,x);this._geometry.lengths[this.totalSize-1]++}pushPoints(g){for(const x of g)for(let n=
0;n<this._stride;++n)this._geometry.coords.push(x[n]);this._geometry.lengths[this.totalSize-1]+=g.length}pushCursor(g){g=g.asOptimized();this._geometry.coords.push(...g.coords);this._geometry.lengths.push(...g.lengths)}asOptimized(){const g=this._geometry.clone();if(1!==this.yFactor)for(let x=1;x<g.coords.length;x+=this._stride)g.coords[x]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(g.lengths.length=0);return g}isClosed(){const g=this._geometry.coords,x=this._pathOffset,n=this._end-this._stride;
for(let e=0;e<this._stride;e++)if(g[x+e]!==g[n+e])return!1;return!0}clone(){return(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((g,x)=>g+x)}get pathSize(){const {lengths:g}=this._geometry;return 0>this._pathIndex||this._pathIndex>g.length-1?0:this._geometry.isPoint?1:g[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(g){this._geometry.coords[this._pointOffset]=
g}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(g){this._geometry.coords[this._pointOffset+1]=this.yFactor*g}get z(){return this._geometry.coords[this._pointOffset+2]}set z(g){this._geometry.coords[this._pointOffset+2]=g}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(g){this._geometry.coords[this._pointOffset+3]=g}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class d extends b{initialize(g,
x,n,e,h){this._paths=g;this.geometryType=x;this.hasZ=n;this.hasM=e;this._pathIndex=this._pointIndex=-1;this.yFactor=h;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(g){this._pathIndex=g;this._pointIndex=-1;return 0<=g&&g<this.totalSize?(this._currentPath=this._paths[g],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(g){return 0<=g&&g<this._currentPath.length?(this._pointIndex=g,this._currentPoint=
this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const g=
this._currentPath.length,x=this._currentPath;let n=0;for(let h=1;h<g;h++){var e=x[h-1];const u=x[h],v=u[0]-e[0];e=u[1]-e[1];n+=Math.sqrt(v*v+e*e)}return n}startPath(){this._paths.push([])}pushPath(g){this._paths.push(g)}pushPoint(g){this._paths[this.totalSize-1].push(g)}pushXY(g,x){this._paths[this.totalSize-1].push([g,x])}pushPoints(g){this._paths[this.totalSize-1].push(...g)}pushCursor(g){g=r.collectMultipath(g);for(const x of g)this.pushPath(x)}asOptimized(){const g=new l;if("esriGeometryPoint"===
this.geometryType)g.coords.push(...this._paths[0][0]),g.lengths.length=0;else for(const x of this._paths){for(const n of x)g.coords.push(n[0]),g.coords.push(n[1]*this.yFactor),this.hasZ&&g.coords.push(n[2]),this.hasM&&g.coords.push(n[this._mIndex]);g.lengths.push(x.length)}return g}isClosed(){const g=this._currentPath[0],x=this._currentPath[this._currentPath.length-1];for(let n=0;n<g.length;n++)if(g[n]!==x[n])return!1;return!0}clone(){return(new d).initialize(q.clone(this._paths),this.geometryType,
this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(g=>g.length).reduce((g,x)=>g+x)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(g){this._currentPoint[0]=g}get y(){return this.yFactor*this._currentPoint[1]}set y(g){this._currentPoint[1]=this.yFactor*g}get z(){return this._currentPoint[2]}set z(g){this._currentPoint[2]=g}get m(){return this._currentPoint[this._mIndex]}set m(g){this._currentPoint[this._mIndex]=
g}get pathIndex(){return this._pathIndex}}class f extends c{initialize(g,x,n,e,h){super.initialize(g,x,n,e,h);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(u=>new Set));return this}startPath(){super.startPath();this._controlPoints.push(new Set)}clone(){const g=(new f).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);g._controlPoints=this._controlPoints;return g}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(g){this._controlPoints[this.pathIndex].add(g)}getControlPointAt(g){return this._controlPoints[this.pathIndex].has(g)}}
class p extends d{initialize(g,x,n,e,h){return super.initialize(g,x,n,e,h)}clone(){return(new p).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(g){this._paths[this.pathIndex][g][4]=1}getControlPointAt(g){return 1===this._paths[this.pathIndex][g][4]}}a.GeometryCursor=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),function(a,q,r,k,l,m){const b=96/72;class c{static executeEffects(d,f,p,g){const x=m.getEffectsInflateSize(d);f=new k.SimpleEffectCursor(f);for(const n of d)(d=l.getEffectOperator(n))&&(f=d.execute(f,n,b,p,g,x));return f}static applyEffects(d,f,p){if(!d)return f;var g=m.getEffectsInflateSize(d);
f=new k.SimpleEffectCursor(q.GeometryCursor.fromJSONCIM(f));for(var x of d)(d=l.getEffectOperator(x))&&(f=d.execute(f,x,1,null,p,g));g=[];for(x=null;p=f.next();)g.push(...r.collectMultipath(p)),x=p.geometryType;return 0===g.length||null===x?null:"esriGeometryPolygon"===x?{rings:g}:{paths:g}}}a.CIMEffectHelper=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],
function(a,q,r){let k;class l{constructor(m){this._geometry=m}next(){const m=this._geometry;this._geometry=null;return m}}a.SimpleEffectCursor=l;a.clipCursorToTileExtent=function(m,b){k||=new r.TileClipper(0,0,0,1);var c="esriGeometryPolygon"===m.geometryType;const d=c?3:2;k.reset(c?r.GeometryType.Polygon:r.GeometryType.LineString);k.setPixelMargin(b+1);k.setExtent(512);let f;for(;m.nextPath();)if(!(m.pathSize<d)){m.nextPoint();b=m.x;f=-m.y;for(k.moveTo(b,f);m.nextPoint();)b=m.x,f=-m.y,k.lineTo(b,
f);c&&k.close()}if(c=k.result(!1)){m=q.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(const p of c){m.startPath();for(const g of p)m.pushXY(g.x,-g.y)}m.reset();return m}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B,t,w){a.getEffectOperator=function(C){if(!C)return null;switch(C.type){case "CIMGeometricEffectAddControlPoints":return q.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return r.EffectArrow.local();case "CIMGeometricEffectBuffer":return k.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return l.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return m.EffectCut.local();case "CIMGeometricEffectDashes":return b.EffectDashes.local();
case "CIMGeometricEffectDonut":return c.EffectDonut.local();case "CIMGeometricEffectJog":return d.EffectJog.local();case "CIMGeometricEffectMove":return f.EffectMove.local();case "CIMGeometricEffectOffset":return p.EffectOffset.local();case "CIMGeometricEffectReverse":return g.EffectReverse.local();case "CIMGeometricEffectRotate":return x.EffectRotate.local();case "CIMGeometricEffectScale":return n.EffectScale.local();case "CIMGeometricEffectWave":return e.EffectWave.local()}return null};a.getPlacementOperator=
function(C){if(!C)return null;switch(C.type){case "CIMMarkerPlacementAlongLineSameSize":return h.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return u.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return v.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return y.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return B.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return t.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return w.PlacementPolygonCenter.local()}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(a){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(k,l,m,b,c){return new r(k,l,m)}}q.instance=null;class r{constructor(k,l,m){this._inputGeometries=k;this._angleTolerance=void 0!==l.angleTolerance?l.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let k=this._inputGeometries.next();for(;k;){if("esriGeometryPolygon"===k.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===k.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===k.geometryType){if(this._maxCosAngle)return k;this._isClosed=!0}else{k=this._inputGeometries.next();continue}for(;k.nextPath();)this._processPath(k);k.reset();return k}return null}_processPath(k){if(k.nextPoint()){const l=
k.x,m=k.y;let b=l,c=m,d=k.pathSize,f=0,p=0,g=0,x=0,n=0,e=0;this._isClosed&&++d;for(let h=1;k.nextPoint()||h<d;++h){let u,v;this._isClosed&&h===d-1?(u=l,v=m):(u=k.x,v=k.y);const y=u-b,B=v-c,t=Math.sqrt(y*y+B*B);1<h&&0<t&&0<g&&(f*y+p*B)/t/g<=this._maxCosAngle&&k.setControlPointAt(h-1);1===h&&(x=y,n=B,e=t);0<t&&(b=u,c=v,f=y,p=B,g=t)}this._isClosed&&0<g&&0<e&&(f*x+p*n)/e/g<=this._maxCosAngle&&k.setControlPointAt(0)}}}a.EffectAddControlPoints=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(a,q,r,k,l,m){const b=m.GeometricEffectArrowType.OpenEnded;class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(f,p,g,x,n){return new d(f,p,g)}}c.instance=null;class d extends k.PathEffectCursor{constructor(f,p,g){super(f,!1,!0);this._curveHelper=new l.CurveHelper;this._width=
(void 0!==p.width?p.width:5)*g;this._arrowType=void 0!==p.geometricEffectArrowType?p.geometricEffectArrowType:void 0!==p.arrowType?p.arrowType:b;this._offsetFlattenError=l.pixelTolerance*g}processPath(f){const p=q.GeometryCursor.createEmptyOptimizedCIM(f.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(p,f,!0);break;case m.GeometricEffectArrowType.Block:this._constructSimpleArrow(p,f,!1);break;case m.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(p,f)}return p}_constructSimpleArrow(f,
p,g){var x=p.pathLength(),n=this._width;x<2*n&&(n=x/2);var e=this._curveHelper.getSubCurve(p,0,x-n);if(e&&e.nextPath()&&(e.seekPathStart(),x=n/2,!this._curveHelper.isEmpty(e)&&(e=r.collectPath(e),n=this._constructOffset(e,-x)))&&(e=this._constructOffset(e,x))){var h=this._constructArrowBasePoint(n,-x/2);h&&(x=this._constructArrowBasePoint(e,x/2))&&(p.seekInPath(p.pathSize-1),p=[p.x,p.y],f.pushPath(e),f.nextPath(),f.nextPoint(),f.setControlPoint(),f.pushPoint(x),f.nextPoint(),f.setControlPoint(),f.pushPoint(p),
f.nextPoint(),f.setControlPoint(),f.pushPoint(h),f.nextPoint(),f.setControlPoint(),f.pushPoints(n.reverse()),f.setControlPoint(),g||(f.setControlPointAt(0),f.setControlPointAt(f.pathSize-1),f.pushPoint(e[0])),f.reset())}}_constructCrossedArrow(f,p){var g=p.pathLength(),x=this._width;g<3.732050807568877*x&&(x=g/3.732050807568877);p.seekPathStart();var n=this._curveHelper.getSubCurve(p,0,g-2.732050807568877*x);if(n){n.nextPath();var e=x/2;if(!this._curveHelper.isEmpty(n)){var h=r.collectPath(n);if(n=
this._constructOffset(h,e))if(h=this._constructOffset(h,-e))if(g=this._curveHelper.getSubCurve(p,0,g-x))if(g.nextPath(),!this._curveHelper.isEmpty(g)&&(g=r.collectPath(g),x=this._constructOffset(g,e))){var u=this._constructOffset(g,-e);if(u&&(g=x[x.length-1],x=this._constructArrowBasePoint(x,e/2))){var v=u[u.length-1];if(e=this._constructArrowBasePoint(u,-e/2))p.seekInPath(p.pathSize-1),p=[p.x,p.y],f.pushPath(n),f.nextPath(),f.nextPoint(),f.setControlPoint(),f.pushPoint(v),f.nextPoint(),f.setControlPoint(),
f.pushPoint(e),f.nextPoint(),f.setControlPoint(),f.pushPoint(p),f.nextPoint(),f.setControlPoint(),f.pushPoint(x),f.nextPoint(),f.setControlPoint(),f.pushPoint(g),f.nextPoint(),f.setControlPoint(),f.pushPoints(h.reverse()),f.nextPoint(),f.setControlPoint(),f.reset()}}}}}_constructOffset(f,p){return this._curveHelper.offset(f,p,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(f,p){if(!f||2>f.length)return null;var g=f[f.length-2];f=f[f.length-1];g=[f[0]-g[0],
f[1]-g[1]];this._curveHelper.normalize(g);return[f[0]+g[1]*p,f[1]-g[0]*p]}}a.EffectArrow=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(a,q){class r{constructor(l,m=!0,b=!0,c=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!m&&"esriGeometryPolygon"===l.geometryType||!b&&"esriGeometryPolyline"===l.geometryType?null:l;this.geomUnitsPerPoint=c;this.iteratePath=!1;this.internalPlacement=
new q.Placement}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const l=this.processPath(this.geometryCursor);if(l)return l}return this.geometryCursor=null}}class k{constructor(l,m,b,c=0){this.isClosed=!1;this.inputGeometries=l;this.acceptPolygon=m;this.acceptPolyline=b;this.geomUnitsPerPoint=c;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var l=
this.inputGeometries.next();l&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===l.geometryType||"esriGeometryEnvelope"===l.geometryType,this.multiPathCursor=l);)l=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),l=this.processPath(this.multiPathCursor))return l;this.multiPathCursor=null}}}a.PathEffectCursor=k;a.PathTransformationCursor=r;a.getId=function(l){return l[4]};a.setId=
function(l,m){l[4]=m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(a){class q{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(k,l){this.tx=k;this.ty=l}setTranslateZ(k){this.tz=k}setRotateCS(k,
l){this.rz=void 0;this.rzCos=k;this.rzSin=l}setRotate(k){this.rz=k;this.rzSin=this.rzCos=void 0}setRotateY(k){this.ry=k}setScale(k){this.s=k}setMeasure(k){this.m=k}}class r{next(){return null}}a.EmptyPlacementCursor=r;a.Placement=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(a,q,r){class k{constructor(l,m){}isEmpty(l){if(!l.nextPoint())return!0;let m,b,c,d;m=l.x;for(b=
l.y;l.nextPoint();m=b,b=d)if(c=l.x,d=l.y,c!==m||d!==b)return l.seekPathStart(),!1;l.seekPathStart();return!0}normalize(l){const m=Math.sqrt(l[0]*l[0]+l[1]*l[1]);0!==m&&(l[0]/=m,l[1]/=m)}getLength(l,m,b,c){l=b-l;m=c-m;return Math.sqrt(l*l+m*m)}getSegLength(l){const [[m,b],[c,d]]=l;return this.getLength(m,b,c,d)}getCoord2D(l,m,b,c,d){return[l+(b-l)*d,m+(c-m)*d]}getSegCoord2D(l,m){const [[b,c],[d,f]]=l;return this.getCoord2D(b,c,d,f,m)}getAngle(l,m,b,c,d){return Math.atan2(c-m,b-l)}getAngleCS(l,m,b,
c,d){l=b-l;m=c-m;c=Math.sqrt(l*l+m*m);return 0<c?[l/c,m/c]:[1,0]}getSegAngleCS(l,m){const [[b,c],[d,f]]=l;return this.getAngleCS(b,c,d,f,m)}cut(l,m,b,c,d,f){d=0>=d?[l,m]:this.getCoord2D(l,m,b,c,d);l=1<=f?[b,c]:this.getCoord2D(l,m,b,c,f);return[d,l]}getSubCurve(l,m,b){const c=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(c,l,m,b)?c:null}appendSubCurve(l,m,b,c){l.startPath();m.seekPathStart();let d=0;var f=!0;if(!m.nextPoint())return!1;var p=m.x;let g=m.y;
for(;m.nextPoint();){const x=this.getLength(p,g,m.x,m.y);if(0!==x){if(f){if(d+x>b){const n=(b-d)/x;let e=1;f=!1;d+x>=c&&(e=(c-d)/x,f=!0);(p=this.cut(p,g,m.x,m.y,n,e))&&l.pushPoints(p);if(f)break;f=!1}}else{if(d+x>c){(m=this.cut(p,g,m.x,m.y,0,(c-d)/x))&&l.pushPoint(m[1]);break}l.pushXY(m.x,m.y)}d+=x}p=m.x;g=m.y}return!0}getCIMPointAlong(l,m){if(!l.nextPoint())return null;let b=0,c,d,f,p;c=l.x;for(d=l.y;l.nextPoint();c=f,d=p){f=l.x;p=l.y;const g=this.getLength(c,d,f,p);if(0!==g){if(b+g>m)return this.getCoord2D(c,
d,f,p,(m-b)/g);b+=g}}return null}offset(l,m,b,c,d){if(!l||2>l.length)return null;var f=0,p=l[f++];for(d=f;f<l.length;){var g=l[f];if(g[0]!==p[0]||g[1]!==p[1])f!==d&&(l[d]=l[f]),p=l[d++];f++}(f=l[0][0]===l[d-1][0]&&l[0][1]===l[d-1][1])&&--d;if(d<(f?3:2))return null;g=[];p=f?l[d-1]:null;let x=l[0];for(let v=0;v<d;v++){const y=v===d-1?f?l[0]:null:l[v+1];if(p)if(y){var n=[y[0]-x[0],y[1]-x[1]];this.normalize(n);var e=[x[0]-p[0],x[1]-p[1]];this.normalize(e);var h=e[0]*n[1]-e[1]*n[0],u=e[0]*n[0]+e[1]*n[1];
if(0===h&&1===u){x=y;continue}if(0<=h===0>=m)1>u&&(n=[n[0]-e[0],n[1]-e[1]],this.normalize(n),e=Math.sqrt((1+u)/2),e>1/c&&(e=-Math.abs(m)/e,g.push([x[0]-n[0]*e,x[1]-n[1]*e])));else switch(b){case r.GeometricEffectOffsetMethod.Mitered:if(p=Math.sqrt((1+u)/2),0<p&&1/p<c){n=[n[0]-e[0],n[1]-e[1]];this.normalize(n);e=Math.abs(m)/p;g.push([x[0]-n[0]*e,x[1]-n[1]*e]);break}case r.GeometricEffectOffsetMethod.Bevelled:g.push([x[0]+e[1]*m,x[1]-e[0]*m]);g.push([x[0]+n[1]*m,x[1]-n[0]*m]);break;case r.GeometricEffectOffsetMethod.Rounded:if(1>
u){g.push([x[0]+e[1]*m,x[1]-e[0]*m]);p=Math.floor(2.5*(1-u));if(0<p){h=u=1/p;for(let B=1;B<p;B++,h+=u){const t=[e[1]*(1-h)+n[1]*h,-e[0]*(1-h)-n[0]*h];this.normalize(t);g.push([x[0]+t[0]*m,x[1]+t[1]*m])}}g.push([x[0]+n[1]*m,x[1]-n[0]*m])}break;default:0>h?(g.push([x[0]+(e[1]+e[0])*m,x[1]+(e[1]-e[0])*m]),g.push([x[0]+(n[1]-n[0])*m,x[1]-(n[0]+n[1])*m])):(p=Math.sqrt((1+Math.abs(u))/2),n=[n[0]-e[0],n[1]-e[1]],this.normalize(n),e=m/p,g.push([x[0]-n[0]*e,x[1]-n[1]*e]))}}else n=[x[0]-p[0],x[1]-p[1]],this.normalize(n),
g.push([x[0]+n[1]*m,x[1]-n[0]*m]);else n=[y[0]-x[0],y[1]-x[1]],this.normalize(n),g.push([x[0]+n[1]*m,x[1]-n[0]*m]);p=x;x=y}if(g.length<(f?3:2))return null;f&&g.push([g[0][0],g[0][1]]);return g}}a.CurveHelper=k;a.pixelTolerance=.03;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(a,q,r,k,l,m,b,c){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(p,g,x,n,e,h){return new f(p,g,x,n,e,h)}}d.instance=null;class f{constructor(p,g,x,n,e,h){this._inputGeometries=p;this._tileKey=n;this._geometryEngine=e;this._curveHelper=new m.CurveHelper;this._size=(void 0!==g.size?g.size:1)*x;this._maxInflateSize=h*x;this._offsetFlattenError=m.pixelTolerance*x}next(){for(var p;p=this._inputGeometries.next();){if(0===this._size)return p;if("esriGeometryEnvelope"===
p.geometryType)if(0<this._size){var g=r.GeometryCursor.createEmptyOptimizedCIM(p.geometryType),x=k.collectMultipath(p)[0];if(x=this._curveHelper.offset(x,this._size,b.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return g.pushPath(x),g}else if(0>this._size&&(g=p.asJSON(),0<Math.min(g.xmax-g.xmin,g.ymax-g.ymin)+2*this._size))return r.GeometryCursor.fromJSONCIM({xmin:g.xmin-this._size,xmax:g.xmax+this._size,ymin:g.ymin-this._size,ymax:g.ymax+this._size});g=this._geometryEngine;if(null==
g)break;if(p=this._tileKey?l.clipCursorToTileExtent(p,this._maxInflateSize):p)return(p=g.buffer(c.WebMercator,p.asJSON(),this._size,1))?r.GeometryCursor.fromJSONCIM(p):null}return null}}a.EffectBuffer=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(a,q,r,k,l){class m{static local(){null===
m.instance&&(m.instance=new m);return m.instance}execute(c,d,f,p,g){return new b(c,d,f)}}m.instance=null;class b{constructor(c,d,f){this._defaultPointSize=20;this._inputGeometries=c;this._geomUnitsPerPoint=f;this._rule=d.rule??l.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*f}next(){for(var c;c=this._inputGeometries.next();)if((c=this._processGeom(r.collectMultipath(c)))&&c.length)return q.GeometryCursor.fromJSONCIM({paths:c});return null}_clone(c){return[c[0],
c[1]]}_mid(c,d){return[(c[0]+d[0])/2,(c[1]+d[1])/2]}_mix(c,d,f,p){return[c[0]*d+f[0]*p,c[1]*d+f[1]*p]}_add(c,d){return[c[0]+d[0],c[1]+d[1]]}_add2(c,d,f){return[c[0]+d,c[1]+f]}_sub(c,d){return[c[0]-d[0],c[1]-d[1]]}_dist(c,d){return Math.sqrt((c[0]-d[0])*(c[0]-d[0])+(c[1]-d[1])*(c[1]-d[1]))}_norm(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}_normalize(c,d=1){d/=this._norm(c);c[0]*=d;c[1]*=d}_leftPerpendicular(c){const d=c[0];c[0]=-c[1];c[1]=d}_leftPerp(c){return[-c[1],c[0]]}_rightPerpendicular(c){const d=
-c[0];c[0]=c[1];c[1]=d}_rightPerp(c){return[c[1],-c[0]]}_dotProduct(c,d){return c[0]*d[0]+c[1]*d[1]}_crossProduct(c,d){return c[0]*d[1]-c[1]*d[0]}_rotateDirect(c,d,f){const p=c[0]*f+c[1]*d;c[0]=c[0]*d-c[1]*f;c[1]=p}_makeCtrlPt(c){c=[c[0],c[1]];k.setId(c,1);return c}_addAngledTicks(c,d,f,p){const g=this._sub(f,d);this._normalize(g);var x=this._crossProduct(g,this._sub(p,d));p=0<x?this._rightPerp(g):this._leftPerp(g);x=Math.abs(x)/2;const n=[];n.push([d[0]+(p[0]-g[0])*x,d[1]+(p[1]-g[1])*x]);n.push(d);
n.push(f);n.push([f[0]+(p[0]+g[0])*x,f[1]+(p[1]+g[1])*x]);c.push(n)}_addBezier2(c,d,f,p,g){if(0===g--)c.push(p);else{var x=this._mid(d,f);f=this._mid(f,p);var n=this._mid(x,f);this._addBezier2(c,d,x,n,g);this._addBezier2(c,n,f,p,g)}}_addBezier3(c,d,f,p,g,x){if(0===x--)c.push(g);else{var n=this._mid(d,f),e=this._mid(f,p);p=this._mid(p,g);f=this._mid(n,e);e=this._mid(e,p);var h=this._mid(f,e);this._addBezier3(c,d,n,f,h,x);this._addBezier3(c,h,e,p,g,x)}}_add90DegArc(c,d,f,p,g){p=g??0<this._crossProduct(this._sub(f,
d),this._sub(p,d));g=this._mid(d,f);const x=this._sub(g,d);p?this._leftPerpendicular(x):this._rightPerpendicular(x);g[0]+=x[0];g[1]+=x[1];this._addBezier3(c,d,this._mix(d,.33333,g,.66667),this._mix(f,.33333,g,.66667),f,4)}_addArrow(c,d,f){var p=d[0],g=d[1],x=d[d.length-1],n=this._sub(p,g);this._normalize(n);const e=this._crossProduct(n,this._sub(x,g));g=.5*e;var h=this._leftPerp(n);const u=[x[0]-h[0]*e,x[1]-h[1]*e];var v=d.length-1;x=[];x.push(f?[-h[0],-h[1]]:h);var y=[-n[0],-n[1]];for(f=1;f<v-1;f++){n=
this._sub(d[f+1],d[f]);this._normalize(n);var B=this._dotProduct(n,y);h=this._crossProduct(n,y);B=Math.sqrt((1+B)/2);y=this._sub(n,y);this._normalize(y);y[0]/=B;y[1]/=B;x.push(0>h?[-y[0],-y[1]]:y);y=n}x.push(this._rightPerp(y));for(v=x.length-1;0<v;v--)c.push([d[v][0]+x[v][0]*g,d[v][1]+x[v][1]*g]);c.push([u[0]+x[0][0]*g,u[1]+x[0][1]*g]);c.push([u[0]+x[0][0]*e,u[1]+x[0][1]*e]);c.push(p);c.push([u[0]-x[0][0]*e,u[1]-x[0][1]*e]);c.push([u[0]-x[0][0]*g,u[1]-x[0][1]*g]);for(p=1;p<x.length;p++)c.push([d[p][0]-
x[p][0]*g,d[p][1]-x[p][1]*g])}_cp2(c,d,f){return 2<=c.length?c[1]:this._add2(c[0],d*this._defaultSize,f*this._defaultSize)}_cp3(c,d,f,p){if(3<=c.length)return c[2];f=this._mix(c[0],1-f,d,f);c=this._sub(d,c[0]);this._normalize(c);this._rightPerpendicular(c);return[f[0]+c[0]*p*this._defaultSize,f[1]+c[1]*p*this._defaultSize]}_arrowPath(c){if(2<c.length)return c;const d=c[0];c=this._cp2(c,-4,0);const f=this._sub(d,c);this._normalize(f);const p=this._rightPerp(f);return[d,c,[d[0]+(p[0]-f[0])*this._defaultSize,
d[1]+(p[1]-f[1])*this._defaultSize]]}_arrowLastSeg(c){var d=c[0];const f=this._cp2(c,-4,0);if(3<=c.length)d=c[c.length-1];else{c=this._sub(d,f);this._normalize(c);const p=this._rightPerp(c);d=[d[0]+(p[0]-c[0])*this._defaultSize,d[1]+(p[1]-c[1])*this._defaultSize]}return[f,d]}_processGeom(c){if(!c)return null;const d=[];for(const f of c){if(!f||0===f.length)continue;const p=f.length;let g=f[0];switch(this._rule){case l.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const x=this._cp2(f,
0,-1),n=this._cp3(f,x,.5,4),e=[];e.push(n);e.push(this._mid(g,x));d.push(e);break;case l.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const h=this._cp2(f,0,-1);d.push([h,g]);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const u=this._cp2(f,-4,1),v=this._cp3(f,u,.882353,-1.94),y=[];y.push(this._mid(u,v));y.push(g);d.push(y);break;case l.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const B=this._cp2(f,-4,1),t=this._cp3(f,B,.882353,-1.94),
w=this._sub(t,B);let C;C=0<this._crossProduct(w,this._sub(g,B))?this._rightPerp(C):this._leftPerp(w);const z=[];z.push([B[0]+(C[0]-w[0])/3,B[1]+(C[1]-w[1])/3]);z.push(B);z.push(t);z.push([t[0]+(C[0]+w[0])/3,t[1]+(C[1]+w[1])/3]);d.push(z);break;case l.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const D=this._cp2(f,0,-1),H=this._cp3(f,D,.5,3),G=this._mid(g,D),A=this._sub(G,H);this._normalize(A);const F=this._crossProduct(A,this._sub(g,H));this._leftPerpendicular(A);const J=[];J.push(g);
J.push([H[0]+A[0]*F,H[1]+A[1]*F]);d.push(J);const K=[];K.push([H[0]-A[0]*F,H[1]-A[1]*F]);K.push(D);d.push(K);break;case l.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const P=this._cp2(f,0,-1),E=this._cp3(f,P,.5,3),M=this._mid(g,P),T=this._sub(M,E);this._normalize(T);const ba=this._crossProduct(T,this._sub(g,E));this._leftPerpendicular(T);const ea=[];ea.push([E[0]+T[0]*ba,E[1]+T[1]*ba]);ea.push([E[0]-T[0]*ba,E[1]-T[1]*ba]);d.push(ea);break;case l.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const X=
this._cp2(f,0,-1),ca=this._cp3(f,X,.5,4),ma=this._mid(g,X),S=this._sub(ma,ca);this._normalize(S);const Y=this._crossProduct(S,this._sub(g,ca));this._leftPerpendicular(S);const ia=[];ia.push([ca[0]+S[0]*Y*.8,ca[1]+S[1]*Y*.8]);ia.push([ma[0]+.8*(g[0]-ma[0]),ma[1]+.8*(g[1]-ma[1])]);d.push(ia);d.push([ca,ma]);const na=[];na.push([ca[0]-S[0]*Y*.8,ca[1]-S[1]*Y*.8]);na.push([ma[0]+.8*(X[0]-ma[0]),ma[1]+.8*(X[1]-ma[1])]);d.push(na);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const ta=
this._cp2(f,0,-1),va=this._cp3(f,ta,.5,4),xa=this._mid(g,ta);let wa=this._sub(ta,g);const Ca=Math.cos(Math.PI/18),L=Math.sin(Math.PI/18),R=Math.sqrt((1+Ca)/2),fa=Math.sqrt((1-Ca)/2),ka=[];let qa;0<this._crossProduct(wa,this._sub(va,g))?(ka.push(g),wa=this._sub(g,xa),qa=ta):(ka.push(ta),wa=this._sub(ta,xa),qa=g);this._rotateDirect(wa,R,fa);wa[0]/=R;wa[1]/=R;for(let Ja=1;18>=Ja;Ja++)ka.push(this._add(xa,wa)),this._rotateDirect(wa,Ca,L);ka.push(qa);d.push(ka);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const Q=
this._cp2(f,0,-1),V=this._cp3(f,Q,1,-1);let W=this._sub(g,Q);this._normalize(W);const ha=this._crossProduct(W,this._sub(V,Q))/2;this._leftPerpendicular(W);const la=[Q[0]+W[0]*ha,Q[1]+W[1]*ha];W=this._sub(Q,la);const N=Math.cos(Math.PI/18);let aa=Math.sin(Math.PI/18);0<ha&&(aa=-aa);const ja=[Q];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(W,N,aa),ja.push(this._add(la,W));d.push(ja);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const oa=this._cp2(f,0,-2),ua=this._cp3(f,oa,1,-1);
let za;if(4<=p)za=f[3];else{const Ja=this._sub(g,oa);za=this._add(ua,Ja)}const Aa=this._dist(oa,ua)/2/.75,Ga=this._sub(oa,g);this._normalize(Ga,Aa);const Da=this._sub(ua,za);this._normalize(Da,Aa);d.push([za,ua]);const Ha=[this._clone(ua)];this._addBezier3(Ha,ua,this._add(ua,Da),this._add(oa,Ga),oa,4);Ha.push(g);d.push(Ha);break;case l.GeometricEffectControlMeasureLineRule.OpenCircle:const Fa=this._cp2(f,-2,0),Ea=this._sub(Fa,g),Ka=Math.cos(Math.PI/18),Sa=-Math.sin(Math.PI/18),Xa=[Fa];for(let Ja=
1;33>=Ja;Ja++)this._rotateDirect(Ea,Ka,Sa),Xa.push(this._add(g,Ea));d.push(Xa);break;case l.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Ra=this._cp2(f,0,-1);let Ma;if(3<=p)Ma=f[2];else{const Ja=this._sub(Ra,g),Wa=this._leftPerp(Ja);Ma=[g[0]+Wa[0]-.25*Ja[0],g[1]+Wa[1]-.25*Ja[1]]}let Pa;if(4<=p)Pa=f[3];else{const Ja=this._mid(g,Ra),Wa=this._sub(g,Ra);this._normalize(Wa);this._leftPerpendicular(Wa);const ab=this._crossProduct(Wa,this._sub(Ma,Ja));this._rightPerpendicular(Wa);Pa=
[Ma[0]+Wa[0]*ab*2,Ma[1]+Wa[1]*ab*2]}const sa=this._sub(Ra,g);let Qa,cb;Qa=0<this._crossProduct(sa,this._sub(Ma,g))?this._rightPerp(sa):this._leftPerp(sa);cb=[];cb.push(Ma);cb.push(g);cb.push([g[0]+(Qa[0]-sa[0])/3,g[1]+(Qa[1]-sa[1])/3]);d.push(cb);Qa=0<this._crossProduct(sa,this._sub(Pa,Ra))?this._rightPerp(Qa):this._leftPerp(sa);cb=[];cb.push([Ra[0]+(Qa[0]+sa[0])/3,Ra[1]+(Qa[1]+sa[1])/3]);cb.push(Ra);cb.push(Pa);d.push(cb);break;case l.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const jb=
this._cp2(f,0,2),I=this._cp3(f,jb,0,1);let sb;if(4<=p)sb=f[3];else{const Ja=this._sub(jb,g);sb=this._add(I,Ja)}this._addAngledTicks(d,g,jb,this._mid(I,sb));this._addAngledTicks(d,I,sb,this._mid(g,jb));break;case l.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Fc=this._cp2(f,2,0),cd=this._cp3(f,Fc,0,1);let dd;if(4<=p)dd=f[3];else{const Ja=this._sub(Fc,g);dd=this._add(cd,Ja)}const Gc=[];Gc.push(this._mid(g,cd));Gc.push(this._mid(Fc,dd));d.push(Gc);break;case l.GeometricEffectControlMeasureLineRule.Chevron:const ed=
this._cp2(f,-1,-1);let fd;if(3<=p)fd=f[2];else{const Ja=this._sub(ed,g);this._leftPerpendicular(Ja);fd=this._add(g,Ja)}d.push([ed,this._makeCtrlPt(g),fd]);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Eb=this._cp2(f,0,-2),gd=this._cp3(f,Eb,.5,-1);let Ya=this._sub(Eb,g);const Fb=this._norm(Ya);Ya[0]/=Fb;Ya[1]/=Fb;const pb=this._crossProduct(Ya,this._sub(gd,g));let tb=this._dotProduct(Ya,this._sub(gd,g));tb<.05*Fb?tb=.05*Fb:tb>.95*Fb&&(tb=.95*Fb);const Yb=[g[0]+Ya[0]*
tb,g[1]+Ya[1]*tb];this._leftPerpendicular(Ya);let Sb=[];Sb.push([Yb[0]-Ya[0]*pb,Yb[1]-Ya[1]*pb]);Sb.push([Yb[0]+Ya[0]*pb,Yb[1]+Ya[1]*pb]);d.push(Sb);const Md=[Eb[0]+Ya[0]*pb,Eb[1]+Ya[1]*pb];Ya=this._sub(Eb,Md);const Fe=Math.cos(Math.PI/18);let Hc=Math.sin(Math.PI/18);0>pb&&(Hc=-Hc);Sb=[g,Eb];for(let Ja=1;9>=Ja;Ja++)this._rotateDirect(Ya,Fe,Hc),Sb.push(this._add(Md,Ya));d.push(Sb);break;case l.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Ic=this._cp2(f,2,0),Zb=this._mid(g,Ic),Nd=this._sub(Ic,
Zb),Ge=Math.cos(Math.PI/18),He=Math.sin(Math.PI/18),Od=[g,Ic];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(Nd,Ge,He),Od.push(this._add(Zb,Nd));d.push(Od);break;case l.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Gb=this._cp2(f,0,-2),hd=this._cp3(f,Gb,1,-2),Hb=this._mid(g,Gb),nb=this._sub(hd,Gb);this._normalize(nb);const Pd=Math.abs(this._crossProduct(nb,this._sub(Hb,Gb)))/2,Tb=this._dist(Gb,hd),Qd=[Gb,g];Qd.push([g[0]+nb[0]*Tb*.5,g[1]+nb[1]*Tb*.5]);d.push(Qd);const Ub=[];Ub.push([Hb[0]-
nb[0]*Pd,Hb[1]-nb[1]*Pd]);Ub.push([Hb[0]+nb[0]*Tb*.375,Hb[1]+nb[1]*Tb*.375]);k.setId(Ub[Ub.length-1],1);Ub.push([Hb[0]+nb[0]*Tb*.75,Hb[1]+nb[1]*Tb*.75]);d.push(Ub);d.push([Gb,hd]);break;case l.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const $b=this._cp2(f,3,0),id=this._cp3(f,$b,.5,-1),ac=this._sub(id,$b);this._normalize(ac);const Rd=this._crossProduct(ac,this._sub(id,g));this._leftPerpendicular(ac);this._addAngledTicks(d,g,$b,id);this._addAngledTicks(d,this._mix(g,1,ac,Rd),this._mix($b,
1,ac,Rd),this._mid(g,$b));break;case l.GeometricEffectControlMeasureLineRule.Parallel:const bc=this._cp2(f,3,0),Ie=this._cp3(f,bc,.5,-1),jd=this._sub(bc,g);this._normalize(jd);const Jc=this._leftPerp(jd),Kc=this._crossProduct(jd,this._sub(Ie,g));let cc=[g,bc];d.push(cc);cc=[];cc.push([g[0]+Jc[0]*Kc,g[1]+Jc[1]*Kc]);cc.push([bc[0]+Jc[0]*Kc,bc[1]+Jc[1]*Kc]);d.push(cc);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const kd=this._cp2(f,3,0),Je=this._cp3(f,kd,.5,-1),Lc=
this._mid(g,kd),Ib=this._sub(kd,g);this._normalize(Ib);const Mc=this._crossProduct(Ib,this._sub(Je,g));this._leftPerpendicular(Ib);const ld=[];ld.push([Lc[0]-Ib[0]*Mc*.25,Lc[1]-Ib[1]*Mc*.25]);ld.push([Lc[0]+Ib[0]*Mc*1.25,Lc[1]+Ib[1]*Mc*1.25]);d.push(ld);break;case l.GeometricEffectControlMeasureLineRule.ParallelOffset:const Vb=this._cp2(f,3,0),Ke=this._cp3(f,Vb,.5,-1),kb=this._sub(Vb,g);this._normalize(kb);const ub=this._crossProduct(kb,this._sub(Ke,g));this._leftPerpendicular(kb);const md=[];md.push([g[0]-
kb[0]*ub,g[1]-kb[1]*ub]);md.push([Vb[0]-kb[0]*ub,Vb[1]-kb[1]*ub]);d.push(md);const nd=[];nd.push([g[0]+kb[0]*ub,g[1]+kb[1]*ub]);nd.push([Vb[0]+kb[0]*ub,Vb[1]+kb[1]*ub]);d.push(nd);break;case l.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Nc=this._cp2(f,3,0),Le=this._cp3(f,Nc,.5,-1),Jb=this._sub(Nc,g);this._normalize(Jb);const Oc=this._crossProduct(Jb,this._sub(Le,g));this._leftPerpendicular(Jb);const od=[];od.push([g[0]-Jb[0]*Oc,g[1]-Jb[1]*Oc]);od.push([Nc[0]-Jb[0]*Oc,Nc[1]-Jb[1]*Oc]);
d.push(od);break;case l.GeometricEffectControlMeasureLineRule.OffsetSame:const Pc=this._cp2(f,3,0),Me=this._cp3(f,Pc,.5,-1),Kb=this._sub(Pc,g);this._normalize(Kb);const Qc=this._crossProduct(Kb,this._sub(Me,g));this._leftPerpendicular(Kb);const pd=[];pd.push([g[0]+Kb[0]*Qc,g[1]+Kb[1]*Qc]);pd.push([Pc[0]+Kb[0]*Qc,Pc[1]+Kb[1]*Qc]);d.push(pd);break;case l.GeometricEffectControlMeasureLineRule.CircleWithArc:let vb=this._cp2(f,3,0);const qd=this._cp3(f,vb,.5,-1);let Wb,Rc;if(4<=p)Wb=f[3],Rc=0<this._crossProduct(this._sub(Wb,
vb),this._sub(qd,vb));else{Wb=vb;Rc=0<this._crossProduct(this._sub(Wb,g),this._sub(qd,g));const Ja=24*this._geomUnitsPerPoint,Wa=this._sub(Wb,g);this._normalize(Wa,Ja);const ab=Math.sqrt(2)/2;this._rotateDirect(Wa,ab,Rc?ab:-ab);vb=this._add(g,Wa)}const Sd=this._sub(vb,g),Td=Math.cos(Math.PI/18),Ne=Math.sin(Math.PI/18),dc=[vb];for(let Ja=1;36>=Ja;Ja++)this._rotateDirect(Sd,Td,Ne),dc.push(this._add(g,Sd));this._add90DegArc(dc,vb,Wb,qd,Rc);k.setId(dc[dc.length-8],1);d.push(dc);break;case l.GeometricEffectControlMeasureLineRule.DoubleJog:let qb=
this._cp2(f,-3,1),wb;wb=3<=p?f[2]:this._add(g,this._sub(g,qb));let ob;if(4<=p)ob=f[3];else{const Ja=g;g=qb;ob=wb;const Wa=this._dist(g,Ja),ab=this._dist(ob,Ja);let xb=30*this._geomUnitsPerPoint;.5*Wa<xb&&(xb=.5*Wa);.5*ab<xb&&(xb=.5*ab);qb=this._mix(g,xb/Wa,Ja,(Wa-xb)/Wa);wb=this._mix(ob,xb/ab,Ja,(ab-xb)/ab)}const Ud=this._mid(g,qb),Vd=this._mid(ob,wb),Oe=this._dist(g,qb),Pe=this._dist(wb,ob);let ec=Math.min(Oe,Pe)/8;ec=Math.min(ec,24*this._geomUnitsPerPoint);const yb=Math.cos(Math.PI/4);let db=this._sub(g,
qb);this._normalize(db,ec);0<this._crossProduct(db,this._sub(ob,qb))?this._rotateDirect(db,yb,-yb):this._rotateDirect(db,yb,yb);let lb=[];lb.push(qb);lb.push(this._add(Ud,db));lb.push(this._sub(Ud,db));lb.push(g);d.push(lb);db=this._sub(ob,wb);this._normalize(db,ec);0>this._crossProduct(db,this._sub(g,wb))?this._rotateDirect(db,yb,yb):this._rotateDirect(db,yb,-yb);lb=[];lb.push(wb);lb.push(this._add(Vd,db));lb.push(this._sub(Vd,db));lb.push(ob);d.push(lb);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Sc=
this._cp2(f,-4,1),Wd=this._cp3(f,Sc,.882353,-1.94),fc=this._sub(Wd,Sc);0<this._crossProduct(fc,this._sub(g,Sc))?this._rightPerpendicular(fc):this._leftPerpendicular(fc);const Qe=[fc[0]/8,fc[1]/8],Re=this._sub(this._mid(Sc,Wd),Qe);d.push([Re,g]);break;case l.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Tc=this._arrowPath(f),Uc=[];let Xd=Tc.length-2;for(;Xd--;)Uc.push(Tc[Xd]);d.push(Uc);break;case l.GeometricEffectControlMeasureLineRule.MultivertexArrow:const Se=this._arrowPath(f),
Yd=[];this._addArrow(Yd,Se,!1);d.push(Yd);break;case l.GeometricEffectControlMeasureLineRule.CrossedArrow:const Te=this._arrowPath(f),Zd=[];this._addArrow(Zd,Te,!0);d.push(Zd);break;case l.GeometricEffectControlMeasureLineRule.ChevronArrow:const [rd,gc]=this._arrowLastSeg(f),Vc=10*this._geomUnitsPerPoint,zb=this._sub(g,rd);this._normalize(zb);const $d=this._crossProduct(zb,this._sub(gc,rd)),sd=this._leftPerp(zb),td=[gc[0]-sd[0]*$d*2,gc[1]-sd[1]*$d*2],Wc=[];Wc.push([gc[0]+zb[0]*Vc,gc[1]+zb[1]*Vc]);
Wc.push(g);Wc.push([td[0]+zb[0]*Vc,td[1]+zb[1]*Vc]);d.push(Wc);break;case l.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [ae,ud]=this._arrowLastSeg(f),rb=this._sub(g,ae);this._normalize(rb);const Xb=this._crossProduct(rb,this._sub(ud,ae));this._leftPerpendicular(rb);const hc=[ud[0]-rb[0]*Xb,ud[1]-rb[1]*Xb],Xc=[];Xc.push([hc[0]+rb[0]*Xb*.5,hc[1]+rb[1]*Xb*.5]);Xc.push(this._mid(hc,g));Xc.push([hc[0]-rb[0]*Xb*.5,hc[1]-rb[1]*Xb*.5]);d.push(Xc);break;case l.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [vd,
wd]=this._arrowLastSeg(f),ic=this._sub(g,vd);this._normalize(ic);const be=this._crossProduct(ic,this._sub(wd,vd));this._leftPerpendicular(ic);d.push([vd,[wd[0]-ic[0]*be,wd[1]-ic[1]*be]]);break;case l.GeometricEffectControlMeasureLineRule.Arch:const xd=this._cp2(f,0,-1),Yc=this._cp3(f,xd,.5,1),ce=this._sub(g,xd),Ue=this._mix(Yc,1,ce,.55),Ve=this._mix(Yc,1,ce,-.55),yd=[g];this._addBezier2(yd,g,Ue,Yc,4);this._addBezier2(yd,Yc,Ve,xd,4);d.push(yd);break;case l.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Ab=
this._cp2(f,-4,1),jc=this._cp3(f,Ab,.882353,-1.94),Lb=this._sub(jc,Ab);0<this._crossProduct(Lb,this._sub(g,Ab))?this._rightPerpendicular(Lb):this._leftPerpendicular(Lb);const zd=[Lb[0]/8,Lb[1]/8],de=this._sub(this._mid(Ab,jc),zd),We=this._sub(this._mix(Ab,.75,jc,.25),zd),Xe=this._sub(this._mix(Ab,.25,jc,.75),zd),Zc=[Ab];this._addBezier2(Zc,Ab,We,de,3);this._addBezier2(Zc,de,Xe,jc,3);d.push(Zc);for(let Ja=0;8>Ja;Ja++){const Wa=Zc[2*Ja+1],ab=[this._clone(Wa)];ab.push(this._add(Wa,[Lb[0]/4,Lb[1]/4]));
d.push(ab)}break;case l.GeometricEffectControlMeasureLineRule.Arc90Degrees:const Ad=this._cp2(f,0,-1),Ye=this._cp3(f,Ad,.5,1),ee=[Ad];this._add90DegArc(ee,Ad,g,Ye);d.push(ee);break;default:d.push(f)}}return d}}a.EffectControlMeasureLine=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=
new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends r.PathEffectCursor{constructor(b,c,d){super(b,!0,!0);this._curveHelper=new k.CurveHelper;this._beginCut=(void 0!==c.beginCut?c.beginCut:1)*d;this._endCut=(void 0!==c.endCut?c.endCut:1)*d;this._middleCut=(void 0!==c.middleCut?c.middleCut:0)*d;this._invert=void 0!==c.invert?c.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(b){const {_beginCut:c,
_endCut:d,_middleCut:f}=this,p=b.pathLength(),g=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===c&&0===d&&0===f)for(g.startPath();b.nextPoint();)g.pushXY(b.x,b.y);else c+d+f<p&&(0===f?this._curveHelper.appendSubCurve(g,b,c,p-d):(this._curveHelper.appendSubCurve(g,b,c,.5*(p-f)),this._curveHelper.appendSubCurve(g,b,.5*(p+f),p-d)));else if(0!==c||0!==d||0!==f)if(c+d+f>=p)for(g.startPath();b.nextPoint();)g.pushXY(b.x,b.y);else this._curveHelper.appendSubCurve(g,
b,0,c),this._curveHelper.appendSubCurve(g,b,.5*(p-f),.5*(p+f)),this._curveHelper.appendSubCurve(g,b,p-d,d);return 0===g.totalSize?null:g}}a.EffectCut=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker".split(" "),function(a,q,r,k,l,m){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(d,
f,p,g,x){return new c(d,f,p)}}b.instance=null;class c extends k.PathEffectCursor{constructor(d,f,p){super(d,!0,!0);this._firstCurve=null;this._walker=new m.GeometryWalker;this._walker.updateTolerance(p);this._endings=f.lineDashEnding;this._customDashPos=-(f.offsetAlongLine??0)*p;this._offsetAtEnd=(f.customEndingOffset??0)*p;this._pattern=new m.DashPattern;this._pattern.init(f.dashTemplate,!0);this._pattern.scale(p)}processPath(d){if(0===this._pattern.length())return this.iteratePath=!1,d=r.collectPath(d),
q.GeometryCursor.fromJSONCIM({paths:[d]});if(!this.iteratePath){var f=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case l.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case l.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case l.LineDashEnding.NoConstraint:this.isClosed||(f=!1);break;case l.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var p=
d.pathLength();if(this._pattern.isEmpty()||p<.1*this._pattern.length()||!this._walker.init(d,this._pattern,f))return d=r.collectPath(d),q.GeometryCursor.fromJSONCIM({paths:[d]})}if(this.iteratePath)d=this._pattern.nextValue();else{switch(this._endings){default:f=.5*this._pattern.firstValue();break;case l.LineDashEnding.HalfGap:f=.5*-this._pattern.lastValue();break;case l.LineDashEnding.FullGap:f=-this._pattern.lastValue();break;case l.LineDashEnding.FullPattern:f=0;break;case l.LineDashEnding.NoConstraint:case l.LineDashEnding.Custom:f=
-this._customDashPos}d=f/this._pattern.length();d-=Math.floor(d);f=d*this._pattern.length();this._pattern.reset();d=this._pattern.nextValue();for(p=!1;f>=d;)f-=d,d=this._pattern.nextValue(),p=!p;d-=f;p?(this._walker.nextPosition(d),d=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(d),d=this._pattern.nextValue(),this._walker.nextPosition(d),d=this._pattern.nextValue())}if(f=this._walker.nextCurve(d))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)f.pushXY(this._firstCurve.x,
this._firstCurve.y);this._firstCurve=null}}else d=this._pattern.nextValue(),!this._walker.nextPosition(d)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(f.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,f=this._firstCurve,this._firstCurve=null;f?.reset();return f}}a.EffectDashes=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor",
"./CurveHelper"],function(a,q,r){class k{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(c,d,f=!0){this._setEmpty();if(!c||0===c.length)return!1;for(let p=0;p<c.length;p++){let g=Math.abs(c[p]);f&&1E-7>g&&(g=1E-7);this._values.push(g);this._length+=g}d&&c.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(c){const d=
this._values?this._values.length:0;for(let f=0;f<d;++f)this._values[f]*=c;this._length*=c;this.extPtGap*=c;this.ctrlPtGap*=c}addValue(c){this._length+=c;this._values.push(c)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=
this._length=0;this._currentValue=-1;this._values.length=0}}class l{constructor(){this.pt=null;this.sa=this.ca=0}}a.EndType=void 0;(function(c){c[c.FAIL=0]="FAIL";c[c.END=1]="END";c[c.CONTINUE=2]="CONTINUE"})(a.EndType||(a.EndType={}));class m{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(c){c.segment=this.segment;c.segmentLength=this.segmentLength;c.abscissa=this.abscissa;c.isPathEnd=
this.isPathEnd;c.isPartEnd=this.isPartEnd}}class b extends r.CurveHelper{constructor(c=0,d=!1){super(c,d);this._tolerance=r.pixelTolerance;this._currentPosition=new m}updateTolerance(c){this._tolerance=r.pixelTolerance*c}init(c,d,f=!0){f?(this._patternLength=d.length(),this._partExtPtGap=d.extPtGap,this._partCtrlPtGap=d.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=c;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(c,
d=a.EndType.FAIL){const f=new m;if(!this._nextPosition(c,f,null,d))return!1;f.copyTo(this._currentPosition);return!0}curPointAndAngle(c){c.pt=this._getPoint(this._currentPosition);const [d,f]=this._getAngleCS(this._currentPosition);c.ca=d;c.sa=f}nextPointAndAngle(c,d,f=a.EndType.FAIL){const p=new m;if(!this._nextPosition(c,p,null,f))return!1;p.copyTo(this._currentPosition);d.pt=this._getPoint(p);const [g,x]=this._getAngleCS(p);d.ca=g;d.sa=x;return!0}nextCurve(c){if(0===c)return null;const d=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
d.startPath();d.nextPath();const f=new m;if(!this._nextPosition(c,f,d,a.EndType.END))return null;f.copyTo(this._currentPosition);return d}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(c){this._pathCursor.seekInPath(c);return[this._pathCursor.x,this._pathCursor.y]}getSeg(c){const d=this.getPt(c);c=this.getPt(c+1);return[d,c]}_nextPosition(c,d,f,p){if(this._currentPosition.isPathEnd)return!1;var g=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(g/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(d);d.abscissa+c*this._partLengthRatio>d.segmentLength+this._tolerance;)if(f&&(0===f.pathSize&&(0===g?(g=d.segment[0],f.pushXY(g[0],g[1])):f.pushPoint(this.getSegCoord2D(d.segment,g))),g=d.segment[1],f.pushXY(g[0],g[1])),g=0,c-=(d.segmentLength-d.abscissa)/this._partLengthRatio,this._partSegCount)d.segment=this._nextSegment(),d.segmentLength=this.getSegLength(d.segment),d.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(p===
a.EndType.FAIL)return!1;d.segmentLength=this.getSegLength(d.segment);d.isPartEnd=!0;p===a.EndType.END?(d.abscissa=d.segmentLength,d.isPathEnd=!0):d.abscissa=d.segmentLength+c;return!0}this._currentPosition.copyTo(d)}d.abscissa+=c*this._partLengthRatio;f&&(0===f.pathSize&&(0===g?f.pushPoint(d.segment[0]):f.pushPoint(this.getSegCoord2D(d.segment,g))),c=d.abscissa/d.segmentLength,1===c?f.pushPoint(d.segment[1]):f.pushPoint(this.getSegCoord2D(d.segment,c)));!this._partSegCount&&Math.abs(d.abscissa-d.segmentLength)<
this._tolerance&&(d.isPathEnd=this._partIsLast,d.isPartEnd=!0);return!0}_getPoint(c){return this.getSegCoord2D(this._currentPosition.segment,0>=c.segmentLength?0:c.abscissa/c.segmentLength)}_getAngleCS(c){return this.getSegAngleCS(this._currentPosition.segment,0>=c.segmentLength?0:c.abscissa/c.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=
0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var c=this._partSegCount;c;)this._previousSegment(),--c;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=
!1;--this._partSegCount;c=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(c);c=c+this._partSegCount+1;c>=this._pathCursor.pathSize&&(c=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(c);if(0<this._patternLength){c=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const d=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let f=Math.round((this._partLength-(c+d))/this._patternLength);0>=f&&(f=0<c+d?0:1);this._partLengthRatio=this._partLength/(c+d+f*
this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}a.DashPattern=k;a.GeometryWalker=b;a.Pos=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),
function(a,q,r,k,l,m){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(d,f,p,g,x,n){return new c(d,f,p,g,x,n)}}b.instance=null;class c{constructor(d,f,p,g,x,n){this._inputGeometries=d;this._tileKey=g;this._geometryEngine=x;this._maxInflateSize=n*p;this._width=(void 0!==f.width?f.width:2)*p;this._option=f.option}next(){for(var d;d=this._inputGeometries.next();){if("esriGeometryEnvelope"===d.geometryType&&0<this._width){var f=d.asJSON();return 0>Math.min(f.xmax-
f.xmin,f.ymax-f.ymin)-2*this._width?d:r.GeometryCursor.fromJSONCIM({paths:[[[f.xmin+this._width,f.ymin+this._width],[f.xmax-this._width,f.ymin+this._width],[f.xmax-this._width,f.ymax-this._width],[f.xmin+this._width,f.ymax-this._width],[f.xmin+this._width,f.ymin+this._width]],[[f.xmin,f.ymin],[f.xmin,f.ymax],[f.xmax,f.ymax],[f.xmax,f.ymin],[f.xmin,f.ymin]]]})}if("esriGeometryPolygon"===d.geometryType){if(0===this._width)return d.clone();var p=this._geometryEngine;if(null==p)break;if(d=this._tileKey?
k.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()){if(p=p.buffer(m.WebMercator,d.asJSON(),-this._width,1))for(f of p.rings)if(f){d.startPath();for(const g of f.reverse())d.pushXY(g[0],d.yFactor*g[1])}return d}}}return null}}a.EffectDonut=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,q,r,k){class l{static local(){null===l.instance&&
(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends r.PathEffectCursor{constructor(b,c,d){super(b,!1,!0);this._curveHelper=new k.CurveHelper;this._length=(void 0!==c.length?c.length:20)*d;this._angle=void 0!==c.angle?c.angle:225;this._position=void 0!==c.position?c.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(b){const c=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(b))return null;b.seekInPath(0);const d=b.x,f=b.y;b.seekInPath(b.pathSize-1);const p=b.x;b=b.y;this._curveHelper.normalize([p-d,b-f]);const g=d+(p-d)*this._position/100,x=f+(b-f)*this._position/100,n=Math.cos((90-this._angle)/180*Math.PI);let e=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(e=-e);this._mirror=!this._mirror;c.pushPath([[d,f],[g-this._length/2*n,x-this._length/2*e],[g+this._length/2*n,x+this._length/2*e],[p,b]]);return c}}a.EffectJog=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(a){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(k,l,m,b,c){return new r(k,l,m)}}q.instance=null;class r{constructor(k,l,m){this._inputGeometries=k;this._offsetX=void 0!==l.offsetX?l.offsetX*m:0;this._offsetY=void 0!==l.offsetY?l.offsetY*m:0}next(){let k=this._inputGeometries.next();for(;k;){if(0<k.totalSize)return this._move(k.clone(),this._offsetX,
this._offsetY);k=this._inputGeometries.next()}return null}_move(k,l,m){for(;k.nextPath();)for(;k.nextPoint();)k.x+=l,k.y+=m;k.reset();return k}}a.EffectMove=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(a,q,r,k,l,m,b,c,d){class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(g,x,n,e,h,u){return new p(g,x,n,e,h,u)}}f.instance=null;class p{constructor(g,x,n,e,h,u){this._inputGeometries=g;this._tileKey=e;this._geometryEngine=h;this._curveHelper=new b.CurveHelper;this._offset=(x.offset??1)*n;this._method=x.method;this._maxInflateSize=u*n;this._option=x.option;this._offsetFlattenError=b.pixelTolerance*n}next(){for(var g;g=this._inputGeometries.next();){if(0===
this._offset)return g.clone();if("esriGeometryEnvelope"===g.geometryType){if(this._method===c.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var x=k.collectPath(g);if(x=this._curveHelper.offset(x,-this._offset,this._method,4,this._offsetFlattenError))return g=r.GeometryCursor.createEmptyOptimizedCIM(g.geometryType),g.pushPath(x),g;break}x=g.asJSON();if(l.isExtent(x)&&0<Math.min(x.xmax-x.xmin,x.ymax-x.ymin)+2*this._offset)return r.GeometryCursor.fromJSONCIM({xmin:x.xmin-this._offset,xmax:x.xmax+
this._offset,ymin:x.ymin-this._offset,ymax:x.ymax+this._offset})}x=this._geometryEngine;if(null!=x&&(g=this._tileKey?m.clipCursorToTileExtent(g,this._maxInflateSize):g.clone()))return(g=x.offset(d.WebMercator,g.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?r.GeometryCursor.fromJSONCIM(g):null}return null}}a.EffectOffset=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(a){class q{static local(){null===
q.instance&&(q.instance=new q);return q.instance}execute(k,l,m,b,c){return new r(k,l,m)}}q.instance=null;class r{constructor(k,l,m){this._inputGeometries=k;this._reverse=void 0!==l.reverse?l.reverse:!0}next(){for(var k=this._inputGeometries.next();k;){if(!this._reverse)return k;if("esriGeometryPolyline"===k.geometryType){for(k=k.clone();k.nextPath();)for(let l=0;l<k.pathSize/2;l++){k.seekInPath(l);const m=k.x,b=k.y;k.seekInPath(k.pathSize-l-1);const c=k.x,d=k.y;k.x=m;k.y=b;k.seekInPath(l);k.x=c;k.y=
d}k.reset();return k}k=this._inputGeometries.next()}return null}}a.EffectReverse=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(a,q){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(l,m,b,c,d){return new k(l,m,b)}}r.instance=null;class k{constructor(l,m,b){this._inputGeometries=l;this._rotateAngle=void 0!==m.angle?m.angle*Math.PI/
180:0}next(){let l=this._inputGeometries.next();for(;l;){if(0===this._rotateAngle||"esriGeometryPoint"===l.geometryType)return l;if(0<l.totalSize){var m=q.getCursorBoundsXY(l);const b=(m[2]+m[0])/2;m=(m[3]+m[1])/2;l.reset();return this._rotate(l.clone(),b,m)}l=this._inputGeometries.next()}return null}_rotate(l,m,b){const c=Math.cos(this._rotateAngle),d=Math.sin(this._rotateAngle);for(;l.nextPath();)for(;l.nextPoint();){const f=l.x-m,p=l.y-b;l.x=m+f*c-p*d;l.y=b+f*d+p*c}l.reset();return l}}a.EffectRotate=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(a,q){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(l,m,b,c,d){return new k(l,m,b)}}r.instance=null;class k{constructor(l,m,b){this._inputGeometries=l;this._xFactor=void 0!==m.XScaleFactor?m.XScaleFactor:1.15;this._yFactor=void 0!==m.YScaleFactor?m.YScaleFactor:1.15}next(){const l=
this._inputGeometries.next();if(l){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===l.geometryType)return l;if(0<l.totalSize){var m=q.getCursorBoundsXY(l);const b=(m[2]+m[0])/2;m=(m[3]+m[1])/2;l.reset();return this._scaleCursor(l.clone(),b,m)}}return null}_scaleCursor(l,m,b){for(;l.nextPath();)for(;l.nextPoint();)l.x=m+(l.x-m)*this._xFactor,l.y=b+(l.y-b)*this._yFactor;l.reset();return l}}a.EffectScale=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports",
"../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m{constructor(b,c,d){this._inputGeometries=b;this._height=(void 0!==c.amplitude?c.amplitude:2)*d;this._period=(void 0!==c.period?c.period:3)*d;this._style=c.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));
this._pattern=new k.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new k.GeometryWalker;this._walker.updateTolerance(d)}next(){for(var b=this._inputGeometries.next();b;){if(0===this._height||0===this._period||(b=this._processGeom(b)))return b;b=this._inputGeometries.next()}return null}_processGeom(b){const c=q.GeometryCursor.createEmptyOptimizedCIM(b.geometryType);for(;b.nextPath();){c.startPath();const d=b.pathLength();if(this._walker.init(b,this._pattern))switch(this._style){default:this._constructCurve(c,
d,!1);break;case r.GeometricEffectWaveform.Square:this._constructSquare(c,d);break;case r.GeometricEffectWaveform.Triangle:this._constructTriangle(c,d);break;case r.GeometricEffectWaveform.Random:this._constructCurve(c,d,!0)}else for(;b.nextPoint();)c.pushXY(b.x,b.y)}return c}_constructCurve(b,c,d){var f=Math.round(c/this._period);0===f&&(f=1);const p=this._period/16,g=1/(16*f+1);c=2*Math.PI*c/(c/f);f=2*Math.PI*Math.random();const x=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),e=.75-Math.random()/
2,h=.75-Math.random()/2,u=new k.Pos;this._walker.curPointAndAngle(u);b.pushPoint(u.pt);let v=0;for(;;)if(this._walker.nextPointAndAngle(p,u)){const y=v;v+=g;let B;if(d){const t=this._height/2*(1+.3*Math.sin(e*c*y+f));B=t*Math.sin(c*y+x);B+=t*Math.sin(h*c*y+n);B/=2}else B=.5*this._height*Math.sin(.5*c*y);b.pushXY(u.pt[0]-B*u.sa,u.pt[1]+B*u.ca)}else{b.pushPoint(this._walker.getPathEnd());break}}_constructSquare(b,c){Math.round(c/this._period);for(c=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const f=
new k.Pos;this._walker.curPointAndAngle(f);const p=new k.Pos;if(this._walker.nextPointAndAngle(this._period,p)){const g=new k.Pos;this._walker.nextPointAndAngle(this._period,g)&&(c?(b.pushPoint(f.pt),c=!1):b.pushPoint(f.pt),b.pushXY(f.pt[0]-this._height/2*f.sa,f.pt[1]+this._height/2*f.ca),b.pushXY(p.pt[0]-this._height/2*p.sa,p.pt[1]+this._height/2*p.ca),b.pushXY(p.pt[0]+this._height/2*p.sa,p.pt[1]-this._height/2*p.ca),b.pushXY(g.pt[0]+this._height/2*g.sa,g.pt[1]-this._height/2*g.ca),d=!0)}}if(!d){b.pushPoint(this._walker.getPathEnd());
break}}}_constructTriangle(b,c){Math.round(c/this._period);for(c=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const f=new k.Pos;this._walker.curPointAndAngle(f);const p=new k.Pos;if(this._walker.nextPointAndAngle(this._period/2,p)){const g=new k.Pos;this._walker.nextPointAndAngle(this._period,g)&&(this._walker.nextPosition(this._period/2)&&(c?(b.pushPoint(f.pt),c=!1):b.pushPoint(f.pt),b.pushXY(p.pt[0]-this._height/2*p.sa,p.pt[1]+this._height/2*p.ca),b.pushXY(g.pt[0]+this._height/2*g.sa,g.pt[1]-
this._height/2*g.ca)),d=!0)}}if(!d){b.pushPoint(this._walker.getPathEnd());break}}}}a.EffectWave=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends q.PathTransformationCursor{constructor(b,
c,d){super(b);this._geometryWalker=new k.GeometryWalker;this._geometryWalker.updateTolerance(d);this._angleToLine=c.angleToLine??!0;this._offset=(c.offset?c.offset:0)*d;this._originalEndings=c.endings;this._offsetAtEnd=(c.customEndingOffset?c.customEndingOffset:0)*d;this._position=-(c.offsetAlongLine?c.offsetAlongLine:0)*d;this._pattern=new k.DashPattern;this._pattern.init(c.placementTemplate,!1);this._pattern.scale(d);this._endings=this._originalEndings}processPath(b){if(this._pattern.isEmpty())return null;
if(this.iteratePath)var c=this._pattern.nextValue();else{this._endings=this._originalEndings===r.PlacementEndings.WithFullGap&&this.isClosed?r.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let d=!0;switch(this._endings){case r.PlacementEndings.NoConstraint:c=-this._position;c=this._adjustPosition(c);d=!1;break;default:c=-this._pattern.lastValue()/2;break;case r.PlacementEndings.WithFullGap:c=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();
break;case r.PlacementEndings.WithMarkers:c=0;break;case r.PlacementEndings.Custom:c=-this._position,c=this._adjustPosition(c),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(b,this._pattern,d))return null;this._pattern.reset();for(b=0;c>b;)c-=b,b=this._pattern.nextValue();c=b-c;this.iteratePath=!0}b=new k.Pos;if(!this._geometryWalker.nextPointAndAngle(c,b)||this._endings===r.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===
r.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(b.pt[0]-this._offset*b.sa,b.pt[1]+this._offset*b.ca);this._angleToLine&&this.internalPlacement.setRotateCS(b.ca,b.sa);return this.internalPlacement}_adjustPosition(b){b/=this._pattern.length();b-=Math.floor(b);return b*this._pattern.length()}}a.PlacementAlongLineSameSize=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends q.PathTransformationCursor{constructor(b,c,d){super(b,!1,!0);this._curveHelper=new r.CurveHelper;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*d:0;this._type=c.extremityPlacement;this._position=void 0!==c.offsetAlongLine?c.offsetAlongLine*
d:0;this._beginProcessed=!1}processPath(b){let c;switch(this._type){default:this._beginProcessed?(c=this._atExtremities(b,this._position,!1),this.iteratePath=this._beginProcessed=!1):(c=this._atExtremities(b,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case k.ExtremityPlacement.JustBegin:c=this._atExtremities(b,this._position,!0);break;case k.ExtremityPlacement.JustEnd:c=this._atExtremities(b,this._position,!1);case k.ExtremityPlacement.None:}return c}_atExtremities(b,c,d){d||
b.seekPathEnd();if(d?b.nextPoint():b.prevPoint()){let f=0,[p,g]=[0,0],[x,n]=[b.x,b.y];for(;d?b.nextPoint():b.prevPoint();){p=x;g=n;x=b.x;n=b.y;const e=this._curveHelper.getLength(p,g,x,n);if(f+e>c){b=(c-f)/e;const [h,u]=this._curveHelper.getAngleCS(p,g,x,n,b);b=this._curveHelper.getCoord2D(p,g,x,n,b);this.internalPlacement.setTranslate(b[0]-this._offset*u,b[1]+this._offset*h);this._angleToLine&&this.internalPlacement.setRotateCS(-h,-u);return this.internalPlacement}f+=e}}return null}}a.PlacementAtExtremities=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(a,q,r){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(m,b,c,d,f){return new l(m,b,c)}}k.instance=null;class l extends q.PathTransformationCursor{constructor(m,b,c){super(m);this._walker=new r.GeometryWalker;this._walker.updateTolerance(c);this._angleToLine=void 0!==
b.angleToLine?b.angleToLine:!0;this._offset=void 0!==b.offset?b.offset*c:0;this._beginGap=void 0!==b.beginPosition?b.beginPosition*c:0;this._endGap=void 0!==b.endPosition?b.endPosition*c:0;this._flipFirst=void 0!==b.flipFirst?b.flipFirst:!0;this._pattern=new r.DashPattern;this._pattern.init(b.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(m){if(this._pattern.isEmpty())return null;if(this.iteratePath){m=this._pattern.nextValue()*
this._subPathLen;var b=this._beginGap+m;m=b-this._prevPos;this._prevPos=b}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=m.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(m,this._pattern,!1))return null;this._pattern.reset();m=this._pattern.nextValue()*this._subPathLen;b=this._beginGap+m;m=b-this._prevPos;this._prevPos=b;this.iteratePath=!0}b=new r.Pos;if(!this._walker.nextPointAndAngle(m,
b,r.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(b.pt[0]-this._offset*b.sa,b.pt[1]+this._offset*b.ca);m=this._isFirst&&this._flipFirst;let c;this._angleToLine?(c=b.ca,b=b.sa):(c=1,b=0);m&&(c=-c,b=-b);this.internalPlacement.setRotateCS(c,b);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}a.PlacementAtRatioPositions=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports",
"../../../core/RandomLCG","../CIMPlacements","../enums"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d,f,p)}}l.instance=null;class m{constructor(b,c,d,f,p){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(c.stepX??16)*d;this._stepY=Math.abs(c.stepY??16)*d;this._stepX=Math.round(128*
this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=c.gridType??k.PlacementGridType.Fixed;if(this._gridType===k.PlacementGridType.Random)this._randomLCG=new q(1*(c.seed??13)),this._randomness=(c.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=c.gridAngle??0;this._shiftOddRows=c.shiftOddRows??!1;this._offsetX=
(c.offsetX??0)*d;this._offsetY=(c.offsetY??0)*d;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=
this._graphicOriginX=0;if(null!=f){const [g,x,n,e]=f.split("/");c=parseFloat(g);d=parseFloat(x);f=parseFloat(n);this._graphicOriginX=512*-(parseFloat(e)*2**c+f);this._graphicOriginY=512*d;this._testInsidePolygon=!0}this._internalPlacement=new r.Placement;this._calculateMinMax(b);this._geometryCursor=b}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!m._randValues){m._randValues=[];for(let b=0;24>b;b++)for(let c=0;24>c;c++)m._randValues.push(this._randomLCG.getFloat()),
m._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(b){this._yMax=this._yMin=this._xMax=this._xMin=0;let c,d,f,p,g,x,n,e;c=d=n=g=Number.MAX_VALUE;f=p=e=x=-Number.MAX_VALUE;var h=1!==this._cosAngle;for(b.reset();b.nextPath();)for(;b.nextPoint();){var u=b.x;var v=b.y;var y=u-this._graphicOriginX-this._offsetX;var B=v-this._graphicOriginY-this._offsetY;if(h){var t=this._cosAngle*y-this._sinAngle*B;y=this._sinAngle*y+this._cosAngle*B}else t=y,y=B;c=Math.min(c,t);f=Math.max(f,t);d=Math.min(d,
y);p=Math.max(p,y);g=Math.min(g,v);x=Math.max(x,v);n=Math.min(n,u);e=Math.max(e,u)}g=g!==Number.MAX_VALUE?g:-512-this._stepY;x=x!==-Number.MAX_VALUE?x:this._stepY;n=n!==Number.MAX_VALUE?n:-this._stepX;e=e!==-Number.MAX_VALUE?e:512+this._stepX;this._polygonMin=(this._verticalSubdivision=x-g>=e-n)?g:n;if(this._testInsidePolygon){t=0-this._graphicOriginX-this._offsetX-this._stepX;v=512-this._graphicOriginX-this._offsetX+this._stepX;u=-512-this._graphicOriginY-this._offsetY-this._stepY;y=0-this._graphicOriginY-
this._offsetY+this._stepY;if(h){h=[[t,u],[t,y],[v,u],[v,y]];t=u=Number.MAX_VALUE;v=y=-Number.MAX_VALUE;for(const w of h)h=this._cosAngle*w[0]-this._sinAngle*w[1],B=this._sinAngle*w[0]+this._cosAngle*w[1],t=Math.min(t,h),v=Math.max(v,h),u=Math.min(u,B),y=Math.max(y,B)}c=c!==Number.MAX_VALUE?Math.max(c,t):t;d=d!==Number.MAX_VALUE?Math.max(d,u):u;f=f!==-Number.MAX_VALUE?Math.min(f,v):v;p=p!==-Number.MAX_VALUE?Math.min(p,y):y}this._xMin=Math.round(c/this._stepX);this._xMax=Math.round(f/this._stepX);this._yMin=
Math.round(d/this._stepY);this._yMax=Math.round(p/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(b,n,e,g,x)}_buildAccelerationMap(b,c,d,f,p){b.reset();const g=new Map,x=this._verticalSubdivision;d=x?p-f:d-c;p=Math.ceil(d/10);if(!(1>=p)){d=Math.floor(d/p);p++;this._delta=d;var n,e;if(x){p=-512-2*this._stepY;var h=2*this._stepY;var u=f}else p=-2*this._stepX,h=512+2*this._stepX,u=c;for(;b.nextPath();)if(!(2>b.pathSize)&&b.nextPoint()){var v=b.x;for(n=
b.y;b.nextPoint();v=c,n=f){c=b.x;f=b.y;if(x){if(n===f||n<p&&f<p||n>h&&f>h)continue;var y=Math.min(n,f);var B=Math.max(n,f)}else{if(v===c||v<p&&c<p||v>h&&c>h)continue;y=Math.min(v,c);B=Math.max(v,c)}for(;y<B;){var t=e=Math.floor((y-u)/d),w=v,C=n,z=c,D=f,H=g;let G=H.get(t);G||(G=[],H.set(t,G));G.push([[w,C],[z,D]]);y+=d}y=Math.floor((B-u)/d);y>e&&(B=c,t=f,w=g,C=w.get(y),C||(C=[],w.set(y,C)),C.push([[v,n],[B,t]]))}}this._accelerationMap=g}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;
if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var b=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(b+=.5*this._stepX);const c=this._currentY*this._stepY+this._offsetY;this._currentX++;let d;if(this._gridType===k.PlacementGridType.Random){const f=(this._currentX%24+24)%24,p=(this._currentY%24+24)%24;d=this._graphicOriginX+b+this._stepX*this._randomness*(.5-m._randValues[24*p+f])*2/3;b=this._graphicOriginY+
c+this._stepY*this._randomness*(.5-m._randValues[24*p+f+1])*2/3}else d=this._graphicOriginX+this._cosAngle*b+this._sinAngle*c,b=this._graphicOriginY-this._sinAngle*b+this._cosAngle*c;if(!this._testInsidePolygon||this._isInsidePolygon(d,b,this._geometryCursor))return this._internalPlacement.setTranslate(d,b),this._internalPlacement}}_isInsidePolygon(b,c,d){if(null==this._accelerationMap){var f=0,p;let n;b+=1E-6;c+=1E-6;for(d.reset();d.nextPath();)if(d.nextPoint()){var g=d.x;for(p=d.y;d.nextPoint();g=
x,p=n){var x=d.x;n=d.y;p>c!==n>c&&(0<(x-g)*(c-p)-(n-p)*(b-g)?f++:f--)}}return 0!==f}b+=1E-6;c+=1E-6;d=this._verticalSubdivision;p=this._accelerationMap.get(Math.floor(((d?c:b)-this._polygonMin)/this._delta));if(!p)return!1;g=0;for(f of p){p=f[0];x=f[1];if(d){if(p[1]>c===x[1]>c)continue;p=(x[0]-p[0])*(c-p[1])-(x[1]-p[1])*(b-p[0])}else{if(p[0]>b===x[0]>b)continue;p=(x[1]-p[1])*(b-p[0])-(x[0]-p[0])*(c-p[1])}0<p?g++:g--}return 0!==g}}a.PlacementInsidePolygon=l;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(a,q,r,k){class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends q.PathTransformationCursor{constructor(b,c,d){super(b);this._curveHelper=new r.CurveHelper;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*d:0;
this._relativeTo=c.relativeTo;this._position=void 0!==c.startPointOffset?c.startPointOffset*d:0;this._epsilon=.001*d}processPath(b){var c=this._position;if(this._relativeTo===k.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(b.nextPoint()){let [d,f]=[b.x,b.y],[p,g]=[0,0];for(;b.nextPoint();){p=b.x;g=b.y;c=this._curveHelper.getLength(d,f,p,g);if(c<this._epsilon){d=p;f=g;continue}b=.5+this._position/c;const [x,n]=this._curveHelper.getAngleCS(d,f,p,g,b);b=this._curveHelper.getCoord2D(d,
f,p,g,b);this.internalPlacement.setTranslate(b[0]-this._offset*n,b[1]+this._offset*x);this._angleToLine&&this.internalPlacement.setRotateCS(x,n);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(b,c,this._relativeTo===k.PlacementOnLineRelativeTo.LineEnd)}onLine(b,c,d){let f=!1;switch(this._relativeTo){default:b.seekPathStart();c=b.pathLength()/2+c;break;case k.PlacementOnLineRelativeTo.LineBeginning:break;case k.PlacementOnLineRelativeTo.LineEnd:f=!0}d?b.seekPathEnd():
b.seekPathStart();let p=0;if(d?b.prevPoint():b.nextPoint()){let [g,x]=[b.x,b.y],[n,e]=[0,0];for(;d?b.prevPoint():b.nextPoint();){n=b.x;e=b.y;const h=this._curveHelper.getLength(g,x,n,e);if(p+h>c){b=(c-p)/h;const [u,v]=this._curveHelper.getAngleCS(g,x,n,e,b);b=this._curveHelper.getCoord2D(g,x,n,e,b);d=f?-this._offset:this._offset;this.internalPlacement.setTranslate(b[0]-d*v,b[1]+d*u);this._angleToLine&&(f?this.internalPlacement.setRotateCS(-u,-v):this.internalPlacement.setRotateCS(u,v));return this.internalPlacement}g=
n;x=e;p+=h}}return null}}a.PlacementOnLine=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(a,q,r){function k(b,c){const d=Math.PI;for(;Math.abs(c-b)>d+2E-15;)c=c-b>d?c-2*d:c+2*d;return(b+c)/2}class l{static local(){null===l.instance&&(l.instance=new l);return l.instance}execute(b,c,d,f,p){return new m(b,c,d)}}l.instance=null;class m extends q.PathTransformationCursor{constructor(b,
c,d){super(b);this._curveHelper=new r.CurveHelper;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*d:0;this._endPoints=void 0!==c.placeOnEndPoints?c.placeOnEndPoints:!0;this._controlPoints=void 0!==c.placeOnControlPoints?c.placeOnControlPoints:!0;this._regularVertices=void 0!==c.placeOnRegularVertices?c.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(b){this.iteratePath||(this._preparePath(b),this.iteratePath=!0);if(this._tagIterator>=
this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;b=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(b[2]);let c=b[0],d=b[1];if(0!==this._offset){const f=Math.cos(b[2]);c-=this._offset*Math.sin(b[2]);d+=this._offset*f}this.internalPlacement.setTranslate(c,d);this._tagIterator++;return this.internalPlacement}_preparePath(b){this._tagIterator=this._tags.length=0;b.seekPathStart();const c=b.isClosed();let d=0,f=!1,p=0,g=0;b.seekPathStart();
if(b.nextPoint()){let x=b.x,n=b.y,e=b.getControlPoint(),h=!0,u=b.nextPoint();for(;u;){const v=b.x,y=b.y,B=b.getControlPoint();if(this._angleToLine||0!==this._offset)p=this._curveHelper.getAngle(x,n,v,y,0);h?(h=!1,c?(d=p,f=e):(this._endPoints||this._controlPoints&&e)&&this._tags.push([x,n,p])):e?this._controlPoints&&this._tags.push([x,n,k(g,p)]):this._regularVertices&&this._tags.push([x,n,k(g,p)]);if(this._angleToLine||0!==this._offset)g=this._curveHelper.getAngle(x,n,v,y,1);(u=b.nextPoint())||(c?
B||f?this._controlPoints&&this._tags.push([v,y,k(g,d)]):this._regularVertices&&this._tags.push([v,y,k(g,d)]):(this._endPoints||this._controlPoints&&B)&&this._tags.push([v,y,g]));x=v;n=y;e=B}}this._tagIterator=0}}a.PlacementOnVertices=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(a,q,r,k,l,m){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(d,f,p,g,x){return new c(d,f,p)}}b.instance=null;class c{constructor(d,f,p){this._geometryCursor=d;this._offsetX=void 0!==f.offsetX?f.offsetX*p:0;this._offsetY=void 0!==f.offsetY?f.offsetY*p:0;this._method=void 0!==f.method?f.method:m.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new l.Placement}next(){const d=this._geometryCursor;this._geometryCursor=null;return d?this._polygonCenter(d):
null}_polygonCenter(d){let f=!1;switch(this._method){case m.PlacementPolygonCenterMethod.CenterOfMass:if(d=r.weightedAreaCentroid(d))this._internalPlacement.setTranslate(d[0]+this._offsetX,d[1]+this._offsetY),f=!0;break;case m.PlacementPolygonCenterMethod.BoundingBoxCenter:if(d=q.getCursorBoundsXY(d))this._internalPlacement.setTranslate((d[2]+d[0])/2+this._offsetX,(d[3]+d[1])/2+this._offsetY),f=!0;break;default:d=k.getLabelPoint(d),null!==d&&(this._internalPlacement.setTranslate(d[0]+this._offsetX,
d[1]+this._offsetY),f=!0)}return f?this._internalPlacement:null}}a.PlacementPolygonCenter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(a,q,r,k,l,m,b){function c(e,h){let u=0,v,y,B,t;for(h.reset();h.nextPath()&&h.nextPoint();)for(v=h.x,y=h.y;h.nextPoint();v=B,y=t)B=h.x,t=h.y,y>e[1]!==t>e[1]&&(0<(B-v)*
(e[1]-y)-(t-y)*(e[0]-v)?u++:u--);return 0!==u}function d(e,h,u){if(u&&c(e,h))return{coord:e,distance:0};u=Infinity;let v=0,y=0;var B=[0,0];let t=[0,0];const w=[0,0];for(h.reset();h.nextPath()&&h.nextPoint();)if(!(2>h.pathSize))for(B[0]=h.x,B[1]=h.y;h.nextPoint();B=t)t=[h.x,h.y],m.projectPointOnLineSeg(w,e,B,t),B=g(e,w),B<u&&(u=B,v=w[0],y=w[1]);return{coord:[v,y],distance:Math.sqrt(u)}}function f(e,h,u,v){u=[h,0];let y=Infinity,B=Infinity,t=!1,w=!1;h=[[h,v[1]-1],[h,v[3]+1]];v=[0,0];const C=[0,0],z=
[0,0],D=[[0,0],[0,0]],H=r.create();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(2>e.pathSize))for(D[0][0]=e.x,D[0][1]=e.y;e.nextPoint();D[0][0]=D[1][0],D[0][1]=D[1][1]){D[1][0]=e.x;D[1][1]=e.y;a:{var G=H;var A=D;if(2>A.length){G=null;break a}G||=r.create();const [J,K]=A[0],[P,E]=A[1];G[0]=Math.min(J,P);G[1]=Math.min(K,E);G[2]=Math.max(J,P);G[3]=Math.max(K,E)}if(null!==G){C[0]=h[0][0];C[1]=h[0][1];z[0]=h[1][0];z[1]=h[1][1];a:{G=H;A=C;var F=z;let J=p(A,G),K=p(F,G);const P=G[0],E=G[1],M=G[2],T=G[3];
if(J&K){G=0;break a}if(!(J|K)){G=4;break a}const ba=(J?1:0)|(K?2:0);do{const ea=F[0]-A[0],X=F[1]-A[1];if(ea>X)J&3?(J&1?(A[1]+=X*(P-A[0])/ea,A[0]=P):(A[1]+=X*(M-A[0])/ea,A[0]=M),J=p(A,G)):K&3?(K&1?(F[1]+=X*(P-F[0])/ea,F[0]=P):(F[1]+=X*(M-F[0])/ea,F[0]=M),K=p(F,G)):J?(J&4?(A[0]+=ea*(E-A[1])/X,A[1]=E):(A[0]+=ea*(T-A[1])/X,A[1]=T),J=p(A,G)):(K&4?(F[0]+=ea*(E-F[1])/X,F[1]=E):(F[0]+=ea*(T-F[1])/X,F[1]=T),K=p(F,G));else if(J&12?(J&4?(A[0]+=ea*(E-A[1])/X,A[1]=E):(A[0]+=ea*(T-A[1])/X,A[1]=T),J=p(A,G)):K&12?
(K&4?(F[0]+=ea*(E-F[1])/X,F[1]=E):(F[0]+=ea*(T-F[1])/X,F[1]=T),K=p(F,G)):J?(J&1?(A[1]+=X*(P-A[0])/ea,A[0]=P):(A[1]+=X*(M-A[0])/ea,A[0]=M),J=p(A,G)):(K&1?(F[1]+=X*(P-F[0])/ea,F[0]=P):(F[1]+=X*(M-F[0])/ea,F[0]=M),K=p(F,G)),J&K){G=0;break a}}while(J|K);G=ba}0!==G&&b.segmentIntersects(h[0],h[1],D[0],D[1],v)&&(G=v[1],y>B?G<y&&(y=G,t=!0):G<B&&(B=G,w=!0))}}t&&w?u[1]=(y+B)/2:u[0]=u[1]=NaN;return u}function p(e,h){return(e[0]<h[0]?1:0)|(e[0]>h[2]?1:0)<<1|(e[1]<h[1]?1:0)<<2|(e[1]>h[3]?1:0)<<3}function g(e,
h){return(e[0]-h[0])*(e[0]-h[0])+(e[1]-h[1])*(e[1]-h[1])}function x(e,h){if(e<h)return-1;if(e>h)return 1;if(e===h)return 0;e=isNaN(e);h=isNaN(h);return e<h?-1:e>h?1:0}class n{constructor(e,h,u,v){this.x=e;this.y=h;this.cellSize=u;this.distancefromCellCenter=m.distanceFromPointToPolygon(e,h,v);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}a.getLabelPoint=function(e){if(0===e.totalSize)return null;var h=k.getCursorBoundsXY(e);if(!h)return null;var u=8.8818E-14*(Math.abs(h[0])+
Math.abs(h[2])+Math.abs(h[1])+Math.abs(h[3])+1),v=0,y=0;e.reset();for(var B=0;e.nextPath();B++){var t=e.getCurrentRingArea();t>y&&(y=t,v=B)}e.seekPath(v);if(0===e.pathSize)return null;e.seekPathStart();t=k.getCursorPathBounds(e);if(Math.abs(y)<=2*u*u)return[(t[0]+t[2])/2,(t[1]+t[3])/2];e.seekPathStart();var w=l.ringCentroidCursorXY(e,r.create());if(null===w)return null;if(4>e.totalPoints)return w;y=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];v=[NaN,NaN,NaN,NaN];B=[NaN,NaN,NaN,NaN];var C=!1,z=d(w,e,
!0);0===z.distance&&(C=!0,y[0][0]=w[0],y[0][1]=w[1],z=d(w,e,!1));v[0]=z.distance;B[0]=0;var D=[NaN,NaN];let H=!1,G=.25,A=-1;z=NaN;do{z=NaN;var F=t[0];y[1]=f(e,F+(t[2]-F)*G,u,h);isNaN(y[1][0])||isNaN(y[1][1])||(z=d(y[1],e,!1),z=z.distance);if(!isNaN(z)&&z>u&&c(y[1],e))H=!0,v[1]=z,B[1]=g(y[1],w);else if(!isNaN(z)&&z>A&&(A=z,D[0]=y[1][0],D[1]=y[1][1]),G-=.01,.1>G)if(0<=A)H=!0,v[1]=A,y[1][0]=D[0],y[1][1]=D[1],B[1]=g(y[1],w);else break}while(!H);H=!1;G=.5;A=-1;F=.01;let J=1;do{z=NaN;var K=t[0];y[2]=f(e,
K+(t[2]-K)*G,u,h);isNaN(y[2][0])||isNaN(y[2][1])||(z=d(y[2],e,!1),z=z.distance);if(!isNaN(z)&&z>u&&c(y[2],e))H=!0,v[2]=z,B[2]=g(y[2],w);else if(!isNaN(z)&&z>A)A=z,D[0]=y[2][0],D[1]=y[2][1];else if(z>A&&(A=z,D[0]=y[2][0],D[1]=y[2][1]),G=.5+F*J,F+=.01,J*=-1,.3>G||.7<G)if(0<=A)H=!0,v[2]=A,y[2][0]=D[0],y[2][1]=D[1],B[2]=g(y[2],w);else break}while(!H);H=!1;G=.75;A=-1;do if(z=NaN,F=t[0],y[3]=f(e,F+(t[2]-F)*G,u,h),isNaN(y[3][0])||isNaN(y[3][1])||(z=d(y[3],e,!1),z=z.distance),!isNaN(z)&&z>u&&c(y[3],e))H=
!0,v[3]=z,B[3]=g(y[3],w);else if(z>A&&(A=z,D[0]=y[3][0],D[1]=y[3][1]),G+=.01,.9<G)if(0<=A)H=!0,v[3]=A,y[3][0]=D[0],y[3][1]=D[1],B[3]=g(y[3],w);else break;while(!H);e=[0,1,2,3];h=C?0:1;for(t=h;4>t;t++)for(C=h;3>C;C++)w=B[C],D=B[C+1],0<x(w,D)&&(u=e[C],e[C]=e[C+1],e[C+1]=u,B[C]=D,B[C+1]=w);B=h;for(t=u=0;4>h;h++){switch(h){case 0:t=2*v[e[h]];break;case 1:t=1.66666666*v[e[h]];break;case 2:t=1.33333333*v[e[h]];break;case 3:t=v[e[h]]}t>u&&(u=t,B=e[h])}return y[B]};a.getPolylabelPoint=function(e){if(!e.nextPath()||
!e.pathSize)return null;var h=k.getCursorPathBounds(e),u=h[2]-h[0],v=h[3]-h[1];if(0===u||0===v)return[h[0]+u/2,h[1]+v/2];const y=Math.max(Math.min(u,v)/100,1),B=new q((C,z)=>z.maxDistanceToPolygon-C.maxDistanceToPolygon);v=Math.min(u,v);u=v/2;let t=0,w=0;for(t=h[0];t<h[2];t+=v)for(w=h[1];w<h[3];w+=v)B.enqueue(new n(t+u,w+u,u,e));e.reset();e.nextPath();h=l.ringsCentroidCursor(e);if(null===h)return null;for(h=new n(h[0],h[1],0,e);0<B.size;)v=B.dequeue(),v.distancefromCellCenter>h.distancefromCellCenter&&
(h=v),v.maxDistanceToPolygon-h.distancefromCellCenter<=y||(u=v.cellSize/2,B.enqueue(new n(v.x-u,v.y-u,u,e)),B.enqueue(new n(v.x+u,v.y-u,u,e)),B.enqueue(new n(v.x-u,v.y+u,u,e)),B.enqueue(new n(v.x+u,v.y+u,u,e)));return[h.x,h.y]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class a{constructor(r=q){this._data=[];this._compare=r}get size(){return this._data.length}enqueue(r){if(null!=r){var {_data:k,_compare:l}=this;k.push(r);
r=k.length-1>>>0;for(var m=k[r];0<r;){const b=r-1>>1,c=k[b];if(0>=l(c,m))k[b]=m,k[r]=c,r=b;else break}}}dequeue(){const {_data:r,_compare:k}=this,l=r[0];var m=r.pop();if(0===r.length)return l;r[0]=m;m=0;const b=r.length,c=r[0];let d;let f=null;for(;;){var p=2*m+1;const g=2*m+2;f=null;p<b&&(d=r[p],0<k(d,c)&&(f=p));g<b&&(p=r[g],null===f&&0>=k(p,c)||null!==f&&0>=k(p,d))&&(f=g);if(null===f)break;r[m]=r[f];r[f]=c;m=f}return l}}const q=(r,k)=>r<k?-1:r>k?1:0;return a})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y){function B(S,Y,ia){switch(Y.type){case "CIMSymbolReference":return B(S,Y.symbol,ia);case "CIMPointSymbol":null==ia&&(ia={x:0,y:0});S.drawSymbol(Y,ia);break;case "CIMLineSymbol":null==ia&&(ia={paths:[[[0,0],[10,0]]]});S.drawSymbol(Y,ia);break;case "CIMPolygonSymbol":null==ia&&(ia={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});S.drawSymbol(Y,ia);break;case "CIMTextSymbol":S.drawSymbol(Y,{x:0,y:0});break;case "CIMVectorMarker":ia=new p.Placement,S.drawMarker(Y,
ia)}return S.envelope()}function t(S){if(!S)return 0;switch(S.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(S.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(S.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(S.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(S.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(S.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(S.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(S.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function w(S){if(!S)return 0;switch(S.type){case "CIMGeometricEffectArrow":return Math.abs(.5*S.width);case "CIMGeometricEffectBuffer":return Math.abs(S.size);case "CIMGeometricEffectExtension":return Math.abs(S.length);case "CIMGeometricEffectJog":return Math.abs(.5*S.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(e.getValue(S.offsetX)),Math.abs(e.getValue(S.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(S.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(S.offset);case "CIMGeometricEffectRadial":return Math.abs(S.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(S.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(S.fromWidth),Math.abs(S.toWidth));case "CIMGeometricEffectWave":return Math.abs(S.amplitude);case "CIMGeometricEffectDonut":return Math.abs(S.width);
default:return 0}}function C(S){if(!S)return 0;let Y=0;for(const ia of S)Y+=w(ia);return Y}function z(S,Y){if(S)switch(S.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(S=S.symbolLayers)for(const ia of S)switch(Y(ia),ia.type){case "CIMVectorMarker":if(S=ia.markerGraphics)for(const na of S)na&&(S=na.symbol)&&z(S,Y)}}}function D(S,Y,ia){S.effects&&null==Y.geometryEngine&&(Y.geometryEnginePromise?ia.push(Y.geometryEnginePromise):e.isGeometryEngineRequired(S.effects)&&(Y.geometryEnginePromise=
e.importGeometryEngine(),ia.push(Y.geometryEnginePromise),Y.geometryEnginePromise.then(na=>Y.geometryEngine=na)))}function H(S){if(!S)return null;let Y=null;const {cap:ia,color:na,join:ta,miterLimit:va,style:xa,width:wa}=S;"solid"!==xa&&"none"!==xa&&"esriSLSSolid"!==xa&&"esriSLSNull"!==xa&&(Y=[{type:"CIMGeometricEffectDashes",dashTemplate:ca(xa,ia),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==xa&&"none"!==xa?X(na):[0,0,0,0],
capStyle:M(ia),joinStyle:T(ta),miterLimit:va,width:wa,effects:Y}}const G=Math.PI,A=G/2,F=Math.PI/180,J=96/72,K=()=>l.getLogger("esri.symbols.cim.CIMSymbolHelper");class P{static getSymbolInflateSize(S,Y,ia,na,ta){S||=[0,0,0,0];return Y?this._getInflateSize(S,Y,ia,na,ta):S}static safeSize(S){const Y=Math.max(Math.abs(S[0]),Math.abs(S[2]));S=Math.max(Math.abs(S[1]),Math.abs(S[3]));return Math.sqrt(Y*Y+S*S)}static _vectorMarkerBounds(S,Y,ia,na){let ta=!0;const va=c.create();if(Y?.markerGraphics)for(const xa of Y.markerGraphics)Y=
[0,0,0,0],xa.geometry&&(d.getBoundsXY(va,xa.geometry),Y[0]=0,Y[1]=0,Y[2]=0,Y[3]=0,this.getSymbolInflateSize(Y,xa.symbol,ia,0,na),va[0]+=Y[0],va[1]+=Y[1],va[2]+=Y[2],va[3]+=Y[3],ta?(S[0]=va[0],S[1]=va[1],S[2]=va[2],S[3]=va[3],ta=!1):(S[0]=Math.min(S[0],va[0]),S[1]=Math.min(S[1],va[1]),S[2]=Math.max(S[2],va[2]),S[3]=Math.max(S[3],va[3])));return S}static _getInflateSize(S,Y,ia,na,ta){return void 0!==Y.symbolLayers?(S=this._getLayersInflateSize(S,Y.symbolLayers,ia,na,ta),Y=C(Y.effects),0<Y&&(S[0]-=Y,
S[1]-=Y,S[2]+=Y,S[3]+=Y),S):this._getTextInflatedSize(S,Y,ta)}static _getLayersInflateSize(S,Y,ia,na,ta){let va=!0;if(!Y)return S;for(const fa of Y)if(fa){Y=[0,0,0,0];switch(fa.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var xa=fa,wa=xa.width;null!=wa&&(wa=xa.capStyle===n.LineCapStyle.Square||xa.joinStyle===n.LineJoinStyle.Miter?wa/1.4142135623730951:wa/2,Y[0]=-wa,Y[1]=-wa,Y[2]=wa,Y[3]=wa);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":xa=
fa;if("CIMVectorMarker"===fa.type){if(wa=fa,Y=this._vectorMarkerBounds(Y,wa,ia,ta),wa.frame){var Ca=(wa.frame.xmin+wa.frame.xmax)/2,L=(wa.frame.ymin+wa.frame.ymax)/2;Y[0]-=Ca;Y[1]-=L;Y[2]-=Ca;Y[3]-=L;null!=wa.size&&(wa=wa.size/(wa.frame.ymax-wa.frame.ymin),Y[0]*=wa,Y[1]*=wa,Y[2]*=wa,Y[3]*=wa)}}else"CIMPictureMarker"===fa.type?(wa=fa,L=ia.getResource(wa.url),Ca=1,null!=L&&L.height&&(Ca=L.width/L.height),null!=xa.size&&(Y=xa.size/2,wa=xa.size*Ca*wa.scaleX/2,Y=[-wa,-Y,wa,Y])):null!=xa.size&&(Y=xa.size/
2,Y=[-Y,-Y,Y,Y]);xa.anchorPoint&&("Absolute"===xa.anchorPointUnits?(wa=xa.anchorPoint.x,Ca=xa.anchorPoint.y):(wa=xa.anchorPoint.x*(Y[2]-Y[0]),Ca=xa.anchorPoint.y*(Y[3]-Y[1])),Y[0]-=wa,Y[1]-=Ca,Y[2]-=wa,Y[3]-=Ca);wa=e.getValue(xa.rotation);xa.rotateClockwise&&(wa=-wa);na&&(wa-=na);wa&&(Ca=F*wa,wa=Math.cos(Ca),Ca=Math.sin(Ca),L=c.create([u.cInfinity,u.cInfinity,-u.cInfinity,-u.cInfinity]),c.expandPointInPlace(L,[Y[0]*wa-Y[1]*Ca,Y[0]*Ca+Y[1]*wa]),c.expandPointInPlace(L,[Y[0]*wa-Y[3]*Ca,Y[0]*Ca+Y[3]*
wa]),c.expandPointInPlace(L,[Y[2]*wa-Y[1]*Ca,Y[2]*Ca+Y[1]*wa]),c.expandPointInPlace(L,[Y[2]*wa-Y[3]*Ca,Y[2]*Ca+Y[3]*wa]),Y=L);wa=e.getValue(xa.offsetX);Ca=e.getValue(xa.offsetY);if(na){var R=F*na;L=Math.cos(R);R=Math.sin(R);const ka=wa*R+Ca*L;wa=wa*L-Ca*R;Ca=ka}Y[0]+=wa;Y[1]+=Ca;Y[2]+=wa;Y[3]+=Ca;xa=t(xa.markerPlacement);0<xa&&(Y[0]-=xa,Y[1]-=xa,Y[2]+=xa,Y[3]+=xa)}xa=C(fa.effects);0<xa&&(Y[0]-=xa,Y[1]-=xa,Y[2]+=xa,Y[3]+=xa);va?(S[0]=Y[0],S[1]=Y[1],S[2]=Y[2],S[3]=Y[3],va=!1):(S[0]=Math.min(S[0],Y[0]),
S[1]=Math.min(S[1],Y[1]),S[2]=Math.max(S[2],Y[2]),S[3]=Math.max(S[3],Y[3]))}return S}static _getTextInflatedSize(S,Y,ia){const na=Y.height??x.defaultCIMValues.CIMTextSymbol.height;S[0]=-na/2;S[1]=-na/2;S[2]=na/2;S[3]=na/2;if(!ia)return S;ia=ia.get(Y);if(!ia||!ia.glyphMosaicItems.glyphs.length)return S;const {lineGapType:ta,lineGap:va}=Y,xa=ta?g.lineGapType2LineHeight(ta,va??0,na):0,wa="CIMBackgroundCallout"===Y.callout?.type;Y=y.shapeGlyphs(ia.glyphMosaicItems,{scale:na/v.glyphSize,angle:e.getValue(Y.angle),
xOffset:e.getValue(Y.offsetX),yOffset:e.getValue(Y.offsetY),horizontalAlignment:Y.horizontalAlignment,verticalAlignment:Y.verticalAlignment,maxLineWidth:512,lineHeight:v.magicLabelLineHeight*Math.max(.25,Math.min(xa||1,4)),decoration:Y.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:wa}).boundsT;S[0]=Y.x-Y.halfWidth;S[1]=-Y.y-Y.halfHeight;S[2]=Y.x+Y.halfWidth;S[3]=-Y.y+Y.halfHeight;return S}}class E{static getEnvelope(S,Y,ia){if(!S)return null;ia=new g.EnvDrawHelper(ia);if(Array.isArray(S)){let na;
for(const ta of S)na?na.union(B(ia,ta,Y)):na=B(ia,ta,Y);return na}return B(ia,S,Y)}static getTextureAnchor(S,Y){S=this.getEnvelope(S,null,Y);if(!S)return[0,0,0];Y=S.height*J+2;return[-((S.x+.5*S.width)*J)/(S.width*J+2),-((S.y+.5*S.height)*J)/Y,Y]}static rasterize(S,Y,ia,na,ta=!0){var va=ia||this.getEnvelope(Y,null,na);if(!va)return[null,0,0,0,0];const xa=(va.x+.5*va.width)*J,wa=(va.y+.5*va.height)*J;S.width=va.width*J;S.height=va.height*J;ia||(S.width+=2,S.height+=2);ia=S.getContext("2d",{willReadFrequently:!0});
va=g.Transformation.createScale(J,-J);va.translate(.5*S.width-xa,.5*S.height+wa);na=new g.CanvasDrawHelper(ia,na,va);switch(Y.type){case "CIMPointSymbol":na.drawSymbol(Y,{type:"point",x:0,y:0});break;case "CIMVectorMarker":va=new p.Placement,na.drawMarker(Y,va)}Y=ia.getImageData(0,0,S.width,S.height);Y=new Uint8Array(Y.data);if(ta)for(na=0;na<Y.length;na+=4)ta=Y[na+3]/255,Y[na]*=ta,Y[na+1]*=ta,Y[na+2]*=ta;return[Y,S.width,S.height,-xa/S.width,-wa/S.height]}static fromTextSymbol(S){const {text:Y}=
S;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:E.createCIMTextSymbolfromTextSymbol(S),textString:Y}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(S){const {height:Y,outline:ia,width:na,xoffset:ta,xscale:va,
yoffset:xa,yscale:wa}=S,Ca=[],L={type:"CIMPolygonSymbol",symbolLayers:Ca};if(ia){var R=H(ia);R&&Ca.push(R)}R=S.url;"esriPFS"===S.type&&S.imageData&&(R=S.imageData);S="angle"in S?S.angle??0:0;Ca.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:R,height:(Y??0)*(wa||1),width:(na??0)*(va||1),offsetX:e.getValue(ta),offsetY:e.getValue(xa),rotation:e.getValue(-S),colorSubstitutions:null});return L}static fromSimpleFillSymbol(S){const {color:Y,
style:ia,outline:na}=S;S=[];const ta={type:"CIMPolygonSymbol",symbolLayers:S};if(na){var va=H(na);va&&S.push(va)}if(ia&&"solid"!==ia&&"none"!==ia&&"esriSFSSolid"!==ia&&"esriSFSNull"!==ia){va={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:X(Y),capStyle:n.LineCapStyle.Butt,joinStyle:n.LineJoinStyle.Miter,width:.75}]};let xa=0;const wa=b.px2pt("vertical"===ia||"horizontal"===ia||"cross"===ia||"esriSFSCross"===ia||"esriSFSVertical"===ia||"esriSFSHorizontal"===ia?8:10);switch(ia){case "vertical":case "esriSFSVertical":xa=
90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":xa=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":xa=45;break;case "cross":case "esriSFSCross":xa=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":xa=-45}S.push({type:"CIMHatchFill",lineSymbol:va,offsetX:0,offsetY:0,rotation:xa,separation:wa});"cross"===ia||"esriSFSCross"===ia?S.push({type:"CIMHatchFill",lineSymbol:k.clone(va),offsetX:0,offsetY:0,rotation:90,separation:wa}):("diagonal-cross"===ia||"esriSFSDiagonalCross"===
ia)&&S.push({type:"CIMHatchFill",lineSymbol:k.clone(va),offsetX:0,offsetY:0,rotation:45,separation:wa})}else!ia||"solid"!==ia&&"esriSFSSolid"!==ia||S.push({type:"CIMSolidFill",enable:!0,color:X(Y)});return ta}static fromSimpleLineSymbol(S){const {cap:Y,color:ia,join:na,marker:ta,miterLimit:va,style:xa,width:wa}=S;S=null;"solid"!==xa&&"none"!==xa&&"esriSLSSolid"!==xa&&"esriSLSNull"!==xa&&(S=[{type:"CIMGeometricEffectDashes",dashTemplate:ca(xa,Y),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);
const Ca=[];if(ta){let L;switch(ta.placement){case "begin-end":L=n.ExtremityPlacement.Both;break;case "begin":L=n.ExtremityPlacement.JustBegin;break;case "end":L=n.ExtremityPlacement.JustEnd;break;default:L=n.ExtremityPlacement.None}const R=E.fromSimpleMarker(ta,wa,ia).symbolLayers[0];R.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:L,offsetAlongLine:0};Ca.push(R)}Ca.push({type:"CIMSolidStroke",color:"none"!==xa&&"esriSLSNull"!==xa?X(ia):[0,0,0,
0],capStyle:M(Y),joinStyle:T(na),miterLimit:va,width:wa,effects:S});return{type:"CIMLineSymbol",symbolLayers:Ca}}static fromPictureMarker(S){const {angle:Y,height:ia,width:na,xoffset:ta,yoffset:va}=S;let xa=S.url;"esriPMS"===S.type&&S.imageData&&(xa=S.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:xa,size:ia,width:na,offsetX:e.getValue(ta),offsetY:e.getValue(va),rotation:e.getValue(-Y)}]}}static createCIMTextSymbolfromTextSymbol(S){const {angle:Y,
color:ia,font:na,haloColor:ta,haloSize:va,horizontalAlignment:xa,kerning:wa,text:Ca,verticalAlignment:L,xoffset:R,yoffset:fa,backgroundColor:ka,borderLineColor:qa,borderLineSize:Q}=S;let V,W,ha;if(na){var la=na.family;var N=na.style;var aa=na.weight;V=na.size;W=na.decoration}S=!1;Ca&&(S=q.bidiText(Ca)[1]);if(ka||Q)ha={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:X(ka)},{type:"CIMSolidStroke",color:X(qa),width:Q}]},accentBarSymbol:null,
gap:null,leaderLineSymbol:null,lineStyle:null};var ja=n.BlockProgression.BTT,oa=n.FontEffects.Normal,ua=n.FontEncoding.Unicode;la=la||"Arial";b:{if(aa)switch(aa.toLowerCase()){case "bold":case "bolder":aa="bold";break b}aa=""}b:{if(N)switch(N.toLowerCase()){case "italic":case "oblique":N="italic";break b}N=""}aa=aa&&N?`${aa}-${N}`:`${aa}${N}`;return{type:"CIMTextSymbol",angle:Y,blockProgression:ja,depth3D:1,extrapolateBaselines:!0,fontEffects:oa,fontEncoding:ua,fontFamilyName:la,fontStyleName:aa,
fontType:n.FontType.Unspecified,haloSize:va,height:V,hinting:n.GlyphHinting.Default,horizontalAlignment:ba(xa??"center"),kerning:wa,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:e.getValue(R),offsetY:e.getValue(fa),strikethrough:"line-through"===W,underline:"underline"===W,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:X(ia)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:X(ta)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,
shadowOffsetY:1,textCase:"Normal",textDirection:S?n.TextReadingDirection.RTL:n.TextReadingDirection.LTR,verticalAlignment:ea(L??"baseline"),verticalGlyphOrientation:n.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:n.BillBoardMode.FaceNearPlane,callout:ha}}static createPictureMarkerRasterizationParam(S){const {angle:Y,height:ia,width:na,xoffset:ta,yoffset:va}=S;return(S=S.url??S.source?.url??S.source?.imageData)?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",
invertBackfaceTexture:!1,scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:S,size:ia,width:na,offsetX:e.getValue(ta),offsetY:e.getValue(va),rotation:e.getValue(-Y)}}:null}static createPictureFillRasterizationParam(S){const {width:Y,height:ia,xoffset:na,yoffset:ta,url:va}=S;return va?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:va,width:Y,height:ia,offsetX:e.getValue(na),offsetY:e.getValue(ta),
rotation:0}}:null}static fromSimpleMarker(S,Y,ia){var {style:na}=S;ia=S.color??ia;if("path"===na||"esriSMSPath"===na){Y=[];if("outline"in S&&S.outline){var ta=S.outline;Y.push({type:"CIMSolidStroke",enable:!0,width:b.px2pt(Math.round(b.pt2px(ta.width))),color:X(ta.color),path:S.path})}Y.push({type:"CIMSolidFill",enable:!0,color:X(ia),path:S.path});const [L,R]=ma("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-e.getValue(S.angle),size:e.getValue(S.size||
6),offsetX:e.getValue(S.xoffset),offsetY:e.getValue(S.yoffset),scaleSymbolsProportionally:!1,frame:L,markerGraphics:[{type:"CIMMarkerGraphic",geometry:R,symbol:{type:"CIMPolygonSymbol",symbolLayers:Y}}]}]}}const va=[];ta=S.size;let xa;if("outline"in S&&S.outline&&"none"!==S.outline.style&&"esriSLSNull"!==S.outline.style){const L=S.outline,R="solid"!==L.style&&"esriSLSSolid"!==L.style;[na,xa]=R?ma(na,S.size):ma(na);let fa=L.width??h.defaultPolylineSymbol2D.width;fa=.667<fa?b.px2pt(Math.round(b.pt2px(fa))):
fa;if(R){var wa=fa/S.size,Ca=(na.xmax-na.xmin)*wa/2;wa=(na.ymax-na.ymin)*wa/2;na.xmin-=Ca;na.xmax+=Ca;na.ymin-=wa;na.ymax+=wa;ta&&(ta+=fa)}Ca="cross"!==S.style&&"x"!==S.style||"dot"===S?.outline.style||"short-dot"===S?.outline.style?n.LineDashEnding.HalfGap:n.LineDashEnding.FullPattern;Ca=R?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:ca(L.style,null).map(ka=>L.width&&0<L.width?ka*L.width:ka),lineDashEnding:Ca,controlPointEnding:n.LineDashEnding.FullPattern}]:
void 0;va.push({type:"CIMSolidStroke",capStyle:R?n.LineCapStyle.Round:n.LineCapStyle.Butt,enable:!0,width:fa,color:X(L.color),effects:Ca})}else!Y||"line-marker"!==S.type||"cross"!==S.style&&"x"!==S.style?[na,xa]=ma(na):([na,xa]=ma(na),va.push({type:"CIMSolidStroke",enable:!0,width:Y,color:X(ia)}));va.push({type:"CIMSolidFill",enable:!0,color:X(ia)});ia={type:"CIMPolygonSymbol",symbolLayers:va};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.getValue(-S.angle),
size:e.getValue(ta||6*Y),offsetX:e.getValue(S.xoffset),offsetY:e.getValue(S.yoffset),scaleSymbolsProportionally:!1,frame:na,markerGraphics:[{type:"CIMMarkerGraphic",geometry:xa,symbol:ia}]}]}}static fromCIMHatchFill(S,Y){const ia=Y*(S.separation??x.defaultCIMValues.CIMHatchFill.separation),na=ia/2;S=k.clone(S.lineSymbol);S.symbolLayers?.forEach(va=>{switch(va.type){case "CIMSolidStroke":null!=va.width&&(va.width*=Y);va.effects?.forEach(xa=>{"CIMGeometricEffectDashes"===xa.type&&(xa.dashTemplate=xa.dashTemplate.map(wa=>
wa*Y))});break;case "CIMVectorMarker":null!=va.size&&(va.size*=Y),va=va.markerPlacement,null!=va&&"placementTemplate"in va&&(va.placementTemplate=va.placementTemplate.map(xa=>xa*Y))}});for(var ta=this._getLineSymbolPeriod(S)||4;4>ta;)ta*=2;ta/=2;return{type:"CIMVectorMarker",frame:{xmin:-ta,xmax:ta,ymin:-na,ymax:na},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-ta,0],[ta,0]]]},symbol:S}],size:ia}}static fetchResources(S,Y,ia,na=null){if(!S||!Y)return ia;z(S,ta=>{D(ta,Y,ia);"url"in ta&&
ta.url&&ia.push(Y.fetchResource(ta.url,{signal:na}))});return ia}static fetchFonts(S,Y,ia){if(S&&Y)if("symbolLayers"in S&&S.symbolLayers)for(const va of S.symbolLayers){if("CIMVectorMarker"===va.type&&va.markerGraphics)for(const xa of va.markerGraphics)xa?.symbol&&E.fetchFonts(xa.symbol,Y,ia)}else if("CIMTextSymbol"===S.type){const {fontFamilyName:va,fontStyleName:xa}=S;if(va&&"calcitewebcoreicons"!==va.toLowerCase()){var {style:na,weight:ta}=e.fromCIMFontStyle(xa);S=e.fromCIMFontDecoration(S);S=
new f({family:va,style:na,weight:ta,decoration:S});ia.push(Y.loadFont(S).catch(()=>{K().error(`Unsupported font ${va} in CIM symbol`)}))}}}static _getLineSymbolPeriod(S){if(S){const Y=this._getEffectsRepeat(S.effects);if(Y)return Y;if(S.symbolLayers)for(const ia of S.symbolLayers)if(ia){if(S=this._getEffectsRepeat(ia.effects))return S;switch(ia.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(S=this._getPlacementRepeat(ia.markerPlacement))return S}}}return 0}static _getEffectsRepeat(S){if(S)for(var Y of S)if(Y)switch(Y.type){case "CIMGeometricEffectDashes":if((S=
Y.dashTemplate)&&S.length){Y=0;for(const ia of S)Y+=ia;S.length&1&&(Y*=2);return Y}break;case "CIMGeometricEffectWave":return Y.period;default:K().error(`unsupported geometric effect type ${Y.type}`)}return 0}static _getPlacementRepeat(S){if(S)switch(S.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((S=S.placementTemplate)&&S.length){let Y=0;for(const ia of S)Y+=+ia;S.length&1&&(Y*=2);return Y}}return 0}static fromCIMInsidePolygon(S){var Y=
S.markerPlacement;const ia={...S,markerPlacement:null,anchorPoint:null};S=Math.abs(Y.stepX);const na=Math.abs(Y.stepY);var ta=(Y.randomness??100)/100;let va,xa;if("Random"===Y.gridType){var wa=b.px2pt(v.randomInsidePolygonTextureSize);const Ca=Math.max(Math.floor(wa/S),1),L=Math.max(Math.floor(wa/na),1);wa=Ca*S/2;va=L*na/2;xa=2*va;Y=new m(Y.seed);const R=ta*S/1.5,fa=ta*na/1.5;ta=[];for(let ka=0;ka<Ca;ka++)for(let qa=0;qa<L;qa++){const Q=ka*S-wa+R*(.5-Y.getFloat()),V=qa*na-va+fa*(.5-Y.getFloat());
ta.push({x:Q,y:V});0===ka&&ta.push({x:Q+2*wa,y:V});0===qa&&ta.push({x:Q,y:V+2*va})}}else!0===Y.shiftOddRows?(wa=S/2,va=na,xa=2*na,ta=[{x:-wa,y:0},{x:wa,y:0},{x:0,y:va},{x:0,y:-va}]):(wa=S/2,va=na/2,xa=na,ta=[{x:-S,y:0},{x:0,y:-na},{x:-S,y:-na},{x:0,y:0},{x:S,y:0},{x:0,y:na},{x:S,y:na},{x:-S,y:na},{x:S,y:-na}]);S=ta.map(Ca=>({type:"CIMMarkerGraphic",geometry:Ca,symbol:{type:"CIMPointSymbol",symbolLayers:[ia]}}));return{type:"CIMVectorMarker",frame:{xmin:-wa,xmax:wa,ymin:-va,ymax:va},markerGraphics:S,
size:xa}}static getSize(S){if(S)switch(S.type){case "CIMTextSymbol":return S.height;case "CIMPointSymbol":var Y=0;if(S.symbolLayers)for(var ia of S.symbolLayers)if(ia)switch(ia.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":S=ia.size??x.defaultCIMValues.CIMVectorMarker.size,S>Y&&(Y=S)}return Y;case "CIMLineSymbol":case "CIMPolygonSymbol":ia=0;if(S.symbolLayers)for(Y of S.symbolLayers)if(Y)switch(Y.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":S=
Y.width;null!=S&&S>ia&&(ia=S);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":Y.markerPlacement&&e.isCIMMarkerStrokePlacement(Y.markerPlacement)&&(S=Y.size??x.defaultCIMValues.CIMVectorMarker.size,S>ia&&(ia=S));break;case "CIMPictureFill":S=Y.height,null!=S&&S>ia&&(ia=S)}return ia}}}const M=S=>{if(!S)return n.LineCapStyle.Butt;switch(S){case "butt":return n.LineCapStyle.Butt;case "square":return n.LineCapStyle.Square;case "round":return n.LineCapStyle.Round}},
T=S=>{if(!S)return n.LineJoinStyle.Miter;switch(S){case "miter":return n.LineJoinStyle.Miter;case "round":return n.LineJoinStyle.Round;case "bevel":return n.LineJoinStyle.Bevel}},ba=S=>{if(null==S)return"Center";switch(S){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},ea=S=>{if(null==S)return"Center";switch(S){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},X=S=>{if(!S)return[0,0,0,0];const {r:Y,
g:ia,b:na,a:ta}=S;return[Y,ia,na,255*ta]},ca=(S,Y)=>{const ia=r("safari")?.001:0;Y="butt"===Y;switch(S){case "dash":case "esriSLSDash":return Y?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return Y?[4,3,1,3]:[3,4,ia,4];case "dot":case "esriSLSDot":return Y?[1,3]:[ia,4];case "long-dash":case "esriSLSLongDash":return Y?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return Y?[8,3,1,3]:[7,4,ia,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return Y?[8,3,1,3,1,3]:[7,4,ia,4,ia,4];
case "short-dash":case "esriSLSShortDash":return Y?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return Y?[4,1,1,1]:[3,2,ia,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return Y?[4,1,1,1,1,1]:[3,2,ia,2,ia,2];case "short-dot":case "esriSLSShortDot":return Y?[1,1]:[ia,2];case "solid":case "esriSLSSolid":case "none":return K().error("Unexpected: style does not require rasterization"),[0,0];default:return K().error(`Tried to rasterize SLS, but found an unexpected style: ${S}!`),
[0,0]}},ma=(S,Y=100)=>{var ia=Y/2,na;if("circle"===S||"esriSMSCircle"===S){var ta=Math.acos(1-.25/ia);Y=Math.ceil(G/ta/4);0===Y&&(Y=1);ta=A/Y;Y*=4;S=[];S.push([ia,0]);for(na=1;na<Y;na++)S.push([ia*Math.cos(na*ta),-ia*Math.sin(na*ta)]);S.push([ia,0]);ta={rings:[S]};na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}}else"cross"===S||"esriSMSCross"===S?(ta={paths:[[[0,ia],[0,-ia]],[[ia,0],[-ia,0]]]},na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"diamond"===S||"esriSMSDiamond"===S?(ta={rings:[[[-ia,0],[0,ia],[ia,0],[0,
-ia],[-ia,0]]]},na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"square"===S||"esriSMSSquare"===S?(ta={rings:[[[-ia,-ia],[-ia,ia],[ia,ia],[ia,-ia],[-ia,-ia]]]},na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"x"===S||"esriSMSX"===S?(ta={paths:[[[ia,ia],[-ia,-ia]],[[ia,-ia],[-ia,ia]]]},na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"triangle"===S||"esriSMSTriangle"===S?(ia=.5773502691896257*Y,S=-ia,na=2/3*Y,Y=na-Y,ta={rings:[[[S,Y],[0,na],[ia,Y],[S,Y]]]},na={xmin:S,ymin:Y,xmax:ia,ymax:na}):"arrow"===S&&(ta={rings:[[[-50,
50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},na={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia});return[na,ta]};a.CIMSymbolHelper=E;a.CIMSymbolInflatedSizeHelper=P;a.capTypeToEnum=M;a.getEffectsInflateSize=C;a.rgbaColorToArray=X;a.slsDashToTemplateArray=ca;a.symbolToCIM=function(S){let Y;switch(S.type){case "cim":return S.data;case "web-style":return S;case "simple-marker":S=E.fromSimpleMarker(S);if(!S)throw Error("InternalError: Cannot convert symbol to CIM");Y=S;break;case "picture-marker":Y=E.fromPictureMarker(S);
break;case "simple-line":Y=E.fromSimpleLineSymbol(S);break;case "simple-fill":Y=E.fromSimpleFillSymbol(S);break;case "picture-fill":Y=E.fromPictureFillSymbol(S);break;case "text":Y=E.fromTextSymbol(S)}return{type:"CIMSymbolReference",symbol:Y}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(a,q){const r=new q;a.bidiText=function(k){if(null==k)return["",!1];if(!r.hasBidiChar(k))return[k,!1];let l;l="rtl"===
r.checkContextual(k)?"IDNNN":"ICNNN";return[r.bidiTransform(k,l,"VLYSN"),!0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/Font":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./support/textUtils".split(" "),function(a,q,r,k,l,m,b,c,d){var f;q=f=class extends q.JSONSupport{constructor(p){super(p);
this.decoration="none";this.family="sans-serif";this.size=9;this.weight=this.style="normal"}castSize(p){return r.toPt(p)}clone(){return new f({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};a.__decorate([k.property({type:d.fontDecorations,json:{default:"none",write:!0}})],q.prototype,"decoration",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],
q.prototype,"family",void 0);a.__decorate([k.property({type:Number,json:{write:{overridePolicy(p,g,x){return{enabled:!x||!x.textSymbol3D}}}}})],q.prototype,"size",void 0);a.__decorate([l.cast("size")],q.prototype,"castSize",null);a.__decorate([k.property({type:d.fontStyles,json:{default:"normal",write:!0}})],q.prototype,"style",void 0);a.__decorate([k.property({type:d.fontWeights,json:{default:"normal",write:!0}})],q.prototype,"weight",void 0);return q=f=a.__decorate([c.subclass("esri.symbols.Font")],
q)})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],function(a,q,r){const k={type:Number,cast:d=>{d=r.ensureNumber(d);return 0===d?1:q.clamp(d,.1,4)},nonNullable:!0},l=["left","right","center"],m=["baseline","top","middle","bottom"],b={type:l,nonNullable:!0},c={type:m,nonNullable:!0};a.backgroundPadding=8;a.fontDecorations=["none","underline","line-through"];a.fontStyles=["normal","italic","oblique"];a.fontWeights=["normal",
"lighter","bold","bolder"];a.horizontalAlignmentProperty=b;a.horizontalAlignments=l;a.lineHeightProperty=k;a.verticalAlignmentProperty=c;a.verticalAlignments=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B,t,w,C){function z(E,M=1){const T=t.fromCIMFontDecoration(E);var ba=t.fromCIMFontStyle(E.fontStyleName);const ea=E.fontFamilyName??q.defaultFontFamily,{weight:X,style:ca}=ba;ba=M*(E.height||5);const ma=t.fromCIMHorizontalAlignment(E.horizontalAlignment),S=t.fromCIMVerticalAlignment(E.verticalAlignment),Y=t.getFillColor(E),ia=t.getFillColor(E.haloSymbol);M=null!=ia?M*(E.haloSize??0):0;var na="CIMBackgroundCallout"===E.callout?.type?E.callout.backgroundSymbol:
null;E=t.getFillColor(na);const ta=t.getStrokeWidth(na);na=t.getStrokeColor(na);return{color:Y,size:ba,horizontalAlignment:ma,verticalAlignment:S,font:{family:ea,style:t.getFontStyle(ca),weight:t.getFontWeight(X),decoration:T},halo:{size:M||0,color:ia,style:ca},backgroundColor:E,borderLine:null!=ta&&null!=na?{size:ta,color:na}:null,pixelRatio:1,premultiplyColors:!0}}const D=Math.PI/180;class H{constructor(E){this._t=E}static createIdentity(){return new H([1,0,0,0,1,0])}clone(){return new H(this._t.slice())}transform(E){const M=
this._t;return[M[0]*E[0]+M[1]*E[1]+M[2],M[3]*E[0]+M[4]*E[1]+M[5]]}static createScale(E,M){return new H([E,0,0,0,M,0])}scale(E,M){const T=this._t;T[0]*=E;T[1]*=E;T[2]*=E;T[3]*=M;T[4]*=M;T[5]*=M;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(E,M){return new H([0,0,E,0,0,M])}translate(E,M){const T=this._t;T[2]+=E;T[5]+=M;return this}static createRotate(E){const M=Math.cos(E);E=Math.sin(E);return new H([M,-E,0,E,M,0])}rotate(E){return H.multiply(this,
H.createRotate(E),this)}angle(){const E=this._t[0],M=this._t[3],T=Math.sqrt(E*E+M*M);return[E/T,M/T]}static multiply(E,M,T){E=E._t;M=M._t;const ba=E[1]*M[0]+E[4]*M[1],ea=E[2]*M[0]+E[5]*M[1]+M[2],X=E[0]*M[3]+E[3]*M[4],ca=E[1]*M[3]+E[4]*M[4],ma=E[2]*M[3]+E[5]*M[4]+M[5],S=T._t;S[0]=E[0]*M[0]+E[3]*M[1];S[1]=ba;S[2]=ea;S[3]=X;S[4]=ca;S[5]=ma;return T}invert(){const E=this._t;let M=E[0]*E[4]-E[1]*E[3];if(0===M)return new H([0,0,0,0,0,0]);M=1/M;return new H([E[4]*M,-E[1]*M,(E[1]*E[5]-E[2]*E[4])*M,-E[3]*
M,E[0]*M,(E[2]*E[3]-E[0]*E[5])*M])}}class G{constructor(E,M){this._resourceManager=E;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new l(e.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(M||H.createIdentity());this._sizeTransfos.push(M?M.scaleRatio():1)}setTransform(E,M){this._transfos=[E||H.createIdentity()];this._sizeTransfos=[M||(E?E.scaleRatio():1)]}setGeomUnitsPerPoint(E){this._geomUnitsPerPoint=E}transformPt(E){return this._transfos[this._transfos.length-
1].transform(E)}transformSize(E){return E*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(E){return this._transfos[this._transfos.length-1].invert().transform(E)}reverseTransformSize(E){return E/this._sizeTransfos[this._sizeTransfos.length-1]}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-
1]}push(E,M){M=M?E.scaleRatio():1;H.multiply(E,this.back(),E);this._transfos.push(E);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*M)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(E,M,T){if(E)switch(E.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(E,M);break;case "CIMTextSymbol":this.drawTextSymbol(E,M,T)}}drawMultiLayerSymbol(E,M){if(E&&M){var T=E.symbolLayers;if(T)if((E=E.effects)&&0<E.length){if(M=
this.executeEffects(E,M))for(E=M.next();E;)this.drawSymbolLayers(T,E.asJSON()),E=M.next()}else this.drawSymbolLayers(T,M)}}executeEffects(E,M){const T=this._resourceManager.geometryEngine;M=new g.SimpleEffectCursor(b.GeometryCursor.fromJSONCIM(M));for(const ba of E)(E=n.getEffectOperator(ba))&&(M=E.execute(M,ba,this.geomUnitsPerPoint(),null,T));return M}drawSymbolLayers(E,M){let T=E.length;for(;T--;){const ea=E[T];if(ea&&!1!==ea.enable){var ba=ea.effects;if(ba&&0<ba.length){if(ba=this.executeEffects(ba,
M)){let X=null;for(;(X=ba.next())&&(this.drawSymbolLayer(ea,X.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(ea,M);if(this._earlyReturn)break}}}drawSymbolLayer(E,M){switch(E.type){case "CIMSolidFill":this.drawSolidFill(M,E.color);break;case "CIMHatchFill":this.drawHatchFill(M,E);break;case "CIMPictureFill":this.drawPictureFill(M,E);break;case "CIMGradientFill":this.drawGradientFill(M,E);break;case "CIMSolidStroke":this.drawSolidStroke(M,E.color,E.width,E.capStyle,E.joinStyle,E.miterLimit);
break;case "CIMPictureStroke":this.drawPictureStroke(M,E);break;case "CIMGradientStroke":this.drawGradientStroke(M,E);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(E,M)}}drawHatchFill(E,M){const T=this._buildHatchPolyline(M,E,this.geomUnitsPerPoint());T&&(this.pushClipPath(E),this.drawMultiLayerSymbol(M.lineSymbol,T),this.popClipPath())}drawPictureFill(E,M){}drawGradientFill(E,M){}drawPictureStroke(E,M){}drawGradientStroke(E,M){}drawMarkerLayer(E,
M){var T=E.markerPlacement;if(T){var ba=n.getPlacementOperator(T);if(ba){var ea="CIMMarkerPlacementInsidePolygon"===T.type||"CIMMarkerPlacementPolygonCenter"===T.type&&T.clipAtBoundary;ea&&this.pushClipPath(M);if(M=ba.execute(b.GeometryCursor.fromJSONCIM(M),T,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(T=null;(T=M.next())&&(this.drawMarker(E,T),!this._earlyReturn););ea&&this.popClipPath()}}else{ea=this._placementPool.acquire();if(p.isPoint(M))ea.tx=M.x,ea.ty=M.y,this.drawMarker(E,
ea);else if(p.isPolygon(M)){if(M=f.polygonCentroid(M))[ea.tx,ea.ty]=M,this.drawMarker(E,ea)}else for(ba of M.points)if(ea.tx=ba[0],ea.ty=ba[1],this.drawMarker(E,ea),this._earlyReturn)break;this._placementPool.release(ea)}}drawMarker(E,M){switch(E.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(E,M);break;case "CIMVectorMarker":this.drawVectorMarker(E,M)}}drawPictureMarker(E,M){if(E){var T=this._resourceManager.getResource(E.url),ba=t.getValue(E.size,h.defaultCIMValues.CIMPictureMarker.size);
if(!(null==T||0>=ba)){var ea=T.width;T=T.height;if(ea&&T){T=ea/T;var X=t.getValue(E.scaleX,1);ea=H.createIdentity();var ca=E.anchorPoint;if(ca){var ma=ca.x;ca=ca.y;"Absolute"!==E.anchorPointUnits&&(ma*=ba*T*X,ca*=ba);ea.translate(-ma,-ca)}T=t.getValue(E.rotation);E.rotateClockwise&&(T=-T);this._mapRotation&&(T+=this._mapRotation);T&&ea.rotate(T*D);T=t.getValue(E.offsetX);X=t.getValue(E.offsetY);if(T||X){if(this._mapRotation){ca=D*this._mapRotation;ma=Math.cos(ca);ca=Math.sin(ca);const S=T*ca+X*ma;
T=T*ma-X*ca;X=S}ea.translate(T,X)}T=this.geomUnitsPerPoint();1!==T&&ea.scale(T,T);(T=M.getAngle())&&ea.rotate(T);ea.translate(M.tx,M.ty);this.push(ea,!1);this.drawImage(E,ba);this.pop()}}}}drawVectorMarker(E,M){if(E){var T=E.markerGraphics;if(T){var ba=t.getValue(E.size,h.defaultCIMValues.CIMVectorMarker.size),ea=E.frame,X=ea?ea.ymax-ea.ymin:0;X=ba&&X?ba/X:1;ba=H.createIdentity();ea&&ba.translate(.5*-(ea.xmax+ea.xmin),.5*-(ea.ymax+ea.ymin));var ca=E.anchorPoint;if(ca){var ma=ca.x;ca=ca.y;"Absolute"!==
E.anchorPointUnits?ea&&(ma*=ea.xmax-ea.xmin,ca*=ea.ymax-ea.ymin):(ma/=X,ca/=X);ba.translate(-ma,-ca)}1!==X&&ba.scale(X,X);ea=t.getValue(E.rotation);E.rotateClockwise&&(ea=-ea);this._mapRotation&&(ea+=this._mapRotation);ea&&ba.rotate(ea*D);ea=t.getValue(E.offsetX);X=t.getValue(E.offsetY);if(ea||X){if(this._mapRotation){ca=D*this._mapRotation;ma=Math.cos(ca);ca=Math.sin(ca);const S=ea*ca+X*ma;ea=ea*ma-X*ca;X=S}ba.translate(ea,X)}ea=this.geomUnitsPerPoint();1!==ea&&ba.scale(ea,ea);(ea=M.getAngle())&&
ba.rotate(ea);ba.translate(M.tx,M.ty);this.push(ba,E.scaleSymbolsProportionally);for(const S of T)if(S?.symbol&&S.geometry||k.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",S),E=S.textString,"number"===typeof E&&(E=E.toString()),this.drawSymbol(S.symbol,S.geometry,E),this._earlyReturn)break;this.pop()}}}drawTextSymbol(E,M,T){if(E&&p.isPoint(M)&&!(0>=t.getValue(E.height,h.defaultCIMValues.CIMTextSymbol.height))){var ba=H.createIdentity(),ea=t.getValue(E.angle);(ea=
-ea)&&ba.rotate(ea*D);ea=t.getValue(E.offsetX);var X=t.getValue(E.offsetY);(ea||X)&&ba.translate(ea,X);ea=this.geomUnitsPerPoint();1!==ea&&ba.scale(ea,ea);ba.translate(M.x,M.y);this.push(ba,!1);this.drawText(E,T);this.pop()}}_buildHatchPolyline(E,M,T){var ba=t.getValue(E.separation,h.defaultCIMValues.CIMHatchFill.separation)*T,ea=t.getValue(E.rotation);if(0===ba)return null;0>ba&&(ba=-ba);for(var X=0,ca=.5*ba;X>ca;)X-=ba;for(;X<-ca;)X+=ba;X=c.create();d.getBoundsXY(X,M);X[0]-=ca;X[1]-=ca;X[2]+=ca;
X[3]+=ca;for(var ma=[[X[0],X[1]],[X[0],X[3]],[X[2],X[3]],[X[2],X[1]]];180<ea;)ea-=180;for(;0>ea;)ea+=180;ca=Math.cos(ea*D);var S=Math.sin(ea*D);ea=-ba*S;M=ba*ca;X=t.getValue(E.offsetX)*T;E=t.getValue(E.offsetY)*T;X=X*S-E*ca;let Y;var ia=E=Number.MAX_VALUE;Y=T=-Number.MAX_VALUE;for(var na of ma){var ta=na[0];const va=na[1];ma=ca*ta+S*va;ta=-S*ta+ca*va;ia=Math.min(ia,ma);E=Math.min(E,ta);Y=Math.max(Y,ma);T=Math.max(T,ta)}E=Math.floor(E/ba)*ba;na=ca*ia-S*E-ea*X/ba;ma=S*ia+ca*E-M*X/ba;ia=ca*Y-S*E-ea*
X/ba;X=S*Y+ca*E-M*X/ba;ba=1+Math.round((T-E)/ba);ca=[];for(S=0;S<ba;S++)na+=ea,ma+=M,ia+=ea,X+=M,ca.push([[na,ma],[ia,X]]);return{paths:ca}}}class A extends G{constructor(E,M){super(E,M);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new y(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return c.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(E){!E||0<this._clipCount||(p.isPolygon(E)?
this._processPath(E.rings,0):p.isPolyline(E)?this._processPath(E.paths,0):p.isExtent(E)?(E=K(E))&&this._processPath(E.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(E,M,T){!E||0<this._clipCount||null==T||0>=T||(M=Math.max(.5*this.transformSize(t.getValue(T,h.defaultCIMValues.CIMSolidStroke.width)),.25),p.isPolygon(E)?this._processPath(E.rings,M):p.isPolyline(E)?this._processPath(E.paths,M):p.isExtent(E)?(E=K(E))&&this._processPath(E.rings,M):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(E,
M){p.isPolygon(M)&&E.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===E.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===E.markerPlacement.type&&E.markerPlacement.clipAtBoundary)?this._processPath(M.rings,0):super.drawMarkerLayer(E,M)}drawHatchFill(E,M){this.drawSolidFill(E)}drawPictureFill(E,M){this.drawSolidFill(E)}drawGradientFill(E,M){this.drawSolidFill(E)}drawPictureStroke(E,M){this.drawSolidStroke(E,null,M.width)}drawGradientStroke(E,M){this.drawSolidStroke(E,null,M.width)}pushClipPath(E){this.drawSolidFill(E);
this._clipCount++}popClipPath(){this._clipCount--}drawImage(E,M){var {url:T}=E;E=t.getValue(E.scaleX,1);let ba=E*M;var ea=M;T=this._resourceManager.getResource(T);null!=T&&(ea=T.height/T.width,ba=E*(M?1<ea?M:M/ea:T.width),ea=M?1<ea?M*ea:M:T.height);this._merge(this.transformPt([-ba/2,-ea/2]),0);this._merge(this.transformPt([-ba/2,ea/2]),0);this._merge(this.transformPt([ba/2,-ea/2]),0);this._merge(this.transformPt([ba/2,ea/2]),0)}drawText(E,M){if(M&&0!==M.length){this._textRasterizer||(this._textRasterizer=
new B);var T=z(E),[ba,ea]=this._textRasterizer.computeTextSize(M,T);ba=m.px2pt(ba);ea=m.px2pt(ea);M=0;switch(E.horizontalAlignment){case "Left":M=ba/2;break;case "Right":M=-ba/2}T=0;switch(E.verticalAlignment){case "Bottom":T=ea/2;break;case "Top":T=-ea/2;break;case "Baseline":T=ea/6}this._merge(this.transformPt([-ba/2+M,-ea/2+T]),0);this._merge(this.transformPt([-ba/2+M,ea/2+T]),0);this._merge(this.transformPt([ba/2+M,-ea/2+T]),0);this._merge(this.transformPt([ba/2+M,ea/2+T]),0)}}_processPath(E,
M){if(E)for(const T of E)if(E=T?T.length:0,1<E){this._merge(this.transformPt(T[0]),M);for(let ba=1;ba<E;ba++)this._merge(this.transformPt(T[ba]),M)}}_merge(E,M){E[0]-M<this._xmin&&(this._xmin=E[0]-M);E[0]+M>this._xmax&&(this._xmax=E[0]+M);E[1]-M<this._ymin&&(this._ymin=E[1]-M);E[1]+M>this._ymax&&(this._ymax=E[1]+M)}}class F extends G{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(E,M,T,ba,ea,X){X*=m.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(X);
this._searchPoint=[(E[0]+E[2])/2,(E[1]+E[3])/2];this._searchDistPoint=(E[2]-E[0])/2/X;this._textInfo=ba;this._mapRotation=M&&("CIMPointSymbol"===M.type&&"Map"!==M.angleAlignment||"CIMTextSymbol"===M.type)?ea:0;this._earlyReturn=!1;this.drawSymbol(M,T);return this._earlyReturn}drawSolidFill(E,M){this._hitTestFill(E)}drawHatchFill(E,M){this._hitTestFill(E)}drawPictureFill(E,M){this._hitTestFill(E)}drawGradientFill(E,M){this._hitTestFill(E)}drawSolidStroke(E,M,T,ba,ea,X){this._hitTestStroke(E,T)}drawPictureStroke(E,
M){this._hitTestStroke(E,M.width)}drawGradientStroke(E,M){this._hitTestStroke(E,M.width)}drawMarkerLayer(E,M){E.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===E.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===E.markerPlacement.type&&E.markerPlacement.clipAtBoundary)?this._hitTestFill(M):super.drawMarkerLayer(E,M)}pushClipPath(E){}popClipPath(){}drawImage(E,M){var {url:T}=E;E=t.getValue(E.scaleX,1);T=this._resourceManager.getResource(T);if(null!=T&&0!==T.height&&0!==M){M*=this.geomUnitsPerPoint();
E=T.width/T.height*E*M;T=this.reverseTransformPt(this._searchPoint);var ba=this._searchDistPoint;Math.abs(T[0])<E/2+ba&&Math.abs(T[1])<M/2+ba&&(this._earlyReturn=!0)}}drawText(E,M){if((M=this._textInfo)&&(M=M.get(E))&&M.glyphMosaicItems.glyphs.length){var T=t.getValue(E.height,h.defaultCIMValues.CIMTextSymbol.height),{lineGapType:ba,lineGap:ea}=E,X=ba?P(ba,t.getValue(ea),T):0;E=C.shapeGlyphs(M.glyphMosaicItems,{scale:T/w.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:E.horizontalAlignment,
verticalAlignment:E.verticalAlignment,maxLineWidth:512,lineHeight:w.magicLabelLineHeight*Math.max(.25,Math.min(X||1,4)),decoration:E.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:"CIMBackgroundCallout"===E.callout?.type});T=this.reverseTransformPt(this._searchPoint);M=T[0];T=T[1];for(const ca of E.glyphs)if(M>ca.xTopLeft&&M<ca.xBottomRight&&T>-ca.yBottomRight&&T<-ca.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(E){let M=null;if(p.isExtent(E))M=[[[E.xmin,E.ymin],[E.xmin,E.ymax],
[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]];else if(p.isPolygon(E))M=E.rings;else if(p.isPolyline(E))M=E.paths;else return;E=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(E,M)&&(this._earlyReturn=!0);if(!this._earlyReturn){const T=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(E,M,T)&&(this._earlyReturn=!0)}}_hitTestStroke(E,M){let T=null;if(p.isExtent(E))T=[[[E.xmin,E.ymin],[E.xmin,E.ymax],[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]];
else if(p.isPolygon(E))T=E.rings;else if(p.isPolyline(E))T=E.paths;else return;E=this.reverseTransformPt(this._searchPoint);M=t.getValue(M,h.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const ba=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(E,T,M/2+ba)&&(this._earlyReturn=!0)}_pointInPolygon(E,M){let T=0;for(const ba of M){M=ba.length;for(let ea=1;ea<M;ea++){const X=ba[ea-1],ca=ba[ea];X[1]>E[1]!==ca[1]>E[1]&&(0<(ca[0]-X[0])*(E[1]-X[1])-
(ca[1]-X[1])*(E[0]-X[0])?T++:T--)}}return 0!==T}_nearLine(E,M,T){for(const ea of M){M=ea.length;for(let X=1;X<M;X++){var ba=ea[X-1];const ca=ea[X];let ma=(ca[0]-ba[0])*(ca[0]-ba[0])+(ca[1]-ba[1])*(ca[1]-ba[1]);if(0!==ma&&(ma=Math.sqrt(ma),Math.abs(((ca[0]-ba[0])*(E[1]-ba[1])-(ca[1]-ba[1])*(E[0]-ba[0]))/ma)<T&&(ba=((ca[0]-ba[0])*(E[0]-ba[0])+(ca[1]-ba[1])*(E[1]-ba[1]))/ma,ba>-T&&ba<ma+T)))return!0}}return!1}}class J extends G{constructor(E,M,T,ba){super(M,T);this._applyAdditionalRenderProps=ba;this._colorSubstitutionHelper=
new x;this._ctx=E}drawSolidFill(E,M){if(E){if(p.isPolygon(E))this._buildPath(E.rings,!0);else if(p.isPolyline(E))this._buildPath(E.paths,!0);else if(p.isExtent(E))this._buildPath(K(E).rings,!0);else if(p.isMultipoint(E))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;E=this._ctx;E.fillStyle="string"===typeof M?M:"rgba("+Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+","+(M[3]??255)/255+")";E.fill("evenodd")}}drawSolidStroke(E,M,T,ba,ea,X){if(E&&M&&0!==T){if(p.isPolygon(E))this._buildPath(E.rings,
!0);else if(p.isPolyline(E))this._buildPath(E.paths,!1);else if(p.isExtent(E))this._buildPath(K(E).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}E=this._ctx;E.strokeStyle="string"===typeof M?M:"rgba("+Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+","+(M[3]??255)/255+")";E.lineWidth=Math.max(this.transformSize(T),.5);this._setCapStyle(ba);this._setJoinStyle(ea);E.miterLimit=X;E.stroke()}}pushClipPath(E){this._ctx.save();if(p.isPolygon(E))this._buildPath(E.rings,
!0);else if(p.isPolyline(E))this._buildPath(E.paths,!0);else if(p.isExtent(E))this._buildPath(K(E).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(E,M){const {colorSubstitutions:T,url:ba,tintColor:ea}=E;E=t.getValue(E.scaleX,1);var X=this._resourceManager.getResource(ba);if(null!=X){var ca=X.width/X.height*M,ma=M;M||(ca=X.width,ma=X.height);var S=t.isSVGImage(ba)||"src"in X&&t.isSVGImage(X.src);M="getFrame"in X?v.getFirstFrame(X):X;T&&(M=this._colorSubstitutionHelper.applyColorSubstituition(M,
T));this._applyAdditionalRenderProps&&!S&&ea&&(M=this._colorSubstitutionHelper.tintImageData(M,ea));X=this.transformPt([0,0]);var [Y,ia]=this.getTransformAngle();S=this.transformSize(1);var na=this._ctx;na.save();na.setTransform({m11:E*S*Y,m12:E*S*ia,m21:-S*ia,m22:S*Y,m41:X[0],m42:X[1]});na.drawImage(M,-ca/2,-ma/2,ca,ma);na.restore()}}drawText(E,M){if(M&&0!==M.length&&(this._textRasterizer||(this._textRasterizer=new B),E=z(E),E.size*=this.transformSize(m.px2pt(1)),M=this._textRasterizer.rasterizeText(M,
E))){var {size:T,anchorX:ba,anchorY:ea,canvas:X}=M;M=T[0]*(ba+.5);E=T[1]*(ea-.5);var ca=this._ctx,ma=this.transformPt([0,0]),[S,Y]=this.getTransformAngle();ca.save();ca.setTransform({m11:1*S,m12:1*Y,m21:-1*Y,m22:1*S,m41:ma[0]-1*M,m42:ma[1]+1*E});ca.drawImage(X,0,0);ca.restore()}}drawPictureFill(E,M){if(E){var {colorSubstitutions:T,height:ba,offsetX:ea,offsetY:X,rotation:ca,scaleX:ma,tintColor:S,url:Y}=M;M=this._resourceManager.getResource(Y);if(null!=M){if(p.isPolygon(E))this._buildPath(E.rings,!0);
else if(p.isPolyline(E))this._buildPath(E.paths,!0);else if(p.isExtent(E))this._buildPath(K(E).rings,!0);else if(p.isMultipoint(E))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;E=this._ctx;var ia=t.isSVGImage(Y)||"src"in M&&t.isSVGImage(M.src),na="getFrame"in M?v.getFirstFrame(M):M;T&&(na=this._colorSubstitutionHelper.applyColorSubstituition(na,T));if(this._applyAdditionalRenderProps){if(ia||S&&(na=this._colorSubstitutionHelper.tintImageData(na,S)),ia=E.createPattern(na,
"repeat"),na=this.transformSize(1),ca||=0,ea=ea?na*ea:0,X=X?na*X:0,ba&&=na*ba,na=ba?ba/M.height:1,M=ma&&ba?ma*ba/M.width:1,0!==ca||1!==na||1!==M||0!==ea||0!==X){const ta=new DOMMatrix;ta.rotateSelf(0,0,-ca).translateSelf(ea,X).scaleSelf(M,na,1);ia.setTransform(ta)}}else ia=E.createPattern(na,"repeat");E.save();E.fillStyle=ia;E.fill("evenodd");E.restore()}}}drawPictureStroke(E,M){if(E){var {colorSubstitutions:T,capStyle:ba,joinStyle:ea,miterLimit:X,tintColor:ca,url:ma,width:S}=M;M=this._resourceManager.getResource(ma);
if(null!=M){if(p.isPolygon(E))var Y=E.rings;else if(p.isPolyline(E))Y=E.paths;else if(p.isExtent(E))Y=K(E).rings;else{p.isMultipoint(E)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}S||(S=M.width);E=t.isSVGImage(ma)||"src"in M&&t.isSVGImage(M.src);var ia="getFrame"in M?v.getFirstFrame(M):M;T&&(ia=this._colorSubstitutionHelper.applyColorSubstituition(ia,T));this._applyAdditionalRenderProps&&(E||ca&&(ia=this._colorSubstitutionHelper.tintImageData(ia,ca)));M=Math.max(this.transformSize(m.pt2px(S)),
.5);E=M/ia.width;var na=this._ctx;ia=na.createPattern(ia,"repeat-y");na.save();this._setCapStyle(ba);this._setJoinStyle(ea);void 0!==X&&(na.miterLimit=X);na.lineWidth=M;var ta;for(let L of Y){L=r.clone(L);var va=ta=void 0,xa=void 0;let R=va=void 0;Y=L;for(var wa=Y[0],Ca=1;Ca<Y.length;)R=Y[Ca][0]-wa[0],va=Y[Ca][1]-wa[1],va=0!==R?va/R:Math.PI/2,void 0!==xa&&1E-4>=va-xa?(Y.splice(Ca-1,1),wa=ta):(ta=wa,wa=Y[Ca],Ca++),xa=va;if(L&&!(1>=L.length))for(Y=this.transformPt(L[0]),xa=1;xa<L.length;xa++)ta=this.transformPt(L[xa]),
wa=180/Math.PI*Math.atan2(ta[1]-Y[1],ta[0]-Y[0]),Ca=new DOMMatrix,Ca.translateSelf(0,Y[1]-M/2).scaleSelf(E,E,1).rotateSelf(0,0,90-wa),ia.setTransform(Ca),na.strokeStyle=ia,na.beginPath(),na.moveTo(Y[0],Y[1]),na.lineTo(ta[0],ta[1]),na.stroke(),Y=ta}na.restore()}}}_buildPath(E,M){const T=this._ctx;T.beginPath();if(E)for(const ba of E)if(E=ba?ba.length:0,1<E){let ea=this.transformPt(ba[0]);T.moveTo(ea[0],ea[1]);for(let X=1;X<E;X++)ea=this.transformPt(ba[X]),T.lineTo(ea[0],ea[1]);M&&T.closePath()}}_setCapStyle(E){switch(E){case u.LineCapStyle.Butt:this._ctx.lineCap=
"butt";break;case u.LineCapStyle.Round:this._ctx.lineCap="round";break;case u.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(E){switch(E){case u.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case u.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case u.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const K=E=>E?{spatialReference:E.spatialReference,rings:[[[E.xmin,E.ymin],[E.xmin,E.ymax],[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]]}:null,P=(E,M,T)=>{switch(E){case "ExtraLeading":return 1+
M/T;case "Multiple":return M;case "Exact":return M/T}};a.CIMSymbolDrawHelper=G;a.CanvasDrawHelper=J;a.EnvDrawHelper=A;a.HittestDrawHelper=F;a.Transformation=H;a.cDegToRad=D;a.lineGapType2LineHeight=P;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(a,q){function r(c){if(!c)return"arial-unicode-ms";c=c.toLowerCase().split(" ").join("-");switch(c){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";
case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return c}}function k(c){a:{if(c.weight)switch(c.weight.toLowerCase()){case "bold":case "bolder":var d="-bold";break a}d=""}a:{if(c.style)switch(c.style.toLowerCase()){case "italic":case "oblique":var f="-italic";break a}f=""}d+=f;return r(c.family)+(0<d.length?d:"-regular")}const l=new Map,m=new Set;class b{constructor(c,d){this.fontFace=c;this.promise=d}}a.clearFonts=function(){const c=
document.fonts;l.forEach(d=>{c.delete(d.fontFace)});l.clear();m.clear()};a.defaultFontFamily="arial-unicode-ms";a.getFontFamily=r;a.getFullyQualifiedFontName=k;a.isCachedFontFace=function(c){return m.has(c)};a.loadFont=async function(c){const d=k(c),f=l.get(d);if(f)return f.promise;const p=new FontFace(c.family,`url('${q.fontsUrl}/woff2/${d}.${"woff2"}') format('${"woff2"}')`,{style:c.style,weight:c.weight}),g=document.fonts;if(g.has(p)&&"loading"===p.status)return p.loaded;c=p.load().then(()=>{g.add(p);
return p});l.set(d,new b(p,c));m.add(p);return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class a{applyColorSubstituition(q,r){if(!r)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:k,height:l}=q,m=this._rasterizationCanvas,b=m.getContext("2d",{willReadFrequently:!0});q!==m&&(m.width=k,m.height=l,b.drawImage(q,0,0,k,l));q=b.getImageData(0,
0,k,l).data;if(r)for(var c of r)if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&4===c.newColor.length){const [d,f,p,g]=c.oldColor,[x,n,e,h]=c.newColor;if(d!==x||f!==n||p!==e||g!==h)for(r=0;r<q.length;r+=4)d===q[r]&&f===q[r+1]&&p===q[r+2]&&g===q[r+3]&&(q[r]=x,q[r+1]=n,q[r+2]=e,q[r+3]=h)}c=new ImageData(q,k,l);b.putImageData(c,0,0);return m}tintImageData(q,r){if(!r||4>r.length)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:k,height:l}=
q,m=this._rasterizationCanvas,b=m.getContext("2d",{willReadFrequently:!0});q!==m&&(m.width=k,m.height=l,b.drawImage(q,0,0,k,l));q=b.getImageData(0,0,k,l);q=new Uint8Array(q.data);r=[r[0]/255,r[1]/255,r[2]/255,r[3]/255];for(let c=0;c<q.length;c+=4)q[c]*=r[0],q[c+1]*=r[1],q[c+2]*=r[2],q[c+3]*=r[3];r=new ImageData(new Uint8ClampedArray(q.buffer),k,l);b.putImageData(r,0,0);return m}}return a})},"esri/symbols/cim/defaultCIMValues":function(){define(["exports"],function(a){a.defaultCIMColor={color:[128,
128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderLineColor:[0,0,0,1]};a.defaultCIMValues={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetX:0,offsetY:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,
height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorocked:!1},CIMPictureFill:{offsetx:0,
offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",
option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,
placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},
CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/imageUtils":function(){define(["exports"],function(a){a.getFirstFrame=function(q){const r=q.getFrame(0);if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement)return r;const k=document.createElement("canvas");k.width=q.width;k.height=q.height;q=k.getContext("2d");r instanceof ImageData?q.putImageData(r,0,0):q.drawImage(r,0,0);return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class a{constructor(q=
0,r=0,k=0,l=0){this.x=q;this.y=r;this.width=k;this.height=l}static fromExtent(q){return new a(q.xmin,-q.ymax,q.xmax-q.xmin,q.ymax-q.ymin)}get isEmpty(){return 0>=this.width||0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=Math.min(this.y,q.y);this.width=Math.max(this.width,q.width);this.height=Math.max(this.height,q.height)}}return a})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(a,q){function r(l){return`rgba(${l.slice(0,
3).toString()},${l[3]})`}class k{constructor(l){l&&(this._textRasterizationCanvas=l)}rasterizeText(l,m){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const b=this._textRasterizationCanvas;var c=b.getContext("2d",{willReadFrequently:!0});this._setFontProperties(c,m);this._parameters=m;this._textLines=l.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:d,weight:f}=m.font;this._lineThroughWidthOffset=d&&"line-through"===d?.1*
this._lineHeight:0;var p=(l=null!=m.backgroundColor||null!=m.borderLine)?q.backgroundPadding:0,g=this._computeTextWidth(c,m)+2*p,x=this._lineHeight*this._textLines.length+2*p;b.width=g+2*this._lineThroughWidthOffset;b.height=x;if(0===b.width||0===b.height)return b.width=b.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:b};this._renderedLineHeight=Math.round(this._lineHeight*m.pixelRatio);this._renderedHaloSize=a.pt2px(m.halo.size)*m.pixelRatio;this._renderedWidth=
g*m.pixelRatio;this._renderedHeight=x*m.pixelRatio;this._lineThroughWidthOffset*=m.pixelRatio;g=m.halo&&m.halo.color?m.halo.color:[0,0,0,0];this._fillStyle=r(m.color??[0,0,0,0]);this._haloStyle=`rgb(${g.slice(0,3).toString()})`;g=this._renderedLineHeight;var n=this._renderedHaloSize;c.save();c.clearRect(0,0,b.width,b.height);this._setFontProperties(c,m);x=p*m.pixelRatio;p=c.textAlign;var e=this._renderedWidth-2*x;p=("center"===p?.5*e:"right"===p?e:0)+n+x;x=n+x;n=0<n;e=this._lineThroughWidthOffset;
let h=0;if(l){c.save();l=m.backgroundColor??[0,0,0,0];const v=m.borderLine?.color??[0,0,0,0],y=2*a.pt2px(m.borderLine?.size??0);c.fillStyle=r(l);c.strokeStyle=r(v);c.lineWidth=y;c.fillRect(0,0,b.width,b.height);c.strokeRect(0,0,b.width,b.height);c.restore()}n&&this._renderHalo(c,p,x,e,h,m);h+=x;e+=p;for(var u of this._textLines)n&&(c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(u,e,h),c.globalCompositeOperation="source-over"),c.fillStyle=this._fillStyle,c.fillText(u,
e,h),d&&"none"!==d&&this._renderDecoration(c,e,h,d,f),h+=g;c.restore();u=this._renderedWidth+2*this._lineThroughWidthOffset;l=this._renderedHeight;c=c.getImageData(0,0,u,l);c=new Uint8Array(c.data);if(m.premultiplyColors)for(p=0;p<c.length;p+=4)g=c[p+3]/255,c[p]*=g,c[p+1]*=g,c[p+2]*=g;switch(m.horizontalAlignment){case "left":g=-.5;break;case "right":g=.5;break;default:g=0}switch(m.verticalAlignment){case "bottom":m=-.5;break;case "top":m=.5;break;case "baseline":m=-1/6;break;default:m=0}return{size:[u,
l],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:g,anchorY:m,canvas:b}}_renderHalo(l,m,b,c,d,f){const p=this._renderedWidth,g=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=p;this._haloRasterizationCanvas.height=g;const x=this._haloRasterizationCanvas,n=x.getContext("2d");n.clearRect(0,0,p,g);this._setFontProperties(n,f);const {decoration:e,weight:h}=f.font;n.fillStyle=this._haloStyle;
n.strokeStyle=this._haloStyle;n.lineJoin="round";this._renderHaloNative(n,m,b,e,h);l.globalAlpha=this._parameters.halo.color[3];l.drawImage(x,0,0,p,g,c,d,p,g);l.globalAlpha=1}_renderHaloNative(l,m,b,c,d){const f=this._renderedLineHeight,p=this._renderedHaloSize;for(const g of this._textLines){const x=2*p;for(let n=0;5>n;n++){const e=(.6+.1*n)*x;l.lineWidth=e;l.strokeText(g,m,b);c&&"none"!==c&&this._renderDecoration(l,m,b,c,d,e)}b+=f}}_setFontProperties(l,m){var b=m.font;b=`${b.style} ${b.weight} ${a.pt2px(Math.max(m.size,
.5)*m.pixelRatio).toFixed(1)}px ${b.family}, sans-serif`;l.font=b;l.textBaseline="top";switch(m.horizontalAlignment){case "left":m="left";break;case "right":m="right";break;case "center":m="center";break;default:m="left"}l.textAlign=m}computeTextSize(l,m){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const b=this._textRasterizationCanvas;var c=b.getContext("2d");this._setFontProperties(c,m);this._parameters=m;this._textLines=l.split(/\r?\n/);this._lineHeight=
this._computeLineHeight();l=this._computeTextWidth(c,m);c=this._lineHeight*this._textLines.length;b.width=l;b.height=c;return[l*m.pixelRatio,c*m.pixelRatio]}_computeTextWidth(l,m){let b=0;for(const c of this._textLines)b=Math.max(b,l.measureText(c).width);m=m.font;if("italic"===m.style||"oblique"===m.style||"string"===typeof m.weight&&("bold"===m.weight||"bolder"===m.weight)||"number"===typeof m.weight&&600<m.weight)b+=.3*l.measureText("w").width;b+=2*a.pt2px(this._parameters.halo.size);return Math.round(b)}_computeLineHeight(){let l=
1.275*this._parameters.size;const m=this._parameters.font.decoration;m&&"underline"===m&&(l*=1.3);return Math.round(l+2*a.pt2px(this._parameters.halo.size))}_renderDecoration(l,m,b,c,d,f){const p=.9*this._lineHeight;switch(l.textAlign){case "center":m-=this._renderedWidth/2;break;case "right":m-=this._renderedWidth}const g=l.textBaseline;if("underline"===c)switch(g){case "top":b+=p;break;case "middle":b+=p/2}else if("line-through"===c)switch(g){case "top":b+=p/1.5;break;case "middle":b+=p/3}c=f?1.5*
f:Math.ceil(p*("bold"===d?.06:"bolder"===d?.09:.04));l.save();l.beginPath();l.strokeStyle=l.fillStyle;l.lineWidth=c;l.moveTo(m-this._lineThroughWidthOffset,b);l.lineTo(m+this._renderedWidth+2*this._lineThroughWidthOffset,b);l.stroke();l.restore()}}return k})},"esri/symbols/cim/utils":function(){define(["require","exports","./defaultCIMValues"],function(a,q,r){function k(e){return"function"===typeof e}function l(e){let h=e.length;for(;h--;)if(!" /-,\n".includes(e.charAt(h)))return!1;return!0}function m(e,
h){"string"!==typeof e&&(e=String(e));switch(h){case "LowerCase":return e.toLowerCase();case "Allcaps":return e.toUpperCase();default:return e}}function b(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function c(e){if(!e)return null;switch(e.type){case "CIMPolygonSymbol":if(e.symbolLayers)for(const h of e.symbolLayers)if(e=c(h),null!=e)return e;break;case "CIMTextSymbol":return c(e.symbol);case "CIMSolidFill":return e.color}return null}function d(e){if(e)switch(e.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(e=
e.symbolLayers)for(const h of e)if(e=d(h),null!=e)return e;break;case "CIMTextSymbol":return d(e.symbol);case "CIMSolidStroke":return e.color}}function f(e){if(e)switch(e.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(e.symbolLayers)for(const h of e.symbolLayers)if(e=f(h),void 0!==e)return e;break;case "CIMTextSymbol":return f(e.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return e.width}}function p(e){if(null==e)return!1;if(Array.isArray(e))return e.every(h=>
p(h));switch(typeof e){case "string":return!!e;case "number":return!isNaN(e)}}function g(e){if(null==e)return"Normal";switch(e.type){case "CIMTextSymbol":return e.textCase??"Normal";case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var h=e.symbolLayers;if(!h)break;for(var u of h)if("CIMVectorMarker"===u.type)return g(u);break;case "CIMVectorMarker":if(u=e.markerGraphics)for(h of u)if(h.symbol)return g(h.symbol)}return"Normal"}function x(e,h,u,v,y){return(u=u*Math.PI/180)?(Math.sin(u)*
e+Math.cos(u)*h)*v+y:h*v+y}function n(e,h,u,v,y){return(u=u*Math.PI/180)?(Math.cos(u)*e-Math.sin(u)*h)*v+y:e*v+y}q.adjustTextCase=m;q.analyzeTextParts=function(e,h){const u=[];var v=0;let y=-1;do y=e.indexOf("[",v),y>=v&&(y>v&&(v=e.substr(v,y-v),u.push([v,null,l(v)])),v=y+1,y=e.indexOf("]",v),y>=v&&(y>v&&(v=e.substr(v,y-v),(v=h[v])&&u.push([null,v,!1])),v=y+1));while(-1!==y);v<e.length-1&&(e=e.substr(v),u.push([e,null,l(e)]));return u};q.applyParentTransform=function(e,h,u,v,y,B){const {infos:t}=
B;B=1;let w=0;var C=0,z=0;for(const {offsetX:D,offsetY:H,rotation:G,size:A,frameHeight:F,rotateClockWise:J}of t)C=n(D,H,w,B,C),z=x(D,H,w,B,z),F&&(B*=A/F),w=J?w-G:w+G;C=n(v,y,w,B,C);v=x(v,y,w,B,z);return{size:e*B,rotation:u?w-h:w+h,offsetX:C,offsetY:v}};q.assignTextValuesFromFeature=function(e,h,u){let v="",y=null;for(const B of h){const [t,w,C]=B;if(t)C?y=t:(y&&(v+=y,y=null),v+=t);else if(h=e.attributes[w])y&&(v+=y,y=null),v+=h}return m(v,u)};q.attributesToFields=function(e){return(e?Object.keys(e):
[]).map(h=>({name:h,alias:h,type:"string"===typeof e[h]?"esriFieldTypeString":"esriFieldTypeDouble"}))};q.colorToArray=function(e){return[e.r,e.g,e.b,e.a]};q.evaluateValueOrFunction=function(e,h,u,v){return k(e)?e(h,u,v):e};q.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"};q.fromCIMFontStyle=function(e){let h="normal",u="normal";e&&(e=e.toLowerCase(),e.includes("italic")?h="italic":e.includes("oblique")&&(h="oblique"),e.includes("bold")?u="bold":
e.includes("light")&&(u="lighter"));return{style:h,weight:u}};q.fromCIMHorizontalAlignment=function(e){switch(e){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};q.fromCIMVerticalAlignment=function(e){switch(e){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};q.getDefaultCIMValue=function(e,h){if("color"===h||"outlinecolor"===h||"backgroundcolor"===h||"borderLineColor"===h)return[...r.defaultCIMColor[h]];
const u=r.defaultCIMValues[e];if(!u||"boolean"===typeof u[h])throw Error(`InternalError: default value for type ${e}.`);return u[h]};q.getFillColor=c;q.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};q.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};q.getStrokeColor=
d;q.getStrokeWidth=f;q.getTextCasing=g;q.getTintColor=e=>e.tintColor?b(e.tintColor):[255,255,255,1];q.getValue=(e,h=0)=>null==e||isNaN(e)?h:e;q.importGeometryEngine=function(){return new Promise((e,h)=>a(["../../geometry/geometryEngineJSON"],e,h))};q.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)};q.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===
e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type};q.isCIMMarkerStrokePlacement=function(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===
e.type||"CIMMarkerPlacementOnVertices"===e.type)};q.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type};q.isFeatureValueFn=k;q.isGeometryEngineRequired=e=>{if(!e)return!1;for(const h of e)switch(h.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};q.isSVGImage=e=>e.includes("data:image/svg+xml");q.isValidCIMValue=p;q.mapCIMSymbolToGeometryType=function(e){if(!e)return null;
switch(e.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};q.normalizeAlpha=b;q.resampleHermite=function(e,h,u,v,y,B,t=!0){const w=h/y;u/=B;const C=Math.ceil(w/2),z=Math.ceil(u/2);for(let G=0;G<B;G++)for(let A=0;A<y;A++){const F=4*(A+(t?B-G-1:G)*y);var D=0;let J=0,K=0,P=0,E=0,M=0,T=0;const ba=(G+.5)*u;for(let ea=Math.floor(G*u);ea<(G+1)*u;ea++){var H=
Math.abs(ba-(ea+.5))/z;const X=(A+.5)*w;H*=H;for(let ca=Math.floor(A*w);ca<(A+1)*w;ca++){let ma=Math.abs(X-(ca+.5))/C;D=Math.sqrt(H+ma*ma);-1<=D&&1>=D&&(D=2*D*D*D-3*D*D+1,0<D&&(ma=4*(ca+ea*h),T+=D*e[ma+3],K+=D,255>e[ma+3]&&(D=D*e[ma+3]/250),P+=D*e[ma],E+=D*e[ma+1],M+=D*e[ma+2],J+=D))}}v[F]=P/J;v[F+1]=E/J;v[F+2]=M/J;v[F+3]=T/K}};q.toCIMSymbolJSON=function(e){return e.data?.symbol??null};q.uncapitalize=function(e){return e?e.charAt(0).toLowerCase()+e.substring(1):e};Object.defineProperty(q,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(a,q,r,k,l,m,b,c){function d(n,e){n.forEach(h=>k.transformMat2d(h,h,e));return{topLeft:n[0],topRight:n[1],
bottomLeft:n[2],bottomRight:n[3]}}const f=Math.PI/180;class p{constructor(n,e,h,u){this._rotationT=r.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const v=h.rect,y=new Float32Array(8);n*=u;e*=u;const B=h.code?v.width*u:h.metrics.width,t=h.code?v.height*u:h.metrics.height;this.width=B;this.height=t;y[0]=n;y[1]=e;y[2]=n+B;y[3]=e;y[4]=n;y[5]=e+t;y[6]=n+B;y[7]=e+t;this._data=y;this._setTextureCoords(v);this._scale=u;this._mosaic=h;this.x=n;this.y=e;this.maxOffset=
Math.max(n+B,e+t)}get mosaic(){return this._mosaic}set angle(n){this._angle=n;q.fromRotation(this._rotationT,-n);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:v,
width:y}=this._mosaic.metrics;var n=y*this._scale,e=Math.abs(v)*this._scale,h=new Float32Array(8);h[0]=this.x;h[1]=this.y;h[2]=this.x+n;h[3]=this.y;h[4]=this.x;h[5]=this.y+e;h[6]=this.x+n;h[7]=this.y+e;n=q.multiply(r.create(),this._rotationT,this._transform);r.transformMany(h,h,n);e=n=Infinity;let B=0;var u=0;for(let t=0;4>t;t++){const w=h[2*t],C=h[2*t+1];n=Math.min(n,w);e=Math.min(e,C);B=Math.max(B,w);u=Math.max(u,C)}h=B-n;u-=e;this._bounds=new c(n+h/2,e+u/2,h,u)}return this._bounds}setTransform(n){this._transform=
n;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const n=q.multiply(r.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];k.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,n);k.transformMat2d(this._offsets.topRight,this._offsets.topRight,n);k.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,n);k.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,n)}_setTextureCoords({x:n,y:e,width:h,height:u}){this._texcoords={topLeft:[n,e],topRight:[n+h,e],bottomLeft:[n,e+u],bottomRight:[n+h,e+u]}}}class g{constructor(n,e,h){this._rotation=0;this._decorate(n,e,h);this.glyphs=
n;this.bounds=this._createBounds(n);this.isMultiline=1<e.length;this._hasRotation=0!==h.angle;this._transform=this._createGlyphTransform(this.bounds,h);if((this._borderLineSizePx=h.borderLineSizePx)||h.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const u of n)u.setTransform(this._transform)}setRotation(n){if(0!==n||0!==this._rotation){this._rotation=n;var e=this._transform;n=q.fromRotation(r.create(),n);q.multiply(e,n,e);for(const h of this.glyphs)h.setTransform(this._transform)}}_decorate(n,
e,h){if(h.decoration&&"none"!==h.decoration&&n.length){var u=h.scale;h="underline"===h.decoration?26:16;var v=n[0].textureBinding;for(const w of e){const C=w.startX*u,z=w.startY*u;e=n;var y=e.push;var B=(w.width+w.glyphWidthEnd)*u;var t=v;B={code:0,page:0,sdf:!0,rect:new b(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:B,left:0,top:0}};y.call(e,new p(C,z+h*u,B,1))}}}shapeBackground(n){const e=(1.5+(this._borderLineSizePx||0))/2;var h=this._borderLineSizePx?e:0;const {xmin:u,ymin:v,xmax:y,
ymax:B,x:t,y:w,width:C,height:z}=this.bounds,D=[u-8,v-8],H=[y+8,v-8],G=[u-8,B+8],A=[y+8,B+8],F=d([[D[0]-e,D[1]-e],[H[0]+e,H[1]-e],[D[0]+h,D[1]+h],[H[0]-h,H[1]+h]],n),J=d([[G[0]+h,G[1]-h],[A[0]-h,A[1]-h],[G[0]-e,G[1]+e],[A[0]+e,A[1]+e]],n),K=d([[D[0]-e,D[1]-e],[D[0]+h,D[1]+h],[G[0]-e,G[1]+e],[G[0]+h,G[1]-h]],n);h=d([[H[0]-h,H[1]+h],[H[0]+e,H[1]-e],[A[0]-h,A[1]-h],[A[0]+e,A[1]+e]],n);n={main:d([D,H,G,A],n),top:F,bot:J,left:K,right:h};return[new c(t,w,C+2*e,z+2*e),n]}get boundsT(){var n=this.bounds;
const e=k.set(l.create(),n.x,n.y);k.transformMat2d(e,e,this._transform);return this._hasRotation?(n=Math.max(n.width,n.height),new c(e[0],e[1],n,n)):new c(e[0],e[1],n.width,n.height)}_createBounds(n){let e=Infinity,h=Infinity,u=0;var v=0;for(const y of n)e=Math.min(e,y.xTopLeft),h=Math.min(h,y.yTopLeft),u=Math.max(u,y.xBottomRight),v=Math.max(v,y.yBottomRight);n=u-e;v-=h;return new c(e+n/2,h+v/2,n,v)}_createGlyphTransform(n,e){const h=f*e.angle,u=r.create(),v=l.create();q.translate(u,u,k.set(v,e.xOffset,
-e.yOffset));e.useCIMAngleBehavior?q.rotate(u,u,h):(q.translate(u,u,k.set(v,n.x,n.y)),q.rotate(u,u,h),q.translate(u,u,k.set(v,-n.x,-n.y)));return u}}class x{constructor(n,e,h,u,v,y){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(e,h));this.end=Math.max(0,Math.max(e,h));this.end<n.length&&(this.glyphWidthEnd=n[this.end].metrics.width);this.width=u;this.yMin=v;this.yMax=y}}a.ShapedGlyph=p;a.ShapingInfo=g;a.shapeGlyphs=function(n,e){const h=e.scale,u=[],{glyphs:v,isRightToLeft:y}=
n;n=[];var B=1/e.scale*e.maxLineWidth;var t=y?v.length-1:0;var w=y?-1:v.length,C=y?-1:1,z=t,D=0,H=0,G=z;let A=G,F=0,J=Infinity,K=0;for(;z!==w;){const {code:E,metrics:M}=v[z];var P=Math.abs(M.top);10!==E&&32!==E&&(J=Math.min(J,P),K=Math.max(K,P+M.height));10===E?(z!==t&&(n.push(new x(v,G,z-C,D,J,K)),J=Infinity,K=0),D=0,G=z+C,A=z+C,H=0):32===E?(A=z+C,H=0,F=M.advance,D+=M.advance):(D>B&&(A!==G?(P=A-2*C,D-=F,n.push(new x(v,G,P,D-H,J,K)),J=Infinity,K=0,G=A,D=H):(n.push(new x(v,G,z-C,D,J,K)),J=Infinity,
K=0,A=G=z,D=0)),D+=M.advance,H+=M.advance);z+=C}B=new x(v,G,z-C,D,J,K);0<=B.start&&B.end<v.length&&n.push(B);for(B=0;B<n.length;B++);w=n[0].yMin;t=n[n.length-1].yMax+e.lineHeight*(n.length-1)+("underline"===e.decoration?4:0)-w;B=m.getXAnchorDirection(e.horizontalAlignment);C=m.getYAnchorDirection(e.verticalAlignment);z=C===m.VAlign.Baseline?1:0;t=(1-z)*-w+t/2*(z?0:C-1)+-22*(z?1:0);for(w=0;w<n.length;w++){const {start:E,end:M,width:T}=n[w];C=T/2*(B+1)*-1-3;z=w*e.lineHeight+t-3;n[w].startX=C;n[w].startY=
z;for(D=E;D<=M;D++)H=v[D],10!==H.code&&(G=new p(C+H.metrics.left,z-H.metrics.top,H,h),C+=H.metrics.advance,u.push(G))}return new g(u,n,e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(a,q){function r(z,D){z[0]=D[0];z[1]=D[1];z[2]=D[2];z[3]=D[3];z[4]=D[4];z[5]=D[5];return z}function k(z){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=0;z[5]=0;return z}function l(z,D,H,G,A,F,J){z[0]=D;z[1]=H;z[2]=G;z[3]=A;
z[4]=F;z[5]=J;return z}function m(z,D){const H=D[0],G=D[1],A=D[2],F=D[3],J=D[4];D=D[5];let K=H*F-G*A;if(!K)return null;K=1/K;z[0]=F*K;z[1]=-G*K;z[2]=-A*K;z[3]=H*K;z[4]=(A*D-F*J)*K;z[5]=(G*J-H*D)*K;return z}function b(z){return z[0]*z[3]-z[1]*z[2]}function c(z,D,H){const G=D[0],A=D[1],F=D[2],J=D[3],K=D[4];D=D[5];const P=H[0],E=H[1],M=H[2],T=H[3],ba=H[4];H=H[5];z[0]=G*P+F*E;z[1]=A*P+J*E;z[2]=G*M+F*T;z[3]=A*M+J*T;z[4]=G*ba+F*H+K;z[5]=A*ba+J*H+D;return z}function d(z,D,H){const G=D[0],A=D[1],F=D[2],J=
D[3],K=D[4];D=D[5];const P=Math.sin(H);H=Math.cos(H);z[0]=G*H+F*P;z[1]=A*H+J*P;z[2]=G*-P+F*H;z[3]=A*-P+J*H;z[4]=K;z[5]=D;return z}function f(z,D,H){const G=D[1],A=D[2],F=D[3],J=D[4],K=D[5],P=H[0];H=H[1];z[0]=D[0]*P;z[1]=G*P;z[2]=A*H;z[3]=F*H;z[4]=J;z[5]=K;return z}function p(z,D,H){const G=D[0],A=D[1],F=D[2],J=D[3],K=D[4];D=D[5];const P=H[0];H=H[1];z[0]=G;z[1]=A;z[2]=F;z[3]=J;z[4]=G*P+F*H+K;z[5]=A*P+J*H+D;return z}function g(z,D){const H=Math.sin(D);D=Math.cos(D);z[0]=D;z[1]=H;z[2]=-H;z[3]=D;z[4]=
0;z[5]=0;return z}function x(z,D){z[0]=D[0];z[1]=0;z[2]=0;z[3]=D[1];z[4]=0;z[5]=0;return z}function n(z,D){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=D[0];z[5]=D[1];return z}function e(z){return"mat2d("+z[0]+", "+z[1]+", "+z[2]+", "+z[3]+", "+z[4]+", "+z[5]+")"}function h(z){return Math.sqrt(z[0]**2+z[1]**2+z[2]**2+z[3]**2+z[4]**2+z[5]**2+1)}function u(z,D,H){z[0]=D[0]+H[0];z[1]=D[1]+H[1];z[2]=D[2]+H[2];z[3]=D[3]+H[3];z[4]=D[4]+H[4];z[5]=D[5]+H[5];return z}function v(z,D,H){z[0]=D[0]-H[0];z[1]=D[1]-H[1];z[2]=
D[2]-H[2];z[3]=D[3]-H[3];z[4]=D[4]-H[4];z[5]=D[5]-H[5];return z}function y(z,D,H){z[0]=D[0]*H;z[1]=D[1]*H;z[2]=D[2]*H;z[3]=D[3]*H;z[4]=D[4]*H;z[5]=D[5]*H;return z}function B(z,D,H,G){z[0]=D[0]+H[0]*G;z[1]=D[1]+H[1]*G;z[2]=D[2]+H[2]*G;z[3]=D[3]+H[3]*G;z[4]=D[4]+H[4]*G;z[5]=D[5]+H[5]*G;return z}function t(z,D){return z[0]===D[0]&&z[1]===D[1]&&z[2]===D[2]&&z[3]===D[3]&&z[4]===D[4]&&z[5]===D[5]}function w(z,D){const H=z[0],G=z[1],A=z[2],F=z[3],J=z[4];z=z[5];const K=D[0],P=D[1],E=D[2],M=D[3],T=D[4];D=
D[5];const ba=q.getEpsilon();return Math.abs(H-K)<=ba*Math.max(1,Math.abs(H),Math.abs(K))&&Math.abs(G-P)<=ba*Math.max(1,Math.abs(G),Math.abs(P))&&Math.abs(A-E)<=ba*Math.max(1,Math.abs(A),Math.abs(E))&&Math.abs(F-M)<=ba*Math.max(1,Math.abs(F),Math.abs(M))&&Math.abs(J-T)<=ba*Math.max(1,Math.abs(J),Math.abs(T))&&Math.abs(z-D)<=ba*Math.max(1,Math.abs(z),Math.abs(D))}const C=Object.freeze(Object.defineProperty({__proto__:null,add:u,copy:r,determinant:b,equals:w,exactEquals:t,frob:h,fromRotation:g,fromScaling:x,
fromTranslation:n,identity:k,invert:m,mul:c,multiply:c,multiplyScalar:y,multiplyScalarAndAdd:B,rotate:d,scale:f,set:l,str:e,sub:v,subtract:v,translate:p},Symbol.toStringTag,{value:"Module"}));a.add=u;a.copy=r;a.determinant=b;a.equals=w;a.exactEquals=t;a.frob=h;a.fromRotation=g;a.fromScaling=x;a.fromTranslation=n;a.identity=k;a.invert=m;a.mat2d=C;a.mul=c;a.multiply=c;a.multiplyScalar=y;a.multiplyScalarAndAdd=B;a.rotate=d;a.scale=f;a.set=l;a.str=e;a.sub=v;a.subtract=v;a.translate=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(a){function q(){const d=new Float32Array(6);d[0]=1;d[3]=1;return d}function r(d){const f=new Float32Array(6);f[0]=d[0];f[1]=d[1];f[2]=d[2];f[3]=d[3];f[4]=d[4];f[5]=d[5];return f}function k(d,f,p,g,x,n){const e=new Float32Array(6);e[0]=d;e[1]=f;e[2]=p;e[3]=g;e[4]=x;e[5]=n;return e}function l(d,f){return new Float32Array(d,f,6)}function m(d,f,p,g){const x=f[g];f=f[g+1];d[g]=
p[0]*x+p[2]*f+p[4];d[g+1]=p[1]*x+p[3]*f+p[5]}function b(d,f,p,g=0,x=0,n=2){for(x=x||f.length/n;g<x;g++)m(d,f,p,g*n)}const c=Object.freeze(Object.defineProperty({__proto__:null,clone:r,create:q,createView:l,fromValues:k,transform:m,transformMany:b},Symbol.toStringTag,{value:"Module"}));a.clone=r;a.create=q;a.createView=l;a.fromValues=k;a.mat2df32=c;a.transform=m;a.transformMany=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],
function(a){function q(){return new Float32Array(2)}function r(e){const h=new Float32Array(2);h[0]=e[0];h[1]=e[1];return h}function k(e,h){const u=new Float32Array(2);u[0]=e;u[1]=h;return u}function l(e,h){return new Float32Array(e,h,2)}function m(){return q()}function b(){return k(1,1)}function c(){return k(1,0)}function d(){return k(0,1)}const f=q(),p=b(),g=c(),x=d(),n=Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_X:g,UNIT_Y:x,ZEROS:f,clone:r,create:q,createView:l,fromValues:k,
ones:b,unitX:c,unitY:d,zeros:m},Symbol.toStringTag,{value:"Module"}));a.ONES=p;a.UNIT_X=g;a.UNIT_Y=x;a.ZEROS=f;a.clone=r;a.create=q;a.createView=l;a.fromValues=k;a.ones=b;a.unitX=c;a.unitY=d;a.vec2f32=n;a.zeros=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(a,q){a.HAlign=void 0;(function(r){r[r.Left=-1]="Left";r[r.Center=0]="Center";r[r.Right=1]="Right"})(a.HAlign||(a.HAlign=
{}));a.VAlign=void 0;(function(r){r[r.Top=1]="Top";r[r.Center=0]="Center";r[r.Bottom=-1]="Bottom";r[r.Baseline=2]="Baseline"})(a.VAlign||(a.VAlign={}));a.getAlignmentFromPlacement=function(r){switch(r){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center","bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left",
"bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center","middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right","top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center",
"top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];default:return console.debug(`Found invalid placement type ${r}`),["center","middle"]}};a.getJustification=function(r){switch(r){case "left":return a.HAlign.Left;case "right":return a.HAlign.Right;case "center":return a.HAlign.Center}};a.getXAnchorDirection=function(r){if(!r)return a.HAlign.Center;switch(r){case "Left":case "left":return a.HAlign.Left;
case "Right":case "right":return a.HAlign.Right;case "Justify":return q.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),a.HAlign.Center;case "Center":case "center":return a.HAlign.Center}};a.getXDirection=function(r){switch(r){case a.HAlign.Right:case "right":return-1;case a.HAlign.Center:case "center":return 0;case a.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${r}`),
0}};a.getYAnchorDirection=function(r){if(!r)return a.VAlign.Center;switch(r){case "Top":case "top":return a.VAlign.Top;case "Center":case "middle":return a.VAlign.Center;case "Baseline":case "baseline":return a.VAlign.Baseline;case "Bottom":case "bottom":return a.VAlign.Bottom}};a.getYDirection=function(r){switch(r){case a.VAlign.Top:case "top":return 1;case a.VAlign.Center:case "middle":return 0;case a.VAlign.Bottom:case a.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${r}`),
0}};a.isMapAligned=function(r){switch(r){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;default:return!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(a){class q{constructor(r,k,l,m){this.computedY=this.computedX=
0;this.center=a.fromValues(r,k);this.centerT=a.create();this.halfWidth=l/2;this.halfHeight=m/2;this.width=l;this.height=m}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+
this.halfHeight}set x(r){this.center[0]=r}set y(r){this.center[1]=r}clone(){return new q(this.x,this.y,this.width,this.height)}serialize(r){r.writeF32(this.center[0]);r.writeF32(this.center[1]);r.push(this.width);r.push(this.height);return r}findCollisionDelta(r,k=4){return Math.log2(Math.min((r.halfWidth+this.halfWidth+k)/Math.abs(r.centerT[0]-this.centerT[0]),(r.halfHeight+this.halfHeight+k)/Math.abs(r.centerT[1]-this.centerT[1])))}extend(r){const k=Math.min(this.xmin,r.xmin),l=Math.min(this.ymin,
r.ymin),m=Math.max(this.xmax,r.xmax)-k;r=Math.max(this.ymax,r.ymax)-l;this.width=m;this.height=r;this.halfWidth=m/2;this.halfHeight=r/2;this.x=k+m/2;this.y=l+r/2}static deserialize(r){const k=r.readF32(),l=r.readF32(),m=r.readInt32();r=r.readInt32();return new q(k,l,m,r)}}return q})},"esri/symbols/support/defaults":function(){define("exports ../../core/has ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../TextSymbol ./defaultsJSON".split(" "),function(a,q,r,k,l,m,b){const c=l.fromJSON(b.defaultPointSymbolJSON),
d=k.fromJSON(b.defaultPolylineSymbolJSON),f=r.fromJSON(b.defaultPolygonSymbolJSON);q=m.fromJSON(b.defaultTextSymbolJSON);l=l.fromJSON(b.errorPointSymbolJSON);k=k.fromJSON(b.errorPolylineSymbolJSON);r=r.fromJSON(b.errorPolygonSymbolJSON);a.defaultPointSymbol2D=c;a.defaultPolygonSymbol2D=f;a.defaultPolylineSymbol2D=d;a.defaultTextSymbol2D=q;a.errorPointSymbol2D=l;a.errorPolygonSymbol2D=r;a.errorPolylineSymbol2D=k;a.getDefaultSymbol2D=function(p){if(null==p)return null;switch(p.type){case "point":case "multipoint":return c;
case "polyline":return d;case "polygon":case "extent":return f}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleFillSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./FillSymbol ./SimpleLineSymbol".split(" "),function(a,q,r,k,l,m,b,c,d,f,p){var g;r=new r.JSONMap({esriSFSSolid:"solid",
esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});f=g=class extends f{constructor(...x){super(...x);this.color=new q([0,0,0,.25]);this.outline=new p;this.type="simple-fill";this.style="solid"}normalizeCtorArgs(x,n,e){if(x&&"string"!==typeof x)return x;const h={};x&&(h.style=x);n&&(h.outline=n);e&&(h.color=e);return h}clone(){return new g({color:k.clone(this.color),
outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};a.__decorate([l.property()],f.prototype,"color",void 0);a.__decorate([l.property()],f.prototype,"outline",void 0);a.__decorate([c.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],f.prototype,"type",void 0);a.__decorate([l.property({type:r.apiValues,json:{read:r.read,write:r.write}})],f.prototype,"style",void 0);return f=g=a.__decorate([d.subclass("esri.symbols.SimpleFillSymbol")],
f)})},"esri/core/accessorSupport/decorators/enumeration":function(){define(["exports","../../jsonMap","./property"],function(a,q,r){a.enumeration=function(k,l={}){k=k instanceof q.JSONMap?k:new q.JSONMap(k,l);k={type:l?.ignoreUnknown??!0?k.apiValues:String,json:{type:k.jsonValues,read:l?.readOnly?!1:{reader:k.read},write:{writer:k.write}}};void 0!==l?.readOnly&&(k.readOnly=!!l.readOnly);void 0!==l?.default&&(k.json.default=l.default);void 0!==l?.name&&(k.json.name=l.name);void 0!==l?.nonNullable&&
(k.nonNullable=l.nonNullable);return r.property(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/FillSymbol":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./SimpleLineSymbol ./Symbol".split(" "),function(a,q,r,k,l,m,b,c){r=class extends c{constructor(d){super(d);this.type=this.outline=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};
a.__decorate([q.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":b}},json:{default:null,write:!0}})],r.prototype,"outline",void 0);a.__decorate([q.property({type:["simple-fill","picture-fill"],readOnly:!0})],r.prototype,"type",void 0);return r=a.__decorate([m.subclass("esri.symbols.FillSymbol")],r)})},"esri/symbols/SimpleLineSymbol":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./LineSymbol ./LineSymbolMarker".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){var g;q=new q.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});f=g=class extends f{constructor(...x){super(...x);this.type="simple-line";
this.style="solid";this.join=this.cap="round";this.marker=null;this.miterLimit=2}normalizeCtorArgs(x,n,e,h,u,v){if(x&&"string"!==typeof x)return x;const y={};null!=x&&(y.style=x);null!=n&&(y.color=n);null!=e&&(y.width=k.toPt(e));null!=h&&(y.cap=h);null!=u&&(y.join=u);null!=v&&(y.miterLimit=k.toPt(v));return y}clone(){return new g({color:r.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};
a.__decorate([c.enumeration({esriSLS:"simple-line"},{readOnly:!0})],f.prototype,"type",void 0);a.__decorate([l.property({type:q.apiValues,json:{read:q.read,write:q.write}})],f.prototype,"style",void 0);a.__decorate([l.property({type:["butt","round","square"],json:{write:{overridePolicy:(x,n,e)=>({enabled:"round"!==x&&null==e?.origin})}}})],f.prototype,"cap",void 0);a.__decorate([l.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(x,n,e)=>({enabled:"round"!==x&&null==e?.origin})}}})],
f.prototype,"join",void 0);a.__decorate([l.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":p}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],f.prototype,"marker",void 0);a.__decorate([l.property({type:Number,json:{read:!1,write:!1}})],f.prototype,"miterLimit",void 0);return f=g=a.__decorate([d.subclass("esri.symbols.SimpleLineSymbol")],f)})},"esri/symbols/LineSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),
function(a,q,r,k,l,m,b,c,d){k=class extends d{constructor(f){super(f);this.type="simple-line";this.width=.75}hash(){return`${this.type}.${this.width}`}};a.__decorate([b.enumeration({esriSLS:"simple-line"},{readOnly:!0})],k.prototype,"type",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,json:{write:!0}})],k.prototype,"width",void 0);return k=a.__decorate([c.subclass("esri.symbols.LineSymbol")],k)})},"esri/symbols/Symbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c,d,f){r=new r.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let p=0;k=class extends k.JSONSupport{constructor(g){super(g);this.id=`sym${p++}`;this.type=null;this.color=new q([0,
0,0,1])}readColor(g){return null!=g?.[0]?[g[0],g[1],g[2],g[3]/255]:g}async collectRequiredFields(g,x){}hash(){return JSON.stringify(this.toJSON())}clone(){}};a.__decorate([l.property({type:r.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:r.write}}})],k.prototype,"type",void 0);a.__decorate([l.property({type:q,json:{write:{allowNull:!0}}})],k.prototype,"color",void 0);a.__decorate([d.reader("color")],k.prototype,"readColor",null);return k=a.__decorate([f.subclass("esri.symbols.Symbol")],
k)})},"esri/symbols/LineSymbolMarker":function(){define("../chunks/tslib.es6 ../Color ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./support/lineMarkers".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g){var x;r=x=class extends r.JSONSupport{constructor(n){super(n);this.placement=
"begin-end";this.type="line-marker";this.style="arrow"}writeStyle(n,e,h,u){e[h]="web-map"===u?.origin?"arrow":n}set color(n){this._set("color",n)}readColor(n){return null!=n?.[0]?[n[0],n[1],n[2],n[3]/255]:n}writeColor(n,e,h,u){"web-map"!==u?.origin&&(e[h]=n)}clone(){return new x({color:k.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};a.__decorate([l.property({type:["begin","end","begin-end"],json:{write:!0}})],r.prototype,
"placement",void 0);a.__decorate([c.enumeration({"line-marker":"line-marker"},{readOnly:!0}),l.property({json:{origins:{"web-map":{write:!1}}}})],r.prototype,"type",void 0);a.__decorate([l.property({type:g.lineMarkerStyles})],r.prototype,"style",void 0);a.__decorate([p.writer("style")],r.prototype,"writeStyle",null);a.__decorate([l.property({type:q,value:null,json:{write:{allowNull:!0}}})],r.prototype,"color",null);a.__decorate([d.reader("color")],r.prototype,"readColor",null);a.__decorate([p.writer("color")],
r.prototype,"writeColor",null);return r=x=a.__decorate([f.subclass("esri.symbols.LineSymbolMarker")],r)})},"esri/symbols/support/lineMarkers":function(){define(["exports"],function(a){a.lineMarkerPlacements=["begin","end","begin-end"];a.lineMarkerStyles="arrow circle square diamond cross x".split(" ");Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleMarkerSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./MarkerSymbol ./SimpleLineSymbol".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x){var n;r=new r.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});g=n=class extends g{constructor(...e){super(...e);this.color=new q([255,255,255,.25]);this.type="simple-marker";this.size=12;this.style="circle";this.outline=new x}normalizeCtorArgs(e,h,u,v){if(e&&"string"!==typeof e)return e;const y={};e&&(y.style=e);null!=h&&(y.size=l.toPt(h));u&&(y.outline=
u);v&&(y.color=v);return y}writeColor(e,h){e&&"x"!==this.style&&"cross"!==this.style&&(h.color=e.toJSON());null===e&&(h.color=null)}set path(e){this.style="path";this._set("path",e)}clone(){return new n({angle:this.angle,color:k.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};a.__decorate([m.property()],
g.prototype,"color",void 0);a.__decorate([p.writer("color")],g.prototype,"writeColor",null);a.__decorate([d.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],g.prototype,"type",void 0);a.__decorate([m.property()],g.prototype,"size",void 0);a.__decorate([m.property({type:r.apiValues,json:{read:r.read,write:r.write}})],g.prototype,"style",void 0);a.__decorate([m.property({type:String,json:{write:!0}})],g.prototype,"path",null);a.__decorate([m.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",
typeMap:{"simple-line":x}},json:{default:null,write:!0}})],g.prototype,"outline",void 0);return g=n=a.__decorate([f.subclass("esri.symbols.SimpleMarkerSymbol")],g)})},"esri/symbols/MarkerSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),function(a,q,r,k,l,m,b,c){k=class extends c{constructor(d){super(d);this.angle=0;this.type=null;
this.yoffset=this.xoffset=0;this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};a.__decorate([r.property({type:Number,json:{read:d=>d&&-1*d,write:(d,f)=>f.angle=d&&-1*d}})],k.prototype,"angle",void 0);a.__decorate([r.property({type:["simple-marker","picture-marker"],readOnly:!0})],k.prototype,"type",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,json:{write:!0}})],k.prototype,"xoffset",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,
json:{write:!0}})],k.prototype,"yoffset",void 0);a.__decorate([r.property({type:Number,cast:d=>"auto"===d?d:q.toPt(d),json:{write:!0}})],k.prototype,"size",void 0);return k=a.__decorate([b.subclass("esri.symbols.MarkerSymbol")],k)})},"esri/symbols/TextSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Font ./Symbol ./support/textUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g){var x;p=x=class extends p{constructor(...n){super(...n);this.borderLineSize=this.borderLineColor=this.backgroundColor=null;this.font=new f;this.horizontalAlignment="center";this.kerning=!0;this.rightToLeft=this.haloSize=this.haloColor=null;this.rotated=!1;this.text="";this.type="text";this.verticalAlignment="baseline";this.angle=this.yoffset=this.xoffset=0;this.width=null;this.lineWidth=192;this.lineHeight=1}normalizeCtorArgs(n,e,h){if(n&&"string"!==typeof n)return n;
const u={};n&&(u.text=n);e&&(u.font=e);h&&(u.color=h);return u}writeLineWidth(n,e,h,u){u&&"string"!==typeof u||(e[h]=n)}castLineWidth(n){return k.toPt(n)}writeLineHeight(n,e,h,u){u&&"string"!==typeof u||(e[h]=n)}clone(){return new x({angle:this.angle,backgroundColor:r.clone(this.backgroundColor),borderLineColor:r.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:r.clone(this.color),font:this.font&&this.font.clone(),haloColor:r.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,
kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};
a.__decorate([l.property({type:q,json:{write:!0}})],p.prototype,"backgroundColor",void 0);a.__decorate([l.property({type:q,json:{write:!0}})],p.prototype,"borderLineColor",void 0);a.__decorate([l.property({type:Number,json:{write:!0},cast:k.toPt})],p.prototype,"borderLineSize",void 0);a.__decorate([l.property({type:f,json:{write:!0}})],p.prototype,"font",void 0);a.__decorate([l.property({...g.horizontalAlignmentProperty,json:{write:!0}})],p.prototype,"horizontalAlignment",void 0);a.__decorate([l.property({type:Boolean,
json:{write:!0}})],p.prototype,"kerning",void 0);a.__decorate([l.property({type:q,json:{write:!0}})],p.prototype,"haloColor",void 0);a.__decorate([l.property({type:Number,cast:k.toPt,json:{write:!0}})],p.prototype,"haloSize",void 0);a.__decorate([l.property({type:Boolean,json:{write:!0}})],p.prototype,"rightToLeft",void 0);a.__decorate([l.property({type:Boolean,json:{write:!0}})],p.prototype,"rotated",void 0);a.__decorate([l.property({type:String,json:{write:!0}})],p.prototype,"text",void 0);a.__decorate([b.enumeration({esriTS:"text"},
{readOnly:!0})],p.prototype,"type",void 0);a.__decorate([l.property({...g.verticalAlignmentProperty,json:{write:!0}})],p.prototype,"verticalAlignment",void 0);a.__decorate([l.property({type:Number,cast:k.toPt,json:{write:!0}})],p.prototype,"xoffset",void 0);a.__decorate([l.property({type:Number,cast:k.toPt,json:{write:!0}})],p.prototype,"yoffset",void 0);a.__decorate([l.property({type:Number,json:{read:n=>n&&-1*n,write:(n,e)=>e.angle=n&&-1*n}})],p.prototype,"angle",void 0);a.__decorate([l.property({type:Number,
json:{write:!0}})],p.prototype,"width",void 0);a.__decorate([l.property({type:Number})],p.prototype,"lineWidth",void 0);a.__decorate([d.writer("lineWidth")],p.prototype,"writeLineWidth",null);a.__decorate([m.cast("lineWidth")],p.prototype,"castLineWidth",null);a.__decorate([l.property(g.lineHeightProperty)],p.prototype,"lineHeight",void 0);a.__decorate([d.writer("lineHeight")],p.prototype,"writeLineHeight",null);return p=x=a.__decorate([c.subclass("esri.symbols.TextSymbol")],p)})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],
function(a){const q=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:q,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},k={type:"esriSLS",style:"esriSLSSolid",width:.75,color:q};a.defaultColor=q;a.defaultOutlineColor=[153,153,153,255];a.defaultPointSymbolJSON=r;a.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}};a.defaultPolylineSymbolJSON=
k;a.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0};a.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5};a.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null};a.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",
color:[0,0,0,255],width:1.5};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(a,q){let r=null;q.getGeometryEngine=function(){return r};q.loadGeometryEngine=async function(){r=await new Promise((k,l)=>a(["../../../../../../../geometry/geometryEngineJSON"],k,l))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports",
"../../../number","./AlignedVertexSpec","./dataViewUtils"],function(a,q,r,k){class l{static fromVertexSpec(m,b){m=r.AlignedVertexSpec.fromVertexSpec(m,b);return new l(m)}constructor(m){this._spec=m;this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(m,b,c,d,f,p){for(let n=
0;n<this._spec.packVertexCount;n++){const e=n*this._spec.stride;this._packPosition(c,d,e);this._packId(b,e);var g=this._spec.bitset;if(p){if(g.packTessellation){var x=g.packTessellation(p,f);this._pack(x,g,e)}for(const h of this._spec.standardAttributes)if(null!=h.packTessellation)g=h.packTessellation(p,f),this._pack(g,h,e);else if(h.packAlternating?.packTessellation)for(g=h.packAlternating.packTessellation(p,f),x=0;x<this._spec.packVertexCount;x++)this._pack(g[x],h,x*this._spec.stride)}}m.vertexWriteRegion(this._packedU32View)}pack(m,
b){for(const f of this._spec.standardAttributes)if(f.pack&&"string"!==typeof f.pack){var c=f.pack(m,b);for(var d=0;d<this._spec.packVertexCount;d++)this._pack(c,f,d*this._spec.stride)}else if(f.packAlternating?.pack)for(c=f.packAlternating.pack(m,b),d=0;d<this._spec.packVertexCount;d++)this._pack(c[d],f,d*this._spec.stride)}_packPosition(m,b,c){const {offset:d}=this._spec.position,f=this._spec.position.packPrecisionFactor??1;m=q.i1616to32(m*f,b*f);this._dataView.setUint32(c+d,m,!0)}_packId(m,b){m*=
this._spec.id.packPrecisionFactor??1;const c=this._dataView.getUint32(b+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(b+this._spec.id.offset,m|c,!0)}_pack(m,b,c){k.packDataView(this._dataView,m,b,c)}}a.MeshWriterVertexPack=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(a){function q(l,m,b){return Math.round(Math.max(Math.min(l,b),m))}const r=new Float32Array(1),k=new Uint32Array(r.buffer);
a.i16=function(l){return q(l,-32768,32767)};a.i1616to32=function(l,m){return 65535&l|m<<16};a.i32=function(l){return q(l,-2147483648,2147483647)};a.i8=function(l){return q(l,-128,127)};a.i8816to32=function(l,m,b){return l&255|(m&255)<<8|b<<16};a.i8888to32=function(l,m,b,c){return l&255|(m&255)<<8|(b&255)<<16|c<<24};a.numTo32=function(l){return l|0};a.toFloat32=function(l){k[0]=l;return r[0]};a.toUint32=function(l){r[0]=l;return k[0]};a.u16=function(l){return q(l,0,65535)};a.u32=function(l){return q(l,
0,4294967295)};a.u32to4Xu8=function(l){return[l&255,(l&65280)>>>8,(l&16711680)>>>16,(l&4278190080)>>>24]};a.u4u4to8=function(l,m){return 15&l|(15&m)<<4};a.u8=function(l){return q(l,0,255)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(a,q,r,k){function l(c){switch(c){case k.DataType.BYTE:case k.DataType.UNSIGNED_BYTE:return 1;
case k.DataType.SHORT:case k.DataType.UNSIGNED_SHORT:return 2;case k.DataType.FLOAT:case k.DataType.INT:case k.DataType.UNSIGNED_INT:return 4}}function m(c){const d=[],f=[],p=[];for(const g of c)switch(c=l(g.type)*g.count,c%2||c%4||4){case 4:d.push(g);continue;case 2:f.push(g);continue;case 1:p.push(g);continue;default:throw Error("Found unexpected dataType byte count");}d.push(...f);d.push(...p);return d}class b{static fromVertexSpec({attributes:c},d){let f,p,g;var x=[];for(var n in c){const h=c[n];
!1!==d?.[n]&&("position"===h.pack?f={...h,name:n,offset:0}:"id"===h.pack?p={...h,name:n,offset:4}:"bitset"===n?g={...h,name:n,offset:7}:x.push({...h,name:n}))}n=m(x);c=[];d=8;x=1;for(var e of n)c.push({...e,offset:d}),d+=l(e.type)*e.count,e.packAlternating&&(x=Math.max(e.packAlternating.count,x));e=Uint32Array.BYTES_PER_ELEMENT;n=d%e;return new b(f,p,g,c,d+(n?e-n:0),x)}constructor(c,d,f,p,g,x){this.position=c;this.id=d;this.bitset=f;this.standardAttributes=p;this.stride=g;this.packVertexCount=x;p.push(f);
this._attributes=[c,d,f,...p]}get attributeLayout(){if(!this._attributeLayout){const c=r.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(d=>({name:d.name,count:d.count,offset:d.offset,type:d.type,packPrecisionFactor:d.packPrecisionFactor,normalized:d.normalized??!1})),hash:c,stride:this.stride}}return this._attributeLayout}}a.AlignedVertexSpec=b;a.sortByAlignment=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports",
"../../../../../../webgl/enums"],function(a,q){a.packDataView=function(r,k,l,m){const b=l.packPrecisionFactor??1;switch(l.type){case q.DataType.BYTE:if(1===l.count)r.setInt8(m+l.offset,k*b);else for(var c=0;c<l.count;c++)r.setInt8(m+l.offset+c*Int8Array.BYTES_PER_ELEMENT,k[c]*b);break;case q.DataType.UNSIGNED_BYTE:if(1===l.count)r.setUint8(m+l.offset,k*b);else for(c=0;c<l.count;c++)r.setUint8(m+l.offset+c*Uint8Array.BYTES_PER_ELEMENT,k[c]*b);break;case q.DataType.SHORT:if(1===l.count)r.setInt16(m+
l.offset,k*b,!0);else for(c=0;c<l.count;c++)r.setInt16(m+l.offset+c*Int16Array.BYTES_PER_ELEMENT,k[c]*b,!0);break;case q.DataType.UNSIGNED_SHORT:if(1===l.count)r.setUint16(m+l.offset,k*b,!0);else for(c=0;c<l.count;c++)r.setUint16(m+l.offset+c*Uint16Array.BYTES_PER_ELEMENT,k[c]*b,!0);break;case q.DataType.INT:if(1===l.count)r.setInt32(m+l.offset,k*b,!0);else for(c=0;c<l.count;c++)r.setInt32(m+l.offset+c*Int32Array.BYTES_PER_ELEMENT,k[c]*b,!0);break;case q.DataType.UNSIGNED_INT:if(1===l.count)r.setUint32(m+
l.offset,k*b,!0);else for(c=0;c<l.count;c++)r.setUint32(m+l.offset+c*Uint32Array.BYTES_PER_ELEMENT,k[c]*b,!0);break;case q.DataType.FLOAT:if(1===l.count)r.setFloat32(m+l.offset,k*b,!0);else for(c=0;c<l.count;c++)r.setFloat32(m+l.offset+c*Float32Array.BYTES_PER_ELEMENT,k[c]*b,!0)}};a.unpackDataView=function(r,k,l){switch(k.type){case q.DataType.BYTE:if(1===k.count)return r.getInt8(l+k.offset);var m=[];for(var b=0;b<k.count;b++)m.push(r.getInt8(l+k.offset+b*Int8Array.BYTES_PER_ELEMENT));return m;case q.DataType.UNSIGNED_BYTE:if(1===
k.count)return r.getUint8(l+k.offset);m=[];for(b=0;b<k.count;b++)m.push(r.getUint8(l+k.offset+b*Uint8Array.BYTES_PER_ELEMENT));return m;case q.DataType.SHORT:if(1===k.count)return r.getInt16(l+k.offset,!0);m=[];for(b=0;b<k.count;b++)m.push(r.getInt16(l+k.offset+b*Int16Array.BYTES_PER_ELEMENT,!0));return m;case q.DataType.UNSIGNED_SHORT:if(1===k.count)return r.getUint16(l+k.offset,!0);m=[];for(b=0;b<k.count;b++)m.push(r.getUint16(l+k.offset+b*Uint16Array.BYTES_PER_ELEMENT,!0));return m;case q.DataType.INT:if(1===
k.count)return r.getInt32(l+k.offset,!0);m=[];for(b=0;b<k.count;b++)m.push(r.getInt32(l+k.offset+b*Int32Array.BYTES_PER_ELEMENT,!0));return m;case q.DataType.UNSIGNED_INT:if(1===k.count)return r.getUint32(l+k.offset,!0);m=[];for(b=0;b<k.count;b++)m.push(r.getUint32(l+k.offset+b*Uint32Array.BYTES_PER_ELEMENT,!0));return m;case q.DataType.FLOAT:if(1===k.count)return r.getFloat32(l+k.offset,!0);m=[];for(b=0;b<k.count;b++)m.push(r.getFloat32(l+k.offset+b*Float32Array.BYTES_PER_ELEMENT,!0));return m}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ../../../definitions ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),function(a,q,r,k,l,m,b,c){function d(e){const {sprite:h,aspectRatio:u,scaleProportionally:v}=e;var y=q.pt2px(e.height);e=0<y?y:h.height;
y*=u;0>=y?y=h.width:v&&(y*=h.width/h.height);return{width:y,height:e}}function f(e){const {applyRandomOffset:h,sampleAlphaOnly:u}=e,{width:v,height:y}=d(e);return l.packBitset([[b.bitsetFillRandomPatternOffset,h],[b.bitsetGenericConsiderAlphaOnly,u],[b.bitsetFillPatternWidthIsCompressed,v<k.maxSizeForU16Compression],[b.bitsetFillPatternHeightIsCompressed,y<k.maxSizeForU16Compression]])}function p(e){({width:e}=d(e));return Math.round(e<k.maxSizeForU16Compression?e*k.compressionFactorForU16:e)}function g(e){({height:e}=
d(e));return Math.round(e<k.maxSizeForU16Compression?e*k.compressionFactorForU16:e)}const x={createComputedParams:e=>e,attributes:{...m.patternFillVertexSpec.attributes,bitset:{count:1,type:c.DataType.UNSIGNED_BYTE,pack:f},width:{count:1,type:c.DataType.UNSIGNED_SHORT,pack:p},height:{count:1,type:c.DataType.UNSIGNED_SHORT,pack:g},offset:{count:2,type:c.DataType.SHORT,pack:({offsetX:e,offsetY:h})=>[q.pt2px(e),-q.pt2px(h)]},scale:{count:2,type:c.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,
scaleY:h})=>[e,h]},angle:{count:1,type:c.DataType.UNSIGNED_BYTE,pack:({angle:e})=>r.degToByte(e)}}};class n extends m.PatternFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=x}}a.ComplexFillMeshWriter=n;a.complexFillVertexSpec=x;a.packComplexFillBitset=f;a.packComplexFillHeight=g;a.packComplexFillWidth=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color",
"../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(a,q,r,k,l){a.getBitMask=function(m){return 1<<m};a.getMinMaxZoom=function(m,b){const c=!!m?.minScale&&b.scaleToZoom(m.minScale)||0;m=!!m?.maxScale&&b.scaleToZoom(m.maxScale)||100;return[c,m]};a.packBitset=function(m){let b=0;for(const [c,d]of m)d&&(b|=1<<c);return b};a.packByteSqrt=function(m,b){return Math.round(Math.min(Math.sqrt(m*b),255))};a.packCeil=function(m,b){return Math.ceil(m*
b)/b};a.packRounded=function(m,b){return Math.round(m*b)/b};a.processColorInput=function(m){if(!m)return[0,0,0,0];if("string"===typeof m){const p=q.fromString(m);if(!p)return k.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new r("mapview:mesh-processing","Unable to parse string into color",{color:m})),[0,0,0,0];m=p.toArray()}const [b,c,d,f]=m;return[f/255*b,f/255*c,f/255*d,f]};a.processLineCapInput=function(m){switch(m){case "butt":case l.LineCapStyle.Butt:return l.CapType.BUTT;
case "round":case l.LineCapStyle.Round:return l.CapType.ROUND;case "square":case l.LineCapStyle.Square:return l.CapType.SQUARE}};a.processLineJoinInput=function(m){switch(m){case "bevel":case l.LineJoinStyle.Bevel:return l.JoinType.BEVEL;case "miter":case l.LineJoinStyle.Miter:return l.JoinType.MITER;case "round":case l.LineJoinStyle.Round:return l.JoinType.ROUND}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports",
"../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(a,q,r,k){const l={createComputedParams:b=>b,attributes:{...r.fillVertexSpec.attributes,tlbr:{count:4,type:k.DataType.UNSIGNED_SHORT,pack:({sprite:b})=>{const {rect:c,width:d,height:f}=b;b=c.x+q.spritePadding;const p=c.y+q.spritePadding;return[b,p,b+d,p+f]}},inverseRasterizationScale:{count:1,type:k.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:b})=>1/b.rasterizationScale}}};class m extends r.FillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=l}_write(b,c,d){d=d?.asOptimized()??c.readGeometryForDisplay();if(d=this._clip(d))b.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(b,c,d),b.recordEnd()}}a.PatternFillMeshWriter=m;a.patternFillVertexSpec=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils",
"../../../../../../webgl/enums"],function(a,q,r,k,l){const m={createComputedParams:c=>c,attributes:{id:{type:l.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:l.DataType.UNSIGNED_BYTE,count:1},pos:{type:l.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:l.DataType.SHORT,count:2,packPrecisionFactor:q.minMaxZoomPrecisionFactor,pack:({scaleInfo:c},{tileInfo:d})=>k.getMinMaxZoom(c,d)},color:{type:l.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:c})=>k.processColorInput(c)}}};
class b extends r.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}createTesselationParams(c){return null}}a.FillMeshWriter=b;a.fillVertexSpec=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(a){a.RotationType=void 0;var q=a.RotationType||(a.RotationType={});q[q.Geographic=0]="Geographic";q[q.Arithmatic=1]="Arithmatic";a.attrVvColor=1;a.attrVvOpacity=2;a.attrVvRotation=
3;a.attrVvSize=0;a.bitsetFillPatternHeightIsCompressed=5;a.bitsetFillPatternWidthIsCompressed=6;a.bitsetFillRandomPatternOffset=2;a.bitsetGenericConsiderAlphaOnly=4;a.bitsetGenericLockColor=1;a.bitsetLineIsSdf=3;a.bitsetLineScaleDash=2;a.bitsetMarkerAlignmentMap=0;a.bitsetMarkerOutlineAllowColorOverride=2;a.bitsetMarkerScaleSymbolsProportionally=3;a.bitsetTextIsBackground=0;a.bitsetTextIsLineLabel=4;a.bitsetTextIsMapAligned=3;a.bitsetTypeFillOutline=0;a.c256ToRad=3.14159265359/128;a.cDegToRad=3.14159265359/
180;a.cRadToDeg=57.29577950560105;a.epsilon=1E-5;a.epsilonHitTest=.05;a.extrudeScalePlacementPadding=.25;a.fillPositionPrecision=1;a.maxFilterCount=2;a.maxRepresentableInt=16777216;a.maxSdfDistance=8;a.nanMagicNumber=1E-30;a.offsetPrecision=.125;a.outlineScale=.2;a.placementPadding=8;a.positionPrecision=.125;a.sdfFontSize=24;a.softEdgeRatio=1;a.thinLineHalfWidth=1;a.thinLineWidthFactor=1.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/ComplexOutlineFillShader ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b,c,d){const f=k.complexFillVertexSpec.attributes,p={createComputedParams:e=>e,attributes:{id:f.id,pos:f.pos,zoomRange:f.zoomRange,tlbr:f.tlbr,angle:f.angle,color:f.color,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:e=>k.packComplexFillBitset(e)},aux1:{count:1,type:d.DataType.UNSIGNED_SHORT,pack:e=>k.packComplexFillWidth(e)},aux2:{count:1,type:d.DataType.UNSIGNED_SHORT,pack:e=>k.packComplexFillHeight(e)},aux3:{count:2,type:d.DataType.SHORT,pack:({offsetX:e,offsetY:h})=>
[q.pt2px(e),q.pt2px(h)]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:h})=>[e*b.packPrecision,h*b.packPrecision]}}},g={createComputedParams:e=>e,attributes:{id:f.id,pos:f.pos,zoomRange:f.zoomRange,tlbr:f.tlbr,angle:f.angle,color:m.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:e=>l.packBitset([[c.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:d.DataType.UNSIGNED_SHORT,pack:e=>q.pt2px(.5*e.width)*b.packPrecision},aux2:{count:1,
type:d.DataType.UNSIGNED_SHORT,pack:e=>q.pt2px(.5*e.referenceWidth)*b.packPrecision},aux3:{count:2,type:d.DataType.SHORT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:h})=>[e*b.packPrecision,h*b.packPrecision]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:h})=>[e*b.packPrecision+b.signedToUnsignedByte,h*b.packPrecision+b.signedToUnsignedByte]}}};class x extends m.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=g}}class n extends m.OutlineFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=p}_createOutlineWriter(e,h,u,v){return new x(e,h,u,v)}_write(e,h,u){u=u?.asOptimized()??h.readGeometryForDisplay();if(u=this._clip(u))e.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(e,h,u),this._lineMeshWriter.writeLineVertices(e,r.GeometryCursor.fromOptimizedCIM(u,"esriGeometryPolyline"),h),e.recordEnd()}ensurePacked(e,h,u){super.ensurePacked(e,h,u);this._lineMeshWriter.ensurePacked(e,h,u)}enqueueRequest(e,h,
u){super.enqueueRequest(e,h,u);this._lineMeshWriter.enqueueRequest(e,h,u)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}a.ComplexOutlineFillMeshWriter=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b){const c={createComputedParams:g=>g,attributes:{...l.LineVertexSpec.attributes,bitset:{type:b.DataType.UNSIGNED_BYTE,count:1,pack:g=>0},color:{type:b.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:g})=>k.processColorInput(g)}}},d={createComputedParams:g=>g,attributes:{...l.LineVertexSpec.attributes,bitset:{type:b.DataType.UNSIGNED_BYTE,count:1,pack:g=>k.packBitset([[m.bitsetTypeFillOutline,!0]])},color:{type:b.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:g})=>
k.processColorInput(g)}}};class f extends l.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=d}}class p extends r.FillMeshWriter{constructor(g,x,n,e){super(g,x,n,e);this.vertexSpec=c;this._lineMeshWriter=this._createOutlineWriter(g,x,n,e)}_createOutlineWriter(g,x,n,e){return new f(g,x,n,e)}_write(g,x,n){n=n?.asOptimized()??x.readGeometryForDisplay();if(n=this._clip(n))g.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(g,x,n),this._lineMeshWriter.writeLineVertices(g,
q.GeometryCursor.fromOptimizedCIM(n,"esriGeometryPolyline"),x),g.recordEnd()}ensurePacked(g,x,n){super.ensurePacked(g,x,n);this._lineMeshWriter.ensurePacked(g,x,n)}enqueueRequest(g,x,n){super.enqueueRequest(g,x,n);this._lineMeshWriter.enqueueRequest(g,x,n)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}a.OutlineFillMeshWriter=p;a.OutlineFillOutlineMeshWriter=f;a.outlineFillVertexSpec_Fill=c;a.outlineFillVertexSpec_Outline=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),function(a,q,r,k,l,m,b,c,d){class f{constructor(){this.distance=this.directionY=this.directionX=this.normalY=this.normalX=
this.extrusionOffsetY=this.extrusionOffsetX=0}}const p={createComputedParams:n=>n,attributes:{id:{type:d.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:d.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:d.DataType.UNSIGNED_BYTE,count:1},zoomRange:{type:d.DataType.SHORT,count:2,packPrecisionFactor:k.minMaxZoomPrecisionFactor,pack:({scaleInfo:n},{tileInfo:e})=>b.getMinMaxZoom(n,e)},color:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:n})=>b.processColorInput(n)},
offset:{type:d.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:n,extrusionOffsetY:e})=>[b.packRounded(n,16),b.packRounded(e,16)]},normal:{type:d.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:n,normalY:e})=>[b.packRounded(n,16),b.packRounded(e,16)]},halfWidth:{type:d.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({width:n})=>b.packCeil(q.pt2px(.5*n),16)},referenceHalfWidth:{type:d.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,
pack:({referenceWidth:n})=>b.packCeil(q.pt2px(.5*n),16)}}};class g{constructor(){this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class x extends c.MeshWriter{constructor(n,e,h,u){super(n,e,h,u);this.vertexSpec=p;this._currentWrite=new g;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};this._tessParams=new f;this._initializeTessellator()}writeLineVertices(n,e,h){e=this._getLines(e);null!=e&&this._writeVertices(n,
h,e)}_initializeTessellator(){this._lineTessellator=new l.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(n,e,h){(h=h??r.GeometryCursor.fromFeatureSetReaderCIM(e))&&this._writeGeometry(n,e,h)}_writeGeometry(n,e,h,u){n.recordStart(this.instanceId,this.attributeLayout,u);this.writeLineVertices(n,h,e);n.recordEnd()}_getLines(n){return m.clipLinesMarshall(n,this.hasEffects?256:16)}_writeVertices(n,e,h){const {_currentWrite:u,_tessellationOptions:v,evaluatedMeshParams:y}=
this,{width:B,capType:t,joinType:w,miterLimit:C,hasSizeVV:z}=y,D=q.pt2px(.5*B);v.halfWidth=D;v.capType=b.processLineCapInput(t);v.joinType=b.processLineJoinInput(w);v.miterLimit=C;const H=!z;u.out=n;u.id=e.getDisplayId();u.vertexCount=0;u.indexCount=0;u.vertexFrom=n.vertexCount();u.vertexBounds=H&&D<k.thinLineHalfWidthThreshold?0:1;for(const {line:G,start:A}of h)v.initialDistance=A%65535,this._lineTessellator.tessellate(G,v,H)}_writeTesselatedVertex(n,e,h,u,v,y,B,t,w,C,z){const {out:D,id:H,vertexBounds:G}=
this._currentWrite;this.hasEffects&&D.recordBounds(n,e,G,G);this._tessParams.extrusionOffsetX=B;this._tessParams.extrusionOffsetY=t;this._tessParams.normalX=w;this._tessParams.normalY=C;this._tessParams.directionX=v;this._tessParams.directionY=y;this._tessParams.distance=z;this._writeVertex(D,H,n,e,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(n,e,h){const {out:u}=this._currentWrite;u.indexEnsureSize(3);u.indexWrite(n);u.indexWrite(e);u.indexWrite(h);
this._currentWrite.indexCount+=3}}a.LineMeshWriter=x;a.LineTessellationParams=f;a.LineVertexSpec=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g){class x extends l.FeatureVertexInput{}q.__decorate([r.location(3,k.Vec4)],x.prototype,"color",void 0);q.__decorate([r.location(4,k.Vec4)],x.prototype,"tlbr",void 0);q.__decorate([r.location(5,k.Float)],x.prototype,"angle",void 0);q.__decorate([r.location(6,k.Float)],x.prototype,"aux1",void 0);q.__decorate([r.location(7,k.Float)],x.prototype,"aux2",void 0);q.__decorate([r.location(8,k.Vec2)],x.prototype,"aux3",void 0);q.__decorate([r.location(9,k.Vec2)],x.prototype,
"aux4",void 0);q.__decorate([r.location(10,k.Vec2)],x.prototype,"zoomRange",void 0);class n extends g.PatternOutlineFillFragmentInput{}class e extends p.AOutlineFillShader{vertex(h,u){const {aux1:v,aux2:y,aux3:B,aux4:t}=h;var w={...h,width:v,height:y,offset:B,scale:t.multiply(.0625)},C={...h,halfWidth:v.multiply(.0625),referenceHalfWidth:y.multiply(.0625),offset:B.multiply(.0625),normal:t.subtract(128).multiply(.0625)};C=p.getOutlineFillVertexData(this,C);w=m.getComplexFillVertexData(this,w);const z=
k.greaterThan(C.isOutline,new k.Float(.5));return{...C,...w,...this.maybeRunHittest(h,u,z)}}fragment(h){var {isOutline:u}=h;u=k.greaterThan(u,new k.Float(.5));var v=c.getLineFragmentColor(h,this.antialiasingControls.blur);const y=m.getComplexFillFragmentColor(this,h);v=k.ifElse(u,v,y);u=k.ifElse(u,new k.Float(1/255),new k.Float(0));return this.getFragmentOutput(v,h,u)}hittest(h,u,v){return k.ifElse(v,b.failHittest(this.hittestRequest),b.hittestFill(this,h,u))}}q.__decorate([r.uniform(f.MosaicInfo)],
e.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(d.LocalTileOffset)],e.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(x)),q.__param(1,r.input(l.BaseHittestVertexInput))],e.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(n))],e.prototype,"fragment",null);a.ComplexOutlineFillShader=e;a.ComplexOutlineFillVertexInput=x;a.packPrecision=16;a.signedToUnsignedByte=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/string ./ShaderBuilder2D ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){function g(t,w,C){const z=t.constructor[w]??[];t.constructor.hasOwnProperty(w)||Object.defineProperty(t.constructor,w,{value:z.slice()});t.constructor[w].push(C)}const x=t=>(w,C)=>{g(w,"builtins",{builtin:t,propertyKey:C})},n=(t,w)=>(C,z)=>{C.constructor.builtins.push({builtin:t,propertyKey:z,typeCtor:w})};class e{}e.builtins=[];q.__decorate([n("gl_VertexID",b.Int)],e.prototype,"glVertexID",void 0);class h{}class u{}u.builtins=[];q.__decorate([n("gl_FragCoord",b.Vec4)],
u.prototype,"glFragCoord",void 0);q.__decorate([n("gl_PointCoord",b.Vec2)],u.prototype,"glPointCoord",void 0);class v{}q.__decorate([x("gl_FragColor")],v.prototype,"glFragColor",void 0);class y{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class B{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const t=r.findLast(this._shaderModuleClass.inputs,w=>"vertex"===w.propertyKey&&0===w.parameterIndex);if(!t)throw Error("Unable to find vertex input parameter");
return t}get computeInput(){return r.findLast(this._shaderModuleClass.inputs,t=>"vertex"===t.propertyKey&&1===t.parameterIndex)}get fragmentInput(){const t=r.findLast(this._shaderModuleClass.inputs,w=>"fragment"===w.propertyKey);if(!t)throw Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??
[])]}get locationsMap(){const t=new Map,w=new Set;for(const C of this.locations)w.has(C.index)?k.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${C.propertyKey} to ${C.index}. Index already in use`,{locationsMap:t}):(t.set(C.propertyKey,C.index),w.add(C.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,w=Array.from(t.entries()).map(([C,z])=>`${C}.${z}`).join(".");this._locationInfo=
{hash:l.numericHash(w),locations:t}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const w of this.locations)t.set("a_"+w.propertyKey,w.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const w of this._options)t.add(w.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??
[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,w,C,z){try{const {vertex:D,fragment:H,uniformBindings:G}=this._generateShaders(t,w,C,z);return new p.TypedShaderProgram(D,H,this.renamedLocationsMap,this.locationInfo,G,this.transformFeedbackBindings)}catch(D){return console.error("Failed to create program",{error:D}),new p.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){var w=this._options.find(C=>
C.propertyKey===t);if(w)return{type:"option",className:w.typeCtor};w=this._uniforms.find(C=>C.propertyKey===t);if(!w)throw Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:w.typeCtor}}getShaderKey(t,w,C,z){const D=Object.keys(C).map(A=>`${A}.${C[A]}`).join("."),H=Object.keys(z).map(A=>`${A}.${z[A]}`).join("."),G=Object.keys(w).filter(A=>this.optionPropertyKeys.has(A)&&w[A]).join(".");return`${this.constructor.name}.${t.hash}.${D}.${H}.${G}`}_generateShaders(t,
w,C,z){const D=[];this._setDefines(C);this._setOptionalUniforms(D,w);this._setRequiredUniforms(D);w=this._hydrateVertexInput(z);z=this._injectPackPrecisionFactor(w,t);t=(C=this._hydrateComputeInput())&&this._injectPackPrecisionFactor(C,t);const H=this.vertex(z,t);t=this._hydrateFragmentInput(H);z=this.fragment(t);const G=new Set;for(var A in z)f.setReachableUids(G,z[A]);A=this._getVertexInputBuiltins();A=d.ShaderGraphContext.createVertex({...w,...C},H,A,D,this.transformFeedbackBindings,G);(new c.GlslShaderWriter).write(A);
w=this._getFragmentInputBuiltins(z);w.set("glPointCoord","gl_PointCoord");w=d.ShaderGraphContext.createFragment(t,z,w,D,A,this.transformFeedbackBindings);(new c.GlslShaderWriter).write(w);w=this._createShaderBuilder(A,w);A=w.generate("vertex",!1);w=w.generate("fragment",!1);this.logShader&&(console.log(A),console.log(w));return{vertex:A,fragment:w,uniformBindings:D}}_setDefines(t){for(const w in t)this[w]=t[w]}_setOptionalUniforms(t,w){for(const C of this._options)this[C.propertyKey]=w[C.propertyKey]?
this._hydrateUniformGroup(t,C):null}_setRequiredUniforms(t){for(const w of this._uniforms)this[w.propertyKey]=this._hydrateUniformGroup(t,w)}_hydrateUniformGroup(t,w){const C=new w.typeCtor;for(const z of C._uniforms??[]){const D=new z.typeCtor,H=`u_${w.propertyKey}_${z.propertyKey}`,G=D.type,A=[w.propertyKey,z.propertyKey].join(".");if("type"in z.typeCtor&&"array"===z.typeCtor.type){const F=D;t.push({shaderModulePath:A,uniformName:H,uniformType:G,uniformArrayLength:F.size,uniformArrayElementType:F.elementType.type,
uniformHydrated:D})}else t.push({shaderModulePath:A,uniformName:H,uniformType:G,uniformHydrated:D});C[z.propertyKey]=D}return C}_hydrateVertexInput(t){var w=this.vertexInput.inputCtor;const C=w.locations.reduce((z,D)=>!1===t[D.propertyKey]?z:{...z,[D.propertyKey]:new D.typeCtor},{});for(const {propertyKey:z,typeCtor:D}of w.builtins)w=new D,C[z]=w;return C}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((t,w)=>({...t,[w.propertyKey]:new w.typeCtor}),
{})}_injectPackPrecisionFactor(t,w){const C={};for(const z in t){const D=t[z],H=w.attributes.find(G=>G.name===z);if(H?.packPrecisionFactor){if("float"!==D.type&&"vec2"!==D.type&&"vec3"!==D.type&&"vec4"!==D.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${D.type}`);C[z]=D.divide(new b.Float(H.packPrecisionFactor))}else C[z]=D}return C}_hydrateFragmentInput(t){const w={};for(const C in t)w[C]=t[C];for(const {propertyKey:C,typeCtor:z}of u.builtins)t=new z,w[C]=t;return w}_getVertexInputBuiltins(){const t=
this.vertexInput.inputCtor,w=new Map;for(const {builtin:C,propertyKey:z}of t.builtins)w.set(z,C);return w}_getFragmentInputBuiltins(t){t=t.constructor;const w=new Map;for(const C of t.builtins??[])w.set(C.propertyKey,C.builtin);return w}_createShaderBuilder(t,w){const C=new m.ShaderBuilder2D;this._insertDebugInfo(C);t.insertVertexShader(C);w.insertFragmentShader(C);return C}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: ");t.vertex.code.add("// --------------------------------------------------------- ");
for(const w of this._defines)this[w.propertyKey]?t.vertex.code.add(`//   ${w.propertyKey}: true`):t.vertex.code.add(`//   ${w.propertyKey}: false`);t.vertex.code.add("");t.vertex.code.add("// OPTIONS: ");t.vertex.code.add("// --------------------------------------------------------- ");for(const w of this._options)this[w.propertyKey]?t.vertex.code.add(`//   ${w.propertyKey}: true`):t.vertex.code.add(`//   ${w.propertyKey}: false`)}}a.ComputeVertexInput=h;a.FragmentInput=u;a.FragmentOutput=v;a.GraphShaderModule=
B;a.UniformGroup=y;a.VertexInput=e;a.builtin=x;a.define=(t,w)=>{g(t,"defines",{propertyKey:w})};a.input=t=>(w,C,z)=>{g(w,"inputs",{inputCtor:t,propertyKey:C,parameterIndex:z})};a.location=function(t,w){return(C,z)=>{g(C,"locations",{typeCtor:w,propertyKey:z,parameterIndex:null,index:t})}};a.option=t=>(w,C)=>{g(w,"options",{typeCtor:t,propertyKey:C})};a.transformFeedback=function(t){return(w,C)=>{g(w,"transformFeedbackBindings",{propertyKey:C,parameterIndex:null,index:t})}};a.uniform=t=>(w,C)=>{g(w,
"uniforms",{typeCtor:t,propertyKey:C})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/ShaderBuilder2D":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../3d/webgl-engine/core/shaderTechnique/BindType","../../../../3d/webgl-engine/lib/Util"],function(a,q,r,k,l){function m(u=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${u?
"out vec4 fragColor;":""}\n`}const b=()=>r.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class c{constructor(){this._includedModules=new Map}include(u,v){if(this._includedModules.has(u)){const y=this._includedModules.get(u);if(y!==v){b().error("Trying to include shader module multiple times with different sets of options.");v=new Set;for(const B of Object.keys(y))y[B]!==u[B]&&v.add(B);for(const B of Object.keys(u))y[B]!==u[B]&&v.add(B);v.forEach(B=>console.error(`  ${B}: current ${y[B]} new ${u[B]}`))}}else this._includedModules.set(u,
v),u(this.builder,v)}}class d extends c{constructor(){super(...arguments);this.vertex=new g;this.fragment=new g;this.attributes=new x;this.varyings=new n;this.extensions=new e;this.constants=new h}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(u,v=!0){const y=this.extensions.generateSource(u),B=this.attributes.generateSource(u),t=this.varyings.generateSource(u);var w="vertex"===u?this.vertex:this.fragment;const C=w.uniforms.generateSource(),z=w.code.generateSource();
u="vertex"===u?"precision highp float;\nprecision highp sampler2D;":m(v);w=this.constants.generateSource().concat(w.constants.generateSource());return`${v?"#version 300 es":""}\n${y.join("\n")}\n${u}\n${w.join("\n")}\n${C.join("\n")}\n${B.join("\n")}\n${t.join("\n")}\n${z.join("\n")}`}generateBindPass(u){const v=new Map;this.vertex.uniforms.entries.forEach(t=>{const w=t.bind[k.BindType.Pass];w&&v.set(t.name,w)});this.fragment.uniforms.entries.forEach(t=>{const w=t.bind[k.BindType.Pass];w&&v.set(t.name,
w)});const y=Array.from(v.values()),B=y.length;return(t,w)=>{for(let C=0;C<B;++C)y[C](u,t,w)}}generateBindDraw(u){const v=new Map;this.vertex.uniforms.entries.forEach(t=>{const w=t.bind[k.BindType.Draw];w&&v.set(t.name,w)});this.fragment.uniforms.entries.forEach(t=>{const w=t.bind[k.BindType.Draw];w&&v.set(t.name,w)});const y=Array.from(v.values()),B=y.length;return(t,w,C)=>{for(let z=0;z<B;++z)y[z](u,t,w,C)}}}class f{constructor(){this._entries=new Map}add(...u){for(const v of u)this._add(v)}get(u){return this._entries.get(u)}_add(u){if(null==
u)b().error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(u.name)&&!this._entries.get(u.name).equals(u))throw new q(`Duplicate uniform name ${u.name} for different uniform type`);this._entries.set(u.name,u)}}generateSource(){return Array.from(this._entries.values()).map(u=>null!=u.arraySize?`uniform ${u.type} ${u.name}[${u.arraySize}];`:`uniform ${u.type} ${u.name};`)}get entries(){return Array.from(this._entries.values())}}class p{constructor(){this._entries=[]}add(u){this._entries.push(u)}generateSource(){return this._entries}}
class g extends c{constructor(){super(...arguments);this.uniforms=new f;this.code=new p;this.constants=new h}get builder(){return this}}class x{constructor(){this._entries=[]}add(u,v){this._entries.push([u,v])}generateSource(u){return"fragment"===u?[]:this._entries.map(v=>`in ${v[1]} ${v[0]};`)}}class n{constructor(){this._entries=new Map}add(u,v){this._entries.has(u)&&l.assert(this._entries.get(u)===v);this._entries.set(u,v)}generateSource(u){const v=[];this._entries.forEach((y,B)=>v.push("vertex"===
u?`out ${y} ${B};`:`in ${y} ${B};`));return v}}class e{constructor(){this._entries=new Set}add(u){this._entries.add(u)}generateSource(u){const v="vertex"===u?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(y=>v.includes(y)).map(y=>`#extension ${y} : enable`)}}e.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];e.ALLOWLIST_VERTEX=[];class h{constructor(){this._entries=new Set}add(u,v,y){let B="ERROR_CONSTRUCTOR_STRING";switch(v){case "float":B=
h._numberToFloatStr(y);break;case "int":B=h._numberToIntStr(y);break;case "bool":B=y.toString();break;case "vec2":B=`vec2(${h._numberToFloatStr(y[0])},                            ${h._numberToFloatStr(y[1])})`;break;case "vec3":B=`vec3(${h._numberToFloatStr(y[0])},                            ${h._numberToFloatStr(y[1])},                            ${h._numberToFloatStr(y[2])})`;break;case "vec4":B=`vec4(${h._numberToFloatStr(y[0])},                            ${h._numberToFloatStr(y[1])},                            ${h._numberToFloatStr(y[2])},                            ${h._numberToFloatStr(y[3])})`;
break;case "ivec2":B=`ivec2(${h._numberToIntStr(y[0])},                             ${h._numberToIntStr(y[1])})`;break;case "ivec3":B=`ivec3(${h._numberToIntStr(y[0])},                             ${h._numberToIntStr(y[1])},                             ${h._numberToIntStr(y[2])})`;break;case "ivec4":B=`ivec4(${h._numberToIntStr(y[0])},                             ${h._numberToIntStr(y[1])},                             ${h._numberToIntStr(y[2])},                             ${h._numberToIntStr(y[3])})`;
break;case "mat2":case "mat3":case "mat4":B=`${v}(${Array.prototype.map.call(y,t=>h._numberToFloatStr(t)).join(", ")})`}this._entries.add(`const ${v} ${u} = ${B};`);return this}static _numberToIntStr(u){return u.toFixed(0)}static _numberToFloatStr(u){return Number.isInteger(u)?u.toFixed(1):u.toString()}generateSource(){return Array.from(this._entries)}}a.Code=p;a.Includes=c;a.ShaderBuilder2D=d;a.Stage=g;a.Uniforms=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var q=a.BindType||(a.BindType={});q[q.Pass=0]="Pass";q[q.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,q,r,k){function l(c,d){if(!c)throw d=d||"Assertion",new b(`${d} at ${Error(d).stack}`);}const m=k.create();class b{constructor(c){this.message=
c}toString(){return`AssertException: ${this.message}`}}a.assert=l;a.isTranslationMatrix=function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&1===c[15]};a.logWithBase=function(c,d){return Math.log(c)/Math.log(d)};a.project=function(c,d,f,p,g){m[0]=c[0];m[1]=c[1];m[2]=c[2];m[3]=1;r.transformMat4(m,m,d);2<g.length&&(g[2]=-m[2]);r.transformMat4(m,m,f);l(0!==m[3]);g[0]=m[0]/m[3];g[1]=m[1]/m[3];g[2]=m[2]/m[3];g[0]=(.5*
g[0]+.5)*p[2]+p[0];g[1]=(.5*g[1]+.5)*p[3]+p[1]};a.rayBoxTest=function(c,d,f,p){let g,x=(f[0]-c[0])/d[0],n=(p[0]-c[0])/d[0];x>n&&(g=x,x=n,n=g);let e=(f[1]-c[1])/d[1],h=(p[1]-c[1])/d[1];e>h&&(g=e,e=h,h=g);if(x>h||e>n)return!1;e>x&&(x=e);h<n&&(n=h);f=(f[2]-c[2])/d[2];c=(p[2]-c[2])/d[2];f>c&&(g=f,f=c,c=g);if(x>c||f>n)return!1;c<n&&(n=c);return 0>n?!1:!0};a.rayRay2D=function(c,d,f,p,g,x=q.create()){const n=(p[g]-f[g])*(d[0]-c[0])-(p[0]-f[0])*(d[g]-c[g]);if(0===n)return!1;f=((p[0]-f[0])*(c[g]-f[g])-(p[g]-
f[g])*(c[0]-f[0]))/n;x[0]=c[0]+f*(d[0]-c[0]);x[1]=c[g]+f*(d[g]-c[g]);return!0};a.setMatrixTranslation3=function(c,d,f,p){c[12]=d;c[13]=f;c[14]=p};a.verify=function(c,d){c||console.warn("Verify failed: "+(d||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(a){function q(){return[0,0]}function r(h){return[h[0],h[1]]}function k(h,u){return[h,u]}function l(h,u=[0,0]){const v=
Math.min(2,h.length);for(let y=0;y<v;++y)u[y]=h[y];return u}function m(h,u){return new Float64Array(h,u,2)}function b(){return[0,0]}function c(){return[1,1]}function d(){return[1,0]}function f(){return[0,1]}const p=[0,0],g=[1,1],x=[1,0],n=[0,1],e=Object.freeze(Object.defineProperty({__proto__:null,ONES:g,UNIT_X:x,UNIT_Y:n,ZEROS:p,clone:r,create:q,createView:m,fromArray:l,fromValues:k,ones:c,unitX:d,unitY:f,zeros:b},Symbol.toStringTag,{value:"Module"}));a.ONES=g;a.UNIT_X=x;a.UNIT_Y=n;a.ZEROS=p;a.clone=
r;a.create=q;a.createView=m;a.fromArray=l;a.fromValues=k;a.ones=c;a.unitX=d;a.unitY=f;a.vec2f64=e;a.zeros=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(a,q,r){function k(N){switch(N.type){case "uint":return fa;case "uvec2":return a.Vec2;case "uvec3":return a.Vec3;case "uvec4":return a.Vec4;default:throw Error("Found unexpected type");
}}function l(N){switch(N.type){case "float":return a.UInt;case "vec2":return a.UVec2;case "vec3":return a.UVec3;case "vec4":return a.UVec4;default:throw Error("Found unexpected type");}}function m(N){switch(N.type){case "int":return fa;case "ivec2":return a.Vec2;case "ivec3":return a.Vec3;case "ivec4":return a.Vec4;default:throw Error("Found unexpected type");}}function b(N){switch(N.type){case "float":return qa;case "vec2":return a.IVec2;case "vec3":return a.IVec3;case "vec4":return a.IVec4;default:throw Error("Found unexpected type");
}}function c(N){switch(N.type){case "bool":case "float":case "int":case "uint":return ka;case "bvec2":case "vec2":case "ivec2":case "uvec2":return a.BVec2;case "bvec3":case "vec3":case "ivec3":case "uvec3":return a.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return a.BVec4;default:throw Error("Unable to handle type");}}function d(N){switch(N.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;
case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return N.size*d(N.elementType)}}function f(N){const aa=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const ja of aa)if(ja.includes(N))return ja.map(oa=>ha[oa]);throw Error("Unable to find type family");}function p(N){return new Proxy(N,{get(aa,ja){if("constructor"===ja)return new Proxy(aa.constructor,
{construct(oa,ua,za){oa=new oa(...ua);return p(oa)}});if(ja in aa)return aa[ja];if("string"===typeof ja)return aa=f(N.type),e(N,ja,aa[ja.length-1])}})}function g(N){return new Proxy(N,{construct(aa,ja,oa){aa=new aa(...ja);return p(aa)}})}function x(N){return new Proxy(N,{get(aa,ja){if(ja in aa)return aa[ja];if("string"===typeof ja&&(aa=parseInt(ja,10),!isNaN(aa)))return e(N,`[${aa}]`,N.elementType.constructor)}})}function n(N,aa){return"number"===typeof N?new aa(N):N}function e(N,aa,ja){N=new ja(new r.ShaderPropertyAccessNode(aa,
N,ja));N.isImplicit=!0;return N}function h(N,aa,ja,oa=null){if(oa){const ua=new oa;N=new oa(new r.ShaderFunctionNode(N,[aa,ja],!0,!1,ua));N.isImplicit=!0;return N}if("float"===aa.type||"int"===aa.type||("mat2"===aa.type||"mat3"===aa.type||"mat4"===aa.type)&&"float"!==ja.type)return N=new ja.constructor(new r.ShaderFunctionNode(N,[aa,ja],!0,!1,ja.constructor)),N.isImplicit=!0,N;N=new aa.constructor(new r.ShaderFunctionNode(N,[aa,ja],!0,!1,aa.constructor));N.isImplicit=!0;return N}function u(N,aa,ja=
aa.constructor){N=new ja(new r.ShaderFunctionNode(N,[aa],!1,!1,ja));N.isImplicit=!0;return N}function v(N,aa,ja,oa=aa.constructor){N=new oa(new r.ShaderFunctionNode(N,[aa,ja],!1,!1,oa));N.isImplicit=!0;return N}function y(N,aa,ja,oa,ua=aa.constructor){N=new ua(new r.ShaderFunctionNode(N,[aa,ja,oa],!1,!1,ua));N.isImplicit=!0;return N}function B(N){return D(N,la(-1))}function t(N,aa,ja,oa){return new aa(new r.ShaderBlockNode(N,aa,ja,oa))}function w(N,aa,ja=0,oa=N.size){ja=(new qa(ja)).setMutable().setDebugName("FindIndexIterator");
N=N.get(ja);aa=aa(N).setDebugName("FindIndexPredicate");return t({iter:ja},qa,aa,({out:ua,iter:za,subgraph:Aa})=>`\n${ua} = -1;\n\nfor (; ${za} < ${oa}; ${za}++) {\n\n${Aa.body}\n\n  if (${Aa.varName}) {\n    ${ua} = ${za};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}function C(N,aa,ja=0,oa=N.size){return t({array:N},qa,null,({out:ua,array:za})=>`\n${ua} = -1;\nfor (int i = ${ja}; i < ${oa}; i++) {\n  bool condition;\n  ${aa({array:za,i:"i",out:"condition"})}\n  if (condition) {\n    ${ua} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}
function z(N,aa,ja){aa="function"===typeof aa?aa():aa;ja="function"===typeof ja?ja():ja;N=new aa.constructor(new r.ShaderConditionNode(N,aa,ja));N.isImplicit=!0;return N}function D(N,aa){return h("*",N,aa)}function H(N,aa){return h("/",N,aa)}function G(N,aa){return h("+",N,aa)}function A(N,aa){return h("-",N,aa)}function F(...N){return 1>=N.length?N[0]:N.slice(1).reduce((aa,ja)=>J(aa,ja),N[0])}function J(N,aa){return h("||",N,aa,ka)}function K(...N){return 1>=N.length?N[0]:N.slice(1).reduce((aa,ja)=>
h("\x26\x26",aa,ja,ka),N[0])}function P(N){return u("all",N,ka)}function E(N){return u("any",N,ka)}function M(N){return u("cos",N)}function T(N){return u("sin",N)}var ba,ea,X,ca,ma,S,Y,ia,na,ta,va,xa,wa,Ca;class L extends Error{}a.FixedArray=ba=class extends r.ShaderPrimitiveNode{constructor(N,aa){super();this.elementType=N;this.size=aa;this.children=[];this.type="array"}clone(){const N=new ba(this.elementType,this.size);super.cloneInto(N);return N}get(N){return"number"===typeof N?(N=new qa(N),N.isImplicit=
!0,e(this,N,this.elementType.constructor)):e(this,N,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(N,aa,ja){return w(this,N,aa,ja)}glslFindIndex(N,aa,ja){return C(this,N,aa,ja)}static ofType(N,aa){return new Proxy(ba,{construct(ja,oa){return new ba(new N,aa)}})}};a.FixedArray.type="array";a.FixedArray=ba=q.__decorate([function(N){return new Proxy(N,{construct(aa,ja,oa){aa=new aa(...ja);return x(aa)}})}],a.FixedArray);class R extends r.ShaderPrimitiveNode{constructor(){super(...arguments);
this.type="sampler2D";this.children=[]}clone(){const N=new R;N.children=this.children.map(r.cloneShaderNode);super.cloneInto(N);return N}}R.type="sampler2D";class fa extends r.ShaderPrimitiveNode{constructor(N){super();this.type="float";this.children=[N]}clone(){const N=new fa(r.cloneShaderNode(this.children[0]));super.cloneInto(N);return N}multiply(N){return"number"===typeof N?D(this,n(N,fa)):D(this,N)}divide(N){return"number"===typeof N?H(this,n(N,fa)):H(this,N)}add(N){return"number"===typeof N?
G(this,n(N,fa)):G(this,N)}subtract(N){return"number"===typeof N?A(this,n(N,fa)):A(this,N)}}fa.type="float";a.Vec2=ea=class extends r.ShaderPrimitiveNode{constructor(N,aa){super();this.type="vec2";this.children=[N,aa].filter(ja=>null!=ja)}clone(){const N=new ea(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(N);return N}get 0(){return e(this,"[0]",fa)}get 1(){return e(this,"[1]",fa)}get 2(){throw new L;}get 3(){throw new L;}multiply(N){return D(this,"number"===
typeof N?n(N,fa):N)}divide(N){return H(this,"number"===typeof N?n(N,fa):N)}add(N){return G(this,"number"===typeof N?n(N,fa):N)}subtract(N){return A(this,"number"===typeof N?n(N,fa):N)}};a.Vec2.type="vec2";a.Vec2=ea=q.__decorate([g],a.Vec2);a.Vec3=X=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja){super();this.type="vec3";this.children=[N,aa,ja].filter(oa=>null!=oa)}get 0(){return e(this,"[0]",fa)}get 1(){return e(this,"[1]",fa)}get 2(){return e(this,"[2]",fa)}get 3(){throw new L;}clone(){const N=
new X(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(N);return N}multiply(N){return D(this,"number"===typeof N?n(N,fa):N)}divide(N){return H(this,"number"===typeof N?n(N,fa):N)}add(N){return G(this,"number"===typeof N?n(N,fa):N)}subtract(N){return A(this,"number"===typeof N?n(N,fa):N)}};a.Vec3.type="vec3";a.Vec3=X=q.__decorate([g],a.Vec3);a.Vec4=ca=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja,oa){super();this.type=
"vec4";this.children=[N,aa,ja,oa].filter(ua=>null!=ua)}clone(){const N=new ca(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(N);return N}get 0(){return e(this,"[0]",fa)}get 1(){return e(this,"[1]",fa)}get 2(){return e(this,"[2]",fa)}get 3(){return e(this,"[3]",fa)}multiply(N){return D(this,"number"===typeof N?n(N,fa):N)}divide(N){return H(this,"number"===typeof N?n(N,fa):N)}add(N){return G(this,
"number"===typeof N?n(N,fa):N)}subtract(N){return A(this,"number"===typeof N?n(N,fa):N)}};a.Vec4.type="vec4";a.Vec4=ca=q.__decorate([g],a.Vec4);a.UInt=ma=class extends r.ShaderPrimitiveNode{constructor(N){super();this.type="uint";this.children=[N]}clone(){const N=new ma(r.cloneShaderNode(this.children[0]));super.cloneInto(N);return N}};a.UInt.type="uint";a.UInt=ma=q.__decorate([g],a.UInt);a.UVec2=S=class extends r.ShaderPrimitiveNode{constructor(N,aa){super();this.type="uvec2";this.children=[N,aa].filter(ja=>
null!=ja)}clone(){const N=new S(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(N);return N}};a.UVec2.type="uvec2";a.UVec2=S=q.__decorate([g],a.UVec2);a.UVec3=Y=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja){super();this.type="uvec3";this.children=[N,aa,ja].filter(oa=>null!=oa)}clone(){const N=new Y(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(N);return N}};a.UVec3.type=
"uvec3";a.UVec3=Y=q.__decorate([g],a.UVec3);a.UVec4=ia=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja,oa){super();this.type="uvec4";this.children=[N,aa,ja,oa].filter(ua=>null!=ua)}clone(){const N=new ia(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(N);return N}};a.UVec4.type="uvec4";a.UVec4=ia=q.__decorate([g],a.UVec4);class ka extends r.ShaderPrimitiveNode{constructor(N){super();
this.type="bool";this.children=[N]}and(N){return K(this,N)}or(N){return F(this,N)}clone(){const N=new ka(r.cloneShaderNode(this.children[0]));super.cloneInto(N);return N}}ka.type="bool";a.BVec2=na=class extends r.ShaderPrimitiveNode{constructor(N,aa){super();this.type="bvec2";this.children=[N,aa].filter(ja=>null!=ja)}all(){return P(this)}any(){return E(this)}clone(){const N=new na(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(N);return N}};a.BVec2.type="bvec2";
a.BVec2=na=q.__decorate([g],a.BVec2);a.BVec3=ta=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja){super();this.type="bvec3";this.children=[N,aa,ja].filter(oa=>null!=oa)}all(){return P(this)}any(){return E(this)}clone(){const N=new ta(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(N);return N}};a.BVec3.type="bvec3";a.BVec3=ta=q.__decorate([g],a.BVec3);a.BVec4=va=class extends r.ShaderPrimitiveNode{constructor(N,aa,
ja,oa){super();this.type="bvec4";this.children=[N,aa,ja,oa].filter(ua=>null!=ua)}all(){return P(this)}any(){return E(this)}clone(){const N=new va(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(N);return N}};a.BVec4.type="bvec4";a.BVec4=va=q.__decorate([g],a.BVec4);class qa extends r.ShaderPrimitiveNode{constructor(N){super();this.type="int";this.children=[N]}multiply(N){return D(this,
n(N,qa))}add(N){return G(this,n(N,qa))}subtract(N){return A(this,n(N,qa))}divide(N){return H(this,n(N,qa))}clone(){const N=new qa(r.cloneShaderNode(this.children[0]));super.cloneInto(N);return N}}qa.type="int";a.IVec2=xa=class extends r.ShaderPrimitiveNode{constructor(N,aa){super();this.type="ivec2";this.children=[N,aa].filter(ja=>null!=ja)}clone(){const N=new xa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(N);return N}};a.IVec2.type="ivec2";a.IVec2=xa=
q.__decorate([g],a.IVec2);a.IVec3=wa=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja){super();this.type="ivec3";this.children=[N,aa,ja].filter(oa=>null!=oa)}clone(){const N=new wa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(N);return N}};a.IVec3.type="ivec3";a.IVec3=wa=q.__decorate([g],a.IVec3);a.IVec4=Ca=class extends r.ShaderPrimitiveNode{constructor(N,aa,ja,oa){super();this.type="ivec4";this.children=[N,aa,
ja,oa].filter(ua=>null!=ua)}clone(){const N=new Ca(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(N);return N}};a.IVec4.type="ivec4";a.IVec4=Ca=q.__decorate([g],a.IVec4);class Q extends r.ShaderPrimitiveNode{constructor(N,aa,ja,oa){super();this.type="mat2";this.children=[N,aa,ja,oa]}clone(){const N=new Q(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),
r.cloneShaderNode(this.children[3]));super.cloneInto(N);return N}}Q.type="mat2";class V extends r.ShaderPrimitiveNode{static identity(){return new V(1,0,0,0,1,0,0,0,1)}static fromRotation(N){const aa=T(N);N=M(N);return new V(N,aa,0,B(aa),N,0,0,0,1)}constructor(N,aa,ja,oa,ua,za,Aa,Ga,Da){super();this.type="mat3";this.children=[N,aa,ja,oa,ua,za,Aa,Ga,Da]}add(N){return G(this,N)}multiply(N){return D(this,N)}clone(){const N=new V(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),
r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]),r.cloneShaderNode(this.children[4]),r.cloneShaderNode(this.children[5]),r.cloneShaderNode(this.children[6]),r.cloneShaderNode(this.children[7]),r.cloneShaderNode(this.children[8]));super.cloneInto(N);return N}}V.type="mat3";class W extends r.ShaderPrimitiveNode{static identity(){return new W(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(N,aa,ja,oa,ua,za,Aa,Ga,Da,Ha,Fa,Ea,Ka,Sa,Xa,Ra){super();this.type="mat4";this.children=[N,aa,
ja,oa,ua,za,Aa,Ga,Da,Ha,Fa,Ea,Ka,Sa,Xa,Ra]}static fromColumns(N,aa,ja,oa){return new W(N.x,N.y,N.z,N.w,aa.x,aa.y,aa.z,aa.w,ja.x,ja.y,ja.z,ja.w,oa.x,oa.y,oa.z,oa.w)}multiply(N){return D(this,N)}clone(){const N=new W(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]),r.cloneShaderNode(this.children[4]),r.cloneShaderNode(this.children[5]),r.cloneShaderNode(this.children[6]),r.cloneShaderNode(this.children[7]),
r.cloneShaderNode(this.children[8]),r.cloneShaderNode(this.children[9]),r.cloneShaderNode(this.children[10]),r.cloneShaderNode(this.children[11]),r.cloneShaderNode(this.children[12]),r.cloneShaderNode(this.children[13]),r.cloneShaderNode(this.children[14]),r.cloneShaderNode(this.children[15]));super.cloneInto(N);return N}}W.type="mat4";const ha={float:fa,vec2:a.Vec2,vec3:a.Vec3,vec4:a.Vec4,int:qa,ivec2:a.IVec2,ivec3:a.IVec3,ivec4:a.IVec4,uint:a.UInt,uvec2:a.UVec2,uvec3:a.UVec3,uvec4:a.UVec4,bool:ka,
bvec2:a.BVec2,bvec3:a.BVec3,bvec4:a.BVec4},la=(...N)=>new fa(...N);a.Bool=ka;a.Float=fa;a.Int=qa;a.Mat2=Q;a.Mat3=V;a.Mat4=W;a.Sampler2D=R;a._or=J;a.abs=function(N){return u("abs",N)};a.acos=function(N){return u("acos",N)};a.acosh=function(N){return u("acosh",N)};a.add=G;a.all=P;a.and=K;a.any=E;a.asin=function(N){return u("asin",N)};a.asinh=function(N){return u("asinh",N)};a.atan=function(N,aa){return null==aa?u("atan",N):v("atan",N,aa,N.constructor)};a.atanh=function(N){return u("atanh",N)};a.bitAnd=
function(N,aa){return h("\x26",N,aa)};a.bitOr=function(N,aa){return h("|",N,aa)};a.bitRShift=function(N,aa){return h("\x3e\x3e",N,aa)};a.bitShift=function(N,aa){return h("\x3c\x3c",N,aa)};a.bitXor=function(N,aa){return h("^",N,aa)};a.block=t;a.ceil=function(N){return u("ceil",N)};a.clamp=function(N,aa,ja){return y("clamp",N,aa,ja,N.constructor)};a.cond=function(...N){var aa=N.map(([oa,ua])=>"function"===typeof ua?[oa,ua()]:[oa,ua]);N=aa[0][1].constructor;const ja=aa.findIndex(oa=>!0===oa[0]);if(-1===
ja)throw Error("A cond must have a fallthrough case with `true`/; ");aa=aa.slice(0,ja).reduceRight((oa,ua)=>z(ua[0],ua[1],oa),aa[ja][1]);N=new N(aa);N.isImplicit=!0;return N};a.cos=M;a.cosh=function(N){return u("cosh",N)};a.cross=function(N,aa){return v("cross",N,aa,N.constructor)};a.dFdx=function(N){return u("dFdX",N)};a.dFdy=function(N){return u("dFdY",N)};a.definePropertyAccess=e;a.degrees=function(N){return u("degrees",N)};a.determinant=function(N){return u("determinant",N,fa)};a.distance=function(N,
aa){return v("distance",N,aa,fa)};a.divide=H;a.dot=function(N,aa){return v("dot",N,aa,fa)};a.equal=function(N,aa){return h("\x3d\x3d",N,aa,ka)};a.equalComponent=function(N,aa){return v("equal",N,aa,c(N))};a.exp=function(N){return u("exp",N)};a.exp2=function(N){return u("exp2",N)};a.faceforward=function(N,aa,ja){return y("faceforward",N,aa,ja)};a.findIndex=w;a.float=la;a.floatBitsToInt=function(N){return u("floatBitsToInt",N,b(N))};a.floatBitsToUint=function(N){return u("floatBitsToUint",N,l(N))};
a.floor=function(N){return u("floor",N)};a.fract=function(N){return u("fract",N)};a.fwidth=function(N){return u("fwidth",N)};a.getTypeElementLengthForType=d;a.glslFindIndex=C;a.greaterThan=function(N,aa){return h("\x3e",N,aa,ka)};a.greaterThanComponent=function(N,aa){return v("greaterThan",N,aa,c(N))};a.greaterThanEqual=function(N,aa){return h("\x3e\x3d",N,aa,ka)};a.greaterThanEqualComponent=function(N,aa){return v("greaterThanEqual",N,aa,c(N))};a.ifElse=z;a.int=(...N)=>new qa(...N);a.intBitsToFloat=
function(N){return u("intBitsToFloat",N,m(N))};a.inverse=function(N){return u("inverse",N,fa)};a.inversesqrt=function(N){return u("inversesqrt",N)};a.isinf=function(N){return u("isinf",N,c(N))};a.isnan=function(N){return u("isnan",N,c(N))};a.length=function(N){return u("length",N,fa)};a.lessThan=function(N,aa){return h("\x3c",N,aa,ka)};a.lessThanComponent=function(N,aa){return v("lessThan",N,aa,c(N))};a.lessThanEqual=function(N,aa){return h("\x3c\x3d",N,aa,ka)};a.lessThanEqualComponent=function(N,
aa){return v("lessThanEqual",N,aa,c(N))};a.log=function(N){return u("log",N)};a.log2=function(N){return u("log2",N)};a.mat2=(...N)=>new Q(...N);a.mat3=(...N)=>new V(...N);a.mat4=(...N)=>new W(...N);a.matrixCompMult=function(N,aa){return v("matrixCompMult",N,aa)};a.max=function(N,aa){return v("max",N,aa)};a.min=function(N,aa){return v("min",N,aa)};a.mix=function(N,aa,ja){return y("mix",N,aa,ja)};a.mod=function(N,aa){return v("mod",N,aa)};a.modf=function(N,aa){throw Error("modf not implemented");};
a.multiply=D;a.namedScope=function(N,aa){N="function"===typeof N?N():N;aa=new N.constructor((new r.ShaderScopeNode(N)).setDebugName(aa));aa.isImplicit=!0;return aa};a.negate=B;a.normalize=function(N){return u("normalize",N)};a.not=function(N){return"bool"===N.type?u("!",N):u("not",N)};a.notEqual=function(N,aa){return h("!\x3d",N,aa,ka)};a.notEqualComponent=function(N,aa){return v("notEqual",N,aa,c(N))};a.or=F;a.outerProduct=function(N,aa){throw Error("Impl type?");};a.packHalf2x16=function(N){return u("packHalf2x16",
N,a.UInt)};a.packSnorm2x16=function(N){return u("packSnorm2x16",N,a.UInt)};a.packUnorm2x16=function(N){return u("packUnorm2x16",N,a.UInt)};a.pow=function(N,aa){return v("pow",N,aa)};a.radians=function(N){return u("radians",N)};a.reflect=function(N,aa){return v("reflect",N,aa)};a.refract=function(N,aa,ja){return y("refract",N,aa,ja)};a.round=function(N){return u("round",N)};a.roundEven=function(N){return u("roundEven",N)};a.sign=function(N){return u("sign",N)};a.sin=T;a.sinh=function(N){return u("sinh",
N)};a.smoothstep=function(N,aa,ja){return y("smoothstep",N,aa,ja)};a.sqrt=function(N){return u("sqrt",N)};a.step=function(N,aa){return v("step",N,aa,aa.constructor)};a.subtract=A;a.tan=function(N){return u("tan",N)};a.tanh=function(N){return u("tanh",N)};a.texelFetch=function(N,aa,ja){throw Error("Impl type");};a.texelFetchOffset=function(N,aa,ja,oa){throw Error("Impl type");};a.texture=function(N,aa,ja){throw Error("Impl type");};a.texture2D=function(N,aa){return v("texture2D",N,aa,a.Vec4)};a.textureGrad=
function(N,aa,ja,oa){throw Error("Impl type");};a.textureGradOffset=function(N,aa,ja,oa,ua){throw Error("Impl type");};a.textureLod=function(N,aa,ja){throw Error("Impl type");};a.textureLodOffset=function(N,aa,ja,oa){throw Error("Impl type");};a.textureOffset=function(N,aa,ja,oa){throw Error("Impl type");};a.textureProj=function(N,aa,ja){throw Error("Impl type");};a.textureProjGrad=function(N,aa,ja,oa){throw Error("Impl type");};a.textureProjGradOffset=function(N,aa,ja,oa,ua){throw Error("Impl type");
};a.textureProjLod=function(N,aa,ja){throw Error("Impl type");};a.textureProjLodOffset=function(N,aa,ja,oa){throw Error("Impl type");};a.textureProjOffset=function(N,aa,ja,oa){throw Error("Impl type");};a.textureSize=function(N,aa){throw Error("Impl type");};a.transformFloatToInt=b;a.transformFloatToUInt=l;a.transformIntToFloat=m;a.transformTypeToBooleanType=c;a.transformUIntToFloat=k;a.transpose=function(N){return u("transpose",N)};a.trunc=function(N){return u("trunc",N)};a.uintBitsToFloat=function(N){return u("uintBitsToFloat",
N,k(N))};a.unpackHalf2x16=function(N){return u("unpackHalf2x16",N,a.Vec2)};a.unpackSnorm2x16=function(N){return u("unpackSnorm2x16",N,a.Vec2)};a.unpackUnorm2x16=function(N){return u("unpackUnorm2x16",N,a.Vec2)};a.vec2=(...N)=>new a.Vec2(...N);a.vec3=(...N)=>new a.Vec3(...N);a.vec4=(...N)=>new a.Vec4(...N);a.when=function(N,aa){N=new aa.constructor(new r.ShaderConditionNode(N,aa,null));N.isImplicit=!0;return N};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],
function(a){function q(g){return g.split(" ").map((x,n)=>0<n?x.charAt(0).toUpperCase()+x.slice(1):x).join("")}function r(g){return"object"===typeof g?g.clone():g}class k{constructor(){this.uid=k.NodeCount++;this._debugName=null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(g){this._debugName=g=q(g);this.isImplicit&&this.children[0]instanceof k&&this.children[0].setDebugName(g);return this}get debugInfo(){return{name:this._debugName??
""}}cloneInto(g){g._debugName=this._debugName;g._isMutable=this._isMutable;g.isImplicit=this.isImplicit;g.uid=this.uid}}k.NodeCount=0;class l extends k{constructor(){super(...arguments);this.shaderType="primitive-node"}}class m extends k{constructor(g){super();this.child=g;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const g=new m(r(this.child));this.cloneInto(g);return g}}class b extends k{constructor(g){super();this.text=g;this.shaderType="text-node"}get children(){return[]}clone(){const g=
new b(this.text);this.cloneInto(g);return g}}class c extends k{constructor(g,x,n){super();this.property=g;this.target=x;this.returnType=n;this.shaderType="property-access-node"}get children(){const g=[this.target];"string"!==typeof this.property&&g.push(this.property);return g}clone(){const g=new c(this.property,r(this.target),this.returnType);this.cloneInto(g);return g}}class d extends k{constructor(g,x,n){super();this.condition=g;this.ifTrue=x;this.ifFalse=n;this.shaderType="condition-node"}get children(){return[this.condition,
this.ifTrue,this.ifFalse]}clone(){var g=r(this.ifTrue);const x=this.ifFalse?r(this.ifFalse):null;g=new d(this.condition,g,x);this.cloneInto(g);return g}}class f extends k{constructor(g,x,n,e){super();this.captureList=g;this.returnType=x;this.generator=e;this.shaderType="block-node";n&&(this.subgraph=new m(n))}get children(){return Object.keys(this.captureList).map(g=>this.captureList[g]).concat(this.subgraph??[])}clone(){var g={};for(const x in this.captureList)g[x]=r(this.captureList[x]);g=new f(g,
this.returnType,this.subgraph?r(this.subgraph.child):this.subgraph,this.generator);this.cloneInto(g);return g}}class p extends k{constructor(g,x,n,e,h,u=!1){super();this.token=g;this._children=x;this.isInfix=n;this.isPropertyAccess=e;this.returnType=h;this.isTernary=u;this.shaderType="function-node"}get children(){return this._children}clone(){const g=new p(this.token,this._children.map(r),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);this.cloneInto(g);return g}}a.ShaderBlockNode=
f;a.ShaderConditionNode=d;a.ShaderFunctionNode=p;a.ShaderNode=k;a.ShaderPrimitiveNode=l;a.ShaderPropertyAccessNode=c;a.ShaderScopeNode=m;a.ShaderTextNode=b;a.cloneShaderNode=r;a.setReachableUids=function(g,x){const n=[];for(n.push(x);n.length;)if(x=n.pop(),"object"===typeof x&&!g.has(x.uid)){g.add(x.uid);for(const e of x.children)n.push(e)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],
function(a){function q(k,l,m){l=l.split("\n");for(const b of l)if(b.trim().length){l="";const c=m??"000";null!=m&&(l+=`/*id:${c}*/   `);k.body+=l.padEnd(14);k.body+=" ".repeat(k.indent)+b+"\n"}}class r{write(k){for(const l of k.rootOutputNodes())k.shouldPruneOutputNode(l)||(l.variableName=this._write(k,l.node));return k}_createVarName(k,l){let m="";"boolean"!==typeof l&&"number"!==typeof l&&l.debugInfo.name&&(m=`${l.debugInfo.name}_`);return`${m}v${k.varCount++}`}_write(k,l,m=!1){if("number"===typeof l||
"boolean"===typeof l)return l.toString();let b=k.getEmit(l);if(b)return b;switch(l.shaderType){case "scope-node":b=this._writeScopeNode(k,l);break;case "primitive-node":b=this._writePrimitveNode(k,l,m);break;case "function-node":b=this._writeFunctionNode(k,l);break;case "property-access-node":b=this._writePropertyAccessNode(k,l);break;case "text-node":b=l.text;break;case "block-node":b=this._writeBlockNode(k,l);break;case "condition-node":b=this._writeConditionNode(k,l)}k.setEmit(l,b);return b}_writeScopeNode(k,
l){var m=new l.child.constructor;m.setDebugName(l.debugInfo.name);m=this._write(k,m,!0);q(k,`{ /*ScopeStart: ${l.uid} ${l.debugInfo.name}*/`);k.indent+=2;const b=this._write(k,l.child);q(k,`${m} = ${b};`);k.indent-=2;q(k,`} /*ScopeEnd: ${l.uid} ${l.debugInfo.name}*/`);return m}_writeConditionNode(k,l){var m=new l.ifTrue.constructor;m=this._write(k,m,!0);var b=this._write(k,l.condition);q(k,`if (${b}) {`);k.indent+=2;b=k.createSubgraphContext();const c=this._write(b,l.ifTrue);k.body+=b.body;c&&q(k,
`${m} = ${c};`);k.indent-=2;q(k,"}");l.ifFalse&&(q(k,"else {"),k.indent+=2,b=k.createSubgraphContext(),l=this._write(b,l.ifFalse),k.body+=b.body,l&&q(k,`${m} = ${l};`),k.indent-=2,q(k,"}"));return m}_writeBlockNode(k,l){const {captureList:m,generator:b,returnType:c}=l;var d={};for(var f in m)if(m[f]){var p=this._write(k,m[f]);d[f]=p}f=new c;f=this._write(k,f,!0);d.out=f;l.subgraph&&(p=k.createSubgraphContext(),l=this._write(p,l.subgraph.child),d.subgraph={varName:l,body:p.body});d=b(d);q(k,"{\n");
k.indent+=2;q(k,d);k.indent-=2;q(k,"}\n");return f}_writePropertyAccessNode(k,l){const m=this._write(k,l.target);return"string"===typeof l.property&&l.property.includes("[")?`${m}${l.property}`:"string"!==typeof l.property?(k=this._write(k,l.property),`${m}[${k}]`):`${m}.${l.property}`}_writeFunctionNode(k,l){const m=l.returnType.type;if(l.isInfix){const [d,f]=l.children.map(p=>this._write(k,p));var b=this._createVarName(k,l);q(k,`${m.padEnd(5)} ${b} = ${d} ${l.token} ${f};`,l.uid);return b}b=l.children.map(d=>
this._write(k,d)).join(", ");const c=this._createVarName(k,l);q(k,`${m.padEnd(5)} ${c} = ${l.token}(${b});`,l.uid);return c}_writePrimitveNode(k,l,m=!1){var b=k.getInput(l);if(b)return b.isUsed=!0,b.variableName;b=1===l.children.length&&l.children[0]?.type===l.type;if(l.isImplicit||b)return this._write(k,l.children[0]);b=this._createVarName(k,l);if(m)return q(k,`${l.type.padEnd(5)} ${b};`,l.uid),b;if((m=!l.debugInfo.name&&!l.isMutable)&&"float"===l.type&&"number"===typeof l.children[0])return Number.isInteger(l.children[0])?
l.children[0].toFixed(1):l.children[0].toString();if(m&&"int"===l.type&&"number"===typeof l.children[0]&&Number.isInteger(l.children[0]))return l.children[0].toString();const c=l.children.map(d=>this._write(k,d)).join(", ");if("array"===l.type)return q(k,`${l.type.padEnd(5)} ${b} = [${c}];`,l.uid),b;if(m)return`${l.type}(${c})`;q(k,`${l.type.padEnd(5)} ${b} = ${l.type}(${c});`,l.uid);return b}}a.GlslShaderWriter=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports",
"./ShaderGraphNode"],function(a,q){class r{constructor(m,b,c){this.variableName=m;this.variableInputType=b;this.node=c;this.type="shader-input";this.isUsed=!1}clone(){return new r(this.variableName,this.variableInputType,q.cloneShaderNode(this.node))}}class k{constructor(m,b,c){this.outVariableName=m;this.outVariableType=b;this.node=c;this.type="shader-output"}clone(){const m=new k(this.outVariableName,this.outVariableType,q.cloneShaderNode(this.node));m.variableName=this.variableName;return m}}class l{static createVertex(m,
b,c,d,f,p){const g=[];for(const x in m){const n=m[x],e=c.get(x);e?g.push(new r(e,"builtin",n)):g.push(new r("a_"+x,"attribute",n))}for(const x of d)g.push(new r(x.uniformName,"uniform",x.uniformHydrated));m=[];for(const x in b)c=b[x],"glPosition"===x?m.push(new k("gl_Position","builtin",c)):"glPointSize"===x?m.push(new k("gl_PointSize","builtin",c)):m.push(new k("v_"+x,"varying",c));return new l(g,m,f,p)}static createFragment(m,b,c,d,f,p){const g=[];f=Array.from(f.rootOutputNodes());for(var x in m){const e=
m[x];var n=c.get(x);n?g.push(new r(n,"builtin",e)):(n=f.find(h=>h.node===e))&&g.push(new r(n.outVariableName,n.outVariableType,e))}for(const e of d)g.push(new r(e.uniformName,"uniform",e.uniformHydrated));m=[];for(const e in b)if(d=b[e],x=c.get(e),"discard"===e)m.push(new k(null,"discard",d));else if(x)m.push(new k(x,"builtin",d));else throw Error(`Member ${e} in shader fragment output shoule be tagged as builtin`);return new l(g,m,p)}constructor(m,b,c,d){this.type="shader-graph-context";this.indent=
0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;this._nodeEmitMap=new Map;for(const f of m)this._inputShaderTypesByNodeUid.set(f.node.uid,f);this._outputShaderTypes=b;this._transformFeedbackBindings=c;this._transformFeedbackNames=new Set(c.map(f=>"v_"+f.propertyKey));this._usedInFragmentShader=d}shouldPruneOutputNode(m){return!this._usedInFragmentShader||"builtin"===m.outVariableType||this._transformFeedbackNames.has(m.outVariableName)?!1:!this._usedInFragmentShader.has(m.node.uid)}setEmit(m,
b){this._nodeEmitMap.set(m.uid,b)}getEmit(m){return this._nodeEmitMap.get(m.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(m){return this._inputShaderTypesByNodeUid.get(m.uid)}*rootOutputNodes(){for(const m of this._outputShaderTypes)yield m}*nodes(){const m=[];for(var b of this._outputShaderTypes.values())m.push(b.node);for(;m.length;)b=m.pop(),"number"!==typeof b&&"boolean"!==typeof b&&m.push(...b.children.filter(Boolean)),yield b}*nodesOfTypeOrFunction(){for(const m of this.nodes())"number"!==
typeof m&&"boolean"!==typeof m&&(yield m)}createSubgraphContext(){const m=this.clone();m.body="";m.indent=this.indent+2;m._nodeEmitMap=new Map(this._nodeEmitMap);return m}clone(){const m=new l([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);m._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;m.indent=this.indent;m.body=this.body;m.varCount=this.varCount;m._nodeEmitMap=this._nodeEmitMap;return m}insertVertexShader(m){m.vertex.code.add("");this._insertInputs(m,
"vertex");m.vertex.code.add("");m.vertex.code.add("// OUTPUTS: ");m.vertex.code.add("// --------------------------------------------------------- ");for(const b of this.rootOutputNodes()){const c="builtin"===b.outVariableType;this.shouldPruneOutputNode(b)||(c?m.vertex.code.add(`// ${b.outVariableType.padEnd(7)} ${b.node.type.padEnd(9)} ${b.outVariableName};`):m.vertex.code.add(`${b.outVariableType.padEnd(10)} ${b.node.type.padEnd(9)} ${b.outVariableName};`))}m.vertex.code.add("");m.vertex.code.add("void main() {");
m.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const b of this.rootOutputNodes())this.shouldPruneOutputNode(b)||m.vertex.code.add("  "+`${b.outVariableName} = ${b.variableName};`);m.vertex.code.add("}")}insertFragmentShader(m){this._insertInputs(m,"fragment");m.fragment.code.add("");m.fragment.code.add("void main() {");m.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const b of this.rootOutputNodes())"discard"===b.outVariableType?(m.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),
m.fragment.code.add("  "+`if (${b.variableName}) {`),m.fragment.code.add("    discard;"),m.fragment.code.add("  }"),m.fragment.code.add("  ")):m.fragment.code.add("  "+`${b.outVariableName} = ${b.variableName};`);m.fragment.code.add("}")}_insertInputs(m,b){m[b].code.add("// INPUTS: ");m[b].code.add("// --------------------------------------------------------- ");for(const c of this.inputs())c.isUsed&&"builtin"!==c.variableInputType&&("array"===c.node.type?m[b].code.add(`${c.variableInputType.padEnd(10)} ${c.node.elementType.type.padEnd(9)} ${c.variableName}[${c.node.size}];`):
m[b].code.add(`${c.variableInputType.padEnd(10)} ${c.node.type.padEnd(9)} ${c.variableName};`))}}a.ShaderGraphContext=l;a.ShaderInput=r;a.ShaderOutput=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/RandomLCG ../../../../../../core/has ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../Utils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x){function n(h,u,v){const y=u.length;y!==v&&(h=new q("Invalid Uniform",`Invalid length, expected ${v} but got ${y}`,{uniformName:h,values:u}),r.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(h))}class e{constructor(h,u,v,y,B,t){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=h;this.fragmentShader=u;this._locations=v;this._locationInfo=y;this._uniformBindings=B;this._transformFeedbackBindings=t}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(h){this._uniforms=h}cleanupTemporaryTextures(){for(const h of this._temporaryTextures)h.dispose();this._temporaryTextures=[]}bind(h){const u=this._uniforms;if(!this._program){var v=new Map;for(const [B,t]of this._locations)v.set(B,t);var y=[];for(const B of this._transformFeedbackBindings??[]){const {index:t,propertyKey:w}=B;y[t]=`v_${w}`}this._program=
new f.Program(h,this.vertexShader,this.fragmentShader,v,new Map,y)}v=this._program;h.useProgram(v);for(const B of this._uniformBindings){const {shaderModulePath:t,uniformName:w,uniformType:C,uniformArrayLength:z}=B;y=k.getDeepValue(t,u);if(null==y){if("sampler2D"===C)continue;throw Error(`Failed to find uniform value for ${t}`);}switch("array"===C?B.uniformArrayElementType:C){case "sampler2D":const {unit:D,texture:H}=y;v.setUniform1i(w,D);"type"in H?h.bindTexture(H,D):(y=x.createTexture(h,H.descriptor,
H.data),h.bindTexture(y,D));break;case "int":if(!z){v.setUniform1i(w,y);break}n(B.uniformName,y,z);v.setUniform1iv(w,y);break;case "float":if(!z){v.setUniform1f(w,y);break}n(B.uniformName,y,z);v.setUniform1fv(w,y);break;case "vec2":if(!z){v.setUniform2f(w,y[0],y[1]);break}n(B.uniformName,y,z);v.setUniform2fv(w,y.flat());break;case "vec3":if(!z){v.setUniform3f(w,y[0],y[1],y[2]);break}n(B.uniformName,y,z);v.setUniform3fv(w,y.flat());break;case "vec4":if(!z){v.setUniform4f(w,y[0],y[1],y[2],y[3]);break}n(B.uniformName,
y,z);v.setUniform4fv(w,y.flat());break;case "mat3":v.setUniformMatrix3fv(w,y.flat());break;case "mat4":v.setUniformMatrix4fv(w,y.flat());break;default:throw Error(`Unable to set uniform for type ${C}`);}}}}a.TypedShaderProgram=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,q,r,k){function l(b,c){switch(c){case b.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case b.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case b.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case b.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case b.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case b.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const m=!!r("enable-feature:webgl-debug");a.checkWebGLError=function(b){if(m){var c=b.getError();c&&(b=l(b,c),c=Error().stack,k.getLogger("esri.views.webgl.checkWebGLError").error(new q("webgl-error","WebGL error occurred",{message:b,stack:c})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),
function(a,q,r,k,l,m,b,c,d,f){function p(e){return null!=e&&"type"in e&&e.type===c.GLObjectType.Texture}function g(e,h){const u=Math.max(e.width,e.height);return u>h?(r.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${h}`),h/=u,e.width=Math.round(e.width*h),e.height=Math.round(e.height*h),!1):!0}function x(e){return e.descriptor.target===b.TextureType.TEXTURE_CUBE_MAP?b.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:b.TextureType.TEXTURE_2D}
class n{constructor(e,h,u=null){this._context=e;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;e.instanceCounter.increment(b.ResourceType.FramebufferObject,this);e=p(h)?h:new f.Texture(this._context,h);this._colorAttachments.set(b.ColorAttachment.COLOR_ATTACHMENT0,e);this._validateTextureDescriptor(e.descriptor);this._validateColorAttachmentPoint(b.ColorAttachment.COLOR_ATTACHMENT0);null!=u&&(p(u)||null!=u&&"pixelFormat"in
u?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=p(u)?u:new f.Texture(this._context,u),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=u=null!=u&&"type"in u&&u.type===c.GLObjectType.RenderBuffer?u:new d.Renderbuffer(this._context,u),this._validateRenderBufferDescriptor(u.descriptor)))}dispose(){if(0!==this._colorAttachments.size||
this._glName){var e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((h,u)=>this.detachColorTexture(u)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(e);this._context.instanceCounter.decrement(b.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||
this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[,h])=>e+h.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){return(e=this._colorAttachments.get(e))&&p(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,
h=b.ColorAttachment.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(h),this._validateTextureDescriptor(e.descriptor),this.detachColorTexture(h)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,h)),this._colorAttachments.set(h,e))}detachColorTexture(e=b.ColorAttachment.COLOR_ATTACHMENT0){const h=this._colorAttachments.get(e);if(h){if(this._initialized){const u=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);
this._framebufferTexture2D(null,e);this._context.bindFramebuffer(u)}this._colorAttachments.delete(e);return h}}setColorTextureTarget(e,h=b.ColorAttachment.COLOR_ATTACHMENT0){const u=this._colorAttachments.get(h);u&&this._framebufferTexture2D(u.glName,h,e)}attachDepthStencil(e){if(e)switch(e.type){case c.GLObjectType.Texture:return this._attachDepthStencilTexture(e);case c.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null!=e){var h=e.descriptor;
h.pixelFormat!==b.PixelFormat.DEPTH_STENCIL&&h.pixelFormat!==b.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");h.dataType!==b.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDescriptor(h);this._disposeDepthStencilAttachments();
this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,b.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=e}}detachDepthStencilTexture(){const e=this._depthStencilTexture;e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,b.DepthStencilAttachment));this._depthStencilTexture=null;return e}_attachDepthStencilBuffer(e){if(null!=e){var h=e.descriptor;this._validateRenderBufferDescriptor(h);
this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const u=this._context.gl;h=this._getGLAttachmentPoint(h);u.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,h,u.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const h=this._context.gl,u=this._getGLAttachmentPoint(e.descriptor);h.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,
u,h.RENDERBUFFER,null)}this._depthStencilBuffer=null;return e}copyToTexture(e,h,u,v,y,B,t){(0>e||0>h||0>y||0>B)&&console.error("Offsets cannot be negative!");(0>=u||0>=v)&&console.error("Copy width and height must be greater than zero!");var w=t.descriptor;t.descriptor.target!==b.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==w?.width||null==w?.height||e+u>this.width||h+v>this.height||y+u>w.width||B+v>w.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");
w=this._context;t=w.bindTexture(t,f.Texture.TEXTURE_UNIT_FOR_UPDATES);w.setActiveTexture(f.Texture.TEXTURE_UNIT_FOR_UPDATES);w.bindFramebuffer(this);w.gl.copyTexSubImage2D(b.TextureType.TEXTURE_2D,0,y,B,e,h,u,v);w.bindTexture(t,f.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,h,u,v,y,B,t){(0>=u||0>=v)&&console.error("Copy width and height must be greater than zero!");t||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(e,h,u,v,y,B,t)}async readPixelsAsync(e,
h,u,v,y,B,t){const {gl:w}=this._context,C=l.BufferObject.createPixelPack(this._context,b.Usage.STREAM_READ,t.byteLength);this._context.bindBuffer(C);this._context.bindFramebuffer(this);w.readPixels(e,h,u,v,y,B,0);this._context.unbindBuffer(b.BufferType.PIXEL_PACK_BUFFER);await C.getSubDataAsync(t);C.dispose()}resize(e,h){if(this.width!==e||this.height!==h){var u={width:e,height:h};g(u,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(v=>v.resize(u.width,u.height));this._depthStencilTexture?.resize(u.width,
u.height);this._initialized&&(g(u,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(u.width,u.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(e=b.FramebufferTarget.FRAMEBUFFER){const h=this._context.gl;if(this._initialized)h.bindFramebuffer(e,this.glName);else{this._glName&&h.deleteFramebuffer(this._glName);var u=h.createFramebuffer();h.bindFramebuffer(e,u);this._colorAttachments.forEach((v,
y)=>this._framebufferTexture2D(v.glName,y,x(v),e));if(this._depthStencilBuffer){const v=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);h.framebufferRenderbuffer(e,v,h.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,h.DEPTH_STENCIL_ATTACHMENT,x(this._depthStencilTexture),e);m.webglDebugEnabled()&&h.checkFramebufferStatus(e)!==h.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");
this._glName=u;this._initialized=!0}}_framebufferTexture2D(e,h=b.ColorAttachment.COLOR_ATTACHMENT0,u=b.TextureType.TEXTURE_2D,v=b.FramebufferTarget.FRAMEBUFFER,y=0){this._context.gl.framebufferTexture2D(v,h,u,e,y)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const h=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,h,e.RENDERBUFFER,
null)}this._depthStencilBuffer=k.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=k.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==b.TextureType.TEXTURE_2D&&e.target!==b.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");g(e,this._context.parameters.maxTextureSize);
this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){g(e,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(e)}_validateBufferDimensions(e){0>=e.width&&(e.width=this.width);0>=e.height&&(e.height=this.height);0<this.width&&0<this.height&&(this.width!==e.width||this.height!==e.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(e){switch(e.internalFormat){case b.RenderbufferFormat.DEPTH_COMPONENT16:case b.RenderbufferFormat.DEPTH_COMPONENT24:case b.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;
case b.RenderbufferFormat.DEPTH24_STENCIL8:case b.RenderbufferFormat.DEPTH32F_STENCIL8:case b.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case b.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===n._MAX_COLOR_ATTACHMENTS){const h=this._context.capabilities.drawBuffers;n._MAX_COLOR_ATTACHMENTS=h?this._context.gl.getParameter(h.MAX_COLOR_ATTACHMENTS):1}e-=b.ColorAttachment.COLOR_ATTACHMENT0;e+1>
n._MAX_COLOR_ATTACHMENTS&&r.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${n._MAX_COLOR_ATTACHMENTS} color attachments`)}}n._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=n;a.ensureAttachmentMaxSize=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),
function(a,q,r,k,l,m){const b=()=>r.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(d,f,p){return new c(d,m.BufferType.ELEMENT_ARRAY_BUFFER,f,p)}static createVertex(d,f,p){return new c(d,m.BufferType.ARRAY_BUFFER,f,p)}static createUniform(d,f,p){return new c(d,m.BufferType.UNIFORM_BUFFER,f,p)}static createPixelPack(d,f=m.Usage.STREAM_READ,p){d=new c(d,m.BufferType.PIXEL_PACK_BUFFER,f);p&&d.setSize(p);return d}static createPixelUnpack(d,f=m.Usage.STREAM_DRAW,p){return new c(d,
m.BufferType.PIXEL_UNPACK_BUFFER,f,p)}static createTransformFeedback(d,f=m.Usage.STATIC_DRAW,p){d=new c(d,m.BufferType.TRANSFORM_FEEDBACK_BUFFER,f);d.setSize(p);return d}constructor(d,f,p,g){this._context=d;this.bufferType=f;this.usage=p;this._glName=null;this._size=-1;this._indexType=void 0;d.instanceCounter.increment(m.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();l.checkWebGLError(this._context.gl);g&&this.setData(g)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===
m.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===m.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===m.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(m.ResourceType.BufferObject,this),this._context=null):this._glName&&b().warn("Leaked WebGL buffer object")}setSize(d,f=
null){0>=d&&b().error("Buffer size needs to be positive!");if(this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&null!=f)switch(this._indexType=f,f){case m.DataType.UNSIGNED_SHORT:d*=2;break;case m.DataType.UNSIGNED_INT:d*=4}this._setBufferData(d)}setData(d){if(d){var f=d.byteLength;this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&(k.isUint16Array(d)&&(f/=2,this._indexType=m.DataType.UNSIGNED_SHORT),k.isUint32Array(d)&&(f/=4,this._indexType=m.DataType.UNSIGNED_INT));this._setBufferData(f,d)}}_setBufferData(d,
f=null){this._size=d;const p=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const g=this._context.gl;null!=f?g.bufferData(this.bufferType,f,this.usage):g.bufferData(this.bufferType,d,this.usage);l.checkWebGLError(g);this._isVAOAware&&this._context.bindVAO(p)}setSubData(d,f,p,g){if(d){(0>f||f*d.BYTES_PER_ELEMENT>=this.usedMemory)&&b().error("offset is out of range!");p>=g&&b().error("end must be bigger than start!");(f+(g-p))*d.BYTES_PER_ELEMENT>
this.usedMemory&&b().error("An attempt to write beyond the end of the buffer!");var x=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:n}=this._context;n.bufferSubData(this.bufferType,f*d.BYTES_PER_ELEMENT,d,p,g-p);l.checkWebGLError(n);this._isVAOAware&&this._context.bindVAO(x)}}getSubData(d,f=0,p,g){if(0>p||0>g)b().error("Problem getting subdata: offset and length were less than zero!");else{var x=q.isArrayLike(d)?d.BYTES_PER_ELEMENT:
1;x*((p??0)+(g??0))>d.byteLength?b().error("Problem getting subdata: offset and length exceeded destination size!"):(f+x*(g??0)>this.usedMemory&&b().warn("Potential problem getting subdata: requested data exceeds buffer size!"),x=this._context.gl,this.bufferType===m.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,m.BufferType.TRANSFORM_FEEDBACK_BUFFER),x.getBufferSubData(m.BufferType.TRANSFORM_FEEDBACK_BUFFER,f,d,p,g),this._context.unbindBuffer(m.BufferType.TRANSFORM_FEEDBACK_BUFFER)):
(this._context.bindBuffer(this,m.BufferType.COPY_READ_BUFFER),x.getBufferSubData(m.BufferType.COPY_READ_BUFFER,f,d,p,g),this._context.unbindBuffer(m.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(d,f=0,p,g){await this._context.clientWaitAsync();this.getSubData(d,f,p,g)}}a.BufferObject=c;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var q=a.GLObjectType||(a.GLObjectType=
{});q[q.Texture=0]="Texture";q[q.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(a,q,r,k){class l{constructor(m,b){this._context=m;this._descriptor=b;this.type=r.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(q.ResourceType.Renderbuffer,this);m=this._context.gl;this.glName=m.createRenderbuffer();this._context.bindRenderbuffer(this);
const {width:c,height:d,internalFormat:f,multisampled:p}=b;p?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,f,c,d):m.renderbufferStorage(m.RENDERBUFFER,f,c,d)}get descriptor(){return this._descriptor}get samples(){const m=this._descriptor.samples,b=this._context.parameters.maxSamples;return m?Math.min(m,b):b}get usedMemory(){return k.estimateMemory(this._descriptor)}resize(m,b){const c=this._descriptor;if(c.width!==m||c.height!==b)c.width=m,c.height=b,m=this._context.gl,this._context.bindRenderbuffer(this),
c.multisampled?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,c.internalFormat,c.width,c.height):m.renderbufferStorage(m.RENDERBUFFER,c.internalFormat,c.width,c.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(q.ResourceType.Renderbuffer,this),this._context=null)}}a.Renderbuffer=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports",
"./Util"],function(a,q){class r{constructor(k,l,m=l){this.internalFormat=k;this.width=l;this.height=m;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=r;a.estimateMemory=function(k){return 0>=k.width||0>=k.height||null==k.internalFormat?0:k.width*k.height*q.getBytesPerElementFormat(k.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],
function(a,q,r,k,l){function m(c){c=c.gl;switch(c.getError()){case c.NO_ERROR:return null;case c.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case c.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case c.INVALID_OPERATION:return"The specified command is not allowed for the current state";case c.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case c.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";
case c.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function b(c){return c[0].stride}a.bindVertexBufferLayout=function(c,d,f,p,g=0){const x=c.gl;c.bindBuffer(f);for(const e of p)if(p=d.get(e.name),void 0===p)console.warn(`There is no location for vertex attribute '${e.name}' defined.`);else{f=g*e.stride;if(4>=e.count)x.vertexAttribPointer(p,e.count,e.type,e.normalized,e.stride,e.offset+f),x.enableVertexAttribArray(p),0<e.divisor&&c.gl.vertexAttribDivisor(p,e.divisor);else if(9===
e.count)for(var n=0;3>n;n++)x.vertexAttribPointer(p+n,3,e.type,e.normalized,e.stride,e.offset+12*n+f),x.enableVertexAttribArray(p+n),0<e.divisor&&c.gl.vertexAttribDivisor(p+n,e.divisor);else if(16===e.count)for(n=0;4>n;n++)x.vertexAttribPointer(p+n,4,e.type,e.normalized,e.stride,e.offset+16*n+f),x.enableVertexAttribArray(p+n),0<e.divisor&&c.gl?.vertexAttribDivisor(p+n,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count);if(r.webglDebugEnabled()){p=m(c);n=l.getDataTypeBytes(e.type);
const h=e.offset;n=Math.round(n/h)!==n/h?`. Offset not a multiple of stride. DataType requires ${n} bytes, but descriptor has an offset of ${h}`:"";p&&console.error(`Unable to bind vertex attribute "${e.name}" with baseInstanceOffset ${f}${n}:`,p,e)}}};a.getBytesPerElementFormat=function(c){switch(c){case k.PixelFormat.ALPHA:case k.PixelFormat.LUMINANCE:case k.PixelFormat.RED:case k.PixelFormat.RED_INTEGER:case k.SizedPixelFormat.R8:case k.SizedPixelFormat.R8I:case k.SizedPixelFormat.R8UI:case k.SizedPixelFormat.R8_SNORM:case k.RenderbufferFormat.STENCIL_INDEX8:return 1;
case k.PixelFormat.LUMINANCE_ALPHA:case k.PixelFormat.RG:case k.PixelFormat.RG_INTEGER:case k.SizedPixelFormat.RGBA4:case k.SizedPixelFormat.R16F:case k.SizedPixelFormat.R16I:case k.SizedPixelFormat.R16UI:case k.SizedPixelFormat.RG8:case k.SizedPixelFormat.RG8I:case k.SizedPixelFormat.RG8UI:case k.SizedPixelFormat.RG8_SNORM:case k.SizedPixelFormat.RGB565:case k.SizedPixelFormat.RGB5_A1:case k.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case k.PixelFormat.DEPTH_COMPONENT:case k.PixelFormat.RGB:case k.PixelFormat.RGB_INTEGER:case k.SizedPixelFormat.RGB8:case k.SizedPixelFormat.RGB8I:case k.SizedPixelFormat.RGB8UI:case k.SizedPixelFormat.RGB8_SNORM:case k.SizedPixelFormat.SRGB8:case k.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case k.PixelFormat.DEPTH_STENCIL:case k.PixelFormat.DEPTH24_STENCIL8:case k.PixelFormat.RGBA:case k.PixelFormat.RGBA_INTEGER:case k.SizedPixelFormat.RGBA8:case k.SizedPixelFormat.R32F:case k.SizedPixelFormat.R11F_G11F_B10F:case k.SizedPixelFormat.RG16F:case k.SizedPixelFormat.R32I:case k.SizedPixelFormat.R32UI:case k.SizedPixelFormat.RG16I:case k.SizedPixelFormat.RG16UI:case k.SizedPixelFormat.RGBA8I:case k.SizedPixelFormat.RGBA8UI:case k.SizedPixelFormat.RGBA8_SNORM:case k.SizedPixelFormat.SRGB8_ALPHA8:case k.SizedPixelFormat.RGB9_E5:case k.SizedPixelFormat.RGB10_A2UI:case k.SizedPixelFormat.RGB10_A2:case k.RenderbufferFormat.DEPTH_STENCIL:case k.RenderbufferFormat.DEPTH_COMPONENT32F:case k.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case k.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case k.SizedPixelFormat.RGB16F:case k.SizedPixelFormat.RGB16I:case k.SizedPixelFormat.RGB16UI:return 6;case k.SizedPixelFormat.RG32F:case k.SizedPixelFormat.RG32I:case k.SizedPixelFormat.RG32UI:case k.SizedPixelFormat.RGBA16F:case k.SizedPixelFormat.RGBA16I:case k.SizedPixelFormat.RGBA16UI:return 8;case k.SizedPixelFormat.RGB32F:case k.SizedPixelFormat.RGB32I:case k.SizedPixelFormat.RGB32UI:return 12;case k.SizedPixelFormat.RGBA32F:case k.SizedPixelFormat.RGBA32I:case k.SizedPixelFormat.RGBA32UI:return 16;
case k.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case k.CompressedTextureFormat.COMPRESSED_R11_EAC:case k.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case k.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case k.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case k.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case k.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case k.CompressedTextureFormat.COMPRESSED_RG11_EAC:case k.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case k.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case k.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=m;a.getStride=b;a.unbindVertexBufferLayout=function(c,d,f,p){const g=c.gl;c.bindBuffer(f);for(const x of p)if(f=d.get(x.name),4>=x.count)g.disableVertexAttribArray(f),x.divisor&&0<x.divisor&&c.gl?.vertexAttribDivisor(f,0);else if(9===x.count)for(p=
0;3>p;p++)g.disableVertexAttribArray(f+p),x.divisor&&0<x.divisor&&c.gl?.vertexAttribDivisor(f+p,0);else if(16===x.count)for(p=0;4>p;p++)g.disableVertexAttribArray(f+p),x.divisor&&0<x.divisor&&c.gl?.vertexAttribDivisor(f+p,0);else console.error("Unsupported vertex attribute element count: "+x.count);c.unbindBuffer(k.BufferType.ARRAY_BUFFER)};a.vertexCount=function(c,d){return c.vertexBuffers[d].usedMemory/b(c.layout[d])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports",
"./enums"],function(a,q){a.getDataTypeBytes=function(r){switch(r){case q.DataType.BYTE:case q.DataType.UNSIGNED_BYTE:return 1;case q.DataType.SHORT:case q.DataType.UNSIGNED_SHORT:return 2;case q.DataType.FLOAT:case q.DataType.INT:case q.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(a,q,r,k,l,m,b,c){function d(u){(null!=u.width&&0>u.width||null!=u.height&&0>u.height||null!=u.depth&&0>u.depth)&&console.error("Negative dimension parameters are not allowed!")}function f(u,v){let y=v.samplingMode,B=v.samplingMode;if(y===l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||y===l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)y=l.TextureSamplingMode.LINEAR,v.hasMipmap||(B=l.TextureSamplingMode.LINEAR);else if(y===l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||y===l.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)y=
l.TextureSamplingMode.NEAREST,v.hasMipmap||(B=l.TextureSamplingMode.NEAREST);u.texParameteri(v.target,u.TEXTURE_MAG_FILTER,y);u.texParameteri(v.target,u.TEXTURE_MIN_FILTER,B)}function p(u,v){"number"===typeof v.wrapMode?(u.texParameteri(v.target,u.TEXTURE_WRAP_S,v.wrapMode),u.texParameteri(v.target,u.TEXTURE_WRAP_T,v.wrapMode)):(u.texParameteri(v.target,u.TEXTURE_WRAP_S,v.wrapMode.s),u.texParameteri(v.target,u.TEXTURE_WRAP_T,v.wrapMode.t))}function g(u,v){const y=u.capabilities.textureFilterAnisotropic;
y&&u.gl.texParameterf(v.target,y.TEXTURE_MAX_ANISOTROPY,v.maxAnisotropy??1)}function x(u){return null!=u&&"type"in u&&"compressed"===u.type}function n(u){return null!=u&&!x(u)&&!(null!=u&&"byteLength"in u)}function e(u){return u===l.TextureType.TEXTURE_3D||u===l.TextureType.TEXTURE_2D_ARRAY}function h(u,v,y,B=1){v=Math.max(v,y);u===l.TextureType.TEXTURE_3D&&(v=Math.max(v,B));return Math.round(Math.log(v)/Math.LN2)+1}r=class u{constructor(v,y=null,B=null){this.type=m.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in v)this._descriptor=v,B=y;else{v=c.ValidatedTextureDescriptor.validate(v,y);if(!v)throw new q("Texture descriptor invalid");this._descriptor=v}this._descriptor.target===l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(B):this.setData(B)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return b.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(l.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(v,y){const B=this._descriptor;if(B.width!==v||B.height!==y){if(this._wasImmutablyAllocated)throw new q("Immutable textures can't be resized!");B.width=v;B.height=y;this._descriptor.target===
l.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(v=null){for(let y=l.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;y<=l.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;y++)this._setData(v,y)}setData(v){this._setData(v)}_setData(v,y){if(this._descriptor.context?.gl){var B=this._descriptor.context.gl;k.checkWebGLError(B);this._glName||(this._glName=B.createTexture())&&this._descriptor.context.instanceCounter.increment(l.ResourceType.Texture,this);void 0===v&&(v=null);
var t=this._descriptor,w=y??t.target,C=e(w);null===v&&(t.width=t.width||4,t.height=t.height||4,C&&(t.depth=t.depth??1));y=this._descriptor.context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);d(t);this._configurePixelStorage();k.checkWebGLError(B);var z=this._deriveInternalFormat();if(n(v)){let D="width"in v?v.width:v.codedWidth,H="height"in v?v.height:v.codedHeight;v instanceof HTMLVideoElement&&(D=v.videoWidth,H=v.videoHeight);
t.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(w,z,t.hasMipmap,D,H,1);this._texImage(w,0,z,D,H,1,v);k.checkWebGLError(B);t.hasMipmap&&this.generateMipmap();t.width||(t.width=D);t.height||(t.height=H);C&&!t.depth&&(t.depth=1)}else{const {width:D,height:H,depth:G}=t;if(null==D||null==H)throw new q("Width and height must be specified!");if(C&&null==G)throw new q("Depth must be specified!");t.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(w,z,t.hasMipmap,D,H,G);if(x(v)){const A=
v.levels;v=h(w,D,H,G);v=Math.min(v-1,A.length-1);B.texParameteri(t.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,v);if(!(z in l.CompressedTextureFormat))throw new q("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((F,J,K,P)=>{this._compressedTexImage(w,F,z,J,K,P,A[Math.min(F,A.length-1)])},v)}else this._texImage(w,0,z,D,H,G,v),k.checkWebGLError(B),t.hasMipmap&&this.generateMipmap()}f(B,this._descriptor);p(B,this._descriptor);g(this._descriptor.context,
this._descriptor);k.checkWebGLError(B);this._descriptor.context.bindTexture(y,u.TEXTURE_UNIT_FOR_UPDATES)}}updateData(v,y,B,t,w,C,z=0){C||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var D=this._descriptor;const H=this._deriveInternalFormat(),{context:G,pixelFormat:A,dataType:F,target:J,isImmutable:K}=D;if(K&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");const P=G.bindTexture(this,
u.TEXTURE_UNIT_FOR_UPDATES,!0);(0>y||0>B||t>D.width||w>D.height||y+t>D.width||B+w>D.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:D}=G);z&&D.pixelStorei(D.UNPACK_SKIP_ROWS,z);n(C)?D.texSubImage2D(J,v,y,B,t,w,A,F,C):x(C)?D.compressedTexSubImage2D(J,v,y,B,t,w,H,C.levels[v]):D.texSubImage2D(J,v,y,B,t,w,A,F,C);z&&D.pixelStorei(D.UNPACK_SKIP_ROWS,0);G.bindTexture(P,u.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(v,y,B,t,w,C,z,D){D||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var H=this._descriptor;const G=this._deriveInternalFormat(),{context:A,pixelFormat:F,dataType:J,isImmutable:K,target:P}=H;if(K&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");e(P)||console.warn("Attempting to set 3D texture data on a non-3D texture");const E=A.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);A.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);(0>y||0>B||0>t||w>H.width||
C>H.height||z>H.depth||y+w>H.width||B+C>H.height||t+z>H.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:H}=A);x(D)?(D=D.levels[v],H.compressedTexSubImage3D(P,v,y,B,t,w,C,z,G,D)):H.texSubImage3D(P,v,y,B,t,w,C,z,F,J,D);A.bindTexture(E,u.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const v=this._descriptor;if(!v.hasMipmap){if(this._wasImmutablyAllocated)throw new q("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=
v.hasMipmap=!0;d(v)}v.samplingMode===l.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,v.samplingMode=l.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):v.samplingMode===l.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,v.samplingMode=l.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const y=this._descriptor.context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(v.target);this._descriptor.context.bindTexture(y,
u.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(v){v!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=v,this._samplingModeDirty=!0)}setWrapMode(v){v!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=v,d(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const v=this._descriptor,y=v.context.gl;this._samplingModeDirty&&(f(y,v),this._samplingModeDirty=!1);this._wrapModeDirty&&(p(y,v),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===
l.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=l.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case l.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case l.PixelFormat.RGBA:return this._descriptor.internalFormat=l.SizedPixelFormat.RGBA32F;case l.PixelFormat.RGB:return this._descriptor.internalFormat=l.SizedPixelFormat.RGB32F;default:throw new q("Unable to derive format");}case l.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case l.PixelFormat.RGBA:return this._descriptor.internalFormat=
l.SizedPixelFormat.RGBA8;case l.PixelFormat.RGB:return this._descriptor.internalFormat=l.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===l.PixelFormat.DEPTH_STENCIL?l.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const v=this._descriptor.context.gl,{unpackAlignment:y,flipped:B,preMultiplyAlpha:t}=this._descriptor;v.pixelStorei(v.UNPACK_ALIGNMENT,y);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,B?1:0);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
t?1:0)}_texStorage(v,y,B,t,w,C){const {gl:z}=this._descriptor.context;if(!(y in l.SizedPixelFormat))throw new q("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){B=B?h(v,t,w,C):1;if(e(v)){if(null==C)throw new q("Missing depth dimension for 3D texture upload");z.texStorage3D(v,B,y,t,w,C)}else z.texStorage2D(v,B,y,t,w);this._wasImmutablyAllocated=!0}}_texImage(v,y,B,t,w,C,z){const D=this._descriptor.context.gl,H=e(v),{isImmutable:G,pixelFormat:A,dataType:F}=this._descriptor;
if(G){if(null!=z)if(H){if(null==C)throw new q("Missing depth dimension for 3D texture upload");D.texSubImage3D(v,y,0,0,0,t,w,C,A,F,z)}else D.texSubImage2D(v,y,0,0,t,w,A,F,z)}else if(H){if(null==C)throw new q("Missing depth dimension for 3D texture upload");D.texImage3D(v,y,B,t,w,C,0,A,F,z)}else D.texImage2D(v,y,B,t,w,0,A,F,z)}_compressedTexImage(v,y,B,t,w,C,z){const D=this._descriptor.context.gl,H=e(v);if(this._descriptor.isImmutable){if(null!=z)if(H){if(null==C)throw new q("Missing depth dimension for 3D texture upload");
D.compressedTexSubImage3D(v,y,0,0,0,t,w,C,B,z)}else D.compressedTexSubImage2D(v,y,0,0,t,w,B,z)}else if(H){if(null==C)throw new q("Missing depth dimension for 3D texture upload");D.compressedTexImage3D(v,y,B,t,w,C,0,z)}else D.compressedTexImage2D(v,y,B,t,w,0,z)}_forEachMipmapLevel(v,y=Infinity){let {width:B,height:t,depth:w,hasMipmap:C,target:z}=this._descriptor;const D=z===l.TextureType.TEXTURE_3D;if(null==B||null==t||D&&null==w)throw new q("Missing texture dimensions for mipmap calculation");for(let H=
0;;++H){v(H,B,t,w);if(!C||1===B&&1===t&&(!D||1===w)||H>=y)break;B=Math.max(1,B>>1);t=Math.max(1,t>>1);D&&(w=Math.max(1,w>>1))}}};r.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=r;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,q,r){class k{constructor(l=0,m=l){this.width=l;this.height=m;this.target=q.TextureType.TEXTURE_2D;this.pixelFormat=q.PixelFormat.RGBA;this.dataType=q.PixelType.UNSIGNED_BYTE;
this.samplingMode=q.TextureSamplingMode.LINEAR;this.wrapMode=q.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=!1}}a.TextureDescriptor=k;a.estimateMemory=function(l){return 0>=l.width||0>=l.height?0:Math.round(l.width*l.height*(l.hasMipmap?4/3:1)*(null==l.internalFormat?4:r.getBytesPerElementFormat(l.internalFormat)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,q,r){class k extends r.TextureDescriptor{constructor(l,m){super();this.context=l;Object.assign(this,m);switch(this.internalFormat){case q.SizedPixelFormat.R16F:case q.SizedPixelFormat.R16I:case q.SizedPixelFormat.R16UI:case q.SizedPixelFormat.R32F:case q.SizedPixelFormat.R32I:case q.SizedPixelFormat.R32UI:case q.SizedPixelFormat.R8_SNORM:case q.SizedPixelFormat.R8:case q.SizedPixelFormat.R8I:case q.SizedPixelFormat.R8UI:this.pixelFormat=
q.PixelFormat.RED}}static validate(l,m){return new k(l,m)}}a.ValidatedTextureDescriptor=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(a,q,r,k,l){function m(p,g,x){p=p.gl;const n=p.createShader(g);p.shaderSource(n,x);p.compileShader(n);r.webglValidateShadersEnabled()&&!p.getShaderParameter(n,p.COMPILE_STATUS)&&(console.error("Compile error in ".concat(g===
k.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(p.getShaderInfoLog(n)),console.error(b(x)));return n}function b(p){let g=2;return p.replaceAll("\n",()=>{var x=g++;x=1E3<=x?x.toString():("  "+x).slice(-3);return"\n"+x+":"})}function c(p,g,x){const n=p.get(g);if(!n)return p.set(g,Array.from(x)),!0;const e=x.length;if(n.length!==e)return p.set(g,Array.from(x)),!0;for(p=0;p<e;++p)if(g=x[p],n[p]!==g){for(n[p]=g;p<e;++p)n[p]=x[p];return!0}return!1}class d{constructor(p,g,x,n,e=
new Map,h=[]){this._context=p;this._locations=n;this._uniformBlockBindings=e;this._transformFeedbackVaryings=h;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;p||console.error("RenderingContext isn't initialized!");0===g.length&&console.error("Shaders source should not be empty!");
g=l.transpileShader(g,k.ShaderType.VERTEX_SHADER);x=l.transpileShader(x,k.ShaderType.FRAGMENT_SHADER);this._vShader=m(this._context,k.ShaderType.VERTEX_SHADER,g);this._fShader=m(this._context,k.ShaderType.FRAGMENT_SHADER,x);f.enabled&&(this._linesOfCode=g.match(/\n/g).length+x.match(/\n/g).length+2,this._context.instanceCounter.increment(k.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(k.ResourceType.Shader,
this);r.webglValidateShadersEnabled()&&(this.vertexShader=g,this.fragmentShader=x);this.usedMemory=g.length+x.length;const u=this._context.gl,v=u.createProgram();u.attachShader(v,this._vShader);u.attachShader(v,this._fShader);this._locations.forEach((y,B)=>u.bindAttribLocation(v,y,B));this._transformFeedbackVaryings?.length&&u.transformFeedbackVaryings(v,this._transformFeedbackVaryings,u.SEPARATE_ATTRIBS);u.linkProgram(v);r.webglValidateShadersEnabled()&&!u.getProgramParameter(v,u.LINK_STATUS)&&console.error("Could not link shader\n"+
`validated: ${u.getProgramParameter(v,u.VALIDATE_STATUS)}`+`, gl error ${u.getError()}`+`, vertex: ${u.getShaderParameter(this._vShader,u.COMPILE_STATUS)}`+`, fragment: ${u.getShaderParameter(this._fShader,u.COMPILE_STATUS)}`+`, info log: ${u.getProgramInfoLog(v)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);for(const [y,B]of this._uniformBlockBindings)p=u.getUniformBlockIndex(v,y),4294967295>p&&u.uniformBlockBinding(v,p,B);this._glName=v;this._context.instanceCounter.increment(k.ResourceType.Program,
this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const p=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==p||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,p.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var p=this._context.gl,g=this._context.instanceCounter;
this._nameToUniformLocation.forEach(x=>x&&g.decrement(k.ResourceType.Uniform,x));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(g.decrement(k.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),p.deleteShader(this._vShader),this._vShader=null,g.decrement(k.ResourceType.Shader,this));this._fShader&&(p.deleteShader(this._fShader),this._fShader=null);this._glName&&(p.deleteProgram(this._glName),this._glName=null,g.decrement(k.ResourceType.Program,
this))}}ref(){++this._refCount}_getUniformLocation(p){var g=this._nameToUniformLocation.get(p);return void 0!==g?g:this.glName?(g=this._context.gl.getUniformLocation(this.glName,p),this._nameToUniformLocation.set(p,g),g&&this._context.instanceCounter.increment(k.ResourceType.Uniform,g),g):null}hasUniform(p){return null!=this._getUniformLocation(p)}setUniform1i(p,g){const x=this._nameToUniform1.get(p);if(void 0===x||g!==x)this._context.gl.uniform1i(this._getUniformLocation(p),g),this._nameToUniform1.set(p,
g)}setUniform1iv(p,g){c(this._nameToUniform1v,p,g)&&this._context.gl.uniform1iv(this._getUniformLocation(p),g)}setUniform2iv(p,g){c(this._nameToUniform2,p,g)&&this._context.gl.uniform2iv(this._getUniformLocation(p),g)}setUniform3iv(p,g){c(this._nameToUniform3,p,g)&&this._context.gl.uniform3iv(this._getUniformLocation(p),g)}setUniform4iv(p,g){c(this._nameToUniform4,p,g)&&this._context.gl.uniform4iv(this._getUniformLocation(p),g)}setUniform1f(p,g){const x=this._nameToUniform1.get(p);if(void 0===x||
g!==x)this._context.gl.uniform1f(this._getUniformLocation(p),g),this._nameToUniform1.set(p,g)}setUniform1fv(p,g){c(this._nameToUniform1v,p,g)&&this._context.gl.uniform1fv(this._getUniformLocation(p),g)}setUniform2f(p,g,x){const n=this._nameToUniform2.get(p);if(void 0===n)this._context.gl.uniform2f(this._getUniformLocation(p),g,x),this._nameToUniform2.set(p,[g,x]);else if(g!==n[0]||x!==n[1])this._context.gl.uniform2f(this._getUniformLocation(p),g,x),n[0]=g,n[1]=x}setUniform2fv(p,g){c(this._nameToUniform2,
p,g)&&this._context.gl.uniform2fv(this._getUniformLocation(p),g)}setUniform3f(p,g,x,n){const e=this._nameToUniform3.get(p);if(void 0===e)this._context.gl.uniform3f(this._getUniformLocation(p),g,x,n),this._nameToUniform3.set(p,[g,x,n]);else if(g!==e[0]||x!==e[1]||n!==e[2])this._context.gl.uniform3f(this._getUniformLocation(p),g,x,n),e[0]=g,e[1]=x,e[2]=n}setUniform3fv(p,g){const x=this._getUniformLocation(p);null!=x&&c(this._nameToUniform3,p,g)&&this._context.gl.uniform3fv(x,g)}setUniform4f(p,g,x,n,
e){const h=this._nameToUniform4.get(p);if(void 0===h)this._context.gl.uniform4f(this._getUniformLocation(p),g,x,n,e),this._nameToUniform4.set(p,[g,x,n,e]);else if(void 0===h||g!==h[0]||x!==h[1]||n!==h[2]||e!==h[3])this._context.gl.uniform4f(this._getUniformLocation(p),g,x,n,e),h[0]=g,h[1]=x,h[2]=n,h[3]=e}setUniform4fv(p,g){const x=this._getUniformLocation(p);null!=x&&c(this._nameToUniform4,p,g)&&this._context.gl.uniform4fv(x,g)}setUniformMatrix3fv(p,g,x=!1){const n=this._getUniformLocation(p);null!=
n&&c(this._nameToUniformMatrix3,p,g)&&this._context.gl.uniformMatrix3fv(n,x,g)}setUniformMatrix4fv(p,g,x=!1){const n=this._getUniformLocation(p);null!=n&&c(this._nameToUniformMatrix4,p,g)&&this._context.gl.uniformMatrix4fv(n,x,g)}stop(){}}const f={enabled:!1};a.Program=d;a.test=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,
q,r,k,l,m){function b(){function u(X){X.length&&J.push({type:n[H],data:X,position:E,line:K,column:P})}function v(){F=F.length?[]:F;if("/"===A&&"*"===G)return E=D+z-1,H=0,A=G,z+1;if("/"===A&&"/"===G)return E=D+z-1,H=1,A=G,z+1;if("#"===G)return H=2,E=D+z,z;if(/\s/.test(G))return H=9,E=D+z,z;M=/\d/.test(G);T=/[^\w_]/.test(G);E=D+z;H=M?4:T?3:9999;return z}function y(){if(("\r"===G||"\n"===G)&&"\\"!==A)return u(F.join("")),H=999,z;F.push(G);A=G;return z+1}function B(){if("."===A&&/\d/.test(G))return H=
5,z;if("/"===A&&"*"===G)return H=0,z;if("/"===A&&"/"===G)return H=1,z;if("."===G&&F.length){for(;t(F););H=5;return z}if(";"===G||")"===G||"("===G){if(F.length)for(;t(F););u(G);H=999;return z+1}var X=2===F.length&&"\x3d"!==G;if(/[\w_\d\s]/.test(G)||X){for(;t(F););H=999;return z}F.push(G);A=G;return z+1}function t(X){var ca=0;do{var ma=m.operators.indexOf(X.slice(0,X.length+ca).join(""));var S=m.operators[ma];if(-1===ma){if(0<ca--+X.length)continue;S=X.slice(0,1).join("")}u(S);E+=S.length;F=F.slice(S.length);
return F.length}while(1)}function w(){if("."===G||/[eE]/.test(G))return F.push(G),H=5,A=G,z+1;if("x"===G&&1===F.length&&"0"===F[0])return H=11,F.push(G),A=G,z+1;if(/[^\d]/.test(G))return u(F.join("")),H=999,z;F.push(G);A=G;return z+1}function C(){"f"===G&&(F.push(G),A=G,z+=1);if(/[eE]/.test(G)||"-"===G&&/[eE]/.test(A))return F.push(G),A=G,z+1;if(/[^\d]/.test(G))return u(F.join("")),H=999,z;F.push(G);A=G;return z+1}var z=0,D=0,H=999,G,A,F=[],J=[],K=1,P=0,E=0,M=!1,T=!1,ba="",ea;return function(X){J=
[];if(null!==X){X=X.replace?X.replace(/\r\n/g,"\n"):X;z=0;ba+=X;for(ea=ba.length;G=ba[z],z<ea;){X=z;switch(H){case 0:"/"===G&&"*"===A?(F.push(G),u(F.join("")),H=999):(F.push(G),A=G);z+=1;break;case 1:z=y();break;case 2:z=y();break;case 3:z=B();break;case 4:z=w();break;case 11:/[^a-fA-F0-9]/.test(G)?(u(F.join("")),H=999):(F.push(G),A=G,z+=1);break;case 5:z=C();break;case 9999:if(/[^\d\w_]/.test(G)){var ca=F.join("");H=-1<m.literals.indexOf(ca)?8:-1<m.builtins.indexOf(ca)?7:6;u(F.join(""));H=999}else F.push(G),
A=G,z+=1;break;case 9:/[^\s]/g.test(G)?(u(F.join("")),H=999):(F.push(G),A=G,z+=1);break;case 999:z=v()}if(X!==z)switch(ba[X]){case "\n":P=0;++K;break;default:++P}}D+=z;ba=ba.slice(z);return J}F.length&&u(F.join(""));H=10;u("(eof)");return J}}function c(u){return u.map(v=>"eof"!==v.type?v.data:"").join("")}function d(u,v="100",y="300 es"){const B=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const t of u)if("preprocessor"===t.type){const w=B.exec(t.data);if(w){u=w[1].replaceAll(/\s\s+/g," ");if(u===
y)return u;if(u===v)return t.data="#version "+y,v;throw Error("unknown glsl version: "+u);}}u.splice(0,0,{type:"preprocessor",data:"#version "+y},{type:"whitespace",data:"\n"});return null}function f(u,v,y,B){B=B||y;for(const t of u)if("ident"===t.type&&t.data===y)return B in v?v[B]++:v[B]=0,f(u,v,B+"_"+v[B],B);return y}function p(u,v,y="afterVersion"){const B={data:"\n",type:"whitespace"},t=C=>C<u.length?/[^\r\n]$/.test(u[C].data):!1;let w=function(C){let z=-1,D=0,H=-1;for(let A=0;A<C.length;A++){var G=
C[A];"preprocessor"===G.type&&(/#(if|ifdef|ifndef)\s+.+/.test(G.data)?++D:/#endif\s*.*/.test(G.data)&&--D);("afterVersion"===y||"afterPrecision"===y)&&"preprocessor"===G.type&&G.data.startsWith("#version")&&(H=Math.max(H,A));if("afterPrecision"===y&&"keyword"===G.type&&"precision"===G.data){a:{for(G=A;G<C.length;G++){const F=C[G];if("operator"===F.type&&";"===F.data)break a}G=null}if(null===G)throw Error("precision statement not followed by any semicolons!");H=Math.max(H,G)}z<H&&0===D&&(z=A)}return z+
1}(u);t(w-1)&&u.splice(w++,0,B);for(const C of v)u.splice(w++,0,C);t(w-1)&&t(w)&&u.splice(w,0,B)}function g(u,v,y,B="lowp"){p(u,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision")}function x(u,v,y,B,t="lowp"){p(u,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",
data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:B.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision")}var n="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");
const e=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),h=new Map;a.transpileShader=function(u,v){if(u.startsWith("#version 300"))return u;var y=l.shaderTranspiler.enableCache?h.get(u):null;if(null!=y)return y;y=b();var B=[];B=B.concat(y(u));y=B=B.concat(y(null));if("300 es"===d(y,"100","300 es"))return u;var t=B=null;const w={},C={};for(let G=0;G<y.length;++G){const A=y[G];switch(A.type){case "keyword":v===r.ShaderType.VERTEX_SHADER&&
"attribute"===A.data?A.data="in":"varying"===A.data&&(A.data=v===r.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(A.data.trim())&&(A.data=A.data.replaceAll(/(2D|Cube|EXT)/g,""));v===r.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===A.data&&(B||(B=f(y,w,"fragColor"),g(y,B,"vec4")),A.data=B);if(v===r.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===A.data){var z=void 0;let F=void 0;var D=y,H=G+1;let J=-1;for(;H<D.length;H++){const K=D[H];if("operator"===
K.type&&("["===K.data&&(F=H),"]"===K.data)){z=H;break}"integer"===K.type&&(J=parseInt(K.data,10))}F&&z&&D.splice(F,z-F+1);D=J;z=f(y,w,"fragData");x(y,z,"vec4",D,"mediump");A.data=z}else v===r.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===A.data&&(t||=f(y,w,"gl_FragDepth"),A.data=t);break;case "ident":if(k.includes(A.data)){if(D=v===r.ShaderType.VERTEX_SHADER)a:{for(D=G-1;0<=D;D--)if(z=y[D],"whitespace"!==z.type&&"block-comment"!==z.type)if("keyword"===z.type){if("attribute"===z.data||"in"===z.data){D=
!0;break a}}else break;D=!1}if(D)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");A.data in C||(C[A.data]=f(y,w,A.data));A.data=C[A.data]}}}for(v=y.length-1;0<=v;--v)B=y[v],"preprocessor"===B.type&&((t=B.data.match(/#extension\s+(.*):/))&&t[1]&&e.has(t[1].trim())&&(t=y[v+1],y.splice(v,t&&"whitespace"===t.type?2:1)),(t=B.data.match(/#ifdef\s+(.*)/))&&t[1]&&e.has(t[1].trim())&&(B.data="#if 1"),(t=B.data.match(/#ifndef\s+(.*)/))&&t[1]&&e.has(t[1].trim())&&
(B.data="#if 0"));y=c(y);l.shaderTranspiler.enableCache&&h.set(u,y);return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,q){var r={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(r);
r=q.getDefaultExportFromCjs(r.exports);var k={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(k);k=q.getDefaultExportFromCjs(k.exports);var l={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(l);
q=q.getDefaultExportFromCjs(l.exports);a.builtins=q;a.literals=r;a.operators=k})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ../../../../core/RandomLCG ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../chunks/builtins ../../../webgl/GLObjectType ../../../webgl/getDataTypeBytes ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexElementDescriptor".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){function h(y){const B={};for(const t in y){let w=0;B[t]=y[t].map(C=>{const z=new e.VertexElementDescriptor(C.name,C.count,C.type,w,0,C.normalized||!1);w+=C.count*g.getDataTypeBytes(C.type);return z});B[t]?.forEach(C=>C.stride=w)}return B}const u=()=>r.getLogger("esri.views.2d.engine.webgl.Utils"),v=new Map;a.charCodes=function(y){const B=[];for(let t=0;t<y.length;t++)B.push(y.charCodeAt(t));return B};a.createAttributeLayout=h;a.createProgramDescriptor=(y,B)=>
{if(!v.has(y)){const C=h(B);var t=C;var w={};for(const z in t){const D=t[z];w[z]=D?.length?D[0].stride:0}t=w;w=new Map;for(const z in B)for(const D of B[z])w.set(D.name,D.location);v.set(y,{strides:t,bufferLayouts:C,attributes:w})}return v.get(y)};a.createTexture=function(y,B,t){const w=new n.TextureDescriptor(B.width,B.height);w.dataType=B.dataType;B.depth&&(w.depth=B.depth);B.flipped&&(w.flipped=B.flipped);B.hasMipmap&&(w.hasMipmap=B.hasMipmap);w.internalFormat=B.internalFormat;B.isImmutable&&(w.isImmutable=
B.isImmutable);B.isOpaque&&(w.isOpaque=B.isOpaque);B.maxAnisotropy&&(w.maxAnisotropy=B.maxAnisotropy);w.pixelFormat=B.pixelFormat;B.preMultiplyAlpha&&(w.preMultiplyAlpha=B.preMultiplyAlpha);B.samplingMode&&(w.samplingMode=B.samplingMode);B.target&&(w.target=B.target);w.uniform=B.uniform;B.unpackAlignment&&(w.unpackAlignment=B.unpackAlignment);B.wrapMode&&(w.wrapMode=B.wrapMode);return new x.Texture(y,w,t)};a.getCapType=function(y){switch(y){case "butt":return k.CapType.BUTT;case "round":return k.CapType.ROUND;
case "square":return k.CapType.SQUARE;default:return u().error(new q("mapview-invalid-type",`Cap type ${y} is not a valid option. Defaulting to round`)),k.CapType.ROUND}};a.getJoinType=function(y){switch(y){case "miter":return k.JoinType.MITER;case "bevel":return k.JoinType.BEVEL;case "round":return k.JoinType.ROUND;default:return u().error(new q("mapview-invalid-type",`Join type ${y} is not a valid option. Defaulting to round`)),k.JoinType.ROUND}};a.getPixelArrayCtor=function(y){switch(y){case c.PixelType.UNSIGNED_BYTE:return Uint8Array;
case c.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case c.PixelType.FLOAT:return Float32Array;default:u().error(new q("webgl-utils",`Unable to handle type ${y}`))}};a.getPixelBytes=function(y){switch(y){case c.PixelType.UNSIGNED_BYTE:return 1;case c.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case c.PixelType.FLOAT:return 4;default:u().error(new q("webgl-utils",`Unable to handle type ${y}`))}};a.isSVGImage=y=>y.includes("data:image/svg+xml");a.isValidSVG=y=>{if(!y)return!1;y=y.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(y)&&
/[\dz]$/i.test(y)&&4<y.length?!0:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../highlightReasons ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(a,q,r,k,l,m,b,c,d,f){class p extends k.VertexInput{}q.__decorate([k.location(0,l.Vec3)],p.prototype,
"id",void 0);q.__decorate([k.location(1,l.Float)],p.prototype,"bitset",void 0);q.__decorate([k.location(2,l.Vec2)],p.prototype,"pos",void 0);class g extends k.ComputeVertexInput{}q.__decorate([k.location(14,l.Vec2)],g.prototype,"nextPos1",void 0);q.__decorate([k.location(15,l.Vec2)],g.prototype,"nextPos2",void 0);class x extends k.FragmentInput{}class n extends k.GraphShaderModule{clip(e,h){let u=new l.Float(0);e=this.storage.getFilterFlags(e);u=u.add(l.float(2).multiply(l.float(1).subtract(d.getFilterBit(e,
0))));this.inside?u=u.add(l.float(2).multiply(l.float(1).subtract(d.getFilterBit(e,1)))):this.outside?u=u.add(l.float(2).multiply(d.getFilterBit(e,1))):this.highlight&&(u=u.add(l.float(2).multiply(l.float(1).subtract(this._checkHighlight(e)))));null!=h&&(e=(new l.Float(1)).subtract(l.step(h.x,this.view.currentZoom)),h=l.step(h.y,this.view.currentZoom),u=u.add((new l.Float(2)).multiply(e.add(h))));return u}getFragmentOutput(e,h,u=new l.Float(1/255)){const v=new k.FragmentOutput;v.glFragColor=this._maybeWriteHittest(h)??
this._maybeHighlight(e,u)??e;return v}_maybeHighlight(e,h){return this.highlight?new l.Vec4(e.rgb,l.step(h,e.a)):null}_checkHighlight(e){let h=this._checkHighlightBit(e,0);for(let u=1;u<r.highlightReasons.length;u++)h=h.add(this._checkHighlightBit(e,u));return l.step(new l.Float(.1),h.add(this.highlight.highlightAll))}_checkHighlightBit(e,h){return d.getHighlightBit(e,h).multiply(d.getBit(this.highlight.activeReasons,h))}maybeRunHittest(e,h,u){if(null==this.hittestRequest)return null;u=this.hittest(e,
h,u);h=l.ifElse(l.greaterThanEqual(u,this.hittestRequest.distance),new l.Float(2),new l.Float(0));e=this.storage.getAttributeDataCoords(e.id);e=d.uvToClip(e);u=new l.Vec4(new l.Float(1/255),0,0,l.step(new l.Float(0),u).divide(255));return{glPointSize:new l.Float(1),glPosition:new l.Vec4(e,h,1),color:u}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}q.__decorate([k.define],n.prototype,"inside",void 0);q.__decorate([k.define],n.prototype,"outside",void 0);q.__decorate([k.option(b.ShaderHighlight)],
n.prototype,"highlight",void 0);q.__decorate([k.uniform(m.EntityStorage)],n.prototype,"storage",void 0);q.__decorate([k.uniform(f.ViewInfo)],n.prototype,"view",void 0);q.__decorate([k.option(c.ShaderHittest)],n.prototype,"hittestRequest",void 0);a.AFeatureShader=n;a.BaseHittestVertexInput=g;a.FeatureFragmentInput=x;a.FeatureVertexInput=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),
function(a,q,r,k,l,m){class b extends k.UniformGroup{getVisualVariableData(c){this._vvData||(c=this.getAttributeDataCoords(c),this._vvData=l.texture2D(this.visualVariableData,c).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(c){if(!this._uv){var d=m.unpackDisplayIdTexel(c);c=this.size;var f=l.int(d.x),p=l.int(d.y).multiply(l.int(256));d=l.int(d.z).multiply(l.int(256)).multiply(l.int(256));p=l.float(f.add(p).add(d));f=l.mod(p,c);p=p.subtract(f).divide(c);this._uv=(new l.Vec2(f,
p)).add(.5).divide(c)}return this._uv}getFilterData(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.filterFlags,c).setDebugName("storage0")}getAnimationData(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.animation,c).setDebugName("storage1")}getVVData(c){return this.getVisualVariableData(c)}getDataDrivenData0(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.dataDriven0,c).setDebugName("storage30")}getDataDrivenData1(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.dataDriven1,
c).setDebugName("storage31")}getDataDrivenData2(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.dataDriven2,c).setDebugName("storage32")}getGPGPUData(c){c=this.getAttributeDataCoords(c);return l.texture2D(this.gpgpu,c).setDebugName("storage4")}getFilterFlags(c){return r("webgl-ignores-sampler-precision")?l.ceil(this.getFilterData(c).x.multiply(l.float(255))):this.getFilterData(c).x.multiply(l.float(255))}getAnimationValue(c){return this.getAnimationData(c).x}getSizeValue(c){return this.getVisualVariableData(c).x}getColorValue(c){return this.getVisualVariableData(c).y}getOpacityValue(c){return this.getVisualVariableData(c).z}getRotationValue(c){return this.getVisualVariableData(c).w}}
q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"filterFlags",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"animation",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"gpgpu",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"visualVariableData",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"dataDriven0",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"dataDriven1",void 0);q.__decorate([k.uniform(l.Sampler2D)],b.prototype,"dataDriven2",void 0);
q.__decorate([k.uniform(l.Float)],b.prototype,"size",void 0);a.EntityStorage=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../../highlightReasons","../../graph/glsl","./constants"],function(a,q,r,k){function l(m,b){b=r.float(2**b);return r.mod(r.floor(m.divide(b)),r.float(2))}a.cross2=function(m,b){return m.x.multiply(b.y).subtract(b.x.multiply(m.y))};a.getBit=l;a.getBitBool=function(m,
b){return r.greaterThan(l(m,b),r.float(.5))};a.getFilterBit=function(m,b){return l(m,b+q.highlightReasons.length)};a.getHighlightBit=function(m,b){return l(m,b)};a.isNan=function(m){return r.equal(m,r.float(k.nanMagicNumber))};a.max4=function(m){return r.max(r.max(r.max(m.x,m.y),m.z),m.w)};a.norm=function(m){return r.divide(m,r.float(255))};a.rand=function(m){const b=r.float(12.9898),c=r.float(78.233),d=r.float(43758.5453);m=r.dot(m,r.vec2(b,c));m=r.mod(m,r.float(3.14));return r.fract(r.sin(m).multiply(d))};
a.rgba2float=function(m){const b=r.vec4(.99609375,255/65536,255/16777216,255/4294967296);return r.dot(m,b)};a.unpackDisplayIdTexel=function(m){const b=l(m.z,7),c=r.float(1).subtract(b),d=m.xyz.subtract(r.vec3(0,0,r.float(128)));return c.multiply(m).add(b.multiply(d))};a.uvToClip=function(m){return m.multiply(2).subtract(1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl"],function(a,q,r,k){class l extends r.UniformGroup{}q.__decorate([r.uniform(k.Float)],l.prototype,"activeReasons",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"highlightAll",void 0);a.ShaderHighlight=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],
function(a,q,r,k){class l extends r.UniformGroup{}q.__decorate([r.uniform(k.Vec2)],l.prototype,"position",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"distance",void 0);a.ShaderHittest=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,k){class l extends r.UniformGroup{}q.__decorate([r.uniform(k.Mat3)],
l.prototype,"displayViewScreenMat3",void 0);q.__decorate([r.uniform(k.Mat3)],l.prototype,"displayViewMat3",void 0);q.__decorate([r.uniform(k.Mat3)],l.prototype,"displayMat3",void 0);q.__decorate([r.uniform(k.Mat3)],l.prototype,"viewMat3",void 0);q.__decorate([r.uniform(k.Mat3)],l.prototype,"tileMat3",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"displayZoomFactor",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"requiredZoomFactor",void 0);q.__decorate([r.uniform(k.Vec2)],l.prototype,
"tileOffset",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"currentScale",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"currentZoom",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"metersPerSRUnit",void 0);q.__decorate([r.uniform(k.Float)],l.prototype,"rotation",void 0);a.ViewInfo=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){function g(u,v){var y=l.mix(new l.Vec2(1),new l.Vec2(1/r.compressionFactorForU16),new l.Vec2(p.getBit(v.bitset,b.bitsetFillPatternWidthIsCompressed),p.getBit(v.bitset,b.bitsetFillPatternHeightIsCompressed))),B=u.view.requiredZoomFactor,t=(new l.Vec2(v.width,v.height)).multiply(y);y=t.multiply(v.scale).multiply(B);var w=v.angle.multiply(b.c256ToRad);const C=l.sin(w);w=l.cos(w);var z=v.id;var D=l.equal(p.getBit(v.bitset,b.bitsetFillRandomPatternOffset),l.float(1));z=
p.rgba2float(new l.Vec4(z,0));D=l.ifElse(D,l.mat3(w.divide(y.x),C.divide(y.y),0,l.negate(C.divide(y.x)),w.divide(y.y),0,p.rand(l.vec2(z,0)),p.rand(l.vec2(0,z)),1),l.mat3(w.divide(y.x),C.divide(y.y),0,l.negate(C.divide(y.x)),w.divide(y.y),0,0,0,1));t=u.localTileOffset.getPatternOffsetAtTileOrigin(t,C,w);B=B.multiply(v.scale).multiply(v.offset.subtract(t)).divide(y);y=new l.Vec3(v.pos,1);B=D.multiply(y).xy.subtract(B);y=v.tlbr.divide(u.mosaicInfo.size.xyxy);t=p.getBit(v.bitset,b.bitsetGenericConsiderAlphaOnly);
null!=u.visualVariableColor&&(t=l.ifElse(p.isNan(u.storage.getColorValue(v.id)),new l.Float(0),t));return{tileTextureCoord:B,tlbr:y,sampleAlphaOnly:t}}function x(u,v){var y=l.mod(v.tileTextureCoord,new l.Float(1));y=l.mix(v.tlbr.xy,v.tlbr.zw,y);u=l.texture2D(u.mosaicInfo.texture,y);u=l.ifElse(l.greaterThan(v.sampleAlphaOnly,new l.Float(.5)),u.aaaa,u);return v.color.multiply(u)}class n extends c.FillVertexInput{}q.__decorate([k.location(5,l.Vec4)],n.prototype,"tlbr",void 0);q.__decorate([k.location(6,
l.Float)],n.prototype,"width",void 0);q.__decorate([k.location(7,l.Float)],n.prototype,"height",void 0);q.__decorate([k.location(8,l.Vec2)],n.prototype,"offset",void 0);q.__decorate([k.location(9,l.Vec2)],n.prototype,"scale",void 0);q.__decorate([k.location(10,l.Float)],n.prototype,"angle",void 0);class e extends m.FeatureFragmentInput{}class h extends c.FillShader{vertex(u,v){return{...super.vertex(u,v),...g(this,u)}}fragment(u){const v=x(this,u);return this.getFragmentOutput(v,u,new l.Float(0))}}
q.__decorate([k.uniform(f.MosaicInfo)],h.prototype,"mosaicInfo",void 0);q.__decorate([k.uniform(d.LocalTileOffset)],h.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,k.input(n)),q.__param(1,k.input(m.BaseHittestVertexInput))],h.prototype,"vertex",null);q.__decorate([q.__param(0,k.input(e))],h.prototype,"fragment",null);a.ComplexFillFragmentInput=e;a.ComplexFillShader=h;a.ComplexFillVertexInput=n;a.getComplexFillFragmentColor=x;a.getComplexFillVertexData=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),function(a,q,r,k,l,m,b,c,d){class f extends l.FeatureVertexInput{}q.__decorate([r.location(3,k.Vec4)],f.prototype,"color",void 0);q.__decorate([r.location(4,k.Vec2)],f.prototype,"zoomRange",void 0);class p extends l.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(g,x){var n=d.getVisualVariableOpacity(this,g.id);n=d.getVisualVariableColor(this,g.id,g.color).multiply(n);const e=this.view.displayViewScreenMat3.multiply(new k.Vec3(g.pos.xy,1)),h=this.clip(g.id,g.zoomRange);return{glPosition:new k.Vec4(e.xy,h,1),color:n,...this.maybeRunHittest(g,x,null)}}fragment(g){return this.getFragmentOutput(g.color,g,new k.Float(0))}hittest(g,x){return m.hittestFill(this,g,x)}}q.__decorate([r.option(b.VisualVariableColor)],
p.prototype,"visualVariableColor",void 0);q.__decorate([r.option(c.VisualVariableOpacity)],p.prototype,"visualVariableOpacity",void 0);q.__decorate([q.__param(0,r.input(f)),q.__param(1,r.input(l.BaseHittestVertexInput))],p.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(l.FeatureFragmentInput))],p.prototype,"fragment",null);a.FillShader=p;a.FillVertexInput=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports",
"../../graph/glsl","./constants","./utils"],function(a,q,r,k){function l(f,p){return q.dot(f,q.normalize(p))}function m(f,p,g){var x=g.subtract(p),n=f.subtract(p);n=l(n,x);x=q.clamp(n.divide(q.length(x)),new q.Float(0),new q.Float(1));return q.distance(f,p.add(x.multiply(g.subtract(p))))}function b(f){f=q.abs(f);return q.step(f.x.add(f.y).add(f.z),new q.Float(1.05))}function c(f,p,g,x){const n=new q.Mat3(g.x.multiply(x.y).subtract(x.x.multiply(g.y)),x.x.multiply(p.y).subtract(p.x.multiply(x.y)),p.x.multiply(g.y).subtract(g.x.multiply(p.y)),
g.y.subtract(x.y),x.y.subtract(p.y),p.y.subtract(g.y),x.x.subtract(g.x),p.x.subtract(x.x),g.x.subtract(p.x));var e=p.x.multiply(g.y.subtract(x.y));const h=g.x.multiply(x.y.subtract(p.y));p=x.x.multiply(p.y.subtract(g.y));e=e.add(h).add(p);return(new q.Float(1)).divide(e).multiply(n.multiply(new q.Vec3(1,f)))}function d(f,p,g,x){var n=g.subtract(p);const e=x.subtract(p);n=k.cross2(n,e);n=q.and(q.lessThan(n,new q.Float(r.epsilonHitTest)),q.greaterThan(n,new q.Float(-r.epsilonHitTest)));return q.cond([q.and(q.not(n),
q.equal(b(c(f.xy,p,g,x)),new q.Float(1))),new q.Float(-1)],[!0,()=>{const h=m(f,p,g),u=m(f,g,x),v=m(f,x,p);return q.min(q.min(h,u),v)}])}a.distPointSegment=m;a.distPointTriangle=d;a.failHittest=function(f){return f.distance.add(1)};a.hittestFill=function(f,p,g){const {viewMat3:x,tileMat3:n}=f.view,e=x.multiply(n);p=e.multiply(new q.Vec3(p.pos,1));const h=e.multiply(new q.Vec3(g.nextPos1,1));g=e.multiply(new q.Vec3(g.nextPos2,1));return d(f.hittestRequest.position,p.xy,h.xy,g.xy)};a.hittestMarker=
function(f,p,g){return q.distance(f,g).subtract(p)};a.inTriangle=b;a.projectScalar=l;a.xyToBarycentric=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,k,l){class m extends r.UniformGroup{getColor(b,c,d){return k.cond([k.or(l.isNan(b),d),c],[k.lessThanEqual(b,this.values.first()),
this.colors.first()],[k.greaterThanEqual(b,this.values.last()),this.colors.last()],[!0,()=>{const f=this.values.findIndex(n=>k.greaterThan(n,b));var p=this.values.get(f);const g=f.subtract(1),x=this.values.get(g);p=b.subtract(x).divide(p.subtract(x));return k.mix(this.colors.get(g),this.colors.get(f),p)}])}}q.__decorate([r.uniform(k.FixedArray.ofType(k.Vec4,8))],m.prototype,"colors",void 0);q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],m.prototype,"values",void 0);a.VisualVariableColor=
m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,k,l){class m extends r.UniformGroup{getOpacity(b){return k.cond([l.isNan(b),new k.Float(1)],[k.lessThanEqual(b,this.opacityValues.first()),this.opacities.first()],[k.greaterThanEqual(b,this.opacityValues.last()),this.opacities.last()],
[!0,()=>{const c=this.opacityValues.findIndex(g=>k.greaterThan(g,b));var d=this.opacityValues.get(c);const f=c.subtract(1),p=this.opacityValues.get(f);d=b.subtract(p).divide(d.subtract(p));return k.mix(this.opacities.get(f),this.opacities.get(c),d)}])}}q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],m.prototype,"opacities",void 0);q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],m.prototype,"opacityValues",void 0);a.VisualVariableOpacity=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(a,q){function r(k){return null!=k.visualVariableSizeMinMaxValue||null!=k.visualVariableSizeScaleStops||null!=k.visualVariableSizeStops||null!=k.visualVariableSizeUnitValue}a.getVisualVariableColor=function(k,l,m,b=new q.Bool(!1)){if(null==k.visualVariableColor)return m;l=k.storage.getColorValue(l);return k.visualVariableColor.getColor(l,m,b)};a.getVisualVariableOpacity=
function(k,l){if(null==k.visualVariableOpacity)return new q.Float(1);l=k.storage.getOpacityValue(l);return k.visualVariableOpacity.getOpacity(l)};a.getVisualVariableRotation=function(k,l){if(null==k.visualVariableRotation)return q.Mat3.identity();l=k.storage.getRotationValue(l);return k.visualVariableRotation.getVVRotationMat3(l)};a.getVisualVariableSize=function(k,l,m){return r(k)?(l=k.storage.getSizeValue(l),k.visualVariableSizeMinMaxValue?.getSize(l,m)??k.visualVariableSizeScaleStops?.getSizeForViewScale(k.view.currentScale)??
k.visualVariableSizeStops?.getSize(l,m)??k.visualVariableSizeUnitValue?.getSize(l,m)):m};a.hasVisualVariableSize=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(a,q,r,k,l){class m extends r.UniformGroup{getPatternOffsetAtTileOrigin(b,c=new k.Float(0),d=new k.Float(1)){var f=
(new k.Vec2(l.maxRepresentableInt)).divide(b);f=b.multiply(k.fract(this.maxIntsToLocalOrigin.multiply(f))).add(this.tileOffsetFromLocalOrigin).subtract((new k.Float(.5)).multiply(b));f=new k.Vec2(f.x.multiply(d).subtract(f.y.multiply(c)),f.x.multiply(c).add(f.y.multiply(d)));return k.mod(f,b)}}q.__decorate([r.uniform(k.Vec2)],m.prototype,"tileOffsetFromLocalOrigin",void 0);q.__decorate([r.uniform(k.Vec2)],m.prototype,"maxIntsToLocalOrigin",void 0);a.LocalTileOffset=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,k){class l extends r.UniformGroup{}q.__decorate([r.uniform(k.Vec2)],l.prototype,"size",void 0);q.__decorate([r.uniform(k.Sampler2D)],l.prototype,"texture",void 0);a.MosaicInfo=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n){function e(C){return k.max((new k.Float(m.thinLineWidthFactor)).multiply(k.step(C,new k.Float(m.thinLineHalfWidth))),new k.Float(1))}function h(C,z){const {halfWidth:D,normal:H}=C;C=e(D);const G=k.length(H).multiply(D);return k.clamp(C.multiply(D.subtract(G)).divide(z.add(C).subtract(new k.Float(1))),new k.Float(0),new k.Float(1))}function u(C,z){const {id:D,offset:H,pos:G,normal:A,zoomRange:F}=z,{displayViewScreenMat3:J,displayViewMat3:K}=C.view,P=n.getVisualVariableColor(C,
D,z.color),E=n.getVisualVariableOpacity(C,D);{const {id:ea,halfWidth:X,referenceHalfWidth:ca}=z;n.hasVisualVariableSize(C)?(z=(new k.Float(2)).multiply(ca),z=n.getVisualVariableSize(C,ea,z),z=(new k.Float(.5)).multiply(X.divide(k.max(ca,new k.Float(m.epsilon)))).multiply(z)):z=X}var M=(new k.Float(.5)).multiply(C.antialiasingControls.antialiasing);M=k.max(z.add(M),new k.Float(.45)).add((new k.Float(.1)).multiply(M));const T=e(M).multiply(M).multiply(H);var ba=K.multiply(new k.Vec3(T,new k.Float(0)));
ba=J.multiply(new k.Vec3(G,new k.Float(1))).add(ba);C=(new k.Float(2)).multiply(k.step(z,new k.Float(0))).add(C.clip(D,F));ba=new k.Vec4(ba.xy,C,1);C=new k.Vec4(ba.xy,C,1);return{color:P,opacity:E,halfWidth:M,normal:A,scaledOffset:T,scaledHalfWidth:z,glPosition:C}}function v(C,z){const {opacity:D,color:H}=C;C=h(C,z);return D.multiply(H).multiply(C)}class y extends l.FeatureVertexInput{}q.__decorate([r.location(3,k.Vec4)],y.prototype,"color",void 0);q.__decorate([r.location(4,k.Vec2)],y.prototype,
"offset",void 0);q.__decorate([r.location(5,k.Vec2)],y.prototype,"normal",void 0);q.__decorate([r.location(6,k.Float)],y.prototype,"halfWidth",void 0);q.__decorate([r.location(7,k.Float)],y.prototype,"referenceHalfWidth",void 0);q.__decorate([r.location(8,k.Vec2)],y.prototype,"zoomRange",void 0);class B extends l.FeatureFragmentInput{}class t extends r.UniformGroup{}q.__decorate([r.uniform(k.Float)],t.prototype,"antialiasing",void 0);q.__decorate([r.uniform(k.Float)],t.prototype,"blur",void 0);class w extends l.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(C,z){const D=u(this,C);return{...D,...this.maybeRunHittest(C,z,D.halfWidth)}}fragment(C){const z=v(C,this.antialiasingControls.blur);return this.getFragmentOutput(z,C)}hittest(C,z,D){const {viewMat3:H,tileMat3:G}=this.view;var A=H.multiply(G);C=A.multiply(new k.Vec3(C.pos,1));const F=A.multiply(new k.Vec3(z.nextPos1,1));z=A.multiply(new k.Vec3(z.nextPos2,1));A=this.hittestRequest.position;return k.min(b.distPointSegment(A,C.xy,F.xy),b.distPointSegment(A,
C.xy,z.xy)).subtract(D)}}q.__decorate([r.uniform(t)],w.prototype,"antialiasingControls",void 0);q.__decorate([r.option(c.VisualVariableColor)],w.prototype,"visualVariableColor",void 0);q.__decorate([r.option(d.VisualVariableOpacity)],w.prototype,"visualVariableOpacity",void 0);q.__decorate([r.option(f.VisualVariableSizeMinMaxValue)],w.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([r.option(p.VisualVariableSizeScaleStops)],w.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([r.option(g.VisualVariableSizeStops)],
w.prototype,"visualVariableSizeStops",void 0);q.__decorate([r.option(x.VisualVariableSizeUnitValue)],w.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([q.__param(0,r.input(y)),q.__param(1,r.input(l.BaseHittestVertexInput))],w.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(B))],w.prototype,"fragment",null);a.AntialiasingControls=t;a.LineFragmentInput=B;a.LineShader=w;a.LineVertexInput=y;a.getLineAntialiasing=h;a.getLineFragmentColor=v;a.getLineVertexData=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,k,l){class m extends r.UniformGroup{getSize(b,c){const d=this.minMaxValueAndSize.xy,f=this.minMaxValueAndSize.zw;return k.ifElse(l.isNan(b),c,()=>{var p=b.subtract(d.x).divide(d.y.subtract(d.x));p=k.clamp(p,new k.Float(0),new k.Float(1));
return f.x.add(p.multiply(f.y.subtract(f.x)))})}}q.__decorate([r.uniform(k.Vec4)],m.prototype,"minMaxValueAndSize",void 0);a.VisualVariableSizeMinMaxValue=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,k){class l extends r.UniformGroup{getSizeForViewScale(m){return k.cond([k.lessThanEqual(m,
this.values.first()),this.sizes.first()],[k.greaterThanEqual(m,this.values.last()),this.sizes.last()],[!0,()=>{const b=this.values.findIndex(p=>k.greaterThan(p,m));var c=this.values.get(b);const d=b.subtract(1),f=this.values.get(d);c=m.subtract(f).divide(c.subtract(f));return k.mix(this.sizes.get(d),this.sizes.get(b),c)}])}}q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],l.prototype,"sizes",void 0);q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],l.prototype,"values",void 0);a.VisualVariableSizeScaleStops=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,k,l){class m extends r.UniformGroup{getSize(b,c){const d=k.cond([l.isNan(b),c],[k.lessThanEqual(b,this.values.first()),this.sizes.first()],[k.greaterThanEqual(b,this.values.last()),this.sizes.last()],[!0,()=>{const f=
this.values.findIndex(n=>k.greaterThan(n,b));var p=this.values.get(f);const g=f.subtract(1),x=this.values.get(g);p=b.subtract(x).divide(p.subtract(x));return k.mix(this.sizes.get(g),this.sizes.get(f),p)}]);return k.ifElse(l.isNan(d),c,d)}}q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],m.prototype,"sizes",void 0);q.__decorate([r.uniform(k.FixedArray.ofType(k.Float,8))],m.prototype,"values",void 0);a.VisualVariableSizeStops=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,k,l){class m extends r.UniformGroup{getSize(b,c){return k.ifElse(l.isNan(b),c,b.multiply(this.unitValueToPixelsRatio))}}q.__decorate([r.uniform(k.Float)],m.prototype,"unitValueToPixelsRatio",void 0);a.VisualVariableSizeUnitValue=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h){function u(w,
C,z){const {id:D,bitset:H}=C,G=d.getBit(H,m.bitsetTypeFillOutline),A=k.greaterThan(G,new k.Float(.5)),F=c.getLineVertexData(w,C),J=k.ifElse(A,F.halfWidth,new k.Float(0));var K=h.getVisualVariableOpacity(w,D),P=h.getVisualVariableColor(w,D,C.color);K=k.ifElse(A,C.color,P.multiply(K));P=w.view.displayViewScreenMat3.multiply(new k.Vec3(C.pos.xy,1));const E=w.clip(C.id);P=new k.Vec4(P.xy,E,1);P=k.ifElse(A,F.glPosition,P);w=z&&w.maybeRunHittest(C,z,A);return{isOutline:G,color:K,opacity:new k.Float(1),
halfWidth:J,normal:F.normal,glPosition:P,...w}}class v extends l.FeatureVertexInput{}q.__decorate([r.location(3,k.Vec2)],v.prototype,"offset",void 0);q.__decorate([r.location(4,k.Vec4)],v.prototype,"color",void 0);q.__decorate([r.location(5,k.Vec2)],v.prototype,"normal",void 0);q.__decorate([r.location(6,k.Float)],v.prototype,"halfWidth",void 0);q.__decorate([r.location(7,k.Float)],v.prototype,"referenceHalfWidth",void 0);q.__decorate([r.location(8,k.Vec2)],v.prototype,"zoomRange",void 0);class y extends c.LineFragmentInput{}
class B extends l.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}q.__decorate([r.uniform(c.AntialiasingControls)],B.prototype,"antialiasingControls",void 0);q.__decorate([r.option(f.VisualVariableColor)],B.prototype,"visualVariableColor",void 0);q.__decorate([r.option(p.VisualVariableOpacity)],B.prototype,"visualVariableOpacity",void 0);q.__decorate([r.option(g.VisualVariableSizeMinMaxValue)],B.prototype,"visualVariableSizeMinMaxValue",void 0);
q.__decorate([r.option(x.VisualVariableSizeScaleStops)],B.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([r.option(n.VisualVariableSizeStops)],B.prototype,"visualVariableSizeStops",void 0);q.__decorate([r.option(e.VisualVariableSizeUnitValue)],B.prototype,"visualVariableSizeUnitValue",void 0);class t extends B{vertex(w,C){return u(this,w,C)}fragment(w){const {color:C,isOutline:z}=w;var D=k.greaterThan(z,new k.Float(.5)),H=c.getLineFragmentColor(w,this.antialiasingControls.blur);H=k.ifElse(D,
H,C);D=k.ifElse(D,new k.Float(1/255),new k.Float(0));return this.getFragmentOutput(H,w,D)}hittest(w,C,z){return k.ifElse(z,b.failHittest(this.hittestRequest),b.hittestFill(this,w,C))}}q.__decorate([q.__param(0,r.input(v)),q.__param(1,r.input(l.BaseHittestVertexInput))],t.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(y))],t.prototype,"fragment",null);a.AOutlineFillShader=B;a.OutlineFillFragmentInput=y;a.OutlineFillShader=t;a.OutlineFillVertexInput=v;a.getOutlineFillVertexData=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(a,q,r,k,l,m,b,c,d,f){class p extends d.OutlineFillVertexInput{}q.__decorate([r.location(9,k.Vec4)],p.prototype,"tlbr",void 0);q.__decorate([r.location(10,
k.Float)],p.prototype,"inverseRasterizationScale",void 0);class g extends d.OutlineFillFragmentInput{}class x extends d.OutlineFillShader{vertex(n,e){return{...d.getOutlineFillVertexData(this,n,e),...f.getPatternFillVertexData(this,n)}}fragment(n){var {isOutline:e}=n;e=k.greaterThan(e,new k.Float(.5));var h=m.getLineFragmentColor(n,this.antialiasingControls.blur);const u=f.getPatternFillFragmentColor(n,this.mosaicInfo);h=k.ifElse(e,h,u);e=k.ifElse(e,new k.Float(1/255),new k.Float(0));return this.getFragmentOutput(h,
n,e)}}q.__decorate([r.uniform(c.MosaicInfo)],x.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(b.LocalTileOffset)],x.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(p)),q.__param(1,r.input(l.BaseHittestVertexInput))],x.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(g))],x.prototype,"fragment",null);a.PatternOutlineFillFragmentInput=g;a.PatternOutlineFillShader=x;a.PatternOutlineFillVertexInput=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(a,q,r,k,l,m,b,c){function d(n,e){var h=e.tlbr.xy,u=e.tlbr.zw,v=u.x.subtract(h.x);h=h.y.subtract(u.y);v=(new k.Vec2(v,h)).multiply(e.inverseRasterizationScale);h=v.multiply(n.view.requiredZoomFactor);u=new k.Float(1);const y=new k.Float(0);
u=new k.Mat3(u.divide(h.x),y.divide(h.y),0,k.negate(y.divide(h.x)),u.divide(h.y),0,0,0,1);v=n.localTileOffset.getPatternOffsetAtTileOrigin(v).divide(h);h=new k.Vec3(e.pos,1);v=u.multiply(h).xy.subtract(v);n=e.tlbr.divide(n.mosaicInfo.size.xyxy);return{tileTextureCoord:v,tlbr:n}}function f(n,e){var h=k.mod(n.tileTextureCoord,new k.Float(1));h=k.mix(n.tlbr.xy,n.tlbr.zw,h);e=k.texture2D(e.texture,h);return n.color.multiply(e)}class p extends m.FillVertexInput{}q.__decorate([r.location(5,k.Vec4)],p.prototype,
"tlbr",void 0);q.__decorate([r.location(6,k.Float)],p.prototype,"inverseRasterizationScale",void 0);class g extends l.FeatureFragmentInput{}class x extends m.FillShader{vertex(n,e){return{...super.vertex(n,e),...d(this,n)}}fragment(n){const e=f(n,this.mosaicInfo);return this.getFragmentOutput(e,n,new k.Float(0))}}q.__decorate([r.uniform(c.MosaicInfo)],x.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(b.LocalTileOffset)],x.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(p)),
q.__param(1,r.input(l.BaseHittestVertexInput))],x.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(g))],x.prototype,"fragment",null);a.PatternFillFragmentInput=g;a.PatternFillShader=x;a.PatternFillVertexInput=p;a.getPatternFillFragmentColor=f;a.getPatternFillVertexData=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor",
"./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(a,q,r,k){const l={createComputedParams:d=>d,attributes:{...k.patternFillVertexSpec.attributes,...r.outlineFillVertexSpec_Fill.attributes}},m={createComputedParams:d=>d,attributes:{...k.patternFillVertexSpec.attributes,...r.outlineFillVertexSpec_Outline.attributes}};class b extends r.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}}class c extends r.OutlineFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=l}_createOutlineWriter(d,f,p,g){return new b(d,f,p,g)}_write(d,f,p){p=p?.asOptimized()??f.readGeometryForDisplay();if(p=this._clip(p))d.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(d,f,p),this._lineMeshWriter.writeLineVertices(d,q.GeometryCursor.fromOptimizedCIM(p,"esriGeometryPolyline"),f),d.recordEnd()}ensurePacked(d,f,p){super.ensurePacked(d,f,p);this._lineMeshWriter.ensurePacked(d,f,p)}enqueueRequest(d,f,
p){super.enqueueRequest(d,f,p);this._lineMeshWriter.enqueueRequest(d,f,p)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}a.PatternOutlineFillMeshWriter=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(a,q,r){const k={createComputedParams:m=>m,attributes:{pos:{type:r.DataType.SHORT,
count:2,pack:"position",packPrecisionFactor:10},id:{type:r.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},offset:{type:r.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class l extends q.MeshWriter{constructor(){super(...arguments);this.vertexSpec=k}_write(m,b){m.recordStart(this.instanceId,this.attributeLayout);const c=b.getDisplayId();if("esriGeometryPoint"===b.geometryType){const d=b.readXForDisplay();b=b.readYForDisplay();
this._writeQuad(m,c,d,b)}else"esriGeometryMultipoint"===b.geometryType&&b.readGeometryForDisplay()?.forEachVertex((d,f)=>{0<=d&&512>=d&&0<=f&&512>=f&&this._writeQuad(m,c,d,f)});m.recordEnd()}_writeQuad(m,b,c,d){const f=m.vertexCount();this._writeVertex(m,b,c,d);m.indexWrite(f+0);m.indexWrite(f+1);m.indexWrite(f+2);m.indexWrite(f+1);m.indexWrite(f+3);m.indexWrite(f+2)}}a.HeatmapMeshWriter=l;a.heatmapVertexSpec=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../alignmentUtils ../../../definitions ../../../DisplayId ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){const g=q.memoize(n=>{let e=0;if(0===n)return Infinity;for(;!(n%2);)e++,n/=2;return e});class x extends p.TextMeshWriter{constructor(){super(...arguments);this.enablePixelBuffering=!1;this._zoomLevel=0}_write(n,e,h,u){this._zoomLevel=u||0;if(null!=h)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case "esriGeometryPoint":return h=e.readXForDisplay(),u=e.readYForDisplay(),this._writePoint(n,h,u,e);case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":h=
e.readCentroidForDisplay();if(!h)break;const [v,y]=h.coords;if(0>v||v>=m.tileSize||0>y||y>=m.tileSize)break;return this._writePoint(n,v,y,e);case "esriGeometryPolyline":h=e.readLegacyGeometryForDisplay(),this._writeLines(n,e,h)}}_writePoint(n,e,h,u){const v=this._getShaping();if(v){var y=this._getPointReferenceBounds();y||={offsetX:0,offsetY:0,size:0};var B=v.boundsT,t=l.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),w=l.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),
C=this.evaluatedMeshParams.scaleInfo?.maxScale??0,z=this.evaluatedMeshParams.scaleInfo?.maxScale??0,D=b.getDisplayIdTexel(u.getDisplayId());n.metricStart(new c.LabelMetric(D,e,h,t,w,C,z,y));n.metricBoxWrite(B);this._writeGlyphs(n,u.getDisplayId(),e,h,v,0,y);n.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const n of this._references){const e=n.getBoundsInfo();if(e)return e}return null}_writeLines(n,e,h){const {repeatLabel:u,scaleInfo:v}=this.evaluatedMeshParams;var y=
this.evaluatedMeshParams.repeatLabelDistance||128;const B=this._getShaping();if(B){this._current={out:n,id:e.getDisplayId(),shaping:B,zoomRange:f.getMinMaxZoom(v,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};n=d.smoothPaths(h.paths,B.bounds.width);e=this._placeSubdivGlyphs.bind(this);y=(B.bounds.width+y)/2;for(const t of n)d.pathDivide(t,y,e,!!u)}}_placeSubdivGlyphs(n,e,h,u){const {allowOverrun:v,labelPosition:y,repeatLabelDistance:B}=this.evaluatedMeshParams,
t=this._current.zoomRange[0];var w=g(e),C=this._current.shaping.bounds.width/2,z=Math.sqrt(B||128)/2;h=Math.min(h,u-h);C=this._current.shaping.isMultiline?25:Math.log2(h/(z+C/2));w=Math.max(t,this._zoomLevel+1-(0===e?C:Math.min(w,C)));C=this._zoomLevel-w;z=this._current.shaping.bounds.width/2*2**C;this._current.shaping.isMultiline?0===e&&this._placeStraight(n,w):v&&0>C?this._placeStraightAlong(n,t):"parallel"===y?this._placeStraightAlong(n,w):"curved"===y&&this._placeCurved(n,w,z)}_placeStraight(n,
e){const {out:h,id:u,shaping:v,zoomRange:y,referenceBounds:B}=this._current,{x:t,y:w}=n,C=180/Math.PI*n.angle%360,z=(180/Math.PI*n.angle+180)%360;if(v.textBox){var D=Math.max(e,y[0],0);const G=Math.min(25,y[1]);var H=r.fromRotation(k.create(),-n.angle);[,H]=v.shapeBackground(H);D={minZoom:D,maxZoom:G,clipAngle:C,mapAligned:!0,isLineLabel:!0};h.recordStart(this.instanceId,this.attributeLayout,v.glyphs[0].textureBinding);this._writeTextBox(h,u,n.x,n.y,H,B,D);h.recordEnd();D.clipAngle=z;h.recordStart(this.instanceId,
this.attributeLayout,v.glyphs[0].textureBinding);this._writeTextBox(h,u,n.x,n.y,H,B,D);h.recordEnd()}for(const G of v.glyphs)G.minZoom=e,G.maxZoom=y[1],G.angle=n.angle,this._writeLineGlyph(h,u,t,w,v.bounds,G,C,B,!0),G.angle=n.angle+Math.PI,this._writeLineGlyph(h,u,t,w,v.bounds,G,z,B,!0)}_placeCurved(n,e,h){const u=n.clone(),v=180/Math.PI*n.angle%360,y=(180/Math.PI*n.angle+180)%360;this._placeFirst(u,e,1,v);this._placeBack(n,u,e,h,1,v);this._placeForward(n,u,e,h,1,v);this._placeFirst(u,e,0,y);this._placeBack(n,
u,e,h,0,y);this._placeForward(n,u,e,h,0,y)}_placeStraightAlong(n,e){const {out:h,id:u,shaping:v,zoomRange:y,referenceBounds:B}=this._current,{boxBorderLineColor:t,boxBackgroundColor:w}=this.evaluatedMeshParams,C=n.clone(),z=180/Math.PI*n.angle%360,D=(180/Math.PI*n.angle+180)%360;if(0<v.glyphs.length&&(t||w)){var H=Math.max(e,y[0],0);const A=Math.min(25,y[1]);var G=r.fromRotation(k.create(),-n.angle);[,G]=v.shapeBackground(G);H={minZoom:H,maxZoom:A,clipAngle:z,mapAligned:!0,isLineLabel:!0};h.recordStart(this.instanceId,
this.attributeLayout,v.glyphs[0].textureBinding);this._writeTextBox(h,u,n.x,n.y,G,B,H);h.recordEnd();H.clipAngle=D;h.recordStart(this.instanceId,this.attributeLayout,v.glyphs[0].textureBinding);this._writeTextBox(h,u,n.x,n.y,G,B,H);h.recordEnd()}this._placeFirst(C,e,1,z,!0);this._placeFirst(C,e,0,D,!0)}_placeBack(n,e,h,u,v,y){const B=n.clone();for(n=n.backwardLength+0;B.prev()&&!(n>=u);)this._placeOnSegment(B,e,n,h,-1,v,y),n+=B.length+0}_placeForward(n,e,h,u,v,y){const B=n.clone();for(n=n.remainingLength+
0;B.next()&&!(n>=u);)this._placeOnSegment(B,e,n,h,1,v,y),n+=B.length+0}_placeFirst(n,e,h,u,v=!1){const {out:y,id:B,shaping:t,zoomRange:w,referenceBounds:C}=this._current;var z=t.glyphs;for(const D of z)z=D.x>t.bounds.x?h:1-h,z=Math.max(0,this._zoomLevel+Math.log2(Math.abs(D.x+D.width/2-t.bounds.x)/(z*n.remainingLength+(1-z)*n.backwardLength))),z=Math.max(e,v?0:z),D.maxZoom=Math.min(w[1],25),D.angle=n.angle+(1-h)*Math.PI,D.minZoom=Math.max(w[0],z),this._writeLineGlyph(y,B,n.x,n.y,t.bounds,D,u,C,!0)}_placeOnSegment(n,
e,h,u,v,y,B){const {out:t,id:w,shaping:C,referenceBounds:z}=this._current;var D=C.glyphs;e=n.x+n.dx/n.length*-v*h;var H=n.y+n.dy/n.length*-v*h;for(const A of D)if((D=A.x>C.bounds.x?y:1-y)&&1===v||!D&&-1===v){var G=Math.abs(A.x+A.width/2-C.bounds.x);D=Math.max(0,this._zoomLevel+Math.log2(G/h)-.1);G=Math.max(u,this._zoomLevel+Math.log2(G/(h+n.length+0)));0!==D&&(A.angle=n.angle+(1-y)*Math.PI,A.minZoom=G,A.maxZoom=D,this._writeLineGlyph(t,w,e,H,C.bounds,A,B,z,!0))}}_writeLineGlyph(n,e,h,u,v,y,B,t,w){const C=
h+v.x,z=u+v.y;v=2*Math.max(v.width,v.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1);n.recordStart(this.instanceId,this.attributeLayout,y.textureBinding);this.enablePixelBuffering&&n.recordBounds(C,z,v,v);const {texcoords:D,offsets:H}=y;this._writeQuad(n,e,h,u,{texcoords:D,offsets:H,fontSize:this._textMeshTransformProps.fontSize,color:f.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:t,
minZoom:Math.max(this._current.zoomRange[0],y.minZoom),maxZoom:Math.min(this._current.zoomRange[1],y.maxZoom),clipAngle:B,mapAligned:w,isLineLabel:!0});n.recordEnd()}}a.LabelMeshWriter=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(a){a.aggregateValidFiltersMask=254;a.createDisplayId=function(q,r){return((r?8388608:0)|q)>>>0};a.displayIdTexelMask=8388607;a.displayIdTypeAggregate=1;a.displayIdTypeFeature=
0;a.displayIdTypeMask=8388608;a.getDisplayIdFilterMask=q=>1===(q&8388608)>>>23?254:255;a.getDisplayIdTexel=q=>q&8388607;a.getDisplayIdType=q=>(q&8388608)>>>23;a.isAggregateId=function(q){return 1===(q&8388608)>>>23};a.nonAggregateValidFiltersMask=255;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","./BoundingBox","../util/serializationUtils"],function(a,q,r){class k{constructor(l,m,b,c,d,f,p,g,x=[]){this.entityTexel=
l;this.anchorX=m;this.anchorY=b;this.directionX=c;this.directionY=d;this.maxScale=f;this.minScale=p;this.referenceBounds=g;this.bounds=x}serialize(l){l.push(this.entityTexel);l.writeF32(this.anchorX);l.writeF32(this.anchorY);l.writeF32(this.directionX);l.writeF32(this.directionY);l.writeF32(this.maxScale);l.writeF32(this.minScale);l.writeF32(this.referenceBounds.size);l.writeF32(this.referenceBounds.offsetX);l.writeF32(this.referenceBounds.offsetY);r.serializeList(l,this.bounds)}static deserialize(l){const m=
l.readInt32(),b=l.readF32(),c=l.readF32(),d=l.readF32(),f=l.readF32(),p=l.readF32(),g=l.readF32(),x=l.readF32(),n=l.readF32(),e=l.readF32();l=r.deserializeList(l,q)??[];return new k(m,b,c,d,f,p,g,{size:x,offsetX:n,offsetY:e},l)}}a.LabelMetric=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports"],function(a){function q(d,f,p){d[0]=f[0]-p[0];d[1]=f[1]-p[1];return d}function r(d){var f=d[0];var p=d[1];
f=Math.sqrt(f*f+p*p);d[0]/=f;d[1]/=f}function k(d){return d.length-1}function l(d){let f=0;for(let p=0;p<k(d);p++)f+=m(d,p);return f}function m(d,f,p=1){const [g,x]=d[f+1];return Math.sqrt(g*g+x*x)*p}function b(d,f,p,g,x){if(!(p<f)){var n=g.clone().seek(p/2);null!=n&&(d(n.clone(),p,x),p=(p-f)/2,n=n.seek(f/2),b(d,f,p,g,x+1),b(d,f,p,n,x+1))}}class c{constructor(d,f,p,g,x){this._segments=d;this._index=f;this._distance=p;this._xStart=g;this._yStart=x;this._done=!1}static create(d){return new c(d,0,0,
d[0][0],d[0][1])}clone(){return new c(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(d){return this._index===d._index||d._index===this._index-1&&(0===this._distance||1===d._distance)||d._index===this._index+1&&(1===this._distance||0===d._distance)}leq(d){return this._index<d._index||this._index===d._index&&this._distance<=d._distance}geq(d){return this._index>d._index||this._index===d._index&&this._distance>=d._distance}get _segment(){return this._segments[this._index+1]}get angle(){const d=
this.dy;let f=Math.acos((0*d+-1*-this.dx)/(1*this.length));0<d&&(f=2*Math.PI-f);return f}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:d,
dy:f}=this;return Math.sqrt(d*d+f*f)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=this._index-1}hasNext(){return this._index+1<k(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=
this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(d,f){var p=this.backwardLength;if(d<=p)return this._distance=(p-d)/this.length,this;for(p=this.backwardLength;this.prev();){if(p+this.length>d)return this._seekBackwards(d-p);p+=this.length}this._distance=0;return f?this:null}seek(d,f=!1){if(0>d)return this._seekBackwards(Math.abs(d),f);if(d<=this.remainingLength)return this._distance=(this.backwardLength+d)/this.length,this;let p=this.remainingLength;for(;this.next();){if(p+
this.length>d)return this.seek(d-p,f);p+=this.length}this._distance=1;return f?this:null}}a.SegmentCursor=c;a.pathDivide=function(d,f,p,g=!0){const x=l(d);d=c.create(d);const n=x/2;if(g){g=Math.floor(Math.max((x-f)/2,0)/f);d.seek(n-g*f);for(let e=-g;e<=g;e++)512>d.x&&0<=d.x&&512>d.y&&0<=d.y&&p(d.clone(),e,n+e*f,x),d.seek(f)}else d.seek(n),p(d.clone(),0,n+0*f,x)};a.pathLength=l;a.pathSubdivide=function(d,f,p){b(p,f,l(d),c.create(d),0)};a.segmentAt=function(d,f){return d[f+1]};a.segmentCount=k;a.segmentLength=
m;a.smoothPaths=function(d,f){for(let A=0;A<d.length;A++){let F=d[A];a:{var p=F,g=f;if(0>=g)break a;const J=p.length;if(3>J)break a;const K=[];var x=0;K.push(0);for(var n=1;n<J;n++){var e=p[n],h=p[n-1],u=e[0]-h[0];e=e[1]-h[1];x+=Math.sqrt(u*u+e*e);K.push(x)}g=Math.min(g,.2*x);u=[];u.push(p[0][0]);u.push(p[0][1]);x=p[J-1][0];n=p[J-1][1];e=q([0,0],p[0],p[1]);r(e);p[0][0]+=g*e[0];p[0][1]+=g*e[1];q(e,p[J-1],p[J-2]);r(e);p[J-1][0]+=g*e[0];p[J-1][1]+=g*e[1];for(e=1;e<J;e++)K[e]+=g;K[J-1]+=g;e=.5*g;for(h=
1;h<J-1;h++){let P=0,E=0,M=0;for(var v=h-1;0<=v&&!(K[v+1]<K[h]-e);v--){var y=e+K[v+1]-K[h],B=K[v+1]-K[v],t=K[h]-K[v]<e?1:y/B;if(1E-6>Math.abs(t))break;var w=t*t,C=t*y-.5*w*B,z=t*B/g,D=p[v+1],H=p[v][0]-D[0],G=p[v][1]-D[1];P+=z/C*(D[0]*t*y+.5*w*(y*H-B*D[0])-w*t*B*H/3);E+=z/C*(D[1]*t*y+.5*w*(y*G-B*D[1])-w*t*B*G/3);M+=z}for(v=h+1;v<J&&!(K[v-1]>K[h]+e);v++){y=e-K[v-1]+K[h];B=K[v]-K[v-1];t=K[v]-K[h]<e?1:y/B;if(1E-6>Math.abs(t))break;w=t*t;C=t*y-.5*w*B;z=t*B/g;D=p[v-1];H=p[v][0]-D[0];G=p[v][1]-D[1];P+=z/
C*(D[0]*t*y+.5*w*(y*H-B*D[0])-w*t*B*H/3);E+=z/C*(D[1]*t*y+.5*w*(y*G-B*D[1])-w*t*B*G/3);M+=z}u.push(P/M);u.push(E/M)}u.push(x);u.push(n);for(let P=0,E=0;P<J;P++)p[P][0]=u[E++],p[P][1]=u[E++]}p=[];p.push(F[0]);for(g=1;g<F.length;g++){const [J,K]=F[g-1],[P,E]=F[g];p.push([Math.round(P-J),Math.round(E-K)])}F=d[A]=p}return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n){const e=[4,4];var h=[16,4];const u={topLeft:h,topRight:h,bottomLeft:h,bottomRight:h};h=[4,2];const v=[4,6],y={topLeft:h,topRight:h,bottomLeft:v,bottomRight:v},B={topLeft:h,topRight:v,bottomLeft:h,bottomRight:v},t={topLeft:v,topRight:v,bottomLeft:e,bottomRight:e},w={topLeft:e,topRight:e,bottomLeft:v,bottomRight:v},C={topLeft:v,topRight:e,bottomLeft:v,bottomRight:e},z={topLeft:e,topRight:v,bottomLeft:e,bottomRight:v},D={createComputedParams:G=>G,attributes:{pos:{type:n.DataType.SHORT,
count:2,pack:"position",packPrecisionFactor:10},id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:G,mapAligned:A,isLineLabel:F})=>d.packBitset([[g.bitsetTextIsBackground,G],[g.bitsetTextIsMapAligned,!!A],[g.bitsetTextIsLineLabel,!!F]])},zoomRange:{type:n.DataType.UNSIGNED_BYTE,count:2,packPrecisionFactor:b.minMaxZoomPrecisionFactor,packTessellation:({minZoom:G,maxZoom:A})=>[G||0,A||100]},offset:{type:n.DataType.SHORT,
count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:G})=>{const {bottomLeft:A,bottomRight:F,topLeft:J,topRight:K}=G;return[J,K,A,F]}}},textureUV:{type:n.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:G})=>{const {bottomLeft:A,bottomRight:F,topLeft:J,topRight:K}=G;return[J,K,A,F]}}},color:{type:n.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:G})=>G},fontSize:{type:n.DataType.UNSIGNED_SHORT,count:1,
packPrecisionFactor:4,packTessellation:({fontSize:G})=>r.pt2px(G)},referenceSize:{type:n.DataType.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:G},{referenceSize:A})=>r.pt2px(A??G)},haloColor:{type:n.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:G})=>d.processColorInput(G)},haloFontSize:{type:n.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:G})=>r.pt2px(G)},clipAngle:{type:n.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:G})=>
Math.round(254/360*(G||0))},referenceSymbol:{type:n.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(G,A)=>{if(!G.referenceBounds)return[0,0,0,0];const F=m.getXDirection(A.horizontalAlignment);A=m.getYDirection(A.verticalAlignment);const {offsetX:J,offsetY:K,size:P}=G.referenceBounds;return[r.pt2px(J),-r.pt2px(K),r.pt2px(P),F+1<<2|A+1]}}}};class H extends p.MeshWriter{constructor(){super(...arguments);this.vertexSpec=D;this._textMeshParamsPropsInitialized=!1;this.enablePixelBuffering=
!0}ensurePacked(G,A,F){super.ensurePacked(G,A,F);if(!this._textMeshParamsPropsInitialized||this._evaluator.hasDynamicProperties)this._textMeshTransformProps=new x.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(G,A,F){const J=this._getShaping();if(J){var K=A.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(G,A,J,F);if(F&&F.nextPath())return F.nextPoint(),this._writeGlyphs(G,K,F.x,F.y,J,0);if("esriGeometryPolygon"===
A.geometryType){A=A.readCentroidForDisplay();if(!A)return;const [P,E]=A.coords;return this._writeGlyphs(G,K,P,E,J,0)}if("esriGeometryMultipoint"===A.geometryType)A.readGeometryForDisplay()?.forEachVertex((P,E)=>this._writeGlyphs(G,K,P,E,J,0));else return F=A.readXForDisplay(),A=A.readYForDisplay(),this._writeGlyphs(G,K,F,A,J,0)}}_writePlacedTextMarkers(G,A,F,J){if(J=J??k.GeometryCursor.fromFeatureSetReaderCIM(A))if(J=l.CIMMarkerPlacementHelper.getPlacement(J,-1,this.evaluatedMeshParams.placement,
r.pt2px(1),G.id,f.getGeometryEngine())){A=A.getDisplayId();for(var K=J.next();null!=K;){const P=K.tx,E=-K.ty;K=-K.getAngle();this._writeGlyphs(G,A,P,E,F,K);K=J.next()}}}_getShaping(){const G=this._textMeshTransformProps,A=this.evaluatedMeshParams;if(!A.glyphs?.glyphs.length)return null;const F=Math.round(r.pt2px(G.fontSize)),J=r.pt2px(G.offsetX),K=r.pt2px(G.offsetY),P=q.clamp(r.pt2px(A.lineWidth),32,512),E=b.magicLabelLineHeight*q.clamp(A.lineHeightRatio,.25,4);return c.shapeGlyphs(A.glyphs,{scale:F/
b.glyphSize,angle:G.postAngle,xOffset:J,yOffset:K,horizontalAlignment:A.horizontalAlignment,verticalAlignment:A.verticalAlignment,maxLineWidth:P,lineHeight:E,decoration:A.decoration,borderLineSizePx:r.pt2px(A.boxBorderLineSize),hasBackground:!!A.boxBackgroundColor,useCIMAngleBehavior:A.useCIMAngleBehavior})}_writeGlyphs(G,A,F,J,K,P,E){const M=this.evaluatedMeshParams;var T=this._textMeshTransformProps;const ba=T.fontSize;var ea=r.pt2px(T.offsetX),X=r.pt2px(T.offsetY);0!==P&&K.setRotation(P);T=K.bounds;
ea=F+T.x+ea;X=J+T.y-X;T=2*Math.max(T.width,T.height)*(M.minPixelBuffer?M.minPixelBuffer/ba:1);K.textBox&&(G.recordStart(this.instanceId,this.attributeLayout,K.glyphs[0].textureBinding),this.enablePixelBuffering&&G.recordBounds(ea,X,T,T),this._writeTextBox(G,A,F,J,K.textBox,E),G.recordEnd());for(const ca of K.glyphs){G.recordStart(this.instanceId,this.attributeLayout,ca.textureBinding);this.enablePixelBuffering&&G.recordBounds(ea,X,T,T);const {texcoords:ma,offsets:S}=ca;this._writeQuad(G,A,F,J,{texcoords:ma,
offsets:S,fontSize:ba,color:d.processColorInput(M.color),isBackground:!1,referenceBounds:E});G.recordEnd()}0!==P&&K.setRotation(-P)}_writeTextBox(G,A,F,J,K,P,E){const M=this.evaluatedMeshParams,{fontSize:T}=this._textMeshTransformProps,{boxBackgroundColor:ba,boxBorderLineColor:ea}=M;P={isBackground:!0,fontSize:T,referenceBounds:P,...E};ba&&(this._writeQuad(G,A,F,J,{texcoords:u,offsets:K.main,color:d.processColorInput(ba),...P}),ea||(this._writeQuad(G,A,F,J,{texcoords:t,offsets:K.top,color:d.processColorInput(ba),
...P}),this._writeQuad(G,A,F,J,{texcoords:w,offsets:K.bot,color:d.processColorInput(ba),...P}),this._writeQuad(G,A,F,J,{texcoords:C,offsets:K.left,color:d.processColorInput(ba),...P}),this._writeQuad(G,A,F,J,{texcoords:z,offsets:K.right,color:d.processColorInput(ba),...P})));ea&&(this._writeQuad(G,A,F,J,{texcoords:y,offsets:K.top,color:d.processColorInput(ea),...P}),this._writeQuad(G,A,F,J,{texcoords:y,offsets:K.bot,color:d.processColorInput(ea),...P}),this._writeQuad(G,A,F,J,{texcoords:B,offsets:K.left,
color:d.processColorInput(ea),...P}),this._writeQuad(G,A,F,J,{texcoords:B,offsets:K.right,color:d.processColorInput(ea),...P}))}_writeQuad(G,A,F,J,K){const P=G.vertexCount();this._writeVertex(G,A,F,J,K);G.indexWrite(P+0);G.indexWrite(P+1);G.indexWrite(P+2);G.indexWrite(P+1);G.indexWrite(P+3);G.indexWrite(P+2)}}a.TextMeshWriter=H;a.TextVertexSpec=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],
function(a,q){class r{static getPlacement(k,l,m,b,c,d){const f=q.getPlacementOperator(m);if(!f)return null;-1===l&&k.invertY();return f.execute(k,m,b,c,d)}}a.CIMMarkerPlacementHelper=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(a,q){class r{constructor(k){const {offsetX:l,offsetY:m,postAngle:b,fontSize:c,transforms:d}=k;this.offsetX=
l;this.offsetY=m;this.postAngle=b;this.fontSize=c;(this.transforms=d)&&1<d.infos.length&&(k=q.applyParentTransform(c,b,!1,l,m,d),this.fontSize=k.size,this.postAngle=k.rotation,this.offsetX=k.offsetX,this.offsetY=k.offsetY)}}a.TextMeshTransformProps=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b){const c={createComputedParams:f=>f,attributes:{...l.LineVertexSpec.attributes,bitset:{type:b.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:f,shouldScaleDash:p,isSDF:g})=>k.packBitset([[m.bitsetGenericConsiderAlphaOnly,f],[m.bitsetLineScaleDash,p],[m.bitsetLineIsSdf,g]])},tlbr:{type:b.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:f})=>{const {rect:p,width:g,height:x}=f;f=p.x+r.spritePadding;const n=p.y+r.spritePadding;return[f,n,f+g,n+x]}},accumulatedDistance:{type:b.DataType.UNSIGNED_SHORT,
count:1,packTessellation:({distance:f})=>f},segmentDirection:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:f,directionY:p})=>[f,p]}}};class d extends l.LineMeshWriter{constructor(f,p,g,x){super(f,p,g,x);this.vertexSpec=c;this._tessellationOptions.textured=!0}_write(f,p,g){if(g=g??q.GeometryCursor.fromFeatureSetReaderCIM(p)){var {sprite:x}=this.evaluatedMeshParams;this._writeGeometry(f,p,g,x?.textureBinding)}}}a.TexturedLineMeshWriter=d;a.texturedLineVertexSpec=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){function h(t,w,C,z,D=!1){const H=k.create();D=D?1:-1;t?r.fromRotation(H,D*u*t):r.identity(H);(w||C)&&r.translate(H,H,[w,-C]);z&&r.rotate(H,H,D*u*-z);return H}const u=3.14159265359/180,v=128/Math.PI,y={createComputedParams:t=>p.ComputedMarkerParams.from(t),attributes:{pos:{type:e.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:e.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:e.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:t,alignment:w,
scaleSymbolsProportionally:C,overrideOutlineColor:z,colorLocked:D})=>{let H=0;t.sdf&&(H|=f.getBitMask(g.MarkerConstants.bitset.isSDF));w===b.Alignment.MAP&&(H|=f.getBitMask(g.MarkerConstants.bitset.isMapAligned));C&&(H|=f.getBitMask(g.MarkerConstants.bitset.scaleSymbolsProportionally));z&&(H|=f.getBitMask(g.MarkerConstants.bitset.overrideOutlineColor));D&&(H|=f.getBitMask(g.MarkerConstants.bitset.colorLocked));return H}},zoomRange:{type:e.DataType.SHORT,count:2,packPrecisionFactor:d.minMaxZoomPrecisionFactor,
pack:({scaleInfo:t},{tileInfo:w})=>f.getMinMaxZoom(t,w)},offset:{type:e.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:t,computedWidth:w,computedHeight:C,anchorX:z,anchorY:D,offsetX:H,offsetY:G,rotateClockwise:A})=>{t=h(0,H,G,-t,A);z=-(.5+z)*w;A=-(.5-D)*C;D=[z,A];H=[z+w,A];G=[z,A+C];w=[z+w,A+C];l.transformMat2d(D,D,t);l.transformMat2d(H,H,t);l.transformMat2d(G,G,t);l.transformMat2d(w,w,t);return[D,H,G,w]}}},textureUV:{type:e.DataType.SHORT,count:2,packPrecisionFactor:4,
packAlternating:{count:4,pack:({texXmax:t,texXmin:w,texYmax:C,texYmin:z})=>[[w,z],[t,z],[w,C],[t,C]]}},color:{type:e.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>f.processColorInput(t)},outlineColor:{type:e.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>f.processColorInput(t)},sizing:{type:e.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:t,rawHeight:w,outlineSize:C,referenceSize:z})=>[f.packByteSqrt(Math.max(t,w),128),f.packByteSqrt(C,128),f.packByteSqrt(z,
128),0]},placementAngle:{type:e.DataType.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:t})=>{t*=v;t%=256;return Math.abs(0<=t?t:t+256)}},sizeRatio:{type:e.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:t})=>t}}};class B extends n.MeshWriter{constructor(){super(...arguments);this.vertexSpec=y}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,w,C){var z=this.evaluatedMeshParams.sprite?.textureBinding;const D=w.getDisplayId();t.recordStart(this.instanceId,
this.attributeLayout,z);z=this.evaluatedMeshParams.minPixelBuffer;const H=Math.max(this.evaluatedMeshParams.computedWidth,z),G=Math.max(this.evaluatedMeshParams.computedHeight,z);if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(t,w,C,H,G);else if(C&&C.nextPath())C.nextPoint(),w=C.x,C=C.y,t.recordBounds(w,C,H,G),this._writeQuad(t,D,w,C);else if("esriGeometryPolygon"===w.geometryType){w=w.readCentroidForDisplay();if(!w)return;const [A,F]=w.coords;t.recordBounds(A,F,H,G);this._writeQuad(t,
D,A,F)}else"esriGeometryPoint"===w.geometryType?(C=w.readXForDisplay(),w=w.readYForDisplay(),t.recordBounds(C,w,H,G),this._writeQuad(t,D,C,w)):w.readGeometryForDisplay()?.forEachVertex((A,F)=>{t.recordBounds(A,F,H,G);this._writeQuad(t,D,A,F)});t.recordEnd()}_writePlacedMarkers(t,w,C,z,D){if(C=C??m.GeometryCursor.fromFeatureSetReaderCIM(w)?.clone())if(C=c.CIMMarkerPlacementHelper.getPlacement(C,-1,this.evaluatedMeshParams.placement,q.pt2px(1),t.id,x.getGeometryEngine())){w=w.getDisplayId();for(var H=
C.next();null!=H;){const G=H.tx,A=-H.ty;H=-H.getAngle();t.recordBounds(G,A,z,D);this._writeQuad(t,w,G,A,H);H=C.next()}}}_writeQuad(t,w,C,z,D){const H=t.vertexCount();this._writeVertex(t,w,C,z,null==D?null:{placementAngle:D});t.indexWrite(H+0);t.indexWrite(H+1);t.indexWrite(H+2);t.indexWrite(H+1);t.indexWrite(H+3);t.indexWrite(H+2)}}a.MarkerMeshWriter=B;a.MarkerVertexSpec=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports",
"../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils","../../../definitions"],function(a,q,r,k,l){class m{static from(b){return"width"in b?this.fromSimpleMeshParams(b):this.fromComplexMeshParams(b)}static fromSimpleMeshParams(b){const c=new m(b.sprite,b.color,b.outlineColor,b.minPixelBuffer,b.placement,b.scaleInfo,b.effects),{type:d,width:f,height:p,angle:g,outlineSize:x,referenceSize:n,sprite:e,overrideOutlineColor:h}=b;c.rawWidth=
q.pt2px(f);c.rawHeight=q.pt2px(p);c.angle=g;c.outlineSize=q.pt2px(x);c.referenceSize=q.pt2px(n);c.overrideOutlineColor=h;c.offsetX=q.pt2px(b.offsetX);c.offsetY=q.pt2px(b.offsetY);"simple"!==d||e.sdf||(c.rawWidth=e.width,c.rawHeight=e.height);c.sizeRatio=e.sdf?2:1;c._computeSize(b,!1);return c}static fromComplexMeshParams(b){const c=new m(b.sprite,b.color,b.outlineColor,b.minPixelBuffer,b.placement,b.scaleInfo,b.effects);let {alignment:d,transforms:f,size:p,scaleX:g,anchorX:x,anchorY:n,angle:e,colorLocked:h,
frameHeight:u,offsetX:v,offsetY:y,outlineSize:B,referenceSize:t,scaleFactor:w,sizeRatio:C,isAbsoluteAnchorPoint:z,rotateClockwise:D,scaleSymbolsProportionally:H,sprite:G}=b;if(f&&0<f.infos.length){var A=k.applyParentTransform(p,e,D,v,y,f);p=A.size;e=A.rotation;v=A.offsetX;y=A.offsetY;D=!1}w&&(p*=w,v*=w,y*=w);c.alignment=d;c.rawHeight=q.pt2px(p);c.rawWidth=G.width/G.height*g*c.rawHeight;c.referenceSize=q.pt2px(t);c.sizeRatio=C;c.angle=e;c.rotateClockwise=D;c.anchorX=x;c.anchorY=n;c.offsetX=q.pt2px(v);
c.offsetY=q.pt2px(y);z&&p&&(c.anchorX=x/p,c.anchorY=n/p);A=H&&u?p/u:1;c.outlineSize=0===B||isNaN(B)?0:Math.max(q.pt2px(B)*A,.75);c.scaleSymbolsProportionally=H;c.colorLocked=h;c._computeSize(b,!0);return c}constructor(b,c,d,f,p,g,x){this.sprite=b;this.color=c;this.outlineColor=d;this.minPixelBuffer=f;this.placement=p;this.scaleInfo=g;this.effects=x;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=0;this.sizeRatio=1;this.alignment=r.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=
this.scaleSymbolsProportionally=!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(b,c){const {sprite:d,hasSizeVV:f}=b;var p=!!d.sdf;const {rawWidth:g,rawHeight:x,sizeRatio:n,outlineSize:e}=this;b=g*n;const h=x*n;if(p&&!f){var u=e+2;this.computedWidth=
Math.min((c&&g>x?b:g)+u,b);this.computedHeight=Math.min(x+u,h)}else this.computedWidth=b,this.computedHeight=h;c=p?l.sdfTextureSize/Math.max(b,h):1;u=.5*(b-this.computedWidth)*c;var v=.5*(h-this.computedHeight)*c;c=d.rect.x+l.spritePadding+u;p=d.rect.y+l.spritePadding+v;u=c+d.width-2*u;v=p+d.height-2*v;this.texXmin=Math.floor(c);this.texYmin=Math.floor(p);this.texXmax=Math.ceil(u);this.texYmax=Math.ceil(v);this.computedWidth*=(this.texXmax-this.texXmin)/(u-c);this.computedHeight*=(this.texYmax-this.texYmin)/
(v-p);this.anchorX*=b/this.computedWidth;this.anchorY*=h/this.computedHeight}}a.ComputedMarkerParams=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(a){a.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports",
"../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(a,q,r,k,l){const m={createComputedParams:c=>c,attributes:{pos:{type:l.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:l.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:c=>0},offset:{type:l.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:c,outlineWidth:d})=>{c=Math.round(q.pt2px(c+
2*d));d=-c/2;const f=-c/2;return[[d,f],[d+c,f],[d,f+c],[d+c,f+c]]}}},texCoords:{type:l.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:l.DataType.UNSIGNED_BYTE,count:2,pack:({size:c})=>[c,c]},referenceSize:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:({size:c})=>q.pt2px(c)},zoomRange:{type:l.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:c},{tileInfo:d})=>r.getMinMaxZoom(c,d)}}};class b extends k.MeshWriter{constructor(){super(...arguments);
this.vertexSpec=m}_write(c,d){const f=d.getDisplayId();let p;if("esriGeometryPoint"===d.geometryType)p=d.readXForDisplay(),d=d.readYForDisplay();else{d=d.readCentroidForDisplay();if(!d)return;p=d?.coords[0];d=d?.coords[1]}c.recordStart(this.instanceId,this.attributeLayout);c.recordBounds(p,d,this.evaluatedMeshParams.size,this.evaluatedMeshParams.size);const g=c.vertexCount();this._writeVertex(c,f,p,d);c.indexWrite(g+0);c.indexWrite(g+1);c.indexWrite(g+2);c.indexWrite(g+1);c.indexWrite(g+3);c.indexWrite(g+
2);c.recordEnd()}}a.PieChartMeshWriter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports","../shaderGraph/techniques/mesh/createMeshWriter"],function(a,q){class r{constructor(){this._backgroundFillResult=this._defaultResult=null}static async from(k,l,m,b){const c=new r;c.setDefault(await q.createMeshWriterGroupFromSchema(k,l,m.meshes,b));return c}size(){return 1}getDefault(){return this._defaultResult}setDefault(k){this._defaultResult=
k}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(k){this._backgroundFillResult=k}match(k,l){return(k=this.doMatch(k,l)||this.getDefault())&&0<k.length&&(l=this.getBackgroundFill())?[...l,...k]:k}getSortKey(k,l){return 0}doMatch(k,l){return null}async fetchResources(k,l){}}a.FeatureMatcher=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/IntervalMatcher":function(){define(["exports","../shaderGraph/techniques/mesh/createMeshWriter",
"./Matcher"],function(a,q,r){class k extends r.FeatureMatcher{constructor(l,m){super();this._intervals=[];this._isMaxInclusive=m;this._field=l}static async fromIntervalSchema(l,m,b,c){var d=await l.createComputedField(b);const f=new k(d,b.isMaxInclusive);await Promise.all(b.intervals.map(async p=>{const g=await q.createMeshWriterGroupFromSchema(l,m,p.meshes,c);f.add(p,g)}));d=await q.createMeshWriterGroupFromSchema(l,m,b.defaultSymbol,c);f.setDefault(d);b=await q.createMeshWriterGroupFromSchema(l,
m,b.backgroundFill,c);f.setBackgroundFill(b);return f}add(l,m){this._intervals.push({interval:l,result:m});this._intervals.sort((b,c)=>b.interval.min-c.interval.min)}size(){return super.size()+this._intervals.length}doMatch(l,m){l=this._field?.read(l,m);if(null==l||isNaN(l)||Infinity===l||-Infinity===l)return null;for(m=0;m<this._intervals.length;m++){const {interval:b,result:c}=this._intervals[m],d=this._isMaxInclusive?l<=b.max:l<b.max;if(l>=b.min&&d)return c}return null}}a.IntervalMatcher=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/LabelMatcher":function(){define(["exports","../shaderGraph/techniques/mesh/createMeshWriter","./Matcher"],function(a,q,r){class k extends r.FeatureMatcher{static async fromLabelSchema(l,m,b,c){b=b.classes.map(async d=>{const f=await q.createMeshWriterGroupFromSchema(l,m,d.meshes,c);return{minScale:d.minScale,maxScale:d.maxScale,meshes:f,expression:null,where:await l.createWhereClause(d.where)}});b=await Promise.all(b);return new k(b)}constructor(l){super();
this._labels=l}match(l,m){if(!this._labels.length)return null;m=this._getLabels(m.$view.scale);const b=[];for(const c of m)c.where&&!c.where(l)||b.push(...c.meshes);return b}_getLabels(l){return this._labels.filter(m=>this._validForTileScale(m,l))}_validForTileScale(l,m){return(!l.minScale||l.minScale>=m-m/4)&&(!l.maxScale||l.maxScale<=m+m/2)}}a.LabelMatcher=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MapMatcher":function(){define(["exports",
"../shaderGraph/techniques/mesh/createMeshWriter","./Matcher"],function(a,q,r){class k extends r.FeatureMatcher{constructor(l,m){super();this._defaultSymbolSortKey=0;this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fields=l;this._separator=m||""}static async fromMatcherSchema(l,m,b,c){var d=b.expression?[l.createComputedField({expression:b.expression})]:[b.field?l.createComputedField({field:b.field}):null,b.field2?l.createComputedField({field:b.field2}):null,b.field3?l.createComputedField({field:b.field3}):
null];d=(await Promise.all(d)).filter(p=>!!p);const f=new k(d,b.fieldDelimiter);d=await q.createMeshWriterGroupFromSchema(l,m,b.defaultSymbol,c);f.setDefault(d);d=await q.createMeshWriterGroupFromSchema(l,m,b.backgroundFill,c);f.setBackgroundFill(d);await Promise.all(b.map.map(async(p,g)=>{const x=await q.createMeshWriterGroupFromSchema(l,m,p.symbol,c);"\x3cNull\x3e"===p.value?f.setNullResult(x):f.add(p.value,x,g+1)}));return f}setNullResult(l){this._nullResult=l}getSortKey(l,m){l=this._getValueFromFields(l,
m);return null==l||""===l||"\x3cNull\x3e"===l?0:(l=this._resultsMap.get(l.toString()))?l.sortKey:this._defaultSymbolSortKey}add(l,m,b){this._resultsMap.set(l.toString(),{meshWriters:m,sortKey:b});this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,b+1)}size(){return super.size()+this._resultsMap.size}doMatch(l,m){l=this._getValueFromFields(l,m);return null===this._nullResult||null!=l&&""!==l&&"\x3cNull\x3e"!==l?null==l?null:this._resultsMap.get(l.toString())?.meshWriters:this._nullResult}_getValueFromFields(l,
m){const b=[];for(const c of this._fields){const d=c.read(l,m);null==d||""===d?b.push("\x3cNull\x3e"):b.push(d)}return b.join(this._separator)}}a.MapMatcher=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../shaderGraph/techniques/mesh/AResourceProxy"],function(a,q,r){class k extends r.AResourceProxy{constructor(l){super();this._fetcher=l;this._controller=new AbortController;
this._pendingRequests=[];this._resourceIdToResource=new Map}destory(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(l){const m=q.numericHash(JSON.stringify(l));this._pendingRequests.push({...l,resourceId:m});return m}async fetchEnqueuedResources(){const l=this._pendingRequests;this._pendingRequests=[];const m=await this._fetcher.fetch(l,this._abortOptions);for(let b=0;b<m.length;b++)this._resourceIdToResource.set(l[b].resourceId,m[b])}async fetchResourceImmediate(l){l=
await this._fetcher.fetch([l],this._abortOptions);if(1!==l.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return l[0]}async fetchDictionaryResourceImmediate(l){l=await this._fetcher.fetchDictionary([l],this._abortOptions);if(1!==l.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return l[0]}getResource(l){return this._resourceIdToResource.get(l)}}a.ResourceProxy=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(a){class q{}a.AResourceProxy=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/BinningStrategy":function(){define("exports ../../../../../core/has ../../../../../geohash/geohashUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/support/FieldsIndex ../aggregation/ComputedAggregateField ./AAggregateStrategy ./AProcessorStrategy ../sources/FeatureSourceMessage ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../../tiling/TileKey".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){class h extends d.ASendState{constructor(v,y){super(v);this.bins=new Map;this.done=!1;this._store=y}reset(){this.destroy();this.bins.clear();this.done=!1;this.handledChunks.clear()}destroy(){for(const v of this.bins.values()){const y=v.cachedFeature?.objectId;null!=y&&this._store.releaseDisplayIdForObjectId(y)}}*features(){for(const v of this.bins.values())v.cachedFeature&&(yield v.cachedFeature)}getGeohashBounds(v,y){const B=this.subscription.tile;return r.getGeohashBounds(B.extent,
B.resolution,y,v)}}class u extends c.AAggregateStrategy{static async create(v,y,B,t){const w=new p.ComputedAttributeStorage({spatialReference:y}),C=v.fixedBinLevel,z=await Promise.all(v.fields.map(async D=>b.ComputedAggregateField.create(w,D)));v=v.featureFilter?await g.create({geometryType:B.service.geometryType,hasM:!1,hasZ:!1,timeInfo:B.service.timeInfo,fieldsIndex:new m(B.service.fields),spatialReference:y,filterJSON:v.featureFilter}):null;return new u({fields:z,geohashLevel:C,spatialReference:y,
featureFilter:v},B,t)}constructor(v,y,B){super(y,B,v.spatialReference,v.fields);this._indexOptions=v;this._metadata=new x.FeatureMetadata({geometryType:this.geometryType,objectIdField:"aggregateId",fields:this._indexOptions.fields})}get geometryType(){return"esriGeometryPolygon"}createState(v){return new h(v,this._attributeStore)}async *applyOverride(v){this._attributeStore.incrementDisplayIdGeneration();for(const y of this._sendStates.values())y.reset()}getDisplayFeatures(v){v=new Set(v);const y=
new Set,B=[];for(const t of this._sendStates.values())for(const w of t.features())v.has(w.displayId)&&!y.has(w.objectId)&&(B.push(k.convertToFeature(w,this.geometryType,!1,!1)),y.add(w.objectId));return{features:[],aggregates:B}}getFeatureObjectIdsForAggregate(v){for(const y of this._sendStates.values())for(const B of y.bins.values())if(B.id===v)return Array.from(B.objectIds);return[]}async *updateChunks(){if(this._source.chunks().length)for(const v of this._sendStates.values())yield*this._update(v,
this._source)}async *_update(v,y){const {handledChunks:B,subscription:t,bins:w}=v,{spatialReference:C,geohashLevel:z}=this._indexOptions;var D=t.tile;if(!v.done){for(var H of y.chunks())if(!B.has(H.chunkId)){B.add(H.chunkId);var G=H.queryInfo;if("tileId"in G&&(G=new e(G.tileId),G.level!==D.level||G.world!==D.key.world))continue;G=H.getGeohashIndex(this._indexOptions);var A=v.getGeohashBounds(C,z);G.putBins(w,A)}D=[];H=t.tile.transform;for(var F of w.values())F.cachedFeature?F.cachedFeature.attributes=
F.getAttributes():(G=F.getGeometry(this.spatialReference,H),A=new l.OptimizedFeature(G,F.getAttributes(),null),G||(A.centroid=F.getGeometryCentroid(this.spatialReference,H)),A.objectId=F.id,A.displayId=this._attributeStore.createDisplayIdForObjectId(F.id),F.cachedFeature=A),D.push(F.cachedFeature);this.events.emit("changed");v.done=!y.updateTracking.updating;y=n.FeatureSetReaderJSON.fromOptimizedFeatures(D,this._metadata,H);F=y.getCursor();for(D=v.subscription.tile.arcadeEvaluationOptions;F.next();)this._attributeStore.setAttributeData(F.getDisplayId(),
F,D);q("esri-2d-update-debug")&&console.debug(`Tile[${t.tile.key.id}] BinningStrategy.sendUpdates`);this._attributeStore.sendUpdates();q("esri-2d-update-debug")&&console.debug(`Tile[${t.tile.key.id}] BinningStrategy._sendUpdates.await`);yield new f.FeatureTileAppendMessage(v.subscription,y,!0,v.done,{})}}}a.BinningState=h;a.BinningStrategy=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/geohashUtils":function(){define("exports ../core/has ../core/mathUtils ../geometry/Extent ../geometry/Polygon ../geometry/SpatialReference ../geometry/support/Ellipsoid ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport".split(" "),
function(a,q,r,k,l,m,b,c,d,f){function p(w,C,z,D){if(D.isWebMercator)return w=r.rad2deg(w/b.earth.radius),w-=360*Math.floor((w+180)/360),C=r.rad2deg(Math.PI/2-2*Math.atan(Math.exp(-C/b.earth.radius))),D=[0,0],h(D,0,C,w,z),D;C=f.project({x:w,y:C},D,m.WGS84);if(!C)return null;w=[0,0];h(w,0,C.y,C.x,z);return w}function g(w){return 57>=w?w-48:104>=w?w-88:107>=w?w-89:110>=w?w-90:w-91}function x(w,C,z){w[0]=C;w[1]=z;return w}function n(w,C){const z=(w[0]+w[1])/2,D=!C;w[0]=D*w[0]+C*z;w[1]=D*z+C*w[1]}function e(w,
C){C=C>(w[0]+w[1])/2;n(w,C);return C}function h(w,C,z,D,H){H%2&&(H+=1);let G=0,A=0,F=-90,J=90,K=-180,P=180;for(let ba=0;ba<H/2;ba++){for(var E=0;5>E;E++){var M=(K+P)/2,T=D>M?1:0;G|=T<<29-(E+5*ba);K=(1-T)*K+T*M;P=(1-T)*M+T*P}for(E=0;5>E;E++)M=(F+J)/2,T=z>M?1:0,A|=T<<29-(E+5*ba),F=(1-T)*F+T*M,J=(1-T)*M+T*J}w[2*C]=G;w[2*C+1]=A}function u(w,C){return C?1&w|(4&w)>>1|(16&w)>>2:(2&w)>>1|(8&w)>>2}function v(w,C){return C?(2&w)>>1|(8&w)>>2:1&w|(4&w)>>1|(16&w)>>2}function y(w,C,z){var D=!((w.length-1)%2);const H=
w.substring(0,w.length-1);var G=g(w.charCodeAt(w.length-1)),A=0,F=0;let J=0;var K=0;D?(A=8,F=4,J=1&G|(4&G)>>1|(16&G)>>2,K=(2&G)>>1|(8&G)>>2):(A=4,F=8,K=1&G|(4&G)>>1|(16&G)>>2,J=(2&G)>>1|(8&G)>>2);C=J+C;G=K+z;z=Math.floor(C/A);K=Math.floor(G/F);A=C-z*A;F=G-K*F;D="0123456789bcdefghjkmnpqrstuvwxyz"[D?A&1|(F&1)<<1|(A&2)<<1|(F&2)<<2|(A&4)<<2:F&1|(A&1)<<1|(F&2)<<1|(A&2)<<2|(F&4)<<2];return 1<w.length&&(z||K)?y(H,z,K)+D:H+D}const B=new Float64Array(2),t=new Float64Array(2);a.convertGeohash32ToXY=function(w,
C){let z=w=0,D=30,H=30;for(let F=0;F<C.length;F++){var G=C.charCodeAt(F),A=g(G);G=0===F%2;const J=u(A,G);A=v(A,G);D-=G?3:2;H-=G?2:3;w|=J<<D;z|=A<<H}return{geohashX:w,geohashY:z}};a.decodeBase32Char=g;a.decodeGeohash=function(w,C){const z=x(B,-90,90),D=x(t,-180,180);for(let G=0;G<C.length;G++){var H=C.charCodeAt(G);H=g(H);0===G%2?(n(D,!!(16&H)),n(D,!!(4&H)),n(D,!!(1&H)),n(z,!!(8&H)),n(z,!!(2&H))):(n(z,!!(16&H)),n(z,!!(4&H)),n(z,!!(1&H)),n(D,!!(8&H)),n(D,!!(2&H)))}w[0]=(z[0]+z[1])/2;w[1]=(D[0]+D[1])/
2;return w};a.decodeGeohashXY=function(w,C){let z=-90,D=90,H=-180,G=180;for(let E=0;E<C;E++){var A=Math.ceil((E+1)/2),F=Math.floor((E+1)/2),J=1-E%2,K=30-(3*A+2*F),P=30-(2*A+3*F);F=3*J+2*(1-J);A=2*J+3*(1-J);K=(7*J+3*(1-J)<<K&w.geohashX)>>K;J=(3*J+7*(1-J)<<P&w.geohashY)>>P;for(--F;0<=F;F--){P=(H+G)/2;const M=K&1<<F?1:0;H=(1-M)*H+M*P;G=(1-M)*P+M*G}for(--A;0<=A;A--)K=(z+D)/2,F=J&1<<A?1:0,z=(1-F)*z+F*K,D=(1-F)*K+F*D}return[H,z,G,D]};a.encodeBase32Char=function(w){return"0123456789bcdefghjkmnpqrstuvwxyz"[w]};
a.encodeGeohash=function(w,C,z){let D="";const H=x(B,-90,90),G=x(t,-180,180);for(let A=0;A<z;A++){let F=0;A%2?(F|=e(H,w)<<4,F|=e(G,C)<<3,F|=e(H,w)<<2,F|=e(G,C)<<1,F|=e(H,w)<<0):(F|=e(G,C)<<4,F|=e(H,w)<<3,F|=e(G,C)<<2,F|=e(H,w)<<1,F|=e(G,C)<<0);D+="0123456789bcdefghjkmnpqrstuvwxyz"[F]}return D};a.getGeohash=p;a.getGeohashBounds=function(w,C,z,D){w=[w.xmin,w.ymin,w.xmax,w.ymax];var H=l.fromExtent(k.fromBounds(w,D));C=f.project(H,D,m.WGS84,{densificationStep:64*C});C=c.convertFromPolygon(new d,C,!1,
!1);H=C.coords.filter((A,F)=>!(F%2));var G=C.coords.filter((A,F)=>F%2);C=Math.min(...H);D=Math.min(...G);H=Math.max(...H);G=Math.max(...G);C=p(C,D,z,m.WGS84);D=p(H,G,z,m.WGS84);if(!C||!D)throw Error("InternalError: Unable to project tile bounds");return{bounds:w,geohashBounds:{xLL:C[0],yLL:C[1],xTR:D[0],yTR:D[1]},level:z}};a.getRelativeGeohash=y;a.setGeohashBuf=h;a.setGeohashXY=function(w,C,z,D){D%2&&(D+=1);let H=0,G=0,A=-90,F=90,J=-180,K=180;for(let T=0;T<D/2;T++){for(var P=0;5>P;P++){var E=(J+K)/
2,M=z>E?1:0;H|=M<<29-(P+5*T);J=(1-M)*J+M*E;K=(1-M)*E+M*K}for(P=0;5>P;P++)E=(A+F)/2,M=C>E?1:0,G|=M<<29-(P+5*T),A=(1-M)*A+M*E,F=(1-M)*E+M*F}w.geohashX=H;w.geohashY=G};a.unpackXBits=u;a.unpackYBits=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/maybe ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(a,q,r,k,l,m,b,c,d,f){function p(Q,V){return Q?V?4:3:V?3:2}function g(Q,V,W,ha){if(Q){if(W)return V&&ha?R:Ca;if(V&&ha)return L}else if(V&&ha)return Ca;return wa}function x({scale:Q,translate:V},W){return Math.round((W-V[0])/Q[0])}function n({scale:Q,translate:V},W){return Math.round((V[1]-W)/Q[1])}function e({scale:Q,translate:V},W,ha){return W*Q[ha]+V[ha]}function h(Q){Q=Q.coords;return{x:Q[0],y:Q[1]}}function u(Q,V){Q.coords[0]=V.x;Q.coords[1]=V.y;return Q}function v(Q){Q=Q.coords;return{x:Q[0],
y:Q[1],z:Q[2]}}function y(Q,V){Q.coords[0]=V.x;Q.coords[1]=V.y;Q.coords[2]=V.z;return Q}function B(Q){Q=Q.coords;return{x:Q[0],y:Q[1],m:Q[2]}}function t(Q,V){Q.coords[0]=V.x;Q.coords[1]=V.y;Q.coords[2]=V.m;return Q}function w(Q){Q=Q.coords;return{x:Q[0],y:Q[1],z:Q[2],m:Q[3]}}function C(Q,V){Q.coords[0]=V.x;Q.coords[1]=V.y;Q.coords[2]=V.z;Q.coords[3]=V.m;return Q}function z(Q,V){return Q&&V?C:Q?y:V?t:u}function D(Q,V,W,ha,la){W=z(W,ha);for(const {geometry:N,attributes:aa}of V)V=null!=N?W(new f,N):
null,Q.push(new c.OptimizedFeature(V,aa,null,la?aa[la]:void 0));return Q}function H(Q,V,W=z(null!=V.z,null!=V.m)){return W(Q,V)}function G(Q,V,W,ha){for(const {geometry:la,attributes:N}of V)Q.push({attributes:N,geometry:null!=la?A(la,W,ha):null});return Q}function A(Q,V,W){if(null==Q)return null;const ha=p(V,W),la=[];for(let N=0;N<Q.coords.length;N+=ha){const aa=[];for(let ja=0;ja<ha;ja++)aa.push(Q.coords[N+ja]);la.push(aa)}return V?W?{points:la,hasZ:V,hasM:W}:{points:la,hasZ:V}:W?{points:la,hasM:W}:
{points:la}}function F(Q,V,W,ha,la){W=p(W,ha);for(const {geometry:N,attributes:aa}of V)V=null!=N?J(new f,N,W):null,Q.push(new c.OptimizedFeature(V,aa,null,la?aa[la]:void 0));return Q}function J(Q,V,W=p(V.hasZ,V.hasM)){Q.lengths[0]=V.points.length;const ha=Q.coords;let la=0;for(const N of V.points)for(V=0;V<W;V++)ha[la++]=N[V];return Q}function K(Q,V,W){if(!Q)return null;const ha=p(V,W),{coords:la,lengths:N}=Q;Q=[];let aa=0;for(const ja of N){const oa=[];for(let ua=0;ua<ja;ua++){const za=[];for(let Aa=
0;Aa<ha;Aa++)za.push(la[aa++]);oa.push(za)}Q.push(oa)}return V?W?{paths:Q,hasZ:V,hasM:W}:{paths:Q,hasZ:V}:W?{paths:Q,hasM:W}:{paths:Q}}function P(Q,V,W,ha,la){W=p(W,ha);for(const {geometry:N,attributes:aa,centroid:ja}of V)V=null!=N?E(new f,N,W):null,ha=null!=ja?H(new f,ja):null,Q.push(new c.OptimizedFeature(V,aa,ha,la?aa[la]:void 0));return Q}function E(Q,V,W=p(V.hasZ,V.hasM)){const {lengths:ha,coords:la}=Q;let N=0;for(const aa of V.paths){for(const ja of aa)for(V=0;V<W;V++)la[N++]=ja[V];ha.push(aa.length)}return Q}
function M(Q,V,W){if(!Q)return null;const ha=p(V,W),{coords:la,lengths:N}=Q;Q=[];let aa=0;for(const ja of N){const oa=[];for(let ua=0;ua<ja;ua++){const za=[];for(let Aa=0;Aa<ha;Aa++)za.push(la[aa++]);oa.push(za)}Q.push(oa)}return V?W?{rings:Q,hasZ:V,hasM:W}:{rings:Q,hasZ:V}:W?{rings:Q,hasM:W}:{rings:Q}}function T(Q,V,W=V.hasZ,ha=V.hasM){return ba(Q,V.rings,W,ha)}function ba(Q,V,W,ha){W=p(W,ha);const {lengths:la,coords:N}=Q;ha=0;na(Q);for(const aa of V){for(const ja of aa)for(V=0;V<W;V++)N[ha++]=ja[V];
la.push(aa.length)}return Q}function ea(Q,V,W,ha,la,N){ta(Q);if(!W){for(const aa of V)Q.push(new c.OptimizedFeature(null,aa.attributes,null,N?aa.attributes[N]:void 0));return Q}switch(W){case "esriGeometryPoint":return D(Q,V,ha,la,N);case "esriGeometryMultipoint":return F(Q,V,ha,la,N);case "esriGeometryPolyline":return P(Q,V,ha,la,N);case "esriGeometryPolygon":for(const {geometry:aa,centroid:ja,attributes:oa}of V)V=null!=aa?T(new f,aa,ha,la):null,W=N?oa[N]:void 0,null!=ja?Q.push(new c.OptimizedFeature(V,
oa,u(new f,ja),W)):Q.push(new c.OptimizedFeature(V,oa,null,W));break;default:va().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${W}'`)),ta(Q)}return Q}function X(Q,V,W,ha){Q=Q&&("coords"in Q?Q:Q.geometry);if(null==Q)return null;switch(V){case "esriGeometryPoint":return V=h,W&&ha?V=w:W?V=v:ha&&(V=B),V(Q);case "esriGeometryMultipoint":return A(Q,W,ha);case "esriGeometryPolyline":return K(Q,W,ha);case "esriGeometryPolygon":return M(Q,W,ha);default:return va().error("convertToGeometry:unknown-geometry",
new q(`Unable to parse unknown geometry type '${V}'`)),null}}function ca(Q,V,W,ha,la){ta(Q);if(null==W){for(const aa of V)Q.push({attributes:aa.attributes});return Q}switch(W){case "esriGeometryPoint":W=h;ha&&la?W=w:ha?W=v:la&&(W=B);for(var N of V){const {geometry:aa,attributes:ja}=N;ha=null!=aa?W(aa):null;Q.push({attributes:ja,geometry:ha})}break;case "esriGeometryMultipoint":return G(Q,V,ha,la);case "esriGeometryPolyline":for(const {geometry:aa,attributes:ja}of V)Q.push({attributes:ja,geometry:null!=
aa?K(aa,ha,la):null});break;case "esriGeometryPolygon":for(const {geometry:aa,attributes:ja,centroid:oa}of V)N=null!=aa?M(aa,ha,la):null,null!=oa?(V=h(oa),Q.push({attributes:ja,centroid:V,geometry:N})):Q.push({attributes:ja,geometry:N});break;default:va().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${W}'`))}return Q}function ma(Q,V,W,ha,la,N,aa=W,ja=ha){na(Q);if(!V?.coords.length)return null;la=xa[la];const {coords:oa,lengths:ua}=V;V=p(W,ha);const za=
p(W&&aa,ha&&ja);W=g(W,ha,aa,ja);if(!ua.length)return W(Q.coords,oa,0,0,x(N,oa[0]),n(N,oa[1])),na(Q,V,0),Q;let Aa,Ga=0,Da,Ha=0;for(const Fa of ua){if(Fa<la)continue;let Ea=0;Da=Ha;ja=ha=x(N,oa[Ga]);Aa=aa=n(N,oa[Ga+1]);W(Q.coords,oa,Da,Ga,ja,Aa);Ea++;Ga+=V;Da+=za;for(let Ka=1;Ka<Fa;Ka++,Ga+=V)if(ja=x(N,oa[Ga]),Aa=n(N,oa[Ga+1]),ja!==ha||Aa!==aa)W(Q.coords,oa,Da,Ga,ja-ha,Aa-aa),Da+=za,Ea++,ha=ja,aa=Aa;Ea>=la&&(Q.lengths.push(Ea),Ha=Da)}ta(Q.coords,Ha);return Q.coords.length?Q:null}function S(Q,V,W,ha,
la,N,aa){let ja=ha,oa=0;for(let za=N+W;za<aa;za+=W){var ua=V[za];const Aa=V[za+1],Ga=V[aa],Da=V[aa+1];let Ha=V[N],Fa=V[N+1],Ea=Ga-Ha,Ka=Da-Fa;if(0!==Ea||0!==Ka){const Sa=((ua-Ha)*Ea+(Aa-Fa)*Ka)/(Ea*Ea+Ka*Ka);1<Sa?(Ha=Ga,Fa=Da):0<Sa&&(Ha+=Ea*Sa,Fa+=Ka*Sa)}Ea=ua-Ha;Ka=Aa-Fa;ua=Ea*Ea+Ka*Ka;ua>ja&&(oa=za,ja=ua)}ja>ha&&(oa-N>W&&S(Q,V,W,ha,la,N,oa),la(Q,V,Q.length,oa,V[oa],V[oa+1]),aa-oa>W&&S(Q,V,W,ha,la,oa,aa))}function Y(Q,V,W,ha,la){const {coords:N,lengths:aa}=V;W=p(W,ha);if(!N.length)return Q!==V&&
na(Q),Q;k.assertIsSome(la);const {originPosition:ja,scale:oa,translate:ua}=la;la=qa;la.originPosition=ja;ha=la.scale;ha[0]=oa[0]??1;ha[1]=-(oa[1]??1);ha[2]=oa[2]??1;ha[3]=oa[3]??1;var za=la.translate;za[0]=ua[0]??0;za[1]=ua[1]??0;za[2]=ua[2]??0;za[3]=ua[3]??0;if(!aa.length){for(ha=0;ha<W;++ha)Q.coords[ha]=e(la,N[ha],ha);Q!==V&&na(Q,W,0);return Q}za=0;for(let Ga=0;Ga<aa.length;Ga++){const Da=aa[Ga];Q.lengths[Ga]=Da;for(var Aa=0;Aa<W;++Aa)Q.coords[za+Aa]=e(la,N[za+Aa],Aa);Aa=Q.coords[za];let Ha=Q.coords[za+
1];za+=W;for(let Fa=1;Fa<Da;Fa++,za+=W){Aa+=N[za]*ha[0];Ha+=N[za+1]*ha[1];Q.coords[za]=Aa;Q.coords[za+1]=Ha;for(let Ea=2;Ea<W;++Ea)Q.coords[za+Ea]=e(la,N[za+Ea],Ea)}}Q!==V&&na(Q,N.length,aa.length);return Q}function ia(Q,V,W,ha){let la=0,N=Q[ha*V],aa=Q[ha*(V+1)];for(let ja=1;ja<W;ja++){const oa=N+Q[ha*(V+ja)],ua=aa+Q[ha*(V+ja)+1],za=(oa-N)*(ua+aa);N=oa;aa=ua;la+=za}return.5*la}function na(Q,V=0,W=0){ta(Q.lengths,W);ta(Q.coords,V)}function ta(Q,V=0){Q.length!==V&&(Q.length=V)}const va=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),
xa={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},wa=(Q,V,W,ha,la,N)=>{Q[W]=la;Q[W+1]=N},Ca=(Q,V,W,ha,la,N)=>{Q[W]=la;Q[W+1]=N;Q[W+2]=V[ha+2]},L=(Q,V,W,ha,la,N)=>{Q[W]=la;Q[W+1]=N;Q[W+2]=V[ha+3]},R=(Q,V,W,ha,la,N)=>{Q[W]=la;Q[W+1]=N;Q[W+2]=V[ha+2];Q[W+3]=V[ha+3]},fa=[],ka=[],qa={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};a.convertFromFeature=function(Q,V,W,ha,la){fa[0]=Q;[Q]=ea(ka,fa,V,W,ha,la);ta(fa);ta(ka);
return Q};a.convertFromFeatureSet=function(Q,V){const W=new d,{hasM:ha,hasZ:la,features:N,objectIdFieldName:aa,spatialReference:ja,geometryType:oa,exceededTransferLimit:ua,transform:za,fields:Aa}=Q;Aa&&(W.fields=Aa);W.geometryType=oa??null;W.objectIdFieldName=aa??V??null;W.spatialReference=ja??null;if(!W.objectIdFieldName)return va().error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),W;N&&ea(W.features,N,oa,la,ha,W.objectIdFieldName);ua&&(W.exceededTransferLimit=
ua);ha&&(W.hasM=ha);la&&(W.hasZ=la);za&&(W.transform=za);return W};a.convertFromFeatures=ea;a.convertFromGeometry=function(Q,V,W){if(null==Q)return null;const ha=new f;"hasZ"in Q&&null==V&&(V=Q.hasZ);"hasM"in Q&&null==W&&(W=Q.hasM);if(b.isPoint(Q))return z(null!=V?V:null!=Q.z,null!=W?W:null!=Q.m)(ha,Q);if(b.isPolygon(Q))return T(ha,Q,V,W);if(b.isPolyline(Q))return E(ha,Q,p(V,W));if(b.isMultipoint(Q))return J(ha,Q,p(V,W));va().error("convertFromGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${Q}'`))};
a.convertFromMultipoint=J;a.convertFromMultipointFeatures=F;a.convertFromNestedArray=ba;a.convertFromPoint=H;a.convertFromPointFeatures=D;a.convertFromPolygon=T;a.convertFromPolyline=E;a.convertFromPolylineFeatures=P;a.convertToFeature=function(Q,V,W,ha){ka[0]=Q;ca(fa,ka,V,W,ha);Q=fa[0];ta(fa);ta(ka);return Q};a.convertToFeatureSet=function(Q){const {objectIdFieldName:V,spatialReference:W,transform:ha,fields:la,hasM:N,hasZ:aa,features:ja,geometryType:oa,exceededTransferLimit:ua,uniqueIdField:za,queryGeometry:Aa,
queryGeometryType:Ga}=Q;Q=ca([],ja,oa,aa,N);const Da=X(Aa,Ga,!1,!1);Q={features:Q,fields:la,geometryType:oa,objectIdFieldName:V,spatialReference:W,uniqueIdField:za,queryGeometry:Da};ha&&(Q.transform=ha);ua&&(Q.exceededTransferLimit=ua);N&&(Q.hasM=N);aa&&(Q.hasZ=aa);return Q};a.convertToFeatures=ca;a.convertToGeometry=X;a.convertToMultipoint=A;a.convertToMultipointFeatures=G;a.convertToPoint=function(Q,V,W){return Q?V?W?w(Q):v(Q):W?B(Q):h(Q):null};a.convertToPolygon=M;a.convertToPolyline=K;a.deltaDecodeGeometry=
function(Q,V){if(null==Q)return null;const W=Q.clone(),ha=Q.coords;Q=Q.lengths;let la=0;for(let ja=0;ja<Q.length;ja++){const oa=Q[ja];var N=ha[V*la],aa=ha[V*la+1];for(let ua=1;ua<oa;ua++)N+=ha[V*(la+ua)],aa+=ha[V*(la+ua)+1],W.coords[V*(la+ua)]=N,W.coords[V*(la+ua)+1]=aa;la+=oa}return W};a.deltaEncodeGeometry=function(Q,V){const W=Q.clone(),ha=Q.coords;Q=Q.lengths;let la=0;for(let aa=0;aa<Q.length;aa++){const ja=Q[aa];let oa=ha[V*la];var N=ha[V*la+1];for(let ua=1;ua<ja;ua++){const za=ha[V*(la+ua)],
Aa=ha[V*(la+ua)+1];N=Aa-N;W.coords[V*(la+ua)]=za-oa;W.coords[V*(la+ua)+1]=N;oa=za;N=Aa}la+=ja}return W};a.generalizeOptimizedGeometry=function(Q,V,W,ha,la,N,aa=W,ja=ha){na(Q);if(!V?.coords.length)return null;la=xa[la];const {coords:oa,lengths:ua}=V;V=p(W,ha);const za=p(W&&aa,ha&&ja);W=g(W,ha,aa,ja);if(!ua.length)return W(Q.coords,oa,0,0,oa[0],oa[1]),na(Q,V,0),Q;ha=0;N*=N;for(const Aa of ua){if(Aa<la){ha+=Aa*V;continue}aa=Q.coords.length/za;ja=ha;const Ga=ha+(Aa-1)*V;W(Q.coords,oa,Q.coords.length,
ja,oa[ja],oa[ja+1]);S(Q.coords,oa,V,N,W,ja,Ga);W(Q.coords,oa,Q.coords.length,Ga,oa[Ga],oa[Ga+1]);ja=Q.coords.length/za-aa;ja>=la?Q.lengths.push(ja):ta(Q.coords,aa*za);ha+=Aa*V}return Q.coords.length?Q:null};a.getBoundsOptimizedGeometry=function(Q,V,W,ha){if(!V?.coords?.length)return null;W=p(W,ha);let la=ha=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,aa=Number.NEGATIVE_INFINITY;if(V&&V.coords){V=V.coords;for(let ja=0;ja<V.length;ja+=W){const oa=V[ja],ua=V[ja+1];ha=Math.min(ha,oa);N=Math.max(N,
oa);la=Math.min(la,ua);aa=Math.max(aa,ua)}}l.is(Q)?l.fromRectValues(Q,ha,la,N,aa):m.fromValues(ha,la,N,aa,Q);return Q};a.getQuantizedArea=function(Q,V){const {coords:W,lengths:ha}=Q;let la=Q=0;for(let N=0;N<ha.length;N++){const aa=ha[N];la+=ia(W,Q,aa,V);Q+=aa}return Math.abs(la)};a.getQuantizedBoundsOptimizedGeometry=function(Q,V,W,ha){W=p(W,ha);const {lengths:la,coords:N}=V;ha=V=Number.POSITIVE_INFINITY;let aa=Number.NEGATIVE_INFINITY,ja=Number.NEGATIVE_INFINITY,oa=0;for(const ua of la){let za=N[oa],
Aa=N[oa+1];V=Math.min(za,V);ha=Math.min(Aa,ha);aa=Math.max(za,aa);ja=Math.max(Aa,ja);oa+=W;for(let Ga=1;Ga<ua;Ga++,oa+=W){const Da=N[oa],Ha=N[oa+1];za+=Da;Aa+=Ha;0>Da&&(V=Math.min(V,za));0<Da&&(aa=Math.max(aa,za));0>Ha?ha=Math.min(ha,Aa):0<Ha&&(ja=Math.max(ja,Aa))}}Q[0]=V;Q[1]=ha;Q[2]=aa;Q[3]=ja;return Q};a.getSignedQuantizedRingArea=ia;a.quantizeOptimizedFeatureSet=function(Q,V){const {geometryType:W,features:ha,hasM:la,hasZ:N}=V;if(!Q)return V;for(let aa=0;aa<ha.length;aa++){const ja=ha[aa],oa=
ja.weakClone();oa.geometry=new f;ma(oa.geometry,ja.geometry,la,N,W,Q);ja.centroid&&(oa.centroid=new f,ma(oa.centroid,ja.centroid,la,N,"esriGeometryPoint",Q));ha[aa]=oa}V.transform=Q;return V};a.quantizeOptimizedGeometry=ma;a.quantizeX=x;a.quantizeY=n;a.removeCollinearVertices=function(Q,V,W,ha,la){if(!V?.coords?.length)return null;W=xa[W];const {coords:N,lengths:aa}=V;V=g(ha,la,ha,la);ha=p(ha,la);let ja=la=0,oa=0,ua=0;for(const Ga of aa){ja=ua;V(Q.coords,N,ja,la,N[la],N[la+1]);la+=ha;var za=N[la];
let Da=N[la+1],Ha=za,Fa=Da;var Aa=Da/za;ja+=ha;V(Q.coords,N,ja,la,Ha,Fa);la+=ha;for(let Ea=2;Ea<Ga;Ea++){za=N[la];Da=N[la+1];const Ka=Da/za,Sa=Aa===Ka||!isFinite(Aa)&&!isFinite(Ka);Aa=Sa&&isFinite(Ka)?0<=Aa&&0<=Ka||0>=Aa&&0>=Ka:0<=Fa&&0<=Da||0>=Fa&&0>=Da;Sa&&Aa?(Ha+=za,Fa+=Da):(Ha=za,Fa=Da,ja+=ha);V(Q.coords,N,ja,la,Ha,Fa);la+=ha;Aa=Ka}ja+=ha;za=(ja-ua)/ha;za>=W&&(Q.lengths[oa]=za,ua=ja,oa++)}Q.coords.length>ua&&(Q.coords.length=ua);Q.lengths.length>oa&&(Q.lengths.length=oa);return Q.coords.length&&
Q.lengths.length?Q:null};a.removeZMValues=function(Q,V,W,ha,la,N){na(Q);Q.lengths.push(...V.lengths);if(W===la&&ha===N)for(var aa=0;aa<V.coords.length;aa++)Q.coords.push(V.coords[aa]);else for(aa=p(W,ha),W=g(W,ha,la,N),V=V.coords,ha=0;ha<V.length;ha+=aa)W(Q.coords,V,Q.coords.length,ha,V[ha],V[ha+1]);return Q};a.unquantizeOptimizedFeatureSet=function(Q){const {transform:V,features:W,hasM:ha,hasZ:la}=Q;if(!V)return Q;for(const N of W)null!=N.geometry&&Y(N.geometry,N.geometry,ha,la,V),null!=N.centroid&&
Y(N.centroid,N.centroid,ha,la,V);Q.transform=null;return Q};a.unquantizeOptimizedGeometry=Y;a.unquantizeValue=e;a.unquantizeX=function(Q,V){return e(Q,V,0)};a.unquantizeY=function(Q,V){return e(Q,-V,1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect"],function(a,q,r){function k(e=x){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function l(e,h,u,v,y,B,t=k()){t[0]=e;t[1]=h;t[2]=u;t[3]=v;t[4]=y;
t[5]=B;return t}function m(e){return e[0]>=e[3]?0:e[3]-e[0]}function b(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,h){return Math.max(h[0],e[0])<=Math.min(h[3],e[3])&&Math.max(h[1],e[1])<=Math.min(h[4],e[4])&&Math.max(h[2],e[2])<=Math.min(h[5],e[5])}function f(e,h){e[0]=h[0];e[1]=h[1];e[2]=h[2];e[3]=h[3];e[4]=h[4];e[5]=h[5];return e}function p(e){return 6===e.length}const g=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],x=[0,0,0,0,0,0],n=k();
a.allFinite=function(e){for(let h=0;6>h;h++)if(!isFinite(e[h]))return!1;return!0};a.center=function(e,h=[0,0,0]){h[0]=e[0]+m(e)/2;h[1]=e[1]+b(e)/2;h[2]=e[2]+c(e)/2;return h};a.contains=function(e,h){return h[0]>=e[0]&&h[1]>=e[1]&&h[2]>=e[2]&&h[3]<=e[3]&&h[4]<=e[4]&&h[5]<=e[5]};a.containsPoint=function(e,h){return h[0]>=e[0]&&h[1]>=e[1]&&h[2]>=e[2]&&h[0]<=e[3]&&h[1]<=e[4]&&h[2]<=e[5]};a.containsPointWithMargin=function(e,h,u){return h[0]>=e[0]-u&&h[1]>=e[1]-u&&h[2]>=e[2]-u&&h[0]<=e[3]+u&&h[1]<=e[4]+
u&&h[2]<=e[5]+u};a.create=k;a.depth=b;a.diameter=function(e){const h=m(e),u=c(e);e=b(e);return Math.sqrt(h*h+u*u+e*e)};a.empty=function(e){return e?f(e,g):k(g)};a.equals=function(e,h,u){if(null==e||null==h)return e===h;if(!p(e)||!p(h))return!1;if(u)for(let v=0;v<e.length;v++){if(!u(e[v],h[v]))return!1}else for(u=0;u<e.length;u++)if(e[u]!==h[u])return!1;return!0};a.expandWithAABB=function(e,h){e[0]=Math.min(e[0],h[0]);e[1]=Math.min(e[1],h[1]);e[2]=Math.min(e[2],h[2]);e[3]=Math.max(e[3],h[3]);e[4]=
Math.max(e[4],h[4]);e[5]=Math.max(e[5],h[5])};a.expandWithBuffer=function(e,h,u=0,v=h.length/3){let y=e[0],B=e[1],t=e[2],w=e[3],C=e[4],z=e[5];for(let D=0;D<v;D++)y=Math.min(y,h[u+3*D]),B=Math.min(B,h[u+3*D+1]),t=Math.min(t,h[u+3*D+2]),w=Math.max(w,h[u+3*D]),C=Math.max(C,h[u+3*D+1]),z=Math.max(z,h[u+3*D+2]);e[0]=y;e[1]=B;e[2]=t;e[3]=w;e[4]=C;e[5]=z};a.expandWithNestedArray=function(e,h,u){const v=h.length;let y=e[0],B=e[1],t=e[2],w=e[3],C=e[4],z=e[5];if(u)for(u=0;u<v;u++){var D=h[u];y=Math.min(y,D[0]);
B=Math.min(B,D[1]);t=Math.min(t,D[2]);w=Math.max(w,D[0]);C=Math.max(C,D[1]);z=Math.max(z,D[2])}else for(u=0;u<v;u++)D=h[u],y=Math.min(y,D[0]),B=Math.min(B,D[1]),w=Math.max(w,D[0]),C=Math.max(C,D[1]);e[0]=y;e[1]=B;e[2]=t;e[3]=w;e[4]=C;e[5]=z};a.expandWithOffset=function(e,h,u,v){e[0]=Math.min(e[0],e[0]+h);e[3]=Math.max(e[3],e[3]+h);e[1]=Math.min(e[1],e[1]+u);e[4]=Math.max(e[4],e[4]+u);e[2]=Math.min(e[2],e[2]+v);e[5]=Math.max(e[5],e[5]+v)};a.expandWithRect=function(e,h){e[0]=Math.min(e[0],h[0]);e[1]=
Math.min(e[1],h[1]);e[3]=Math.max(e[3],h[2]);e[4]=Math.max(e[4],h[3])};a.expandWithVec3=function(e,h){e[0]=Math.min(e[0],h[0]);e[1]=Math.min(e[1],h[1]);e[2]=Math.min(e[2],h[2]);e[3]=Math.max(e[3],h[0]);e[4]=Math.max(e[4],h[1]);e[5]=Math.max(e[5],h[2])};a.fromExtent=function(e,h=k()){h[0]=e.xmin;h[1]=e.ymin;h[2]=e.hasZ?e.zmin:-Infinity;h[3]=e.xmax;h[4]=e.ymax;h[5]=e.hasZ?e.zmax:Infinity;return h};a.fromMinMax=function(e,h,u=k()){u[0]=e[0];u[1]=e[1];u[2]=e[2];u[3]=h[0];u[4]=h[1];u[5]=h[2];return u};
a.fromRect=function(e,h){e[0]=h[0];e[1]=h[1];e[2]=Number.NEGATIVE_INFINITY;e[3]=h[2];e[4]=h[3];e[5]=Number.POSITIVE_INFINITY;return e};a.fromRectValues=function(e,h,u,v,y){e[0]=h;e[1]=u;e[2]=Number.NEGATIVE_INFINITY;e[3]=v;e[4]=y;e[5]=Number.POSITIVE_INFINITY;return e};a.fromValues=l;a.getMax=function(e,h){h[0]=e[3];h[1]=e[4];h[2]=e[5];return h};a.getMin=function(e,h){h[0]=e[0];h[1]=e[1];h[2]=e[2];return h};a.height=c;a.intersects=d;a.intersectsClippingArea=function(e,h){return null==h?!0:d(e,h)};
a.is=p;a.isPoint=function(e){return 0===m(e)&&0===b(e)&&0===c(e)};a.maximumDimension=function(e){return Math.max(m(e),c(e),b(e))};a.negativeInfinity=g;a.offset=function(e,h,u,v,y=e){y[0]=e[0]+h;y[1]=e[1]+u;y[2]=e[2]+v;y[3]=e[3]+h;y[4]=e[4]+u;y[5]=e[5]+v;return y};a.positiveInfinity=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];a.scale=function(e,h,u=e){const v=e[0]+m(e)/2,y=e[1]+b(e)/2,B=e[2]+c(e)/2;u[0]=v+(e[0]-v)*h;u[1]=y+(e[1]-y)*h;u[2]=B+(e[2]-B)*h;u[3]=v+(e[3]-v)*h;u[4]=y+(e[4]-
y)*h;u[5]=B+(e[5]-B)*h;return u};a.set=f;a.setMax=function(e,h,u=e){u[3]=h[0];u[4]=h[1];u[5]=h[2];u!==e&&(u[0]=e[0],u[1]=e[1],u[2]=e[2]);return e};a.setMin=function(e,h,u=e){u[0]=h[0];u[1]=h[1];u[2]=h[2];u!==e&&(u[3]=e[3],u[4]=e[4],u[5]=e[5]);return u};a.size=function(e,h=[0,0,0]){h[0]=m(e);h[1]=b(e);h[2]=c(e);return h};a.toExtent=function(e,h){return isFinite(e[2])||isFinite(e[5])?new q({xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:h}):new q({xmin:e[0],xmax:e[3],ymin:e[1],
ymax:e[4],spatialReference:h})};a.toRect=function(e,h){h||=r.create();h[0]=e[0];h[1]=e[1];h[2]=e[3];h[3]=e[4];return h};a.width=m;a.wrap=function(e,h,u,v,y,B){return l(e,h,u,v,y,B,n)};a.zero=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports"],function(a){class q{constructor(k=null,l={},m,b){this.geometry=k;this.attributes=l;this.centroid=m;this.objectId=b;this.geohashY=this.geohashX=this.displayId=0}weakClone(){const k=
new q(this.geometry,this.attributes,this.centroid,this.objectId);k.displayId=this.displayId;k.geohashX=this.geohashX;k.geohashY=this.geohashY;return k}clone(){var k=this.geometry?.clone();k=new q(k,{...this.attributes},this.centroid?.clone(),this.objectId);k.displayId=this.displayId;k.geohashX=this.geohashX;k.geohashY=this.geohashY;return k}}class r extends q{}a.OptimizedFeature=q;a.OptimizedFeatureWithGeometry=r;a.hasGeometry=function(k){return!!k.geometry?.coords?.length};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){class a{constructor(){this.spatialReference=this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1;this.queryGeometry=this.queryGeometryType=this.uniqueIdField=null}weakClone(){const q=new a;q.objectIdFieldName=this.objectIdFieldName;
q.globalIdFieldName=this.globalIdFieldName;q.geohashFieldName=this.geohashFieldName;q.geometryProperties=this.geometryProperties;q.geometryType=this.geometryType;q.spatialReference=this.spatialReference;q.hasZ=this.hasZ;q.hasM=this.hasM;q.features=this.features;q.fields=this.fields;q.transform=this.transform;q.exceededTransferLimit=this.exceededTransferLimit;q.uniqueIdField=this.uniqueIdField;q.queryGeometry=this.queryGeometry;q.queryGeometryType=this.queryGeometryType;return q}}return a})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,q,r,k,l,m,b){function c(h,u){if(!u)return null;if("x"in u){var v={x:0,y:0};[v.x,v.y]=h(u.x,u.y,p);null!=u.z&&(v.z=u.z);null!=u.m&&(v.m=u.m);return v}return"xmin"in u?(v={xmin:0,ymin:0,xmax:0,ymax:0},[v.xmin,v.ymin]=h(u.xmin,u.ymin,p),[v.xmax,v.ymax]=h(u.xmax,u.ymax,p),u.hasZ&&(v.zmin=u.zmin,v.zmax=u.zmax,v.hasZ=!0),u.hasM&&(v.mmin=u.mmin,v.mmax=u.mmax,v.hasM=!0),v):"rings"in u?{rings:d(u.rings,h),hasM:u.hasM,hasZ:u.hasZ}:"paths"in u?{paths:d(u.paths,h),hasM:u.hasM,hasZ:u.hasZ}:"points"in
u?{points:f(u.points,h),hasM:u.hasM,hasZ:u.hasZ}:null}function d(h,u){const v=[];for(const y of h)v.push(f(y,u));return v}function f(h,u){const v=[];for(const y of h)h=u(y[0],y[1],[0,0]),v.push(h),2<y.length&&h.push(y[2]),3<y.length&&h.push(y[3]);return v}const p=[0,0],g=c.bind(null,b.lngLatToXY),x=c.bind(null,b.xyToLngLat);class n{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(h,u,v,y){if(!h?.length||!u||!v||m.equals(u,v))return h;h={geometries:h,inSpatialReference:u,
outSpatialReference:v,geographicTransformation:y,resolve:r.createResolver()};this._jobs.push(h);this._timer??(this._timer=setTimeout(this._process,10));return h.resolve.promise}_process(){this._timer=null;const h=this._jobs.shift();if(h){var {geometries:u,inSpatialReference:v,outSpatialReference:y,resolve:B,geographicTransformation:t}=h;b.canProject(v,y)?m.isWebMercator(y)?B(u.map(g)):B(u.map(x)):B(k.projectMany(l.jsonAdapter,u,v,y,t,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const e=new n;a.checkProjectionSupport=async function(h,u){h&&u&&(h=Array.isArray(h)?h.map(v=>null!=v.geometry?v.geometry.spatialReference:null).filter(q.isSome):[h],await k.initializeProjection(h.map(v=>({source:v,dest:u}))))};a.project=function(h,u,v,y){if(!h)return h;v||(v=u,u=h.spatialReference);return m.isValid(u)&&m.isValid(v)&&!m.equals(u,v)?b.canProject(u,v)?(h=m.isWebMercator(v)?g(h):x(h),h.spatialReference=v,h):k.projectMany(l.jsonAdapter,[h],u,v,null,y)[0]:h};a.projectMany=function(h,
u,v,y){return e.push(h,u,v,y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class q{constructor(b,c,d){this.x=b;this.y=c;this.spatialReference=d;this.m=this.z=void 0}}class r{constructor(b,c,d,f){this.rings=b;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);f&&(this.hasM=f)}}class k{constructor(b,c,d,f){this.paths=b;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=
d);f&&(this.hasM=f)}}class l{constructor(b,c,d,f){this.points=b;this.spatialReference=c;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);f&&(this.hasM=f)}}class m{constructor(b,c,d,f,p){this.xmin=b;this.ymin=c;this.xmax=d;this.ymax=f;this.spatialReference=p;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(b,c){return null==c?null:b.convertJSONToGeometry(c)},exportPoint:function(b,c,d){d=new q(b.getPointX(c),b.getPointY(c),d);const f=b.hasZ(c),p=b.hasM(c);f&&(d.z=
b.getPointZ(c));p&&(d.m=b.getPointM(c));return d},exportPolygon:function(b,c,d){return new r(b.exportPaths(c),d,b.hasZ(c),b.hasM(c))},exportPolyline:function(b,c,d){return new k(b.exportPaths(c),d,b.hasZ(c),b.hasM(c))},exportMultipoint:function(b,c,d){return new l(b.exportPoints(c),d,b.hasZ(c),b.hasM(c))},exportExtent:function(b,c,d){var f=b.hasZ(c);const p=b.hasM(c);d=new m(b.getXMin(c),b.getYMin(c),b.getXMax(c),b.getYMax(c),d);f&&(f=b.getZExtent(c),d.zmin=f.vmin,d.zmax=f.vmax);p&&(b=b.getMExtent(c),
d.mmin=b.vmin,d.mmax=b.vmax);return d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/ComputedAggregateField":function(){define(["exports","../support/DictionaryValue"],function(a,q){class r{static async create(k,l){if("count"===l.statisticType)return k=new q.DictionaryValue(1),new r(l.name,l.alias,l.type,l.statisticType,k);k=await k.createComputedField({expression:l.onStatisticExpression?.expression,field:l.onStatisticField});return new r(l.name,
l.alias,l.type,l.statisticType,k)}constructor(k,l,m,b,c){this.name=k;this.alias=l;this.type=m;this.statisticType=b;this.computed=c}}a.ComputedAggregateField=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AAggregateStrategy":function(){define(["exports","../../../../../layers/graphics/data/QueryEngine","../../../../../layers/support/FieldsIndex","./AProcessorStrategy"],function(a,q,r,k){class l extends k.AProcessorStrategy{constructor(m,b,
c,d){super(m,b);this.spatialReference=c;this.aggregateFields=d}get aggregateQueryEngine(){this._aggregateQueryEngine||(this._aggregateQueryEngine=new q.QueryEngine({featureStore:this,fieldsIndex:new r(this.aggregateFields),geometryType:"esriGeometryPolygon",objectIdField:"aggregateId",hasM:!1,hasZ:!1,spatialReference:this.spatialReference,cacheSpatialQueries:!0}));return this._aggregateQueryEngine}}a.AAggregateStrategy=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B,t,w,C,z,D,H,G,A){class F{constructor(E,M=null,T,ba,ea){this.attributes=E;this.geometry=T;this.centroid=ba;this.filterFlags=ea;this.groupId=-1;this.displayId=M}}const J=new b.MemCacheStorage(2E6);let K=0;class P{constructor(E){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:t.queryCapabilities};this.geometryType=E.geometryType;this.hasM=!!E.hasM;this.hasZ=!!E.hasZ;this.objectIdField=E.objectIdField;this.spatialReference=E.spatialReference;
this.definitionExpression=E.definitionExpression;this.featureStore=E.featureStore;this.aggregateAdapter=E.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=E.timeInfo;E.cacheSpatialQueries&&(this._geometryQueryCache=new b.MemCache(K++ +"$$",J));this.fieldsIndex=k.isSerializable(E.fieldsIndex)?E.fieldsIndex:G.fromJSON(E.fieldsIndex);this.availableFields=null==E.availableFields?new Set(this.fieldsIndex.fields.map(M=>M.name)):new Set(E.availableFields.map(M=>
this.fieldsIndex.get(M)?.name).filter(M=>null!=M));E.scheduler&&E.priority&&(this._frameTask=E.scheduler.registerTask(E.priority))}destroy(){this._frameTask=m.removeMaybe(this._frameTask);this.clearCache();m.destroyMaybe(this._geometryQueryCache);this._changeHandle=m.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(E,
M){M=c.signalFromSignalOrOptions(M);try{return(await this._executeQuery(E,{},M)).createQueryResponse()}catch(T){if(T!==C.queryEngineEmptyResult)throw T;return(new w.QueryEngineResult([],E,this)).createQueryResponse()}}async executeQueryForCount(E={},M){M=c.signalFromSignalOrOptions(M);try{return(await this._executeQuery(E,{returnGeometry:!1,returnCentroid:!1,outSR:null},M)).createQueryResponseForCount()}catch(T){if(T!==C.queryEngineEmptyResult)throw T;return 0}}async executeQueryForExtent(E,M){M=
c.signalFromSignalOrOptions(M);const T=E.outSR;try{const ba=await this._executeQuery(E,{returnGeometry:!0,returnCentroid:!1,outSR:null},M),ea=ba.size;if(!ea)return{count:0,extent:null};const X=await this._getBounds(ba.items,ba.spatialReference,T||this.spatialReference);return{count:ea,extent:X}}catch(ba){if(ba===C.queryEngineEmptyResult)return{count:0,extent:null};throw ba;}}async executeQueryForIds(E,M){return this.executeQueryForIdSet(E,M).then(T=>Array.from(T))}async executeQueryForIdSet(E,M){M=
c.signalFromSignalOrOptions(M);try{const T=await this._executeQuery(E,{returnGeometry:!0,returnCentroid:!1,outSR:null},M),ba=T.items,ea=new Set;await this._reschedule(()=>{for(const X of ba)ea.add(T.featureAdapter.getObjectId(X))},M);return ea}catch(T){if(T===C.queryEngineEmptyResult)return new Set;throw T;}}async executeQueryForSnapping(E,M){const T=c.signalFromSignalOrOptions(M),{point:ba,distance:ea,returnEdge:X,vertexMode:ca}=E;if(!X&&"none"===ca)return{candidates:[]};let ma=l.clone(E.query);
ma=await this._schedule(()=>C.normalizeQueryLike(ma,this.definitionExpression,this.spatialReference),T);ma=await this._reschedule(()=>z.validateQuery(ma,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),T);(M=!h.equals(ba.spatialReference,this.spatialReference))&&await B.checkProjectionSupport(ba.spatialReference,this.spatialReference);var S="number"===typeof ea?ea:ea.x,Y="number"===typeof ea?ea:ea.y;S={xmin:ba.x-
S,xmax:ba.x+S,ymin:ba.y-Y,ymax:ba.y+Y,spatialReference:ba.spatialReference};S=M?B.project(S,this.spatialReference):S;if(!S)return{candidates:[]};Y=(await e.normalizeCentralMeridian(n.fromJSON(ba),null,{signal:T}))[0];const ia=(await e.normalizeCentralMeridian(n.fromJSON(S),null,{signal:T}))[0];if(null==Y||null==ia)return{candidates:[]};const na=new w.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(ia.toJSON())),T),ma,this);await this._reschedule(()=>this._executeObjectIdsQuery(na),
T);await this._reschedule(()=>this._executeTimeQuery(na),T);await this._reschedule(()=>this._executeAttributesQuery(na),T);await this._reschedule(()=>this._executeGeometryQueryForSnapping(na,T),T);Y=Y.toJSON();Y=M?B.project(Y,this.spatialReference):Y;return na.createSnappingResponse({...E,point:Y,distance:M?Math.max(S.xmax-S.xmin,S.ymax-S.ymin)/2:ea},ba.spatialReference)}async executeQueryForLatestObservations(E,M){M=c.signalFromSignalOrOptions(M);if(!this.timeInfo?.trackIdField)throw new r("unsupported-query",
"Missing timeInfo or timeInfo.trackIdField",{query:E,timeInfo:this.timeInfo});try{const T=await this._executeQuery(E,{},M);await this._reschedule(()=>this._filterLatest(T),M);return T.createQueryResponse()}catch(T){if(T!==C.queryEngineEmptyResult)throw T;return(new w.QueryEngineResult([],E,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(E={},M,T){T=c.signalFromSignalOrOptions(T);const {field:ba,normalizationField:ea,valueExpression:X}=M;return(await this._executeQueryForStatistics(E,
{field:ba,normalizationField:ea,valueExpression:X},T)).createSummaryStatisticsResponse(M)}async executeQueryForUniqueValues(E={},M,T){T=c.signalFromSignalOrOptions(T);const {field:ba,field2:ea,field3:X,valueExpression:ca}=M;return(await this._executeQueryForStatistics(E,{field:ba,field2:ea,field3:X,valueExpression:ca},T)).createUniqueValuesResponse(M)}async executeQueryForClassBreaks(E={},M,T){T=c.signalFromSignalOrOptions(T);const {field:ba,normalizationField:ea,valueExpression:X}=M;return(await this._executeQueryForStatistics(E,
{field:ba,normalizationField:ea,valueExpression:X},T)).createClassBreaksResponse(M)}async executeQueryForHistogram(E={},M,T){T=c.signalFromSignalOrOptions(T);const {field:ba,normalizationField:ea,valueExpression:X}=M;return(await this._executeQueryForStatistics(E,{field:ba,normalizationField:ea,valueExpression:X},T)).createHistogramResponse(M)}async fetchRecomputedExtents(E){E=c.signalFromSignalOrOptions(E);this._timeExtentPromise||(this._timeExtentPromise=H.getTimeExtent(this.timeInfo,this.featureStore));
const [M,T]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);c.throwIfAborted(E);return{fullExtent:M,timeExtent:T}}async _getBounds(E,M,T){const ba=p.set(p.create(),p.negativeInfinity);await this.featureStore.forEachBounds(E,ea=>p.expandWithAABB(ba,ea));E={xmin:ba[0],ymin:ba[1],xmax:ba[3],ymax:ba[4],spatialReference:y.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(ba[2])&&isFinite(ba[5])&&(E.zmin=ba[2],E.zmax=ba[5]);M=B.project(E,M,T);M.spatialReference=y.cleanFromGeometryEngine(T);
0===M.xmax-M.xmin&&(T=d.getMetersPerUnitForSR(M.spatialReference),M.xmin-=T,M.xmax+=T);0===M.ymax-M.ymin&&(T=d.getMetersPerUnitForSR(M.spatialReference),M.ymin-=T,M.ymax+=T);this.hasZ&&null!=M.zmin&&null!=M.zmax&&0===M.zmax-M.zmin&&(T=d.getMetersPerUnitForSR(M.spatialReference),M.zmin-=T,M.zmax+=T);return M}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):
this._getAllFeatures().then(E=>this._getBounds(E,this.spatialReference,this.spatialReference)));return this._fullExtentPromise}async _schedule(E,M){return null!=this._frameTask?this._frameTask.schedule(E,M):E(A.noBudget)}async _reschedule(E,M){return null!=this._frameTask?this._frameTask.reschedule(E,M):E(A.noBudget)}async _getAllFeaturesQueryEngineResult(E){return new w.QueryEngineResult(await this._getAllFeatures(),E,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const T=[];this._allFeaturesPromise=
(async()=>{await this.featureStore.forEach(ba=>T.push(ba))})().then(()=>T)}const E=this._allFeaturesPromise,M=await E;return E===this._allFeaturesPromise?M.slice():this._getAllFeatures()}async _executeQuery(E,M,T){E=l.clone(E);E=await this._schedule(()=>C.normalizeQuery(E,this.definitionExpression,this.spatialReference),T);E=await this._reschedule(()=>z.validateQuery(E,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),
T);E={...E,...M};const ba=await this._reschedule(()=>this._executeSceneFilterQuery(E,T),T),ea=await this._reschedule(()=>this._executeGeometryQuery(E,ba,T),T);await this._reschedule(()=>this._executeAggregateIdsQuery(ea),T);await this._reschedule(()=>this._executeObjectIdsQuery(ea),T);await this._reschedule(()=>this._executeTimeQuery(ea),T);await this._reschedule(()=>this._executeAttributesQuery(ea),T);return ea}async _executeSceneFilterQuery(E,M){if(null==E.sceneFilter)return null;const {outSR:T,
returnGeometry:ba,returnCentroid:ea}=E;var X=this.featureStore.featureSpatialReference,ca=E.sceneFilter.geometry;const ma=null==X||h.equals(X,ca.spatialReference)?ca:B.project(ca,X);if(!ma)return null;X=ba||ea;X=h.isValid(T)&&!h.equals(this.spatialReference,T)&&X?async na=>this._project(na,T):na=>na;const S=this.featureAdapter;ca=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(ma)),M);if("disjoint"===E.sceneFilter.spatialRelationship){if(!ca.length)return null;const na=new Set;
for(var Y of ca)na.add(S.getObjectId(Y));const ta=await this._reschedule(()=>this._getAllFeatures(),M);Y=await this._reschedule(async()=>{const va=await D.getSpatialQueryOperator("esriSpatialRelDisjoint",ma,this.geometryType,this.hasZ,this.hasM),xa=await this._runSpatialFilter(ta,wa=>!na.has(S.getObjectId(wa))||va(S.getGeometry(wa)),M);return new w.QueryEngineResult(xa,E,this)},M);return X(Y)}if(!ca.length)return new w.QueryEngineResult([],E,this);if(this._canExecuteSinglePass(ma,E))return X(new w.QueryEngineResult(ca,
E,this));const ia=await D.getSpatialQueryOperator("esriSpatialRelContains",ma,this.geometryType,this.hasZ,this.hasM);Y=await this._runSpatialFilter(ca,na=>ia(S.getGeometry(na)),M);return X(new w.QueryEngineResult(Y,E,this))}async _executeGeometryQuery(E,M,T){if(null!=M&&0===M.items.length)return M;E=null!=M?M.query:E;const {geometry:ba,outSR:ea,spatialRel:X,returnGeometry:ca,returnCentroid:ma}=E;var S=this.featureStore.featureSpatialReference;const Y=!ba||null==S||h.equals(S,ba.spatialReference)?
ba:B.project(ba,S),ia=ca||ma,na=h.isValid(ea)&&!h.equals(this.spatialReference,ea),ta=this._geometryQueryCache&&null==M?na&&ia?JSON.stringify({originalFilterGeometry:ba,spatialRelationship:X,outSpatialReference:ea}):JSON.stringify({originalFilterGeometry:ba,spatialRelationship:X}):null;S=ta?this._geometryQueryCache.get(ta):null;if(null!=S)return new w.QueryEngineResult(S,E,this);S=async L=>{na&&ia&&await this._project(L,ea);ta&&this._geometryQueryCache.put(ta,L.items,L.items.length+1);return L};if(!Y)return S(null!=
M?M:await this._getAllFeaturesQueryEngineResult(E));const va=this.featureAdapter;let xa=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(ba)),T);if("esriSpatialRelDisjoint"===X){if(!xa.length)return S(null!=M?M:await this._getAllFeaturesQueryEngineResult(E));const L=new Set;for(var wa of xa)L.add(va.getObjectId(wa));const R=null!=M?M.items:await this._reschedule(()=>this._getAllFeatures(),T);wa=await this._reschedule(async()=>{const fa=await D.getSpatialQueryOperator(X,Y,this.geometryType,
this.hasZ,this.hasM),ka=await this._runSpatialFilter(R,qa=>!L.has(va.getObjectId(qa))||fa(va.getGeometry(qa)),T);return new w.QueryEngineResult(ka,E,this)},T);return S(wa)}if(null!=M){const L=new q.PositionHint;xa=xa.filter(R=>0<=q.indexOf(M.items,R,M.items.length,L))}if(!xa.length)return S=new w.QueryEngineResult([],E,this),ta&&this._geometryQueryCache.put(ta,S.items,1),S;if(this._canExecuteSinglePass(Y,E))return S(new w.QueryEngineResult(xa,E,this));const Ca=await D.getSpatialQueryOperator(X,Y,
this.geometryType,this.hasZ,this.hasM);wa=await this._runSpatialFilter(xa,L=>Ca(va.getGeometry(L)),T);return S(new w.QueryEngineResult(wa,E,this))}async _executeGeometryQueryForSnapping(E,M){const {query:T}=E,{spatialRel:ba}=T;if(E?.items?.length&&T.geometry&&ba){var ea=await D.getSpatialQueryOperator(ba,T.geometry,this.geometryType,this.hasZ,this.hasM);M=await this._runSpatialFilter(E.items,X=>ea(X.geometry),M);E.items=M}}_executeAggregateIdsQuery(E){if(0!==E.items.length&&E.query.aggregateIds?.length&&
null!=this.aggregateAdapter){var M=new Set;for(const ba of E.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(ba).forEach(ea=>M.add(ea));var T=this.featureAdapter.getObjectId;E.items=E.items.filter(ba=>M.has(T(ba)))}}_executeObjectIdsQuery(E){if(0!==E.items.length&&E.query.objectIds?.length){var M=new Set(E.query.objectIds),T=this.featureAdapter.getObjectId;E.items=E.items.filter(ba=>M.has(T(ba)))}}_executeTimeQuery(E){if(0!==E.items.length){var M=H.getTimeOperator(this.timeInfo,E.query.timeExtent,
this.featureAdapter);null!=M&&(E.items=E.items.filter(M))}}_executeAttributesQuery(E){if(0!==E.items.length){var M=v.getWhereClause(E.query.where,this.fieldsIndex);if(M){if(!M.isStandardized)throw new TypeError("Where clause is not standardized");E.items=E.items.filter(T=>M.testFeature(T,this.featureAdapter))}}}async _runSpatialFilter(E,M,T){if(!M)return E;if(null==this._frameTask)return E.filter(ca=>M(ca));let ba=0;const ea=[],X=async ca=>{for(;ba<E.length;){const ma=E[ba++];M(ma)&&(ea.push(ma),
ca.madeProgress());ca.done&&await this._reschedule(S=>X(S),T)}};return this._reschedule(ca=>X(ca),T).then(()=>ea)}_filterLatest(E){const {trackIdField:M,startTimeField:T,endTimeField:ba}=this.timeInfo,ea=ba||T,X=new Map,ca=this.featureAdapter.getAttribute;for(const ma of E.items){const S=ca(ma,M),Y=ca(ma,ea),ia=X.get(S);(!ia||Y>ca(ia,ea))&&X.set(S,ma)}E.items=Array.from(X.values())}_canExecuteSinglePass(E,M){({spatialRel:M}=M);return D.canQueryWithRBush(E)&&("esriSpatialRelEnvelopeIntersects"===M||
"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===M||"esriSpatialRelContains"===M))}async _project(E,M){if(!M||h.equals(this.spatialReference,M))return E;const T=this.featureAdapter;let ba=void 0;try{const ea=await this._getFullExtent();ba=f.getTransformation(this.spatialReference,M,ea)}catch{}M=await B.projectMany(E.items.map(ea=>y.getGeometry(this.geometryType,this.hasZ,this.hasM,T.getGeometry(ea))),this.spatialReference,M,ba);E.items=M.map((ea,X)=>T.cloneWithGeometry(E.items[X],
u.convertFromGeometry(ea,this.hasZ,this.hasM)));return E}_getQueryBBoxes(E){if(D.canQueryWithRBush(E)){if(n.isExtent(E))return[g.fromValues(Math.min(E.xmin,E.xmax),Math.min(E.ymin,E.ymax),Math.max(E.xmin,E.xmax),Math.max(E.ymin,E.ymax))];if(n.isPolygon(E))return E.rings.map(M=>g.fromValues(Math.min(M[0][0],M[2][0]),Math.min(M[0][1],M[2][1]),Math.max(M[0][0],M[2][0]),Math.max(M[0][1],M[2][1])))}return[x.getBoundsXY(g.create(),E)]}async _searchFeatures(E){const M=new Set;await Promise.all(E.map(T=>
this.featureStore.forEachInBounds(T,ba=>M.add(ba))));E=Array.from(M.values());M.clear();return E}async _executeQueryForStatistics(E,M,T){E=l.clone(E);try{E=await this._schedule(()=>C.normalizeQuery(E,this.definitionExpression,this.spatialReference),T);E=await this._reschedule(()=>z.validateStatisticsQuery(E,M,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),T);const ba=await this._reschedule(()=>this._executeSceneFilterQuery(E,
T),T),ea=await this._reschedule(()=>this._executeGeometryQuery(E,ba,T),T);await this._reschedule(()=>this._executeAggregateIdsQuery(ea),T);await this._reschedule(()=>this._executeObjectIdsQuery(ea),T);await this._reschedule(()=>this._executeTimeQuery(ea),T);await this._reschedule(()=>this._executeAttributesQuery(ea),T);return ea}catch(ba){if(ba!==C.queryEngineEmptyResult)throw ba;return new w.QueryEngineResult([],E,this)}}}a.Feature=F;a.QueryEngine=P;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/MemCache":function(){define(["exports","./PooledArray"],function(a,q){a.RemoveMode=void 0;(function(b){b[b.ALL=0]="ALL";b[b.SOME=1]="SOME"})(a.RemoveMode||(a.RemoveMode={}));class r{constructor(b,c,d){this.name=b;this._storage=c;this.id=`${l++}:`;this.size=0;this.maxSize=-1;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);d&&(this._storage.registerRemoveFunc(this.id,d),this._removeFunc=!0)}destroy(){this._storage.clear(this);this._removeFunc&&this._storage.deregisterRemoveFunc(this.id);
this._storage.deregister(this);this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(b){return this._storage.getSize(this,b)}resetHitRate(){this._hit=this._miss=0}put(b,c,d,f=0){this._storage.put(this,b,c,d,f)}pop(b){b=this._storage.pop(this,b);void 0===b?++this._miss:++this._hit;return b}get(b){b=this._storage.get(this,b);void 0===b?++this._miss:++this._hit;return b}peek(b){return this._storage.peek(this,b)}updateSize(b,c,d){this._storage.updateSize(this,
b,c,d)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class k{get size(){return this._size}constructor(b=10485760){this._maxSize=b;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=new q;this._users=new q}destroy(){this.clearAll();this._removeFuncs.clear();this._users.clear();this._db=null}register(b){this._users.push(b)}deregister(b){this._users.removeUnordered(b)}registerRemoveFunc(b,
c){this._removeFuncs.push([b,c])}deregisterRemoveFunc(b){this._removeFuncs.filterInPlace(c=>c[0]!==b)}get maxSize(){return this._maxSize}set maxSize(b){this._maxSize=Math.max(b,-1);this._checkSize()}getSize(b,c){return this._db.get(b.id+c)?.size??0}put(b,c,d,f,p){c=b.id+c;const g=this._db.get(c);g&&(this._size-=g.size,b.size-=g.size,this._db.delete(c),g.entry!==d&&this._notifyRemove(c,g.entry,g.size,a.RemoveMode.ALL));f>this._maxSize?this._notifyRemove(c,d,f,a.RemoveMode.ALL):void 0===d?console.warn("Refusing to cache undefined entry "):
!f||0>f?(console.warn(`Refusing to cache entry with size ${f} for key ${c}`),this._notifyRemove(c,d,0,a.RemoveMode.ALL)):(this._db.set(c,new m(d,f,1+Math.max(p,-4)- -3)),this._size+=f,b.size+=f,this._checkSize())}updateSize(b,c,d,f){c=b.id+c;const p=this._db.get(c);if(p&&p.entry===d){this._size-=p.size;for(b.size-=p.size;f>this._maxSize;)if(f=this._notifyRemove(c,d,f,a.RemoveMode.SOME),!(null!=f&&0<f)){this._db.delete(c);return}p.size=f;this._size+=f;b.size+=f;this._checkSize()}}pop(b,c){c=b.id+c;
const d=this._db.get(c);if(d)return this._size-=d.size,b.size-=d.size,this._db.delete(c),++this._hit,d.entry;++this._miss}get(b,c){c=b.id+c;b=this._db.get(c);if(void 0===b)++this._miss;else return this._db.delete(c),b.lives=b.lifetime,this._db.set(c,b),++this._hit,b.entry}peek(b,c){(b=this._db.get(b.id+c))?++this._hit:++this._miss;return b?.entry}get performanceInfo(){const b={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+
"%",Entries:this._db.size.toString()},c={},d=[];this._db.forEach((g,x)=>{const n=g.lifetime;d[n]=(d[n]||0)+g.size;this._users.forAll(e=>{const {id:h,name:u}=e;x.startsWith(h)&&(c[u]=(c[u]||0)+g.size)})});const f={};this._users.forAll(g=>{const x=g.name;"hitRate"in g&&"number"===typeof g.hitRate&&!isNaN(g.hitRate)&&0<g.hitRate?(c[x]=c[x]||0,f[x]=Math.round(100*g.hitRate)+"%"):f[x]="0%"});var p=Object.keys(c);p.sort((g,x)=>c[x]-c[g]);p.forEach(g=>b[g]=Math.round(c[g]/2**20)+"MB / "+f[g]);for(p=d.length-
1;0<=p;--p){const g=d[p];g&&(b["Priority "+(p+-3-1)]=Math.round(g/this._size*100)+"%")}return b}resetStats(){this._hit=this._miss=0;this._users.forAll(b=>b.resetHitRate())}clear(b){const c=b.id;this._db.forEach((d,f)=>{f.startsWith(c)&&(this._size-=d.size,this._db.delete(f),this._notifyRemove(f,d.entry,d.size,a.RemoveMode.ALL))});b.size=0}clearAll(){this._db.forEach((b,c)=>this._notifyRemove(c,b.entry,b.size,a.RemoveMode.ALL));this._users.forAll(b=>b.size=0);this._size=0;this._db.clear()}_getHitRate(){return this._hit/
(this._hit+this._miss)}_notifyRemove(b,c,d,f){let p;this._removeFuncs.some(g=>b.startsWith(g[0])?(g=g[1](c,f,d),"number"===typeof g&&(p=g),!0):!1);return p}_checkSize(){this._users.forAll(b=>this._checkSizeLimits(b));this._checkSizeLimits()}_checkSizeLimits(b){const c=b??this;if(!(0>c.maxSize||c.size<=c.maxSize)){for(var d=b?.id,f=!0;f;){f=!1;for(const [p,g]of this._db)if(0===g.lifetime&&(!d||p.startsWith(d))){this._purgeItem(p,g,b);if(c.size<=.9*c.maxSize)return;f||=this._db.has(p)}}for(const [p,
g]of this._db)if(!d||p.startsWith(d))if(this._purgeItem(p,g,b),c.size<=.9*c.maxSize)break}}_purgeItem(b,c,d=this._users.find(f=>b.startsWith(f.id))){this._db.delete(b);if(1>=c.lives){this._size-=c.size;d&&(d.size-=c.size);const f=this._notifyRemove(b,c.entry,c.size,a.RemoveMode.SOME);null!=f&&0<f&&(this._size+=f,d&&(d.size+=f),c.lives=c.lifetime,c.size=f,this._db.set(b,c))}else--c.lives,this._db.set(b,c)}}let l=0;class m{constructor(b,c,d){this.entry=b;this.size=c;this.lives=this.lifetime=d}}a.MemCache=
r;a.MemCacheStorage=k;a.MinPriority=-3;a.NoPriority=-4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define("exports ../../config ../../core/Error ../../core/Logger ../Polygon ../Polyline ./normalizeUtilsCommon ./spatialReferenceUtils ./webMercatorUtils ../../rest/geometryService/cut ../../rest/geometryService/simplify".split(" "),function(a,q,r,k,l,m,b,c,d,f,p){function g(y){const B=[];let t=0,w=0;for(let C=0;C<y.length;C++){const z=
y[C];let D=null;for(let H=0;H<z.length;H++)D=z[H],B.push(D),0===H?w=t=D[0]:(t=Math.min(t,D[0]),w=Math.max(w,D[0]));D&&B.push([(t+w)/2,0])}return B}function x(y,B){if(!(y instanceof m||y instanceof l))throw v().error("straightLineDensify: the input geometry is neither polyline nor polygon"),new r("straightLineDensify: the input geometry is neither polyline nor polygon");var t=b.getGeometryParts(y);const w=[];for(const z of t){t=[];w.push(t);t.push([z[0][0],z[0][1]]);for(let D=0;D<z.length-1;D++){const H=
z[D][0],G=z[D][1],A=z[D+1][0],F=z[D+1][1];var C=Math.sqrt((A-H)*(A-H)+(F-G)*(F-G));const J=(F-G)/C,K=(A-H)/C,P=C/B;if(1<P){for(let E=1;E<=P-1;E++){const M=E*B;t.push([K*M+H,J*M+G])}C=(C+Math.floor(P-1)*B)/2;t.push([K*C+H,J*C+G])}t.push([A,F])}}return"polygon"===y.type?new l({rings:w,spatialReference:y.spatialReference}):new m({paths:w,spatialReference:y.spatialReference})}function n(y,B,t){B&&(y=x(y,1E6),y=d.webMercatorToGeographic(y,!0));t&&(y=b.updatePolyGeometry(y,t));return y}function e(y,B,t){if(Array.isArray(y)){var w=
y[0];w>B?(t=b.offsetMagnitude(w,B),y[0]=w+-2*t*B):w<t&&(B=b.offsetMagnitude(w,t),y[0]=w+-2*B*t)}else w=y.x,w>B?(t=b.offsetMagnitude(w,B),y=y.clone().offset(-2*t*B,0)):w<t&&(B=b.offsetMagnitude(w,t),y=y.clone().offset(-2*B*t,0));return y}function h(y,B){let t=-1;for(let w=0;w<B.cutIndexes.length;w++){const C=B.cutIndexes[w],z=B.geometries[w],D=b.getGeometryParts(z);for(let H=0;H<D.length;H++){const G=D[H];G.some(A=>{if(180>A[0])return!0;A=0;for(var F=0;F<G.length;F++){var J=G[F][0];A=J>A?J:A}A=Number(A.toFixed(9));
A=-360*b.offsetMagnitude(A,180);for(F=0;F<G.length;F++)J=z.getPoint(H,F),z.setPoint(H,F,J.clone().offset(A,0));return!0})}if(C===t)if("polygon"===y[0].type)for(const H of b.getGeometryParts(z))y[C]=y[C].addRing(H);else{if("polyline"===y[0].type)for(const H of b.getGeometryParts(z))y[C]=y[C].addPath(H)}else t=C,y[C]=z}return y}async function u(y,B,t){if(!Array.isArray(y))return u([y],B);B&&"string"!==typeof B&&v().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");
var w="string"===typeof B?B:B?.url??q.geometryServiceUrl;let C,z,D;let H=0;var G=[];B=[];for(var A of y)if(null==A)B.push(A);else{if(!F){var F=A.spatialReference;var J=c.getInfo(F);var K=(C=F.isWebMercator)?102100:4326;z=b.cutParams[K].maxX;D=b.cutParams[K].minX;var P=b.cutParams[K].plus180Line;K=b.cutParams[K].minus180Line}if(J)if("mesh"===A.type)B.push(A);else if("point"===A.type)B.push(e(A.clone(),z,D));else if("multipoint"===A.type){var E=A.clone();E.points=E.points.map(M=>e(M,z,D));B.push(E)}else if("extent"===
A.type)E=A.clone()._normalize(!1,!1,J),B.push(E.rings?new l(E):E);else if(A.extent){E=A.extent;const M=2*b.offsetMagnitude(E.xmin,D)*z;let T=0===M?A.clone():b.updatePolyGeometry(A.clone(),M);E.offset(M,0);E.intersects(P)&&E.xmax!==z?(H=E.xmax>H?E.xmax:H,T=n(T,C),G.push(T),B.push("cut")):E.intersects(K)&&E.xmin!==D?(H=2*E.xmax*z>H?2*E.xmax*z:H,T=n(T,C,360),G.push(T),B.push("cut")):B.push(T)}else B.push(A.clone());else B.push(A)}F=b.offsetMagnitude(H,z);J=-90;P=F;for(A=new m;0<F;)K=-180+360*F,A.addPath([[K,
J],[K,-1*J]]),J*=-1,F--;if(0<G.length&&0<P){F=await f.cut(w,G,A,t);F=h(G,F);J=[];G=[];for(P=0;P<B.length;P++)A=B[P],"cut"!==A?G.push(A):(A=F.shift(),K=y[P],null!=K&&"polygon"===K.type&&K.rings&&1<K.rings.length&&A.rings.length>=K.rings.length?(J.push(A),G.push("simplify")):G.push(C?d.geographicToWebMercator(A):A));if(!J.length)return G;B=await p.simplify(w,J,t);y=[];for(t=0;t<G.length;t++)w=G[t],"simplify"!==w?y.push(w):y.push(C?d.geographicToWebMercator(B.shift()):B.shift());return y}y=[];for(t=
0;t<B.length;t++)w=B[t],"cut"!==w?y.push(w):(w=G.shift(),y.push(!0===C?d.geographicToWebMercator(w):w));return y}const v=()=>k.getLogger("esri.geometry.support.normalizeUtils");a.getClosestDenormalizedXToReference=function(y,B,t){t=c.getInfo(t);if(null==t)return y;const [w,C]=t.valid;t=2*C;let z=0,D=0;B>C?z=Math.ceil(Math.abs(B-C)/t):B<w&&(z=-Math.ceil(Math.abs(B-w)/t));y>C?D=Math.ceil(Math.abs(y-C)/t):y<w&&(D=-Math.ceil(Math.abs(y-w)/t));y+=(z-D)*t;B=y-B;B>C?y-=t:B<w&&(y+=t);return y};a.getDenormalizedExtent=
function(y){if(!y)return null;const B=y.extent;if(!B)return null;var t=y.spatialReference&&c.getInfo(y.spatialReference);if(!t)return B;const [w,C]=t.valid;({width:t}=B);let {xmin:z,xmax:D}=B;[z,D]=[D,z];if("extent"===y.type||0===t||t<=C||t>2*C||z<w||D>C)return B;let H;switch(y.type){case "polygon":if(1<y.rings.length)H=g(y.rings);else return B;break;case "polyline":if(1<y.paths.length)H=g(y.paths);else return B;break;case "multipoint":H=y.points}y=B.clone();for(let G=0;G<H.length;G++){let A=H[G][0];
0>A?(A+=C,D=Math.max(A,D)):(A-=C,z=Math.min(A,z))}y.xmin=z;y.xmax=D;return y.width<t?(y.xmin-=C,y.xmax-=C,y):B};a.normalizeCentralMeridian=u;a.normalizeMapX=function(y,B){if(B=c.getInfo(B)){const [t,w]=B.valid;B=w-t;if(y<t)for(;y<t;)y+=B;if(y>w)for(;y>w;)y-=B}return y};a.straightLineDensify=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(a,q,r,k){function l(m){return k.isPolygon(m)?
m.rings:m.paths}q={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new q({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:r.WebMercator}),minus180Line:new q({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new q({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new q({paths:[[[-180,
-180],[-180,180]]],spatialReference:r.WGS84})}};a.cutParams=q;a.getGeometryParts=l;a.offsetMagnitude=function(m,b){return Math.ceil((m-b)/(2*b))};a.updatePolyGeometry=function(m,b){const c=l(m);for(const d of c)for(const f of d)f[0]+=b;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define("exports ../../geometry ../../request ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ../utils".split(" "),function(a,
q,r,k,l,m){a.cut=async function(b,c,d,f){b=m.parseUrl(b);const p=c[0].spatialReference;c={...f,responseType:"json",query:{...b.query,f:"json",sr:l.srToRESTValue(p),target:JSON.stringify({geometryType:k.getJsonType(c[0]),geometries:c}),cutter:JSON.stringify(d)}};c=await r(b.path+"/cut",c);const {cutIndexes:g,geometries:x=[]}=c.data;return{cutIndexes:g,geometries:x.map(n=>{n=k.fromJSON(n);n.spatialReference=p;return n})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define("exports ../config ../kernel ../core/lang ../core/urlUtils ../support/apiKeyUtils".split(" "),
function(a,q,r,k,l,m){function b(c,d,f){const p={};for(const x in c)if("declaredClass"!==x){var g=c[x];null!=g&&"function"!==typeof g&&(Array.isArray(g)?p[x]=g.map(n=>b({item:n},d,f).item):"object"===typeof g?g.toJSON?(g=g.toJSON(f?.[x]),p[x]=d?g:JSON.stringify(g)):p[x]=d?g:JSON.stringify(g):p[x]=g)}return p}a.asValidOptions=function(c,d){return d?{...d,query:{...(c??{}),...d.query}}:{query:c}};a.encode=b;a.getToken=function(c,d){return c?m.supportsApiKey(c)&&(d||q.apiKey)?d||q.apiKey:r.id?.findCredential(c)?.token:
null};a.parseUrl=function(c){return"string"===typeof c?l.urlToObject(c):k.clone(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define("exports ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ./utils".split(" "),function(a,q,r,k,l,m){a.simplify=async function(b,c,d){const f="string"===typeof b?r.urlToObject(b):b;b=c[0].spatialReference;const p=k.getJsonType(c[0]);c={...d,
query:{...f.query,f:"json",sr:l.srToRESTValue(b),geometries:JSON.stringify(m.encodeGeometries(c))}};({data:c}=await q(f.path+"/simplify",c));return m.decodeGeometries(c.geometries,p,b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(a,q){a.decodeGeometries=function(r,k,l){const m=q.getGeometryType(k);return r.map(b=>{b=m.fromJSON(b);b.spatialReference=l;return b})};a.encodeGeometries=
function(r){return{geometryType:q.getJsonType(r[0]),geometries:r.map(k=>k.toJSON())}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,q,r,k){function l(n,e,h={}){const u=m(e,n);if(!u)throw h=p.getError(e,n),new q("unsupported-query","invalid SQL expression",{expression:e,error:h});n=h.expressionName||"expression";
if(h.validateStandardized&&!u.isStandardized)throw new q("unsupported-query",`${n} is not standard`,{expression:e});if(h.validateAggregate&&!u.isAggregate)throw new q("unsupported-query",`${n} does not contain a valid aggregate function`,{expression:e});return u.fieldNames}function m(n,e){return n?p.get(n,e):null}function b(n){return/\((.*?)\)/.test(n)?n:n.split(" as ")[0]}function c(n,e,h,u={}){const v=new Map;d(v,n,e,u.allowedFieldTypes??x,h);if(v.size)throw new q("unsupported-query",`${u.expressionName??
"expression"} contains invalid or missing fields`,{errors:Array.from(v.values()),query:u.query});}function d(n,e,h,u,v){v=v.includes("*")?[...h,...v.filter(y=>"*"!==y)]:v;for(const y of v)if(e.get(y))f(n,e,h,u,y);else try{const B=b(y),t=l(e,B,{validateStandardized:!0});for(const w of t)f(n,e,h,u,w)}catch(B){n.set(y,{type:"expression-error",expression:y,error:B})}}function f(n,e,h,u,v){(e=e.get(v))?h.has(e.name)?"all"!==u&&!1===u?.has(e.type)&&n.set(v,{type:"invalid-type",fieldName:e.name,fieldType:k.kebabDict.fromJSON(e.type),
allowedFieldTypes:Array.from(u,y=>k.kebabDict.fromJSON(y))}):n.set(v,{type:"missing-field",fieldName:e.name}):n.set(v,{type:"invalid-field",fieldName:v})}const p=new r.WhereClauseCache(50,500);r=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const g=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),x=new Set(["esriFieldTypeString",
"esriFieldTypeGUID","esriFieldTypeGlobalID",...r,...g]);a.allDateAndTimeFieldTypes=g;a.getAliasFromFieldName=function(n){return n.split(" as ")[1]};a.getExpressionFromFieldName=b;a.getWhereClause=m;a.numericFieldTypes=r;a.validateFields=c;a.validateHaving=function(n,e,h,u,v){if(!h)return!0;const y=l(n,h,{validateAggregate:!0,expressionName:"having clause"});c(n,e,y,{expressionName:"having clause",query:v});if(!m(h,n)?.getExpressions().every(B=>{const {aggregateType:t,field:w}=B,C=n.get(w)?.name;return u.some(z=>
{const {onStatisticField:D,statisticType:H}=z;return n.get(D)?.name===C&&H.toLowerCase().trim()===t})}))throw new q("unsupported-query","expressions in having clause should also exist in outStatistics",{having:h});return!0};a.validateWhere=function(n,e,h,u){if(!h)return!0;h=l(n,h,{validateStandardized:!0,expressionName:"where clause"});c(n,e,h,{expressionName:"where clause",query:u});return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports",
"../LRUCache","./WhereClause"],function(a,q,r){class k{constructor(l,m){this._cache=new q.LRUCache(l);this._invalidCache=new q.LRUCache(m)}get(l,m){const b=`${m.uid}:${l}`,c=this._cache.get(b);if(c)return c;if(null!=this._invalidCache.get(b))return null;try{const d=r.WhereClause.create(l,m);this._cache.put(b,d);return d}catch(d){return this._invalidCache.put(b,d),null}}getError(l,m){return this._invalidCache.get(`${m.uid}:${l}`)??null}}a.WhereClauseCache=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(a,q){class r{constructor(k,l){this._storage=new q.MemCacheStorage;this.name=this.id="";this.size=0;this._storage.maxSize=k;this._storage.register(this);l&&this._storage.registerRemoveFunc("",l)}destroy(){this._storage.deregister(this);this._storage.destroy()}put(k,l,m=1){this._storage.put(this,k,l,m,1)}pop(k){return this._storage.pop(this,k)}get(k){return this._storage.get(this,k)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(k){this._storage.maxSize=
k}resetHitRate(){}}a.LRUCache=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){function h(A){return Array.isArray(A)?
A:[A]}function u(A){return null!==A?!0!==A:null}function v(A,F){return null!=A&&null!=F?!0===A&&!0===F:!1===A||!1===F?!1:null}function y(A,F){return null!=A&&null!=F?!0===A||!0===F:!0===A||!0===F?!0:null}function B(A,F){if(null==A)return null;let J=!1;for(const K of F)if(null==K)J=null;else if(A===K){J=!0;break}return J}function t(A,F,J){if(null==A)return null;let K="",P=H.Normal;for(let E=0;E<F.length;E++){const M=F.charAt(E);switch(P){case H.Normal:M===J?P=H.Escaped:K="-[]/{}()*+?.\\^$|".includes(M)?
K+("\\"+M):"%"===M?K+".*":"_"===M?K+".":K+M;break;case H.Escaped:K="-[]/{}()*+?.\\^$|".includes(M)?K+("\\"+M):K+M,P=H.Normal}}return(new RegExp("^"+K+"$","m")).test(A)}function w(A,F,J,K){A=K.getAttribute(A,F);F=J?.get(F);return null==A||"esriFieldTypeDate"!==F?.type&&"date"!==F?.type?null==A||"esriFieldTypeDateOnly"!==F?.type&&"date-only"!==F?.type?null==A||"esriFieldTypeTimeOnly"!==F?.type&&"time-only"!==F?.type?null==A||"esriFieldTypeTimestampOffset"!==F?.type&&"timestamp-offset"!==F?.type?A:new p.SqlTimeStampOffset(A):
x.TimeOnly.fromReader(A):m.DateOnly.fromReader(A):d.convertToExecutingTimeZone(new Date(A),J?.getLuxonTimeZone(F.name)??e.FixedOffsetZone.utcInstance)}const C=new Set(["current_timestamp","current_date","current_time"]);class z{static makeBool(A){return!0===A}static featureValue(A,F,J,K){return w(A,F,J,K)}static equalsNull(A){return null===A}static applyLike(A,F,J){return t(A,F,J)}static ensureArray(A){return h(A)}static applyIn(A,F){return B(A,F)}static currentDate(A){return m.DateOnly.fromNow(A)}static makeSqlInterval(A,
F,J){return f.SqlInterval.createFromValueAndQualifier(A,F,J)}static convertInterval(A){return A instanceof f.SqlInterval?A.valueInMilliseconds():A}static currentTimestamp(A){return d.convertToExecutingTimeZone(new Date,A)}static compare(A,F,J,K){return c.sqlCompare(F,J,A)}static calculate(A,F,J,K){return b.sqlCalculateFunction(A,F,J,K)}static evaluateTime(A){return d.parseTime(A)}static evaluateTimestamp(A,F,J){return d.parseTimestamp(A,F,J)}static evaluateDate(A,F){return d.parseDate(A,F)}static evaluateFunction(A,
F,J){return g.evaluateFunction(A,F,J)}static lookup(A,F){A=F[A];return void 0===A?null:A}static between(A,F,J){return null==A||null==F[0]||null==F[1]?null:c.sqlCompare(A,F[0],"\x3e\x3d")&&c.sqlCompare(A,F[1],"\x3c\x3d")}static notbetween(A,F,J){return null==A||null==F[0]||null==F[1]?null:c.sqlCompare(A,F[0],"\x3c")||c.sqlCompare(A,F[1],"\x3e")}static ternaryNot(A){return u(A)}static ternaryAnd(A,F){return v(A,F)}static ternaryOr(A,F){return y(A,F)}}class D{constructor(A,F,J="UTC"){this.fieldsIndex=
F;this.timeZone=J;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=n.WhereGrammar.parse(A);const {isStandardized:K,isAggregate:P,referencedFieldNames:E}=this._extractExpressionInfo(F);this._referencedFieldNames=E;this.isStandardized=K;this.isAggregate=P}static convertValueToStorageFormat(A,F=null){if(null===F)return d.isDate(A)?A.getTime():d.isDateTime(A)?A.toMillis():d.isTimestampOffset(A)?A.toStorageFormat():d.isTimeOnly(A)?A.toStorageString():d.isDateOnly(A)?A.toStorageFormat():
A;switch(F){case "date":if(d.isDate(A))return A.getTime();if(d.isDateTime(A))return A.toMillis();if(d.isTimestampOffset(A))return A.toMilliseconds();if(d.isDateOnly(A))return A.toNumber();break;case "date-only":if(d.isDate(A))return m.DateOnly.fromDateJS(A).toString();if(d.isTimestampOffset(A))return m.DateOnly.fromSqlTimeStampOffset(A).toString();if(d.isDateTime(A))return m.DateOnly.fromDateTime(A).toString();break;case "time-only":if(d.isDate(A))return x.TimeOnly.fromDateJS(A).toStorageString();
if(d.isDateTime(A))return x.TimeOnly.fromDateTime(A).toStorageString();if(d.isTimestampOffset(A))return x.TimeOnly.fromSqlTimeStampOffset(A).toStorageString();if(d.isTimeOnly(A))return A.toStorageString();break;case "timestamp-offset":if(d.isDate(A))return p.SqlTimeStampOffset.fromJSDate(A).toStorageFormat();if(d.isDateTime(A))return p.SqlTimeStampOffset.fromDateTime(A).toStorageFormat();if(d.isTimestampOffset(A))return A.toStorageFormat()}return A}static create(A,F,J="UTC"){return new D(A,F,J)}get fieldNames(){return this._referencedFieldNames}testSet(A,
F=G){return!!this._evaluateNode(this.parseTree,null,F,A)}calculateValue(A,F=G){A=this._evaluateNode(this.parseTree,A,F,null);return A instanceof f.SqlInterval?A.valueInMilliseconds()/864E5:A}calculateValueCompiled(A,F=G){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(A,this.parameters,F,this.fieldsIndex,this.timeZone);if(k("esri-csp-restrictions"))return this.calculateValue(A,F);this._compileMe();return this.parseTree._compiledVersion(A,this.parameters,F,this.fieldsIndex,
this.timeZone)}testFeature(A,F=G){return!!this._evaluateNode(this.parseTree,A,F,null)}testFeatureCompiled(A,F=G){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(A,this.parameters,F,this.fieldsIndex,this.timeZone);if(k("esri-csp-restrictions"))return this.testFeature(A,F);this._compileMe();return!!this.parseTree._compiledVersion(A,this.parameters,F,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=
!1;this._visitAll(this.parseTree,A=>{"current-time"===A.type?this._hasDateFunctions=!0:"function"===A.type&&(this._hasDateFunctions=this._hasDateFunctions||C.has(A.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const A=new Set;this._visitAll(this.parseTree,F=>{"function"===F.type&&A.add(F.name.toLowerCase())});return Array.from(A)}getExpressions(){const A=new Map;this._visitAll(this.parseTree,F=>{if("function"===F.type){const J=F.name.toLowerCase();F=F.args.value[0];if("column-reference"===
F.type){F=F.column;const K=`${J}-${F}`;A.has(K)||A.set(K,{aggregateType:J,field:F})}}});return[...A.values()]}getVariables(){const A=new Set;this._visitAll(this.parseTree,F=>{"parameter"===F.type&&A.add(F.value.toLowerCase())});return Array.from(A)}_compileMe(){const A="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone",A)).bind(z)}_extractExpressionInfo(A){const F=
[],J=new Set;let K=!0,P=!1;this._visitAll(this.parseTree,E=>{switch(E.type){case "column-reference":var M=A?.get(E.column);let T;M?M=T=M.name??"":(T=E.column,M=T.toLowerCase());J.has(M)||(J.add(M),F.push(T));E.column=T;break;case "function":const {name:ba,args:ea}=E;E=ea.value.length;K&&=g.isStandardized(ba,E);!1===P&&(P=l.isAggregate(ba,E))}});return{referencedFieldNames:Array.from(F),isStandardized:K,isAggregate:P}}_visitAll(A,F){if(null!=A)switch(F(A),A.type){case "when-clause":this._visitAll(A.operand,
F);this._visitAll(A.value,F);break;case "case-expression":for(const J of A.clauses)this._visitAll(J,F);"simple"===A.format&&this._visitAll(A.operand,F);null!==A.else&&this._visitAll(A.else,F);break;case "expression-list":for(const J of A.value)this._visitAll(J,F);break;case "unary-expression":this._visitAll(A.expr,F);break;case "binary-expression":this._visitAll(A.left,F);this._visitAll(A.right,F);break;case "function":this._visitAll(A.args,F)}}evaluateNodeToJavaScript(A){switch(A.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(A.value)+", "+JSON.stringify(A.qualifier)+","+JSON.stringify(A.op)+")";case "case-expression":var F="";if("simple"===A.format){var J=this.evaluateNodeToJavaScript(A.operand);F="( ";for(let K=0;K<A.clauses.length;K++)F+=" (this.compare('\x3d',"+J+","+this.evaluateNodeToJavaScript(A.clauses[K].operand)+") ? ("+this.evaluateNodeToJavaScript(A.clauses[K].value)+") : "}else for(F="( ",J=0;J<A.clauses.length;J++)F+=" this.makeBool("+this.evaluateNodeToJavaScript(A.clauses[J].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(A.clauses[J].value)+") : ";F=null!==A.else?F+this.evaluateNodeToJavaScript(A.else):F+"null";return F+" )";case "parameter":return"this.lookup("+JSON.stringify(A.value.toLowerCase())+",lookups)";case "expression-list":F="[";for(J of A.value)"["!==F&&(F+=","),F+=this.evaluateNodeToJavaScript(J);return F+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(A.expr)+")";case "binary-expression":switch(A.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+" )";case "IS":if("null"!==A.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(A.left)+")";case "ISNOT":if("null"!==A.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(A.left)+
")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(A.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(A.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(A.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(A.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(A.left)+
","+this.evaluateNodeToJavaScript(A.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+","+JSON.stringify(A.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+","+JSON.stringify(A.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(A.operator)+
","+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(A.operator)+","+this.evaluateNodeToJavaScript(A.left)+","+this.evaluateNodeToJavaScript(A.right)+", timeZone)"}throw new r.SqlError(r.SqlErrorCodes.UnsupportedOperator,{operator:A.operator});case "null":case "boolean":case "string":case "number":return JSON.stringify(A.value);case "time":return"this.evaluateTime(JSON.stringify(node.value))";
case "date":return"this.evaluateDate(JSON.stringify(node.value), 'unknown')";case "timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), 'unknown')";case "current-time":return"date"===A.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(A.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(A.name)+","+this.evaluateNodeToJavaScript(A.args)+", timeZone)"}throw new r.SqlError(r.SqlErrorCodes.UnsupportedSyntax,
{node:A.type});}_evaluateNode(A,F,J,K){switch(A.type){case "interval":return J=this._evaluateNode(A.value,F,J,K),f.SqlInterval.createFromValueAndQualifier(J,A.qualifier,A.op);case "case-expression":if("simple"===A.format){var P=this._evaluateNode(A.operand,F,J,K);for(var E=0;E<A.clauses.length;E++)if(c.sqlCompare(P,this._evaluateNode(A.clauses[E].operand,F,J,K),"\x3d",this.timeZone))return this._evaluateNode(A.clauses[E].value,F,J,K)}else for(P=0;P<A.clauses.length;P++)if(!0===this._evaluateNode(A.clauses[P].operand,
F,J,K))return this._evaluateNode(A.clauses[P].value,F,J,K);return null!==A.else?this._evaluateNode(A.else,F,J,K):null;case "parameter":return A=this.parameters[A.value.toLowerCase()],d.isDate(A)?e.DateTime.fromJSDate(A):A instanceof q.ArcadeDate?A.toDateTime():A;case "expression-list":P=[];for(var M of A.value)P.push(this._evaluateNode(M,F,J,K));return P;case "unary-expression":return u(this._evaluateNode(A.expr,F,J,K));case "binary-expression":switch(A.operator){case "AND":return v(this._evaluateNode(A.left,
F,J,K),this._evaluateNode(A.right,F,J,K));case "OR":return y(this._evaluateNode(A.left,F,J,K),this._evaluateNode(A.right,F,J,K));case "IS":if("null"!==A.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(A.left,F,J,K);case "ISNOT":if("null"!==A.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(A.left,F,J,K);case "IN":return P=h(this._evaluateNode(A.right,F,J,K)),B(this._evaluateNode(A.left,F,J,K),P);case "NOT IN":return P=
h(this._evaluateNode(A.right,F,J,K)),u(B(this._evaluateNode(A.left,F,J,K),P));case "BETWEEN":return P=this._evaluateNode(A.left,F,J,K),A=this._evaluateNode(A.right,F,J,K),null==P||null==A[0]||null==A[1]?null:c.sqlCompare(P,A[0],"\x3e\x3d",this.timeZone)&&c.sqlCompare(P,A[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return P=this._evaluateNode(A.left,F,J,K),A=this._evaluateNode(A.right,F,J,K),null==P||null==A[0]||null==A[1]?null:c.sqlCompare(P,A[0],"\x3c",this.timeZone)||c.sqlCompare(P,A[1],"\x3e",
this.timeZone);case "LIKE":return t(this._evaluateNode(A.left,F,J,K),this._evaluateNode(A.right,F,J,K),A.escape);case "NOT LIKE":return u(t(this._evaluateNode(A.left,F,J,K),this._evaluateNode(A.right,F,J,K),A.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return c.sqlCompare(this._evaluateNode(A.left,F,J,K),this._evaluateNode(A.right,F,J,K),A.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return b.sqlCalculateFunction(A.operator,
this._evaluateNode(A.left,F,J,K),this._evaluateNode(A.right,F,J,K),this.timeZone)}case "null":case "boolean":case "string":case "number":return A.value;case "date":return A.parsedValue??(A.parsedValue=d.parseDate(A.value,"unknown")),A.parsedValue;case "timestamp":return A.parsedValue??(A.parsedValue=d.parseTimestamp(A.value,"unknown")),A.parsedValue;case "time":return d.parseTime(A.value);case "current-time":return"date"===A.mode?m.DateOnly.fromNow(this.timeZone):d.convertToExecutingTimeZone(new Date,
this.timeZone);case "column-reference":return w(F,A.column,this.fieldsIndex,J);case "data-type":return A.value;case "function":if(this.isAggregate&&l.isAggregate(A.name,A.args.value.length)){F=[];for(P of A.args?.value||[]){M=[];for(E of K||[])M.push(this._evaluateNode(P,E,J,null));F.push(M)}return l.aggregateFunction(A.name,F)}J=this._evaluateNode(A.args,F,J,K);return g.evaluateFunction(A.name,J,this.timeZone)}throw new r.SqlError(r.SqlErrorCodes.UnsupportedSyntax,{node:A.type});}}var H;(function(A){A[A.Normal=
0]="Normal";A[A.Escaped=1]="Escaped"})(H||={});const G={getAttribute(A,F){return(A&&"object"===typeof A.attributes?A.attributes:A)[F]}};a.WhereClause=D;a.defaultAttributeAdapter=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,q,r,k){function l(f,p,g){return f<p?f-p:f>g?f-g:0}function m(f,p=!0){if(f instanceof k.Zone)return f;if("system"===f.toLowerCase())return"system";
if("utc"===f.toLowerCase())return"UTC";if("unknown"===f.toLowerCase())return r.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(f)){const g=k.FixedOffsetZone.parseSpecifier("UTC"+(f.startsWith("+")||f.startsWith("-")?"":"+")+f);if(g)return g}f=k.IANAZone.create(f);if(!f.isValid){if(p)throw new c(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return f}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const b={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class c extends Error{constructor(f,p){super(q.replace(b[f],p));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,c)}}class d{constructor(f){this._date=f;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(f=0,p=1,g=1,x=0,n=0,e=0,h=0,u){if(isNaN(f)||isNaN(p)||isNaN(g)||isNaN(x)||isNaN(n)||isNaN(e)||isNaN(h))return null;const v=
k.DateTime.local(f,p).daysInMonth;f=k.DateTime.fromObject({day:1>g?1:g>v?v:g,year:f,month:1>p?1:12<p?12:p,hour:0>x?0:23<x?23:x,minute:0>n?0:59<n?59:n,second:0>e?0:59<e?59:e,millisecond:0>h?0:999<h?999:h},{zone:m(u)});f=f.plus({months:l(p,1,12),days:l(g,1,v),hours:l(x,0,23),minutes:l(n,0,59),seconds:l(e,0,59),milliseconds:l(h,0,999)});return new d(f)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(f,p){p=
m(p);return f.isUnknownTimeZone||p===r.UnknownTimeZone.instance?d.fromParts(f.year,f.monthJS+1,f.day,f.hour,f.minute,f.second,f.millisecond,p):new d(f._date.setZone(p))}static dateJSToArcadeDate(f){return new d(k.DateTime.fromJSDate(f,{zone:"system"}))}static dateJSAndZoneToArcadeDate(f,p="system"){p=m(p);return new d(k.DateTime.fromJSDate(f,{zone:p}))}static unknownEpochToArcadeDate(f){return new d(k.DateTime.fromMillis(f,{zone:r.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(f){return new d(k.DateTime.fromMillis(f.getTime(),
{zone:r.UnknownTimeZone.instance}))}static epochToArcadeDate(f,p="system"){p=m(p);return new d(k.DateTime.fromMillis(f,{zone:p}))}static dateTimeToArcadeDate(f){return new d(f)}clone(){return new d(this._date)}changeTimeZone(f){f=m(f);return d.dateTimeToArcadeDate(this._date.setZone(f))}static dateTimeAndZoneToArcadeDate(f,p){p=m(p);return f.zone===r.UnknownTimeZone.instance||p===r.UnknownTimeZone.instance?d.fromParts(f.year,f.month,f.day,f.hour,f.minute,f.second,f.millisecond,p):new d(f.setZone(p))}static nowToArcadeDate(f){f=
m(f);return new d(k.DateTime.fromJSDate(new Date,{zone:f}))}static nowUTCToArcadeDate(){return new d(k.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(f){return this.isSystem&&f.isSystem?this.toNumber()===f.toNumber():this.isUnknownTimeZone!==f.isUnknownTimeZone?!1:this._date.equals(f._date)}get isUnknownTimeZone(){return this._date.zone===r.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let f=
this._date.weekday;6<f&&(f=0);return f}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const f=this.zone;return"fixed"===f.type?0===f.fixed?"UTC":f.formatOffset(0,"short"):f.name}stringify(){return JSON.stringify(this.toJSDate())}plus(f){return new d(this._date.plus(f))}diff(f,p="milliseconds"){return this._date.diff(f._date,p)[p]}toISODate(){return this._date.toISODate()}toISOString(f){return f?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(f,p){return this._date.toISOTime({suppressMilliseconds:f,
includeOffset:p&&!this.isUnknownTimeZone})}toFormat(f,p){this.isUnknownTimeZone&&(f=f.replaceAll("Z",""));return this._date.toFormat(f,p)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(f){if(!f)return null;
f=k.DateTime.fromISO(f,{setZone:!0});return new d(f)}}a.ArcadeDate=d;a.ArcadeDateError=c;a.arcadeDateErrorMessages=b;a.createDateTimeZone=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(a,q){a.SqlErrorCodes=void 0;(function(b){b.InvalidFunctionParameters="InvalidFunctionParameters";b.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";b.UnsupportedSqlFunction=
"UnsupportedSqlFunction";b.UnsupportedOperator="UnsupportedOperator";b.UnsupportedSyntax="UnsupportedSyntax";b.UnsupportedIsRhs="UnsupportedIsRhs";b.UnsupportedIsLhs="UnsupportedIsLhs";b.InvalidDataType="InvalidDataType";b.CannotCastValue="CannotCastValue";b.FunctionNotRecognized="FunctionNotRecognized";b.InvalidTime="InvalidTime";b.InvalidParameterCount="InvalidParameterCount";b.InvalidTimeStamp="InvalidTimeStamp";b.InvalidDate="InvalidDate";b.InvalidOperator="InvalidOperator";b.IllegalInterval=
"IllegalInterval";b.YearMonthIntervals="YearMonthIntervals";b.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";b.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const r={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",
[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",
[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};
class k extends Error{constructor(b,c){super(q.replace(r[b],c));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,k)}}a.FeatureSetErrorCodes=void 0;(function(b){b.NeverReach="NeverReach";b.NotImplemented="NotImplemented";b.Cancelled="Cancelled";b.InvalidStatResponse="InvalidStatResponse";b.InvalidRequest="InvalidRequest";b.RequestFailed="RequestFailed";b.MissingFeatures="MissingFeatures";b.AggregationFieldNotFound="AggregationFieldNotFound";
b.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const l={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",
[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class m extends Error{constructor(b,c){super(q.replace(l[b],c));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,m)}}a.FeatureSetError=m;a.SqlError=k;a.featureSetErrorMessages=l;a.sqlErrorMessages=r;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,q,r,k,l,m){function b(p){if(null===p)return null;let g=0,x=0;for(let n=0;n<p.length;n++){const e=p[n];if(null!==e){if("number"!==typeof e)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);x++;g+=e}}return 0===x?null:g/p.length}function c(p,g){if(null===
p)return null;let x=null,n=null;for(const e of p)p=e,p=e instanceof r.DateOnly?e.toNumber():e instanceof l.TimeOnly?e.toNumber():e instanceof m.DateTime?e.toMillis():e instanceof k.SqlTimeStampOffset?e.toMilliseconds():e,null===x?(x=e,n=p):"max"===g&&null!==n&&null!==p&&n<=p?(x=e,n=p):"min"===g&&null!==n&&null!==p&&n>=p&&(x=e,n=p);return x}function d(p){if(null===p)return null;p=p.filter(n=>null!==n);if(0===p.length)return null;const g=b(p);if(null===g)return null;let x=0;for(const n of p){if("number"!==
typeof n)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);x+=(g-n)**2}return x/(p.length-1)}const f={min:{minParams:1,maxParams:1,evaluate:p=>c(p[0],"min")},max:{minParams:1,maxParams:1,evaluate:p=>c(p[0],"max")},avg:{minParams:1,maxParams:1,evaluate:p=>b(p[0])},sum:{minParams:1,maxParams:1,evaluate:p=>{p=p[0];if(null===p)p=null;else{var g=0;for(let x=0;x<p.length;x++){const n=p[x];if(null!==n){if("number"!==typeof n)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);
g+=n}}p=g}return p}},stddev:{minParams:1,maxParams:1,evaluate:p=>{p=p[0];null===p?p=null:(p=d(p),p=null===p?null:Math.sqrt(p));return p}},count:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:p[0].length},var:{minParams:1,maxParams:1,evaluate:p=>d(p[0])}};a.aggregateFunction=function(p,g){const x=f[p.toLowerCase()];if(null==x)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(g.length<x.minParams||g.length>x.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:p.toUpperCase()});
return x.evaluate(g)};a.isAggregate=function(p,g){p=f[p.toLowerCase()];return null!=p&&g>=p.minParams&&g<=p.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,q,r,k){function l(b){b=b.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let c="";const d=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const f of b.match(d)||[])switch(f){case "D":c+="d";break;case "DD":c+="dd";break;case "DDD":c+="o";break;case "d":c+="c";break;case "ddd":c+="ccc";break;case "dddd":c+="cccc";break;case "M":c+="L";break;case "MM":c+="LL";break;case "MMM":c+="LLL";break;case "MMMM":c+="LLLL";break;case "YY":c+="yy";break;case "Y":case "YYYY":c+="yyyy";break;case "Q":c+="q";break;case "X":case "x":c+=f;break;default:c=2<=f.length&&"["===f.slice(0,1)&&"]"===f.slice(-1)?c+`'${f.slice(1,-1)}'`:c+`'${f}'`}return c}
class m{constructor(b,c,d){this._year=b;this._month=c;this._day=d;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(b){return b instanceof m&&b.day===this.day&&b.month===this.month&&b.year===this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(b){return k.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:q.createDateTimeZone(b)})}toDateTimeLuxon(b){return k.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(b)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(b=null){if(null===b||""===b)return this.toString();b=l(b);if(!b)return"";const c=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(c).toFormat(b,{locale:r.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const b=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(b)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd")}toSQLValue(){return this.toFormat("yyyy-LL-dd")}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd")+"'"}plus(b,c){return m.fromDateTime(this.toUTCDateTime().plus({[b]:c}))}toUTCDateTime(){return k.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(b,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(b.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(b.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(b.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(b.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(b.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(b){b=k.DateTime.fromMillis(b,{zone:k.FixedOffsetZone.utcInstance});
return b.isValid?m.fromParts(b.year,b.month,b.day):null}static fromSeconds(b){b=k.DateTime.fromSeconds(b,{zone:k.FixedOffsetZone.utcInstance});return b.isValid?m.fromParts(b.year,b.month,b.day):null}static fromReader(b){if(!b)return null;b=b.split("-");return 3!==b.length?null:new m(parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10))}static fromParts(b,c,d){b=new m(b,c,d);return!1===b.isValid?null:b}static fromDateJS(b){return m.fromParts(b.getFullYear(),b.getMonth()+1,b.getDay())}static fromDateTime(b){return m.fromParts(b.year,
b.month,b.day)}static fromSqlTimeStampOffset(b){return this.fromDateTime(b.toDateTime())}static fromString(b,c=null){if(""===b||null===b)return null;var d=[];if(c)(c=l(c))&&d.push(c);else if(null===c||""===c)return b=k.DateTime.fromISO(b,{setZone:!0}),b.isValid?m.fromParts(b.year,b.month,b.day):null;for(const f of d)if(d=k.DateTime.fromFormat(b,c??f),d.isValid)return new m(d.year,d.month,d.day);return null}static fromNow(b="system"){b=k.DateTime.fromJSDate(new Date).setZone(q.createDateTimeZone(b));
return new m(b.year,b.month,b.day)}}a.DateOnly=m;a.standardizeDateOnlyFormat=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(a,q){function r(l){return Number.isNaN(l)||0===l?l:Math.trunc(l)}class k{constructor(l){this._timeStampOffset=l;this._date=null}toDateTime(){this._date??(this._date=q.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return r(this.toDateTime().offset/
60)}get timezoneOffsetMinutes(){return r(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return k.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(l){return new k(q.DateTime.fromJSDate(l).toISO({includeOffset:!0}))}static fromDateTime(l){return new k(l.toISO({includeOffset:!0}))}static fromParts(l,
m,b=0,c=0,d=0,f=0,p=0,g=!1,x=0,n=0){l=`${l.toString().padStart(4,"0")}-${m.toString().padStart(2,"0")}-${b.toString().padStart(2,"0")}`;m="";10>f&&(m="0");c=`${c.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${m+f.toString()}`;0!==p&&(c+="."+p.toString().padStart(3,"0"));p=`${g?"-":"+"}${x.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`;return new k(l+"T"+c+p)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let l=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});l&&=l.replace(".000","");return l}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(l){l=this.toDateTime().plus(l);return k.fromDateTime(l)}}a.SqlTimeStampOffset=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,q,r,k){function l(b){if(!b)return"";const c=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let d="";for(const f of b.match(c)||
[])switch(f){case "SSS":d+=f;break;case "A":case "a":d+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":d+=f;break;default:d+=`'${f}'`}return d}class m{constructor(b,c,d,f){this._hour=b;this._minute=c;this._second=d;this._millisecond=f;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(b){return b instanceof m&&b.hour===
this.hour&&b.minute===this.minute&&b.second===this.second&&b.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return q.isInteger(this.hour)&&q.isInteger(this.minute)&&q.isInteger(this.second)&&q.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(b=null){return null===b||""===b?this.toString():(b=l(b))?k.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(b,{locale:r.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(b,c,d,f){b=new m(b,c,d,f);return b.isValid()?b:null}static fromReader(b){if(!b)return null;b=b.split(":");return 3!==b.length?null:new m(parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],
10),0)}static fromMilliseconds(b){return 864E5<b||0>b?null:new m(Math.floor(b/36E5%24),Math.floor(b/6E4%60),Math.floor(b/1E3%60),Math.floor(b%1E3))}static fromDateJS(b){return new m(b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds())}static fromDateTime(b){return new m(b.hour,b.minute,b.second,b.millisecond)}static fromSqlTimeStampOffset(b){return this.fromDateTime(b.toDateTime())}static fromString(b,c=null){if(""===b||null===b)return null;const d=[];if(c)(c=l(c))&&d.push(c);else if(null===
c||""===c)d.push("HH:mm:ss"),d.push("HH:mm:ss.SSS"),d.push("hh:mm:ss a"),d.push("hh:mm:ss.SSS a"),d.push("HH:mm"),d.push("hh:mm a"),d.push("H:mm"),d.push("h:mm a"),d.push("H:mm:ss"),d.push("h:mm:ss a"),d.push("H:mm:ss.SSS"),d.push("h:mm:ss.SSS a");for(const f of d)if(c=k.DateTime.fromFormat(b,f),c.isValid)return new m(c.hour,c.minute,c.second,c.millisecond);return null}plus(b,c){switch(b){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[b]:c}))}return null}toUTCDateTime(){return k.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(b,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(b.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(b.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(b.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(b.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(b.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=m;a.standardizeTimeFormat=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,q){a.cloneGeometry=function(r){if(null==r)return null;const k=r.clone();void 0!==r.cache._geVersion&&(k.cache._geVersion=r.cache._geVersion);return k};a.convertLinearUnitsToCode=function(r){if(null==r)return null;if("number"===typeof r)return r;r=r.toLowerCase();r=r.replaceAll(/\s/g,"");r=r.replaceAll("-","");switch(r){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(r){if(null==r)return null;if("number"===typeof r)return r;r=r.toLowerCase();r=r.replaceAll(/\s/g,"");r=r.replaceAll("-","");switch(r){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(r){return"number"===typeof r&&isFinite(r)&&Math.floor(r)===r};a.sameGeomType=function(r,k){return r===k||"point"===r&&"esriGeometryPoint"===k||"polyline"===r&&"esriGeometryPolyline"===
k||"polygon"===r&&"esriGeometryPolygon"===k||"extent"===r&&"esriGeometryEnvelope"===k||"multipoint"===r&&"esriGeometryMultipoint"===k||"point"===k&&"esriGeometryPoint"===r||"polyline"===k&&"esriGeometryPolyline"===r||"polygon"===k&&"esriGeometryPolygon"===r||"extent"===k&&"esriGeometryEnvelope"===r||"multipoint"===k&&"esriGeometryMultipoint"===r?!0:!1};a.shapeExtent=function(r){if(null==r)return null;switch(r.type){case "polygon":case "multipoint":case "polyline":return r.extent;case "point":return new q({xmin:r.x,
ymin:r.y,xmax:r.x,ymax:r.y,spatialReference:r.spatialReference});case "extent":return r}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,q,r,k,l){function m(Q,V,W){switch(W){case "+":return Q+V;case "-":return Q-V;case "*":return Q*V;case "/":return Q/V}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function b(Q,V,W){switch(W){case "+":return V.plus({milliseconds:Q.valueInMilliseconds()});case "-":return Q.valueInMilliseconds()-V.toMillis()}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function c(Q,V,W){switch(W){case "+":return V.plus("milliseconds",Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function d(Q,V,W){switch(W){case "+":return V.plus("milliseconds",Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function f(Q,
V,W){switch(W){case "+":return Q.plus("milliseconds",V.valueInMilliseconds());case "-":return Q.plus("milliseconds",-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function p(Q,V,W){switch(W){case "+":return V.addMilliseconds(Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function g(Q,V,W){switch(W){case "+":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()+V.valueInMilliseconds());case "-":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()-
V.valueInMilliseconds());case "*":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()*V.valueInMilliseconds());case "/":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()/V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function x(Q,V,W){switch(W){case "+":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()+V);case "-":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()-V);case "*":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()*
V);case "/":return k.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()/V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function n(Q,V,W){switch(W){case "+":return k.SqlInterval.createFromMilliseconds(Q+V.valueInMilliseconds());case "-":return k.SqlInterval.createFromMilliseconds(Q-V.valueInMilliseconds());case "*":return k.SqlInterval.createFromMilliseconds(Q*V.valueInMilliseconds());case "/":return k.SqlInterval.createFromMilliseconds(Q/V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function e(Q,V,W){switch(W){case "+":return Q.plus("milliseconds",V.valueInMilliseconds());case "-":return Q.plus("milliseconds",-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function h(Q,V,W){switch(W){case "+":return Q.plus({milliseconds:V.valueInMilliseconds()});case "-":return Q.minus({milliseconds:V.valueInMilliseconds()})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function u(Q,V,W){switch(W){case "+":return Q.addMilliseconds(V.valueInMilliseconds());
case "-":return Q.addMilliseconds(-1*V.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function v(Q,V,W){V*=864E5;switch(W){case "+":return Q.plus({milliseconds:V});case "-":return Q.minus({milliseconds:V})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function y(Q,V,W){V*=864E5;switch(W){case "+":return Q.plus("milliseconds",V);case "-":return Q.plus("milliseconds",-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function B(Q,V,W){V*=864E5;switch(W){case "+":return Q.plus("milliseconds",
V);case "-":return Q.plus("milliseconds",-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function t(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function w(Q,V,W){V*=864E5;switch(W){case "+":return Q.addMilliseconds(V);case "-":return Q.addMilliseconds(-1*V)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function C(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function z(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function D(Q,
V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function H(Q,V,W){V=parseFloat(V);if(isNaN(V))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return m(Q,V,W)}function G(Q,V,W){Q=parseFloat(Q);if(isNaN(Q))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return m(Q,V,W)}function A(Q,V,W){switch(W){case "+":return Q+V}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function F(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function J(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function K(Q,V,W){switch(W){case "-":return Q.toDateTimeLuxon(V.zone).diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function P(Q,V,W){switch(W){case "-":return Q.toDateTimeLuxon(V.toDateTime().zone).diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function E(Q,V,W){switch(W){case "-":return Q.toDateTimeLuxon("UTC").diff(V.toDateTimeLuxon("UTC")).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function M(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function T(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ba(Q,V,W){switch(W){case "-":return Q.toDateTime().diff(V.toDateTimeLuxon(Q.toDateTime().zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ea(Q,V,W){switch(W){case "-":return Q.toDateTime().diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function X(Q,V,W){switch(W){case "-":return Q.toDateTime().diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function ca(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ma(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function S(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function Y(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ia(Q,V,W){switch(W){case "-":return Q.diff(V).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function na(Q,V,W){switch(W){case "-":return Q.diff(V.toDateTimeLuxon(Q.zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function ta(Q,V,W){switch(W){case "-":return Q.diff(V.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function va(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function xa(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function wa(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function Ca(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function L(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function R(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function fa(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ka(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function qa(Q,V,W){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=E;a.calculateDateOnlyAndDateTime=K;a.calculateDateOnlyAndNumber=y;a.calculateDateOnlyAndSqlInterval=e;a.calculateDateOnlyAndString=xa;a.calculateDateOnlyAndTimeOnly=M;a.calculateDateOnlyAndTimestamp=
P;a.calculateDateTimeAndDateOnly=na;a.calculateDateTimeAndDateTime=ia;a.calculateDateTimeAndNumber=v;a.calculateDateTimeAndSqlInterval=h;a.calculateDateTimeAndString=Ca;a.calculateDateTimeAndTimeOnly=va;a.calculateDateTimeAndTimestamp=ta;a.calculateNumberAndDateOnly=D;a.calculateNumberAndDateTime=t;a.calculateNumberAndNumber=m;a.calculateNumberAndSqlInterval=n;a.calculateNumberAndString=H;a.calculateNumberAndTimeOnly=z;a.calculateNumberAndTimestamp=C;a.calculateSqlIntervalAndDateOnly=d;a.calculateSqlIntervalAndDateTime=
b;a.calculateSqlIntervalAndNumber=x;a.calculateSqlIntervalAndSqlInterval=g;a.calculateSqlIntervalAndString=F;a.calculateSqlIntervalAndTimeOnly=c;a.calculateSqlIntervalAndTimestamp=p;a.calculateStringAndDateOnly=fa;a.calculateStringAndDateTime=ka;a.calculateStringAndNumber=G;a.calculateStringAndSqlInterval=J;a.calculateStringAndString=A;a.calculateStringAndTimeOnly=R;a.calculateStringAndTimestamp=qa;a.calculateTimeOnlyAndDateOnly=ma;a.calculateTimeOnlyAndDateTime=ca;a.calculateTimeOnlyAndNumber=B;
a.calculateTimeOnlyAndSqlInterval=f;a.calculateTimeOnlyAndString=wa;a.calculateTimeOnlyAndTimeOnly=Y;a.calculateTimeOnlyAndTimestamp=S;a.calculateTimestampAndDateOnly=ba;a.calculateTimestampAndDateTime=ea;a.calculateTimestampAndNumber=w;a.calculateTimestampAndSqlInterval=u;a.calculateTimestampAndString=L;a.calculateTimestampAndTimeOnly=T;a.calculateTimestampAndTimestamp=X;a.sqlCalculateFunction=function(Q,V,W,ha){if("||"===Q)return l.evaluateFunction("concat",[V,W],ha);if(null===V||null===W)return null;
if(r.isNumber(V)){if(r.isNumber(W))return m(V,W,Q);if(r.isSqlInterval(W))return n(V,W,Q);if(r.isTimeOnly(W))return z();if(r.isDateOnly(W))return D();if(r.isTimestampOffset(W))return C();if(r.isDateTime(W))return t();if(r.isString(W))return H(V,W,Q)}else if(r.isDateOnly(V)){if(r.isNumber(W))return y(V,W,Q);if(r.isSqlInterval(W))return e(V,W,Q);if(r.isTimeOnly(W))return M();if(r.isDateOnly(W))return E(V,W,Q);if(r.isTimestampOffset(W))return P(V,W,Q);if(r.isDateTime(W))return K(V,W,Q);if(r.isString(W))return xa()}else if(r.isTimeOnly(V)){if(r.isNumber(W))return B(V,
W,Q);if(r.isSqlInterval(W))return f(V,W,Q);if(r.isTimeOnly(W))return Y();if(r.isDateOnly(W))return ma();if(r.isTimestampOffset(W))return S();if(r.isDateTime(W))return ca();if(r.isString(W))return wa()}else if(r.isSqlInterval(V)){if(r.isNumber(W))return x(V,W,Q);if(r.isSqlInterval(W))return g(V,W,Q);if(r.isTimeOnly(W))return c(V,W,Q);if(r.isDateOnly(W))return d(V,W,Q);if(r.isTimestampOffset(W))return p(V,W,Q);if(r.isDateTime(W))return b(V,W,Q);if(r.isString(W))return F()}else if(r.isDateTime(V)){if(r.isNumber(W))return v(V,
W,Q);if(r.isSqlInterval(W))return h(V,W,Q);if(r.isTimeOnly(W))return va();if(r.isDateOnly(W))return na(V,W,Q);if(r.isTimestampOffset(W))return ta(V,W,Q);if(r.isDateTime(W))return ia(V,W,Q);if(r.isString(W))return Ca()}else if(r.isTimestampOffset(V)){if(r.isNumber(W))return w(V,W,Q);if(r.isSqlInterval(W))return u(V,W,Q);if(r.isTimeOnly(W))return T();if(r.isDateOnly(W))return ba(V,W,Q);if(r.isTimestampOffset(W))return X(V,W,Q);if(r.isDateTime(W))return ea(V,W,Q);if(r.isString(W))return L()}else if(r.isString(V)){if(r.isNumber(W))return G(V,
W,Q);if(r.isSqlInterval(W))return J();if(r.isTimeOnly(W))return R();if(r.isDateOnly(W))return fa();if(r.isTimestampOffset(W))return qa();if(r.isDateTime(W))return ka();if(r.isString(W))return A(V,W,Q)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,q,r,k,l,m,b,c){function d(v,y,B){B=n.exec(v);if(null!==B){const [,t,w,C,z,D,H,G]=B;v=c.DateTime.fromObject({year:parseInt(t,10),month:parseInt(w,10),day:parseInt(C,10),hour:parseInt(z,10),minute:parseInt(D,10),second:parseInt(H,10),millisecond:G?parseInt(G.replace(".",""),10):0},{zone:b.substituteUnknownTimezone(y)});if(!1===v.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return v}B=e.exec(v);if(null!==B){const [,t,w,C,z,D,H,G,A,F,J]=B;v=l.SqlTimeStampOffset.fromParts(parseInt(t,
10),parseInt(w,10),parseInt(C,10),parseInt(z,10),parseInt(D,10),parseInt(H,10),G?parseInt(G.replace(".",""),10):0,"-"===A,parseInt(F,10),parseInt(J,10));if(!1===v.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return v}B=h.exec(v);if(null!==B){const [,t,w,C,z,D,H,G,A]=B;v=l.SqlTimeStampOffset.fromParts(parseInt(t,10),parseInt(w,10),parseInt(C,10),parseInt(z,10),parseInt(D,10),0,0,"-"===H,parseInt(G,10),parseInt(A,10));if(!1===v.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);
return v}B=u.exec(v);if(null!==B){const [,t,w,C,z,D]=B;v=c.DateTime.fromObject({year:parseInt(t,10),month:parseInt(w,10),day:parseInt(C,10),hour:parseInt(z,10),minute:parseInt(D,10),second:0},{zone:b.substituteUnknownTimezone(y)});if(!1===v.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return v}B=x.exec(v);if(null!==B){const [,t,w,C]=B;v=c.DateTime.fromObject({year:parseInt(t,10),month:parseInt(w,10),day:parseInt(C,10),hour:0,minute:0,second:0},{zone:b.substituteUnknownTimezone(y)});
if(!1===v.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return v}throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);}const f=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,p=/^(\d{1,2}):(\d{1,2})$/,g=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,n=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,e=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,h=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,
u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(v,y){if(y instanceof c.Zone)return y===b.UnknownTimeZone.instance?c.DateTime.fromMillis(v.getTime(),{zone:b.UnknownTimeZone.instance}):c.DateTime.fromJSDate(v,{zone:y});switch(y){case "system":case "local":case null:return c.DateTime.fromJSDate(v);default:return"unknown"===y?.toLowerCase()?c.DateTime.fromMillis(v.getTime(),{zone:b.UnknownTimeZone.instance}):c.DateTime.fromJSDate(v,{zone:y})}};a.isDate=function(v){return v instanceof
Date};a.isDateOnly=function(v){return v instanceof r.DateOnly};a.isDateTime=function(v){return v instanceof c.DateTime};a.isNumber=function(v){return"number"===typeof v};a.isSqlInterval=function(v){return v instanceof k.SqlInterval};a.isString=function(v){return"string"===typeof v||v instanceof String};a.isTimeOnly=function(v){return v instanceof m.TimeOnly};a.isTimestampOffset=function(v){return v instanceof l.SqlTimeStampOffset};a.parseDate=function(v,y){const B=x.exec(v);if(null===B)try{return d(v,
y)}catch{throw new q.SqlError(q.SqlErrorCodes.InvalidDate);}const [,t,w,C]=B;v=r.DateOnly.fromParts(parseInt(t,10),parseInt(w,10),parseInt(C,10));if(null===v)throw new q.SqlError(q.SqlErrorCodes.InvalidDate);return v};a.parseTime=function(v){let y=f.exec(v);if(null!==y){const [,B,t,w]=y;v=m.TimeOnly.fromParts(parseInt(B,10),parseInt(t,10),parseInt(w,10),0);if(null!==v)return v;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}y=p.exec(v);if(null!==y){const [,B,t]=y;v=m.TimeOnly.fromParts(parseInt(B,
10),parseInt(t,10),0,0);if(null!==v)return v;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}y=g.exec(v);if(null!==y){const [,B,t,w,C]=y;v=m.TimeOnly.fromParts(parseInt(B,10),parseInt(t,10),parseInt(w,10),parseInt(C,10));if(null!==v)return v}throw new q.SqlError(q.SqlErrorCodes.InvalidTime);};a.parseTimestamp=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(a,q){class r{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(k){if(null!==k.precision||null!==k.secondary)throw new q.SqlError(q.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(k,l){l.includes(".")?(l=l.split("."),k.second=parseFloat(l[0]),k.millis=parseInt(l[1],10)):k.second=parseFloat(l)}static createFromMilliseconds(k){const l=new r;l.second=k/1E3;return l}static createFromValueAndQualifier(k,l,m){let b=null;const c=new r;c.op="-"===
m?"-":"+";if("interval-period"===l.type){r._fixDefaults(l);m=RegExp("^[0-9]{1,}$");if("year"===l.period||"month"===l.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);if("second"===l.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(k))r._parseSecondsComponent(c,k);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);else if(m.test(k))c[l.period]=parseFloat(k);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}else{r._fixDefaults(l.start);r._fixDefaults(l.end);if("year"===
l.start.period||"month"===l.start.period||"year"===l.end.period||"month"===l.end.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);switch(l.start.period){case "day":switch(l.end.period){case "hour":b=RegExp("^[0-9]{1,} [0-9]{1,}$");if(b.test(k))c[l.start.period]=parseFloat(k.split(" ")[0]),c[l.end.period]=parseFloat(k.split(" ")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "minute":b=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(b.test(k))c[l.start.period]=
parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),c.hour=parseFloat(k[0]),c.minute=parseFloat(k[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":b=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(k))c[l.start.period]=parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),c.hour=parseFloat(k[0]),c.minute=parseFloat(k[1]),r._parseSecondsComponent(c,k[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(l.end.period){case "minute":b=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(b.test(k))c.hour=parseFloat(k.split(":")[0]),c.minute=parseFloat(k.split(":")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":b=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(k))k=k.split(":"),c.hour=parseFloat(k[0]),c.minute=parseFloat(k[1]),r._parseSecondsComponent(c,k[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(l.end.period){case "second":b=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(k))k=k.split(":"),c.minute=parseFloat(k[0]),r._parseSecondsComponent(c,k[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}}return c}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(a,q,r,k,l,m,b,c){function d(h){return"string"===typeof h||h instanceof String}function f(h){return m.isDate(h)||m.isDateOnly(h)||
m.isDateTime(h)||m.isTimeOnly(h)||m.isTimestampOffset(h)?!1:!0}function p(h){return m.isDateOnly(h)||m.isTimeOnly(h)?h.toString():m.isTimestampOffset(h)?h.toSQLValue():m.isDateTime(h)?0===h.millisecond?h.toFormat("yyyy-LL-dd HH:mm:ss"):h.toSQL({includeOffset:!1}):m.isDate(h)?p(c.DateTime.fromJSDate(h)):h.toString()}function g(h){if(m.isDate(h))return k.DateOnly.fromDateJS(h);if(m.isDateTime(h))return k.DateOnly.fromParts(h.year,h.month,h.day);if(m.isDateOnly(h))return h;if(m.isTimeOnly(h))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(m.isTimestampOffset(h)&&null===k.DateOnly.fromParts(h.year,h.month,h.day))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(d(h)&&(h=k.DateOnly.fromReader(h),null!==h&&h.isValid))return h;throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function x(h,u,v){if(m.isDate(h))return m.convertToExecutingTimeZone(h,u);if(m.isDateTime(h))return h;if(m.isDateOnly(h))return h.toDateTimeLuxon("unknown");if(m.isTimeOnly(h))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(m.isTimestampOffset(h))return h;
if(d(h))return m.parseTimestamp(h,"unknown",v);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function n(h){if(m.isDate(h))return b.TimeOnly.fromDateJS(h);if(m.isDateTime(h))return b.TimeOnly.fromDateTime(h);if(m.isDateOnly(h))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(m.isTimeOnly(h))return h;if(m.isTimestampOffset(h))return b.TimeOnly.fromSqlTimeStampOffset(h);if(d(h))return m.parseTime(h);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}const e={extract:{minParams:2,
maxParams:2,evaluate:([h,u])=>{if(null==u)return null;if(m.isDate(u))switch(h.toUpperCase()){case "SECOND":return u.getSeconds();case "MINUTE":return u.getMinutes();case "HOUR":return u.getHours();case "DAY":return u.getDate();case "MONTH":return u.getMonth()+1;case "YEAR":return u.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(m.isDateTime(u))switch(h.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour;case "DAY":return u.day;
case "MONTH":return u.month;case "YEAR":return u.year}else if(m.isDateOnly(u))switch(h.toUpperCase()){case "DAY":return u.day;case "MONTH":return u.month;case "YEAR":return u.year}else if(m.isTimeOnly(u))switch(h.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour}else if(m.isTimestampOffset(u))switch(h.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour;case "DAY":return u.day;case "MONTH":return u.month;
case "YEAR":return u.year;case "TIMEZONE_HOUR":return u.timezoneOffsetHour;case "TIMEZONE_MINUTE":return u.timezoneOffsetMinutes}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:h=>{if(2===h.length){const [u,v]=h;return null==u||null==v?null:u.toString().substring(v-1)}if(3===h.length){const [u,v,y]=h;return null==u||null==v||null==y?null:0>=y?"":u.toString().substring(v-1,v+y-1)}}},position:{minParams:2,maxParams:2,
evaluate:([h,u])=>null==h||null==u?null:u.indexOf(h)+1},trim:{minParams:2,maxParams:3,evaluate:h=>{var u=3===h.length,v=u?h[1]:" ";u=u?h[2]:h[1];if(null==v||null==u)return null;v=`(${r.escapeRegExpString(v)})`;switch(h[0]){case "BOTH":return u.replaceAll(new RegExp(`^${v}*|${v}*$`,"g"),"");case "LEADING":return u.replaceAll(new RegExp(`^${v}*`,"g"),"");case "TRAILING":return u.replaceAll(new RegExp(`${v}*$`,"g"),"")}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.abs(h[0])},ceiling:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.ceil(h[0])},floor:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.floor(h[0])},log:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.log(h[0])},log10:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.log(h[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.sin(h[0])},cos:{minParams:1,maxParams:1,evaluate:h=>
null==h[0]?null:Math.cos(h[0])},tan:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.tan(h[0])},asin:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.asin(h[0])},acos:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.acos(h[0])},atan:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.atan(h[0])},sign:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:0<h[0]?1:0>h[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:h=>null==h[0]||null==h[1]?null:h[0]**h[1]},mod:{minParams:2,
maxParams:2,evaluate:h=>null==h[0]||null==h[1]?null:h[0]%h[1]},round:{minParams:1,maxParams:2,evaluate:h=>{const u=h[0];h=2===h.length?10**h[1]:1;return null==u?null:Math.round(u*h)/h}},truncate:{minParams:1,maxParams:2,evaluate:h=>null==h[0]?null:1===h.length?parseInt(h[0].toFixed(0),10):parseFloat(h[0].toFixed(h[1]))},char_length:{minParams:1,maxParams:1,evaluate:h=>d(h[0])?h[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:h=>{let u="";for(let v=0;v<h.length;v++){if(null==h[v])return null;
u+=h[v].toString()}return u}},lower:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:h[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:h[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:h=>{for(const u of h)if(null!==u)return u;return null}},cosh:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.cosh(h[0])},sinh:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.sinh(h[0])},tanh:{minParams:1,maxParams:1,evaluate:h=>
null==h[0]?null:Math.tanh(h[0])},nullif:{minParams:2,maxParams:2,evaluate:(h,u)=>l.sqlCompare(h[0],h[1],"\x3d")?null:h[0]},cast:{minParams:2,maxParams:2,evaluate:(h,u)=>{const v=h[0];h=h[1];if(null===v)return null;switch(h.type){case "integer":if(!f(v))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseInt(v,10);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "smallint":if(!f(v))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseInt(v,10);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(32767<u||-32767>u)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "float":case "real":if(!f(v))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseFloat(v);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "time":return n(v);case "date":return g(v);case "timestamp":return x(v,u,!0===h.withtimezone);case "varchar":u=p(v);if(u.length>h.size)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;default:throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);
}}}};a.evaluateFunction=function(h,u,v){const y=e[h.toLowerCase()];if(null==y)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(u.length<y.minParams||u.length>y.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:h.toUpperCase()});return y.evaluate(u,v)};a.isStandardized=function(h,u){h=e[h.toLowerCase()];return null!=h&&u>=h.minParams&&u<=h.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,q,r,k,l,m){function b(h){return r.isDateTime(h)||r.isTimestampOffset(h)?!0:!1}function c(h){return r.isDateTime(h)||r.isDateOnly(h)||r.isTimestampOffset(h)||r.isTimeOnly(h)?!0:!1}function d(h){if(r.isDateTime(h))return h.toMillis();if(r.isDateOnly(h))return h.toNumber();if(r.isTimestampOffset(h))return h.toMilliseconds();throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);}function f(h,u,v){switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<
u;case "\x3e\x3d":return h>=u;case "\x3c\x3d":return h<=u}}function p(h,u,v){const y=parseFloat(u);if(!isNaN(y))return f(h,y,v);h=h.toString();switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<u;case "\x3e\x3d":return h>=u;case "\x3c\x3d":return h<=u}}function g(h,u,v){const y=parseFloat(h);if(!isNaN(y))return f(y,u,v);u=u.toString();switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<
u;case "\x3e\x3d":return h>=u;case "\x3c\x3d":return h<=u}}function x(h,u,v){switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<u;case "\x3e\x3d":return h>=u;case "\x3c\x3d":return h<=u}}function n(h,u,v){h instanceof k.SqlTimeStampOffset&&(h=h.toDateTime());u instanceof k.SqlTimeStampOffset&&(u=u.toDateTime());h=e(h);u=e(u);switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<u;case "\x3e\x3d":return h>=
u;case "\x3c\x3d":return h<=u}}function e(h){return 321408E5*h.year+26784E5*h.month+864E5*h.day+36E5*h.hour+6E4*h.minute+1E3*h.second+h.millisecond}a.dateValueInMilliseconds=d;a.isDateOrTimeValue=c;a.isDateTimeComparableValue=b;a.sqlCompare=function(h,u,v,y){if(null==h||null==u)return null;if(r.isNumber(h)){if(r.isNumber(u))return f(h,u,v);if(r.isString(u))return p(h,u,v);if(c(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}else if(r.isString(h)){if(r.isNumber(u))return g(h,u,v);if(r.isString(u))return x(h,u,v);if(r.isDateTime(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isTimestampOffset(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isDateTime(h)){if(b(u)){if(h instanceof m.DateTime&&l.isUnknownTimeZone(h.zone)){if(u instanceof m.DateTime&&
!1===l.isUnknownTimeZone(u.zone)||u instanceof k.SqlTimeStampOffset)return n(h,u,v)}else if(u instanceof m.DateTime&&l.isUnknownTimeZone(u.zone)&&(h instanceof m.DateTime&&!1===l.isUnknownTimeZone(h.zone)||h instanceof k.SqlTimeStampOffset))return n(h,u,v);return f(d(h),d(u),v)}if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return u=u.toDateTimeLuxon(h.zone),h=h.startOf("day"),f(h.toMillis(),u.toMillis(),v);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isDateOnly(h)){if(r.isTimestampOffset(u))return h=h.toDateTimeLuxon(u.toDateTime().zone),u=u.startOfDay(),f(h.toMillis(),u.toMilliseconds(),v);if(r.isDateTime(u))return h=h.toDateTimeLuxon(u.zone),u=u.startOf("day"),f(h.toMillis(),u.toMillis(),v);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return f(h.toNumber(),u.toNumber(),v);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isTimeOnly(h)){if(r.isTimeOnly(u))return f(h.toNumber(),u.toNumber(),v);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(b(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isTimestampOffset(h)){if(b(u))return u instanceof m.DateTime&&
l.isUnknownTimeZone(u.zone)?n(h,u,v):f(d(h),d(u),v);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return u=u.toDateTimeLuxon(h.toDateTime().zone),h=h.startOfDay(),f(h.toMilliseconds(),u.toMillis(),v);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}switch(v){case "\x3c\x3e":return h!==u;case "\x3d":return h===u;case "\x3e":return h>u;case "\x3c":return h<u;case "\x3e\x3d":return h>=
u;case "\x3c\x3d":return h<=u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,q){var r={exports:{}};(function(m){(function(b,c){m.exports&&(m.exports=c())})(q.commonjsGlobal,function(){function b(d,f,p,g){d=Error.call(this,d);Object.setPrototypeOf&&Object.setPrototypeOf(d,b.prototype);d.expected=f;d.found=p;d.location=g;d.name="SyntaxError";return d}function c(d,f,p){p=p||" ";if(d.length>
f)return d;f-=d.length;p+=p.repeat(f);return d+p.slice(0,f)}(function(d,f){function p(){this.constructor=d}p.prototype=f.prototype;d.prototype=new p})(b,Error);b.prototype.format=function(d){var f="Error: "+this.message;if(this.location){var p=null,g;for(g=0;g<d.length;g++)if(d[g].source===this.location.source){p=d[g].text.split(/\r\n|\n|\r/g);break}d=this.location.start;g=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(d):d;var x=this.location.source+
":"+g.line+":"+g.column;if(p){var n=this.location.end,e=c("",g.line.toString().length," ");p=p[d.line-1];n=(d.line===n.line?n.column:p.length+1)-d.column||1;f+="\n --\x3e "+x+"\n"+e+" |\n"+g.line+" | "+p+"\n"+e+" | "+c("",d.column-1," ")+c("",n,"^")}else f+="\n at "+x}return f};b.buildMessage=function(d,f){function p(h){return h.charCodeAt(0).toString(16).toUpperCase()}function g(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+p(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+p(u)})}function x(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+p(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+p(u)})}function n(h){return e[h.type](h)}var e={literal:function(h){return'"'+
g(h.text)+'"'},class:function(h){var u=h.parts.map(function(v){return Array.isArray(v)?x(v[0])+"-"+x(v[1]):x(v)});return"["+(h.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(h){return h.description}};return"Expected "+function(h){h=h.map(n);var u,v;h.sort();if(0<h.length){for(v=u=1;u<h.length;u++)h[u-1]!==h[u]&&(h[v]=h[u],v++);h.length=v}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,
-1).join(", ")+", or "+h[h.length-1]}}(d)+" but "+(f?'"'+g(f)+'"':"end of input")+" found."};return{SyntaxError:b,parse:function(d,f){function p(U,Z){Z=void 0!==Z?Z:e(ya,O);throw new b(U,null,null,Z);}function g(U,Z){return{type:"literal",text:U,ignoreCase:Z}}function x(U,Z,da){return{type:"class",parts:U,inverted:Z,ignoreCase:da}}function n(U){var Z=fe[U],da;if(!Z){for(da=U-1;!fe[da];)da--;Z=fe[da];for(Z={line:Z.line,column:Z.column};da<U;)10===d.charCodeAt(da)?(Z.line++,Z.column=1):Z.column++,da++;
fe[U]=Z}return Z}function e(U,Z,da){var pa=n(U),Ba=n(Z);U={source:sb,start:{offset:U,line:pa.line,column:pa.column},end:{offset:Z,line:Ba.line,column:Ba.column}};da&&sb&&"function"===typeof sb.offset&&(U.start=sb.offset(U.start),U.end=sb.offset(U.end));return U}function h(U){O<Bb||(O>Bb&&(Bb=O,Ze=[]),Ze.push(U))}function u(){var U=O;sa();var Z=y();Z!==I?(sa(),ya=U,U=Z):(O=U,U=I);return U}function v(){var U=O;var Z=y();if(Z!==I){var da=[];var pa=O;var Ba=sa();var Ia=Ra();if(Ia!==I){var La=sa();var Na=
y();Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)}else O=pa,pa=I;for(;pa!==I;)da.push(pa),pa=O,Ba=sa(),Ia=Ra(),Ia!==I?(La=sa(),Na=y(),Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)):(O=pa,pa=I);ya=U;U={type:"expression-list"};Z=[Z];for(pa=0;pa<da.length;pa++)Z.push(da[pa][3]);U.value=Z}else O=U,U=I;return U}function y(){var U=O;var Z=B();if(Z!==I){var da=[];var pa=O;var Ba=sa();var Ia=W();if(Ia!==I){var La=sa();var Na=B();Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)}else O=pa,pa=I;for(;pa!==I;)da.push(pa),pa=O,Ba=sa(),
Ia=W(),Ia!==I?(La=sa(),Na=B(),Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)):(O=pa,pa=I);ya=U;U=jb(Z,da)}else O=U,U=I;return U}function B(){var U=O;var Z=t();if(Z!==I){var da=[];var pa=O;var Ba=sa();var Ia=V();if(Ia!==I){var La=sa();var Na=t();Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)}else O=pa,pa=I;for(;pa!==I;)da.push(pa),pa=O,Ba=sa(),Ia=V(),Ia!==I?(La=sa(),Na=t(),Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)):(O=pa,pa=I);ya=U;U=jb(Z,da)}else O=U,U=I;return U}function t(){var U=O;var Z=Q();if(Z===I){Z=O;if(33===
d.charCodeAt(O)){var da=dd;O++}else da=I,0===ra&&h(yb);if(da!==I){var pa=O;ra++;if(61===d.charCodeAt(O)){var Ba=Gc;O++}else Ba=I,0===ra&&h(db);ra--;Ba===I?pa=void 0:(O=pa,pa=I);pa!==I?Z=da=[da,pa]:(O=Z,Z=I)}else O=Z,Z=I}Z!==I?(da=sa(),pa=t(),pa!==I?(ya=U,U={type:"unary-expression",operator:"NOT",expr:pa}):(O=U,U=I)):(O=U,U=I);if(U===I){Z=O;U=D();if(U!==I){sa();da=O;pa=[];Ba=O;var Ia=sa();var La=w();if(La!==I){var Na=sa();var kc=D();kc!==I?Ba=Ia=[Ia,La,Na,kc]:(O=Ba,Ba=I)}else O=Ba,Ba=I;if(Ba!==I)for(;Ba!==
I;)pa.push(Ba),Ba=O,Ia=sa(),La=w(),La!==I?(Na=sa(),kc=D(),kc!==I?Ba=Ia=[Ia,La,Na,kc]:(O=Ba,Ba=I)):(O=Ba,Ba=I);else pa=I;pa!==I&&(ya=da,pa={type:"arithmetic",tail:pa});da=pa;da===I&&(da=O,pa=z(),pa!==I?(sa(),Ba=Ma(),Ba!==I?(sa(),Ba=v(),Ba!==I?(sa(),Ia=Pa(),Ia!==I?(ya=da,da={op:pa,right:Ba}):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=z(),pa!==I?(sa(),Ba=Ma(),Ba!==I?(sa(),Ba=Pa(),Ba!==I?(ya=da,da={op:pa,right:{type:"expression-list",value:[]}}):(O=da,da=I)):(O=da,da=I)):(O=da,
da=I),da===I&&(da=O,pa=z(),pa!==I?(sa(),Ba=ba(),Ba!==I?(ya=da,da={op:pa,right:Ba}):(O=da,da=I)):(O=da,da=I))),da===I&&(da=O,Ia=Q(),Ia!==I?(sa(),pa=ha(),pa!==I?(sa(),Ba=D(),Ba!==I?(sa(),La=V(),La!==I?(sa(),Ia=D(),Ia!==I?(ya=da,da={op:"NOT"+pa,right:{type:"expression-list",value:[Ba,Ia]}}):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,Ia=ha(),Ia!==I?(sa(),pa=D(),pa!==I?(sa(),Ba=V(),Ba!==I?(sa(),La=D(),La!==I?(ya=da,da={op:Ia,right:{type:"expression-list",value:[pa,La]}}):
(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)),da===I&&(da=O,pa=ka(),pa!==I?(sa(),Ba=Q(),Ba!==I?(sa(),Ba=D(),Ba!==I?(ya=da,da={op:pa+"NOT",right:Ba}):(O=da,da=I)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=ka(),pa!==I?(sa(),Ba=D(),Ba!==I?(ya=da,da={op:pa,right:Ba}):(O=da,da=I)):(O=da,da=I)),da===I&&(da=O,pa=C(),pa!==I?(sa(),Ba=Y(),Ba!==I?(sa(),Ia=O,d.substr(O,6).toLowerCase()===nb?(La=d.substr(O,6),O+=6):(La=I,0===ra&&h(be)),La!==I?(La=O,ra++,Na=P(),ra--,Na===I?La=void 0:(O=La,La=I),La!==I?(ya=
Ia,Ia="ESCAPE"):(O=Ia,Ia=I)):(O=Ia,Ia=I),Ia!==I?(sa(),Ia=ia(),Ia!==I?(ya=da,da={op:pa,right:Ba,escape:Ia.value}):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=C(),pa!==I?(sa(),Ba=Y(),Ba!==I?(ya=da,da={op:pa,right:Ba,escape:""}):(O=da,da=I)):(O=da,da=I))))));da===I&&(da=null);ya=Z;Z=da;""==Z||void 0==Z||null==Z?Z=U:(da=null,Z=da="arithmetic"==Z.type?jb(U,Z.tail):cb(Z.op,U,Z.right,Z.escape))}else O=Z,Z=I;U=Z}return U}function w(){if(d.substr(O,2)===ed){var U=ed;O+=2}else U=I,0===
ra&&h(lb);U===I&&(62===d.charCodeAt(O)?(U=fd,O++):(U=I,0===ra&&h(Sc)),U===I&&(d.substr(O,2)===Eb?(U=Eb,O+=2):(U=I,0===ra&&h(Wd)),U===I&&(d.substr(O,2)===gd?(U=gd,O+=2):(U=I,0===ra&&h(fc)),U===I&&(60===d.charCodeAt(O)?(U=Ya,O++):(U=I,0===ra&&h(Qe)),U===I&&(61===d.charCodeAt(O)?(U=Gc,O++):(U=I,0===ra&&h(db)),U===I&&(d.substr(O,2)===Fb?(U=Fb,O+=2):(U=I,0===ra&&h(Re))))))));return U}function C(){var U;var Z=U=O;var da=Q();if(da!==I){var pa=sa();var Ba=qa();Ba!==I?Z=da=[da,pa,Ba]:(O=Z,Z=I)}else O=Z,Z=
I;Z!==I&&(ya=U,Z=Z[0]+" "+Z[2]);U=Z;U===I&&(U=qa());return U}function z(){var U;var Z=U=O;var da=Q();if(da!==I){var pa=sa();var Ba=fa();Ba!==I?Z=da=[da,pa,Ba]:(O=Z,Z=I)}else O=Z,Z=I;Z!==I&&(ya=U,Z=Z[0]+" "+Z[2]);U=Z;U===I&&(U=fa());return U}function D(){var U=O;var Z=G();if(Z!==I){var da=[];var pa=O;var Ba=sa();var Ia=H();if(Ia!==I){var La=sa();var Na=G();Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)}else O=pa,pa=I;for(;pa!==I;)da.push(pa),pa=O,Ba=sa(),Ia=H(),Ia!==I?(La=sa(),Na=G(),Na!==I?pa=Ba=[Ba,Ia,La,
Na]:(O=pa,pa=I)):(O=pa,pa=I);ya=U;U=jb(Z,da)}else O=U,U=I;return U}function H(){if(43===d.charCodeAt(O)){var U=pb;O++}else U=I,0===ra&&h(Tc);U===I&&(45===d.charCodeAt(O)?(U=tb,O++):(U=I,0===ra&&h(Uc)),U===I&&(d.substr(O,2)===Yb?(U=Yb,O+=2):(U=I,0===ra&&h(Xd))));return U}function G(){var U=O;var Z=F();if(Z!==I){var da=[];var pa=O;var Ba=sa();var Ia=A();if(Ia!==I){var La=sa();var Na=F();Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)}else O=pa,pa=I;for(;pa!==I;)da.push(pa),pa=O,Ba=sa(),Ia=A(),Ia!==I?(La=sa(),
Na=F(),Na!==I?pa=Ba=[Ba,Ia,La,Na]:(O=pa,pa=I)):(O=pa,pa=I);ya=U;U=jb(Z,da)}else O=U,U=I;return U}function A(){if(42===d.charCodeAt(O)){var U=Sb;O++}else U=I,0===ra&&h(Se);U===I&&(47===d.charCodeAt(O)?(U=Md,O++):(U=I,0===ra&&h(Yd)));return U}function F(){var U=ia();if(U===I){var Z=O;var da=O;var pa=xa();if(pa!==I){var Ba=wa();if(Ba!==I){var Ia=Ca();Ia!==I?(ya=da,da=parseFloat(pa+Ba+Ia)):(O=da,da=I)}else O=da,da=I}else O=da,da=I;da===I&&(da=O,pa=xa(),pa!==I?(Ba=wa(),Ba!==I?(ya=da,da=parseFloat(pa+Ba)):
(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=xa(),pa!==I?(Ba=Ca(),Ba!==I?(ya=da,da=parseFloat(pa+Ba)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=xa(),pa!==I&&(ya=da,pa=parseFloat(pa)),da=pa)));var La=da;if(La!==I){var Na=O;ra++;var kc=K();ra--;kc===I?Na=void 0:(O=Na,Na=I);Na!==I?(ya=Z,Z={type:"number",value:La}):(O=Z,Z=I)}else O=Z,Z=I;U=Z;if(U===I){var lc=O;var $c=O;if(d.substr(O,4).toLowerCase()===He){var ge=d.substr(O,4);O+=4}else ge=I,0===ra&&h(hc);if(ge!==I){var Bd=O;ra++;var Rf=P();ra--;Rf===I?Bd=
void 0:(O=Bd,Bd=I);Bd!==I?$c=ge=[ge,Bd]:(O=$c,$c=I)}else O=$c,$c=I;var mc=$c;mc!==I&&(ya=lc,mc={type:"boolean",value:!0});lc=mc;if(lc===I){lc=O;var ad=O;if(d.substr(O,5).toLowerCase()===Od){var he=d.substr(O,5);O+=5}else he=I,0===ra&&h(Xc);if(he!==I){var Cd=O;ra++;var Sf=P();ra--;Sf===I?Cd=void 0:(O=Cd,Cd=I);Cd!==I?ad=he=[he,Cd]:(O=ad,ad=I)}else O=ad,ad=I;mc=ad;mc!==I&&(ya=lc,mc={type:"boolean",value:!1});lc=mc}U=lc;if(U===I){var Tf=O;var bd=O;if(d.substr(O,4).toLowerCase()===Ge){var ie=d.substr(O,
4);O+=4}else ie=I,0===ra&&h(Xb);if(ie!==I){var Dd=O;ra++;var Uf=P();ra--;Uf===I?Dd=void 0:(O=Dd,Dd=I);Dd!==I?bd=ie=[ie,Dd]:(O=bd,bd=I)}else O=bd,bd=I;var $e=bd;$e!==I&&(ya=Tf,$e={type:"null",value:null});U=$e;if(U===I){var nc=O;if(ja()!==I){sa();var je=Y();je!==I?(ya=nc,"string"===je.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(je.value)&&
p("Date literal is invalid"),nc={type:"date",value:je.value}):(O=nc,nc=I)}else O=nc,nc=I;U=nc;if(U===I){var oc=O;if(aa()!==I){sa();var ke=Y();ke!==I?(ya=oc,"string"===ke.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(ke.value)&&
p("Timestamp literal is invalid"),oc={type:"timestamp",value:ke.value}):(O=oc,oc=I)}else O=oc,oc=I;U=oc;if(U===I){var Za=O;var af=ua();if(af!==I){sa();if(45===d.charCodeAt(O)){var Mb=tb;O++}else Mb=I,0===ra&&h(Uc);Mb===I&&(43===d.charCodeAt(O)?(Mb=pb,O++):(Mb=I,0===ra&&h(Tc)));if(Mb!==I){sa();var Ed=Y();if(Ed!==I){sa();var of=X();of!==I?(ya=Za,Za={type:"interval",value:Ed,qualifier:of,op:Mb}):(O=Za,Za=I)}else O=Za,Za=I}else O=Za,Za=I}else O=Za,Za=I;Za===I&&(Za=O,af=ua(),af!==I?(sa(),Mb=Y(),Mb!==I?
(sa(),Ed=X(),Ed!==I?(ya=Za,Za={type:"interval",value:Mb,qualifier:Ed,op:""}):(O=Za,Za=I)):(O=Za,Za=I)):(O=Za,Za=I));U=Za;if(U===I){var pc=O;if(oa()!==I){sa();var le=Y();le!==I?(ya=pc,"string"===le.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(le.value)&&p("Time literal is invalid"),pc={type:"time",value:le.value}):(O=pc,pc=I)}else O=pc,pc=I;U=pc}}}}}}}var Ta=U;if(Ta===I){var eb=O;var qc=O;if(d.substr(O,7).toLowerCase()===Rd){var pf=
d.substr(O,7);O+=7}else pf=I,0===ra&&h(jc);if(pf!==I){var me=O;ra++;var Vf=P();ra--;Vf===I?me=void 0:(O=me,me=I);me!==I?(ya=qc,qc="EXTRACT"):(O=qc,qc=I)}else O=qc,qc=I;if(qc!==I){sa();var Wf=Ma();if(Wf!==I){sa();var fb=za();if(fb===I&&(fb=Aa(),fb===I&&(fb=Ga(),fb===I&&(fb=Da(),fb===I&&(fb=Ha(),fb===I&&(fb=Fa(),fb===I)))))){var rc=O;if(d.substr(O,13).toLowerCase()===Nc){var qf=d.substr(O,13);O+=13}else qf=I,0===ra&&h(Xf);if(qf!==I){var ne=O;ra++;var Yf=P();ra--;Yf===I?ne=void 0:(O=ne,ne=I);ne!==I?
(ya=rc,rc="TIMEZONE_HOUR"):(O=rc,rc=I)}else O=rc,rc=I;fb=rc;if(fb===I){var sc=O;if(d.substr(O,15).toLowerCase()===Le){var rf=d.substr(O,15);O+=15}else rf=I,0===ra&&h(Zf);if(rf!==I){var oe=O;ra++;var $f=P();ra--;$f===I?oe=void 0:(O=oe,oe=I);oe!==I?(ya=sc,sc="TIMEZONE_MINUTE"):(O=sc,sc=I)}else O=sc,sc=I;fb=sc}}var sf=fb;if(sf!==I){sa();var ag=la();if(ag!==I){sa();var tf=y();if(tf!==I){sa();var bg=Pa();bg!==I?(ya=eb,eb={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",
value:sf},tf]}}):(O=eb,eb=I)}else O=eb,eb=I}else O=eb,eb=I}else O=eb,eb=I}else O=eb,eb=I}else O=eb,eb=I;Ta=eb;if(Ta===I){var gb=O;var tc=O;if(d.substr(O,9).toLowerCase()===ac){var uf=d.substr(O,9);O+=9}else uf=I,0===ra&&h(Ab);if(uf!==I){var pe=O;ra++;var cg=P();ra--;cg===I?pe=void 0:(O=pe,pe=I);pe!==I?(ya=tc,tc="SUBSTRING"):(O=tc,tc=I)}else O=tc,tc=I;if(tc!==I){sa();var dg=Ma();if(dg!==I){sa();var bf=y();if(bf!==I){sa();var eg=la();if(eg!==I){sa();var cf=y();if(cf!==I){sa();var Nb=O;var uc=O;if(d.substr(O,
3).toLowerCase()===id){var vf=d.substr(O,3);O+=3}else vf=I,0===ra&&h(yd);if(vf!==I){var qe=O;ra++;var fg=P();ra--;fg===I?qe=void 0:(O=qe,qe=I);qe!==I?(ya=uc,uc="FOR"):(O=uc,uc=I)}else O=uc,uc=I;var Fd=uc;if(Fd!==I){var gg=sa();var wf=y();if(wf!==I){var hg=sa();Nb=Fd=[Fd,gg,wf,hg]}else O=Nb,Nb=I}else O=Nb,Nb=I;Nb===I&&(Nb=null);Fd=Pa();Fd!==I?(ya=gb,gb={type:"function",name:"substring",args:{type:"expression-list",value:Nb?[bf,cf,Nb[2]]:[bf,cf]}}):(O=gb,gb=I)}else O=gb,gb=I}else O=gb,gb=I}else O=gb,
gb=I}else O=gb,gb=I}else O=gb,gb=I;Ta=gb;if(Ta===I){var Va=O;var df=N();if(df!==I){sa();var ef=Ma();if(ef!==I){sa();var Ob=ea();Ob===I&&(Ob=null);sa();var Gd=y();if(Gd!==I){sa();var ff=la();if(ff!==I){sa();var xf=y();if(xf!==I){sa();var ig=Pa();ig!==I?(ya=Va,Va={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ob?"BOTH":Ob},Gd,xf]}}):(O=Va,Va=I)}else O=Va,Va=I}else O=Va,Va=I}else O=Va,Va=I}else O=Va,Va=I}else O=Va,Va=I;Va===I&&(Va=O,df=N(),df!==I?(sa(),ef=
Ma(),ef!==I?(sa(),Ob=ea(),Ob===I&&(Ob=null),sa(),Gd=y(),Gd!==I?(sa(),ff=Pa(),ff!==I?(ya=Va,Va={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ob?"BOTH":Ob},Gd]}}):(O=Va,Va=I)):(O=Va,Va=I)):(O=Va,Va=I)):(O=Va,Va=I));Ta=Va;if(Ta===I){var hb=O;var vc=O;if(d.substr(O,8).toLowerCase()===Ie){var yf=d.substr(O,8);O+=8}else yf=I,0===ra&&h(zd);if(yf!==I){var re=O;ra++;var jg=P();ra--;jg===I?re=void 0:(O=re,re=I);re!==I?(ya=vc,vc="POSITION"):(O=vc,vc=I)}else O=vc,
vc=I;if(vc!==I){sa();var kg=Ma();if(kg!==I){sa();var zf=y();if(zf!==I){sa();var lg=fa();if(lg!==I){sa();var Af=y();if(Af!==I){sa();var mg=Pa();mg!==I?(ya=hb,hb={type:"function",name:"position",args:{type:"expression-list",value:[zf,Af]}}):(O=hb,hb=I)}else O=hb,hb=I}else O=hb,hb=I}else O=hb,hb=I}else O=hb,hb=I}else O=hb,hb=I;Ta=hb;if(Ta===I){var ib=O;var wc=O;if(d.substr(O,4).toLowerCase()===Lc){var Bf=d.substr(O,4);O+=4}else Bf=I,0===ra&&h(ee);if(Bf!==I){var se=O;ra++;var ng=P();ra--;ng===I?se=void 0:
(O=se,se=I);se!==I?(ya=wc,wc="CAST"):(O=wc,wc=I)}else O=wc,wc=I;if(wc!==I){sa();var og=Ma();if(og!==I){sa();var Cf=y();if(Cf!==I){sa();var xc=O;if(d.substr(O,2).toLowerCase()===Ib){var Df=d.substr(O,2);O+=2}else Df=I,0===ra&&h(Ja);if(Df!==I){var te=O;ra++;var pg=P();ra--;pg===I?te=void 0:(O=te,te=I);te!==I?(ya=xc,xc="AS"):(O=xc,xc=I)}else O=xc,xc=I;var qg=xc;if(qg!==I){sa();var Oa=O;var yc=O;if(d.substr(O,7).toLowerCase()===Mc){var Ef=d.substr(O,7);O+=7}else Ef=I,0===ra&&h(Wa);if(Ef!==I){var ue=O;
ra++;var rg=P();ra--;rg===I?ue=void 0:(O=ue,ue=I);ue!==I?(ya=yc,yc="INTEGER"):(O=yc,yc=I)}else O=yc,yc=I;var Ua=yc;Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"integer"}});Oa=Ua;if(Oa===I){Oa=O;var zc=O;if(d.substr(O,8).toLowerCase()===ld){var Ff=d.substr(O,8);O+=8}else Ff=I,0===ra&&h(ab);if(Ff!==I){var ve=O;ra++;var sg=P();ra--;sg===I?ve=void 0:(O=ve,ve=I);ve!==I?(ya=zc,zc="SMALLINT"):(O=zc,zc=I)}else O=zc,zc=I;Ua=zc;Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"smallint"}});Oa=Ua;if(Oa===
I){Oa=O;var Ac=O;if(d.substr(O,5).toLowerCase()===Vb){var Gf=d.substr(O,5);O+=5}else Gf=I,0===ra&&h(xb);if(Gf!==I){var we=O;ra++;var tg=P();ra--;tg===I?we=void 0:(O=we,we=I);we!==I?(ya=Ac,Ac="FLOAT"):(O=Ac,Ac=I)}else O=Ac,Ac=I;Ua=Ac;Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"float"}});Oa=Ua;if(Oa===I){Oa=O;var Bc=O;if(d.substr(O,4).toLowerCase()===Ke){var Hf=d.substr(O,4);O+=4}else Hf=I,0===ra&&h(ug);if(Hf!==I){var xe=O;ra++;var vg=P();ra--;vg===I?xe=void 0:(O=xe,xe=I);xe!==I?(ya=Bc,Bc="REAL"):
(O=Bc,Bc=I)}else O=Bc,Bc=I;Ua=Bc;Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"real"}});Oa=Ua;if(Oa===I&&(Oa=O,Ua=ja(),Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"date"}}),Oa=Ua,Oa===I&&(Oa=O,Ua=aa(),Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"timestamp"}}),Oa=Ua,Oa===I&&(Oa=O,Ua=oa(),Ua!==I&&(ya=Oa,Ua={type:"data-type",value:{type:"time"}}),Oa=Ua,Oa===I)))){Oa=O;var Cc=O;if(d.substr(O,7).toLowerCase()===kb){var If=d.substr(O,7);O+=7}else If=I,0===ra&&h(wg);if(If!==I){var ye=O;ra++;var xg=
P();ra--;xg===I?ye=void 0:(O=ye,ye=I);ye!==I?(ya=Cc,Cc="VARCHAR"):(O=Cc,Cc=I)}else O=Cc,Cc=I;Ua=Cc;if(Ua!==I){sa();var yg=Ma();if(yg!==I){sa();var Jf=L();if(Jf!==I){sa();var zg=Pa();zg!==I?(ya=Oa,Oa={type:"data-type",value:{type:"varchar",size:parseInt(Jf)}}):(O=Oa,Oa=I)}else O=Oa,Oa=I}else O=Oa,Oa=I}else O=Oa,Oa=I}}}}var Kf=Oa;if(Kf!==I){sa();var Ag=Pa();Ag!==I?(ya=ib,ib={type:"function",name:"cast",args:{type:"expression-list",value:[Cf,Kf]}}):(O=ib,ib=I)}else O=ib,ib=I}else O=ib,ib=I}else O=ib,
ib=I}else O=ib,ib=I}else O=ib,ib=I;Ta=ib;if(Ta===I){var Pb=O;var mb=O;var Hd=J();Hd!==I&&(ya=mb);mb=Hd;if(mb===I)if(mb=O,96===d.charCodeAt(O)?(Hd=Td,O++):(Hd=I,0===ra&&h(Lf)),Hd!==I){var ze=[];if(ec.test(d.charAt(O))){var Qb=d.charAt(O);O++}else Qb=I,0===ra&&h(Mf);if(Qb!==I)for(;Qb!==I;)ze.push(Qb),ec.test(d.charAt(O))?(Qb=d.charAt(O),O++):(Qb=I,0===ra&&h(Mf));else ze=I;ze!==I?(96===d.charCodeAt(O)?(Qb=Td,O++):(Qb=I,0===ra&&h(Lf)),Qb!==I?(ya=mb,mb=ze.join("")):(O=mb,mb=I)):(O=mb,mb=I)}else O=mb,mb=
I;var Nf=mb;if(Nf!==I){sa();var Bg=Ma();if(Bg!==I){sa();var Ae=v();Ae===I&&(Ae=null);sa();var Cg=Pa();Cg!==I?(ya=Pb,Pb={type:"function",name:Nf,args:Ae?Ae:{type:"expression-list",value:[]}}):(O=Pb,Pb=I)}else O=Pb,Pb=I}else O=Pb,Pb=I;Ta=Pb;if(Ta===I){var Cb;var $a=O;var gf=Ea();if(gf!==I){sa();var Id=y();if(Id!==I){sa();var Jd=[];for(Cb=ta();Cb!==I;)Jd.push(Cb),Cb=ta();Cb=sa();var Be=Ka();Be!==I?(ya=$a,$a={type:"case-expression",format:"simple",operand:Id,clauses:Jd,else:null}):(O=$a,$a=I)}else O=
$a,$a=I}else O=$a,$a=I;if($a===I)if($a=O,gf=Ea(),gf!==I)if(sa(),Id=y(),Id!==I){sa();Jd=[];for(Cb=ta();Cb!==I;)Jd.push(Cb),Cb=ta();Cb=sa();Be=va();if(Be!==I){sa();var Dg=Ka();Dg!==I?(ya=$a,$a={type:"case-expression",format:"simple",operand:Id,clauses:Jd,else:Be.value}):(O=$a,$a=I)}else O=$a,$a=I}else O=$a,$a=I;else O=$a,$a=I;var hf=$a;if(hf===I){var Db;var bb=O;var jf=Ea();if(jf!==I){sa();var Kd=[];for(Db=na();Db!==I;)Kd.push(Db),Db=na();Db=sa();var Ce=Ka();Ce!==I?(ya=bb,bb={type:"case-expression",
format:"searched",clauses:Kd,else:null}):(O=bb,bb=I)}else O=bb,bb=I;if(bb===I)if(bb=O,jf=Ea(),jf!==I){sa();Kd=[];for(Db=na();Db!==I;)Kd.push(Db),Db=na();Db=sa();Ce=va();if(Ce!==I){sa();var Eg=Ka();Eg!==I?(ya=bb,bb={type:"case-expression",format:"searched",clauses:Kd,else:Ce.value}):(O=bb,bb=I)}else O=bb,bb=I}else O=bb,bb=I;hf=bb}Ta=hf;if(Ta===I){var Dc=O;var Fg=O;var De;var Ld=O;var Of=K();if(Of!==I){var Pf=[];for(De=E();De!==I;)Pf.push(De),De=E();ya=Ld;Ld=Of+Pf.join("")}else O=Ld,Ld=I;var Qf=Ld;
Qf!==I&&(ya=Fg);var Rb=Qf;if(Rb!==I){ya=Dc;var kf=Rb;Rb=/^CURRENT_DATE$/i.test(kf)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(kf)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:kf}}Dc=Rb;if(Dc===I){Dc=O;var Ec=O;if(T()!==I){var Ee;var Gg=O;var lf=[];for(Ee=M();Ee!==I;)lf.push(Ee),Ee=M();ya=Gg;var Hg=lf=lf.join("");var Ig=T();Ig!==I?(ya=Ec,Ec=Hg):(O=Ec,Ec=I)}else O=Ec,Ec=I;Rb=Ec;Rb!==I&&(ya=Dc,Rb={type:"column-reference",table:"",column:Rb,delimited:!0});
Dc=Rb}Ta=Dc;if(Ta===I&&(Ta=ba(),Ta===I)){Ta=O;var Jg=Ma();if(Jg!==I){sa();var mf=y();if(mf!==I){sa();var Kg=Pa();Kg!==I?(ya=Ta,mf.paren=!0,Ta=mf):(O=Ta,Ta=I)}else O=Ta,Ta=I}else O=Ta,Ta=I}}}}}}}}}return Ta}function J(){var U;var Z=O;var da=K();if(da!==I){var pa=[];for(U=P();U!==I;)pa.push(U),U=P();ya=Z;Z=da+pa.join("")}else O=Z,Z=I;return Z}function K(){if(Ne.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(Te);return U}function P(){if(dc.test(d.charAt(O))){var U=d.charAt(O);O++}else U=
I,0===ra&&h(Zd);return U}function E(){if(qb.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(rd);return U}function M(){if(qb.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(rd);if(U===I)if(U=O,T()!==I){var Z=T();Z!==I?(ya=U,U='"'):(O=U,U=I)}else O=U,U=I;return U}function T(){if(wb.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(gc);return U}function ba(){var U;var Z=U=O;if(64===d.charCodeAt(O)){var da=Fe;O++}else da=I,0===ra&&h(Vc);if(da!==I){var pa=J();pa!==I?Z=
da=[da,pa]:(O=Z,Z=I)}else O=Z,Z=I;Z!==I&&(ya=U,Z={type:"parameter",value:Z[1]});return Z}function ea(){var U=O;if(d.substr(O,7).toLowerCase()===cc){var Z=d.substr(O,7);O+=7}else Z=I,0===ra&&h(Zc);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="LEADING"):(O=U,U=I)}else O=U,U=I;U===I&&(U=O,d.substr(O,8).toLowerCase()===kd?(Z=d.substr(O,8),O+=8):(Z=I,0===ra&&h(Ad)),Z!==I?(Z=O,ra++,da=P(),ra--,da===I?Z=void 0:(O=Z,Z=I),Z!==I?(ya=U,U="TRAILING"):(O=U,U=I)):(O=U,U=I),U===I&&
(U=O,d.substr(O,4).toLowerCase()===Je?(Z=d.substr(O,4),O+=4):(Z=I,0===ra&&h(Ye)),Z!==I?(Z=O,ra++,da=P(),ra--,da===I?Z=void 0:(O=Z,Z=I),Z!==I?(ya=U,U="BOTH"):(O=U,U=I)):(O=U,U=I)));return U}function X(){var U=O;var Z=O;var da=ca();if(da!==I){sa();var pa=Ma();if(pa!==I)if(sa(),pa=S(),pa!==I){sa();var Ba=Pa();Ba!==I?(ya=Z,Z={type:"interval-period",period:da.value,precision:pa,secondary:null}):(O=Z,Z=I)}else O=Z,Z=I;else O=Z,Z=I}else O=Z,Z=I;Z===I&&(Z=O,da=ca(),da!==I&&(ya=Z,da={type:"interval-period",
period:da.value,precision:null,secondary:null}),Z=da);if(Z!==I)if(sa(),da=O,d.substr(O,2).toLowerCase()===ub?(pa=d.substr(O,2),O+=2):(pa=I,0===ra&&h(Lg)),pa!==I?(pa=O,ra++,Ba=P(),ra--,Ba===I?pa=void 0:(O=pa,pa=I),pa!==I?(ya=da,da="TO"):(O=da,da=I)):(O=da,da=I),da!==I){sa();da=O;pa=ca();pa!==I&&(ya=da,pa={type:"interval-period",period:pa.value,precision:null,secondary:null});da=pa;if(da===I){da=O;pa=Fa();if(pa!==I)if(sa(),pa=Ma(),pa!==I)if(sa(),pa=S(),pa!==I)if(sa(),Ba=Ra(),Ba!==I)if(sa(),Ba=ma(),
Ba!==I){sa();var Ia=Pa();Ia!==I?(ya=da,da={type:"interval-period",period:"second",precision:pa,secondary:Ba}):(O=da,da=I)}else O=da,da=I;else O=da,da=I;else O=da,da=I;else O=da,da=I;else O=da,da=I;da===I&&(da=O,pa=Fa(),pa!==I?(sa(),pa=Ma(),pa!==I?(sa(),pa=S(),pa!==I?(sa(),Ba=Pa(),Ba!==I?(ya=da,da={type:"interval-period",period:"second",precision:pa,secondary:null}):(O=da,da=I)):(O=da,da=I)):(O=da,da=I)):(O=da,da=I),da===I&&(da=O,pa=Fa(),pa!==I&&(ya=da,pa={type:"interval-period",period:"second",precision:null,
secondary:null}),da=pa))}da!==I?(ya=U,U={type:"interval-qualifier",start:Z,end:da}):(O=U,U=I)}else O=U,U=I;else O=U,U=I;U===I&&(U=O,da=ca(),da!==I?(sa(),Z=Ma(),Z!==I?(sa(),Z=ma(),Z!==I?(sa(),pa=Pa(),pa!==I?(ya=U,U={type:"interval-period",period:da.value,precision:Z,secondary:null}):(O=U,U=I)):(O=U,U=I)):(O=U,U=I)):(O=U,U=I),U===I&&(U=O,da=ca(),da!==I&&(ya=U,da={type:"interval-period",period:da.value,precision:null,secondary:null}),U=da,U===I&&(U=O,da=Fa(),da!==I?(sa(),Z=Ma(),Z!==I?(sa(),Z=S(),Z!==
I?(sa(),pa=Ra(),pa!==I?(sa(),da=ma(),da!==I?(sa(),pa=Pa(),pa!==I?(ya=U,U={type:"interval-period",period:"second",precision:Z,secondary:da}):(O=U,U=I)):(O=U,U=I)):(O=U,U=I)):(O=U,U=I)):(O=U,U=I)):(O=U,U=I),U===I&&(U=O,da=Fa(),da!==I?(sa(),Z=Ma(),Z!==I?(sa(),Z=ma(),Z!==I?(sa(),pa=Pa(),pa!==I?(ya=U,U={type:"interval-period",period:"second",precision:Z,secondary:null}):(O=U,U=I)):(O=U,U=I)):(O=U,U=I)):(O=U,U=I),U===I&&(U=O,da=Fa(),da!==I&&(ya=U,da={type:"interval-period",period:"second",precision:null,
secondary:null}),U=da)))));return U}function ca(){var U=O;var Z=Ga();Z!==I&&(ya=U,Z={type:"string",value:"day"});U=Z;U===I&&(U=O,Z=Da(),Z!==I&&(ya=U,Z={type:"string",value:"hour"}),U=Z,U===I&&(U=O,Z=Ha(),Z!==I&&(ya=U,Z={type:"string",value:"minute"}),U=Z,U===I&&(U=O,Z=Aa(),Z!==I&&(ya=U,Z={type:"string",value:"month"}),U=Z,U===I&&(U=O,Z=za(),Z!==I&&(ya=U,Z={type:"string",value:"year"}),U=Z))));return U}function ma(){var U=O;var Z=L();Z!==I&&(ya=U,Z=parseFloat(Z));return Z}function S(){var U=O;var Z=
L();Z!==I&&(ya=U,Z=parseFloat(Z));return Z}function Y(){var U=ia();U===I&&(U=ba());return U}function ia(){var U=O;if(39===d.charCodeAt(O)){var Z=Hc;O++}else Z=I,0===ra&&h(zb);Z===I&&(d.substr(O,2)===Ic?(Z=Ic,O+=2):(Z=I,0===ra&&h($d)));if(Z!==I){Z=[];var da=O;if(d.substr(O,2)===Zb){var pa=Zb;O+=2}else pa=I,0===ra&&h(sd);pa!==I&&(ya=da,pa="'");da=pa;da===I&&(ob.test(d.charAt(O))?(da=d.charAt(O),O++):(da=I,0===ra&&h(td)));for(;da!==I;)Z.push(da),da=O,d.substr(O,2)===Zb?(pa=Zb,O+=2):(pa=I,0===ra&&h(sd)),
pa!==I&&(ya=da,pa="'"),da=pa,da===I&&(ob.test(d.charAt(O))?(da=d.charAt(O),O++):(da=I,0===ra&&h(td)));39===d.charCodeAt(O)?(da=Hc,O++):(da=I,0===ra&&h(zb));da!==I?(ya=U,U={type:"string",value:Z.join("")}):(O=U,U=I)}else O=U,U=I;return U}function na(){var U=O;if(Sa()!==I){sa();var Z=y();if(Z!==I){sa();var da=Xa();da!==I?(sa(),da=y(),da!==I?(ya=U,U={type:"when-clause",operand:Z,value:da}):(O=U,U=I)):(O=U,U=I)}else O=U,U=I}else O=U,U=I;return U}function ta(){var U=O;if(Sa()!==I){sa();var Z=y();if(Z!==
I){sa();var da=Xa();da!==I?(sa(),da=y(),da!==I?(ya=U,U={type:"when-clause",operand:Z,value:da}):(O=U,U=I)):(O=U,U=I)}else O=U,U=I}else O=U,U=I;return U}function va(){var U=O;var Z=O;if(d.substr(O,4).toLowerCase()===qd){var da=d.substr(O,4);O+=4}else da=I,0===ra&&h(Mg);if(da!==I){da=O;ra++;var pa=P();ra--;pa===I?da=void 0:(O=da,da=I);da!==I?(ya=Z,Z="ELSE"):(O=Z,Z=I)}else O=Z,Z=I;Z!==I?(sa(),Z=y(),Z!==I?(ya=U,U={type:"else-clause",value:Z}):(O=U,U=I)):(O=U,U=I);return U}function xa(){var U=L();if(U===
I){U=O;if(45===d.charCodeAt(O)){var Z=tb;O++}else Z=I,0===ra&&h(Uc);Z===I&&(43===d.charCodeAt(O)?(Z=pb,O++):(Z=I,0===ra&&h(Tc)));if(Z!==I){var da=L();da!==I?(ya=U,U=Z[0]+da):(O=U,U=I)}else O=U,U=I}return U}function wa(){var U=O;if(46===d.charCodeAt(O)){var Z=Nd;O++}else Z=I,0===ra&&h(Wc);Z!==I?(Z=L(),Z===I&&(Z=null),ya=U,U="."+(null!=Z?Z:"")):(O=U,U=I);return U}function Ca(){var U;var Z=U=O;if(Vd.test(d.charAt(O))){var da=d.charAt(O);O++}else da=I,0===ra&&h(ud);da!==I?(Oe.test(d.charAt(O))?(da=d.charAt(O),
O++):(da=I,0===ra&&h(rb)),da===I&&(da=null),ya=Z,Z="e"+(null===da?"":da)):(O=Z,Z=I);Z!==I?(da=L(),da!==I?(ya=U,U=Z+da):(O=U,U=I)):(O=U,U=I);return U}function L(){var U=O;var Z=[];var da=R();if(da!==I)for(;da!==I;)Z.push(da),da=R();else Z=I;Z!==I&&(ya=U,Z=Z.join(""));return Z}function R(){if(Ud.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(ae);return U}function fa(){var U=O;if(d.substr(O,2).toLowerCase()===Gb){var Z=d.substr(O,2);O+=2}else Z=I,0===ra&&h(vd);if(Z!==I){Z=O;ra++;var da=
P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="IN"):(O=U,U=I)}else O=U,U=I;return U}function ka(){var U=O;if(d.substr(O,2).toLowerCase()===hd){var Z=d.substr(O,2);O+=2}else Z=I,0===ra&&h(wd);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="IS"):(O=U,U=I)}else O=U,U=I;return U}function qa(){var U=O;if(d.substr(O,4).toLowerCase()===Hb){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(ic);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="LIKE"):(O=U,
U=I)}else O=U,U=I;return U}function Q(){var U=O;if(d.substr(O,3).toLowerCase()===Pd){var Z=d.substr(O,3);O+=3}else Z=I,0===ra&&h(xd);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="NOT"):(O=U,U=I)}else O=U,U=I;return U}function V(){var U=O;if(d.substr(O,3).toLowerCase()===Tb){var Z=d.substr(O,3);O+=3}else Z=I,0===ra&&h(Yc);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="AND"):(O=U,U=I)}else O=U,U=I;return U}function W(){var U=O;if(d.substr(O,
2).toLowerCase()===Qd){var Z=d.substr(O,2);O+=2}else Z=I,0===ra&&h(ce);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="OR"):(O=U,U=I)}else O=U,U=I;return U}function ha(){var U=O;if(d.substr(O,7).toLowerCase()===Ub){var Z=d.substr(O,7);O+=7}else Z=I,0===ra&&h(Ue);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="BETWEEN"):(O=U,U=I)}else O=U,U=I;return U}function la(){var U=O;if(d.substr(O,4).toLowerCase()===$b){var Z=d.substr(O,4);O+=4}else Z=I,
0===ra&&h(Ve);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="FROM"):(O=U,U=I)}else O=U,U=I;return U}function N(){var U=O;if(d.substr(O,4).toLowerCase()===bc){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Lb);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="TRIM"):(O=U,U=I)}else O=U,U=I;return U}function aa(){var U=O;if(d.substr(O,9).toLowerCase()===jd){var Z=d.substr(O,9);O+=9}else Z=I,0===ra&&h(de);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=
void 0:(O=Z,Z=I);Z!==I?(ya=U,U="TIMESTAMP"):(O=U,U=I)}else O=U,U=I;return U}function ja(){var U=O;if(d.substr(O,4).toLowerCase()===Jc){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(We);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="DATE"):(O=U,U=I)}else O=U,U=I;return U}function oa(){var U=O;if(d.substr(O,4).toLowerCase()===Kc){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Xe);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="TIME"):(O=U,U=I)}else O=
U,U=I;return U}function ua(){var U=O;if(d.substr(O,8).toLowerCase()===md){var Z=d.substr(O,8);O+=8}else Z=I,0===ra&&h(Ng);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="INTERVAL"):(O=U,U=I)}else O=U,U=I;return U}function za(){var U=O;if(d.substr(O,4).toLowerCase()===nd){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Og);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="YEAR"):(O=U,U=I)}else O=U,U=I;return U}function Aa(){var U=O;if(d.substr(O,5).toLowerCase()===
Jb){var Z=d.substr(O,5);O+=5}else Z=I,0===ra&&h(Pg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="MONTH"):(O=U,U=I)}else O=U,U=I;return U}function Ga(){var U=O;if(d.substr(O,3).toLowerCase()===Oc){var Z=d.substr(O,3);O+=3}else Z=I,0===ra&&h(Qg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="DAY"):(O=U,U=I)}else O=U,U=I;return U}function Da(){var U=O;if(d.substr(O,4).toLowerCase()===od){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Rg);if(Z!==
I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="HOUR"):(O=U,U=I)}else O=U,U=I;return U}function Ha(){var U=O;if(d.substr(O,6).toLowerCase()===Pc){var Z=d.substr(O,6);O+=6}else Z=I,0===ra&&h(Sg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="MINUTE"):(O=U,U=I)}else O=U,U=I;return U}function Fa(){var U=O;if(d.substr(O,6).toLowerCase()===Me){var Z=d.substr(O,6);O+=6}else Z=I,0===ra&&h(Tg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==
I?(ya=U,U="SECOND"):(O=U,U=I)}else O=U,U=I;return U}function Ea(){var U=O;if(d.substr(O,4).toLowerCase()===Kb){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Ug);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="CASE"):(O=U,U=I)}else O=U,U=I;return U}function Ka(){var U=O;if(d.substr(O,3).toLowerCase()===Qc){var Z=d.substr(O,3);O+=3}else Z=I,0===ra&&h(Vg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="END"):(O=U,U=I)}else O=U,U=I;return U}function Sa(){var U=
O;if(d.substr(O,4).toLowerCase()===pd){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Wg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="WHEN"):(O=U,U=I)}else O=U,U=I;return U}function Xa(){var U=O;if(d.substr(O,4).toLowerCase()===vb){var Z=d.substr(O,4);O+=4}else Z=I,0===ra&&h(Xg);if(Z!==I){Z=O;ra++;var da=P();ra--;da===I?Z=void 0:(O=Z,Z=I);Z!==I?(ya=U,U="THEN"):(O=U,U=I)}else O=U,U=I;return U}function Ra(){if(44===d.charCodeAt(O)){var U=Wb;O++}else U=I,0===ra&&h(Yg);return U}
function Ma(){if(40===d.charCodeAt(O)){var U=Rc;O++}else U=I,0===ra&&h(Zg);return U}function Pa(){if(41===d.charCodeAt(O)){var U=Sd;O++}else U=I,0===ra&&h($g);return U}function sa(){var U;var Z=[];for(U=Qa();U!==I;)Z.push(U),U=Qa();return Z}function Qa(){if(Pe.test(d.charAt(O))){var U=d.charAt(O);O++}else U=I,0===ra&&h(ah);return U}function cb(U,Z,da,pa){U={type:"binary-expression",operator:U,left:Z,right:da};void 0!==pa&&(U.escape=pa);return U}function jb(U,Z){for(var da=0;da<Z.length;da++)U=cb(Z[da][1],
U,Z[da][3]);return U}f=void 0!==f?f:{};var I={},sb=f.grammarSource,Fc={start:u},cd=u,dd="!",Gc="\x3d",ed="\x3e\x3d",fd="\x3e",Eb="\x3c\x3d",gd="\x3c\x3e",Ya="\x3c",Fb="!\x3d",pb="+",tb="-",Yb="||",Sb="*",Md="/",Fe="@",Hc="'",Ic="N'",Zb="''",Nd=".",Ge="null",He="true",Od="false",Gb="in",hd="is",Hb="like",nb="escape",Pd="not",Tb="and",Qd="or",Ub="between",$b="from",id="for",ac="substring",Rd="extract",bc="trim",Ie="position",jd="timestamp",Jc="date",Kc="time",cc="leading",kd="trailing",Je="both",Lc=
"cast",Ib="as",Mc="integer",ld="smallint",Vb="float",Ke="real",kb="varchar",ub="to",md="interval",nd="year",Nc="timezone_hour",Le="timezone_minute",Jb="month",Oc="day",od="hour",Pc="minute",Me="second",Kb="case",Qc="end",pd="when",vb="then",qd="else",Wb=",",Rc="(",Sd=")",Td="`",Ne=/^[A-Za-z_\x80-\uFFFF]/,dc=/^[A-Za-z0-9_]/,qb=/^[A-Za-z0-9_.\x80-\uFFFF]/,wb=/^["]/,ob=/^[^']/,Ud=/^[0-9]/,Vd=/^[eE]/,Oe=/^[+\-]/,Pe=/^[ \t\n\r]/,ec=/^[^`]/,yb=g("!",!1),db=g("\x3d",!1),lb=g("\x3e\x3d",!1),Sc=g("\x3e",!1),
Wd=g("\x3c\x3d",!1),fc=g("\x3c\x3e",!1),Qe=g("\x3c",!1),Re=g("!\x3d",!1),Tc=g("+",!1),Uc=g("-",!1),Xd=g("||",!1),Se=g("*",!1),Yd=g("/",!1),Te=x([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Zd=x([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),rd=x([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),gc=x(['"'],!1,!1),Vc=g("@",!1),zb=g("'",!1),$d=g("N'",!1),sd=g("''",!1),td=x(["'"],!0,!1),Wc=g(".",!1),ae=x([["0","9"]],!1,!1),ud=x(["e","E"],!1,!1),rb=x(["+","-"],!1,!1),Xb=g("NULL",!0),
hc=g("TRUE",!0),Xc=g("FALSE",!0),vd=g("IN",!0),wd=g("IS",!0),ic=g("LIKE",!0),be=g("ESCAPE",!0),xd=g("NOT",!0),Yc=g("AND",!0),ce=g("OR",!0),Ue=g("BETWEEN",!0),Ve=g("FROM",!0),yd=g("FOR",!0),Ab=g("SUBSTRING",!0),jc=g("EXTRACT",!0),Lb=g("TRIM",!0),zd=g("POSITION",!0),de=g("TIMESTAMP",!0),We=g("DATE",!0),Xe=g("TIME",!0),Zc=g("LEADING",!0),Ad=g("TRAILING",!0),Ye=g("BOTH",!0),ee=g("CAST",!0),Ja=g("AS",!0),Wa=g("INTEGER",!0),ab=g("SMALLINT",!0),xb=g("FLOAT",!0),ug=g("REAL",!0),wg=g("VARCHAR",!0),Lg=g("TO",
!0),Ng=g("INTERVAL",!0),Og=g("YEAR",!0),Xf=g("TIMEZONE_HOUR",!0),Zf=g("TIMEZONE_MINUTE",!0),Pg=g("MONTH",!0),Qg=g("DAY",!0),Rg=g("HOUR",!0),Sg=g("MINUTE",!0),Tg=g("SECOND",!0),Ug=g("CASE",!0),Vg=g("END",!0),Wg=g("WHEN",!0),Xg=g("THEN",!0),Mg=g("ELSE",!0),Yg=g(",",!1),Zg=g("(",!1),$g=g(")",!1),ah=x([" ","\t","\n","\r"],!1,!1),Lf=g("`",!1),Mf=x(["`"],!0,!1),O=0,ya=0,fe=[{line:1,column:1}],Bb=0,Ze=[],ra=0;if("startRule"in f){if(!(f.startRule in Fc))throw Error("Can't start parsing from rule \""+f.startRule+
'".');cd=Fc[f.startRule]}var nf=cd();if(nf!==I&&O===d.length)return nf;nf!==I&&O<d.length&&h({type:"end"});throw function(U,Z,da){return new b(b.buildMessage(U,Z),U,Z,da)}(Ze,Bb<d.length?d.charAt(Bb):null,Bb<d.length?e(Bb,Bb+1):e(Bb,Bb));}}})})(r);var k=r.exports;class l{static parse(m){return k.parse(m)}}a.WhereGrammar=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/fieldType":function(){define(["exports","../../core/jsonMap"],function(a,q){q=new q.JSONMap({esriFieldTypeSmallInteger:"small-integer",
esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});
a.kebabDict=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,q,r){const k=new r,l=new r,m=new r,b={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,esriGeometryPolygon:q.convertToPolygon,esriGeometryMultipoint:q.convertToMultipoint},c=(d,f)=>"_geVersion"!==d?f:void 0;a.cleanFromGeometryEngine=function(d){return d&&"_geVersion"in
d?JSON.parse(JSON.stringify(d,c)):d};a.getGeometry=function(d,f,p,g,x,n,e=f,h=p){const u=f&&e,v=p&&h;g=null!=g?"coords"in g?g:g.geometry:null;if(null==g)return null;if(x)return f=q.generalizeOptimizedGeometry(l,g,f,p,d,x,e,h),n&&(f=q.quantizeOptimizedGeometry(m,f,u,v,d,n)),b[d]?.(f,u,v)??null;if(n)return n=q.quantizeOptimizedGeometry(m,g,f,p,d,n,e,h),b[d]?.(n,u,v)??null;q.removeZMValues(k,g,f,p,e,h);return b[d]?.(k,u,v)??null};a.transformCentroid=function(d,f,p,g=d.hasZ,x=d.hasM){if(null==f)return null;
const n=d.hasZ&&g,e=d.hasM&&x;return p?(d=q.quantizeOptimizedGeometry(m,f,d.hasZ,d.hasM,"esriGeometryPoint",p,g,x),q.convertToPoint(d,n,e)):q.convertToPoint(f,n,e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(a){a.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,
convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,
supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x){function n(v,y,B,t){const w=t.x-B.x;t=t.y-B.y;y=Math.min(1,Math.max(0,((y.x-B.x)*w+(y.y-B.y)*t)/(w*w+t*t)));v.x=B.x+w*y;v.y=B.y+t*y}function e(v,y){return v?y?4:3:y?3:2}class h{constructor(v,y,B){this.items=v;this.query=y;this.geometryType=B.geometryType;this.hasM=B.hasM;this.hasZ=B.hasZ;this.fieldsIndex=B.fieldsIndex;this.objectIdField=B.objectIdField;this.spatialReference=B.spatialReference;this.featureAdapter=B.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const v=
new c(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return v.countDistinctValues(this.items);const {groupByFieldsForStatistics:y,having:B,outStatistics:t}=this.query;if(!y?.length)return 1;const w=new Map,C=new Map,z=new Set;for(const G of t){var {statisticType:D}=G;D="exceedslimit"!==D?G.onStatisticField:void 0;if(!C.has(D)){var H=[];for(const A of y){const F=this._getAttributeValues(v,A,w);H.push(F)}C.set(D,this._calculateUniqueValues(H,v.returnDistinctValues))}D=
C.get(D);for(const A in D){const {data:F,items:J}=D[A];H=F.join(",");B&&!v.validateItems(J,B)||z.add(H)}}return z.size}async createQueryResponse(){let v;v=this.query.outStatistics?this.query.outStatistics.some(y=>"exceedslimit"===y.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const y=this.query.geometry;b.isValid(this.query.outSR)&&!b.equals(y.spatialReference,
this.query.outSR)?v.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...f.project(y,y.spatialReference,this.query.outSR)}):v.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...y})}return v}createSnappingResponse(v,y){const B=this.featureAdapter,t=e(this.hasZ,this.hasM),{point:w,mode:C}=v,z="number"===typeof v.distance?v.distance:v.distance.x,D="number"===typeof v.distance?v.distance:v.distance.y,H={candidates:[]},G="esriGeometryPolygon"===this.geometryType;
y=this._getPointCreator(C,this.spatialReference,y);const A=new u(null,0),F=new u(null,0),J={x:0,y:0,z:0};for(const ea of this.items){var K=B.getGeometry(ea);if(null==K)continue;const {coords:X,lengths:ca}=K;A.coords=X;F.coords=X;if(v.returnEdge){K=0;for(var P=0;P<ca.length;P++){var E=ca[P];for(var M=0;M<E;M++,K+=t){var T=A;T.coordsIndex=K;if(M!==E-1){const ma=F;ma.coordsIndex=K+t;const S=J;n(J,w,T,ma);var ba=(w.x-S.x)/z;const Y=(w.y-S.y)/D;ba=ba*ba+Y*Y;1>=ba&&H.candidates.push(p.makeEdgeCandidate(B.getObjectId(ea),
y(S),Math.sqrt(ba),y(T),y(ma)))}}}}if("none"!==v.vertexMode)if(K=G?X.length-t:X.length,"all"===v.vertexMode)for(P=0;P<K;P+=t)E=A,E.coordsIndex=P,M=(w.x-E.x)/z,T=(w.y-E.y)/D,M=M*M+T*T,1>=M&&H.candidates.push(p.makeVertexCandidate(B.getObjectId(ea),y(E),Math.sqrt(M)));else if("ends"===v.vertexMode){K=[0];G||K.push(X.length-t);for(const ma of K)K=A,K.coordsIndex=ma,P=(w.x-K.x)/z,E=(w.y-K.y)/D,P=P*P+E*E,1>=P&&H.candidates.push(p.makeVertexCandidate(B.getObjectId(ea),y(K),Math.sqrt(P)))}}H.candidates.sort((ea,
X)=>ea.distance-X.distance);return H}_getPointCreator(v,y,B){const t=null==B||b.equals(y,B)?C=>C:C=>f.project(C,y,B),{hasZ:w}=this;return"3d"===v?w?({x:C,y:z,z:D})=>t({x:C,y:z,z:D}):({x:C,y:z})=>t({x:C,y:z,z:0}):({x:C,y:z})=>t({x:C,y:z})}async createSummaryStatisticsResponse(v){const {field:y,valueExpression:B,normalizationField:t,normalizationType:w,normalizationTotal:C,minValue:z,maxValue:D,scale:H,timeZone:G}=v;var A=this.fieldsIndex.get(y);v=g.isDateField(A)||g.isDateOnlyField(A)||g.isTimestampOffsetField(A);
const F=await this._getDataValues({field:y,valueExpression:B,normalizationField:t,normalizationType:w,normalizationTotal:C,scale:H,timeZone:G}),J=x.isNullCountSupported({normalizationType:w,normalizationField:t,minValue:z,maxValue:D}),K={value:.5,fieldType:A?.type};A=g.isStringField(A)?x.calculateStringStatistics({values:F,supportsNullCount:J,percentileParams:K}):x.calculateStatistics({values:F,minValue:z,maxValue:D,useSampleStdDev:!w,supportsNullCount:J,percentileParams:K});return x.processSummaryStatisticsResult(A,
v)}async createUniqueValuesResponse(v){const {field:y,valueExpression:B,domains:t,returnAllCodedValues:w,scale:C,timeZone:z}=v;var D=await this._getDataValues({field:y,field2:v.field2,field3:v.field3,fieldDelimiter:v.fieldDelimiter,valueExpression:B,scale:C,timeZone:z},!1);D=x.calculateUniqueValuesCount(D);return x.createUVResult(D,t,w,v.fieldDelimiter)}async createClassBreaksResponse(v){const {field:y,valueExpression:B,normalizationField:t,normalizationType:w,normalizationTotal:C,classificationMethod:z,
standardDeviationInterval:D,minValue:H,maxValue:G,numClasses:A,scale:F,timeZone:J}=v;v=await this._getDataValues({field:y,valueExpression:B,normalizationField:t,normalizationType:w,normalizationTotal:C,scale:F,timeZone:J});v=x.calculateClassBreaks(v,{field:y,normalizationField:t,normalizationType:w,normalizationTotal:C,classificationMethod:z,standardDeviationInterval:D,minValue:H,maxValue:G,numClasses:A});return x.resolveCBResult(v,z)}async createHistogramResponse(v){const {field:y,valueExpression:B,
normalizationField:t,normalizationType:w,normalizationTotal:C,classificationMethod:z,standardDeviationInterval:D,minValue:H,maxValue:G,numBins:A,scale:F,timeZone:J}=v;v=await this._getDataValues({field:y,valueExpression:B,normalizationField:t,normalizationType:w,normalizationTotal:C,scale:F,timeZone:J});return x.calculateHistogram(v,{field:y,normalizationField:t,normalizationType:w,normalizationTotal:C,classificationMethod:z,standardDeviationInterval:D,minValue:H,maxValue:G,numBins:A})}_sortFeatures(v,
y,B){if(1<v.length&&y?.length)for(const t of y.reverse()){y=t.split(" ");const w=y[0],C=this.fieldsIndex.get(w);y=y[1]?"desc"===y[1].toLowerCase():!1;const z=x.getAttributeComparator(C?.type,y);v.sort((D,H)=>{D=B(D,w,C);H=B(H,w,C);return z(D,H)})}}_createFeatureQueryResponse(v){const y=this.items,{geometryType:B,hasM:t,hasZ:w,objectIdField:C,spatialReference:z}=this,{outFields:D,outSR:H,quantizationParameters:G,resultRecordCount:A,resultOffset:F,returnZ:J,returnM:K}=v,P=null!=A?y.length>(F||0)+A:
!1,E=D&&(D.includes("*")?[...this.fieldsIndex.fields]:D.map(M=>this.fieldsIndex.get(M)));return{exceededTransferLimit:P,features:this._createFeatures(v,y),fields:E,geometryType:B,hasM:t&&K,hasZ:w&&J,objectIdFieldName:C,spatialReference:d.cleanFromGeometryEngine(H||z),transform:G&&m.toQuantizationTransform(G)||null}}_createFeatures(v,y){const B=new c(v,this.featureAdapter,this.fieldsIndex),{hasM:t,hasZ:w}=this,{orderByFields:C,quantizationParameters:z,returnGeometry:D,returnCentroid:H,maxAllowableOffset:G,
resultOffset:A,resultRecordCount:F,returnZ:J=!1,returnM:K=!1}=v,P=w&&J,E=t&&K;v=[];var M=0;const T=[...y];this._sortFeatures(T,C,(ma,S,Y)=>B.getFieldValue(ma,S,Y));if(this.geometryType&&(D||H)){var ba=m.toQuantizationTransform(z)??void 0;y="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(D&&!H)for(var ea of T){var X=this.featureAdapter.getGeometry(ea),ca={attributes:B.getAttributes(ea),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,X,G,ba,P,E)};
y&&X&&!ca.geometry&&(ca.centroid=d.transformCentroid(this,this.featureAdapter.getCentroid(ea,this),ba));v[M++]=ca}else if(!D&&H)for(X of T)v[M++]={attributes:B.getAttributes(X),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(X,this),ba)};else for(ca of T)v[M++]={attributes:B.getAttributes(ca),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(ca,this),ba),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(ca),G,ba,P,E)}}else for(ba of T)(ea=
B.getAttributes(ba))&&(v[M++]={attributes:ea});M=A||0;null!=F&&(v=v.slice(M,Math.min(v.length,M+F)));return v}_createExceedsLimitQueryResponse(v){var y=!1;let B=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY;y=Number.POSITIVE_INFINITY;for(const w of v.outStatistics??[])if("exceedslimit"===w.statisticType){B=null!=w.maxPointCount?w.maxPointCount:Number.POSITIVE_INFINITY;t=null!=w.maxRecordCount?w.maxRecordCount:Number.POSITIVE_INFINITY;y=null!=w.maxVertexCount?w.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)y=this.items.length>B;else if(this.items.length>t)y=!0;else{v=e(this.hasZ,this.hasM);const w=this.featureAdapter;y=this.items.reduce((C,z)=>{z=w.getGeometry(z);return C+(null!=z&&z.coords.length||0)},0)/v>y}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(y)}}]}}async _createStatisticsQueryResponse(v){var y={attributes:{}};
const B=[],t=new Map,w=new Map,C=new Map,z=new Map,D=new c(v,this.featureAdapter,this.fieldsIndex);var H=v.outStatistics;const {groupByFieldsForStatistics:G,having:A,orderByFields:F,resultRecordCount:J}=v;v=G?.length;const K=!!v,P=K?G[0]:null,E=K&&!this.fieldsIndex.get(P);for(const X of H??[]){const {outStatisticFieldName:ca,statisticType:ma}=X;H=X;const S="exceedslimit"!==ma?X.onStatisticField:void 0,Y="percentile_disc"===ma||"percentile_cont"===ma;var M="EnvelopeAggregate"===ma||"CentroidAggregate"===
ma||"ConvexHullAggregate"===ma;const ia=K&&1===v&&(S===P||E)&&"count"===ma;if(K){if(!C.has(S)){var T=[];for(const na of G){var ba=this._getAttributeValues(D,na,t);T.push(ba)}C.set(S,this._calculateUniqueValues(T,M?!1:D.returnDistinctValues))}T=C.get(S);if(!T)continue;ba=Object.keys(T);for(const na of ba){const {count:ta,data:va,items:xa,itemPositions:wa}=T[na];ba=va.join(",");if(!A||D.validateItems(xa,A)){const Ca=z.get(ba)||{attributes:{}};if(M){Ca.aggregateGeometries||(Ca.aggregateGeometries={});
const {aggregateGeometries:R,outStatisticFieldName:fa}=await this._getAggregateGeometry(H,xa);Ca.aggregateGeometries[fa]=R}else{var ea=null;if(ia)ea=ta;else{const R=this._getAttributeValues(D,S,t);ea=wa.map(fa=>R[fa]);ea=Y&&"statisticParameters"in H?this._getPercentileValue(H,ea):this._getStatisticValue(H,ea,null,D.returnDistinctValues)}Ca.attributes[ca]=ea}let L=0;G.forEach((R,fa)=>Ca.attributes[this.fieldsIndex.get(R)?R:`EXPR_${++L}`]=va[fa]);z.set(ba,Ca)}}}else if(M){y.aggregateGeometries||(y.aggregateGeometries=
{});const {aggregateGeometries:na,outStatisticFieldName:ta}=await this._getAggregateGeometry(H,this.items);y.aggregateGeometries[ta]=na}else M=this._getAttributeValues(D,S,t),y.attributes[ca]=Y&&"statisticParameters"in H?this._getPercentileValue(H,M):this._getStatisticValue(H,M,w,D.returnDistinctValues);H="min"!==ma&&"max"!==ma||!g.isStringField(this.fieldsIndex.get(S))&&!this._isAnyDateField(S)?null:this.fieldsIndex.get(S)?.type;B.push({name:ca,alias:ca,type:H||"esriFieldTypeDouble"})}y=K?Array.from(z.values()):
[y];this._sortFeatures(y,F,(X,ca)=>X.attributes[ca]);J&&(y.length=Math.min(J,y.length));return{fields:B,features:y}}_isAnyDateField(v){v=this.fieldsIndex.get(v);return g.isDateField(v)||g.isDateOnlyField(v)||g.isTimestampOffsetField(v)||g.isTimeOnlyField(v)}async _getAggregateGeometry(v,y){const {convexHull:B,union:t}=await new Promise((J,K)=>a(["../../../geometry/geometryEngineJSON"],J,K)),{statisticType:w,outStatisticFieldName:C}=v,{featureAdapter:z,spatialReference:D,geometryType:H,hasZ:G,hasM:A}=
this;y=y.map(J=>d.getGeometry(H,G,A,z.getGeometry(J)));const F=B(D,y,!0)[0];v={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===w?(y=F?l.getPolygonExtent(F):l.getGeometryExtent(t(D,y)),v.aggregateGeometries={...y,spatialReference:D},v.outStatisticFieldName=C||"extent"):"CentroidAggregate"===w?(y=F?k.polygonCentroid(F):k.extentCentroid(l.getGeometryExtent(t(D,y))),v.aggregateGeometries={x:y[0],y:y[1],spatialReference:D},v.outStatisticFieldName=C||"centroid"):"ConvexHullAggregate"===
w&&(v.aggregateGeometries=F,v.outStatisticFieldName=C||"convexHull");return v}_getStatisticValue(v,y,B,t){const {onStatisticField:w,statisticType:C}=v;v=null;v=B?.has(w)?B.get(w):g.isStringField(this.fieldsIndex.get(w))||this._isAnyDateField(w)?x.calculateStringStatistics({values:y,returnDistinct:t}):x.calculateStatistics({values:t?[...(new Set(y))]:y,minValue:null,maxValue:null,useSampleStdDev:!0});B&&B.set(w,v);return v["var"===C?"variance":C]}_getPercentileValue(v,y){const {onStatisticField:B,
statisticParameters:t,statisticType:w}=v,{value:C,orderBy:z}=t;v=this.fieldsIndex.get(B);return x.calculatePercentile(y,{value:C,orderBy:z,fieldType:v?.type,isDiscrete:"percentile_disc"===w})}_getAttributeValues(v,y,B){if(B.has(y))return B.get(y);const t=this.fieldsIndex.get(y),w=this.items.map(C=>v.getFieldValue(C,y,t));B.set(y,w);return w}_calculateUniqueValues(v,y){const B={},t=this.items,w=t.length;for(let C=0;C<w;C++){const z=t[C],D=[];for(const G of v)D.push(G[C]);const H=D.join(",");null==
B[H]?B[H]={count:1,data:D,items:[z],itemPositions:[C]}:(y||B[H].count++,B[H].items.push(z),B[H].itemPositions.push(C))}return B}async _getDataValues(v,y=!0){const B=new c(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:t,scale:w,timeZone:C}=v;return t?B.getExpressionValues(this.items,t,{viewingMode:"map",scale:w,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},C):B.getDataValues(this.items,r.clone(v),y)}}class u{constructor(v,
y){this.coords=v;this.coordsIndex=y}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}q.QueryEngineResult=h;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,q){function r({scale:H,translate:G},A){return Math.round((A-G[0])/H[0])}function k({scale:H,translate:G},A){return Math.round((G[1]-A)/H[1])}function l(H,
G,A){const F=[];let J,K,P,E;for(let M=0;M<A.length;M++){const T=A[M];if(0<M){if(P=r(H,T[0]),E=k(H,T[1]),P!==J||E!==K)F.push(G(T,P-J,E-K)),J=P,K=E}else J=r(H,T[0]),K=k(H,T[1]),F.push(G(T,J,K))}return 0<F.length?F:null}function m(H,G,A,F){return l(H,A?F?D:z:F?z:C,G)}function b(H,G,A,F){const J=[];A=A?F?D:z:F?z:C;for(F=0;F<G.length;F++){const K=l(H,A,G[F]);K&&3<=K.length&&J.push(K)}return J.length?J:null}function c(H,G,A,F){const J=[];A=A?F?D:z:F?z:C;for(F=0;F<G.length;F++){const K=l(H,A,G[F]);K&&2<=
K.length&&J.push(K)}return J.length?J:null}function d({scale:H,translate:G},A){return A*H[0]+G[0]}function f({scale:H,translate:G},A){return G[1]-A*H[1]}function p(H,G,A){const F=Array(A.length);if(!A.length)return F;const [J,K]=H.scale;let P=d(H,A[0][0]);H=f(H,A[0][1]);F[0]=G(A[0],P,H);for(let E=1;E<A.length;E++){const M=A[E];P+=M[0]*J;H-=M[1]*K;F[E]=G(M,P,H)}return F}function g(H,G,A){const F=Array(A.length);for(let J=0;J<A.length;J++)F[J]=p(H,G,A[J]);return F}function x(H,G,A,F){return p(H,A?F?
D:z:F?z:C,G)}function n(H,G,A,F){return g(H,A?F?D:z:F?z:C,G)}function e(H,G,A,F){return g(H,A?F?D:z:F?z:C,G)}function h(H,G,A){let [F,J]=A[0],K=Math.min(F,G[0]),P=Math.min(J,G[1]),E=Math.max(F,G[2]);G=Math.max(J,G[3]);for(let M=1;M<A.length;M++){const [T,ba]=A[M];F+=T;J+=ba;0>T&&(K=Math.min(K,F));0<T&&(E=Math.max(E,F));0>ba?P=Math.min(P,J):0<ba&&(G=Math.max(G,J))}H[0]=K;H[1]=P;H[2]=E;H[3]=G;return H}function u(H,G){if(!G.length)return null;H[0]=H[1]=Number.POSITIVE_INFINITY;H[2]=H[3]=Number.NEGATIVE_INFINITY;
for(let A=0;A<G.length;A++)h(H,H,G[A]);return H}function v(H,G,A,F,J){G.xmin=r(H,A.xmin);G.ymin=k(H,A.ymin);G.xmax=r(H,A.xmax);G.ymax=k(H,A.ymax);G!==A&&(F&&(G.zmin=A.zmin,G.zmax=A.zmax),J&&(G.mmin=A.mmin,G.mmax=A.mmax));return G}function y(H,G,A,F,J){G.points=m(H,A.points,F,J)??[];return G}function B(H,G,A,F,J){G.x=r(H,A.x);G.y=k(H,A.y);G!==A&&(F&&(G.z=A.z),J&&(G.m=A.m));return G}function t(H,G,A,F,J){H=b(H,A.rings,F,J);if(!H)return null;G.rings=H;return G}function w(H,G,A,F,J){H=c(H,A.paths,F,J);
if(!H)return null;G.paths=H;return G}const C=(H,G,A)=>[G,A],z=(H,G,A)=>[G,A,H[2]],D=(H,G,A)=>[G,A,H[2],H[3]];a.equals=function(H,G){if(H===G||null==H&&null==G)return!0;if(null==H||null==G)return!1;let A,F,J,K;H&&"upperLeft"===H.originPosition?(A=H.translate[0],F=H.translate[1],H=H.scale[0]):(A=null!=H.extent?H.extent.xmin:0,F=null!=H.extent?H.extent.ymax:0,H=H.tolerance);G&&"upperLeft"===G.originPosition?(J=G.translate[0],K=G.translate[1],G=G.scale[0]):(J=null!=G.extent?G.extent.xmin:0,K=null!=G.extent?
G.extent.ymax:0,G=G.tolerance);return A===J&&F===K&&H===G};a.getQuantizedBoundsCoordsArray=h;a.getQuantizedBoundsCoordsArrayArray=u;a.getQuantizedBoundsPaths=function(H){return u([0,0,0,0],H)};a.getQuantizedBoundsPoints=function(H){const G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return h(G,G,H)};a.getQuantizedBoundsRings=function(H){return u([0,0,0,0],H)};a.quantizeBounds=function(H,G,A){G[0]=r(H,A[0]);G[3]=k(H,A[1]);G[2]=r(H,A[2]);G[1]=
k(H,A[3]);return G};a.quantizeExtent=v;a.quantizeGeometry=function(H,G){return H&&G?q.isPoint(G)?B(H,{},G,!1,!1):q.isPolyline(G)?w(H,{},G,!1,!1):q.isPolygon(G)?t(H,{},G,!1,!1):q.isMultipoint(G)?y(H,{},G,!1,!1):q.isExtent(G)?v(H,{},G,!1,!1):null:null};a.quantizeMultipoint=y;a.quantizePaths=c;a.quantizePoint=B;a.quantizePoints=m;a.quantizePolygon=t;a.quantizePolyline=w;a.quantizeRings=b;a.quantizeX=r;a.quantizeY=k;a.toQuantizationTransform=function(H){return H?{originPosition:"upper-left"===H.originPosition?
"upperLeft":"lower-left"===H.originPosition?"lowerLeft":H.originPosition,scale:H.tolerance?[H.tolerance,H.tolerance]:[1,1],translate:null!=H.extent?[H.extent.xmin,H.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(H,G,A){return A?(G[0]=d(H,A[0]),G[1]=f(H,A[3]),G[2]=d(H,A[2]),G[3]=f(H,A[1]),G):[d(H,G[0]),f(H,G[3]),d(H,G[2]),f(H,G[1])]};a.unquantizeCoordsArray=p;a.unquantizeCoordsArrayArray=g;a.unquantizeExtent=function(H,G,A,F,J){G.xmin=d(H,A.xmin);G.ymin=f(H,A.ymin);G.xmax=d(H,A.xmax);G.ymax=
f(H,A.ymax);G!==A&&(F&&(G.zmin=A.zmin,G.zmax=A.zmax),J&&(G.mmin=A.mmin,G.mmax=A.mmax));return G};a.unquantizeMultipoint=function(H,G,A,F,J){null!=A&&(G.points=x(H,A.points,F,J));return G};a.unquantizePaths=n;a.unquantizePoint=function(H,G,A,F,J){if(null==A)return G;G.x=d(H,A.x);G.y=f(H,A.y);G!==A&&(F&&(G.z=A.z),J&&(G.m=A.m));return G};a.unquantizePoints=x;a.unquantizePolygon=function(H,G,A,F,J){null!=A&&(G.rings=e(H,A.rings,F,J));return G};a.unquantizePolyline=function(H,G,A,F,J){null!=A&&(G.paths=
n(H,A.paths,F,J));return G};a.unquantizeRings=e;a.unquantizeX=d;a.unquantizeY=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),function(a,q,r,k,l,m){class b{constructor(c,d,f){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=
c.returnDistinctValues??!1;this.fieldsIndex=f;this.featureAdapter=d;if((d=c.outFields)&&!d.includes("*")){this.outFields=d;c=0;for(const g of d){var p=a.getExpressionFromFieldName(g);p=(d=this.fieldsIndex.get(p))?null:a.getWhereClause(p,f);d=d?d.name:a.getAliasFromFieldName(g)||`FIELD_EXP_${c++}`;this._fieldDataCache.set(g,{alias:d,clause:p})}}}countDistinctValues(c){if(!this.returnDistinctValues)return c.length;c.forEach(d=>this.getAttributes(d));return this._returnDistinctMap.size}getAttributes(c){c=
this._processAttributesForOutFields(c);return this._processAttributesForDistinctValues(c)}getFieldValue(c,d,f){const p=f?f.name:d;let g=null;this._fieldDataCache.has(p)?g=this._fieldDataCache.get(p)?.clause:f||(g=a.getWhereClause(d,this.fieldsIndex),this._fieldDataCache.set(p,{alias:p,clause:g}));return f?this.featureAdapter.getAttribute(c,p):g?.calculateValue(c,this.featureAdapter)}getDataValues(c,d,f=!0){const p=d.normalizationType,g=d.normalizationTotal,x=this.fieldsIndex.get(d.field),n=r.isDateOnlyField(x)||
r.isTimestampOffsetField(x),e=r.isTimeOnlyField(x);return c.map(h=>{let u=d.field&&this.getFieldValue(h,d.field,this.fieldsIndex.get(d.field));d.field2?(u=`${l.processNullValue(u)}${d.fieldDelimiter}${l.processNullValue(this.getFieldValue(h,d.field2,this.fieldsIndex.get(d.field2)))}`,d.field3&&(u=`${u}${d.fieldDelimiter}${l.processNullValue(this.getFieldValue(h,d.field3,this.fieldsIndex.get(d.field3)))}`)):"string"===typeof u&&f&&(n?u=u?(new Date(u)).getTime():null:e&&(u=u?k.timeOnlyToMilliseconds(u):
null));p&&Number.isFinite(u)&&(h="field"===p&&d.normalizationField?this.getFieldValue(h,d.normalizationField,this.fieldsIndex.get(d.normalizationField)):null,u=l.getNormalizedValue(u,p,h,g));return u})}async getExpressionValues(c,d,f,p,g){const {arcadeUtils:x}=await m.loadArcade(),n=x.hasGeometryOperations(d);n&&await x.enableGeometryOperations();const e=x.createFunction(d),h=x.getViewInfo(f),u={fields:this.fieldsIndex.fields};return c.map(v=>{v={attributes:this.featureAdapter.getAttributes(v),layer:u,
geometry:n?{...q.getGeometry(p.geometryType,p.hasZ,p.hasM,this.featureAdapter.getGeometry(v)),spatialReference:f?.spatialReference}:null};v=x.createExecContext(v,h,g);return x.executeFunction(e,v)})}validateItem(c,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testFeature(c,this.featureAdapter)??!1}validateItems(c,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,
this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testSet(c,this.featureAdapter)??!1}_processAttributesForOutFields(c){const d=this.outFields;if(!d?.length)return this.featureAdapter.getAttributes(c);const f={};for(const p of d){const {alias:g,clause:x}=this._fieldDataCache.get(p);f[g]=x?x.calculateValue(c,this.featureAdapter):this.featureAdapter.getAttribute(c,g)}return f}_processAttributesForDistinctValues(c){if(null==c||!this.returnDistinctValues)return c;var d=this.outFields,f=[];
if(d)for(const g of d){var {alias:p}=this._fieldDataCache.get(g);f.push(c[p])}else for(p in c)f.push(c[p]);d=`${(d||["*"]).join(",")}=${f.join(",")}`;f=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++f);return 1<f?null:c}}return b})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n){function e(t){t=B.exec(t);if(!t)return null;const {hh:w,mm:C,ss:z,ms:D}=t.groups;return Number(w)*l.millisecondsPerTimeUnit.hours+Number(C)*l.millisecondsPerTimeUnit.minutes+Number(z)*l.millisecondsPerTimeUnit.seconds+Number(D||0)}function h(t,w){t=null!=t?t:"";null!=w&&w&&(t=t?"("+t+") AND ("+w+")":w);return t}function u(t){const w=t.layer;return t.fields.filter(C=>!w.getField(C))}function v(t){const w=t.layer;return t.fields.filter(C=>{C=w.getFieldUsageInfo(C);
return!C||!C.supportsStatistics})}let y=null;const B=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(t,w=18,C,z,D){const H=new Float64Array(z*D);w=Math.round(k.pt2px(w));let G=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY;C=f.createValueFunction(C);for(const {geometry:K,attributes:P}of t){const {x:E,y:M}=K;t=Math.max(0,E-w);var F=Math.max(0,M-w);const T=Math.min(D,M+w),ba=Math.min(z,E+w),ea=+C(P);for(;F<T;F++)for(let X=
t;X<ba;X++){var J=F*z+X;const ca=f.evaluateDensityKernel(X-E,F-M,w)*ea;J=H[J]+=ca;G=Math.min(G,J);A=Math.max(A,J)}}return{min:G,max:A}};a.getDataValues=async function(t,w,C=!0){if(!w)return[];const {field:z,field2:D,field3:H,fieldDelimiter:G,fieldInfos:A,timeZone:F}=t;var J=z&&A?.find(S=>S.name.toLowerCase()===z.toLowerCase());const K=J?d.isTimeOnlyField(J):!1,P=J?p.isAnyDateField(J):!1,E=t.valueExpression,M=t.normalizationType,T=t.normalizationField,ba=t.normalizationTotal,ea=[];J=t.viewInfoParams;
let X=null,ca=null;if(E){if(!y){const {arcadeUtils:S}=await x.loadArcade();y=S}y.hasGeometryOperations(E)&&await y.enableGeometryOperations();X=y.createFunction(E);ca=J?y.getViewInfo({viewingMode:J.viewingMode,scale:J.scale,spatialReference:new m(J.spatialReference)}):null}t=t.fieldInfos;const ma=w[0]&&"declaredClass"in w[0]&&"esri.Graphic"===w[0].declaredClass||!t?null:{fields:t};w.forEach(S=>{var Y=S.attributes;if(E){var ia=y.createExecContext(ma?{...S,layer:ma}:S,ca,F);ia=y.executeFunction(X,ia)}else Y&&
(ia=Y[z],D?(ia=`${g.processNullValue(ia)}${G}${g.processNullValue(Y[D])}`,H&&(ia=`${ia}${G}${g.processNullValue(Y[H])}`)):"string"===typeof ia&&C&&(P?ia=ia?(new Date(ia)).getTime():null:K&&(ia=ia?e(ia):null)));M&&"number"===typeof ia&&isFinite(ia)&&(Y=Y&&parseFloat(Y[T]),ia=g.getNormalizedValue(ia,M,Y,ba));ea.push(ia)});return ea};a.getRangeExpr=function(t,w,C){w=null!=w?t+" \x3e\x3d "+w:"";t=null!=C?t+" \x3c\x3d "+C:"";C="";return(C=w&&t?h(w,t):w||t)?"("+C+")":""};a.getSQLFilterForNormalization=
function(t){const w=t.field,C=t.normalizationType;t=t.normalizationField;let z;if("field"===C)z="(NOT "+t+" \x3d 0)";else if("log"===C||"natural-log"===C||"square-root"===C)z=`(${w} > 0)`;return z};a.getSumOfAttributesExpr=function(t,w,C){const z=[],D=[],H=[],G=[],A=[];t.forEach((K,P)=>{const E=K.field?"field":"expression",M=K.field||K.valueExpression;K.field?(A.push(M),D.push(`var ${E}${P} = Number($feature["${M}"]);`)):(z.push(`function getValueForExpr${P}() {\n  ${M} \n}`),D.push(`var ${E}${P} = Number(getValueForExpr${P}());`));
C||H.push(`${E}${P} = IIf(${E}${P} < 0, 0, ${E}${P});`);G.push(`${E}${P}`)});t="return sum;";const F=z.length?null:A.reduce((K,P)=>`${K} + ${P}`);let J=null;w||C?w?C||(t="return IIf(sum \x3e\x3d 0, sum, null);",F&&(J=`(( ${F} ) >= 0)`)):(t="return IIf(sum !\x3d 0, sum, null);",F&&(J=`(( ${F} ) <> 0)`)):(t="return IIf(sum \x3e 0, sum, null);",F&&(J=`(( ${F} ) > 0)`));return{valueExpression:[z.length?z.join("\n"):"",D.join("\n"),H.join("\n"),`var sum = ${G.join(" + ")};`,t].filter(Boolean).join("\n\n"),
sqlExpression:F,sqlWhere:J}};a.mergeWhereClauses=h;a.quantizeFeatures=function(t,w,C,z){const D=c.isWrappable(C)?c.getInfo(C):null,H=D?Math.round((D.valid[1]-D.valid[0])/w.scale[0]):null;return t.map(G=>{const A=new n(G.geometry);b.quantizePoint(w,A,A,A.hasZ,A.hasM);if(D){var F=H??0,J=z[0];0>A.x?A.x+=F:A.x>J&&(A.x-=F)}G.geometry=A;return G})};a.timeOnlyToMilliseconds=e;a.verifyBasicFieldValidity=function(t,w,C){const z=u({layer:t,fields:w});if(z.length)return new r(C,"Unknown fields: "+z.join(", ")+
". You can only use fields defined in the layer schema");t=v({layer:t,fields:w});if(t.length)return new r(C,"Unsupported fields: "+t.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(t,w,C,z){let D;w?w.name!==t.objectIdField&&z.includes(w.type)||(D=new r(C,"'field' should be one of these types: "+z.join(","))):D=new r(C,"'field' is not defined in the layer schema");return D};a.verifyFilterValidty=function(t,
w){if(t&&"intersects"!==t.spatialRelationship)return new r(w,"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=function(t,w,C){let z;w?w.name!==t.objectIdField&&d.isNumericField(w)||(z=new r(C,"'field' should be one of these numeric types: "+d.numericTypes.join(","))):z=new r(C,"'field' is not defined in the layer schema");return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/timeUtils":function(){define(["exports","../intl/date",
"../time/timeZoneUtils","../chunks/datetime"],function(a,q,r,k){function l(c,d,f){return 0===c?0:c*b[d]/b[f]}function m(c){switch(c){case "milliseconds":return"millisecond";case "seconds":return"second";case "minutes":return"minute";case "hours":return"hour";case "days":return"day";case "weeks":return"week";case "months":return"month";case "years":return"year"}}const b={milliseconds:1,seconds:1E3,minutes:6E4,hours:36E5,days:864E5,weeks:6048E5,months:26784E5,years:31536E6,decades:31536E7,centuries:31536E8};
a.convertTime=l;a.isValidDate=function(c){return c instanceof Date&&!isNaN(c.getTime())};a.makeUTCTime=function(c,d,f="milliseconds"){d=new Date(l(d,f,"milliseconds"));d.setUTCFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate());return d};a.mergeTimeExtents=function(c,d){return c&&d?c.intersection(d):c||d};a.millisecondsPerTimeUnit=b;a.offsetDate=function(c,d,f,p=r.system){p=new k.IANAZone(q.resolveTimeZone(p));c=k.DateTime.fromJSDate(c,{zone:p});p="decades"===f||"centuries"===f?"year":m(f);
"decades"===f&&(d*=10);"centuries"===f&&(d*=100);return c.plus({[p]:d}).toJSDate()};a.offsetDateUTC=function(c,d,f="milliseconds"){c=c.getTime();d=l(d,f,"milliseconds");return new Date(c+d)};a.resetUTCDate=function(c,d){c=new Date(c.getTime());c.setUTCFullYear(d.getFullYear(),d.getMonth(),d.getDate());return c};a.timeSinceUTCMidnight=function(c,d="milliseconds"){const f=l(c.getUTCHours(),"hours","milliseconds"),p=l(c.getUTCMinutes(),"minutes","milliseconds"),g=l(c.getUTCSeconds(),"seconds","milliseconds");
c=c.getUTCMilliseconds();return l(f+p+g+c,"milliseconds",d)};a.truncateDate=function(c,d,f=r.system){f=new k.IANAZone(q.resolveTimeZone(f));c=k.DateTime.fromJSDate(c,{zone:f});if("decades"===d||"centuries"===d)return c=c.startOf("year"),{year:f}=c,c.set({year:f-f%("decades"===d?10:100)}).toJSDate();d=m(d);return c.startOf(d).toJSDate()};a.truncateLocalTime=function(c){const d=new Date(0);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),
c.getUTCDate());return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,q,r,k,l){function m(b,c,d,f){let {color:p,ratio:g}=c,{color:x,ratio:n}=d;n===g&&(1===n?g-=1E-6:n+=1E-6);c=q.clamp((f-g)/(n-g),0,1);k.lerp(b,p.toArray(),x.toArray(),c)}a.createValueFunction=function(b){return"function"===
typeof b?b:b?c=>+c[b]:()=>1};a.evaluateDensityKernel=function(b,c,d){b=Math.sqrt(b**2+c**2)/d;return 1<b?0:3/(Math.PI*d**2)*(1-b**2)**2};a.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(b){return r.px2pt(2.4*b)};a.generateGradient=function(b){const c=new Uint8ClampedArray(2048);b=b.filter(({ratio:x})=>0<=x&&1>=x).sort((x,n)=>x.ratio-n.ratio).map(({color:x,ratio:n})=>({color:x,ratio:Math.max(n,.001)}));if(1>b.length)return c;let d=b[0],f=b[0],p=1;const g=l.create();for(let x=0;512>x;x++){const n=
(x+.5)/512;for(;n>f.ratio&&p<b.length;)d=f,f=b[p++];m(g,d,f,n);c.set(g,4*x)}return c};a.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(b){return r.pt2px(b)/2.4};a.magicKernelDensityRadiusInflationFactor=2.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(a,q,r,k,l,m){function b(n){return String(n).padStart(2,
"0")}function c(n,e,h){if("date"===e||"number"===e){"number"===e&&(n=new Date(n));e=h?n.getFullYear():n.getUTCFullYear();const u=b((h?n.getMonth():n.getUTCMonth())+1),v=b(h?n.getDate():n.getUTCDate()),y=b(h?n.getHours():n.getUTCHours()),B=b(h?n.getMinutes():n.getUTCMinutes());n=b(h?n.getSeconds():n.getUTCSeconds());n=`TIMESTAMP'${e}-${u}-${v} ${y}:${B}:${n}'`}return n}function d(n,e){if(e instanceof Date)return"date";if("number"===typeof e)return"number";if("string"===typeof e&&(n=n.getField(e),"\x3cnow\x3e"!==
e.toLowerCase()&&r.isDateField(n)))return"field"}const f={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},g=new Set(["integer","small-integer"]);let x=null;a.castIntegerFieldToFloat=function(n){return`cast(${n} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=f;a.fieldDelimiter=",";a.formatAnyDate=function(n,e){const {format:h,timeZoneOptions:u,fieldType:v}=e??{};let y;u&&({timeZone:B,timeZoneName:y}=m.getTimeZoneFormattingOptions(u.layerTimeZone,u.datesInUnknownTimezone,u.viewTimeZone,q.convertDateFormatToIntlOptions(h||"short-date-short-time"),v));if("string"===typeof n&&isNaN(Date.parse("time-only"===v?`1970-01-01T${n}Z`:n)))return n;switch(v){case "date-only":var B=q.convertDateFormatToIntlOptions(h||
"short-date");return"string"===typeof n?q.formatDateOnly(n,{...B}):q.formatDate(n,{...B,timeZone:m.utc});case "time-only":return B=q.convertDateFormatToIntlOptions(h||"short-time"),"string"===typeof n?q.formatTimeOnly(n,B):q.formatDate(n,{...B,timeZone:m.utc});case "timestamp-offset":if(!B&&"string"===typeof n&&(new Date(n)).toISOString()!==n)return n;B=(e=h||u?q.convertDateFormatToIntlOptions(h||"short-date-short-time"):void 0)?{...e,timeZone:B,timeZoneName:y}:void 0;return"string"===typeof n?q.formatTimestamp(n,
B):q.formatDate(n,B);default:return e=h||u?q.convertDateFormatToIntlOptions(h||"short-date-short-time"):void 0,q.formatDate("string"===typeof n?new Date(n):n,e?{...e,timeZone:B,timeZoneName:y}:void 0)}};a.getBasemapGroup=function(n,e=f){for(const h in e)if(e[h].includes(n))return h};a.getBasemapId=function(n,e,h=!0){let u=null;n&&("string"===typeof n?e.includes(n)&&(u=n):u=l.getWellKnownBasemapId(n));return h?u||"gray":u};a.getDateDiffSQL=function(n,e,h,u){const {hasQueryEngine:v}=n;h=c(h,d(n,h),
v);n=c(e,d(n,e),v);n=`(${h} - ${n})`;u=p[u];e="/";1>u&&(u=1/u,e="*");return{sqlExpression:1===u?n:`(${n} ${e} ${u})`,sqlWhere:null}};a.getDateType=d;a.getFieldsList=async function(n){const {field:e,field2:h,field3:u,normalizationField:v,valueExpression:y}=n;n=[];y&&(x||({arcadeUtils:n}=await k.loadArcade(),x=n),n=x.extractFieldNames(y));e&&n.push(e);h&&n.push(h);u&&n.push(u);v&&n.push(v);return n};a.getNormalizationType=function(n){let e=n.normalizationType;e||(n.normalizationField?e="field":null!=
n.normalizationTotal&&(e="percent-of-total"));return e??void 0};a.isAnyDateField=function(n){return r.isDateField(n)||r.isDateOnlyField(n)||r.isTimestampOffsetField(n)};a.isIntegerField=function(n,e){n=e&&n.getField(e);return!!n&&g.has(n.type)};a.unitValueInDays=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define("exports ../Basemap ../config ../core/Collection ../core/Logger ../core/maybe ../core/urlUtils ../core/accessorSupport/ensureType ../layers/effects/utils ./basemapDefinitions".split(" "),
function(a,q,r,k,l,m,b,c,d,f){function p(F,J){let K;if("string"===typeof F){const P=F in f.esriBasemapDefinitions,E=!P&&F.includes("/");if(!P&&!E)return J=Object.entries(f.esriBasemapDefinitions).filter(([,M])=>r.apiKey&&!M.classic||!r.apiKey&&(M.classic||M.is3d)).map(([M])=>`"${M}"`).sort().join(", "),l.getLogger("esri.support.basemapUtils").warn(`Unable to find basemap definition for: ${F}. Try one of these: ${J}`),null;J&&(K=J[F]);K||(K=P?q.fromId(F):new q({style:{id:F}}),J&&(J[F]=K))}else K=c.ensureType(q,
F);K?.destroyed&&(l.getLogger("esri.support.basemapUtils").warn("The provided basemap is already destroyed",{basemap:K}),K=null);return K}function g(F){if(G)return G(F);let J=null;F=h(F);const K=!F?.baseLayers.length;for(const E in f.esriBasemapDefinitions){var P=B(f.esriBasemapDefinitions[E]);P=w(F,P,{mustMatchReferences:K});if("equal"===P){J=E;break}"base-layers-equal"===P&&(J=E)}return J}function x(F,J){const K=new k;F.forEach(P=>{const E=J.find(M=>"scene"!==M.type&&z(v(P),v(M)))||P;K.includes(E)?
K.push(P):K.push(E)});return K}function n(F){if(e(F.url))return!0;if("vector-tile"===F.type)for(const J in F.sourceNameToSource)if(e(F.sourceNameToSource[J]?.sourceUrl))return!0;return!1}function e(F){if(!F)return!1;F=new b.Url(b.makeAbsolute(F));return!!F.authority&&A.test(F.authority)}function h(F){return F?!F.loaded&&F.resourceInfo?B(F.resourceInfo.data):{baseLayers:u(F.baseLayers),referenceLayers:u(F.referenceLayers)}:null}function u(F){return(k.isCollection(F)?F.toArray():F).map(v)}function v(F){return{type:F.type,
effect:"effect"in F?F.effect:void 0,url:D("urlTemplate"in F&&F.urlTemplate||F.url||"styleUrl"in F&&F.styleUrl||""),minScale:"minScale"in F&&null!=F.minScale?F.minScale:0,maxScale:"maxScale"in F&&null!=F.maxScale?F.maxScale:0,opacity:null!=F.opacity?F.opacity:1,visible:null!=F.visible?!!F.visible:!0,sublayers:"map-image"!==F.type&&"wms"!==F.type||null==F.sublayers?void 0:F.sublayers?.map(J=>({id:J.id,visible:J.visible})),activeLayerId:"wmts"===F.type?F.activeLayer?.id:void 0}}function y(F){return F.isReference||
"ArcGISSceneServiceLayer"===F.layerType}function B(F){return F?{baseLayers:t((F.baseMapLayers??[]).filter(J=>!y(J))),referenceLayers:t((F.baseMapLayers??[]).filter(J=>y(J)))}:null}function t(F){return F.map(J=>{let K;switch(J.layerType){case "VectorTileLayer":K="vector-tile";break;case "ArcGISTiledMapServiceLayer":K="tile";break;case "ArcGISSceneServiceLayer":K="scene";break;default:K="unknown"}return{type:K,effect:J.effect,url:D(J.templateUrl||J.urlTemplate||J.styleUrl||J.url),minScale:J.minScale??
0,maxScale:J.maxScale??0,opacity:J.opacity??1,visible:null!=J.visibility?!!J.visibility:!0,sublayers:void 0,activeLayerId:void 0}})}function w(F,J,K){return null!=F!==(null!=J)?"not-equal":F&&J?C(F.baseLayers,J.baseLayers)?C(F.referenceLayers,J.referenceLayers)?"equal":K.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function C(F,J){if(F.length!==J.length)return!1;for(let K=0;K<F.length;K++)if(!z(F[K],J[K]))return!1;return!0}function z(F,J){if(F.type!==J.type||F.url!==J.url||
F.minScale!==J.minScale||F.maxScale!==J.maxScale||F.visible!==J.visible||F.opacity!==J.opacity||!d.effectEquals(F.effect,J.effect))return!1;if(null!=F.activeLayerId||null!=J.activeLayerId)return F.activeLayerId===J.activeLayerId;if(null!=F.sublayers||null!=J.sublayers){if(null==F.sublayers||null==J.sublayers||F.sublayers.length!==J.sublayers.length)return!1;for(let K=0;K<F.sublayers.length;K++){const P=F.sublayers.at(K),E=J.sublayers.at(K);if(P?.id!==E?.id||P?.visible!==E?.visible)return!1}}return!0}
function D(F){return F?b.normalize(F).replace(/^\s*https?:/i,"").toLowerCase():""}function H(F){return"portalItem"in F?F.portalItem?.thumbnailUrl:void 0}let G;const A=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;a.clonePreservingTiledLayers=function(F,J=null){F=p(F);if(!F)return null;F=F.clone();J&&(F.baseLayers=x(F.baseLayers,J.baseLayers),F.referenceLayers=x(F.referenceLayers,J.referenceLayers));return F};a.contentEquals=function(F,J){if(F===J||null!=F?.portalItem?.id&&F.portalItem.id===J?.portalItem?.id)return!0;
F=h(F);J=h(J);return"equal"===w(F,J,{mustMatchReferences:!0})};a.createCache=function(){return{}};a.destroyCache=function(F){for(const J in F)m.destroyMaybe(F[J]),delete F[J]};a.ensureType=p;a.findSpatialReference=function(F,J){if(null==J||null==F)return{spatialReference:null,updating:!1};if("not-loaded"===J.loadStatus)return J.load(),{spatialReference:null,updating:!0};if(J.spatialReference)return{spatialReference:J.spatialReference,updating:!1};if(0===J.baseLayers.length)return{spatialReference:null,
updating:!1};J=J.baseLayers.at(0);switch(J.loadStatus){case "not-loaded":J.load();case "loading":return{spatialReference:null,updating:!0};case "failed":return{spatialReference:null,updating:!1}}J=(("supportedSpatialReferences"in J?J.supportedSpatialReferences:null)||["tileInfo"in J?J.tileInfo?.spatialReference:J.spatialReference]).filter(Boolean);const K=F.spatialReference;return K?{spatialReference:J.find(P=>K.equals(P))??J[0]??null,updating:!1}:{spatialReference:J[0],updating:!1}};a.getBasemapThumbnailUrl=
function(F){if(!F)return null;var {thumbnailUrl:J}=F;return J?J:(J=g(F))?f.esriBasemapDefinitions[J].thumbnailUrl:m.mappedFind(F.baseLayers,H)};a.getWellKnownBasemapId=g;a.hasDeveloperBasemapLayer=function(F){return!!F?.baseLayers.concat(F.referenceLayers).some(n)};a.isBasemap3D=function(F){return"Web Scene"===F.portalItem?.type||F.referenceLayers.some(J=>"scene"===J.type)};a.isBasemapInBeta=function(F){return!!F?.portalItem?.tags?.some(J=>"beta"===J.toLowerCase())};a.isBasemapLayer=function(F,J){return F.basemap?.referenceLayers?.some(K=>
K.uid===J)||F.basemap?.baseLayers?.some(K=>K.uid===J)};a.isDeveloperBasemapLayer=n;a.overrideGetWellKnownBasemapId=function(F){G=F};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/Basemap":function(){define("require ./chunks/tslib.es6 ./request ./core/Collection ./core/collectionUtils ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/has ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./support/BasemapStyle ./webdoc/support/writeUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B,t,w,C){var z;let D=0;m=z=class extends m.JSONSupportMixin(c){constructor(A){super(A);this.thumbnailUrl=this.style=this.spatialReference=this.portalItem=this.id=null;this.title="Basemap";this.id=Date.now().toString(16)+"-basemap-"+D++;this.baseLayers=new k;this.referenceLayers=new k;const F=J=>{J.parent&&J.parent!==this&&"remove"in J.parent&&J.parent.remove(J);J.parent=this;"elevation"===J.type&&f.getLogger(this).error(`Layer '${J.title}, id:${J.id}' of type '${J.type}' is not supported as a basemap layer and will therefore be ignored.`)};
this.addHandles([this.baseLayers.on("after-add",J=>F(J.item)),this.referenceLayers.on("after-add",J=>F(J.item)),this.baseLayers.on("after-remove",J=>{J.item.parent=null}),this.referenceLayers.on("after-remove",J=>{J.item.parent=null})])}initialize(){this.when().catch(A=>{f.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,A)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var A=this.baseLayers.toArray();for(const F of A)F.destroy();
A=this.referenceLayers.toArray();for(const F of A)F.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem=p.destroyMaybe(this.portalItem)}normalizeCtorArgs(A){A&&"resourceInfo"in A&&(this._set("resourceInfo",A.resourceInfo),A={...A},delete A.resourceInfo);return A}set baseLayers(A){this._set("baseLayers",l.referenceSetter(A,this._get("baseLayers")))}_writeBaseLayers(A,F,J){const K=[];A&&(J={...J,layerContainerType:"basemap"},this.baseLayers.forEach(P=>{P=C.getLayerJSON(P,
J.webmap?J.webmap.getLayerJSONFromResourceInfo(P):null,J);null!=P&&K.push(P)}),this.referenceLayers.forEach(P=>{const E=C.getLayerJSON(P,J.webmap?J.webmap.getLayerJSONFromResourceInfo(P):null,J);null!=E&&("scene"!==P.type&&(E.isReference=!0),K.push(E))}));F.baseMapLayers=K}set referenceLayers(A){this._set("referenceLayers",l.referenceSetter(A,this._get("referenceLayers")))}writeTitle(A,F){F.title=A||"Basemap"}load(A){this.addResolvingPromise(this._loadFromSource(A));return Promise.resolve(this)}loadAll(){return d.loadAll(this,
A=>{A(this.baseLayers,this.referenceLayers)})}clone(){const A={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(F=>b.isClonable(F)?F.clone():F),referenceLayers:this.referenceLayers.map(F=>b.isClonable(F)?F.clone():F)};this.loaded&&(A.loadStatus="loaded");return(new z({resourceInfo:this.resourceInfo})).set(A)}read(A,F){this.resourceInfo||this._set("resourceInfo",{data:A,context:F});super.read(A,F)}write(A,F){A=A||{};F?.origin||(F={origin:"web-map",...F});super.write(A,
F);!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(A.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(J=>{J=b.clone(J);J.url&&x.isProtocolRelative(J.url)&&(J.url=`https:${J.url}`);J.templateUrl&&x.isProtocolRelative(J.templateUrl)&&(J.templateUrl=`https:${J.templateUrl}`);return J}));return A}async _loadFromSource(A){const {resourceInfo:F,portalItem:J,style:K}=this;g.throwIfAborted(A);const P=[];F?(P.push(this._loadLayersFromJSON(F.data,F.context?F.context.url:null,A)),F.data.id&&!F.data.title&&
P.push(t.getBasemapTitle(F.data.id).then(E=>{E&&this.read({title:E},F.context)}))):J?P.push(this._loadFromItem(J,A)):K&&P.push(this._loadFromStylesService(K,A));await Promise.all(P)}async _loadLayersFromJSON(A,F,J){const K=this.resourceInfo?.context,P=this.portalItem?.portal||K?.portal||null,E=G[K?.origin||""]??"web-map",{populateOperationalLayers:M}=await new Promise((ba,ea)=>a(["./layers/support/layersCreator"],ba,ea)),T=[];g.throwIfAborted(J);if(A.baseMapLayers&&Array.isArray(A.baseMapLayers)){F=
{context:{...K,origin:E,url:F,portal:P,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const ba=ea=>"web-scene"===E&&"ArcGISSceneServiceLayer"===ea.layerType||ea.isReference;J=M(this.baseLayers,A.baseMapLayers.filter(ea=>!ba(ea)),F);T.push(J);A=M(this.referenceLayers,A.baseMapLayers.filter(ba),F);T.push(A)}await Promise.allSettled(T)}async _loadFromItem(A,F){const J=await (await A.load(F)).fetchData("json",F),K=x.urlToObject(A.itemUrl??"");this._set("resourceInfo",{data:J.baseMap??
{},context:{origin:H[A.type||""]??"web-map",portal:A.portal||y.getDefault(),url:K}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:J.spatialReference},this.resourceInfo.context);this.read({title:A.title,thumbnailUrl:A.thumbnailUrl},{origin:"portal-item",portal:A.portal||y.getDefault(),url:K});return this._loadLayersFromJSON(this.resourceInfo.data,K,F)}async _loadFromStylesService(A,F){var J=`${A.serviceUrl}/${A.id}`;A=(await r(J,{query:{language:A.getLanguageParamValue(),
places:A.places,worldview:A.worldview},signal:F?.signal})).data;J=x.urlToObject(J);this._set("resourceInfo",{data:A.baseMap??{},context:{origin:"web-map",url:J}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:A.spatialReference},this.resourceInfo.context);return this._loadLayersFromJSON(this.resourceInfo.data,J,F)}static fromId(A){return(A=t.esriBasemapDefinitions[A])?A.itemId?new z({portalItem:{id:A.itemId,portal:{url:"https://www.arcgis.com"}}}):z.fromJSON(A,
{origin:A.is3d?"web-scene":"web-map"}):null}};q.__decorate([n.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(A,F,J,K){this._writeBaseLayers(A,F,K)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:k}},writer(A,F,J,K){this._writeBaseLayers(A,F,K)}}}}}})],m.prototype,"baseLayers",null);q.__decorate([n.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],m.prototype,"id",void 0);q.__decorate([n.property({type:B})],m.prototype,"portalItem",void 0);
q.__decorate([n.property()],m.prototype,"referenceLayers",null);q.__decorate([n.property({readOnly:!0})],m.prototype,"resourceInfo",void 0);q.__decorate([n.property({type:v})],m.prototype,"spatialReference",void 0);q.__decorate([n.property({type:w})],m.prototype,"style",void 0);q.__decorate([n.property()],m.prototype,"thumbnailUrl",void 0);q.__decorate([n.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],m.prototype,"title",void 0);q.__decorate([u.writer("title")],m.prototype,
"writeTitle",null);m=z=q.__decorate([h.subclass("esri.Basemap")],m);const H={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},G={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"};return m})},"esri/core/collectionUtils":function(){define(["exports","./Collection"],function(a,q){a.castForReferenceSetter=function(r){return r};a.referenceSetter=function(r,k,l=q){k||=new l;if(k===r)return k;k.removeAll();r&&(Array.isArray(r)||"items"in r&&Array.isArray(r.items))?
k.addMany(r):r&&k.add(r);return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Loadable":function(){define("../chunks/tslib.es6 ./Error ./maybe ./Promise ./promiseUtils ./Warning ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c){const d=f=>{f=class extends f{constructor(...p){super(...p);this.loadError=this._loadController=null;this.loadStatus="not-loaded";this._set("loadWarnings",[]);this.addResolvingPromise(new Promise(g=>
{const x=this.load.bind(this);this.load=n=>{const e=new Promise((h,u)=>{const v=l.onAbortOrThrow(n,u);this.destroyed&&u(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this}));this.when(h,u).finally(()=>{v&&v.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const h=this._loadController=new AbortController;x({signal:h.signal})}g();return e}}));this.when(()=>{this._set("loadStatus","loaded");
this._loadController=null},g=>{this._set("loadStatus","failed");this._set("loadError",g);this._loadController=null})}destroy(){this._loadController&&(this._loadController=r.abortMaybe(this._loadController),this._promiseProps.abort());this._set("loadError",null);this._set("loadWarnings",[])}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){if(this.isFulfilled())return this;this._set("loadError",new q("load:cancelled","Cancelled"));
this._loadController?.abort();this._promiseProps.abort();return this}};a.__decorate([b.property({readOnly:!0})],f.prototype,"loaded",null);a.__decorate([b.property({readOnly:!0})],f.prototype,"loadError",void 0);a.__decorate([b.property({clonable:!1})],f.prototype,"loadStatus",void 0);a.__decorate([b.property({type:[m],readOnly:!0})],f.prototype,"loadWarnings",null);return f=a.__decorate([c.subclass("esri.core.Loadable")],f)};k=class extends d(k.EsriPromise){};k=a.__decorate([c.subclass("esri.core.Loadable")],
k);(function(f){f.LoadableMixin=d;f.isLoadable=function(p){return!(!p||!p.load)}})(k||={});return k})},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],function(a,q,r,k,l){var m;(function(d){d[d.PENDING=0]="PENDING";d[d.RESOLVED=1]="RESOLVED";d[d.REJECTED=2]="REJECTED"})(m||={});class b{constructor(){this._resolver=k.createResolver();this._status=m.PENDING;this._resolvingPromises=[];this._resolver.promise.then(()=>
{this._status=m.RESOLVED;this._cleanUp()},()=>{this._status=m.REJECTED;this._cleanUp()});this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(d){this._resolvingPromises.push(d);this._tryResolve()}isResolved(){return this._status===m.RESOLVED}isRejected(){return this._status===m.REJECTED}isFulfilled(){return this._status!==m.PENDING}abort(){this._resolver.reject(k.createAbortError())}_cleanUp(){this._resolvingPromises=this._allPromise=null}_tryResolve(){if(!this.isFulfilled()){var d=
k.createResolver(),f=[...this._resolvingPromises,d.promise],p=this._allPromise=Promise.all(f);p.then(()=>{this.isFulfilled()||this._allPromise!==p||this._resolver.resolve()},g=>{this.isFulfilled()||this._allPromise!==p||k.isAbortError(g)||this._resolver.reject(g)});d.resolve()}}}const c=d=>{d=class extends d{constructor(...f){super(...f);this._promiseProps=new b;this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(f,
p){return this._promiseProps.promise.then(()=>this).then(f,p)}catch(f){return this.when(null,f)}addResolvingPromise(f){f&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in f?f.when():f)}};return d=q.__decorate([l.subclass("esri.core.Promise")],d)};a.EsriPromise=class extends c(r){};a.EsriPromise=q.__decorate([l.subclass("esri.core.Promise")],a.EsriPromise);a.EsriPromiseMixin=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/loadAll":function(){define(["exports",
"./asyncUtils","./Collection","./Loadable"],function(a,q,r,k){async function l(m,b){const c=[],d=(...p)=>{for(const g of p)null!=g&&(Array.isArray(g)?d(...g):r.isCollection(g)?g.forEach(x=>d(x)):k.isLoadable(g)&&c.push(g))};b(d);let f=null;await q.map(c,async p=>{p=await q.result("loadAll"in p&&"function"===typeof p.loadAll?p.loadAll():p.load());!1!==p.ok||f||(f=p)});if(f)throw f.error;return m}a.loadAll=async function(m,b){await m.load();return l(m,b)};a.loadAllChildren=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/portal/Portal":function(){define("require ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/JSONSupport ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ../intl/locale ./portalDefault ./PortalGroup ./PortalQueryParams ./PortalQueryResult ./PortalUser ../support/apiKeyUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B,t,w,C,z){function D(K){const P=k.id;return()=>{const E=K.deref();E&&P.findCredential(E.restUrl)&&E.signIn().catch(()=>{})}}const H=K=>Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));var G;let A;const F={PortalGroup:()=>Promise.resolve({default:B}),PortalItem:()=>new Promise((K,P)=>a(["./PortalItem"],E=>K(H(E)),P)),PortalUser:()=>Promise.resolve({default:C})};b=G=class extends b.JSONSupportMixin(c){constructor(K){super(K);
this.access=this._esriIdCredentialCreateHandle=null;this.allSSL=!1;this.authMode="auto";this.bingKey=this.basemapGalleryGroupQuery3D=this.basemapGalleryGroupQuery=this.authorizedCrossOriginDomains=null;this.canProvisionDirectPurchase=this.canListPreProvisionedItems=this.canListData=this.canListApps=!1;this.canSearchPublic=!0;this.canSignInIDP=this.canSignInArcGIS=this.canSharePublic=this.canShareBingPublic=!1;this.colorSetsGroupQuery=null;this.commentsEnabled=!1;this.livingAtlasGroupQuery=this.galleryTemplatesGroupQuery=
this.featuredItemsGroupQuery=this.featuredGroups=this.eueiEnabled=this.devBasemapGalleryGroupQuery=this.description=this.defaultVectorBasemap=this.defaultExtent=this.defaultDevBasemap=this.defaultBasemap=this.customBaseUrl=this.culture=this.created=null;this.hasCategorySchema=!1;this.ipCntryCode=this.id=this.httpsPort=this.httpPort=this.homePageFeaturedContentCount=this.homePageFeaturedContent=this.helperServices=null;this.isReadOnly=this.isPortal=!1;this.rotatorPanels=this.region=this.portalProperties=
this.portalMode=this.portalHostname=this.name=this.modified=this.maxTokenExpirationMinutes=this.layerTemplatesGroupQuery=null;this.showHomePageDescription=!1;this.sourceJSON=null;this.supportsHostedServices=!1;this.units=this.templatesGroupQuery=this.symbolSetsGroupQuery=null;this.url=r.portalUrl;this.user=this.urlKey=null;this.use3dBasemaps=!0;this.useVectorBasemaps=this.useStandardizedQuery=!1;this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(K){return"string"===typeof K?{url:K}:K}destroy(){J.unregister(this);
this.defaultBasemap=d.destroyMaybe(this.defaultBasemap);this.defaultDevBasemap=d.destroyMaybe(this.defaultDevBasemap);this.defaultVectorBasemap=d.destroyMaybe(this.defaultVectorBasemap);this._esriIdCredentialCreateHandle=d.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(K){if(K)for(const P of K)r.request.trustedServers.includes(P)||r.request.trustedServers.push(P);return K}readDefaultBasemap(K){return this._readBasemap(K)}readDefaultDevBasemap(K){return this._readBasemap(K)}readDefaultVectorBasemap(K){return this._readBasemap(K)}get extraQuery(){const K=
!this.user?.orgId||this.canSearchPublic;return this.id&&!K?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let K=this.url;if(K){const P=K.indexOf("/sharing");K=0<P?K.substring(0,P):this.url.replace(/\/+$/,"");K+="/sharing/rest"}return K}get thumbnailUrl(){const K=this.restUrl,P=this.thumbnail;return K&&P?this._normalizeSSL(K+"/portals/self/resources/"+P):null}readUrlKey(K){return K?K.toLowerCase():
K}readUser(K){let P=null;K&&(P=C.fromJSON(K),P.portal=this);return P}load(K){const P=(new Promise((E,M)=>a(["../Basemap"],T=>E(H(T)),M))).then(({default:E})=>{f.throwIfAborted(K);A=E}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,K)).then(E=>{if(k.id){const M=k.id;this.credential=M.findCredential(this.restUrl);this.credential||this.authMode!==G.AUTH_MODE_AUTO&&this.authMode!==G.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=
M.on("credential-create",D(new WeakRef(this))),J.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=E;this.read(E)});this.addResolvingPromise(P);return Promise.resolve(this)}async createElevationLayers(){await this.load();const K=this._getHelperService("defaultElevationLayers"),P=(await new Promise((E,M)=>a(["../layers/ElevationLayer"],T=>E(H(T)),M))).default;return K?K.map(E=>new P({id:E.id,url:E.url})):[]}async fetchBasemaps(K,P){const E=await this._fetchBasemaps(K,P);!0===
P?.include3d&&!1!==this.use3dBasemaps&&(K=await this._fetchBasemaps3D(K,P),E.unshift(...K));return E}fetchCategorySchema(K){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",K).then(P=>P.categorySchema):f.isAborted(K)?Promise.reject(f.createAbortError()):Promise.resolve([])}fetchFeaturedGroups(K){const P=this.featuredGroups,E=new t;E.num=100;E.sortField="title";if(P&&P.length){const M=[];for(const T of P)M.push(`(title:"${T.title}" AND owner:${T.owner})`);E.query=
M.join(" OR ");return this.queryGroups(E,K).then(T=>T.results)}return f.isAborted(K)?Promise.reject(f.createAbortError()):Promise.resolve([])}fetchRegions(K){const P=this.user?.culture||this.culture||v.getLocale();return this.request(this.restUrl+"/portals/regions",{...K,query:{culture:P}})}fetchSettings(K){const P=this.user?.culture||this.culture||v.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...K,query:{culture:P}})}static getDefault(){return y.ensureDefaultPortalInstance(()=>
new G)}queryGroups(K,P){return this.queryPortal("/community/groups",K,"PortalGroup",P)}queryItems(K,P){return this.queryPortal("/search",K,"PortalItem",P)}queryUsers(K,P){K.sortField||(K.sortField="username");return this.queryPortal("/community/users",K,"PortalUser",P)}fetchSelf(K=this.authMode,P=!1,E){const M=this.restUrl+"/portals/self";K={authMode:K,query:{culture:v.getLocale().toLowerCase()},withCredentials:!0,...E};"auto"===K.authMode&&(K.authMode="no-prompt");P&&(K.query.default=!0);return this.request(M,
K)}queryPortal(K,P,E,M){const T=g.ensureType(t,P),ba=ea=>this.request(this.restUrl+K,{...T.toRequestOptions(this),...M}).then(X=>{const ca=T.clone();ca.start=X.nextStart;return new w({nextQueryParams:ca,queryParams:T,total:X.total,results:G._resultsToTypedArray(ea,{portal:this},X,M)})}).then(X=>Promise.all(X.results.map(ca=>"function"===typeof ca.when?ca.when():X)).then(()=>X,ca=>{f.throwIfAbortError(ca);return X}));return E&&F[E]?F[E]().then(({default:ea})=>{f.throwIfAborted(M);return ba(ea)}):ba()}signIn(){if(this.authMode===
G.AUTH_MODE_ANONYMOUS||this.authMode===G.AUTH_MODE_NO_PROMPT&&!k.id)return Promise.reject(new m("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const K=P=>Promise.resolve().then(()=>{if("not-loaded"===this.loadStatus)return P||(this.authMode="immediate"),this.load().then(()=>null);if("loading"===this.loadStatus)return this.load().then(()=>{if(this.credential)return null;this.credential=P;return this.fetchSelf("immediate")});
if(this.user&&this.credential===P)return null;this.credential=P;return this.fetchSelf("immediate")}).then(E=>{E&&(this.sourceJSON=E,this.read(E))});return k.id?k.id.getCredential(this.restUrl,{prompt:this.authMode!==G.AUTH_MODE_NO_PROMPT}).then(P=>K(P)):K(this.credential)}normalizeUrl(K){const P=this.credential?.token;return this._normalizeSSL(P?K+(K.includes("?")?"\x26":"?")+"token\x3d"+P:K)}requestToTypedArray(K,P,E){return this.request(K,P).then(M=>{const T=G._resultsToTypedArray(E,{portal:this},
M);return Promise.all(T.map(ba=>"function"===typeof ba.when?ba.when():M)).then(()=>T,()=>T)})}request(K,P={}){var E={f:"json",...P.query};const {authMode:M=this.authMode===G.AUTH_MODE_ANONYMOUS||this.authMode===G.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:T=null,cacheBust:ba=!1,method:ea="auto",responseType:X="json",signal:ca}=P;E={authMode:M,body:T,cacheBust:ba,method:ea,query:E,responseType:X,timeout:0,signal:ca};P.withCredentials&&(E.withCredentials=!0);return l(this._normalizeSSL(K),E).then(ma=>
ma.data)}toJSON(){throw new m("internal:not-yet-implemented","Portal.toJSON is not yet implemented");}static fromJSON(K){if(!K)return null;if(K.declaredClass)throw Error("JSON object is already hydrated");return new G({sourceJSON:K})}_getHelperService(K){const P=this.helperServices&&this.helperServices[K];if(!P)throw new m("portal:service-not-found",`The \`helperServices\` do not include an entry named "${K}"`);return P}async _fetchBasemaps(K,P){const E=new t;E.query=K||(r.apiKey&&z.supportsApiKey(this.url)?
this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);E.disableExtraQuery=!0;K=await this.queryGroups(E,P);if(!K.total)return[];K=K.results[0];E.num=100;E.query='type:"Web Map" -type:"Web Application"';E.sortField=K.sortField||"name";E.sortOrder=K.sortOrder||"desc";P=await K.queryItems(E,P);return P.total?P.results.filter(M=>"Web Map"===M.type).map(M=>new A({portalItem:M})):[]}async _fetchBasemaps3D(K,P){K=K||this.basemapGalleryGroupQuery3D;
if(!K)return[];K=new t({query:K,disableExtraQuery:!0});var E=await this.queryGroups(K,P);if(!E.total)return[];E=E.results[0];K.num=100;K.query='type:"Web Scene"';K.sortField=E.sortField||"name";K.sortOrder=E.sortOrder||"desc";P=await E.queryItems(K,P);return P.total?P.results.filter(M=>"Web Scene"===M.type).map(M=>new A({portalItem:M})):[]}_normalizeSSL(K){return K.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(K){return K?(K=A.fromJSON(K),K.portalItem={portal:this},K):null}static _resultsToTypedArray(K,
P,E,M){let T=[];if(E){const ba=null!=M?M.signal:null;T=E.listings||E.notifications||E.userInvitations||E.tags||E.items||E.groups||E.comments||E.provisions||E.results||E.relatedItems||E;if(K||P)T=T.map(ea=>{ea=Object.assign(K?K.fromJSON(ea):ea,P);"function"===typeof ea.load&&ea.load(ba);return ea})}else T=[];return T}};b.AUTH_MODE_ANONYMOUS="anonymous";b.AUTH_MODE_AUTO="auto";b.AUTH_MODE_IMMEDIATE="immediate";b.AUTH_MODE_NO_PROMPT="no-prompt";q.__decorate([p.property()],b.prototype,"access",void 0);
q.__decorate([p.property()],b.prototype,"allSSL",void 0);q.__decorate([p.property()],b.prototype,"authMode",void 0);q.__decorate([p.property()],b.prototype,"authorizedCrossOriginDomains",void 0);q.__decorate([e.reader("authorizedCrossOriginDomains")],b.prototype,"readAuthorizedCrossOriginDomains",null);q.__decorate([p.property()],b.prototype,"basemapGalleryGroupQuery",void 0);q.__decorate([p.property({json:{name:"3DBasemapGalleryGroupQuery"}})],b.prototype,"basemapGalleryGroupQuery3D",void 0);q.__decorate([p.property()],
b.prototype,"bingKey",void 0);q.__decorate([p.property()],b.prototype,"canListApps",void 0);q.__decorate([p.property()],b.prototype,"canListData",void 0);q.__decorate([p.property()],b.prototype,"canListPreProvisionedItems",void 0);q.__decorate([p.property()],b.prototype,"canProvisionDirectPurchase",void 0);q.__decorate([p.property()],b.prototype,"canSearchPublic",void 0);q.__decorate([p.property()],b.prototype,"canShareBingPublic",void 0);q.__decorate([p.property()],b.prototype,"canSharePublic",void 0);
q.__decorate([p.property()],b.prototype,"canSignInArcGIS",void 0);q.__decorate([p.property()],b.prototype,"canSignInIDP",void 0);q.__decorate([p.property()],b.prototype,"colorSetsGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"commentsEnabled",void 0);q.__decorate([p.property({type:Date})],b.prototype,"created",void 0);q.__decorate([p.property()],b.prototype,"credential",void 0);q.__decorate([p.property()],b.prototype,"culture",void 0);q.__decorate([p.property()],b.prototype,"currentVersion",
void 0);q.__decorate([p.property()],b.prototype,"customBaseUrl",void 0);q.__decorate([p.property()],b.prototype,"defaultBasemap",void 0);q.__decorate([e.reader("defaultBasemap")],b.prototype,"readDefaultBasemap",null);q.__decorate([p.property()],b.prototype,"defaultDevBasemap",void 0);q.__decorate([e.reader("defaultDevBasemap")],b.prototype,"readDefaultDevBasemap",null);q.__decorate([p.property({type:u})],b.prototype,"defaultExtent",void 0);q.__decorate([p.property()],b.prototype,"defaultVectorBasemap",
void 0);q.__decorate([e.reader("defaultVectorBasemap")],b.prototype,"readDefaultVectorBasemap",null);q.__decorate([p.property()],b.prototype,"description",void 0);q.__decorate([p.property()],b.prototype,"devBasemapGalleryGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"eueiEnabled",void 0);q.__decorate([p.property({readOnly:!0})],b.prototype,"extraQuery",null);q.__decorate([p.property()],b.prototype,"featuredGroups",void 0);q.__decorate([p.property()],b.prototype,"featuredItemsGroupQuery",
void 0);q.__decorate([p.property()],b.prototype,"galleryTemplatesGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"livingAtlasGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"hasCategorySchema",void 0);q.__decorate([p.property()],b.prototype,"helpBase",void 0);q.__decorate([p.property()],b.prototype,"helperServices",void 0);q.__decorate([p.property()],b.prototype,"helpMap",void 0);q.__decorate([p.property()],b.prototype,"homePageFeaturedContent",void 0);q.__decorate([p.property()],
b.prototype,"homePageFeaturedContentCount",void 0);q.__decorate([p.property()],b.prototype,"httpPort",void 0);q.__decorate([p.property()],b.prototype,"httpsPort",void 0);q.__decorate([p.property()],b.prototype,"id",void 0);q.__decorate([p.property()],b.prototype,"ipCntryCode",void 0);q.__decorate([p.property({readOnly:!0})],b.prototype,"isOrganization",null);q.__decorate([p.property()],b.prototype,"isPortal",void 0);q.__decorate([p.property()],b.prototype,"isReadOnly",void 0);q.__decorate([p.property({readOnly:!0})],
b.prototype,"itemPageUrl",null);q.__decorate([p.property()],b.prototype,"layerTemplatesGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"maxTokenExpirationMinutes",void 0);q.__decorate([p.property({type:Date})],b.prototype,"modified",void 0);q.__decorate([p.property()],b.prototype,"name",void 0);q.__decorate([p.property()],b.prototype,"portalHostname",void 0);q.__decorate([p.property()],b.prototype,"portalMode",void 0);q.__decorate([p.property()],b.prototype,"portalProperties",void 0);
q.__decorate([p.property()],b.prototype,"region",void 0);q.__decorate([p.property({readOnly:!0})],b.prototype,"restUrl",null);q.__decorate([p.property()],b.prototype,"rotatorPanels",void 0);q.__decorate([p.property()],b.prototype,"showHomePageDescription",void 0);q.__decorate([p.property()],b.prototype,"sourceJSON",void 0);q.__decorate([p.property()],b.prototype,"staticImagesUrl",void 0);q.__decorate([p.property({json:{name:"2DStylesGroupQuery"}})],b.prototype,"stylesGroupQuery2d",void 0);q.__decorate([p.property({json:{name:"stylesGroupQuery"}})],
b.prototype,"stylesGroupQuery3d",void 0);q.__decorate([p.property()],b.prototype,"supportsHostedServices",void 0);q.__decorate([p.property()],b.prototype,"symbolSetsGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"templatesGroupQuery",void 0);q.__decorate([p.property()],b.prototype,"thumbnail",void 0);q.__decorate([p.property({readOnly:!0})],b.prototype,"thumbnailUrl",null);q.__decorate([p.property()],b.prototype,"units",void 0);q.__decorate([p.property()],b.prototype,"url",void 0);q.__decorate([p.property()],
b.prototype,"urlKey",void 0);q.__decorate([e.reader("urlKey")],b.prototype,"readUrlKey",null);q.__decorate([p.property()],b.prototype,"user",void 0);q.__decorate([e.reader("user")],b.prototype,"readUser",null);q.__decorate([p.property()],b.prototype,"use3dBasemaps",void 0);q.__decorate([p.property()],b.prototype,"useStandardizedQuery",void 0);q.__decorate([p.property()],b.prototype,"useVectorBasemaps",void 0);q.__decorate([p.property()],b.prototype,"vectorBasemapGalleryGroupQuery",void 0);q=b=G=q.__decorate([h.subclass("esri.portal.Portal")],
b);const J=new FinalizationRegistry(K=>{K.remove()});return q})},"esri/portal/portalDefault":function(){define(["exports"],function(a){let q;a.clearDefaultPortalInstance=function(){q=void 0};a.ensureDefaultPortalInstance=function(r){if(!q||q.destroyed)q=r();return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/PortalGroup":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./PortalQueryParams".split(" "),
function(a,q,r,k,l,m,b,c,d){var f;r=f=class extends r.JSONSupport{constructor(p){super(p);this.id=this.description=this.created=this.access=null;this.isInvitationOnly=!1;this.title=this.tags=this.sourceJSON=this.sortOrder=this.sortField=this.snippet=this.portal=this.owner=this.modified=null}get thumbnailUrl(){const p=this.url,g=this.thumbnail;return p&&g&&this.portal?this.portal?.normalizeUrl(`${p}/info/${g}?f=json`):null}get url(){const p=this.portal?.restUrl;return p?p+"/community/groups/"+this.id:
null}fetchCategorySchema(p){return this.portal.request(this.url+"/categorySchema",p).then(g=>{g=g.categorySchema||[];return g.some(x=>"contentCategorySetsGroupQuery.LivingAtlas"===x.source)?this._fetchCategorySchemaSet("LivingAtlas",p):g})}fetchMembers(p){return this.portal.request(this.url+"/users",p)}getThumbnailUrl(p){let g=this.thumbnailUrl;g&&p&&(g+=`&w=${p}`);return g}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");}static fromJSON(p){if(!p)return null;
if(p.declaredClass)throw Error("JSON object is already hydrated");const g=new f;g.sourceJSON=p;g.read(p);return g}queryItems(p,g){p=l.ensureType(d,p);const x=this.portal;if(5<parseFloat(x.currentVersion))return p=p||new d,x.queryPortal(`/content/groups/${this.id}/search`,p,"PortalItem",g);p=p?p.clone():new d;p.query="group:"+this.id+(p.query?" "+p.query:"");return x.queryItems(p,g)}_fetchCategorySchemaSet(p,g){const x=this.portal;return x.fetchSelf(x.authMode,!0,g).then(n=>{if(n=n.contentCategorySetsGroupQuery){const e=
new d;e.disableExtraQuery=!0;e.num=1;e.query=n;return x.queryGroups(e,g)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found");}).then(n=>{if(n.total){n=n.results[0];const e=new d;e.num=1;e.query=`typekeywords:"${p}"`;return n.queryItems(e,g)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found");}).then(n=>n.total?n.results[0].fetchData("json",g).then(e=>{e=e?.categorySchema;return e?.length?e:[]}):[])}};a.__decorate([k.property()],
r.prototype,"access",void 0);a.__decorate([k.property({type:Date})],r.prototype,"created",void 0);a.__decorate([k.property()],r.prototype,"description",void 0);a.__decorate([k.property()],r.prototype,"id",void 0);a.__decorate([k.property()],r.prototype,"isInvitationOnly",void 0);a.__decorate([k.property({type:Date})],r.prototype,"modified",void 0);a.__decorate([k.property()],r.prototype,"owner",void 0);a.__decorate([k.property()],r.prototype,"portal",void 0);a.__decorate([k.property()],r.prototype,
"snippet",void 0);a.__decorate([k.property()],r.prototype,"sortField",void 0);a.__decorate([k.property()],r.prototype,"sortOrder",void 0);a.__decorate([k.property()],r.prototype,"sourceJSON",void 0);a.__decorate([k.property()],r.prototype,"tags",void 0);a.__decorate([k.property()],r.prototype,"thumbnail",void 0);a.__decorate([k.property({readOnly:!0})],r.prototype,"thumbnailUrl",null);a.__decorate([k.property()],r.prototype,"title",void 0);a.__decorate([k.property({readOnly:!0})],r.prototype,"url",
null);return r=f=a.__decorate([c.subclass("esri.portal.PortalGroup")],r)})},"esri/portal/PortalQueryParams":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils".split(" "),function(a,q,r,k,l,m,b,c,d,f,p){var g;const x=new r.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",
numComments:"num-comments",numViews:"num-views"});q=g=class extends q{constructor(n){super(n);this.categories=null;this.disableExtraQuery=!1;this.filter=this.extent=null;this.num=10;this.sortField=this.query=null;this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(n){"asc"!==n&&"desc"!==n||this._set("sortOrder",n)}clone(){return new g({categories:this.categories?k.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():
null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(n,e){let h=[];this.categories&&(h=this.categories.map(y=>Array.isArray(y)?JSON.stringify(y):y));let u="";if(this.extent){var v=p.project(this.extent,f.WGS84);null!=v&&(u=`${v.xmin},${v.ymin},${v.xmax},${v.ymax}`)}v=this.query;!this.disableExtraQuery&&n.extraQuery&&(v="("+v+")"+n.extraQuery);n={categories:h,bbox:u,q:v,filter:this.filter,num:this.num,sortField:null,
sortOrder:null,start:this.start};this.sortField&&(n.sortField=this.sortField.split(",").map(y=>x.toJSON(y.trim())).join(","),n.sortOrder=this.sortOrder);return{query:{...e,...n}}}};a.__decorate([l.property()],q.prototype,"categories",void 0);a.__decorate([l.property()],q.prototype,"disableExtraQuery",void 0);a.__decorate([l.property({type:d})],q.prototype,"extent",void 0);a.__decorate([l.property()],q.prototype,"filter",void 0);a.__decorate([l.property()],q.prototype,"num",void 0);a.__decorate([l.property()],
q.prototype,"query",void 0);a.__decorate([l.property()],q.prototype,"sortField",void 0);a.__decorate([l.property()],q.prototype,"sortOrder",null);a.__decorate([l.property()],q.prototype,"start",void 0);return q=g=a.__decorate([c.subclass("esri.portal.PortalQueryParams")],q)})},"esri/portal/PortalQueryResult":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b){q=class extends q{constructor(c){super(c);this.total=this.results=this.queryParams=this.nextQueryParams=null}};a.__decorate([r.property()],q.prototype,"nextQueryParams",void 0);a.__decorate([r.property()],q.prototype,"queryParams",void 0);a.__decorate([r.property()],q.prototype,"results",void 0);a.__decorate([r.property()],q.prototype,"total",void 0);return q=a.__decorate([b.subclass("esri.portal.PortalQueryResult")],q)})},"esri/portal/PortalUser":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){var g;k=g=class extends k.JSONSupport{constructor(...x){super(...x);this.userType=this.username=this.units=this.sourceJSON=this.roleId=this.role=this.region=this.privileges=this.preferredView=this.portal=this.orgId=this.modified=this.fullName=this.email=this.description=this.culture=this.created=this.access=null}get thumbnailUrl(){const x=this.url,n=this.thumbnail;return x&&n?this.portal.normalizeUrl(`${x}/info/${n}?f=json`):null}get userContentUrl(){const x=this.portal?.restUrl;
return x?`${x}/content/users/${this.username}`:null}get url(){const x=this.portal?.restUrl;return x?`${x}/community/users/${this.username}`:null}addItem(x){const n=x&&x.item;var e=x?.data;x=x?.folder;const h={method:"post"};n&&(h.query=n.createPostQuery(),null!=e&&("string"===typeof e?h.query.text=e:"object"===typeof e&&(h.query.text=JSON.stringify(e))));e=this.userContentUrl;x&&(e+="/"+("string"===typeof x?x:x.id));return this.portal.request(e+"/addItem",h).then(u=>{n.id=u.id;n.portal=this.portal;
return n.loaded?n.reload():n.load()})}deleteItem(x){let n=this.userContentUrl;x.ownerFolder&&(n+="/"+x.ownerFolder);return this.portal.request(n+`/items/${x.id}/delete`,{method:"post"}).then(()=>{x.id=null;x.portal=null})}deleteItems(x){const n=this.userContentUrl+"/deleteItems";var e=x.map(h=>h.id);return e.length?(e={method:"post",query:{items:e.join(",")}},this.portal.request(n,e).then(()=>{x.forEach(h=>{h.id=null;h.portal=null})})):Promise.resolve(void 0)}fetchFolders(){return this.portal.request(this.userContentUrl??
"",{query:{num:1}}).then(x=>x&&x.folders?x.folders.map(n=>{n=f.fromJSON(n);n.portal=this.portal;return n}):[])}fetchGroups(){return this.portal.request(this.url??"").then(x=>x&&x.groups?x.groups.map(n=>{n=p.fromJSON(n);n.portal=this.portal;return n}):[])}fetchItems(x){const n=x??{};let e=this.userContentUrl??"";n.folder&&(e+="/"+n.folder.id);let h;return(new Promise((u,v)=>a(["./PortalItem"],y=>u(Object.freeze(Object.defineProperty({__proto__:null,default:y},Symbol.toStringTag,{value:"Module"}))),
v))).then(({default:u})=>{h=u;return this.portal.request(e,{query:{folders:!1,num:n.num||10,start:n.start||1,sortField:n.sortField||"created",sortOrder:n.sortOrder||"asc"}})}).then(u=>{let v;return u?.items?(v=u.items.map(y=>{y=h.fromJSON(y);y.portal=this.portal;return y}),Promise.all(v.map(y=>y.load())).catch(y=>y).then(()=>({items:v,nextStart:u.nextStart,total:u.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(x=>x.tags)}getThumbnailUrl(x){let n=
this.thumbnailUrl;n&&x&&(n+=`&w=${x}`);return n}queryFavorites(x){return this.favGroupId?(this._favGroup||(this._favGroup=new p({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(x)):Promise.reject(new r("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new r("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented");}static fromJSON(x){if(!x)return null;if(x.declaredClass)throw Error("JSON object is already hydrated");
const n=new g;n.sourceJSON=x;n.read(x);return n}};q.__decorate([l.property()],k.prototype,"access",void 0);q.__decorate([l.property({type:Date})],k.prototype,"created",void 0);q.__decorate([l.property()],k.prototype,"culture",void 0);q.__decorate([l.property()],k.prototype,"description",void 0);q.__decorate([l.property()],k.prototype,"email",void 0);q.__decorate([l.property()],k.prototype,"favGroupId",void 0);q.__decorate([l.property()],k.prototype,"fullName",void 0);q.__decorate([l.property({type:Date})],
k.prototype,"modified",void 0);q.__decorate([l.property()],k.prototype,"orgId",void 0);q.__decorate([l.property()],k.prototype,"portal",void 0);q.__decorate([l.property()],k.prototype,"preferredView",void 0);q.__decorate([l.property()],k.prototype,"privileges",void 0);q.__decorate([l.property()],k.prototype,"region",void 0);q.__decorate([l.property()],k.prototype,"role",void 0);q.__decorate([l.property()],k.prototype,"roleId",void 0);q.__decorate([l.property()],k.prototype,"sourceJSON",void 0);q.__decorate([l.property()],
k.prototype,"thumbnail",void 0);q.__decorate([l.property({readOnly:!0})],k.prototype,"thumbnailUrl",null);q.__decorate([l.property()],k.prototype,"units",void 0);q.__decorate([l.property({readOnly:!0})],k.prototype,"userContentUrl",null);q.__decorate([l.property({readOnly:!0})],k.prototype,"url",null);q.__decorate([l.property()],k.prototype,"username",void 0);q.__decorate([l.property()],k.prototype,"userType",void 0);return k=g=q.__decorate([d.subclass("esri.portal.PortalUser")],k)})},"esri/portal/PortalFolder":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c){r=class extends r.JSONSupport{constructor(d){super(d);this.username=this.title=this.portal=this.id=this.created=null}get url(){const d=this.portal?.restUrl;return d?`${d}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented");}};a.__decorate([k.property({type:Date})],r.prototype,"created",void 0);a.__decorate([k.property()],r.prototype,"id",void 0);a.__decorate([k.property()],r.prototype,
"portal",void 0);a.__decorate([k.property()],r.prototype,"title",void 0);a.__decorate([k.property({readOnly:!0})],r.prototype,"url",null);a.__decorate([k.property()],r.prototype,"username",void 0);return r=a.__decorate([c.subclass("esri.portal.PortalFolder")],r)})},"esri/portal/PortalItem":function(){define("require ../chunks/tslib.es6 ../assets ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ./Portal ./PortalItemResource ./PortalRating ../chunks/persistableUrlUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u){var v;const y=new Set("Map Service;Feature Service;Feature Collection;Scene Service;Image Service;Stream Service;Vector Tile Service;GeoJson;CSV;KML;WFS;WMTS;WMS;Feed".split(";")),B=new Set(["KML","GeoJson","CSV"]);l=v=class extends l.JSONSupportMixin(b){static from(t){return f.ensureClass(v,t)}constructor(t){super(t);this.id=this.groupCategories=this.extent=this.description=this.culture=this.created=this.categories=this.avgRating=this.applicationProxies=
this.apiKey=this.accessInformation=this.access=null;this.isOrgItem=!1;this.url=this.typeKeywords=this.type=this.title=this.tags=this.spatialReference=this.sourceUrl=this.sourceJSON=this.snippet=this.size=this.screenshots=this.portal=this.ownerFolder=this.owner=this.numViews=this.numRatings=this.numComments=this.name=this.modified=this.licenseInfo=this.itemControl=null}destroy(){this.portal=null}get displayName(){const t=this.type,w=this.typeKeywords||[];let C=t;"Feature Service"===t||"Feature Collection"===
t?C=w.includes("Table")?"Table":w.includes("Route Layer")?"Route Layer":w.includes("Markup")?"Markup":"Feature Layer":"Image Service"===t?C=w.includes("Elevation 3D Layer")?"Elevation Layer":w.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===t?C="Scene Layer":"Video Service"===t?C="Video Layer":"Scene Package"===t?C="Scene Layer Package":"Stream Service"===t?C="Feature Layer":"Geoprocessing Service"===t?C=w.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===
t?C="GeoEnrichment Service":"Geocoding Service"===t?C="Locator":"Microsoft Powerpoint"===t?C="Microsoft PowerPoint":"GeoJson"===t?C="GeoJSON":"Globe Service"===t?C="Globe Layer":"Vector Tile Service"===t?C="Tile Layer":"netCDF"===t?C="NetCDF":"Map Service"===t?C=w.includes("Spatiotemporal")||!w.includes("Hosted Service")&&!w.includes("Tiled")||w.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?C=t.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===
t?C="Big Data File Share":"Compact Tile Package"===t?C="Tile Package (tpkx)":"Raster function template"===t?C="Raster Function Template":"OGCFeatureServer"===t?C="OGC Feature Layer":"web mapping application"===t&&w.includes("configurableApp")?C="Instant App":"Insights Page"===t?C="Insights Report":"Excalibur Imagery Project"===t&&(C="Excalibur Project");return C}readExtent(t){return t&&t.length?new x(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var t=this.type?.toLowerCase()||"";const w=this.typeKeywords||
[];var C=!1,z=!1;let D=!1,H=!1,G=!1,A=!1;C=z=!1;0<t.indexOf("service")||"feature collection"===t||"kml"===t||"wms"===t||"wmts"===t||"wfs"===t?(C=w.includes("Hosted Service"),"feature service"===t||"feature collection"===t||"kml"===t||"wfs"===t?(z=w.includes("Table"),D=w.includes("Route Layer"),H=w.includes("Markup"),G=w.includes("Spatiotemporal"),A=w.includes("UtilityNetwork"),t=G&&z?"spatiotemporaltable":z?"table":D?"routelayer":H?"markup":G?"spatiotemporal":A?"utilitynetwork":C?"featureshosted":
"features"):"map service"===t||"wms"===t||"wmts"===t?(G=w.includes("Spatiotemporal"),z=w.includes("Relational"),t=G||z?"mapimages":C||w.includes("Tiled")||"wmts"===t?"maptiles":"mapimages"):t="scene service"===t?w.includes("Line")?"sceneweblayerline":w.includes("3DObject")?"sceneweblayermultipatch":w.includes("Point")?"sceneweblayerpoint":w.includes("IntegratedMesh")?"sceneweblayermesh":w.includes("PointCloud")?"sceneweblayerpointcloud":w.includes("Polygon")?"sceneweblayerpolygon":w.includes("Building")?
"sceneweblayerbuilding":w.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===t?w.includes("Elevation 3D Layer")?"elevationlayer":w.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===t?"streamlayer":"vector tile service"===t?"vectortile":"datastore catalog service"===t?"datastorecollection":"geocoding service"===t?"geocodeservice":"video service"===t?w.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===t?w.includes("Web Tool")?
"tool":"layers":"geodata service"===t?"geodataservice":"3dtiles service"===t?w.includes("3DObject")?"3dobjecttileslayer":w.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t="web map"===t||"cityengine web scene"===t?"maps":"web scene"===t?w.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===t&&w.includes("configurableApp")?"instantapps":"web mapping application"===t||"mobile application"===t||"application"===t||"operation view"===
t||"desktop application"===t?"apps":"map document"===t||"map package"===t||"published map"===t||"scene document"===t||"globe document"===t||"basemap package"===t||"mobile basemap package"===t||"mobile map package"===t||"project package"===t||"project template"===t||"pro map"===t||"layout"===t||"layer"===t&&w.includes("ArcGIS Pro")||"explorer map"===t&&w.indexOf("Explorer Document")?"mapsgray":"service definition"===t||"csv"===t||"shapefile"===t||"cad drawing"===t||"geojson"===t||"netcdf"===t||"administrative report"===
t?"datafiles":"360 vr experience"===t?"360vr":"explorer add in"===t||"desktop add in"===t||"windows viewer add in"===t||"windows viewer configuration"===t?"appsgray":"arcgis pro add in"===t||"arcgis pro configuration"===t?"addindesktop":"rule package"===t||"file geodatabase"===t||"sqlite geodatabase"===t||"csv collection"===t||"kml collection"===t||"windows mobile package"===t||"map template"===t||"desktop application template"===t||"gml"===t||"arcpad package"===t||"code sample"===t||"document link"===
t||"earth configuration"===t||"operations dashboard add in"===t||"rules package"===t||"image"===t||"workflow manager package"===t||"explorer map"===t&&w.includes("Explorer Mapping Application")||w.includes("Document")?"datafilesgray":"network analysis service"===t||"geoprocessing service"===t||"geodata service"===t||"geometry service"===t||"geoprocessing package"===t||"locator package"===t||"geoprocessing sample"===t||"workflow manager service"===t?"toolsgray":"layer"===t||"layer package"===t||"explorer layer"===
t?"layersgray":"scene package"===t?"scenepackage":"3dtiles package"===t?"3dtileslayerpackage":"3dtiles service"===t?"3dtileslayer":"mobile scene package"===t?"mobilescenepackage":"tile package"===t||"compact tile package"===t?"tilepackage":"task file"===t?"taskfile":"report template"===t?"report-template":"statistical data collection"===t?"statisticaldatacollection":"insights workbook"===t?"workbook":"insights model"===t?"insightsmodel":"insights page"===t?"insightspage":"insights theme"===t?"insightstheme":
"hub initiative"===t?"hubinitiative":"hub page"===t?"hubpage":"hub site application"===t?"hubsite":"hub event"===t?"hubevent":"hub project"===t?"hubproject":"relational database connection"===t?"relationaldatabaseconnection":"big data file share"===t?"datastorecollection":"image collection"===t?"imagecollection":"desktop style"===t?"desktopstyle":"style"===t?"style":"dashboard"===t?"dashboard":"raster function template"===t?"rasterprocessingtemplate":"vector tile package"===t?"vectortilepackage":
"ortho mapping project"===t?"orthomappingproject":"ortho mapping template"===t?"orthomappingtemplate":"solution"===t?"solutions":"geopackage"===t?"geopackage":"deep learning package"===t?"deeplearningpackage":"real time analytic"===t?"realtimeanalytics":"big data analytic"===t?"bigdataanalytics":"feed"===t?"feed":"excalibur imagery project"===t?"excaliburimageryproject":"notebook"===t?"notebook":"storymap"===t?"storymap":"survey123 add in"===t?"survey123addin":"mission"===t?"mission":"mission report"===
t?"missionreport":"mission template"===t?"missiontemplate":"quickcapture project"===t?"quickcaptureproject":"pro report"===t?"proreport":"pro report template"===t?"proreporttemplate":"urban model"===t?"urbanmodel":"web experience"===t?"experiencebuilder":"web experience template"===t?"webexperiencetemplate":"experience builder widget"===t?"experiencebuilderwidget":"experience builder widget package"===t?"experiencebuilderwidgetpackage":"workflow"===t?"workflow":"kernel gateway connection"===t?"kernelgatewayconnection":
"insights script"===t?"insightsscript":"hub initiative template"===t?"hubinitiativetemplate":"storymap theme"===t?"storymaptheme":"knowledge graph"===t?"knowledgegraph":"knowledge studio project"===t?"knowledgestudio":"native application"===t?"nativeapp":"native application installer"===t?"nativeappinstaller":"link chart"===t?"linkchart":"investigation"===t?"investigation":"ogcfeatureserver"===t?"features":"pro project"===t?"proproject":"insights workbook package"===t?"insightsworkbookpackage":"apache parquet"===
t?"apacheparquet":"notebook code snippets"===t||"notebook code snippet library"===t?"notebookcodesnippets":"suitability model"===t?"suitabilitymodel":"esri classifier definition"===t?"classifierdefinition":"esri classification schema"===t?"classificationschema":"insights data engineering workbook"===t?"dataengineeringworkbook":"insights data engineering model"===t?"dataengineeringmodel":"deep learning studio project"===t?"deeplearningproject":"discussion"===t?"discussion":"allsource project"===t?
"allsourceproject":"api key"===t?"apikey":"data pipeline"===t?"datapipelines":"group layer"===t?(C=w.includes("Map"))?"layergroup2d":"layergroup":"media layer"===t?"onlinemedialayer":"form"===t?w.includes("Survey123")?"survey":"datafilesgray":"maps";return t?r.getAssetUrl("esri/images/portal/"+t+"16.png"):null}get isLayer(){return null!=this.type&&y.has(this.type)}get itemCdnUrl(){return u.toCDNUrl(this.itemUrl)}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:
null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,w=this.thumbnail;return t&&w?this.portal?.normalizeUrl(`${t}/info/${w}?f=json`)??null:null}get userItemUrl(){const t=this.portal?.restUrl;if(!t)return null;const w=this.owner||this.portal?.user?.username;return w?`${t}/content/users/${this.ownerFolder?`${w}/${this.ownerFolder}`:w}/items/${this.id}`:null}load(t){const w=this.portal??(this.portal=n.getDefault()),
C=w.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?w.request(this.itemUrl,{signal:null!=t?t.signal:null,query:{token:this.apiKey}}):{}).then(z=>{this.sourceJSON=z;this.read(z)});this.addResolvingPromise(C);return Promise.resolve(this)}async addRating(t){const w={method:"post",query:{}};t instanceof h&&(t=t.rating);null==t||isNaN(t)||"number"!==typeof t||(w.query.rating=t);if(!this.portal)return null;await this.portal.request(this.itemUrl+"/addRating",w);return new h({rating:t,
created:new Date})}clone(){var t={access:this.access,accessInformation:this.accessInformation,applicationProxies:m.clone(this.applicationProxies),avgRating:this.avgRating,categories:m.clone(this.categories),created:m.clone(this.created),culture:this.culture,description:this.description,extent:m.clone(this.extent),groupCategories:m.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:m.clone(this.modified),name:this.name,numComments:this.numComments,
numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:m.clone(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");t=(new v({sourceJSON:this.sourceJSON})).set(t);t._set("isOrgItem",this.isOrgItem);
return t}createPostQuery(){const t=this.toJSON();for(var w of["tags","typeKeywords","categories"])t[w]=t[w]?.join(", ");({extent:w}=t);w&&(t.extent=JSON.stringify(w));return t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",w){return this.portal.request(this.itemUrl+"/data",{responseType:t,...w,query:{token:this.apiKey}})}async fetchRating(t){t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return null!=
t.rating?(t.created=new Date(t.created),new h(t)):null}fetchRelatedItems(t,w){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...w},v)}getThumbnailUrl(t){let w=this.thumbnailUrl;w&&t&&(w+=`&w=${t}`);return w}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>{this.sourceJSON=t;this.read(t);return this})}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const w=t?.data,
C={method:"post"};C.query=this.createPostQuery();for(const z in C.query)null===C.query[z]&&(C.query[z]="");C.query.clearEmptyFields=!0;null!=w&&("string"===typeof w?C.query.text=w:"object"===typeof w&&(C.query.text=JSON.stringify(w)));return this.portal.request(`${this.userItemUrl}/update`,C).then(()=>this.reload())}):Promise.reject(new k("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new k("portal:item-does-not-exist","The item does not exist yet");
await this.load();const {portal:w,itemUrl:C}=this;await w.signIn();const {copyResources:z,folder:D,tags:H,title:G}=t||{};t={method:"post",query:{copyPrivateResources:"all"===z,folder:"string"===typeof D?D:D?.id,includeResources:!!z,tags:H?.join(","),title:G}};({itemId:t}=await w.request(`${C}/copy`,t));return new v({id:t,portal:w})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const w=t.thumbnail,C=t.filename,z={method:"post"};if("string"===typeof w)c.isDataProtocol(w)?
z.query={data:w}:z.query={url:c.makeAbsolute(w)},null!=C&&(z.query.filename=C);else{const D=new FormData;null!=C?D.append("file",w,C):D.append("file",w);z.body=D}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,z).then(()=>this.reload())}):Promise.reject(new k("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},w){const {fetchResources:C}=await new Promise((z,D)=>a(["./support/resourceUtils"],z,D));return C(this,t,w)}async addResource(t,
w,C){const {addOrUpdateResources:z}=await new Promise((D,H)=>a(["./support/resourceUtils"],D,H));t.portalItem=this;await z(this,[{resource:t,content:w,compress:C?.compress,access:C?.access}],"add",C);return t}async removeResource(t,w){const {removeResource:C}=await new Promise((z,D)=>a(["./support/resourceUtils"],z,D));if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new k("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");
return C(this,t,w)}async removeAllResources(t){const {removeAllResources:w}=await new Promise((C,z)=>a(["./support/resourceUtils"],C,z));return w(this,t)}resourceFromPath(t){return new e({portalItem:this,path:t})}toJSON(){var t=this.extent;t={accessInformation:this.accessInformation,categories:m.clone(this.categories),created:this.created?.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),
name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};return m.fixJson(t)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw Error("JSON object is already hydrated");return new v({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const w in t)"tags"===w&&null!==
t[w]&&(t[w]=t[w].join(", ")),"typeKeywords"===w&&null!==t[w]&&(t[w]=t[w].join(", ")),"extent"===w&&t[w]&&(t[w]=JSON.stringify(t[w]));return t}};q.__decorate([d.property({type:["private","shared","org","public"]})],l.prototype,"access",void 0);q.__decorate([d.property()],l.prototype,"accessInformation",void 0);q.__decorate([d.property({type:String})],l.prototype,"apiKey",void 0);q.__decorate([d.property({json:{read:{source:"appProxies"}}})],l.prototype,"applicationProxies",void 0);q.__decorate([d.property()],
l.prototype,"avgRating",void 0);q.__decorate([d.property()],l.prototype,"categories",void 0);q.__decorate([d.property({type:Date})],l.prototype,"created",void 0);q.__decorate([d.property()],l.prototype,"culture",void 0);q.__decorate([d.property()],l.prototype,"description",void 0);q.__decorate([d.property({readOnly:!0})],l.prototype,"displayName",null);q.__decorate([d.property({type:x})],l.prototype,"extent",void 0);q.__decorate([p.reader("extent")],l.prototype,"readExtent",null);q.__decorate([d.property()],
l.prototype,"groupCategories",void 0);q.__decorate([d.property({readOnly:!0})],l.prototype,"iconUrl",null);q.__decorate([d.property()],l.prototype,"id",void 0);q.__decorate([d.property({readOnly:!0})],l.prototype,"isLayer",null);q.__decorate([d.property({type:Boolean,readOnly:!0})],l.prototype,"isOrgItem",void 0);q.__decorate([d.property()],l.prototype,"itemControl",void 0);q.__decorate([d.property({readOnly:!0})],l.prototype,"itemPageUrl",null);q.__decorate([d.property({readOnly:!0})],l.prototype,
"itemUrl",null);q.__decorate([d.property()],l.prototype,"licenseInfo",void 0);q.__decorate([d.property({type:Date})],l.prototype,"modified",void 0);q.__decorate([d.property()],l.prototype,"name",void 0);q.__decorate([d.property()],l.prototype,"numComments",void 0);q.__decorate([d.property()],l.prototype,"numRatings",void 0);q.__decorate([d.property()],l.prototype,"numViews",void 0);q.__decorate([d.property()],l.prototype,"owner",void 0);q.__decorate([d.property()],l.prototype,"ownerFolder",void 0);
q.__decorate([d.property({type:n})],l.prototype,"portal",void 0);q.__decorate([d.property()],l.prototype,"screenshots",void 0);q.__decorate([d.property()],l.prototype,"size",void 0);q.__decorate([d.property()],l.prototype,"snippet",void 0);q.__decorate([d.property()],l.prototype,"sourceJSON",void 0);q.__decorate([d.property({type:String})],l.prototype,"sourceUrl",void 0);q.__decorate([d.property({type:String})],l.prototype,"spatialReference",void 0);q.__decorate([d.property()],l.prototype,"tags",
void 0);q.__decorate([d.property()],l.prototype,"thumbnail",void 0);q.__decorate([d.property({readOnly:!0})],l.prototype,"thumbnailUrl",null);q.__decorate([d.property()],l.prototype,"title",void 0);q.__decorate([d.property()],l.prototype,"type",void 0);q.__decorate([d.property()],l.prototype,"typeKeywords",void 0);q.__decorate([d.property({type:String,json:{read(t,w){B.has(w.type)&&(w=this.portal?.restUrl,t||=w&&this.id?`${w}/content/items/${this.id}/data`:null);return t}}})],l.prototype,"url",void 0);
q.__decorate([d.property({readOnly:!0})],l.prototype,"userItemUrl",null);return l=v=q.__decorate([g.subclass("esri.portal.PortalItem")],l)})},"esri/portal/PortalItemResource":function(){define("require ../chunks/tslib.es6 ../core/Accessor ../core/Error ../core/Logger ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c,d,f,p){r=class extends r{constructor(g){super(g);
this.portalItem=null}normalizeCtorArgs(g){return g?.portalItem&&g.path?{...g,path:this._normalizePath(g.path,g.portalItem)}:g}set path(g){null!=g&&m.isAbsolute(g)?l.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",g)}_castPath(g){return this._normalizePath(g,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:
null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(g="json",x){const n=this.cdnUrl;if(null==n)throw new k("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(n,{responseType:g,query:{token:this.portalItem.apiKey},signal:x?.signal})}async update(g,x){const {addOrUpdateResources:n}=await new Promise((e,h)=>a(["./support/resourceUtils"],e,h));await n(this.portalItem,[{resource:this,
content:g,compress:x?.compress,access:x?.access}],"update",x);return this}hasPath(){return null!=this.path}_normalizePath(g,x){if(null==g)return g;g=g.replace(/^\/+/,"");null!=x&&m.isAbsolute(g)&&(g=m.makeRelative(g,x.itemUrl));return g?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,"")}};q.__decorate([b.property()],r.prototype,"portalItem",void 0);q.__decorate([b.property({type:String,value:null})],r.prototype,"path",null);q.__decorate([c.cast("path")],r.prototype,"_castPath",null);q.__decorate([b.property({type:String,
readOnly:!0})],r.prototype,"url",null);q.__decorate([b.property({type:String,readOnly:!0})],r.prototype,"cdnUrl",null);q.__decorate([b.property({type:String,readOnly:!0})],r.prototype,"itemRelativeUrl",null);return r=q.__decorate([p.subclass("esri.portal.PortalItemResource")],r)})},"esri/portal/PortalRating":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b){q=class extends q{constructor(c){super(c);this.rating=this.created=null}};a.__decorate([r.property()],q.prototype,"created",void 0);a.__decorate([r.property()],q.prototype,"rating",void 0);return q=a.__decorate([b.subclass("esri.portal.PortalRating")],q)})},"esri/chunks/persistableUrlUtils":function(){define(["exports","../kernel","../core/urlUtils"],function(a,q,r){function k(u,v){var y=v?.url?.path;u&&y&&(u=r.makeAbsolute(u,y,{preserveProtocolRelative:!0}),v.portalItem&&
v.readResourcePaths&&(y=r.makeRelative(u,v.portalItem.itemUrl),null!=y&&e.test(y)&&v.readResourcePaths.push(v.portalItem.resourceFromPath(y).path)));return(u=p(u,v?.portal))&&n.test(u)?g(u):u}function l(u,v,y=a.MarkKeep.YES){u=u&&n.test(u)?x(u):u;if(null==u)return u;!r.isAbsolute(u)&&v?.blockedRelativeUrls&&v.blockedRelativeUrls.push(u);let B=r.makeAbsolute(u);if(v){var t=v.verifyItemRelativeUrls?.rootPath||v.url?.path;if(t){t=p(t,v.portal);const w=p(B,v.portal);B=r.makeRelative(w,t,t);null!=B&&B!==
w&&B!==u&&v.verifyItemRelativeUrls&&v.verifyItemRelativeUrls.writtenUrls.push(B)}}B=f(B,v?.portal);r.isAbsolute(B)&&(B=r.normalize(B));v?.resources&&v?.portalItem&&!r.isAbsolute(B)&&!r.isDataProtocol(B)&&y===a.MarkKeep.YES&&v.resources.toKeep.push({resource:v.portalItem.resourceFromPath(B),compress:!1});return B}function m(u,v,y){return k(u,y)}function b(u,v,y,B){u=l(u,B);void 0!==u&&(v[y]=u)}function c(u){return(u?.match(n)??null)?.[1]??null}function d(u){u=u?.match(n)??null;if(null==u)return null;
u=u[2];const v=u.lastIndexOf("/");if(-1===v){const {path:t,extension:w}=r.splitPathExtension(u);return{prefix:null,filename:t,extension:w}}const {path:y,extension:B}=r.splitPathExtension(u.slice(v+1));return{prefix:u.slice(0,v),filename:y,extension:B}}function f(u,v){return v&&!v.isPortal&&v.urlKey&&v.customBaseUrl?r.changeDomain(u,`${v.urlKey}.${v.customBaseUrl}`,v.portalHostname):u}function p(u,v){if(!v||v.isPortal||!v.urlKey||!v.customBaseUrl)return u;const y=`${v.urlKey}.${v.customBaseUrl}`,B=
r.getAppUrl();return r.hasSameOrigin(B,`${B.scheme}://${y}`)?r.changeDomain(u,v.portalHostname,y):r.changeDomain(u,y,v.portalHostname)}function g(u){if(!u)return u||null;u&&q.id&&!q.id.findCredential(u)&&(u=q.id._normalizeAGOLorgDomain(u),u=u.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),u=u.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),u=u.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com"));return u}function x(u){if(!u)return u||null;
u=u.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com");u=u.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com");(u=u.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"))&&q.id&&!q.id.findCredential(u)&&(u=q.id._normalizeAGOLorgDomain(u));return u}const n=/\/items\/([^\/]+)\/resources\/(.*)/,e=/^\.\/resources\//;a.MarkKeep=void 0;(function(u){u[u.YES=0]="YES";u[u.NO=1]="NO"})(a.MarkKeep||(a.MarkKeep={}));const h=Object.freeze(Object.defineProperty({__proto__:null,
get MarkKeep(){return a.MarkKeep},ensureMainOnlineDomain:f,fromCDNUrl:x,fromJSON:k,itemIdFromResourceUrl:c,prefixAndFilenameFromResourceUrl:d,read:m,toCDNUrl:g,toJSON:l,write:b},Symbol.toStringTag,{value:"Module"}));a.ensureMainOnlineDomain=f;a.fromCDNUrl=x;a.fromJSON=k;a.itemIdFromResourceUrl=c;a.persistableUrlUtils=h;a.prefixAndFilenameFromResourceUrl=d;a.read=m;a.toCDNUrl=g;a.toJSON=l;a.write=b})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(a,
q,r){a.esriBasemapDefinitions={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",
url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/terrain.jpg")},
baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",
isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get "dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},
baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],
id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-vector.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},
"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",
styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",
layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,
visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",
url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,
opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",
itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},
{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",
title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},
"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",
layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",
baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",
title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",
title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",
title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},
"arcgis-topographic":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},
title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",
title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},
"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},
"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",
title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",
title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",
showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",
title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",
title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};a.getBasemapTitle=async function(k){if(k){var l=k.includes("-vector")?k.slice(0,k.indexOf("-vector")):
k.includes("-3d")?k.slice(0,k.indexOf("-3d")):k,m=await r.fetchMessageBundle("esri/t9n/basemaps");return m[k]||m[l]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/BasemapStyle":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../intl/locale".split(" "),function(a,q,r,k,l,m,b,c){const d=new Set("ar bs ca hr cs da nl en et fi fr de el he hu id it ja ko lv lt nb pl ro ru sr es sv th tr uk vi".split(" "));
q=class extends q{constructor(f){super(f);this.places=this.language=this.id=null;this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps";this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;var f=c.getLocale().toLowerCase();switch(f){case "pt-br":return"pt-BR";case "pt-pt":return"pt-PT";case "zh-cn":return"zh-CN";case "zh-hk":return"zh-HK";case "zh-tw":return"zh-TW"}f=c.getLanguage(f);return"pt"===f?"pt-BR":f&&d.has(f)?f:"global"}};
a.__decorate([r.property()],q.prototype,"id",void 0);a.__decorate([r.property()],q.prototype,"language",void 0);a.__decorate([r.property()],q.prototype,"places",void 0);a.__decorate([r.property()],q.prototype,"serviceUrl",void 0);a.__decorate([r.property()],q.prototype,"worldview",void 0);return q=a.__decorate([b.subclass("esri.support.BasemapStyle")],q)})},"esri/webdoc/support/writeUtils":function(){define("exports ../../core/Error ../../core/lang ../../core/object ../../core/accessorSupport/extensions/serializableProperty/writer ../../layers/support/layerUtils".split(" "),
function(a,q,r,k,l,m){function b(f,p){"maxScale"in f&&(p.maxScale=l.numberToJSON(f.maxScale)??void 0);"minScale"in f&&(p.minScale=l.numberToJSON(f.minScale)??void 0)}const c=new Set("bing-maps imagery imagery-tile map-image open-street-map tile unknown unsupported vector-tile web-tile wms wmts".split(" ")),d=new Set("csv feature geo-rss geojson group imagery imagery-tile kml map-image map-notes media ogc-feature oriented-imagery route stream subtype-group tile unknown unsupported vector-tile web-tile wfs wms wmts".split(" "));
a.disableRestrictedWriting=function(f){c.add(f);d.add(f)};a.enableRestrictedWriting=function(f){c.delete(f);d.delete(f)};a.getLayerJSON=function(f,p,g){if(!f.persistenceEnabled)return null;if(!("write"in f&&f.write))return g?.messages&&g.messages.push(new q("layer:unsupported",`Layers (${f.title}, ${f.id}) of type '${f.declaredClass}' cannot be persisted`,{layer:f})),null;if(m.isFeatureCollectionLayer(f)&&!f.isTable)p=f.resourceInfo;else{if(g.restrictedWebMapWriting){var x="basemap"===g.layerContainerType?
c:"operational-layers"===g.layerContainerType?d:null;x=null!=x?x.has(f.type)&&!m.isFeatureCollectionLayer(f):!0}else x=!0;if(x)return p={},f.write(p,g)?p:null}if(null!=p){p=r.clone(p);if(g=p)m.isFeatureCollectionLayer(f)?(x=k.getDeepValue("featureCollection.layers",g)?.[0]?.layerDefinition)&&b(f,x):"group"!==f.type&&b(f,g);if(g&&(g.id=f.id,"blendMode"in f&&(g.blendMode=f.blendMode,"normal"===g.blendMode&&delete g.blendMode),g.opacity=l.numberToJSON(f.opacity)??void 0,g.title=f.title||"Layer",g.visibility=
f.visible,"legendEnabled"in f&&"wmts"!==f.type))if(m.isFeatureCollectionLayer(f)){if(g=g.featureCollection)g.showLegend=f.legendEnabled}else g.showLegend=f.legendEnabled}return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request"],function(a,q,r){function k(m){return"scene"===m?.type}function l(m){m=m?.type;return"imagery-tile"===m||"tile"===m||"open-street-map"===m||"vector-tile"===m||"web-tile"===
m||"wmts"===m}a.getEffectiveEditingEnabled=function(m){a:if("editingEnabled"in m)switch(m.type){case "csv":case "feature":case "geojson":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":var b=!0;break a;default:b=!1}else b=!1;return b?"effectiveEditingEnabled"in m?m.effectiveEditingEnabled:m.editingEnabled:!1};a.getEffectiveLayerCapabilities=function(m){a:if("capabilities"in m)switch(m.type){case "catalog":case "csv":case "feature":case "geojson":case "imagery":case "knowledge-graph-sublayer":case "ogc-feature":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":case "wfs":var b=
!0;break a;default:b=!1}else b=!1;return b?"effectiveCapabilities"in m?m.effectiveCapabilities:m.capabilities:null};a.getOwningPortalUrl=async function(m,b){var c=q.id?.findServerInfo(m);if(null!=c?.currentVersion)return c.owningSystemUrl||null;c=m.toLowerCase().indexOf("/rest/services");if(-1===c)return null;m=`${m.substring(0,c)}/rest/info`;({data:b}=await r(m,{query:{f:"json"},responseType:"json",signal:null!=b?b.signal:null}));return b?.owningSystemUrl||null};a.getTileMaxtrixSetFromActiveLayer=
function(m){if(m.activeLayer){const b=m.activeLayer.tileMatrixSet;if(b)return b;if(m=m.activeLayer.tileMatrixSets)return m}return null};a.isBaseLayer=function(m){return null!=m?.parent&&"declaredClass"in m.parent&&"esri.Basemap"===m.parent.declaredClass&&m.parent.baseLayers.includes(m)};a.isBasemap3DSupportedLayer=function(m){return l(m)||k(m)};a.isBasemapSupportedTiledLayer=l;a.isFeatureCollectionLayer=function(m){return"feature"===m?.type&&!m.url&&"memory"===m.source?.type};a.isFeatureLayer=function(m){return null!=
m&&"object"===typeof m&&"type"in m&&"feature"===m.type};a.isFeatureServiceLayer=function(m){return"feature"===m?.type&&"feature-layer"===m.source?.type};a.isGraphicsLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"graphics"===m.type};a.isGroupLayer=function(m){return null!=m&&"type"in m&&"group"===m.type};a.isImageryTileLayer=function(m){return"imagery-tile"===m?.type};a.isIntegratedMeshLayer=function(m){return"integrated-mesh"===m||"integrated-mesh-3dtiles"===m};a.isIntegratedMeshOperationalLayer=
function(m){return"IntegratedMeshLayer"===m||"IntegratedMesh3DTilesLayer"===m};a.isKnowledgeGraphLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"knowledge-graph"===m.type&&"layers"in m};a.isLayerWithFeatureLayerSource=function(m){return("feature"===m?.type||"subtype-group"===m?.type)&&"feature-layer"===m.source?.type};a.isLinkChartLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"link-chart"===m.type&&"layers"in m};a.isMapNotesLayer=function(m){return null!=m&&
"object"===typeof m&&"type"in m&&"map-notes"===m.type&&"sublayers"in m};a.isSceneLayer=k;a.isSceneServiceLayer=function(m){m=m?.type;return"building-scene"===m||"integrated-mesh"===m||"point-cloud"===m||"scene"===m};a.isSubtypeGroupLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"subtype-group"===m.type&&"sublayers"in m};a.isTable=function(m){return null!=m&&"object"===typeof m&&"isTable"in m&&!!m.isTable};a.isTiledLayer=function(m){m=m?.type;return"base-tile"===m||"tile"===m||
"elevation"===m||"imagery-tile"===m||"base-elevation"===m||"open-street-map"===m||"wcs"===m||"web-tile"===m||"wmts"===m||"vector-tile"===m};a.isVoxelLayer=function(m){return"voxel"===m?.type};a.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};a.serializeLayerDefinitions=function(m){const b=/[:;]/,c=[];let d=!1;if(m&&(m.forEach((f,p)=>{c.push([p,f]);!d&&b.test(f)&&(d=!0)}),0<
c.length)){if(d){const f={};c.forEach(p=>{f[p[0]]=p[1]});m=JSON.stringify(f)}else{const f=[];c.forEach(p=>{f.push(p[0]+":"+p[1])});m=f.join(";")}return m}return null};a.serializeTimeOptions=function(m){if(m){var b=[];m.forEach((c,d)=>{b.push('"'+d+'":'+JSON.stringify(c))});if(b.length)return"{"+b.join(",")+"}"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(a,q){a.canInterpolateEffects=function(r,k){const l=
r.length>k.length?r:k;return(r.length>k.length?k:r).every((m,b)=>m.type===l[b].type)};a.effectEquals=function(r,k){r=JSON.stringify(r??null);k=JSON.stringify(k??null);return r===k};a.isEffectFunctions=function(r){return(r=r[0])?"type"in r:!1};a.normalizeEffects=function(r,k){const l=r.length>k.length?r:k;r=r.length>k.length?k:r;for(k=r.length;k<l.length;k++)r.push(q.createEffectWithInitialValues(l[k]))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports",
"../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(a,q,r,k,l){function m(n,e,h){return n+(e-n)*h}function b(n){return Math.round(1E3*r.px2pt(n))/1E3}class c{constructor(n,e,h){this.strength=n;this.radius=e;this.threshold=h;this.type="bloom"}interpolate(n,e,h){this.strength=m(n.strength,e.strength,h);this.radius=m(n.radius,e.radius,h);this.threshold=m(n.threshold,e.threshold,h)}clone(){return new c(this.strength,this.radius,
this.threshold)}toJSON(){return{type:"bloom",radius:b(this.radius),strength:this.strength,threshold:this.threshold}}}class d{constructor(n){this.radius=n;this.type="blur"}interpolate(n,e,h){this.radius=Math.round(m(n.radius,e.radius,h))}clone(){return new d(this.radius)}toJSON(){return{type:"blur",radius:b(this.radius)}}}class f{constructor(n,e){this.type=n;this.amount=e;if("invert"===this.type||"grayscale"===this.type||"sepia"===this.type)this.amount=Math.min(this.amount,1)}get colorMatrix(){this._colorMatrix||
this._updateMatrix();return this._colorMatrix}interpolate(n,e,h){this.amount=m(n.amount,e.amount,h);this._updateMatrix()}clone(){return new f(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const n=this._colorMatrix||k.create();switch(this.type){case "brightness":this._colorMatrix=l.brightness(n,this.amount);break;case "contrast":this._colorMatrix=l.contrast(n,this.amount);break;case "grayscale":this._colorMatrix=l.grayscale(n,this.amount);break;case "invert":this._colorMatrix=
l.invert(n,this.amount);break;case "saturate":this._colorMatrix=l.saturate(n,this.amount);break;case "sepia":this._colorMatrix=l.sepia(n,this.amount)}}}class p{constructor(n,e,h,u){this.offsetX=n;this.offsetY=e;this.blurRadius=h;this.color=u;this.type="drop-shadow"}interpolate(n,e,h){this.offsetX=m(n.offsetX,e.offsetX,h);this.offsetY=m(n.offsetY,e.offsetY,h);this.blurRadius=m(n.blurRadius,e.blurRadius,h);this.color[0]=Math.round(m(n.color[0],e.color[0],h));this.color[1]=Math.round(m(n.color[1],e.color[1],
h));this.color[2]=Math.round(m(n.color[2],e.color[2],h));this.color[3]=m(n.color[3],e.color[3],h)}clone(){return new p(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const n=[...this.color];n[3]*=255;return{type:"drop-shadow",xoffset:b(this.offsetX),yoffset:b(this.offsetY),blurRadius:b(this.blurRadius),color:n}}}class g{constructor(n){this.angle=n;this.type="hue-rotate"}get colorMatrix(){this._colorMatrix||this._updateMatrix();return this._colorMatrix}interpolate(n,e,h){this.angle=
m(n.angle,e.angle,h);this._updateMatrix()}clone(){return new g(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const n=this._colorMatrix||k.create();this._colorMatrix=l.rotateHue(n,this.angle)}}class x{constructor(n){this.amount=n;this.type="opacity";this.amount=Math.min(this.amount,1)}interpolate(n,e,h){this.amount=m(n.amount,e.amount,h)}clone(){return new x(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}a.BloomEffect=c;a.BlurEffect=d;a.ColorMatrixEffect=
f;a.DropShadowEffect=p;a.HueRotateEffect=g;a.OpacityEffect=x;a.createEffectWithInitialValues=function(n){switch(n.type){case "grayscale":case "sepia":case "invert":return new f(n.type,0);case "saturate":case "brightness":case "contrast":return new f(n.type,1);case "opacity":return new x(1);case "hue-rotate":return new g(0);case "blur":return new d(0);case "drop-shadow":return new p(0,0,0,[...q.getNamedColor("transparent")]);case "bloom":return new c(0,0,1)}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(a){function q(){const c=new Float32Array(16);c[0]=1;c[5]=1;c[10]=1;c[15]=1;return c}function r(c){const d=new Float32Array(16);d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[3];d[4]=c[4];d[5]=c[5];d[6]=c[6];d[7]=c[7];d[8]=c[8];d[9]=c[9];d[10]=c[10];d[11]=c[11];d[12]=c[12];d[13]=c[13];d[14]=c[14];d[15]=c[15];return d}function k(c,d,f,p,g,x,n,e,h,u,v,y,B,t,w,C){const z=new Float32Array(16);z[0]=c;z[1]=d;
z[2]=f;z[3]=p;z[4]=g;z[5]=x;z[6]=n;z[7]=e;z[8]=h;z[9]=u;z[10]=v;z[11]=y;z[12]=B;z[13]=t;z[14]=w;z[15]=C;return z}function l(c,d){return new Float32Array(c,d,16)}const m=q(),b=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:r,create:q,createView:l,fromValues:k},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=r;a.create=q;a.createView=l;a.fromValues=k;a.mat4f32=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports",
"../../core/libs/gl-matrix-2/math/mat4"],function(a,q){a.brightness=(r,k)=>{r=q.set(r,k,0,0,0,0,k,0,0,0,0,k,0,0,0,0,1);return q.transpose(r,r)};a.contrast=(r,k)=>{r=q.set(r,k,0,0,.5-.5*k,0,k,0,.5-.5*k,0,0,k,.5-.5*k,0,0,0,1);return q.transpose(r,r)};a.grayscale=(r,k)=>{k=1-k;r=q.set(r,.2126+.7874*k,.7152-.7152*k,.0722-.0722*k,0,.2126-.2126*k,.7152+.2848*k,.0722-.0722*k,0,.2126-.2126*k,.7152-.7152*k,.0722+.9278*k,0,0,0,0,1);return q.transpose(r,r)};a.invert=(r,k)=>{const l=1-2*k;r=q.set(r,l,0,0,k,0,
l,0,k,0,0,l,k,0,0,0,1);return q.transpose(r,r)};a.rotateHue=(r,k)=>{const l=Math.sin(k*Math.PI/180);k=Math.cos(k*Math.PI/180);r=q.set(r,.213+.787*k-.213*l,.715-.715*k-.715*l,.072-.072*k+.928*l,0,.213-.213*k+.143*l,.715+.285*k+.14*l,.072-.072*k-.283*l,0,.213-.213*k-.787*l,.715-.715*k+.715*l,.072+.928*k+.072*l,0,0,0,0,1);return q.transpose(r,r)};a.saturate=(r,k)=>{r=q.set(r,.213+.787*k,.715-.715*k,.072-.072*k,0,.213-.213*k,.715+.285*k,.072-.072*k,0,.213-.213*k,.715-.715*k,.072+.928*k,0,0,0,0,1);return q.transpose(r,
r)};a.sepia=(r,k)=>{k=1-k;r=q.set(r,.393+.607*k,.769-.769*k,.189-.189*k,0,.349-.349*k,.686+.314*k,.168-.168*k,0,.272-.272*k,.534-.534*k,.131+.869*k,0,0,0,0,1);return q.transpose(r,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(a,q,r){function k(L,R){L[0]=R[0];L[1]=R[1];L[2]=R[2];L[3]=R[3];L[4]=R[4];L[5]=R[5];L[6]=R[6];L[7]=R[7];L[8]=R[8];L[9]=R[9];L[10]=R[10];L[11]=
R[11];L[12]=R[12];L[13]=R[13];L[14]=R[14];L[15]=R[15];return L}function l(L,R,fa,ka,qa,Q,V,W,ha,la,N,aa,ja,oa,ua,za,Aa){L[0]=R;L[1]=fa;L[2]=ka;L[3]=qa;L[4]=Q;L[5]=V;L[6]=W;L[7]=ha;L[8]=la;L[9]=N;L[10]=aa;L[11]=ja;L[12]=oa;L[13]=ua;L[14]=za;L[15]=Aa;return L}function m(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function b(L,R){if(L===R){const fa=R[1],ka=R[2],qa=R[3],Q=R[6],V=R[7],W=R[11];L[1]=R[4];L[2]=R[8];L[3]=
R[12];L[4]=fa;L[6]=R[9];L[7]=R[13];L[8]=ka;L[9]=Q;L[11]=R[14];L[12]=qa;L[13]=V;L[14]=W}else L[0]=R[0],L[1]=R[4],L[2]=R[8],L[3]=R[12],L[4]=R[1],L[5]=R[5],L[6]=R[9],L[7]=R[13],L[8]=R[2],L[9]=R[6],L[10]=R[10],L[11]=R[14],L[12]=R[3],L[13]=R[7],L[14]=R[11],L[15]=R[15];return L}function c(L,R){d(L,R)||m(L);return L}function d(L,R){const fa=R[0],ka=R[1],qa=R[2],Q=R[3],V=R[4],W=R[5],ha=R[6],la=R[7],N=R[8],aa=R[9],ja=R[10],oa=R[11],ua=R[12],za=R[13],Aa=R[14];R=R[15];const Ga=fa*W-ka*V,Da=fa*ha-qa*V,Ha=fa*
la-Q*V,Fa=ka*ha-qa*W,Ea=ka*la-Q*W,Ka=qa*la-Q*ha,Sa=N*za-aa*ua,Xa=N*Aa-ja*ua,Ra=N*R-oa*ua,Ma=aa*Aa-ja*za,Pa=aa*R-oa*za,sa=ja*R-oa*Aa;let Qa=Ga*sa-Da*Pa+Ha*Ma+Fa*Ra-Ea*Xa+Ka*Sa;if(!Qa)return null;Qa=1/Qa;L[0]=(W*sa-ha*Pa+la*Ma)*Qa;L[1]=(qa*Pa-ka*sa-Q*Ma)*Qa;L[2]=(za*Ka-Aa*Ea+R*Fa)*Qa;L[3]=(ja*Ea-aa*Ka-oa*Fa)*Qa;L[4]=(ha*Ra-V*sa-la*Xa)*Qa;L[5]=(fa*sa-qa*Ra+Q*Xa)*Qa;L[6]=(Aa*Ha-ua*Ka-R*Da)*Qa;L[7]=(N*Ka-ja*Ha+oa*Da)*Qa;L[8]=(V*Pa-W*Ra+la*Sa)*Qa;L[9]=(ka*Ra-fa*Pa-Q*Sa)*Qa;L[10]=(ua*Ea-za*Ha+R*Ga)*Qa;L[11]=
(aa*Ha-N*Ea-oa*Ga)*Qa;L[12]=(W*Xa-V*Ma-ha*Sa)*Qa;L[13]=(fa*Ma-ka*Xa+qa*Sa)*Qa;L[14]=(za*Da-ua*Fa-Aa*Ga)*Qa;L[15]=(N*Fa-aa*Da+ja*Ga)*Qa;return L}function f(L,R){const fa=R[0],ka=R[1],qa=R[2],Q=R[3],V=R[4],W=R[5],ha=R[6],la=R[7],N=R[8],aa=R[9],ja=R[10],oa=R[11],ua=R[12],za=R[13],Aa=R[14];R=R[15];L[0]=W*(ja*R-oa*Aa)-aa*(ha*R-la*Aa)+za*(ha*oa-la*ja);L[1]=-(ka*(ja*R-oa*Aa)-aa*(qa*R-Q*Aa)+za*(qa*oa-Q*ja));L[2]=ka*(ha*R-la*Aa)-W*(qa*R-Q*Aa)+za*(qa*la-Q*ha);L[3]=-(ka*(ha*oa-la*ja)-W*(qa*oa-Q*ja)+aa*(qa*la-
Q*ha));L[4]=-(V*(ja*R-oa*Aa)-N*(ha*R-la*Aa)+ua*(ha*oa-la*ja));L[5]=fa*(ja*R-oa*Aa)-N*(qa*R-Q*Aa)+ua*(qa*oa-Q*ja);L[6]=-(fa*(ha*R-la*Aa)-V*(qa*R-Q*Aa)+ua*(qa*la-Q*ha));L[7]=fa*(ha*oa-la*ja)-V*(qa*oa-Q*ja)+N*(qa*la-Q*ha);L[8]=V*(aa*R-oa*za)-N*(W*R-la*za)+ua*(W*oa-la*aa);L[9]=-(fa*(aa*R-oa*za)-N*(ka*R-Q*za)+ua*(ka*oa-Q*aa));L[10]=fa*(W*R-la*za)-V*(ka*R-Q*za)+ua*(ka*la-Q*W);L[11]=-(fa*(W*oa-la*aa)-V*(ka*oa-Q*aa)+N*(ka*la-Q*W));L[12]=-(V*(aa*Aa-ja*za)-N*(W*Aa-ha*za)+ua*(W*ja-ha*aa));L[13]=fa*(aa*Aa-ja*
za)-N*(ka*Aa-qa*za)+ua*(ka*ja-qa*aa);L[14]=-(fa*(W*Aa-ha*za)-V*(ka*Aa-qa*za)+ua*(ka*ha-qa*W));L[15]=fa*(W*ja-ha*aa)-V*(ka*ja-qa*aa)+N*(ka*ha-qa*W);return L}function p(L){const R=L[0],fa=L[1],ka=L[2],qa=L[3],Q=L[4],V=L[5],W=L[6],ha=L[7],la=L[8],N=L[9],aa=L[10],ja=L[11],oa=L[12],ua=L[13],za=L[14];L=L[15];return(R*V-fa*Q)*(aa*L-ja*za)-(R*W-ka*Q)*(N*L-ja*ua)+(R*ha-qa*Q)*(N*za-aa*ua)+(fa*W-ka*V)*(la*L-ja*oa)-(fa*ha-qa*V)*(la*za-aa*oa)+(ka*ha-qa*W)*(la*ua-N*oa)}function g(L,R,fa){const ka=R[0],qa=R[1],
Q=R[2],V=R[3],W=R[4],ha=R[5],la=R[6],N=R[7],aa=R[8],ja=R[9],oa=R[10],ua=R[11],za=R[12],Aa=R[13],Ga=R[14];R=R[15];let Da=fa[0],Ha=fa[1],Fa=fa[2],Ea=fa[3];L[0]=Da*ka+Ha*W+Fa*aa+Ea*za;L[1]=Da*qa+Ha*ha+Fa*ja+Ea*Aa;L[2]=Da*Q+Ha*la+Fa*oa+Ea*Ga;L[3]=Da*V+Ha*N+Fa*ua+Ea*R;Da=fa[4];Ha=fa[5];Fa=fa[6];Ea=fa[7];L[4]=Da*ka+Ha*W+Fa*aa+Ea*za;L[5]=Da*qa+Ha*ha+Fa*ja+Ea*Aa;L[6]=Da*Q+Ha*la+Fa*oa+Ea*Ga;L[7]=Da*V+Ha*N+Fa*ua+Ea*R;Da=fa[8];Ha=fa[9];Fa=fa[10];Ea=fa[11];L[8]=Da*ka+Ha*W+Fa*aa+Ea*za;L[9]=Da*qa+Ha*ha+Fa*ja+Ea*
Aa;L[10]=Da*Q+Ha*la+Fa*oa+Ea*Ga;L[11]=Da*V+Ha*N+Fa*ua+Ea*R;Da=fa[12];Ha=fa[13];Fa=fa[14];Ea=fa[15];L[12]=Da*ka+Ha*W+Fa*aa+Ea*za;L[13]=Da*qa+Ha*ha+Fa*ja+Ea*Aa;L[14]=Da*Q+Ha*la+Fa*oa+Ea*Ga;L[15]=Da*V+Ha*N+Fa*ua+Ea*R;return L}function x(L,R,fa){const ka=fa[0],qa=fa[1];fa=fa[2];if(R===L)L[12]=R[0]*ka+R[4]*qa+R[8]*fa+R[12],L[13]=R[1]*ka+R[5]*qa+R[9]*fa+R[13],L[14]=R[2]*ka+R[6]*qa+R[10]*fa+R[14],L[15]=R[3]*ka+R[7]*qa+R[11]*fa+R[15];else{const Q=R[0],V=R[1],W=R[2],ha=R[3],la=R[4],N=R[5],aa=R[6],ja=R[7],
oa=R[8],ua=R[9],za=R[10],Aa=R[11];L[0]=Q;L[1]=V;L[2]=W;L[3]=ha;L[4]=la;L[5]=N;L[6]=aa;L[7]=ja;L[8]=oa;L[9]=ua;L[10]=za;L[11]=Aa;L[12]=Q*ka+la*qa+oa*fa+R[12];L[13]=V*ka+N*qa+ua*fa+R[13];L[14]=W*ka+aa*qa+za*fa+R[14];L[15]=ha*ka+ja*qa+Aa*fa+R[15]}return L}function n(L,R,fa){const ka=fa[0],qa=fa[1];fa=fa[2];L[0]=R[0]*ka;L[1]=R[1]*ka;L[2]=R[2]*ka;L[3]=R[3]*ka;L[4]=R[4]*qa;L[5]=R[5]*qa;L[6]=R[6]*qa;L[7]=R[7]*qa;L[8]=R[8]*fa;L[9]=R[9]*fa;L[10]=R[10]*fa;L[11]=R[11]*fa;L[12]=R[12];L[13]=R[13];L[14]=R[14];
L[15]=R[15];return L}function e(L,R,fa,ka){let qa=ka[0],Q=ka[1];ka=ka[2];let V=Math.sqrt(qa*qa+Q*Q+ka*ka);var W=void 0,ha=void 0;let la=void 0,N=void 0,aa=void 0,ja=void 0,oa=void 0,ua=void 0,za=void 0,Aa=void 0,Ga=void 0,Da=void 0,Ha=void 0,Fa=void 0,Ea=void 0,Ka=void 0,Sa=void 0,Xa=void 0,Ra=void 0,Ma=void 0,Pa=void 0,sa=void 0;ha=W=void 0;if(V<r.getEpsilon())return null;V=1/V;qa*=V;Q*=V;ka*=V;W=Math.sin(fa);ha=Math.cos(fa);la=1-ha;N=R[0];aa=R[1];ja=R[2];oa=R[3];ua=R[4];za=R[5];Aa=R[6];Ga=R[7];
Da=R[8];Ha=R[9];Fa=R[10];Ea=R[11];Ka=qa*qa*la+ha;Sa=Q*qa*la+ka*W;Xa=ka*qa*la-Q*W;Ra=qa*Q*la-ka*W;Ma=Q*Q*la+ha;Pa=ka*Q*la+qa*W;sa=qa*ka*la+Q*W;W=Q*ka*la-qa*W;ha=ka*ka*la+ha;L[0]=N*Ka+ua*Sa+Da*Xa;L[1]=aa*Ka+za*Sa+Ha*Xa;L[2]=ja*Ka+Aa*Sa+Fa*Xa;L[3]=oa*Ka+Ga*Sa+Ea*Xa;L[4]=N*Ra+ua*Ma+Da*Pa;L[5]=aa*Ra+za*Ma+Ha*Pa;L[6]=ja*Ra+Aa*Ma+Fa*Pa;L[7]=oa*Ra+Ga*Ma+Ea*Pa;L[8]=N*sa+ua*W+Da*ha;L[9]=aa*sa+za*W+Ha*ha;L[10]=ja*sa+Aa*W+Fa*ha;L[11]=oa*sa+Ga*W+Ea*ha;R!==L&&(L[12]=R[12],L[13]=R[13],L[14]=R[14],L[15]=R[15]);return L}
function h(L,R,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=R[4],Q=R[5],V=R[6],W=R[7],ha=R[8],la=R[9],N=R[10],aa=R[11];R!==L&&(L[0]=R[0],L[1]=R[1],L[2]=R[2],L[3]=R[3],L[12]=R[12],L[13]=R[13],L[14]=R[14],L[15]=R[15]);L[4]=qa*fa+ha*ka;L[5]=Q*fa+la*ka;L[6]=V*fa+N*ka;L[7]=W*fa+aa*ka;L[8]=ha*fa-qa*ka;L[9]=la*fa-Q*ka;L[10]=N*fa-V*ka;L[11]=aa*fa-W*ka;return L}function u(L,R,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=R[0],Q=R[1],V=R[2],W=R[3],ha=R[8],la=R[9],N=R[10],aa=R[11];R!==L&&(L[4]=R[4],
L[5]=R[5],L[6]=R[6],L[7]=R[7],L[12]=R[12],L[13]=R[13],L[14]=R[14],L[15]=R[15]);L[0]=qa*fa-ha*ka;L[1]=Q*fa-la*ka;L[2]=V*fa-N*ka;L[3]=W*fa-aa*ka;L[8]=qa*ka+ha*fa;L[9]=Q*ka+la*fa;L[10]=V*ka+N*fa;L[11]=W*ka+aa*fa;return L}function v(L,R,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=R[0],Q=R[1],V=R[2],W=R[3],ha=R[4],la=R[5],N=R[6],aa=R[7];R!==L&&(L[8]=R[8],L[9]=R[9],L[10]=R[10],L[11]=R[11],L[12]=R[12],L[13]=R[13],L[14]=R[14],L[15]=R[15]);L[0]=qa*fa+ha*ka;L[1]=Q*fa+la*ka;L[2]=V*fa+N*ka;L[3]=W*fa+aa*
ka;L[4]=ha*fa-qa*ka;L[5]=la*fa-Q*ka;L[6]=N*fa-V*ka;L[7]=aa*fa-W*ka;return L}function y(L,R){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=R[0];L[13]=R[1];L[14]=R[2];L[15]=1;return L}function B(L,R){L[0]=R[0];L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=R[1];L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=R[2];L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function t(L,R,fa){if(0===R)return m(L);let ka=fa[0],qa=fa[1];fa=fa[2];let Q=Math.sqrt(ka*ka+qa*qa+fa*fa),V=void 0,W=void 0,
ha=void 0;if(Q<r.getEpsilon())return null;Q=1/Q;ka*=Q;qa*=Q;fa*=Q;V=Math.sin(R);W=Math.cos(R);ha=1-W;L[0]=ka*ka*ha+W;L[1]=qa*ka*ha+fa*V;L[2]=fa*ka*ha-qa*V;L[3]=0;L[4]=ka*qa*ha-fa*V;L[5]=qa*qa*ha+W;L[6]=fa*qa*ha+ka*V;L[7]=0;L[8]=ka*fa*ha+qa*V;L[9]=qa*fa*ha-ka*V;L[10]=fa*fa*ha+W;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function w(L,R){const fa=Math.sin(R);R=Math.cos(R);L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=R;L[6]=fa;L[7]=0;L[8]=0;L[9]=-fa;L[10]=R;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}
function C(L,R){const fa=Math.sin(R);R=Math.cos(R);L[0]=R;L[1]=0;L[2]=-fa;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=fa;L[9]=0;L[10]=R;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function z(L,R){const fa=Math.sin(R);R=Math.cos(R);L[0]=R;L[1]=fa;L[2]=0;L[3]=0;L[4]=-fa;L[5]=R;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function D(L,R,fa){var ka=R[0],qa=R[1],Q=R[2],V=R[3],W=ka+ka,ha=qa+qa;const la=Q+Q;R=ka*W;const N=ka*ha;ka*=la;const aa=qa*ha;qa*=la;Q*=la;
W*=V;ha*=V;V*=la;L[0]=1-(aa+Q);L[1]=N+V;L[2]=ka-ha;L[3]=0;L[4]=N-V;L[5]=1-(R+Q);L[6]=qa+W;L[7]=0;L[8]=ka+ha;L[9]=qa-W;L[10]=1-(R+aa);L[11]=0;L[12]=fa[0];L[13]=fa[1];L[14]=fa[2];L[15]=1;return L}function H(L,R){const fa=Ca,ka=-R[0],qa=-R[1],Q=-R[2],V=R[3],W=R[4],ha=R[5],la=R[6],N=R[7],aa=ka*ka+qa*qa+Q*Q+V*V;0<aa?(fa[0]=2*(W*V+N*ka+ha*Q-la*qa)/aa,fa[1]=2*(ha*V+N*qa+la*ka-W*Q)/aa,fa[2]=2*(la*V+N*Q+W*qa-ha*ka)/aa):(fa[0]=2*(W*V+N*ka+ha*Q-la*qa),fa[1]=2*(ha*V+N*qa+la*ka-W*Q),fa[2]=2*(la*V+N*Q+W*qa-ha*
ka));D(L,R,fa);return L}function G(L,R){L[0]=R[12];L[1]=R[13];L[2]=R[14];return L}function A(L,R){const fa=R[0],ka=R[1],qa=R[2],Q=R[4],V=R[5],W=R[6],ha=R[8],la=R[9];R=R[10];L[0]=Math.sqrt(fa*fa+ka*ka+qa*qa);L[1]=Math.sqrt(Q*Q+V*V+W*W);L[2]=Math.sqrt(ha*ha+la*la+R*R);return L}function F(L,R){const fa=R[0]+R[5]+R[10];let ka=0;0<fa?(ka=2*Math.sqrt(fa+1),L[3]=.25*ka,L[0]=(R[6]-R[9])/ka,L[1]=(R[8]-R[2])/ka,L[2]=(R[1]-R[4])/ka):R[0]>R[5]&&R[0]>R[10]?(ka=2*Math.sqrt(1+R[0]-R[5]-R[10]),L[3]=(R[6]-R[9])/ka,
L[0]=.25*ka,L[1]=(R[1]+R[4])/ka,L[2]=(R[8]+R[2])/ka):R[5]>R[10]?(ka=2*Math.sqrt(1+R[5]-R[0]-R[10]),L[3]=(R[8]-R[2])/ka,L[0]=(R[1]+R[4])/ka,L[1]=.25*ka,L[2]=(R[6]+R[9])/ka):(ka=2*Math.sqrt(1+R[10]-R[0]-R[5]),L[3]=(R[1]-R[4])/ka,L[0]=(R[8]+R[2])/ka,L[1]=(R[6]+R[9])/ka,L[2]=.25*ka);return L}function J(L,R,fa,ka){var qa=R[0],Q=R[1],V=R[2],W=R[3],ha=qa+qa,la=Q+Q,N=V+V;R=qa*ha;const aa=qa*la;qa*=N;const ja=Q*la;Q*=N;V*=N;ha*=W;la*=W;W*=N;N=ka[0];const oa=ka[1];ka=ka[2];L[0]=(1-(ja+V))*N;L[1]=(aa+W)*N;L[2]=
(qa-la)*N;L[3]=0;L[4]=(aa-W)*oa;L[5]=(1-(R+V))*oa;L[6]=(Q+ha)*oa;L[7]=0;L[8]=(qa+la)*ka;L[9]=(Q-ha)*ka;L[10]=(1-(R+ja))*ka;L[11]=0;L[12]=fa[0];L[13]=fa[1];L[14]=fa[2];L[15]=1;return L}function K(L,R,fa,ka,qa){var Q=R[0],V=R[1],W=R[2],ha=R[3],la=Q+Q,N=V+V,aa=W+W;R=Q*la;var ja=Q*N,oa=Q*aa;Q=V*N;V*=aa;var ua=W*aa;W=ha*la;N*=ha;const za=ha*aa;var Aa=ka[0],Ga=ka[1];aa=ka[2];ka=qa[0];ha=qa[1];qa=qa[2];la=(1-(Q+ua))*Aa;const Da=(ja+za)*Aa;Aa*=oa-N;ja=(ja-za)*Ga;ua=(1-(R+ua))*Ga;Ga*=V+W;oa=(oa+N)*aa;V=(V-
W)*aa;R=(1-(R+Q))*aa;L[0]=la;L[1]=Da;L[2]=Aa;L[3]=0;L[4]=ja;L[5]=ua;L[6]=Ga;L[7]=0;L[8]=oa;L[9]=V;L[10]=R;L[11]=0;L[12]=fa[0]+ka-(la*ka+ja*ha+oa*qa);L[13]=fa[1]+ha-(Da*ka+ua*ha+V*qa);L[14]=fa[2]+qa-(Aa*ka+Ga*ha+R*qa);L[15]=1;return L}function P(L,R){var fa=R[0],ka=R[1],qa=R[2];R=R[3];var Q=fa+fa,V=ka+ka;const W=qa+qa;fa*=Q;const ha=ka*Q;ka*=V;const la=qa*Q,N=qa*V;qa*=W;Q*=R;V*=R;R*=W;L[0]=1-ka-qa;L[1]=ha+R;L[2]=la-V;L[3]=0;L[4]=ha-R;L[5]=1-fa-qa;L[6]=N+Q;L[7]=0;L[8]=la+V;L[9]=N-Q;L[10]=1-fa-ka;L[11]=
0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function E(L,R,fa,ka,qa,Q,V){const W=1/(fa-R),ha=1/(qa-ka),la=1/(Q-V);L[0]=2*Q*W;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=2*Q*ha;L[6]=0;L[7]=0;L[8]=(fa+R)*W;L[9]=(qa+ka)*ha;L[10]=(V+Q)*la;L[11]=-1;L[12]=0;L[13]=0;L[14]=V*Q*2*la;L[15]=0;return L}function M(L,R,fa,ka,qa){R=1/Math.tan(R/2);let Q=void 0;L[0]=R/fa;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=R;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[11]=-1;L[12]=0;L[13]=0;L[15]=0;null!=qa&&Infinity!==qa?(Q=1/(ka-qa),L[10]=(qa+ka)*Q,L[14]=
2*qa*ka*Q):(L[10]=-1,L[14]=-2*ka);return L}function T(L,R,fa,ka){const qa=Math.tan(R.upDegrees*Math.PI/180),Q=Math.tan(R.downDegrees*Math.PI/180),V=Math.tan(R.leftDegrees*Math.PI/180);R=Math.tan(R.rightDegrees*Math.PI/180);const W=2/(V+R),ha=2/(qa+Q);L[0]=W;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=ha;L[6]=0;L[7]=0;L[8]=-((V-R)*W*.5);L[9]=(qa-Q)*ha*.5;L[10]=ka/(fa-ka);L[11]=-1;L[12]=0;L[13]=0;L[14]=ka*fa/(fa-ka);L[15]=0;return L}function ba(L,R,fa,ka,qa,Q,V){const W=1/(R-fa),ha=1/(ka-qa),la=1/(Q-V);L[0]=-2*
W;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=-2*ha;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=2*la;L[11]=0;L[12]=(R+fa)*W;L[13]=(qa+ka)*ha;L[14]=(V+Q)*la;L[15]=1;return L}function ea(L,R,fa,ka){const qa=R[0],Q=R[1];R=R[2];let V=qa-fa[0],W=Q-fa[1];fa=R-fa[2];var ha=r.getEpsilon();if(Math.abs(V)<ha&&Math.abs(W)<ha&&Math.abs(fa)<ha)m(L);else{var la=1/Math.sqrt(V*V+W*W+fa*fa);V*=la;W*=la;fa*=la;la=ka[0];var N=ka[1];ha=ka[2];ka=N*fa-ha*W;ha=ha*V-la*fa;N=la*W-N*V;(la=Math.sqrt(ka*ka+ha*ha+N*N))?(la=1/la,ka*=la,ha*=la,N*=
la):N=ha=ka=0;var aa=W*N-fa*ha,ja=fa*ka-V*N,oa=V*ha-W*ka;(la=Math.sqrt(aa*aa+ja*ja+oa*oa))?(la=1/la,aa*=la,ja*=la,oa*=la):oa=ja=aa=0;L[0]=ka;L[1]=aa;L[2]=V;L[3]=0;L[4]=ha;L[5]=ja;L[6]=W;L[7]=0;L[8]=N;L[9]=oa;L[10]=fa;L[11]=0;L[12]=-(ka*qa+ha*Q+N*R);L[13]=-(aa*qa+ja*Q+oa*R);L[14]=-(V*qa+W*Q+fa*R);L[15]=1}}function X(L,R,fa,ka){const qa=R[0],Q=R[1];R=R[2];var V=ka[0];const W=ka[1];var ha=ka[2];ka=qa-fa[0];let la=Q-fa[1];fa=R-fa[2];let N=ka*ka+la*la+fa*fa;0<N&&(N=1/Math.sqrt(N),ka*=N,la*=N,fa*=N);let aa=
W*fa-ha*la;ha=ha*ka-V*fa;V=V*la-W*ka;N=aa*aa+ha*ha+V*V;0<N&&(N=1/Math.sqrt(N),aa*=N,ha*=N,V*=N);L[0]=aa;L[1]=ha;L[2]=V;L[3]=0;L[4]=la*V-fa*ha;L[5]=fa*aa-ka*V;L[6]=ka*ha-la*aa;L[7]=0;L[8]=ka;L[9]=la;L[10]=fa;L[11]=0;L[12]=qa;L[13]=Q;L[14]=R;L[15]=1;return L}function ca(L){return"mat4("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+", "+L[9]+", "+L[10]+", "+L[11]+", "+L[12]+", "+L[13]+", "+L[14]+", "+L[15]+")"}function ma(L){return Math.sqrt(L[0]**2+L[1]**2+L[2]**
2+L[3]**2+L[4]**2+L[5]**2+L[6]**2+L[7]**2+L[8]**2+L[9]**2+L[10]**2+L[11]**2+L[12]**2+L[13]**2+L[14]**2+L[15]**2)}function S(L,R,fa){L[0]=R[0]+fa[0];L[1]=R[1]+fa[1];L[2]=R[2]+fa[2];L[3]=R[3]+fa[3];L[4]=R[4]+fa[4];L[5]=R[5]+fa[5];L[6]=R[6]+fa[6];L[7]=R[7]+fa[7];L[8]=R[8]+fa[8];L[9]=R[9]+fa[9];L[10]=R[10]+fa[10];L[11]=R[11]+fa[11];L[12]=R[12]+fa[12];L[13]=R[13]+fa[13];L[14]=R[14]+fa[14];L[15]=R[15]+fa[15];return L}function Y(L,R,fa){L[0]=R[0]-fa[0];L[1]=R[1]-fa[1];L[2]=R[2]-fa[2];L[3]=R[3]-fa[3];L[4]=
R[4]-fa[4];L[5]=R[5]-fa[5];L[6]=R[6]-fa[6];L[7]=R[7]-fa[7];L[8]=R[8]-fa[8];L[9]=R[9]-fa[9];L[10]=R[10]-fa[10];L[11]=R[11]-fa[11];L[12]=R[12]-fa[12];L[13]=R[13]-fa[13];L[14]=R[14]-fa[14];L[15]=R[15]-fa[15];return L}function ia(L,R,fa){L[0]=R[0]*fa;L[1]=R[1]*fa;L[2]=R[2]*fa;L[3]=R[3]*fa;L[4]=R[4]*fa;L[5]=R[5]*fa;L[6]=R[6]*fa;L[7]=R[7]*fa;L[8]=R[8]*fa;L[9]=R[9]*fa;L[10]=R[10]*fa;L[11]=R[11]*fa;L[12]=R[12]*fa;L[13]=R[13]*fa;L[14]=R[14]*fa;L[15]=R[15]*fa;return L}function na(L,R,fa,ka){L[0]=R[0]+fa[0]*
ka;L[1]=R[1]+fa[1]*ka;L[2]=R[2]+fa[2]*ka;L[3]=R[3]+fa[3]*ka;L[4]=R[4]+fa[4]*ka;L[5]=R[5]+fa[5]*ka;L[6]=R[6]+fa[6]*ka;L[7]=R[7]+fa[7]*ka;L[8]=R[8]+fa[8]*ka;L[9]=R[9]+fa[9]*ka;L[10]=R[10]+fa[10]*ka;L[11]=R[11]+fa[11]*ka;L[12]=R[12]+fa[12]*ka;L[13]=R[13]+fa[13]*ka;L[14]=R[14]+fa[14]*ka;L[15]=R[15]+fa[15]*ka;return L}function ta(L,R){return L[0]===R[0]&&L[1]===R[1]&&L[2]===R[2]&&L[3]===R[3]&&L[4]===R[4]&&L[5]===R[5]&&L[6]===R[6]&&L[7]===R[7]&&L[8]===R[8]&&L[9]===R[9]&&L[10]===R[10]&&L[11]===R[11]&&L[12]===
R[12]&&L[13]===R[13]&&L[14]===R[14]&&L[15]===R[15]}function va(L,R){if(L===R)return!0;const fa=L[0],ka=L[1],qa=L[2],Q=L[3],V=L[4],W=L[5],ha=L[6],la=L[7],N=L[8],aa=L[9],ja=L[10],oa=L[11],ua=L[12],za=L[13],Aa=L[14];L=L[15];const Ga=R[0],Da=R[1],Ha=R[2],Fa=R[3],Ea=R[4],Ka=R[5],Sa=R[6],Xa=R[7],Ra=R[8],Ma=R[9],Pa=R[10],sa=R[11],Qa=R[12],cb=R[13],jb=R[14];R=R[15];const I=r.getEpsilon();return Math.abs(fa-Ga)<=I*Math.max(1,Math.abs(fa),Math.abs(Ga))&&Math.abs(ka-Da)<=I*Math.max(1,Math.abs(ka),Math.abs(Da))&&
Math.abs(qa-Ha)<=I*Math.max(1,Math.abs(qa),Math.abs(Ha))&&Math.abs(Q-Fa)<=I*Math.max(1,Math.abs(Q),Math.abs(Fa))&&Math.abs(V-Ea)<=I*Math.max(1,Math.abs(V),Math.abs(Ea))&&Math.abs(W-Ka)<=I*Math.max(1,Math.abs(W),Math.abs(Ka))&&Math.abs(ha-Sa)<=I*Math.max(1,Math.abs(ha),Math.abs(Sa))&&Math.abs(la-Xa)<=I*Math.max(1,Math.abs(la),Math.abs(Xa))&&Math.abs(N-Ra)<=I*Math.max(1,Math.abs(N),Math.abs(Ra))&&Math.abs(aa-Ma)<=I*Math.max(1,Math.abs(aa),Math.abs(Ma))&&Math.abs(ja-Pa)<=I*Math.max(1,Math.abs(ja),Math.abs(Pa))&&
Math.abs(oa-sa)<=I*Math.max(1,Math.abs(oa),Math.abs(sa))&&Math.abs(ua-Qa)<=I*Math.max(1,Math.abs(ua),Math.abs(Qa))&&Math.abs(za-cb)<=I*Math.max(1,Math.abs(za),Math.abs(cb))&&Math.abs(Aa-jb)<=I*Math.max(1,Math.abs(Aa),Math.abs(jb))&&Math.abs(L-R)<=I*Math.max(1,Math.abs(L),Math.abs(R))}function xa(L){const R=r.getEpsilon(),fa=L[0],ka=L[1],qa=L[2],Q=L[4],V=L[5],W=L[6],ha=L[8],la=L[9];L=L[10];return Math.abs(1-(fa*fa+Q*Q+ha*ha))<=R&&Math.abs(1-(ka*ka+V*V+la*la))<=R&&Math.abs(1-(qa*qa+W*W+L*L))<=R}function wa(L){return 1===
L[0]&&0===L[1]&&0===L[2]&&0===L[4]&&1===L[5]&&0===L[6]&&0===L[8]&&0===L[9]&&1===L[10]}const Ca=q.create();q=Object.freeze(Object.defineProperty({__proto__:null,add:S,adjoint:f,copy:k,determinant:p,equals:va,exactEquals:ta,frob:ma,fromQuat:P,fromQuat2:H,fromRotation:t,fromRotationTranslation:D,fromRotationTranslationScale:J,fromRotationTranslationScaleOrigin:K,fromScaling:B,fromTranslation:y,fromXRotation:w,fromYRotation:C,fromZRotation:z,frustum:E,getRotation:F,getScaling:A,getTranslation:G,hasIdentityRotation:wa,
identity:m,invert:d,invertOrIdentity:c,isOrthoNormal:xa,lookAt:ea,mul:g,multiply:g,multiplyScalar:ia,multiplyScalarAndAdd:na,ortho:ba,perspective:M,perspectiveFromFieldOfView:T,rotate:e,rotateX:h,rotateY:u,rotateZ:v,scale:n,set:l,str:ca,sub:Y,subtract:Y,targetTo:X,translate:x,transpose:b},Symbol.toStringTag,{value:"Module"}));a.add=S;a.adjoint=f;a.copy=k;a.determinant=p;a.equals=va;a.exactEquals=ta;a.frob=ma;a.fromQuat=P;a.fromQuat2=H;a.fromRotation=t;a.fromRotationTranslation=D;a.fromRotationTranslationScale=
J;a.fromRotationTranslationScaleOrigin=K;a.fromScaling=B;a.fromTranslation=y;a.fromXRotation=w;a.fromYRotation=C;a.fromZRotation=z;a.frustum=E;a.getRotation=F;a.getScaling=A;a.getTranslation=G;a.hasIdentityRotation=wa;a.identity=m;a.invert=d;a.invertOrIdentity=c;a.isOrthoNormal=xa;a.lookAt=ea;a.mat4=q;a.mul=g;a.multiply=g;a.multiplyScalar=ia;a.multiplyScalarAndAdd=na;a.ortho=ba;a.perspective=M;a.perspectiveFromFieldOfView=T;a.rotate=e;a.rotateX=h;a.rotateY=u;a.rotateZ=v;a.scale=n;a.set=l;a.str=ca;
a.sub=Y;a.subtract=Y;a.targetTo=X;a.translate=x;a.transpose=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,q,r){function k(J){return null==J||"string"===typeof J&&!J?"\x3cNull\x3e":J}function l(J){const K=null!=J.minValue||null!=J.maxValue,P=!!J.sqlExpression&&J.supportsSQLExpression;return!(null!=J.normalizationField||null!=J.normalizationType)&&
!K&&!P}function m(J){const {values:K,useSampleStdDev:P,supportsNullCount:E}=J;var M=Number.POSITIVE_INFINITY;let T=Number.NEGATIVE_INFINITY,ba=null,ea=null;var X=null;let ca=null,ma=0;const S=null==J.minValue?-Infinity:J.minValue,Y=null==J.maxValue?Infinity:J.maxValue;for(const ia of K)Number.isFinite(ia)?ia>=S&&ia<=Y&&(ba=null===ba?ia:ba+ia,M=Math.min(M,ia),T=Math.max(T,ia),ma++):"string"===typeof ia&&ma++;if(ma&&null!=ba){ea=ba/ma;X=0;for(const ia of K)Number.isFinite(ia)&&ia>=S&&ia<=Y&&(X+=(ia-
ea)**2);ca=P?1<ma?X/(ma-1):0:0<ma?X/ma:0;X=Math.sqrt(ca)}else T=M=null;M={avg:ea,count:ma,max:T,min:M,stddev:X,sum:ba,variance:ca};E&&(M.nullcount=K.length-ma);J.percentileParams&&(M.median=b(K,J.percentileParams));return M}function b(J,K){const {fieldType:P,value:E,orderBy:M,isDiscrete:T}=K,ba=c(P,"desc"===M);J=[...J].filter(ma=>null!=ma).sort((ma,S)=>ba(ma,S));if(0===J.length)return null;if(0>=E)return J[0];if(1<=E)return J[J.length-1];var ea=(J.length-1)*E,X=Math.floor(ea);K=X+1;ea%=1;X=J[X];const ca=
J[K];return K>=J.length||T||"string"===typeof X||"string"===typeof ca?X:X*(1-ea)+ca*ea}function c(J,K){if(J){if(y.has(J))return K?A:F;if(B.has(J))return d(K,!1);if("esriFieldTypeTimestampOffset"===J)return K?D:z;const T=d(K,!0);if("esriFieldTypeString"===J)return T;if("esriFieldTypeGUID"===J||"esriFieldTypeGlobalID"===J)return(ba,ea)=>T(f(ba),f(ea))}const P=K?1:-1,E=K?A:F,M=d(K,!0);return(T,ba)=>"number"===typeof T&&"number"===typeof ba?E(T,ba):"string"===typeof T&&"string"===typeof ba?M(T,ba):P}
function d(J,K){if(!K)return J?G:H;const P=J?w:C;return J?(E,M)=>{const T=P(E,M);if(null!=T)return T;E=E.toUpperCase();M=M.toUpperCase();return E>M?-1:E<M?1:0}:(E,M)=>{const T=P(E,M);if(null!=T)return T;E=E.toUpperCase();M=M.toUpperCase();return E<M?-1:E>M?1:0}}function f(J){return J.substr(24,12)+J.substr(19,4)+J.substr(16,2)+J.substr(14,2)+J.substr(11,2)+J.substr(9,2)+J.substr(6,2)+J.substr(4,2)+J.substr(2,2)+J.substr(0,2)}function p(J){return"coded-value"!==J?.type?[]:J.codedValues.map(K=>K.code)}
function g(J,K){const P=n({field:K.field,normalizationType:K.normalizationType,normalizationField:K.normalizationField,classificationMethod:K.classificationMethod,standardDeviationInterval:K.standardDeviationInterval,breakCount:K.numClasses||5});J=x(J,K.minValue,K.maxValue);return r.createGenerateRendererClassBreaks({definition:P,values:J,normalizationTotal:K.normalizationTotal})}function x(J,K,P){const E=null==K?-Infinity:K,M=null==P?Infinity:P;return J.filter(T=>Number.isFinite(T)&&T>=E&&T<=M)}
function n(J){const {breakCount:K,field:P,normalizationField:E,normalizationType:M}=J,T=J.classificationMethod||"equal-interval";return new q({breakCount:K,classificationField:P,classificationMethod:T,normalizationField:"field"===M?E:void 0,normalizationType:M,standardDeviationInterval:"standard-deviation"===T?J.standardDeviationInterval||1:void 0})}function e(J,K){const {field:P,classificationMethod:E,standardDeviationInterval:M,normalizationType:T,normalizationField:ba,normalizationTotal:ea,minValue:X,
maxValue:ca}=K,ma=K.numBins||10;let S=K=null,Y=null;E&&"equal-interval"!==E||T?({classBreaks:J}=g(J,{field:P,normalizationType:T,normalizationField:ba,normalizationTotal:ea,classificationMethod:E,standardDeviationInterval:M,minValue:X,maxValue:ca,numClasses:ma}),K=J[0].minValue,S=J[J.length-1].maxValue,Y=J.map(ia=>[ia.minValue,ia.maxValue])):(null!=X&&null!=ca?(K=X,S=ca):(J=m({values:J,minValue:X,maxValue:ca,useSampleStdDev:!T,supportsNullCount:l({normalizationType:T,normalizationField:ba,minValue:X,
maxValue:ca})}),K=J.min??null,S=J.max??null),Y=u(K??0,S??0,ma));return{min:K,max:S,intervals:Y}}function h(J,K){let P=-1;for(let E=J.length-1;0<=E;E--)if(K>=J[E][0]){P=E;break}return P}function u(J,K,P){const E=(K-J)/P,M=[];let T;for(let ba=1;ba<=P;ba++)T=J+E,T=Number(T.toFixed(16)),M.push([J,ba===P?K:T]),J=T;return M}const v=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,y=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
B=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),t="min max avg stddev count sum variance nullcount median".split(" "),w=(J,K)=>null==J?null==K?0:1:null==K?-1:null,C=(J,K)=>null==J?null==K?0:-1:null==K?1:null,z=(J,K)=>C(J,K)??(J===K?0:(new Date(J)).getTime()-(new Date(K)).getTime()),D=(J,K)=>w(J,K)??(J===K?0:(new Date(K)).getTime()-(new Date(J)).getTime()),H=(J,K)=>C(J,K)??(J===K?0:J<K?-1:1),G=(J,K)=>w(J,K)??(J===K?0:J<K?1:-1),A=(J,K)=>w(J,K)??K-J,F=(J,K)=>C(J,K)??J-K;a.calculateClassBreaks=
g;a.calculateHistogram=function(J,K){var P=e(J,K);if(null==P.min&&null==P.max)return{bins:[],minValue:P.min,maxValue:P.max,normalizationTotal:K.normalizationTotal};const E=P.intervals,M=P.min??0;P=P.max??0;const T=E.map((ba,ea)=>({minValue:E[ea][0],maxValue:E[ea][1],count:0}));for(const ba of J)null!=ba&&ba>=M&&ba<=P&&(J=h(E,ba),-1<J&&T[J].count++);return{bins:T,minValue:M,maxValue:P,normalizationTotal:K.normalizationTotal}};a.calculatePercentile=b;a.calculateStatistics=m;a.calculateStringStatistics=
function(J){const K=J.returnDistinct?[...(new Set(J.values))]:J.values;var P=K.filter(M=>null!=M).sort();const E=P.length;P={count:E,min:P[0],max:P[E-1]};J.supportsNullCount&&(P.nullcount=K.length-E);J.percentileParams&&(P.median=b(K,J.percentileParams));return P};a.calculateUniqueValuesCount=function(J){const K={};for(let P of J){if(null==P||"string"===typeof P&&""===P.trim())P=null;null==K[P]?K[P]={count:1,data:P}:K[P].count++}return{count:K}};a.createClassBreaksDefinition=n;a.createUVResult=function(J,
K,P,E){J=J.count;const M=[];if(P&&K){P=[];var T=p(K[0]);for(const ba of T)if(K[1]){T=p(K[1]);for(const ea of T)if(K[2]){T=p(K[2]);for(const X of T)P.push(`${k(ba)}${E}${k(ea)}${E}${k(X)}`)}else P.push(`${k(ba)}${E}${k(ea)}`)}else P.push(ba);for(const ba of P)J.hasOwnProperty(ba)||(J[ba]={data:ba,count:0})}for(const ba in J)K=J[ba],M.push({value:K.data,count:K.count,label:K.label});return{uniqueValueInfos:M}};a.getAttributeComparator=c;a.getEqualIntervalBins=u;a.getNormalizedValue=function(J,K,P,E){let M=
null;switch(K){case "log":0!==J&&(M=Math.log(J)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(E)&&0!==E&&(M=J/E*100);break;case "field":Number.isFinite(P)&&0!==P&&(M=J/P);break;case "natural-log":0<J&&(M=Math.log(J));break;case "square-root":0<J&&(M=J**.5)}return M};a.isNullCountSupported=l;a.processNullValue=k;a.processSummaryStatisticsResult=function(J,K){let P;for(P in J)t.includes(P)&&(Number.isFinite(J[P])||(J[P]=null));if(!K)return J;["avg","stddev","variance"].forEach(E=>{null!=
J[E]&&(J[E]=Math.ceil(J[E]??0))});return J};a.resolveCBResult=function(J,K){let P=J.classBreaks;const E=P[0]?.minValue,M=P[P.length-1]?.maxValue,T="standard-deviation"===K;P=P.map(ba=>{const ea=ba.label;ba={minValue:ba.minValue,maxValue:ba.maxValue,label:ea};if(T&&ea){const X=ea.match(v)?.map(ca=>+ca.trim())??[];2===X.length?(ba.minStdDev=X[0],ba.maxStdDev=X[1],0>X[0]&&0<X[1]&&(ba.hasAvg=!0)):1===X.length&&(ea.includes("\x3c")?(ba.minStdDev=null,ba.maxStdDev=X[0]):ea.includes("\x3e")&&(ba.minStdDev=
X[0],ba.maxStdDev=null))}return ba});return{minValue:E,maxValue:M,classBreakInfos:P,normalizationTotal:J.normalizationTotal}};a.statisticTypes=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c,d){l=new q.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});q=new q.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});r=class extends r.JSONSupport{constructor(f){super(f);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(f){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",f)}set definedInterval(f){"defined-interval"===this.classificationMethod&&this._set("definedInterval",f)}};a.__decorate([c.enumeration({classBreaksDef:"class-breaks-definition"})],r.prototype,"type",void 0);a.__decorate([k.property({json:{write:!0}})],r.prototype,
"breakCount",void 0);a.__decorate([k.property({json:{write:!0}})],r.prototype,"classificationField",void 0);a.__decorate([k.property({type:String,json:{read:l.read,write:l.write}})],r.prototype,"classificationMethod",void 0);a.__decorate([k.property({json:{write:!0}})],r.prototype,"normalizationField",void 0);a.__decorate([k.property({json:{read:q.read,write:q.write}})],r.prototype,"normalizationType",void 0);a.__decorate([k.property({value:null,json:{write:!0}})],r.prototype,"standardDeviationInterval",
null);a.__decorate([k.property({value:null,json:{write:!0}})],r.prototype,"definedInterval",null);return r=a.__decorate([d.subclass("esri.rest.support.ClassBreaksDefinition")],r)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,q){function r(g){var x=g.definition;const {classificationMethod:n,normalizationType:e,definedInterval:h}=x;x=x.breakCount??1;const u=[];var v=g.values;if(0===v.length)return[];v=v.sort((z,D)=>z-D);var y=v[0],B=v[v.length-
1];if("equal-interval"===n)if(v.length>=x){v=(B-y)/x;g=y;for(var t=1;t<x;t++){var w=Number((y+t*v).toFixed(6));u.push({minValue:g,maxValue:w,label:k(g,w,e)});g=w}u.push({minValue:g,maxValue:B,label:k(g,B,e)})}else v.forEach(z=>{u.push({minValue:z,maxValue:z,label:k(z,z,e)})});else if("natural-breaks"===n){v=l(v);g=m(v.uniqueValues,g.valueFrequency||v.valueFrequency,x);for(t=1;t<x;t++)v.uniqueValues.length>t&&(w=Number(v.uniqueValues[g[t]].toFixed(6)),u.push({minValue:y,maxValue:w,label:k(y,w,e)}),
y=w);u.push({minValue:y,maxValue:B,label:k(y,B,e)})}else if("quantile"===n)if(v.length>=x&&y!==B){g=Math.ceil(v.length/x);t=0;for(w=1;w<x;w++){var C=g+t-1;C>v.length&&(C=v.length-1);0>C&&(C=0);u.push({minValue:y,maxValue:v[C],label:k(y,v[C],e)});y=v[C];t+=g;g=Math.ceil((v.length-t)/(x-w))}u.push({minValue:y,maxValue:B,label:k(y,B,e)})}else for(x=-1,B=0;B<v.length;B++)y=v[B],y!==x&&(x=y,u.push({minValue:x,maxValue:y,label:k(x,y,e)}),x=y);else if("standard-deviation"===n)if(g=d(v),t=f(v,g),0===t)u.push({minValue:v[0],
maxValue:v[0],label:k(v[0],v[0],e)});else{v=c(y,B,x,g,t)*t;t=0;for(w=x;1<=w;w--)C=Number((g-(w-.5)*v).toFixed(6)),u.push({minValue:y,maxValue:C,label:k(y,C,e)}),y=C,t++;w=Number((g+.5*v).toFixed(6));u.push({minValue:y,maxValue:w,label:k(y,w,e)});y=w;t++;for(C=1;C<=x;C++)w=t===2*x?B:Number((g+(C+.5)*v).toFixed(6)),u.push({minValue:y,maxValue:w,label:k(y,w,e)}),y=w,t++}else if("defined-interval"===n){if(!h)return u;x=v[0];B=v[v.length-1];v=Math.ceil((B-x)/h);y=x;for(g=1;g<v;g++)t=Number((x+g*h).toFixed(6)),
u.push({minValue:y,maxValue:t,label:k(y,t,e)}),y=t;u.push({minValue:y,maxValue:B,label:k(y,B,e)})}return u}function k(g,x,n){let e=null;return e=g===x?n&&"percent-of-total"===n?g+"%":g.toString():n&&"percent-of-total"===n?g+"% - "+x+"%":g+" - "+x}function l(g){const x=[],n=[];let e=Number.MIN_VALUE,h=1,u=-1;for(let v=0;v<g.length;v++){const y=g[v];y===e?(h++,n[u]=h):null!==y&&(x.push(y),e=y,h=1,n.push(h),u++)}return{uniqueValues:x,valueFrequency:n}}function m(g,x,n){var e=g.length;const h=[];n>e&&
(n=e);for(var u=0;u<n;u++)h.push(Math.round(u*e/n-1));h.push(e-1);u=b(h,g,x,n);e=u.mean;u=u.sdcm;var v=n,y=0,B=0;let t=0,w=0,C=!0;for(let D=0;2>D&&C;D++){0===D&&(C=!1);for(var z=0;z<v-1;z++)for(;h[z+1]+1!==h[z+2];)if(h[z+1]+=1,y=p(z,h,g,x),t=y.sbMean,y=y.sbSdcm,B=p(z+1,h,g,x),w=B.sbMean,B=B.sbSdcm,y+B<u[z]+u[z+1])u[z]=y,u[z+1]=B,e[z]=t,e[z+1]=w,C=!0;else{--h[z+1];break}for(z=v-1;0<z;z--)for(;h[z]!==h[z-1]+1;)if(--h[z],y=p(z-1,h,g,x),t=y.sbMean,y=y.sbSdcm,B=p(z,h,g,x),w=B.sbMean,B=B.sbSdcm,y+B<u[z-
1]+u[z])u[z-1]=y,u[z]=B,e[z-1]=t,e[z]=w,C=!0;else{h[z]+=1;break}}C&&(u=b(h,g,x,n));return h}function b(g,x,n,e){let h=[];var u=[],v=[];let y=0;const B=[],t=[];for(var w=0;w<e;w++){var C=p(w,g,x,n);B.push(C.sbMean);t.push(C.sbSdcm);y+=t[w]}C=y;for(w=!0;w||y<C;){w=!1;h=[];for(u=0;u<e;u++)h.push(g[u]);for(v=0;v<e;v++)for(C=g[v]+1;C<=g[v+1];C++)if(u=x[C],0<v&&C!==g[v+1]&&Math.abs(u-B[v])>Math.abs(u-B[v-1]))g[v]=C;else if(v<e-1&&g[v]!==C-1&&Math.abs(u-B[v])>Math.abs(u-B[v+1])){g[v+1]=C-1;break}C=y;y=0;
u=[];v=[];for(let z=0;z<e;z++){u.push(B[z]);v.push(t[z]);const D=p(z,g,x,n);B[z]=D.sbMean;t[z]=D.sbSdcm;y+=t[z]}}if(y>C){for(x=0;x<e;x++)g[x]=h[x],B[x]=u[x],t[x]=v[x];y=C}return{mean:B,sdcm:t}}function c(g,x,n,e,h){g=Math.max(e-g,x-e)/h/n;return 1<=g?1:.5<=g?.5:.25}function d(g){let x=0;for(let n=0;n<g.length;n++)x+=g[n];return x/=g.length}function f(g,x){let n=0;for(let e=0;e<g.length;e++){const h=g[e];n+=(h-x)*(h-x)}n/=g.length;return Math.sqrt(n)}function p(g,x,n,e){var h=0,u=0;for(var v=x[g]+
1;v<=x[g+1];v++){const y=e[v];h+=n[v]*y;u+=y}0>=u&&q.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");h/=u;u=0;for(v=x[g]+1;v<=x[g+1];v++)u+=e[v]*(n[v]-h)**2;return{sbMean:h,sbSdcm:u}}a.createGenerateRendererClassBreaks=function(g){const {normalizationTotal:x}=g;return{classBreaks:r(g),normalizationTotal:x}};a.createGenerateRendererUniqueValues=function(g){g=l(g);const x=[],n=g.uniqueValues.length;for(let e=0;e<n;e++){const h=g.uniqueValues[e];x.push({value:h,
count:g.valueFrequency[e],label:h.toString()})}return{uniqueValues:x}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(q,r,k,l,m,b=!1){return{objectId:q,target:r,distance:k,type:"edge",start:l,end:m,draped:b}};a.makeVertexCandidate=function(q,r,k){return{objectId:q,target:r,distance:k,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(a,q,r,k,l,m,b,c,d,f){async function p(u,v,y){if(!u)return null;var {where:B}=u;u.where=B=B?.trim();if(!B||/^1 *= *1$/.test(B)||v&&v===B)u.where=null;if(!u.geometry)return u;v=await x(u);u.distance=0;u.units=null;"esriSpatialRelEnvelopeIntersects"===u.spatialRel&&({spatialReference:B}=u.geometry,v=m.getGeometryExtent(v),v.spatialReference=B);if(v){await f.checkProjectionSupport(v.spatialReference,y);B=v.spatialReference;v=g(v,y)&&b.isExtent(v)?{spatialReference:B,rings:[[[v.xmin,v.ymin],[v.xmin,
v.ymax],[v.xmax,v.ymax],[v.xmax,v.ymin],[v.xmin,v.ymin]]]}:v;B=(await c.normalizeCentralMeridian(b.fromJSON(v)))[0];if(null==B)throw h;const t="quantizationParameters"in u&&u.quantizationParameters?.tolerance||"maxAllowableOffset"in u&&u.maxAllowableOffset||0;v=t&&g(v,y)?{densificationStep:8*t}:void 0;B=B.toJSON();v=f.project(B,B.spatialReference,y,v);if(!v)throw h;v.spatialReference=y;u.geometry=v}return u}function g(u,v){if(!u)return!1;const y=u.spatialReference;return(b.isExtent(u)||b.isPolygon(u)||
b.isPolyline(u))&&!d.equals(y,v)&&!l.canProjectWithoutEngine(y,v)}async function x(u){const {distance:v,units:y}=u,B=u.geometry;if(null==v||"vertexAttributes"in B)return B;var t=B.spatialReference;u=y?e.fromJSON(y):k.getUnitString(t);t=t&&(d.isGeographic(t)||d.isWebMercator(t))?B:await f.checkProjectionSupport(t,d.wgs84).then(()=>f.project(B,d.wgs84));return(await n())(t.spatialReference,t,v,u)}async function n(){return(await new Promise((u,v)=>a(["../../../geometry/geometryEngineJSON"],u,v))).geodesicBuffer}
const e=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({});q.normalizeQuery=async function(u,v,y){const {outFields:B,orderByFields:t,groupByFieldsForStatistics:w,outStatistics:C}=u;if(B)for(var z=0;z<B.length;z++)B[z]=B[z].trim();if(t)for(z=0;z<t.length;z++)t[z]=t[z].trim();if(w)for(z=0;z<w.length;z++)w[z]=w[z].trim();
if(C)for(z=0;z<C.length;z++)C[z].onStatisticField&&(C[z].onStatisticField=C[z].onStatisticField.trim());u.geometry&&!u.outSR&&(u.outSR=u.geometry.spatialReference);return p(u,v,y)};q.normalizeQueryLike=p;q.queryEngineEmptyResult=h;q.unitsKebabDict=e;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),
function(a,q,r,k,l,m){function b(g,x,n){const {outFields:e,orderByFields:h,returnDistinctValues:u,outStatistics:v}=n,y=v?v.map(B=>B.outStatisticFieldName&&B.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(h&&0<h.length){const B=h.map(t=>{const w=t.toLowerCase();return w.includes(" asc")?w.split(" asc")[0]:w.includes(" desc")?w.split(" desc")[0]:t}).filter(t=>!y.includes(t));r.validateFields(g,x,B,{expressionName:"orderByFields",query:n})}if(e&&0<e.length)r.validateFields(g,x,e,{expressionName:"outFields",
query:n,allowedFieldTypes:"all"});else if(u)throw new q("unsupported-query","outFields should be specified for returnDistinctValues",{query:n});r.validateWhere(g,x,n.where,n)}function c(g,x,n){const {outStatistics:e,groupByFieldsForStatistics:h,having:u}=n;var v=h?.length,y=e?.length;if(u){if(!v||!y)throw new q("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:n});r.validateHaving(g,x,u,e,n)}if(y&&f(e)){y=e.map(B=>B.onStatisticField).filter(Boolean);
r.validateFields(g,x,y,{expressionName:"onStatisticFields",query:n});v&&r.validateFields(g,x,h,{expressionName:"groupByFieldsForStatistics",query:n});for(const B of e){const {onStatisticField:t,statisticType:w}=B;if(("percentile_disc"===w||"percentile_cont"===w)&&"statisticParameters"in B){if({statisticParameters:v}=B,!v)throw new q("unsupported-query","statisticParameters should be set for percentile type",{definition:B,query:n});}else g.get(t)&&"count"!==w&&"min"!==w&&"max"!==w&&r.validateFields(g,
x,[t],{expressionName:`outStatistics with '${w}' statistic type`,allowedFieldTypes:p,query:n})}}}async function d(g,x,n,e){var h=[];n.valueExpression&&({arcadeUtils:h}=await m.loadArcade(),h=h.extractFieldNames(n.valueExpression));n.field&&h.push(n.field);n.field2&&h.push(n.field2);n.field3&&h.push(n.field3);n.normalizationField&&h.push(n.normalizationField);if(!h.length&&!n.valueExpression)throw new q("unsupported-query","field or valueExpression is required",{params:n});r.validateFields(g,x,h,{expressionName:"statistics",
query:e})}function f(g){return null!=g&&g.every(x=>"exceedslimit"!==x.statisticType)}const p=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);a.validateQuery=async function(g,{fieldsIndex:x,geometryType:n,spatialReference:e,availableFields:h}){if(0>(g.distance??0)||null!=g.geometryPrecision||g.multipatchOption&&"xyFootprint"!==g.multipatchOption||g.pixelSize||g.relationParam||g.text)throw new q("unsupported-query","Unsupported query options",{query:g});b(x,h,g);c(x,h,g);return Promise.all([l.checkSpatialQuerySupport(g,
n,e),k.checkProjectionSupport(e,g.outSR)]).then(()=>g)};a.validateStatisticsQuery=async function(g,x,{fieldsIndex:n,geometryType:e,spatialReference:h,availableFields:u}){if(0>(g.distance??0)||null!=g.geometryPrecision||g.multipatchOption||g.pixelSize||g.relationParam||g.text||g.outStatistics||g.groupByFieldsForStatistics||g.having||g.orderByFields)throw new q("unsupported-query","Unsupported query options",{query:g});b(n,u,g);return Promise.all([d(n,u,x,g),l.checkSpatialQuerySupport(g,e,h),k.checkProjectionSupport(h,
g.outSR)]).then(()=>g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g){function x(){return new Promise((v,
y)=>a(["../../../geometry/geometryEngineJSON"],v,y))}const n={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var e={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,
esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},h={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},u={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};q.canQueryWithRBush=function(v){if(m.isExtent(v))return!0;if(m.isPolygon(v)){for(const y of v.rings)if(5!==
y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};q.checkSpatialQuerySupport=async function(v,y,B){const {spatialRel:t,geometry:w}=v;if(w){if(null==t||!0!==e[t])throw new r("unsupported-query","Unsupported query spatial relationship",{query:v});if(b.isValid(w.spatialReference)&&b.isValid(B)){if(null==w||!0!==h[m.getJsonType(w)])throw new r("unsupported-query","Unsupported query geometry type",{query:v});
if(null==y||!0!==u[y])throw new r("unsupported-query","Unsupported layer geometry type",{query:v});if(v.outSR)return g.checkProjectionSupport(v.geometry?.spatialReference,v.outSR)}}};q.getSpatialQueryOperator=function(v,y,B,t,w){if(m.isPolygon(y)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===v||"esriSpatialRelContains"===v)){const C=d.convertFromPolygon(new f,y,!1,!1);return Promise.resolve(z=>c.polygonContainsPoint(C,!1,!1,z))}if(m.isPolygon(y)&&"esriGeometryMultipoint"===B){const C=d.convertFromPolygon(new f,
y,!1,!1);if("esriSpatialRelContains"===v)return Promise.resolve(z=>c.polygonContainsMultipoint(C,!1,!1,z,t,w))}if(m.isExtent(y)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===v||"esriSpatialRelContains"===v))return Promise.resolve(C=>k.extentContainsPoint(y,p.getGeometry(B,t,w,C)));if(m.isExtent(y)&&"esriGeometryMultipoint"===B&&"esriSpatialRelContains"===v)return Promise.resolve(C=>k.extentContainsMultipoint(y,p.getGeometry(B,t,w,C)));if(m.isExtent(y)&&"esriSpatialRelIntersects"===v){const C=
l.getExtentIntersector(B);return Promise.resolve(z=>C(y,p.getGeometry(B,t,w,z)))}return x().then(C=>{const z=C[n[v]].bind(null,y.spatialReference,y);return D=>z(p.getGeometry(B,t,w,D))})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,q){a.extentIntersectsExtent=q.extentIntersectsExtent;a.extentIntersectsMultipoint=q.extentIntersectsMultipoint;a.extentIntersectsPoint=q.extentIntersectsPoint;
a.extentIntersectsPolygon=q.extentIntersectsPolygon;a.extentIntersectsPolyline=q.extentIntersectsPolyline;a.extentIntersectsRings=q.extentIntersectsRings;a.getFeatureExtentIntersector=q.getFeatureExtentIntersector;a.isSelfIntersecting=q.isSelfIntersecting;a.segmentIntersects=q.segmentIntersects;a.getExtentIntersector=function(r){return"mesh"===r?q.extentIntersectsExtent:q.getFeatureExtentIntersector(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(a){function q(r,k,l,m,b){if(!r)return!1;k=k?l?4:3:l?3:2;const {coords:c,lengths:d}=r;l=!1;r=0;for(const p of d){var f=r;for(let g=r,x=r+p*k;g<x;g+=k){f=g+k;f===x&&(f=r);const n=c[g],e=c[g+1],h=c[f];f=c[f+1];(e<b&&f>=b||f<b&&e>=b)&&n+(b-e)/(f-e)*(h-n)<m&&(l=!l)}r+=p*k}return l}a.polygonContainsCoords=q;a.polygonContainsMultipoint=function(r,k,l,m,b,c){b=b?c?4:3:c?3:2;const {coords:d,lengths:f}=m;if(!f)return!1;for(let p=0,g=0;p<f.length;p++,g+=b)if(!q(r,k,l,d[g],d[g+1]))return!1;return!0};
a.polygonContainsPoint=function(r,k,l,m){return q(r,k,l,m.coords[0],m.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function q(l,m,b,c,d){if(null!=c&&null!=d)return f=>{const p=l(f,m);f=l(f,b);return(null==p||p<=d)&&(null==f||f>=c)};if(null!=c)return f=>{f=l(f,b);return null==f||f>=c};if(null!=d)return f=>{f=l(f,m);return null==f||f<=d}}function r(l,m,b,c){if(null!=b&&null!=c&&b===c)return d=>
l(d,m)===b;if(null!=b&&null!=c)return d=>{d=l(d,m);return null!=d&&d>=b&&d<=c};if(null!=b)return d=>{d=l(d,m);return null!=d&&d>=b};if(null!=c)return d=>{d=l(d,m);return null!=d&&d<=c}}function k(){return()=>!1}a.getTimeExtent=async function(l,m){if(!l)return null;const b=m.featureAdapter,{startTimeField:c,endTimeField:d}=l;let f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(c&&d)await m.forEach(g=>{const x=b.getAttribute(g,c);g=b.getAttribute(g,d);null==x||isNaN(x)||(f=Math.min(f,x));null==
g||isNaN(g)||(p=Math.max(p,g))});else{const g=c||d;await m.forEach(x=>{x=b.getAttribute(x,g);null==x||isNaN(x)||(f=Math.min(f,x),p=Math.max(p,x))})}return{start:f,end:p}};a.getTimeOperator=function(l,m,b){if(!m||!l)return null;const {startTimeField:c,endTimeField:d}=l;if(!c&&!d)return null;const {start:f,end:p}=m;if(null===f&&null===p)return null;if(void 0===f&&void 0===p)return k();l=b.getAttributeAsTimestamp?.bind(b)??b.getAttribute.bind(b);return c&&d?q(l,c,d,f,p):r(l,c||d,f,p)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e){function h(G){return u.has(G)?u.get(G):"number"===typeof G?G:1}a.TaskPriority=
void 0;(function(G){G.RESOURCE_CONTROLLER_IMMEDIATE="immediate";G.RESOURCE_CONTROLLER="schedule";G.SLIDE="slide";G.STREAM_DATA_LOADER="stream loader";G.ELEVATION_QUERY="elevation query";G.TERRAIN_SURFACE="terrain";G.SURFACE_GEOMETRY_UPDATES="surface geometry updates";G.LOD_RENDERER="LoD renderer";G.GRAPHICS_CORE="Graphics3D";G.I3S_CONTROLLER="I3S";G.POINT_CLOUD_LAYER="point cloud";G.FEATURE_TILE_FETCHER="feature fetcher";G.OVERLAY="overlay";G.STAGE="stage";G.GRAPHICS_DECONFLICTOR="graphics deconflictor";
G.FILTER_VISIBILITY="Graphics3D filter visibility";G.SCALE_VISIBILITY="Graphics3D scale visibility";G.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";G.POINT_OF_INTEREST_FREQUENT="POI frequent";G.POINT_OF_INTEREST_INFREQUENT="POI infrequent";G.LABELER="labeler";G.FEATURE_QUERY_ENGINE="feature query";G.FEATURE_TILE_TREE="feature tile tree";G.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";G.ELEVATION_ALIGNMENT="elevation alignment";G.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";G.TEXT_TEXTURE_ATLAS=
"text texture atlas";G.TEXTURE_UNLOAD="texture unload";G.LINE_OF_SIGHT_TOOL="line of sight tool";G.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";G.ELEVATION_PROFILE="elevation profile";G.SNAPPING="snapping";G.SHADOW_ACCUMULATOR="shadow accumulator";G.CLOUDS_GENERATOR="clouds generator";G[G.NONE=0]="NONE";G[G.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority={}));const u=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,
0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,
4],[a.TaskPriority.CLOUDS_GENERATOR,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.ELEVATION_ALIGNMENT_SCENE,14],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,
0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),v=p.Milliseconds(6.5),y=p.Milliseconds(1),B=p.Milliseconds(30),t=p.Milliseconds(1E3/30),w=p.Milliseconds(100);var C;(function(G){class A{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(K=>K.needsUpdate)}constructor(){this._updating=f.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new m("total"),tasks:new Map};this._frameTaskTimes=new Map;
this._budget=new J;this._state=n.RenderState.INTERACTING;this._tasks=new b;this._runQueue=new b;this._load=0;this._idleStateCallbacks=new b;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=d.watch(()=>x.SCHEDULER_LOG_SLOW_TASKS,P=>this._debug=P,d.initial);for(const P of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[P],new m(a.TaskPriority[P]));const K=this;this._test={FRAME_SAFETY_BUDGET:v,INTERACTING_BUDGET:t,IDLE_BUDGET:w,get availableBudget(){return K._budget.budget},
usedBudget:0,getBudget:()=>K._budget,setBudget:P=>K._budget=P,updateTask:P=>this._updateTask(P),getState:P=>this._getState(P),getRuntime:P=>this._getRuntime(P),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(K=>K.remove());this._tasks.clear();l.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(K){this._updatingChanged();K&&0<this._budget.remaining&&
!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(K,P){P=new F(this,K,P);this._tasks.push(P);this._updatingChanged();this.performanceInfo.tasks.has(K)||this.performanceInfo.tasks.set(K,new m(K));return P}registerIdleStateCallbacks(K,P){const E={idleBegin:K,idleEnd:P};this._idleStateCallbacks.push(E);this.state===n.RenderState.IDLE&&this._idleUpdatesStartFired&&
E.idleBegin();const M=this;return{remove:()=>this._removeIdleStateCallbacks(E),set idleBegin(T){M._idleUpdatesStartFired&&(E.idleEnd(),M._state===n.RenderState.IDLE&&T());E.idleBegin=T},set idleEnd(T){E.idleEnd=T}}}get load(){return this._load}set state(K){this._state!==K&&(this._state=K,this.state!==n.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(P=>P.idleEnd())))}get state(){return this._state}updateBudget(K){this._test.usedBudget=
0;++this._frameNumber;let P=v,E=K.frameDuration,M=y;switch(this.state){case n.RenderState.IDLE:P=p.Milliseconds(0);E=p.Milliseconds(Math.max(w,K.frameDuration));M=B;break;case n.RenderState.INTERACTING:E=p.Milliseconds(Math.max(t,K.frameDuration))}E=p.Milliseconds(E-K.elapsedFrameTime-P);if(this.state!==n.RenderState.IDLE&&E<y&&!this._forceTask)return this._forceTask=!0,!1;E=p.Milliseconds(Math.max(E,M));this._budget.reset(E,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=
this._forceTask=!1;switch(this.state){case n.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(K=>K.idleBegin()));this._runIdle();break;case n.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(p.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(K){this._idleUpdatesStartFired&&K.idleEnd();this._idleStateCallbacks.removeUnordered(K)}removeTask(K){this._tasks.removeUnordered(K);
this._runQueue.removeUnordered(K);this._updatingChanged()}_updateTask(K){this._tasks.forAll(P=>{P.name===K&&P.setPriority(K)})}_getState(K){if(this._runQueue.some(E=>E.name===K))return a.TaskState.SCHEDULED;let P=a.TaskState.IDLE;this._tasks.forAll(E=>{E.name===K&&E.needsUpdate&&(1>=E.schedulePriority?P=a.TaskState.READY:P!==a.TaskState.READY&&(P=a.TaskState.WAITING))});return P}_getRuntime(K){let P=0;this._tasks.forAll(E=>{E.name===K&&(P+=E.runtime)});return P}_resetRuntimes(){this._tasks.forAll(K=>
K.runtime=0)}_getRunning(){const K=new Map;this._tasks.forAll(E=>{E.needsUpdate&&K.set(E.name,(K.get(E.name)||0)+1)});if(0===K.size)return null;let P="";K.forEach((E,M)=>{P=1<E?P+` ${E}x ${M}`:P+` ${M}`});return P}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const K=this._tasks.reduce((P,E)=>E.needsUpdate?++P:P,0);this._load=.9*this._load+K*(1-.9)}_schedule(){this._runQueue.filterInPlace(K=>{if(K.needsUpdate)return!0;K.schedulePriority=K.basePriority;
return!1});for(this._tasks.forAll(K=>{0===K.basePriority&&K.needsUpdate&&!this._runQueue.includes(K)&&K.blockFrame!==this._frameNumber&&this._runQueue.unshift(K)});0===this._runQueue.length;){let K=!1;this._tasks.forAll(P=>{if(P.needsUpdate&&0!==P.schedulePriority&&0!==P.basePriority&&P.blockFrame!==this._frameNumber)switch(K=!0,P.schedulePriority){case 1:P.schedulePriority=0;this._runQueue.push(P);break;default:--P.schedulePriority}});if(!K)return this._updatingChanged(),!1}this._updatingChanged();
return!0}_run(){const K=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var P=this._budget.now();const E=this._runQueue.pop();this._budget.resetProgress();try{E.task.runTask(this._budget)===e.Yield&&(E.blockFrame=this._frameNumber)}catch(M){k.getLogger("esri.views.support.Scheduler").error(`Exception in task "${E.name}"`,M),E.blockFrame=this._frameNumber}!this._budget.hasProgressed&&E.blockFrame!==this._frameNumber&&E.needsUpdate&&(E.blockFrame=this._frameNumber);
E.schedulePriority=E.basePriority;P=this._budget.now()-P;E.runtime+=P;this._frameTaskTimes.set(E.priority,this._frameTaskTimes.get(E.priority)+P);this._debug&&P>2*this._budget.budget&&console.log("Task",E.name,"used",P,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-K);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-K)}_startFrameTaskTimes(){for(const K of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[K],
0)}_recordFrameTaskTimes(K){this._frameTaskTimes.forEach((P,E)=>this.performanceInfo.tasks.get(E).record(P));this.performanceInfo.total.record(K)}get test(){return this._test}}G.Scheduler=A;class F{get task(){return this._task.value}get updating(){return this._queue.running}constructor(K,P,E){this._scheduler=K;this.name=P;this.runtime=this.blockFrame=0;this._queue=new g.PromiseQueue;this._handles=new q;this.schedulePriority=this._basePriority=h(P);this._task=f.signal(null!=E?E:this._queue);this._handles.add(d.when(()=>
this.task.running,M=>K.taskRunningChanged(M)))}remove(){this.processQueue(z);this._scheduler.removeTask(this);this.schedule=H.schedule;this.reschedule=H.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(K){if(this.name!==K){this.name=K;K=h(K);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=K;this._basePriority=K}}get priority(){return this.name}set priority(K){this.setPriority(K)}get needsUpdate(){return this.updating||this.task.running}schedule(K,
P,E){return this._queue.push(K,P,E)}reschedule(K,P,E){return this._queue.unshift(K,P,E)}processQueue(K){return this._queue.runTask(K)}}class J{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=n.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(K){if(this.done)return!1;!0===K()&&this.madeProgress();return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=
this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(K){this._enabled=K}reset(K,P){this._begin=this.now();this._budget=K;this._state=P;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=this._progressed=!1}get hasProgressed(){return this._progressed}}G.Budget=J})(C||={});a.TaskState=void 0;(function(G){G.SCHEDULED=
"s";G.READY="r";G.WAITING="w";G.IDLE="i"})(a.TaskState||(a.TaskState={}));const z=(()=>{const G=new C.Budget;G.enabled=!1;return G})();class D{remove(){}processQueue(){}schedule(G,A,F){try{if(c.isAborted(A)){const J=c.createAbortError();return F?Promise.resolve(F(J)):Promise.reject(J)}return c.when(G(z))}catch(J){return Promise.reject(J)}}reschedule(G,A,F){return this.schedule(G,A,F)}}const H=new D;a.ImmediateTask=H;a.getTaskPriority=h;a.newScheduler=function(){return new C.Scheduler};a.noBudget=
z;a.taskPriorities=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(a,q,r,k){class l{constructor(){this._tasks=[];this._runningTasks=r.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(b){if(0===this.length)return k.Yield;for(;!b.done&&this._process(b);)b.madeProgress()}push(b,
c,d){++this._runningTasks.value;return(new Promise((f,p)=>this._tasks.push(new m(f,p,b,c,d)))).finally(()=>--this._runningTasks.value)}unshift(b,c,d){++this._runningTasks.value;return(new Promise((f,p)=>this._tasks.unshift(new m(f,p,b,c,d)))).finally(()=>--this._runningTasks.value)}_process(b){if(0===this._tasks.length)return!1;const c=this._tasks.shift();try{const d=q.isAborted(c.signal);if(d&&!c.abortCallback)c.reject(q.createAbortError());else{const f=d?c.abortCallback?.(q.createAbortError()):
c.callback(b);q.isPromiseLike(f)?f.then(c.resolve,c.reject):c.resolve(f)}}catch(d){c.reject(d)}return!0}cancelAll(){const b=q.createAbortError();for(const c of this._tasks)if(c.abortCallback){const d=c.abortCallback(b);c.resolve(d)}else c.reject(b);this._tasks.length=0}}class m{constructor(b,c,d,f,p){this.resolve=b;this.reject=c;this.callback=d;this.signal=f;this.abortCallback=p}}a.PromiseQueue=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],
function(a){const q=Symbol("Yield");a.Yield=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b){q=class extends q{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=
!1}};a.__decorate([r.property()],q.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([r.property()],q.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);q=a.__decorate([b.subclass("esri.views.support.DebugFlags")],q);return new q})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=void 0;var q=a.RenderState||(a.RenderState={});q[q.ANIMATING=0]="ANIMATING";q[q.INTERACTING=1]="INTERACTING";q[q.IDLE=2]="IDLE";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AProcessorStrategy":function(){define(["exports","../../../../../core/Evented","../../../../../geometry/support/aaBoundingBox","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter"],function(a,q,r,k,l){class m{constructor(c){this.subscription=c;this.handledChunks=new Set}destroy(){}*features(){}}class b{constructor(c,d){this._source=c;this._attributeStore=
d;this._sendStates=new Map;this.events=new q;this.featureAdapter=l.optimizedFeatureQueryEngineAdapter}destroy(){}onSubscribe(c){const d=this.createState(c);this._sendStates.set(c.key.id,d);this.updateChunks()}onUnsubscribe(c){this._sendStates.get(c.key.id)?.destroy();this._sendStates.delete(c.key.id)}invalidate(){const c=Array.from(this._sendStates.values());this._sendStates.clear();for(const d of c)d.destroy(),this.onSubscribe(d.subscription)}invalidateAttributeData(){}getDisplayIds(c){c=new Set(c);
const d=[];for(const f of this._sendStates.values())for(const p of f.features())c.has(p.objectId)&&(d.push(p.displayId),c.delete(p.objectId));return d}getFeatureObjectIdsForAggregate(c){throw Error("InternalError: AggregateId lookup not supported");}forEach(c){for(const d of this._sendStates.values())for(const f of d.features())c(f)}forEachInBounds(c,d){}forEachBounds(c,d){const f=r.create();for(const p of c)(c=k.getBoundsOptimizedGeometry(f,p.geometry,!1,!1))&&d(c)}}a.AProcessorStrategy=b;a.ASendState=
m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,q,r,k){a.optimizedFeatureQueryEngineAdapter={getObjectId(l){return l.objectId},getAttributes(l){return l.attributes},getAttribute(l,m){return l.attributes[m]},cloneWithGeometry(l,m){return new r.OptimizedFeature(m,l.attributes,null,l.objectId)},getGeometry(l){return l.geometry},
getCentroid(l,m){null==l.centroid&&(l.centroid=q.getCentroidOptimizedGeometry(new k,l.geometry,m.hasZ,m.hasM));return l.centroid}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function q(k,l,m,b,c,d){d=c?d?4:3:d?3:2;let f=m,p=m+d,g=0,x=0,n=m=0,e=0;for(let h=0,u=b-1;h<u;h++,f+=d,p+=d){b=l[f];const v=l[f+1],y=l[f+2],B=l[p],t=l[p+1],w=l[p+2];let C=b*t-B*v;n+=C;g+=(b+B)*C;x+=(v+t)*C;c&&(C=b*w-B*y,m+=(y+w)*C,e+=
C);b<k[0]&&(k[0]=b);b>k[1]&&(k[1]=b);v<k[2]&&(k[2]=v);v>k[3]&&(k[3]=v);c&&(y<k[4]&&(k[4]=y),y>k[5]&&(k[5]=y))}0<n&&(n*=-1);0<e&&(e*=-1);if(!n)return null;k=[g,x,.5*n];c&&(k[3]=m,k[4]=.5*e);return k}function r(k,l,m,b,c){c=b?c?4:3:c?3:2;let d=l,f=l+c,p=0,g=0,x=0,n=0;for(let v=0,y=m-1;v<y;v++,d+=c,f+=c){var e=k[d];const B=k[d+1],t=k[d+2],w=k[f],C=k[f+1],z=k[f+2];if(b){var h=w-e;var u=C-B;const D=z-t;h=Math.sqrt(h*h+u*u+D*D)}else h=w-e,u=C-B,h=Math.sqrt(h*h+u*u);h&&(p+=h,b?(e=[e+.5*(w-e),B+.5*(C-B),
t+.5*(z-t)],g+=h*e[0],x+=h*e[1],n+=h*e[2]):(e=[e+.5*(w-e),B+.5*(C-B)],g+=h*e[0],x+=h*e[1]))}return 0<p?b?[g/p,x/p,n/p]:[g/p,x/p]:0<m?b?[k[l],k[l+1],k[l+2]]:[k[l],k[l+1]]:null}a.getCentroidOptimizedGeometry=function(k,l,m,b){if(!l?.lengths.length)return null;k.lengths.length&&(k.lengths.length=0);k.coords.length&&(k.coords.length=0);const c=k.coords,d=[],f=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:
[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:p,coords:g}=l;var x=m?b?4:3:b?3:2;let n=0;for(const e of p){const h=q(f,g,n,e,m,b);h&&d.push(h);n+=e*x}d.sort((e,h)=>{let u=e[2]-h[2];0===u&&m&&(u=e[4]-h[4]);return u});d.length&&(x=6*d[0][2],c[0]=d[0][0]/x,c[1]=d[0][1]/x,m&&(x=6*d[0][4],c[2]=0!==x?d[0][3]/x:0),c[0]<f[0]||c[0]>f[1]||c[1]<f[2]||c[1]>f[3]||m&&(c[2]<f[4]||c[2]>f[5]))&&(c.length=0);if(!c.length)if(l=l.lengths[0]?r(g,0,p[0],m,
b):null)c[0]=l[0],c[1]=l[1],m&&2<l.length&&(c[2]=l[2]);else return null;return k};a.lineCentroid=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceMessage":function(){define(["exports"],function(a){class q{constructor(k,l,m,b,c){this.subscription=k;this.reader=l;this.clear=m;this.end=b;this.debugInfo=c;this.type="append"}get id(){return this.subscription.tile.id}createMessage(k,l){return{type:"append",clear:this.clear,id:this.id,
append:k,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:l}}}class r{constructor(k,l,m,b,c){this.subscription=k;this.reader=l;this.remove=m;this.end=b;this.debugInfo=c;this.type="update"}get id(){return this.subscription.tile.id}createMessage(k,l){return{type:"update",id:this.id,modify:k,debugInfo:this.debugInfo,remove:this.remove,version:l,subscriptionVesrion:this.subscription.version,end:this.end}}}a.FeatureTileAppendMessage=q;a.FeatureTileUpdateMessage=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),function(a,q,r,k,l,m,b,c,d,f){function p(n,e,h){if(!(n.length>e))for(;n.length<=e;)n.push(h)}const g=()=>r.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");
class x{constructor(n){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=n}createBitset(){const n=this._bitsets.length;this._bitsets.push(d.StaticBitSet.create(this._allocatedSize,l.displayIdTexelMask));return n+1}async createComputedField(n){if(n.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");return await b.ComputedExpression.create(n.expression,
this.compilationOptions)}catch(e){return n=new q("featurelayer","Failed to compile arcade expression",{error:e,expression:n.expression}),g().error(n),null}if(n.normalizationType||n.normalizationField)return new c.NormalizedField(n.field,n);if(n.field)return new m.CachedField(n.field);n=new q("featurelayer","Unable to create computed field. No expression or field found",{info:n});g().error(n);return null}async createWhereClause(n){return n?f.createWhereClause(n,this.compilationOptions.fields):null}getBitset(n){return this._bitsets[n-
1]}getComputedNumeric(n,e){return this.getComputedNumericAtIndex(n&l.displayIdTexelMask,0)}setComputedNumeric(n,e,h){return this.setComputedNumericAtIndex(n&l.displayIdTexelMask,h,0)}getComputedString(n,e){return this.getComputedStringAtIndex(n&l.displayIdTexelMask,0)}setComputedString(n,e,h){return this.setComputedStringAtIndex(n&l.displayIdTexelMask,0,h)}getComputedNumericAtIndex(n,e){n&=l.displayIdTexelMask;this._ensureNumeric(e,n);return this._numerics[e][n]}setComputedNumericAtIndex(n,e,h){n&=
l.displayIdTexelMask;this._ensureNumeric(e,n);this._numerics[e][n]=h}getPackedChunkId(n){n&=l.displayIdTexelMask;this._ensureInstanceId(n);return this._instanceIds[n]}setPackedChunkId(n,e){n&=l.displayIdTexelMask;this._ensureInstanceId(n);this._instanceIds[n]=e}getComputedStringAtIndex(n,e){n&=l.displayIdTexelMask;this._ensureString(e,n);return this._strings[e][n]}setComputedStringAtIndex(n,e,h){n&=l.displayIdTexelMask;this._ensureString(e,n);this._strings[e][n]=h}getXMin(n){return this._bounds[4*
(n&l.displayIdTexelMask)]}getYMin(n){return this._bounds[4*(n&l.displayIdTexelMask)+1]}getXMax(n){return this._bounds[4*(n&l.displayIdTexelMask)+2]}getYMax(n){return this._bounds[4*(n&l.displayIdTexelMask)+3]}setBounds(n,e,h=!1){const u=n&l.displayIdTexelMask;if(!h&&!this._dirtyBitset.has(n))return 4294967295!==this._bounds[4*u];this._dirtyBitset.unset(n);n=e.readGeometryWorldSpace();p(this._bounds,4*u+4,0);if(!n||!n.coords.length)return this._bounds[4*u]=4294967295,this._bounds[4*u+1]=4294967295,
this._bounds[4*u+2]=4294967295,this._bounds[4*u+3]=4294967295,!1;let v=Infinity,y=Infinity,B=-Infinity,t=-Infinity;n.forEachVertex((w,C)=>{v=Math.min(v,w);y=Math.min(y,C);B=Math.max(B,w);t=Math.max(t,C)});this._bounds[4*u]=v;this._bounds[4*u+1]=y;this._bounds[4*u+2]=B;this._bounds[4*u+3]=t;return!0}getBounds(n,e){const h=this.getXMin(e),u=this.getYMin(e),v=this.getXMax(e);e=this.getYMax(e);k.fromRectValues(n,h,u,v,e);return 4294967295!==h}_ensureNumeric(n,e){this._numerics[n]||(this._numerics[n]=
[]);p(this._numerics[n],e,0)}_ensureInstanceId(n){p(this._instanceIds,n,0)}_ensureString(n,e){this._strings[n]||(this._strings[n]=[]);p(this._strings[n],e,null)}}a.ComputedAttributeStorage=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(k){super();this._field=k}resize(k){throw Error("Method not implemented.");}read(k,l){return k.readAttribute(this._field)}readWithDefault(k,
l){return k.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}a.CachedField=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports","../../../../../support/arcadeOnDemand","../../../arcade/callExpressionWithCursor","./AComputedField"],function(a,q,r,k){class l extends k.AComputedField{static async create(m,b){m=await q.createRendererExpression(m,b.spatialReference,b.fields);
return new l(m)}constructor(m){super();this._compiled=m}resize(m){}read(m,b){return r.callExpressionWithCursor(this._compiled,m,b)}readWithDefault(m,b,c){return r.callExpressionWithCursorWithDefault(this._compiled,m,b,c)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}}a.ComputedExpression=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports",
"../../../core/has","../../../core/Logger"],function(a,q,r){function k(l){return null==l||Infinity===l||-Infinity===l||"number"===typeof l&&isNaN(l)}a.callExpressionWithCursor=function(l,m,b){if(null==l)return null;const c=m.readArcadeFeature();m.contextTimeZone=b.$view?.timeZone;try{return l.evaluate({...b,$feature:c},l.services)}catch(d){return r.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",d),null}};a.callExpressionWithCursorWithDefault=function(l,
m,b,c){if(null==l)return null!=c?c:null;m=m.readArcadeFeature();l=l.evaluate({...b,$feature:m},l.services);return k(l)?null!=c?c:null:l};a.isBadArcadeResult=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(k,l){super();this._field=k;this._normalizationInfo=l}resize(k){throw Error("Method not implemented.");}read(k,l){return this._readNormalized(k)}readWithDefault(k,
l){return this._readNormalized(k)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(k){const l=k.readAttribute(this._field);if(null==l)return null;const {normalizationField:m,normalizationTotal:b,normalizationType:c}=this._normalizationInfo;k=k.readAttribute(m);switch(c??"esriNormalizeByField"){case "esriNormalizeByField":return k?(k||void 0)&&l/k:null;case "esriNormalizeByLog":return Math.log(l)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return b?l/b*100:null}}}a.NormalizedField=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(a){class q{static fromBuffer(r,k){return new q(r,k)}static create(r,k=4294967295){r=new Uint32Array(Math.ceil(r/32));return new q(r,k)}constructor(r,k){this._mask=0;this._buf=r;this._mask=k}_getIndex(r){return Math.floor(r/32)}has(r){r&=this._mask;return!!(this._buf[this._getIndex(r)]&1<<r%32)}hasRange(r,k){for(;r%32&&r!==k;){if(this.has(r))return!0;
r++}for(;k%32&&r!==k;){if(this.has(r))return!0;k--}if(r===k)return!1;for(r/=32;r!==k/32;r++)if(this._buf[r])return!0;return!1}set(r){r&=this._mask;const k=this._getIndex(r);this._buf[k]|=1<<r%32}setRange(r,k){for(;r%32&&r!==k;)this.set(r++);for(;k%32&&r!==k;)this.set(k--);if(r!==k)for(r/=32;r!==k/32;r++)this._buf[r]=4294967295}unset(r){r&=this._mask;const k=this._getIndex(r);this._buf[k]&=4294967295^1<<r%32}resize(r){const k=this._buf;r=new Uint32Array(Math.ceil(r/32));r.set(k);this._buf=r}or(r){for(let k=
0;k<this._buf.length;k++)this._buf[k]|=r._buf[k];return this}and(r){for(let k=0;k<this._buf.length;k++)this._buf[k]&=r._buf[k];return this}xor(r){for(let k=0;k<this._buf.length;k++)this._buf[k]^=r._buf[k];return this}ior(r){for(let k=0;k<this._buf.length;k++)this._buf[k]|=~r._buf[k];return this}iand(r){for(let k=0;k<this._buf.length;k++)this._buf[k]&=~r._buf[k];return this}ixor(r){for(let k=0;k<this._buf.length;k++)this._buf[k]^=~r._buf[k];return this}any(){for(let r=0;r<this._buf.length;r++)if(this._buf[r])return!0;
return!1}copy(r){for(let k=0;k<this._buf.length;k++)this._buf[k]=r._buf[k];return this}clone(){return new q(this._buf.slice(),this._mask)}clear(){for(let r=0;r<this._buf.length;r++)this._buf[r]=0;return this}forEachSet(r){for(let k=0;k<this._buf.length;k++){let l=this._buf[k],m=32*k;if(l)for(;l;)l&1&&r(m),l>>>=1,m++}}countSet(){let r=0;this.forEachSet(k=>{r++});return r}}a.StaticBitSet=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports",
"../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(a,q,r,k){const l=()=>r.getLogger("esri.views.2d.layers.features.support.whereUtils"),m={getAttribute(b,c){return b.readAttribute(c)}};a.createWhereClause=async function(b,c){try{const d=await k.parseWhereClause(b,c);if(!d.isStandardized){const f=new q("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",d);l().error(f)}return f=>{f=f.readArcadeFeature();
return d.testFeature(f,m)}}catch(d){return l().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",b),f=>!0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilter":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f){class p{constructor(g){this._geometryBounds=r.create();this._idToVisibility=new Map;this._serviceInfo=g}static async create(g){const x=new p(g);await x.update(g.filterJSON,g.spatialReference);return x}get hash(){return this._hash}check(g){return this._applyFilter(g)}clear(){const g=this._resetAllHiddenIds();this.update();return{show:g,hide:[]}}invalidate(){this._idToVisibility.forEach((g,x)=>{this._idToVisibility.set(x,0)})}setKnownIds(g){for(const x of g)this._idToVisibility.set(x,
1)}setTrue(g){const x=[],n=[],e=new Set(g);this._idToVisibility.forEach((h,u)=>{h=!!(this._idToVisibility.get(u)&1);const v=e.has(u);!h&&v?x.push(u):h&&!v&&n.push(u);this._idToVisibility.set(u,v?3:0)});return{show:x,hide:n}}createQuery(){const {geometry:g,spatialRel:x,where:n,timeExtent:e,objectIds:h}=this;return c.fromJSON({geometry:g,spatialRel:x,where:n,timeExtent:e,objectIds:h})}async update(g,x){this._hash=JSON.stringify(g);g=await l.normalizeQueryLike(g,null,x);await Promise.all([this._setGeometryFilter(g),
this._setIdFilter(g),this._setAttributeFilter(g),this._setTimeFilter(g)])}async _setAttributeFilter(g){g?.where?(this._clause=await f.createWhereClause(g.where,this._serviceInfo.fieldsIndex),this.where=g.where):this.where=this._clause=null}_setIdFilter(g){this._idsToShow=g?.objectIds&&new Set(g.objectIds);this._idsToHide=g?.hiddenIds&&new Set(g.hiddenIds);this.objectIds=g?.objectIds}async _setGeometryFilter(g){if(g?.geometry){var x=g.geometry;g=g.spatialRel||"esriSpatialRelIntersects";var n=await m.getSpatialQueryOperator(g,
x,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);k.getBoundsXY(this._geometryBounds,x);this._spatialQueryOperator=n;this.geometry=x;this.spatialRel=g}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(g){this.timeExtent=this._timeOperator=null;g?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=g.timeExtent,this._timeOperator=b.getTimeOperator(this._serviceInfo.timeInfo,g.timeExtent,d.FeatureStoreQueryAdapter.Shared)):(g=new a("feature-layer-view:time-filter-not-available",
"Unable to apply time filter, as layer doesn't have time metadata.",g.timeExtent),q.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(g)))}_applyFilter(g){return this._filterByGeometry(g)&&this._filterById(g)&&this._filterByTime(g)&&this._filterByExpression(g)}_filterByExpression(g){return this.where?this._clause(g):!0}_filterById(g){return(!this._idsToHide?.size||!this._idsToHide.has(g.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(g.getObjectId()))}_filterByGeometry(g){return this.geometry?
(g=g.readGeometryWorldSpace())?this._spatialQueryOperator(g):!1:!0}_filterByTime(g){return null==this._timeOperator?!0:this._timeOperator(g)}_resetAllHiddenIds(){const g=[];this._idToVisibility.forEach((x,n)=>{x&1||(this._idToVisibility.set(n,1),g.push(n))});return g}}return p})},"esri/rest/support/Query":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../../layers/support/source/DataLayerSource ./FullTextSearch ./QuantizationParameters ./spatialRelationships ./StatisticDefinition ../../geometry/SpatialReference ../../geometry/Point".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v,y,B){var t;k=new k.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let w=t=class extends l.JSONSupport{static from(C){return g.ensureClass(t,C)}constructor(C){super(C);this.aggregateIds=null;this.cacheHint=void 0;this.compactGeometryEnabled=!1;this.datumTransformation=null;this.defaultSpatialReferenceEnabled=
!1;this.dynamicDataSource=this.distance=void 0;this.geometry=this.gdbVersion=this.fullText=this.formatOf3DObjects=null;this.geometryPrecision=void 0;this.historicMoment=this.having=this.groupByFieldsForStatistics=null;this.maxAllowableOffset=void 0;this.maxRecordCountFactor=1;this.multipatchOption=null;this.num=void 0;this.resultType=this.relationParameter=this.rangeValues=this.quantizationParameters=this.pixelSize=this.parameterValues=this.outStatistics=this.outSpatialReference=this.outFields=this.orderByFields=
this.objectIds=null;this.returnDistinctValues=this.returnCentroid=!1;this.returnExceededLimitFeatures=!0;this.returnQueryGeometry=this.returnGeometry=!1;this.returnZ=this.returnM=void 0;this.sourceSpatialReference=null;this.spatialRelationship="intersects";this.start=void 0;this.timeExtent=this.text=this.sqlFormat=null;this.timeReferenceUnknownClient=!1;this.where=this.units=null}castDatumTransformation(C){return"number"===typeof C||"object"===typeof C?C:null}writeHistoricMoment(C,z){z.historicMoment=
C&&C.getTime()}writeParameterValues(C,z){if(C){const D={};for(const H in C){const G=C[H];Array.isArray(G)?D[H]=G.map(A=>A instanceof Date?A.getTime():A):D[H]=G instanceof Date?G.getTime():G}z.parameterValues=D}}writeStart(C,z){z.resultOffset=this.start;z.resultRecordCount=this.num||10;z.where="1\x3d1"}writeWhere(C,z){z.where=C||"1\x3d1"}clone(){return new t(m.clone({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,
defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,
num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,
returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};w.MAX_MAX_RECORD_COUNT_FACTOR=5;a.__decorate([b.property({json:{write:!0}})],
w.prototype,"aggregateIds",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],w.prototype,"cacheHint",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"compactGeometryEnabled",void 0);a.__decorate([b.property({json:{write:!0}})],w.prototype,"datumTransformation",void 0);a.__decorate([c.cast("datumTransformation")],w.prototype,"castDatumTransformation",null);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"defaultSpatialReferenceEnabled",
void 0);a.__decorate([b.property({type:Number,json:{write:{overridePolicy(C){return{enabled:0<C}}}}})],w.prototype,"distance",void 0);a.__decorate([b.property({type:n.DataLayerSource,json:{write:!0}})],w.prototype,"dynamicDataSource",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"formatOf3DObjects",void 0);a.__decorate([b.property({type:[e],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&0<this.fullText.length}}}}})],w.prototype,"fullText",
void 0);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"gdbVersion",void 0);a.__decorate([b.property({types:q.geometryTypes,json:{read:x.fromJSON,write:!0}})],w.prototype,"geometry",void 0);a.__decorate([b.property({type:Number,json:{write:!0}})],w.prototype,"geometryPrecision",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],w.prototype,"groupByFieldsForStatistics",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"having",void 0);
a.__decorate([b.property({type:Date})],w.prototype,"historicMoment",void 0);a.__decorate([p.writer("historicMoment")],w.prototype,"writeHistoricMoment",null);a.__decorate([b.property({type:Number,json:{write:!0}})],w.prototype,"maxAllowableOffset",void 0);a.__decorate([b.property({type:Number,cast(C){return 1>C?1:C>w.MAX_MAX_RECORD_COUNT_FACTOR?w.MAX_MAX_RECORD_COUNT_FACTOR:C},json:{write:{overridePolicy(C){return{enabled:1<C}}}}})],w.prototype,"maxRecordCountFactor",void 0);a.__decorate([b.property({type:["xyFootprint"],
json:{write:!0}})],w.prototype,"multipatchOption",void 0);a.__decorate([b.property({type:Number,json:{read:{source:"resultRecordCount"}}})],w.prototype,"num",void 0);a.__decorate([b.property({json:{write:!0}})],w.prototype,"objectIds",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],w.prototype,"orderByFields",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],w.prototype,"outFields",void 0);a.__decorate([b.property({type:y,json:{name:"outSR",write:!0}})],w.prototype,
"outSpatialReference",void 0);a.__decorate([b.property({type:[v],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&0<this.outStatistics.length}}}}})],w.prototype,"outStatistics",void 0);a.__decorate([b.property({json:{write:!0}})],w.prototype,"parameterValues",void 0);a.__decorate([p.writer("parameterValues")],w.prototype,"writeParameterValues",null);a.__decorate([b.property({type:B,json:{write:!0}})],w.prototype,"pixelSize",void 0);a.__decorate([b.property({type:h,
json:{write:!0}})],w.prototype,"quantizationParameters",void 0);a.__decorate([b.property({type:[Object],json:{write:!0}})],w.prototype,"rangeValues",void 0);a.__decorate([b.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],w.prototype,"relationParameter",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"resultType",void 0);a.__decorate([b.property({type:Boolean,
json:{default:!1,write:!0}})],w.prototype,"returnCentroid",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"returnDistinctValues",void 0);a.__decorate([b.property({type:Boolean,json:{default:!0,write:!0}})],w.prototype,"returnExceededLimitFeatures",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],w.prototype,"returnGeometry",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"returnQueryGeometry",void 0);
a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"returnM",void 0);a.__decorate([b.property({type:Boolean,json:{write:{overridePolicy(C){return{enabled:C}}}}})],w.prototype,"returnZ",void 0);a.__decorate([b.property({type:y,json:{write:!0}})],w.prototype,"sourceSpatialReference",void 0);a.__decorate([d.enumeration(u.spatialRelKebabDict,{ignoreUnknown:!1,name:"spatialRel"})],w.prototype,"spatialRelationship",void 0);a.__decorate([b.property({type:Number,json:{read:{source:"resultOffset"}}})],
w.prototype,"start",void 0);a.__decorate([p.writer("start"),p.writer("num")],w.prototype,"writeStart",null);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"sqlFormat",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],w.prototype,"text",void 0);a.__decorate([b.property({type:r,json:{write:!0}})],w.prototype,"timeExtent",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],w.prototype,"timeReferenceUnknownClient",void 0);a.__decorate([d.enumeration(k,
{ignoreUnknown:!1}),b.property({json:{write:{overridePolicy(C){return{enabled:!!C&&null!=this.distance&&0<this.distance}}}}})],w.prototype,"units",void 0);a.__decorate([b.property({type:String,json:{write:{overridePolicy(C){return{enabled:null!=C||null!=this.start&&0<this.start}}}}})],w.prototype,"where",void 0);a.__decorate([p.writer("where")],w.prototype,"writeWhere",null);return w=t=a.__decorate([f.subclass("esri.rest.support.Query")],w)})},"esri/TimeExtent":function(){define("./chunks/tslib.es6 ./core/JSONSupport ./core/timeUtils ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./time/timeZoneUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){var g;q=g=class extends q.JSONSupport{static get allTime(){return x}static get empty(){return n}constructor(e){super(e);this.start=this.end=null}readEnd(e,h){return null!=h.end?new Date(h.end):null}writeEnd(e,h){h.end=e?.getTime()??null}get isAllTime(){return this.equals(g.allTime)}get isEmpty(){return this.equals(g.empty)}readStart(e,h){return null!=h.start?new Date(h.start):null}writeStart(e,h){h.start=e?.getTime()??null}clone(){return new g({end:this.end,start:this.start})}equals(e){if(!e)return!1;
const h=this.start?.getTime()??this.start,u=this.end?.getTime()??this.end,v=e.start?.getTime()??e.start;e=e.end?.getTime()??e.end;return h===v&&u===e}expandTo(e,h=p.system){if(this.isEmpty||this.isAllTime)return this.clone();let u=this.start;u&&=r.truncateDate(u,e,h);let v=this.end;if(v){const y=r.truncateDate(v,e,h);v=v.getTime()===y.getTime()?y:r.offsetDate(y,1,e,h)}return new g({start:u,end:v})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return g.empty;if(this.isAllTime)return e.clone();
if(e.isAllTime)return this.clone();var h=this.start?.getTime()??-Infinity;const u=this.end?.getTime()??Infinity,v=e.start?.getTime()??-Infinity;e=e.end?.getTime()??Infinity;let y,B;v>=h&&v<=u?y=v:h>=v&&h<=e&&(y=h);u>=v&&u<=e?B=u:e>=h&&e<=u&&(B=e);return null==y||null==B||isNaN(y)||isNaN(B)?g.empty:(h=new g,h.start=-Infinity===y?null:new Date(y),h.end=Infinity===B?null:new Date(B),h)}offset(e,h,u=p.system){if(this.isEmpty||this.isAllTime)return this.clone();const v=new g,{start:y,end:B}=this;null!=
y&&(v.start=r.offsetDate(y,e,h,u));null!=B&&(v.end=r.offsetDate(B,e,h,u));return v}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return x.clone();const h=null!=this.start&&null!=e.start?new Date(Math.min(this.start.getTime(),e.start.getTime())):null;e=null!=this.end&&null!=e.end?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new g({start:h,end:e})}};a.__decorate([k.property({type:Date,json:{write:{allowNull:!0}}})],
q.prototype,"end",void 0);a.__decorate([c.reader("end")],q.prototype,"readEnd",null);a.__decorate([f.writer("end")],q.prototype,"writeEnd",null);a.__decorate([k.property({readOnly:!0,json:{read:!1}})],q.prototype,"isAllTime",null);a.__decorate([k.property({readOnly:!0,json:{read:!1}})],q.prototype,"isEmpty",null);a.__decorate([k.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"start",void 0);a.__decorate([c.reader("start")],q.prototype,"readStart",null);a.__decorate([f.writer("start")],
q.prototype,"writeStart",null);q=g=a.__decorate([d.subclass("esri.TimeExtent")],q);const x=new q,n=new q({start:void 0,end:void 0});return q})},"esri/layers/support/source/DataLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/extensions/serializableProperty/reader ../Field ./MapLayerSource ./QueryTableDataSource ./RasterDataSource ./TableDataSource".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h){function u(){t||=p.createTypeReader({types:v()});return t}function v(){w||={key:"type",base:null,typeMap:{"data-layer":a.DataLayerSource,"map-layer":x.MapLayerSource}};return w}var y,B;r=r.strict()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});a.JoinTableDataSource=y=class extends k.JSONSupport{constructor(C){super(C);this.type="join-table"}readLeftTableSource(C,z,D){return u()(C,z,D)}castLeftTableSource(C){return f.ensureOneOfType(v(),
C)}readRightTableSource(C,z,D){return u()(C,z,D)}castRightTableSource(C){return f.ensureOneOfType(v(),C)}clone(){const {leftTableKey:C,rightTableKey:z,leftTableSource:D,rightTableSource:H,joinType:G}=this,A={leftTableKey:C,rightTableKey:z,leftTableSource:D?.clone()??void 0,rightTableSource:H?.clone()??void 0,joinType:G};return new y(A)}};q.__decorate([b.enumeration({joinTable:"join-table"})],a.JoinTableDataSource.prototype,"type",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],a.JoinTableDataSource.prototype,
"leftTableKey",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],a.JoinTableDataSource.prototype,"rightTableKey",void 0);q.__decorate([l.property({json:{write:!0}})],a.JoinTableDataSource.prototype,"leftTableSource",void 0);q.__decorate([c.reader("leftTableSource")],a.JoinTableDataSource.prototype,"readLeftTableSource",null);q.__decorate([m.cast("leftTableSource")],a.JoinTableDataSource.prototype,"castLeftTableSource",null);q.__decorate([l.property({json:{write:!0}})],a.JoinTableDataSource.prototype,
"rightTableSource",void 0);q.__decorate([c.reader("rightTableSource")],a.JoinTableDataSource.prototype,"readRightTableSource",null);q.__decorate([m.cast("rightTableSource")],a.JoinTableDataSource.prototype,"castRightTableSource",null);q.__decorate([b.enumeration(r)],a.JoinTableDataSource.prototype,"joinType",void 0);a.JoinTableDataSource=y=q.__decorate([d.subclass("esri.layers.support.source.JoinTableDataSource")],a.JoinTableDataSource);let t=null,w=null;m={key:"type",base:null,typeMap:{"join-table":a.JoinTableDataSource,
"query-table":n.QueryTableDataSource,raster:e.RasterDataSource,table:h.TableDataSource}};a.DataLayerSource=B=class extends k.JSONSupport{constructor(C){super(C);this.type="data-layer"}clone(){const {fields:C,dataSource:z}=this;return new B({fields:C,dataSource:z})}};q.__decorate([b.enumeration({dataLayer:"data-layer"})],a.DataLayerSource.prototype,"type",void 0);q.__decorate([l.property({type:[g],json:{write:!0}})],a.DataLayerSource.prototype,"fields",void 0);q.__decorate([l.property({types:m,json:{write:!0}})],
a.DataLayerSource.prototype,"dataSource",void 0);a.DataLayerSource=B=q.__decorate([d.subclass("esri.layers.support.source.DataLayerSource")],a.DataLayerSource);a.DataLayerSource.from=f.ensureType(a.DataLayerSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Field":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./domains ./fieldType".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g){var x;const n=new q.JSONMap({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});q=x=class extends r.JSONSupport{constructor(e){super(e);
this.alias=null;this.defaultValue=void 0;this.domain=this.description=null;this.editable=!0;this.length=void 0;this.name=null;this.nullable=!0;this.valueType=this.type=null;this.visible=!0}readDescription(e,{description:h}){e=null;try{e=h?JSON.parse(h):null}catch(u){}return e?.value??null}readValueType(e,{description:h}){e=null;try{e=h?JSON.parse(h):null}catch(u){}return e?n.fromJSON(e.fieldValueType):null}clone(){return new x({alias:this.alias,defaultValue:this.defaultValue,description:this.description,
domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};a.__decorate([k.property({type:String,json:{write:!0}})],q.prototype,"alias",void 0);a.__decorate([k.property({type:[String,Number],json:{write:{allowNull:!0}}})],q.prototype,"defaultValue",void 0);a.__decorate([k.property()],q.prototype,"description",void 0);a.__decorate([d.reader("description")],q.prototype,"readDescription",
null);a.__decorate([k.property({types:p.types,json:{read:{reader:p.fromJSON},write:!0}})],q.prototype,"domain",void 0);a.__decorate([k.property({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0);a.__decorate([k.property({type:l.Integer,json:{write:{overridePolicy(e){return{enabled:Number.isFinite(e)}}}}})],q.prototype,"length",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],q.prototype,"name",void 0);a.__decorate([k.property({type:Boolean,json:{write:!0}})],q.prototype,
"nullable",void 0);a.__decorate([c.enumeration(g.kebabDict)],q.prototype,"type",void 0);a.__decorate([k.property()],q.prototype,"valueType",void 0);a.__decorate([d.reader("valueType",["description"])],q.prototype,"readValueType",null);a.__decorate([k.property({type:Boolean,json:{read:!1}})],q.prototype,"visible",void 0);return q=x=a.__decorate([f.subclass("esri.layers.support.Field")],q)})},"esri/layers/support/domains":function(){define("exports ../../core/has ./CodedValueDomain ./Domain ./InheritedDomain ./RangeDomain".split(" "),
function(a,q,r,k,l,m){q={key:"type",base:k,typeMap:{range:m,"coded-value":r,inherited:l}};a.CodedValueDomain=r;a.DomainBase=k;a.InheritedDomain=l;a.RangeDomain=m;a.fromJSON=function(b){if(!b?.type)return null;switch(b.type){case "range":return m.fromJSON(b);case "codedValue":return r.fromJSON(b);case "inherited":return l.fromJSON(b)}return null};a.types=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CodedValueDomain":function(){define("../../chunks/tslib.es6 ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./CodedValue ./Domain".split(" "),
function(a,q,r,k,l,m,b,c,d){var f;k=f=class extends d{constructor(p){super(p);this.codedValues=null;this.type="coded-value"}getName(p){let g=null;if(this.codedValues){const x=String(p);this.codedValues.some(n=>{String(n.code)===x&&(g=n.name);return!!g})}return g}clone(){return new f({codedValues:q.clone(this.codedValues),name:this.name})}};a.__decorate([r.property({type:[c.CodedValue],json:{write:!0}})],k.prototype,"codedValues",void 0);a.__decorate([m.enumeration({codedValue:"coded-value"})],k.prototype,
"type",void 0);return k=f=a.__decorate([b.subclass("esri.layers.support.CodedValueDomain")],k)})},"esri/layers/support/CodedValue":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c){var d;a.CodedValue=d=class extends r.JSONSupport{constructor(f){super(f);this.code=this.name=null}clone(){return new d({name:this.name,
code:this.code})}};q.__decorate([k.property({type:String,json:{write:!0}})],a.CodedValue.prototype,"name",void 0);q.__decorate([k.property({type:[String,Number],json:{write:!0}})],a.CodedValue.prototype,"code",void 0);a.CodedValue=d=q.__decorate([c.subclass("esri.layers.support.CodedValue")],a.CodedValue);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Domain":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c,d){q=new q.JSONMap({inherited:"inherited",codedValue:"coded-value",range:"range"});r=class extends r.JSONSupport{constructor(f){super(f);this.type=this.name=null}};a.__decorate([k.property({type:String,json:{write:!0}})],r.prototype,"name",void 0);a.__decorate([c.enumeration(q)],r.prototype,"type",void 0);return r=a.__decorate([d.subclass("esri.layers.support.Domain")],r)})},"esri/layers/support/InheritedDomain":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(a,q,r,k,l,m,b,c){var d;q=d=class extends c{constructor(f){super(f);this.type="inherited"}clone(){return new d}};a.__decorate([m.enumeration({inherited:"inherited"})],q.prototype,"type",void 0);return q=d=a.__decorate([b.subclass("esri.layers.support.InheritedDomain")],q)})},"esri/layers/support/RangeDomain":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(a,q,r,k,l,m,b,c){var d;r=d=class extends c{constructor(f){super(f);this.minValue=this.maxValue=null;this.type="range"}clone(){return new d({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};a.__decorate([q.property({json:{type:[Number],read:{source:"range",reader(f,p){return p.range?.[1]}},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(f,p,g){p[g]=[this.minValue||0,f]}}}})],r.prototype,"maxValue",void 0);a.__decorate([q.property({json:{type:[Number],
read:{source:"range",reader(f,p){return p.range?.[0]}},write:{target:"range",writer(f,p,g){p[g]=[f,this.maxValue||0]}}}})],r.prototype,"minValue",void 0);a.__decorate([m.enumeration({range:"range"})],r.prototype,"type",void 0);return r=d=a.__decorate([b.subclass("esri.layers.support.RangeDomain")],r)})},"esri/layers/support/source/MapLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c,d){var f;a.MapLayerSource=f=class extends r.JSONSupport{constructor(p){super(p);this.type="map-layer"}clone(){const {mapLayerId:p,gdbVersion:g}=this;return new f({mapLayerId:p,gdbVersion:g})}};q.__decorate([c.enumeration({mapLayer:"map-layer"})],a.MapLayerSource.prototype,"type",void 0);q.__decorate([k.property({type:l.Integer,json:{write:!0}})],a.MapLayerSource.prototype,"mapLayerId",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],a.MapLayerSource.prototype,
"gdbVersion",void 0);a.MapLayerSource=f=q.__decorate([d.subclass("esri.layers.support.source.MapLayerSource")],a.MapLayerSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/QueryTableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../geometry ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g){var x;a.QueryTableDataSource=x=class extends k.JSONSupport{constructor(n){super(n);this.type="query-table"}clone(){const {workspaceId:n,query:e,oidFields:h,spatialReference:u,geometryType:v}=this,y={workspaceId:n,query:e,oidFields:h,spatialReference:u?.clone()??void 0,geometryType:v};return new x(y)}};q.__decorate([d.enumeration({queryTable:"query-table"})],a.QueryTableDataSource.prototype,"type",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,
"workspaceId",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,"query",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,"oidFields",void 0);q.__decorate([l.property({type:p,json:{write:!0}})],a.QueryTableDataSource.prototype,"spatialReference",void 0);q.__decorate([d.enumeration(g.featureGeometryTypeKebabDictionary)],a.QueryTableDataSource.prototype,"geometryType",void 0);a.QueryTableDataSource=x=q.__decorate([f.subclass("esri.layers.support.source.QueryTableDataSource")],
a.QueryTableDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/RasterDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c,d){var f;a.RasterDataSource=f=class extends r.JSONSupport{constructor(p){super(p);
this.type="raster"}clone(){const {workspaceId:p,dataSourceName:g}=this;return new f({workspaceId:p,dataSourceName:g})}};q.__decorate([c.enumeration({raster:"raster"})],a.RasterDataSource.prototype,"type",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],a.RasterDataSource.prototype,"dataSourceName",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],a.RasterDataSource.prototype,"workspaceId",void 0);a.RasterDataSource=f=q.__decorate([d.subclass("esri.layers.support.source.RasterDataSource")],
a.RasterDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/TableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c,d){var f;a.TableDataSource=f=class extends r.JSONSupport{constructor(p){super(p);
this.type="table"}clone(){const {workspaceId:p,gdbVersion:g,dataSourceName:x}=this;return new f({workspaceId:p,gdbVersion:g,dataSourceName:x})}};q.__decorate([c.enumeration({table:"table"})],a.TableDataSource.prototype,"type",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],a.TableDataSource.prototype,"workspaceId",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],a.TableDataSource.prototype,"gdbVersion",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],
a.TableDataSource.prototype,"dataSourceName",void 0);a.TableDataSource=f=q.__decorate([d.subclass("esri.layers.support.source.TableDataSource")],a.TableDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FullTextSearch":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c){q=class extends q.ClonableMixin(r.JSONSupport){constructor(d){super(d);this.searchType=this.searchTerm=this.operator=this.onFields=null}};a.__decorate([k.property({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&0<this.onFields.length}}}}})],q.prototype,"onFields",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],q.prototype,"operator",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],q.prototype,"searchTerm",
void 0);a.__decorate([k.property({type:String,json:{write:!0}})],q.prototype,"searchType",void 0);return q=a.__decorate([c.subclass("esri.rest.support.FullTextSearch")],q)})},"esri/core/Clonable":function(){define("exports ../chunks/tslib.es6 ./Accessor ./has ./lang ./Logger ./maybe ./accessorSupport/PropertyOrigin ./accessorSupport/utils ./accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c,d,f){k=p=>{p=class extends p{clone(){var g=d.getProperties(this);b.assertIsSome(g,"unable to clone instance of non-accessor class");
var x=g.metadata;const n=g.store,e={};g=new Map;for(var h in x){var u=x[h];const v=n?.originOf(h),y=u.clonable;if(u.readOnly||!1===y||v!==c.OriginId.USER&&v!==c.OriginId.DEFAULTS&&v!==c.OriginId.WEB_MAP&&v!==c.OriginId.WEB_SCENE)continue;u=this[h];let B=null;B="function"===typeof y?y(u):"reference"===y?u:l.tryClone(u);if(null==u||null!=B)v===c.OriginId.DEFAULTS?g.set(h,B):e[h]=B}x=new (Object.getPrototypeOf(this).constructor)(e);if(g.size&&(h=d.getProperties(x)?.store))for(const [v,y]of g)h.set(v,
y,c.OriginId.DEFAULTS);return x}};return p=q.__decorate([f.subclass("esri.core.Clonable")],p)};a.Clonable=class extends k(r){};a.Clonable=q.__decorate([f.subclass("esri.core.Clonable")],a.Clonable);a.ClonableMixin=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/QuantizationParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/Extent".split(" "),
function(a,q,r,k,l,m,b,c,d,f){var p;q=new r.JSONMap({upperLeft:"upper-left",lowerLeft:"lower-left"});k=p=class extends k.JSONSupport{constructor(g){super(g);this.extent=null;this.mode="view";this.originPosition="upper-left";this.tolerance=1}clone(){return new p(l.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};a.__decorate([m.property({type:f,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],k.prototype,"extent",void 0);
a.__decorate([m.property({type:["view","edit"],json:{write:!0}})],k.prototype,"mode",void 0);a.__decorate([m.property({type:String,json:{read:q.read,write:q.write}})],k.prototype,"originPosition",void 0);a.__decorate([m.property({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],k.prototype,"tolerance",void 0);return k=p=a.__decorate([d.subclass("esri.rest.support.QuantizationParameters")],k)})},"esri/rest/support/spatialRelationships":function(){define(["exports",
"../../core/jsonMap"],function(a,q){q=new q.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});a.spatialRelKebabDict=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/rest/support/StatisticDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer".split(" "),function(a,q,r,k,l,m,b,c,d){var f;q=new q.JSONMap({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",
percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});r=f=class extends r.JSONSupport{constructor(p){super(p);this.maxVertexCount=this.maxRecordCount=this.maxPointCount=void 0;this.statisticParameters=this.statisticType=this.outStatisticFieldName=this.onStatisticField=null}writeStatisticParameters(p,g){if("percentile-continuous"===this.statisticType||"percentile-discrete"===this.statisticType)g.statisticParameters=
k.clone(p)}clone(){return new f({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:k.clone(this.statisticParameters)})}};a.__decorate([l.property({type:Number,json:{write:!0}})],r.prototype,"maxPointCount",void 0);a.__decorate([l.property({type:Number,json:{write:!0}})],r.prototype,"maxRecordCount",void 0);
a.__decorate([l.property({type:Number,json:{write:!0}})],r.prototype,"maxVertexCount",void 0);a.__decorate([l.property({type:String,json:{write:!0}})],r.prototype,"onStatisticField",void 0);a.__decorate([l.property({type:String,json:{write:!0}})],r.prototype,"outStatisticFieldName",void 0);a.__decorate([l.property({type:String,json:{read:{source:"statisticType",reader:q.read},write:{target:"statisticType",writer:q.write}}})],r.prototype,"statisticType",void 0);a.__decorate([l.property({type:Object})],
r.prototype,"statisticParameters",void 0);a.__decorate([d.writer("statisticParameters")],r.prototype,"writeStatisticParameters",null);return r=f=a.__decorate([c.subclass("esri.rest.support.StatisticDefinition")],r)})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports"],function(a){class q{getObjectId(r){return r.getObjectId()}getAttributes(r){return r.readAttributes()}getAttribute(r,k){return r.readAttribute(k)}getAttributeAsTimestamp(r,k){return r.readAttributeAsTimestamp(k)}cloneWithGeometry(r,
k){return r}getGeometry(r){return r.readGeometryWorldSpace()}getCentroid(r,k){return r.readCentroidForDisplay()}}q.Shared=new q;a.FeatureStoreQueryAdapter=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(a,q,r){class k{constructor(m){this._options=m;this._fieldsIndex="fieldsIndex"in m?r.fromJSON(m.fieldsIndex):
new r(m.fields);m.spatialReference&&(this._spatialReference=q.fromJSON(m.spatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField,types:this._options.types}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get objectIdField(){return this._options.objectIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}}
class l extends k{static create(m){return new l({fields:[],objectIdField:"uid",geometryType:null,spatialReference:m})}}a.FeatureMetadata=k;a.GraphicsMetadata=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(a,q,r,
k,l){class m extends l.FeatureSetReader{static fromFeatures(b,c){const {objectIdField:d,geometryType:f}=c,p=q.convertFromFeatures([],b,f,!1,!1,d);for(let g=0;g<p.length;g++)p[g].displayId=b[g].displayId;return m.fromOptimizedFeatures(p,c)}static fromFeatureSet(b,c){b=q.convertFromFeatureSet(b,c.objectIdField);return m.fromOptimizedFeatureSet(b,c)}static fromOptimizedFeatureSet(b,c){c=m.fromOptimizedFeatures(b.features,c);c._exceededTransferLimit=b.exceededTransferLimit;c._transform=b.transform;c._fieldsIndex=
new k(b.fields);return c}static fromOptimizedFeatures(b,c,d){b=new m(b,c);b._fieldsIndex=c.fieldsIndex;b._transform=d;return b}static empty(b){return new m([],b)}constructor(b,c){super(c);this._exceededTransferLimit=!1;this._featureIndex=-1;this._fieldsIndex=null;this._geometryType=c.geometryType;this._features=b}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}removeIds(b){const c=
new Set(b);this._features=this._features.filter(d=>!(null!=d.objectId&&c.has(d.objectId)))}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let b="";for(const c in this._current.attributes)b+=this._current.attributes[c];return b}getIndex(){return this._featureIndex}setIndex(b){this._featureIndex=b}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(b){this._current.displayId=
b}copy(){const b=new m(this._features,this.metadata);this.copyInto(b);return b}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return r.hasGeometry(this._current)?q.getQuantizedArea(this._current.geometry,2):0}_readX(){return r.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return r.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return this._current.geometry??
null}_readServerCentroid(){return this._current.centroid}_readAttribute(b,c){if(this._fieldsIndex){var d=this._fieldsIndex.get(b);if(d){d=this._current.attributes[d.name];if(null==d)return d;"esriFieldTypeTimestampOffset"===this.fields.get(b)?.type&&(d=this.parseTimestampOffset(d));return c&&this.fields.isDateField(b)?new Date(d):d}}else{c=this._current.attributes[b];if(void 0!==c)return c;b=b.toLowerCase();for(d in this._current.attributes)if(d.toLowerCase()===b)return this._current.attributes[d]}}_readAttributes(){return this._current.attributes}copyInto(b){super.copyInto(b);
b._featureIndex=this._featureIndex;b._transform=this._transform;b._fieldsIndex=this._fieldsIndex}}a.FeatureSetReaderJSON=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h){function u(A,F,J){if(!(A.length>F))for(;A.length<=F;)A.push(J)}q=k("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const v=q[0],y=q[1],B=q[2],t=q[3];q=k("featurelayer-simplify-payload-size-factors")??[1,2,4];const w=q[0],C=q[1],z=q[2],D=k("featurelayer-simplify-mobile-factor")??2,H=k("esri-mobile");class G{constructor(A){this.metadata=A;this.type="FeatureSetReader";this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];this.arcadeDeclaredClass=
"esri.arcade.Feature";this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(A,F){let J=1;const K=H?D:1;4E6<F?J=z*K:1E6<F?J=C*K:5E5<F?J=w*K:1E5<F&&(J=K);F=0;4E3<A?F=t*J:2E3<A?F=B*J:100<A?F=y:15<A&&(F=v);return F}parseTimestampOffset(A){return A}getBounds(A){u(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var F=this.readGeometryWorldSpace();if(!F)return this.setBoundsXMin(4294967295),
!1;let E=Infinity,M=Infinity,T=-Infinity,ba=-Infinity;F.forEachVertex((ea,X)=>{E=Math.min(E,ea);M=Math.min(M,X);T=Math.max(T,ea);ba=Math.max(ba,X)});this.setBoundsXMin(E);this.setBoundsYMin(M);this.setBoundsXMax(T);this.setBoundsYMax(ba);d.fromRectValues(A,E,M,T,ba);return!0}F=this.getBoundsXMin();const J=this.getBoundsYMin(),K=this.getBoundsXMax(),P=this.getBoundsYMax();d.fromRectValues(A,F,J,K,P);return!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(A){this._boundsBuffer[4*
this.getIndex()]=A}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(A){this._boundsBuffer[4*this.getIndex()+1]=A}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(A){this._boundsBuffer[4*this.getIndex()+2]=A}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(A){this._boundsBuffer[4*this.getIndex()+3]=A}readAttributeAsTimestamp(A){A=this.readAttribute(A);return"string"===typeof A?(new Date(A)).getTime():"number"===typeof A||
null==A?A:null}readAttribute(A,F=!1){var J=this._readAttribute(A,F);if(void 0!==J)return J;for(const K of this._joined)if(K.setIndex(this.getIndex()),J=K._readAttribute(A,F),void 0!==J)return J}readAttributes(){const A=this._readAttributes();for(const F of this._joined){F.setIndex(this.getIndex());const J=F._readAttributes();for(const K of Object.keys(J))A[K]=J[K]}return A}joinAttributes(A){this._joined.push(A)}removeIds(A){if(null==this._objectIdToIndex){var F=new Map;const J=this.getCursor();for(;J.next();){const K=
J.getObjectId();l.assertIsSome(K);F.set(K,J.getIndex())}this._objectIdToIndex=F}F=this._objectIdToIndex;for(const J of A.values())F.has(J)&&this._removeAtIndex(F.get(J))}readOptimizedFeatureWorldSpace(){var A=this.readGeometryWorldSpace();const F=this.readAttributes(),J=this.readCentroidWorldSpace();A=new g.OptimizedFeature(A,F,J);A.objectId=this.getObjectId();A.displayId=this.getDisplayId();return A}readLegacyFeatureForDisplay(){const A=this.readCentroidForDisplay();return{attributes:this.readAttributes(),
geometry:this.readLegacyGeometryForDisplay(),centroid:(A&&{x:A.coords[0],y:A.coords[1]})??null}}readLegacyFeatureWorldSpace(){const A=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(A&&{x:A.coords[0],y:A.coords[1]})??null}}readLegacyGeometryForDisplay(){const A=this.readGeometryForDisplay();return p.convertToGeometry(A,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const A=
this._readX(),F=this.getInTransform();return null==F?A:A*F.scale[0]+F.translate[0]}readYWorldSpace(){const A=this._readY(),F=this.getInTransform();return null==F?A:F.translate[1]-A*F.scale[1]}readGeometryForDisplay(){var A=this._readGeometryDeltaDecoded(!0);return A?A:(A=this._createGeometryFromServerCentroid())?A.deltaDecode():null}readGeometryWorldSpace(){var A=this._readGeometry();A||=this._createGeometryFromServerCentroid();if(!A)return null;A=A.clone();const F=this.getInTransform();null!=F&&
p.unquantizeOptimizedGeometry(A,A,this.hasZ,this.hasM,F);return A}readCentroidForDisplay(){const A=this.readGeometryForDisplay();return A?this._computeDisplayCentroid(A):this._readServerCentroid()}readCentroidWorldSpace(){var A=this.readGeometryForDisplay();A=A?this._computeDisplayCentroid(A):this._readServerCentroid();if(!A)return null;A=A.clone();const F=this.getInTransform();null!=F&&p.unquantizeOptimizedGeometry(A,A,this.hasZ,this.hasM,F);return A}_readGeometryDeltaDecoded(A){A=this._readGeometry(A);
return"esriGeometryPoint"!==this.geometryType&&A&&this.getInTransform()?A.deltaDecode():A}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(A){this._contextTimeZone=A}readArcadeFeature(){return this}hasField(A){return this.fields.has(A)}geometry(){var A=this.readGeometryWorldSpace();A=p.convertToGeometry(A,this.geometryType,this.hasZ,this.hasM);if(A=h.fromJSON(A)){if(!this.metadata.spatialReference)throw Error("InternalError: Expected spatial reference to be defined");A.spatialReference=
this.metadata.spatialReference}return A}autocastArcadeDate(A,F){return F&&F instanceof Date?this.isUnknownDateTimeField(A)?r.ArcadeDate.unknownDateJSToArcadeDate(F):r.ArcadeDate.dateJSAndZoneToArcadeDate(F,this.contextTimeZone??n.system):F}isUnknownDateTimeField(A){return this.metadata.fieldsIndex.getTimeZone(A)===n.unknown}field(A){let F=this.fields.get(A);if(F)switch(F.type){case "date-only":case "esriFieldTypeDateOnly":return m.DateOnly.fromReader(this.readAttribute(A,!1));case "time-only":case "esriFieldTypeTimeOnly":return b.TimeOnly.fromReader(this.readAttribute(A,
!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(A,!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(A,this.readAttribute(A,!0));default:return this.readAttribute(A,!1)}for(const J of this._joined)if(J.setIndex(this.getIndex()),F=J.fields.get(A))switch(F.type){case "date-only":case "esriFieldTypeDateOnly":return m.DateOnly.fromReader(J._readAttribute(A,!1));case "time-only":case "esriFieldTypeTimeOnly":return b.TimeOnly.fromReader(J._readAttribute(A,
!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(J._readAttribute(A,!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(A,J._readAttribute(A,!0));default:return this.readAttribute(A,!1)}throw Error(`Field ${A} does not exist`);}setField(A,F){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(A=>A.name)}castToText(A=!1){if(!A)return JSON.stringify(this.readLegacyFeatureForDisplay());
A=this.readLegacyFeatureForDisplay();if(!A)return JSON.stringify(null);A={geometry:A.geometry,attributes:{...(A.attributes??{})}};for(const F in A.attributes){const J=A.attributes[F];J instanceof Date&&(A.attributes[F]=J.getTime())}return JSON.stringify(A)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(A=null){return{attributes:this._readAttributes(),geometry:!0===A?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(A,F=null){return Promise.resolve(this.castAsJson(F))}_getExists(){return null==
this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(A){A=c.GeometryCursor.fromOptimized(A,this.geometryType);A.yFactor*=-1;return(A=f.getLabelPoint(A))?(A[1]*=-1,new x([],A)):null}copyInto(A){A._joined=this._joined;A._deleted=this._deleted;A._objectIdToIndex=this._objectIdToIndex;A._boundsBuffer=this._boundsBuffer}_readLegacyGeometryWorldSpace(){const A=this.readGeometryWorldSpace();return p.convertToGeometry(A,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const A=
this._readServerCentroid();if(!A)return null;const [F,J]=A.coords;return this._createQuantizedExtrudedGeometry(F,J)}_createQuantizedExtrudedGeometry(A,F){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(A,F):this._createQuantizedExtrudedQuad(A,F)}_createQuantizedExtrudedQuad(A,F){return new x([5],[A-1,F,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(A,F){return new x([2],[A-1,F+1,1,-1])}_removeAtIndex(A){null==this._deleted&&(this._deleted=e.StaticBitSet.create(this.getSize()));
this._deleted.set(A)}}a.FeatureSetReader=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/ClusterStrategy":function(){define("exports ../../../../../core/has ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../aggregation/ComputedAggregateField ../aggregation/GridCell ../aggregation/GridSpatialIndex ./AAggregateStrategy ./AProcessorStrategy ./support/WithDisplayId ../sources/FeatureSourceMessage ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u){class v extends p.ASendState{constructor(t){super(t);this.done=this.didSend=!1}}class y{constructor(t,w,C,z,D){this._level=t;this._scale=w;this._indexOptions=C;this._clusterRadius=z;this._store=D;this._cells=new Map;this._handledChunks=new Set;this._statistics=new Map;this._clusters=new Map}destroy(){this._clearClusters()}_clearClusters(){for(const t of this._clusters.values())this._store.releaseDisplayIdForObjectId(t.inner.id);this._clusters.clear()}clusters(){return this._clusters.values()}updateChunks(t){let w=
!1;for(const C of t)this._handledChunks.has(C.chunkId)||(this._handledChunks.add(C.chunkId),w=!0,C.getGridIndex({...this._indexOptions,scale:this._scale}).putCells(this._cells));w&&this._clusterCells();return w}async updateStatistics(t){var w=!1;for(const C of this._clusters.values())1<C.inner.count&&(w=this._updateAggregateStatistics(this._statistics,C.inner)||w);w&&(w=Array.from(this._statistics.entries()).map(([C,z])=>({fieldName:C,minValue:z.minValue,maxValue:z.maxValue})),await t.container.updateStatistics(this._level,
w))}createAggregateFeatures(t,w){t=t.subscription;const C=[],z=t.tile.transform;for(const H of this._clusters.values()){var D=H.inner.getCentroid(z);D=new k.OptimizedFeature(D,H.inner.getAttributes(),null);D.objectId=H.inner.id;D.displayId=H.displayId;const [G,A]=D.geometry.coords;G<m.tileSize&&0<=G&&A<m.tileSize&&0<=A&&C.push(D)}return u.FeatureSetReaderJSON.fromOptimizedFeatures(C,w,t.tile.transform)}_clusterCells(){var t=Array.from(this._cells.values());t=t.sort((C,z)=>z.count-C.count);this._clusters.clear();
const w=new Set;for(const C of t){if(w.has(C.id))continue;t=this._store.createDisplayIdForObjectId(C.id);t=new g.WithDisplayId(C.clone(),t);w.add(C.id);this._clusters.set(C.id,t);const z=this._clusterRadius*(1/d.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale)),D=1+this._clusterRadius/this._indexOptions.cellSize,H=C.centroidXWorld,G=C.centroidYWorld;for(let A=C.gridY-D;A<=C.gridY+D;A++)for(let F=C.gridX-D;F<=C.gridX+D;F++){if(0===A&&0===F)continue;const J=this._cells.get(c.GridCell.createId(F,
A));if(!J||w.has(J.id))continue;const K=Math.abs(J.centroidYWorld-G);Math.abs(J.centroidXWorld-H)<z&&K<z&&(t.inner.merge(J),w.add(J.id))}}}_updateAggregateStatistics(t,w){let C=!1;for(const H of w.statistics.values())if("esriFieldTypeString"!==H.field.type){var z=H.value,D=H.field;if(w=t.get(D.name)){const {minValue:G,maxValue:A}=w;D=Math.min(w.minValue,z);z=Math.max(w.maxValue,z);if(G!==D||A!==z)w.minValue=D,w.maxValue=z,C=!0}else t.set(D.name,{minValue:z,maxValue:z}),C=!0}return C}}class B extends f.AAggregateStrategy{static async create(t,
w,C,z,D){const H=new n.ComputedAttributeStorage({spatialReference:C}),G=await Promise.all(w.fields.map(async F=>b.ComputedAggregateField.create(H,F))),A=w.featureFilter?await e.create({geometryType:z.service.geometryType,hasM:!1,hasZ:!1,timeInfo:z.service.timeInfo,fieldsIndex:new l(z.service.fields),spatialReference:C,filterJSON:w.featureFilter}):null;return new B(t,w.clusterRadius,{fields:G,spatialReference:C,featureFilter:A,cellSize:w.clusterRadius/4},z,D)}constructor(t,w,C,z,D){super(z,D,C.spatialReference,
C.fields);this._connection=t;this._clusterRadius=w;this._indexOptions=C;this._metadata=new h.FeatureMetadata({geometryType:this.geometryType,objectIdField:"aggregateId",fields:[...this._indexOptions.fields,...this._source.service.fields,{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}]});this._aggregateStatistics=new Map;this._cellsPerScale=new Map}get geometryType(){return"esriGeometryPoint"}onSubscribe(t){super.onSubscribe(t);this._requiredLevel=t.tile.level;this._requiredScale=
t.tile.scale}createState(t){return new v(t)}async *applyOverride(t){this._aggregateStatistics.clear()}getDisplayIds(t){t=new Set(t);const w=[],C=this._getClusterState(this._requiredLevel,this._requiredScale);for(const z of C.clusters())t.has(z.inner.id)?(w.push(z.displayId),t.delete(z.inner.id)):1===z.inner.count&&t.has(z.inner.firstObjectId)&&(w.push(z.displayId),t.delete(z.inner.firstObjectId));return w}getDisplayFeatures(t){t=new Set(t);const w=new Set,C=[],z=[];var D=this._getClusterState(this._requiredLevel,
this._requiredScale);for(const H of D.clusters())if(t.has(H.displayId)&&!w.has(H.displayId)){D=H.inner.getCentroid(null);D=new k.OptimizedFeature(D,H.inner.getAttributes(),null);D.objectId=H.inner.id;D.displayId=H.displayId;const G=r.convertToFeature(D,this.geometryType,!1,!1);w.add(D.displayId);1===G.attributes.cluster_count?C.push(G):z.push(G)}return{features:C,aggregates:z}}getFeatureObjectIdsForAggregate(t){const w=this._getClusterState(this._requiredLevel,this._requiredScale);for(const C of w.clusters())if(C.inner.id===
t)return Array.from(C.inner.objectIds);return[]}async *updateChunks(){var t=this._source.chunks();if(t.length){var w=this._getClusterState(this._requiredLevel,this._requiredScale);if(w.updateChunks(t)||!this._source.updateTracking.updating)for(const z of this._sendStates.values())z.subscription.tile.level===this._requiredLevel&&(z.didSend=!1);t=Array.from(this._sendStates.values()).filter(z=>z.done).map(z=>z.subscription.tile.key);var C=new Set(t);for(const z of this._sendStates.values()){if(this._source.updateTracking.updating){if(t.some(D=>
D.containsChild(z.subscription.tile.key)))continue;if(z.subscription.tile.key.getChildKeys().every(D=>C.has(D)))continue}z.didSend||z.subscription.tile.level!==this._requiredLevel||(z.didSend=!0,yield*this._update(z,w,this._source))}await w.updateStatistics(this._connection)}}_getClusterState(t,w){if(null==t||null==w)throw Error("InternalError: Level and scale must be defined");let C=this._cellsPerScale.get(w);C||(C=new y(t,w,this._indexOptions,this._clusterRadius,this._attributeStore),this._cellsPerScale.set(w,
C));return C}async *_update(t,w,C){const {subscription:z}=t;if(!t.done){w=w.createAggregateFeatures(t,this._metadata);this.events.emit("changed");t.done=!C.updateTracking.updating;C=w.getCursor();for(var D=t.subscription.tile.arcadeEvaluationOptions;C.next();)this._attributeStore.setAttributeData(C.getDisplayId(),C,D);q("esri-2d-update-debug")&&console.debug(`Tile[${z.tile.key.id}] ClusterStrategy.sendUpdates`);this._attributeStore.sendUpdates();q("esri-2d-update-debug")&&console.debug(`Tile[${z.tile.key.id}] ClusterStrategy._sendUpdates.await`);
yield new x.FeatureTileUpdateMessage(t.subscription,w,[],t.done,{})}}}a.ClusterState=v;a.ClusterStrategy=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridCell":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./AccumulatedStatistics"],function(a,q,r,k){class l{static createId(m,b){return`${m}.${b}`}static create(m,b,c,d){return new l(m,b,k.AccumulatedStatistics.create(c),
d)}constructor(m,b,c,d){this.gridX=m;this.gridY=b;this._statistics=c;this._worldUnitsPerCell=d;this._yWorldTotal=this._xWorldTotal=this._count=0;this._objectIds=new Set}get id(){return l.createId(this.gridX,this.gridY)}get count(){return this._count}get statistics(){return this._statistics}get objectIds(){return this._objectIds}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const m=
new l(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);m._count=this._count;m._xWorldTotal=this._xWorldTotal;m._yWorldTotal=this._yWorldTotal;m._firstFeatureAttributes=this._firstFeatureAttributes;m._objectIds=new Set(this._objectIds);return m}insert(m,b){this._firstFeatureAttributes=0===this._count?m.readAttributes():null;this._count+=1;this._xWorldTotal+=m.readXWorldSpace();this._yWorldTotal+=m.readYWorldSpace();this._statistics.insert(m,b);this._objectIds.add(m.getObjectId())}merge(m){if(0!==
m._count){this._count+=m._count;this._firstFeatureAttributes=m._firstFeatureAttributes;this._xWorldTotal+=m._xWorldTotal;this._yWorldTotal+=m._yWorldTotal;this._statistics.merge(m._statistics);for(const b of m._objectIds.values())this._objectIds.add(b)}}getCentroid(m){const b=new r([],[this.centroidXWorld,this.centroidYWorld]);if(null!=m){const c=new r;return q.quantizeOptimizedGeometry(c,b,!1,!1,"esriGeometryPoint",m)}return b}getGeometricCentroid(m){const b=new r([],[this.gridX*this._worldUnitsPerCell+
.5*this._worldUnitsPerCell,this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell]);if(null!=m){const c=new r;return q.quantizeOptimizedGeometry(c,b,!1,!1,"esriGeometryPoint",m)}return b}getAttributes(){const m={aggregateId:this.id};for(const b of this._statistics.values())m[b.field.name]=b.value;return null!=this._firstFeatureAttributes?{...m,...this._firstFeatureAttributes}:m}}a.GridCell=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AccumulatedStatistics":function(){define(["exports",
"../../../arcade/callExpressionWithCursor"],function(a,q){function r(x){switch(x.statisticType){case "min":return new b(x);case "max":return new c(x);case "avg":return new f(x);case "avg_angle":return new p(x);case "sum":return new d(x);case "mode":return new g(x);case "count":return new d(x)}}const k=Math.PI/180;class l{static create(x){return new l(x.map(n=>r(n)))}constructor(x){this._statistics=x}values(){return this._statistics.values()}insert(x,n){for(const e of this._statistics)e.insert(x,n)}merge(x){for(let n=
0;n<this._statistics.length;n++){const e=this._statistics[n],h=x._statistics[n];if(e.field!==h.field)throw Error("InternalError: Tried to merge incompatible statistics");e.merge(h)}}clone(){return new l(this._statistics.map(x=>x.clone()))}}class m{constructor(x){this.field=x}insert(x,n){this.field.computed&&(x=this.field.computed.read(x,n),q.isBadArcadeResult(x)||this._insertValue(x))}}class b extends m{constructor(){super(...arguments);this.type="min";this.value=Number.MAX_VALUE}_insertValue(x){this.value=
Math.min(this.value,x)}merge(x){this.value=Math.min(this.value,x.value)}clone(){const x=new b(this.field);x.value=this.value;return x}}class c extends m{constructor(){super(...arguments);this.type="max";this.value=Number.MIN_VALUE}_insertValue(x){this.value=Math.max(this.value,x)}merge(x){this.value=Math.max(this.value,x.value)}clone(){const x=new c(this.field);x.value=this.value;return x}}class d extends m{constructor(){super(...arguments);this.type="sum";this.value=0}_insertValue(x){this.value+=
x}merge(x){this.value+=x.value}clone(){const x=new d(this.field);x.value=this.value;return x}}class f extends m{constructor(){super(...arguments);this.type="avg";this._count=this._total=0}get value(){return this._total/this._count}_insertValue(x){this._total+=x;this._count+=1}merge(x){this._total+=x._total;this._count+=x._count}clone(){const x=new f(this.field);x._total=this._total;x._count=this._count;return x}}class p extends m{constructor(){super(...arguments);this.type="avg_angle";this._count=
this._y=this._x=0}get value(){return 180/Math.PI*Math.atan2(this._y/this._count,this._x/this._count)}_insertValue(x){this._x+=Math.cos(x*k);this._y+=Math.sin(x*k);this._count+=1}merge(x){this._x+=x._x;this._y+=x._y;this._count+=x._count}clone(){const x=new p(this.field);x._x=this._x;x._y=this._y;x._count=this._count;return x}}class g extends m{constructor(){super(...arguments);this._frequencies=new Map}get value(){let x=0,n;for(const [e,h]of this._frequencies.entries())h>x&&(x=h,n=e);return n}_insertValue(x){const n=
this._frequencies.get(x);null==n?this._frequencies.set(x,1):this._frequencies.set(x,n+1)}merge(x){for(const [n,e]of x._frequencies.entries())x=this._frequencies.get(n),null==x?this._frequencies.set(n,e):this._frequencies.set(n,x+e)}clone(){const x=new g(this.field);x._frequencies=new Map(this._frequencies);return x}}a.AccumulatedStatistics=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridSpatialIndex":function(){define(["exports","../../../../../core/unitUtils",
"./GridCell"],function(a,q,r){function k(m,b){return q.getMetersPerUnitForSR(m)*q.inchesPerMeter*96/b}class l{constructor(m){this._options=m;this._cells=new Map;this._pixelsPerMapUnit=k(m.spatialReference,m.scale)}insert(m){m=m.getCursor();const b={$view:{scale:this._options.scale}};for(;m.next();)this._insertFeature(m,b)}putCellsInBounds(m,b){const [c,d,f,p]=b;b=Math.floor(c*this._pixelsPerMapUnit/this._options.cellSize);var g=Math.floor(d*this._pixelsPerMapUnit/this._options.cellSize);const x=Math.ceil(f*
this._pixelsPerMapUnit/this._options.cellSize),n=Math.ceil(p*this._pixelsPerMapUnit/this._options.cellSize);for(;g<=n;g++)for(let e=b;e<=x;e++){const h=this._cells.get(`${e}.${g}`);if(!h)continue;const u=m.get(h.id);u?h&&!m.has(h.id)&&u.merge(h):m.set(h.id,h.clone())}}putCells(m){for(const b of this._cells.values()){const c=m.get(b.id);c?b&&!m.has(b.id)&&c.merge(b):m.set(b.id,b.clone())}}_insertFeature(m,b){var {featureFilter:c}=this._options;if(null===c||c.check(m)){c=m.readXWorldSpace()*this._pixelsPerMapUnit;
var d=m.readYWorldSpace()*this._pixelsPerMapUnit;this._getCellOrCreate(Math.floor(c/this._options.cellSize),Math.floor(d/this._options.cellSize)).insert(m,b)}}_getCellOrCreate(m,b){const c=r.GridCell.createId(m,b);let d=this._cells.get(c);d||(d=r.GridCell.create(m,b,this._options.fields,1*this._options.cellSize/this._pixelsPerMapUnit),this._cells.set(c,d));return d}}a.GridSpatialIndex=l;a.pixelsPerMapUnit=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/support/WithDisplayId":function(){define(["exports"],
function(a){class q{constructor(r,k){this.inner=r;this.displayId=k}}a.WithDisplayId=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/FeatureUpdateStrategy":function(){define(["exports","./AProcessorStrategy","../sources/FeatureSourceMessage","../sources/strategies/chunks/OverrideChunk"],function(a,q,r,k){class l extends q.ASendState{}class m extends q.AProcessorStrategy{constructor(b,c){super(b,c);this.handledChunks=new Set;this.handledChunksForIdCreation=
new Set;this.handledChunksForAttributeData=new Set;this._handle=b.store.events.on("remove",d=>{this.handledChunks.delete(d.chunkId);this.handledChunksForAttributeData.delete(d.chunkId);this.handledChunksForIdCreation.delete(d.chunkId);for(d=d.reader.getCursor();d.next();){const f=d.getObjectId();this._attributeStore.releaseDisplayIdForObjectId(f)}})}destroy(){super.destroy();this._handle.remove();for(const b of this._source.chunks()){const c=b.reader.getCursor();for(;c.next();){const d=c.getObjectId();
this._attributeStore.releaseDisplayIdForObjectId(d)}}}invalidateAttributeData(){this.handledChunksForAttributeData.clear()}onSubscribe(b){super.onSubscribe(b);this._evalOptions=b.tile.arcadeEvaluationOptions}createState(b){return new l(b)}get aggregateQueryEngine(){throw Error("InternalError: FeatureUpdateStrategy does not support aggregations");}getDisplayIds(b){b=new Set(b);const c=[];for(const d of this._source.chunks()){const f=d.reader.getCursor();for(;f.next();)b.has(f.getObjectId())&&c.push(f.getDisplayId())}return c}getDisplayFeatures(b){b=
new Set(b);const c=new Set,d=[];for(const f of this._source.chunks()){const p=f.reader.getCursor();for(;p.next();){const g=p.getObjectId();b.has(p.getDisplayId())&&!c.has(g)&&(d.push(p.readLegacyFeatureWorldSpace()),c.add(g))}}return{features:d,aggregates:[]}}async *applyOverride(b){const c=[];for(var d=b.reader.getCursor();d.next();){var f=d.getObjectId();c.push(f);f=this._attributeStore.createDisplayIdForObjectId(f);d.setDisplayId(f);this._attributeStore.setAttributeData(f,d,this._evalOptions)}const p=
this.getDisplayIds(c);d=this.getDisplayIds(b.removed);this._attributeStore.sendUpdates();f=new k.OverrideChunk;f.applyOverrides(b);for(var g of this._sendStates.values())yield new r.FeatureTileUpdateMessage(g.subscription,null,p,!1,f.queryInfo);for(const x of this._sendStates.values())g=f.getTileReader(x.subscription.tile),yield new r.FeatureTileUpdateMessage(x.subscription,g,d,!1,f.queryInfo);for(const x of b.removed)this._attributeStore.releaseDisplayIdForObjectId(x);for(const x of c)this._attributeStore.releaseDisplayIdForObjectId(x)}async *updateChunks(){if(this._source.chunks().length){await this._updateAttributeData();
for(const b of this._sendStates.values())yield*this._update(b)}}async _updateAttributeData(){for(var b of this._source.chunks()){const {chunkId:d,reader:f}=b;if(!this.handledChunksForIdCreation.has(d)){this.handledChunksForIdCreation.add(d);for(var c=f.getCursor();c.next();){const p=this._attributeStore.createDisplayIdForObjectId(c.getObjectId());c.setDisplayId(p)}}}for(const d of this._source.chunks())if(!this.handledChunksForAttributeData.has(d.chunkId))for(this.handledChunksForAttributeData.add(d.chunkId),
b=d.reader.getCursor();b.next();)c=b.getDisplayId(),this._attributeStore.setAttributeData(c,b,this._evalOptions);this._attributeStore.sendUpdates()}*_update(b){const {subscription:c,handledChunks:d}=b;for(const p of this._source.chunks()){var {chunkId:f}=p;d.has(f)||(d.add(f),(f=p.getTileReader(c.tile))&&(yield new r.FeatureTileAppendMessage(b.subscription,f,!1,p.end,p.queryInfo)))}}}a.DefaultSendState=l;a.FeatureUpdateStrategy=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/OverrideChunk":function(){define(["exports",
"./ASourceChunk","../../../support/FeatureSetReaderJSON"],function(a,q,r){class k extends q.ASourceChunk{constructor(){super(...arguments);this.chunkId="override";this.removed=new Set;this.overridenIds=new Set;this._features=[]}get reader(){return r.FeatureSetReaderJSON.fromOptimizedFeatures(this._features,this._layerSchema??{fields:[]})}get queryInfo(){return{}}get first(){return!1}get end(){return!1}applyOverrides(l){super.invalidate();this._layerSchema||(this._layerSchema=l.reader.fullSchema());
const {reader:m,removed:b}=l;l=[];const c=new Set;var d=m.getCursor();const f=new Set(b);for(this.overridenIds.clear();d.next();){const p=d.readOptimizedFeatureWorldSpace(),g=p.objectId;l.push(p);c.add(g);this.overridenIds.add(g);this.removed.delete(g)}for(const p of this._features)d=p.objectId,f.has(d)||c.has(d)||(l.push(p),this.overridenIds.add(d));this._features=l;for(const p of c.values())this.removed.delete(p);for(const p of b)this.removed.add(p),this.overridenIds.add(p)}getTileReader(l){if(!this._features.length)return null;
const m=this.queryFeaturesInBounds(l.bounds);m.setTransformForDisplay(l.transform);return m}}a.OverrideChunk=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/ASourceChunk":function(){define(["exports","../../../FeatureSpatialIndex","../../../aggregation/GeohashSpatialIndex","../../../aggregation/GridSpatialIndex","../../../support/FeatureSetReaderIndirect"],function(a,q,r,k,l){class m{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._gridIndexHash=
this._gridIndex=this._spatialIndex=this._geohashIndexHash=this._geohashIndex=null}queryFeaturesInBounds(b){b=this._getSpatialIndex().search(b);return l.FeatureSetReaderIndirect.from(this.reader,b)}getGeohashIndex(b){const c=JSON.stringify(b);c!==this._geohashIndexHash&&(this._geohashIndexHash=c,this._geohashIndex=new r.GeohashSpatialIndex(b),this._geohashIndex.insert(this.reader));return this._geohashIndex}getGridIndex(b){const c=JSON.stringify(b);c!==this._gridIndexHash&&(this._gridIndexHash=c,this._gridIndex=
new k.GridSpatialIndex(b),this._gridIndex.insert(this.reader));return this._gridIndex}_getSpatialIndex(){this._spatialIndex||(this._spatialIndex=q.FeatureSpatialIndex.fromReader(this.reader));return this._spatialIndex}}a.ASourceChunk=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSpatialIndex":function(){define(["exports","../../../../chunks/rbush","../../../../geometry/support/aaBoundingBox"],function(a,q,r){class k{static fromReader(l){const m=
[],b=l.copy();for(l=r.create();b.next();)b.getBounds(l)&&m.push(b.getIndex());l=q.rbush(9,c=>{b.setIndex(c);return{minX:b.getBoundsXMin(),minY:b.getBoundsYMin(),maxX:b.getBoundsXMax(),maxY:b.getBoundsYMax()}});l.load(m);return new k(l)}constructor(l){this._index=l}search(l){return this._index.search({minX:l[0],minY:l[1],maxX:l[2],maxY:l[3]})}}a.FeatureSpatialIndex=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/rbush":function(){define(["exports","./quickselect"],function(a,
q){function r(e,h){if(!(this instanceof r))return new r(e,h);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));h&&("function"===typeof h?this.toBBox=h:this._initFormat(h));this.clear()}function k(e,h){l(e,0,e.children.length,h,e)}function l(e,h,u,v,y){y||=x(null);y.minX=Infinity;y.minY=Infinity;y.maxX=-Infinity;y.maxY=-Infinity;for(var B;h<u;h++)B=e.children[h],m(y,e.leaf?v(B):B);return y}function m(e,h){e.minX=Math.min(e.minX,h.minX);e.minY=Math.min(e.minY,
h.minY);e.maxX=Math.max(e.maxX,h.maxX);e.maxY=Math.max(e.maxY,h.maxY);return e}function b(e,h){return e.minX-h.minX}function c(e,h){return e.minY-h.minY}function d(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,h){return e.minX<=h.minX&&e.minY<=h.minY&&h.maxX<=e.maxX&&h.maxY<=e.maxY}function g(e,h){return h.minX<=e.maxX&&h.minY<=e.maxY&&h.maxX>=e.minX&&h.maxY>=e.minY}function x(e){return{children:e,height:1,leaf:!0,minX:Infinity,minY:Infinity,
maxX:-Infinity,maxY:-Infinity}}function n(e,h,u,v,y){for(var B=[h,u],t;B.length;)u=B.pop(),h=B.pop(),u-h<=v||(t=h+Math.ceil((u-h)/v/2)*v,q.quickselect(e,t,h,u,y),B.push(h,t,t,u))}r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var h=this.data,u=[],v=this.toBBox;if(!g(e,h))return u;for(var y=[],B,t,w,C;h;){B=0;for(t=h.children.length;B<t;B++)w=h.children[B],C=h.leaf?v(w):w,g(e,C)&&(h.leaf?u.push(w):p(e,C)?this._all(w,u):y.push(w));h=y.pop()}return u},collides:function(e){var h=
this.data,u=this.toBBox;if(!g(e,h))return!1;for(var v=[],y,B,t,w;h;){y=0;for(B=h.children.length;y<B;y++)if(t=h.children[y],w=h.leaf?u(t):t,g(e,w)){if(h.leaf||p(e,w))return!0;v.push(t)}h=v.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var h=0,u=e.length;h<u;h++)this.insert(e[h]);return this}e=this._build(e.slice(),0,e.length-1,0);this.data.children.length?this.data.height===e.height?this._splitRoot(this.data,e):(this.data.height<e.height&&(h=this.data,
this.data=e,e=h),this._insert(e,this.data.height-e.height-1,!0)):this.data=e;return this},insert:function(e){null!=e&&this._insert(e,this.data.height-1);return this},clear:function(){this.data=x([]);return this},remove:function(e,h){if(null==e)return this;for(var u=this.data,v=this.toBBox(e),y=[],B=[],t,w,C,z;u||y.length;){u||(u=y.pop(),w=y[y.length-1],t=B.pop(),z=!0);if(u.leaf){a:{C=e;var D=u.children,H=h;if(H){for(var G=0;G<D.length;G++)if(H(C,D[G])){C=G;break a}C=-1}else C=D.indexOf(C)}if(-1!==
C){u.children.splice(C,1);y.push(u);this._condense(y);break}}z||u.leaf||!p(u,v)?w?(t++,u=w.children[t],z=!1):u=null:(y.push(u),B.push(t),t=0,w=u,u=u.children[0])}return this},toBBox:function(e){return e},compareMinX:b,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,h){for(var u=[];e;)e.leaf?h.push.apply(h,e.children):u.push.apply(u,e.children),e=u.pop();return h},_build:function(e,h,u,v){var y=u-h+1,B=this._maxEntries;if(y<=B){var t=
x(e.slice(h,u+1));k(t,this.toBBox);return t}v||(v=Math.ceil(Math.log(y)/Math.log(B)),B=Math.ceil(y/Math.pow(B,v-1)));t=x([]);t.leaf=!1;t.height=v;y=Math.ceil(y/B);B=y*Math.ceil(Math.sqrt(B));var w;for(n(e,h,u,B,this.compareMinX);h<=u;h+=B){var C=Math.min(h+B-1,u);n(e,h,C,y,this.compareMinY);for(w=h;w<=C;w+=y){var z=Math.min(w+y-1,C);t.children.push(this._build(e,w,z,v-1))}}k(t,this.toBBox);return t},_chooseSubtree:function(e,h,u,v){for(var y,B,t,w,C,z,D,H;;){v.push(h);if(h.leaf||v.length-1===u)break;
D=H=Infinity;y=0;for(B=h.children.length;y<B;y++)t=h.children[y],C=d(t),z=(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))-C,z<H?(H=z,D=C<D?C:D,w=t):z===H&&C<D&&(D=C,w=t);h=w||h.children[0]}return h},_insert:function(e,h,u){var v=this.toBBox;u=u?e:v(e);v=[];var y=this._chooseSubtree(u,this.data,h,v);y.children.push(e);for(m(y,u);0<=h;)if(v[h].children.length>this._maxEntries)this._split(v,h),h--;else break;this._adjustParentBBoxes(u,v,h)},_split:function(e,
h){var u=e[h],v=u.children.length,y=this._minEntries;this._chooseSplitAxis(u,y,v);v=this._chooseSplitIndex(u,y,v);v=x(u.children.splice(v,u.children.length-v));v.height=u.height;v.leaf=u.leaf;k(u,this.toBBox);k(v,this.toBBox);h?e[h-1].children.push(v):this._splitRoot(u,v)},_splitRoot:function(e,h){this.data=x([e,h]);this.data.height=e.height+1;this.data.leaf=!1;k(this.data,this.toBBox)},_chooseSplitIndex:function(e,h,u){var v,y;var B=y=Infinity;for(v=h;v<=u-h;v++){var t=l(e,0,v,this.toBBox);var w=
l(e,v,u,this.toBBox);var C=Math.max(0,Math.min(t.maxX,w.maxX)-Math.max(t.minX,w.minX))*Math.max(0,Math.min(t.maxY,w.maxY)-Math.max(t.minY,w.minY));t=d(t)+d(w);if(C<B){B=C;var z=v;y=t<y?t:y}else C===B&&t<y&&(y=t,z=v)}return z},_chooseSplitAxis:function(e,h,u){var v=e.leaf?this.compareMinX:b,y=e.leaf?this.compareMinY:c,B=this._allDistMargin(e,h,u,v);h=this._allDistMargin(e,h,u,y);B<h&&e.children.sort(v)},_allDistMargin:function(e,h,u,v){e.children.sort(v);v=this.toBBox;var y=l(e,0,h,v),B=l(e,u-h,u,
v),t=f(y)+f(B),w;for(w=h;w<u-h;w++){var C=e.children[w];m(y,e.leaf?v(C):C);t+=f(y)}for(w=u-h-1;w>=h;w--)C=e.children[w],m(B,e.leaf?v(C):C),t+=f(B);return t},_adjustParentBBoxes:function(e,h,u){for(;0<=u;u--)m(h[u],e)},_condense:function(e){for(var h=e.length-1,u;0<=h;h--)0===e[h].children.length?0<h?(u=e[h-1].children,u.splice(u.indexOf(e[h]),1)):this.clear():k(e[h],this.toBBox)},_initFormat:function(e){var h=["return a"," - b",";"];this.compareMinX=new Function("a","b",h.join(e[0]));this.compareMinY=
new Function("a","b",h.join(e[1]));this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};a.rbush=r})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,q){var r={exports:{}};(function(k){(function(l){l=l();void 0!==l&&(k.exports=l)})(function(){function l(c,d,f,p,g){for(;p>f;){if(600<p-f){var x=p-f+1,n=d-f+1,e=Math.log(x),h=.5*Math.exp(2*e/3);e=.5*Math.sqrt(e*h*(x-h)/x)*(0>n-x/2?-1:1);l(c,d,Math.max(f,Math.floor(d-
n*h/x+e)),Math.min(p,Math.floor(d+(x-n)*h/x+e)),g)}x=c[d];n=f;h=p;m(c,f,d);for(0<g(c[p],x)&&m(c,f,p);n<h;){m(c,n,h);n++;for(h--;0>g(c[n],x);)n++;for(;0<g(c[h],x);)h--}0===g(c[f],x)?m(c,f,h):(h++,m(c,h,p));h<=d&&(f=h+1);d<=h&&(p=h-1)}}function m(c,d,f){var p=c[d];c[d]=c[f];c[f]=p}function b(c,d){return c<d?-1:c>d?1:0}return function(c,d,f,p,g){l(c,d,f||0,p||c.length-1,g||b)}})})(r);q=q.getDefaultExportFromCjs(r.exports);a.quickselect=q})},"esri/views/2d/layers/features/aggregation/GeohashSpatialIndex":function(){define(["exports",
"../../../../../geohash/GeohashTree","../../../../../geohash/geohashUtils"],function(a,q,r){class k{constructor(l){this._options=l;this._tree=new q.GeohashTree(l.fields)}insert(l){l=l.getCursor();const m={$view:{scale:0}};for(;l.next();)this._insertFeature(l,m)}putBins(l,m){this._tree.putBins(l,m)}_insertFeature(l,m){const {featureFilter:b,geohashLevel:c,spatialReference:d}=this._options;if(null===b||b.check(l)){var f=l.readXWorldSpace(),p=l.readYWorldSpace(),g=r.getGeohash(f,p,c,d);g&&this._tree.insert(l,
f,p,g[0],g[1],c,m)}}}a.GeohashSpatialIndex=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashTree":function(){define("exports ./geohashUtils ../geometry/SpatialReference ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport ../views/2d/layers/features/aggregation/AccumulatedStatistics".split(" "),function(a,q,r,k,l,m,b){class c{static create(f,p,g,x){f=b.AccumulatedStatistics.create(f);const n=
Array(32);for(let e=0;e<n.length;e++)n[e]=null;return new c(f,p,g,x,n)}constructor(f,p,g,x,n){this._statistics=f;this.xNode=p;this.yNode=g;this.depth=x;this.children=n;this._objectIds=new Set;this._yGeohashTotal=this._xGeohashTotal=this._yWorldTotal=this._xWorldTotal=this._count=0;this.next=null}get id(){return`${this.xNode}.${this.yNode}`}get objectIds(){return this._objectIds}clone(){const f=new c(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);f._count=this._count;f._xWorldTotal=
this._xWorldTotal;f._yWorldTotal=this._yWorldTotal;f._xGeohashTotal=this._xGeohashTotal;f._yGeohashTotal=this._yGeohashTotal;f.next=this.next;f.cachedFeature=this.cachedFeature;f._objectIds=new Set(this._objectIds);return f}insert(f,p,g,x,n,e){this._count+=1;this._xWorldTotal+=p;this._yWorldTotal+=g;this._xGeohashTotal+=x;this._yGeohashTotal+=n;this._statistics.insert(f,e);this._objectIds.add(f.getObjectId())}merge(f){if(0!==f._count){this._count+=f._count;this._xWorldTotal+=f._xWorldTotal;this._yWorldTotal+=
f._yWorldTotal;this._xGeohashTotal+=f._xWorldTotal;this._yGeohashTotal+=f._yWorldTotal;this._statistics.merge(f._statistics);for(const p of f._objectIds.values())this._objectIds.add(p)}}getGeometry(f,p){const g=this._getLngLatBounds(),[x,n,e,h]=g;f=m.project({rings:[[[x,n],[x,h],[e,h],[e,n],[x,n]]]},r.WGS84,f);f=k.convertFromPolygon(new l,f,!1,!1);return null!=p?k.quantizeOptimizedGeometry(new l,f,!1,!1,"esriGeometryPolygon",p,!1,!1):f}getGeometryCentroid(f,p){const g=this._getLngLatBounds(),[x,n,
e,h]=g;f=m.project({x:(x+e)/2,y:(n+h)/2},r.WGS84,f);f=k.convertFromPoint(new l,f);return null!=p?k.quantizeOptimizedGeometry(new l,f,!1,!1,"esriGeometryPoint",p,!1,!1):f}getAttributes(){const f={aggregateId:this.id};for(const p of this._statistics.values())f[p.field.name]=p.value;f.aggregateCount=this._count;return f}_getLngLatBounds(){var f=this.depth;const p=Math.ceil(f/2);f=Math.floor(f/2);return q.decodeGeohashXY({geohashX:this.xNode<<30-(3*p+2*f),geohashY:this.yNode<<30-(2*p+3*f)},this.depth)}}
class d{constructor(f){this._fields=f;this._root=c.create(this._fields,0,0,0)}destroy(){}insert(f,p,g,x,n,e,h){let u=this._root,v=0,y=0,B=0;for(;null!==u;){u.insert(f,p,g,x,n,h);if(v>=e)break;var t=Math.ceil((v+1)/2),w=Math.floor((v+1)/2);const z=1-v%2;var C=30-(3*t+2*w);t=30-(2*t+3*w);C=(x&7*z+3*(1-z)<<C)>>C;t=(n&3*z+7*(1-z)<<t)>>t;w=C+t*(8*z+4*(1-z));const D=2*z+3*(1-z);y=y<<3*z+2*(1-z)|C;B=B<<D|t;null==u.children[w]&&(u.children[w]=c.create(this._fields,y,B,v+1));v+=1;u=u.children[w]}}putBins(f,
p){for(const g of this.getNodes(p))(p=f.get(g.id))?p.merge(g):f.set(g.id,g.clone())}getNodes(f){const p=[],{geohashBounds:g,level:x}=f;for(f=this._root;null!==f;){var n=f.depth,e=f.xNode,h=f.yNode;if(n>=x)p.push(f),f=f.next;else{var u=Math.ceil((n+1)/2),v=Math.floor((n+1)/2);n=1-n%2;var y=30-(3*u+2*v),B=30-(2*u+3*v),t=~((1<<y)-1),w=~((1<<B)-1);e<<=3*n+2*(1-n);h<<=2*n+3*(1-n);u=Math.max(e,(g.xLL&t)>>y);v=Math.max(h,(g.yLL&w)>>B);y=Math.min(e+8*n+4*(1-n),(g.xTR&t)>>y);B=Math.min(h+4*n+8*(1-n),(g.yTR&
w)>>B);for(t=w=null;v<=B;v++)for(let C=u;C<=y;C++){const z=f.children[C-e+(v-h)*(8*n+4*(1-n))];z&&(w||(w=z,w.next=f.next),t&&(t.next=z),t=z,z.next=f.next)}f=w||f.next}}return p}}a.GeohashCell=c;a.GeohashTree=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderIndirect":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetReader"],function(a,
q,r,k){class l extends k.FeatureSetReader{static from(m,b){return new l(m.copy(),b)}constructor(m,b){super(m.metadata);this._currentIndex=-1;this._displayTranslationY=this._displayTranslationX=0;this._displayScaleY=this._displayScaleX=1;this._reader=m;this._indices=b;this._isPoint="esriGeometryPoint"===m.geometryType}setTransformForDisplay(m){const b=this._reader.getInTransform();if(null==b){const [h,u]=m.scale,[v,y]=m.translate;this._displayTranslationX=-v/h;this._displayScaleX=1/h;this._displayTranslationY=
y/u;this._displayScaleY=1/-u}else{var [c,d]=b.scale,[f,p]=b.translate,[g,x]=m.scale,[n,e]=m.translate;this._displayScaleX=c/g;this._displayTranslationX=(f-n)/g;this._displayScaleY=d/x;this._displayTranslationY=(-p+e)/x;if(!this._isPoint&&b)throw Error("InternalError: Relative transformations not supported for non-point features");}this._displayTransform=m}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const m=
new l(this._reader.copy(),this._indices);m._currentIndex=this._currentIndex;m._displayTransform=this._displayTransform;m._displayTranslationX=this._displayTranslationX;m._displayTranslationY=this._displayTranslationY;m._displayScaleX=this._displayScaleX;m._displayScaleY=this._displayScaleY;return m}_nextIndex(){return++this._currentIndex<this._indices.length?(this._reader.setIndex(this._indices[this._currentIndex]),!0):!1}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<
this._indices.length}readXForDisplay(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}readYForDisplay(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}readGeometryForDisplay(){const m=this._reader.readGeometryForDisplay();if(!this._displayTransform)return m;const b=new r;q.quantizeOptimizedGeometry(b,m,this.hasZ,this.hasM,this.geometryType,this._displayTransform);return b.deltaDecode()}readCentroidForDisplay(){const m=this._reader.readCentroidForDisplay()?.clone();
if(m){const [b,c]=m.coords;m.coords[0]=b*this._displayScaleX+this._displayTranslationX;m.coords[1]=c*this._displayScaleY+this._displayTranslationY}return m}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(m,b=!1){return this._reader.readAttribute(m,b)}readAttributes(){return this._reader.readAttributes()}joinAttributes(m){return this._reader.joinAttributes(m)}getBounds(m){return this._reader.getBounds(m)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(m){return this._reader.setDisplayId(m)}setIndex(m){return this._reader.setIndex(m)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){return this._reader.readLegacyFeatureForDisplay()}readLegacyGeometryForDisplay(){return this._reader.readLegacyGeometryForDisplay()}readGeometryArea(){return this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(m,
b){throw Error("Error: Should not be called. Underlying _reader should be used instead");}_readAttributes(){throw Error("Error: Should not be called. Underlying _reader should be used instead");}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(m){return this.readAttribute(m,!0)}hasField(m){return this._reader.hasField(m)}setField(m,b){return this._reader.setField(m,b)}keys(){return this._reader.keys()}castToText(m=!1){return this._reader.castToText(m)}}
a.FeatureSetReaderIndirect=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../../../layers/support/FieldsIndex ../../../engine/highlightReasons ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./AttributeStoreCommandQueue ./DisplayIdGenerator ./FeatureFilter ../../../../webgl/enums".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h){function u(z,D){if(!z||!D)return z;switch(D){case "radius":case "distance":return 2*z;case "area":return Math.sqrt(z)}return z}const v=()=>k.getLogger("esri.views.layers.2d.features.support.AttributeStore"),y=g.createDebugLogger(g.DEBUG_ATTR_UPDATES,v());var B=r("esri-shared-array-buffer"),t=r("esri-atomics");class w{constructor(z,D,H,G){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:A,layout:F,textureOnly:J}=G;this.textureOnly=
J||!1;this.pixelType=A;this._ctype=D;this.layout=F;this._resetRange();this._shared=z;this.size=H;J||(this.data=this._initData(A,H,z,D))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(z,D){const H=this.data;for(let G=0;G<this.size*this.size;G++)H[G*this.texelSize+z]&=~D;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(z,D){const H=this.data;for(let G=0;G<this.size*this.size;G++)H[G*this.texelSize+z]|=255&D;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-
1}setComponent(z,D,H){const G=this.data;for(const A of H)G[A*this.texelSize+z]|=D,this.dirtyStart=Math.min(this.dirtyStart,A),this.dirtyEnd=Math.max(this.dirtyEnd,A)}setComponentTexel(z,D,H){this.data[H*this.texelSize+z]|=D;this.dirtyStart=Math.min(this.dirtyStart,H);this.dirtyEnd=Math.max(this.dirtyEnd,H)}unsetComponentTexel(z,D,H){this.data[H*this.texelSize+z]&=~D;this.dirtyStart=Math.min(this.dirtyStart,H);this.dirtyEnd=Math.max(this.dirtyEnd,H)}getData(z,D){z=d.getDisplayIdTexel(z);return this.data[z*
this.texelSize+D]}setData(z,D,H){z=d.getDisplayIdTexel(z);0===(this.layout&1<<D)?v().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[z*this.texelSize+D]=H,this.dirtyStart=Math.min(this.dirtyStart,z),this.dirtyEnd=Math.max(this.dirtyEnd,z))}lock(){this.pixelType===h.PixelType.UNSIGNED_BYTE&&this._shared&&t&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===h.PixelType.UNSIGNED_BYTE&&this._shared&&t&&"local"!==
this._ctype&&Atomics.store(this.data,0,0)}expand(z){this.size=z;this.textureOnly||(z=this._initData(this.pixelType,z,this._shared,this._ctype),z.set(this.data),this.data=z)}toMessage(){const z=this.dirtyStart,D=this.dirtyEnd;var H=this.texelSize;if(z>D)return null;this._resetRange();const G=this.pixelType,A=this.layout,F=this.data;H=!this._shared&&"local"!==this._ctype&&F.slice(z*H,(D+1)*H)||null;return{start:z,end:D,data:H,pixelType:G,layout:A}}_initData(z,D,H,G){H=H&&"local"!==G?SharedArrayBuffer:
ArrayBuffer;z=f.getPixelArrayCtor(z);D=new z(new H(D*D*4*z.BYTES_PER_ELEMENT));for(z=0;z<D.length;z+=4)D[z+1]=255;return D}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class C{constructor(z){this._client=z;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=c.attributeStoreInitialSize;this._idsToHighlight=new Map;this._initialized=this._referencesGeometry=this._referencesScale=!1;this.version=0;this._idGenerator=new n.DisplayIdGenerator;
this._commandQueue=new x.AttributeStoreCommmandQueue({process:D=>{switch(D.type){case "update":return this._doSendUpdate();case "initialize":return this._doEnsureInititialized()}}})}destroy(){this._abortController.abort();this._commandQueue.destroy()}_initialize(){if(null==this._blockDescriptors){var z=h.PixelType.FLOAT;y(`Creating AttributeStore ${B?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:h.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:h.PixelType.UNSIGNED_BYTE,layout:15,
textureOnly:!0},{pixelType:h.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:z,layout:15},{pixelType:z,layout:15},{pixelType:z,layout:15},{pixelType:z,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get _signal(){return this._abortController.signal}get hasHighlight(){return 0<this._idsToHighlight.size}get updateTracking(){return this._commandQueue.updateTracking}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}createDisplayIdForObjectId(z){return this._idGenerator.createIdForObjectId(z)}releaseDisplayIdForObjectId(z){return this._idGenerator.releaseIdForObjectId(z)}async update(z,
D,H,G,A=0){const F=l.diff(this._schema,z);this.version=A;if(F&&(r("esri-2d-update-debug")&&console.debug(`Version[${A}] AttributeStore.update`,{changed:F}),this._schema=z,this._attributeComputeInfo=null,this._initialize(),null!=z))if(H&&(this._filters=await Promise.all(z.filters.map(J=>J?e.create({geometryType:H.geometryType,hasM:!1,hasZ:!1,timeInfo:H.timeInfo,fieldsIndex:new m(H.fields),spatialReference:G??H.spatialReference,filterJSON:J}):null))),"subtype"===z.type){this._attributeComputeInfo={isSubtype:!0,
subtypeField:z.subtypeField,map:new Map};this._referencesGeometry=this._referencesScale=!1;for(const J in z.bindings)await Promise.all(z.bindings[J].map(async K=>{K=await this._bind(D,K,parseInt(J,10));this._referencesGeometry=this._referencesGeometry||(K?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(K?.referencesScale()??!1)}))}else this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(z.bindings.map(async J=>{J=await this._bind(D,J);this._referencesGeometry=
this._referencesGeometry||(J?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(J?.referencesScale()??!1)}))}async setHighlight(z){const D=this._getBlock(0);D.lock();D.unsetComponentAllTexels(0,(1<<b.highlightReasons.length)-1);for(const {displayId:H,highlightFlags:G}of z){if(null==H)continue;const A=d.getDisplayIdTexel(H);D.setComponent(0,G,[A])}D.unlock();this._idsToHighlight.clear();for(const {objectId:H,highlightFlags:G}of z)this._idsToHighlight.set(H,G);await this.sendUpdates()}setData(z,
D,H,G){const A=d.getDisplayIdTexel(z);this._ensureSizeForTexel(A);this._getBlock(D).setData(z,H,G)}getData(z,D,H){return this._getBlock(D).getData(z,H)}getHighlightFlags(z){return this._idsToHighlight.get(z)||0}unsetAttributeData(z){z=d.getDisplayIdTexel(z);this._getBlock(0).setData(z,0,0)}setAttributeData(z,D,H){const G=d.getDisplayIdTexel(z);this._ensureSizeForTexel(G);this._getBlock(0).setData(G,0,this.getFilterFlags(D));z=this._attributeComputeInfo;let A=null;z&&(A=z.isSubtype?z.map.get(D.readAttribute(z.subtypeField)):
z.map,A?.size&&A.forEach((F,J)=>{const K=1*J%4;J=this._getBlock(Math.floor(1*J/4)+c.AttributeDataType.VV);let P=F.field?.read(D,H);F.valueRepresentation&&(P=u(P,F.valueRepresentation));if(null===P||isNaN(P)||Infinity===P||-Infinity===P)P=p.nanMagicNumber;J.setData(G,K,P)}))}async _doSendUpdate(){var z=this._blocks.map(H=>null!=H?H.toMessage():null);const D={blocks:z,version:this.version};z.some(H=>H)&&(r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),z=this._client.update(D,
this._signal),await this._client.render(),await z,r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end"))}async sendUpdates(){await this._commandQueue.push({type:"initialize"});return this._commandQueue.push({type:"update"})}_ensureSizeForTexel(z){for(;z>=this._size*this._size&&!this._expand(););}async _bind(z,D,H){z=await z.createComputedField(D);const {valueRepresentation:G}=D,A=this._attributeComputeInfo;if(A.isSubtype){const F=A.map.get(H)??new Map;F.set(D.binding,{field:z,
valueRepresentation:G});A.map.set(H,F)}else A.map.set(D.binding,{field:z,valueRepresentation:G});return z}async _doEnsureInititialized(){if(!this._initialized){this._initialized=!0;this._getBlock(c.AttributeDataType.Animation);this._getBlock(c.AttributeDataType.GPGPU);var z={shared:B&&"local"!==this._client.type,size:this._size,blocks:this._blocks.map(D=>null!=D?{textureOnly:D.textureOnly,buffer:D.buffer,pixelType:D.pixelType}:null)};r("esri-2d-log-updating")&&console.log("AttributeStore: _doEnsureInitialized.start",
{message:z});await this._client.initialize(z,this._signal);r("esri-2d-log-updating")&&console.log("AttributeStore: _doEnsureInitialized.end")}}_getBlock(z){var D=this._blocks[z];if(null!=D)return D;y(`Initializing AttributeBlock at index ${z}`);D=new w(B,this._client.type,this._size,this._blockDescriptors[z]);this._blocks[z]=D;this._initialized=!1;return D}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const z=this._size<<=1;y("Expanding block size to",z,this._blocks);for(const D of this._blocks)D?.expand(z);
this._initialized=!1;this._size=z;return 0}v().error(new q("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}isVisible(z){return!!(this._getBlock(0).getData(z,0)&1<<b.highlightReasons.length)}getFilterFlags(z){let D=0;for(var H=0;H<this._filters.length;H++){var G=this._filters[H];G=!(1<<H)||null==G||G.check(z);D|=(G?1:0)<<H}H=0;this._idsToHighlight.size&&(z=z.getObjectId(),H=this.getHighlightFlags(z));return D<<b.highlightReasons.length|H}}a.AttributeStore=C;a.getVisualVariableSizeValueRepresentationRatio=
u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(a){a.DEBUG_ATTR_UPDATES=!1;a.createDebugLogger=(q,r)=>q&&((...k)=>r.warn("DEBUG:",...k))||(()=>null);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStoreCommandQueue":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/accessorSupport/decorators/property","../../support/UpdateTracking2D",
"../../../../support/QueueProcessor"],function(a,q,r,k,l){class m{constructor(b){this._updateTracking=new k.UpdateTracking2D({debugName:"AttributeStoreCommandQueue"});this._queueProcessor=new l.QueueProcessor({concurrency:1,process:b.process})}destroy(){this._updateTracking.destroy();this.clear()}get updateTracking(){return this._updateTracking}clear(){this._queueProcessor.clear()}async push(b){return this._updateTracking.addPromise(this._doPush(b))}async _doPush(b){const c=this._queueProcessor,d=
c.last();switch(b.type){case "update":return d?.type===b.type?c.lastPromise():c.push(b);case "initialize":return c.push(b)}}}q.__decorate([r.property()],m.prototype,"process",void 0);a.AttributeStoreCommmandQueue=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){a.UpdateTracking2D=class extends r{constructor(g){super(g);this.debugName="";this._updatingHandles=new p.UpdatingHandles;this._idToUpdatingState=new l}get updating(){const g=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(x=>x);if(k("esri-2d-log-updating")){const x=Array.from(this._idToUpdatingState.entries()).map(([n,e])=>`-> ${n}: ${e}`).join("\n");console.log(`${this.debugName}: Updating: ${g}\n-> Handles: ${this._updatingHandles.updating}\n${x}`)}return g}addUpdateTracking(g,
x){const n=m.watch(()=>x.updating,e=>this._idToUpdatingState.set(g,e),{sync:!0});this.addHandles(n)}addPromise(g){return this._updatingHandles.addPromise(g)}};q.__decorate([b.property({constructOnly:!0})],a.UpdateTracking2D.prototype,"debugName",void 0);q.__decorate([b.property({readOnly:!0})],a.UpdateTracking2D.prototype,"updating",null);a.UpdateTracking2D=q.__decorate([f.subclass("esri.view.2d.layers.support.UpdateTracking2D")],a.UpdateTracking2D);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(a,q){class r{constructor(l){this.data=l;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount+=1}empty(){return 0===this._referenceCount}}class k{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;this._objectIdToDisplayId=new Map}incrementGeneration(){this._freeIds=
this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}createIdForObjectId(l){let m=this._objectIdToDisplayId.get(l);m||(m=new r(q.createDisplayId(this._getFreeId(),!1)),m.increment(),this._objectIdToDisplayId.set(l,m));return m.data}releaseIdForObjectId(l){const m=this._objectIdToDisplayId.get(l);m&&(m.decrement(),m.empty()&&(this._objectIdToDisplayId.delete(l),this._freeIds.push(m.data)))}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}
a.DisplayIdGenerator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSource":function(){define("exports ../../../../../request ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../layers/graphics/data/QueryEngine ../../../../../layers/support/FieldsIndex ../../../../../rest/query/operations/query ../FeatureStoreStatistics ./FeatureSourceQueryInfo ./StreamMessenger ./strategies/DrillDownTileLoadStrategy ./strategies/PagedTileLoadStrategy ./strategies/SnapshotLoadStrategy ./strategies/StreamLoadStrategy ./strategies/chunks/SourceChunkStore ../support/FeatureMetadata ../../support/UpdateTracking2D".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v){class y{constructor(B,t,w,C){this._aggregateAdapter=B;this._subscriptions=t;this._onChange=w;this._connection=C;this._updateTracking=new v.UpdateTracking2D({debugName:"FeatureSource"});this._store=new h.FeatureSourceChunkStore(this._onChange)}destroy(){this._strategy?.destroy();this._store.destroy();this._streamMessenger?.destroy()}get _eventLog(){return this._connection.eventLog}get metadata(){if(!this._metadata)throw Error("InternalError: Metadata not defined. Was update called?");
return this._metadata}get service(){return this._schema.service}get store(){return this._store}get streamMessenger(){null==this._streamMessenger&&this._initStreamMessenger();return this._streamMessenger}get statistics(){return d.FeatureStoreStatistics.from(this._store)}get updateTracking(){return this._updateTracking}get queryEngine(){if(!this._queryEngine){const {dataFilter:B}=this._schema,{objectIdField:t,geometryType:w,timeInfo:C}=this._schema.service,z=this._schema.availableFields;this._queryEngine=
new m.QueryEngine({featureStore:this._store,fieldsIndex:b.fromJSON(this._schema.service.fieldsIndex),geometryType:w,objectIdField:t,hasM:!1,hasZ:!1,spatialReference:B.outSpatialReference,cacheSpatialQueries:!0,aggregateAdapter:this._aggregateAdapter,timeInfo:C,definitionExpression:B.definitionExpression,availableFields:z})}return this._queryEngine}get isStream(){return"stream"===this._schema.type}chunks(){return Array.from(this._store.chunks())}onSubscribe(B){this._eventLog.onEvent({type:"subscribe",
tile:B.tile.id});const t=this._strategy?.load(B);t&&(t.then(()=>this._eventLog.onEvent({type:"loaded",tile:B.tile.id})).catch(w=>this._eventLog.onEvent({type:"error",tile:B.tile.id,error:w})),this._updateTracking.addPromise(t))}onResume(B){this._updateTracking.addPromise(k.ignoreAbortErrors(this._strategy?.load(B)))}onUnsubscribe(B){this._eventLog.onEvent({type:"unsubscribe",tile:B.tile.id});this._strategy?.unload(B)}getOverride(B){return this._updateTracking.addPromise(this._doGetOverride(B))}applyOverride(B){this._store.applyOverrides(B)}async update(B,
t){B=B.source;const w=l.diff(this._schema,B);if(!w)return!1;r("esri-2d-update-debug")&&console.debug(`Version[${t}] FeatureSource.update`,{changes:w});this._schema=B;this._metadata=new u.FeatureMetadata(this._schema.service);this._queryEngine?.destroy();this._queryEngine=null;null==this._lastEditDate&&"lastEditDate"in this._schema.service&&(this._lastEditDate=this._schema.service.lastEditDate);null==this._streamMessenger&&"stream"===this._schema.type&&this._initStreamMessenger();if(l.hasRootDiffOnly(w,
"sourceRefreshVersion")&&this._strategy?.refresh)return await this._strategy.refresh(),!0;if("feature"===B.type&&l.hasRootDiffOnly(w,"availableFields")&&!await this._queryLastEditDateChanged()){this._eventLog.onEvent({type:"updateFieldsStart"});try{await this._strategy.updateFields(B.availableFields),this._eventLog.onEvent({type:"updateFieldsEnd"})}catch(C){this._eventLog.onEvent({type:"updateFieldsError",error:C})}return!1}return l.hasRootDiff(w,"dataFilter")||l.hasRootDiff(w,"sourceRefreshVersion")?
(await this._updateStrategy(t),!0):!1}_initStreamMessenger(){null==this._streamMessenger&&(this._streamMessenger=new p.StreamMessenger(this._connection))}async _doGetOverride(B){return this._strategy.queryOverride(B)}async _queryLastEditDateChanged(){if(null==this._lastEditDate)return!1;var B=this._schema.service.source;B=(await q(B.path,{query:{...B.query,f:"json"},responseType:"json"})).data.editingInfo.lastEditDate;if(B===this._lastEditDate)return!1;this._lastEditDate=B;return!0}async _createStrategy(){var B=
this.service,t="isSourceHosted"in B&&B.isSourceHosted,w=Array.isArray(B.source);B=B.source&&"collection"in B.source;t=t||w||B;w=f.FeatureSourceQueryInfo.fromSchema(this._schema);return"stream"===this._schema.type?(t=new e.StreamLoadStrategy(this._schema.service,this._schema.dataFilter,this._store,{outSR:this._schema.dataFilter.outSpatialReference},this.metadata),this._streamMessenger.strategy=t):(B=await this._supportSnapshotMode(w))?new n.SnapshotLoadStrategy(this._schema.service,w,this._store,B.featureCount,
this.metadata,this._eventLog):t?new x.PagedTileLoadStrategy(this._schema.service,w,this._store,this.metadata,this._eventLog):new g.DrillDownTileLoadStrategy(this._schema.service,w,this._store,this.metadata,this._eventLog)}async _updateStrategy(B){const t=await this._createStrategy();this._eventLog.onEvent({type:"updateStrategyStart",about:t.about});const w=!!this._strategy;this._store.clear();this._strategy?.destroy();this._strategy=t;r("esri-2d-update-debug")&&console.debug(`Version[${B}] FeatureSource.updateStrategy`,
{strategy:t});var C=Array.from(this._subscriptions.values());if(C.length){C=Promise.all(C.map(z=>this._strategy.load(z).then(()=>this._eventLog.onEvent({type:"loaded",tile:z.tile.id})).catch(D=>this._eventLog.onEvent({type:"error",tile:z.tile.id,error:D}))));this._updateTracking.addPromise(C);try{w&&await C}catch(z){k.throwIfNotAbortError(z)}this._eventLog.onEvent({type:"updateStrategyEnd"});r("esri-2d-update-debug")&&console.debug(`Version[${B}] FeatureSource.updateStrategyEnd`,{strategy:t})}else this._eventLog.onEvent({type:"updateStrategyEnd"})}async _supportSnapshotMode(B){const t=
this._schema.service;if(!("supportsSnapshotMinThreshold"in t&&t.supportsSnapshotMinThreshold&&t.snapshotCountThresholds))return null;var w=t.source;B=B.createQuery();B.inner.orderByFields=[];B.inner.returnGeometry=!1;w=(await c.executeQueryForCount(w,B.inner,{query:B.customParameters})).data.count;const {min:C,max:z}=t.snapshotCountThresholds;return w<=C||t.supportsSnapshotMaxThreshold&&w<z?{featureCount:w}:null}}a.FeatureSource=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define("exports ../../../request ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../operations/urlUtils ./pbfQueryUtils ./queryZScale".split(" "),
function(a,q,r,k,l,m,b,c,d){function f(n,e){if(e&&"extent"===n.type)return`${n.xmin},${n.ymin},${n.xmax},${n.ymax}`;if(e&&"point"===n.type)return`${n.x},${n.y}`;n=n.toJSON();delete n.spatialReference;return JSON.stringify(n)}function p(n,e){const h=n.geometry,u=n.toJSON();delete u.compactGeometryEnabled;delete u.defaultSpatialReferenceEnabled;let v,y,B;null!=h&&(y=h.spatialReference,B=m.srToRESTValue(y),u.geometryType=k.getJsonType(h),u.geometry=f(h,n.compactGeometryEnabled),u.inSR=B);u.groupByFieldsForStatistics&&
(u.groupByFieldsForStatistics=u.groupByFieldsForStatistics.join(","));u.objectIds&&(u.objectIds=u.objectIds.join(","));u.orderByFields&&(u.orderByFields=u.orderByFields.join(","));!u.outFields||!u.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete u.outFields:u.outFields.includes("*")?u.outFields="*":u.outFields=u.outFields.join(",");u.outSR?(u.outSR=m.srToRESTValue(u.outSR),v=n.outSpatialReference):h&&(u.returnGeometry||u.returnCentroid)&&(u.outSR=u.inSR,v=y);
u.returnGeometry&&delete u.returnGeometry;u.outStatistics&&(u.outStatistics=JSON.stringify(u.outStatistics));u.fullText&&(u.fullText=JSON.stringify(u.fullText));u.pixelSize&&(u.pixelSize=JSON.stringify(u.pixelSize));u.quantizationParameters&&(n.defaultSpatialReferenceEnabled&&null!=y&&null!=n.quantizationParameters?.extent&&y.equals(n.quantizationParameters.extent.spatialReference)&&delete u.quantizationParameters.extent.spatialReference,u.quantizationParameters=JSON.stringify(u.quantizationParameters));
u.parameterValues&&(u.parameterValues=JSON.stringify(u.parameterValues));u.rangeValues&&(u.rangeValues=JSON.stringify(u.rangeValues));u.dynamicDataSource&&(u.layer=JSON.stringify({source:u.dynamicDataSource}),delete u.dynamicDataSource);if(u.timeExtent){const {start:t,end:w}=u.timeExtent;if(null!=t||null!=w)u.time=t===w?t:`${null==t?"null":t},${null==w?"null":w}`;delete u.timeExtent}n.defaultSpatialReferenceEnabled&&null!=y&&null!=v&&y.equals(v)&&(u.defaultSR=u.inSR,delete u.inSR,delete u.outSR);
return u}function g(n,e,h){return x(n,e,"pbf",h)}async function x(n,e,h,u={},v={}){n="string"===typeof n?r.urlToObject(n):n;var y=(await l.normalizeCentralMeridian(e.geometry?[e.geometry]:[],null,{signal:u.signal}))?.[0];null!=y&&(e=e.clone(),e.geometry=y);y=b.mapParameters({...n.query,f:h,...v,...p(e,v)});return q(r.join(n.path,null==e.formatOf3DObjects||v.returnCountOnly||v.returnExtentOnly||v.returnIdsOnly?"query":"query3d"),{...u,responseType:"pbf"===h?"array-buffer":"json",query:{...y,...u.query}})}
a.encodeGeometry=f;a.executeQuery=async function(n,e,h,u){n=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await x(n,e,"json",u);d.applyFeatureSetZUnitScaling(e,h,n.data);return n};a.executeQueryForCount=function(n,e,h){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(n,e,"json",h,{returnIdsOnly:!0,returnCountOnly:!0})};a.executeQueryForExtent=async function(n,e,h){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};n=await x(n,
e,"json",h,{returnExtentOnly:!0,returnCountOnly:!0});e=n.data;if(e.hasOwnProperty("extent"))return n;if(e.features)throw Error("Layer does not support extent calculation.");if(e.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");return n};a.executeQueryForIds=function(n,e,h){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(n,e,"json",h,{returnIdsOnly:!0})};a.executeQueryPBF=async function(n,e,h,u){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:h.createFeatureResult()};
n=await g(n,e,u);n.data=c.parsePBFFeatureQuery(n.data,h);return n};a.executeQueryPBFBuffer=g;a.queryToQueryStringParameters=p;a.runQuery=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(a){function q(r){const k={};for(const l in r){if("declaredClass"===l)continue;const m=r[l];if(null!=m&&"function"!==typeof m)if(Array.isArray(m)){k[l]=[];for(let b=0;b<m.length;b++)k[l][b]=q(m[b])}else"object"===typeof m?m.toJSON&&
(k[l]=JSON.stringify(m)):k[l]=m}return k}a.mapParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(a,q){a.parsePBFFeatureQuery=function(r,k){var l=q.parseFeatureQuery(r,k);r=l.queryResult.featureResult;k=l.queryResult.queryGeometry;l=l.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const m=r.objectIdFieldName;for(const b of r.features)b.attributes&&
(b.objectId=b.attributes[m])}r&&(r.queryGeometry=k,r.queryGeometryType=l);return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(a,q,r,k,l){function m(z){return z>=t.length?null:t[z]}function b(z,D,H){z=z.asUnsafe();for(H=D.createPointGeometry(H);z.next();)switch(z.tag()){case 3:var G=
z.getUInt32();G=z.pos()+G;let A=0;for(;z.pos()<G;)D.addCoordinatePoint(H,z.getSInt64(),A++);break;default:z.skip()}return H}function c(z,D,H){z=z.asUnsafe();const G=D.createGeometry(H);for(H=2+(H.hasZ?1:0)+(H.hasM?1:0);z.next();)switch(z.tag()){case 2:var A=z.getUInt32();A=z.pos()+A;for(var F=0;z.pos()<A;)D.addLength(G,z.getUInt32(),F++);break;case 3:A=z.getUInt32();A=z.pos()+A;F=0;for(D.allocateCoordinates(G);z.pos()<A;)D.addCoordinate(G,z.getSInt64(),F),F++,F===H&&(F=0);break;default:z.skip()}return G}
function d(z){z=z.asUnsafe();const D=new k;let H="esriGeometryPoint";for(;z.next();)switch(z.tag()){case 2:var G=z.getUInt32();for(G=z.pos()+G;z.pos()<G;)D.lengths.push(z.getUInt32());break;case 3:G=z.getUInt32();for(G=z.pos()+G;z.pos()<G;)D.coords.push(z.getSInt64());break;case 1:H=l.optimizedGeometryTypes[z.getEnum()];break;default:z.skip()}return{queryGeometry:D,queryGeometryType:H}}function f(z){for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();
case 3:return z.getDouble();case 4:return z.getSInt32();case 5:return z.getUInt32();case 6:return z.getInt64();case 7:return z.getUInt64();case 8:return z.getSInt64();case 9:return z.getBool();default:return z.skip(),null}return null}function p(z){z=z.asUnsafe();const D={type:m(0)};for(;z.next();)switch(z.tag()){case 1:D.name=z.getString();break;case 2:D.type=m(z.getEnum());break;case 3:D.alias=z.getString();break;case 4:var H=z.getEnum();H=H>=w.length?null:w[H];D.sqlType=H;break;case 5:z.skip();
break;case 6:D.defaultValue=z.getString();break;default:z.skip()}return D}function g(z){const D={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:D.name=z.getString();break;case 2:D.isSystemMaintained=z.getBool();break;default:z.skip()}return D}function x(z,D,H,G){const A=D.createFeature(H);let F=0;for(;z.next();)switch(z.tag()){case 1:const J=G[F++].name;A.attributes[J]=z.processMessage(f);break;case 2:A.geometry=z.processMessageWithArgs(c,D,H);break;case 4:A.centroid=z.processMessageWithArgs(b,
D,H);break;default:z.skip()}return A}function n(z){const D=[1,1,1,1];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:D[0]=z.getDouble();break;case 2:D[1]=z.getDouble();break;case 4:D[2]=z.getDouble();break;case 3:D[3]=z.getDouble();break;default:z.skip()}return D}function e(z){const D=[0,0,0,0];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:D[0]=z.getDouble();break;case 2:D[1]=z.getDouble();break;case 4:D[2]=z.getDouble();break;case 3:D[3]=z.getDouble();break;default:z.skip()}return D}function h(z){const D=
{originPosition:0>=C.length?null:C[0]};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:var H=z.getEnum();D.originPosition=H>=C.length?null:C[H];break;case 2:D.scale=z.processMessage(n);break;case 3:D.translate=z.processMessage(e);break;default:z.skip()}return D}function u(z){const D={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:D.shapeAreaFieldName=z.getString();break;case 2:D.shapeLengthFieldName=z.getString();break;case 3:D.units=z.getString();break;default:z.skip()}return D}function v(z,
D){for(D=D.createSpatialReference();z.next();)switch(z.tag()){case 1:D.wkid=z.getUInt32();break;case 5:D.wkt=z.getString();break;case 2:D.latestWkid=z.getUInt32();break;case 3:D.vcsWkid=z.getUInt32();break;case 4:D.latestVcsWkid=z.getUInt32();break;default:z.skip()}return D}function y(z,D){const H=D.createFeatureResult();z=z.asUnsafe();H.geometryType=0>=D.geometryTypes.length?null:D.geometryTypes[0];let G=!1;for(;z.next();)switch(z.tag()){case 1:H.objectIdFieldName=z.getString();break;case 3:H.globalIdFieldName=
z.getString();break;case 4:H.geohashFieldName=z.getString();break;case 5:H.geometryProperties=z.processMessage(u);break;case 7:var A=z.getEnum();H.geometryType=A>=D.geometryTypes.length?null:D.geometryTypes[A];break;case 8:H.spatialReference=z.processMessageWithArgs(v,D);break;case 10:H.hasZ=z.getBool();break;case 11:H.hasM=z.getBool();break;case 12:H.transform=z.processMessage(h);break;case 9:H.exceededTransferLimit=z.getBool();break;case 13:D.addField(H,z.processMessage(p));break;case 15:G||(D.prepareFeatures(H),
G=!0);D.addFeature(H,z.processMessageWithArgs(x,D,H,H.fields));break;case 2:H.uniqueIdField=z.processMessage(g);break;default:z.skip()}D.finishFeatureResult(H);return H}function B(z,D){const H={};let G=null;for(;z.next();)switch(z.tag()){case 4:G=z.processMessageWithArgs(d);break;case 1:H.featureResult=z.processMessageWithArgs(y,D);break;default:z.skip()}null!=G&&H.featureResult&&D.addQueryGeometry(H,G);return H}const t="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeBigInteger esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "),
w="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),C=["upperLeft","lowerLeft"];a.parseFeatureQuery=function(z,D){try{const H=new r(new Uint8Array(z),new DataView(z));
for(z={};H.next();)switch(H.tag()){case 2:z.queryResult=H.processMessageWithArgs(B,D);break;default:H.skip()}return z}catch(H){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:H});}};a.parseField=p;a.parseFieldType=m;a.parseTransform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define("exports ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/OptimizedFeature ../../../layers/graphics/OptimizedFeatureSet ../../../layers/graphics/OptimizedGeometry".split(" "),
function(a,q,r,k,l,m){const b=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(d){this._options=d;this.geometryTypes=b;this._vertexDimension=this._coordinatePtr=0}createFeatureResult(){return new l}prepareFeatures(d){this._vertexDimension=2;d.hasZ&&this._vertexDimension++;d.hasM&&this._vertexDimension++}finishFeatureResult(d){if(d?.features&&d.hasZ&&this._options.sourceSpatialReference&&d.spatialReference&&!r.equals(d.spatialReference,
this._options.sourceSpatialReference)&&!d.spatialReference.vcsWkid){var f=q.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference),p=q.getMetersPerVerticalUnitForSR(d.spatialReference);f/=p;if(1!==f)for(const g of d.features)if(k.hasGeometry(g))for(d=g.geometry.coords,p=2;p<d.length;p+=3)d[p]*=f}}addFeature(d,f){d.features.push(f)}createFeature(){return new k.OptimizedFeature}createSpatialReference(){return{wkid:0}}createGeometry(){return new m}addField(d,f){d.fields.push(f)}allocateCoordinates(d){d.coords.length=
d.lengths.reduce((f,p)=>f+p,0)*this._vertexDimension;this._coordinatePtr=0}addCoordinate(d,f){d.coords[this._coordinatePtr++]=f}addCoordinatePoint(d,f){d.coords.push(f)}addLength(d,f){d.lengths.push(f)}addQueryGeometry(d,f){d.queryGeometry=f.queryGeometry;d.queryGeometryType=f.queryGeometryType}createPointGeometry(){return new m}}a.OptimizedFeatureSetParserContext=c;a.optimizedGeometryTypes=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports",
"../../../geometry/support/zscale"],function(a,q){a.applyFeatureSetZUnitScaling=function(r,k,l){if(l?.features&&l.hasZ&&(r=q.getGeometryZScaler(l.geometryType,k,r.outSpatialReference),null!=r))for(const m of l.features)r(m.geometry)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreStatistics":function(){define(["exports"],function(a){class q{static from(r){let k=0,l=0,m=0;r.forEach(b=>{if(b=b._readGeometry())l+=b.isPoint?1:b.lengths.reduce((c,
d)=>c+d,0),m+=b.isPoint?1:b.lengths.length,k+=1});return new q(k,l,m)}constructor(r,k,l){this.featureCount=r;this.vertexCount=k;this.ringCount=l}toJSON(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}a.FeatureStoreStatistics=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceQueryInfo":function(){define(["exports","../../../../../TimeExtent","../../../../../core/has","../../../../../geometry/SpatialReference",
"../../../../../rest/support/Query"],function(a,q,r,k,l){class m{static fromSchema(b){{var c=b.service;const d="orderByFields"in c&&c.orderByFields?c.orderByFields:c.objectIdField+" ASC";c={returnCentroid:"esriGeometryPolygon"===c.geometryType,returnGeometry:!0,timeReferenceUnknownClient:"timeReferenceUnknownClient"in c?c.timeReferenceUnknownClient:!1,outSpatialReference:k.fromJSON(b.dataFilter.outSpatialReference),orderByFields:[d],where:b.dataFilter.definitionExpression??"1\x3d1",outFields:b.availableFields};
if("feature"===b.type){const {gdbVersion:f,historicMoment:p,timeExtent:g}=b.dataFilter;c={...c,gdbVersion:f,historicMoment:p?new Date(p):null,timeExtent:g?q.fromJSON(g):null,outFields:b.availableFields}}}return new m(c,b.dataFilter.customParameters,b.service.geometryType,"capabilities"in b.service?b.service.capabilities:null)}constructor(b,c,d,f){this._queryParams=b;this._customParameters=c;this._geometryType=d;this._capabilities=f}get pageSize(){if(null==this._capabilities)throw Error("InternalError: Service does not support paged queries");
const {query:b}=this._capabilities;return Math.min(8E3,(b.maxRecordCount??8E3)*((b.supportsMaxRecordCountFactor?4:null)??1))}updateFields(b){this._queryParams.outFields=b}createPatchFieldsQuery(b,c){b=b.clone();if("*"===this._queryParams.outFields[0]){if("*"===(b.outFields??[])[0])return null;b.outFields=this._queryParams.outFields}else{const d=new Set(this._queryParams.outFields),f=[];for(const p of d)c.has(p)||f.push(p);if(0===f.length)return null;b.outFields=f}b.returnGeometry=!1;b.returnCentroid=
!1;b.quantizationParameters=null;b.cacheHint=!0;return{inner:b,customParameters:this._customParameters}}createQuery(b={}){if(!this._queryParams)throw Error("InternalError: queryInfo should be defined");return{inner:new l({...this._queryParams,...b}),customParameters:this._customParameters}}createTileQuery(b,c){if(null==this._capabilities)throw Error("InternalError: Service does not support tile queries");const d=this.createQuery(c),f=d.inner;f.quantizationParameters=c.quantizationParameters??b.getQuantizationParameters();
f.resultType="tile";f.geometry=b.extent;if(this._capabilities.query.supportsQuantization)"esriGeometryPolyline"===this._geometryType&&(f.maxAllowableOffset=b.resolution*r("feature-polyline-generalization-factor"));else if("esriGeometryPolyline"===this._geometryType||"esriGeometryPolygon"===this._geometryType)f.maxAllowableOffset=b.resolution,"esriGeometryPolyline"===this._geometryType&&(f.maxAllowableOffset*=r("feature-polyline-generalization-factor"));f.defaultSpatialReferenceEnabled=this._capabilities.query.supportsDefaultSpatialReference;
f.compactGeometryEnabled=this._capabilities.query.supportsCompactGeometry;this._capabilities.query.supportsMaxRecordCountFactor&&(f.maxRecordCountFactor=4);return d}createPagedTileQuery(b,c){const d=this.pageSize;return this.createTileQuery(b,{start:d*c,num:d,returnExceededLimitFeatures:!0})}createPagedQuery(b){const c=this.pageSize;return this.createQuery({start:c*b,num:c,returnExceededLimitFeatures:!0,maxRecordCountFactor:4})}}a.FeatureSourceQueryInfo=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamMessenger":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,k,l,m,b,c,d){a.StreamMessenger=class extends r{constructor(f){super();this._connection=
f;this._enabledEventTypes=new Set;this._updateInfo={websocket:0,client:0};this._lastTime=performance.now();this.addHandles([k.watch(()=>this._strategy?.connectionStatus??"disconnected",p=>{this._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:p})},{initial:!0}),k.watch(()=>this._strategy?.errorString||null,p=>this._layerView.setProperty({propertyName:"pipelineErrorString",value:p}),{initial:!0})])}destroy(){this._strategy=null;this.removeAllHandles()}get _layerView(){return this._connection.layerView}set strategy(f){null==
this._strategy&&this._resetUpdateInfo(performance.now());this.removeHandles("event-handles");null!=f&&this.addHandles([f.events.on("data-received",p=>this._onFeature(p)),f.events.on("message-received",p=>this._onWebSocketMessage(p)),f.events.on("features-updated",p=>this._onUpdate(p)),f.events.on("tick",()=>this._onTick())],"event-handles");this._strategy=f}updateCustomParameters(f){null!=f&&this._strategy?.updateCustomParameters(f)}sendMessageToSocket(f){this._strategy?.sendMessageToSocket(f)}sendMessageToClient(f){this._strategy?.sendMessageToClient(f)}enableEvent(f,
p){p?this._enabledEventTypes.add(f):this._enabledEventTypes.delete(f)}disconnect(){this._strategy?.disconnect()}connect(){this._strategy?.connect()}clear(){this._strategy?.clear()}_onWebSocketMessage(f){this._enabledEventTypes.has("message-received")&&this._layerView.emitEvent({name:"message-received",event:f})}_onFeature(f){this._updateInfo.websocket++;this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:f.attributes,centroid:f.centroid,
geometry:f.geometry}})}_onUpdate(f){this._updateInfo.client+=f}_onTick(){const f=performance.now();var p=f-this._lastTime;if(2500<p){const g=Math.round(this._updateInfo.client/(p/1E3));p=Math.round(this._updateInfo.websocket/(p/1E3));this._resetUpdateInfo(f);this._layerView.emitEvent({name:"update-rate",event:{client:g,websocket:p}})}}_resetUpdateInfo(f){this._lastTime=f;this._updateInfo.client=0;this._updateInfo.websocket=0}};q.__decorate([l.property()],a.StreamMessenger.prototype,"_strategy",void 0);
a.StreamMessenger=q.__decorate([d.subclass("esri.views.2d.layers.features.sources.StreamMessenger")],a.StreamMessenger);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/DrillDownTileLoadStrategy":function(){define("exports ../../../../../../core/has ../../../../../../core/promiseUtils ./ATileLoadStrategy ./chunks/DrillDownTileSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(a,q,r,k,l,m){class b{constructor(d,f){this.subscription=
d;this._tileIdToResult=new Map;this._controller=new AbortController;r.onAbort(d.options,()=>this._controller.abort());r.onAbort(f,()=>this._controller.abort())}get(d){return this._tileIdToResult.get(d)}set(d,f){this._tileIdToResult.set(d,f)}get options(){return{signal:this._controller.signal}}}class c extends k.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(d){this._loadStates.has(d.key.id)||
this._loadStates.set(d.key.id,new b(d,this._options));const f=this._loadStates.get(d.key.id);let p;try{for await(const g of this._fetchChunkInfos(f,d.tile,0)){const {queryJSON:x,reader:n,sourceTile:e,sourceTileDepth:h,tile:u}=g,v=new l.DrillDownTileSourceChunk(n,x,u,e,h,!1);r.throwIfAborted(d.options);this._addChunk(v)}}catch(g){p=g}d=new l.DrillDownTileSourceChunk(m.FeatureSetReaderJSON.empty(this._metadata),null,d.tile,null,-1,!0);this._addChunk(d);if(p)throw p;}unload(d){super.unload(d);this._loadStates.delete(d.key.id)}async *_fetchChunkInfos(d,
f,p){let g=d.get(f.id);const x=!!g;g||(g=await this._fetchChunkInfo(d,f,p),d.set(f.id,g));if(g.reader.exceededTransferLimit&&p<q("featurelayer-query-max-depth"))for(const n of f.createChildTiles())yield*this._fetchChunkInfos(d,n,p+1);else x||(yield g)}async _fetchChunkInfo(d,f,p){var g=d.subscription.tile.getQuantizationParameters();g=this._queryInfo.createTileQuery(f,{returnExceededLimitFeatures:!1,quantizationParameters:g});return{reader:await this._fetch(g,d.subscription.options),queryJSON:g.inner.toJSON(),
tile:d.subscription.tile,sourceTile:f,sourceTileDepth:p}}}a.DrillDownTileLoadStrategy=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ATileLoadStrategy":function(){define(["exports","../../../../../../core/has","./AFetchLoadStrategy"],function(a,q,r){class k extends r.AFetchLoadStrategy{constructor(){super(...arguments);this._chunksById=new Map}unload(l){this._removeChunks(l.tile)}_addChunk(l){const m=l.tile.id;this._chunksById.has(m)||
this._chunksById.set(m,[]);const b=l.size();if(b||l.first||l.end)q("esri-2d-update-debug")&&console.debug(`Chunk[${l.chunkId}] ATileLoadStrategy.addChunk [count=${b}]`),this._chunksById.get(m).push(l),this._store.insert(l)}_removeChunks(l){const m=this._chunksById.get(l.key.id)??[];for(const b of m)q("esri-2d-update-debug")&&console.debug(`Tile[${l.key.id}] Chunk[${b.chunkId}] ATileLoadStrategy.removeChunk`),this._store.remove(b);this._chunksById.delete(l.key.id)}}a.ATileLoadStrategy=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/AFetchLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../rest/support/Query ./ALoadStrategy ./support/queryAdapters ../../../../../support/QueueProcessor".split(" "),function(a,q,r,k,l,m){class b extends k.ALoadStrategy{constructor(c,d,f,p,g){super(f);this._serviceInfo=c;this._queryInfo=d;this._metadata=p;this._eventLog=g;this._queue=new m.QueueProcessor({concurrency:8,process:async x=>
this._adapter.executeQuery(x.query.inner,{signal:x.options?.signal,query:x.query.customParameters})});this._adapter=l.createQueryAdapter(c,p)}async updateFields(c){this._queryInfo.updateFields(c);c=Array.from(this._store.chunks()).map(async d=>{const f=r.fromJSON(d.queryInfo.queryJSON);if(f)try{return await this._tryUpdateFields(d.reader,f),null}catch(p){return p}});c=(await Promise.all(c)).filter(d=>d);if(c.length)throw new q("featurelayer-query","Encountered errors when downloading fields",{errors:c});
}async queryOverride({edits:c}){const d=[],f=[];for(const p of c.removed)null==p.objectId||-1===p.objectId?f.push(p.globalId):d.push(p.objectId);f.length&&d.push(...this._mapGlobalIdsToObjectIds(f));c=c.addOrModified.map(({objectId:p})=>p);c=this._queryInfo.createQuery({objectIds:c});return{reader:await this._fetch(c),removed:d}}_mapGlobalIdsToObjectIds(c){const d=new Set(c),f="globalIdField"in this._serviceInfo?this._serviceInfo.globalIdField:null;if(null==f)throw Error("InternalError: Recieved an edit with globalIds, but not supported by the service");
const p=[];this._store.forEachUnsafe(g=>{const x=g.readAttribute(f);d.has(x)&&p.push(g.getObjectId())});return p}async _fetch(c,d){d=await this._enqueue(c,d);await this._tryUpdateFields(d,c.inner);return d}async _tryUpdateFields(c,d){if(d=this._queryInfo.createPatchFieldsQuery(d,c.fields))d=await this._enqueue(d,this._options),c.joinAttributes(d)}async _enqueue(c,d){this._eventLog.onEvent({type:"fetchStart"});return this._queue.push({query:c,options:d}).finally(()=>{this._eventLog.onEvent({type:"fetchEnd",
done:0===this._queue.length})})}}a.AFetchLoadStrategy=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ALoadStrategy":function(){define(["exports"],function(a){class q{constructor(r){this._store=r;this._controller=new AbortController}destroy(){this._controller.abort()}get _options(){return{signal:this._controller.signal}}async queryOverride(r){throw Error("InternalError: LoadStrategy does not support fetching");}}a.ALoadStrategy=q;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/support/queryAdapters":function(){define("exports ../../../../../../../core/has ../../../../../../../core/workers/Connection ../../../../../../../geometry/support/quantizationUtils ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../../rest/query/operations/query ../../../support/FeatureSetReaderJSON ../../../support/FeatureSetReaderPBF".split(" "),
function(a,q,r,k,l,m,b,c,d){async function f(h){const u=new r;await u.open(h,{});return u}class p{constructor(h,u){this.service=h;this._metadata=u}destroy(){}}class g extends p{constructor(h,u){super(h,u);this._portsOpen=f(h.source).then(v=>this.client=v)}destroy(){this.client.close();this.client=null}async executeQuery(h,u){await this._portsOpen;h=await this.client.invoke("queryFeatures",h.toJSON(),u);return c.FeatureSetReaderJSON.fromFeatureSet(h,this._metadata)}}class x extends p{async executeQuery(h,
u){({data:u}=await b.executeQueryPBFBuffer(this.service.source,h,u));return d.FeatureSetReaderPBF.fromBuffer(u,this._metadata,!h.quantizationParameters)}}class n extends p{async executeQuery(h,u){const {source:v,capabilities:y,spatialReference:B,objectIdField:t,geometryType:w}=this.service;if(null!=h.quantizationParameters&&!y.query.supportsQuantization){const C=h.clone();h=k.toQuantizationTransform(C.quantizationParameters);C.quantizationParameters=null;({data:u}=await b.executeQuery(v,C,B,u));u=
l.convertFromFeatureSet(u,t);l.quantizeOptimizedFeatureSet(h,u);return c.FeatureSetReaderJSON.fromOptimizedFeatureSet(u,this._metadata)}({data:h}=await b.executeQuery(v,h,this.service.spatialReference,u));"esriGeometryPoint"===w&&(h.features=h.features?.filter(C=>null!=C.geometry?(C=C.geometry,Number.isFinite(C.x)&&Number.isFinite(C.y)):!0));return c.FeatureSetReaderJSON.fromFeatureSet(h,this._metadata)}}class e extends p{async executeQuery(h,u){var {capabilities:v}=this.service;if(h.quantizationParameters&&
!v.query.supportsQuantization){const y=h.clone();v=k.toQuantizationTransform(y.quantizationParameters);y.quantizationParameters=null;h=await m.queryOptimizedFeatureSet(this.service.source,h,u);l.quantizeOptimizedFeatureSet(v,h);return c.FeatureSetReaderJSON.fromOptimizedFeatureSet(h,this._metadata)}h=await m.queryOptimizedFeatureSet(this.service.source,h,u);return c.FeatureSetReaderJSON.fromOptimizedFeatureSet(h,this._metadata)}}a.SourceAdapter=p;a.createQueryAdapter=function(h,u){switch(h.type){case "memory":return new g(h,
u);case "ogc":return new e(h,u);case "feature-service":return h.capabilities.query.supportsFormatPBF&&q("featurelayer-pbf")?new x(h,u):new n(h,u)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define("../handleUtils ../promiseUtils ../Queue ./connectionRegistry ./InvokeHandler ./RemoteClient".split(" "),function(a,q,r,k,l,m){class b{constructor(){this._inUseClients=[];this._clients=[];this._clientPromises=[];this._ongoingJobsQueue=new r}destroy(){this.close()}get closed(){return!this._clients?.length}open(c,
d){return new Promise((f,p)=>{let g=!0;const x=n=>{q.throwIfAborted(d.signal);g&&(g=!1,n())};this._clients.length=c.length;this._clientPromises.length=c.length;this._inUseClients.length=c.length;for(let n=0;n<c.length;++n){const e=c[n];q.isPromiseLike(e)?this._clientPromises[n]=e.then(h=>{this._clients[n]=new m(h,d,this._ongoingJobsQueue);x(f);return this._clients[n]},()=>{x(p);return null}):(this._clients[n]=new m(e,d,this._ongoingJobsQueue),this._clientPromises[n]=Promise.resolve(this._clients[n]),
x(f))}})}broadcast(c,d,f){const p=Array(this._clientPromises.length);for(let g=0;g<this._clientPromises.length;++g)p[g]=this._clientPromises[g].then(x=>x?.invoke(c,d,f));return p}close(){let c;for(;c=this._ongoingJobsQueue.pop();)c.resolver.reject(q.createAbortError(`Worker closing, aborting job calling '${c.methodName}'`));for(const d of this._clientPromises)d.then(f=>f?.close());this._clients.length=0;this._clientPromises.length=0;this._inUseClients.length=0;k.unregister(this)}invoke(c,d,f){return this.apply(c,
[d],f)}apply(c,d,f){const p=q.createResolver();this._ongoingJobsQueue.push({methodName:c,data:d,invokeOptions:f,resolver:p});for(c=0;c<this._clientPromises.length;c++)(d=this._clients[c])?d.jobAdded():this._clientPromises[c].then(g=>g?.jobAdded());return p.promise}createInvokeProxy(c){return l.createInvokeProxy(this,c)}on(c,d){return Promise.all(this._clientPromises).then(()=>a.handlesGroup(this._clients.map(f=>f.on(c,d))))}openPorts(){return new Promise(c=>{const d=Array(this._clientPromises.length);
let f=d.length;for(let p=0;p<this._clientPromises.length;++p)this._clientPromises[p].then(g=>{g&&(d[p]=g.openPort());0===--f&&c(d)})})}get test(){return{numClients:this._clients.length}}}return b})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(a){const q=new FinalizationRegistry(r=>{r.close()});a.register=function(r,k){q.register(r,k,k)};a.unregister=function(r){q.unregister(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/ogc/ogcFeatureUtils":function(){define("exports ../../geometry ../../request ../../core/Error ../../core/Logger ../../core/urlUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../graphics/featureConversionUtils ../graphics/OptimizedFeatureSet ../graphics/sources/geojson/geojson ../graphics/sources/support/clientSideDefaults ../graphics/sources/support/sourceUtils ../support/FieldsIndex ../support/fieldType ../../time/timeZoneUtils ../../geometry/SpatialReference".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u){async function v(G,A,F){const {collection:{links:J,landingPage:{url:K}},layerDefinition:P,maxRecordCount:E,queryParameters:{apiKey:M,customParameters:T},spatialReference:ba,supportedCrs:ea}=G;var X=w(J,"items",H.geojson)||w(J,"http://www.opengis.net/def/rel/ogc/1.0/items",H.geojson);if(null==X)throw new k("ogc-feature-layer:missing-items-page","Missing items url");const {geometry:ca,num:ma,start:S,timeExtent:Y,where:ia}=A;if(A.objectIds)throw new k("ogc-feature-layer:query-by-objectids-not-supported",
"Queries with object ids are not supported");G=u.fromJSON(ba);A=A.outSpatialReference??G;G=A.isWGS84?null:y(A,ea);if(null==ca||"extent"!==ca.type)var na=null;else if({spatialReference:na}=ca,!na||na.isWGS84)na={bbox:B(ca)};else{var ta=y(na,ea);na=null!=ta?{bbox:B(ca),"bbox-crs":ta}:na.isWebMercator?{bbox:B(c.project(ca,u.WGS84))}:null}ta=na;if(null==Y)na=null;else{var {start:va,end:xa}=Y;na=`${null!=va?va.toISOString():".."}/${null!=xa?xa.toISOString():".."}`}const wa=na;var Ca=null!=ia&&ia&&"1\x3d1"!==
ia?ia:null;na=ma??(null==S?E:10);const L=0===S?void 0:S,{fields:R,geometryType:fa,hasZ:ka,objectIdField:qa,paginationParameter:Q}=P;X=m.makeAbsolute(X.href,K);({data:X}=await r(X,{...F,query:{...T,...ta,crs:G,datetime:wa,query:Ca,limit:na,[Q]:L,token:M},headers:{accept:H.geojson}}));F=p.createOptimizedFeatures(X,{geometryType:fa,hasZ:ka,objectIdField:qa});X=F.length===na&&!!w(X.links??[],"next",H.geojson);na=new n(R);for(var V of F)ta={},x.mixAttributes(na,ta,V.attributes),ta[qa]=V.attributes[qa],
V.attributes=ta;if(!G&&A.isWebMercator)for(var W of F)null!=W.geometry&&null!=fa&&(V=d.convertToGeometry(W.geometry,fa,ka,!1),V.spatialReference=u.WGS84,W.geometry=d.convertFromGeometry(c.project(V,A)));for(var ha of F)ha.objectId=ha.attributes[qa];W=G||!G&&A.isWebMercator?A.toJSON():b.wgs84;ha=new f;ha.exceededTransferLimit=X;ha.features=F;ha.fields=R;ha.geometryType=fa;ha.hasZ=ka;ha.objectIdFieldName=qa;ha.spatialReference=W;return ha}function y(G,A){const {isWebMercator:F,wkid:J}=G;return J?(G=
F?A[3857]??A[102100]??A[102113]??A[900913]:A[G.wkid])?`${"http://www.opengis.net/def/crs/"}${G}`:null:null}function B(G){if(null==G)return"";const {xmin:A,ymin:F,xmax:J,ymax:K}=G;return`${A},${F},${J},${K}`}function t(G){G=G.extent?.spatial;if(!G)return null;var A=G.bbox[0],F=4===A.length;const [J,K]=A;G=F?void 0:A[2];const P=F?A[2]:A[3],E=F?A[3]:A[4];A=F?void 0:A[5];F=u.WGS84.toJSON();return{xmin:J,ymin:K,xmax:P,ymax:E,zmin:G,zmax:A,spatialReference:F}}function w(G,A,F){return G.find(({rel:J,type:K})=>
J===A&&K===F)??G.find(({rel:J,type:K})=>J===A&&!K)}function C(G,A,F){if(F&&(F=w(F,"next",H.geojson),F=m.urlToObject(F?.href)?.query)){G=m.urlToObject(G).query;var J=Object.keys(G??{});return Object.entries(F).filter(([K])=>!J.includes(K)).find(([K,P])=>D.has(K.toLowerCase())&&Number.parseInt(P,10)===A)?.[0]}}const z=()=>l.getLogger("esri.layers.ogc.ogcFeatureUtils"),D=new Set(["startindex","offset"]);var H;(function(G){G.json="application/json";G.geojson="application/geo+json";G.openapi="application/vnd.oai.openapi+json;version\x3d3.0"})(H||=
{});a.crsDefault="http://www.opengis.net/def/crs/OGC/1.3/CRS84";a.crsPrefix="http://www.opengis.net/def/crs/";a.getCollectionDefinition=async function(G,A,F={},J=5){var {links:K}=G;K=w(K,"items",H.geojson)||w(K,"http://www.opengis.net/def/rel/ogc/1.0/items",H.geojson);if(null==K)throw new k("ogc-feature-layer:missing-items-page","Missing items url");const {apiKey:P,customParameters:E,signal:M}=F;F=m.makeAbsolute(K.href,G.landingPage.url);K=m.addQueryParameters(F,{limit:J,...E,token:P});({data:F}=
await r(K,{signal:M,headers:{accept:H.geojson}}));J=C(K,J,F.links)??"startindex";p.validateGeoJSON(F);const T=p.inferLayerProperties(F,{geometryType:A.geometryType});F=A.fields||T.fields||[];K=null!=A.hasZ?A.hasZ:T.hasZ;const ba=T.geometryType,ea=A.objectIdField||T.objectIdFieldName||"OBJECTID";A=A.timeInfo;var X=F.find(({name:S})=>S===ea);if(X)X.editable=!1,X.nullable=!1;else{if(!T.objectIdFieldType)throw new k("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");
F.unshift({name:ea,alias:ea,type:"number"===T.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}ea!==T.objectIdFieldName&&(X=F.find(({name:S})=>S===T.objectIdFieldName))&&(X.type="esriFieldTypeInteger");F===T.fields&&0<T.unknownFields.length&&z().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:T.unknownFields}});for(var ca of F){null==ca.name&&(ca.name=ca.alias);
null==ca.alias&&(ca.alias=ca.name);"esriFieldTypeOID"!==ca.type&&"esriFieldTypeGlobalID"!==ca.type&&(ca.editable=null==ca.editable||!!ca.editable,ca.nullable=null==ca.nullable||!!ca.nullable);if(!ca.name)throw new k("ogc-feature-layer:invalid-field-name","field name is missing",{field:ca});if(!e.kebabDict.jsonValues.includes(ca.type))throw new k("ogc-feature-layer:invalid-field-type",`invalid type for field "${ca.name}"`,{field:ca});}if(A){ca=new n(F);A.startTimeField&&((X=ca.get(A.startTimeField))?
(A.startTimeField=X.name,X.type="esriFieldTypeDate"):A.startTimeField=null);A.endTimeField&&((X=ca.get(A.endTimeField))?(A.endTimeField=X.name,X.type="esriFieldTypeDate"):A.endTimeField=null);A.trackIdField&&((ca=ca.get(A.trackIdField))?A.trackIdField=ca.name:(A.trackIdField=null,z().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:A}})));var ma;(ma=A).timeReference||(ma.timeReference={timeZoneIANA:h.utc});A.startTimeField||A.endTimeField||
(z().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:A}}),A=null)}ma=ba?g.createDrawingInfo(ba):null;G=t(G);return{drawingInfo:ma,extent:G,geometryType:ba,fields:F,hasZ:!!K,objectIdField:ea,paginationParameter:J,timeInfo:A}};a.getServerCollections=async function(G,A={}){const {links:F,url:J}=G,K=w(F,"data",H.json)||w(F,"http://www.opengis.net/def/rel/ogc/1.0/data",H.json);if(null==K)throw new k("ogc-feature-layer:missing-collections-page",
"Missing collections url");const {apiKey:P,customParameters:E,signal:M}=A;A=m.makeAbsolute(K.href,J);({data:A}=await r(A,{signal:M,headers:{accept:H.json},query:{...E,token:P}}));for(const T of A.collections)T.landingPage=G;return A};a.getServerConformance=async function(G,A={}){const {links:F,url:J}=G;G=w(F,"conformance",H.json)||w(F,"http://www.opengis.net/def/rel/ogc/1.0/conformance",H.json);if(null==G)throw new k("ogc-feature-layer:missing-conformance-page","Missing conformance url");const {apiKey:K,
customParameters:P,signal:E}=A;A=m.makeAbsolute(G.href,J);({data:A}=await r(A,{signal:E,headers:{accept:H.json},query:{...P,token:K}}));return A};a.getServerLandingPage=async function(G,A={}){const {apiKey:F,customParameters:J,signal:K}=A;({data:A}=await r(G,{signal:K,headers:{accept:H.json},query:{...J,token:F}}));A.url=G;return A};a.getServerOpenApi=async function(G,A={}){const {links:F,url:J}=G;G=w(F,"service-desc",H.openapi);if(null==G)return z().warn("ogc-feature-layer:missing-openapi-page",
"The OGC API-Features server does not have an OpenAPI page."),null;const {apiKey:K,customParameters:P,signal:E}=A;A=m.makeAbsolute(G.href,J);({data:A}=await r(A,{signal:E,headers:{accept:H.openapi},query:{...P,token:K}}));return A};a.getSpatialReferenceWkid=function(G){G=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(G)?.groups;if(!G)return null;const {authority:A,code:F}=G;switch(A.toLowerCase()){case "ogc":switch(F.toLowerCase()){case "crs27":return u.GCS_NAD_1927.wkid;
case "crs83":return 4269;case "crs84":case "crs84h":return u.WGS84.wkid;default:return null}case "esri":case "epsg":return G=Number.parseInt(F,10),Number.isNaN(G)?null:G;default:return null}};a.queryFeatureSetJSON=async function(G,A,F){G=await v(G,A,F);return d.convertToFeatureSet(G)};a.queryOptimizedFeatureSet=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define("exports ../../../../core/date ../../../../core/Error ../../../../geometry/support/spatialReferenceUtils ../../OptimizedFeature ../../OptimizedGeometry ../../../support/fieldUtils".split(" "),
function(a,q,r,k,l,m,b){function*c(t){switch(t.type){case "Feature":yield t;break;case "FeatureCollection":for(const w of t.features)w&&(yield w)}}function*d(t){if(t)switch(t.type){case "Point":yield t.coordinates;break;case "LineString":case "MultiPoint":yield*t.coordinates;break;case "MultiLineString":case "Polygon":for(const w of t.coordinates)yield*w;break;case "MultiPolygon":for(const w of t.coordinates)for(const C of w)yield*C}}function*f(t,w={}){const {geometryType:C,objectIdField:z}=w;for(const D of t){const {geometry:H,
properties:G,id:A}=D;if(H&&B[H.type]!==C)continue;t=G||{};let F=void 0;z&&(F=t[z],null==A||F||(t[z]=F=A));yield new l.OptimizedFeature(H?n(new m,H,w):null,t,null,F??void 0)}}function p(t){for(const w of t)if(2<w.length)return!0;return!1}function g(t){let w=0;for(let C=0;C<t.length;C++){const z=t[C],D=t[(C+1)%t.length];w+=z[0]*D[1]-D[0]*z[1]}return 0>=w}function x(t){const w=t[0],C=t[t.length-1];w[0]===C[0]&&w[1]===C[1]&&w[2]===C[2]||t.push(w);return t}function n(t,w,C){switch(w.type){case "LineString":return u(t,
w.coordinates,C),t;case "MultiLineString":for(const D of w.coordinates)u(t,D,C);return t;case "MultiPoint":return u(t,w.coordinates,C),t;case "MultiPolygon":for(var z of w.coordinates)for(e(t,z[0],C),w=1;w<z.length;w++)h(t,z[w],C);return t;case "Point":return y(t,w.coordinates,C),t;case "Polygon":z=w.coordinates;e(t,z[0],C);for(w=1;w<z.length;w++)h(t,z[w],C);return t}}function e(t,w,C){w=x(w);g(w)?u(t,w,C):v(t,w,C)}function h(t,w,C){w=x(w);g(w)?v(t,w,C):u(t,w,C)}function u(t,w,C){for(const z of w)y(t,
z,C);t.lengths.push(w.length)}function v(t,w,C){for(let z=w.length-1;0<=z;z--)y(t,w[z],C);t.lengths.push(w.length)}function y(t,w,C){const [z,D,H]=w;t.coords.push(z,D);C.hasZ&&t.coords.push(H||0)}const B={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};a.createOptimizedFeatures=function(t,w){return Array.from(f(c(t),w))};a.getGeometryType=function(t){return B[t]};
a.inferLayerProperties=function(t,w={}){const C=[];var z=new Set;const D=new Set;var H=!1;let G=null,A=!1,F=void 0;({geometryType:w=null}=w);var J=!1;for(const K of c(t)){const {geometry:P,properties:E,id:M}=K;if(P&&(w||=B[P.type],B[P.type]!==w))continue;H||(H=d(P),H=p(H));!A&&(A=null!=M)&&(F=typeof M,E&&(G=Object.keys(E).filter(T=>E[T]===M)));E&&G&&A&&null!=M&&(1<G.length?G=G.filter(T=>E[T]===M):1===G.length&&(G=E[G[0]]===M?G:[]));if(!J&&E){t=!0;for(const T in E){if(z.has(T))continue;J=E[T];if(null==
J){t=!1;D.add(T);continue}a:switch(typeof J){case "string":J=q.isISO8601Date(J)?"esriFieldTypeDate":"esriFieldTypeString";break a;case "number":J="esriFieldTypeDouble";break a;default:J="unknown"}if("unknown"===J){D.add(T);continue}D.delete(T);z.add(T);const ba=b.normalizeFieldName(T);ba&&C.push({name:ba,alias:T,type:J})}J=t}}if(z=b.normalizeFieldName(1===G?.length&&G[0]||null)??void 0)for(const K of C)if(K.name===z&&b.isNumericField(K)){K.type="esriFieldTypeOID";break}return{fields:C,geometryType:w,
hasZ:H,objectIdFieldName:z,objectIdFieldType:F,unknownFields:Array.from(D)}};a.validateGeoJSON=function(t,w=4326){if(!t)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==t.type&&"FeatureCollection"!==t.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});({crs:t}=t);if(t){var C="string"===typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null;w=k.isWGS84({wkid:w})?RegExp(".*(CRS84H?|4326)$",
"i"):new RegExp(`.*(${w})$`,"i");if(!C||!w.test(C))throw new r("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(a){function q(b){const c=new Date(b);if(Number.isNaN(c.getTime()))b=!1;else{var d=!0;if(m&&/\d+\W*$/.test(b)&&(b=b.match(/[a-zA-Z]{2,}/))){d=!1;let f=0;for(;!d&&f<=b.length;)d=!l.test(b[f]),f++;d=!d}b=d}return b?Number.isNaN(c.getTime())?null:c.getTime()-
6E4*c.getTimezoneOffset():null}function r(b){b=k.exec(b);if(!b?.groups)return null;b=b.groups;const c=+b.year,d=+b.month-1,f=+b.day,p=+(b.hours??0),g=+(b.minutes??0),x=+(b.seconds??0);if(23<p||59<g||59<x)return null;var n=b.ms??"0";n=n?+n.padEnd(3,"0").substring(0,3):0;b=b.isUTC||!b.offsetSign?Date.UTC(c,d,f,p,g,x,n):6E4*("+"===b.offsetSign?-1:1)*(60*+b.offsetHours+ +b.offsetMinutes)+Date.UTC(c,d,f,p,g,x,n);return Number.isNaN(b)?null:b}const k=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,
l=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,m=!Number.isNaN((new Date("technology 10")).getTime());a.isDateString=function(b){return null!=r(b)||null!=q(b)};a.isISO8601Date=function(b){return k.test(b)};a.parseDate=function(b){return r(b)??q(b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define(["exports",
"../../../../core/has","../../../../core/lang","../../data/QueryEngineCapabilities","../../../../symbols/support/defaultsJSON"],function(a,q,r,k,l){const m=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let b=1;a.createCapabilities=function(c,d){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:c},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:d,supportsDelete:d,
supportsEditing:d,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:d,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:k.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:d,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,
supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}};a.createDefaultAttributesFunction=function(c,d){if(q("esri-csp-restrictions"))return()=>({[d]:null,...c});try{let f=`this.${d} = null;`;for(const g in c){const x=m.test(g)?`.${g}`:`["${g}"]`;f+=`this${x} = ${JSON.stringify(c[g])};`}const p=(new Function(`\n      return class AttributesClass$${b++} {\n        constructor() {\n          ${f};\n        }\n      }\n    `))();
return()=>new p}catch(f){return()=>({[d]:null,...c})}};a.createDefaultTemplate=function(c={}){return[{name:"New Feature",description:"",prototype:{attributes:r.clone(c)}}]};a.createDrawingInfo=function(c){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===c||"esriGeometryMultipoint"===c?l.defaultPointSymbolJSON:"esriGeometryPolyline"===c?l.defaultPolylineSymbolJSON:l.defaultPolygonSymbolJSON}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require",
"exports","../../../../core/date","../../../../geometry/support/spatialReferenceUtils","../../../support/fieldUtils"],function(a,q,r,k,l){function m(x){return new d(x)}async function b(){null==g&&(g=await new Promise((x,n)=>a(["../../../../geometry/geometryEngineJSON"],x,n)));return g}class c{constructor(){this.description=this.code=null}}class d{constructor(x){this.error=new c;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=x}}class f{constructor(x){this.globalId=
null;this.success=!0;this.objectId=this.uniqueId=x}}const p=new Set;let g;q.createFeatureEditErrorResult=m;q.createFeatureEditSuccessResult=function(x){return new f(x)};q.loadGeometryEngineForSimplify=async function(x,n){!k.isValid(x)||"esriGeometryPolygon"!==n&&"esriGeometryPolyline"!==n||await b()};q.mixAttributes=function(x,n,e,h=!1){p.clear();for(const y in e){const B=x.get(y);if(!B)continue;var u=B,v=e[y];let t=v;l.isNumericField(u)&&"string"===typeof v?t=parseFloat(v):l.isStringField(u)&&null!=
v&&"string"!==typeof v?t=String(v):l.isDateField(u)&&"string"===typeof v&&(t=r.parseDate(v));u=l.sanitizeNullFieldValue(t);p.add(B.name);if(B&&(h||B.editable)){if(v=l.validateFieldValue(B,u))return m(l.validationErrorToString(v,B,u));n[B.name]=u}}for(const y of x?.requiredFields??[])if(!p.has(y.name))return m(`missing required field "${y.name}"`);return null};q.parseStringDateFieldValues=function(x,n){if(x?.length)for(const {name:e}of x)"string"===typeof n[e]&&(n[e]=r.parseDate(n[e]))};q.simplify=
function(x,n){if(!x||!k.isValid(n))return x;if("rings"in x||"paths"in x){if(null==g)throw new TypeError("geometry engine not loaded");return g.simplify(n,x)}return x};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBF":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/pbf ../../../../../layers/graphics/OptimizedGeometry ./FeatureSetReader ./FeatureSetReaderPBFHeader".split(" "),
function(a,q,r,k,l,m,b,c){function d(n){if(n<=g.small.delta.length)return g.small;if(n<=g.large.delta.length)return g.large;g.large.delta=new Int32Array(Math.round(1.25*n));g.large.decoded=new Int32Array(Math.round(1.25*n));return g.large}function f(n){var e=n.getLength();for(e=n.pos()+e;n.pos()<e&&n.next();)switch(n.tag()){case 1:return n.getString();case 2:return n.getFloat();case 3:return n.getDouble();case 4:return n.getSInt32();case 5:return n.getUInt32();case 6:return n.getInt64();case 7:return n.getUInt64();
case 8:return n.getSInt64();case 9:return n.getBool();default:return n.skip(),null}return null}function p(n,e,h,u){return 0===n*u-h*e&&0<n*h+e*u}const g={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(128E3),decoded:new Int32Array(128E3)}};class x extends b.FeatureSetReader{static fromBuffer(n,e,h=!1){const u=e.geometryType;a:{try{const B=new l(new Uint8Array(n),new DataView(n));for(;B.next();)switch(B.tag()){case 2:b:{for(var v=B.getMessage();v.next();)switch(v.tag()){case 1:var y=
v.getMessage();break b;default:v.skip()}y=null}break a;default:B.skip()}}catch(B){n=new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:B}),r.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(n)}y=null}n=y;h=c.parseHeader(n,"esriGeometryPoint"===u,h);return new x(n,h,e)}constructor(n,e,h){super(h);this._isPoints=this._hasNext=!1;this._featureIndex=-1;this._featureOffset=0;this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,
legacyFeature:void 0,optFeature:void 0};this._geometryType=h.geometryType;this._reader=n;this._header=e;this._hasNext=e.hasFeatures;this._isPoints="esriGeometryPoint"===h.geometryType}get _size(){return this._header.featureCount}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get hasZ(){return!1}get hasM(){return!1}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getInTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(n){this._cache.area=
0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;this._cache.optFeature=void 0;this._featureIndex=n}getAttributeHash(){let n="";for(const e of this._header.fields.fields)n+=this._readAttributeAtIndex(e.index)+".";return n}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(n){this._header.displayIds[this._featureIndex]=
n}readGeometryArea(){this._cache.area||this._readGeometry(!0);return this._cache.area}copy(){var n=this._reader.clone();n=new x(n,this._header,this.metadata);this.copyInto(n);return n}next(){this._cache.area=0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;for(this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readX(){return this._header.centroid[2*this._featureIndex]}_readY(){return this._header.centroid[2*
this._featureIndex+1]}_readServerCentroid(){const n=this._header.centroid[2*this._featureIndex];return 268435455===n?null:new m([],[n,this._header.centroid[2*this._featureIndex+1]])}_readGeometry(n=!1){if(void 0===this._cache.geometry){let e=null;if(this._isPoints){if(268435455===this._header.centroid[2*this._featureIndex])return null;e=new m([],[this._header.centroid[2*this._featureIndex],this._header.centroid[2*this._featureIndex+1]])}else{const h=this._header.offsets.geometry[this._featureIndex],
u=this._reader;if(0===h)return null;u.move(h);try{e=n?this._parseGeometryForDisplay(u):this._parseGeometry(u)}catch(v){return console.error("Failed to parse geometry!",v),null}}return this._cache.geometry=e}return this._cache.geometry}_readAttribute(n,e){const h=this._header.fields.get(n);if(null!=h){var u=this._readAttributeAtIndex(h.index);"esriFieldTypeTimestampOffset"===this.fields.get(n)?.type&&(u=this.parseTimestampOffset(u));n=this._header.fields.isDateField(h.name);return e&&null!=u?n?new Date(u):
u:u}}_readAttributes(){const n={};for(const e of this._header.fields.fields)n[e.name]=this._readAttributeAtIndex(e.index);return n}copyInto(n){super.copyInto(n);n._featureIndex=this._featureIndex;n._featureOffset=this._featureOffset;n._hasNext=this._hasNext}_readAttributeAtIndex(n){const e=this._reader;e.move(this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+n]);return f(e)}_readGeometryDeltaDecoded(n=!1){if(void 0===this._cache.unquantGeometry){n=this._readGeometry(n);if(!n)return this._cache.unquantGeometry=
void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=n;var e=d(n.coords.length).decoded;n=n.clone(e);e=n.coords;let h=0;for(const u of n.lengths){for(let v=1;v<u;v++){const y=2*(h+v),B=2*(h+v-1);e[y]+=e[B];e[y+1]+=e[B+1]}h+=u}return this._cache.unquantGeometry=n}return this._cache.unquantGeometry}_parseGeometry(n){n=n.asUnsafe();var e=n.getLength();e=n.pos()+e;const h=[],u=[];for(;n.pos()<e&&n.next();)switch(n.tag()){case 2:var v=n.getUInt32();for(v=n.pos()+v;n.pos()<v;)u.push(n.getUInt32());
break;case 3:v=n.getUInt32();v=n.pos()+v;h.push(n.getSInt64());h.push(n.getSInt64());this.hasZ&&n.getSInt64();for(this.hasM&&n.getSInt64();n.pos()<v;)h.push(n.getSInt64()),h.push(n.getSInt64()),this.hasZ&&n.getSInt64(),this.hasM&&n.getSInt64();break;default:n.skip()}return new m(u,h)}_parseGeometryForDisplay(n){n=n.asUnsafe();var e=n.getLength();e=n.pos()+e;const h=[],u=[];let v=0,y=0;var B=null;let t=0;const w="esriGeometryPolygon"===this.geometryType;for(;n.pos()<e&&n.next();)switch(n.tag()){case 2:B=
n.getUInt32();for(B=n.pos()+B;n.pos()<B;){var C=n.getUInt32();h.push(C);v+=C}B=d(2*v).delta;break;case 3:n.getUInt32();C=2+(this.hasZ?1:0)+(this.hasM?1:0);k.assertIsSome(B);for(const P of h)if(y+C*P>B.length)for(var z=0;z<P;z++)n.getSInt32(),n.getSInt32(),this.hasZ&&n.getSInt32(),this.hasM&&n.getSInt32();else if(w){z=this.getAreaSimplificationThreshold(P,this._header.vertexCount);var D=2,H=1,G=n.getSInt32(),A=n.getSInt32();B[y++]=G;B[y++]=A;this.hasZ&&n.getSInt32();this.hasM&&n.getSInt32();var F=
n.getSInt32(),J=n.getSInt32();this.hasZ&&n.getSInt32();for(this.hasM&&n.getSInt32();D<P;){var K=n.getSInt32();let E=n.getSInt32();this.hasZ&&n.getSInt32();this.hasM&&n.getSInt32();const M=G+F,T=A+J,ba=M+K,ea=T+E;.5*Math.abs(G*T+M*ea+ba*A-G*ea-M*A-ba*T)>=z?(t+=-.5*(M-G)*(T+A),1<H&&p(B[y-2],B[y-1],F,J)?(B[y-2]+=F,B[y-1]+=J):(B[y++]=F,B[y++]=J,H++),G=M,A=T):(K+=F,E+=J);F=K;J=E;D++}3>H?y-=2*H:(t+=-.5*(G+F-G)*(A+J+A),p(B[y-2],B[y-1],F,J)?(B[y-2]+=F,B[y-1]+=J,u.push(H)):(B[y++]=F,B[y++]=J,u.push(++H)))}else{z=
0;D=n.getSInt32();H=n.getSInt32();this.hasZ&&n.getSInt32();this.hasM&&n.getSInt32();B[y++]=D;B[y++]=H;z+=1;for(G=1;G<P;G++)A=n.getSInt32(),F=n.getSInt32(),J=D+A,K=H+F,t+=-.5*(J-D)*(K+H),this.hasZ&&n.getSInt32(),this.hasM&&n.getSInt32(),2<G&&p(B[y-2],B[y-1],A,F)?(B[y-2]+=A,B[y-1]+=F):(B[y++]=A,B[y++]=F,z+=1),D=J,H=K;u.push(z)}break;default:n.skip()}this._cache.area=t;return u.length?new m(u,B):null}}a.FeatureSetReaderPBF=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFHeader":function(){define(["exports",
"../../../../../core/Error","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(a,q,r,k){class l{constructor(){this.exceededTransferLimit=this.hasFeatures=!1;this.vertexCount=this.objectIdFieldIndex=this.featureCount=this.fieldCount=0;this.offsets={attributes:[],geometry:[]};this.centroid=[]}}a.FeatureSetHeader=l;a.parseHeader=function(m,b,c=!1){m=m.asUnsafe();const d=m.pos(),f=new l;let p=0,g=0,x=null,n=null,e=null,h=!1;const u=[];
for(;m.next();)switch(m.tag()){case 1:x=m.getString();break;case 3:n=m.getString();break;case 12:e=m.processMessage(k.parseTransform);break;case 9:f.exceededTransferLimit=m.getBool();if(f.exceededTransferLimit){f.offsets.geometry=c?new Float64Array(8E3):new Int32Array(8E3);f.centroid=c?new Float64Array(16E3):new Int32Array(16E3);for(var v=0;v<f.centroid.length;v++)f.centroid[v]=268435455}break;case 13:v=m.processMessage(k.parseField);v.index=p++;u.push(v);break;case 15:v=m.getLength();v=m.pos()+v;
if(!f.exceededTransferLimit){var y=f.centroid;f.offsets.geometry.push(0);y.push(268435455);y.push(268435455)}!h&&f.exceededTransferLimit&&(h=!0,f.offsets.attributes=c?new Float64Array(8E3*p):new Uint32Array(8E3*p));for(y=g*p;m.pos()<v&&m.next();)switch(m.tag()){case 1:h?f.offsets.attributes[y++]=m.pos():f.offsets.attributes.push(m.pos());var B=m.getLength();m.skipLen(B);break;case 2:if(b)for(B=m.getLength(),B=m.pos()+B;m.pos()<B&&m.next();)switch(m.tag()){case 3:m.getUInt32();var t=m.getSInt64(),
w=m.getSInt64();f.centroid[2*g]=t;f.centroid[2*g+1]=w;break;default:m.skip()}else f.offsets.geometry[g]=m.pos(),B=m.getLength(),f.vertexCount+=B,m.skipLen(B);break;case 4:B=m.getLength();for(B=m.pos()+B;m.pos()<B&&m.next();)switch(m.tag()){case 3:m.getUInt32();t=m.getSInt64();w=m.getSInt64();f.centroid[2*g]=t;f.centroid[2*g+1]=w;break;default:m.skip()}break;default:m.skip()}g++;f.hasFeatures=!0;break;default:m.skip()}b=x||n;if(!b)throw new q("FeatureSet has no objectId or globalId field name");f.fields=
new r(u);f.featureCount=g;f.fieldCount=p;f.objectIdFieldIndex=f.fields.get(b)?.index;f.transform=e;f.displayIds=new Uint32Array(f.featureCount);f.groupIds=new Uint16Array(f.featureCount);m.move(d);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/DrillDownTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(k,l,m,b,c,d){super();this._reader=k;this._queryJSON=
l;this._tile=m;this._sourceTile=b;this._sourceTileDepth=c;this._end=d;this.chunkId=`${this._tile.key.id}.${this._sourceTile?.key.id}${this._end?"e":""}`}get queryInfo(){return{type:"drill-down-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:this._sourceTile?.key.id,size:this.size(),end:this.end}}get first(){return 0===this._sourceTileDepth}get reader(){return this._reader}get end(){return this._end}get tile(){return this._tile}getTileReader(k){return this._tile.key.id===
k.key.id?this.reader:null}}a.DrillDownTileSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/PagedTileLoadStrategy":function(){define(["exports","../../../../../../core/promiseUtils","./ATileLoadStrategy","./chunks/PagedTileSourceChunk","../../support/FeatureSetReaderJSON"],function(a,q,r,k,l){class m{constructor(c,d){this.subscription=c;this._pages=new Set;this._controller=new AbortController;this._done=!1;q.onAbort(c.options,
()=>this._controller.abort());q.onAbort(d,()=>this._controller.abort())}resetAbortController(){this._controller=new AbortController}get pageStart(){let c=-1;for(const d of this._pages.values())c=Math.max(c,d);return c+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(c,d){this._pages.add(c);this._done=this._done||d}}class b extends r.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(c){this._loadStates.has(c.key.id)||
this._loadStates.set(c.key.id,new m(c,this._options));const d=this._loadStates.get(c.key.id);d.resetAbortController();let f;try{await this._fetchPages(d)}catch(p){f=p}c=new k.PagedTileSourceChunk(l.FeatureSetReaderJSON.empty(this._metadata),null,c.tile,-1,!0);q.isAborted(d.options)||this._addChunk(c);if(f)throw f;}unload(c){super.unload(c);this._loadStates.delete(c.key.id)}async _fetchPages(c){let d=0,f=c.pageStart,p=1;for(;20>d&&!c.done;){var g=[];for(let x=0;x<p;x++)g.push(this._fetchChunk(c,f++));
g=await Promise.all(g);for(const x of g)if(0!==x.size()||x.first)c.add(x.page,!x.reader.exceededTransferLimit),q.throwIfAborted(c.options),this._addChunk(x);d++;p=Math.min(p+1,4)}}async _fetchChunk(c,d){const f=c.subscription.tile,p=this._queryInfo.createPagedTileQuery(f,d);c=await this._fetch(p,c.options);return new k.PagedTileSourceChunk(c,p.inner.toJSON(),f,d,!1)}}a.PagedTileLoadStrategy=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/PagedTileSourceChunk":function(){define(["exports",
"./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(k,l,m,b,c){super();this._reader=k;this._queryJSON=l;this._tile=m;this._page=b;this._end=c;this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`}get queryInfo(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get page(){return this._page}get tile(){return this._tile}getTileReader(k){return this._tile.key.id===
k.key.id?this.reader:null}}a.PagedTileSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/SnapshotLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../core/promiseUtils ../../../../../../core/RandomLCG ./AFetchLoadStrategy ./chunks/FeatureSnapshotSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(a,q,r,k,l,m,b){class c extends l.AFetchLoadStrategy{constructor(d,f,p,g,x,n){super(d,
f,p,x,n);this._random=new k(1E3);this._promise=this._downloadPages(g)}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(d){return this._promise}unload(d){}async _downloadPages(d){d=Array.from({length:Math.ceil(d/this._queryInfo.pageSize)},(p,g)=>g).sort((p,g)=>this._random.getInt()-this._random.getInt());d=await Promise.all(d.map(p=>this._downloadPage(p)));const f=new m.FeatureSnapshotSourceChunk(b.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0);this._store.insert(f);
d=d.filter(p=>p);if(d.length)throw new q("featurelayer-query","Encountered errors when downloading data",{errors:d});}async _downloadPage(d){try{const f=this._queryInfo.createPagedQuery(d),p=await this._fetch(f,this._options),g=new m.FeatureSnapshotSourceChunk(p,f.inner.toJSON(),d,!1);r.throwIfAborted(this._options);this._store.insert(g);return null}catch(f){return f}}}a.SnapshotLoadStrategy=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/FeatureSnapshotSourceChunk":function(){define(["exports",
"./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(k,l,m,b){super();this._reader=k;this._queryJSON=l;this._page=m;this._end=b;this.chunkId=`${this._page}${this.end?"e":""}`}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}getTileReader(k){const l=this.queryFeaturesInBounds(k.bounds);l.setTransformForDisplay(k.transform);
return l}}a.FeatureSnapshotSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/StreamLoadStrategy":function(){define("exports ../../../../../../core/Evented ../../../../../../core/handleUtils ../../../../../../core/has ../../../../../../core/maybe ../../../../../../layers/graphics/data/StreamFeatureManager ../../../../../../layers/graphics/sources/connections/createConnection ../StreamConnectionState ../StreamFeatureStore ./ALoadStrategy ./chunks/StreamSourceChunk".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p){class g extends f.ALoadStrategy{constructor(x,n,e,h,u){super(e);this._service=x;this._dataFilter=n;this._streamOptions=h;this._connectionState=new c.StreamConnectionState;this.events=new q;const {objectIdField:v,timeInfo:y}=x;({purgeOptions:x}=n);this._stagingStore=new d.StreamFeatureStore(u,B=>this.events.emit("features-updated",B));this._manager=new m.StreamFeatureManager(this._stagingStore,v,y,x);this.connect()}destroy(){super.destroy();this.disconnect()}get about(){return{willQueryAllFeatures:!1,
willQueryFullResolutionGeometry:!1}}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState?.errorString}async refresh(){this._manager.checkForUpdates();this._chunk&&this._store.remove(this._chunk);this._chunk=new p.StreamSourceChunk(this._stagingStore.reader);this._store.insert(this._chunk);this.events.emit("tick")}async updateFields(x){throw Error("Updating available fields not supported for StreamLayer");}async load(x){}unload(x){}disconnect(){this._connection=
l.destroyMaybe(this._connection);this._connectionState.connection=null;this._handlesGroup?.remove()}connect(){if(null==this._connection){var {geometryType:x,source:n,spatialReference:e}=this._service,{maxReconnectionAttempts:h,maxReconnectionInterval:u,geometryDefinition:v,definitionExpression:y,customParameters:B}=this._dataFilter;this._connection=b.createConnection(n,e,this._streamOptions.outSR,x,y,v,h,u,B);this._handlesGroup=r.handlesGroup([this._connection.on("data-received",t=>this._onFeature(t)),
this._connection.on("message-received",t=>this._onWebSocketMessage(t))]);this._connectionState.connection=this._connection}}clear(){this._manager.checkForUpdates();this._stagingStore.clear()}updateCustomParameters(x){this._connection?.updateCustomParameters(x)}sendMessageToSocket(x){this._connection?.sendMessageToSocket(x)}sendMessageToClient(x){this._connection?.sendMessageToClient(x)}_onWebSocketMessage(x){if("type"in x)switch(x.type){case "delete":if(x.objectIds)for(const n of x.objectIds)this._manager.removeById(n);
if(x.trackIds)for(const n of x.trackIds)this._manager.removeByTrackId(n);break;case "clear":this.clear()}this.events.emit("message-received",x)}_onFeature(x){try{this._manager.add(x),this.events.emit("data-received",x)}catch(n){}}}a.StreamLoadStrategy=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/StreamFeatureManager":function(){define(["exports","../../../core/CircularArray","../../../core/mathUtils"],function(a,q,r){class k{constructor(l,m,b,c,d=128){this._trackIdToObservations=
new Map;this._idCounter=0;this._lastPurge=performance.now();this._addOrUpdated=new Map;this._removed=[];this._maxAge=0;this._timeInfo=b;this._purgeOptions=c;this.store=l;this.objectIdField=m;this.purgeInterval=d;this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(l){this._removed.push(l)}removeByTrackId(l){if(l=this._trackIdToObservations.get(l))for(const m of l.entries)this._removed.push(m)}add(l){if(this._useGeneratedIds){var m=this._nextId();l.attributes[this.objectIdField]=
m;l.objectId=m}else l.objectId=l.attributes[this.objectIdField];m=l.objectId;this._addOrUpdated.set(m,l);this._maxAge=Math.max(this._maxAge,l.attributes[this._timeInfo.startTimeField]);if(this._timeInfo.trackIdField){l=l.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(l)){const b=r.clamp(null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1E3,0,1E3);this._trackIdToObservations.set(l,new q(b))}m=this._trackIdToObservations.get(l)?.enqueue(m);null!=
m&&(this._addOrUpdated.has(m)?this._addOrUpdated.delete(m):this._removed.push(m))}else null==this._trackIdLessObservations&&(this._trackIdLessObservations=new q(1E5)),this._trackIdLessObservations.enqueue(m)}checkForUpdates(){const l=this._getToAdd();var m=this._getToRemove();const b=performance.now();b-this._lastPurge>=this.purgeInterval&&(this._purge(b),this._lastPurge=b);const c=[];if(null!=m)for(var d of m){const f=this.store.removeById(d);null!=f&&c.push(f)}d=[];if(null!=l){m=new Set(m??[]);
for(const f of l)m.has(f.objectId)||(f.attributes.__esri_timestamp__=b,this.store.add(f),d.push(f))}(d.length||c?.length)&&this.store.update(d,c)}_getToAdd(){if(!this._addOrUpdated.size)return null;const l=Array(this._addOrUpdated.size);let m=0;this._addOrUpdated.forEach(b=>l[m++]=b);this._addOrUpdated.clear();return l}_getToRemove(){const l=this._removed;if(!this._removed.length)return null;this._removed=[];return l}_nextId(){const l=this._idCounter;this._idCounter=(this._idCounter+1)%4294967294+
1;return l}_purge(l){const m=this._purgeOptions;null!=m&&(this._purgeSomeByDisplayCount(m),this._purgeByAge(m),this._purgeByAgeReceived(l,m),this._purgeTracks())}_purgeSomeByDisplayCount(l){if(l.displayCount){var m=this.store.size;if(m>l.displayCount){if(this._timeInfo.trackIdField)for(const b of this._trackIdToObservations.values())if(m>l.displayCount&&b.size){const c=b.dequeue();this._removed.push(c);m--}if(null!=this._trackIdLessObservations)for(l=m-l.displayCount;0<l--;)m=this._trackIdLessObservations.dequeue(),
null!=m&&this._removed.push(m)}}}_purgeByAge(l){const m=this._timeInfo?.startTimeField;if(l.age&&m){var b=this._maxAge-6E4*l.age;this.store.forEach(c=>{c.attributes[m]<b&&this._removed.push(c.objectId)})}}_purgeByAgeReceived(l,m){if(m.ageReceived){var b=l-6E4*m.ageReceived;this.store.forEach(c=>{c.attributes.__esri_timestamp__<b&&this._removed.push(c.objectId)})}}_purgeTracks(){this._trackIdToObservations.forEach((l,m)=>{0===l.size&&this._trackIdToObservations.delete(m)})}}a.StreamFeatureManager=
k;a.defaultStreamIdField="__esri_stream_id__";a.esriTimestamp="__esri_timestamp__";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class a{constructor(q){this._start=this.size=0;this.maxSize=q;this._buffer=Array(q)}get entries(){return this._buffer}enqueue(q){if(this.size===this.maxSize){const r=this._buffer[this._start];this._buffer[this._start]=q;this._start=(this._start+1)%this.maxSize;return r}this._buffer[(this._start+this.size++)%
this.maxSize]=q;return null}dequeue(){if(0===this.size)return null;const q=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return q}peek(){return 0===this.size?null:this._buffer[this._start]}find(q){if(0===this.size)return null;for(const r of this._buffer)if(null!=r&&q(r))return r;return null}clear(q){let r=this.dequeue();for(;null!=r;)q&&q(r),r=this.dequeue()}}return a})},"esri/layers/graphics/sources/connections/createConnection":function(){define(["exports",
"./GeoEventConnection","./WebSocketConnection","../../../support/ClientSideConnection"],function(a,q,r,k){a.createConnection=function(l,m,b,c,d,f,p,g,x){if(null==d&&null==f)d=null;else{var n={};null!=f&&(n.geometry=f);null!=d&&(n.where=d);d=n}m={source:l,sourceSpatialReference:m,spatialReference:b,geometryType:c,filter:d,maxReconnectionAttempts:p,maxReconnectionInterval:g,customParameters:x};return l?l.path.startsWith("wss://")||l.path.startsWith("ws://")?new r.WebSocketConnection(m):new q(m):new k.ClientSideConnection(m)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/GeoEventConnection":function(){define("require ../../../../chunks/tslib.es6 ../../../../geometry ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./WebSocketConnection ../../../../rest/query/operations/query ../../../../rest/support/Query ../../../../geometry/support/jsonUtils ../../../../geometry/SpatialReference".split(" "),
function(a,q,r,k,l,m,b,c,d,f,p,g,x,n,e,h){const u={maxQueryDepth:5,maxRecordCountFactor:3};r=class extends g.WebSocketConnection{constructor(v){super({...u,...v});this._relatedFeatures=this._buddyServicesQuery=null}async _open(){var v=await this._fetchServiceDefinition(this._config.source);v.timeInfo.trackIdField||m.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");
v=this._fetchWebSocketUrl(v.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices());await this._buddyServicesQuery;await this._tryCreateWebSocket(v);const {filter:y,outFields:B}=this._config;this.destroyed||this._setFilter(y,B)}_onMessage(v){if("attributes"in v){let y;try{y=this._enrich(v),null!=this._featureZScaler&&this._featureZScaler(y.geometry)}catch(B){m.getLogger(this).error(new l("geoevent-connection","Failed to parse message",
B));return}this.onFeature(y)}else this.onMessage(v)}async _fetchServiceDefinition(v){return this._serviceDefinition=v=(await k(v.path,{query:{f:"json",...this._config.customParameters},responseType:"json"})).data}_fetchWebSocketUrl(v,y){const {urls:B,token:t}=v[0];v=this._inferWebSocketBaseUrl(B);return c.addQueryParameters(`${v}/subscribe`,{outSR:""+y.wkid,token:t})}_inferWebSocketBaseUrl(v){if(1===v.length)return v[0];for(const y of v)if(y.includes("wss"))return y;m.getLogger(this).error(new l("geoevent-connection",
"Unable to infer WebSocket url",v));return null}async _setFilter(v,y){const B=this._websocket;if(null!=B&&(null!=v||null!=y)){v=JSON.stringify({filter:this._serializeFilter(v,y)});var t=!1,w=b.createResolver();B.onmessage=C=>{C=JSON.parse(C.data);C.filter&&(C.error&&(m.getLogger(this).error(new l("geoevent-connection","Failed to set service filter",C.error)),this._set("errorString",`Could not set service filter - ${C.error}`),w.reject(C.error)),this._setWebSocketJSONParseHandler(B),t=!0,w.resolve())};
B.send(v);setTimeout(()=>{t||(this.destroyed||this._websocket!==B||m.getLogger(this).error(new l("geoevent-connection","Server timed out when setting filter")),w.reject())},1E4);return w.promise}}_serializeFilter(v,y){const B={};if(null==v&&null==y)return B;if(v?.geometry)try{const t=e.fromJSON(v.geometry);if("extent"!==t.type)throw new l(`Expected extent but found type ${t.type}`);B.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(t){m.getLogger(this).error(new l("geoevent-connection","Encountered an error when setting connection geometryDefinition",
t))}v?.where&&"1 \x3d 1"!==v.where&&"1\x3d1"!==v.where&&(B.where=v.where);null!=y&&(B.outFields=y.join(","));return B}_enrich(v){if(!this._relatedFeatures)return v;const y=this._relatedFeatures.get(v.attributes[this._serviceDefinition.relatedFeatures.joinField]);if(!y)return m.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",v),v;const {attributes:B,geometry:t}=y;for(const w in B)v.attributes[w]=B[w];t&&(v.geometry=t);v.geometry||v.centroid||
m.getLogger(this).error(new l("geoevent-connection","Found malformed feature - no geometry found",v));return v}async _queryBuddyServices(){try{const {relatedFeatures:v,keepLatestArchive:y}=this._serviceDefinition,B=this._queryRelatedFeatures(v),t=this._queryArchive(y);await B;const w=await t;if(w)for(const C of w.features)this.onFeature(this._enrich(C))}catch(v){m.getLogger(this).error(new l("geoevent-connection","Encountered an error when querying buddy services",{error:v}))}}async _queryRelatedFeatures(v){v&&
(v=await this._queryBuddy(v.featuresUrl),this._addRelatedFeatures(v))}async _queryArchive(v){if(v)return this._queryBuddy(v.featuresUrl)}async _queryBuddy(v){const y=new (await new Promise((H,G)=>a(["../../../FeatureLayer"],A=>H(Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"}))),G))).default({url:v});var {capabilities:B}=await y.load();const t=B.query.supportsMaxRecordCountFactor,w=B.query.supportsPagination;B=B.query.supportsCentroid;const C=this._config.maxRecordCountFactor;
var z=y.capabilities.query.maxRecordCount;z=t?z*C:z;const D=new n;D.outFields=this._config.outFields??["*"];D.where=this._config.filter?.where??"1\x3d1";D.returnGeometry=!0;D.returnExceededLimitFeatures=!0;D.outSpatialReference=h.fromJSON(this._config.spatialReference);B&&(D.returnCentroid=!0);t&&(D.maxRecordCountFactor=C);if(w)return D.num=z,y.destroy(),this._queryPages(v,D);v=await x.executeQuery(v,D,this._config.sourceSpatialReference);y.destroy();return v.data}async _queryPages(v,y,B=[],t=0){y.start=
null!=y.num?t*y.num:null;const {data:w}=await x.executeQuery(v,y,this._config.sourceSpatialReference);if(w.exceededTransferLimit&&t<(this._config.maxQueryDepth??0))return w.features.forEach(C=>B.push(C)),this._queryPages(v,y,B,t+1);B.forEach(C=>w.features.push(C));return w}_addRelatedFeatures(v){const y=new Map;v=v.features;const B=this._serviceDefinition.relatedFeatures.joinField;for(const t of v)y.set(t.attributes[B],t);this._relatedFeatures=y}};return r=q.__decorate([p.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],
r)})},"esri/layers/graphics/sources/connections/WebSocketConnection":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/zscale ../../../support/StreamConnection".split(" "),function(a,q,r,k,l,m,b,c,d,f,p,g){var x;
(function(n){n[n.CONNECTING=0]="CONNECTING";n[n.OPEN=1]="OPEN";n[n.CLOSING=2]="CLOSING";n[n.CLOSED=3]="CLOSED"})(x||={});a.WebSocketConnection=class extends g{constructor(n){super({});this._outstandingMessages=[];this.errorString=null;const {geometryType:e,spatialReference:h,sourceSpatialReference:u}=n;this._config=n;this._featureZScaler=p.getGeometryZScaler(e,u,h);this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket();this.destroyed||await this._handshake()}destroy(){super.destroy();
null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close());this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case x.CONNECTING:case x.OPEN:return"connected";case x.CLOSING:case x.CLOSED:return"disconnected"}}sendMessageToSocket(n){null==this._websocket?this._outstandingMessages.push(n):this._websocket.send(JSON.stringify(n))}sendMessageToClient(n){this._onMessage(n)}updateCustomParameters(n){this._config.customParameters=
n;null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(n=this._config.source.path,e=1E3,h=0){try{if(!this.destroyed){var u=m.addQueryParameters(n,this._config.customParameters??{});this._websocket=await this._createWebSocket(u);this.notifyChange("connectionStatus")}}catch(v){if(u=e/1E3,this._config.maxReconnectionAttempts&&h>=this._config.maxReconnectionAttempts)k.getLogger(this).error(new r("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),
this.destroy();else return k.getLogger(this).error(new r("websocket-connection",`Failed to connect. Attempting to reconnect in ${u}s`,v)),await l.after(e),this._tryCreateWebSocket(n,Math.min(1.5*e,1E3*this._config.maxReconnectionInterval),h+1)}}_setWebSocketJSONParseHandler(n){n.onmessage=e=>{try{const h=JSON.parse(e.data);this._onMessage(h)}catch(h){k.getLogger(this).error(new r("websocket-connection","Failed to parse message, invalid JSON",{error:h}))}}}_createWebSocket(n){return new Promise((e,
h)=>{const u=new WebSocket(n);u.onopen=()=>{u.onopen=null;this.destroyed?(u.onclose=null,u.close()):(u.onclose=v=>this._onClose(v),u.onerror=v=>this._onError(v),this._setWebSocketJSONParseHandler(u),e(u))};u.onclose=v=>{u.onopen=u.onclose=null;h(v)}})}async _handshake(n=1E4){const e=this._websocket;if(null!=e){var h=l.createResolver(),u=e.onmessage,{filter:v,outFields:y,spatialReference:B}=this._config;h.timeout(n);e.onmessage=t=>{let w=null;try{w=JSON.parse(t.data)}catch(C){}w&&"object"===typeof w||
(k.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - malformed message",t.data)),h.reject(),this.destroy());w.spatialReference?.wkid!==B?.wkid&&(k.getLogger(this).error(new r("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${B.wkid}`,t.data)),h.reject(),this.destroy());"json"!==w.format&&(k.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - format is not set",t.data)),h.reject(),this.destroy());
v&&w.filter!==v&&k.getLogger(this).error(new r("websocket-connection","Tried to set filter, but server doesn't support it"));y&&w.outFields!==y&&k.getLogger(this).error(new r("websocket-connection","Tried to set outFields, but server doesn't support it"));e.onmessage=u;for(const C of this._outstandingMessages)e.send(JSON.stringify(C));this._outstandingMessages=[];h.resolve()};e.send(JSON.stringify({filter:v,outFields:y,format:"json",spatialReference:{wkid:B.wkid}}));return h.promise}}_onMessage(n){this.onMessage(n);
if("type"in n)switch(n.type){case "features":case "featureResult":for(const e of n.features)null!=this._featureZScaler&&this._featureZScaler(e.geometry),this.onFeature(e)}}_onError(n){this._set("errorString","Encountered an error over WebSocket connection");k.getLogger(this).error("websocket-connection","Encountered an error over WebSocket connection")}_onClose(n){this._websocket=null;this.notifyChange("connectionStatus");1E3!==n.code&&k.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${n.code}`);
this.destroyed||this._open()}};q.__decorate([b.property()],a.WebSocketConnection.prototype,"connectionStatus",null);q.__decorate([b.property()],a.WebSocketConnection.prototype,"errorString",void 0);a.WebSocketConnection=q.__decorate([f.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],a.WebSocketConnection);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/StreamConnection":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,k,l,m,b,c){r=class extends r.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new q("stream-connection",this.errorString):null}onFeature(d){this.emit("data-received",d)}onMessage(d){this.emit("message-received",d)}};a.__decorate([k.property({readOnly:!0})],r.prototype,"connectionError",null);return r=a.__decorate([c.subclass("esri.layers.support.StreamConnection")],r)})},"esri/layers/support/ClientSideConnection":function(){define("exports ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/zscale ./StreamConnection".split(" "),
function(a,q,r,k,l,m,b,c,d){a.ClientSideConnection=class extends d{constructor(f){super({});this.connectionStatus="connected";this.errorString=null;const {geometryType:p,spatialReference:g,sourceSpatialReference:x}=f;this._featureZScaler=c.getGeometryZScaler(p,x,g)}normalizeCtorArgs(){return{}}updateCustomParameters(f){}sendMessageToSocket(f){}sendMessageToClient(f){if("type"in f)switch(f.type){case "features":case "featureResult":for(const p of f.features)null!=this._featureZScaler&&this._featureZScaler(p.geometry),
this.onFeature(p)}this.onMessage(f)}};q.__decorate([r.property()],a.ClientSideConnection.prototype,"connectionStatus",void 0);q.__decorate([r.property()],a.ClientSideConnection.prototype,"errorString",void 0);a.ClientSideConnection=q.__decorate([b.subclass("esri.layers.support.ClientSideConnection")],a.ClientSideConnection);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamConnectionState":function(){define(["exports","../../../../../chunks/tslib.es6",
"../../../../../core/Accessor","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass"],function(a,q,r,k,l){a.StreamConnectionState=class extends r{constructor(m){super(m)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}};q.__decorate([k.property()],a.StreamConnectionState.prototype,"connection",void 0);q.__decorate([k.property()],a.StreamConnectionState.prototype,"connectionStatus",
null);q.__decorate([k.property()],a.StreamConnectionState.prototype,"errorString",null);a.StreamConnectionState=q.__decorate([l.subclass("esri.views.2d.layers.features.sources.StreamConnectionState")],a.StreamConnectionState);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamFeatureStore":function(){define(["exports","../support/FeatureSetReaderJSON"],function(a,q){class r{constructor(k,l){this._metadata=k;this._onUpdate=l;this._objectIdToFeature=
new Map}get size(){return this._objectIdToFeature.size}get reader(){return q.FeatureSetReaderJSON.fromFeatures([...this._objectIdToFeature.values()],this._metadata)}add(k){this._objectIdToFeature.set(k.objectId,k)}forEach(k){this._objectIdToFeature.forEach(k)}removeById(k){const l=this._objectIdToFeature.get(k);return l?(this._objectIdToFeature.delete(k),l):null}clear(){this._objectIdToFeature=new Map}update(k,l){this._onUpdate(k?.length??0)}}a.StreamFeatureStore=r;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/StreamSourceChunk":function(){define(["exports","./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(k){super();this._reader=k;this.chunkId="stream-chunk"}get reader(){return this._reader}get first(){return!0}get end(){return!0}get queryInfo(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}getTileReader(k){const l=this.queryFeaturesInBounds(k.bounds);l.setTransformForDisplay(k.transform);
return l}}a.StreamSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/SourceChunkStore":function(){define("exports ../../../../../../../core/Evented ../../../../../../../core/has ../../../../../../../geometry/support/aaBoundingBox ../../../FeatureStoreQueryAdapter ./OverrideChunk".split(" "),function(a,q,r,k,l,m){class b{constructor(c){this._onChange=c;this._chunks=new Map;this._overrideChunk=new m.OverrideChunk;this.events=
new q;this.featureAdapter=new l.FeatureStoreQueryAdapter}destroy(){this.clear()}clear(){for(const c of this.chunks())this.events.emit("remove",c);this._chunks.clear()}*chunks(){this._overrideChunk&&(yield this._overrideChunk);yield*this._chunks.values()}insert(c){r("esri-2d-update-debug")&&console.debug(`Chunk[${c.chunkId}] SourceChunkStore.insert`);this._overrideChunk.overridenIds.size&&c.reader.removeIds(this._overrideChunk.overridenIds);this._chunks.set(c.chunkId,c);this.events.emit("changed");
this._onChange()}remove(c){r("esri-2d-update-debug")&&console.debug(`Chunk[${c.chunkId}] SourceChunkStore.remove`);this._chunks.delete(c.chunkId);this.events.emit("remove",c)}applyOverrides(c){this._overrideChunk.applyOverrides(c);for(const d of this._chunks.values())d.reader.removeIds(this._overrideChunk.overridenIds)}forEach(c){const d=new Set;for(const f of this.chunks()){const p=f.reader.getCursor();for(;p.next();){const g=p.getObjectId();d.has(g)||(c(p.copy()),d.add(g))}}}forEachUnsafe(c){const d=
new Set;for(const f of this.chunks()){const p=f.reader.getCursor();for(;p.next();){const g=p.getObjectId();d.has(g)||(c(p),d.add(g))}}}forEachInBounds(c,d){const f=new Set;for(const p of this.chunks()){const g=p.queryFeaturesInBounds(c);for(;g.next();){const x=g.getObjectId();f.has(x)||(d(g.copy()),f.add(x))}}}forEachBounds(c,d){const f=k.create();for(const p of c)p.getBounds(f)&&d(f)}}a.FeatureSourceChunkStore=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureTileSubscription":function(){define(["exports",
"../../../../../core/Handles","../../../../../core/promiseUtils"],function(a,q,r){class k{constructor(l,m){this._handles=new q;this._abortController=new AbortController;this._resolver=r.createResolver();this._aborted=this._isDone=!1;this.tile=l;this._version=m;this._handles.add([])}destroy(){this.pause();this._handles.destroy()}get key(){return this.tile.key}get version(){return this._version}set version(l){this._version=l}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get done(){return this._resolver.promise}get isDone(){return this._isDone}resolve(){this._isDone=
!0;this._resolver.resolve()}get paused(){return this._aborted}resume(){this._abortController=new AbortController;this._aborted=!1}pause(){this._aborted||(this._aborted=!0,this._abortController.abort())}}a.FeatureTileSubscription=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/Tile":function(){define("exports ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../rest/support/QuantizationParameters ../../../tiling/TileKey".split(" "),
function(a,q,r,k,l,m){class b{constructor(c,d){this.key=new m(0,0,0,0);this.bounds=k.create();this.objectIds=new Set;this.key.set(d);d=c.getLODInfoAt(this.key);this.tileInfoView=c;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=d.resolution;this.scale=d.scale;this.level=d.level}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return r.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",
scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get arcadeEvaluationOptions(){return{$view:{scale:this.scale}}}createChildTiles(){const c=this.key.getChildKeys(),d=q.acquire();for(let f=0;f<c.length;f++)d[f]=new b(this.tileInfoView,c[f]);return d}getQuantizationParameters(){return l.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}
a.Tile=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../../core/handleUtils ../../../../core/has ../../../../core/nextTick ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../layers/support/TileInfo ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ./PipelineConnectionHandlers ./Processor ./sources/FeatureSource ./sources/FeatureTileSubscription ./support/Tile".split(" "),function(a,
q,r,k,l,m,b,c,d,f,p,g,x,n,e,h,u,v){class y{constructor(w){this.edit=w;this.resolver=k.createResolver()}}class B{constructor(w,C){this.schema=w;this.version=C;this.resolver=k.createResolver()}}class t{constructor(){this._aggregateAdapter={getFeatureObjectIds:w=>this._processor.getFeatureObjectIdsForAggregate(w)};this._subscriptions=new Map;this._updateRequested=!1;this._updateSubscriptionRequests=[]}destroy(){this._subscriptions.clear();this._processor.destroy();this._source.destroy();this._handles.remove();
this._tileInfoView=this._editState=null}onDetach(){this.destroy();this._initialize(this._connection)}_initialize(w){this._source=new h.FeatureSource(this._aggregateAdapter,this._subscriptions,()=>this._requestUpdate(),w);this._processor=new e(w,this._source);this._handles=a.handlesGroup([m.watch(()=>this._source.updateTracking.updating,()=>{this._requestUpdate();this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0})})])}set remoteClient(w){this._connection=
new n.PipelineConnectionHandlers(w);this._initialize(this._connection)}get features(){return this._source.queryEngine}get aggregates(){return this._processor.aggregateQueryEngine}get processor(){return this._processor}get streamMessenger(){return this._source.streamMessenger}async updateSchema(w,C){q("esri-2d-update-debug")&&this._updateSchemaState&&console.error("InternalError: Schema already updating");this._updateSchemaState=new B(w,C);this._requestUpdate();return this._updateSchemaState.resolver.promise}updateSubscriptions(w){this._updateSubscriptionRequests.push(w);
this._requestUpdate()}async onEdits(w){if(null!=this._editState)throw Error("InternalError - Already processing an edit");this._editState=new y(w);w=this._editState.resolver.promise;this._requestUpdate();return w}queryStatistics(){return this._source.statistics.toJSON()}async queryVisibleFeatures(w,C){return this.features.executeQuery(w,C)}async queryHeatmapStatistics(w){var C=Math.round(b.pt2px(w.radius));let z=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;const H="string"===typeof w.fieldOffset,
G=w.fieldOffset??0;var A=Array.from(this._subscriptions.values());const F=this._source.chunks(),J=C**2,K=3/(Math.PI*J);C*=2;const P=Math.ceil(x.tileSize/C);for(const ea of A){var E=ea.tile;A=new Float64Array(P*P);for(const X of F){var M=X.getTileReader(E);if(M)for(M=M.getCursor();M.next();){var T=1;null!=w.field&&(T=M.readAttribute(w.field),T=H?-1*+T:+T+G);var ba=M.readXForDisplay()/C;const ca=M.readYForDisplay()/C,ma=Math.floor(ba),S=Math.floor(ca);0>ma||0>S||ma>=P||S>=P||(ba=((.5+ma-ba)*C)**2+((.5+
S-ca)*C)**2,ba>J||(A[S+ma*P]+=T*K*(1-ba/J)**2))}}for(E=0;E<A.length;E++)z=Math.min(z,A[E]),D=Math.max(D,A[E])}return{max:D,min:z}}async getSampleFeatures(w){const C=this._source.chunks();if(C.reduce((K,P)=>K+P.size(),0)<=w.minFeatureCount){if(!this._source.updateTracking.updating){const K=[];this._source.store.forEachUnsafe(P=>K.push(P.readLegacyFeatureWorldSpace()));return K}return null}const z=new Set,D=[],H=C.map(K=>K.reader.getCursor()),G=new l,A=3*w.sampleSize;for(let K=0;K<A&&D.length<w.sampleSize;K++){var F=
G.getIntRange(0,C.length-1);F=H[F];if(0!==F.getSize()){var J=G.getIntRange(0,F.getSize()-1);F.setIndex(J);J=F.getObjectId();z.has(J)||(z.add(J),D.push(F.readLegacyFeatureWorldSpace()))}}return D.length>=w.sampleSize?D:null}_requestUpdate(){this._updateRequested||(this._updateRequested=!0,r.nextTick(()=>this._scheduleNextUpdate()))}_scheduleNextUpdate(){this._updateRequested&&!this._ongoingUpdate&&(this._ongoingUpdate=this._doUpdate().finally(()=>{this._ongoingUpdate=null;this._scheduleNextUpdate()}),
this._updateRequested=!1)}_subscribe(w){const C=w.tileId;if(this._subscriptions.has(C)){var z=this._subscriptions.get(C);z.paused&&(q("esri-2d-update-debug")&&console.debug(`Tile[${C}] Pipeline.resume`),z.resume(),z.version=w.version,this._source.onResume(z))}else q("esri-2d-update-debug")&&console.debug(`Tile[${C}] Pipeline.subscribe`),z=new v.Tile(this._tileInfoView,C),w=new u.FeatureTileSubscription(z,w.version),this._subscriptions.set(C,w),this._source.onSubscribe(w),this._processor.onSubscribe(w)}_unsubscribe(w){const C=
this._subscriptions.get(w);C&&(q("esri-2d-update-debug")&&console.debug(`Tile[${w}] Pipeline.unsubscribe`),this._source.onUnsubscribe(C),this._processor.onUnsubscribe(C),this._subscriptions.delete(C.key.id),C.destroy())}_pauseSubscription(w){const C=this._subscriptions.get(w);C&&(q("esri-2d-update-debug")&&console.debug(`Tile[${w}] Pipeline.pause`),C.pause())}async _doUpdate(){await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0});if(this._updateSubscriptionRequests.length){var w=
this._updateSubscriptionRequests;this._updateSubscriptionRequests=[];for(const C of w)this._doUpdateSubscriptions(C)}if(null!=this._updateSchemaState){const {schema:C,version:z}=this._updateSchemaState;await this._doUpdateSchema(C,z)}null!=this._editState&&(q("esri-2d-update-debug")&&console.debug("Pipeline.handleEdit",this._editState.edit),w=await this._source.getOverride(this._editState.edit),await this._processor.applyOverride(w));try{this._subscriptions.size&&await this._processor.updateChunks()}catch(C){k.throwIfNotAbortError(C)}null!=
this._editState&&(this._editState.resolver.resolve(),this._editState=null);null!=this._updateSchemaState&&(this._updateSchemaState.resolver.resolve(),this._updateSchemaState=null);this._updateRequested?await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0}):(this._processor.updateTracking.updating&&await m.once(()=>!this._processor.updateTracking.updating),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:this._updateRequested}))}async _doUpdateSchema(w,
C){q("esri-2d-update-debug")&&console.debug(`Version[${C}] Pipeline.updateStart`,{schema:w});if(!this._tileInfoView){var z=c.fromJSON(w.source.tileInfoJSON);this._tileInfoView=new d(z)}z={tileInfo:this._tileInfoView?.tileInfo};try{const D=await this._source.update(w,C),H=Array.from(this._subscriptions.values());await this._processor.update(w,C,z,D,H)}catch(D){console.error(D)}q("esri-2d-update-debug")&&console.debug(`Version[${C}] Pipeline.updateEnd`)}_doUpdateSubscriptions(w){q("esri-2d-update-debug")&&
console.debug("Pipeline.updateSubscriptions",w);if(!this._tileInfoView){const C=c.fromJSON(w.tileInfoJSON);this._tileInfoView=new d(C)}for(const C of w.subscribe)this._subscribe(C);for(const C of w.unsubscribe)this._unsubscribe(C);if(q("featurelayer-query-pausing-enabled"))for(const C of w.pause)this._pauseSubscription(C)}}return t});