// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(b,c,f,g,h,d,l,m,n,k){b.FeatureSourceEventLog=class extends f{constructor(){super(...arguments);this.events=new g;this._updatingStrategy=!0;this._tileToEvent=new h;this._fetchStatus=
{outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(a){switch(a.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(a);break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,outstanding:0};this._strategyInfo=
a.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",a);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),a.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const a of this._tileToEvent.values())if("loaded"!==
a[a.length-1].type)return!1;return!0}_handleTileEvent(a){switch(a.type){case "subscribe":this._tileToEvent.set(a.tile,[a]);break;case "unsubscribe":this._tileToEvent.delete(a.tile);break;case "loaded":var e=this._tileToEvent.get(a.tile);if(!e)break;e.push(a);this._tileToEvent.set(a.tile,e);break;case "error":if(e=this._tileToEvent.get(a.tile))e.push(a),this._tileToEvent.set(a.tile,e),this.events.emit("error",a)}}};c.__decorate([d.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasAllFeatures",
null);c.__decorate([d.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);c.__decorate([d.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasFullGeometries",null);c.__decorate([d.property()],b.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0);c.__decorate([d.property()],b.FeatureSourceEventLog.prototype,"_strategyInfo",void 0);c.__decorate([d.property()],b.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);b.FeatureSourceEventLog=c.__decorate([k.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],
b.FeatureSourceEventLog);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});