// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(v,p,z,A,B,w,C,q,D,r,E,F,G){class H{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const a=this.layer;b=r.getFeatureReductionDeconflictionEnabled(a,
b)??r.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:r.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){var a=this.layer;const f=B.getEffectiveLayerCapabilities(a),{capabilities:c,editingInfo:e,objectIdField:g,typeIdField:h,globalIdField:k,datesInUnknownTimezone:l,orderBy:d,subtypeField:m,refreshInterval:t}=a,x=a.fieldsIndex.toJSON(),I=x.fields,J=a.fullExtent?.toJSON(),K=D.getEffectiveGeometryType(a),L=a.timeInfo?.toJSON(),M=a.spatialReference.toJSON(),
O=a.types?.map(N=>N.toJSON()),u=z.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(u.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let y=this.layer.objectIdField;if(d?.length){var n=!d[0].valueExpression&&d[0].field;n&&(y=n)}n=null==e?.lastEditDate&&0<t;b=(n=p("featurelayer-snapshot-enabled")&&"point"===a.geometryType&&c?.query.supportsPagination&&!c?.operations.supportsEditing&&!n)&&C.exceedsMinimumSnapshotCoverage(b,a.fullExtent);a=A.isHostedAgolService(u.path);
return{type:"feature-service",supportsSnapshotMinThreshold:n,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:p("featurelayer-snapshot-point-min-threshold"),max:p("featurelayer-snapshot-point-max-threshold")},isSourceHosted:a,typeIdField:h??void 0,types:O,timeReferenceUnknownClient:l,subtypeField:m,globalIdField:k,maxRecordCount:c.query.maxRecordCount,tileMaxRecordCount:c.query.tileMaxRecordCount,capabilities:c,effectiveCapabilities:f,fields:I,fieldsIndex:x,fullExtent:J,geometryType:K,
objectIdField:g,source:u,timeInfo:L,spatialReference:M,orderByFields:y,lastEditDate:e?.lastEditDate?.getTime()}}createSourceSchema(b,a,f){const {definitionExpression:c,customParameters:e,gdbVersion:g,historicMoment:h,subtypeCode:k,subtypeField:l,timeExtent:d,apiKey:m}=this.layer;return E.createFeatureSourceSchema(b,{definitionExpression:c,customParameters:e,gdbVersion:g,historicMoment:h,subtypeCode:k,subtypeField:l,timeExtent:d},a,f,m)}createProcessorSchema(b,a,f){const {fields:c,renderer:e,geometryType:g,
labelingInfo:h,labelsVisible:k,orderBy:l,objectIdField:d}=this.layer,m={fields:c.map(t=>t.toJSON()),renderer:e?.clone(),featureReduction:w.getEffectiveFeatureReduction(this.layer,a),geometryType:g,labelingInfo:h,labelsVisible:k,objectIdField:d,orderBy:l??"default"};return F.createSimpleProcessorSchema(b,a,m,f)}get hasRequiredSupport(){return G.isRendererSupported(this.layer.renderer)}hasFilters(b){return q.hasFloorFilter(this.layer,b)}addFilters(b,a){return q.addFloorFilter(this.layer,b,a)}getUpdateHashProperties(b){var a=
this.layer;const {definitionExpression:f,renderer:c,gdbVersion:e,apiKey:g,subtypeCode:h}=a,k=this.layer.labelsVisible?this.layer.labelingInfo:null,l=a.historicMoment?.getTime()??void 0,d=JSON.stringify(a.customParameters),m=w.getEffectiveFeatureReduction(a,b)?.toJSON();a=JSON.stringify(a.orderBy);b=q.hasFloorFilter(this.layer,b)?b.floors:null;return{apiKey:g,customParameters:d,definitionExpression:f,featureReduction:m,floors:b,gdbVersion:e,historicMoment:l,labelingInfo:k,orderBy:a,renderer:c,subtypeCode:h}}}
v.FeatureLayerAdapter=H;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});