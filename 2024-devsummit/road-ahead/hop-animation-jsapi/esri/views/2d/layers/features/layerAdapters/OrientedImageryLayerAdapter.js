// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(u,l,y,z,A,v,B,m,C,n,D,E,F){class G{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const a=this.layer;b=n.getFeatureReductionDeconflictionEnabled(a,
b)??n.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:n.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){var a=this.layer;const d=A.getEffectiveLayerCapabilities(a),{capabilities:c,objectIdField:e,globalIdField:f,orderBy:g,refreshInterval:p}=a,k=a.fieldsIndex.toJSON(),q=k.fields,r=a.fullExtent?.toJSON(),t=C.getEffectiveGeometryType(a),H=a.timeInfo?.toJSON(),I=a.spatialReference.toJSON(),w=y.clone(this.layer.parsedUrl);let x=this.layer.objectIdField;
if(g?.length){var h=!g[0].valueExpression&&g[0].field;h&&(x=h)}h=0<p;b=(h=l("featurelayer-snapshot-enabled")&&"point"===a.geometryType&&c?.query.supportsPagination&&!c?.operations.supportsEditing&&!h)&&B.exceedsMinimumSnapshotCoverage(b,a.fullExtent);a=z.isHostedAgolService(w.path);return{type:"feature-service",supportsSnapshotMinThreshold:h,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:l("featurelayer-snapshot-point-min-threshold"),max:l("featurelayer-snapshot-point-max-threshold")},
isSourceHosted:a,globalIdField:f,maxRecordCount:c.query.maxRecordCount,tileMaxRecordCount:c.query.tileMaxRecordCount,capabilities:c,effectiveCapabilities:d,fields:q,fieldsIndex:k,fullExtent:r,geometryType:t,objectIdField:e,source:w,timeInfo:H,spatialReference:I,orderByFields:x,timeReferenceUnknownClient:!1}}createSourceSchema(b,a,d){const {definitionExpression:c,customParameters:e,timeExtent:f}=this.layer;return D.createFeatureSourceSchema(b,{definitionExpression:c,customParameters:e,timeExtent:f},
a,d,null)}createProcessorSchema(b,a,d){const {fields:c,renderer:e,geometryType:f,labelingInfo:g,labelsVisible:p,orderBy:k,objectIdField:q}=this.layer,r={fields:c.map(t=>t.toJSON()),renderer:e?.clone(),featureReduction:v.getEffectiveFeatureReduction(this.layer,a),geometryType:f,labelingInfo:g,labelsVisible:p,objectIdField:q,orderBy:k??"default"};return E.createSimpleProcessorSchema(b,a,r,d)}get hasRequiredSupport(){return F.isRendererSupported(this.layer.renderer)}hasFilters(b){return m.hasFloorFilter(this.layer,
b)}addFilters(b,a){return m.addFloorFilter(this.layer,b,a)}getUpdateHashProperties(b){var a=this.layer;const {definitionExpression:d,renderer:c}=a,e=this.layer.labelsVisible?this.layer.labelingInfo:null,f=JSON.stringify(a.customParameters),g=v.getEffectiveFeatureReduction(a,b)?.toJSON();a=JSON.stringify(a.orderBy);b=m.hasFloorFilter(this.layer,b)?b.floors:null;return{orderBy:a,definitionExpression:d,renderer:c,labelingInfo:e,featureReduction:g,customParameters:f,floors:b}}}u.OrientedImageryLayerAdapter=
G;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});