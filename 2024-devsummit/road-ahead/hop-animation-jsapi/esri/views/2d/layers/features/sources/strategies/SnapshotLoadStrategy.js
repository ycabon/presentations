// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/Error ../../../../../../core/promiseUtils ../../../../../../core/RandomLCG ./AFetchLoadStrategy ./chunks/FeatureSnapshotSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(e,g,h,k,l,f,m){class n extends l.AFetchLoadStrategy{constructor(a,c,b,d,p,q){super(a,c,b,p,q);this._random=new k(1E3);this._promise=this._downloadPages(d)}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(a){return this._promise}unload(a){}async _downloadPages(a){a=
Array.from({length:Math.ceil(a/this._queryInfo.pageSize)},(b,d)=>d).sort((b,d)=>this._random.getInt()-this._random.getInt());a=await Promise.all(a.map(b=>this._downloadPage(b)));const c=new f.FeatureSnapshotSourceChunk(m.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0);this._store.insert(c);a=a.filter(b=>b);if(a.length)throw new g("featurelayer-query","Encountered errors when downloading data",{errors:a});}async _downloadPage(a){try{const c=this._queryInfo.createPagedQuery(a),b=await this._fetch(c,
this._options),d=new f.FeatureSnapshotSourceChunk(b,c.inner.toJSON(),a,!1);h.throwIfAborted(this._options);this._store.insert(d);return null}catch(c){return c}}}e.SnapshotLoadStrategy=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});