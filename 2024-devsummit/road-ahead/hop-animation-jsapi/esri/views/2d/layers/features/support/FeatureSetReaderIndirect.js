// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetReader"],function(e,l,m,n){class c extends n.FeatureSetReader{static from(a,b){return new c(a.copy(),b)}constructor(a,b){super(a.metadata);this._currentIndex=-1;this._displayTranslationY=this._displayTranslationX=0;this._displayScaleY=this._displayScaleX=1;this._reader=a;this._indices=b;this._isPoint="esriGeometryPoint"===a.geometryType}setTransformForDisplay(a){const b=
this._reader.getInTransform();if(null==b){const [f,g]=a.scale,[p,q]=a.translate;this._displayTranslationX=-p/f;this._displayScaleX=1/f;this._displayTranslationY=q/g;this._displayScaleY=1/-g}else{var [d,r]=b.scale,[t,u]=b.translate,[h,k]=a.scale,[v,w]=a.translate;this._displayScaleX=d/h;this._displayTranslationX=(t-v)/h;this._displayScaleY=r/k;this._displayTranslationY=(-u+w)/k;if(!this._isPoint&&b)throw Error("InternalError: Relative transformations not supported for non-point features");}this._displayTransform=
a}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const a=new c(this._reader.copy(),this._indices);a._currentIndex=this._currentIndex;a._displayTransform=this._displayTransform;a._displayTranslationX=this._displayTranslationX;a._displayTranslationY=this._displayTranslationY;a._displayScaleX=this._displayScaleX;a._displayScaleY=
this._displayScaleY;return a}_nextIndex(){return++this._currentIndex<this._indices.length?(this._reader.setIndex(this._indices[this._currentIndex]),!0):!1}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}readYForDisplay(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}readGeometryForDisplay(){const a=this._reader.readGeometryForDisplay();
if(!this._displayTransform)return a;const b=new m;l.quantizeOptimizedGeometry(b,a,this.hasZ,this.hasM,this.geometryType,this._displayTransform);return b.deltaDecode()}readCentroidForDisplay(){const a=this._reader.readCentroidForDisplay()?.clone();if(a){const [b,d]=a.coords;a.coords[0]=b*this._displayScaleX+this._displayTranslationX;a.coords[1]=d*this._displayScaleY+this._displayTranslationY}return a}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(a,
b=!1){return this._reader.readAttribute(a,b)}readAttributes(){return this._reader.readAttributes()}joinAttributes(a){return this._reader.joinAttributes(a)}getBounds(a){return this._reader.getBounds(a)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(a){return this._reader.setDisplayId(a)}setIndex(a){return this._reader.setIndex(a)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){return this._reader.readLegacyFeatureForDisplay()}readLegacyGeometryForDisplay(){return this._reader.readLegacyGeometryForDisplay()}readGeometryArea(){return this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(a,
b){throw Error("Error: Should not be called. Underlying _reader should be used instead");}_readAttributes(){throw Error("Error: Should not be called. Underlying _reader should be used instead");}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(a){return this.readAttribute(a,!0)}hasField(a){return this._reader.hasField(a)}setField(a,b){return this._reader.setField(a,b)}keys(){return this._reader.keys()}castToText(a=!1){return this._reader.castToText(a)}}
e.FeatureSetReaderIndirect=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});