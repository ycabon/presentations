// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(k,f,g,l,m){class d extends m.FeatureSetReader{static fromFeatures(a,b){const {objectIdField:c,geometryType:n}=b,h=f.convertFromFeatures([],a,n,!1,!1,c);for(let e=0;e<h.length;e++)h[e].displayId=a[e].displayId;return d.fromOptimizedFeatures(h,b)}static fromFeatureSet(a,b){a=f.convertFromFeatureSet(a,b.objectIdField);
return d.fromOptimizedFeatureSet(a,b)}static fromOptimizedFeatureSet(a,b){b=d.fromOptimizedFeatures(a.features,b);b._exceededTransferLimit=a.exceededTransferLimit;b._transform=a.transform;b._fieldsIndex=new l(a.fields);return b}static fromOptimizedFeatures(a,b,c){a=new d(a,b);a._fieldsIndex=b.fieldsIndex;a._transform=c;return a}static empty(a){return new d([],a)}constructor(a,b){super(b);this._exceededTransferLimit=!1;this._featureIndex=-1;this._fieldsIndex=null;this._geometryType=b.geometryType;
this._features=a}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}removeIds(a){const b=new Set(a);this._features=this._features.filter(c=>!(null!=c.objectId&&b.has(c.objectId)))}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let a=
"";for(const b in this._current.attributes)a+=this._current.attributes[b];return a}getIndex(){return this._featureIndex}setIndex(a){this._featureIndex=a}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){this._current.displayId=a}copy(){const a=new d(this._features,this.metadata);this.copyInto(a);return a}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return g.hasGeometry(this._current)?
f.getQuantizedArea(this._current.geometry,2):0}_readX(){return g.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return g.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return this._current.geometry??null}_readServerCentroid(){return this._current.centroid}_readAttribute(a,b){if(this._fieldsIndex){var c=this._fieldsIndex.get(a);if(c){c=this._current.attributes[c.name];if(null==c)return c;"esriFieldTypeTimestampOffset"===this.fields.get(a)?.type&&
(c=this.parseTimestampOffset(c));return b&&this.fields.isDateField(a)?new Date(c):c}}else{b=this._current.attributes[a];if(void 0!==b)return b;a=a.toLowerCase();for(c in this._current.attributes)if(c.toLowerCase()===a)return this._current.attributes[c]}}_readAttributes(){return this._current.attributes}copyInto(a){super.copyInto(a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._fieldsIndex=this._fieldsIndex}}k.FeatureSetReaderJSON=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});