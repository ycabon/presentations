// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(t,x,y,u,v){function z(){const {supportsColorBufferFloat:k,supportsColorBufferFloatBlend:d,supportsColorBufferHalfFloat:f}=v.getWebGLCapabilities();return k&&d||f}const w=()=>y.getLogger("esri.views.2d.layers.features.support.rendererUtils");t.isRendererSupported=function(k){if(!k)return!0;switch(k.type){case "heatmap":if(!z()){const d=v.getWebGLCapabilities();
k=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(f=>!d[f]).join(", ");w().errorOnce(new x("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${k}`));return!1}}return!0};t.simplifyVisualVariables=function(k){return k.map(d=>{if(("size"===d.type||"color"===d.type||"opacity"===d.type)&&null!=d.stops){d=d.clone();var f=d.type;var e=d.stops??[];if(8>=e.length)f=e;else if(w().warn(`Found ${e.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),
16<e.length){const [A,...h]=e;var p=h.pop(),l=h[0].value,m=h[h.length-1].value,q=(m-l)/6;const r=[];for(;l<m;l+=q){for(var a=0;l>=h[a].value;)a++;var b=h[a],g=e[a-1],c=l-g.value;b=b.value===g.value?1:c/(b.value-g.value);"color"===f?(g=h[a],a=e[a-1],c=g.color.clone(),c.r=(1-b)*a.color.r+b*c.r,c.g=(1-b)*a.color.g+b*c.g,c.b=(1-b)*a.color.b+b*c.b,c.a=(1-b)*a.color.a+b*c.a,r.push({value:l,color:c,label:g.label})):"size"===f?(g=h[a],c=e[a-1],a=u.toPt(g.size),c=u.toPt(c.size),r.push({value:l,size:(1-b)*
c+b*a,label:g.label})):(g=h[a],r.push({value:l,opacity:(1-b)*e[a-1].opacity+b*g.opacity,label:g.label}))}f=[A,...r,p]}else{var [B,...n]=e;for(f=n.pop();6<n.length;){p=e=0;for(m=1;m<n.length;m++)q=Math.abs(n[m].value-n[m-1].value),q>p&&(p=q,e=m);n.splice(e,1)}f=[B,...n,f]}d.stops=f}return d})};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});