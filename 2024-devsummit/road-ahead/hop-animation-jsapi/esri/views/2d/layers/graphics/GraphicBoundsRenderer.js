// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(u,n,q,v,w,x,y,z,r,m,A){const B=Math.PI/180;class C extends y.DisplayObject{constructor(c){super();
this._indexBuffer=this._vertexBuffer=this._vao=this._program=null;this._dvsMat3=q.create();this._localOrigin={x:0,y:0};this._getBounds=c}destroy(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=u.disposeMaybe(this._program)}doRender(c){const {context:a}=c,h=this._getBounds();1>h.length||(this._createShaderProgram(a),this._updateMatricesAndLocalOrigin(c),this._updateBufferData(a,h),a.setBlendingEnabled(!0),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),
a.setStencilTestEnabled(!1),a.setBlendFunction(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA),a.setColorMask(!0,!0,!0,!0),c=this._program,a.bindVAO(this._vao),a.useProgram(c),c.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),a.gl.lineWidth(1),a.drawElements(m.PrimitiveType.LINES,8*h.length,m.DataType.UNSIGNED_INT,0),a.bindVAO())}_createTransforms(){return{displayViewScreenMat3:q.create()}}_createShaderProgram(c){this._program||(this._program=c.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }",
"precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",t().attributes))}_updateMatricesAndLocalOrigin(c){var {state:a}=c;const {displayMat3:h,size:k,resolution:d,pixelRatio:e,rotation:b,viewpoint:f}=a;c=B*b;const {x:g,y:D}=f.targetGeometry;a=x.normalizeMapX(g,a.spatialReference);this._localOrigin.x=a;this._localOrigin.y=D;a=e*k[0];const p=e*k[1],E=d*a,F=d*p,l=n.identity(this._dvsMat3);n.multiply(l,l,h);n.translate(l,l,v.fromValues(a/2,p/2));
n.scale(l,l,w.fromValues(k[0]/E,-p/F,1));n.rotate(l,l,-c)}_updateBufferData(c,a){const {x:h,y:k}=this._localOrigin,d=new Float32Array(8*a.length),e=new Uint32Array(8*a.length);let b=0,f=0;for(const g of a)g&&(d[2*b]=g[0]-h,d[2*b+1]=g[1]-k,d[2*b+2]=g[0]-h,d[2*b+3]=g[3]-k,d[2*b+4]=g[2]-h,d[2*b+5]=g[3]-k,d[2*b+6]=g[2]-h,d[2*b+7]=g[1]-k,e[f]=b+0,e[f+1]=b+3,e[f+2]=b+3,e[f+3]=b+2,e[f+4]=b+2,e[f+5]=b+1,e[f+6]=b+1,e[f+7]=b+0,b+=4,f+=8);this._vertexBuffer?this._vertexBuffer.setData(d.buffer):this._vertexBuffer=
r.BufferObject.createVertex(c,m.Usage.DYNAMIC_DRAW,d.buffer);this._indexBuffer?this._indexBuffer.setData(e):this._indexBuffer=r.BufferObject.createIndex(c,m.Usage.DYNAMIC_DRAW,e);this._vao||(a=t(),this._vao=new A.VertexArrayObject(c,a.attributes,a.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer))}}const t=()=>z.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:m.DataType.FLOAT}]});return C});