// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),function(f,h,g,e,p,q,k,l,m,n){e=class extends n.BaseImageryTileSubView2D{constructor(){super(...arguments);this._handle=
null;this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(a,b){b={...b,interpolation:"nearest",requestProjectedLocalDirections:!0};a=await this.layer.fetchTile(a.level,a.row,a.col,b);"vector-magdir"===this.layer.serviceRasterInfo.dataType&&a?.pixelBlock&&(a.pixelBlock=await this.layer.convertVectorFieldData(a.pixelBlock,b));return a}updateTileSource(a,b){const c=b.symbolizerParams,{tileData:d}=a;d.key=a.key;d.width=this._tileInfoView.tileInfo.size[0];d.height=this._tileInfoView.tileInfo.size[1];
({symbolTileSize:a}=c);({source:b}=b);d.offset=this._getTileSymbolOffset(d.key,a);null!=b?.pixelBlock?(d.rawPixelData={extent:b.extent,pixelBlock:b.pixelBlock},d.symbolizerParameters=c,d.source=this._sampleVectorFieldData(b.pixelBlock,c,d.offset)):(b=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo.size[0]-d.offset[0])/a),Math.round((this._tileInfoView.tileInfo.size[1]-d.offset[1])/a)]),d.source=b,d.symbolizerParameters=c);d.invalidateVAO();return Promise.resolve()}updateTileSymbolizerParameters(a,
b){var c=b.local;({symbolTileSize:b}=c);({tileData:a}=a);a.offset=this._getTileSymbolOffset(a.key,b);const d=a.symbolizerParameters.symbolTileSize;a.symbolizerParameters=c;c=a.rawPixelData?.pixelBlock;null!=c&&d!==b&&(a.source=this._sampleVectorFieldData(c,a.symbolizerParameters,a.offset));return Promise.resolve()}attach(){super.attach();this.container=new m.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);
this._handle=h.watch(()=>this.layer.renderer,a=>this._updateSymbolType(a))}detach(){super.detach();this.container.removeAllChildren();this._handle?.remove();this.container=this._handle=null}_getTileSymbolOffset(a,b){const c=a.col*this._tileInfoView.tileInfo.size[0]%b;a=a.row*this._tileInfoView.tileInfo.size[1]%b;return[c>b/2?b-c:-c,a>b/2?b-a:-a]}_sampleVectorFieldData(a,b,c){({symbolTileSize:b}=b);return l.sampleVectorField(a,"vector-uv",b,c)}_updateSymbolType(a){"vector-field"===a.type&&(this.container.symbolTypes=
"wind-barb"===a.style?["scalar","triangle"]:"simple-scalar"===a.style?["scalar"]:["triangle"])}};f.__decorate([g.property()],e.prototype,"container",void 0);f.__decorate([g.property()],e.prototype,"layer",void 0);f.__decorate([g.property()],e.prototype,"type",void 0);return e=f.__decorate([k.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],e)});