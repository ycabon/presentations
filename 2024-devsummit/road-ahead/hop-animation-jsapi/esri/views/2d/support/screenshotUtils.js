// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../support/screenshotUtils"],function(g,h){function l(a,b){const e=m(b||{},Math.min(4,h.getMaximumResolutionScale(a.size,Math.min(4096,a.stage.context.parameters.maxTextureSize))),a.size,a.padding),d=p(b,a.allLayerViews);return a.stage.takeScreenshot(e,d,a.backgroundColor,b?.rotation)}function p(a={},b){if(a.layers){var e=[];a.layers.forEach(d=>{const c=b.find(f=>f.layer.id===d.id);c?.container&&e.push(c.container)});return e}}function m(a,b,e,d){a.ignorePadding&&(d={left:0,
right:0,top:0,bottom:0});var c=null;null!=a.width&&null!=a.height?c=[a.width,a.height]:null==a.width&&null!=a.height?c=[a.height,a.height]:null!=a.width&&null==a.height?c=[a.width,a.width]:null==a.width&&null==a.height&&(c=null);var f=e[0]-(d.left+d.right);e=e[1]-(d.top+d.bottom);a=a.area||{x:0,y:0,width:f,height:e};if(c){const k=c[0]/c[1];k>f/e?(f=a.width/k,a={x:a.x,y:Math.round(a.y+(a.height-f)/2),width:a.width,height:Math.round(f)}):(f=a.height*k,a={x:Math.round(a.x+(a.width-f)/2),y:a.y,width:Math.round(f),
height:a.height})}else c=[a.width,a.height];c[0]>a.width?(b=Math.min(c[0]/a.width,b),c=c[0]/a.width/b):(b=1,c=c[0]/a.width);return{cropArea:{x:Math.round((a.x+d.left)*b),y:Math.round((a.y+d.top)*b),width:Math.round(a.width*b),height:Math.round(a.height*b)},outputScale:c,resolutionScale:b}}const n={flipY:!0,premultipliedAlpha:!0};g.createScreenshotRegion=m;g.takeRawScreenshot=async function(a,b){a=await l(a,b);return h.encodeData(a,n)};g.takeScreenshot=async function(a,b){a=await l(a,b);const {format:e,
quality:d}=h.getFormatAndQuality(b?.format,b?.quality);return h.encode(a,{format:e,quality:d,rotation:0,disableDecorations:!1},n)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});