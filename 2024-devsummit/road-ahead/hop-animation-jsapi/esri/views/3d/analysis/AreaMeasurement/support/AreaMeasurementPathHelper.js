// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/Logger ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../geometry/projection ../../../../../geometry/support/aaBoundingRect ../../support/projectionUtils ../../../../interactive/coordinateHelper ../../../../interactive/editGeometry/EditGeometry ../../../../interactive/editGeometry/EditGeometryOperations".split(" "),
function(e,f,p,q,k,g,y,z,r,t,u,h,v,w,l,m){e.AreaMeasurement3DPathHelper=class extends p.EventedAccessor{constructor(a={}){super(a);this._version=0;this._internalGeometryChange=!1;this._extent=h.empty()}set areaMeasurement(a){this._set("areaMeasurement",a);null!=a&&null!=this.view&&this._initialize(a,this.view)}set view(a){this._set("view",a);null!=a&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,a)}get constructed(){return null!=this.areaMeasurement&&null!=this.view}get version(){return this._version}get isEmptyPolygon(){return!this.constructed||
0===this._editGeometry.components.length}get isValidPolygon(){return this.constructed&&this.polygonIsClosed}get extent(){if(this.constructed&&0<this._editGeometry.components.length&&0<this._editGeometry.components[0].vertices.length){const a=h.empty(this._extent);this.forEachVertex(b=>{h.expandPointInPlace(a,b.pos)});return a}return null}get spatialReference(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}_initialize(a,b){this.removeAllHandles();this.addHandles(k.watch(()=>
a.geometry,()=>{this._updateEditGeometryFromModelGeometry(a,b)},k.syncAndInitial));this._makeDirty(!0)}_makeDirty(a=!1){this.notifyChange("polygonIsClosed");this.notifyChange("isValidPolygon");this.notifyChange("initialized");this.notifyChange("extent");a&&this.notifyChange("numVertices")}_updateEditGeometryFromModelGeometry(a,b){this._version++;if(!this._internalGeometryChange){this.removeHandles("EditGeometry");var c=a.geometry;if(null!=c){const d=u.tryProjectWithZConversion(c,b.spatialReference);
null==d&&v.logFailedGeometryProjectionError(a,c.spatialReference,q.getLogger(this));c=d}this._editGeometryOperations=null!=c?m.EditGeometryOperations.fromGeometry(c,b.state.viewingMode):new m.EditGeometryOperations(new l.EditGeometry("polygon",w.createCoordinateHelper(!0,!1,b.spatialReference)));this._makeDirty(!0);this.emit("change");this.addHandles(this._editGeometry.on("change",d=>{this._makeDirty(null!=d.addedVertices||null!=d.removedVertices);this._internalGeometryChange=!0;a.geometry=0<this.numVertices?
this._editGeometry.geometry:null;this._internalGeometryChange=!1}),"EditGeometry")}}get _editGeometry(){return this._editGeometryOperations.data}get vertices(){const a=[];this.forEachVertex(b=>{a.push(b)});return a}get numVertices(){return this.constructed&&0<this._editGeometry.components.length?this._editGeometry.components[0].vertices.length:0}get polygonIsClosed(){return 0<this._editGeometry.components.length&&this._editGeometry.components[0].isClosed()}get firstPoint(){if(this.constructed&&0<
this._editGeometry.components.length){const a=this._editGeometry.components[0].getFirstVertex();if(null!=a)return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)}return null}get lastPoint(){if(this.constructed&&0<this._editGeometry.components.length){const a=this._editGeometry.components[0].getLastVertex();if(null!=a)return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)}return null}getVertex(a){if(!this.constructed||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;
const b=this._editGeometry.components[0].vertices[0];let c=b;do{if(c.index===a)return c;c=c.rightEdge.rightVertex}while(c!==b&&null!=c);return null}getVertexPositionAsPoint(a){return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)}getVertexPositionAsPointFromIndex(a){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(a).pos)}forEachVertex(a){this.constructed&&0<this._editGeometry.components.length&&this._editGeometry.components[0].iterateVertices(a)}forEachVertexPosition(a){const b=
this._editGeometry.coordinateHelper;this.forEachVertex((c,d)=>{b.vectorToPoint(c.pos,n);a(n,d)})}clear(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)}add(a){if(!this.constructed)return null;if(0===this._editGeometry.components.length){const b=this.view;this._editGeometry.components.push(new l.Component(b.spatialReference,b.state.viewingMode))}a=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(a));this.emit("change");return a}close(){if(!this.constructed||
0===this._editGeometry.components.length)return null;const a=this._editGeometryOperations.closeComponent(this._editGeometry.components[0]);this.emit("change");return a}ensureContains(a,b=""){let c=!1;this._editGeometry.components.forEach(d=>{d.iterateVertices(x=>{x===a&&(c=!0)})});if(!c)throw Error(`vertex doesnt exist ${b}`);return c}setVertexPosition(a,b){if(!this.constructed)return null;a=this._editGeometryOperations.setVertexPosition(a,this._editGeometry.coordinateHelper.pointToVector(b));this.emit("change");
return a}equals(a){if(this.numVertices!==a.numVertices)return!1;let b=!0;this.forEachVertexPosition((c,d)=>{d=a.getVertexPositionAsPointFromIndex(d);c.equals(d)||(b=!1)});return b?!0:!1}};f.__decorate([g.property({value:null})],e.AreaMeasurement3DPathHelper.prototype,"areaMeasurement",null);f.__decorate([g.property({value:null})],e.AreaMeasurement3DPathHelper.prototype,"view",null);f.__decorate([g.property()],e.AreaMeasurement3DPathHelper.prototype,"isEmptyPolygon",null);f.__decorate([g.property()],
e.AreaMeasurement3DPathHelper.prototype,"isValidPolygon",null);f.__decorate([g.property()],e.AreaMeasurement3DPathHelper.prototype,"extent",null);f.__decorate([g.property()],e.AreaMeasurement3DPathHelper.prototype,"spatialReference",null);f.__decorate([g.property()],e.AreaMeasurement3DPathHelper.prototype,"numVertices",null);f.__decorate([g.property()],e.AreaMeasurement3DPathHelper.prototype,"polygonIsClosed",null);e.AreaMeasurement3DPathHelper=f.__decorate([r.subclass("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurement3DPathHelper")],
e.AreaMeasurement3DPathHelper);const n=new t;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});