// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../Color ../../../../intl ../../../../core/Accessor ../../../../core/handleUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./LengthDimensionVisualization ./settings ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/LineMarkerTechniqueConfiguration ../../../../intl/locale ../../../../intl/messages".split(" "),
function(c,f,r,E,t,n,d,u,g,F,G,H,v,k,w,p,h,x,q,m,y,z,A){c.DimensionVisualization=class extends t{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(b){super(b);this.loadingMessages=!1;this._messages=null}initialize(){var b=this.isDecoration;this._markerMaterial=new x.LineMarkerMaterial({width:1,anchor:y.LineMarkerAnchor.Tip,color:k.ZEROS,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,
markerPrimitive:"triangle",isDecoration:b});this._dimensionLineMaterial=new m.RibbonLineMaterial({width:1,color:k.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:b});this._offsetLineMaterial=new m.RibbonLineMaterial({width:1,color:k.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:q.createStipplePatternSimple(5),isDecoration:b});this._smallDimensionLineMaterial=new m.RibbonLineMaterial({width:1,
color:k.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,isDecoration:b});this._smallOffsetLineMaterial=new m.RibbonLineMaterial({width:1,color:k.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:q.createStipplePatternSimple(5),isDecoration:b});for(const a of this._lineMaterials())this.view._stage.add(a),this.addHandles(n.makeHandle(()=>{this.view._stage?.remove(a)}));this._dimensionVisualizations=b=d.mapCollection(()=>this.analysisViewData.computations,
({computation:a})=>this._createVisualization(a));this.addHandles([n.destroyHandle(b),d.watch(()=>r.toUnitRGBA(this.analysis.style.color),a=>{for(const e of this._lineMaterials())e.setParameters({color:a})},d.syncAndInitial),d.watch(()=>this.analysis.style.lineSize,a=>{a=u.pt2px(a);this._markerMaterial.setParameters({width:a*p.markerLineSizeFraction});this._dimensionLineMaterial.setParameters({width:a,markerParameters:this._markerMaterial.parameters});this._offsetLineMaterial.setParameters({width:Math.max(a*
p.offsetLineSizeFraction,1)})},d.syncAndInitial),d.watch(()=>{var a=this.view.state.camera;const {fontSize:e,lineSize:l,textColor:B,textBackgroundColor:C}=this.analysis.style;var D={fontSize:e,lineSize:l,textBackgroundColor:C.clone(),textColor:B.clone()};return{camera:a,style:D}},({camera:a,style:e})=>{for(const {visualization:l}of this._dimensionVisualizations)l.updateCameraDependentElements(a,l.computation.geometry,e),l.updateLabelStyle(e)}),d.watch(()=>this.visible,a=>{for(const {visualization:e}of this._dimensionVisualizations)e.visible=
a})]);this.addHandles([z.onLocaleChange(()=>this._updateMessageBundle()),d.when(()=>!this.loadingMessages,()=>{for(const {visualization:a}of this._dimensionVisualizations)a.updateUnitsMessages(this._messages)},d.sync)]);this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map(({visualization:b})=>b),disablePartialOcclusion:()=>{for(const b of this._lineMaterials())b.setParameters({renderOccluded:h.RenderOccludedFlag.Occlude})}}}_createVisualization(b){const a=
new w.LengthDimensionVisualization({analysis:this.analysis,computation:b,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:a,remove:()=>a.destroy()}}_lineMaterials(){return[this._markerMaterial,
this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await A.fetchMessageBundle("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};f.__decorate([g.property({constructOnly:!0})],c.DimensionVisualization.prototype,"analysisViewData",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],c.DimensionVisualization.prototype,"view",void 0);f.__decorate([g.property({constructOnly:!0})],
c.DimensionVisualization.prototype,"isDecoration",void 0);f.__decorate([g.property()],c.DimensionVisualization.prototype,"analysis",null);f.__decorate([g.property()],c.DimensionVisualization.prototype,"visible",null);f.__decorate([g.property()],c.DimensionVisualization.prototype,"loadingMessages",void 0);c.DimensionVisualization=f.__decorate([v.subclass("esri.views.3d.analysis.Dimension.DimensionVisualization")],c.DimensionVisualization);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});