// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Handles ../../../../core/lang ../../../../core/maybe ../../../../core/quantityFormatUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./lengthDimensionUtils ./settings ../../interactive/visualElements/LabelVisualElement ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/MarkerVisualElement ../../interactive/visualElements/support/Segment".split(" "),function(p,w,x,
y,z,n,h,A,k,q,B,l,C,r){class D{set visible(a){for(const c of this._visualElements.values())c.attached=a}constructor(a){this.destroyed=!1;this._handles=new w;this._messages=null;this._labelSegment=new r.EuclideanSegment;const {analysis:c,computation:d,view:b,messages:m,isDecoration:e}=a;this.analysis=c;this.computation=d;this.view=b;this._messages=m;const g=a.visible,f={view:b,attached:g,isDecoration:e},{fontSize:t,textColor:E,textBackgroundColor:F}=c.style;this._visualElements=new v({marker:new C.MarkerVisualElement(f,
a.markerMaterial),dimension:new l.LineVisualElement(f,a.dimensionLineMaterial),startOffset:new l.LineVisualElement(f,a.offsetLineMaterial),endOffset:new l.LineVisualElement(f,a.offsetLineMaterial),dimensionSmall:new l.LineVisualElement(f,a.smallDimensionLineMaterial),startOffsetSmall:new l.LineVisualElement(f,a.smallOffsetLineMaterial),endOffsetSmall:new l.LineVisualElement(f,a.smallOffsetLineMaterial),label:new B.LabelVisualElement({view:b,attached:g,distance:0,geometry:{type:"segment",sampleLocation:"center",
segment:this._labelSegment,callout:!1},fontSize:h.pt2px(t),textColor:E.clone(),backgroundColor:F.clone(),isDecoration:e})});this._handles.add([n.watch(()=>d.geometry,u=>{this.updateCameraDependentElements(b.state.camera,u,c.style);null!=d.geometry&&this._updateLines(d.geometry)},{...n.initial,equals:x.equals}),n.watch(()=>d.length,u=>this._updateLabelContent(u),n.initial)])}destroy(){this.destroyed=!0;this._handles=y.destroyMaybe(this._handles);for(const a of this._visualElements.values())a.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,
label:this._visualElements.label}}_updateLines(a){const c=k.computeSpanningSegment(G,k.OffsetSegmentLocation.Start,a.directSegment,a.dimensionSegment),d=k.computeSpanningSegment(H,k.OffsetSegmentLocation.End,a.directSegment,a.dimensionSegment),b=this._visualElements;b.marker.setGeometryFromSegment(a.dimensionSegment,a.primaryOffsetAxis);b.dimension.setGeometryFromSegment(a.dimensionSegment);b.startOffset.setGeometryFromSegment(c);b.endOffset.setGeometryFromSegment(d);b.dimensionSmall.setGeometryFromSegment(a.dimensionSegment);
b.startOffsetSmall.setGeometryFromSegment(c);b.endOffsetSmall.setGeometryFromSegment(d)}updateCameraDependentElements(a,c,d){var b=this._visualElements;if(null==c)for(var m of b.values())m.visible=!1;else{a=a.computeScreenPixelSizeAt(c.dimensionSegment.eval(.5,I));m=k.maxScreenLengthSquaredFromGeometry(c,a);var e=h.pt2px(d.lineSize)*q.smallScreenLengthLineSizeFactor;e=m<e**2;var g=!e;b.marker.visible=g;b.dimension.visible=g;b.startOffset.visible=g;b.endOffset.visible=g;b.dimensionSmall.visible=e;
b.startOffsetSmall.visible=e;b.endOffsetSmall.visible=e;e=h.pt2px(d.fontSize)*q.minScreenLengthFontSizeFactor;({label:b}=b);b.visible=m>=e**2;if(b.visible){var {dimensionSegment:f,primaryOffsetAxis:t}=c;({offset:c}=this.computation.dimension);d=(0<=Math.sign(c)?1:-1)*this._labelOffsetPx(d)*a;k.offsetSegment(this._labelSegment,f,t,d);b.updateLabelPosition()}}}updateLabelStyle(a){const {label:c}=this._visualElements;c.fontSize=h.pt2px(a.fontSize);c.textColor=a.textColor;c.backgroundColor=a.textBackgroundColor}updateUnitsMessages(a){this._messages=
a;({length:a}=this.computation);this._updateLabelContent(a)}_updateLabelContent(a){const {label:c}=this._visualElements;c.text=null==a||null==this._messages?"":z.formatDecimal(this._messages,a,a.unit)}_labelOffsetPx(a){return 1.5*h.pt2px(a.fontSize)+q.labelMarginPx+h.pt2px(a.lineSize/2)}}const G=new r.EuclideanSegment,H=new r.EuclideanSegment,I=A.create();class v{constructor(a){this.marker=a.marker;this.dimension=a.dimension;this.startOffset=a.startOffset;this.endOffset=a.endOffset;this.dimensionSmall=
a.dimensionSmall;this.startOffsetSmall=a.startOffsetSmall;this.endOffsetSmall=a.endOffsetSmall;this.label=a.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}p.LengthDimensionVisualElements=v;p.LengthDimensionVisualization=D;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});