// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/signal ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../support/elevationInfoUtils ../Manipulator3D ./GrabbingState ./ManipulatorState ./ManipulatorType ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/OutlineVisualElement ../../layers/graphics/GraphicState ../../webgl-engine/lib/Material".split(" "),
function(A,l,I,g,B,x,J,C,K,D,L,M,E,N,O,P,Q,R){function S(a,c){const {view:d,graphic:e}=a,b=new P.OutlineVisualElement({view:d,geometry:y(e)?e.geometry:null,elevationInfo:C.getGraphicEffectiveElevationInfo(e),attached:!1,isDecoration:!0}),f=new E.Settings({getTheme:()=>d.effectiveTheme}),h=l.handlesGroup([g.watch(()=>f.visualElements.lineGraphics.outline,n=>n.apply(b),g.initial),g.watch(()=>f.visualElements.lineGraphics.shadowStyle,n=>n.apply(b),g.initial),g.watch(()=>c.displaying,()=>{b.attached=
c.displaying}),g.watch(()=>c.isDraped,n=>{b.isDraped=n}),c.on("changed",()=>b.geometry=y(e)?e.geometry:null),l.destroyHandle(b)]);b.attached=c.displaying;return{visualElement:b,remove:()=>h.remove()}}function T(a,c,d){const {graphic:e,view:b}=a,f=[];var h=C.getGraphicEffectiveElevationInfo(e);const n="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,m=new L.ManipulatorState,t=new E.Settings({getTheme:()=>b.effectiveTheme}),v=t.visualElements,p=new N.ExtendedLineVisualElement({view:b,
extensionType:v.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});h=I.deg2rad(v.heightPlaneAngleCutoff);const w=new O.LaserlineVisualElement({view:b,attached:!1,angleCutoff:h,isDecoration:!0}),F=B.signal(1);f.push(g.watch(()=>({lineShadowStyle:t.visualElements.lineGraphics.shadowStyle,pointShadowStyle:t.visualElements.pointGraphics.shadowStyle,alpha:F.value}),({lineShadowStyle:k,pointShadowStyle:z,
alpha:G})=>{k.apply(c,G);z.apply(p,G)},g.initial));const H=B.signal(1);f.push(g.watch(()=>({heightPlane:t.visualElements.heightPlane,alpha:H.value}),({heightPlane:k,alpha:z})=>k.apply(w,z),g.initial));const r=()=>{m.update(a);if(d.displaying&&(!n||!d.isDraped&&y(e)&&e.geometry.hasZ)){c.laserlineEnabled=!0;F.value=m.grabbingState&D.GrabbingState.XY?v.laserlineAlphaMultiplier:1;H.value=m.grabbingState&D.GrabbingState.Z?v.laserlineAlphaMultiplier:1;var k=1===m.numSelected?m.firstSelected:1<m.numSelected&&
null!=m.firstGrabbedXY?m.firstGrabbedXY:null;null!=k?(p.setStartEndFromWorldDownAtLocation(k.renderLocation),p.attached=!0):p.attached=!1;U(a,c,w,m)}else c.laserlineEnabled=!1,p.attached=!1,w.attached=!1};f.push(g.watch(()=>t.visualElements.zVerticalLine,k=>k.apply(p),g.initial));f.push(d.on("changed",r),g.watch(()=>d.displaying,r),c.events.on("attachment-origin-changed",r),l.destroyHandle(p),l.destroyHandle(w));const u=[];h=()=>{l.removeHandles(u);u.length=0;a.forEachManipulator(k=>u.push(k.events.on("grab-changed",
r)));a.forEachManipulator(k=>u.push(k.events.on("select-changed",r)));r()};h();f.push(a.onManipulatorsChanged(h),l.refHandle(()=>l.handlesGroup(u)));return l.handlesGroup(f)}function U(a,c,d,e){if(0<e.numSelected){x.set(q,0,0,0);let b=0;a.forEachManipulator((f,h)=>{h===M.ManipulatorType.TRANSLATE_XY&&f.selected&&f instanceof K.Manipulator3D&&(x.add(q,q,f.renderLocation),b++)});0<b?(d.heightManifoldTarget=x.scale(q,q,1/b),d.attached=!0):d.attached=!1}else c=c.attachmentOrigin,null!=c&&a.view.renderCoordsHelper.toRenderCoords(c,
q)?(d.heightManifoldTarget=q,d.attached=!0):d.attached=!1}function y(a){return null!=a.geometry&&("polygon"===a.geometry.type||"polyline"===a.geometry.type)}const q=J.create();A.createVisualElements=function(a){const {view:c,graphic:d}=a,e=new Q.GraphicState({graphic:d}),b=S(a,e);a=T(a,b.visualElement,e);const f=[b,a,c.maskOccludee(d),c.trackGraphicState(e)];return{visualElement:b.visualElement,remove:()=>l.removeHandles(f)}};Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});