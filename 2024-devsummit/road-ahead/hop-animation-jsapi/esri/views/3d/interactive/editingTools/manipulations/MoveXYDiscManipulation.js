// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../Color ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/vectorStacks ../../../../../support/elevationInfoUtils ../../Manipulator3D ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ./config ./Manipulation ./moveUtils ../snapping/SnapToScene ../../../webgl-engine/lib/basicInterfaces ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(r,z,A,B,t,u,C,D,m,v,E,F,w,G,x,e,H,I,J,K,L,M,N,p,y){class O extends H.Manipulation{constructor(a){super();this._handles=new A;this._snapToScene=new J.SnapToScene;this._scale=1;this._radius=e.discRadius;this._view=a.view;this._tool=a.tool;this._discMaterial=this._createMaterial();this._discMaterialTransparent=this._createMaterial(.5);null!=a.snapToScene&&(this.snapToScene=a.snapToScene);null!=a.radius&&(this._radius=a.radius);this._createManipulator();this.forEachManipulator(b=>this._tool.manipulators.add(b))}destroy(){this._handles=
B.destroyMaybe(this._handles);this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._manipulator=this._view=this._tool=null}forEachManipulator(a){a(this._manipulator,x.ManipulatorType.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(a){this._scale=a;this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(a){this._snapToScene.enabled=a}get radius(){return this._radius}set radius(a){a!==this._radius&&(this._radius=
a,this._updateManipulator())}createGraphicDragPipeline(a,b,c){const d=b.graphic,f=E.getGraphicEffectiveElevationInfo(d),g=d.geometry.spatialReference;return I.createGraphicMoveDragPipeline(d,c,h=>this.createDragPipeline((n,k,l,q,P)=>{({steps:k,cancel:l}=a(n,k,l,q,P));return h(n,k,l)},f,g,d),this._view.state.viewingMode)}createDragPipeline(a,b,c,d){const f=this._view;return p.createManipulatorDragEventPipeline(this._manipulator,(g,h,n,k,l)=>{h=h.next(p.dragAtLocation(f,g.elevationAlignedLocation)).next(G.screenToMapXYAtLocation(f,
g.elevationAlignedLocation,b,c,d)).next(...this._snapToScene.createDragEventPipelineStep(f,b)).next(q=>({...q,manipulatorType:x.ManipulatorType.TRANSLATE_XY})).next(p.addScreenDelta());a(g,h,n,k,l)})}_updateManipulatorTransform(){const a=u.fromScaling(v.sm4d.get(),D.set(v.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=a}_createManipulator(){this._manipulator=new F.Manipulator3D({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,
touchMultiplier:1,collisionType:{type:"disc",direction:m.fromValues(0,0,1)},worldOriented:!0});this._updateManipulator()}_updateManipulator(){const a=L.createCylinderGeometry(this._discMaterial,e.discHeight,1,e.geometrySegments,m.fromValues(0,0,1),m.fromValues(0,0,0));a.transformation=u.fromScaling(C.create(),m.fromValues(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[new w.RenderObject(a,y.ManipulatorStateFlags.Focused),new w.RenderObject(a.instantiate({material:this._discMaterialTransparent}),
y.ManipulatorStateFlags.Unfocused)];this._manipulator.radius=this._radius/e.discRadius*e.discCollisionRadius}_createMaterial(a=1){const b=new N.ColorMaterial({cullFace:K.CullFaceOptions.Back,renderOccluded:M.RenderOccludedFlag.Transparent,isDecoration:!0});this._handles.add(t.watch(()=>z.toUnitRGBA(this._view.effectiveTheme.accentColor),c=>{c[3]*=a;b.setParameters({color:c})},t.initial));return b}get test(){return{discManipulator:this._manipulator}}}r.MoveXYDiscManipulation=O;Object.defineProperty(r,
Symbol.toStringTag,{value:"Module"})});