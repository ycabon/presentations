// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/signal ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./GrabbingState ./ManipulatorState ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState ../../webgl-engine/lib/Material".split(" "),
function(y,p,I,n,z,J,K,L,A,v,M,B,C,N,D,O,E,P,Q,R,S,T){function U(a,d,c,f){const {view:b,graphic:h}=a,g=new D.Settings({getTheme:()=>b.effectiveTheme}),q=new O.ExtendedLineVisualElement({view:b,extensionType:g.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:T.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});c.push(n.watch(()=>g.visualElements.zVerticalLine,e=>e.apply(q),n.initial));const k=new E.LaserlineVisualElement({view:b,intersectsLineInfinite:!0,
attached:!1,isDecoration:!0});var r=I.deg2rad(g.visualElements.heightPlaneAngleCutoff);const t=new E.LaserlineVisualElement({view:b,attached:!1,angleCutoff:r,isDecoration:!0});r=B.getGraphicEffectiveElevationInfo(a.graphic);const V=R.ElevationContext.fromElevationInfo(r),W="on-the-ground"===r.mode||!r.offset&&"absolute-height"!==r.mode,w=new N.ManipulatorState,F=z.signal(1);c.push(n.watch(()=>({heightPlane:g.visualElements.heightPlane,alpha:F.value}),({heightPlane:e,alpha:m})=>e.apply(t,m),n.initial));
const G=z.signal(1);c.push(n.watch(()=>({shadowStyle:g.visualElements.pointGraphics.shadowStyle,alpha:G.value}),({shadowStyle:e,alpha:m})=>e.apply(k,m),n.initial));const u=()=>{w.update(a);var e=x(h),m=W&&(d.isDraped||null==e||!e.hasZ);let H=!0;if(m||null==e)H=!1;else{const X=Q.evaluateElevationAlignmentAtPoint(e,b.elevationProvider,V,b.renderCoordsHelper);J.set(l,e.x,e.y,X);A.projectVectorToVector(l,e.spatialReference,l,b.renderCoordsHelper.spatialReference);q.setStartEndFromWorldDownAtLocation(l);
k.intersectsWorldUpAtLocation=l}F.value=w.grabbingState&C.GrabbingState.Z?g.visualElements.laserlineAlphaMultiplier:1;e=v.empty(Y);!m&&d.displaying&&f.calculateMapBounds(e)&&A.projectVectorToVector(v.getMin(e,l),b.spatialReference,l,b.renderCoordsHelper.spatialReference)?(t.heightManifoldTarget=l,t.attached=!0):t.attached=!1;G.value=w.grabbingState&C.GrabbingState.XY?g.visualElements.laserlineAlphaMultiplier:1;m=H&&d.displaying&&!m;k.attached=m;q.attached=m};c.push(n.watch(()=>[d.displaying,d.isDraped],
u),d.on("changed",u));a.forEachManipulator(e=>{c.push(e.events.on("grab-changed",u))});c.push(p.destroyHandle(k));c.push(p.destroyHandle(q));c.push(p.destroyHandle(t));u()}function Z(a,d,c){const {view:f,graphic:b}=a,h=new P.PointVisualElement({view:f,geometry:x(b),elevationInfo:B.getGraphicEffectiveElevationInfo(b),isDecoration:!0});aa(a,h,d,c);c.push(p.destroyHandle(h));return h}function x(a){a=a.geometry;return null==a?null:"point"===a.type?a:"mesh"===a.type?a.anchor.clone():null}function aa(a,
d,c,f){const b=new D.Settings({getTheme:()=>a.view.effectiveTheme});ba(a,d,c,f);b.visualElements.pointGraphics.outline.apply(d);f.push(n.watch(()=>c.displaying,()=>{d.attached=c.displaying},n.initial))}function ba(a,d,c,f){const {view:b,graphic:h}=a;let g=null;const q=k=>{null!=g&&(g.remove(),g=null);c.isDraped&&null!=k&&(g=ca(b,k,()=>{d.geometry=k}))};a=()=>{const k=x(h);q(k);d.geometry=k};f.push(c.on("changed",a),p.refHandle(()=>g));a()}function ca(a,d,c){L.projectPointToVector(d,l,a.elevationProvider.spatialReference);
const f=l[0],b=l[1];return a.elevationProvider.on("elevation-change",h=>{M.containsXY(h.extent,f,b)&&c()})}const l=K.create(),Y=v.create();y.createVisualElements=function(a){const {view:d,graphic:c}=a,f=new S.GraphicState({graphic:c}),b=[],h=Z(a,f,b);U(a,f,b,h);b.push(d.trackGraphicState(f));return{visualElement:h,remove:()=>p.removeHandles(b)}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});