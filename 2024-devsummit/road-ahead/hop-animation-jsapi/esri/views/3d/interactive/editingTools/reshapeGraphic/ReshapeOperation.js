// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../geometry ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/quantityUtils ../../../../../core/reactiveUtils ../../../../../core/unitUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../geometry/Polyline ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/plane ../../../../../geometry/support/vectorStacks ../../../../../layers/graphics/dehydratedPoint ../../../../../support/elevationInfoUtils ../../../../../symbols/support/utils ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../../SegmentLabels3D ../../SnappingVisualizer3D ../dragEventPipeline3D ../geometryUtils ../ManipulatorType ../manipulatorUtils ../settings ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ../manipulations/moveUtils ../manipulations/MoveXYGraphicManipulation ./edgeOffsetUtils ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/GeometryUtil ../../../../input/IViewEvents ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/editGeometry/interfaces ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep ../../../../interactive/tooltip/ReshapeTooltipInfos ../../../../interactive/tooltip/Tooltip ../../../../interactive/tooltip/TranslateTooltipInfos ../../../../interactive/tooltip/fields/fields ../../../../support/automaticAreaMeasurementUtils ../../../../support/automaticLengthMeasurementUtils ../../../../support/euclideanLengthMeasurementUtils ../../../../support/geodesicLengthMeasurementUtils ../../../../../geometry/SpatialReference".split(" "),
function(q,r,Ja,ka,la,C,Ka,ma,na,H,x,G,A,oa,t,La,pa,qa,I,X,ra,sa,ta,ua,va,Y,M,Z,T,D,y,wa,aa,R,xa,ba,U,ya,za,Aa,u,ca,Ba,J,da,Ca,K,ea,B,n,Da,V,fa,ha,ia,Ea,L,Fa,Ga,N,W,Ha,Ia){q.ReshapeOperation=class extends ma.EventedMixin(ka){constructor(a){super(a);this._selectedIndex=0;this._manipulatorHandles=new na;this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0;this._reshapeEventState=p.NONE;this._updatingHandles=new ra.UpdatingHandles;this._recreatingManipulators=!1;this._settings=new ya.Settings({getTheme:()=>
this.view.effectiveTheme});this._vertexLaserLineVisualElement=this.outputGeometry=this._edgeOffsetTooltipInfo=this._translateVertexZTooltipInfo=this._translateVertexXYTooltipInfo=this._translateVertexTooltipInfo=this._translateGraphicZTooltipInfo=this._translateGraphicXYTooltipInfo=this._translateGraphicTooltipInfo=this._latestTooltipInfo=null}initialize(){const {graphic:a,view:b}=this;var d=this._settings.manipulators,c=d.vertex;this._vertexManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(c.color),
c.renderOccluded);this._vertexManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(c.outlineColor),c.renderOccluded);this._vertexManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(c.hoverOutlineColor),c.renderOccluded);c=d.edge;this._edgeManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(c.color),c.renderOccluded);this._edgeManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(c.outlineColor),
c.renderOccluded);c=d.edgeOffset;this._edgeOffsetManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(c.color),c.renderOccluded,!1);this._edgeOffsetManipulatorHoverMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(c.hoverColor),c.renderOccluded,!1);d=d.selected;this._selectedManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(d.color),d.renderOccluded);this._selectedManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(d.outlineColor),
d.renderOccluded);this._selectedManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(d.hoverOutlineColor),d.renderOccluded);const e=this._graphicState=new Ca.GraphicState({graphic:a});this.tooltip=new Ea.Tooltip({view:b});this.addHandles([A.watch(()=>{const f=this._settings.manipulators;return{vertexSettings:f.vertex,edgeSettings:f.edge,edgeOffsetSettings:f.edgeOffset,selectedSettings:f.selected}},({vertexSettings:f,edgeSettings:g,edgeOffsetSettings:k,selectedSettings:h})=>
{f.applyColor(this._vertexManipulatorMaterial);f.applyOutline(this._vertexManipulatorOutlineMaterial);f.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial);g.applyColor(this._edgeManipulatorMaterial);g.applyOutline(this._edgeManipulatorOutlineMaterial);k.applyColor(this._edgeOffsetManipulatorMaterial);k.applyHover(this._edgeOffsetManipulatorHoverMaterial);h.applyColor(this._selectedManipulatorMaterial);h.applyOutline(this._selectedManipulatorOutlineMaterial);h.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),
A.watch(()=>e.displaying,f=>{for(const g of this._manipulatorInfos)g.manipulator.available=f}),A.watch(()=>({labels:this._segmentLabels,enabled:this.sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:f,enabled:g,edgeOffsetEnabled:k})=>{null!=f&&(f.visible=g,f.edgeDistance=k?"far":"default")},A.initial),A.watch(()=>this.sketchOptions.tooltips.effectiveEnabled,f=>{this.tooltip.info=f?this._latestTooltipInfo:null},A.initial),this.view.trackGraphicState(e)])}destroy(){this._segmentLabels=
x.destroyMaybe(this._segmentLabels);this.tooltip=x.destroyMaybe(this.tooltip);this._removeManipulators();this._updatingHandles.destroy()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(a){this._recreateEditGeometryAndManipulators(a)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const a=
this._manipulatorInfos.filter(b=>b.manipulator.selected&&"vertex"===b.type);this._removeVertices(a)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll();this._moveManipulation=x.destroyMaybe(this._moveManipulation);this._graphicMoveManipulation=x.destroyMaybe(this._graphicMoveManipulation);this.manipulators.removeAll();this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0}_createManipulators(a){if(null!=this._editGeometryOperations){var b=
M.getGraphicEffectiveElevationInfo(this.graphic);for(const d of this._editGeometryOperations.data.components){const c=a?.byComponentIndex.get(d.index);for(const e of d.vertices){const f=c?.has(e.index);this._createVertexOrEdgeManipulator(e,b,f)}for(const e of d.edges)this._createVertexOrEdgeManipulator(e,b)}this._createGraphicMoveManipulation();this._createMoveManipulation(b);this._createVisualElements()}}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=
this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const a=this._editGeometryOperations.redo();null!=a&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());return a}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const a=this._editGeometryOperations.undo();null!=a&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());
return a}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._hideTooltip(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(a){const b={byComponentIndex:new Map};if(null!=a&&null!=this.inputGeometry&&ta.hasCompatibleTopology(a,this.inputGeometry))for(const d of this._manipulatorInfos)if("vertex"===d.type&&d.manipulator.selected){const {index:c,component:{index:e}}=d.handle,{byComponentIndex:f}=
b,g=f.get(e)||new Set;g.add(c);f.set(e,g)}this._recreatingManipulators=!0;this._removeManipulators();this._hideTooltip();this._editGeometryOperations=x.destroyMaybe(this._editGeometryOperations);this._segmentLabels=x.destroyMaybe(this._segmentLabels);null!=a&&(this._editGeometryOperations=Da.EditGeometryOperations.fromGeometry("mesh"===a.type?a.anchor:a,this.view.state.viewingMode),this._createManipulators(b),a=this.sketchOptions.labels,this._segmentLabels=new wa.SegmentLabels3D({context:{view:this.view,
editGeometryOperations:this._editGeometryOperations,elevationInfo:M.getGraphicEffectiveElevationInfo(this.graphic),labelOptions:a,graphic:this.graphic,graphicState:this._graphicState},visible:a.enabled}));this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(a,b){if("end"===b.action)return b;let d=0;const c=[],e=this._manipulatorInfos.some(f=>"vertex"===f.type&&f.manipulator.selected);a=a===O.SELECTED_OR_ALL&&e;for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.grabbing||
a&&!f.manipulator.selected||c.push(f),d++);if(0===c.length)return b;this._moveVertices(c,b);if(c.length===d){this._updateEventState(p.MOVING);if(this.destroyed)return b;this.emit("move",{type:"move",dx:b.screenDeltaX,dy:b.screenDeltaY,mover:this.graphic})}else{this._updateEventState(p.RESHAPING);if(this.destroyed)return b;this.emit("reshape",{type:"reshape",mover:this.graphic})}return b}_isMultiVertexSelection(){return 1<this._manipulatorInfos.reduce((a,b)=>"vertex"===b.type&&b.manipulator.selected?
a+1:a,0)}_perVertexManipulatorDragAction(a){this._updateEventState(p.RESHAPING);if(!this.destroyed){var {mapDeltaX:b,mapDeltaY:d,mapDeltaZ:c}=a;if(b||d||c){var e=[];for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.selected&&!f.manipulator.grabbing||f===a.info)&&e.push(f);this._moveVertices(e,a,V.AccumulationBehavior.ACCUMULATE_STEPS);this.emit("reshape",{type:"reshape",mover:this.graphic})}}}_updateEventState(a){if(a===this._reshapeEventState)return!1;switch(a){case p.NONE:if(0!==
this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case p.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case p.MOVING:switch(this._reshapeEventState){case p.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",
dx:0,dy:0,mover:this.graphic})}break;case p.RESHAPING:switch(this._reshapeEventState){case p.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case p.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const b=this._reshapeEventState!==a;this._reshapeEventState=a;return b}_createGraphicMoveManipulation(){const {tool:a,view:b}=this;this._graphicMoveManipulation=
new Ba.MoveXYGraphicManipulation({tool:a,view:b,graphicState:this._graphicState});if(this.enableMoveGraphic){let d=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((c,e,f)=>{e.next(g=>this._trackNumDragging(g)).next(g=>{"start"===g.action&&(d=this._editGeometryOperations.createUndoGroup());return g}).next(g=>this._perGraphicManipulatorDragAction(O.ALL,g)).next(g=>{this._updateTranslateGraphicTooltip(u.ManipulationType.XY,g);return g}).next(g=>{"end"===g.action&&(this._hideTooltip(),
d=x.removeMaybe(d))});f.next(()=>this._onDragCancel(!0,()=>d=x.removeMaybe(d)))}));this._graphicMoveManipulation.forEachManipulator(c=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(c,!1)))}else this._graphicMoveManipulation.forEachManipulator(d=>{d.grabbable=!1;d.cursor=null});this._graphicMoveManipulation.forEachManipulator(d=>this._manipulatorHandles.add(d.events.on("immediate-click",c=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",
{...c,graphic:this.graphic});c.stopPropagation()})))}_createMoveManipulation(a){const {graphic:b,tool:d,view:c}=this,e=this._graphicState;this._moveManipulation=new u.MoveManipulation({tool:d,view:c,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&U.canMoveZ(b),snapToScene:!1,radius:u.MoveManipulation.radiusForSymbol(b.symbol)});this._moveManipulation.forEachManipulator(g=>this.addHandles([g.events.on("immediate-click",k=>{this._moveManipulation.zManipulation.hasManipulator(g)||this._manipulatorInfos.some(h=>
h.manipulator.selected)||this.emit("immediate-click",{...k,graphic:b});k.stopPropagation()}),this._watchAndUpdateGrabState(g,!1)]));const f=g=>k=>{this.addHandles(k.events.on("focus-changed",({action:h})=>{"focus"===h?this._updateTranslateTooltip(g):this._hideTooltip()}))};this._moveManipulation.xyManipulation.forEachManipulator(f(u.ManipulationType.XY));this._moveManipulation.xyAxisManipulation.forEachManipulator(f(u.ManipulationType.XY_AXIS));this._moveManipulation.zManipulation.forEachManipulator(f(u.ManipulationType.Z));
this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};this.addHandles([this._moveManipulation.createDragPipeline((g,k,h,l,v)=>{const {snappingStep:w,cancelSnapping:F}=ha.createSnapDragEventPipelineStep({predicate:m=>!!m.info,snappingManager:d.snappingManager,snappingContext:new fa.SnappingContext({editGeometryOperations:this._editGeometryOperations,elevationInfo:a,pointer:v,excludeFeature:b,visualizer:new aa.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});l=
l.next(m=>{this._onDragCancel();return m}).next(F);h=h.next(m=>this._trackNumDragging(m)).next(m=>{const P=this._manipulatorInfos.filter(z=>"vertex"===z.type&&z.manipulator.selected);return m.manipulatorType===ba.ManipulatorType.TRANSLATE_XY&&1===P.length?{...m,info:P[0],snapOrigin:P[0].handle.pos}:m}).next(B.sceneSnappingAtLocation(this.view,a,b)).next(...w).next(B.addMapDelta()).next(m=>this._perGraphicManipulatorDragAction(O.SELECTED_OR_ALL,m)).next(m=>{this._updateTranslateTooltip(g,m);return m});
return{steps:h,cancel:l}},a,b.geometry.spatialReference,b),A.watch(()=>e.displaying,()=>this._updateMoveManipulationPosition(),A.initial),e.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),A.watch(()=>e.isDraped,g=>{this._updateMoveManipulationPosition();g?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),"align-move-manipulation"):this.removeHandles("align-move-manipulation")},A.initial)])}_createVisualElements(){const {graphic:a,
view:b}=this,d=za.createVisualElements({view:b,graphic:a,forEachManipulator:c=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(c);this._moveManipulation.forEachManipulator(c);for(const e of this._manipulatorInfos)c(e.manipulator,ba.ManipulatorType.TRANSLATE_XY)}},onManipulatorsChanged:c=>this.on("manipulators-changed",c)});null!=d&&(this._outlineVisualElement=d.visualElement instanceof da.OutlineVisualElement?d.visualElement:null);null!=this._outlineVisualElement&&
this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}));this._manipulatorHandles.add(d)}_createEdgeOffsetManipulator(a,b=M.getGraphicEffectiveElevationInfo(this.graphic)){if(2>=a.component.vertices.length)return null;var d=this._settings.manipulators.edgeOffset,c=d.size/2,e=c+d.collisionPadding;c/=e;const f=c*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=
K.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,f,c/2,c/2,d.height,d.offset));null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=K.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,-f,c/2,c/2,d.height,-d.offset));c=[new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate(),n.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),
n.ManipulatorStateFlags.Focused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate(),n.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),n.ManipulatorStateFlags.Focused)];e=new T.Manipulator3D({view:this.view,renderObjects:c,elevationInfo:"on-the-ground"!==b.mode||Z.isVolumetricSymbol(this.graphic.symbol)?{mode:"absolute-height",offset:0}:b,worldOriented:!1,focusMultiplier:1,
radius:e,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:X.fromValues(0,0,1)},collisionPriority:1,metadata:{deleting:!1}});c=new T.Manipulator3D({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}});const g={manipulator:e,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:c,
elevationInfo:b,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(g,d.minSquaredEdgeLength);this._updateEdgeOffsetManipulator(g);d=[];for(var k of[a.leftVertex,a.rightVertex])a=this._getManipulatorInfoFromHandle(k),null!=a&&d.push(a.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(g)));g.locationUpdateHandle=H.handlesGroup(d);this._manipulatorHandles.add(g.locationUpdateHandle,e);this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!0),this._watchAndUpdateGrabState(c,
!0)],e);this._manipulatorHandles.add(B.createManipulatorDragEventPipeline(e,this._createEdgeOffsetPipeline(g,b)),e);this._manipulatorHandles.add(B.createManipulatorDragEventPipeline(c,(h,l,v,w)=>{if("touch"===w)this._createEdgeOffsetPipeline(g,b)(h,l,v);else if(this.enableMoveGraphic){w=this.graphic;const F=null!=w.geometry?w.geometry.spatialReference:null;l.next(m=>this._trackNumDragging(m)).next(B.dragAtLocation(this.view,h.elevationAlignedLocation)).next(R.screenToMapXYAtLocation(this.view,h.elevationAlignedLocation,
b,F,w)).next(B.addScreenDelta()).next(B.addMapDelta()).next(m=>this._perGraphicManipulatorDragAction(O.ALL,m)).next(m=>{this._updateTranslateGraphicTooltip(u.ManipulationType.XY,m);return m}).next(m=>{"end"===m.action&&this._hideTooltip()});v.next(()=>this._onDragCancel(!h.metadata.deleting))}}),e);k=h=>{this._manipulatorInfos.some(l=>l.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...h,graphic:this.graphic});h.stopPropagation()};this._manipulatorHandles.add([e.events.on("immediate-click",
k),c.events.on("immediate-click",k),e.events.on("focus-changed",({action:h})=>{const {sketchOptions:l,tooltip:v}=this;"focus"===h?(h=this._edgeOffsetTooltipInfo??(this._edgeOffsetTooltipInfo=new ia.ReshapeEdgeOffsetTooltipInfo({sketchOptions:l})),h.distance=G.zeroMeters,h.sketchOptions=l,this._updateTooltipAreaOrTotalLength(h),this._latestTooltipInfo=h,v.info=l.tooltips.effectiveEnabled?this._latestTooltipInfo:null):this._hideTooltip()})],e);this._manipulatorInfos.push(g);this.manipulators.add(e);
this.manipulators.add(c);this.emit("manipulators-changed");return g}_autoHideEdgeOffsetManipulator(a,b){const d=a.manipulator,c=a.edgeManipulator,e=()=>{a.visibilityHandle=x.removeMaybe(a.visibilityHandle);var f=this._getManipulatorInfoFromHandle(a.handle.leftVertex);const g=this._getManipulatorInfoFromHandle(a.handle.rightVertex);f=null!=f&&null!=g&&J.screenEdgeLengthSquared(f.manipulator.renderLocation,g.manipulator.renderLocation,this.view.state.camera)<b;if(!d.focused&&!c.focused||f)d.grabbable=
!f,c.grabbable=!f,a.visibilityHandle=H.handlesGroup([d.disableDisplay(),H.makeHandle(()=>{d.grabbable=!0;c.grabbable=this.enableMoveGraphic})])};this._manipulatorHandles.add([d.events.on("focus-changed",e),c.events.on("focus-changed",e),H.makeHandle(()=>{x.removeMaybe(a.visibilityHandle);c.metadata.deleting=!0;this.manipulators.remove(c)})],d);e()}_updateEdgeOffsetManipulator(a){this._updateManipulatorPosition(a);var {coordinateHelper:b}=this._editGeometryOperations.data;b=J.createEdgeOffsetIntersectionPlane(this.view,
a.manipulator.elevationAlignedLocation,J.createEdgeOffsetOperation(b,a.handle,a.manipulator.elevationInfo));var d=this._getManipulatorInfoFromHandle(a.handle.leftVertex),c=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=d&&null!=c&&(d=d.manipulator.renderLocation,c=c.manipulator.renderLocation,b=null!=b?J.edgeOffsetRotationMatrix(b,d,c):qa.IDENTITY,a.manipulator.modelTransform=b,a.edgeManipulator.elevationAlignedLocation=a.manipulator.elevationAlignedLocation,a.edgeManipulator.modelTransform=
b,b=I.length(I.subtract(S,d,c))/2,a.edgeManipulator.collisionType={type:"line",paths:[[[-b,0,0],[b,0,0]]]})}_createEdgeOffsetPipeline(a,b){return(d,c,e)=>{this._clearSelection();const {step:f,cleanup:g}=this._initializeEdgeOffset(a,b);c.next(k=>this._trackNumDragging(k)).next(B.dragAtLocation(this.view,d.elevationAlignedLocation)).next(f).next(R.screenToRenderPlaneFromEvent(this.view)).next(R.convertToMapCoordinates(this.view,this._editGeometryOperations.data.spatialReference)).next(B.addMapDelta()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(a)).next(this._showEdgeOffsetTooltip()).next(k=>
{"end"===k.action&&g()});e.next(()=>{d.metadata.deleting||(g(),this._onDragCancel())})}}_initializeEdgeOffset(a,b){var {view:d}=this;const c=this._editGeometryOperations,e=J.createEdgeOffsetOperation(c.data.coordinateHelper,a.handle,b);b=c.createUndoGroup();const f=J.createEdgeOffsetIntersectionPlane(d,a.manipulator.elevationAlignedLocation,e);if(e.requiresSplitEdgeLeft){var g=this._getManipulatorInfoFromHandle(a.handle.leftVertex.leftEdge);null!=g&&this._splitEdgeManipulator(g,1)}e.requiresSplitEdgeRight&&
(g=this._getManipulatorInfoFromHandle(a.handle.rightVertex.rightEdge),null!=g&&this._splitEdgeManipulator(g,0));const k=()=>new sa({paths:[[a.handle.leftVertex.pos,a.handle.rightVertex.pos]],spatialReference:c.data.spatialReference});g=this._settings;const h=new da.OutlineVisualElement({view:d,isDraped:this._graphicState.isDraped,geometry:k(),elevationInfo:a.elevationInfo,width:g.visualElements.lineGraphics.outline.width,attached:!1,isDecoration:!0});let l;const v=()=>{this._cleanEdgeOffsetCollapsedEdges(a);
l=x.removeMaybe(l)};d=this.on("undo",v);l=H.handlesGroup([A.watch(()=>C.unitRGBAFromColor(this._accentColor),w=>h.color=w,A.initial),H.destroyHandle(h),A.watch(()=>this._graphicState.isDraped,w=>h.isDraped=w),this._graphicState.on("changed",()=>h.geometry=k()),b,d]);h.attached=!0;return{step:w=>null==e||null==f?(v(),null):{...w,operation:e,plane:f},cleanup:v}}_applyEdgeOffsetStep(a){return b=>{if(this.destroyed||null==b.operation)return b;this._updateEventState(p.RESHAPING);const {mapDeltaX:d,mapDeltaY:c,
mapDeltaZ:e}=b;if(d||c||e)this._offsetEdge(a,b),this.emit("reshape",{type:"reshape",mover:this.graphic});return b}}_applyComputeEdgeOffsetDistanceStep(){return a=>{const {operation:b,mapEnd:d}=a;if(null==b||null==d)return a;"start"===a.action&&b.selectArrowFromStartPoint(d);return{...a,signedDistance:b.signedDistanceToPoint(d)}}}_showEdgeOffsetTooltip(){return a=>{const {mapEnd:b,signedDistance:d,operation:c}=a,{tooltip:e,sketchOptions:f}=this;if(null!=d){const l=this._edgeOffsetTooltipInfo??(this._edgeOffsetTooltipInfo=
new ia.ReshapeEdgeOffsetTooltipInfo({sketchOptions:f}));l.sketchOptions=f;if("end"===a.action)var g=G.zeroMeters;else a:{g=d*c.selectedArrow;var k=c.plane,h=this._editGeometryOperations.data.coordinateHelper;if(this._graphicState.isDraped){const v=h.toXYZ(h.pointToVector(b));k=ua.projectPoint(k,v,va.sv3d.get());h=Ha.geodesicDistance(k,v,h.spatialReference);if(null!=h){g=G.createLength(h.value*Math.sign(g),h.unit);break a}}g=G.createLength(g*oa.getMetersPerUnitForSR(b.spatialReference),"meters")}l.distance=
g;this._updateTooltipAreaOrTotalLength(l);this._latestTooltipInfo=l}else this._latestTooltipInfo=null;e.info=f.tooltips.effectiveEnabled?this._latestTooltipInfo:null;return a}}_cleanEdgeOffsetCollapsedEdges(a){var b=a.handle.leftVertex.leftEdge?.leftVertex,d=a.handle.leftVertex;const c=a.handle.rightVertex.rightEdge?.rightVertex,e=a.handle.rightVertex,f=this._editGeometryOperations.data.coordinateHelper;a=[];b&&1E-6>f.distance(b.pos,d.pos)&&(b=this._getManipulatorInfoFromHandle(d),null!=b&&a.push(b));
if(1E-6>f.distance(d.pos,e.pos)||c&&1E-6>f.distance(c.pos,e.pos))d=this._getManipulatorInfoFromHandle(e),null!=d&&a.push(d);a.length&&this._removeVertices(a)}_computeVertexManipulatorSizeAndOutline(a){const b=a.size/2,d=b+a.collisionPadding;return{size:b/d,outlineSize:(b+a.outlineSize)/d}}_createVertexOrEdgeManipulator(a,b=M.getGraphicEffectiveElevationInfo(this.graphic),d=!1){const {view:c}=this;var e=this._settings;if("edge"===a.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(a,
b);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const {size:h,outlineSize:l}=this._computeVertexManipulatorSizeAndOutline(e.manipulators.vertex);this._vertexManipulatorGeometry=K.createSphereGeometry(this._vertexManipulatorMaterial,h,16,16);this._vertexManipulatorOutlineGeometry=K.createSphereGeometry(this._vertexManipulatorOutlineMaterial,l,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const {size:h,
outlineSize:l}=this._computeVertexManipulatorSizeAndOutline(e.manipulators.edge);this._edgeManipulatorGeometry=K.createSphereGeometry(this._edgeManipulatorMaterial,h,16,16);this._edgeManipulatorOutlineGeometry=K.createSphereGeometry(this._edgeManipulatorOutlineMaterial,l,16,16)}({geometry:e}=this.graphic);e=e?.type;e="point"===e||"mesh"===e?[]:[new y.RenderObject(this._vertexManipulatorGeometry.instantiate(),E.Vertex|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate(),
E.Vertex|n.ManipulatorStateFlags.Unfocused|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),E.Vertex|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),n.ManipulatorStateFlags.Selected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),
n.ManipulatorStateFlags.Selected|n.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),n.ManipulatorStateFlags.Selected|n.ManipulatorStateFlags.Focused)];this.enableMidpoints&&e.push(new y.RenderObject(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),E.Edge|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),
E.Edge|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorGeometry.instantiate(),E.Edge|n.ManipulatorStateFlags.Unfocused|n.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate(),E.Edge|n.ManipulatorStateFlags.Unfocused|n.ManipulatorStateFlags.Unselected));const f=new T.Manipulator3D({view:c,renderObjects:e,elevationInfo:b,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||
!this.graphic.layer?.visible),metadata:{deleting:!1}});f.selected=d;this._setTypeSpecificManipulatorSettings(f,a,b);const g="edge"===a.type?{manipulator:f,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:f,handle:a,type:"vertex",selectedIndex:0};this._manipulatorInfos.push(g);this.manipulators.add(f);this._updateManipulatorPosition(g);if("edge"===g.type){a=[];for(var k of[g.handle.leftVertex,g.handle.rightVertex])d=this._getManipulatorInfoFromHandle(k),null!=d&&a.push(d.manipulator.events.on("location-update",
()=>this._updateManipulatorPosition(g)));g.locationUpdateHandle=H.handlesGroup(a);this._manipulatorHandles.add(g.locationUpdateHandle,f)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(f,!0),f);k=B.createManipulatorDragEventPipeline(f,(h,l,v,w)=>{let F=null;const {snappingStep:m,cancelSnapping:P}=ha.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new fa.SnappingContext({editGeometryOperations:this._editGeometryOperations,
elevationInfo:b,pointer:w,excludeFeature:this.graphic,visualizer:new aa.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});v=v.next(z=>{this._onDragCancel(!h.metadata.deleting,()=>F=x.removeMaybe(F));return z}).next(P);l.next(z=>this._trackNumDragging(z)).next(z=>{"start"===z.action&&(F=this._editGeometryOperations.createUndoGroup());if("edge"===g.type){const ja=this._splitEdgeManipulator(g);return{...z,info:ja,snapOrigin:ja.handle.pos}}return{...z,info:g,snapOrigin:g.handle.pos}}).next(B.dragAtLocation(this.view,
h.elevationAlignedLocation)).next(R.screenToMapXYForGraphicAtLocation(this.view,this.graphic,h.elevationAlignedLocation,h.location.spatialReference,this.graphic)).next(B.sceneSnappingAtLocation(this.view,b,this.graphic)).next(...m).next(B.addMapDelta()).next(z=>{this._perVertexManipulatorDragAction(z);"end"===z.action&&(F=x.removeMaybe(F));this._updateTranslateVertexTooltip(h,u.ManipulationType.XY,z)})});this._manipulatorHandles.add([k,f.events.on("immediate-click",h=>this._manipulatorClickCallback(h,
g)),f.events.on("select-changed",()=>{g.selectedIndex=++this._selectedIndex;this._updateMoveManipulationPosition()}),f.events.on("focus-changed",({action:h})=>{"focus"===h&&"edge"!==g.type?this._updateTranslateVertexTooltip(f,u.ManipulationType.XY):this._hideTooltip()})],f);this.emit("manipulators-changed");return g}_trackNumDragging(a){switch(a.action){case "start":this._numDragging++;break;case "end":this._numDragging--}return a}_onDragCancel(a=!0,b){this._numDragging--;a&&(this.undo(),this.outputGeometry=
null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null);null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping();this._hideTooltip();switch(this._reshapeEventState){case p.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}b&&b();this.destroyed||this._updateEventState(p.NONE)}_setTypeSpecificManipulatorSettings(a,b,d){const {graphic:c}=this,e=this._settings;
switch(b.type){case "vertex":a.state=E.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;const {size:f,collisionPadding:g}=e.manipulators.vertex;a.radius=f/2+g;a.elevationInfo=d;({geometry:b}=c);b=b?.type;a.interactive=null!=b&&"point"!==b&&"mesh"!==b;break;case "edge":a.state=E.Edge;a.selectable=!1;a.cursor="copy";a.collisionPriority=-1;const {size:k,collisionPadding:h}=e.manipulators.edge;a.radius=k/2+h;a.elevationInfo="on-the-ground"!==d.mode||Z.isVolumetricSymbol(c.symbol)?{mode:"absolute-height",
offset:0}:d}}_watchAndUpdateGrabState(a,b){return a.events.on("grab-changed",d=>this._onGrabStateChanged(a,b,d.action,d.pointerType))}_onGrabStateChanged(a,b,d,c="mouse"){if(!this._recreatingManipulators){if("start"===d)b&&this._updateSelection(a),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(p.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing;if("touch"!==c||this.enableEdgeOffset)this._manipulatorInfos.forEach(e=>{const {manipulator:f}=e;var {geometry:g}=
this.graphic;g=g?.type;f.interactive=f.grabbing||!this._numGrabbing&&null!=g&&"point"!==g&&"mesh"!==g;"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing})}}_clearSelection(){for(const a of this._manipulatorInfos)a.manipulator.grabbing||(a.manipulator.selected=!1)}_updateSelection(a){a.grabbing&&!a.selected&&a.selectable&&(this._clearSelection(),a.selected=
!0,this.emit("manipulators-changed"))}_removeManipulator(a){null!=a&&(a.manipulator.metadata.deleting=!0,this.manipulators.remove(a.manipulator),this._manipulatorHandles.remove(a.manipulator),la.removeUnordered(this._manipulatorInfos,a),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(a){if(a)for(const b of this._manipulatorInfos)if(a===b.handle)return b;return null}_updateManipulatorPosition(a){if(null!=a){var b=this._editGeometryOperations;if("vertex"===a.type)a.manipulator.location=
b.data.coordinateHelper.vectorToDehydratedPoint(a.handle.pos,Q),a.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=a.manipulator.renderLocation);else if("edge"===a.type){var d=this._getManipulatorInfoFromHandle(a.handle.leftVertex),c=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=d&&null!=c&&(d=d.manipulator,c=c.manipulator,null!=a.manipulator.elevationInfo&&"on-the-ground"===a.manipulator.elevationInfo.mode?
(d=d.location,c=c.location,a.manipulator.location=Y.makeDehydratedPoint(d.x+.5*(c.x-d.x),d.y+.5*(c.y-d.y),d.hasZ&&c.hasZ?0:void 0,b.data.spatialReference)):(I.lerp(S,d.renderLocation,c.renderLocation,.5),a.manipulator.renderLocation=S))}}}_splitEdgeManipulator(a,b=.5){var d=this._editGeometryOperations;b=d.splitEdge(a.handle,b).createdVertex;a.locationUpdateHandle=x.removeMaybe(a.locationUpdateHandle);var c=M.getGraphicEffectiveElevationInfo(this.graphic);let e;this.enableEdgeOffset?(this._removeManipulator(a),
e=this._createVertexOrEdgeManipulator(b)):(e=a,e.handle=b,e.type="vertex",this._setTypeSpecificManipulatorSettings(a.manipulator,a.handle,c));b.leftEdge&&this._createVertexOrEdgeManipulator(b.leftEdge);b.rightEdge&&this._createVertexOrEdgeManipulator(b.rightEdge);this.outputGeometry=d.data.geometry;this._updateManipulatorPosition(e);this.enableEdgeOffset||this._updateTranslateVertexTooltip(e.manipulator,u.ManipulationType.XY);this._updateSelection(a.manipulator);a=this._updateEventState(p.RESHAPING);
c=d.data.coordinateHelper.vectorToArray(e.handle.pos);d=d.data.components.indexOf(b.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:d,vertexIndex:b.index}],added:c});a&&this._updateEventState(p.NONE);return e}_updateMoveManipulationPosition(){const a=I.set(S,0,0,0);let b=0,d=!1;var c=null;let e=null;for(var f of this._manipulatorInfos)if("vertex"===f.type)if(f.manipulator.selected)if(b++,I.add(a,a,f.manipulator.renderLocation),null==c||f.selectedIndex>
c.selectedIndex)e=c,c=f;else{if(null==e||f.selectedIndex>e.selectedIndex)e=f}else d=!0;if(0===b)c=this._graphicState.displaying&&this.enableMoveGraphic,this._moveManipulation.xyManipulation.available=c,this._moveManipulation.xyAxisManipulation.available=c,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=c,this._moveManipulation.zManipulation.available=c&&this.enableZShape&&U.canMoveZ(this.graphic),this._moveManipulation.angle=xa.orientation(this.graphic.geometry),this._moveManipulation.radius=
u.MoveManipulation.radiusForSymbol(this.graphic.symbol);else{f=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=f;this._moveManipulation.xyAxisManipulation.available=f;this._moveManipulation.zManipulation.available=f&&this.enableZVertex&&U.canMoveZ(this.graphic);this._moveManipulation.xyAxisManipulation.orthogonalAvailable=f&&1!==b;f=0;if(null!=c){const g=c.handle.pos,k=null!=e?e.handle.pos:c.handle.leftEdge&&c.handle.leftEdge.leftVertex?c.handle.leftEdge.leftVertex.pos:
null;c=null==e&&c.handle.rightEdge&&c.handle.rightEdge.rightVertex?c.handle.rightEdge.rightVertex.pos:null;k&&c?this._moveManipulation.xyAxisManipulation.available=!1:k?f=Math.atan2(g[1]-k[1],g[0]-k[0])+Math.PI/2:c&&(f=Math.atan2(c[1]-g[1],c[0]-g[0])+Math.PI/2)}this._moveManipulation.angle=f;this._moveManipulation.radius=Aa.discRadiusSmall}0!==b&&d?(I.scale(a,a,1/b),Q.spatialReference=this._editGeometryOperations.data.spatialReference,Q.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,Q),this._moveManipulation.elevationAlignedLocation=
Q):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?D.placeAtGraphic(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(a){var b=[];const d=this._editGeometryOperations;for(var c of a)if(a=c.handle.component,"vertex"===c.type&&d.canRemoveVertex(a)){b.push(c.handle);this._removeManipulator(c);this._removeManipulator(this._getManipulatorInfoFromHandle(c.handle.leftEdge));
this._removeManipulator(this._getManipulatorInfoFromHandle(c.handle.rightEdge));const e=d.removeVertices([c.handle]).removedVertices?.[0].createdEdge;e?this._createVertexOrEdgeManipulator(e):this.enableEdgeOffset&&2>=a.vertices.length&&this._removeManipulator(this._getManipulatorInfoFromHandle(a.edges[0]))}if(0<b.length&&(b=b.map(e=>{const f=d.data.components.indexOf(e.component);return{coordinates:d.data.coordinateHelper.vectorToArray(e.pos),componentIndex:f,vertexIndex:e.index}}),this.outputGeometry=
d.data.geometry,c=this._updateEventState(p.RESHAPING),!this.destroyed&&(this.emit("vertex-remove",{type:"vertex-remove",removed:b.map(e=>e.coordinates),vertices:b}),!this.destroyed))){if(c&&(this._updateEventState(p.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(a,b,d="start"===b.action?V.AccumulationBehavior.NEW_STEP:V.AccumulationBehavior.ACCUMULATE_STEPS){const c=this._editGeometryOperations;c.moveVertices(a.map(e=>e.handle),b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ,
d);this.outputGeometry=c.data.geometry;for(const e of a)this._updateManipulatorPosition(e)}_offsetEdge(a,b){if(null!=b.operation&&null!=b.signedDistance){var d=this._editGeometryOperations,c=b.operation.clone();c.distance=b.signedDistance;d.updateVertices([a.handle.leftVertex,a.handle.rightVertex],c);this.outputGeometry=d.data.geometry;this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.leftVertex));this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.rightVertex))}}_manipulatorClickCallback(a,
b){a.shiftKey||this._clearSelection();"vertex"===b.type&&(b.manipulator.selected=!b.manipulator.selected,a.button===ea.MouseButton.Right&&this._removeVertices([b]));"edge"===b.type&&a.button===ea.MouseButton.Left&&this._splitEdgeManipulator(b);a.stopPropagation()}_updateTranslateTooltip(a,b){const d=this._manipulatorInfos.filter(c=>"vertex"===c.type&&c.manipulator.selected);1===d.length?this._updateTranslateVertexTooltip(d[0].manipulator,a,b):this._updateTranslateGraphicTooltip(a,b)}_updateTranslateGraphicTooltip(a,
b){const {sketchOptions:d,tooltip:c}=this;switch(a){case u.ManipulationType.XY:this._latestTooltipInfo=this._translateGraphicTooltipInfo??(this._translateGraphicTooltipInfo=new L.TranslateGraphicTooltipInfo({sketchOptions:d}));this._updateTranslateTooltipDistance(this._latestTooltipInfo,b,(e,f)=>N.autoDistanceBetweenPoints2D(e,f));break;case u.ManipulationType.XY_AXIS:this._latestTooltipInfo=this._translateGraphicXYTooltipInfo??(this._translateGraphicXYTooltipInfo=new L.TranslateGraphicXYTooltipInfo({sketchOptions:d}));
this._updateTranslateTooltipDistance(this._latestTooltipInfo,b,(e,f)=>G.scale(N.autoDistanceBetweenPoints2D(e,f),ca.axisConstrainedDragSign(b)));break;case u.ManipulationType.Z:this._latestTooltipInfo=this._translateGraphicZTooltipInfo??(this._translateGraphicZTooltipInfo=new L.TranslateGraphicZTooltipInfo({sketchOptions:d})),this._updateTranslateTooltipDistance(this._latestTooltipInfo,b,W.verticalSignedDistanceBetweenPoints)}this._latestTooltipInfo.sketchOptions=d;c.info=d.tooltips.effectiveEnabled?
this._latestTooltipInfo:null}_updateTranslateVertexTooltip(a,b,d){const {sketchOptions:c,tooltip:e}=this;switch(b){case u.ManipulationType.XY:this._latestTooltipInfo=this._translateVertexTooltipInfo??(this._translateVertexTooltipInfo=new L.TranslateVertexTooltipInfo({sketchOptions:c}));this._updateTranslateTooltipDistance(this._latestTooltipInfo,d,(f,g)=>N.autoDistanceBetweenPoints2D(f,g));this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case u.ManipulationType.XY_AXIS:this._latestTooltipInfo=
this._translateVertexXYTooltipInfo??(this._translateVertexXYTooltipInfo=new L.TranslateVertexXYTooltipInfo({sketchOptions:c}));this._updateTranslateTooltipDistance(this._latestTooltipInfo,d,(f,g)=>G.scale(N.autoDistanceBetweenPoints2D(f,g),ca.axisConstrainedDragSign(d)));this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case u.ManipulationType.Z:this._latestTooltipInfo=this._translateVertexZTooltipInfo??(this._translateVertexZTooltipInfo=new L.TranslateVertexZTooltipInfo({sketchOptions:c})),
this._updateTranslateTooltipDistance(this._latestTooltipInfo,d,W.verticalSignedDistanceBetweenPoints)}a=W.elevationOfPoint(a.elevationAlignedLocation);this._latestTooltipInfo.elevation=null!=a?Fa.makeElevationField({actual:a}):null;this._latestTooltipInfo.sketchOptions=c;e.info=c.tooltips.effectiveEnabled?this._latestTooltipInfo:null}_updateTranslateTooltipDistance(a,b,d){if(null!=b&&"end"!==b.action){const {mapStart:c,mapEnd:e}=b;b=d(c,e);a.distance=null!=b?b:G.zeroMeters}else a.distance=G.zeroMeters}_updateTooltipAreaOrTotalLength(a){const {geometry:b}=
this.graphic;null==b?(a.area=null,a.totalLength=null):(a.area="polygon"===b.type?Ga.autoArea2D(b):null,a.totalLength="polyline"===b.type?N.autoLength2D(b):null)}_hideTooltip(){this.tooltip.clear();this._latestTooltipInfo=null}get test(){return{segmentLabels:this._segmentLabels,manipulatorInfos:this._manipulatorInfos}}};r.__decorate([t.property()],q.ReshapeOperation.prototype,"_editGeometryOperations",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"_segmentLabels",void 0);r.__decorate([t.property({constructOnly:!0})],
q.ReshapeOperation.prototype,"tool",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"tooltip",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"inputGeometry",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"outputGeometry",void 0);r.__decorate([t.property({readOnly:!0})],q.ReshapeOperation.prototype,"updating",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"manipulators",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,
"view",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"graphic",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableZShape",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableZVertex",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableMoveGraphic",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableMidpoints",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableEdgeOffset",null);r.__decorate([t.property()],
q.ReshapeOperation.prototype,"sketchOptions",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"_accentColor",null);q.ReshapeOperation=r.__decorate([pa.subclass("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],q.ReshapeOperation);const Q=Y.makeDehydratedPoint(0,0,void 0,Ia.WGS84),S=X.create();var E;(function(a){a.Vertex=n.ManipulatorStateCustomFlags.Custom1;a.Edge=n.ManipulatorStateCustomFlags.Custom2})(E||={});var p;(function(a){a[a.NONE=0]="NONE";a[a.MOVING=
1]="MOVING";a[a.RESHAPING=2]="RESHAPING"})(p||={});var O;(function(a){a[a.ALL=0]="ALL";a[a.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"})(O||={});Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});