// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/handleUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/vectorStacks ../../../analysis/Slice/sliceToolUtils ../../Manipulator3D ../../manipulatorUtils ../ManipulatorType ../manipulatorUtils ../visualElementUtils ./ExtentMove ./ExtentRotate ./ExtentScale ./extentUtils ./PreserveAspectRatio ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../../../../interactive/InteractiveToolBase ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/editGeometry/support/editPlaneUtils ../../../../interactive/sketch/SketchOptions ../../../../interactive/tooltip/Tooltip".split(" "),
function(d,f,t,u,l,h,N,O,P,v,w,x,n,y,z,m,A,B,C,D,E,F,G,H,I,J,K,p,q,L){d.ExtentTransformTool=class extends t.EventedMixin(J.InteractiveToolBase){constructor(a){super(a);this.enableRotation=this.enableScaling=this.enableZ=!0;this.sketchOptions=new q;this._preserveAspectRatio=new G.PreserveAspectRatio;this.grabbing=!1;this._attachmentOrigin=this.inputState=null;this.type="transform-3d";this._outlineVisualElement=null}initialize(){const {view:a,graphic:e}=this,b=this._graphicState=new I.GraphicState({graphic:e});
var c=this._editGeometryOperations=K.EditGeometryOperations.fromGeometry(e.geometry,a.state.viewingMode);const k=this._bounds=new F.TransformBounds(this,()=>this._updateManipulators(),c.data);this._extentMove=new C.ExtentMove(this,b,c,k);this._extentScale=new E.ExtentScale(this,b,c,k,()=>this._preserveAspectRatio.createDragEventPipelineStep());this._extentRotate=new D.ExtentRotate(this,c,k);this.addHandles([l.watch(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,
m.ManipulatorType.TRANSLATE_Z)),l.watch(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(g=>this._updateManipulatorAvailability(g,m.ManipulatorType.SCALE))),l.watch(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,m.ManipulatorType.ROTATE))]);this._updateAllManipulatorAvailability();c=B.createVisualElements({view:a,graphic:e,forEachManipulator:g=>this._forEachManipulator(g),onManipulatorsChanged:()=>u.makeHandle()});if(null!=c){const {visualElement:g}=
c;g instanceof H.OutlineVisualElement&&(this._outlineVisualElement=g,this.addHandles(g.events.on("attachment-origin-changed",()=>this._bounds.updateDisplayBounds())));this.addHandles(c)}this.addHandles([b.on("changed",()=>this._onGeometryChanged()),l.watch(()=>b.displaying,()=>this._updateAllManipulatorAvailability()),l.watch(()=>b.isDraped,()=>this._graphicDrapedChanged(),l.initial),l.watch(()=>a.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>k.updateDisplayBounds()),a.trackGraphicState(b)]);
this._forEachManipulator(g=>{this.addHandles(g.events.on("grab-changed",()=>{this.grabbing=g.grabbing;this._updateAllManipulatorAvailability()}))});this._forEachManipulator((g,M)=>{this.addHandles(g.events.on("immediate-click",r=>{M===m.ManipulatorType.TRANSLATE_XY&&this.emit("immediate-click",{...r,graphic:e});r.stopPropagation()}))});this._initializeTooltip();this.finishToolCreation()}destroy(){this._extentMove.destroy();this._extentScale.destroy();this._extentRotate.destroy();this._editGeometryOperations.destroy();
this.tooltip.destroy();this._set("view",null);this._set("graphic",null)}_initializeTooltip(){const {view:a}=this,e=this.tooltip=new L.Tooltip({view:a}),b=()=>{e.info=this._getUpdatedTooltipInfo()};this.addHandles([l.watch(()=>this.sketchOptions.tooltips.effectiveEnabled,b),this.on("graphic-translate-start",b),this.on("graphic-translate",b),this.on("graphic-translate-stop",()=>{this.tooltip.clear()}),this.on("graphic-rotate-start",b),this.on("graphic-rotate",b),this.on("graphic-rotate-stop",b),this.on("graphic-scale-start",
b),this.on("graphic-scale",b),this.on("graphic-scale-stop",b)]);this._forEachManipulator(c=>{this.addHandles([c.events.on("focus-changed",b),c.events.on("grab-changed",b),c.events.on("drag",k=>{"cancel"===k.action?this.tooltip.clear():b()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles("draped-elevation-changes");
this._bounds.updateDisplayBounds();this._graphicState.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",a=>{null!=this._attachmentOrigin&&w.containsXY(a.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),"draped-elevation-changes")}_updateManipulators(){if(this.visible){var a=this._bounds.displayBounds,e=n.calculateBoundedPlaneTranslateRotate(a,x.sm4d.get());this._extentMove.updateManipulators(e,a);this._extentScale.updateManipulators(e,
a);this._extentRotate.updateManipulators(e,a)}}_updateAllManipulatorAvailability(){this._forEachManipulator((a,e)=>this._updateManipulatorAvailability(a,e))}_updateManipulatorAvailability(a,e){const b=this.grabbing&&!a.grabbing;a.interactive=!b;if(a instanceof y.Manipulator3D){const c=this._graphicState.displaying,k=this.enableZ&&A.canMoveZ(this.graphic);switch(e){case m.ManipulatorType.ROTATE:a.available=c&&this.enableRotation;break;case m.ManipulatorType.SCALE:a.available=c&&(this.enableScaling||
this.enableRotation||k);a.interactive=!b&&this.enableScaling;a.state=this.enableScaling?n.resizeNormal:n.resizeOutlineOnly;break;case m.ManipulatorType.TRANSLATE_Z:a.available=c&&k;break;default:a.available=c}}}_forEachManipulator(a){this._extentMove.forEachManipulator(a);this._extentScale.forEachManipulator(a);this._extentRotate.forEachManipulator(a)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(a){this._preserveAspectRatio.enabled=a;this._set("preserveAspectRatio",
a)}get attachmentOrigin(){const a=this.graphic.geometry;return this._attachmentOrigin=(this._graphicState.isDraped?null:this._outlineVisualElement?.attachmentOrigin)??z.getGraphicAttachmentOrigin(this.view,this.graphic)??a?.extent?.center}reset(){}cancel(){if(this.canUndo){const a=this._editGeometryOperations.undo();p.applyInverse(a,this._bounds.mapBounds);this.graphic.geometry=this._editGeometryOperations.data.geometry}this.inputState=null}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=
this.inputState)this.view.activeTool=null;else if(this.canUndo){const a=this._editGeometryOperations.undo();p.applyInverse(a,this._bounds.mapBounds);this.graphic.geometry=this._editGeometryOperations.data.geometry}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const a=this._editGeometryOperations.redo();p.apply(a,this._bounds.mapBounds);this.graphic.geometry=this._editGeometryOperations.data.geometry}}get test(){return{moveZManipulator:this._extentMove.moveZManipulator,
resizeManipulators:this._extentScale.resizeManipulators,rotateManipulator:this._extentRotate.rotateManipulator}}};f.__decorate([h.property({constructOnly:!0,nonNullable:!0})],d.ExtentTransformTool.prototype,"view",void 0);f.__decorate([h.property({constructOnly:!0,nonNullable:!0})],d.ExtentTransformTool.prototype,"graphic",void 0);f.__decorate([h.property()],d.ExtentTransformTool.prototype,"enableZ",void 0);f.__decorate([h.property()],d.ExtentTransformTool.prototype,"enableScaling",void 0);f.__decorate([h.property()],
d.ExtentTransformTool.prototype,"enableRotation",void 0);f.__decorate([h.property({constructOnly:!0,type:q})],d.ExtentTransformTool.prototype,"sketchOptions",void 0);f.__decorate([h.property()],d.ExtentTransformTool.prototype,"preserveAspectRatio",null);f.__decorate([h.property()],d.ExtentTransformTool.prototype,"grabbing",void 0);f.__decorate([h.property()],d.ExtentTransformTool.prototype,"inputState",void 0);f.__decorate([h.property({readOnly:!0})],d.ExtentTransformTool.prototype,"type",void 0);
f.__decorate([h.property()],d.ExtentTransformTool.prototype,"tooltip",void 0);d.ExtentTransformTool=f.__decorate([v.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ExtentTransformTool")],d.ExtentTransformTool);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});