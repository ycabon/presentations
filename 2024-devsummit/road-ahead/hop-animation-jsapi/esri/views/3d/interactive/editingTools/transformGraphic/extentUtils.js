// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/quantityUtils ../../../../../core/unitUtils ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../chunks/boundedPlane ../../../../../geometry/support/vectorStacks ../../../../../support/elevationInfoUtils ../geometryUtils ../../../layers/graphics/elevationAlignmentUtils ../../../layers/graphics/ElevationContext ../../../../interactive/editGeometry/support/editPlaneUtils ../../../../support/automaticLengthMeasurementUtils".split(" "),
function(q,r,t,u,c,l,k,v,w,x,y,z,p){function A(a,f,d,h=0,b){b||=l.create();f.toRenderCoords(a.origin,d,b.origin);var g=k.sv3d.get();c.add(g,a.origin,a.basis1);c.add(g,g,a.basis2);f.toRenderCoords(g,d,g);var e=k.sv3d.get();c.add(e,a.origin,a.basis1);c.subtract(e,e,a.basis2);f.toRenderCoords(e,d,e);const m=k.sv3d.get();c.subtract(m,a.origin,a.basis1);c.subtract(m,m,a.basis2);f.toRenderCoords(m,d,m);const n=k.sv3d.get();c.subtract(n,a.origin,a.basis1);c.add(n,n,a.basis2);f.toRenderCoords(n,d,n);a=c.lerp(k.sv3d.get(),
g,e,.5);c.subtract(a,a,b.origin);f=c.lerp(k.sv3d.get(),m,n,.5);c.subtract(f,b.origin,f);c.lerp(b.basis1,a,f,.5);g=c.lerp(k.sv3d.get(),n,g,.5);c.subtract(g,g,b.origin);e=c.lerp(k.sv3d.get(),e,m,.5);c.subtract(e,b.origin,e);c.lerp(b.basis2,g,e,.5);e=c.cross(k.sv3d.get(),b.basis1,b.basis2);e=c.cross(e,e,b.basis1);c.normalize(e,e);c.scale(b.basis2,e,c.dot(b.basis2,e));c.scale(b.basis1,b.basis1,1+h/c.length(b.basis1));c.scale(b.basis2,b.basis2,1+h/c.length(b.basis2));l.updateUnboundedPlane(b);return b}
class B{constructor(a,f,d){this._tool=a;this._onDisplayBoundsChanged=f;this.mapBounds=l.create();this.mapBoundsStart=l.create();this.displayBounds=l.create();this._calculateMapBounds(d)}get displayBoundsMargin(){const {view:a,graphic:f}=this._tool,d=a.pointsOfInterest?.centerOnSurfaceFrequent.location??f.geometry?.extent?.center;return d?10*a.pixelSizeAt(d):0}backupMapBounds(){l.copy(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds();this._onDisplayBoundsChanged()}_calculateMapBounds(a){const {view:f,
attachmentOrigin:d}=this._tool;var h=a.geometry;const b=w.mainAxis(h);u.scale(b,b,-1);var g=f.spatialReference;h=h.spatialReference;g=d?f.pixelSizeAt(d)*t.getMetersPerCartesianUnitForSR(g)/t.getMetersPerUnitForSR(h):0;z.calculateOrientedBounds(b,a,80*g,this.mapBounds)}_calculateDisplayBounds(){const {view:a,attachmentOrigin:f,graphic:d}=this._tool;if(d.geometry){var h=f?.z??x.evaluateElevationAlignmentAtPoint(this.mapBounds.origin,a.elevationProvider,y.ElevationContext.fromElevationInfo(v.getGraphicEffectiveElevationInfo(d)),
a.renderCoordsHelper),b=l.copy(this.mapBounds);b.origin[2]=h??0;A(b,a.renderCoordsHelper,d.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}}q.TransformBounds=B;q.mapPlaneAutoSize2D=function(a,f,d){const h=k.sv3d.get();c.subtract(h,c.subtract(h,a.origin,a.basis1),a.basis2);const b=k.sv3d.get();c.scaleAndAdd(b,h,a.basis1,2);const g=k.sv3d.get();c.scaleAndAdd(g,b,a.basis2,2);const e=k.sv3d.get();c.scaleAndAdd(e,h,a.basis2,2);h[2]=b[2]=g[2]=e[2]=f;a=r.max(p.autoDistance2D(h,b,
d),p.autoDistance2D(e,g,d));d=r.max(p.autoDistance2D(b,g,d),p.autoDistance2D(h,e,d));return null==d||null==a?null:[a,d]};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});