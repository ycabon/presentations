// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/Accessor ../../../../../../core/reactiveUtils ../../../../../../core/accessorSupport/decorators/property ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/RandomLCG ../../../../../../core/accessorSupport/decorators/subclass ../../../../../../layers/support/TileKey ../../../../layers/support/FeatureTileDescriptor3D ../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils".split(" "),
function(c,d,l,k,f,u,v,w,m,n,p,h){function q({lij:[a,b,g],extent:e}){return new n.TileKey(`${a}/${b}/${g}`,a,b,g,e)}c.FeatureServiceTiles3D=class extends l{get tiles(){const a=this.tilesCoveringView,b=this._effectivePointOfInterest;if(null!=b){const g=a.map(e=>h.distanceToTile(b,e));for(let e=1;e<g.length;e++)if(g[e-1]>g[e])return a.sort((r,t)=>h.distanceToTile(b,r)-h.distanceToTile(b,t)),a.slice()}return a}get tilesCoveringView(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(q)}get tileInfo(){return this.view.featureTiles?.tilingScheme?.toTileInfo()??
null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){const a=this.pointOfInterest;return null!=a?a:this.view.pointsOfInterest?.focus.location}constructor(a){super(a);this.pointOfInterest=null}initialize(){this.addHandles(k.watch(()=>this.view.featureTiles,a=>{this.removeHandles("feature-tiles");a&&this.addHandles(a.addClient(),"feature-tiles")},k.initial))}_filterTiles(a){return null==a?[]:a.filter(b=>{b=b.measures;return b.visibility===p.Visibility.VISIBLE_ON_SURFACE?
(b=b.screenRect,50<Math.abs(b[3]-b[1])):!1})}};d.__decorate([f.property({readOnly:!0})],c.FeatureServiceTiles3D.prototype,"tiles",null);d.__decorate([f.property({readOnly:!0})],c.FeatureServiceTiles3D.prototype,"tilesCoveringView",null);d.__decorate([f.property({readOnly:!0})],c.FeatureServiceTiles3D.prototype,"tileInfo",null);d.__decorate([f.property({readOnly:!0})],c.FeatureServiceTiles3D.prototype,"tileSize",null);d.__decorate([f.property({constructOnly:!0})],c.FeatureServiceTiles3D.prototype,
"view",void 0);d.__decorate([f.property()],c.FeatureServiceTiles3D.prototype,"pointOfInterest",void 0);d.__decorate([f.property()],c.FeatureServiceTiles3D.prototype,"_effectivePointOfInterest",null);c.FeatureServiceTiles3D=d.__decorate([m.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],c.FeatureServiceTiles3D);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});