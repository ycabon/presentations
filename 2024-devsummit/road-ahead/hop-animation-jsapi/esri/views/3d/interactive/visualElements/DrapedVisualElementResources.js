// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Identifiable ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../layers/interfaces ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/UpdatePolicy".split(" "),function(g,c,l,m,e,r,t,u,n,f,h,p){class q{constructor(a){this._resourceFactory=a;this._resources=null;this._visible=
!0;this._attached=!1;this._renderGroup=f.DrapedRenderGroup.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(a){a!==this._visible&&(this._visible=a,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(a){a!==this._attached&&(this._attached=a,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(a){this._renderGroup=
a;const d=this._resources?.layerView;d&&(d.renderGroup=a)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();
const a=this._resourceFactory.createResources(),d=new b({view:this._resourceFactory.view,renderGroup:this._renderGroup}),k=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new b({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:a,geometriesAdded:!1};k&&(this._resources.drapeSourceRenderer=k.registerGeometryDrapeSource(d));this._syncGeometriesToRenderer()}_destroyResources(){if(null!=this._resources){this._ensureRenderGeometriesRemoved();
var a=this._resourceFactory.view.basemapTerrain?.overlayManager;a&&a.unregisterDrapeSource(this._resources.layerView);this._resourceFactory.destroyResources(this._resources.external);this._resources=null}}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,
h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null==this._resources?.drapeSourceRenderer||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!0)}}let b=class extends m.IdentifiableMixin(l){constructor(a){super(a);this.drapeSourceType=f.DrapeSourceType.Features;this.updatePolicy=p.UpdatePolicy.SYNC;this.renderGroup=f.DrapedRenderGroup.Outline}};
c.__decorate([e.property({constructOnly:!0})],b.prototype,"view",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"drapeSourceType",void 0);c.__decorate([e.property()],b.prototype,"renderGroup",void 0);b=c.__decorate([n.subclass("DrapedVisualElementLayerView")],b);g.DrapedVisualElementResources=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});