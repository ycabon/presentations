// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/colorUtils ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/vectorStacks ./Object3DVisualElement ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),
function(k,l,u,v,w,x,y,m,n,p,f,z,A,B,C){class D extends z.Object3DVisualElement{constructor(a){super(a);this._arrowWidth=16;this._arrowSubdivisions=128;this._origin=m.create();this._originTransform=x.create();this._arrowCenter=m.create();this._renderOccluded=B.RenderOccludedFlag.OccludeAndTransparent;this._geometry=null;this._stripeLength=1;this._stripesEnabled=!0;this._color=p.create();this._contrastColor=p.create();this.applyProperties(a)}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==
this._renderOccluded&&(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:a}))}get geometry(){return this._geometry}set geometry(a){this._geometry=a;this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(a){this._stripeLength=a;this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(a){this._stripesEnabled=a;this.attached&&this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?
this._contrastColor:this._color})}get color(){return this._color}set color(a){l.colorVectorEquals(a,this._color)||(n.copy(this._color,a),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(a){l.colorVectorEquals(a,this._color)||(n.copy(this._contrastColor,a),this._updateArrowColor())}createExternalResources(){const a=this._color,b=this._contrastColor;this._arrowMaterial=new C.MeasurementArrowMaterial({outlineColor:a,stripeEvenColor:this._stripesEnabled?b:a,stripeOddColor:a,
renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration});this._handles=new u;this._handles.add(w.watch(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null;this._handles=v.destroyMaybe(this._handles)}forEachExternalMaterial(a){a(this._arrowMaterial)}createGeometries(a){if(null!=this._geometry?.startRenderSpace&&null!=this._geometry.endRenderSpace){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,
this._origin,this._geometry);b.transformation=this._originTransform;a.addGeometry(b);this._viewChanged()}}_createArrowGeometry(a,b,E,c){const q=this.view.renderCoordsHelper,r=[],t=[],h=(g,d)=>{const e=f.sv3d.get();y.subtract(e,g,E);r.push(e);t.push(d)};if("euclidean"===c.type)c.eval(.5,this._arrowCenter),c=f.sv3d.get(),q.worldUpAtPosition(this._arrowCenter,c),h(a,c),h(b,c);else for(c.eval(.5,this._arrowCenter),a=this._arrowSubdivisions+1&-2,b=0;b<a;++b){const g=b/(a-1),d=f.sv3d.get(),e=f.sv3d.get();
c.eval(g,d);q.worldUpAtPosition(d,e);h(d,e)}return A.createPolylineGeometry(this._arrowMaterial,r,t)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const a=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*a})}}_updateArrowColor(){if(this.attached){var a=this._color,b=this._contrastColor;this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?
b:a,outlineColor:a,stripeOddColor:a})}}}k.MeasurementArrowVisualElement=D;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});