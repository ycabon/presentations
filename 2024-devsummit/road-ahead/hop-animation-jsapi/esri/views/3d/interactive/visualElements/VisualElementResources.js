// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/reactiveUtils ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/WebGLLayer".split(" "),function(h,k,d,n,p,q){class r{constructor(a){this._resourceFactory=a;this._resources=null;this._visible=!0;this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:
null}get visible(){return this._visible}set visible(a){a!==this._visible&&(this._visible=a,this._syncVisible())}get attached(){return this._attached}set attached(a){a!==this._attached&&(this._attached=a,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(this._resourceFactory.recreateGeometry){var a=this._resourceFactory.view._stage;if(null!=this._resources&&a){var c=this._resources.object;this._resources.external.forEach(b=>{b.type!==d.ContentObjectType.Mesh&&
b.type!==d.ContentObjectType.Line&&b.type!==d.ContentObjectType.Point||a.remove(b)});c.removeAllGeometries();this._resourceFactory.recreateGeometry(this._resources.external,c,this._resources.layer);this._resources.external.forEach(b=>{b.type!==d.ContentObjectType.Mesh&&b.type!==d.ContentObjectType.Line&&b.type!==d.ContentObjectType.Point||a.add(b)})}}else this.recreate()}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();
var a=this._resourceFactory;const c=a.view,b=c._stage;if(b){var g=new q.WebGLLayer(b,{pickable:!1,updatePolicy:p.UpdatePolicy.SYNC}),f=new n.Object3D({castShadow:!1}),l=a.createResources(f,g);l.forEach(e=>{b.add(e);e.type===d.ContentObjectType.Texture&&e.load(b.renderView.renderingContext)});b.add(f);g.add(f);var m=a.cameraChanged;a=m?k.watch(()=>c.state.camera,e=>m(e),k.initial):null;this._resources={layer:g,object:f,external:l,cameraHandle:a};this._syncVisible()}}_destroyResources(){if(null!=this._resources){var a=
this._resourceFactory.view._stage;a&&(a.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach(c=>{a.remove(c);c.type===d.ContentObjectType.Texture&&c.unload()}));this._resources.object.dispose();this._resources.cameraHandle?.remove();this._resourceFactory.destroyResources(this._resources.external);this._resources=null}}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}h.VisualElementResources=r;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})});