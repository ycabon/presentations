// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Logger ../../../core/PooledArray ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../geometry/projection/projectVectorToVector ../../../libs/i3s/enums".split(" "),function(q,v,w,x,y,z,A,g){function u(b,c,l){a.clear();var d=Infinity;let m=Infinity,n=-Infinity,p=-Infinity,r=!1;for(const t of c){var e="clip"===t.type?g.ModificationType.Inside:"mask"===t.type?g.ModificationType.Outside:g.ModificationType.Replace;
const h=t.geometry;c=f=>f;if(h.spatialReference){if(!z.canProjectWithoutEngine(h.spatialReference,l)){v.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}c=f=>{A.projectVectorToVector(f,h.spatialReference,k,l);return k}}else h.hasZ||(k[2]=0,c=f=>{k[0]=f[0];k[1]=f[1];return k});r=r||e===g.ModificationType.Outside;a.push(e);a.push(h.rings.length);for(const f of h.rings){a.push(f.length);for(const B of f)e=
c(B),a.push(e[0]),a.push(e[1]),a.push(e[2]),d=Math.min(d,e[0]),m=Math.min(m,e[1]),n=Math.max(n,e[0]),p=Math.max(p,e[1])}}null!=b&&(r?(a.push(g.ModificationType.Inside),a.push(2),a.push(4),a.push(d-1E-4),a.push(m-1E-4),a.push(0),a.push(n+1E-4),a.push(m-1E-4),a.push(0),a.push(n+1E-4),a.push(p+1E-4),a.push(0),a.push(d-1E-4),a.push(p+1E-4),a.push(0)):(a.push(g.ModificationType.Outside),a.push(1)),a.push(4),a.push(b[0]),a.push(b[1]),a.push(0),a.push(b[2]),a.push(b[1]),a.push(0),a.push(b[2]),a.push(b[3]),
a.push(0),a.push(b[0]),a.push(b[3]),a.push(0));a.push(g.ModificationType.Finished);b=new Float64Array(a.length);for(d=0;d<a.length;++d)b[d]=a.at(d);return b}class C extends y.WorkerHandle{constructor(b){super("SceneLayerWorker","process",{process:c=>[c.geometryBuffer],project:c=>[c.positions.buffer],transformNormals:c=>[c.normals.buffer]},b,{hasInitialize:!0})}setModifications(b,c,l,d){b={context:b,modifications:u(c,l,d),isGeodetic:d.isGeographic};this.broadcast(b,"setModifications")}setLegacySchema(b,
c){c=JSON.stringify(c);return this.broadcast({context:b,jsonSchema:c},"setLegacySchema")}destroyContext(b){return this.broadcast(b,"destroyContext")}project(b,c){return this.invokeMethod("project",b,c)}transformNormals(b,c){return this.invokeMethod("transformNormals",b,c)}}const a=new w({deallocator:null}),k=x.create();q.I3SMeshWorkerHandle=C;q.toWasmModification=u;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});