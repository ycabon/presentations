// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(e,f,g,h){class k{constructor(a){this._graphicsCore=a;this._idToState=new Map;this._states=new Set;const b=a.owner.layer?.objectIdField;b?(this._getGraphicId=c=>h.getObjectId(c,b),this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicByObjectId(c)):(this._getGraphicId=c=>c.uid,this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicById(c))}destroy(){this._idToState.clear();
this._states.forEach((a,b)=>this.remove(b))}add(a){const b=g.makeHandle(()=>this.remove(a));if(this._states.has(a))return b;const c=this._getGraphicId(a.graphic),d=this._getGraphics3DGraphicById(c);this._states.has(a)||this._states.add(a);this._ensureStateList(c).push(a);a.displaying=null!=d?d.isVisible():!1;a.isDraped=null!=d?d.isDraped:!1;a.tracking=!0;null!=d&&a.emit("changed");return b}remove(a){if(this._states.has(a)){if(this._idToState.size){const b=this._getGraphicId(a.graphic),c=this._idToState.get(b);
c&&(f.remove(c,a),0===c.length&&this._idToState.delete(b))}this._states.delete(a);a.tracking=!1;a.displaying=!1}}addGraphic(a){this._forEachState(a,b=>{b.displaying=a.isVisible();b.isDraped=a.isDraped;b.emit("changed")})}removeGraphic(a){this._forEachState(a,b=>{b.displaying=!1;b.isDraped=!1})}updateGraphicGeometry(a){this._forEachState(a,b=>b.emit("changed"))}updateGraphicVisibility(a){this._forEachState(a,b=>b.displaying=a.isVisible())}allGraphicsDeleted(){this._states.forEach(a=>a.displaying=!1)}_ensureStateList(a){var b=
this._idToState.get(a);if(b)return b;b=[];this._idToState.set(a,b);return b}_forEachState(a,b){0!==this._states.size&&0!==this._idToState.size&&(a=this._getGraphicId(a.graphic),a=this._idToState.get(a),null!=a&&a.forEach(b))}}e.GraphicStateTracking=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});