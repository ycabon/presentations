// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable".split(" "),function(n,q,r,l,t,u,v,w,x,m,h){class y extends h.Loadable{set symbol(a){this._symbol=a;a.symbolLayers.forEach((c,b)=>{b=this.symbolLayers[b];null!=b&&(b.symbol=a,b.symbolLayer=c)})}get symbol(){return this._symbol}constructor(a,
c,b){super(c.schedule);this._symbol=a;this._context=c;this._backgroundLayers=b;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(a){let c=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(c=this._backgroundLayers.concat(c));const b=c.length;for(;this.symbolLayers.length<c.length;)this.symbolLayers.push(null);this.symbolLayers.length=c.length;const d=[];for(let e=0;e<b;e++){var f=c.at(e);if(!1===f.enabled)continue;k.renderPriority=1-(1+
e)/b;k.renderPriorityStep=1/b;k.ignoreDrivers=f.ignoreDrivers;const g=x.make(this.symbol,f,this._context,k);(f=l.onAbortOrThrow(a,()=>{this.symbolLayers[e]=null;g.destroy()}))&&d.push(f);this.symbolLayers[e]=g}await r.forEach(this.symbolLayers,async(e,g)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[g]=null}});d.forEach(e=>e.remove());l.throwIfAborted(a);if(this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw Error();
}getSymbolLayerSize(a){a=this.symbolLayers[a];return null!=a?a.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(a=>a?.queryForSnapping)}createGraphics3DGraphic(a,c){const b=a.graphic,d=this.symbolLayers.map(f=>f?.createGraphics3DGraphic(a)??null);return new u.Graphics3DGraphic(b,c||this,d,a.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return t.totalSymbolComplexities(this.symbolLayers.map(a=>
null!=a?a.complexity:null))}globalPropertyChanged(a,c){const b=this.symbolLayers.length;for(let d=0;d<b;d++){const f=this.symbolLayers[d],e=g=>{g=g.layers[d];return g instanceof v.Graphics3DObject3DGraphicLayer?g:null};if(null!=f&&!f.globalPropertyChanged(a,c,e))return!1}return!0}applyRendererDiff(a,c){return this.loadStatus!==h.LoadStatus.LOADED?m.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((b,d)=>b!==m.ApplyRendererDiffResult.RecreateSymbol&&null!=d?Math.min(b,d.applyRendererDiff(a,
c)):b,m.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(a){if(this.loadStatus!==h.LoadStatus.FAILED&&"partial"===a.diff.type){var c=a.diff.diff;if(c.symbolLayers&&"partial"===c.symbolLayers.type){var b=c.symbolLayers.diff;this.symbolLayers.forEach((d,f)=>{if(null!=d){var e=b[f];if(e){const g={diff:e,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};d.prepareSymbolLayerPatch(g);a.symbolStatePatches.push(...g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push((z,
A)=>{const p=z.layers[f];null!=p&&g.graphics3DGraphicPatches.forEach(B=>B(p,A))})}}})}}}updateGeometry(a,c){return this._updateGeometryOrTransform(a,(b,d)=>b.updateGeometry(d,c))}updateTransform(a,c,b,d){return this._updateGeometryOrTransform(a,(f,e)=>f.updateTransform(e,c,b,d))}_updateGeometryOrTransform(a,c){for(let b=0;b<this.symbolLayers.length;b++){const d=this.symbolLayers[b];if(null==d)continue;const f=a.layers[b];if(!f||!c(d,f))return!1}return!0}onRemoveGraphic(a){for(let c=0;c<this.symbolLayers.length;c++){const b=
this.symbolLayers[c];if(null==b)continue;const d=a.layers[c];if(null!=d)b.onRemoveGraphic(d)}}getFastUpdateStatus(){let a=0,c=0,b=0;this.symbolLayers.forEach(d=>{null!=d&&(d.loadStatus===h.LoadStatus.LOADING?a++:d.isFastUpdatesEnabled()?b++:c++)});return{loading:a,slow:c,fast:b}}async queryForSnapping(a,c,b,d){var f=this.symbolLayers.filter(q.isSome).filter(e=>null!=e.queryForSnapping).map(e=>e.queryForSnapping(a,c,b,d));f=await Promise.all(f);l.throwIfAborted(d);return f.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{super.destroy();for(const a of this.symbolLayers)null!=a&&a.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}const k=new w.Graphics3DSymbolLayerCreationContext;n.Graphics3DSymbol=y;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});