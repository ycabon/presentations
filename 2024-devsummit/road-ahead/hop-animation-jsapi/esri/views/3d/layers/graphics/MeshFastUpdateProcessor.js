// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../webgl-engine/materials/DefaultMaterial"],function(h,k){class l{constructor(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}enable(a,b,f){a.enableFastTransformUpdates(d=>{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(d))return d;var e=b.byMaterial(d);this._fastTransformOriginalMaterials.set(d,e);b.delete(d);return d}e=new k.DefaultMaterial(d.parameters);f.stage.add(e);this._fastTransformClonedMaterials.set(e,
d);return e},f.localOriginFactory)}disable(a,b,f){const d=new Set,e=new Set;a.disableFastTransformUpdates(c=>{if(!this._fastTransformClonedMaterials.has(c)){var g=this._fastTransformOriginalMaterials.get(c);if(b.has(g.uid))return d.add(c),b.byUid(g.uid).material;e.add(c);return g.material}g=this._fastTransformClonedMaterials.get(c);this._fastTransformClonedMaterials.delete(c);f.stage.remove(c);return g});for(const c of d)this._fastTransformOriginalMaterials.delete(c),f.stage.remove(c);for(const c of e)a=
this._fastTransformOriginalMaterials.get(c),this._fastTransformOriginalMaterials.delete(c),b.set(a.uid,a)}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(a,b,f){this._graphicReferenceCount--;this.disable(a,b,f)}forEachMaterialInfo(a){this._fastTransformOriginalMaterials.forEach(a)}forEachClonedMaterial(a){this._fastTransformClonedMaterials.forEach(a)}destroy(a){a.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));a.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),
({material:b})=>b));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()}}class m{constructor(){this._byUid=new Map;this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),a=>a.material)}byUid(a){return this._byUid.get(a)}byMaterial(a){return this._byMaterial.get(a)}set(a,b){this._byUid.set(a,b);this._byMaterial.set(b.material,b)}delete(a){const b=this._byMaterial.get(a)?.uid;b&&(this._byUid.delete(b),this._byMaterial.delete(a))}has(a){return this._byUid.has(a)}forEachMaterialInfo(a){this._byUid.forEach(a)}clear(){this._byUid.clear();
this._byMaterial.clear()}}h.MaterialInfoCache=m;h.MeshFastUpdateProcessor=l;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});