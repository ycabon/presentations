// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/textureUtils ../../webgl-engine/materials/pbrUtils".split(" "),function(m,k,n,r,t,g,p,q,l){async function h(a,e,d,c){if(null==a)return-1;const f=d.length;var b=a.data;a=a.url;if(null!=b){if(b instanceof HTMLImageElement||b instanceof HTMLCanvasElement)return b=q.downsampleImage(b),d.push({id:f,usage:c,data:b,
encoding:g.TextureEncoding.PNG,downsampled:!1}),e.push({id:f,usage:c,encodings:[{name:void 0,encoding:g.TextureEncoding.PNG}]}),f;if(!(b instanceof HTMLVideoElement)){if(b instanceof ImageData)throw new n("ImageData textures not supported yet for client side I3S nodes");if(b instanceof t.EncodedMeshTexture)throw new n("EncodedMeshTexture textures not supported yet for client side I3S nodes");}}else if(null!=a)return b=new Image,b.src=a,b=await r.loadImageAsync(b,b.src,!1,void 0),b=q.downsampleImage(b),
d.push({id:f,usage:c,data:b,encoding:g.TextureEncoding.PNG,downsampled:!1}),e.push({id:f,usage:c,encodings:[{name:void 0,encoding:g.TextureEncoding.PNG}]}),f;return-1}m.convertMeshMaterialToPBRMaterial=async function(a){const e=[],d=[];if(null==a)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,
metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:e,textureData:d};const c=a.hasOwnProperty("metallicRoughnessTexture");"auto"===a.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const f=l.useSchematicPBR({normalTexture:a.normalTexture,emissiveTexture:c?a.emissiveTexture:null,emissiveFactor:c?k.toUnitRGB(a.emissiveColor):null,occlusionTexture:c?a.occlusionTexture:null,metallicRoughnessTexture:c?
a.metallicRoughnessTexture:null,metallicFactor:c?a.metallic:null,roughnessFactor:c?a.roughness:null}),b=f?l.defaultSchematicMRRFactors[0]:c?a.metallic:0,u=f?l.defaultSchematicMRRFactors[1]:c?a.roughness:0;return{material:{alphaMode:"auto"===a.alphaMode?"blend":a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,cullFace:a.doubleSided?p.CullFaceOptions.None:p.CullFaceOptions.Back,normalTextureId:await h(a.normalTexture,e,d,g.TextureUsage.Normal),emissiveTextureId:c?await h(a.emissiveTexture,
e,d,g.TextureUsage.Emissive):-1,occlusionTextureId:c?await h(a.occlusionTexture,e,d,g.TextureUsage.Occlusion):-1,emissiveFactor:c&&null!=a.emissiveColor?k.toUnitRGB(a.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=a.color?k.toUnitRGBA(a.color):[1,1,1,1],baseColorTextureId:await h(a.colorTexture,e,d,g.TextureUsage.Color),metallicRoughnessTextureId:c?await h(a.metallicRoughnessTexture,e,d,g.TextureUsage.MetallicRoughness):-1,metallicFactor:b,roughnessFactor:u},wrapTextures:!0,hasParametersFromSource:f},
requiredTextures:e,textureData:d}};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});