// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(c,d,k,h,l,e,w,x,y,m,n,p,q,r,t,u){const v=q.QueryEngine;c.I3SQueryEngine=class extends k{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return(new u({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(a){super(a)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=
l.destroyMaybe(this._dataQueryEngineInstance);this._set("layerView",null)}async executeQueryForCount(a,b){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)}async executeQueryForExtent(a,b){const {count:f,extent:g}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b);a=n.fromJSON(g);return{count:f,extent:a}}async executeQueryForIds(a,b){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)}async executeQuery(a,b){a=this._ensureQueryJSON(a);
if(a.returnGeometry)throw new h("unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(a.returnCentroid)throw new h("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");b=await this._dataQueryEngine.executeQuery(a,b);b=t.fromJSON(b);b.features.forEach(f=>{f.geometry=null});return b}_ensureQueryJSON(a){return null==a?this.defaultQueryJSON:a.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const a=this.layer.objectIdField||p.fallbackObjectIDAttribute,b=this.layer.fieldsIndex?.toJSON()||new r([]),f=this.layerView.view.resourceController.scheduler,g=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new v({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:b,timeInfo:null,spatialReference:g,objectIdField:a,featureStore:this.spatialIndex,scheduler:f,priority:this.priority})}};d.__decorate([e.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"layerView",
void 0);d.__decorate([e.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"priority",void 0);d.__decorate([e.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"spatialIndex",void 0);d.__decorate([e.property()],c.I3SQueryEngine.prototype,"spatialReference",null);d.__decorate([e.property()],c.I3SQueryEngine.prototype,"layer",null);d.__decorate([e.property()],c.I3SQueryEngine.prototype,"defaultQueryJSON",null);c.I3SQueryEngine=d.__decorate([m.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
c.I3SQueryEngine);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});