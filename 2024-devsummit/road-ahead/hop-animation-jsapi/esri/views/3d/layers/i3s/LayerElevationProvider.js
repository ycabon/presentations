// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../support/ElevationRange ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(f,g,v,w,x,k,J,K,y,z,A,r,m,B,n,C,t,D,E,F){f.LayerElevationProvider=class extends w.EventedMixin(v){constructor(a){super(a);this._tmpEvent=new D.ElevationUpdateEvent;this._renderCoordsHelper=a.view.renderCoordsHelper;this._renderSR=this._renderCoordsHelper.spatialReference;this._layerElevationSource=a.layerElevationSource}initialize(){this._intersector=E.newIntersector(this.view.state.viewingMode);this._intersector.options.store=F.StoreResults.MIN;this._tmpEvent.context=this.intersectionHandler.isGround?
"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(a,c,d,b){const l=this._renderCoordsHelper;a=r.set(e,a,c,d);if(!l.toRenderCoords(a,b,a))return x.getLogger(this).error("could not project point to compute elevation"),null;const {layerElevationSource:p,_intersector:q,intersectionHandler:G}=this;b=p.fullExtent;c=null!=b&&Number.isFinite(b.xmin)&&Number.isFinite(b.xmax)&&Number.isFinite(b.ymin)&&Number.isFinite(b.ymax)&&Number.isFinite(b.zmin)&&
Number.isFinite(b.zmax)?new t.ElevationRange(b.zmin,b.zmax):p.elevationRange;if(null==c)return null;d=p.elevationOffset;b=c.elevationRangeMin+d;c=l.setAltitude(H,c.elevationRangeMax+d,a);b=l.setAltitude(I,b,a);q.reset(c,b,null);G.intersect(q,null,c,b,null,!0);return q.results.min.getIntersectionPoint(a)?l.getAltitude(a):null}getSphereElevationBounds(a,c){B.projectBoundingSphere(a,c,u,this._renderSR);return this._layerElevationSource.getElevationRange(u)}getRootElevationBounds(){const a=this.layerElevationSource.fullExtent;
return a?.hasZ?new t.ElevationRange(a.zmin,a.zmax):null}objectsChanged(a){this.spatialReference&&(this._computeLayerExtent(a,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(a){this.spatialReference&&(this._computeObjectExtent(a,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(a,c){n.empty(c);this._expandExtent(a,c)}_computeLayerExtent(a,
c){n.empty(c);for(const d of a)this._expandExtent(d,c)}_expandExtent(a,c){const d=this.spatialReference;if(null!=d&&null!=a){z.fromQuat(h,a.quaternion);h[12]=a.center[0];h[13]=a.center[1];h[14]=a.center[2];a=a.halfSize;for(let b=0;8>b;++b)e[0]=b&1?a[0]:-a[0],e[1]=b&2?a[1]:-a[1],e[2]=b&4?a[2]:-a[2],r.transformMat4(e,e,h),this._renderCoordsHelper.fromRenderCoords(e,e,d),n.expand(c,e,c)}}};g.__decorate([k.property({constructOnly:!0})],f.LayerElevationProvider.prototype,"layerElevationSource",void 0);
g.__decorate([k.property({constructOnly:!0})],f.LayerElevationProvider.prototype,"intersectionHandler",void 0);g.__decorate([k.property({constructOnly:!0})],f.LayerElevationProvider.prototype,"view",void 0);g.__decorate([k.property()],f.LayerElevationProvider.prototype,"spatialReference",null);f.LayerElevationProvider=g.__decorate([y.subclass("esri.views.3d.layers.i3s.LayerElevationProvider")],f.LayerElevationProvider);const h=A.create(),u=C.fromValues(0,0,0,0),e=m.create(),H=m.create(),I=m.create();
Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});