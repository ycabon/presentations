// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../geometry/spatialReferenceEllipsoidUtils","../../../../geometry/support/aaBoundingBox"],function(r,u,q){class v{constructor(a,b,c){this._pages=[];this.pageSize=0;this._nodeSR=a;this._renderSR=b;this._renderSRSphericalPCPF=u.getSphericalPCPF(b);this.pageSize=c}addPage(a,b,c=0){for(;this._pages.length<a;)this._pages.push(null);var e=this._nodeSR,f=this._renderSR,k=this._renderSRSphericalPCPF;for(var d=0;d<b.length;d++){const g=b[d];g.obb.transform(g.obbInRenderSR,e,f,c,
k)}this._pages[a]={nodes:b,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(c=[0];c.length;)for(e=c.pop(),f=a[e/b|0].nodes[e%b],k=0;k<f.childCount;k++)d=f.firstChild+k,null!=a[d/b|0]&&(a[d/b|0].parents[d%b]=e,c.push(d))}hasPage(a){return!!this._pages[a]}getNode(a){const b=this.pageSize;return this._pages[a/b|0].nodes[a%b]}getRenderObb(a){const b=this.pageSize;return this._pages[a/b|0].nodes[a%b].obbInRenderSR}setRenderObb(a,b){const c=this.pageSize;this._pages[a/c|0].nodes[a%
c].obbInRenderSR.copy(b)}getParentId(a){const b=this.pageSize;return this._pages[a/b|0].parents[a%b]}hasNodes(a,b){var c=a/this.pageSize|0;for(a=(a+b-1)/this.pageSize|0;c<=a;c++)if(null==this._pages[c])return!1;return!0}forEachNodeId(a){for(let b=0;b<this._pages.length;b++){const c=this._pages[b];if(c)for(let e=0;e<c.nodes.length;e++)a(b*this.pageSize+e)}}createVisibilityTraverse(){var a=this,b=[],c=[],e=q.create();return(f,k)=>{if(a.hasNodes(0,1))for(b.length=0,b.push(0),c.length=0,c.push(0);0<b.length;){var d=
b.pop();let p=c.pop();var g=a.getNode(d),n=a.getRenderObb(d),l=!0;if(null!=f.clippingBox){var h=1<<f.frustum.length;0===(p&h)&&(n.toAaBoundingBox(e),q.contains(f.clippingBox,e)?p|=h:q.intersects(f.clippingBox,e)||(l=!1))}for(h=0;h<f.frustum.length&&l;h++){var m=1<<h;if(0===(p&m)){const t=n.intersectPlane(f.frustum[h]);0<t?l=!1:0>t&&(p|=m)}}if(k.predicate(d,g,l)){n=g.firstChild;g=g.childCount;l=!1;m=n/a.pageSize|0;for(h=(n+g-1)/a.pageSize|0;m<=h;m++)if(!a.hasPage(m)){k.pageMiss(d,m);l=!0;break}if(!l)for(d=
0;d<g;d++)b.push(n+d),c.push(p)}}}}}r.PagedNodeIndex=v;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});