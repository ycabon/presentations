// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(n,r,p,u,v,w,t,q,h){n.PopupSceneLayerView=f=>{f=class extends f{_validateFetchPopupFeatures(b){const {layer:c}=this,{popupEnabled:k}=c;if(!k)throw new p("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:c});
if(!h.getFetchPopupTemplate(c,b))throw new p("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:c});}async prepareFetchPopupFeatures(b){}async fetchPopupFeaturesFromGraphics(b,c){this._validateFetchPopupFeatures(c);if(0===b.length)return[];const k="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;var d=[];"fieldsIndex"in this.layer&&(d=q.unpackFieldNames(this.layer.fieldsIndex,await h.getRequiredFields(k,h.getFetchPopupTemplate(this.layer,
c))));await this.prepareFetchPopupFeatures(d);c=new Set;const l=[],g=[];for(const a of b)q.populateMissingFields(d,a,c)?g.push(a):l.push(a);if(0===g.length)return l;const m=new Map;for(d=0;d<b.length;d++)m.set(b[d].getObjectId()??0,d);b=await this.whenGraphicAttributes(g,[...c]).catch(()=>g).then(a=>l.concat(a));b.sort((a,e)=>{a=a.getObjectId()??0;a=m.get(a)??0;e=e.getObjectId()??0;e=m.get(e)??0;return a-e});return b}};return f=r.__decorate([t.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],
f)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});