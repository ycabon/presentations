// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),function(r,d,l,w,t,x,e,A,B,C,m,u,v,y){let f=class extends l{constructor(a){super(a)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;
const a=new Set(this.layerView.requiredFields),b=new Set(this.layerView.availableFields);return x.difference(b,a)}get queryFeaturesDehydrated(){const {layer:a}=this;var b=a.capabilities;b=b&&b.query;const c=a.parsedUrl;if(b&&b.supportsFormatPBF){null==this._decoder&&(this._decoder=new y.PBFDecoder(this.controller));const p={sourceSpatialReference:a.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024};return(q,g)=>v.runQuery(c,
q,"pbf",this._createRequestOptions(g)).then(z=>{t.throwIfAborted(g);return null!=this._decoder?this._decoder.invoke({buffer:z.data,options:p},g.signal):Promise.reject(t.createAbortError())})}return(p,q)=>v.executeQuery(c,p,a.spatialReference,this._createRequestOptions(q)).then(g=>u.fromFeatureSetJSON(g.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024}))}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,b)}destroy(){this._decoder=w.destroyMaybe(this._decoder)}_createRequestOptions(a){return{...a,
query:{...this.layer.customParameters,token:this.layer.apiKey,...a?.query}}}};d.__decorate([e.property({constructOnly:!0})],f.prototype,"layer",void 0);d.__decorate([e.property({constructOnly:!0})],f.prototype,"layerView",void 0);d.__decorate([e.property({constructOnly:!0})],f.prototype,"controller",void 0);d.__decorate([e.property({readOnly:!0})],f.prototype,"implicitFields",null);d.__decorate([e.property({readOnly:!0})],f.prototype,"queryFeaturesDehydrated",null);f=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],
f);let h=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,b){return this.layer.queryFeatures(a,b)}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,b)}};d.__decorate([e.property({constructOnly:!0})],h.prototype,"layer",void 0);d.__decorate([e.property({readOnly:!0})],h.prototype,"queryFeaturesDehydrated",null);h=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],h);let n=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,
b){return this.layer.queryFeatures(a,b)}};d.__decorate([e.property({constructOnly:!0})],n.prototype,"layer",void 0);n=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],n);let k=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,b){return this.source.queryFeaturesJSON(a,b).then(u.fromFeatureSetJSON,c=>{if(c&&"query-features-json:unsupported"===c.name)return this.layer.queryFeatures(a,b);throw c;})}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,
b)}};d.__decorate([e.property({constructOnly:!0})],k.prototype,"layer",void 0);d.__decorate([e.property({constructOnly:!0})],k.prototype,"source",void 0);k=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],k);r.createFeatureTileQuery3D=function(a,b){const {layer:c}=a;return"feature"===c.type&&"feature-layer"===c.source.type?null!=c.infoFor3D?new h({layer:c}):new f({layer:c,layerView:a,controller:b}):"feature"===c.type&&"memory"===c.source.type||
"csv"===c.type||"geojson"===c.type||"oriented-imagery"===c.type||"wfs"===c.type?new k({layer:c,source:c.source}):"ogc-feature"===c.type?new n({layer:c}):null};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});