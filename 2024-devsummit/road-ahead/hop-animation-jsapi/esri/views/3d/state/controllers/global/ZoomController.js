// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(h,u,v,w,F,G,H,I,x,l,m,c,g,y,n,p,q,z,A,B,C,D,d,E){h.ZoomController=class extends D.InteractiveController{constructor(){super(...arguments);this._pickPoint=g.create();this._tmpP0=m.create();this._panAxisAngle=n.create();this._tmpRayDir=g.create();this._tmpRayDirPick=g.create();this._targetOnSphere=g.create();this._navMode=d.NavigationMode.Horizontal;this._tmpRay={origin:g.create(),direction:g.create()};this.dragBeginPoint=w.createScreenPointArray();this._normalizedAnchorPoint=m.create();this._constraintOptions=
new z.ConstraintOptions(A.ConstraintTypes.ALL_EXCEPT_COLLISION,B.InteractionType.ZOOM,0,this.startCamera);this._sphere=p.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(b){if(this.active){l.copy(this.dragBeginPoint,b);d.normalizeCoordinate(this.startCamera,b,this._normalizedAnchorPoint);var a=y.getReferenceEllipsoid(this.view.spatialReference),f=d.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,b,a,d.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?d.contentIntersectorOptions:{});this._navMode=d.decideNavigationMode(this.startCamera,b,a);if(this._navMode===d.NavigationMode.Horizontal)this._hasPickPoint=!!f.scenePickPoint,this._pickPoint=f.scenePickPoint??this._pickPoint,this._sphere=f.sphere;else{E.fromScreenAtEye(this.startCamera,b,this._tmpRay);c.normalize(this._tmpRay.direction,this._tmpRay.direction);let e;null!=f.scenePickPoint&&(c.subtract(this._tmpRayDirPick,this.startCamera.eye,f.scenePickPoint),e=c.length(this._tmpRayDirPick));
a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,r);a=v.clamp(Math.min(d.pivotDistanceModifier,1/Math.abs(c.dot(r,this._tmpRay.direction)))*a,d.distanceClampValues[0],d.distanceClampValues[1]);b=this.view._stage.renderView.getMinimalDepthForArea(null,b[0],b[1],this.view.state.camera,d.screenPixelArea);a=null!=b?b:a;a=null!=e?Math.min(a,e):a;this._hasPickPoint=!0;c.scale(this._tmpRay.direction,this._tmpRay.direction,a);c.add(this._pickPoint,
this._tmpRay.origin,this._tmpRay.direction)}}}update(b){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===d.NavigationMode.Horizontal){c.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var a=c.length(this._tmpRayDir);d.normalizeCoordinate(this.currentCamera,b,this._tmpP0);var f=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),e=a*2**f;const t=this.view.state.constraints.minimumPoiDistance;
0>f&&e<t&&(e=t);if(1E-6>Math.abs(a-e))return;this._hasPickPoint&&e<a&&(f=1-(1-e/a)*(1-this._sphere[3]/c.length(this.currentCamera.center)),this.currentCamera.center=c.scale(k,this.currentCamera.center,f));c.scale(this._tmpRayDir,this._tmpRayDir,-e/a);this.currentCamera.eye=c.add(k,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(l.distance(this.dragBeginPoint,b));q.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._hasPickPoint&&(d.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),n.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),d.applyRotation(this.currentCamera,p.getCenter(this._sphere),this._panAxisAngle))}else{a=c.length(this._tmpRay.direction);d.normalizeCoordinate(this.currentCamera,b,this._tmpP0);b=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);e=a*2**b;f=this.view.state.constraints.minimumPoiDistance;0>b&&e<f&&(e=
f);if(1E-6>Math.abs(a-e))return;c.scale(this._tmpRayDir,this._tmpRay.direction,1-e/a);this.currentCamera.eye=c.add(k,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=c.add(k,this.currentCamera.center,this._tmpRayDir)}C.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}}end(){this.active&&this.finishController()}};h.ZoomController=u.__decorate([x.subclass("esri.views.3d.state.controllers.global.ZoomController")],h.ZoomController);const k=g.create(),
r=g.create();Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});