// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(h,q,r,t,E,F,G,H,u,c,f,v,w,x,y,z,A,k,m,B,C){h.ZoomStepController=class extends A.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=f.create();this._tmpCamera=new m.Camera;this._tmpRayDir=f.create();this._tmpCenter=f.create();this._beginCamera=new m.Camera;this._constraintOptions=new w.ConstraintOptions(x.ConstraintTypes.ALL,y.InteractionType.ZOOM,null,this._beginCamera)}zoomStep(d,a){if(this.active){var e=this.view.state;this.animation.finished?this._beginCamera.copyFrom(e.camera):
this.animation.cameraAt(1,this._beginCamera);this._tmpCamera.copyFrom(e.camera);var b=B.newIntersector(this.view.state.viewingMode);e=!1;0<d?(e=this.intersectionHelper.intersectScreenFreePointFallback(a,this._zoomLocation,0===this.view.map.ground.opacity?k.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,b,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,b,this._zoomLocation)?this._tmpCamera.center=
this._zoomLocation:c.copy(this._zoomLocation,this._tmpCamera.center);d=.6**d;a=this.view._stage.renderView.getMinimalDepthForArea(z.getVoxelWasm(this.view),a[0],a[1],this.view.state.camera,60);c.subtract(l,this._tmpCamera.eye,this._zoomLocation);c.normalize(l,l);b=r.clamp(Math.min(k.zoomDistanceModifier,1/Math.abs(c.dot(D,l)))*Math.abs(this.view.camera.position.z),k.zoomMinDistanceModifier,k.zoomMaxDistanceModifier);if(a=null!=a?a:b)if(b=f.create(),c.subtract(b,this._zoomLocation,this._tmpCamera.eye),
a<c.length(b)||!e)c.normalize(b,b),c.add(this._zoomLocation,this._tmpCamera.eye,c.scale(b,b,a));this._updateCamera(this._tmpCamera,d,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:t.Milliseconds(600),easing:C.outExpo}}_updateCamera(d,a,e){c.subtract(this._tmpRayDir,e,d.eye);const b=c.length(this._tmpRayDir);let g=b*a;const n=Math.max(4,1.01*d.nearFar[0]);0!==g&&(1>=a&&g<n&&(g=n,a=g/b),1E-6>Math.abs(b-g)||(c.scale(this._tmpRayDir,this._tmpRayDir,a),d.eye=c.subtract(p,
e,this._tmpRayDir),d.center=c.lerp(p,d.center,e,1-a),v.applyAll(this.view,d,this._constraintOptions)))}};h.ZoomStepController=q.__decorate([u.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],h.ZoomStepController);const p=f.create(),D=f.fromValues(0,0,1),l=f.create();Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});