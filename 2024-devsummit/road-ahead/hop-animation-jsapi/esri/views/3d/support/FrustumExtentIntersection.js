// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(w,F,x,G,y,d,p,H,I,J,K,r,z,h,A,l,B,t,L){const C=.5*Math.PI,M=C/Math.PI*180;class N{constructor(a){this._renderCoordsHelper=a.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:p.create(),direction:p.create()};for(a=0;4>a;a++)this._extent[a]={origin:p.create(),direction:p.create(),cap:{next:null,direction:p.create()}},this._planes[a]=l.create();this._planes[h.PlaneIndex.NEAR]=l.create();this._planes[h.PlaneIndex.FAR]=l.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(a,c,b,e=!0){const m=this._extent;this._toRenderBoundingExtent(a,c,b);d.add(this._center.origin,m[0].origin,m[2].origin);d.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);e||d.scale(this._center.direction,this._center.direction,-1);for(b=0;4>b;b++){const g=m[b];this._renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);const q=m[3===b?0:b+1];g.cap.next=q.origin;d.direction(g.cap.direction,
g.origin,q.origin);l.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this._planes[b]);e||d.scale(g.direction,g.direction,-1)}l.fromVectorsAndPoint(m[0].cap.direction,m[1].cap.direction,m[0].origin,this._planes[h.PlaneIndex.NEAR]);e?l.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.FAR]):(l.copy(this._planes[h.PlaneIndex.FAR],this._planes[h.PlaneIndex.NEAR]),l.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(a[0]-a[2]),
Math.abs(a[1]-a[3]));this._maxSpanSpatialReference=c;this._minGlobalAltitude=.9*H.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(a,c,b=!1){if(null==a)return!1;if(this._renderCoordsHelper.viewingMode===t.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?M:C*c))return!0;if(null!=a.altitude&&a.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(a)}if(0===this._maxSpan)return c=this._extent[0],!b&&a.intersectsRay(B.wrap(c.origin,
c.direction))?!0:!1;for(c=0;c<this._extent.length;c++){var e=this._extent[c];if(!b&&a.intersectsRay(B.wrap(e.origin,e.direction))||a.intersectsLineSegment(A.fromPoints(e.origin,e.cap.next,O),e.cap.direction))return!0}b=b?this._planes:this._planesWithoutFar;for(c=0;c<a.lines.length;c++)if(e=a.lines[c],L.frustumLineSegment(b,e.origin,e.endpoint,e.direction))return!0;return!1}_toRenderBoundingExtentGlobal(a,c,b){z.center(a,k);k[2]=b;I.computeTranslationToOriginAndRotation(c,k,u,this._renderCoordsHelper.spatialReference);
G.invert(D,u);r.empty(f);for(const {x0:e,x1:m,y0:g,y1:q}of P)for(let v=0;5>v;v++){const E=v/4;k[0]=x.lerp(a[e],a[m],E);k[1]=x.lerp(a[g],a[q],E);k[2]=b;K.projectVectorToVector(k,c,k,this._renderCoordsHelper.spatialReference);d.transformMat4(k,k,D);r.expandWithVec3(f,k)}d.set(this._extent[0].origin,f[0],f[1],f[2]);d.set(this._extent[1].origin,f[3],f[1],f[2]);d.set(this._extent[2].origin,f[3],f[4],f[2]);d.set(this._extent[3].origin,f[0],f[4],f[2]);for(a=0;4>a;++a)d.transformMat4(this._extent[a].origin,
this._extent[a].origin,u)}_toRenderBoundingExtentLocal(a,c,b){J.projectBoundingRect(a,c,n,this._renderCoordsHelper.spatialReference);d.set(this._extent[0].origin,n[0],n[1],b);d.set(this._extent[1].origin,n[2],n[1],b);d.set(this._extent[2].origin,n[2],n[3],b);d.set(this._extent[3].origin,n[0],n[3],b)}_toRenderBoundingExtent(a,c,b){switch(this._renderCoordsHelper.viewingMode){case t.ViewingMode.Global:this._toRenderBoundingExtentGlobal(a,c,b);break;case t.ViewingMode.Local:this._toRenderBoundingExtentLocal(a,
c,b);break;default:F.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(a){if(0>l.signedDistance(a.planes[h.PlaneIndex.NEAR],this._center.origin)&&0>d.dot(this._center.direction,a.direction))return!0;for(let c=0;4>c;c++){const b=this._extent[c];if(0>l.signedDistance(a.planes[h.PlaneIndex.NEAR],b.origin)&&0>d.dot(b.direction,a.direction))return!0}return!1}}const P=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],k=p.create(),u=y.create(),
D=y.create(),f=r.create(),n=z.create(),O=A.create();w.FrustumExtentIntersection=N;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});