// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/tslib.es6 ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../geometry/support/clipRay ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/ray ../../ViewingMode ./LaserlinePathData ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/RenderSlot ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/LaserlinePathTechnique ../webgl-engine/shaders/LaserlinePathTechniqueConfiguration ../webgl-engine/shaders/LaserlineTechnique ../webgl-engine/shaders/LaserlineTechniqueConfiguration".split(" "),
function(b,e,g,h,B,C,D,u,c,f,v,l,w,m,n,p,q,x,y,z,r,A){b.LaserLineRenderer=class extends p.SyncPrepareRenderPlugin{constructor(a){super(a);this._technique=null;this._intersectsLineInfinite=this._intersectsLineEnabled=this._lineVerticalPlaneEnabled=this._pointDistanceEnabled=this._heightManifoldEnabled=!1;this._viewingMode=m.ViewingMode.Local;this._pathVerticalPlaneEnabled=!1;this._pathTechnique=this._pathVerticalPlaneData=null;this._passParameters=new r.LaserlinePassParameters;this.produces=new Map([[q.RenderSlot.LASERLINES,
()=>!this.contrastControlEnabled],[q.RenderSlot.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return p.ConsumesDepth}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(a){this._heightManifoldEnabled!==a&&(this._heightManifoldEnabled=a,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(a){c.copy(this._passParameters.heightManifoldTarget,
a);this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(a){a!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=a,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(a){c.copy(this._passParameters.pointDistanceTarget,a);this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(a){c.copy(this._passParameters.pointDistanceOrigin,
a);this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(a){a!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=a,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(a){l.copy(a,this._passParameters.lineVerticalPlaneSegment);this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(a){a!==
this._intersectsLineEnabled&&(this._intersectsLineEnabled=a,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(a){l.copy(a,this._passParameters.intersectsLineSegment);this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(a){a!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=a,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(a){a!==
this._intersectsLineInfinite&&(this._intersectsLineInfinite=a,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(a){a!==this._viewingMode&&(this._viewingMode=a,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(a){a!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=a,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(a){null==this._pathVerticalPlaneData&&
(this._pathVerticalPlaneData=new n.LaserlinePathData(this._passParameters.renderCoordsHelper));this._pathVerticalPlaneData.vertices=a;this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(a){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new n.LaserlinePathData(this._passParameters.renderCoordsHelper));this._pathVerticalPlaneData.buffers=a;this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(a){x.updateParameters(this._passParameters,a)&&
this._requestRender()}initializeRenderContext(a){this._context=a;this._techniqueRepository=a.techniqueRepository;this._techniqueConfig=new A.LaserlineTechniqueConfiguration;a=new z.LaserlinePathTechniqueConfiguration;a.contrastControlEnabled=this.contrastControlEnabled;this._pathTechnique=this._techniqueRepository.acquire(y.LaserlinePathTechnique,a)}uninitializeRenderContext(){this._technique=g.releaseMaybe(this._technique);this._pathVerticalPlaneData=g.disposeMaybe(this._pathVerticalPlaneData);this._pathTechnique=
g.releaseMaybe(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=
this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===m.ViewingMode.Global,this._technique=this._techniqueRepository.releaseAndAcquire(r.LaserlineTechnique,this._techniqueConfig,this._technique)):this._pathTechnique}renderNode(a,k){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(a,k);this.pathVerticalPlaneEnabled&&this._renderPath(a)}_renderUnified(a,k){const t=a.rctx;this._updatePassParameters(a);
t.bindTechnique(k,a.bindParameters,this._passParameters);t.screen.draw()}_renderPath(a){null!=this._pathVerticalPlaneData&&null!=this._pathTechnique&&(a.rctx.bindTechnique(this._pathTechnique,a.bindParameters,{...this._passParameters,origin:this._pathVerticalPlaneData.origin}),this._pathVerticalPlaneData.draw(a.rctx))}_updatePassParameters(a){this._intersectsLineEnabled&&(a=a.bindParameters.camera,this._intersectsLineInfinite?(f.fromRay(w.wrap(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),
d),d.c0=-Number.MAX_VALUE,v.intersectClipRay(a.frustum,d)&&(f.getStart(d,this._passParameters.lineStartWorld),f.getEnd(d,this._passParameters.lineEndWorld))):(c.copy(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),c.add(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)))}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};
e.__decorate([h.property({constructOnly:!0})],b.LaserLineRenderer.prototype,"contrastControlEnabled",void 0);e.__decorate([h.property({constructOnly:!0})],b.LaserLineRenderer.prototype,"_isDecoration",void 0);e.__decorate([h.property({constructOnly:!0})],b.LaserLineRenderer.prototype,"renderCoordsHelper",void 0);b.LaserLineRenderer=e.__decorate([u.subclass("esri.views.3d.support.LaserLineRenderer")],b.LaserLineRenderer);const d=f.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});