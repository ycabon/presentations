// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),function(m,r,n,t,p,u){function v(a){switch(a.type){case "polyline":a.paths.reduce((c,b)=>c+b.length,0)<n.nativeArrayMaxSize&&(a.paths=a.hasZ||a.hasM?a.paths.map(c=>c.map(b=>[b[0],b[1],b[2]])):a.paths.map(c=>c.map(b=>[b[0],b[1]])));break;case "polygon":a.rings.reduce((c,b)=>c+b.length,0)<n.nativeArrayMaxSize&&(a.rings=a.hasZ||
a.hasM?a.rings.map(c=>c.map(b=>[b[0],b[1],b[2]])):a.rings.map(c=>c.map(b=>[b[0],b[1]])))}}class w{constructor(a){this._controller=a;this._handle=new x(c=>a.schedule(c))}destroy(){this._handle.destroy()}invoke(a,c){if(!a.buffer||0===a.buffer.byteLength)return Promise.resolve(null);a.options.sourceSpatialReference&&a.options.sourceSpatialReference instanceof p&&(a.options={...a.options,sourceSpatialReference:a.options.sourceSpatialReference.toJSON()});return this._handle.invoke(a,c).then(b=>{let f=
0,h=0;const q=p.fromJSON(b.spatialReference);b.spatialReference=q;const l=async g=>{var d=b.fields;if(d)for(;f<d.length;)if(d[f]=u.fromJSON(d[f]),f++,g.madeProgress())return this._controller.reschedule(k=>l(k));for(d=b.features;h<d.length;){var e=d[h];++h;e.uid=r.generateUID();e=e.geometry;if(null!=e&&(e.spatialReference=q,v(e),g.madeProgress()))return this._controller.reschedule(k=>l(k))}return b};return this._controller.schedule(g=>l(g))})}}class x extends t.WorkerHandle{constructor(a){super("PBFDecoderWorker",
"_parseFeatureQuery",{_parseFeatureQuery:c=>[c.buffer]},a)}}m.PBFDecoder=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});