// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),function(l,m,p,h,q,n){class r extends h.TextureCollection{constructor(c,a,b){super(a,b);this._streamDataRequester=c}async fromUrl(c,a,b){m.throwIfAborted(b);b=b?.signal;const d=this.makeUid(c,a);let e=this._textureRequests.get(d);if(!e){const g=new AbortController,t=this._streamDataRequester.request(c,"image",{uid:d,signal:g.signal});e=new h.TextureRequest;
e.abortController=g;const k=e;this._textureRequests.set(d,e);e.textureAsync=t.then(async f=>{f=this._createTexture(c,f,a);k.texture=f;k.abortController=null;await f.load(this._stage.renderView.renderingContext);this._stage.add(f);return new h.TextureResult(d,f,()=>this._release(d))},f=>{k.abortController=null;throw f;})}e.referenceCount++;try{return await m.whenOrAbort(e.textureAsync,b)}catch(g){throw this._release(d),g;}}_createTexture(c,a,b){const d={width:a.width,height:a.height,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,
t:n.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(p.isSVG(c)){if(b||0===a.width&&0===a.height)c=a.width?a.height/a.width:1,b=b||64,1<c?(a.width=Math.round(b/c),a.height=b):(a.width=b,a.height=Math.round(b*c));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(d.preMultiplyAlpha=!1)}return new q.Texture(a,d)}}l.StreamTextureCollection=r;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});