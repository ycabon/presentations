// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(c,e,l,f,n,p,q,m,g){c.TextureCollection=class extends l{constructor(a,b){super({});this._stage=a;this._textureRequests=new Map;this._frameTask=b?.registerTask(g.TaskPriority.TEXTURE_UNLOAD)??g.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();
this._frameTask?.remove();this._textureRequests?.forEach(a=>this._releaseTextureRequest(a));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(a,b){const d=this.makeUid(a);a=this._textureRequests.get(d);a||(a=new h,a.texture=b(),this._stage&&(a.texture.load(this._stage.renderView.renderingContext),this._stage.add(a.texture)),this._textureRequests.set(d,a));a.referenceCount++;return new k(d,a.texture,()=>this._release(d))}_release(a){const b=this._textureRequests.get(a);
b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||(b.texture?.unload(),this._releaseTextureRequest(b),this._textureRequests.delete(a))}}_releaseTextureRequest(a){a.texture?
this._stage?.remove(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)}makeUid(a,b=null){return null!=b?`${a}.${b}px`:a}};e.__decorate([f.property()],c.TextureCollection.prototype,"_frameTask",void 0);e.__decorate([f.property()],c.TextureCollection.prototype,"updating",null);c.TextureCollection=e.__decorate([m.subclass("esri.views.3d.support.TextureCollection")],c.TextureCollection);class k{constructor(a,b,d){this.uid=a;this.texture=b;this.release=d}}class h{constructor(){this.referenceCount=
0}}c.TextureRequest=h;c.TextureResult=k;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});