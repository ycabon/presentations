// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler ../../../support/Yield".split(" "),
function(d,e,t,u,m,v,g,D,E,F,w,h,l,x,y,z,A,n,B,p){const C=Array;d.Focus=class extends A.PointOfInterest{constructor(a){super(a);this._propertiesPool=new z.PropertiesPool({location:x,renderLocation:C},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([m.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),m.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(B.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=u.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const a=this._propertiesPool.get("location");a.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a);return a}get worldUnitsPerContentPixel(){const {camera:a,contentPixelRatio:b}=this.state;return a.computeRenderPixelSizeAt(this.renderLocation)*(a.pixelRatio/b)}get running(){return this._dirty}runTask(){var a=
this._get("renderLocation");const b=this.centerOnSurface.renderLocation;var c=this.renderCoordsHelper,f=this.state.contentCamera;this._dirty=!1;c.worldUpAtPosition(b,q);c=Math.max(0,(Math.acos(h.dot(q,f.viewForward))-.5*Math.PI)*(f.aboveGround?1:-1));if(Number.isNaN(c))return a&&h.equals(a,b)||(a=this._propertiesPool.get("renderLocation"),h.copy(a,b),this._set("renderLocation",a)),p.Yield;c=1-t.clamp(c/(.5*Math.PI),0,1);c*=c*c;this._calculateScreenHorizontalEdgeOnSurface(r);f=this._propertiesPool.get("renderLocation");
h.lerp(f,b,r,c);a&&h.equals(a,f)||this._set("renderLocation",f);return p.Yield}_calculateScreenHorizontalEdgeOnSurface(a){const b=this.state.contentCamera;var c=b.getRenderCenter(v.createRenderScreenPointArray3());c[1]=b.aboveGround?b.padding[n.PaddingSide.BOTTOM]:b.fullHeight-b.padding[n.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(c,a))return a;const f=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return b.unprojectFromRenderScreen(c,k)&&(h.subtract(k,
k,b.eye),c=h.normalize(k,k),this.renderCoordsHelper.intersectInfiniteManifold(y.wrap(b.eye,c),f,a))?a:this.renderCoordsHelper.setAltitude(a,f,b.eye)}updateRenderLocation(){this._dirty=!0}};e.__decorate([g.property()],d.Focus.prototype,"_dirty",void 0);e.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"scheduler",void 0);e.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"centerOnSurface",void 0);e.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);e.__decorate([g.property()],d.Focus.prototype,"updating",null);e.__decorate([g.property()],d.Focus.prototype,"location",null);e.__decorate([g.property()],d.Focus.prototype,"renderLocation",void 0);e.__decorate([g.property()],d.Focus.prototype,"worldUnitsPerContentPixel",null);d.Focus=e.__decorate([w.subclass("esri.views.3d.support.pointsOfInterest.Focus")],d.Focus);const q=l.create(),k=l.create(),r=l.create();Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});