// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),function(a,c,g,h,f,d,p,q,r,k,l,m,n){a.StableSurfaceCenter=
class extends g{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const b=l.create();this.view.renderCoordsHelper.toRenderCoords(this.location,b);return b}constructor(b){super(b);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([f.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),f.on(()=>this.surface?.layers,"change",
()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var b=n.center(this.surfaceView.extent);b=new m({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(b,
{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(e=>{this._updateController=null;this._set("location",e.geometry)}).catch(e=>{h.isAbortError(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)})):this._set("location",b)}}};c.__decorate([d.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([d.property()],
a.StableSurfaceCenter.prototype,"surface",null);c.__decorate([d.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);c.__decorate([d.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);c.__decorate([d.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([k.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});