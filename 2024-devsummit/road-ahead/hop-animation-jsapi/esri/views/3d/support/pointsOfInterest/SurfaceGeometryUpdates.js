// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../support/Yield".split(" "),function(b,d,p,q,g,x,y,z,r,m,k,t,n){b.SurfaceGeometryUpdates=class extends p{constructor(a){super(a);
this._tileGeometryUpdateExtent=k.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new q;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",a=>this._tileGeometryChanged(a)),this.scheduler.registerTask(t.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return n.Yield;this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&
this.events.emit("request-update",u);k.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return n.Yield}_tileGeometryChanged(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;k.expand(this._tileGeometryUpdateExtent,a.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let a=this.centerOnSurfaces[0];for(let h=1;h<this.centerOnSurfaces.length;h++){const l=this.centerOnSurfaces[h];l.distance>a.distance&&(a=l)}return a}_centerIntersectsExtent(a,
h){const l=this.state.contentCamera.eye,c=v,w=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(l,e,h);this.renderCoordsHelper.fromRenderCoords(w.renderLocation,f,h);e[0]<f[0]?(c[0]=e[0],c[2]=f[0]):(c[0]=f[0],c[2]=e[0]);e[1]<f[1]?(c[1]=e[1],c[3]=f[1]):(c[1]=f[1],c[3]=e[1]);return k.intersects(c,a)}};d.__decorate([g.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"state",void 0);d.__decorate([g.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,
"centerOnSurfaces",void 0);d.__decorate([g.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);d.__decorate([g.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"scheduler",void 0);d.__decorate([g.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"surface",void 0);d.__decorate([g.property({readOnly:!0})],b.SurfaceGeometryUpdates.prototype,"updating",void 0);b.SurfaceGeometryUpdates=d.__decorate([r.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],
b.SurfaceGeometryUpdates);const u={},e=m.create(),f=m.create(),v=k.empty();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});