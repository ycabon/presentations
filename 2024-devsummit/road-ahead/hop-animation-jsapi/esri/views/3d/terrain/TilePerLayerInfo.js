// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(d,g,k,l,e,m){class h{constructor(){this.waitingAgents=new l;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}static acquire(a){const b=f.acquire();b._init(a);return b}release(){this.dispose();c.delete(this);f.release(this)}dispose(){this.loadingAgent=g.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();
this.pendingUpdates=0;this._data=e.releaseTileData(this._data)}static prune(){f.prune(0)}_init(a){this.waitingAgents.clear();this._data=e.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=a;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=g.abortMaybe(this.requestAbort);this.requestPromise=
null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(a,b){if(a===b||null==b)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===b)return;this._upsampleInfo.tile.unrefMapData()}b.refMapData();m.computeUpsampleInfo(a,b,this._upsampleInfo)}}get data(){return this._data}set data(a){e.releaseTileData(this._data);
this._data=a}}const f=new k(h,null,()=>{}),c=new Map;d.TilePerLayerInfo=h;d.printAllocations=function(){0<c.size&&(console.log(`${c.size} live TilePerLayerInfo allocations:`),c.forEach(a=>console.log(a,"\n")))};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});