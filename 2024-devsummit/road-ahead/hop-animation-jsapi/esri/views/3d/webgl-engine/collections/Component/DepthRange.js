// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/quat ../../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../lib/depthRange".split(" "),function(J,F,K,R,S,T,k,x,L,w){function G(c,b,a){return k.set(c,b.data[a],b.data[a+1],b.data[a+2])}
function g(c,b){c.push(b[0]);c.push(b[1]);c.push(b[2])}function U(c,b,a,q){S.conjugate(M,c.quaternion);k.sub(l,b,c.center);k.transformQuat(l,l,M);b=c.halfSize;const r=8*((l[0]<-b[0]?-1:l[0]>b[0]?1:0)+3*(l[1]<-b[1]?-1:l[1]>b[1]?1:0)+9*(l[2]<-b[2]?-1:l[2]>b[2]?1:0)+13);b=N[r];if(0===b)return b;K.fromQuat(C,c.quaternion);K.scale(C,C,c.halfSize);const p=(e,d)=>{d=N[r+d+1];k.set(e,((d&1)<<1)-1,(d&2)-1,((d&4)>>1)-1);k.transformMat3(e,e,C);return k.add(e,c.center,e)};a.length=0;g(a,p(H,0));g(a,p(O,1));g(a,
p(l,2));g(a,p(P,3));q(a);if(1===b)return b;a.length=0;g(a,H);g(a,P);g(a,p(l,4));g(a,p(Q,5));q(a);if(2===b)return b;a.length=0;g(a,H);g(a,Q);g(a,p(l,6));g(a,O);q(a);return b}const D=new F({allocator:c=>c||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:c=>{c.object=null;return c}}),u=w.empty(),h=x.create(),y=x.create(),V=new F({deallocator:null}),W=new F({deallocator:null}),N=(()=>{const c=Array(216);let b=0;const a=q=>{for(let r=0;r<q.length;r++)c[b+r]=q[r];b+=8};a([3,0,6,2,3,1,5,4]);
a([2,0,2,3,1,5,4,0]);a([3,1,0,2,3,7,5,4]);a([2,0,1,3,2,6,4,0]);a([1,0,1,3,2,0,0,0]);a([2,1,5,7,3,2,0,0]);a([3,2,0,1,3,7,6,4]);a([2,2,0,1,3,7,6,0]);a([3,3,0,1,5,7,6,2]);a([2,0,1,5,4,6,2,0]);a([1,0,1,5,4,0,0,0]);a([2,1,3,7,5,4,0,0]);a([1,0,2,6,4,0,0,0]);a([0,0,0,0,0,0,0,0]);a([1,1,3,7,5,0,0,0]);a([2,2,3,7,6,4,0,0]);a([1,2,3,7,6,0,0,0]);a([2,3,1,5,7,6,2,0]);a([3,4,0,1,5,7,6,2]);a([2,5,7,6,4,0,1,0]);a([3,5,0,1,3,7,6,4]);a([2,4,5,7,6,2,0,0]);a([1,4,5,7,6,0,0,0]);a([2,5,1,3,7,6,4,0]);a([3,6,0,2,3,7,5,4]);
a([2,6,2,3,7,5,4,0]);a([3,7,6,2,3,1,5,4]);return c})(),C=R.create(),M=T.create(),l=x.create(),H=x.create(),O=x.create(),P=x.create(),Q=x.create();J.computeDepthRange=function(c,b){const a=w.empty(),{eye:q,frustum:r,viewForward:p}=c;b.forAll(e=>{var d=null!=e.offsetObb?e.offsetObb:e.obb;const f=k.dot(k.sub(l,d.center,q),p),m=d.projectedRadius(p);if(!w.within(a,f-m)||!w.within(a,f+m)){a:{var n=0;for(let v=0;4>v;v++){const t=d.intersectPlane(r[v]);if(0<t){d=-1;break a}0===t&&(n|=1<<v)}d=n}-1!==d&&(0===
d?(u.far=f+m,u.near=f-m,w.union(a,u)):(n=D.pushNew(),n.near=f-m,n.far=f+m,n.mask=d,n.object=e))}});for(c=0;c<D.length;c++){const e=D.data[c];w.within(a,e.near)&&w.within(a,e.far)||(u.far=e.far,u.near=Infinity,0===U(null!=e.object.offsetObb?e.object.offsetObb:e.object.obb,q,V,d=>{var f=W;for(var m=0;4>m&&0<d.length;m++){if(0===(e.mask&1<<m))continue;var n=r[m],v=d,t=f;t.length=0;const I=v.length-3;G(h,v,I);const z=L.signedDistance(n,h);0>=z&&(t.push(h[0]),t.push(h[1]),t.push(h[2]));let E=0,A=z;for(E;E<
I;E+=3){G(y,v,E);const B=L.signedDistance(n,y);0>A*B&&(k.lerp(h,y,h,B/(B-A)),g(t,h));0>=B&&g(t,y);A=B;k.copy(h,y)}0>A*z&&(G(y,v,I),k.lerp(h,y,h,z/(z-A)),g(t,h));n=d;d=f;f=n}for(f=0;f<d.length;f+=3)k.set(h,d.data[f],d.data[f+1],d.data[f+2]),m=k.dot(k.sub(h,h,q),p),u.near=Math.min(u.near,m)})&&(u.near=0),w.union(a,u))}D.length=0;return a};Object.defineProperty(J,Symbol.toStringTag,{value:"Module"})});