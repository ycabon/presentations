// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/signal ../core/shaderLibrary/ShaderOutput ./RenderPlugin ../lib/basicInterfaces ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),function(h,m,k,n,g,f,p,l,q,r){class t{constructor(a){this._context=a;this._renderPlugins=new m;this._slots=[];this._renderVersion=n.signal(0);for(a=0;a<r.RenderSlot.MAX_SLOTS;++a)this._slots[a]=[]}destroy(){this._renderPlugins.forEach(a=>a.destroy());this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(a,
b){const c=()=>{if(b?.aborted)throw a.uninitializeRenderContext(),k.createAbortError();this._renderPlugins.push(a);a.produces.forEach((e,u)=>{this._slots[u].push(a)});this._context.requestRender();this._renderVersion.value++},d=a.initializeRenderContext(this._context,b);if(k.isPromiseLike(d))return d.then(c);c()}remove(a){if(null!=this._renderPlugins.removeUnordered(a)){for(let b=0;b<this._slots.length;++b)this._slots[b]=this._slots[b].filter(c=>c!==a);a.uninitializeRenderContext();this._context.requestRender();
this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(a=>{a.prepareRender&&a.prepareRender(this._context.renderContext)})}updateAnimation(a){let b=!1;this._renderPlugins.forAll(c=>{c.updateAnimation&&(b=c.updateAnimation(a)||b)});return b}renderFeatureChanged(){this._renderPlugins.forAll(a=>{a.renderFeatureChanged&&a.renderFeatureChanged()})}prepare(a){this._context.renderContext.bindParameters.slot=a;this._slots[a].forEach(b=>{const c=b.produces.get(a);c&&c(g.ShaderOutput.Color)&&
(f.isPrepareRenderPlugin(b)&&b.prepareTechnique(this._context.renderContext),f.isPreparesRenderPlugin(b)&&b.prepareTechniques(this._context.renderContext))})}_getRenderables(a){this._context.renderContext.bindParameters.slot=a;const b=this._context.renderContext.output??g.ShaderOutput.Color,c=new Map;this._slots[a].forEach(d=>{var e=d.produces.get(a);!e||!e(b)||d.isDecoration&&this._context.renderContext.bindParameters.decorations===p.Decorations.OFF||(f.isPrepareRenderPlugin(d)?(e=d.prepareTechnique(this._context.renderContext),
null!=e&&c.set(d,e)):f.isPreparesRenderPlugin(d)?(e=d.prepareTechniques(this._context.renderContext),null!=e&&c.set(d,e)):c.set(d,null))});return c}render(a,b=null,c=null){this._getRenderables(a).forEach((d,e)=>c=e.renderNode(this._context.renderContext,d,b,c));return c}queryDepthRange(a){const b=new l.DepthRange;this._renderPlugins.forAll(c=>{c=c.queryDepthRange?.(a);l.union(b,c)});return b}get updating(){return 0<=this._renderVersion.value&&this._renderPlugins.some(a=>a.running)}produces(a,b=g.ShaderOutput.Color){return this._slots[a].some(c=>
(c=c.produces.get(a))?c(b):!1)}consumes(a){return this._renderPlugins.some(b=>b.consumes().required.includes(a))}getMaterialRenderer(a){return this._renderPlugins.find(b=>b.materialReference===a)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(a=>a.materialReference&&0===a.numGeometries?(a.destroy(),!1):!0)}get hasDecorations(){return this._renderPlugins.some(a=>a.isDecoration)}get hasOccludees(){return this._renderPlugins.some(a=>a.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((a,
b)=>a|b.renderOccludedFlags,q.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((a,b)=>null!==b.materialReference?a:a+(b.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}}h.RenderPluginManager=t;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});