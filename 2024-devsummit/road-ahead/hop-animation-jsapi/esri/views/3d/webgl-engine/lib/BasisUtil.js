// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(k,x,l,g,y,z){async function q(){null==p&&(p=x.getBasisTranscoder(),d=await p);return p}function r(a,c,f,b,e){c=z.getBytesPerElementFormat(c?g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(f*b*c*(e&&1<a?(4**a-1)/(3*4**(a-1)):1))}function t(a){return 1<=a.getNumImages()&&
!a.isUASTC()}function u(a){return 1<=a.getFaces()&&a.isETC1S()}function v(a,c,f,b,e,h,m,A){const {compressedTextureETC:B,compressedTextureS3TC:C}=a.capabilities,[w,D]=B?b?[l.TextureFormat.ETC2_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[l.TextureFormat.ETC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:C?b?[l.TextureFormat.BC3_RGBA,g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[l.TextureFormat.BC1_RGB,g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[l.TextureFormat.RGBA32,
g.PixelFormat.RGBA];f=c.hasMipmap?f:Math.min(1,f);b=[];for(let n=0;n<f;n++)b.push(new Uint8Array(m(n,w))),A(n,w,b[n]);c.internalFormat=D;c.hasMipmap=1<b.length;c.samplingMode=c.hasMipmap?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:g.TextureSamplingMode.LINEAR;c.width=e;c.height=h;return new y.Texture(a,c,{type:"compressed",levels:b})}let d=null,p=null;k.createTextureBasis=async function(a,c,f){null==d&&(d=await q());const b=new d.BasisFile(new Uint8Array(f));if(!t(b))return null;b.startTranscoding();
a=v(a,c,b.getNumLevels(0),b.getHasAlpha(),b.getImageWidth(0,0),b.getImageHeight(0,0),(e,h)=>b.getImageTranscodedSizeInBytes(0,e,h),(e,h,m)=>b.transcodeImage(m,0,e,h,0,0));b.close();b.delete();return a};k.createTextureKTX2=async function(a,c,f){null==d&&(d=await q());const b=new d.KTX2File(new Uint8Array(f));if(!u(b))return null;b.startTranscoding();a=v(a,c,b.getLevels(),b.getHasAlpha(),b.getWidth(),b.getHeight(),(e,h)=>b.getImageTranscodedSizeInBytes(e,0,0,h),(e,h,m)=>b.transcodeImage(m,e,0,0,h,0,
-1,-1));b.close();b.delete();return a};k.estimateMemoryBasis=function(a,c){if(null==d)return a.byteLength;a=new d.BasisFile(new Uint8Array(a));c=t(a)?r(a.getNumLevels(0),a.getHasAlpha(),a.getImageWidth(0,0),a.getImageHeight(0,0),c):0;a.close();a.delete();return c};k.estimateMemoryKTX2=function(a,c){if(null==d)return a.byteLength;a=new d.KTX2File(new Uint8Array(a));c=u(a)?r(a.getLevels(),a.getHasAlpha(),a.getWidth(),a.getHeight(),c):0;a.close();a.delete();return c};k.loadBasis=q;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})});