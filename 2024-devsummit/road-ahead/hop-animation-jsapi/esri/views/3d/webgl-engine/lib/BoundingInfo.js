// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(x,B,t,q,r){class y{constructor(b,c,d){this.primitiveIndices=b;this._numIndexPerPrimitive=c;this.position=d;this._children=void 0;r.assert(1<=b.length);r.assert(3===d.size||4===d.size);const {data:f,size:a,indices:l}=d;r.assert(0===l.length%this._numIndexPerPrimitive);r.assert(l.length>=b.length*this._numIndexPerPrimitive);var n=b.length;c=a*l[this._numIndexPerPrimitive*
b[0]];p.clear();p.push(c);d=q.fromValues(f[c],f[c+1],f[c+2]);var g=q.clone(d);for(var h=0;h<n;++h){var e=this._numIndexPerPrimitive*b[h];for(var m=0;m<this._numIndexPerPrimitive;++m){c=a*l[e+m];p.push(c);let k=f[c];d[0]=Math.min(k,d[0]);g[0]=Math.max(k,g[0]);k=f[c+1];d[1]=Math.min(k,d[1]);g[1]=Math.max(k,g[1]);k=f[c+2];d[2]=Math.min(k,d[2]);g[2]=Math.max(k,g[2])}}this.bbMin=d;this.bbMax=g;b=t.lerp(q.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(g[0]-d[0],g[1]-d[1]),g[2]-d[2]);
d=this.radius*this.radius;for(g=0;g<p.length;++g)c=p.at(g),n=f[c]-b[0],h=f[c+1]-b[1],c=f[c+2]-b[2],e=n*n+h*h+c*c,e<=d||(e=Math.sqrt(e),m=.5*(e-this.radius),this.radius+=m,d=this.radius*this.radius,e=m/e,b[0]+=n*e,b[1]+=h*e,b[2]+=c*e);this.center=b;p.clear()}getChildren(){if(this._children||1>=t.squaredDistance(this.bbMin,this.bbMax))return this._children;var b=t.lerp(q.create(),this.bbMin,this.bbMax,.5),c=this.primitiveIndices.length;const d=new Uint8Array(c),f=Array(8);for(var a=0;8>a;++a)f[a]=0;
const {data:l,size:n,indices:g}=this.position;for(a=0;a<c;++a){var h=0;const m=this._numIndexPerPrimitive*this.primitiveIndices[a];var e=n*g[m];let k=l[e],u=l[e+1],v=l[e+2];for(let w=1;w<this._numIndexPerPrimitive;++w){e=n*g[m+w];const z=l[e],A=l[e+1];e=l[e+2];z<k&&(k=z);A<u&&(u=A);e<v&&(v=e)}k<b[0]&&(h|=1);u<b[1]&&(h|=2);v<b[2]&&(h|=4);d[a]=h;++f[h]}b=0;for(a=0;8>a;++a)0<f[a]&&++b;if(!(2>b)){b=Array(8);for(a=0;8>a;++a)b[a]=0<f[a]?new Uint32Array(f[a]):void 0;for(a=0;8>a;++a)f[a]=0;for(a=0;a<c;++a)h=
d[a],b[h][f[h]++]=this.primitiveIndices[a];this._children=[];for(c=0;8>c;++c)void 0!==b[c]&&this._children.push(new y(b[c],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){p.prune()}}const p=new B({deallocator:null});x.BoundingInfo=y;Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});