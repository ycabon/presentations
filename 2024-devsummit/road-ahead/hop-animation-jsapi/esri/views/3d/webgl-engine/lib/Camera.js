// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(b,e,E,F,t,C,g,L,M,G,n,p,D,H,h,q,k,r,y,I,J,K,u){var z;b.Camera=z=class extends E{constructor(a){super(a);this._ray=I.create();this._viewport=r.fromValues(0,0,1,1);this._padding=r.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=H.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=p.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=p.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=p.create();this._frustumDirty=!0;this._frustum=
y.create();this._fullViewport=r.create();this._pixelRatio=1;this.column=this.row=0;this._columns=this._rows=1;this._center=q.create();this._up=q.create();this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(a){this._pixelRatio=0<a?a:1}get rows(){return this._rows}set rows(a){this._rows=Math.max(1,a)}get columns(){return this._columns}set columns(a){this._columns=Math.max(1,a)}get eye(){return this._ray.origin}set eye(a){this._compareAndSetView(a,this._ray.origin)}get center(){return this._center}set center(a){this._compareAndSetView(a,
this._center,"_center")}get ray(){h.subtract(this._ray.direction,this.center,this.eye);return this._ray}get up(){return this._up}set up(a){this._compareAndSetView(a,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(a){n.copy(this._viewMatrix,a);this.notifyChange("_viewMatrix");this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return h.set(q.create(),-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){this._ensureViewClean();return h.set(q.create(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){this._ensureViewClean();return h.set(q.create(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(a){this._nearFar[0]!==a&&(this._nearFar[0]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(a){this._nearFar[1]!==
a&&(this._nearFar[1]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const a=k.scale(r.create(),this._viewport,1/this.pixelRatio),c=this._get("screenViewport");return c&&k.equals(a,c)?c:a}get screenPadding(){if(1===this.pixelRatio)return this._padding;const a=k.scale(r.create(),this._padding,
1/this.pixelRatio),c=this._get("screenPadding");return c&&k.equals(a,c)?c:a}get x(){return this._viewport[0]}set x(a){a+=this._padding[b.PaddingSide.LEFT];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(a){a+=this._padding[b.PaddingSide.BOTTOM];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(a){this._viewport[2]!==
a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT]}set fullWidth(a){this.width=a-(this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+
this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]}set fullHeight(a){this.height=a-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[b.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[b.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(a){k.exactEquals(this._padding,
a)||(this._viewport[0]+=a[b.PaddingSide.LEFT]-this._padding[b.PaddingSide.LEFT],this._viewport[1]+=a[b.PaddingSide.BOTTOM]-this._padding[b.PaddingSide.BOTTOM],this._viewport[2]-=a[b.PaddingSide.RIGHT]+a[b.PaddingSide.LEFT]-(this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT]),this._viewport[3]-=a[b.PaddingSide.TOP]+a[b.PaddingSide.BOTTOM]-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]),k.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=!0,
this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(n.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){var a=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2)*2,m=d*this._aspect,v=d/this.rows,w=m/this.columns;m=-m/2+this.column*w;w=m+w;d=-d/2+this.row*v;v=d+v;a=n.frustum(p.create(),m*(1+2*this._padding[b.PaddingSide.LEFT]/
a),w*(1+2*this._padding[b.PaddingSide.RIGHT]/a),d*(1+2*this._padding[b.PaddingSide.BOTTOM]/c),v*(1+2*this._padding[b.PaddingSide.TOP]/c),this.near,this.far);return(c=this._get("projectionMatrix"))&&n.equals(c,a)?c:a}get inverseProjectionMatrix(){return n.invert(p.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||p.create()}get fov(){return this._fov}set fov(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=!0}get fovX(){return u.fovd2fovx(this._fov,this.width,this.height)}set fovX(a){this._fov=
u.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return u.fovd2fovy(this._fov,this.width,this.height)}set fovY(a){this._fov=u.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return h.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)n.invert(this._viewInverseTransposeMatrix,
this.viewMatrix),n.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(a){return 2*this.near*this.far/(this.far+this.near-(2*a-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&0<=this.relativeElevation}copyFrom(a){h.copy(this._ray.origin,
a.eye);this.center=a.center;this.up=a.up;k.copy(this._viewport,a.viewport);this.notifyChange("_viewport");k.copy(this._padding,a.padding);this.notifyChange("_padding");D.copy(this._nearFar,a.nearFar);this.notifyChange("_nearFar");this._fov=a.fov;this.row=a.row;this.column=a.column;this.rows=a.rows;this.columns=a.columns;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(n.copy(this._viewMatrix,a.viewMatrix),this.notifyChange("_viewMatrix"));this._viewProjectionDirty=
!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(y.copy(this._frustum,a.frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n.copy(this._viewInverseTransposeMatrix,a.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);k.copy(this._fullViewport,a.fullViewport);this.pixelRatio=a.pixelRatio;return this}copyViewFrom(a){this.eye=a.eye;this.center=a.center;this.up=a.up}clone(){return(new z).copyFrom(this)}equals(a){return h.exactEquals(this.eye,
a.eye)&&h.exactEquals(this.center,a.center)&&h.exactEquals(this.up,a.up)&&k.exactEquals(this._viewport,a.viewport)&&k.exactEquals(this._padding,a.padding)&&D.exactEquals(this.nearFar,a.nearFar)&&this._fov===a.fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation&&this.row===a.row&&this.column===a.column&&this.rows===a.rows&&this.columns===a.columns}almostEquals(a){var c=Math.max(1,1/this.pixelRatio,1/a.pixelRatio);if(.001<=Math.abs(a.fov-this._fov)||k.squaredDistance(a.screenPadding,
this.screenPadding)>=c||k.squaredDistance(this.screenViewport,a.screenViewport)>=c||this.row!==a.row||this.column!==a.column||this.rows!==a.rows||this.columns!==a.columns)return!1;h.sub(l,a.eye,a.center);h.sub(A,this.eye,this.center);c=h.dot(l,A);const d=h.sqrLen(l),m=h.sqrLen(A);return c*c>=(1-1E-10)*d*m&&h.sqrDist(a.eye,this.eye)<2.5E-7*Math.max(d,m)}computeRenderPixelSizeAt(a){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(a))}computeRenderPixelSizeAtDist(a){return a*this.perRenderPixelRatio}computeScreenPixelSizeAt(a){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(a))}_viewDirectionDistance(a){return Math.abs(J.projectPointSignedLength(this.viewForward,
h.subtract(l,a,this.eye)))}computeScreenPixelSizeAtDist(a){return a*this.perScreenPixelRatio}computeDistanceFromRadius(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))}getScreenCenter(a=C.createScreenPointArray()){a[0]=(this.padding[b.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;a[1]=(this.padding[b.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return a}getRenderCenter(a,c=.5,d=.5){a[0]=this.padding[b.PaddingSide.LEFT]+this.width*c;a[1]=this.padding[b.PaddingSide.BOTTOM]+this.height*
d;a[2]=.5;return a}setGLViewport(a){const c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])}applyProjection(a,c){a!==f&&h.copy(f,a);f[3]=1;k.transformMat4(f,f,this.projectionMatrix);a=Math.abs(f[3]);h.scale(f,f,1/a);const d=this.fullViewport;c[0]=t.lerp(0,d[0]+d[2],.5+.5*f[0]);c[1]=t.lerp(0,d[1]+d[3],.5+.5*f[1]);c[2]=.5*(f[2]+1);c[3]=a}unapplyProjection(a,c){const d=this.fullViewport;f[0]=(a[0]/(d[0]+d[2])*2-1)*a[3];f[1]=(a[1]/(d[1]+d[3])*2-1)*a[3];f[2]=
(2*a[2]-1)*a[3];f[3]=a[3];null!=this.inverseProjectionMatrix&&(k.transformMat4(f,f,this.inverseProjectionMatrix),c[0]=f[0],c[1]=f[1],c[2]=f[2])}projectToScreen(a,c){this.projectToRenderScreen(a,B);this.renderToScreen(B,c);return c}projectToRenderScreen(a,c){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=1;k.transformMat4(f,f,this.viewProjectionMatrix);if(0===f[3])return null;a=f;h.scale(a,a,1/Math.abs(f[3]));var d=this.fullViewport;const m=t.lerp(0,d[0]+d[2],.5+.5*a[0]);d=t.lerp(0,d[1]+d[3],.5+.5*a[1]);"x"in
c?(c.x=m,c.y=d):(c[0]=m,c[1]=d,2<c.length&&(c[2]=.5*(a[2]+1)));return c}unprojectFromScreen(a,c){return this.unprojectFromRenderScreen(this.screenToRender(a,B),c)}unprojectFromRenderScreen(a,c){n.multiply(x,this.projectionMatrix,this.viewMatrix);if(!n.invert(x,x))return null;const d=this.fullViewport;f[0]=2*(a[0]-d[0])/d[2]-1;f[1]=2*(a[1]-d[1])/d[3]-1;f[2]=2*a[2]-1;f[3]=1;k.transformMat4(f,f,x);if(0===f[3])return null;c[0]=f[0]/f[3];c[1]=f[1]/f[3];c[2]=f[2]/f[3];return c}constrainWindowSize(a,c,d,
m){a*=this.pixelRatio;c*=this.pixelRatio;return[Math.round(Math.max(a-d/2,0)),Math.round(Math.max(this.fullHeight-c-m/2,0)),Math.round(d- -Math.min(a-d/2,0)- -Math.min(this.fullWidth-a-d/2,0)),Math.round(m- -Math.min(this.fullHeight-c-m/2,0)- -Math.min(c-m/2,0))]}computeUp(a){a===K.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(a,c){const d=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=d;return c}renderToScreen(a,c){const d=(this.fullHeight-
a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=d}_computeUpGlobal(){h.subtract(l,this.center,this.eye);const a=h.length(this.center);1>a?(h.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(h.dot(l,this.center))>.9999*h.length(l)*a||(h.cross(this._up,l,this.center),h.cross(this._up,this._up,l),h.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){h.direction(l,this.eye,this.center);.9999>=Math.abs(l[2])&&(h.scale(l,l,l[2]),
h.set(this._up,-l[0],-l[1],1-l[2]),h.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(a,c,d=""){"number"===typeof a[0]&&isFinite(a[0])&&"number"===typeof a[1]&&isFinite(a[1])&&"number"===typeof a[2]&&isFinite(a[2])?h.exactEquals(a,c)||(h.copy(c,a),this._markViewDirty(),d.length&&this.notifyChange(d)):F.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=
this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(y.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(n.lookAt(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};e.__decorate([g.property()],b.Camera.prototype,"_viewport",void 0);e.__decorate([g.property()],b.Camera.prototype,"_padding",void 0);e.__decorate([g.property()],
b.Camera.prototype,"_fov",void 0);e.__decorate([g.property()],b.Camera.prototype,"_nearFar",void 0);e.__decorate([g.property()],b.Camera.prototype,"_viewDirty",void 0);e.__decorate([g.property()],b.Camera.prototype,"_viewMatrix",void 0);e.__decorate([g.property()],b.Camera.prototype,"_pixelRatio",void 0);e.__decorate([g.property()],b.Camera.prototype,"pixelRatio",null);e.__decorate([g.property()],b.Camera.prototype,"row",void 0);e.__decorate([g.property()],b.Camera.prototype,"column",void 0);e.__decorate([g.property()],
b.Camera.prototype,"_rows",void 0);e.__decorate([g.property()],b.Camera.prototype,"rows",null);e.__decorate([g.property()],b.Camera.prototype,"_columns",void 0);e.__decorate([g.property()],b.Camera.prototype,"columns",null);e.__decorate([g.property()],b.Camera.prototype,"eye",null);e.__decorate([g.property()],b.Camera.prototype,"center",null);e.__decorate([g.property()],b.Camera.prototype,"_center",void 0);e.__decorate([g.property()],b.Camera.prototype,"up",null);e.__decorate([g.property()],b.Camera.prototype,
"_up",void 0);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"viewForward",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"viewUp",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"viewRight",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"nearFar",null);e.__decorate([g.property()],b.Camera.prototype,"near",null);e.__decorate([g.property()],b.Camera.prototype,"far",null);e.__decorate([g.property()],b.Camera.prototype,"viewport",null);
e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"screenViewport",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"screenPadding",null);e.__decorate([g.property()],b.Camera.prototype,"x",null);e.__decorate([g.property()],b.Camera.prototype,"y",null);e.__decorate([g.property()],b.Camera.prototype,"width",null);e.__decorate([g.property()],b.Camera.prototype,"height",null);e.__decorate([g.property()],b.Camera.prototype,"fullWidth",null);e.__decorate([g.property()],b.Camera.prototype,
"fullHeight",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"_aspect",null);e.__decorate([g.property()],b.Camera.prototype,"padding",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"projectionMatrix",null);e.__decorate([g.property({readOnly:!0})],b.Camera.prototype,"inverseProjectionMatrix",null);e.__decorate([g.property()],b.Camera.prototype,"fov",null);e.__decorate([g.property()],b.Camera.prototype,"fovX",null);e.__decorate([g.property()],b.Camera.prototype,
"fovY",null);b.Camera=z=e.__decorate([G.subclass("esri.views.3d.webgl-engine.lib.Camera")],b.Camera);const f=r.create(),x=p.create(),l=q.create(),A=q.create(),B=C.createRenderScreenPointArray3();b.PaddingSide=void 0;(function(a){a[a.TOP=0]="TOP";a[a.RIGHT=1]="RIGHT";a[a.BOTTOM=2]="BOTTOM";a[a.LEFT=3]="LEFT"})(b.PaddingSide||(b.PaddingSide={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});