// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(d,e,f,g,h){class k{constructor(a,b,c,l){this._textureRepository=a;this._techniqueRepository=b;this.materialChanged=c;this.requestRender=l;this._id2glMaterialRef=new g.NestedMap}dispose(){this._textureRepository.destroy()}acquire(a,b,c){this._ownMaterial(a);b=a.produces.get(b);if(!b||!b(c))return null;b=this._id2glMaterialRef.get(c,a.id);null==b&&(b=a.createGLMaterial({material:a,techniqueRep:this._techniqueRepository,
textureRepository:this._textureRepository,output:c}),b=new m(b),this._id2glMaterialRef.set(c,a.id,b));b.ref();return b.glMaterial}release(a,b){const c=this._id2glMaterialRef.get(b,a.id);null!=c&&(c.unref(),c.referenced||(f.disposeMaybe(c.glMaterial),this._id2glMaterialRef.delete(b,a.id)))}_ownMaterial(a){a.repository&&a.repository!==this&&e.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");a.repository=this}}class m{constructor(a){this.glMaterial=
a;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;h.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}d.GLMaterialRepository=k;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});