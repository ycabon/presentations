// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define(["../../../../core/mathUtils"],function(g){class h{constructor(a,b=0){this._count=this._capacity=0;this._emptySlots=[];this._emptySlotCount=0;this._id2slot=new Map;this._slot2id=[];this.layout=a;this._resize(b)}prepareAllocate(a){a=this._count+a;a>this._capacity&&this._resize(a)}allocate(a){this._count>=this._capacity&&this._resize(this._count+1);const b=0<this._emptySlotCount?this._emptySlots[--this._emptySlotCount]:this._count;this._id2slot.set(a,b);this._slot2id[b]=a;this._count++;return b}prepareFree(a){this._emptySlots.length+=
a}free(a){const b=this._id2slot.get(a);null!=b&&(this._emptySlots.length<=this._emptySlotCount&&(this._emptySlots.length=this._emptySlotCount+1),this._emptySlots[this._emptySlotCount++]=b,this._id2slot.delete(a),this._slot2id[b]=null,this._count--)}getCount(){return this._count}getSlot(a){return this._id2slot.get(a)}hasSlot(a){return this._id2slot.has(a)}getBuffer(){return this._buffer}compact(){if(0<this._emptySlotCount){const a=this._emptySlots;let b=this._emptySlotCount,c=this._count+b;a.length=
b;for(a.sort((d,e)=>d-e);0<b;){if(a[b-1]!==c-1){const d=c-1,e=a[b-1];this._buffer.copyFrom(this._buffer,d,e,1);const f=this._slot2id[d];this._slot2id[d]=null;this._slot2id[e]=f;this._id2slot.set(f,e)}b--;c--}}this._emptySlotCount=0;this._emptySlots.length=0;this._resize(this._count)}_resize(a){var b=this._capacity;a=Math.max(0,a);0<a&&(a=g.nextHighestPowerOfTwo(a));if(a>b){const c=this.layout.createBuffer(a);this._buffer&&c.copyFrom(this._buffer,0,0,b);this._buffer=c}else a<b&&(b=this.layout.createBuffer(a),
b.copyFrom(this._buffer,0,0,a),this._buffer=b);this._buffer||(this._buffer=this.layout.createBuffer(0));this._capacity=a;this._slot2id.length=a}}return h});