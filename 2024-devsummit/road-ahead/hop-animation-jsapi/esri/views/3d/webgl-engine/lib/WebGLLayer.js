// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(d,k,l,m,e,n,f,p,q,g){class r extends n.ContentObject{get objects(){return this._objects}constructor(a,b,c=""){super();this.stage=a;this.apiLayerUid=c;this.type=f.ContentObjectType.Layer;this.events=new k;this.pickable=this.visible=!0;this.sliceable=!1;this._objects=new e;this._objectsAdded=
new e;this._handles=new l;this.apiLayerUid=c;this.visible=b?.visible??!0;this.pickable=b?.pickable??!0;this.updatePolicy=b?.updatePolicy??g.UpdatePolicy.ASYNC;this._disableOctree=b?.disableOctree??!1;a.add(this);for(const h of p.DirtyEventNames)this._handles.add(this.events.on(h,t=>a.handleEvent(h,t)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(a){this._objects.push(a);a.parentLayer=this;this.events.emit("layerObjectAdded",
{layer:this,object:a});null!=this._octree&&this._objectsAdded.push(a)}remove(a){this._objects.removeUnordered(a)&&(a.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:a}),null!=this._octree&&(this._objectsAdded.removeUnordered(a)||this._octree.remove([a])))}addMany(a){this._objects.pushArray(a);for(const b of a)b.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:a});null!=this._octree&&this._objectsAdded.pushArray(a)}removeMany(a){const b=[];this._objects.removeUnorderedMany(a,
a.length,b);if(0!==b.length){for(const c of b)c.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:b});if(null!=this._octree){for(a=0;a<b.length;)this._objectsAdded.removeUnordered(b[a])?(b[a]=b[b.length-1],--b.length):++a;this._octree.remove(b)}}}sync(){this.updatePolicy!==g.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(a,b){null==this._octree||this._objectsAdded.includes(a)||this._octree.update(a,b)}getSpatialQueryAccelerator(){null==this._octree&&
50<this._objects.length&&!this._disableOctree?(this._octree=new q(a=>a.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=m.destroyMaybe(this._octree);this._objectsAdded.clear()}}d.WebGLLayer=r;d.isWebGLLayer=function(a){return null!=a&&a.type===
f.ContentObjectType.Layer};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});