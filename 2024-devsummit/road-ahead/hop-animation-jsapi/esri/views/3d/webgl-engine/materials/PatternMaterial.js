// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),function(p,z,v,A,g,B,C,D,m,
w,h,E,F,G,H,x,q){class I extends G.TriangleMaterial{constructor(a){super(a,new y);this.supportsEdges=!0;this.produces=new Map([[m.RenderSlot.OPAQUE_MATERIAL,b=>g.isOIDorHighlight(b)],[m.RenderSlot.TRANSPARENT_MATERIAL,b=>g.isColorOrAlpha(b)],[m.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,b=>b===g.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth],[m.RenderSlot.DRAPED_MATERIAL,b=>this.parameters.draped&&b===g.ShaderOutput.Color||g.isOIDorHighlight(b)]]);this._vertexAttributeLocations=q.vertexAttributeLocations;
this._configuration=new q.PatternTechniqueConfiguration}getConfiguration(a,b){this._configuration.output=a;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=
this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=b.transparencyPassType;this._configuration.enableOffset=b.camera.relativeElevation<D.OITPolygonOffsetLimit;this._configuration.multipassEnabled=b.multipassEnabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration}createGLMaterial(a){return new J(a)}createBufferWriter(){const a=A.newLayout().vec3f(h.VertexAttribute.POSITION).vec4f(h.VertexAttribute.UVMAPSPACE);
this.parameters.draped||a.mat3f(h.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?a.f32(h.VertexAttribute.COLORFEATUREATTRIBUTE):a.vec4u8(h.VertexAttribute.COLOR);return new K(a)}}class J extends C{_updateParameters(a){return this.ensureTechnique(q.PatternTechnique,a)}_updateOccludeeState(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})}beginSlot(a){this._output!==g.ShaderOutput.Color&&this._output!==g.ShaderOutput.Alpha||
this._updateOccludeeState(a);return this._updateParameters(a)}}class K extends E.DefaultBufferWriter{write(a,b,k,d,e){for(const l of this.vertexBufferLayout.fields.keys()){const c=k.attributes.get(l);var f=c?.indices;if(c&&f)switch(l){case h.VertexAttribute.UVMAPSPACE:w.assert(4===c.size);(f=d.getField(l,v.BufferViewVec4f))&&x.writeBufferVec4(c,f,e);break;case h.VertexAttribute.BOUNDINGRECT:w.assert(9===c.size);(f=d.getField(l,v.BufferViewMat3f))&&this.writeBoundingRect(c,a,f,e);break;default:x.writeDefaultAttribute(l,
c,a,b,d,e)}}}writeBoundingRect(a,b,k,d){const {data:e,indices:f}=a;a=k.typedBuffer;k=k.typedBufferStride;const l=f.length;d*=k;for(let r=0;r<l;++r){const n=9*f[r];var c=e[n];const t=e[n+1],u=e[n+2];a[d]=b[0]*c+b[4]*t+b[8]*u+b[12];a[d+1]=b[1]*c+b[5]*t+b[9]*u+b[13];a[d+2]=b[2]*c+b[6]*t+b[10]*u+b[14];for(c=3;9>c;++c)a[d+c]=e[n+c];d+=k}}}class y extends H.VisualVariablePassParameters{constructor(){super(...arguments);this.color=z.fromValues(1,1,1,1);this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=
this.writeLinearDepth=!1;this.cullFace=B.CullFaceOptions.None;this.hasOccludees=!1;this.style=F.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}p.Parameters=y;p.PatternMaterial=I;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});