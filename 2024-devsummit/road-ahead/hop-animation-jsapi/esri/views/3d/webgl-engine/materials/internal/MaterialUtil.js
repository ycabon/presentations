// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),function(w,X,Y,G,I,K,Z,aa,ba,ca){function O(a,b,c,d,h,e){if(null!=a){var m=P(b,c,da);K.setMin(J,a.bbMin);K.setMax(J,a.bbMax);null!=h&&h.applyToAabb(J);if(Q(J,b,m,d)){const {primitiveIndices:p,
position:z}=a;m=p?p.length:z.indices.length/3;if(1E3<m&&(a=a.getChildren(),void 0!==a)){for(const C of a)O(C,b,c,d,h,e);return}L(b,c,0,m,z.indices,z,p,h,e)}}}function L(a,b,c,d,h,e,m,p,z){if(m){const {data:t,stride:D}=e;e=a[0];var C=a[1];a=a[2];var E=b[0]-e,F=b[1]-C;for(b=b[2]-a;c<d;++c){var y=m[c],f=3*y,g=D*h[f++],q=t[g++],l=t[g++],k=t[g];g=D*h[f++];var r=t[g++],v=t[g++],n=t[g];g=D*h[f];f=t[g++];var u=t[g++];g=t[g];null!=p&&([q,l,k]=p.applyToVertex(q,l,k,c),[r,v,n]=p.applyToVertex(r,v,n,c),[f,u,
g]=p.applyToVertex(f,u,g,c));r-=q;v-=l;n-=k;f-=q;u-=l;g-=k;var A=F*g-u*b,H=b*f-g*E;const R=E*u-f*F;var x=r*A+v*H+n*R;if(!(Math.abs(x)<=Number.EPSILON)){q=e-q;l=C-l;k=a-k;A=q*A+l*H+k*R;if(0<x){if(0>A||A>x)continue}else if(0<A||A<x)continue;H=l*n-v*k;k=k*r-n*q;l=q*v-r*l;q=E*H+F*k+b*l;if(0<x){if(0>q||A+q>x)continue}else if(0<q||A+q<x)continue;k=(f*H+u*k+g*l)/x;0<=k&&(r=M(r,v,n,f,u,g,S),z(k,r,y,!1))}}}else{var {data:B,stride:N}=e;m=a[0];e=a[1];C=a[2];a=b[0]-m;E=b[1]-e;F=b[2]-C;for(let t=c,D=3*c;t<d;++t)if(f=
N*h[D++],l=B[f++],k=B[f++],n=B[f],f=N*h[D++],b=B[f++],c=B[f++],y=B[f],f=N*h[D++],r=B[f++],v=B[f++],f=B[f],null!=p&&([l,k,n]=p.applyToVertex(l,k,n,t),[b,c,y]=p.applyToVertex(b,c,y,t),[r,v,f]=p.applyToVertex(r,v,f,t)),b-=l,c-=k,y-=n,r-=l,v-=k,f-=n,g=E*f-v*F,q=F*r-f*a,x=a*v-r*E,u=b*g+c*q+y*x,!(Math.abs(u)<=Number.EPSILON)){l=m-l;k=e-k;n=C-n;g=l*g+k*q+n*x;if(0<u){if(0>g||g>u)continue}else if(0<g||g<u)continue;q=k*y-c*n;n=n*b-y*l;k=l*c-b*k;l=a*q+E*n+F*k;if(0<u){if(0>l||g+l>u)continue}else if(0<l||g+l<
u)continue;n=(r*q+v*n+f*k)/u;0<=n&&(b=M(b,c,y,r,v,f,S),z(n,b,t,!1))}}}function M(a,b,c,d,h,e,m){G.set(T,a,b,c);G.set(U,d,h,e);G.cross(m,T,U);G.normalize(m,m);return m}function P(a,b,c){return G.set(c,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function Q(a,b,c,d){return V(a,b,c,d,Infinity)}function V(a,b,c,d,h){var e=(a[0]-d-b[0])*c[0],m=(a[3]+d-b[0])*c[0];let p=Math.min(e,m);e=Math.max(e,m);m=(a[1]-d-b[1])*c[1];const z=(a[4]+d-b[1])*c[1];e=Math.min(e,Math.max(m,z));if(0>e)return!1;p=Math.max(p,Math.min(m,
z));if(p>e)return!1;m=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];e=Math.min(e,Math.max(m,a));if(0>e)return!1;p=Math.max(p,Math.min(m,a));return p>e?!1:p<h}function W(a,b){b=b?W(b):{};for(const c in a){let d=a[c];d?.forEach&&(d=ea(d));null==d&&c in b||(b[c]=d)}return b}function ea(a){const b=[];a.forEach(c=>b.push(c));return b}const J=K.create(),da=I.create(),S=I.create(),T=I.create(),U=I.create();w.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};w.computeInvDir=P;w.computeNormal=M;w.copyParameters=
W;w.intersectAabbInvDir=Q;w.intersectAabbInvDirBefore=V;w.intersectTriangleGeometry=function(a,b,c,d,h,e){a.visible&&(a.boundingInfo?(ba.assert(a.type===Z.ContentObjectType.Mesh),O(a.boundingInfo,c,d,b.tolerance,h,e)):(a=a.attributes.get(ca.VertexAttribute.POSITION),b=a.indices,L(c,d,0,b.length/3,b,a,void 0,h,e)))};w.intersectTriangles=L;w.updateParameters=function(a,b){let c=!1;for(const d in b){const h=b[d];void 0!==h&&(Array.isArray(h)?null===a[d]?(a[d]=h.slice(),c=!0):X.update(a[d],h)&&(c=!0):
a[d]!==h&&(c=!0,a[d]=h))}return c};w.verticalOffsetAtDistance=function(a,b,c,d,h){let e=(c.screenLength||0)*a.pixelRatio;null!=h&&(e=aa.scale(e,d,b,h));return Y.clamp(e*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});