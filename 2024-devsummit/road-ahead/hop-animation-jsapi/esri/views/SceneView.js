// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/overrideDefaultsFrom":function(){define(["exports","../Accessor","./PropertyOrigin","./utils"],function(a,b,h,c){function k(m,d){var f=c.getProperties(m),g=c.getProperties(d);f=f.store;d=g.store;g=g.metadata;for(const l in g){var e=g[l],n=f.originOf(l);const u=d.originOf(l);e.readOnly||u===h.OriginId.DEFAULTS||(n!==h.OriginId.DEFAULTS?(e=f.get(l),n=d.get(l),e&&n&&n instanceof b&&e instanceof b&&e instanceof n.constructor&&k(e,n)):m.set(l,d.get(l)))}}a.overrideDefaultsFrom=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingRect":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","./projectBuffer","../support/aaBoundingRect","../support/spatialReferenceUtils"],function(a,b,h,c,k){const m=b.create();a.projectBoundingRect=function(d,f,g,e){if(null==d)return!1;if(k.equals(f,e))return c.copy(g,d),!0;m[0]=d[0];m[1]=d[1];m[2]=0;if(!h.projectBuffer(m,f,0,m,e,0,1))return!1;g[0]=m[0];g[1]=m[1];
m[0]=d[2];m[1]=d[3];m[2]=0;if(!h.projectBuffer(m,f,0,m,e,0,1))return!1;g[2]=m[0];g[3]=m[1];return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectBuffer"],function(a,b,h,c){function k(d,f,g,e){if(h.canProjectWithoutEngine(d.spatialReference,g))return m[0]=d.x,m[1]=d.y,m[2]=d.z??e??0,c.projectBuffer(m,d.spatialReference,0,f,g,0,1);
d=h.tryProjectWithZConversion(d,g);if(!d)return!1;f[0]=d?.x;f[1]=d?.y;f[2]=d?.z??e??0;return!0}const m=b.create();a.projectPointToVector=k;a.projectPointToVectorAsync=async function(d,f,g,e,n){await h.initializeProjection(d.spatialReference,g,null,n);return k(d,f,g,e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(Y=da){return{plane:l.create(Y.plane),origin:g.clone(Y.origin),basis1:g.clone(Y.basis1),basis2:g.clone(Y.basis2)}}function v(Y,ja,oa){const ra=Z.get();ra.origin=Y;ra.basis1=ja;ra.basis2=oa;ra.plane=l.wrap(0,0,0,0);y(ra);return ra}function p(Y,ja=q()){return r(Y.origin,Y.basis1,Y.basis2,ja)}function t(Y,ja){f.copy(ja.origin,Y.origin);f.copy(ja.basis1,Y.basis1);f.copy(ja.basis2,Y.basis2);l.copy(ja.plane,Y.plane)}function r(Y,ja,oa,ra=q()){f.copy(ra.origin,
Y);f.copy(ra.basis1,ja);f.copy(ra.basis2,oa);y(ra);1E-6<Math.abs(f.dot(ra.basis1,ra.basis2)/(f.length(ra.basis1)*f.length(ra.basis2)))&&ba().warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(f.dot(ra.basis1,ia(ra)))&&ba().warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-f.dot(ia(ra),ra.origin)-ra.plane[3])&&ba().warn("fromValues()","Plane offset is not consistent with plane origin");return ra}function y(Y){l.fromVectorsAndPoint(Y.basis2,
Y.basis1,Y.origin,Y.plane)}function D(Y,ja,oa){Y!==oa&&p(Y,oa);Y=f.scale(w.sv3d.get(),ia(Y),ja);f.add(oa.origin,oa.origin,Y);oa.plane[3]-=ja;return oa}function E(Y,ja,oa){A(ja,oa);D(oa,S(Y,Y.origin),oa);return oa}function A(Y,ja=q()){const oa=(Y[2]-Y[0])/2,ra=(Y[3]-Y[1])/2;f.set(ja.origin,Y[0]+oa,Y[1]+ra,0);f.set(ja.basis1,oa,0,0);f.set(ja.basis2,0,ra,0);l.fromValues(0,0,1,0,ja.plane);return ja}function B(Y,ja,oa){return l.intersectRay(Y.plane,ja,oa)?O(Y,oa):!1}function F(Y,ja,oa){if(B(Y,ja,oa))return oa;
Y=G(Y,ja,w.sv3d.get());f.add(oa,ja.origin,f.scale(w.sv3d.get(),ja.direction,f.distance(ja.origin,Y)/f.length(ja.direction)));return oa}function G(Y,ja,oa){const ra=ha.get();var ta=ha.get();R(Y,ja,ra,ta);ta=Number.POSITIVE_INFINITY;for(const Ca of ea){var ya=P(Y,Ca,fa.get());const pa=w.sv3d.get();l.intersectLineSegment(ra,ya,pa)&&(ya=f.direction(w.sv3d.get(),ja.origin,pa),ya=Math.abs(c.acosClamped(f.dot(ja.direction,ya))),ya<ta&&(ta=ya,f.copy(oa,pa)))}return ta===Number.POSITIVE_INFINITY?H(Y,ja,oa):
oa}function H(Y,ja,oa){if(B(Y,ja,oa))return oa;const ra=ha.get(),ta=ha.get();R(Y,ja,ra,ta);let ya=Number.POSITIVE_INFINITY;for(const pa of ea){var Ca=P(Y,pa,fa.get());const wa=w.sv3d.get();l.intersectLineSegmentClamp(ra,Ca,wa)&&(Ca=u.distance2(ja,wa),l.isPointInside(ta,wa)&&Ca<ya&&(ya=Ca,f.copy(oa,wa)))}z(Y,ja.origin)<ya&&L(Y,ja.origin,oa);return oa}function L(Y,ja,oa){var ra=l.projectPoint(Y.plane,ja,w.sv3d.get());ja=n.projectPointClamp(U(Y,Y.basis1),ra,-1,1,w.sv3d.get());ra=n.projectPointClamp(U(Y,
Y.basis2),ra,-1,1,w.sv3d.get());f.subtract(oa,f.add(w.sv3d.get(),ja,ra),Y.origin);return oa}function C(Y,ja,oa){const {origin:ra,basis1:ta,basis2:ya}=Y,Ca=f.subtract(w.sv3d.get(),ja,ra);ja=x.projectPointSignedLength(ta,Ca);const pa=x.projectPointSignedLength(ya,Ca);Y=x.projectPointSignedLength(ia(Y),Ca);return f.set(oa,ja,pa,Y)}function z(Y,ja){ja=C(Y,ja,w.sv3d.get());const {basis1:oa,basis2:ra}=Y;Y=f.length(oa);var ta=f.length(ra);Y=Math.max(Math.abs(ja[0])-Y,0);ta=Math.max(Math.abs(ja[1])-ta,0);
ja=ja[2];return Y*Y+ta*ta+ja*ja}function J(Y,ja){return Math.sqrt(z(Y,ja))}function K(Y,ja){let oa=Number.NEGATIVE_INFINITY;for(const ta of ea){var ra=P(Y,ta,fa.get());ra=n.distance2(ra,ja);ra>oa&&(oa=ra)}return Math.sqrt(oa)}function I(Y,ja){return l.isPointInside(Y.plane,ja)&&O(Y,ja)}function M(Y,ja,oa,ra){switch(oa){case e.Axis.X:f.copy(ra,Y.basis1);f.normalize(ra,ra);break;case e.Axis.Y:f.copy(ra,Y.basis2);f.normalize(ra,ra);break;case e.Axis.Z:f.copy(ra,ia(Y))}return ra}function S(Y,ja){const oa=
-Y.plane[3];return x.projectPointSignedLength(ia(Y),ja)-oa}function N(Y,ja,oa,ra){const ta=S(Y,ja);Y=f.scale(aa,ia(Y),oa-ta);f.add(ra,ja,Y);return ra}function V(Y,ja){return f.exactEquals(Y.basis1,ja.basis1)&&f.exactEquals(Y.basis2,ja.basis2)&&f.exactEquals(Y.origin,ja.origin)}function Q(Y,ja,oa){Y!==oa&&p(Y,oa);m.invert(ca,ja);m.transpose(ca,ca);f.transformMat4(oa.basis1,Y.basis1,ca);f.transformMat4(oa.basis2,Y.basis2,ca);f.transformMat4(l.getNormal(oa.plane),l.getNormal(Y.plane),ca);f.transformMat4(oa.origin,
Y.origin,ja);l.setOffsetFromPoint(oa.plane,oa.plane,oa.origin);return oa}function T(Y,ja,oa,ra){Y!==ra&&p(Y,ra);m.fromRotation(W,ja,oa);f.transformMat4(ra.basis1,Y.basis1,W);f.transformMat4(ra.basis2,Y.basis2,W);y(ra);return ra}function ia(Y){return l.getNormal(Y.plane)}function O(Y,ja){const oa=f.subtract(w.sv3d.get(),ja,Y.origin);ja=f.squaredLength(Y.basis1);const ra=f.squaredLength(Y.basis2),ta=f.dot(Y.basis1,oa);Y=f.dot(Y.basis2,oa);return 0>-ta-ja&&0>ta-ja&&0>-Y-ra&&0>Y-ra}function U(Y,ja){const oa=
fa.get();f.copy(oa.origin,Y.origin);f.copy(oa.vector,ja);return oa}function P(Y,ja,oa){const {basis1:ra,basis2:ta,origin:ya}=Y;Y=f.scale(w.sv3d.get(),ra,ja.origin[0]);const Ca=f.scale(w.sv3d.get(),ta,ja.origin[1]);f.add(oa.origin,Y,Ca);f.add(oa.origin,oa.origin,ya);Y=f.scale(w.sv3d.get(),ra,ja.direction[0]);ja=f.scale(w.sv3d.get(),ta,ja.direction[1]);f.scale(oa.vector,f.add(Y,Y,ja),2);return oa}function R(Y,ja,oa,ra){Y=ia(Y);l.fromVectorsAndPoint(Y,ja.direction,ja.origin,oa);l.fromVectorsAndPoint(l.getNormal(oa),
Y,ja.origin,ra)}const ba=()=>h.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class X{constructor(){this.plane=l.create();this.origin=g.create();this.basis1=g.create();this.basis2=g.create()}}b=X;const da={plane:l.create(),origin:g.fromValues(0,0,0),basis1:g.fromValues(1,0,0),basis2:g.fromValues(0,1,0)},ha=new k.ObjectStack(l.create),fa=new k.ObjectStack(n.create),aa=g.create(),Z=new k.ObjectStack(()=>q()),ea=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,
1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ca=d.create(),W=d.create();k=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,altitudeAt:S,axisAt:M,closestPoint:H,closestPointOnSilhouette:G,copy:p,copyWithoutVerify:t,create:q,distance:J,distance2:z,distanceToSilhouette:K,elevate:D,equals:V,extrusionContainsPoint:I,fromAABoundingRect:A,fromValues:r,intersectRay:B,intersectRayClosestSilhouette:F,normal:ia,projectPoint:L,projectPointLocal:C,rotate:T,setAltitudeAt:N,setExtent:E,
transform:Q,up:da,updateUnboundedPlane:y,wrap:v},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.altitudeAt=S;a.axisAt=M;a.boundedPlane=k;a.closestPoint=H;a.closestPointOnSilhouette=G;a.copy=p;a.copyWithoutVerify=t;a.create=q;a.distance=J;a.distance2=z;a.distanceToSilhouette=K;a.elevate=D;a.equals=V;a.extrusionContainsPoint=I;a.fromAABoundingRect=A;a.fromValues=r;a.intersectRay=B;a.intersectRayClosestSilhouette=F;a.normal=ia;a.projectPoint=L;a.projectPointLocal=C;a.rotate=T;a.setAltitudeAt=
N;a.setExtent=E;a.transform=Q;a.up=da;a.updateUnboundedPlane=y;a.wrap=v})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){class h{constructor(c){this._allocator=c;this._items=[];this._itemsPtr=0;this._grow()}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]}_reset(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);
this._itemsPtr=0}_grow(){for(let c=0;c<Math.max(8,Math.min(this._items.length,1024));c++)this._items.push(this._allocator())}}a.ObjectStack=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),function(a,b,h,c,k,m){function d(w){return w?{origin:k.clone(w.origin),vector:k.clone(w.vector)}:
{origin:k.create(),vector:k.create()}}function f(w,q){const v=x.get();v.origin=w;v.vector=q;return v}function g(w,q,v=d()){c.copy(v.origin,w);c.copy(v.vector,q);return v}function e(w,q){q=c.subtract(m.sv3d.get(),q,w.origin);var v=c.dot(w.vector,q);const p=c.dot(w.vector,w.vector);v=b.clamp(v/p,0,1);w=c.subtract(m.sv3d.get(),c.scale(m.sv3d.get(),w.vector,v),q);return c.dot(w,w)}function n(w,q,v,p,t){const {vector:r,origin:y}=w;q=c.subtract(m.sv3d.get(),q,y);q=c.dot(r,q)/c.squaredLength(r);c.scale(t,
r,b.clamp(q,v,p));return c.add(t,t,w.origin)}function l(w,q,v,p){const t=w.origin;var r=c.add(m.sv3d.get(),t,w.vector);w=q.origin;var y=c.add(m.sv3d.get(),w,q.vector),D=m.sv3d.get();q=m.sv3d.get();D[0]=t[0]-w[0];D[1]=t[1]-w[1];D[2]=t[2]-w[2];q[0]=y[0]-w[0];q[1]=y[1]-w[1];q[2]=y[2]-w[2];if(1E-6>Math.abs(q[0])&&1E-6>Math.abs(q[1])&&1E-6>Math.abs(q[2]))return!1;y=m.sv3d.get();y[0]=r[0]-t[0];y[1]=r[1]-t[1];y[2]=r[2]-t[2];if(1E-6>Math.abs(y[0])&&1E-6>Math.abs(y[1])&&1E-6>Math.abs(y[2]))return!1;r=D[0]*
q[0]+D[1]*q[1]+D[2]*q[2];var E=q[0]*y[0]+q[1]*y[1]+q[2]*y[2];const A=q[0]*q[0]+q[1]*q[1]+q[2]*q[2],B=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*A-E*E;if(1E-6>Math.abs(B))return!1;D=(r*E-(D[0]*y[0]+D[1]*y[1]+D[2]*y[2])*A)/B;r=(r+E*D)/A;v&&(D=b.clamp(D,0,1),r=b.clamp(r,0,1));v=m.sv3d.get();E=m.sv3d.get();v[0]=t[0]+D*y[0];v[1]=t[1]+D*y[1];v[2]=t[2]+D*y[2];E[0]=w[0]+r*q[0];E[1]=w[1]+r*q[1];E[2]=w[2]+r*q[2];p.tA=D;p.tB=r;p.pA=v;p.pB=E;p.distance2=c.squaredDistance(v,E);return!0}const u={tA:0,tB:0,pA:k.create(),pB:k.create(),
distance2:0},x=new h.ObjectStack(()=>d());a.closestLineSegmentDistance2=function(w,q){return l(w,q,!0,u)?u.distance2:null};a.closestLineSegmentPoint=function(w,q,v){return l(w,q,!0,u)?(c.copy(v,u.pA),!0):!1};a.closestRayDistance2=function(w,q){if(l(w,f(q.origin,q.direction),!1,u)){const {tA:v,pB:p,distance2:t}=u;if(0<=v&&1>=v)return t;if(0>v)return c.squaredDistance(w.origin,p);if(1<v)return c.squaredDistance(c.add(m.sv3d.get(),w.origin,w.vector),p)}return null};a.copy=function(w,q=d()){return g(w.origin,
w.vector,q)};a.create=d;a.distance=function(w,q){return Math.sqrt(e(w,q))};a.distance2=e;a.fromPoints=function(w,q,v=d()){c.copy(v.origin,w);c.subtract(v.vector,q,w);return v};a.fromValues=g;a.pointAt=function(w,q,v){return c.add(v,w.origin,c.scale(v,w.vector,q))};a.projectPoint=function(w,q,v){return n(w,q,0,1,v)};a.projectPointClamp=n;a.wrap=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],
function(a,b){const h=b.VectorStack.createVec2f64(),c=b.VectorStack.createVec3f64(),k=b.VectorStack.createVec4f64(),m=b.VectorStack.createMat3f64(),d=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=m;a.sm4d=d;a.sq4d=b;a.sv2d=h;a.sv3d=c;a.sv4d=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ./nextTick ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/factories/mat4f64 ./libs/gl-matrix-2/factories/quatf64 ./libs/gl-matrix-2/factories/vec2f64 ./libs/gl-matrix-2/factories/vec3f64 ./libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,h,c,k,m,d,f){class g{constructor(e){this._create=e;this._items=[];this._itemsPtr=0}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr>=this._items.length&&this._items.push(this._create());return this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e);this._itemsPtr=0}static createVec2f64(){return new g(m.create)}static createVec3f64(){return new g(d.create)}static createVec4f64(){return new g(f.create)}static createMat3f64(){return new g(h.create)}static createMat4f64(){return new g(c.create)}static createQuatf64(){return new g(k.create)}get test(){return{length:this._items.length}}}
a.VectorStack=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function h(f){return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8]]}function c(f,g,e,n,l,u,x,w,q){return[f,g,e,n,l,u,x,w,q]}function k(f,g){return new Float64Array(f,g,9)}const m=b(),d=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:h,create:b,createView:k,fromValues:c},Symbol.toStringTag,
{value:"Module"}));a.IDENTITY=m;a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.mat3f64=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function h(f){return[f[0],f[1],f[2],f[3]]}function c(f,g,e,n){return[f,g,e,n]}function k(f,g){return new Float64Array(f,g,4)}const m=b(),d=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:h,create:b,createView:k,
fromValues:c},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.quatf64=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function h(q){return[q[0],q[1]]}function c(q,v){return[q,v]}function k(q,v=[0,0]){const p=Math.min(2,q.length);for(let t=0;t<p;++t)v[t]=q[t];return v}function m(q,v){return new Float64Array(q,v,2)}
function d(){return[0,0]}function f(){return[1,1]}function g(){return[1,0]}function e(){return[0,1]}const n=[0,0],l=[1,1],u=[1,0],x=[0,1],w=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:u,UNIT_Y:x,ZEROS:n,clone:h,create:b,createView:m,fromArray:k,fromValues:c,ones:f,unitX:g,unitY:e,zeros:d},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_X=u;a.UNIT_Y=x;a.ZEROS=n;a.clone=h;a.create=b;a.createView=m;a.fromArray=k;a.fromValues=c;a.ones=f;a.unitX=g;a.unitY=e;a.vec2f64=w;a.zeros=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ../../core/libs/gl-matrix-2/math/common ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e){function n(C=F){return[C[0],C[1],C[2],C[3]]}function l(C,z){return u(z[0],z[1],z[2],z[3],C)}function u(C,z,J,K,I=n()){I[0]=
C;I[1]=z;I[2]=J;I[3]=K;return I}function x(C,z,J){var K=z[0]*z[0]+z[1]*z[1]+z[2]*z[2];K=1E-5<Math.abs(K-1)&&1E-12<K?1/Math.sqrt(K):1;J[0]=z[0]*K;J[1]=z[1]*K;J[2]=z[2]*K;J[3]=-(J[0]*C[0]+J[1]*C[1]+J[2]*C[2]);return J}function w(C,z,J,K=n()){var I=J[0]-z[0],M=J[1]-z[1],S=J[2]-z[2];J=C[0]-z[0];const N=C[1]-z[1],V=C[2]-z[2];z=M*V-S*N;S=S*J-I*V;I=I*N-M*J;M=z*z+S*S+I*I;M=1E-5<Math.abs(M-1)&&1E-12<M?1/Math.sqrt(M):1;K[0]=z*M;K[1]=S*M;K[2]=I*M;K[3]=-(K[0]*C[0]+K[1]*C[1]+K[2]*C[2]);return K}function q(C,z,
J,K=0,I=Math.floor(1/3*J),M=Math.floor(2/3*J)){if(3>J)return!1;z(y,K);let S=I,N=!1;for(;S<J-1&&!N;)z(D,S),S++,N=!h.exactEquals(y,D);if(!N)return!1;S=Math.max(S,M);for(N=!1;S<J&&!N;)z(E,S),S++,h.subtract(A,y,D),h.normalize(A,A),h.subtract(B,D,E),h.normalize(B,B),N=!h.exactEquals(y,E)&&!h.exactEquals(D,E)&&.99619469809>Math.abs(h.dot(A,B));if(!N)return 0===K&&1===I&&2===M?!1:q(C,z,J,0,1,2);w(y,D,E,C);return!0}function v(C,z,J){C=h.scale(g.sv3d.get(),C,h.dot(C,z));h.subtract(J,z,C);return J}function p(C,
z){return h.dot(C,z)+C[3]}function t(C,z,J,K,I){const M=h.dot(C,J);if(0===M)return!1;C=-(h.dot(C,z)+C[3])/M;K&G.CLAMP&&(C=b.clamp(C,0,1));if(!(K&G.INFINITE_MIN)&&0>C||!(K&G.INFINITE_MAX)&&1<C)return!1;h.add(I,z,h.scale(I,J,C));return!0}const r=k.exactEquals;k=k.equals;const y=c.create(),D=c.create(),E=c.create(),A=c.create(),B=c.create(),F=[0,0,1,0];var G;(function(C){C[C.NONE=0]="NONE";C[C.CLAMP=1]="CLAMP";C[C.INFINITE_MIN=4]="INFINITE_MIN";C[C.INFINITE_MAX=8]="INFINITE_MAX"})(G||={});const H=G.INFINITE_MIN|
G.INFINITE_MAX,L=G.INFINITE_MAX;a.clip=function(C,z){const J=h.dot(C,z.ray.direction);C=-p(C,z.ray.origin);if(0>C&&0<=J)return!1;if(-1E-6<J&&1E-6>J)return 0<C;if((0>C||0>J)&&!(0>C&&0>J))return!0;C/=J;0<J?C<z.c1&&(z.c1=C):C>z.c0&&(z.c0=C);return z.c0<=z.c1};a.clipInfinite=function(C,z){const J=h.dot(C,z.ray.direction);C=-p(C,z.ray.origin);if(-1E-6<J&&1E-6>J)return 0<C;C/=J;0<J?C<z.c1&&(z.c1=C):C>z.c0&&(z.c0=C);return z.c0<=z.c1};a.copy=l;a.create=n;a.distance=function(C,z){return Math.abs(p(C,z))};
a.equals=k;a.exactEquals=r;a.fromArray=function(C,z,J=!0){const K=z.length/3;return q(C,(I,M)=>h.set(I,z[3*M],z[3*M+1],z[3*M+2]),J?K-1:K)};a.fromManyPoints=q;a.fromNormalAndOffset=function(C,z,J){h.copy(J,C);J[3]=z;return J};a.fromPoints=w;a.fromPositionAndNormal=x;a.fromValues=u;a.fromVectorsAndPoint=function(C,z,J,K){h.cross(E,z,C);return x(J,E,K)};a.getNormal=function(C){return C};a.intersectLine=function(C,z,J,K){J=h.subtract(g.sv3d.get(),J,z);return t(C,z,J,H,K)};a.intersectLineSegment=function(C,
z,J){return t(C,z.origin,z.vector,G.NONE,J)};a.intersectLineSegmentClamp=function(C,z,J){return t(C,z.origin,z.vector,G.CLAMP,J)};a.intersectRay=function(C,z,J){return null!=z?t(C,z.origin,z.direction,L,J):!1};a.isPointInside=function(C,z){return 0<=p(C,z)};a.isPointOutside=function(C,z){return 0>p(C,z)};a.isSphereFullyInside=function(C,z){return 0<=p(C,d.getCenter(z))-z[3]};a.isSphereFullyOutside=function(C,z){return 0>p(C,d.getCenter(z))+z[3]};a.isVertical=function(C){return Math.abs(C[2])<m.getEpsilon()};
a.negate=function(C,z){z[0]=-C[0];z[1]=-C[1];z[2]=-C[2];z[3]=-C[3];return z};a.projectPoint=function(C,z,J){const K=h.scale(g.sv3d.get(),C,-C[3]);z=h.subtract(g.sv3d.get(),z,K);C=v(C,z,g.sv3d.get());h.add(J,C,K);return J};a.projectPointLocal=function(C,z,J,K){var I=g.sv3d.get(),M=g.sv3d.get();e.tangentFrame(C,I,M);z=h.subtract(g.sv3d.get(),J,z);I=f.projectPointSignedLength(I,z);M=f.projectPointSignedLength(M,z);C=f.projectPointSignedLength(C,z);return h.set(K,I,M,C)};a.projectVector=v;a.setOffsetFromPoint=
function(C,z,J){z!==C&&l(C,z);C[3]=-h.dot(C,J);return C};a.signedDistance=p;a.up=F;a.wrap=function(C=F[0],z=F[1],J=F[2],K=F[3]){return u(C,z,J,K,g.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../core/libs/gl-matrix-2/math/common ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(){return g.create()}function q(ha,fa){return f.copy(fa,ha)}function v(ha,fa){return g.fromValues(ha[0],ha[1],ha[2],fa)}function p(ha){return ha}function t(ha){ha[0]=ha[1]=ha[2]=ha[3]=0}function r(ha,fa){ha[0]=ha[1]=ha[2]=0;ha[3]=fa;return ha}function y(ha){return ha[3]}function D(ha){return ha}function E(ha,fa,aa,Z){return g.fromValues(ha,fa,aa,Z)}function A(ha,fa,aa){ha!==aa&&(aa[0]=ha[0],aa[1]=ha[1],aa[2]=ha[2]);aa[3]=ha[3]+fa;return aa}function B(ha,
fa,aa){h.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");ha!==aa&&q(ha,aa);return aa}function F(ha,fa,aa){if(null==fa||!H(ha,fa,U))return!1;let {t0:Z,t1:ea}=U;if(0>Z||ea<Z&&0<ea)Z=ea;if(0>Z)return!1;if(aa){const {origin:ca,direction:W}=fa;aa[0]=ca[0]+W[0]*Z;aa[1]=ca[1]+W[1]*Z;aa[2]=ca[2]+W[2]*Z}return!0}function G(ha,fa,aa){fa=l.fromPoints(fa,aa);if(!H(ha,fa,U))return[];const {origin:Z,direction:ea}=fa,{t0:ca,t1:W}=U;fa=Y=>{const ja=d.create();m.scaleAndAdd(ja,
Z,ea,Y);return K(ha,ja,ja)};return Math.abs(ca-W)<e.getEpsilon()?[fa(ca)]:[fa(ca),fa(W)]}function H(ha,fa,aa){const {origin:Z,direction:ea}=fa,ca=P;ca[0]=Z[0]-ha[0];ca[1]=Z[1]-ha[1];ca[2]=Z[2]-ha[2];fa=ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2];if(0===fa)return!1;const W=2*(ea[0]*ca[0]+ea[1]*ca[1]+ea[2]*ca[2]);ha=W*W-4*fa*(ca[0]*ca[0]+ca[1]*ca[1]+ca[2]*ca[2]-ha[3]*ha[3]);if(0>ha)return!1;ha=Math.sqrt(ha);aa.t0=(-W-ha)/(2*fa);aa.t1=(-W+ha)/(2*fa);return!0}function L(ha,fa){return F(ha,fa,null)}function C(ha,
fa,aa){if(F(ha,fa,aa))return aa;ha=z(ha,fa,x.sv3d.get());m.add(aa,fa.origin,m.scale(x.sv3d.get(),fa.direction,m.distance(fa.origin,ha)/m.length(fa.direction)));return aa}function z(ha,fa,aa){const Z=x.sv3d.get(),ea=x.sm4d.get();m.cross(Z,fa.origin,fa.direction);const ca=ha[3];m.cross(aa,Z,fa.origin);m.scale(aa,aa,1/m.length(aa)*ca);ha=M(ha,fa.origin);fa=u.angle(fa.origin,aa);k.fromRotation(ea,fa+ha,Z);m.transformMat4(aa,aa,ea);return aa}function J(ha,fa,aa){if(F(ha,fa,aa))return aa;l.closestPoint(fa,
ha,aa);return K(ha,aa,aa)}function K(ha,fa,aa){fa=m.subtract(x.sv3d.get(),fa,ha);fa=m.scale(x.sv3d.get(),fa,ha[3]/m.length(fa));return m.add(aa,fa,ha)}function I(ha,fa){fa=m.subtract(x.sv3d.get(),fa,ha);fa=m.squaredLength(fa);return Math.sqrt(Math.abs(fa-ha[3]*ha[3]))}function M(ha,fa){fa=m.subtract(x.sv3d.get(),fa,ha);fa=m.length(fa);ha=ha[3];return c.acosClamped(ha/(ha+Math.abs(ha-fa)))}function S(ha,fa,aa,Z){ha=m.subtract(R,fa,ha);switch(aa){case n.Axis.X:return aa=c.cartesianToSpherical(ha,R)[2],
m.set(Z,-Math.sin(aa),Math.cos(aa),0);case n.Axis.Y:return ha=c.cartesianToSpherical(ha,R),aa=ha[1],ha=ha[2],fa=Math.sin(aa),m.set(Z,-fa*Math.cos(ha),-fa*Math.sin(ha),Math.cos(aa));case n.Axis.Z:return m.normalize(Z,ha)}}function N(ha,fa){fa=m.subtract(ba,fa,ha);return m.length(fa)-ha[3]}function V(ha,fa,aa,Z){const ea=N(ha,fa);ha=S(ha,fa,n.Axis.Z,ba);aa=m.scale(ba,ha,aa-ea);return m.add(Z,fa,aa)}function Q(ha,fa){fa=m.squaredDistance(ha,fa);ha=ha[3];return fa<=ha*ha}function T(ha,fa,aa=g.create()){const Z=
m.distance(ha,fa),ea=ha[3],ca=fa[3];if(Z+ca<ea)return f.copy(aa,ha),aa;if(Z+ea<ca)return f.copy(aa,fa),aa;m.lerp(aa,ha,fa,(Z+ca-ea)/(2*Z));aa[3]=(Z+ea+ca)/2;return aa}b=w();const ia=f.equals,O=f.equals,U={t0:0,t1:0},P=d.create(),R=d.create(),ba=d.create(),X=w(),da=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:b,altitudeAt:N,angleToSilhouette:M,axisAt:S,clear:t,closestPoint:J,closestPointOnSilhouette:z,containsPoint:Q,copy:q,create:w,distanceToSilhouette:I,elevate:A,equals:O,exactEquals:ia,
fromCenterAndRadius:v,fromRadius:r,fromValues:E,getCenter:D,getRadius:y,intersectLine:G,intersectRay:F,intersectRayClosestSilhouette:C,intersectsRay:L,projectPoint:K,setAltitudeAt:V,setExtent:B,tmpSphere:X,union:T,wrap:p},Symbol.toStringTag,{value:"Module"}));a.NullSphere=b;a.altitudeAt=N;a.angleToSilhouette=M;a.axisAt=S;a.clear=t;a.closestPoint=J;a.closestPointOnSilhouette=z;a.containsPoint=Q;a.copy=q;a.create=w;a.distanceToSilhouette=I;a.elevate=A;a.equals=O;a.exactEquals=ia;a.fromCenterAndRadius=
v;a.fromRadius=r;a.fromValues=E;a.getCenter=D;a.getRadius=y;a.intersectLine=G;a.intersectRay=F;a.intersectRayClosestSilhouette=C;a.intersectsRay=L;a.projectPoint=K;a.setAltitudeAt=V;a.setExtent=B;a.sphere=da;a.tmpSphere=X;a.union=T;a.wrap=p})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),function(a,b,h,c,k,m){function d(l){return l?f(k.clone(l.origin),
k.clone(l.direction)):f(k.create(),k.create())}function f(l,u){return{origin:l,direction:u}}function g(l,u,x=d()){c.copy(x.origin,l);c.copy(x.direction,u);return x}function e(l,u){l=c.cross(m.sv3d.get(),c.normalize(m.sv3d.get(),l.direction),c.subtract(m.sv3d.get(),u,l.origin));return c.dot(l,l)}const n=new h.ObjectStack(()=>d());a.closestPoint=function(l,u,x){u=c.dot(l.direction,c.subtract(x,u,l.origin));c.add(x,l.origin,c.scale(x,l.direction,u));return x};a.copy=function(l,u=d()){return g(l.origin,
l.direction,u)};a.create=d;a.distance=function(l,u){return Math.sqrt(e(l,u))};a.distance2=e;a.equals=function(l,u){return b.equals(l.origin,u.origin)&&b.equals(l.direction,u.direction)};a.fromPoints=function(l,u,x=d()){c.copy(x.origin,l);c.subtract(x.direction,u,l);return x};a.fromValues=g;a.wrap=function(l,u){const x=n.get();x.origin=l;x.direction=u;return x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils",
"../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,h,c){const k=c.create(),m=c.create();a.angle=function(d,f){d=h.dot(d,f)/(h.length(d)*h.length(f));return-b.acosClamped(d)};a.angleAroundAxis=function(d,f,g){h.normalize(k,d);h.normalize(m,f);d=h.dot(k,m);d=b.acosClamped(d);f=h.cross(k,k,m);return 0>h.dot(f,g)?2*Math.PI-d:d};a.projectPoint=function(d,f,g){f=h.dot(d,f)/h.dot(d,d);return h.scale(g,d,f)};a.projectPointSignedLength=function(d,f){return h.dot(d,f)/h.length(d)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,h,c){const k=c.create(),m=c.create(),d=c.create(),f=c.create(),g=c.create();a.angle=function(e,n,l){e=h.normalize(f,e);n=h.normalize(g,n);const u=b.acosClamped(h.dot(e,n));return l&&(e=h.cross(d,e,n),0>h.dot(e,l))?-u:u};a.bilerp=function(e,n,l,u,x,w){e+=(n-e)*
x;return e+(l+(u-l)*x-e)*w};a.cosCapped=function(e,n){return e>n?Math.cos(n):Math.cos(e)};a.fovx2fovy=function(e,n,l){return 2*Math.atan(l*Math.tan(.5*e)/n)};a.fovy2fovx=function(e,n,l){return 2*Math.atan(n*Math.tan(.5*e)/l)};a.makeOrthonormal=function(e,n,l){l=l||e;const u=h.dot(e,n);h.set(l,e[0]-u*n[0],e[1]-u*n[1],e[2]-u*n[2]);h.normalize(l,l)};a.makePiecewiseLinearFunction=function(e){const n=e.length;return l=>{if(l<=e[0][0])return e[0][1];if(l>=e[n-1][0])return e[n-1][1];let u=1;for(;l>e[u][0];)u++;
const x=e[u][0];l=(x-l)/(x-e[u-1][0]);return l*e[u-1][1]+(1-l)*e[u][1]}};a.maxScale=function(e){return Math.sqrt(Math.max(e[0]*e[0]+e[4]*e[4]+e[8]*e[8],e[1]*e[1]+e[5]*e[5]+e[9]*e[9],e[2]*e[2]+e[6]*e[6]+e[10]*e[10]))};a.midpoint3d=function(e,n){h.set(n,0,0,0);if(0<e.length){for(let l=0;l<e.length;++l)h.add(n,n,e[l]);h.scale(n,n,1/e.length)}};a.planeFromPoints=function(e,n,l,u){h.subtract(k,n,e);h.subtract(m,l,e);h.cross(u,k,m);h.normalize(u,u);u[3]=-h.dot(e,u)};a.scaleFromMatrix=function(e,n){h.set(e,
Math.sqrt(n[0]*n[0]+n[4]*n[4]+n[8]*n[8]),Math.sqrt(n[1]*n[1]+n[5]*n[5]+n[9]*n[9]),Math.sqrt(n[2]*n[2]+n[6]*n[6]+n[10]*n[10]));return e};a.slerp=function(e,n,l,u=c.create()){const x=h.length(e);var w=h.length(n),q=h.dot(e,n)/(x*w);if(.9999999999999999>q){q=Math.acos(q);const v=((1-l)*x+l*w)/Math.sin(q);w=v/w*Math.sin(l*q);h.scale(f,e,v/x*Math.sin((1-l)*q));h.scale(g,n,w);return h.add(u,f,g)}return h.lerp(u,e,n,l)};a.slerpTangent=function(e,n,l,u=c.create(),x=c.create()){const w=h.length(e),q=h.length(n);
var v=h.dot(e,n)/(w*q);if(.9999999999999999>v){v=Math.acos(v);const p=Math.sin(v),t=Math.sin(l*v),r=Math.sin((1-l)*v),y=(1-l)*w+l*q,D=y/p,E=D/q*t;h.scale(f,e,D/w*r);h.scale(g,n,E);h.add(u,f,g);h.scale(f,e,1/w*(-Math.cos((1-l)*v)*v*y+r*(-w+q)));h.scale(g,n,1/q*(Math.cos(l*v)*v*y+t*(-w+q)));h.add(x,f,g);h.scale(x,x,1/p);return x}h.lerp(u,e,n,l);h.subtract(x,n,e);h.normalize(x,x);return x};a.tangentFrame=function(e,n,l){Math.abs(e[0])>Math.abs(e[1])?h.set(n,0,1,0):h.set(n,1,0,0);h.cross(l,e,n);h.cross(n,
l,e);h.normalize(l,l);h.normalize(n,n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,h,c,k,m,d,f,g,e){function n(p){return{operations:p,value:p.create()}}function l(p,
t,r=n(p)){r.operations=p;p.copy(t,r.value);return r}function u(p,t,r,y){return p.operations.setAltitudeAt(p.value,t,r,y)}const x=2**50,w=c.create(),q={operations:null,value:null},v=c.create();a.altitudeAt=function(p,t){return p.operations.altitudeAt(p.value,t)};a.axisAt=function(p,t,r,y){return p.operations.axisAt(p.value,t,r,y)};a.closestPoint=function(p,t,r){return p.operations.closestPoint(p.value,t,r)};a.closestPointOnSilhouette=function(p,t,r){return p.operations.closestPointOnSilhouette(p.value,
t,r)};a.coordinateSystemFromOneAxisAndNormalVector=function(p,t,r,y,D){h.copy(r,p);h.copy(v,t);h.normalize(v,v);h.cross(y,v,r);h.cross(D,y,r)};a.create=function(p){const {value:t,operations:r}=p;return{operations:r,value:r.create(t)}};a.createFromOperations=n;a.createGlobal=function(p){return l(e.sphere,e.fromValues(0,0,0,k.getReferenceEllipsoid(p).radius))};a.createLocal=function(){return l(g.boundedPlane,g.fromValues([0,0,0],[x,0,0],[0,x,0]))};a.distanceToSilhouette=function(p,t){return p.operations.distanceToSilhouette(p.value,
t)};a.elevate=function(p,t,r){return p.operations.elevate(p.value,t,r.value)};a.fromValues=l;a.intersectRay=function(p,t,r){return p.operations.intersectRay(p.value,t,r)};a.intersectRayClosestSilhouette=function(p,t,r){return p.operations.intersectRayClosestSilhouette(p.value,t,r)};a.intersectsRay=function(p,t){return p.operations.intersectRay(p.value,t,null)};a.normalAt=function(p,t,r){return p.operations.axisAt(p.value,t,f.Axis.Z,r)};a.renderSRFromViewSR=function(p,t){return p?d.getSphericalPCPF(t):
t.isGeographic?m.PlateCarree:t};a.setAltitudeAt=u;a.setAltitudeOfTransformation=function(p,t,r,y){t!==y&&b.copy(y,t);h.set(w,y[12],y[13],y[14]);u(p,w,r,w);y[12]=w[0];y[13]=w[1];y[14]=w[2];return y};a.setExtent=function(p,t,r){p.operations.setExtent(p.value,t,r.value);return r};a.vectorCoordinates=function(p,t,r,y,D){D[0]=h.dot(p,t);D[1]=h.dot(p,r);D[2]=h.dot(p,y);return D};a.wrap=function(p,t){q.operations=p;q.value=t;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports",
"./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(a,b,h,c){const k=new h(b.SphericalECEFSpatialReferenceLike),m=new h(b.SphericalPCPFMarsLike),d=new h(b.SphericalPCPFMoonLike);b=new h(b.WGS84ECEFSpatialReferenceLike);a.SphericalECEFSpatialReference=k;a.SphericalPCPFMars=m;a.SphericalPCPFMoon=d;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(f){return f&&(c.isMars(f)||c.equals(f,m))?m:f&&(c.isMoon(f)||c.equals(f,d))?d:k};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(a,b,h){function c(k,m){m=h.getMetersPerUnitForSR(m);return k/(m*h.inchesPerMeter*96)}a.getExtentForScale=function(k,m){const d=k.extent;k=k.width-(k.padding?k.padding.left+k.padding.right:0);m=c(m,d.spatialReference);return d.clone().expand(m*k/d.width)};a.getResolutionForScale=c;a.getResolutionInMetersForScale=function(k){return k/(96*h.inchesPerMeter)};a.getScale=
function(k,m){m=m||k.extent;k=k.width;const d=h.getMetersPerUnitForSR(m?.spatialReference);return m&&k?m.width/k*d*h.inchesPerMeter*96:0};a.getScaleForResolution=function(k,m){m=h.getMetersPerUnitForSR(m);return k*m*h.inchesPerMeter*96};a.isInScaleRange=function(k,m,d){if(m=0===m||b.floatEqualAbsolute(k,m)||k<m)m=0===d||b.floatEqualAbsolute(k,d)||k>d;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/tslib.es6 ../core/ArrayPool ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(u,x){return x?n[u].valueToClassName[x].split(" "):[]}const n={widthBreakpoint:{getValue(u){const x=u.viewSize[0];u=u.breakpoints;const w=this.values;return x<=u.xsmall?w.xsmall:x<=u.small?w.small:x<=u.medium?w.medium:x<=u.large?w.large:w.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(u){const x=u.viewSize[1];u=u.breakpoints;const w=this.values;return x<=u.xsmall?w.xsmall:x<=u.small?w.small:x<=u.medium?w.medium:x<=u.large?w.large:w.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(u){u=u.viewSize;const x=this.values;return u[1]>=u[0]?x.portrait:x.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},l={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
u=>{u=class extends u{constructor(...x){super(...x);this.heightBreakpoint=this.widthBreakpoint=this.orientation=null;this.breakpoints=l}initialize(){this.addHandles(c.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),c.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(x){var w=this._get("breakpoints");if(x!==w){w=(w=x)&&w.xsmall<w.small&&w.small<w.medium&&w.medium<w.large;if(!w){const q=JSON.stringify(l,null,2);console.warn("provided breakpoints are not valid, using defaults:"+
q)}x=w?x:l;this._set("breakpoints",{...x})}}_updateClassNames(){if(this.container){var x=h.acquire(),w=h.acquire(),q=!1,v;for(v in n){const p=this[v],t=n[v].getValue({viewSize:this.size,breakpoints:this.breakpoints});p!==t&&(q=!0,this[v]=t,e(v,p).forEach(r=>w.push(r)),e(v,t).forEach(r=>x.push(r)))}q&&(this._applyClassNameChanges(x,w),h.release(x),h.release(w))}}_applyClassNameChanges(x,w){const q=this.container;q&&(w.forEach(v=>q.classList.remove(v)),x.forEach(v=>q.classList.add(v)))}_removeActiveClassNames(){const x=
this.container;if(x)for(var w in n)e(w,this[w]).forEach(q=>x.classList.remove(q))}};b.__decorate([k.property()],u.prototype,"breakpoints",null);b.__decorate([k.property()],u.prototype,"orientation",void 0);b.__decorate([k.property()],u.prototype,"widthBreakpoint",void 0);b.__decorate([k.property()],u.prototype,"heightBreakpoint",void 0);return u=b.__decorate([g.subclass("esri.views.BreakpointsOwner")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/tslib.es6 ../intl ../core/domUtils ../core/events ../core/has ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../intl/locale ../intl/messages".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(t){t&&(c.empty(t),t.parentNode&&t.parentNode.removeChild(t))}const p=[0,0];a.DOMContainer=t=>{t=class extends t{constructor(...r){super(...r);this._freqInfo={freq:16,time:750};this._overlayRenderTaskHandle=null;this.height=0;this.position=this.overlay=this.messagesCommon=null;this.resizing=!1;this.surface=this.root=null;this.suspended=!0;this.userContent=this.ui=null;this.width=0;this.widthBreakpoint=null;this.addHandles([g.watch(()=>this.cursor,
y=>{const {surface:D}=this;D&&D.setAttribute("data-cursor",y)}),g.watch(()=>this.navigating,y=>{const {surface:D}=this;D&&D.setAttribute("data-navigating",y.toString())})])}initialize(){const r=m("mac"),y=async()=>{r&&(await g.whenOnce(()=>this.ready),this.messagesCommon=await q.fetchMessageBundle("esri/t9n/common").catch(()=>{}))};y();this.addHandles([g.watch(()=>this.ui,(D,E)=>this._handleUIChange(D,E),g.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),
w.onLocaleChange(y),g.watch(()=>[this.surface,this.messagesCommon],()=>{r&&this.surface?.setAttribute("aria-label",this.messagesCommon?.ariaLabels?.navigationMacVoiceOver??"")})])}destroy(){this.destroyed||(this.ui=f.destroyMaybe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){var y=this._get("container");const D=c.byId(r);D||"string"!==typeof r||d.getLogger(this).error("#container",`element with id '${r}' not found`);if(y!==D)if(this._stopMeasuring(),
y&&(y.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(v(this.root),this._set("root",null)),this.userContent&&(c.reparent(this.userContent,y),v(this.userContent),this._set("userContent",null))),D){D.classList.add("esri-view");r=document.createElement("div");r.className="esri-view-user-storage";c.reparent(D,r);D.appendChild(r);this._set("userContent",
r);r=document.createElement("div");r.className="esri-view-root";D.insertBefore(r,D.firstChild);this._set("root",r);y=document.createElement("div");y.className="esri-view-surface";y.setAttribute("role","application");y.tabIndex=0;r.appendChild(y);this._set("surface",y);var E=new x;r.appendChild(E.surface);this._set("overlay",E);this.addHandles(g.watch(()=>E.needsRender,A=>{this._overlayRenderTaskHandle=A&&!this._overlayRenderTaskHandle?e.addFrameTask({render:()=>this.overlay?.render()}):f.removeMaybe(this._overlayRenderTaskHandle)}));
this.forceDOMReadyCycle();this._set("container",D);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,y,D){const E=this.position;r-=E?E[0]:0;y-=E?E[1]:0;D?(D[0]=r,D[1]=
y):D=[r,y];return D}containerToPage(r,y,D){const E=this.position;r+=E?E[0]:0;y+=E?E[1]:0;D?(D[0]=r,D[1]=y):D=[r,y];return D}_handleUIChange(r,y){this.removeHandles("ui");y&&y!==r&&y.destroy();r&&(r.view=this,this.addHandles(g.watch(()=>this.root,D=>{if(D){const E=document.createElement("div");D.appendChild(E);D=E}else D=null;r.container=D},g.initial),"ui"));this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=
this._freqInfo;r.freq=16;r.time=750;this.addHandles([k.on(window,"resize",()=>{r.freq=16;r.time=750}),e.addFrameTask({prepare:y=>{const D=this._measure(),E=this._freqInfo;E.time+=y.deltaTime;D&&(E.freq=16,this._get("resizing")||this._set("resizing",!0));E.time<E.freq||(E.time=0,this._position()||D?E.freq=16:E.freq=Math.min(750,2*E.freq),!D&&512<=E.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()}_measure(){var r=this.container;const y=r?r.clientWidth:
0;r=r?r.clientHeight:0;if(0===y||0===r)return this.suspended||this._set("suspended",!0),!1;const D=this.width,E=this.height;if(y===D&&r===E)return this.suspended&&this._set("suspended",!1),!1;this._set("width",y);this._set("height",r);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:D,oldHeight:E,width:y,height:r});return!0}_position(){var r=this.container;const y=this.position;var D;if(D=r)D=(r.ownerDocument||window.document).defaultView,r=r.getBoundingClientRect(),p[0]=r.left+
(D?.pageXOffset??0),p[1]=r.top+(D?.pageYOffset??0),D=p;r=D;return r?y&&r[0]===y[0]&&r[1]===y[1]?!1:(this._set("position",[r[0],r[1]]),!0):!1}forceDOMReadyCycle(){}};b.__decorate([n.property()],t.prototype,"container",null);b.__decorate([n.property({readOnly:!0})],t.prototype,"focused",null);b.__decorate([n.property({readOnly:!0})],t.prototype,"height",void 0);b.__decorate([n.property()],t.prototype,"messagesCommon",void 0);b.__decorate([n.property({type:x})],t.prototype,"overlay",void 0);b.__decorate([n.property({readOnly:!0})],
t.prototype,"position",void 0);b.__decorate([n.property({readOnly:!0})],t.prototype,"resizing",void 0);b.__decorate([n.property({readOnly:!0})],t.prototype,"root",void 0);b.__decorate([n.property({value:null,readOnly:!0})],t.prototype,"size",null);b.__decorate([n.property({readOnly:!0})],t.prototype,"surface",void 0);b.__decorate([n.property({readOnly:!0})],t.prototype,"suspended",void 0);b.__decorate([n.property()],t.prototype,"ui",void 0);b.__decorate([n.property({readOnly:!0})],t.prototype,"userContent",
void 0);b.__decorate([n.property({readOnly:!0})],t.prototype,"width",void 0);b.__decorate([n.property()],t.prototype,"widthBreakpoint",void 0);return t=b.__decorate([u.subclass("esri.views.DOMContainer")],t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){b=class extends b{constructor(){super(...arguments);this.items=new h;this._watchUpdatingTracking=new g.UpdatingHandles;this._callbacks=new Map;this._projector=n.createProjector();this._hiddenProjector=n.createProjector()}get needsRender(){return 0<this.items.length}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const l=document.createElement("div");l.className="esri-overlay-surface";this._set("surface",l);this._hiddenSurface=document.createElement("div");
this._hiddenSurface.setAttribute("style","visibility: hidden;");l.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,u=>{for(const x of u.added){const w=()=>x.render();this._callbacks.set(x,w);this._projector.append(this.surface,w)}for(const x of u.removed)u=this._projector.detach(this._callbacks.get(x)),this.surface.removeChild(u.domNode),this._callbacks.delete(x)})}addItem(l){this.items.add(l)}removeItem(l){this.items.remove(l)}destroy(){this.items.removeAll();
this._callbacks.forEach(l=>this._projector.detach(l));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(l){const u=this._hiddenSurface,x=this._hiddenProjector;let w;const q=()=>w=l.render();x.append(u,q);x.renderNow();const v={left:0,top:0,right:0,bottom:0};if(w?.domNode){const p=w.domNode.getBoundingClientRect();v.left=p.left;v.top=p.top;v.right=p.right;v.bottom=p.bottom}for(x.detach(q);u.firstChild;)u.removeChild(u.firstChild);
return v}overlaps(l,u){l=this.computeBoundingRect(l);u=this.computeBoundingRect(u);return Math.max(l.left,u.left)<=Math.min(l.right,u.right)&&Math.max(l.top,u.top)<=Math.min(l.bottom,u.bottom)}get hasVisibleItems(){return this.items.some(l=>l.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(l,u){const x=!!u?.disableDecorations;if(this.items.some(q=>q.visible&&!(x&&q.isDecoration))){var w=l.getContext("2d");w.save();w.font=this._fontString();this.items.forEach(q=>
{x&&q.isDecoration||(w.save(),q.renderCanvas(w),w.restore())});w.restore()}}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};a.__decorate([c.property({readOnly:!0})],b.prototype,"surface",void 0);a.__decorate([c.property({readOnly:!0})],b.prototype,"items",void 0);a.__decorate([c.property({readOnly:!0})],b.prototype,"needsRender",null);a.__decorate([c.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);a.__decorate([c.property({readOnly:!0})],b.prototype,
"updating",null);return b=a.__decorate([f.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/views/GroundView":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./3d/support/cameraUtils ./support/GroundViewElevationSampler".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){b=class extends b{constructor(l){super(l);this.view=
null;this.layerViews=new h}initialize(){this.addHandles(c.when(()=>this.view?.map?.ground,l=>l.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const l of this.layerViews)l.destroy();this.layerViews.length=0}get elevationSampler(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new n({view:this.view}):null}get extent(){const l=this.view;return l&&
"2d"!==l.type&&l.ready?e.toExtent(l,l.state.camera,l.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return this.suspended?!1:this.layerViews.some(l=>l.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating");this.addHandles(this.layerViews.map(l=>c.watch(()=>l.updating,()=>this._updateUpdating(),c.sync)).toArray(),"updating");this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};
a.__decorate([k.property({readOnly:!0})],b.prototype,"elevationSampler",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([k.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([k.property({type:h,readOnly:!0})],b.prototype,"layerViews",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"suspended",null);return b=a.__decorate([g.subclass("esri.views.GroundView")],
b)})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(aa){return aa.spatialReference??l.WGS84}function A(aa){return"global"===aa.viewingMode?t.cameraUtilsSpherical:p.cameraUtilsPlanar}function B(aa,Z,ea){const ca=aa.state.camera,W=ca.width/2/ca.pixelRatio;aa.renderCoordsHelper.viewingMode===q.ViewingMode.Global&&null!=ea&&(Z*=Math.cos(k.deg2rad(ea)));Z/=aa.renderCoordsHelper.unitInMeters;return W/(96*39.37/Z)/Math.tan(ca.fovX/2)}function F(aa,Z,ea){const ca=aa.state.camera;Z=96*39.37/(ca.width/
2/ca.pixelRatio/(Z*Math.tan(ca.fovX/2)));aa.renderCoordsHelper.viewingMode===q.ViewingMode.Global&&null!=ea&&(Z/=Math.cos(k.deg2rad(ea)));return Z*aa.renderCoordsHelper.unitInMeters}async function G(aa,Z,ea,ca,W,Y){Z=await I(aa,ca.heading,ca.tilt,Z,ea,W,Y);m.throwIfAborted(Y);return U(aa,Z,ca.fov,Y)}function H(aa,Z,ea,ca,W){return A(aa).directionToHeadingTilt(Z,ea,ca,W)}function L(aa,Z){return!!(aa.basemapTerrain&&aa.renderCoordsHelper.fromRenderCoords(Z,X,aa.spatialReference)&&aa.elevationProvider&&
(y.getElevationAtPoint(aa.elevationProvider,X)??0)>X[2]-1)}async function C(aa,Z,ea){if(L(aa,Z))return!0;const {elevationProvider:ca,spatialReference:W,renderCoordsHelper:Y}=aa;if(null==ca||!Y.fromRenderCoords(Z,X,W))return!1;const [ja,oa,ra]=X;aa=await ca.queryElevation(ja,oa,ra,W,"ground",ea)??0;m.throwIfAborted(ea);return aa>ra-1}async function z(aa,Z,ea){const ca=f.create();if(null==Z)return d.copy(ca,aa.state.camera.center);if(Z instanceof e){const {renderSpatialReference:W,basemapTerrain:Y,
elevationProvider:ja}=aa,oa=Z.spatialReference;await u.projectPointToVectorAsync(Z,ca,W,0,{signal:ea});m.throwIfAborted(ea);null==Z.z&&null!=Y&&null!=ja&&(Z=await ja.queryElevation(Z.x,Z.y,Z.z??0,oa,"ground",ea),m.throwIfAborted(ea),null!=Z&&aa.renderCoordsHelper.setAltitude(ca,Z));return ca}return d.copy(ca,Z)}function J(aa,Z){const ea=f.create();if(null==Z)return d.copy(ea,aa.state.camera.center);if(Z instanceof e){if(!u.projectPointToVector(Z,ea,aa.renderSpatialReference))return null;const {basemapTerrain:ca,
elevationProvider:W}=aa;null==Z.z&&null!=ca&&null!=W&&(Z=y.getElevationAtPoint(W,Z),null!=Z&&aa.renderCoordsHelper.setAltitude(ea,Z));return ea}return d.copy(ea,Z)}function K(aa,Z,ea,ca,W,Y){const ja=ca instanceof e?ca:null;ca=J(aa,ca);return M(aa,Z,ea,ja,ca,W,Y)}async function I(aa,Z,ea,ca,W,Y,ja){const oa=ca instanceof e?ca:null;ca=await z(aa,ca,ja);m.throwIfAborted(ja);return S(aa,Z,ea,oa,ca,W,Y,ja)}function M(aa,Z,ea,ca,W,Y,ja){if(null==W||!ca&&(ca=new e({spatialReference:E(aa)}),!x.projectVectorToPoint(W,
aa.renderSpatialReference,ca)))return null;const oa=N(aa,Z,ea,W,Y,ja);if(V(aa,ea,ja)&&L(aa,oa.eye)){const {tilt:ra,mode:ta}=Q(aa,ea,W,Y);return M(aa,Z,ra,ca,W,Y,ta)}return{...oa,center:f.clone(W)}}async function S(aa,Z,ea,ca,W,Y,ja,oa){ca||(ca=new e({spatialReference:E(aa)}),await x.projectVectorToPointAsync(W,aa.renderSpatialReference,ca,{signal:oa})||(ca=null));m.throwIfAborted(oa);const ra=N(aa,Z,ea,W,Y,ja);if(V(aa,ea,ja)&&await C(aa,ra.eye,oa)){m.throwIfAborted(oa);const {tilt:ta,mode:ya}=Q(aa,
ea,W,Y);return S(aa,Z,ta,ca,W,Y,ya,oa)}return{...ra,center:f.clone(W)}}function N(aa,Z,ea,ca,W,Y){W=Math.max(W,aa.state.constraints.minimumPoiDistance);var ja=ea;ea=W;var oa=0;if(Y=Y===a.OrientationMode.ADJUST){{const ta=aa.pointsOfInterest.centerOnSurfaceFrequent.distance;if(8<Math.log(ea/ta)/Math.LN2)Y=!0;else{oa=aa.renderSpatialReference;var ra=E(aa);Y=new e({spatialReference:ra});x.projectVectorToPoint(ca,oa,Y)?(ra=new e({spatialReference:ra}),x.projectVectorToPoint(aa.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
oa,ra)?(oa=Math.tan(.5*aa.state.camera.fov)*ta,Y=5<ra.distance(Y)/oa):Y=!1):Y=!1}}}Y?(Z=0,ja=A(aa).eyeTiltToLookAtTilt(ja,ca,ea),aa.state.constraints.tilt?(Y=aa.state.constraints.tilt(ea),Y.max=Math.min(Y.max,.5*Math.PI),oa=Math.min(ja,Y.min*(1-.7)+.7*Y.max)):oa=ja):oa=A(aa).eyeTiltToLookAtTilt(ja,ca,ea);ja=oa=aa.state.constraints.clampTilt(ea,oa);ea=ja=A(aa).lookAtTiltToEyeTilt(ja,ca,ea);aa=A(aa).eyeForCenterWithHeadingTilt;return aa(ca,W,Z,ea)}function V(aa,Z,ea){const ca=aa.map.ground.navigationConstraint;
return ea===a.OrientationMode.ADJUST&&"global"===aa.viewingMode&&0<Z&&(null==ca||"stay-above"===ca.type)}function Q(aa,Z,ea,ca){{let Y=A(aa).eyeTiltToLookAtTilt(Z,ea,ca);if(aa.state.constraints.tilt){var W=aa.state.constraints.tilt(ca);Y=Math.min(Y,.5*Math.PI);W=W.min*(1-.7)+.7*Y}else W=Y}aa=A(aa).lookAtTiltToEyeTilt(W,ea,ca);return{tilt:aa,mode:1>Z-aa?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST}}function T(aa,Z){const {state:ea,spatialReference:ca}=aa;aa=Z.spatialReference;return ea.isGlobal&&
D.isSpatialReferenceSupported(aa,q.ViewingMode.Global)||ea.isLocal&&ca.equals(aa)}function ia(aa,Z){let ea;if(aa.state.isGlobal){const Y=new e(Z.xmin,Z.ymin,Z.spatialReference),ja=new e(Z.xmax,Z.ymax,Z.spatialReference),oa=Z.spatialReference.isGeographic?ha:da;var ca=new e({x:oa.center(Y.x,ja.x),y:(ja.y+Y.y)/2,z:null!=Z.zmax&&null!=Z.zmin?(Z.zmax+Z.zmin)/2:void 0,spatialReference:Z.spatialReference});const ra=g.getReferenceEllipsoid(Z.spatialReference);var W=r.getGreatCircleSpanAt(ca,Y,ja);ea=W.lon;
W=W.lat;oa.diff(Y.x,ja.x)>oa.range/2&&(ea+=ra.halfCircumference);ea=Math.min(ea,ra.halfCircumference);W=Math.min(W,ra.halfCircumference)}else ca=aa.renderSpatialReference??Z.spatialReference,ca.equals(Z.spatialReference)||(Z=n.project(Z,ca)),ea=Z.xmax-Z.xmin,W=Z.ymax-Z.ymin,ca=new e({x:Z.xmin+.5*ea,y:Z.ymin+.5*W,z:null!=Z.zmax&&null!=Z.zmin?(Z.zmax+Z.zmin)/2:void 0,spatialReference:ca});aa=aa.state.camera;return{center:ca,distance:Math.max(1/Math.tan(aa.fovX/2)*ea*.5,1/Math.tan(aa.fovY/2)*W*.5,1/
Math.tan(aa.fov/2)*(null!=Z.zmax&&null!=Z.zmin?Z.zmax-Z.zmin:0)*.5)/1}}function O(aa,Z,ea,ca){if(null==Z)return null;const W=aa.renderSpatialReference;aa=new e({spatialReference:E(aa)});if(!x.projectVectorToPoint(Z.eye,W,aa))return null;ca??=new b;ca.position=aa;ca.heading=Z.heading;ca.tilt=Z.tilt;ca.fov=ea;return ca}async function U(aa,Z,ea,ca){const W=aa.renderSpatialReference;aa=new e({spatialReference:E(aa)});await x.projectVectorToPointAsync(Z.eye,W,aa,{signal:ca});m.throwIfAborted(ca);return new b(aa,
Z.heading,Z.tilt,ea)}const P=()=>c.getLogger("esri.views.3d.support.cameraUtils"),R=f.create(),ba={heading:0,tilt:0},X=f.create(),da=new h.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ha=new h.Cyclical(-180,180);a.OrientationMode=void 0;(function(aa){aa[aa.LOCKED=0]="LOCKED";aa[aa.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const fa=f.create();a.computeScale=function(aa,Z){w.projectVectorToVector(Z.center,aa.renderSpatialReference,R,l.WGS84);return F(aa,Z.distance,R[1])};
a.directionToHeadingTilt=H;a.distanceToScale=F;a.externalToInternal=function(aa,Z){if(null==Z)return null;var ea=aa.renderSpatialReference;const ca=A(aa).headingTiltToDirectionUp,W=f.create();if(!u.projectPointToVector(Z.position,W,ea))return null;ea=ca(W,Z.heading,Z.tilt);d.scale(ea.direction,ea.direction,aa.state.camera.distance);d.add(ea.direction,ea.direction,W);aa=v.cameraOnContentAlongViewDirection(aa,W,ea.direction,ea.up);aa.fov=k.deg2rad(Z.fov);aa.row=Z.layout.row;aa.rows=Z.layout.rows;aa.column=
Z.layout.column;aa.columns=Z.layout.columns;return aa};a.fromCenterDistanceAsync=G;a.fromCenterDistanceSync=function(aa,Z,ea,ca,W,Y){Z=K(aa,ca.heading,ca.tilt,Z,ea,W);return O(aa,Z,ca.fov,Y)};a.fromCenterScale=async function(aa,Z,ea,ca,W,Y){ea=B(aa,ea,Z.latitude);return G(aa,Z,ea,ca,W,Y)};a.fromExtentAsync=async function(aa,Z,ea,ca,W,Y){Z=T(aa,Z)?Z:await n.projectWithZConversion(Z,aa.spatialReference,{signal:Y});m.throwIfAborted(Y);const {center:ja,distance:oa}=ia(aa,Z);ea=await I(aa,ea,ca,ja,oa,
W,Y);m.throwIfAborted(Y);return U(aa,ea,aa.camera.fov,Y)};a.fromExtentSync=function(aa,Z,ea,ca,W,Y){let ja;try{ja=T(aa,Z)?Z:n.project(Z,aa.spatialReference)}catch(ta){return null}const {center:oa,distance:ra}=ia(aa,ja);Z=K(aa,ea,ca,oa,ra,W);return null==Z?null:O(aa,Z,aa.camera.fov,Y)};a.getObserverForPointAtDistanceAsync=I;a.getObserverForPointAtDistanceSync=K;a.getViewSR=E;a.headingTiltToDirectionUp=function(aa,Z,ea,ca,W){return A(aa).headingTiltToDirectionUp(Z,ea,ca,W)};a.internalToExternal=function(aa,
Z,ea){const ca=aa.renderSpatialReference,W=H(aa,Z.eye,Z.viewForward,Z.up,ba);aa=E(aa);w.projectVectorToVector(Z.eye,ca,fa,aa)||(aa=l.WGS84,w.projectVectorToVector(Z.eye,ca,fa,aa));null==ea?ea=new b(new e(fa,aa),W.heading,W.tilt,k.rad2deg(Z.fov)):(ea.position.x=fa[0],ea.position.y=fa[1],ea.position.z=fa[2],ea.position.spatialReference=aa,ea.heading=W.heading,ea.tilt=W.tilt,ea.fov=k.rad2deg(Z.fov));ea.layout.row=Z.row;ea.layout.rows=Z.rows;ea.layout.column=Z.column;ea.layout.columns=Z.columns;return ea};
a.scaleToDistance=B;a.scaleToZoom=function(aa,Z){if(aa=aa.basemapTerrain?.tilingScheme)return aa.levelAtScale(Z);P().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(aa,Z,ea){var ca=aa.renderSpatialReference;const W=new e({spatialReference:E(aa)});if(!x.projectVectorToPoint(ea,ca,W))return null;const Y=Math.tan(Z.fovX/2);ca=Math.tan(Z.fovY/2);Z=d.dist(Z.eye,ea);ea=2*Z*Y;ca*=2*Z;return"global"===aa.viewingMode?t.toExtent(aa,W,ea,ca):p.toExtent(aa,
W,ea,ca)};a.zoomToScale=function(aa,Z){if(aa=aa.basemapTerrain?.tilingScheme)return aa.scaleAtLevel(Z);P().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectVectorToVector"],function(a,b,h,c){function k(d,f,g){if(!c.projectVectorToVector(d,f,m,g.spatialReference))return!1;
g.x=m[0];g.y=m[1];g.z=m[2];return!0}const m=b.create();a.projectVectorToPoint=k;a.projectVectorToPointAsync=async function(d,f,g,e){await h.initializeProjection(f,g.spatialReference,null,e);return k(d,f,g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projection","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(a,b,h,c,k){function m(f,g,e,n,l){if(null==
g||null==n||2>f.length)return!1;d.x=f[0];d.y=f[1];d.z=f[2];d.spatialReference=g;return c.projectPointToVector(d,e,n,l)}const d=k.makeDehydratedPoint(0,0,0,h.WGS84);a.projectVectorToVector=m;a.projectVectorToVectorAsync=async function(f,g,e,n,l,u){await b.initializeProjection(g,n,null,u);return m(f,g,e,n,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(a){a.makeDehydratedPoint=function(b,h,c,k){return{x:b,
y:h,z:c,hasZ:null!=c,hasM:!1,spatialReference:k,type:"point"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,h,c,k,m){function d(x,w){return x.elevationProvider?x.elevationProvider.getElevation(w[0],w[1],w[2],x.renderCoordsHelper.spatialReference,
"ground")??0:0}function f(x,w,q){if(!x.state.isGlobal||!x.stateManager.constraintsManager)return!1;const v=d(x,w);({far:x}=x.stateManager.constraintsManager.nearFarHeuristic.compute(w,q,x.renderDataExtent,v,u));x*=x;return b.squaredDistance(w,q)>x}const g={},e=h.create(),n=h.create(),l=h.create(),u={near:0,far:0};a.cameraOnContentAlongViewDirection=function(x,w,q,v){const p=x.state.camera.clone();w&&q&&v&&(p.eye=w,p.center=q,p.up=v);w=p.ray;q=g[x.viewingMode];q||(q=m.newIntersector(x.state.viewingMode),
q.options.backfacesTerrain=!x.state.isGlobal,q.options.invisibleTerrain=!0,g[x.viewingMode]=q);({isGlobal:v}=x.state);x.sceneIntersectionHelper.intersectRay(w,q,n)&&!f(x,w.origin,n)?w=!0:!x.renderCoordsHelper.intersectManifold(w,0,n)||f(x,w.origin,n)?v?(q=c.getReferenceEllipsoid(x.spatialReference).radius,q=b.dot(w.origin,w.origin)-q*q,b.scale(n,w.direction,(0<q?Math.sqrt(q)/3:1)/b.length(w.direction)),b.add(n,n,w.origin),w=!0):w=!1:w=!0;w||b.copy(n,p.center);q=x.state.constraints;v=q.minimumPoiDistance;
b.squaredDistance(p.eye,n)<v&&(w=q.collision.enabled,b.copy(l,p.viewForward),b.scale(l,l,v),w?p.eye=b.subtract(e,n,l):b.add(n,p.eye,l),x=x.renderCoordsHelper,v=x.getAltitude(p.eye),q=q.collision.elevationMargin,w&&v<q&&(b.subtract(l,n,p.eye),p.eye=x.setAltitude(e,q,p.eye),b.add(n,p.eye,l)));p.center=n;return p};a.eyeWithinExtent=function(x,w,q,v){return null!=x.renderCoordsHelper.fromRenderCoords(w.eye,e,v)&&k.containsPoint(q,e)};a.surfaceElevationBelowRenderLocation=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),function(a,
b,h,c,k,m,d,f,g,e,n,l,u){class x{constructor(r){this.options=new e.IntersectorOptions;this._results=new w;this.transform=new u.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=f.create();this._rayEnd=k.create();this._rayBeginTransformed=k.create();this._rayEndTransformed=k.create();this.viewingMode=null==r?g.ViewingMode.Global:r}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(r,y,
D){this.resetWithRay(f.fromPoints(r,y,this._ray),D)}resetWithRay(r,y){this.camera=y;r!==this._ray&&f.copy(r,this._ray);0!==this.options.verticalOffset?this.viewingMode===g.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;c.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)}intersect(r=null,y,D,E,A){this.point=y;this.filterPredicate=E;this.tolerance=null==D?1E-5:D;y=u.getVerticalOffsetObject3D(this.verticalOffset);
if(r&&0<r.length){const B=A?F=>{A(F)&&this.intersectObject(F)}:F=>{this.intersectObject(F)};for(const F of r)r=F.getSpatialQueryAccelerator?.(),null!=r?(null!=y?r.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,B,y):r.forEachAlongRay(this._ray.origin,this._ray.direction,B),this.options.selectionMode&&this.options.hud&&r.forEachDegenerateObject(B)):F.objects.forAll(G=>B(G))}this.sortResults()}intersectObject(r){const y=r.geometries;if(y){var D=r.effectiveTransformation,E=u.getVerticalOffsetObject3D(this.verticalOffset);
for(const A of y){if(!A.visible)continue;const {material:B,id:F}=A;this.transform.setAndInvalidateLazyTransforms(D,A.transformation);c.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);c.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const G=this.transform.transform;null!=E&&(E.objectTransform=this.transform);B.intersect(A,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(H,L,C,z,J,K)=>{if(0<=H&&(null==this.filterPredicate||
this.filterPredicate(this._ray.origin,this._rayEnd,H))){var I=z?this._results.hud:this._results,M=z?S=>{const N=new n.HudTarget(r,F,C,K);S.set(e.IntersectorType.HUD,N,H,L,h.IDENTITY,J)}:S=>S.set(e.IntersectorType.OBJECT,{object:r,geometryId:F,triangleNr:C},H,L,G,J);(null==I.min.drapedLayerOrder||J>=I.min.drapedLayerOrder)&&(null==I.min.dist||H<I.min.dist)&&M(I.min);this.options.store!==e.StoreResults.MIN&&(null==I.max.drapedLayerOrder||J<I.max.drapedLayerOrder)&&(null==I.max.dist||H>I.max.dist)&&
M(I.max);this.options.store===e.StoreResults.ALL&&(z?(z=new v(this._ray),M(z),this._results.hud.all.push(z)):(z=new q(this._ray),M(z),this._results.all.push(z)))}})}}}sortResults(r=this._results.all){r.sort((y,D)=>y.dist!==D.dist?(y.dist??0)-(D.dist??0):y.drapedLayerOrder!==D.drapedLayerOrder?(D.drapedLayerOrder??-Number.MAX_VALUE)-(y.drapedLayerOrder??-Number.MAX_VALUE):(D.drapedLayerGraphicOrder??-Number.MAX_VALUE)-(y.drapedLayerGraphicOrder??-Number.MAX_VALUE))}}class w{constructor(){this.min=
new q(f.create());this.max=new q(f.create());this.hud={min:new v(f.create()),max:new v(f.create()),all:[]};this.ground=new q(f.create());this.all=[]}init(r){this.min.init(r);this.max.init(r);this.ground.init(r);this.all.length=0;this.hud.min.init(r);this.hud.max.init(r);this.hud.all.length=0}}class q{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(c.scale(p,this.ray.direction,this.dist),c.length(p)):null}getIntersectionPoint(r){if(!l.isValidIntersectorResult(this))return!1;
c.scale(p,this.ray.direction,this.dist);c.add(r,this.ray.origin,p);return!0}getTransformedNormal(r){c.copy(t,this.normal);t[3]=0;m.transformMat4(t,t,this.transformation);c.copy(r,t);return c.normalize(r,r)}constructor(r){this.intersector=e.IntersectorType.OBJECT;this.normal=k.create();this.transformation=h.create();this._ray=f.create();this.init(r)}init(r){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=e.IntersectorType.OBJECT;f.copy(r,this._ray)}set(r,
y,D,E,A,B,F){this.intersector=r;this.dist=D;c.copy(this.normal,E??k.UNIT_Z);b.copy(this.transformation,A??h.IDENTITY);this.target=y;this.drapedLayerOrder=B;this.drapedLayerGraphicOrder=F}copy(r){f.copy(r.ray,this._ray);this.intersector=r.intersector;this.dist=r.dist;this.target=r.target;this.drapedLayerOrder=r.drapedLayerOrder;this.drapedLayerGraphicOrder=r.drapedLayerGraphicOrder;c.copy(this.normal,r.normal);b.copy(this.transformation,r.transformation)}}class v extends q{constructor(){super(...arguments);
this.intersector=e.IntersectorType.HUD}}const p=k.create(),t=d.create();a.defaultTolerance=1E-5;a.newIntersector=function(r){return new x(r)};a.newIntersectorResult=function(r){return new q(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(h){h[h.OBJECT=0]="OBJECT";h[h.HUD=1]="HUD";h[h.TERRAIN=2]="TERRAIN";h[h.OVERLAY=3]="OVERLAY";h[h.I3S=4]="I3S";h[h.PCL=
5]="PCL";h[h.LOD=6]="LOD";h[h.VOXEL=7]="VOXEL";h[h.TILES3D=8]="TILES3D"})(a.IntersectorType||(a.IntersectorType={}));class b{constructor(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=a.StoreResults.ALL}}a.StoreResults=void 0;(function(h){h[h.MIN=0]="MIN";h[h.MINMAX=1]="MINMAX";h[h.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class h{constructor(f,g,e){this.object=f;this.geometryId=g;this.triangleNr=e}}class c extends h{constructor(f,g,e,n){super(f,g,e);this.center=null!=n?b.clone(n):null}}class k extends c{}class m{constructor(f){this.layerUid=f}}class d extends m{constructor(f,g){super(f);this.graphicUid=
g}}a.Graphic3DTarget=d;a.HudTarget=c;a.LayerTarget=m;a.ObjectTarget=h;a.ValidHudTarget=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(a,b,h,c,k){function m(f){return null!=f?.dist}const d=h.create();a.isHudIntersectorResult=function(f){return m(f)&&f.intersector===
k.IntersectorType.HUD&&!!f.target&&"center"in f.target&&null!=f.target.center};a.isObjectIntersectorResult=function(f){return m(f)&&f.intersector===k.IntersectorType.OBJECT&&!!f.target};a.isValidIntersectorResult=m;a.sliceFilterPredicate=function(f){return(g,e,n)=>{b.lerp(d,g,e,n);return!c.extrusionContainsPoint(f,d)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(){this._transform=k.create();this._transformInverse=new l({value:this._transform},c.invert,k.create);this._transformInverseTranspose=new l(this._transformInverse,c.transpose,k.create);this._transformTranspose=new l({value:this._transform},c.transpose,k.create);this._transformInverseRotation=new l({value:this._transform},b.normalFromMat4Legacy,h.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(A){c.copy(this._transform,A)}multiplyTransform(A){c.multiply(this._transform,this._transform,A)}set(A){c.copy(this._transform,
A);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(A,B){this.setTransformMatrix(A);this.multiplyTransform(B);this._invalidateLazyTransforms()}}class l{constructor(A,B,F){this._original=A;this._update=B;this._dirty=!0;this._transform=F()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class u{constructor(A=0){this.offset=A;this.tmpVertex=d.create()}applyToVertex(A,B,F){A=m.set(t,A,B,F);
B=m.add(r,A,this.localOrigin);F=this.offset/m.length(B);m.scaleAndAdd(this.tmpVertex,A,B,F);return this.tmpVertex}applyToAabb(A){var B=y;const F=D,G=E;for(var H=0;3>H;++H)B[H]=A[0+H]+this.localOrigin[H],F[H]=A[3+H]+this.localOrigin[H],G[H]=B[H];H=this.applyToVertex(B[0],B[1],B[2]);for(var L=0;3>L;++L)A[L]=H[L],A[L+3]=H[L];H=z=>{z=this.applyToVertex(z[0],z[1],z[2]);for(let J=0;3>J;++J)A[J]=Math.min(A[J],z[J]),A[J+3]=Math.max(A[J+3],z[J])};for(L=1;8>L;++L){for(var C=0;3>C;++C)G[C]=0===(L&1<<C)?B[C]:
F[C];H(G)}L=0;for(C=0;3>C;++C)0>B[C]*F[C]&&(L|=1<<C);if(0!==L&&7!==L)for(C=0;8>C;++C)if(0===(L&C)){for(let z=0;3>z;++z)G[z]=0!==(L&1<<z)?0:0!==(C&1<<z)?B[z]:F[z];H(G)}for(B=0;3>B;++B)A[B]-=this.localOrigin[B],A[B+3]-=this.localOrigin[B];return A}}class x{constructor(A=0){this._offset=this._totalOffset=this.componentLocalOriginLength=0;this._tmpVertex=d.create();this._tmpMbs=f.create();this._tmpObb=new e.Obb;this._resetOffset(A)}_resetOffset(A){this._totalOffset=this._offset=A}set offset(A){this._resetOffset(A)}get offset(){return this._offset}set componentOffset(A){this._totalOffset=
this._offset+A}set localOrigin(A){this.componentLocalOriginLength=m.length(A)}applyToVertex(A,B,F){const G=m.set(t,A,B,F);A=m.set(r,A,B,F+this.componentLocalOriginLength);B=this._totalOffset/m.length(A);m.scaleAndAdd(this._tmpVertex,G,A,B);return this._tmpVertex}applyToAabb(A){var B=this.componentLocalOriginLength;const F=A[0],G=A[1],H=A[2]+B,L=A[3],C=A[4];B=A[5]+B;var z=Math.abs(F),J=Math.abs(G),K=Math.abs(H),I=Math.abs(L),M=Math.abs(C),S=Math.abs(B),N=.5*(1+Math.sign(F*L))*Math.min(z,I),V=.5*(1+
Math.sign(G*C))*Math.min(J,M);const Q=.5*(1+Math.sign(H*B))*Math.min(K,S);var T=Math.max(z,I),ia=Math.max(J,M),O=Math.max(K,S);N=Math.sqrt(N*N+V*V+Q*Q);z=Math.sign(z+F);J=Math.sign(J+G);K=Math.sign(K+H);I=Math.sign(I+L);M=Math.sign(M+C);S=Math.sign(S+B);V=this._totalOffset;if(N<V)return A[0]-=(1-z)*V,A[1]-=(1-J)*V,A[2]-=(1-K)*V,A[3]+=I*V,A[4]+=M*V,A[5]+=S*V,A;T=V/Math.sqrt(T*T+ia*ia+O*O);ia=V/N;O=ia-T;N=-O;A[0]+=F*(z*N+ia);A[1]+=G*(J*N+ia);A[2]+=H*(K*N+ia);A[3]+=L*(I*O+T);A[4]+=C*(M*O+T);A[5]+=B*
(S*O+T);return A}applyToMbs(A){const B=m.length(f.getCenter(A)),F=this._totalOffset/B;m.scaleAndAdd(f.getCenter(this._tmpMbs),f.getCenter(A),f.getCenter(A),F);this._tmpMbs[3]=A[3]+A[3]*this._totalOffset/B;return this._tmpMbs}applyToObb(A){e.computeOffsetObb(A,this._totalOffset,this._totalOffset,g.ViewingMode.Global,this._tmpObb);return this._tmpObb}}class w{constructor(A=0){this.offset=A;this.sphere=f.create();this.tmpVertex=d.create()}applyToVertex(A,B,F){var G=this.objectTransform.transform;A=m.set(t,
A,B,F);G=m.transformMat4(A,A,G);A=this.offset/m.length(G);m.scaleAndAdd(G,G,G,A);m.transformMat4(this.tmpVertex,G,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(A,B){const F=this.offset/m.length(A);m.scaleAndAdd(A,A,A,F);A=this.offset/m.length(B);m.scaleAndAdd(B,B,B,A)}applyToAabb(A){var B=this.offset/Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]+=A[0]*B;A[1]+=A[1]*B;A[2]+=A[2]*B;B=this.offset/Math.sqrt(A[3]*A[3]+A[4]*A[4]+A[5]*A[5]);A[3]+=A[3]*B;A[4]+=A[4]*B;A[5]+=A[5]*B;return A}applyToBoundingSphere(A){const B=
m.length(f.getCenter(A)),F=this.offset/B;m.scaleAndAdd(f.getCenter(this.sphere),f.getCenter(A),f.getCenter(A),F);this.sphere[3]=A[3]+A[3]*this.offset/B;return this.sphere}}const q=new w,v=new x,p=new u,t=d.create(),r=d.create(),y=d.create(),D=d.create(),E=d.create();a.I3SVerticalOffsetGlobalViewingMode=x;a.IntersectorTransform=n;a.Object3DVerticalOffsetGlobalViewingMode=w;a.TerrainVerticalOffsetGlobalViewingMode=u;a.getVerticalOffsetI3S=function(A){return null!=A?(v.offset=A,v):null};a.getVerticalOffsetObject3D=
function(A){return null!=A?(q.offset=A,q):null};a.getVerticalOffsetTerrain=function(A){return null!=A?(p.offset=A,p):null};a.terrainId="terrain";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(a,b){function h(I,M){I[0]=M[0];I[1]=M[1];I[2]=M[2];I[3]=M[4];I[4]=M[5];I[5]=M[6];I[6]=M[8];I[7]=M[9];I[8]=M[10];return I}function c(I,M){I[0]=M[0];I[1]=M[1];I[2]=M[2];I[3]=M[3];I[4]=M[4];I[5]=M[5];I[6]=M[6];
I[7]=M[7];I[8]=M[8];return I}function k(I,M,S,N,V,Q,T,ia,O,U){I[0]=M;I[1]=S;I[2]=N;I[3]=V;I[4]=Q;I[5]=T;I[6]=ia;I[7]=O;I[8]=U;return I}function m(I){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function d(I,M){if(I===M){const S=M[1],N=M[2],V=M[5];I[1]=M[3];I[2]=M[6];I[3]=S;I[5]=M[7];I[6]=N;I[7]=V}else I[0]=M[0],I[1]=M[3],I[2]=M[6],I[3]=M[1],I[4]=M[4],I[5]=M[7],I[6]=M[2],I[7]=M[5],I[8]=M[8];return I}function f(I,M){const S=M[0],N=M[1],V=M[2],Q=M[3],T=M[4],ia=M[5],O=M[6],
U=M[7];M=M[8];const P=M*T-ia*U,R=-M*Q+ia*O,ba=U*Q-T*O;let X=S*P+N*R+V*ba;if(!X)return null;X=1/X;I[0]=P*X;I[1]=(-M*N+V*U)*X;I[2]=(ia*N-V*T)*X;I[3]=R*X;I[4]=(M*S-V*O)*X;I[5]=(-ia*S+V*Q)*X;I[6]=ba*X;I[7]=(-U*S+N*O)*X;I[8]=(T*S-N*Q)*X;return I}function g(I,M){const S=M[0],N=M[1],V=M[2],Q=M[3],T=M[4],ia=M[5],O=M[6],U=M[7];M=M[8];I[0]=T*M-ia*U;I[1]=V*U-N*M;I[2]=N*ia-V*T;I[3]=ia*O-Q*M;I[4]=S*M-V*O;I[5]=V*Q-S*ia;I[6]=Q*U-T*O;I[7]=N*O-S*U;I[8]=S*T-N*Q;return I}function e(I){const M=I[3],S=I[4],N=I[5],V=I[6],
Q=I[7],T=I[8];return I[0]*(T*S-N*Q)+I[1]*(-T*M+N*V)+I[2]*(Q*M-S*V)}function n(I,M,S){const N=M[0],V=M[1],Q=M[2],T=M[3],ia=M[4],O=M[5],U=M[6],P=M[7];M=M[8];const R=S[0],ba=S[1],X=S[2],da=S[3],ha=S[4],fa=S[5],aa=S[6],Z=S[7];S=S[8];I[0]=R*N+ba*T+X*U;I[1]=R*V+ba*ia+X*P;I[2]=R*Q+ba*O+X*M;I[3]=da*N+ha*T+fa*U;I[4]=da*V+ha*ia+fa*P;I[5]=da*Q+ha*O+fa*M;I[6]=aa*N+Z*T+S*U;I[7]=aa*V+Z*ia+S*P;I[8]=aa*Q+Z*O+S*M;return I}function l(I,M,S){const N=M[0],V=M[1],Q=M[2],T=M[3],ia=M[4],O=M[5],U=M[6],P=M[7];M=M[8];const R=
S[0];S=S[1];I[0]=N;I[1]=V;I[2]=Q;I[3]=T;I[4]=ia;I[5]=O;I[6]=R*N+S*T+U;I[7]=R*V+S*ia+P;I[8]=R*Q+S*O+M;return I}function u(I,M,S){const N=M[0],V=M[1],Q=M[2],T=M[3],ia=M[4],O=M[5],U=M[6],P=M[7];M=M[8];const R=Math.sin(S);S=Math.cos(S);I[0]=S*N+R*T;I[1]=S*V+R*ia;I[2]=S*Q+R*O;I[3]=S*T-R*N;I[4]=S*ia-R*V;I[5]=S*O-R*Q;I[6]=U;I[7]=P;I[8]=M;return I}function x(I,M,S){const N=S[0],V=S[1];S=S[2];I[0]=N*M[0];I[1]=N*M[1];I[2]=N*M[2];I[3]=V*M[3];I[4]=V*M[4];I[5]=V*M[5];I[6]=S*M[6];I[7]=S*M[7];I[8]=S*M[8];return I}
function w(I,M,S){const N=S[0];S=S[1];I[0]=N*M[0];I[1]=N*M[1];I[2]=N*M[2];I[3]=S*M[3];I[4]=S*M[4];I[5]=S*M[5];return I}function q(I,M){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=M[0];I[7]=M[1];I[8]=1;return I}function v(I,M){const S=Math.sin(M);M=Math.cos(M);I[0]=M;I[1]=S;I[2]=0;I[3]=-S;I[4]=M;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function p(I,M){I[0]=M[0];I[1]=0;I[2]=0;I[3]=0;I[4]=M[1];I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function t(I,M){I[0]=M[0];I[1]=M[1];I[2]=0;I[3]=M[2];I[4]=M[3];I[5]=0;I[6]=
M[4];I[7]=M[5];I[8]=1;return I}function r(I,M){var S=M[0],N=M[1],V=M[2];M=M[3];var Q=S+S,T=N+N;const ia=V+V;S*=Q;const O=N*Q;N*=T;const U=V*Q,P=V*T;V*=ia;Q*=M;T*=M;M*=ia;I[0]=1-N-V;I[3]=O-M;I[6]=U+T;I[1]=O+M;I[4]=1-S-V;I[7]=P-Q;I[2]=U-T;I[5]=P+Q;I[8]=1-S-N;return I}function y(I,M){const S=M[0],N=M[1],V=M[2],Q=M[4],T=M[5],ia=M[6],O=M[8],U=M[9];M=M[10];const P=M*T-ia*U,R=-M*Q+ia*O,ba=U*Q-T*O;var X=S*P+N*R+V*ba;if(!X)return null;X=1/X;I[0]=P*X;I[1]=(-M*N+V*U)*X;I[2]=(ia*N-V*T)*X;I[3]=R*X;I[4]=(M*S-V*
O)*X;I[5]=(-ia*S+V*Q)*X;I[6]=ba*X;I[7]=(-U*S+N*O)*X;I[8]=(T*S-N*Q)*X;return I}function D(I,M){const S=M[0],N=M[1],V=M[2],Q=M[3],T=M[4],ia=M[5],O=M[6],U=M[7];var P=M[8],R=M[9],ba=M[10],X=M[11];const da=M[12],ha=M[13],fa=M[14];M=M[15];const aa=S*ia-N*T,Z=S*O-V*T,ea=S*U-Q*T,ca=N*O-V*ia,W=N*U-Q*ia,Y=V*U-Q*O,ja=P*ha-R*da,oa=P*fa-ba*da;P=P*M-X*da;const ra=R*fa-ba*ha;R=R*M-X*ha;ba=ba*M-X*fa;X=aa*ba-Z*R+ea*ra+ca*P-W*oa+Y*ja;if(!X)return null;X=1/X;I[0]=(ia*ba-O*R+U*ra)*X;I[1]=(O*P-T*ba-U*oa)*X;I[2]=(T*R-
ia*P+U*ja)*X;I[3]=(V*R-N*ba-Q*ra)*X;I[4]=(S*ba-V*P+Q*oa)*X;I[5]=(N*P-S*R-Q*ja)*X;I[6]=(ha*Y-fa*W+M*ca)*X;I[7]=(fa*ea-da*Y-M*Z)*X;I[8]=(da*W-ha*ea+M*aa)*X;return I}function E(I,M,S){I[0]=2/M;I[1]=0;I[2]=0;I[3]=0;I[4]=-2/S;I[5]=0;I[6]=-1;I[7]=1;I[8]=1;return I}function A(I){return"mat3("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+")"}function B(I){return Math.sqrt(I[0]**2+I[1]**2+I[2]**2+I[3]**2+I[4]**2+I[5]**2+I[6]**2+I[7]**2+I[8]**2)}function F(I,M,S){I[0]=
M[0]+S[0];I[1]=M[1]+S[1];I[2]=M[2]+S[2];I[3]=M[3]+S[3];I[4]=M[4]+S[4];I[5]=M[5]+S[5];I[6]=M[6]+S[6];I[7]=M[7]+S[7];I[8]=M[8]+S[8];return I}function G(I,M,S){I[0]=M[0]-S[0];I[1]=M[1]-S[1];I[2]=M[2]-S[2];I[3]=M[3]-S[3];I[4]=M[4]-S[4];I[5]=M[5]-S[5];I[6]=M[6]-S[6];I[7]=M[7]-S[7];I[8]=M[8]-S[8];return I}function H(I,M,S){I[0]=M[0]*S;I[1]=M[1]*S;I[2]=M[2]*S;I[3]=M[3]*S;I[4]=M[4]*S;I[5]=M[5]*S;I[6]=M[6]*S;I[7]=M[7]*S;I[8]=M[8]*S;return I}function L(I,M,S,N){I[0]=M[0]+S[0]*N;I[1]=M[1]+S[1]*N;I[2]=M[2]+S[2]*
N;I[3]=M[3]+S[3]*N;I[4]=M[4]+S[4]*N;I[5]=M[5]+S[5]*N;I[6]=M[6]+S[6]*N;I[7]=M[7]+S[7]*N;I[8]=M[8]+S[8]*N;return I}function C(I,M){return I[0]===M[0]&&I[1]===M[1]&&I[2]===M[2]&&I[3]===M[3]&&I[4]===M[4]&&I[5]===M[5]&&I[6]===M[6]&&I[7]===M[7]&&I[8]===M[8]}function z(I,M){const S=I[0],N=I[1],V=I[2],Q=I[3],T=I[4],ia=I[5],O=I[6],U=I[7];I=I[8];const P=M[0],R=M[1],ba=M[2],X=M[3],da=M[4],ha=M[5],fa=M[6],aa=M[7];M=M[8];const Z=b.getEpsilon();return Math.abs(S-P)<=Z*Math.max(1,Math.abs(S),Math.abs(P))&&Math.abs(N-
R)<=Z*Math.max(1,Math.abs(N),Math.abs(R))&&Math.abs(V-ba)<=Z*Math.max(1,Math.abs(V),Math.abs(ba))&&Math.abs(Q-X)<=Z*Math.max(1,Math.abs(Q),Math.abs(X))&&Math.abs(T-da)<=Z*Math.max(1,Math.abs(T),Math.abs(da))&&Math.abs(ia-ha)<=Z*Math.max(1,Math.abs(ia),Math.abs(ha))&&Math.abs(O-fa)<=Z*Math.max(1,Math.abs(O),Math.abs(fa))&&Math.abs(U-aa)<=Z*Math.max(1,Math.abs(U),Math.abs(aa))&&Math.abs(I-M)<=Z*Math.max(1,Math.abs(I),Math.abs(M))}function J(I){const M=b.getEpsilon(),S=I[0],N=I[1],V=I[2],Q=I[3],T=I[4],
ia=I[5],O=I[6],U=I[7];I=I[8];return Math.abs(1-(S*S+Q*Q+O*O))<=M&&Math.abs(1-(N*N+T*T+U*U))<=M&&Math.abs(1-(V*V+ia*ia+I*I))<=M}const K=Object.freeze(Object.defineProperty({__proto__:null,add:F,adjoint:g,copy:c,determinant:e,equals:z,exactEquals:C,frob:B,fromMat2d:t,fromMat4:h,fromQuat:r,fromRotation:v,fromScaling:p,fromTranslation:q,identity:m,invert:f,isOrthoNormal:J,mul:n,multiply:n,multiplyScalar:H,multiplyScalarAndAdd:L,normalFromMat4:D,normalFromMat4Legacy:y,projection:E,rotate:u,scale:x,scaleByVec2:w,
set:k,str:A,sub:G,subtract:G,translate:l,transpose:d},Symbol.toStringTag,{value:"Module"}));a.add=F;a.adjoint=g;a.copy=c;a.determinant=e;a.equals=z;a.exactEquals=C;a.frob=B;a.fromMat2d=t;a.fromMat4=h;a.fromQuat=r;a.fromRotation=v;a.fromScaling=p;a.fromTranslation=q;a.identity=m;a.invert=f;a.isOrthoNormal=J;a.mat3=K;a.mul=n;a.multiply=n;a.multiplyScalar=H;a.multiplyScalarAndAdd=L;a.normalFromMat4=D;a.normalFromMat4Legacy=y;a.projection=E;a.rotate=u;a.scale=x;a.scaleByVec2=w;a.set=k;a.str=A;a.sub=G;
a.subtract=G;a.translate=l;a.transpose=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/support/plane ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/vectorStacks ../../ViewingMode ./dito ../webgl-engine/lib/Attribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){function D(da,ha=new F){r.computeOBB(da,ha);return ha}function E(da,ha,fa,aa,Z){var ea=ha.getQuaternion(H);ea=b.fromQuat(ia,ea);ha=ha.getHalfSize(T);for(let W=0;8>W;++W){for(var ca=0;3>ca;++ca)N[ca]=ha[ca]*(0!==(W&1<<ca)?-1:1);for(ca=0;3>ca;++ca){let Y=fa[ca];for(let ja=0;3>ja;++ja)Y+=N[ja]*ea[3*ja+ca];M[3*W+ca]=Y}}x.projectBuffer(M,da,0,M,aa,0,8);D(S,Z)}function A(da,ha,fa,aa,Z=l.getSphericalPCPF(fa),ea=w.getProjector(fa,Z)){da.getCorners(U);da.getCenter(N);
N[2]+=aa;u.computeTranslationToOriginAndRotation(fa,N,O,Z);ha.setCenter(O[12],O[13],O[14]);fa=2*Math.sqrt(1+O[0]+O[5]+O[10]);G[0]=(O[6]-O[9])/fa;G[1]=(O[8]-O[2])/fa;G[2]=(O[1]-O[4])/fa;G[3]=.25*fa;da=da.getQuaternion(H);ha.quaternion=k.multiply(G,G,da);k.conjugate(G,G);d.set(R,0,0,0);da=ha.getCenter(Q);for(const ca of U)ca[2]+=aa,ea(ca,0,ca,0),d.sub(P,ca,da),d.transformQuat(P,P,G),d.max(R,R,P);ha.halfSize=R}function B(da,ha,fa,aa,Z=l.getSphericalPCPF(fa)){const ea=n.getReferenceEllipsoid(fa),ca=1+
Math.max(0,aa)/(ea.radius+da.centerZ);da.getCenter(N);N[2]+=aa;x.projectBuffer(N,fa,0,N,Z,0,1);ha.center=N;fa=da.getQuaternion(H);ha.quaternion=fa;k.conjugate(G,fa);d.set(P,0,0,1);d.transformQuat(P,P,G);da=da.getHalfSize(T);d.set(P,da[0]*Math.abs(P[0]),da[1]*Math.abs(P[1]),da[2]*Math.abs(P[2]));d.scale(P,P,ea.inverseFlattening);d.add(P,da,P);ha.halfSize=d.scale(P,P,ca)}class F{constructor(da=f.ZEROS,ha=X,fa=m.IDENTITY){this._data=[da[0],da[1],da[2],ha[0],ha[1],ha[2],fa[0],fa[1],fa[2],fa[3]]}clone(){const da=
new F;da._data=this._data.slice();return da}static fromData(da){const ha=new F;ha._data=da.slice();return ha}static fromJSON(da){return new F(da.center,da.halfSize,da.quaternion)}copy(da){this._data=da.data.slice()}get center(){return d.set(p.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(da){da[0]=this._data[0];da[1]=this._data[1];da[2]=this._data[2];return da}set center(da){this._data[0]=
da[0];this._data[1]=da[1];this._data[2]=da[2]}setCenter(da,ha,fa){this._data[0]=da;this._data[1]=ha;this._data[2]=fa}get halfSize(){return d.set(p.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(da){da[0]=this._data[3];da[1]=this._data[4];da[2]=this._data[5];return da}set halfSize(da){this._data[3]=da[0];this._data[4]=da[1];this._data[5]=da[2]}get quaternion(){return k.set(p.sq4d.get(),
this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(da){da[0]=this._data[6];da[1]=this._data[7];da[2]=this._data[8];da[3]=this._data[9];return da}set quaternion(da){this._data[6]=da[0];this._data[7]=da[1];this._data[8]=da[2];this._data[9]=da[3]}get data(){return this._data}getCorners(da){const ha=G,fa=this._data;ha[0]=fa[6];ha[1]=fa[7];ha[2]=fa[8];ha[3]=fa[9];for(let aa=0;8>aa;++aa){const Z=da[aa];Z[0]=(aa&1?-1:1)*fa[3];Z[1]=(aa&2?-1:1)*fa[4];Z[2]=(aa&4?-1:1)*fa[5];d.transformQuat(Z,
Z,ha);Z[0]+=fa[0];Z[1]+=fa[1];Z[2]+=fa[2]}}isVisible(da){return 0>=this.intersectPlane(da[0])&&0>=this.intersectPlane(da[1])&&0>=this.intersectPlane(da[2])&&0>=this.intersectPlane(da[3])&&0>=this.intersectPlane(da[4])&&0>=this.intersectPlane(da[5])}get radius(){const da=this._data[3],ha=this._data[4],fa=this._data[5];return Math.sqrt(da*da+ha*ha+fa*fa)}intersectSphere(da){C[0]=this._data[0]-da[0];C[1]=this._data[1]-da[1];C[2]=this._data[2]-da[2];const ha=this.getQuaternion(H);k.conjugate(G,ha);d.transformQuat(C,
C,G);d.abs(C,C);z[0]=Math.min(C[0],this._data[3]);z[1]=Math.min(C[1],this._data[4]);z[2]=Math.min(C[2],this._data[5]);return d.sqrDist(z,C)<da[3]*da[3]}intersectSphereWithMBS(da,ha=this.radius){const fa=this._data;C[0]=fa[0]-da[0];C[1]=fa[1]-da[1];C[2]=fa[2]-da[2];da=da[3];const aa=d.sqrLen(C);ha=da+ha;if(aa>ha*ha)return!1;G[0]=-fa[6];G[1]=-fa[7];G[2]=-fa[8];G[3]=fa[9];d.transformQuat(C,C,G);d.abs(C,C);z[0]=Math.min(C[0],fa[3]);z[1]=Math.min(C[1],fa[4]);z[2]=Math.min(C[2],fa[5]);return d.sqrDist(z,
C)<da*da}intersectPlane(da){const ha=da[0]*this._data[0]+da[1]*this._data[1]+da[2]*this._data[2]+da[3];da=this.projectedRadius(q.getNormal(da));return ha>da?1:ha<-da?-1:0}intersectRay(da,ha,fa=0){var aa=this._data,Z=G;Z[0]=-aa[6];Z[1]=-aa[7];Z[2]=-aa[8];Z[3]=aa[9];C[0]=da[0]-aa[0];C[1]=da[1]-aa[1];C[2]=da[2]-aa[2];da=d.transformQuat(C,C,G);ha=d.transformQuat(z,ha,G);aa=-Infinity;Z=Infinity;const ea=this.getHalfSize(T);for(let W=0;3>W;W++){var ca=da[W];const Y=ha[W],ja=ea[W]+fa;if(1E-6<Math.abs(Y)){const oa=
(ja-ca)/Y;ca=(-ja-ca)/Y;aa=Math.max(aa,Math.min(oa,ca));Z=Math.min(Z,Math.max(oa,ca))}else if(ca>ja||ca<-ja)return!1}return aa<=Z}projectedArea(da,ha,fa,aa){var Z=this.getQuaternion(H);k.conjugate(G,Z);C[0]=da[0]-this._data[0];C[1]=da[1]-this._data[1];C[2]=da[2]-this._data[2];d.transformQuat(C,C,G);var ea=this.getHalfSize(T),ca=C[0]<-ea[0]?-1:C[0]>ea[0]?1:0,W=C[1]<-ea[1]?-1:C[1]>ea[1]?1:0;const Y=C[2]<-ea[2]?-1:C[2]>ea[2]?1:0;da=Math.abs(ca)+Math.abs(W)+Math.abs(Y);if(0===da)return Infinity;da=1===
da?4:6;ca=6*(ca+3*W+9*Y+13);b.fromQuat(ia,Z);b.scale(ia,ia,ea);Z=this.getCenter(V);for(ea=0;ea<da;ea++)W=I[ca+ea],d.set(C,((W&1)<<1)-1,(W&2)-1,((W&4)>>1)-1),d.transformMat3(C,C,ia),d.add(J,Z,C),J[3]=1,g.transformMat4(J,J,ha),W=1/Math.max(1E-6,J[3]),K[2*ea]=J[0]*W,K[2*ea+1]=J[1]*W;ha=2*da-2;da=K[0]*(K[3]-K[ha+1])+K[ha]*(K[1]-K[ha-1]);for(Z=2;Z<ha;Z+=2)da+=K[Z]*(K[Z+3]-K[Z-1]);return Math.abs(da)*fa*aa*.125}projectedRadius(da){const ha=this.getQuaternion(H);k.conjugate(G,ha);d.transformQuat(C,da,G);
return Math.abs(C[0]*this._data[3])+Math.abs(C[1]*this._data[4])+Math.abs(C[2]*this._data[5])}minimumDistancePlane(da){const ha=da[0]*this._data[0]+da[1]*this._data[1]+da[2]*this._data[2]+da[3];da=this.projectedRadius(q.getNormal(da));return ha-da}maximumDistancePlane(da){const ha=da[0]*this._data[0]+da[1]*this._data[1]+da[2]*this._data[2]+da[3];da=this.projectedRadius(q.getNormal(da));return ha+da}toAaBoundingBox(da){var ha=this.getQuaternion(H),fa=b.fromQuat(ia,ha);ha=this._data[3]*Math.abs(fa[0])+
this._data[4]*Math.abs(fa[3])+this._data[5]*Math.abs(fa[6]);const aa=this._data[3]*Math.abs(fa[1])+this._data[4]*Math.abs(fa[4])+this._data[5]*Math.abs(fa[7]);fa=this._data[3]*Math.abs(fa[2])+this._data[4]*Math.abs(fa[5])+this._data[5]*Math.abs(fa[8]);da[0]=this._data[0]-ha;da[1]=this._data[1]-aa;da[2]=this._data[2]-fa;da[3]=this._data[0]+ha;da[4]=this._data[1]+aa;da[5]=this._data[2]+fa}transform(da,ha,fa,aa=0,Z=l.getSphericalPCPF(fa),ea=l.getSphericalPCPF(ha),ca=w.getProjector(ha,ea)){fa===Z?ha.isGeographic?
B(this,da,ha,aa,ea):A(this,da,ha,aa,ea,ca):ha.isWGS84&&(fa.isWebMercator||v.isPlateCarree(fa))?(this.getCenter(V),V[2]+=aa,aa=l.getSphericalPCPF(fa),x.projectBuffer(V,ha,0,V,aa,0,1),E(aa,this,V,fa,da)):ha.isWebMercator&&v.isPlateCarree(fa)?(this.getCenter(V),V[2]+=aa,E(ha,this,V,fa,da)):(Z=this.getCenter(V),Z[2]+=aa,x.projectBuffer(Z,ha,0,Z,fa,0,1),da.center=Z,this!==da&&(da.quaternion=this.getQuaternion(H),da.halfSize=this.getHalfSize(T)))}}const G=m.create(),H=m.create(),L=m.create(),C=f.create(),
z=f.create(),J=e.create(),K=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],I=(()=>{const da=new Int8Array(162);let ha=0;const fa=aa=>{for(let Z=0;Z<aa.length;Z++)da[ha+Z]=aa[Z];ha+=6};fa([6,2,3,1,5,4]);fa([0,2,3,1,5,4]);fa([0,2,3,7,5,4]);fa([0,1,3,2,6,4]);fa([0,1,3,2,0,0]);fa([0,1,5,7,3,2]);fa([0,1,3,7,6,4]);fa([0,1,3,7,6,2]);fa([0,1,5,7,6,2]);fa([0,1,5,4,6,2]);fa([0,1,5,4,0,0]);fa([0,1,3,7,5,4]);fa([0,2,6,4,0,0]);fa([0,0,0,0,0,0]);fa([1,3,7,5,0,0]);fa([2,3,7,6,4,0]);fa([2,3,7,6,0,0]);fa([2,3,1,5,7,6]);fa([0,
1,5,7,6,2]);fa([0,1,5,7,6,4]);fa([0,1,3,7,6,4]);fa([4,5,7,6,2,0]);fa([4,5,7,6,0,0]);fa([4,5,1,3,7,6]);fa([0,2,3,7,5,4]);fa([6,2,3,7,5,4]);fa([6,2,3,1,5,4]);return da})(),M=Array(24),S=new y.Vertices(M,3),N=f.create(),V=f.create(),Q=f.create(),T=f.create(),ia=h.create(),O=c.create(),U=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],P=f.create(),R=f.create(),ba=f.create(),X=f.fromValues(-1,-1,-1);a.INVALID_HALFSIZE=X;a.Obb=F;a.compute=D;a.computeOffsetObb=function(da,ha,fa,aa,Z){var ea=
da.getQuaternion(H);Z.quaternion=ea;k.conjugate(G,ea);var ca=da.getCenter(V);ea=da.getHalfSize(T);if(aa===t.ViewingMode.Global){d.transformQuat(P,ca,G);d.abs(R,P);d.min(ba,R,ea);d.sub(ba,R,ba);aa=d.length(ba);d.add(ba,R,ea);const W=d.length(ba);aa<fa?(Z.center=ca,d.set(P,fa,fa,fa),Z.halfSize=d.add(P,ea,P)):(ha=0<W?1+ha/W:1,ca=0<aa?1+fa/aa:1,fa=(ca+ha)/2,ha=(ca-ha)/2,d.scale(ba,R,ha),Z.halfSize=d.scaleAndAdd(ba,ba,ea,fa),d.scale(ba,R,fa),d.scaleAndAdd(ba,ba,ea,ha),d.sign(P,P),d.multiply(P,ba,P),da=
da.getQuaternion(L),Z.center=d.transformQuat(P,P,da))}else Z.center=d.scaleAndAdd(P,ca,f.UNIT_Z,(fa+ha)/2),da=d.transformQuat(P,f.UNIT_Z,G),d.abs(da,da),Z.halfSize=d.scaleAndAdd(R,ea,da,(fa-ha)/2);return Z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ../../../../chunks/vec32 ../../../../chunks/vec42".split(" "),function(a,b,h,c,k,m,d){function f(O){O[0]=
0;O[1]=0;O[2]=0;O[3]=1;return O}function g(O,U,P){P*=.5;const R=Math.sin(P);O[0]=R*U[0];O[1]=R*U[1];O[2]=R*U[2];O[3]=Math.cos(P);return O}function e(O,U){const P=2*Math.acos(U[3]),R=Math.sin(P/2);R>k.getEpsilon()?(O[0]=U[0]/R,O[1]=U[1]/R,O[2]=U[2]/R):(O[0]=1,O[1]=0,O[2]=0);return P}function n(O,U,P){const R=U[0],ba=U[1],X=U[2];U=U[3];const da=P[0],ha=P[1],fa=P[2];P=P[3];O[0]=R*P+U*da+ba*fa-X*ha;O[1]=ba*P+U*ha+X*da-R*fa;O[2]=X*P+U*fa+R*ha-ba*da;O[3]=U*P-R*da-ba*ha-X*fa;return O}function l(O,U,P){P*=
.5;const R=U[0],ba=U[1],X=U[2];U=U[3];const da=Math.sin(P);P=Math.cos(P);O[0]=R*P+U*da;O[1]=ba*P+X*da;O[2]=X*P-ba*da;O[3]=U*P-R*da;return O}function u(O,U,P){P*=.5;const R=U[0],ba=U[1],X=U[2];U=U[3];const da=Math.sin(P);P=Math.cos(P);O[0]=R*P-X*da;O[1]=ba*P+U*da;O[2]=X*P+R*da;O[3]=U*P-ba*da;return O}function x(O,U,P){P*=.5;const R=U[0],ba=U[1],X=U[2];U=U[3];const da=Math.sin(P);P=Math.cos(P);O[0]=R*P+ba*da;O[1]=ba*P-R*da;O[2]=X*P+U*da;O[3]=U*P-X*da;return O}function w(O,U){const P=U[0],R=U[1];U=U[2];
O[0]=P;O[1]=R;O[2]=U;O[3]=Math.sqrt(Math.abs(1-P*P-R*R-U*U));return O}function q(O,U,P,R){const ba=U[0],X=U[1],da=U[2];U=U[3];let ha=P[0],fa=P[1],aa=P[2];P=P[3];let Z;let ea;var ca=ba*ha+X*fa+da*aa+U*P;0>ca&&(ca=-ca,ha=-ha,fa=-fa,aa=-aa,P=-P);1-ca>k.getEpsilon()?(Z=Math.acos(ca),ea=Math.sin(Z),ca=Math.sin((1-R)*Z)/ea,R=Math.sin(R*Z)/ea):ca=1-R;O[0]=ca*ba+R*ha;O[1]=ca*X+R*fa;O[2]=ca*da+R*aa;O[3]=ca*U+R*P;return O}function v(O){var U=k.RANDOM,P=U();const R=U();U=U();const ba=Math.sqrt(1-P);P=Math.sqrt(P);
O[0]=ba*Math.sin(2*Math.PI*R);O[1]=ba*Math.cos(2*Math.PI*R);O[2]=P*Math.sin(2*Math.PI*U);O[3]=P*Math.cos(2*Math.PI*U);return O}function p(O,U){const P=U[0],R=U[1],ba=U[2];U=U[3];var X=P*P+R*R+ba*ba+U*U;X=X?1/X:0;O[0]=-P*X;O[1]=-R*X;O[2]=-ba*X;O[3]=U*X;return O}function t(O,U){O[0]=-U[0];O[1]=-U[1];O[2]=-U[2];O[3]=U[3];return O}function r(O,U){var P=U[0]+U[4]+U[8];if(0<P)P=Math.sqrt(P+1),O[3]=.5*P,P=.5/P,O[0]=(U[5]-U[7])*P,O[1]=(U[6]-U[2])*P,O[2]=(U[1]-U[3])*P;else{let R=0;U[4]>U[0]&&(R=1);U[8]>U[3*
R+R]&&(R=2);const ba=(R+1)%3,X=(R+2)%3;P=Math.sqrt(U[3*R+R]-U[3*ba+ba]-U[3*X+X]+1);O[R]=.5*P;P=.5/P;O[3]=(U[3*ba+X]-U[3*X+ba])*P;O[ba]=(U[3*ba+R]+U[3*R+ba])*P;O[X]=(U[3*X+R]+U[3*R+X])*P}return O}function y(O,U,P,R){var ba=.5*Math.PI/180;U*=ba;P*=ba;R*=ba;ba=Math.sin(U);U=Math.cos(U);const X=Math.sin(P);P=Math.cos(P);const da=Math.sin(R);R=Math.cos(R);O[0]=ba*P*R-U*X*da;O[1]=U*X*R+ba*P*da;O[2]=U*P*da-ba*X*R;O[3]=U*P*R+ba*X*da;return O}function D(O){return"quat("+O[0]+", "+O[1]+", "+O[2]+", "+O[3]+
")"}function E(O,U,P){const R=m.dot(U,P);if(-.999999>R)return m.cross(S,N,U),1E-6>m.len(S)&&m.cross(S,V,U),m.normalize(S,S),g(O,S,Math.PI),O;if(.999999<R)return O[0]=0,O[1]=0,O[2]=0,O[3]=1,O;m.cross(S,U,P);O[0]=S[0];O[1]=S[1];O[2]=S[2];O[3]=1+R;return I(O,O)}function A(O,U,P,R,ba,X){q(Q,U,ba,X);q(T,P,R,X);q(O,Q,T,2*X*(1-X));return O}function B(O,U,P,R){const ba=ia;ba[0]=P[0];ba[3]=P[1];ba[6]=P[2];ba[1]=R[0];ba[4]=R[1];ba[7]=R[2];ba[2]=-U[0];ba[5]=-U[1];ba[8]=-U[2];return I(O,r(O,ba))}const F=d.copy,
G=d.set,H=d.add,L=d.scale,C=d.dot,z=d.lerp,J=d.length,K=d.squaredLength,I=d.normalize,M=d.exactEquals;d=d.equals;const S=c.create(),N=c.fromValues(1,0,0),V=c.fromValues(0,1,0),Q=h.create(),T=h.create(),ia=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,add:H,calculateW:w,conjugate:t,copy:F,dot:C,equals:d,exactEquals:M,fromEuler:y,fromMat3:r,getAxisAngle:e,identity:f,invert:p,len:J,length:J,lerp:z,mul:n,multiply:n,normalize:I,random:v,rotateX:l,rotateY:u,rotateZ:x,rotationTo:E,scale:L,
set:G,setAxes:B,setAxisAngle:g,slerp:q,sqlerp:A,sqrLen:K,squaredLength:K,str:D},Symbol.toStringTag,{value:"Module"}));a.add=H;a.calculateW=w;a.conjugate=t;a.copy=F;a.dot=C;a.equals=d;a.exactEquals=M;a.fromEuler=y;a.fromMat3=r;a.getAxisAngle=e;a.identity=f;a.invert=p;a.len=J;a.length=J;a.lerp=z;a.mul=n;a.multiply=n;a.normalize=I;a.quat=b;a.random=v;a.rotateX=l;a.rotateY=u;a.rotateZ=x;a.rotationTo=E;a.scale=L;a.set=G;a.setAxes=B;a.setAxisAngle=g;a.slerp=q;a.sqlerp=A;a.sqrLen=K;a.squaredLength=K;a.str=
D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/factories/vec3f64 ./localRotationUtils ./projectors ../support/spatialReferenceUtils".split(" "),function(a,b,h,c,k,m,d){function f(l){return l===m.ProjectionID.SPHERICAL_ECEF||l===m.ProjectionID.SPHERICAL_MARS_PCPF||l===m.ProjectionID.SPHERICAL_MOON_PCPF}
const g=b.deg2rad(1),e=c.create(),n=c.create();a.computeTranslationToOriginAndRotation=function(l,u,x,w){if(null==l||null==w)return!1;var q=m.classifySpatialReference(l,m.sourceClassificationCache),v=m.classifySpatialReference(w,m.destClassificationCache);if(q===v&&!f(v)&&(q!==m.ProjectionID.UNKNOWN||d.equals(l,w)))return h.fromTranslation(x,u),!0;if(f(v)){q=m.projectionTable[q][m.ProjectionID.LON_LAT];v=m.projectionTable[m.ProjectionID.LON_LAT][v];if(null==q||null==v)return!1;q(u,0,e,0);v(e,0,n,
0);k.computeENUToSphericalPCPFLocalRotation(g*e[0],g*e[1],x);x[12]=n[0];x[13]=n[1];x[14]=n[2];return!0}if((v===m.ProjectionID.WEB_MERCATOR||v===m.ProjectionID.PLATE_CARREE||v===m.ProjectionID.WGS84)&&(q===m.ProjectionID.WGS84||q===m.ProjectionID.CGCS2000&&v===m.ProjectionID.PLATE_CARREE||q===m.ProjectionID.SPHERICAL_ECEF||q===m.ProjectionID.WEB_MERCATOR)){l=m.projectionTable[q][m.ProjectionID.LON_LAT];v=m.projectionTable[m.ProjectionID.LON_LAT][v];if(null==l||null==v)return!1;l(u,0,e,0);v(e,0,n,0);
q===m.ProjectionID.SPHERICAL_ECEF?k.computeSphericalPCPFToENULocalRotation(g*e[0],g*e[1],x):h.identity(x);x[12]=n[0];x[13]=n[1];x[14]=n[2];return!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(a,b){function h(c,k,m){const d=Math.sin(c);c=Math.cos(c);const f=Math.sin(k);k=Math.cos(k);m[0]=-d;m[4]=-f*c;m[8]=k*c;m[12]=0;m[1]=c;m[5]=-f*d;m[9]=k*d;m[13]=
0;m[2]=0;m[6]=k;m[10]=f;m[14]=0;m[3]=0;m[7]=0;m[11]=0;m[15]=1;return m}a.computeENUToSphericalPCPFLocalRotation=h;a.computeSphericalPCPFToENULocalRotation=function(c,k,m){h(c,k,m);b.transpose(m,m);return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/dito":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../webgl-engine/lib/Attribute".split(" "),
function(a,b,h,c,k,m,d){function f(Z,ea,ca,W,Y,ja){if(!(1E-6>ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]))for(v(J,ca,ea),v(K,W,ea),v(I,Y,ea),g(Z,ea,z),S[1]=z[0],M[1]=z[1],N[1]=M[1]-S[1],ca=[ca,W,Y],W=[J,K,I],Y=0;3>Y;++Y){g(Z,ca[Y],z);S[0]=z[0];M[0]=z[1];g(Z,W[Y],z);S[2]=z[0];M[2]=z[1];N[0]=M[0]-S[0];N[2]=M[2]-S[2];const oa=l(N);oa<ja.quality&&(q(ja.b0,ca[Y]),q(ja.b1,ea),q(ja.b2,W[Y]),ja.quality=oa)}}function g(Z,ea,ca){const {data:W,size:Y}=Z;ca[0]=Number.POSITIVE_INFINITY;ca[1]=Number.NEGATIVE_INFINITY;
for(Z=0;Z<W.length;Z+=Y){const ja=W[Z]*ea[0]+W[Z+1]*ea[1]+W[Z+2]*ea[2];ca[0]=Math.min(ca[0],ja);ca[1]=Math.max(ca[1],ja)}}function e(Z,ea,ca,W,Y,ja){g(Z,ea,z);Y[0]=z[0];ja[0]=z[1];g(Z,ca,z);Y[1]=z[0];ja[1]=z[1];g(Z,W,z);Y[2]=z[0];ja[2]=z[1]}function n(Z,ea,ca,W,Y,ja,oa){da[0]=Z[0];da[1]=Z[1];da[2]=Z[2];da[3]=ea[0];da[4]=ea[1];da[5]=ea[2];da[6]=ca[0];da[7]=ca[1];da[8]=ca[2];var ra=ha,ta=da,ya=ta[0]+ta[4]+ta[8];if(0<ya)ya=Math.sqrt(ya+1),ra[3]=.5*ya,ya=.5/ya,ra[0]=(ta[5]-ta[7])*ya,ra[1]=(ta[6]-ta[2])*
ya,ra[2]=(ta[1]-ta[3])*ya;else{ya=0;ta[4]>ta[0]&&(ya=1);ta[8]>ta[3*ya+ya]&&(ya=2);const Ca=(ya+1)%3,pa=(ya+2)%3;let wa=Math.sqrt(ta[3*ya+ya]-ta[3*Ca+Ca]-ta[3*pa+pa]+1);ra[ya]=.5*wa;wa=.5/wa;ra[3]=(ta[3*Ca+pa]-ta[3*pa+Ca])*wa;ra[Ca]=(ta[3*Ca+ya]+ta[3*ya+Ca])*wa;ra[pa]=(ta[3*pa+ya]+ta[3*ya+pa])*wa}oa.quaternion=ra;u(R,W,Y);w(R,R,.5);w(ba,Z,R[0]);w(X,ea,R[1]);u(ba,ba,X);w(X,ca,R[2]);oa.center=k.add(ba,ba,X);oa.halfSize=k.scale(R,ja,.5)}function l(Z){return Z[0]*Z[1]+Z[0]*Z[2]+Z[1]*Z[2]}function u(Z,
ea,ca){Z[0]=ea[0]+ca[0];Z[1]=ea[1]+ca[1];Z[2]=ea[2]+ca[2]}function x(Z,ea,ca){Z[0]=ea[0]-ca[0];Z[1]=ea[1]-ca[1];Z[2]=ea[2]-ca[2]}function w(Z,ea,ca){Z[0]=ea[0]*ca;Z[1]=ea[1]*ca;Z[2]=ea[2]*ca}function q(Z,ea,ca=0){Z[0]=ea[ca];Z[1]=ea[ca+1];Z[2]=ea[ca+2]}function v(Z,ea,ca){const W=ea[0],Y=ea[1];ea=ea[2];const ja=ca[0],oa=ca[1];ca=ca[2];Z[0]=Y*ca-ea*oa;Z[1]=ea*ja-W*ca;Z[2]=W*oa-Y*ja}function p(Z,ea){var ca=ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2];0<ca&&(ca=1/Math.sqrt(ca),Z[0]=ea[0]*ca,Z[1]=ea[1]*ca,Z[2]=
ea[2]*ca)}function t(Z,ea){const ca=ea[0]-Z[0],W=ea[1]-Z[1];Z=ea[2]-Z[2];return ca*ca+W*W+Z*Z}const r=m.create(),y=m.create(),D=m.create(),E=m.create(),A=m.create(),B=m.create(),F=m.create(),G=m.create(),H=m.create(),L=m.create(),C=[0,0,0],z=c.create(),J=m.create(),K=m.create(),I=m.create(),M=m.create(),S=m.create(),N=m.create(),V=m.create(),Q=m.create(),T=m.create(),ia=m.create(),O=m.create(),U=m.create(),P=m.create(),R=m.create(),ba=m.create(),X=m.create(),da=b.fromValues(1,0,0,0,1,0,0,0,1),ha=
h.create();class fa{constructor(Z){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ea=0;this.minProj=new Float64Array(this.buffer,ea,7);ea+=56;this.maxProj=new Float64Array(this.buffer,ea,7);ea+=56;for(var ca=0;7>ca;++ca)this.minVert[ca]=new Float64Array(this.buffer,ea,3),ea+=24;for(ca=0;7>ca;++ca)this.maxVert[ca]=new Float64Array(this.buffer,ea,3),ea+=24;for(ea=0;7>ea;++ea)this.minProj[ea]=Number.POSITIVE_INFINITY,this.maxProj[ea]=Number.NEGATIVE_INFINITY;ea=Array(7);
ca=Array(7);const {data:W,size:Y}=Z;for(Z=0;Z<W.length;Z+=Y){var ja=W[Z];ja<this.minProj[0]&&(this.minProj[0]=ja,ea[0]=Z);ja>this.maxProj[0]&&(this.maxProj[0]=ja,ca[0]=Z);ja=W[Z+1];ja<this.minProj[1]&&(this.minProj[1]=ja,ea[1]=Z);ja>this.maxProj[1]&&(this.maxProj[1]=ja,ca[1]=Z);ja=W[Z+2];ja<this.minProj[2]&&(this.minProj[2]=ja,ea[2]=Z);ja>this.maxProj[2]&&(this.maxProj[2]=ja,ca[2]=Z);ja=W[Z]+W[Z+1]+W[Z+2];ja<this.minProj[3]&&(this.minProj[3]=ja,ea[3]=Z);ja>this.maxProj[3]&&(this.maxProj[3]=ja,ca[3]=
Z);ja=W[Z]+W[Z+1]-W[Z+2];ja<this.minProj[4]&&(this.minProj[4]=ja,ea[4]=Z);ja>this.maxProj[4]&&(this.maxProj[4]=ja,ca[4]=Z);ja=W[Z]-W[Z+1]+W[Z+2];ja<this.minProj[5]&&(this.minProj[5]=ja,ea[5]=Z);ja>this.maxProj[5]&&(this.maxProj[5]=ja,ca[5]=Z);ja=W[Z]-W[Z+1]-W[Z+2];ja<this.minProj[6]&&(this.minProj[6]=ja,ea[6]=Z);ja>this.maxProj[6]&&(this.maxProj[6]=ja,ca[6]=Z)}for(Z=0;7>Z;++Z)ja=ea[Z],q(this.minVert[Z],W,ja),ja=ca[Z],q(this.maxVert[Z],W,ja)}}class aa{constructor(){this.b0=m.fromValues(1,0,0);this.b1=
m.fromValues(0,1,0);this.b2=m.fromValues(0,0,1);this.quality=0}}a.computeOBB=function(Z,ea){const {data:ca,size:W}=Z;var Y=ca.length/W;if(!(0>=Y)){var ja=new fa(Z);u(r,ja.minProj,ja.maxProj);w(r,r,.5);x(y,ja.maxProj,ja.minProj);var oa=l(y),ra=new aa;ra.quality=oa;14>Y&&(Z=new d.Vertices(new Float64Array(ja.buffer,112,42),3));var ta=m.create(),ya=m.create(),Ca=m.create();Y=m.create();var pa=m.create(),wa=m.create(),Ba=m.create();var la=Z;var qa=t(ja.maxVert[0],ja.minVert[0]),ua=0;for(var va=1;7>va;++va){const Na=
t(ja.maxVert[va],ja.minVert[va]);Na>qa&&(qa=Na,ua=va)}q(ta,ja.minVert[ua]);q(ya,ja.maxVert[ua]);if(1E-6>t(ta,ya))la=1;else{x(Y,ta,ya);p(Y,Y);const {data:Na,size:Wa}=la;ja=Number.NEGATIVE_INFINITY;qa=0;for(ua=0;ua<Na.length;ua+=Wa)C[0]=Na[ua]-ta[0],C[1]=Na[ua+1]-ta[1],C[2]=Na[ua+2]-ta[2],va=Y[0]*C[0]+Y[1]*C[1]+Y[2]*C[2],va=C[0]*C[0]+C[1]*C[1]+C[2]*C[2]-va*va/(Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2]),va>ja&&(ja=va,qa=ua);q(Ca,Na,qa);1E-6>ja?la=2:(x(pa,ya,Ca),p(pa,pa),x(wa,Ca,ta),p(wa,wa),v(Ba,pa,Y),p(Ba,Ba),
f(la,Ba,Y,pa,wa,ra),la=0)}switch(la){case 1:ea.center=r;ea.halfSize=k.scale(y,y,.5);ea.quaternion=h.IDENTITY;return;case 2:oa=Z;q(Q,Y);Math.abs(Y[0])>Math.abs(Y[1])&&Math.abs(Y[0])>Math.abs(Y[2])?Q[0]=0:Math.abs(Y[1])>Math.abs(Y[2])?Q[1]=0:Q[2]=0;1E-6>Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]&&(Q[0]=Q[1]=Q[2]=1);v(T,Y,Q);p(T,T);v(ia,Y,T);p(ia,ia);e(oa,Y,T,ia,O,U);x(P,U,O);n(Y,T,ia,O,U,P,ea);return}la=Z;ja=z;const {data:Ga,size:La}=la;q(E,Ga);q(D,E);ja[0]=V[0]*Ba[0]+V[1]*Ba[1]+V[2]*Ba[2];ja[1]=ja[0];for(qa=La;qa<
Ga.length;qa+=La)ua=Ga[qa]*Ba[0]+Ga[qa+1]*Ba[1]+Ga[qa+2]*Ba[2],ua<ja[0]&&(ja[0]=ua,q(E,Ga,qa)),ua>ja[1]&&(ja[1]=ua,q(D,Ga,qa));Ba=ta[0]*Ba[0]+ta[1]*Ba[1]+ta[2]*Ba[2];z[1]-1E-6<=Ba&&(D[0]=void 0);z[0]+1E-6>=Ba&&(E[0]=void 0);void 0!==D[0]&&(x(A,D,ta),p(A,A),x(B,D,ya),p(B,B),x(F,D,Ca),p(F,F),v(G,B,Y),p(G,G),v(H,F,pa),p(H,H),v(L,A,wa),p(L,L),f(la,G,Y,B,A,ra),f(la,H,pa,F,B,ra),f(la,L,wa,A,F,ra));void 0!==E[0]&&(x(A,E,ta),p(A,A),x(B,E,ya),p(B,B),x(F,E,Ca),p(F,F),v(G,B,Y),p(G,G),v(H,F,pa),p(H,H),v(L,A,
wa),p(L,L),f(la,G,Y,B,A,ra),f(la,H,pa,F,B,ra),f(la,L,wa,A,F,ra));e(Z,ra.b0,ra.b1,ra.b2,O,U);Z=m.create();x(Z,U,O);ra.quality=l(Z);ra.quality<oa?n(ra.b0,ra.b1,ra.b2,O,U,Z,ea):(ea.center=r,ea.halfSize=k.scale(y,y,.5),ea.quaternion=h.IDENTITY)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(a){class b{constructor(c,k,m=k){this.data=c;this.size=k;this.stride=m}}class h extends b{constructor(c,k,m,d=!1,
f=m){super(c,m,f);this.indices=k;this.exclusive=d}}a.Attribute=h;a.Vertices=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/Extent ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(D,E,A,B=e.createDirectionUp()){const {direction:F,up:G}=B;h.fromZRotation(t,-b.deg2rad(E));h.rotateX(t,t,b.deg2rad(A));k.transformMat4(F,p,t);k.scale(F,F,-1);k.transformMat4(G,v,t);return B}function l(D,E,A,B){return e.directionToHeadingTilt(E,A,B,p,v)}function u(D,E,A,B){const F=n(D,A,B),G=m.create();k.scale(G,F.direction,-E);k.add(G,G,D);return{up:F.up,eye:G,heading:A,tilt:B}}function x(D){return b.rad2deg(D)}function w(D){return b.deg2rad(D)}function q(D,
E,A,B,F){const G=D.renderSpatialReference;D=D.map&&D.spatialReference||E.spatialReference;f.projectPointToVector(E,r,G);f.projectPointToVector(E,y,G);r[0]-=A/2;y[0]+=A/2;r[1]-=B/2;y[1]+=B/2;g.projectVectorToVector(r,G,r,D);g.projectVectorToVector(y,G,y,D);F?(F.xmin=r[0],F.ymin=r[1],F.xmax=y[0],F.ymax=y[1],F.spatialReference=D):F=new d(r[0],r[1],y[0],y[1],D);return F}const v=m.fromValues(0,1,0),p=m.fromValues(0,0,1),t=c.create(),r=m.create(),y=m.create();c=Object.freeze(Object.defineProperty({__proto__:null,
directionToHeadingTilt:l,eyeForCenterWithHeadingTilt:u,eyeTiltToLookAtTilt:w,headingTiltToDirectionUp:n,lookAtTiltToEyeTilt:x,toExtent:q},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=c;a.directionToHeadingTilt=l;a.eyeForCenterWithHeadingTilt=u;a.eyeTiltToLookAtTilt=w;a.headingTiltToDirectionUp=n;a.lookAtTiltToEyeTilt=x;a.toExtent=q})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b,h,c){const k=c.create(),m=c.create();a.createDirectionUp=function(){return{direction:c.create(),up:c.create()}};a.directionToHeadingTilt=function(d,f,g,e,n){let l=h.normalize(k,d),u=h.dot(l,e);const x=0<u;u=Math.abs(u);.99<u&&(u=Math.abs(h.dot(f,e)),.99>u?(h.copy(l,f),x&&h.scale(l,l,-1)):l=null);f=0;l&&(h.scale(m,e,h.dot(e,l)),h.subtract(l,l,m),f=h.dot(l,n)/(h.length(l)*h.length(n)),h.cross(m,l,n),f=(0<h.dot(m,e)?1:-1)*b.rad2deg(b.acosClamped(f)));d=b.rad2deg(b.acosClamped(-h.dot(e,d)/
h.length(d)));if(!g)return{heading:f,tilt:d};g.heading=f;g.tilt=d;return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(H,L,C,z=l.createDirectionUp()){m.cross(F,H,D);0===m.dot(F,F)&&m.cross(F,H,E);c.fromRotation(B,-h.deg2rad(L),H);c.rotate(B,B,-h.deg2rad(C),F);const {up:J,direction:K}=z;m.cross(J,F,H);m.normalize(J,J);m.transformMat4(J,J,B);m.normalize(K,H);m.negate(K,K);m.transformMat4(K,K,B);return z}function w(H,L,C,z){const J=F,K=G;m.normalize(J,H);m.cross(G,J,D);0===m.dot(G,G)&&m.cross(G,J,E);m.cross(K,G,J);return l.directionToHeadingTilt(L,C,z,J,K)}function q(H,
L,C,z){const J={eye:d.create(),up:null,tilt:z,heading:C},K=F;K[0]=H[0];K[1]=H[2];K[2]=-H[1];C=h.deg2rad(C);var I=h.deg2rad(z);z=Math.sin(C);C=Math.cos(C);var M=Math.sin(I),S=Math.cos(I);const N=m.length(K);if(1E-8>Math.abs(I))I=L+N;else{var V=N/M,Q=h.asinClamped(L/V);I=V*Math.sin(Math.PI-I-Q)}S*=L;V=L*L*M*M;Q=C*C*V;const T=I-S,ia=T*T;var O=Q*(Q+ia-K[1]*K[1]);if(0>O)return m.scale(J.eye,K,I/N),J.tilt=0,p(J,H);var U=Math.sqrt(O);const P=K[1]*T;O=Q+ia;U=0<C?-U+P:U+P;if(1E-8>Math.abs(O))return 1E-8>N?
(J.eye[0]=0,J.eye[1]=0,J.eye[2]=L):m.scale(J.eye,K,I/N),J.tilt=0,v(J.eye),p(J,H);J.eye[1]=U/O;L*=M;U=J.eye[1]*J.eye[1];M=1-U;O=Math.sqrt(M);V=Q*U+z*z*V-2*C*L*J.eye[1]*O*T+M*ia;if(1E-8>Math.abs(V))return m.scale(J.eye,K,I/N),J.tilt=0,v(J.eye),p(J,H);J.eye[0]=(M*(I*K[0]-S*K[0])-L*O*(K[0]*J.eye[1]*C+K[2]*z))/V;J.eye[2]=(M*(I*K[2]-S*K[2])-L*O*(K[2]*J.eye[1]*C-K[0]*z))/V;m.scale(J.eye,J.eye,I);v(J.eye);return p(J,H)}function v(H){const L=H[1];H[1]=-H[2];H[2]=L}function p(H,L){L=x(L,H.heading,H.tilt);H.up=
L.up;return H}function t(H,L,C){L=m.length(L);C=h.asinClamped(C/(Math.sqrt(C*C+L*L-2*C*L*Math.cos(Math.PI-H))/Math.sin(H)));return h.rad2deg(H-C)}function r(H,L,C){H=h.deg2rad(H);L=m.length(L);return h.asinClamped(C/(L/Math.sin(H)))+H}function y(H,L,C,z,J){function K(N){const V=Math.PI/2;N=b.cyclical2PI.normalize(N,-V);N>V&&(N=Math.PI-N);return N}var I=L.latitude;var M=f.getReferenceEllipsoid(H.spatialReference).radius;L=L.longitude;var S=u.getLonDeltaForDistance(I,C,M)/2;C=L-S;L+=S;I=h.deg2rad(I);
I=(1+Math.sin(I))/(1-Math.sin(I));S=(I+1)*Math.tan(z/M/2);I=1.5*Math.PI-2*Math.atan(.5*(S+Math.sqrt(4*I+S*S)));z=I+z/M;I=K(I);z=K(z);z<I&&(M=z,z=I,I=M);I=Math.max(h.rad2deg(I),-90);z=Math.min(h.rad2deg(z),90);L=A.monotonic(C,L);180<L-C&&(M=(L-C-180)/2,C+=M,L-=M);M=H.spatialReference&&H.spatialReference.isGeographic?H.spatialReference:e.WGS84;J?(J.xmin=C,J.ymin=I,J.xmax=L,J.ymax=z,J.spatialReference=M):J=new g(C,I,L,z,M);H.spatialReference&&H.spatialReference.isWebMercator&&n.geographicToWebMercator(J,
!1,J);return J}const D=d.fromValues(0,0,1),E=m.normalize(d.create(),d.fromValues(1,1,1)),A=new b.Cyclical(-180,180),B=k.create(),F=d.create(),G=d.create();k=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:w,eyeForCenterWithHeadingTilt:q,eyeTiltToLookAtTilt:r,headingTiltToDirectionUp:x,lookAtTiltToEyeTilt:t,toExtent:y},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=k;a.directionToHeadingTilt=w;a.eyeForCenterWithHeadingTilt=q;a.eyeTiltToLookAtTilt=r;a.headingTiltToDirectionUp=
x;a.lookAtTiltToEyeTilt=t;a.toExtent=y})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(a,b,h,c){function k(f,g,e){if(null==g.longitude||null==g.latitude||null==e.longitude||null==e.latitude)throw Error("Invalid points: no lon/lat");return m(f,g.longitude,g.latitude,e.longitude,e.latitude)}function m(f,g,e,n,l){e=b.deg2rad(e);l=b.deg2rad(l);g=b.deg2rad(g);const u=b.deg2rad(n);n=Math.sin((e-
l)/2);g=Math.sin((g-u)/2);e=2*b.asinClamped(Math.sqrt(n*n+Math.cos(e)*Math.cos(l)*g*g));return Math.round(e*f*1E4)/1E4}function d(f,g){f/=15;g||(f=Math.round(f));return f}a.getGreatCircleDistance=m;a.getGreatCircleDistanceFromPoints=k;a.getGreatCircleSpanAt=function(f,g,e){const n=g.spatialReference,l=h.getReferenceEllipsoid(n),u=new c(g.x,f.y,n),x=new c(e.x,f.y,n);g=new c(f.x,g.y,n);f=new c(f.x,e.y,n);return{lon:k(l.radius,u,x),lat:k(l.radius,g,f)}};a.getLonDeltaForDistance=function(f,g,e){g/=e;
f=b.deg2rad(f);g=Math.sin(g/2);f=Math.cos(f);f=2*b.asinClamped(Math.sqrt(g*g/(f*f)));return b.rad2deg(f)};a.longitudeToTimezone=d;a.positionToTimezoneInfo=function(f,g){f=f?.[0];if(null==f)return null;g||={hours:0,minutes:0,seconds:0};g.hours=d(f,!0);f=g.hours%1;g.hours-=f;g.minutes=60*f;f=g.minutes%1;g.minutes-=f;g.seconds=Math.round(60*f);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatureUtils"],
function(a,b){function h(k){return"array"in k}class c{constructor(k,m=null,d=0){this.array=k;this.spatialReference=m;this.offset=d}}a.SamplePosition=c;a.getElevationAtPoint=function(k,m,d="ground"){if(b.isDehydratedPoint(m))return k.getElevation(m.x,m.y,m.z||0,m.spatialReference,d);if(h(m)){let f=m.offset;return k.getElevation(m.array[f++],m.array[f++],m.array[f]||0,m.spatialReference??k.spatialReference,d)}return k.getElevation(m[0],m[1],m[2]||0,k.spatialReference,d)};a.isSamplePosition=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,h){a.isSpatialReferenceSupported=function(c,k){return null==c?!1:null==k?!0:k===h.ViewingMode.Local?c.isGeographic?
c.isWGS84||c.wkid===b.SupportedGCSWkids.CGCS2000:!0:c.isWebMercator||c.isWGS84||c.wkid===b.SupportedGCSWkids.CGCS2000||c.wkid===b.SupportedGCSWkids.GCSMARS2000||c.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||c.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){b=class extends b.EventedAccessor{constructor(u){super(u);this.demResolution={min:-1,max:-1};this.noDataValue=l.elevationNodataValue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const u=this.view.basemapTerrain;if(null==u?.extent||null==u.spatialReference)return null;const x=g.toExtent(u.extent,u.spatialReference);x.zmin=u.visibleElevationBounds.min;x.zmax=u.visibleElevationBounds.max;return x}get spatialReference(){return this.view.basemapTerrain?.spatialReference??
f.WGS84}elevationAt(u,x){if(null==this.extent||!e.extentContainsXYZ(this.extent,u,x)){const w=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;h.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${u}, ${x}) is outside of the sampler extent (${w})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(u,x,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(u){return n.updateGeometryElevation(u.clone(),
this)}};a.__decorate([c.property({readOnly:!0})],b.prototype,"demResolution",void 0);a.__decorate([c.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([c.property({readOnly:!0})],b.prototype,"noDataValue",void 0);a.__decorate([c.property()],b.prototype,"spatialReference",null);a.__decorate([c.property({constructOnly:!0})],b.prototype,"view",void 0);return b=a.__decorate([d.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../geometry ../../core/has ../../core/handleUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(v,p){const t=n(v,p.spatialReference);if(!t)return null;switch(v.type){case "point":v.z=p.elevationAt(t.x,t.y);break;case "polyline":q.spatialReference=t.spatialReference;var r=v.hasM&&!v.hasZ;for(var y=0;y<v.paths.length;y++){var D=v.paths[y],E=t.paths[y];for(let A=0;A<D.length;A++){const B=D[A],F=E[A];q.x=F[0];q.y=F[1];r&&(B[3]=B[2]);B[2]=p.elevationAt(q.x,q.y)}}v.hasZ=!0;break;case "multipoint":q.spatialReference=t.spatialReference;r=v.hasM&&!v.hasZ;for(y=
0;y<v.points.length;y++)D=v.points[y],E=t.points[y],q.x=E[0],q.y=E[1],r&&(D[3]=D[2]),D[2]=p.elevationAt(q.x,q.y);v.hasZ=!0}return v}function n(v,p){if(null==v)return null;const t=v.spatialReference;if(t.equals(p))return v;(v=f.project(v,p))||l().error(`Cannot project geometry spatial reference (wkid:${t.wkid}) to elevation sampler spatial reference (wkid:${p.wkid})`);return v}const l=()=>k.getLogger("esri.layers.support.ElevationSampler");class u{queryElevation(v){return e(v.clone(),this)}on(){return c.makeHandle()}projectIfRequired(v,
p){return n(v,p)}}class x extends u{get spatialReference(){return this.extent.spatialReference}constructor(v,p,t){super();this.tile=v;this.noDataValue=t;t=v.tile.extent;this.extent=d.toExtent(t,p.spatialReference);this.extent.zmin=v.zmin;this.extent.zmax=v.zmax;this._aaExtent=t;t=m.getMetersPerUnitForSR(p.spatialReference);v=p.lodAt(v.tile.level).resolution*t;this.demResolution={min:v,max:v}}contains(v){v=this.projectIfRequired(v,this.spatialReference);return null==v?!1:this.containsAt(v.x,v.y)}containsAt(v,
p){return d.containsXY(this._aaExtent,v,p)}elevationAt(v,p){if(!this.containsAt(v,p)){var t=this.extent;t=`${t.xmin}, ${t.ymin}, ${t.xmax}, ${t.ymax}`;l().warn("#elevationAt()",`Point used to sample elevation (${v}, ${p}) is outside of the sampler extent (${t})`);return this.noDataValue}return this.tile.sample(v,p)??this.noDataValue}}class w extends u{get spatialReference(){return this.extent.spatialReference}constructor(v,p,t){super();let r;"number"===typeof p?(this.noDataValue=p,r=null):(r=p,this.noDataValue=
t);this.samplers=r?v.map(y=>new x(y,r,this.noDataValue)):v;if(v=this.samplers[0]){this.extent=v.extent.clone();const {min:y,max:D}=v.demResolution;this.demResolution={min:y,max:D};for(v=1;v<this.samplers.length;v++)p=this.samplers[v],this.extent.union(p.extent),this.demResolution.min=Math.min(this.demResolution.min,p.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,p.demResolution.max)}else this.extent=d.toExtent(d.create(),r.spatialReference),this.demResolution={min:0,max:0}}elevationAt(v,
p){let t,r=!1;for(const y of this.samplers)if(y.containsAt(v,p)&&(r=!0,t=y.elevationAt(v,p),t!==y.noDataValue))return t;if(null!=t)return t;r||l().warn("#elevationAt()",`Point used to sample elevation (${v}, ${p}) is outside of the sampler`);return this.noDataValue}}const q=new g;a.ElevationSamplerBase=u;a.MultiTileElevationSampler=w;a.TileElevationSampler=x;a.updateGeometryElevation=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports",
"../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,h,c){b=b.clampFloat32(b.numberMaxFloat32/10);const k=h.create();c.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,k);h=h.create([-180,-90,180,90]);let m=3;a.elevationNodataValue=b;a.geographicWorldExtent=h;a.getElevationDesiredResolutionLevel=function(d){return 4>d?3:m};a.maxMemoryLodBias=2.5;a.maxPatchTesselation=512;a.maxRootTiles=64;a.maxTileNeighborLevelDelta=4;a.progressiveLoadingModulo=
2;a.test={setElevationDesiredMaxUpscalingDistance(d){m=null==d?3:d}};a.tooManyRootTilesAfterChangeError="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.tooManyRootTilesForLayerError="Surface extent is too large for tile resolution at level 0.";a.webmercatorWorldExtent=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}class q{constructor(p){var t=q.checkUnsupported(p);if(null!=t)throw t;this.spatialReference=p.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=d.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[p.origin.x,p.origin.y];this.pixelSize=p.size[0];
this.dpi=p.dpi;var r=p.lods.reduce((E,A,B)=>{A.level<E.min&&(E.min=A.level,E.minIndex=B);E.max=Math.max(E.max,A.level);return E},{min:Infinity,minIndex:0,max:-Infinity}),y=p.lods[r.minIndex];const D=2**y.level;t=y.resolution*D;y=y.scale*D;this.levels=Array(r.max+1);for(r=0;r<this.levels.length;r++)this.levels[r]={resolution:t,scale:y,tileSize:[t*p.size[0],t*p.size[1]]},t/=2,y/=2}clone(){return new q(this.toTileInfo())}toTileInfo(){return new u({dpi:this.dpi,origin:new x({x:this.origin[0],y:this.origin[1],
spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((p,t)=>new l({level:t,scale:p.scale,resolution:p.resolution}))})}getExtent(p,t,r,y){var D=this.levels[p];p=D.tileSize[0];D=D.tileSize[1];y[0]=this.origin[0]+r*p;y[2]=this.origin[0]+(r+1)*p;y[3]=this.origin[1]-t*D;y[1]=this.origin[1]-(t+1)*D}convertExtentToRadians(p,t){this._isWebMercator?(t[0]=n.x2lon(p[0]),t[1]=n.y2lat(p[1]),t[2]=n.x2lon(p[2]),t[3]=n.y2lat(p[3])):
this._isGCS&&(t[0]=c.deg2rad(p[0]),t[1]=c.deg2rad(p[1]),t[2]=c.deg2rad(p[2]),t[3]=c.deg2rad(p[3]))}getExtentGeometry(p,t,r,y=new m){this.getExtent(p,t,r,v);y.spatialReference=this.spatialReference;y.xmin=v[0];y.ymin=v[1];y.xmax=v[2];y.ymax=v[3];y.zmin=void 0;y.zmax=void 0;return y}ensureMaxLod(p){if(null==p)return!1;for(var t=!1;this.levels.length<=p;){t=this.levels[this.levels.length-1];const r=t.resolution/2;this.levels.push({resolution:r,scale:t.scale/2,tileSize:[r*this.pixelSize,r*this.pixelSize]});
t=!0}return t}capMaxLod(p){this.levels.length>p+1&&(this.levels.length=p+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(p){return this.levels[0].scale/2**p}levelAtScale(p){const t=this.levels[0].scale;return p>=t?0:Math.log(t/p)*Math.LOG2E}resolutionAtLevel(p){return this.levels[0].resolution/2**p}compatibleWith(p){if(!(p instanceof q)){if(q.checkUnsupported(p))return!1;p=new q(p)}if(!p.spatialReference.equals(this.spatialReference)||p.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,
p.levels.length)-1,r=this.levels[t].resolution;let y=.5*r;if(!c.floatEqualAbsolute(p.origin[0],this.origin[0],y)||!c.floatEqualAbsolute(p.origin[1],this.origin[1],y))return!1;y=.5*r/2**t/this.pixelSize*12;return c.floatEqualAbsolute(r,p.levels[t].resolution,y)}rootTilesInExtent(p,t=null,r=Infinity){const y=[],D=this.levels[0].tileSize;if(null==p||0===D[0]||0===D[1])return y;q.computeRowColExtent(p,D,this.origin,v);p=v[1];let E=v[3],A=v[0],B=v[2];var F=B-A;const G=E-p;F*G>r&&(r=Math.floor(Math.sqrt(r)),
G>r&&(p=p+Math.floor(.5*G)-Math.floor(.5*r),E=p+r),F>r&&(A=A+Math.floor(.5*F)-Math.floor(.5*r),B=A+r));for(r=p;r<E;r++)for(F=A;F<B;F++)y.push([0,r,F]);null!=t&&(t[0]=this.origin[0]+A*D[0],t[1]=this.origin[1]-E*D[1],t[2]=this.origin[0]+B*D[0],t[3]=this.origin[1]-p*D[1]);return y}static computeRowColExtent(p,t,r,y){const D=.001*(p[2]-p[0]+(p[3]-p[1]));y[0]=Math.max(0,Math.floor((p[0]+D-r[0])/t[0]));y[2]=Math.max(0,Math.ceil((p[2]-D-r[0])/t[0]));y[1]=Math.max(0,Math.floor((r[1]-p[3]+D)/t[1]));y[3]=Math.max(0,
Math.ceil((r[1]-p[1]-D)/t[1]))}static isPowerOfTwo(p){p=p.lods;const t=p[0].resolution*2**p[0].level;return!p.some(r=>!c.floatEqualRelative(r.resolution,t/2**r.level))}static hasGapInLevels(p){p=p.lods.map(t=>t.level);p.sort((t,r)=>t-r);for(let t=1;t<p.length;t++)if(p[t]!==p[0]+t)return!0;return!1}static tileSizeSupported(p){const t=p.size[1];return t===p.size[0]&&0===(t&t-1)&&128<=t&&512>=t}static hasOriginPerLODs(p){const t=p.origin;return p.lods.some(r=>null!=r.origin&&(r.origin[0]!==t.x||r.origin[1]!==
t.y))}static getMissingTileInfoError(){return new h("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(p){return null==p?w():1>p.lods.length?new h("tilingscheme:generic","Tiling scheme must have at least one level"):q.isPowerOfTwo(p)?q.hasGapInLevels(p)?new h("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):q.tileSizeSupported(p)?q.hasOriginPerLODs(p)?new h("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):
null:new h("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new h("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(p,t){const r=p[2]-p[0],y=p[3]-p[1],D=k.getMetersPerUnitForSR(t),E=1.2*Math.max(r,y);p=new q(new u({size:[256,256],origin:new x({x:p[0]-.5*(E-r),y:p[3]+.5*(E-y)}),lods:[new l({level:0,resolution:E/256,scale:1/(256/96*.0254/(E*D))})],spatialReference:t}));p.ensureMaxLod(20);return p}static makeWebMercatorAuxiliarySphere(p){const t=
new q(q.WebMercatorAuxiliarySphereTileInfo);t.ensureMaxLod(p);return t}static makeGCSWithTileSize(p,t=256,r=16){const y=256/t;p=new q(new u({size:[t,t],origin:new x({x:-180,y:90,spatialReference:p}),spatialReference:p,lods:[new l({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));p.ensureMaxLod(r);return p}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}q.WebMercatorAuxiliarySphereTileInfo=new u({size:[256,256],origin:new x({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:f.WebMercator}),spatialReference:f.WebMercator,lods:[new l({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});q.WebMercatorAuxiliarySphere=q.makeWebMercatorAuxiliarySphere(19);const v=g.create();a.TilingScheme=q;a.getMissingTileInfoError=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){var f;b=f=class extends b.JSONSupport{constructor(g){super(g);this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new f({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);a.__decorate([h.property({type:c.Integer,
json:{write:!0}})],b.prototype,"level",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);a.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);a.__decorate([h.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);a.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,
"rows",void 0);a.__decorate([h.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=f=a.__decorate([d.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){var t;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});h=t=class extends h.JSONSupport{static create(r={}){const {resolutionFactor:y=1,scales:D,size:E=256,spatialReference:A=u.WebMercator,numLODs:B=24}=r;if(!w.isValid(A)){r=[];if(D)for(var F=0;F<D.length;F++){var G=
D[F];r.push(new v({level:F,scale:G,resolution:G}))}else for(F=5E-4,G=B-1;0<=G;G--)r.unshift(new v({level:G,scale:F,resolution:F})),F*=2;return new t({dpi:96,lods:r,origin:new l(0,0,A),size:[E,E],spatialReference:A})}F=w.getInfo(A);r=r.origin?new l({x:r.origin.x,y:r.origin.y,spatialReference:A}):F?new l({x:F.origin[0],y:F.origin[1],spatialReference:A}):new l({x:0,y:0,spatialReference:A});F=1/(39.37*c.getMetersPerUnitForSR(A)*96);G=[];if(D)for(var H=0;H<D.length;H++){var L=D[H];G.push(new v({level:H,
scale:L,resolution:L*F}))}else{var C=w.isGeographic(A)?512/E*5.916575275917094E8:256/E*5.91657527591555E8;H=Math.ceil(B/y);G.push(new v({level:0,scale:C,resolution:C*F}));for(L=1;L<H;L++)C/=2**y,G.push(new v({level:L,scale:C,resolution:C*F}))}return new t({dpi:96,lods:G,origin:r,size:[E,E],spatialReference:A})}constructor(r){super(r);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:r,origin:y}=this;if(r&&y){const D=w.getInfo(r);return r.isWrappable&&
!!D&&Math.abs(D.origin[0]-y.x)<=D.dx}return!1}readOrigin(r,y){return l.fromJSON({spatialReference:y.spatialReference,...r})}set lods(r){const y=[],D=this._levelToLOD={};r&&r.forEach(E=>{y.push(E.scale);D[E.level]=E});this._set("scales",y);this._set("lods",r);this._initializeUpsampleLevels()}readSize(r,y){return[y.cols,y.rows]}writeSize(r,y){y.cols=r[0];y.rows=r[1]}zoomToScale(r){const y=this.scales;if(0>=r)return y[0];if(r>=y.length-1)return y[y.length-1];const D=Math.floor(r);return y[D]/(y[D]/y[D+
1])**(r-D)}scaleToZoom(r){const y=this.scales,D=y.length-1;let E=0;for(;E<D;E++){const A=y[E],B=y[E+1];if(A<=r)break;if(B===r)return E+1;if(A>r&&B<r)return E+Math.log(A/r)/Math.log(A/B)}return E}snapScale(r,y=.95){r=this.scaleToZoom(r);return r%Math.floor(r)>=y?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(r,y,D,E){var A=this.lodAt(r);if(!A)return null;let B;if("number"===typeof y)B=y,y=D;else{if(w.equals(y.spatialReference,this.spatialReference))B=y.x,y=y.y;else{E=q.project(y,
this.spatialReference);if(null==E)return null;B=E.x;y=E.y}E=D}D=A.resolution*this.size[0];A=A.resolution*this.size[1];E||=new p.TileKey(null,0,0,0,x.create());E.level=r;E.row=Math.floor((this.origin.y-y)/A+.001);E.col=Math.floor((B-this.origin.x)/D+.001);this.updateTileInfo(E);return E}updateTileInfo(r,y=t.ExtrapolateOptions.NONE){var D=this.lodAt(r.level);D||y!==t.ExtrapolateOptions.POWER_OF_TWO||(y=this.lods[this.lods.length-1],y.level<r.level&&(D=y));if(D){var E=r.level-D.level;y=D.resolution*
this.size[0]/2**E;D=D.resolution*this.size[1]/2**E;r.id=`${r.level}/${r.row}/${r.col}`;r.extent||(r.extent=x.create());r.extent[0]=this.origin.x+r.col*y;r.extent[1]=this.origin.y-(r.row+1)*D;r.extent[2]=r.extent[0]+y;r.extent[3]=r.extent[1]+D}}upsampleTile(r){const y=this._upsampleLevels[r.level];if(!y||-1===y.parentLevel)return!1;r.level=y.parentLevel;r.row=Math.floor(r.row/y.factor+.001);r.col=Math.floor(r.col/y.factor+.001);this.updateTileInfo(r);return!0}getTileBounds(r,y){var D=this.lodAt(y.level);
if(null==D)return null;var {resolution:E}=D;D=E*this.size[0];E*=this.size[1];r[0]=this.origin.x+y.col*D;r[1]=this.origin.y-(y.row+1)*E;r[2]=r[0]+D;r[3]=r[1]+E;return r}lodAt(r){return this._levelToLOD?.[r]??null}clone(){return t.fromJSON(this.write({}))}getOrCreateCompatible(r,y){if(256===this.size[0]&&256===this.size[1])return 256===r?this:null;const D=[],E=this.lods.length;for(let A=0;A<E;A++){const B=this.lods[A];D.push(new v({level:B.level,scale:B.scale,resolution:B.resolution*y}))}return new t({size:[r,
r],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:D})}_initializeUpsampleLevels(){const r=this.lods;this._upsampleLevels=[];let y=null;for(let D=0;D<r.length;D++){const E=r[D];this._upsampleLevels[E.level]={parentLevel:y?y.level:-1,factor:y?y.resolution/E.resolution:0};y=E}}};a.__decorate([k.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);a.__decorate([k.property({type:Number,
json:{write:!0}})],h.prototype,"dpi",void 0);a.__decorate([k.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);a.__decorate([k.property({readOnly:!0})],h.prototype,"isWrappable",null);a.__decorate([k.property({type:l,json:{write:!0}})],h.prototype,"origin",void 0);a.__decorate([g.reader("origin")],h.prototype,"readOrigin",null);a.__decorate([k.property({type:[v],value:null,json:{write:!0}})],h.prototype,"lods",null);a.__decorate([k.property({readOnly:!0})],
h.prototype,"scales",void 0);a.__decorate([k.property({cast:r=>Array.isArray(r)?r:"number"===typeof r?[r,r]:[256,256]})],h.prototype,"size",void 0);a.__decorate([g.reader("size",["rows","cols"])],h.prototype,"readSize",null);a.__decorate([n.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],h.prototype,"writeSize",null);a.__decorate([k.property({type:u,json:{write:!0}})],h.prototype,"spatialReference",void 0);h=t=a.__decorate([e.subclass("esri.layers.support.TileInfo")],h);(function(r){r=
r.ExtrapolateOptions||(r.ExtrapolateOptions={});r[r.NONE=0]="NONE";r[r.POWER_OF_TWO=1]="POWER_OF_TWO"})(h||={});return h})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class b{constructor(h,c,k,m,d){this.id=h;this.level=c;this.row=k;this.col=m;this.extent=d}}a.TileKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/tslib.es6 ../core/asyncUtils ../core/deprecate ../core/Error ../core/has ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(t){return null!=t&&"open"in t&&"declaredClass"in t}function q(t){return null!=t&&"declaredClass"in t&&"dockOptions"in t}const v=t=>Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}));class p{constructor(t){this.layerView=t;this._resolver=g.createResolver();this.graphics=[]}get promise(){return this._resolver.promise}resolve(t){const {layerView:r,graphics:y,_resolver:D}=this;if(!r)return D.resolve(y),
D.promise;let E;r.fetchPopupFeaturesFromGraphics(y,t).catch(A=>{E=A;return null}).then(A=>{A?D.resolve(A):D.reject(E)});return D.promise}}b.PopupView=t=>{t=class extends t{constructor(){super(...arguments);this._popupSetupTask=null;this.popup={};this.popupEnabled=!0}initialize(){this.addHandles([e.watch(()=>[this.ui,this.popup],([r,y],D)=>{if(D){const [E,A]=D;E&&w(A)&&(A.view=null,q(A)&&E.remove(A,"popup"))}r&&w(y)&&(y.view=this,q(y)&&r.add(y,{key:"popup",position:"manual",internal:!0}))},e.initial),
this.on("click",r=>{this.popup&&this.popupEnabled&&("mouse"!==r.pointerType||0===r.button)&&(!w(this.popup)&&"autoOpenEnabled"in this.popup&&!1===this.popup.autoOpenEnabled||(w(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup();w(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},x.ViewEventPriorities.WIDGET)]);e.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((r,y)=>
a(["../widgets/Popup"],D=>r(v(D)),y))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(w(this.popup))return this.popup.open(r);try{await this.setupPopup(),this.popup?this.popup.open(r):f.getLogger(this).error(new m("view:null-popup","Popup is null and can't be opened"))}catch{}}closePopup(){this._popupSetupTask?.abort();w(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,y){await this.when();return this._popupHitsToFeatures(await this._getPopupHits(r,y),y)}async setupPopup(){this._popupSetupTask?.abort();
if(this.popup&&!w(this.popup))return this._popupSetupTask=c.createTask(async r=>{const {default:y}=await new Promise((D,E)=>a(["../widgets/Popup"],A=>D(v(A)),E));g.throwIfAborted(r);this.popup&&!w(this.popup)&&(r=this.popup,delete r.open,delete r.close,this.popup=new y(r))}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:y},D){const E=[],A=[];let B=!1;const F=g.wrapAbortWithTimeout(D,d("popup-view-fetch-timeout")??5E3);D=G=>{const H=A.at(-1);H&&H.layerView===G&&!B?G=H:(G=
new p(G),A.push(G),E.push(G.promise));return G};for(const G of y)"graphic"in G?(D(G.layerView).graphics.push(G.graphic),B=!1):(E.push(G.layerView.fetchPopupFeaturesAtLocation(G.mapPoint,F)),B=!0);A.map(G=>G.resolve(F));y=g.allSettledValues(E).then(G=>G.filter(H=>!!H).flat());return{pendingFeatures:E,allGraphicsPromise:y,location:r}}async _getPopupHits(r,y){const {hits:D,location:E}=await this.popupHitTest(r);g.throwIfAborted(y);r=[];for(const A of D)if("graphic"in A){if(this._isValidPopupGraphic(A.graphic,
y)){const B=this._isValidPopupGraphicsLayerView(A.layerView)?A.layerView:void 0;r.push({graphic:A.graphic,layerView:B})}}else this._isValidPopupLocationLayerView(A.layerView)&&r.push({mapPoint:A.mapPoint,layerView:A.layerView});return{hits:r,location:E}}_isValidPopupGraphic(r,y){return r&&!!r.getEffectivePopupTemplate(null!=y&&y.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in
r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};h.__decorate([n.property({cast(r){if(!r||w(r))return r;"object"===typeof r&&(r.open=y=>{k.deprecated(f.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"});return this.openPopup(y)},r.close=()=>{k.deprecated(f.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",
{replacement:"Use view.closePopup() instead.",version:"4.27"});return this.closePopup()});return r}})],t.prototype,"popup",void 0);h.__decorate([n.property()],t.prototype,"popupEnabled",void 0);return t=h.__decorate([u.subclass("esri.views.PopupView")],t)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(a,b,h){const c=f=>Object.freeze(Object.defineProperty({__proto__:null,
default:f},Symbol.toStringTag,{value:"Module"})),k=()=>new Promise((f,g)=>a(["./layers/TileLayerView3D"],e=>f(c(e)),g)),m=()=>new Promise((f,g)=>a(["./layers/ElevationLayerView3D"],e=>f(c(e)),g)),d={"base-dynamic":()=>new Promise((f,g)=>a(["./layers/BaseDynamicLayerView3D"],e=>f(c(e)),g)),"base-elevation":m,"base-tile":k,"bing-maps":k,"building-scene":()=>new Promise((f,g)=>a(["./layers/BuildingSceneLayerView3D"],e=>f(c(e)),g)),csv:()=>new Promise((f,g)=>a(["./layers/CSVLayerView3D"],e=>f(c(e)),g)),
dimension:()=>new Promise((f,g)=>a(["./layers/DimensionLayerView3D"],e=>f(c(e)),g)),elevation:m,feature:()=>new Promise((f,g)=>a(["./layers/FeatureLayerView3D"],e=>f(c(e)),g)),geojson:()=>new Promise((f,g)=>a(["./layers/GeoJSONLayerView3D"],e=>f(c(e)),g)),graphics:()=>new Promise((f,g)=>a(["./layers/GraphicsLayerView3D"],e=>f(c(e)),g)),group:()=>new Promise((f,g)=>a(["../layers/GroupLayerView"],e=>f(c(e)),g)),imagery:()=>new Promise((f,g)=>a(["./layers/ImageryLayerView3D"],e=>f(c(e)),g)),"integrated-mesh":()=>
new Promise((f,g)=>a(["./layers/IntegratedMeshLayerView3D"],e=>f(c(e)),g)),"line-of-sight":()=>new Promise((f,g)=>a(["./layers/LineOfSightLayerView3D"],e=>f(c(e)),g)),"map-image":()=>new Promise((f,g)=>a(["./layers/MapImageLayerView3D"],e=>f(c(e)),g)),media:()=>new Promise((f,g)=>a(["./layers/MediaLayerView3D"],e=>f(c(e)),g)),"ogc-feature":()=>new Promise((f,g)=>a(["./layers/OGCFeatureLayerView3D"],e=>f(c(e)),g)),"open-street-map":k,"oriented-imagery":()=>new Promise((f,g)=>a(["./layers/FeatureLayerView3D"],
e=>f(c(e)),g)),"point-cloud":()=>new Promise((f,g)=>a(["./layers/PointCloudLayerView3D"],e=>f(c(e)),g)),voxel:()=>new Promise((f,g)=>a(["./layers/VoxelLayerView3D"],e=>f(c(e)),g)),route:()=>new Promise((f,g)=>a(["./layers/RouteLayerView3D"],e=>f(c(e)),g)),scene:f=>null==f.profile||"mesh-pyramids"===f.profile?new Promise((g,e)=>a(["./layers/SceneLayerView3D"],n=>g(c(n)),e)):new Promise((g,e)=>a(["./layers/SceneLayerGraphicsView3D"],n=>g(c(n)),e)),stream:()=>new Promise((f,g)=>a(["./layers/StreamLayerView3D"],
e=>f(c(e)),g)),tile:k,"integrated-mesh-3dtiles":()=>new Promise((f,g)=>a(["./layers/IntegratedMesh3DTilesLayerView3D"],e=>f(c(e)),g)),"imagery-tile":()=>new Promise((f,g)=>a(["./layers/ImageryTileLayerView3D"],e=>f(c(e)),g)),"vector-tile":()=>new Promise((f,g)=>a(["./layers/VectorTileLayerView3D"],e=>f(c(e)),g)),wcs:()=>new Promise((f,g)=>a(["./layers/ImageryTileLayerView3D"],e=>f(c(e)),g)),"web-tile":k,wfs:()=>new Promise((f,g)=>a(["./layers/WFSLayerView3D"],e=>f(c(e)),g)),wms:()=>new Promise((f,
g)=>a(["./layers/WMSLayerView3D"],e=>f(c(e)),g)),wmts:()=>new Promise((f,g)=>a(["./layers/WMTSLayerView3D"],e=>f(c(e)),g)),catalog:null,"catalog-dynamic-group":null,"catalog-footprint":null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};b.layerView3DImporter={hasLayerViewModule:f=>null!=d[f.type],importLayerView:f=>{var g=d[f.type];if(null==g)throw f=f.declaredClass?f.declaredClass.slice(f.declaredClass.lastIndexOf(".")+
1):"Unknown",g=f.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new h(`${g}:view-not-supported`,`${f} is not supported in 3D`);return g(f)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(){const p=e.createResolver();p.promise.catch(()=>{});return p}const w=p=>Object.freeze(Object.defineProperty({__proto__:null,default:p},Symbol.toStringTag,{value:"Module"}));var q;(function(p){p[p.PENDING=0]="PENDING";p[p.CREATED=1]="CREATED"})(q||={});var v;(function(p){p[p.ADDED=0]="ADDED";p[p.REMOVED=1]="REMOVED"})(v||={});h=class extends h{constructor(p){super(p);this._allAnalysisViews=new k;this._creatingViewCount=0;this._items=new Map;this._scheduledUpdateHandle=
null;this._attachedToViewResolver=x();this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError("AnalysisViewManager was destroyed"))}attach(){this._connectOwners();this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError());this._attachedToViewResolver=
x()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(p=>p.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(p){await this._attachedToViewResolver.promise;const t=this._items.get(p);if(null==t||t.state.list===v.REMOVED)throw new m("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:p});return t.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")}_disconnectOwners(){this.removeHandles("analyses-owner-handles");this._update();this._creatingViewCount=0}_connectAnalysesCollection(p){for(const y of p)this._addAnalysis(y);const t=p.on("after-add",y=>this._addAnalysis(y.item)),r=p.on("after-remove",y=>this._removeAnalysis(y.item));return d.makeHandle(()=>{t.remove();r.remove();for(const y of p)this._removeAnalysis(y)})}_addAnalysis(p){const t=this._items.get(p);if(null==t){const r={state:{view:q.PENDING,list:v.ADDED},analysis:p,
view:null,createAnalysisViewTask:null};this._items.set(p,r);r.createAnalysisViewTask=c.createTask(y=>this._createAnalysisViewPromise(r,y))}else t.state.list=v.ADDED}_removeAnalysis(p){p=this._items.get(p);null==p?f.getLogger(this).error("Trying to remove analysis which was not added"):(p.state.list=v.REMOVED,this._scheduleUpdate())}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=n.schedule(()=>this._update()))}_update(){this._scheduledUpdateHandle=g.removeMaybe(this._scheduledUpdateHandle);
this._items.forEach(p=>{if(p.state.list===v.REMOVED)switch(this._items.delete(p.analysis),p.state.view){case q.PENDING:p.createAnalysisViewTask=g.abortMaybe(p.createAnalysisViewTask);break;case q.CREATED:null!=p.view&&(this._allAnalysisViews.remove(p.view),p.view=g.destroyMaybe(p.view),p.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(p,t){var r=p.analysis;const y=r.type,D=this._analysisModules[y];this._creatingViewCount+=1;if(null==D.module)try{D.module=await this._loadAnalysisModule(y)}catch(E){throw--this._creatingViewCount,
E;}if(e.isAborted(t))throw--this._creatingViewCount,e.createAbortError("AnalysisView creation aborted");r=new D.module.default({analysis:r,view:this.view});try{await r.when()}catch(E){throw--this._creatingViewCount,E;}if(e.isAborted(t))throw--this._creatingViewCount,r.destroy(),e.createAbortError("AnalysisView creation aborted");p.view=r;p.state.view=q.CREATED;this._allAnalysisViews.add(r);--this._creatingViewCount;return r}_loadAnalysisModule(p){switch(p){case "area-measurement":return new Promise((t,
r)=>a(["./AreaMeasurementAnalysisView3D"],y=>t(w(y)),r));case "dimension":return new Promise((t,r)=>a(["./DimensionAnalysisView3D"],y=>t(w(y)),r));case "direct-line-measurement":return new Promise((t,r)=>a(["./DirectLineMeasurementAnalysisView3D"],y=>t(w(y)),r));case "line-of-sight":return new Promise((t,r)=>a(["./LineOfSightAnalysisView3D"],y=>t(w(y)),r));case "slice":return new Promise((t,r)=>a(["./SliceAnalysisView3D"],y=>t(w(y)),r))}}};b.__decorate([l.property()],h.prototype,"updating",null);
b.__decorate([l.property({constructOnly:!0})],h.prototype,"view",void 0);b.__decorate([l.property()],h.prototype,"_allAnalysisViews",void 0);b.__decorate([l.property()],h.prototype,"_creatingViewCount",void 0);return h=b.__decorate([u.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],h)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.Constraints=class extends h.Clonable{constructor(){super(...arguments);this.tilt=new n.TiltConstraint;this.altitude=new g.AltitudeConstraint;this.clipDistance=new e.ClipDistanceConstraint}};b.__decorate([c.property({type:n.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);b.__decorate([c.property({type:g.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);b.__decorate([c.property({type:e.ClipDistanceConstraint})],a.Constraints.prototype,"clipDistance",
void 0);a.Constraints=b.__decorate([f.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),function(a,b,h,
c,k,m,d,f,g){a.AltitudeConstraint=class extends h.Clonable{constructor(){super(...arguments);this.min=g.earthAltitudeConstraint.min;this.max=g.earthAltitudeConstraint.max}};b.__decorate([c.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([c.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([f.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l){a.Constraints=class extends h{constructor(q){super(q);this.collision=
new w;this.distance=Infinity;this.minimumPoiDistance=4;this.tilt=null}get altitude(){return this.mode===n.ViewingMode.Local?null:this._get("altitude")||null}set altitude(q){this.mode===n.ViewingMode.Local?c.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",q)}clampAltitude(q){return this.altitude?k.clamp(q,this.altitude.min,this.altitude.max):q}clampTilt(q,v){if(!this.tilt)return v;q=this.tilt(q);return k.clamp(v,q.min,q.max)}clampDistance(q){return Math.min(q,
this.distance)}createDefaultTilt(){return this.mode===n.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(q){return(v,p=x)=>{p.min=u.min;p.max=q;return p}}_createDefaultTiltLocal(){const q=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,u.max],[1E4,k.deg2rad(88)],[6E6,k.deg2rad(88)]]):()=>u.max;return(v,p=x)=>{p.min=u.min;p.max=q(v);return p}}_createDefaultTiltGlobal(){const q=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,
u.max],[5E4,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,u.min]]):l.makePiecewiseLinearFunction([[3E5,u.max],[3E6,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,u.min]]);return(v,p=x)=>{p.min=u.min;p.max=q(v);return p}}};b.__decorate([m.property()],a.Constraints.prototype,"altitude",null);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([m.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",
void 0);b.__decorate([m.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([m.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([g.subclass("esri.views.3d.state.Constraints")],a.Constraints);d={min:-2E5,max:4*e.earth.radius};const u={min:k.deg2rad(.5),max:k.deg2rad(179.5)},x={min:0,max:0};let w=class extends h{constructor(){super(...arguments);this.enabled=!0;this.elevationMargin=5}};b.__decorate([m.property({type:Boolean})],w.prototype,"enabled",
void 0);b.__decorate([m.property({type:Number})],w.prototype,"elevationMargin",void 0);w=b.__decorate([g.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],w);a.TiltRange=u;a.earthAltitudeConstraint=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){a.ClipDistanceConstraint=class extends h.Clonable{constructor(){super(...arguments);this.mode="auto"}get near(){return this._get("near")}set near(g){this._set("near",g);g>=this._get("far")&&(this.far=g+1E-9);this.mode="manual"}castNear(g){return Math.max(1E-8,g)}get far(){return this._get("far")}set far(g){this._set("far",g);g<=this._get("near")&&(this.near=g-1E-9);this.mode="manual"}castFar(g){return Math.max(1E-8,g)}autoUpdate(g,e){"auto"===this.mode&&(this._get("near")!==
g&&this._set("near",g),this._get("far")!==e&&this._set("far",e))}};b.__decorate([c.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([k.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([c.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([k.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([c.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,
"mode",void 0);a.ClipDistanceConstraint=b.__decorate([f.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,h,c,k,m,d,f,g,e){var n=c.rad2deg(e.TiltRange.min),l=c.rad2deg(e.TiltRange.max);a.TiltConstraint=class extends h.Clonable{constructor(u){super(u);this.mode="auto"}get max(){return this._get("max")}set max(u){this._set("max",u);this.mode="manual"}castMax(u){return c.clamp(u,n,l)}autoUpdate(u){"auto"===this.mode&&this._get("max")!==u&&this._set("max",u)}};b.__decorate([k.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([k.property({type:Number,value:l})],
a.TiltConstraint.prototype,"max",null);b.__decorate([m.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([g.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/handleUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){var q;u=q=class extends u{constructor(v){super(v);this.atmosphere=new e.SceneViewAtmosphere;this.lighting=this.castLighting();this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(v){v=v.cloneConstructProperties();return new q({...v,lighting:v.lighting?"virtual"===v.lighting.type?l.fromWebsceneLighting(v.lighting):n.fromWebsceneLighting(v.lighting):void 0})}castLighting(v){return this._convertLightingWithDestroy(v)}applyLighting(v){this.lighting=
this._convertLightingWithDestroy(v)}_convertLightingWithDestroy(v){const p=this._convertLighting(v);p!==v&&this.addHandles(h.destroyHandle(p));return p}_convertLighting(v){return v?v instanceof n||v instanceof l?v:v instanceof x?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(v):new n({...v.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):v instanceof w?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(v):
new l({...v.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):f.ensureOneOfType(g.lightingTypes,v):new n}clone(){return new q({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background)})}cloneWithWebsceneEnvironment(v){return new q({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled,background:c.clone(this.background),...v.cloneConstructProperties(),lighting:this._getLighting(v)})}_getLighting(v){switch(v.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(v.lighting):n.fromWebsceneLighting(v.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(v.lighting):l.fromWebsceneLighting(v.lighting);default:return b.neverReached(v.lighting),
n.fromWebsceneLighting(v.lighting)}}};a.__decorate([k.property({type:e.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],u.prototype,"atmosphere",void 0);a.__decorate([k.property({nonNullable:!0})],u.prototype,"lighting",void 0);a.__decorate([m.cast("lighting")],u.prototype,"castLighting",null);return u=q=a.__decorate([d.subclass("esri.views.3d.environment.SceneViewEnvironment")],u)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,
b,h){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),function(a,
b,h,c,k,m,d,f,g){var e;h=e=class extends h.EventedMixin(g){constructor(l){super(l);this.cameraTrackingEnabled=!0;this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};l=(new Date).getFullYear();l=new Date("March 15, "+l+" 12:00:00 UTC");this._set("defaultDate",l);this._set("date",l)}get ambientOcclusionEnabled(){b.deprecatedProperty(c.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});
return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(l){b.deprecatedProperty(c.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",l)}get waterReflectionEnabled(){b.deprecatedProperty(c.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??
!1}set waterReflectionEnabled(l){b.deprecatedProperty(c.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",l)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(l){return new e(l.cloneConstructProperties())}set defaultDate(l){const u=this._get("date")===this._get("defaultDate");l=new Date(l.getTime());this._set("defaultDate",l);
u&&this._set("date",l)}set date(l){null!=l&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(l.getTime())))}autoUpdate(l,u){const x=e.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=u.hours;this.positionTimezoneInfo.minutes=u.minutes;this.positionTimezoneInfo.seconds=u.seconds;u=null;null!=l&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(l.getTime())?(u=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(u=this.date&&this.date.getTime(),
this._set("date",new Date(l.getTime()))));const w=e.calculateTimezoneOffset(this.positionTimezoneInfo);x!==w&&(n.target=this,n.timezoneOffset=w,this.emit("timezone-will-change",n),n.target=null);if(null!=l)return isNaN(l.getTime())||u!==l.getTime()}clone(){const l=this._get("date")===this._get("defaultDate"),u=new e({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});l&&u._set("date",u._get("defaultDate"));u.positionTimezoneInfo.autoUpdated=
this.positionTimezoneInfo.autoUpdated;u.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;u.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;u.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return u}cloneWithWebsceneLighting(l){const u=this.clone();null!=l.date&&(u.date=l.date);u.directShadowsEnabled=l.directShadowsEnabled;u.displayUTCOffset=l.displayUTCOffset;return u}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};
a.__decorate([k.property({type:Boolean})],h.prototype,"cameraTrackingEnabled",void 0);a.__decorate([k.property({type:Boolean})],h.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],h.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Date})],h.prototype,"defaultDate",null);a.__decorate([k.property({type:Date})],h.prototype,"date",null);h=e=a.__decorate([f.subclass("esri.views.3d.environment.SunLighting")],h);(function(l){l.calculateTimezoneOffset=
function({hours:u,minutes:x,seconds:w}){return Math.round(u+x/60+w/3600)}})(h||={});const n={target:null,timezoneOffset:0};return h})},"esri/webscene/SunLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,b,h,c,k,m,d,f,g){var e;b=e=class extends b.JSONSupport{constructor(n){super(n);
this.type="sun";this.date=null;this.directShadowsEnabled=!1;this.displayUTCOffset=null}readDate(n,l){return null!=l.datetime&&new Date(l.datetime)||null}writeDate(n,l,u){l[u]=n.getTime()}readDirectShadowsEnabled(n,l){return!!l.directShadows}writedirectShadowsEnabled(n,l,u){n&&(l[u]=n)}writeDisplayUTCOffset(n,l){null!=n&&(l.displayUTCOffset=n)}clone(){return new e(this.cloneConstructProperties())}cloneConstructProperties(){const n={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(n.date=new Date(this.date.getTime()));return n}};a.__decorate([h.property({readOnly:!0,type:["sun"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);a.__decorate([d.reader("date",["datetime"])],b.prototype,"readDate",null);a.__decorate([g.writer("date")],b.prototype,"writeDate",null);a.__decorate([h.property({type:Boolean,json:{default:!1,
write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);a.__decorate([d.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);a.__decorate([g.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);a.__decorate([h.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);a.__decorate([g.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",null);return b=e=a.__decorate([f.subclass("esri.webscene.SunLighting")],
b)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),function(a,b,h,c,k,m,d,f,g){var e;h=e=class extends h.EventedMixin(g){constructor(n){super(n);this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){b.deprecatedProperty(c.getLogger(this),
"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(n){b.deprecatedProperty(c.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",n)}get waterReflectionEnabled(){b.deprecatedProperty(c.getLogger(this),"waterReflectionEnabled",
{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(n){b.deprecatedProperty(c.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",n)}clone(){return new e({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(n){return new e(n.cloneConstructProperties())}cloneWithWebsceneLighting(n){const l=
this.clone();l.directShadowsEnabled=n.directShadowsEnabled;return l}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};a.__decorate([k.property({type:Boolean})],h.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],h.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Boolean})],h.prototype,"cameraTrackingEnabled",void 0);return h=e=a.__decorate([f.subclass("esri.views.3d.environment.VirtualLighting")],
h)})},"esri/webscene/VirtualLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d){var f;b=f=class extends b.JSONSupport{constructor(g){super(g);this.type="virtual";this.directShadowsEnabled=!1}clone(){return new f(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};
a.__decorate([h.property({readOnly:!0,type:["virtual"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([h.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],b.prototype,"directShadowsEnabled",void 0);return b=f=a.__decorate([d.subclass("esri.webscene.VirtualLighting")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){var g;a.SceneViewAtmosphere=g=class extends h{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new g({quality:this.quality})}};b.__decorate([c.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=g=b.__decorate([f.subclass("esri.views.3d.environment.SceneViewAtmosphere")],a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){var x;m=(w,q,v)=>({enabled:!v||!v.isPresentation});b=x=class extends b.JSONSupport{constructor(w){super(w);this.lighting=new n;this.background=null;this.starsEnabled=this.atmosphereEnabled=!0}set weather(w){g.validateWeatherType(w?.type,c.getLogger(this))&&this._set("weather",w)}clone(){return new x(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?l.prototype.clone.call(this.lighting):n.prototype.clone.call(this.lighting),
background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};a.__decorate([k.property({types:e.lightingTypes,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0);a.__decorate([k.property(u.backgroundProperty)],b.prototype,"background",void 0);a.__decorate([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"atmosphereEnabled",void 0);a.__decorate([k.property({type:Boolean,
nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"starsEnabled",void 0);a.__decorate([k.property({types:g.weatherTypes,nonNullable:!0,json:{write:!0},value:new f})],b.prototype,"weather",null);return b=x=a.__decorate([d.subclass("esri.webscene.Environment")],b)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){var g;b=g=class extends b.JSONSupport{constructor(e){super(e);this.type="sunny";this.cloudCover=.5}clone(){return new g({cloudCover:this.cloudCover})}};a.__decorate([d.enumeration({sunny:"sunny"})],b.prototype,"type",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=g=a.__decorate([f.subclass("esri.views.3d.environment.SunnyWeather")],b)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),
function(a,b,h,c,k,m){b={key:"type",base:m,typeMap:{sunny:m,cloudy:b,rainy:c,snowy:k,foggy:h}};const d=Object.keys(b.typeMap);a.cloudsHeight=1E5;a.validateWeatherType=function(f,g){return d.includes(f)?!0:(g.error(`"${f}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){var g;b=g=class extends b.JSONSupport{constructor(e){super(e);this.type="cloudy";this.cloudCover=.5}clone(){return new g({cloudCover:this.cloudCover})}};a.__decorate([d.enumeration({cloudy:"cloudy"})],b.prototype,"type",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=g=a.__decorate([f.subclass("esri.views.3d.environment.CloudyWeather")],b)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){var g;b=g=class extends b.JSONSupport{constructor(e){super(e);this.type="foggy";this.fogStrength=.5}clone(){return new g({fogStrength:this.fogStrength})}};a.__decorate([d.enumeration({foggy:"foggy"})],b.prototype,"type",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"fogStrength",void 0);return b=g=a.__decorate([f.subclass("esri.views.3d.environment.FoggyWeather")],b)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){var g;b=g=class extends b.JSONSupport{constructor(e){super(e);this.type="rainy";this.precipitation=this.cloudCover=.5}clone(){return new g({cloudCover:this.cloudCover,precipitation:this.precipitation})}};a.__decorate([d.enumeration({rainy:"rainy"})],b.prototype,"type",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],b.prototype,"precipitation",void 0);return b=g=a.__decorate([f.subclass("esri.views.3d.environment.RainyWeather")],b)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,
d,f){var g;b=g=class extends b.JSONSupport{constructor(e){super(e);this.type="snowy";this.precipitation=this.cloudCover=.5;this.snowCover="disabled"}clone(){return new g({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};a.__decorate([d.enumeration({snowy:"snowy"})],b.prototype,"type",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,
range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",void 0);a.__decorate([h.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b.prototype,"snowCover",void 0);return b=g=a.__decorate([f.subclass("esri.views.3d.environment.SnowyWeather")],b)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,h){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:h}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,h){b={base:b,key:"type",typeMap:{color:h}};b={types:b,json:{read:function(c){return(k,m,d)=>{if(!k)return k;for(const f in c.typeMap)if(k.type===f)return m=new c.typeMap[f],m.read(k,d),m}}(b),write:{overridePolicy:(c,k,m)=>({enabled:!m||!m.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){b=class extends b.JSONSupport{constructor(f){super(f)}clone(){}};a.__decorate([h.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=a.__decorate([d.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,h,c,k,m,d,f,g,e){var n;c={...g.colorAndTransparencyProperty,nonNullable:!0};e=n=class extends e{constructor(l){super(l);this.type="color";this.color=new b([0,0,0,1])}clone(){return new n(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};a.__decorate([d.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);a.__decorate([h.property(c)],e.prototype,"color",void 0);return e=n=a.__decorate([f.subclass("esri.webscene.background.ColorBackground")],
e)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/projectPointToWGS84ComparableLonLat ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){a.SceneViewEnvironmentManager=class extends h.EventedAccessor{constructor(){super();this._referencePointUpdateDelay=200;this._referencePointUpdateInterval=3E3;this._referencePointUpdateDistThreshold=1E6;this._referencePosMapCoordsRequested=this._referencePosUpdateQuery=null;this._viewHandlesKey="viewHandles";this._referencePosResetPreserveAbsoluteTime=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosMapCoords=this._referencePosUpdateTimer=
null;this._mainLight=new D.MainLight;this._ambientLight=new D.AmbientLight;this._moonLight=new D.FillLight;this._disableWeather=this.disableQueries=!1;this._referencePosWGS84Comparable=this._renderer=null;this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&
!this._disableWeather&&this._view?.state?.viewingMode===v.ViewingMode.Global&&q.isEarth(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(L){if(!this._renderer){this._renderer=new p.EnvironmentRenderer({view:L});var C=()=>this._updateRenderParameters(),z=()=>this._cameraHandler();this.addHandles([m.watch(()=>L.environment.lighting,J=>this._updateLightingHandler(J),
m.sync),m.watch(()=>"virtual"!==L.environment.lighting.type?L.environment.lighting.date:null,J=>this._lightingDateHandler(J),m.sync),m.watch(()=>L.stationary,()=>this._interactingStationaryHandler()),m.watch(()=>L.environment.lighting.directShadowsEnabled,C,m.sync),m.watch(()=>L.qualitySettings.ambientOcclusion,C,m.sync),m.watch(()=>L.qualitySettings.reflections,C,m.sync),m.watch(()=>L.spatialReference,()=>this._resetReferencePosition(!0),m.sync),m.watch(()=>L.environment.weather.type,()=>this._updateLighting(null,
y.Update.Faded),m.sync),m.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,y.Update.Faded),m.sync),m.watch(()=>L.viewingMode,()=>this._resetReferencePosition(!0),m.syncAndInitial),m.watch(()=>"virtual"!==L.environment.lighting.type?L.environment.lighting.cameraTrackingEnabled:!1,J=>this._updateCameraTracking(J),m.syncAndInitial),m.watch(()=>L.state.camera,z,m.syncAndInitial),m.watch(()=>this.disableQueries,z)],this._viewHandlesKey);this._updateRenderParameters();this._updateLighting();
this._cameraHandler();this.notifyChange("updating")}}disconnectView(){this.removeHandles(this._viewHandlesKey);this._resetReferencePosition();this._renderer=c.destroyMaybe(this._renderer)}_updateLightingHandler(L){this._updateCameraTracking("virtual"!==L.type?L.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==L.type?L.date:null);this._updateRenderParameters()}_updateCameraTracking(L){(this._trackingEnabled=L)?this._cameraHandler():(L=this._view.environment.lighting,"virtual"!==L?.type&&
(L.positionTimezoneInfo.autoUpdated=!1))}_lightingDateHandler(L){const C=this._view.environment.lighting;if("virtual"===C?.type)this._updateLighting();else if(L){if(!C.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!x.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var z=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(z)){this._requestReferencePositionUpdate(z);return}}this._preupdateTracking(L);null!=this._referencePosWGS84Comparable&&
(z=t.positionToTimezoneInfo(this._referencePosWGS84Comparable,F),null!=z&&(C.autoUpdate(null,z),this._trackingEnabled&&(C.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(L)}}_preupdateTracking(L){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(L)}_cameraHandler(L=null){var C=this._view;C.ready&&(C=C.stateManager.camera)&&(this._cameraHandlerClientSide(C,L)||this._cameraHandlerServerSide(C))}_cameraHandlerClientSide(L,
C){const z=q.isEarth(this._view.spatialReference);if(z&&!x.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;L=L.position;null==this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable=u.create());z?w.projectPointToWGS84ComparableLonLat(L,this._referencePosWGS84Comparable):l.set(this._referencePosWGS84Comparable,L.longitude??0,L.latitude??0,L.z??0);this.notifyChange("referencePositionWGS84Comparable");
this._autoUpdateTimezone(this._referencePosWGS84Comparable,C)||this._updateLighting(C);return!0}_cameraHandlerServerSide(L){L=L.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(L))&&this._requestReferencePositionUpdate(L,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(L.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&
this._executePendingReferencePositionUpdate()}_updateLighting(L,C=y.Update.Immediate){var z=this._view;L=L||("virtual"===z.environment.lighting.type?null:z.environment.lighting.date);var J=this._referencePosWGS84Comparable;const K=J?E:A;var I=this.weatherVisible?z.environment.weather.type:"disabled";null!=J?r.computeColorAndIntensity(L,J,z.state.viewingMode,I,z.state.camera,K):"virtual"===z.environment.lighting.type&&r.computeVirtualLightDirection(z.state.camera,z.state.viewingMode,K.direct.directionToLightSource);
L=this._mainLight;z=K.direct;l.scale(L.intensity,z.color,z.intensity*Math.PI);l.copy(L.direction,z.directionToLightSource);L.specularStrength=K.specularStrength;L.environmentStrength=K.environmentStrength;J=this._ambientLight;l.scale(J.intensity,K.ambient.color,K.ambient.intensity);I=this._moonLight;l.lerp(I.intensity,G,H,K.globalFactor);l.scale(I.intensity,I.intensity,(1-.5*K.globalFactor)*(1-.4*K.noonFactor*(1-K.globalFactor)));l.copy(I.direction,z.directionToLightSource);this._renderer.updateLightSources([L,
J,I],K.noonFactor,K.globalFactor,C);this._updateRenderParameters()}_autoUpdateTimezone(L,C=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==L)return!1;const z=B;z.setTime((C||this._view.environment.lighting.date).getTime());L=t.positionToTimezoneInfo(L,F);if(null==L)return!1;var J=this._view.environment.lighting.positionTimezoneInfo;if(!J.autoUpdated)J=L;else if(J.hours===L.hours&&J.minutes===L.minutes&&J.seconds===L.seconds)return!1;
const K=z.getUTCHours()-(L.hours-J.hours),I=z.getUTCMinutes()-(L.minutes-J.minutes);J=z.getUTCSeconds()-(L.seconds-J.seconds);z.setUTCHours(K);z.setUTCMinutes(I);z.setUTCSeconds(J);return C?!1:this._view.environment.lighting.autoUpdate(z,L)}_updateRenderParameters(){const L=this._view._stage;if(L){var C=null!=this._referencePosWGS84Comparable?r.computeShadowsEnabled(this._referencePosWGS84Comparable[2],this._view.state.viewingMode):!0;L.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
C,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}}_resetReferencePosition(L=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");L&&this._cameraHandler()}_requestReferencePositionUpdate(L,C=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?
this._referencePosMapCoordsRequested.copy(L):this._referencePosMapCoordsRequested=L.clone(),this._referencePosResetPreserveAbsoluteTime=!!C,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const z=this._referencePosUpdateQuery=k.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===z)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==z)}).catch(K=>{"mapcoordshelper:missing-geometry-service"===K.name&&
(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===z&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),J=this._referencePosUpdateTimer=k.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===J&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(L){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const C=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);L()||isNaN(C[0])||isNaN(C[1])||(L=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=C[0],this._referencePosWGS84Comparable[1]=C[1],this._referencePosWGS84Comparable[2]=L):this._referencePosWGS84Comparable=[C[0],C[1],L],this._referencePosChanged())}_executePendingReferencePositionUpdate(){const L=this._referencePosMapCoordsRequested;L&&this._requestReferencePositionUpdate(L,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(L){return this._referencePosMapCoords?(L=this._referencePosMapCoords.distance(L),this._view.mapCoordsHelper&&(L*=this._view.mapCoordsHelper.unitInMeters),L>this._referencePointUpdateDistThreshold):!0}_cancelReferencePosUpdates(){const L=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return L}get test(){const L=this;return{get renderer(){return L._renderer},
set referencePointUpdateInterval(C){L._referencePointUpdateInterval=C},set referencePointUpdateDistThreshold(C){L._referencePointUpdateDistThreshold=C},set referencePosUpdateTimer(C){L._referencePosUpdateTimer=C},set referencePointUpdateDelay(C){L._referencePointUpdateDelay=C},set disableWeather(C){L._disableWeather=C}}}};b.__decorate([d.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,
"disableQueries",void 0);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);b.__decorate([d.property()],
a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=b.__decorate([n.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const E=new r.ColorAndIntensity,A=new r.ColorAndIntensity,B=new Date,F={hours:0,minutes:0,seconds:0},G=u.fromValues(.22,.22,.33),H=u.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToWGS84ComparableLonLat":function(){define(["exports",
"../../core/libs/gl-matrix-2/factories/vec3f64","./projectVectorToWGS84ComparableLonLat"],function(a,b,h){const c=b.create();a.projectPointToWGS84ComparableLonLat=function(k,m){c[0]=k.x;c[1]=k.y;const d=k.z;c[2]=void 0!==d?d:0;return h.projectVectorToWGS84ComparableLonLat(c,k.spatialReference,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToWGS84ComparableLonLat":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64",
"./projectors"],function(a,b,h){const c=b.create();a.projectVectorToWGS84ComparableLonLat=function(k,m,d){if(null==m)return!1;m=h.getWGS84ComparableLonLatProjector(m);if(null==m)return!1;m(k,0,c,0);d!==c&&(d[0]=c[0],d[1]=c[1],2<d.length&&(d[2]=c[2]));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsParameters ./CloudsPresets ./Fog ./LocalAtmosphere ./MarsAtmosphere ./Precipitation ./Stars ./weather ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){var J;a.EnvironmentRenderer=J=class extends L.SyncRenderPlugin{constructor(N){super(N);this.produces=new Map([[C.RenderSlot.ENVIRONMENT_OPAQUE,()=>!(null===this._atmosphere&&null===this._stars)],[C.RenderSlot.ENVIRONMENT_TRANSPARENT,()=>null!==this._atmosphere]]);this._atmosphere=this._context=null;this._oldWeatherParameters=new K;this._newWeatherParameters=new K;this._fadedWeatherParameters=new K;this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles();
this.uninitializeRenderContext();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:q.AtmosphereType.None}consumes(){return this._atmosphereType===q.AtmosphereType.Realistic?L.ConsumesDepth:L.ConsumesNone}updateAnimation(N){return null!=this._precipitation?this._precipitation.update(N):!1}get updating(){return null!=this._stars&&this._stars.updating||
null!=this._clouds&&this._clouds.running}get weatherVisible(){return n.length(this.view.state.camera.eye)-u.getReferenceEllipsoid(this.view.spatialReference).radius<=H.weatherHeightLimit}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const N=this.view,V=N.environment?.starsEnabled??!1,Q=this._get("_stars");return V&&null!=this._context?null!=Q?Q:new G.Stars({view:N,requestRender:()=>this._setNeedsRender()}):(k.destroyMaybe(Q),null)}get _precipitation(){const N=this._get("_precipitation");
if(!this._precipitationEnabled||null==this._context)return k.destroyMaybe(N),null;const V=this.view,Q=this._context;if(null!=N&&N.context===Q)return N;k.destroyMaybe(N);return new F.Precipitation({context:Q,view:V})}get _clouds(){const N=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(N),null;if(null!=N)return N;const V=this.view,Q=this._context;k.destroyMaybe(N);return new r.CloudsGenerator({context:Q,view:V,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const N=
this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(N),null;const V=this.view.state.viewingMode,Q=this._context.renderContext.rctx,T=u.getReferenceEllipsoid(this.view.spatialReference).radius;if(null!=N&&N.viewingMode===V&&N.planetRadius===T)return N;k.destroyMaybe(N);return new p.CloudsComposition({rctx:Q,viewingMode:V,planetRadius:T,requestRender:()=>this._setNeedsRender()})}get _fog(){const N=this._get("_fog");return this.weatherEnabled&&null!=this._context?
null!=N?N:new E.Fog({context:this._context,view:this.view,rctx:this._context.renderContext.rctx,viewingMode:this.view.state.viewingMode}):(k.destroyMaybe(N),null)}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(N=null){this._context=N;N=()=>this._setNeedsRender();this.addHandles([m.watch(()=>({viewingMode:this.view.state.viewingMode,
enabled:this.view.environment.atmosphereEnabled}),V=>this._updateAtmosphere(V),m.syncAndInitial),m.watch(()=>this._stars,N),m.watch(()=>this._precipitation,N),m.watch(()=>this._clouds,()=>this._updateWeather(),m.initial),m.watch(()=>this._fog,()=>this._updateFogHaze(),m.initial),m.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},m.sync),m.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=
null;this._atmosphere=k.destroyMaybe(this._atmosphere);this._set("_stars",k.destroyMaybe(this._stars));this._set("_precipitation",k.destroyMaybe(this._precipitation));this._set("_clouds",k.destroyMaybe(this._clouds));this._set("_cloudsComposition",k.destroyMaybe(this._cloudsComposition));this._set("_fog",k.destroyMaybe(this._fog))}prepareRender(N){N.bindParameters.cloudsFade.data=t.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&null!=N.bindParameters.cloudsFade.data?.cubeMap&&
(this._updateWeatherFading(N.bindParameters,N.time),N.bindParameters.cloudsFade.renderingStage===t.CloudsRenderingStages.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),N.bindParameters.cloudsFade.data=null))}renderNode(N){switch(N.bindParameters.slot){case C.RenderSlot.ENVIRONMENT_OPAQUE:null!=this._stars&&this._stars.render(N);null!=this.atmosphere&&(this.atmosphere.render(N,this.view?._stage?.renderer?.fullResolutionAtmosphere),
null!=this._cloudsComposition&&null!=N.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(N)),N.bindParameters.cloudsFade.isFading&&null!=this._context&&null!=N.bindParameters.cloudsFade.data?.cubeMap&&this._context.requestRender());break;case C.RenderSlot.ENVIRONMENT_TRANSPARENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(N,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),
0<this._weatherParameters.fog.amount&&null!=this._fog&&this._fog.render(N,this._weatherParameters.fog),this._precipitation)){const V=this.view.environment.weather;"rainy"!==V.type&&"snowy"!==V.type||this._precipitation.render(N,V.precipitation,V.type)}}}updateLightSources(N,V,Q,T){if(null!=this._context){const ia=this._context.renderContext;ia.bindParameters.oldLighting.copyFrom(ia.bindParameters.lighting);ia.bindParameters.newLighting.noonFactor=V;ia.bindParameters.newLighting.globalFactor=Q;ia.bindParameters.newLighting.set(N);
T===z.Update.Faded||ia.bindParameters.weatherFading?ia.bindParameters.fadeLighting(0):ia.bindParameters.fadeLighting(1);this._context.requestRender()}}get _weatherUpdateParameters(){const N=this.weatherEnabled?this.view.environment.weather:null;return null==N?null:"rainy"===N.type||"snowy"===N.type?{type:N.type,weatherAdjustment:N.cloudCover,effect:N.precipitation}:{type:N.type,weatherAdjustment:"foggy"===N.type?N.fogStrength:N.cloudCover}}_updateWeatherFading(N,V){N.cloudsFade.updateFading(N.camera,
this.view.state.mode,V,this.view.qualitySettings.fadeDuration);N.cloudsFade.updateParallax(N.camera);N.weatherFading&&(this._updateLighting(N),this._updateFogAtmoshpere(N))}_updateLighting(N){N.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||N.cloudsFade.fadeMode===y.FadeMode.FADE_IN?N.fadeLighting(N.cloudsFade.fadeFactor):N.fadeLighting(0)}_updateFogAtmoshpere(N){N.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||N.cloudsFade.fadeMode===y.FadeMode.FADE_IN?this._fadeWeather(N.cloudsFade.fadeFactor):this._fadeWeather(0)}_fadeWeather(N){const {_newWeatherParameters:V,
_oldWeatherParameters:Q}=this;1<=N?this._weatherParameters=V:(this._fadedWeatherParameters.lerp(Q,V,N),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const N=this._weatherUpdateParameters;null!=N&&null!=this._clouds&&(this._clouds.applyPreset(D.cloudPresets[N.type],N.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const N=this._weatherUpdateParameters;if(null!=this._fog&&null!=N&&null!=this._context){var V=
this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(N.type){case "foggy":this._newWeatherParameters.fog.strength=c.lerp(3E-5,.005,N.weatherAdjustment**3);n.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=c.lerp(4E-6,2E-4,(N.effect??0)**3);n.copy(this._newWeatherParameters.fog.color,
I);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=c.lerp(4E-6,2E-4,(N.effect??0)**3);n.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}V.weatherFading?
this._fadeWeather(0):this._fadeWeather(1)}}_updateAtmosphere(N){N=this._selectAtmosphereType(N);if(N===q.AtmosphereType.None||!this._context)this._atmosphere=k.destroyMaybe(this._atmosphere);else if(!this._atmosphere||this._atmosphere.type!==N)if(this._atmosphere=k.destroyMaybe(this._atmosphere),N=this._getAtmosphereClass(N))this._atmosphere=new N(this.view,this._context);this._setNeedsRender()}_getAtmosphereClass(N){switch(N){case q.AtmosphereType.Realistic:return v.ChapmanAtmosphere;case q.AtmosphereType.Local:return A.LocalAtmosphere;
case q.AtmosphereType.Mars:return B;default:case q.AtmosphereType.None:return null}}_selectAtmosphereType(N){const {enabled:V,viewingMode:Q}=N;return!V||x.isMoon(this.view.spatialReference)?q.AtmosphereType.None:Q===w.ViewingMode.Local?q.AtmosphereType.Local:null!=this._context&&v.ChapmanAtmosphere.isSupported(this._context)&&x.isEarth(this.view.spatialReference)?q.AtmosphereType.Realistic:x.isMars(this.view.spatialReference)?q.AtmosphereType.Mars:q.AtmosphereType.None}get test(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:N=>{S=J.prototype._getAtmosphereClass;J.prototype._getAtmosphereClass=N},restoreGetAtmosphereClass:()=>{J.prototype._getAtmosphereClass=S}}}};b.__decorate([d.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"atmosphere",
null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);b.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_context",void 0);b.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);b.__decorate([d.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_stars",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",
null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);b.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=J=b.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);class K{constructor(){this.fog=new E.FogParameters;this.hazeAmount=1}copyFrom(N){this.fog.amount=N.fog.amount;this.hazeAmount=N.hazeAmount;this.fog.strength=N.fog.strength;
n.copy(this.fog.color,N.fog.color)}lerp(N,V,Q){this.fog.amount=c.lerp(N.fog.amount,V.fog.amount,Q);this.hazeAmount=c.lerp(N.hazeAmount,V.hazeAmount,Q);this.fog.strength=c.lerp(N.fog.strength,V.fog.strength,Q);n.lerp(this.fog.color,N.fog.color,V.fog.color,Q)}}const I=l.fromValues(.5,.5,.5),M=l.fromValues(1.5,1.5,1.5);let S;a.WeatherParameters=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=
void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Realistic=0]="Realistic";b[b.Local=1]="Local";b[b.Mars=2]="Mars";b[b.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/colorUtils ../../../core/Handles ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl/ManagedFBO ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/textureUtils ../../../chunks/AtmosphereCompositing.glsl ../webgl-engine/shaders/AtmosphereCompositingTechnique ../../webgl/enums ../../../webscene/background/ColorBackground".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){class E{constructor(A,B){this._view=A;this._context=B;this.type=n.AtmosphereType.Realistic;this._handles=new h;this._compositingPassParameters=new t.AtmosphereCompositingPassParameters;this._atmosphereConfiguration=new x.ChapmanAtmosphereTechniqueConfiguration;this._passParameters=new u.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=e.earth.radius;this._fadeHaze=0;this._updateRadius(e.earth.radius);A=
this._context.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([k.watch(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),k.watch(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),k.watch(()=>this._view?.environment.background,F=>{F=F instanceof D?b.unitRGBAFromColor(F.color):g.ZEROS;d.set(this._passParameters.backgroundColor,
F[0]*F[3],F[1]*F[3],F[2]*F[3])},k.syncAndInitial)]);B=new x.ChapmanAtmosphereTechniqueConfiguration;B.haze=!1;this._atmosphereTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,B);B.haze=!0;this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,B);B.reduced=!0;B.haze=!1;this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,B);B.haze=!0;this._atmosphereHazeReducedTechnique=
this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,B);this._vao=v.createQuadVAO(A,q.Pos2Tex)}destroy(){this._handles.destroy();this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();this._atmosphereReducedTechnique.release();this._atmosphereHazeReducedTechnique.release();this._vao.dispose()}render(A,B){this._render(A,B?this._atmosphereTechnique:this._atmosphereReducedTechnique,A.offscreenRenderingHelper.depthTexture,B,!1)}renderHaze(A,B,F){this._fadeHaze=B;
this._render(A,F?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,A.bindParameters.linearDepth?.getTexture(),F,!0)}_render(A,B,F,G,H){if(null!=F){var L=A.offscreenRenderingHelper;this._update(A.bindParameters.camera);this._passParameters.depthTexture=F;var C=A.rctx.bindTechnique(B,A.bindParameters,this._passParameters);if(G)L.renderDepthDetached(()=>this._renderCommon(C,A));else{B=A.rctx.getViewport();G=d.length(A.bindParameters.camera.eye)-e.earth.radius;if(G<l.atmosphereHeight){G=
Math.min(1,Math.max(0,G/l.atmosphereHeight));var z=H?c.lerp(.4,.5,G):c.lerp(.2,.3,G)}else G=Math.min(1,Math.max(0,(G-l.atmosphereHeight)/(15*l.atmosphereHeight))),z=H?c.lerp(.5,1,G):c.lerp(.3,.6,G);G=p.applyTextureResizeModulo(Math.round(z*A.bindParameters.camera.fullViewport[2]));z=p.applyTextureResizeModulo(Math.round(z*A.bindParameters.camera.fullViewport[3]));A.rctx.setViewport(0,0,G,z);G=L.renderToCachedFBO(null,"chapman",()=>this._renderCommon(C,A),[0,0,0,1],w.ColorFormat.RGBA,null,G,z);A.rctx.setViewport(B.x,
B.y,B.width,B.height);this._compositingPassParameters.color=G.getTexture();this._compositingPassParameters.depth=F;this._atmosphereConfiguration.haze=H;F=this._context.techniqueRepository.acquire(r.AtmosphereCompositingTechnique,this._atmosphereConfiguration);A.rctx.bindTechnique(F,A.bindParameters,this._compositingPassParameters);L.renderDepthDetached(()=>A.rctx.screen.draw());F.release();G.release()}}}_renderCommon(A,B){null!=this._vao&&(B.rctx.bindVAO(this._vao),A.assertCompatibleVertexAttributeLocations(this._vao),
B.rctx.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(A){return A*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const A=this._view.basemapTerrain.rootTileElevationBounds.min;A!==this._rootTileElevationMin&&(this._rootTileElevationMin=A,this._lowerBoundEarthRadius=e.earth.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const A=this._adjustRadiusForTesselation(e.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);A<
this._lowerBoundEarthRadius&&this._updateRadius(A)}_updateRadius(A){this._lowerBoundEarthRadius=A;m.set(this._passParameters.radii,A,A+l.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*A-l.innerAtmosphereDepth)*l.innerAtmosphereDepth)}_update(A){if(A){A=d.squaredLength(A.eye);var B=Math.sqrt(A),F=A-this._passParameters.radii[1]*this._passParameters.radii[1],G=c.clamp((B-this._passParameters.radii[0])/l.atmosphereHeight,0,1);f.set(this._passParameters.heightParameters,B,A,F,
G);this._passParameters.altitudeFade=l.computeInnerAltitudeFade(B-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=c.lerp(c.lerp(.6,1,c.smoothstep(9500,10500,B-e.earth.radius)),1,this._fadeHaze)}}static isSupported(A){return A.renderContext.rctx.capabilities.depthTexture}}a.ChapmanAtmosphere=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(a,b){a.atmosphereHeight=
1E5;a.computeInnerAltitudeFade=function(h){return b.clamp((h-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x extends d.NoParameters{constructor(){super(...arguments);this.heightParameters=k.create();this.radii=h.create();this.altitudeFade=this.innerFadeDistance=0;this.hazeStrength=1;this.renderScale=h.create();this.backgroundColor=c.create()}}class w extends g.ShaderTechnique{initializeProgram(q){return new n.Program(q.rctx,w.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return this.configuration.reduced?u.makePipelineState({blending:u.simpleBlendingParams(l.BlendFactor.ONE,
l.BlendFactor.ZERO),depthTest:{func:l.CompareFunction.ALWAYS},colorWrite:u.defaultColorWriteParams}):this.configuration.haze?u.makePipelineState({blending:u.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ZERO,l.BlendFactor.ONE_MINUS_SRC_COLOR,l.BlendFactor.ONE),colorWrite:u.defaultColorWriteParams}):u.makePipelineState({blending:u.simpleBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:u.defaultColorWriteParams})}}
w.shader=new f.ReloadableShaderModule(m.ChapmanAtmosphere,()=>new Promise((q,v)=>a(["./ChapmanAtmosphere.glsl"],q,v)));b.ChapmanAtmospherePassParameters=x;b.ChapmanAtmosphereTechnique=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){function t(A){const B=new q.ShaderBuilder;B.attributes.add(p.VertexAttribute.POSITION,"vec2");B.include(m.TextureCoordinateAttribute,{textureCoordinateType:m.TextureCoordinateAttributeType.Default});B.varyings.add("worldRay","vec3");B.varyings.add("eyeDir","vec3");const {vertex:F,fragment:G}=B;F.uniforms.add(new w.Matrix4PassUniform("inverseProjectionMatrix",(H,L)=>L.camera.inverseProjectionMatrix),new w.Matrix4PassUniform("inverseViewMatrix",(H,L)=>b.invertOrIdentity(E,
L.camera.viewMatrix)));F.code.add(x.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);G.uniforms.add(new n.Float3PassUniform("backgroundColor",H=>H.backgroundColor),new e.Float2PassUniform("radii",H=>H.radii),new n.Float3PassUniform("cameraPosition",(H,L)=>L.camera.eye),new l.Float4PassUniform("heightParameters",H=>H.heightParameters),new u.FloatPassUniform("innerFadeDistance",H=>H.innerFadeDistance),new u.FloatPassUniform("altitudeFade",H=>H.altitudeFade),new v.Texture2DPassUniform("depthTexture",H=>H.depthTexture),new u.FloatPassUniform("hazeStrength",H=>H.hazeStrength));G.constants.add("betaRayleigh",
"vec3",r);G.constants.add("betaCombined","vec3",D);G.constants.add("betaMie","float",3.996E-6);G.constants.add("scaleHeight","float",k.rayLeighScaleHeight*k.atmosphereHeight);g.addMainLightDirection(G);B.include(f.Gamma);A.haze&&(G.include(d.ReadLinearDepth),G.uniforms.add(new e.Float2PassUniform("nearFar",(H,L)=>L.camera.nearFar)));G.code.add(x.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);G.code.add(x.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);G.code.add(x.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);G.code.add(x.glsl`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${A.haze?x.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${A.haze?"":x.glsl`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${A.haze?"":x.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${A.haze?x.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${A.haze?"":x.glsl`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${A.haze&&A.reduced?x.glsl`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${A.haze?x.glsl`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${A.reduced?x.glsl`cameraSpaceRay *= -textureBilinear(vuv0);`:x.glsl`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:x.glsl`${A.reduced?"":x.glsl`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${A.haze?x.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:x.glsl`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${A.haze?"":x.glsl`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `);return B}const r=c.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),y=c.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),D=c.fromValues(parseFloat(Number(r[0]+y[0]).toFixed(6)),parseFloat(Number(r[1]+y[1]).toFixed(6)),parseFloat(Number(r[2]+y[2]).toFixed(6))),E=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:r,
build:t},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=h;a.betaRayleigh=r;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,h,c){a.TextureCoordinateAttributeType=void 0;(function(k){k[k.None=0]="None";k[k.Default=1]="Default";k[k.Atlas=2]="Atlas";k[k.Compressed=3]="Compressed";k[k.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(k,m){switch(m.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:k.attributes.add(c.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(h.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:k.attributes.add(c.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(h.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:k.attributes.add(c.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.attributes.add(c.VertexAttribute.UVREGION,"vec4");k.varyings.add("vuvRegion","vec4");k.vertex.code.add(h.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(m.textureCoordinateType);case a.TextureCoordinateAttributeType.None:k.vertex.code.add(h.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(k,...m){let d="";for(let f=0;f<m.length;f++)d+=k[f]+m[f];return d+=k[k.length-1]}class h{}const c=h;(function(k){k.int=
function(m){return Math.round(m).toString()};k.float=function(m){return m.toPrecision(8)}})(b||={});a.NoParameters=c;a.glsl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;(function(b){b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0="uv0";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";
b.PERSPECTIVEDIVIDE="perspectiveDivide";b.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance";b.LENGTH="length";b.PREVPOSITION="prevPosition";b.NEXTPOSITION="nextPosition";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP=
"profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.INSTANCEMODELORIGINHI="instanceModelOriginHi";b.INSTANCEMODELORIGINLO="instanceModelOriginLo";b.INSTANCEMODEL="instanceModel";b.INSTANCEMODELNORMAL="instanceModelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS=
"modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMAL2COMPRESSED="normal2Compressed";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(a.VertexAttribute||
(a.VertexAttribute={}));a.affectsGeometry=function(b){return b===a.VertexAttribute.POSITION};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,h){a.ReadDepth=function(c){c.code.add(h.glsl`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromDepthTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)};a.ReadLinearDepth=function(c){c.include(b.RgbaFloatEncoding);c.code.add(h.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(h){h.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(h){h.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,h){function c(m){m.uniforms.add(new b.Float3PassUniform("mainLightDirection",(d,f)=>f.lighting.mainLight.direction))}function k(m){m.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(d,f)=>f.lighting.mainLight.intensity))}a.MainLighting=
function(m){c(m.fragment);k(m.fragment);m.fragment.code.add(h.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=c;a.addMainLightIntensity=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec3",h.BindType.Pass,(d,f,g)=>d.setUniform3fv(k,m(f,g)))}}a.Float3PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports",
"../shaderTechnique/BindType"],function(a,b){class h{constructor(c,k,m,d,f=null){this.name=c;this.type=k;this.arraySize=f;this.bind={[b.BindType.Pass]:null,[b.BindType.Draw]:null};if(d)switch(m){case b.BindType.Pass:this.bind[b.BindType.Pass]=d;break;case b.BindType.Draw:this.bind[b.BindType.Draw]=d}}equals(c){return this.type===c.type&&this.name===c.name&&this.arraySize===c.arraySize}}a.Uniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec2",h.BindType.Pass,(d,f,g)=>d.setUniform2fv(k,m(f,g)))}}a.Float2PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec4",h.BindType.Pass,(d,f,g)=>d.setUniform4fv(k,m(f,g)))}}a.Float4PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,
h){class c extends b.Uniform{constructor(k,m){super(k,"float",h.BindType.Pass,(d,f,g)=>d.setUniform1f(k,m(f,g)))}}a.FloatPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"mat4",h.BindType.Pass,(d,f,g)=>d.setUniformMatrix4fv(k,m(f,g)))}}a.Matrix4PassUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../shaderTechnique/BindType","../../lib/Util"],function(a,b,h,c,k){const m=()=>h.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class d{constructor(){this._includedModules=new Map}include(v,p){if(this._includedModules.has(v)){const t=this._includedModules.get(v);if(t!==p){m().error("Shader module included multiple times with different configuration.");
p=new Set;for(const r of Object.keys(t))t[r]!==v[r]&&p.add(r);for(const r of Object.keys(v))t[r]!==v[r]&&p.add(r);p.forEach(r=>console.error(`  ${r}: current ${t[r]} new ${v[r]}`))}}else this._includedModules.set(v,p),v(this.builder,p)}}class f extends d{constructor(){super(...arguments);this.vertex=new n;this.fragment=new n;this.attributes=new l;this.varyings=new u;this.extensions=new x;this.constants=new q;this.outputs=new w}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(v){const p=
this.extensions.generateSource(v),t=this.attributes.generateSource(v),r=this.varyings.generateSource(v);var y="vertex"===v?this.vertex:this.fragment;const D=y.uniforms.generateSource(),E=y.code.generateSource(),A="vertex"===v?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";y=this.constants.generateSource().concat(y.constants.generateSource());
v=this.outputs.generateSource(v);return`#version 300 es\n${p.join("\n")}\n\n${A}\n\n${y.join("\n")}\n\n${D.join("\n")}\n\n${t.join("\n")}\n\n${r.join("\n")}\n\n${v.join("\n")}\n\n${E.join("\n")}`}generateBindPass(v){const p=new Map;this.vertex.uniforms.entries.forEach(y=>{const D=y.bind[c.BindType.Pass];D&&p.set(y.name,D)});this.fragment.uniforms.entries.forEach(y=>{const D=y.bind[c.BindType.Pass];D&&p.set(y.name,D)});const t=Array.from(p.values()),r=t.length;return(y,D)=>{for(let E=0;E<r;++E)t[E](v,
y,D)}}generateBindDraw(v){const p=new Map;this.vertex.uniforms.entries.forEach(y=>{const D=y.bind[c.BindType.Draw];D&&p.set(y.name,D)});this.fragment.uniforms.entries.forEach(y=>{const D=y.bind[c.BindType.Draw];D&&p.set(y.name,D)});const t=Array.from(p.values()),r=t.length;return(y,D,E)=>{for(let A=0;A<r;++A)t[A](v,y,D,E)}}}class g{constructor(){this._entries=new Map}add(...v){for(const p of v)this._add(p)}get(v){return this._entries.get(v)}_add(v){if(null==v)m().error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(v.name)&&!this._entries.get(v.name).equals(v))throw new b(`Duplicate uniform name ${v.name} for different uniform type`);this._entries.set(v.name,v)}}generateSource(){return Array.from(this._entries.values()).map(v=>null!=v.arraySize?`uniform ${v.type} ${v.name}[${v.arraySize}];`:`uniform ${v.type} ${v.name};`)}get entries(){return Array.from(this._entries.values())}}class e{constructor(){this._entries=[]}add(v){this._entries.push(v)}generateSource(){return this._entries}}
class n extends d{constructor(){super(...arguments);this.uniforms=new g;this.code=new e;this.constants=new q}get builder(){return this}}class l{constructor(){this._entries=[]}add(v,p){this._entries.push([v,p])}generateSource(v){return"fragment"===v?[]:this._entries.map(p=>`in ${p[1]} ${p[0]};`)}}class u{constructor(){this._entries=new Map}add(v,p){this._entries.has(v)&&k.assert(this._entries.get(v)===p);this._entries.set(v,p)}generateSource(v){const p=[];this._entries.forEach((t,r)=>p.push("vertex"===
v?`out ${t} ${r};`:`in ${t} ${r};`));return p}}class x{constructor(){this._entries=new Set}add(v){this._entries.add(v)}generateSource(v){const p="vertex"===v?x.ALLOWLIST_VERTEX:x.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(t=>p.includes(t)).map(t=>`#extension ${t} : enable`)}}x.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];x.ALLOWLIST_VERTEX=[];class w{constructor(){this._entries=new Map}add(v,p,t=0){const r=this._entries.get(t);r?k.assert(r.name===
v&&r.type===p,`Fragment shader output location ${t} occupied`):this._entries.set(t,{name:v,type:p})}generateSource(v){if("vertex"===v)return[];0===this._entries.size&&this._entries.set(0,{name:w.DEFAULT_NAME,type:w.DEFAULT_TYPE});const p=[];this._entries.forEach((t,r)=>p.push(`layout(location = ${r}) out ${t.type} ${t.name};`));return p}}w.DEFAULT_TYPE="vec4";w.DEFAULT_NAME="fragColor";class q{constructor(){this._entries=new Set}add(v,p,t){let r="ERROR_CONSTRUCTOR_STRING";switch(p){case "float":r=
q._numberToFloatStr(t);break;case "int":r=q._numberToIntStr(t);break;case "bool":r=t.toString();break;case "vec2":r=`vec2(${q._numberToFloatStr(t[0])},                            ${q._numberToFloatStr(t[1])})`;break;case "vec3":r=`vec3(${q._numberToFloatStr(t[0])},                            ${q._numberToFloatStr(t[1])},                            ${q._numberToFloatStr(t[2])})`;break;case "vec4":r=`vec4(${q._numberToFloatStr(t[0])},                            ${q._numberToFloatStr(t[1])},                            ${q._numberToFloatStr(t[2])},                            ${q._numberToFloatStr(t[3])})`;
break;case "ivec2":r=`ivec2(${q._numberToIntStr(t[0])},                             ${q._numberToIntStr(t[1])})`;break;case "ivec3":r=`ivec3(${q._numberToIntStr(t[0])},                             ${q._numberToIntStr(t[1])},                             ${q._numberToIntStr(t[2])})`;break;case "ivec4":r=`ivec4(${q._numberToIntStr(t[0])},                             ${q._numberToIntStr(t[1])},                             ${q._numberToIntStr(t[2])},                             ${q._numberToIntStr(t[3])})`;
break;case "mat2":case "mat3":case "mat4":r=`${p}(${Array.prototype.map.call(t,y=>q._numberToFloatStr(y)).join(", ")})`}this._entries.add(`const ${p} ${v} = ${r};`);return this}static _numberToIntStr(v){return v.toFixed(0)}static _numberToFloatStr(v){return Number.isInteger(v)?v.toFixed(1):v.toString()}generateSource(){return Array.from(this._entries)}}a.Code=e;a.Includes=d;a.ShaderBuilder=f;a.Stage=n;a.Uniforms=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,h,c){function k(f,g){if(!f)throw g=g||"Assertion",new d(`${g} at ${Error(g).stack}`);}const m=c.create();class d{constructor(f){this.message=f}toString(){return`AssertException: ${this.message}`}}a.assert=k;a.isTranslationMatrix=function(f){return 1===f[0]&&0===f[1]&&0===f[2]&&0===f[3]&&0===f[4]&&1===f[5]&&0===f[6]&&0===f[7]&&0===f[8]&&0===f[9]&&1===
f[10]&&0===f[11]&&1===f[15]};a.logWithBase=function(f,g){return Math.log(f)/Math.log(g)};a.project=function(f,g,e,n,l){m[0]=f[0];m[1]=f[1];m[2]=f[2];m[3]=1;h.transformMat4(m,m,g);2<l.length&&(l[2]=-m[2]);h.transformMat4(m,m,e);k(0!==m[3]);l[0]=m[0]/m[3];l[1]=m[1]/m[3];l[2]=m[2]/m[3];l[0]=(.5*l[0]+.5)*n[2]+n[0];l[1]=(.5*l[1]+.5)*n[3]+n[1]};a.rayBoxTest=function(f,g,e,n){let l,u=(e[0]-f[0])/g[0],x=(n[0]-f[0])/g[0];u>x&&(l=u,u=x,x=l);let w=(e[1]-f[1])/g[1],q=(n[1]-f[1])/g[1];w>q&&(l=w,w=q,q=l);if(u>
q||w>x)return!1;w>u&&(u=w);q<x&&(x=q);e=(e[2]-f[2])/g[2];f=(n[2]-f[2])/g[2];e>f&&(l=e,e=f,f=l);if(u>f||e>x)return!1;f<x&&(x=f);return 0>x?!1:!0};a.rayRay2D=function(f,g,e,n,l,u=b.create()){const x=(n[l]-e[l])*(g[0]-f[0])-(n[0]-e[0])*(g[l]-f[l]);if(0===x)return!1;e=((n[0]-e[0])*(f[l]-e[l])-(n[l]-e[l])*(f[0]-e[0]))/x;u[0]=f[0]+e*(g[0]-f[0]);u[1]=f[l]+e*(g[l]-f[l]);return!0};a.setMatrixTranslation3=function(f,g,e,n){f[12]=g;f[13]=e;f[14]=n};a.verify=function(f,g){f||console.warn("Verify failed: "+(g||
"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"sampler2D",h.BindType.Pass,(d,f,g)=>d.bindTexture(k,m(f,g)))}}a.Texture2DPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],
function(a){class b{constructor(h,c){this._module=h;this._loadModule=c}get(){return this._module}async reload(){return this._module=await this._loadModule()}}a.ReloadableShaderModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,h){class c{constructor(k,m,d){this.release=d;this.initializeConfiguration(k,m);this._configuration=
m.snapshot();this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k.rctx.capabilities)}destroy(){this._program=b.disposeMaybe(this._program);this._pipeline=this._configuration=null}reload(k){b.disposeMaybe(this._program);this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(k){this.program.assertCompatibleVertexAttributeLocations(k)}get primitiveType(){return h.PrimitiveType.TRIANGLES}getPipeline(k,
m,d){return this._pipeline}initializeConfiguration(k,m){}}a.ShaderTechnique=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]=
"LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=
773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.MIN=32775]="MIN";b[b.MAX=32776]=
"MAX";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER";b[b.TRANSFORM_FEEDBACK_BUFFER=
35982]="TRANSFORM_FEEDBACK_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=
5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]=
"DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode=
{}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=
34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.ALPHA=
6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=
34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=
33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";
b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=
32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=
36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=
void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||
(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";
b[b.TransformFeedback=7]="TransformFeedback";b[b.Sync=8]="Sync";b[b.UNCOUNTED=9]="UNCOUNTED";b[b.LinesOfCode=9]="LinesOfCode";b[b.Uniform=10]="Uniform";b[b.COUNT=11]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=
36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=
36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.SpecialDrawBuffers=void 0;(function(b){b[b.NONE=0]="NONE";b[b.BACK=1029]="BACK"})(a.SpecialDrawBuffers||(a.SpecialDrawBuffers={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=
33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";
b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";
b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]=
"INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=
37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=
37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.DepthStencilAttachment=33306;a.baseTextureUnit=33984;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.NORMALCOMPRESSED,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.COLORFEATUREATTRIBUTE,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.CENTEROFFSETANDDISTANCE,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],
[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEMODEL,8],[b.VertexAttribute.INSTANCEMODELNORMAL,12],[b.VertexAttribute.INSTANCEMODELORIGINHI,11],[b.VertexAttribute.INSTANCEMODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(a,b,h){class c{constructor(k,
m,d){this._context=k;this._locations=d;this._textures=new Map;this._freeTextureUnits=new b({deallocator:null});this._glProgram=k.programCache.acquire(m.generate("vertex"),m.generate("fragment"),d);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=m.generateBindPass(this);this.bindDraw=m.generateBindDraw(this);this._fragmentUniforms=h.webglDebugEnabled()?m.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(k,
m){this._glProgram.setUniform1i(k,m?1:0)}setUniform1i(k,m){this._glProgram.setUniform1i(k,m)}setUniform1f(k,m){this._glProgram.setUniform1f(k,m)}setUniform2fv(k,m){this._glProgram.setUniform2fv(k,m)}setUniform3fv(k,m){this._glProgram.setUniform3fv(k,m)}setUniform4fv(k,m){this._glProgram.setUniform4fv(k,m)}setUniformMatrix3fv(k,m){this._glProgram.setUniformMatrix3fv(k,m)}setUniformMatrix4fv(k,m){this._glProgram.setUniformMatrix4fv(k,m)}setUniform1fv(k,m){this._glProgram.setUniform1fv(k,m)}setUniform1iv(k,
m){this._glProgram.setUniform1iv(k,m)}setUniform2iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform3iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform4iv(k,m){this._glProgram.setUniform4iv(k,m)}assertCompatibleVertexAttributeLocations(k){k.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear();this._freeTextureUnits.clear()}bindTexture(k,m){if(null==m?.glName){if(m=this._textures.get(k))this._context.bindTexture(null,m.unit),this._freeTextureUnit(m),
this._textures.delete(k);return null}let d=this._textures.get(k);null==d?(d=this._allocTextureUnit(m),this._textures.set(k,d)):d.texture=m;this._context.useProgram(this);this.setUniform1i(k,d.unit);this._context.bindTexture(m,d.unit);return d.unit}rebindTextures(){this._context.useProgram(this);this._textures.forEach((k,m)=>{this._context.bindTexture(k.texture,k.unit);this.setUniform1i(m,k.unit)});this._fragmentUniforms?.forEach(k=>{"sampler2D"!==k.type&&"samplerCube"!==k.type||this._textures.has(k.name)||
console.error(`Texture sampler ${k.name} has no bound texture`)})}_allocTextureUnit(k){return{texture:k,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(k){this._freeTextureUnits.push(k.unit)}}a.Program=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,h,c){function k(d,f){switch(f){case d.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case d.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case d.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case d.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case d.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case d.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const m=!!h("enable-feature:webgl-debug");a.checkWebGLError=function(d){if(m){var f=d.getError();f&&(d=k(d,f),f=Error().stack,c.getLogger("esri.views.webgl.checkWebGLError").error(new b("webgl-error","WebGL error occurred",{message:d,stack:f})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,h){function c(N){return F.intern(N)}function k(N){return G.intern(N)}function m(N){return H.intern(N)}function d(N){return L.intern(N)}function f(N){return C.intern(N)}function g(N){return z.intern(N)}function e(N){return J.intern(N)}function n(N){return K.intern(N)}function l(N){return I.intern(N)}function u(N){return"["+N.join(",")+"]"}function x(N){return N?u([N.srcRgb,N.srcAlpha,N.dstRgb,N.dstAlpha,N.opRgb,N.opAlpha,N.color.r,N.color.g,
N.color.b,N.color.a]):null}function w(N){return N?u([N.face,N.mode]):null}function q(N){return N?u([N.factor,N.units]):null}function v(N){return N?u([N.func]):null}function p(N){return N?u([N.function.func,N.function.ref,N.function.mask,N.operation.fail,N.operation.zFail,N.operation.zPass]):null}function t(N){return N?u([N.zNear,N.zFar]):null}function r(N){return N?u([N.r,N.g,N.b,N.a]):null}function y(N){return N?u([N.mask]):null}function D(N){return N?u(N.buffers):null}const E={face:h.Face.BACK,
mode:h.CullMode.CCW},A={face:h.Face.FRONT,mode:h.CullMode.CCW};class B{constructor(N,V){this._makeKey=N;this._makeRef=V;this._interns=new Map}intern(N){if(!N)return null;const V=this._makeKey(N),Q=this._interns;Q.has(V)||Q.set(V,this._makeRef(N));return Q.get(V)??null}}const F=new B(x,N=>({__tag:"Blending",...N})),G=new B(w,N=>({__tag:"Culling",...N})),H=new B(q,N=>({__tag:"PolygonOffset",...N})),L=new B(v,N=>({__tag:"DepthTest",...N})),C=new B(p,N=>({__tag:"StencilTest",...N})),z=new B(t,N=>({__tag:"DepthWrite",
...N})),J=new B(r,N=>({__tag:"ColorWrite",...N})),K=new B(y,N=>({__tag:"StencilWrite",...N})),I=new B(D,N=>({__tag:"DrawBuffers",...N})),M=new B(function(N){return N?u([x(N.blending),w(N.culling),q(N.polygonOffset),v(N.depthTest),p(N.stencilTest),t(N.depthWrite),r(N.colorWrite),y(N.stencilWrite),D(N.drawBuffers)]):null},N=>({blending:c(N.blending),culling:k(N.culling),polygonOffset:m(N.polygonOffset),depthTest:d(N.depthTest),stencilTest:f(N.stencilTest),depthWrite:g(N.depthWrite),colorWrite:e(N.colorWrite),
stencilWrite:n(N.stencilWrite),drawBuffers:l(N.drawBuffers)}));class S{constructor(N){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=N}setPipeline(N){if(this._pipelineInvalid||N!==this._pipeline)this._setBlending(N.blending),this._setCulling(N.culling),this._setPolygonOffset(N.polygonOffset),
this._setDepthTest(N.depthTest),this._setStencilTest(N.stencilTest),this._setDepthWrite(N.depthWrite),this._setColorWrite(N.colorWrite),this._setStencilWrite(N.stencilWrite),this._setDrawBuffers(N.drawBuffers),this._pipeline=N;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(N){this._blending=this._setSubState(N,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(N){this._culling=this._setSubState(N,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(N){this._polygonOffset=this._setSubState(N,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(N){this._depthTest=this._setSubState(N,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(N){this._stencilTest=
this._setSubState(N,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(N){this._depthWrite=this._setSubState(N,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(N){this._colorWrite=this._setSubState(N,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(N){this._stencilWrite=this._setSubState(N,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(N){this._drawBuffers=this._setSubState(N,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(N,V,Q,T){if(Q||N!==V)T(N),this._pipelineInvalid=!0;return N}}a.StateTracker=S;a.backFaceCullingParams=E;a.cullingParams=N=>N===b.CullFaceOptions.Back?E:N===b.CullFaceOptions.Front?A:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};
a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=A;a.makeBlending=c;a.makeColorWrite=e;a.makeCulling=k;a.makeDepthTest=d;a.makeDepthWrite=g;a.makeDrawBuffers=l;a.makePipelineState=function(N){return M.intern(N)};a.makePolygonOffset=m;a.makeStencilTest=f;a.makeStencilWrite=n;a.separateBlendingParams=function(N,V,Q,T,ia=h.BlendOperation.ADD,O=h.BlendOperation.ADD,U=[0,0,0,0]){return{srcRgb:N,srcAlpha:V,dstRgb:Q,dstAlpha:T,opRgb:ia,opAlpha:O,color:{r:U[0],g:U[1],b:U[2],a:U[3]}}};a.simpleBlendingParams=
function(N,V,Q=h.BlendOperation.ADD,T=[0,0,0,0]){return{srcRgb:N,srcAlpha:N,dstRgb:V,dstAlpha:V,opRgb:Q,opAlpha:Q,color:{r:T[0],g:T[1],b:T[2],a:T[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=
0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=
2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||
(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.reduced=this.haze=!1}}b.__decorate([h.parameter()],c.prototype,"haze",void 0);b.__decorate([h.parameter()],c.prototype,"reduced",void 0);a.ChapmanAtmosphereTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class h extends b.NoParameters{constructor(){super();this._key="";this._keyDirty=!1;this._parameterBits=
this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}get key(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}snapshot(){const c=this._parameterNames,k={key:this.key};for(const m of c)k[m]=this[m];return k}}a.ShaderTechniqueConfiguration=h;a.parameter=function(c={}){return(k,m)=>{k._parameterNames=k._parameterNames??[];k._parameterNames.push(m);if(null!=c.constValue)Object.defineProperty(k,
m,{get(){return c.constValue}});else{const d=k._parameterNames.length-1,f=Math.ceil(Math.log2(c.count||2)),g=k._parameterBits??[0];let e=0;for(;16<g[e]+f;)e++,e>=g.length&&g.push(0);k._parameterBits=g;const n=g[e],l=(1<<f)-1<<n;g[e]+=f;Object.defineProperty(k,m,{get(){return this[d]},set(u){if(this[d]!==u&&(this[d]=u,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~l|+u<<n&l,"number"!==typeof u&&"boolean"!==typeof u))throw Error("Configuration value for "+m+" must be boolean or number, got "+
typeof u);}})}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBO":function(){define(["exports","../../../core/maybe","./ManagedFBObject","../../webgl/enums"],function(a,b,h,c){class k extends h.ManagedFBObject{constructor(m,d,f,g,e,n){super(m,n);this.type=h.AttachmentType.FBO;this._colors=new Map;this._name="composite-color";this.acquireColor=this.acquireDepth=null;this._name=d;this.fbo=f;this.acquireDepth=g;this.acquireColor=e}dispose(){this.fbo.dispose()}get usedMemory(){return this.fbo.usedMemory}get depth(){return this._depth}get name(){return this._name}setName(m){this._name=
m}getTexture(m=c.ColorAttachment.COLOR_ATTACHMENT0){return m===c.DepthStencilAttachment?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(m)}getColorAttachment(m=c.ColorAttachment.COLOR_ATTACHMENT0){return this._colors.get(m)}attachDepth(m){m?.retain();this.detachDepth();m&&this.fbo.attachDepthStencil(m.attachment);this._depth=m;return this}detachDepth(){this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();this._depth=b.releaseMaybe(this._depth)}attachColor(m,d){m.retain();
this.detachColor(d);this.fbo.attachColorTexture(m.attachment);this._colors.set(d,m);return this}detachColor(m){this.fbo.detachColorTexture(m);const d=this._colors.get(m);this._colors.delete(m);d?.release()}detachAll(){this._colors.forEach((m,d)=>this.detachColor(d));this.detachDepth()}}a.ColorFormat=void 0;(function(m){m[m.RED=0]="RED";m[m.RG=1]="RG";m[m.RGBA4=2]="RGBA4";m[m.RGBA=3]="RGBA";m[m.RGBA_MIPMAP=4]="RGBA_MIPMAP";m[m.R16F=5]="R16F";m[m.RGBA16F=6]="RGBA16F"})(a.ColorFormat||(a.ColorFormat=
{}));a.DepthFormat=void 0;(function(m){m[m.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE";m[m.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"})(a.DepthFormat||(a.DepthFormat={}));a.ManagedFBO=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBObject":function(){define(["exports"],function(a){class b{constructor(h,c){this.key=h;this.free=c;this.incarnation=0;this._refCount=1}retain(){++this._refCount}release(){if(0===this._refCount)return console.log(`Releasing already released FBO attachment in ${Error().stack}`),
!0;--this._refCount;return 0===this._refCount?(this.free(),!0):!1}}a.AttachmentType=void 0;(function(h){h[h.FBO=0]="FBO";h[h.DEPTH=1]="DEPTH";h[h.COLOR=2]="COLOR"})(a.AttachmentType||(a.AttachmentType={}));a.ManagedFBObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,h,c){const k=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,
3,h.DataType.FLOAT,0,12)],m=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,3,h.DataType.FLOAT,0,20),new c.VertexElementDescriptor(b.VertexAttribute.UV0,2,h.DataType.FLOAT,12,20)],d=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,3,h.DataType.FLOAT,0,32),new c.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,h.DataType.FLOAT,12,32),new c.VertexElementDescriptor(b.VertexAttribute.UV0,2,h.DataType.FLOAT,24,32)],f=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,3,h.DataType.FLOAT,
0,16),new c.VertexElementDescriptor(b.VertexAttribute.COLOR,4,h.DataType.UNSIGNED_BYTE,12,16)],g=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,2,h.DataType.FLOAT,0,8)];b=[new c.VertexElementDescriptor(b.VertexAttribute.POSITION,2,h.DataType.FLOAT,0,16),new c.VertexElementDescriptor(b.VertexAttribute.UV0,2,h.DataType.FLOAT,8,16)];a.Pos2=g;a.Pos2Tex=b;a.Pos3=k;a.Pos3Col=f;a.Pos3NormalTex=d;a.Pos3Tex=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],
function(a){class b{constructor(h,c,k,m,d,f=!1,g=0){this.name=h;this.count=c;this.type=k;this.offset=m;this.stride=d;this.normalized=f;this.divisor=g}}a.VertexElementDescriptor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f){a.createEmptyTexture=function(g){const e=new f.TextureDescriptor(4);e.samplingMode=m.TextureSamplingMode.NEAREST;return new d.Texture(g,e)};a.createQuadVAO=function(g,e=h.Pos2,n=b.Default3D,l=-1,u=1){let x=null;switch(e){case h.Pos2Tex:x=new Float32Array([l,l,0,0,u,l,1,0,l,u,0,1,u,u,1,1]);break;default:x=new Float32Array([l,l,u,l,l,u,u,u])}return new c.VertexArrayObject(g,n,{geometry:e},{geometry:k.BufferObject.createVertex(g,m.Usage.STATIC_DRAW,x)})};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports","../../../webgl/VertexArrayObject"],function(a,b){class h extends b.VertexArrayObject{}a.VertexArrayObject=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(a,b,h,c,k,m){const d=()=>b.getLogger("esri.views.webgl.VertexArrayObject");
a.VertexArrayObject=class{constructor(f,g,e,n,l=null){this._context=f;this._locations=g;this._layout=e;this._buffers=n;this._indexBuffer=l;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((f,g)=>f+this._buffers[g].usedMemory,null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+
(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*c.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const f in this._buffers)this._buffers[f]?.dispose(),delete this._buffers[f];this._indexBuffer=h.disposeMaybe(this._indexBuffer);this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&d().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),
this._glName=null,this._context.instanceCounter.decrement(k.ResourceType.VertexArrayObject,this));this._context=null}initialize(){if(!this._initialized){var f=this._context?.capabilities?.vao;if(f){const g=f.createVertexArray();f.bindVertexArray(g);this._bindLayout();f.bindVertexArray(null);this._glName=g;this._context.instanceCounter.increment(k.ResourceType.VertexArrayObject,this)}this._initialized=!0}}bind(){this.initialize();const f=this._context?.capabilities?.vao;f?f.bindVertexArray(this.glName):
(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const {_buffers:f,_layout:g,_indexBuffer:e}=this;f||d().error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const l in f){const u=f[l];u||d().error("Vertex buffer is uninitialized!");const x=g[l];x||d().error("Vertex element descriptor is empty!");m.bindVertexBufferLayout(this._context,this._locations,u,x)}null!=e&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))}unbind(){this.initialize();
const f=this._context.capabilities.vao;f?f.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const {_buffers:f,_layout:g}=this;f||d().error("Vertex buffer dictionary is empty!");for(const e in f){const n=f[e];n||d().error("Vertex buffer is uninitialized!");m.unbindVertexBufferLayout(this._context,this._locations,n,g[e])}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports",
"../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],function(a,b,h,c,k){function m(f){f=f.gl;switch(f.getError()){case f.NO_ERROR:return null;case f.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case f.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case f.INVALID_OPERATION:return"The specified command is not allowed for the current state";case f.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";
case f.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case f.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function d(f){return f[0].stride}a.bindVertexBufferLayout=function(f,g,e,n,l=0){const u=f.gl;f.bindBuffer(e);for(const w of n)if(n=g.get(w.name),void 0===n)console.warn(`There is no location for vertex attribute '${w.name}' defined.`);else{e=l*w.stride;if(4>=w.count)u.vertexAttribPointer(n,w.count,w.type,w.normalized,w.stride,w.offset+e),u.enableVertexAttribArray(n),
0<w.divisor&&f.gl.vertexAttribDivisor(n,w.divisor);else if(9===w.count)for(var x=0;3>x;x++)u.vertexAttribPointer(n+x,3,w.type,w.normalized,w.stride,w.offset+12*x+e),u.enableVertexAttribArray(n+x),0<w.divisor&&f.gl.vertexAttribDivisor(n+x,w.divisor);else if(16===w.count)for(x=0;4>x;x++)u.vertexAttribPointer(n+x,4,w.type,w.normalized,w.stride,w.offset+16*x+e),u.enableVertexAttribArray(n+x),0<w.divisor&&f.gl?.vertexAttribDivisor(n+x,w.divisor);else console.error("Unsupported vertex attribute element count: "+
w.count);if(h.webglDebugEnabled()){n=m(f);x=k.getDataTypeBytes(w.type);const q=w.offset;x=Math.round(x/q)!==x/q?`. Offset not a multiple of stride. DataType requires ${x} bytes, but descriptor has an offset of ${q}`:"";n&&console.error(`Unable to bind vertex attribute "${w.name}" with baseInstanceOffset ${e}${x}:`,n,w)}}};a.getBytesPerElementFormat=function(f){switch(f){case c.PixelFormat.ALPHA:case c.PixelFormat.LUMINANCE:case c.PixelFormat.RED:case c.PixelFormat.RED_INTEGER:case c.SizedPixelFormat.R8:case c.SizedPixelFormat.R8I:case c.SizedPixelFormat.R8UI:case c.SizedPixelFormat.R8_SNORM:case c.RenderbufferFormat.STENCIL_INDEX8:return 1;
case c.PixelFormat.LUMINANCE_ALPHA:case c.PixelFormat.RG:case c.PixelFormat.RG_INTEGER:case c.SizedPixelFormat.RGBA4:case c.SizedPixelFormat.R16F:case c.SizedPixelFormat.R16I:case c.SizedPixelFormat.R16UI:case c.SizedPixelFormat.RG8:case c.SizedPixelFormat.RG8I:case c.SizedPixelFormat.RG8UI:case c.SizedPixelFormat.RG8_SNORM:case c.SizedPixelFormat.RGB565:case c.SizedPixelFormat.RGB5_A1:case c.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case c.PixelFormat.DEPTH_COMPONENT:case c.PixelFormat.RGB:case c.PixelFormat.RGB_INTEGER:case c.SizedPixelFormat.RGB8:case c.SizedPixelFormat.RGB8I:case c.SizedPixelFormat.RGB8UI:case c.SizedPixelFormat.RGB8_SNORM:case c.SizedPixelFormat.SRGB8:case c.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case c.PixelFormat.DEPTH_STENCIL:case c.PixelFormat.DEPTH24_STENCIL8:case c.PixelFormat.RGBA:case c.PixelFormat.RGBA_INTEGER:case c.SizedPixelFormat.RGBA8:case c.SizedPixelFormat.R32F:case c.SizedPixelFormat.R11F_G11F_B10F:case c.SizedPixelFormat.RG16F:case c.SizedPixelFormat.R32I:case c.SizedPixelFormat.R32UI:case c.SizedPixelFormat.RG16I:case c.SizedPixelFormat.RG16UI:case c.SizedPixelFormat.RGBA8I:case c.SizedPixelFormat.RGBA8UI:case c.SizedPixelFormat.RGBA8_SNORM:case c.SizedPixelFormat.SRGB8_ALPHA8:case c.SizedPixelFormat.RGB9_E5:case c.SizedPixelFormat.RGB10_A2UI:case c.SizedPixelFormat.RGB10_A2:case c.RenderbufferFormat.DEPTH_STENCIL:case c.RenderbufferFormat.DEPTH_COMPONENT32F:case c.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case c.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case c.SizedPixelFormat.RGB16F:case c.SizedPixelFormat.RGB16I:case c.SizedPixelFormat.RGB16UI:return 6;case c.SizedPixelFormat.RG32F:case c.SizedPixelFormat.RG32I:case c.SizedPixelFormat.RG32UI:case c.SizedPixelFormat.RGBA16F:case c.SizedPixelFormat.RGBA16I:case c.SizedPixelFormat.RGBA16UI:return 8;case c.SizedPixelFormat.RGB32F:case c.SizedPixelFormat.RGB32I:case c.SizedPixelFormat.RGB32UI:return 12;case c.SizedPixelFormat.RGBA32F:case c.SizedPixelFormat.RGBA32I:case c.SizedPixelFormat.RGBA32UI:return 16;
case c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case c.CompressedTextureFormat.COMPRESSED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case c.CompressedTextureFormat.COMPRESSED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=m;a.getStride=d;a.unbindVertexBufferLayout=function(f,g,e,n){const l=f.gl;f.bindBuffer(e);for(const u of n)if(e=g.get(u.name),4>=u.count)l.disableVertexAttribArray(e),u.divisor&&0<u.divisor&&f.gl?.vertexAttribDivisor(e,0);else if(9===u.count)for(n=
0;3>n;n++)l.disableVertexAttribArray(e+n),u.divisor&&0<u.divisor&&f.gl?.vertexAttribDivisor(e+n,0);else if(16===u.count)for(n=0;4>n;n++)l.disableVertexAttribArray(e+n),u.divisor&&0<u.divisor&&f.gl?.vertexAttribDivisor(e+n,0);else console.error("Unsupported vertex attribute element count: "+u.count);f.unbindBuffer(c.BufferType.ARRAY_BUFFER)};a.vertexCount=function(f,g){return f.vertexBuffers[g].usedMemory/d(f.layout[g])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports",
"./enums"],function(a,b){a.getDataTypeBytes=function(h){switch(h){case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:return 1;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:return 2;case b.DataType.FLOAT:case b.DataType.INT:case b.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),function(a,
b,h,c,k,m){const d=()=>h.getLogger("esri.views.webgl.BufferObject");class f{static createIndex(g,e,n){return new f(g,m.BufferType.ELEMENT_ARRAY_BUFFER,e,n)}static createVertex(g,e,n){return new f(g,m.BufferType.ARRAY_BUFFER,e,n)}static createUniform(g,e,n){return new f(g,m.BufferType.UNIFORM_BUFFER,e,n)}static createPixelPack(g,e=m.Usage.STREAM_READ,n){g=new f(g,m.BufferType.PIXEL_PACK_BUFFER,e);n&&g.setSize(n);return g}static createPixelUnpack(g,e=m.Usage.STREAM_DRAW,n){return new f(g,m.BufferType.PIXEL_UNPACK_BUFFER,
e,n)}static createTransformFeedback(g,e=m.Usage.STATIC_DRAW,n){g=new f(g,m.BufferType.TRANSFORM_FEEDBACK_BUFFER,e);g.setSize(n);return g}constructor(g,e,n,l){this._context=g;this.bufferType=e;this.usage=n;this._glName=null;this._size=-1;this._indexType=void 0;g.instanceCounter.increment(m.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();k.checkWebGLError(this._context.gl);l&&this.setData(l)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===
m.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===m.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===m.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(m.ResourceType.BufferObject,this),this._context=null):this._glName&&d().warn("Leaked WebGL buffer object")}setSize(g,e=
null){0>=g&&d().error("Buffer size needs to be positive!");if(this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case m.DataType.UNSIGNED_SHORT:g*=2;break;case m.DataType.UNSIGNED_INT:g*=4}this._setBufferData(g)}setData(g){if(g){var e=g.byteLength;this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&(c.isUint16Array(g)&&(e/=2,this._indexType=m.DataType.UNSIGNED_SHORT),c.isUint32Array(g)&&(e/=4,this._indexType=m.DataType.UNSIGNED_INT));this._setBufferData(e,g)}}_setBufferData(g,
e=null){this._size=g;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const l=this._context.gl;null!=e?l.bufferData(this.bufferType,e,this.usage):l.bufferData(this.bufferType,g,this.usage);k.checkWebGLError(l);this._isVAOAware&&this._context.bindVAO(n)}setSubData(g,e,n,l){if(g){(0>e||e*g.BYTES_PER_ELEMENT>=this.usedMemory)&&d().error("offset is out of range!");n>=l&&d().error("end must be bigger than start!");(e+(l-n))*g.BYTES_PER_ELEMENT>
this.usedMemory&&d().error("An attempt to write beyond the end of the buffer!");var u=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:x}=this._context;x.bufferSubData(this.bufferType,e*g.BYTES_PER_ELEMENT,g,n,l-n);k.checkWebGLError(x);this._isVAOAware&&this._context.bindVAO(u)}}getSubData(g,e=0,n,l){if(0>n||0>l)d().error("Problem getting subdata: offset and length were less than zero!");else{var u=b.isArrayLike(g)?g.BYTES_PER_ELEMENT:
1;u*((n??0)+(l??0))>g.byteLength?d().error("Problem getting subdata: offset and length exceeded destination size!"):(e+u*(l??0)>this.usedMemory&&d().warn("Potential problem getting subdata: requested data exceeds buffer size!"),u=this._context.gl,this.bufferType===m.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,m.BufferType.TRANSFORM_FEEDBACK_BUFFER),u.getBufferSubData(m.BufferType.TRANSFORM_FEEDBACK_BUFFER,e,g,n,l),this._context.unbindBuffer(m.BufferType.TRANSFORM_FEEDBACK_BUFFER)):
(this._context.bindBuffer(this,m.BufferType.COPY_READ_BUFFER),u.getBufferSubData(m.BufferType.COPY_READ_BUFFER,e,g,n,l),this._context.unbindBuffer(m.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(g,e=0,n,l){await this._context.clientWaitAsync();this.getSubData(g,e,n,l)}}a.BufferObject=f;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f){function g(v){(null!=v.width&&0>v.width||null!=v.height&&0>v.height||null!=v.depth&&0>v.depth)&&console.error("Negative dimension parameters are not allowed!")}function e(v,p){let t=p.samplingMode,r=p.samplingMode;if(t===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||t===k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)t=k.TextureSamplingMode.LINEAR,p.hasMipmap||(r=k.TextureSamplingMode.LINEAR);else if(t===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||t===k.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)t=
k.TextureSamplingMode.NEAREST,p.hasMipmap||(r=k.TextureSamplingMode.NEAREST);v.texParameteri(p.target,v.TEXTURE_MAG_FILTER,t);v.texParameteri(p.target,v.TEXTURE_MIN_FILTER,r)}function n(v,p){"number"===typeof p.wrapMode?(v.texParameteri(p.target,v.TEXTURE_WRAP_S,p.wrapMode),v.texParameteri(p.target,v.TEXTURE_WRAP_T,p.wrapMode)):(v.texParameteri(p.target,v.TEXTURE_WRAP_S,p.wrapMode.s),v.texParameteri(p.target,v.TEXTURE_WRAP_T,p.wrapMode.t))}function l(v,p){const t=v.capabilities.textureFilterAnisotropic;
t&&v.gl.texParameterf(p.target,t.TEXTURE_MAX_ANISOTROPY,p.maxAnisotropy??1)}function u(v){return null!=v&&"type"in v&&"compressed"===v.type}function x(v){return null!=v&&!u(v)&&!(null!=v&&"byteLength"in v)}function w(v){return v===k.TextureType.TEXTURE_3D||v===k.TextureType.TEXTURE_2D_ARRAY}function q(v,p,t,r=1){p=Math.max(p,t);v===k.TextureType.TEXTURE_3D&&(p=Math.max(p,r));return Math.round(Math.log(p)/Math.LN2)+1}h=class v{constructor(p,t=null,r=null){this.type=m.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in p)this._descriptor=p,r=t;else{p=f.ValidatedTextureDescriptor.validate(p,t);if(!p)throw new b("Texture descriptor invalid");this._descriptor=p}this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return d.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(k.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(p,t){const r=this._descriptor;if(r.width!==p||r.height!==t){if(this._wasImmutablyAllocated)throw new b("Immutable textures can't be resized!");r.width=p;r.height=t;this._descriptor.target===
k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(p=null){for(let t=k.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;t<=k.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(p,t)}setData(p){this._setData(p)}_setData(p,t){if(this._descriptor.context?.gl){var r=this._descriptor.context.gl;c.checkWebGLError(r);this._glName||(this._glName=r.createTexture())&&this._descriptor.context.instanceCounter.increment(k.ResourceType.Texture,this);void 0===p&&(p=null);
var y=this._descriptor,D=t??y.target,E=w(D);null===p&&(y.width=y.width||4,y.height=y.height||4,E&&(y.depth=y.depth??1));t=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);g(y);this._configurePixelStorage();c.checkWebGLError(r);var A=this._deriveInternalFormat();if(x(p)){let B="width"in p?p.width:p.codedWidth,F="height"in p?p.height:p.codedHeight;p instanceof HTMLVideoElement&&(B=p.videoWidth,F=p.videoHeight);
y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(D,A,y.hasMipmap,B,F,1);this._texImage(D,0,A,B,F,1,p);c.checkWebGLError(r);y.hasMipmap&&this.generateMipmap();y.width||(y.width=B);y.height||(y.height=F);E&&!y.depth&&(y.depth=1)}else{const {width:B,height:F,depth:G}=y;if(null==B||null==F)throw new b("Width and height must be specified!");if(E&&null==G)throw new b("Depth must be specified!");y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(D,A,y.hasMipmap,B,F,G);if(u(p)){const H=
p.levels;p=q(D,B,F,G);p=Math.min(p-1,H.length-1);r.texParameteri(y.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,p);if(!(A in k.CompressedTextureFormat))throw new b("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((L,C,z,J)=>{this._compressedTexImage(D,L,A,C,z,J,H[Math.min(L,H.length-1)])},p)}else this._texImage(D,0,A,B,F,G,p),c.checkWebGLError(r),y.hasMipmap&&this.generateMipmap()}e(r,this._descriptor);n(r,this._descriptor);l(this._descriptor.context,
this._descriptor);c.checkWebGLError(r);this._descriptor.context.bindTexture(t,v.TEXTURE_UNIT_FOR_UPDATES)}}updateData(p,t,r,y,D,E,A=0){E||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var B=this._descriptor;const F=this._deriveInternalFormat(),{context:G,pixelFormat:H,dataType:L,target:C,isImmutable:z}=B;if(z&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");const J=G.bindTexture(this,
v.TEXTURE_UNIT_FOR_UPDATES,!0);(0>t||0>r||y>B.width||D>B.height||t+y>B.width||r+D>B.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:B}=G);A&&B.pixelStorei(B.UNPACK_SKIP_ROWS,A);x(E)?B.texSubImage2D(C,p,t,r,y,D,H,L,E):u(E)?B.compressedTexSubImage2D(C,p,t,r,y,D,F,E.levels[p]):B.texSubImage2D(C,p,t,r,y,D,H,L,E);A&&B.pixelStorei(B.UNPACK_SKIP_ROWS,0);G.bindTexture(J,v.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(p,t,r,y,D,E,A,B){B||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var F=this._descriptor;const G=this._deriveInternalFormat(),{context:H,pixelFormat:L,dataType:C,isImmutable:z,target:J}=F;if(z&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");w(J)||console.warn("Attempting to set 3D texture data on a non-3D texture");const K=H.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);H.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);(0>t||0>r||0>y||D>F.width||
E>F.height||A>F.depth||t+D>F.width||r+E>F.height||y+A>F.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:F}=H);u(B)?(B=B.levels[p],F.compressedTexSubImage3D(J,p,t,r,y,D,E,A,G,B)):F.texSubImage3D(J,p,t,r,y,D,E,A,L,C,B);H.bindTexture(K,v.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const p=this._descriptor;if(!p.hasMipmap){if(this._wasImmutablyAllocated)throw new b("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=
p.hasMipmap=!0;g(p)}p.samplingMode===k.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,p.samplingMode=k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):p.samplingMode===k.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,p.samplingMode=k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const t=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(p.target);this._descriptor.context.bindTexture(t,
v.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(p){p!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=p,this._samplingModeDirty=!0)}setWrapMode(p){p!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=p,g(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const p=this._descriptor,t=p.context.gl;this._samplingModeDirty&&(e(t,p),this._samplingModeDirty=!1);this._wrapModeDirty&&(n(t,p),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===
k.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=k.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case k.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA32F;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB32F;default:throw new b("Unable to derive format");}case k.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=
k.SizedPixelFormat.RGBA8;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===k.PixelFormat.DEPTH_STENCIL?k.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const p=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:y}=this._descriptor;p.pixelStorei(p.UNPACK_ALIGNMENT,t);p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,r?1:0);p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
y?1:0)}_texStorage(p,t,r,y,D,E){const {gl:A}=this._descriptor.context;if(!(t in k.SizedPixelFormat))throw new b("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){r=r?q(p,y,D,E):1;if(w(p)){if(null==E)throw new b("Missing depth dimension for 3D texture upload");A.texStorage3D(p,r,t,y,D,E)}else A.texStorage2D(p,r,t,y,D);this._wasImmutablyAllocated=!0}}_texImage(p,t,r,y,D,E,A){const B=this._descriptor.context.gl,F=w(p),{isImmutable:G,pixelFormat:H,dataType:L}=this._descriptor;
if(G){if(null!=A)if(F){if(null==E)throw new b("Missing depth dimension for 3D texture upload");B.texSubImage3D(p,t,0,0,0,y,D,E,H,L,A)}else B.texSubImage2D(p,t,0,0,y,D,H,L,A)}else if(F){if(null==E)throw new b("Missing depth dimension for 3D texture upload");B.texImage3D(p,t,r,y,D,E,0,H,L,A)}else B.texImage2D(p,t,r,y,D,0,H,L,A)}_compressedTexImage(p,t,r,y,D,E,A){const B=this._descriptor.context.gl,F=w(p);if(this._descriptor.isImmutable){if(null!=A)if(F){if(null==E)throw new b("Missing depth dimension for 3D texture upload");
B.compressedTexSubImage3D(p,t,0,0,0,y,D,E,r,A)}else B.compressedTexSubImage2D(p,t,0,0,y,D,r,A)}else if(F){if(null==E)throw new b("Missing depth dimension for 3D texture upload");B.compressedTexImage3D(p,t,r,y,D,E,0,A)}else B.compressedTexImage2D(p,t,r,y,D,0,A)}_forEachMipmapLevel(p,t=Infinity){let {width:r,height:y,depth:D,hasMipmap:E,target:A}=this._descriptor;const B=A===k.TextureType.TEXTURE_3D;if(null==r||null==y||B&&null==D)throw new b("Missing texture dimensions for mipmap calculation");for(let F=
0;;++F){p(F,r,y,D);if(!E||1===r&&1===y&&(!B||1===D)||F>=t)break;r=Math.max(1,r>>1);y=Math.max(1,y>>1);B&&(D=Math.max(1,D>>1))}}};h.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=h;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var b=a.GLObjectType||(a.GLObjectType={});b[b.Texture=0]="Texture";b[b.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,b,h){class c{constructor(k=0,m=k){this.width=k;this.height=m;this.target=b.TextureType.TEXTURE_2D;this.pixelFormat=b.PixelFormat.RGBA;this.dataType=b.PixelType.UNSIGNED_BYTE;this.samplingMode=b.TextureSamplingMode.LINEAR;this.wrapMode=b.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=
!1}}a.TextureDescriptor=c;a.estimateMemory=function(k){return 0>=k.width||0>=k.height?0:Math.round(k.width*k.height*(k.hasMipmap?4/3:1)*(null==k.internalFormat?4:h.getBytesPerElementFormat(k.internalFormat)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,b,h){class c extends h.TextureDescriptor{constructor(k,m){super();this.context=k;Object.assign(this,m);switch(this.internalFormat){case b.SizedPixelFormat.R16F:case b.SizedPixelFormat.R16I:case b.SizedPixelFormat.R16UI:case b.SizedPixelFormat.R32F:case b.SizedPixelFormat.R32I:case b.SizedPixelFormat.R32UI:case b.SizedPixelFormat.R8_SNORM:case b.SizedPixelFormat.R8:case b.SizedPixelFormat.R8I:case b.SizedPixelFormat.R8UI:this.pixelFormat=
b.PixelFormat.RED}}static validate(k,m){return new c(k,m)}}a.ValidatedTextureDescriptor=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports","../../../../core/Error"],function(a,b){function h(k,m,d){if(k instanceof ImageData)return h(c(k),m,d);const f=document.createElement("canvas");f.width=m;f.height=d;f.getContext("2d").drawImage(k,0,0,f.width,f.height);return f}function c(k){const m=document.createElement("canvas");
m.width=k.width;m.height=k.height;const d=m.getContext("2d");if(null==d)throw new b("Failed to create 2d context from HTMLCanvasElement");d.putImageData(k,0,0);return m}a.applyTextureResizeFloorModulo=function(k){return 16*Math.floor(k/16)};a.applyTextureResizeModulo=function(k){return 16*Math.ceil(k/16)};a.downsampleImage=function(k,m){let d=k.width*k.height;if(4096>d)return k instanceof ImageData?c(k):k;let f=k.width,g=k.height;do f=Math.ceil(f/2),g=Math.ceil(g/2),d=f*g;while(1048576<d||null!=m&&
(f>m||g>m));return h(k,f,g)};a.ensureImageMaxSize=function(k,m){const d=Math.max(k.width,k.height);if(d<=m)return k;m/=d;return h(k,Math.round(k.width*m),Math.round(k.height*m))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/AtmosphereCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,h,c,k){function m(g){const e=new c.ShaderBuilder;e.include(b.ScreenSpacePass);e.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",n=>n.color),new k.Texture2DPassUniform("depthTexture",n=>n.depth));g=g.haze;e.fragment.code.add(h.glsl`
    void main() {
      ${g?h.glsl`vec4`:h.glsl`float`} depthSample = texture(depthTexture, uv) ${g?"":h.glsl`.r`};
      if (depthSample ${g?h.glsl`== vec4(0)`:h.glsl`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `);return e}class d extends h.NoParameters{}const f=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:d,build:m},Symbol.toStringTag,{value:"Module"}));a.AtmosphereCompositing=f;a.AtmosphereCompositingPassParameters=d;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,h){a.ScreenSpacePass=function(c,k=!0){c.attributes.add(h.VertexAttribute.POSITION,
"vec2");k&&c.varyings.add("uv","vec2");c.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${k?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g){class e extends c.ShaderTechnique{initializeProgram(n){return new m.Program(n.rctx,
e.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return this.configuration.haze?g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_COLOR,f.BlendFactor.ONE),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.simpleBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:g.defaultColorWriteParams})}}
e.shader=new h.ReloadableShaderModule(d.AtmosphereCompositing,()=>new Promise((n,l)=>a(["./AtmosphereCompositing.glsl"],n,l)));b.AtmosphereCompositingTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){a.CloudsComposition=class extends h{constructor(w){super(w);this._technique=new e.CloudsCompositionTechnique(w);this._vao=l.createQuadVAO(w.rctx)}destroy(){this._technique=c.releaseMaybe(this._technique);this._vao=c.disposeMaybe(this._vao)}render(w){if(this._technique.compiled){var q=w.bindParameters.cloudsFade;null!=this._vao&&null!=q.data&&(q=w.rctx.bindTechnique(this._technique,w.bindParameters,x),w.rctx.bindVAO(this._vao),q.assertCompatibleVertexAttributeLocations(this._vao),
w.rctx.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4))}else this.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=b.__decorate([g.subclass("esri.views.3d.environment.CloudsComposition")],
a.CloudsComposition);const x=new n.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends k.ShaderTechnique{constructor(l){super(l,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(l){return new f.Program(l.rctx,n.shader.get().build(),d.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE),depthTest:{func:g.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}n.shader=new c.ReloadableShaderModule(h.CloudsCompositionShader,
()=>new Promise((l,u)=>a(["./CloudsComposition.glsl"],l,u)));b.CloudsCompositionTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(){const t=new w.ShaderBuilder,{attributes:r,varyings:y,vertex:D,fragment:E}=t;r.add(q.VertexAttribute.POSITION,"vec2");y.add("worldRay","vec3");D.uniforms.add(new x.Matrix4PassUniform("inverseProjectionMatrix",(A,B)=>B.camera.inverseProjectionMatrix),new x.Matrix4PassUniform("inverseViewMatrix",(A,B)=>b.invertOrIdentity(p,B.camera.viewMatrix)));D.code.add(u.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);E.include(e.ColorConversion);E.include(n.RgbaFloatEncoding);t.include(c.EvaluateAmbientLighting,{pbrMode:d.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});t.include(f.PiUtils);t.include(k.Gamma);t.include(m.MainLighting);t.include(g.CloudsParallaxShading);E.uniforms.add(new l.Float3PassUniform("cameraPosition",(A,B)=>B.camera.eye));E.code.add(u.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return t}const p=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=h;a.build=v})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,h,c,k,m,d,f,g){const e=h.create(),n=k.create();a.EvaluateAmbientLighting=function(l,u){l=l.fragment;const x=void 0!==u.lightingSphericalHarmonicsOrder?u.lightingSphericalHarmonicsOrder:2;0===x?(l.uniforms.add(new d.Float3PassUniform("lightingAmbientSH0",(w,q)=>b.set(e,q.lighting.sh.r[0],q.lighting.sh.g[0],q.lighting.sh.b[0]))),l.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===x?(l.uniforms.add(new f.Float4PassUniform("lightingAmbientSH_R",(w,q)=>c.set(n,q.lighting.sh.r[0],q.lighting.sh.r[1],q.lighting.sh.r[2],q.lighting.sh.r[3])),new f.Float4PassUniform("lightingAmbientSH_G",(w,q)=>c.set(n,q.lighting.sh.g[0],q.lighting.sh.g[1],q.lighting.sh.g[2],q.lighting.sh.g[3])),new f.Float4PassUniform("lightingAmbientSH_B",(w,q)=>c.set(n,q.lighting.sh.b[0],q.lighting.sh.b[1],q.lighting.sh.b[2],q.lighting.sh.b[3]))),l.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===x&&(l.uniforms.add(new d.Float3PassUniform("lightingAmbientSH0",(w,q)=>b.set(e,q.lighting.sh.r[0],q.lighting.sh.g[0],q.lighting.sh.b[0])),new f.Float4PassUniform("lightingAmbientSH_R1",(w,q)=>c.set(n,q.lighting.sh.r[1],q.lighting.sh.r[2],q.lighting.sh.r[3],q.lighting.sh.r[4])),new f.Float4PassUniform("lightingAmbientSH_G1",(w,q)=>c.set(n,q.lighting.sh.g[1],q.lighting.sh.g[2],q.lighting.sh.g[3],q.lighting.sh.g[4])),new f.Float4PassUniform("lightingAmbientSH_B1",(w,q)=>c.set(n,q.lighting.sh.b[1],
q.lighting.sh.b[2],q.lighting.sh.b[3],q.lighting.sh.b[4])),new f.Float4PassUniform("lightingAmbientSH_R2",(w,q)=>c.set(n,q.lighting.sh.r[5],q.lighting.sh.r[6],q.lighting.sh.r[7],q.lighting.sh.r[8])),new f.Float4PassUniform("lightingAmbientSH_G2",(w,q)=>c.set(n,q.lighting.sh.g[5],q.lighting.sh.g[6],q.lighting.sh.g[7],q.lighting.sh.g[8])),new f.Float4PassUniform("lightingAmbientSH_B2",(w,q)=>c.set(n,q.lighting.sh.b[5],q.lighting.sh.b[6],q.lighting.sh.b[7],q.lighting.sh.b[8]))),l.code.add(g.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),u.pbrMode!==m.PBRMode.Normal&&u.pbrMode!==m.PBRMode.Schematic||l.code.add(g.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),function(a,
b,h,c,k,m,d,f,g){a.PBRMode=void 0;(function(n){n[n.Disabled=0]="Disabled";n[n.Normal=1]="Normal";n[n.Schematic=2]="Schematic";n[n.Water=3]="Water";n[n.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";n[n.Simplified=5]="Simplified";n[n.TerrainWithWater=6]="TerrainWithWater";n[n.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));class e extends g.GLTextureMaterialBindParameters{}a.PBRBindParameters=e;a.PhysicallyBasedRenderingParameters=function(n,l){const u=n.fragment,x=l.hasMetallicRoughnessTexture||l.hasEmissionTexture||
l.hasOcclusionTexture;l.pbrMode===a.PBRMode.Normal&&x&&n.include(b.VertexTextureCoordinates,l);l.pbrMode===a.PBRMode.Schematic?u.code.add(k.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):l.pbrMode===a.PBRMode.Disabled?u.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`):l.pbrMode===a.PBRMode.Normal&&(u.code.add(k.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),n=l.pbrTextureBindType,l.hasMetallicRoughnessTexture&&(u.uniforms.add(n===f.BindType.Pass?new d.Texture2DPassUniform("texMetallicRoughness",w=>w.textureMetallicRoughness):new m.Texture2DDrawUniform("texMetallicRoughness",w=>w.textureMetallicRoughness)),u.code.add(k.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),l.hasEmissionTexture&&(u.uniforms.add(n===f.BindType.Pass?new d.Texture2DPassUniform("texEmission",w=>w.textureEmissive):new m.Texture2DDrawUniform("texEmission",w=>w.textureEmissive)),u.code.add(k.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),l.hasOcclusionTexture?(u.uniforms.add(n===f.BindType.Pass?new d.Texture2DPassUniform("texOcclusion",w=>w.textureOcclusion):new m.Texture2DDrawUniform("texOcclusion",w=>w.textureOcclusion)),u.code.add(k.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):u.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`),n===f.BindType.Pass?u.uniforms.add(new c.Float3PassUniform("emissionFactor",w=>w.emissiveFactor),new c.Float3PassUniform("mrrFactors",w=>w.mrrFactors)):u.uniforms.add(new h.Float3DrawUniform("emissionFactor",w=>w.emissiveFactor),new h.Float3DrawUniform("mrrFactors",w=>w.mrrFactors)),u.code.add(k.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${l.hasMetallicRoughnessTexture?k.glsl`applyMetallnessAndRoughness(${l.hasMetallicRoughnessTextureTransform?k.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${l.hasEmissionTexture?k.glsl`applyEmission(${l.hasEmissiveTextureTransform?k.glsl`emissiveUV`:"vuv0"});`:""}

      ${l.hasOcclusionTexture?k.glsl`applyOcclusion(${l.hasOcclusionTextureTransform?k.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,h,c,k){a.VertexTextureCoordinates=function(m,d){m.include(h.TextureCoordinateAttribute,d);switch(d.textureCoordinateType){case h.TextureCoordinateAttributeType.Default:case h.TextureCoordinateAttributeType.Compressed:m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case h.TextureCoordinateAttributeType.Atlas:m.include(c.TextureAtlasLookup);m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:b.neverReached(d.textureCoordinateType);case h.TextureCoordinateAttributeType.None:case h.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(h){h.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec3",h.BindType.Draw,(d,f,g,e)=>d.setUniform3fv(k,m(f,g,e)))}}a.Float3DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"sampler2D",h.BindType.Draw,(d,f,g)=>d.bindTexture(k,m(f,g)))}}a.Texture2DDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,h,c,k,m){class d extends m{constructor(g){super(g);
this._numLoading=0;this._disposed=!1;this._textureRepository=g.textureRepository;this._textureId=g.textureId;this._acquire(g.textureId,e=>this._texture=e);this._acquire(g.normalTextureId,e=>this._textureNormal=e);this._acquire(g.emissiveTextureId,e=>this._textureEmissive=e);this._acquire(g.occlusionTextureId,e=>this._textureOcclusion=e);this._acquire(g.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){this._texture=b.releaseMaybe(this._texture);this._textureNormal=b.releaseMaybe(this._textureNormal);
this._textureEmissive=b.releaseMaybe(this._textureEmissive);this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0}ensureResources(g){return 0===this._numLoading?k.ResourceState.LOADED:k.ResourceState.LOADING}get textureBindParameters(){return new f(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:
null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(g){if(null==this._texture||g!==this._texture.id)this._texture=b.releaseMaybe(this._texture),this._textureId=g,this._acquire(this._textureId,e=>this._texture=e)}_acquire(g,e){null==g?e(null):(g=this._textureRepository.acquire(g),h.isPromiseLike(g)?(++this._numLoading,g.then(n=>{this._disposed?(b.releaseMaybe(n),e(null)):e(n)}).finally(()=>
--this._numLoading)):e(g))}}class f extends c.NoParameters{constructor(g=null,e=null,n=null,l=null,u=null){super();this.texture=g;this.textureNormal=e;this.textureEmissive=n;this.textureOcclusion=l;this.textureMetallicRoughness=u}}a.GLTextureMaterial=d;a.GLTextureMaterialBindParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],function(a){class b{constructor(h){this._material=h.material;this._techniqueRepository=
h.techniqueRep;this._output=h.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(h,c){return this._technique=this._techniqueRepository.releaseAndAcquire(h,this._material.getConfiguration(this._output,c),this._technique)}ensureResources(h){return a.ResourceState.LOADED}}
return b})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(h){h.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);h.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsData ../../../../environment/CloudsParameters ../../../../environment/weather ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){a.CloudsParallaxShading=function(x){x=x.fragment;x.uniforms.add(new l.Matrix4PassUniform("rotationMatrixClouds",(w,q)=>q.cloudsFade.parallax.transform),new l.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(w,q)=>q.cloudsFade.parallaxNew.transform),new g.Float3PassUniform("anchorPosition",(w,q)=>q.cloudsFade.parallax.anchorPointClouds),new g.Float3PassUniform("anchorPositionCrossFade",(w,q)=>q.cloudsFade.parallaxNew.anchorPointClouds),new e.FloatPassUniform("cloudsHeight",
()=>m.cloudsHeight),new e.FloatPassUniform("radiusCurvatureCorrectionFactor",(w,q)=>q.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new e.FloatPassUniform("totalFadeInOut",(w,q)=>1-q.cloudsFade.opacity),new e.FloatPassUniform("crossFadeAnchorFactor",(w,q)=>b.clamp(q.cloudsFade.fadeFactor,0,1)),new u.TextureCubePassUniform("cubeMap",(w,q)=>q.cloudsFade.data?.cubeMap?.colorTexture??null),new f.BooleanPassUniform("crossFade",(w,q)=>q.cloudsFade.fadeMode===k.FadeMode.CROSS_FADE),new f.BooleanPassUniform("readChannelsRG",
(w,q)=>q.cloudsFade.readChannels===c.CloudsTextureChannels.RG),new f.BooleanPassUniform("fadeTextureChannels",(w,q)=>q.cloudsFade.renderingStage===c.CloudsRenderingStages.FADING));x.constants.add("planetRadius","float",h.earth.radius);x.code.add(n.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);x.code.add(n.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);x.code.add(n.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);d.addMainLightDirection(x);d.addMainLightIntensity(x);x.code.add(n.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);x.code.add(n.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);x.code.add(n.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);x.code.add(n.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);x.code.add(n.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports"],function(a){a.CloudsRenderingStages=void 0;(function(b){b[b.RENDERING=0]="RENDERING";b[b.FADING=1]="FADING";b[b.FINISHED=2]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return null!=
b&&!b.running};a.isReadyCloudsData=function(b){return null!=b?.cubeMap};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsParameters":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l{constructor(){this.readChannels=g.CloudsTextureChannels.RG;this.renderingStage=g.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=m.create();this.parallax=new u;this.parallaxNew=new u;this.pointOnGround=m.create();this.fadeMode=a.FadeMode.HIDE;this.opacity=this.fadeFactor=0}updateParallax(v){var p=this.parallax;v=k.length(v.eye);p.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(v*v-f.earth.radius*f.earth.radius,
0))/v;d.fromPoints(x,p.anchorPointClouds,w);h.rotate(p.transform,c.IDENTITY,w[3],d.axis(w));this.fadeMode===a.FadeMode.CROSS_FADE&&(p=this.parallaxNew,d.fromPoints(x,p.anchorPointClouds,w),h.rotate(p.transform,c.IDENTITY,w[3],d.axis(w)))}updateFading(v,p,t,r){this.isFading&&this._advanceFading(t,r);this._evaluateFading(v,p,t)}_evaluateFading(v,p,t){const r=v.relativeElevation;v=this._calculateDistanceToAnchorPoint(v);(r>1.7*e.weatherHeightLimit||r<-e.weatherHeightLimit||2E5<v)&&0<this.opacity?this._setFade(a.FadeMode.HIDE,
t):this.isFading||((r>e.weatherHeightLimit||r<-.35*e.weatherHeightLimit||64E3<v)&&0<this.opacity?this._setFade(a.FadeMode.FADE_OUT,t):r<=e.weatherHeightLimit&&r>=-.35*e.weatherHeightLimit&&p===n.RenderState.IDLE&&g.ensureClouds(this.data)&&(0===this.opacity?this._setFade(a.FadeMode.FADE_IN,t):(34E3<v||this.renderingStage===g.CloudsRenderingStages.FADING)&&this._setFade(a.FadeMode.CROSS_FADE,t)))}_advanceFading(v,p){this._switchReadChannels();this._updateAnchorPoint();this._advanceFadingFactorAndOpacity(v,
p)}_advanceFadingFactorAndOpacity(v,p){1>this.fadeFactor?(this.fadeFactor=p?b.clamp((v-this.startTime)/(1.25*p),0,1):1,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=this.fadeFactor),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1)):(this.fadeFactor=0,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=0),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=1),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1),this.fadeMode=
a.FadeMode.NONE)}_switchReadChannels(){const v=this.fadeMode===a.FadeMode.CROSS_FADE&&1===this.fadeFactor,p=this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor;this.renderingStage===g.CloudsRenderingStages.FADING&&(v||p)&&(this.readChannels=1-this.readChannels,this.renderingStage=g.CloudsRenderingStages.FINISHED)}_calculateDistanceToAnchorPoint(v){k.normalize(this.pointOnGround,v.eye);k.scale(this.pointOnGround,this.pointOnGround,f.earth.radius);return k.length(k.subtract(q,this.parallax.anchorPointClouds,
this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===a.FadeMode.CROSS_FADE&&(0===this.fadeFactor&&k.copy(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds));this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(v,p){switch(v){case a.FadeMode.HIDE:this.opacity=0;break;case a.FadeMode.FADE_OUT:this.opacity=1;break;case a.FadeMode.FADE_IN:this.opacity=
0;break;case a.FadeMode.CROSS_FADE:this.opacity=1}this.fadeMode=v;this.fadeFactor=0;this.startTime=p}get isFading(){return this.fadeMode===a.FadeMode.FADE_OUT||this.fadeMode===a.FadeMode.FADE_IN||this.fadeMode===a.FadeMode.CROSS_FADE}}a.FadeMode=void 0;(function(v){v[v.NONE=0]="NONE";v[v.HIDE=1]="HIDE";v[v.FADE_OUT=2]="FADE_OUT";v[v.FADE_IN=3]="FADE_IN";v[v.CROSS_FADE=4]="CROSS_FADE"})(a.FadeMode||(a.FadeMode={}));class u{constructor(){this.anchorPointClouds=m.create();this.radiusCurvatureCorrectionFactor=
0;this.transform=c.create()}}const x=m.fromValues(0,0,1),w=d.create(),q=m.create();a.CloudsParameters=l;a.crossFadeDistanceThreshold=34E3;a.fadeOutDistanceThreshold=64E3;a.hideDistanceThreshold=2E5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngleDegrees":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,h,c,k,m,d){function f(y=x){return[y[0],y[1],y[2],y[3]]}function g(y,D,E,A,B=f()){B[0]=y;B[1]=D;B[2]=E;B[3]=A;return B}function e(y,D,E=f()){k.copy(E,y);E[3]=D;return E}function n(y,D,E=f()){h.setAxisAngle(w,y,l(y));h.setAxisAngle(q,D,l(D));h.multiply(w,q,w);return u(E,b.rad2deg(h.getAxisAngle(E,w)))}function l(y){return b.deg2rad(y[3])}function u(y,D){y[3]=D;return y}const x=[0,0,1,0],w=c.create(),q=c.create(),v=f(),p=f(),t=f(),r=f();a.angle=function(y){return y[3]};a.angleRad=l;a.axis=
function(y){return y};a.compose=n;a.composeAxes=function(y,D,E,A=f()){e(m.UNIT_X,y,p);e(m.UNIT_Y,D,t);e(m.UNIT_Z,E,r);n(p,t,p);n(p,r,A);return A};a.copy=function(y,D=f()){return g(y[0],y[1],y[2],y[3],D)};a.create=f;a.fromAxisAndAngle=e;a.fromPoints=function(y,D,E=d.create()){k.cross(E,y,D);k.normalize(E,E);E[3]=-k.angle(y,D);return E};a.fromValues=g;a.setAngle=u;a.up=x;a.wrap=function(y,D,E,A){return g(y,D,E,A,v)};a.wrapAxisAngle=function(y,D){return g(y[0],y[1],y[2],D,v)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=void 0;var b=a.RenderState||(a.RenderState={});b[b.ANIMATING=0]="ANIMATING";b[b.INTERACTING=1]="INTERACTING";b[b.IDLE=2]="IDLE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,
m){super(k,"bool",h.BindType.Pass,(d,f,g)=>d.setUniform1b(k,m(f,g)))}}a.BooleanPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"samplerCube",h.BindType.Pass,(d,f,g)=>d.bindTexture(k,m(f,g)))}}a.TextureCubePassUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(h){h.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../support/Yield ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J){a.CloudsGenerator=class extends h{constructor(S){super(S);this._techniques=[];this._techniqueConfiguration=new A.CloudsTechniqueConfiguration;this._bindParameters=new F.BindParameters(null,null);this._passParameters=new t.CloudsPassParameters;this._weatherTile=q.create();this._weatherTileCount=128;this._tileIndex=this._faceIndex=0;this.coverage=c.lerp(D.cloudPresets.default.coverage[0],D.cloudPresets.default.coverage[1],.5);
this.density=c.lerp(D.cloudPresets.default.density[0],D.cloudPresets.default.density[1],.5);this.absorption=c.lerp(D.cloudPresets.default.absorption[0],D.cloudPresets.default.absorption[1],.5);this.cloudSize=c.lerp(D.cloudPresets.default.cloudSize[0],D.cloudPresets.default.cloudSize[1],.5);this.detailSize=c.lerp(D.cloudPresets.default.detailSize[0],D.cloudPresets.default.detailSize[1],.5);this.smoothness=c.lerp(D.cloudPresets.default.smoothness[0],D.cloudPresets.default.smoothness[1],.5);this.cloudHeight=
c.lerp(D.cloudPresets.default.cloudHeight[0],D.cloudPresets.default.cloudHeight[1],.5);this.raymarchingSteps=D.cloudPresets.default.raymarchingSteps;this._viewMatrix=x.create();this.running=this._dirty=!1;this._vao=G.createQuadVAO(S.context.renderContext.rctx)}_getTechnique(S){const N=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,V=N===r.CloudsTextureChannels.RG?2*S:2*S+1,Q=this._techniques[V];if(Q)return Q;this._techniqueConfiguration.writeTextureChannels=N;this._techniqueConfiguration.steps=
S;this._techniques[V]=new E.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[V]}updateWeatherTile(){var S=this.view.camera.position.latitude,N=this.view.camera.position.longitude;null!=S&&null!=N&&(w.set(this._weatherTile,(S+90)/180,(N+180)/360),S=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=
Math.floor(4*(this._weatherTileCount-S)*this._weatherTile[1]),N=S=0,null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date&&(N=new Date(this.view.environment.lighting.date),N.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),S=31*N.getUTCMonth()+N.getUTCDate(),N=N.getUTCFullYear()),this._weatherTile[0]=(this._weatherTile[0]+S)%(2*this._weatherTileCount),this._weatherTile[1]=
(this._weatherTile[1]+N%100)%(4*this._weatherTileCount),w.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())}initialize(){const S=p.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*S.radius;this.setDirty();this.updateWeatherTile();this.addHandles([this.view.resourceController.scheduler.registerTask(H.TaskPriority.CLOUDS_GENERATOR,this),m.watch(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,
this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),m.initial)])}destroy(){this._techniques.forEach(S=>k.releaseMaybe(S));this._frameBufferCube=k.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao.dispose();this._passParameters.noiseTexture=k.destroyMaybe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case A.RayMarchingSteps.SIXTEEN:return 1;case A.RayMarchingSteps.HUNDRED:return 4;case A.RayMarchingSteps.COUNT:case A.RayMarchingSteps.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.usedMemory??
0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){null==this._passParameters.noiseTexture&&(this._passParameters.noiseTexture=new B.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(S){null==this._frameBufferCube&&(S=new J.TextureDescriptor(S),S.target=C.TextureType.TEXTURE_CUBE_MAP,S.wrapMode=C.TextureWrapMode.CLAMP_TO_EDGE,
this._frameBufferCube=new z.FramebufferObject(this.context.renderContext.rctx,S));return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=k.disposeMaybe(this._frameBufferCube)}applyPreset(S,N){const V=S.median,Q=T=>{const ia=c.lerp(T[0],T[1],V);return.5>N?c.lerp(T[0],ia,2*N):c.lerp(ia,T[1],2*(N-.5))};this.coverage=Q(S.coverage);this.density=Q(S.density);this.absorption=Q(S.absorption);this.cloudSize=Q(S.cloudSize);this.detailSize=Q(S.detailSize);
this.smoothness=Q(S.smoothness);this.cloudHeight=Q(S.cloudHeight);this.raymarchingSteps=S.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(S){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),w.copy(this._passParameters.weatherTile,this._weatherTile));var N=this._getTechnique(this._passParameters.raymarchingSteps);if(!N.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||
!this._ensureNoiseTexture())return L.Yield;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=r.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,
this._dirty=!1);u.targetTo(this._viewMatrix,M,K[this._faceIndex],I[this._faceIndex]);l.fromMat4(this._passParameters.viewMatrix,this._viewMatrix);const V=this.context.renderContext.rctx;var Q=V.bindTechnique(N,this._bindParameters,this._passParameters);V.bindVAO(this._vao);Q.assertCompatibleVertexAttributeLocations(this._vao);Q=V.getViewport();N=N.configuration.cubeMapSize;const T=N/this._tilesPerFace;V.setViewport(0,this._tileIndex*T,N,T);N=this._ensureFrameBufferCube(N);V.bindFramebuffer(N);N.setColorTextureTarget(C.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+
this._faceIndex);V.gl.drawArrays(V.gl.TRIANGLE_STRIP,0,4);V.gl.flush();V.setViewport(Q.x,Q.y,Q.width,Q.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=r.CloudsRenderingStages.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);S.madeProgress();return L.Yield}};b.__decorate([d.property({constructOnly:!0})],
a.CloudsGenerator.prototype,"context",void 0);b.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);b.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"coverage",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"density",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"absorption",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,
"cloudSize",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"detailSize",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"smoothness",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);b.__decorate([d.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=b.__decorate([n.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);
const K=[v.fromValues(1,0,0),v.fromValues(-1,0,0),v.fromValues(0,1,0),v.fromValues(0,-1,0),v.fromValues(0,0,1)],I=[v.fromValues(0,1,0),v.fromValues(0,1,0),v.fromValues(0,0,-1),v.fromValues(0,0,1),v.fromValues(0,1,0)],M=v.zeros();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function h(v){const p=new Float32Array(3);p[0]=v[0];p[1]=v[1];p[2]=v[2];return p}
function c(v,p,t){const r=new Float32Array(3);r[0]=v;r[1]=p;r[2]=t;return r}function k(v,p){return new Float32Array(v,p,3)}function m(){return b()}function d(){return c(1,1,1)}function f(){return c(1,0,0)}function g(){return c(0,1,0)}function e(){return c(0,0,1)}const n=b(),l=d(),u=f(),x=g(),w=e(),q=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:u,UNIT_Y:x,UNIT_Z:w,ZEROS:n,clone:h,create:b,createView:k,fromValues:c,ones:d,unitX:f,unitY:g,unitZ:e,zeros:m},Symbol.toStringTag,{value:"Module"}));
a.ONES=l;a.UNIT_X=u;a.UNIT_Y=x;a.UNIT_Z=w;a.ZEROS=n;a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.ones=d;a.unitX=f;a.unitY=g;a.unitZ=e;a.vec3f32=q;a.zeros=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Clouds.glsl":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/factories/mat3f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(r){const y=new x.ShaderBuilder;y.include(g.ScreenSpacePass,!1);const D=y.fragment;D.uniforms.add(new n.FloatPassUniform("cloudRadius",E=>E.cloudRadius),new n.FloatPassUniform("power",E=>b.lerp(35,120,E.absorption)),new n.FloatPassUniform("sigmaE",E=>1+E.absorption),new n.FloatPassUniform("density",E=>b.lerp(0,.3,E.density)),new n.FloatPassUniform("cloudSize",E=>b.lerp(0,.02,Math.max(.01,1-E.cloudSize))),new n.FloatPassUniform("detailSize",E=>b.lerp(0,
.2,Math.max(.01,1-E.detailSize))),new n.FloatPassUniform("smoothness",E=>b.lerp(0,.5,1-E.smoothness)),new n.FloatPassUniform("cloudHeight",E=>b.lerp(0,1500,E.cloudHeight)),new n.FloatPassUniform("coverage",E=>E.coverage),new u.Matrix3PassUniform("view",E=>E.viewMatrix),new w.Texture2DPassUniform("cloudShapeTexture",E=>null!=E.noiseTexture?E.noiseTexture.textureAtlas:null),new e.Float2PassUniform("cloudVariables",E=>c.set(p,E.coverage,E.absorption)));D.constants.add("halfCubeMapSize","float",.5*r.cubeMapSize);
D.code.add(l.glsl`
    const int STEPS = ${r.steps===d.RayMarchingSteps.SIXTEEN?l.glsl`16`:r.steps===d.RayMarchingSteps.HUNDRED?l.glsl`100`:l.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);D.code.add(l.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${l.glsl.float(f.atlasSize)};
      const float dataWidth = ${l.glsl.float(f.atlasSize)};
      const float tileRows = ${l.glsl.float(f.tileRows)};
      const vec3 atlasDimensions = vec3(${l.glsl.float(f.tileSize)}, ${l.glsl.float(f.tileSize)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${l.glsl.float(f.textureScale)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${l.glsl.float(f.weatherMapScale)} * p) / ${l.glsl.float(f.atlasSize)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);D.code.add(l.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);D.code.add(l.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);D.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
D.code.add(l.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);D.code.add(l.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);D.code.add(l.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return y}class v extends l.NoParameters{constructor(){super(...arguments);this.coverage=this.cloudHeight=this.smoothness=this.density=this.absorption=this.detailSize=this.cloudSize=this.cloudRadius=0;this.raymarchingSteps=m.cloudPresets.default.raymarchingSteps;this.weatherTile=k.create();this.viewMatrix=h.create()}}const p=k.create(),t=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:v,build:q},Symbol.toStringTag,{value:"Module"}));a.Clouds=t;a.CloudsPassParameters=v;
a.build=q})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){class h{constructor(k,m,d,f,g,e,n,l,u=.5){this.coverage=k;this.density=m;this.absorption=d;this.cloudSize=f;this.detailSize=g;this.smoothness=e;this.cloudHeight=n;this.raymarchingSteps=l;this.median=u}}const c=new h([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN);b={sunny:c,cloudy:new h([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,
.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new h([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new h([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new h([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN),default:c};a.CloudPresets=h;a.cloudPresets=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","../../../core/has","./CloudsData","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h,c,k){a.RayMarchingSteps=void 0;(function(d){d[d.SIXTEEN=0]="SIXTEEN";d[d.HUNDRED=1]="HUNDRED";d[d.TWOHUNDRED=2]="TWOHUNDRED";d[d.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));class m extends k.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.steps=a.RayMarchingSteps.SIXTEEN;this.writeTextureChannels=c.CloudsTextureChannels.RG}}
b.__decorate([k.parameter({count:a.RayMarchingSteps.COUNT})],m.prototype,"steps",void 0);b.__decorate([k.parameter({constValue:h("esri-mobile")?1024:2048})],m.prototype,"cubeMapSize",void 0);b.__decorate([k.parameter()],m.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:
128;const h=Math.ceil(Math.sqrt(b)),c=(b+2)*h;a.atlasSize=c;a.textureScale=b/128;a.tileRows=h;a.tileSize=b;a.weatherMapScale=c/1560;a.weatherMapSize=1E5;a.weatherTileSize=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"mat3",h.BindType.Pass,(d,f,g)=>d.setUniformMatrix3fv(k,
m(f,g)))}}a.Matrix3PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends m.ShaderTechnique{constructor(l,
u){super(l,u,()=>this.destroy())}initializeProgram(l){return new f.Program(l.rctx,n.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.simpleBlendingParams(g.BlendFactor.CONSTANT_COLOR,g.BlendFactor.ONE_MINUS_CONSTANT_COLOR,g.BlendOperation.ADD,this.configuration.writeTextureChannels===c.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:g.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}n.shader=new k.ReloadableShaderModule(h.Clouds,
()=>new Promise((l,u)=>a(["./Clouds.glsl"],l,u)));b.CloudsTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){a.NoiseTextureAtlas=class extends h{constructor(p){super(p);this._needsRender=!0;this._passParameters=new n.NoiseTextureAtlasPassParameters;this._fbo=new q.FramebufferObject(p.context.renderContext.rctx,new v.TextureDescriptor(u.atlasSize));this._vao=w.createQuadVAO(p.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&
this._needsRender&&(this._texture=this._render(l.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(l.NoiseTextureRenderMode.Full));return this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(p){if(this._passParameters.weatherTile[0]!==p[0]||this._passParameters.weatherTile[1]!==p[1])e.copy(this._passParameters.weatherTile,p),this._setDirty()}destroy(){this._fullTechniqueCached=c.releaseMaybe(this._fullTechniqueCached);
this._weatherMapTechniqueCached=c.releaseMaybe(this._weatherMapTechniqueCached);this._fbo=c.disposeMaybe(this._fbo);this._vao=c.disposeMaybe(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const p=new l.NoiseTextureAtlasTechniqueConfiguration;p.mode=l.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(x.NoiseTextureAtlasTechnique,p)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const p=
new l.NoiseTextureAtlasTechniqueConfiguration;p.mode=l.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(x.NoiseTextureAtlasTechnique,p)}return this._weatherMapTechniqueCached}_render(p){if(null==this._vao||null==this._fbo)return null;var t=p===l.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;p=this.context.renderContext.rctx;const r=p.getViewport();p.setViewport(0,0,u.atlasSize,u.atlasSize);p.bindFramebuffer(this._fbo);
t=p.bindTechnique(t,null,this._passParameters);p.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao);p.gl.drawArrays(p.gl.TRIANGLE_STRIP,0,4);p.setViewport(r.x,r.y,r.width,r.height);this._needsRender=!1;return this._fbo.colorTexture}};b.__decorate([k.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);b.__decorate([k.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=b.__decorate([g.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,h,c,k,m,d,f){function g(l){const u=new f.ShaderBuilder;u.include(k.ScreenSpacePass,!1);u.fragment.code.add(d.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);l.mode===h.NoiseTextureRenderMode.Full&&u.fragment.code.add(d.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${d.glsl.float(c.tileRows)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${d.glsl.float(8)});

      float worley0 = worley(p, ${d.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${d.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${d.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${d.glsl.float(2)});
      float worley1 = worley(p, ${d.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${d.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${d.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);u.fragment.uniforms.add(new m.Float2PassUniform("weatherTile",x=>x.weatherTile));u.fragment.code.add(d.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${d.glsl.float(c.weatherTileSize)});

      // Get global coordinates of p
      p += weatherTile * ${d.glsl.float(c.weatherTileSize)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${d.glsl.float(c.weatherMapSize)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);u.fragment.code.add(d.glsl`void main() {`);l.mode===h.NoiseTextureRenderMode.Full&&u.fragment.code.add(d.glsl`
        float padWidth = 1.0;
        float paddedSize = ${d.glsl.float(c.tileSize)} + 2.0 * padWidth;
        float tileCount = ${d.glsl.float(c.tileRows)} * ${d.glsl.float(c.tileRows)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${d.glsl.float(c.tileSize)};
          }

          if (startPadY) {
            pixel.y += ${d.glsl.float(c.tileSize)};
          }

          if (endPadX) {
            pixel.x -= ${d.glsl.float(c.tileSize)};
          }

          if (endPadY) {
            pixel.y -= ${d.glsl.float(c.tileSize)};
          }

          uv = vec2(pixel.xy / ${d.glsl.float(c.tileSize)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${d.glsl.float(c.tileSize)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${d.glsl.float(c.tileRows)} * ${d.glsl.float(c.tileRows)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${d.glsl.float(c.tileRows)} * ${d.glsl.float(c.tileRows)});
        p = p_;
        p.z /= (${d.glsl.float(c.tileRows)} * ${d.glsl.float(c.tileRows)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);u.fragment.code.add(d.glsl`
      vec2 mapUV = ${d.glsl.float(c.weatherTileSize)} * (gl_FragCoord.xy / ${d.glsl.float(c.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${l.mode===h.NoiseTextureRenderMode.Full?d.glsl`fragColor.ba = vec2(0.0, map);`:d.glsl`fragColor = vec4(map);`};
    }
  `);return u}class e extends d.NoParameters{constructor(){super(...arguments);this.weatherTile=b.fromValues(0,0)}}const n=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:e,build:g},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=n;a.NoiseTextureAtlasPassParameters=e;a.build=g})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,h){a.NoiseTextureRenderMode=void 0;(function(k){k[k.Full=0]="Full";k[k.WeatherMap=1]="WeatherMap";k[k.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.mode=a.NoiseTextureRenderMode.Full}}b.__decorate([h.parameter({count:a.NoiseTextureRenderMode.COUNT})],c.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends m.ShaderTechnique{initializeProgram(l){return new f.Program(l.rctx,
n.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){return e.makePipelineState({blending:this.configuration.mode===c.NoiseTextureRenderMode.Full?e.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ZERO):e.separateBlendingParams(g.BlendFactor.ZERO,g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ZERO),depthTest:{func:g.CompareFunction.ALWAYS},colorWrite:e.defaultColorWriteParams})}}n.shader=new k.ReloadableShaderModule(h.NoiseTextureAtlas,()=>new Promise((l,u)=>a(["./NoiseTextureAtlas.glsl"],
l,u)));b.NoiseTextureAtlasTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),function(a,b,h,c,k,m,d,f,g,e){function n(w){return null!=w&&"type"in w&&w.type===f.GLObjectType.Texture}function l(w,q){const v=Math.max(w.width,w.height);return v>q?(h.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${w.width}x${w.height} to device limit ${q}`),
q/=v,w.width=Math.round(w.width*q),w.height=Math.round(w.height*q),!1):!0}function u(w){return w.descriptor.target===d.TextureType.TEXTURE_CUBE_MAP?d.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:d.TextureType.TEXTURE_2D}class x{constructor(w,q,v=null){this._context=w;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;w.instanceCounter.increment(d.ResourceType.FramebufferObject,this);w=n(q)?q:new e.Texture(this._context,q);this._colorAttachments.set(d.ColorAttachment.COLOR_ATTACHMENT0,
w);this._validateTextureDescriptor(w.descriptor);this._validateColorAttachmentPoint(d.ColorAttachment.COLOR_ATTACHMENT0);null!=v&&(n(v)||null!=v&&"pixelFormat"in v?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=n(v)?v:new e.Texture(this._context,v),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=v=null!=v&&"type"in v&&v.type===
f.GLObjectType.RenderBuffer?v:new g.Renderbuffer(this._context,v),this._validateRenderBufferDescriptor(v.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var w=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((q,v)=>this.detachColorTexture(v)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(w);
this._context.instanceCounter.decrement(d.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??
0}get usedMemory(){return[...this._colorAttachments].reduce((w,[,q])=>w+q.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(w){return(w=this._colorAttachments.get(w))&&n(w)?w:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(w,q=d.ColorAttachment.COLOR_ATTACHMENT0){w&&(this._validateColorAttachmentPoint(q),this._validateTextureDescriptor(w.descriptor),this.detachColorTexture(q)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,
q)),this._colorAttachments.set(q,w))}detachColorTexture(w=d.ColorAttachment.COLOR_ATTACHMENT0){const q=this._colorAttachments.get(w);if(q){if(this._initialized){const v=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,w);this._context.bindFramebuffer(v)}this._colorAttachments.delete(w);return q}}setColorTextureTarget(w,q=d.ColorAttachment.COLOR_ATTACHMENT0){const v=this._colorAttachments.get(q);v&&this._framebufferTexture2D(v.glName,q,w)}attachDepthStencil(w){if(w)switch(w.type){case f.GLObjectType.Texture:return this._attachDepthStencilTexture(w);
case f.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(w)}}_attachDepthStencilTexture(w){if(null!=w){var q=w.descriptor;q.pixelFormat!==d.PixelFormat.DEPTH_STENCIL&&q.pixelFormat!==d.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");q.dataType!==d.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
this._validateTextureDescriptor(q);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,d.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=w}}detachDepthStencilTexture(){const w=this._depthStencilTexture;w&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,d.DepthStencilAttachment));this._depthStencilTexture=null;return w}_attachDepthStencilBuffer(w){if(null!=
w){var q=w.descriptor;this._validateRenderBufferDescriptor(q);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const v=this._context.gl;q=this._getGLAttachmentPoint(q);v.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,q,v.RENDERBUFFER,w.glName)}this._depthStencilBuffer=w}}detachDepthStencilBuffer(){const w=this._depthStencilBuffer;if(w&&this._initialized){this._context.bindFramebuffer(this);const q=this._context.gl,v=this._getGLAttachmentPoint(w.descriptor);
q.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,v,q.RENDERBUFFER,null)}this._depthStencilBuffer=null;return w}copyToTexture(w,q,v,p,t,r,y){(0>w||0>q||0>t||0>r)&&console.error("Offsets cannot be negative!");(0>=v||0>=p)&&console.error("Copy width and height must be greater than zero!");var D=y.descriptor;y.descriptor.target!==d.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==D?.width||null==D?.height||w+v>this.width||q+p>this.height||t+v>D.width||r+p>D.height)&&
console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");D=this._context;y=D.bindTexture(y,e.Texture.TEXTURE_UNIT_FOR_UPDATES);D.setActiveTexture(e.Texture.TEXTURE_UNIT_FOR_UPDATES);D.bindFramebuffer(this);D.gl.copyTexSubImage2D(d.TextureType.TEXTURE_2D,0,t,r,w,q,v,p);D.bindTexture(y,e.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(w,q,v,p,t,r,y){(0>=v||0>=p)&&console.error("Copy width and height must be greater than zero!");y||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(w,q,v,p,t,r,y)}async readPixelsAsync(w,q,v,p,t,r,y){const {gl:D}=this._context,E=k.BufferObject.createPixelPack(this._context,d.Usage.STREAM_READ,y.byteLength);this._context.bindBuffer(E);this._context.bindFramebuffer(this);D.readPixels(w,q,v,p,t,r,0);this._context.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);await E.getSubDataAsync(y);E.dispose()}resize(w,q){if(this.width!==w||this.height!==q){var v={width:w,height:q};l(v,this._context.parameters.maxTextureSize);
this._colorAttachments.forEach(p=>p.resize(v.width,v.height));this._depthStencilTexture?.resize(v.width,v.height);this._initialized&&(l(v,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(v.width,v.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(w=d.FramebufferTarget.FRAMEBUFFER){const q=this._context.gl;if(this._initialized)q.bindFramebuffer(w,this.glName);else{this._glName&&q.deleteFramebuffer(this._glName);
var v=q.createFramebuffer();q.bindFramebuffer(w,v);this._colorAttachments.forEach((p,t)=>this._framebufferTexture2D(p.glName,t,u(p),w));if(this._depthStencilBuffer){const p=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);q.framebufferRenderbuffer(w,p,q.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,q.DEPTH_STENCIL_ATTACHMENT,u(this._depthStencilTexture),w);m.webglDebugEnabled()&&q.checkFramebufferStatus(w)!==
q.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=v;this._initialized=!0}}_framebufferTexture2D(w,q=d.ColorAttachment.COLOR_ATTACHMENT0,v=d.TextureType.TEXTURE_2D,p=d.FramebufferTarget.FRAMEBUFFER,t=0){this._context.gl.framebufferTexture2D(p,q,v,w,t)}_disposeDepthStencilAttachments(){const w=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const q=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);w.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,
q,w.RENDERBUFFER,null)}this._depthStencilBuffer=c.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=c.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(w){w.target!==d.TextureType.TEXTURE_2D&&w.target!==d.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");l(w,this._context.parameters.maxTextureSize);
this._validateBufferDimensions(w)}_validateRenderBufferDescriptor(w){l(w,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(w)}_validateBufferDimensions(w){0>=w.width&&(w.width=this.width);0>=w.height&&(w.height=this.height);0<this.width&&0<this.height&&(this.width!==w.width||this.height!==w.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(w){switch(w.internalFormat){case d.RenderbufferFormat.DEPTH_COMPONENT16:case d.RenderbufferFormat.DEPTH_COMPONENT24:case d.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;
case d.RenderbufferFormat.DEPTH24_STENCIL8:case d.RenderbufferFormat.DEPTH32F_STENCIL8:case d.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case d.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(w){if(-1===x._MAX_COLOR_ATTACHMENTS){const q=this._context.capabilities.drawBuffers;x._MAX_COLOR_ATTACHMENTS=q?this._context.gl.getParameter(q.MAX_COLOR_ATTACHMENTS):1}w-=d.ColorAttachment.COLOR_ATTACHMENT0;w+1>
x._MAX_COLOR_ATTACHMENTS&&h.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${w+1}. Implementation supports up to ${x._MAX_COLOR_ATTACHMENTS} color attachments`)}}x._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=x;a.ensureAttachmentMaxSize=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(a,
b,h,c){class k{constructor(m,d){this._context=m;this._descriptor=d;this.type=h.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(b.ResourceType.Renderbuffer,this);m=this._context.gl;this.glName=m.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,height:g,internalFormat:e,multisampled:n}=d;n?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,e,f,g):m.renderbufferStorage(m.RENDERBUFFER,e,f,g)}get descriptor(){return this._descriptor}get samples(){const m=
this._descriptor.samples,d=this._context.parameters.maxSamples;return m?Math.min(m,d):d}get usedMemory(){return c.estimateMemory(this._descriptor)}resize(m,d){const f=this._descriptor;if(f.width!==m||f.height!==d)f.width=m,f.height=d,m=this._context.gl,this._context.bindRenderbuffer(this),f.multisampled?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):m.renderbufferStorage(m.RENDERBUFFER,f.internalFormat,f.width,f.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),
this._context.instanceCounter.decrement(b.ResourceType.Renderbuffer,this),this._context=null)}}a.Renderbuffer=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(a,b){class h{constructor(c,k,m=k){this.internalFormat=c;this.width=k;this.height=m;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=h;a.estimateMemory=function(c){return 0>=c.width||0>=c.height||null==c.internalFormat?0:c.width*
c.height*b.getBytesPerElementFormat(c.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../environment/CloudsParameters ../core/shaderLibrary/hud/HUDRenderStyle ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ./basicInterfaces ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u{constructor(w,q){this.shadowMap=w;this.slicePlane=q;this.slot=e.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=n.TransparencyPassType.NONE;this.alignPixelEnabled=!1;this.decorations=f.Decorations.ON;this.overlayStretch=1;this._camera=new g.Camera;this._inverseViewport=h.create();this.oldLighting=new l.SceneLighting;this.newLighting=new l.SceneLighting;this._fadedLighting=new l.SceneLighting;this._lighting=
this.newLighting;this.ssr=new x;this.multipassEnabled=!1;this.multipassTerrain=new d.MultipassTerrainUniforms;this.multipassGeometry=new m.MultipassGeometryUniforms;this.hudRenderStyle=k.HUDRenderStyle.Occluded;this.cloudsFade=new c.CloudsParameters}get camera(){return this._camera}set camera(w){this._camera=w;this._inverseViewport[0]=1/w.fullViewport[2];this._inverseViewport[1]=1/w.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===
this._fadedLighting}fadeLighting(w){const {oldLighting:q,newLighting:v}=this;1<=w?this._lighting=v:(this._fadedLighting.lerpLighting(q,v,w),this._lighting=this._fadedLighting)}}class x{constructor(){this.fadeFactor=1;this.reprojectionMatrix=b.create()}}a.BindParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],function(a){a.HUDRenderStyle=void 0;var b=a.HUDRenderStyle||(a.HUDRenderStyle=
{});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,h,c,k){class m{}a.MultipassGeometryUniforms=m;a.multipassGeometryTest=
function(d){d.include(b.ReadLinearDepth);d.uniforms.add(new k.Texture2DPassUniform("geometryDepthTexture",(f,g)=>g.multipassGeometry.linearDepth?.getTexture()),new h.Float2PassUniform("nearFar",(f,g)=>g.camera.nearFar));d.code.add(c.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,h,c,k){class m{constructor(){this.cullAboveGround=!1}}a.MultipassTerrainUniforms=m;a.multipassTerrainTest=function(d,f){if(f.multipassEnabled){d.fragment.include(b.ReadLinearDepth);
d.fragment.uniforms.add(new k.Texture2DPassUniform("terrainDepthTexture",(e,n)=>n.multipassTerrain.linearDepth?.getTexture()),new h.Float2PassUniform("nearFar",(e,n)=>n.camera.nearFar));var g=f.occlusionPass;d.fragment.code.add(c.glsl`
   ${g?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${g?c.glsl`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:c.glsl`
          if(fragmentDepth ${f.cullAboveGround?"\x3e":"\x3c\x3d"} linearDepth){
            discard;
          }`}
    }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){var A;a.Camera=A=class extends h{constructor(C){super(C);this._ray=r.create();this._viewport=p.fromValues(0,0,1,1);this._padding=p.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=x.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=l.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=l.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=l.create();this._frustumDirty=!0;this._frustum=
t.create();this._fullViewport=p.create();this._pixelRatio=1;this.column=this.row=0;this._columns=this._rows=1;this._center=q.create();this._up=q.create();this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(C){this._pixelRatio=0<C?C:1}get rows(){return this._rows}set rows(C){this._rows=Math.max(1,C)}get columns(){return this._columns}set columns(C){this._columns=Math.max(1,C)}get eye(){return this._ray.origin}set eye(C){this._compareAndSetView(C,this._ray.origin)}get center(){return this._center}set center(C){this._compareAndSetView(C,
this._center,"_center")}get ray(){w.subtract(this._ray.direction,this.center,this.eye);return this._ray}get up(){return this._up}set up(C){this._compareAndSetView(C,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(C){n.copy(this._viewMatrix,C);this.notifyChange("_viewMatrix");this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return w.set(q.create(),-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){this._ensureViewClean();return w.set(q.create(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){this._ensureViewClean();return w.set(q.create(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(C){this._nearFar[0]!==C&&(this._nearFar[0]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(C){this._nearFar[1]!==
C&&(this._nearFar[1]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(C){this.x=C[0];this.y=C[1];this.width=C[2];this.height=C[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const C=v.scale(p.create(),this._viewport,1/this.pixelRatio),z=this._get("screenViewport");return z&&v.equals(C,z)?z:C}get screenPadding(){if(1===this.pixelRatio)return this._padding;const C=v.scale(p.create(),this._padding,
1/this.pixelRatio),z=this._get("screenPadding");return z&&v.equals(C,z)?z:C}get x(){return this._viewport[0]}set x(C){C+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==C&&(this._viewport[0]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(C){C+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==C&&(this._viewport[1]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(C){this._viewport[2]!==
C&&(this._viewport[2]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(C){this._viewport[3]!==C&&(this._viewport[3]=C,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]}set fullWidth(C){this.width=C-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+
this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]}set fullHeight(C){this.height=C-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(C){v.exactEquals(this._padding,
C)||(this._viewport[0]+=C[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=C[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=C[a.PaddingSide.RIGHT]+C[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=C[a.PaddingSide.TOP]+C[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),v.copy(this._padding,C),this._frustumDirty=this._viewProjectionDirty=!0,
this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(n.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){var C=this.width,z=this.height,J=this.near*Math.tan(this.fovY/2)*2,K=J*this._aspect,I=J/this.rows,M=K/this.columns;K=-K/2+this.column*M;M=K+M;J=-J/2+this.row*I;I=J+I;C=n.frustum(l.create(),K*(1+2*this._padding[a.PaddingSide.LEFT]/
C),M*(1+2*this._padding[a.PaddingSide.RIGHT]/C),J*(1+2*this._padding[a.PaddingSide.BOTTOM]/z),I*(1+2*this._padding[a.PaddingSide.TOP]/z),this.near,this.far);return(z=this._get("projectionMatrix"))&&n.equals(z,C)?z:C}get inverseProjectionMatrix(){return n.invert(l.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||l.create()}get fov(){return this._fov}set fov(C){this._fov=C;this._frustumDirty=this._viewProjectionDirty=!0}get fovX(){return E.fovd2fovx(this._fov,this.width,this.height)}set fovX(C){this._fov=
E.fovx2fovd(C,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return E.fovd2fovy(this._fov,this.width,this.height)}set fovY(C){this._fov=E.fovy2fovd(C,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return w.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)n.invert(this._viewInverseTransposeMatrix,
this.viewMatrix),n.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(C){return 2*this.near*this.far/(this.far+this.near-(2*C-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&0<=this.relativeElevation}copyFrom(C){w.copy(this._ray.origin,
C.eye);this.center=C.center;this.up=C.up;v.copy(this._viewport,C.viewport);this.notifyChange("_viewport");v.copy(this._padding,C.padding);this.notifyChange("_padding");u.copy(this._nearFar,C.nearFar);this.notifyChange("_nearFar");this._fov=C.fov;this.row=C.row;this.column=C.column;this.rows=C.rows;this.columns=C.columns;this.relativeElevation=C.relativeElevation;this._viewDirty=C._viewDirty;this._viewDirty||(n.copy(this._viewMatrix,C.viewMatrix),this.notifyChange("_viewMatrix"));this._viewProjectionDirty=
!0;this._frustumDirty=C._frustumDirty;this._frustumDirty||(t.copy(this._frustum,C.frustum),this._frustumDirty=!1);C._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n.copy(this._viewInverseTransposeMatrix,C.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);v.copy(this._fullViewport,C.fullViewport);this.pixelRatio=C.pixelRatio;return this}copyViewFrom(C){this.eye=C.eye;this.center=C.center;this.up=C.up}clone(){return(new A).copyFrom(this)}equals(C){return w.exactEquals(this.eye,
C.eye)&&w.exactEquals(this.center,C.center)&&w.exactEquals(this.up,C.up)&&v.exactEquals(this._viewport,C.viewport)&&v.exactEquals(this._padding,C.padding)&&u.exactEquals(this.nearFar,C.nearFar)&&this._fov===C.fov&&this.pixelRatio===C.pixelRatio&&this.relativeElevation===C.relativeElevation&&this.row===C.row&&this.column===C.column&&this.rows===C.rows&&this.columns===C.columns}almostEquals(C){var z=Math.max(1,1/this.pixelRatio,1/C.pixelRatio);if(.001<=Math.abs(C.fov-this._fov)||v.squaredDistance(C.screenPadding,
this.screenPadding)>=z||v.squaredDistance(this.screenViewport,C.screenViewport)>=z||this.row!==C.row||this.column!==C.column||this.rows!==C.rows||this.columns!==C.columns)return!1;w.sub(G,C.eye,C.center);w.sub(H,this.eye,this.center);z=w.dot(G,H);const J=w.sqrLen(G),K=w.sqrLen(H);return z*z>=(1-1E-10)*J*K&&w.sqrDist(C.eye,this.eye)<2.5E-7*Math.max(J,K)}computeRenderPixelSizeAt(C){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(C))}computeRenderPixelSizeAtDist(C){return C*this.perRenderPixelRatio}computeScreenPixelSizeAt(C){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(C))}_viewDirectionDistance(C){return Math.abs(y.projectPointSignedLength(this.viewForward,
w.subtract(G,C,this.eye)))}computeScreenPixelSizeAtDist(C){return C*this.perScreenPixelRatio}computeDistanceFromRadius(C,z){return C/Math.tan(Math.min(this.fovX,this.fovY)/(2*(z||1)))}getScreenCenter(C=m.createScreenPointArray()){C[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;C[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return C}getRenderCenter(C,z=.5,J=.5){C[0]=this.padding[a.PaddingSide.LEFT]+this.width*z;C[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*
J;C[2]=.5;return C}setGLViewport(C){const z=this.viewport,J=this.padding;C.setViewport(z[0]-J[3],z[1]-J[2],z[2]+J[1]+J[3],z[3]+J[0]+J[2])}applyProjection(C,z){C!==B&&w.copy(B,C);B[3]=1;v.transformMat4(B,B,this.projectionMatrix);C=Math.abs(B[3]);w.scale(B,B,1/C);const J=this.fullViewport;z[0]=k.lerp(0,J[0]+J[2],.5+.5*B[0]);z[1]=k.lerp(0,J[1]+J[3],.5+.5*B[1]);z[2]=.5*(B[2]+1);z[3]=C}unapplyProjection(C,z){const J=this.fullViewport;B[0]=(C[0]/(J[0]+J[2])*2-1)*C[3];B[1]=(C[1]/(J[1]+J[3])*2-1)*C[3];B[2]=
(2*C[2]-1)*C[3];B[3]=C[3];null!=this.inverseProjectionMatrix&&(v.transformMat4(B,B,this.inverseProjectionMatrix),z[0]=B[0],z[1]=B[1],z[2]=B[2])}projectToScreen(C,z){this.projectToRenderScreen(C,L);this.renderToScreen(L,z);return z}projectToRenderScreen(C,z){B[0]=C[0];B[1]=C[1];B[2]=C[2];B[3]=1;v.transformMat4(B,B,this.viewProjectionMatrix);if(0===B[3])return null;C=B;w.scale(C,C,1/Math.abs(B[3]));var J=this.fullViewport;const K=k.lerp(0,J[0]+J[2],.5+.5*C[0]);J=k.lerp(0,J[1]+J[3],.5+.5*C[1]);"x"in
z?(z.x=K,z.y=J):(z[0]=K,z[1]=J,2<z.length&&(z[2]=.5*(C[2]+1)));return z}unprojectFromScreen(C,z){return this.unprojectFromRenderScreen(this.screenToRender(C,L),z)}unprojectFromRenderScreen(C,z){n.multiply(F,this.projectionMatrix,this.viewMatrix);if(!n.invert(F,F))return null;const J=this.fullViewport;B[0]=2*(C[0]-J[0])/J[2]-1;B[1]=2*(C[1]-J[1])/J[3]-1;B[2]=2*C[2]-1;B[3]=1;v.transformMat4(B,B,F);if(0===B[3])return null;z[0]=B[0]/B[3];z[1]=B[1]/B[3];z[2]=B[2]/B[3];return z}constrainWindowSize(C,z,J,
K){C*=this.pixelRatio;z*=this.pixelRatio;return[Math.round(Math.max(C-J/2,0)),Math.round(Math.max(this.fullHeight-z-K/2,0)),Math.round(J- -Math.min(C-J/2,0)- -Math.min(this.fullWidth-C-J/2,0)),Math.round(K- -Math.min(this.fullHeight-z-K/2,0)- -Math.min(z-K/2,0))]}computeUp(C){C===D.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(C,z){const J=this.fullHeight-C[1]*this.pixelRatio;z[0]=C[0]*this.pixelRatio;z[1]=J;return z}renderToScreen(C,z){const J=(this.fullHeight-
C[1])/this.pixelRatio;z[0]=C[0]/this.pixelRatio;z[1]=J}_computeUpGlobal(){w.subtract(G,this.center,this.eye);const C=w.length(this.center);1>C?(w.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(w.dot(G,this.center))>.9999*w.length(G)*C||(w.cross(this._up,G,this.center),w.cross(this._up,this._up,G),w.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){w.direction(G,this.eye,this.center);.9999>=Math.abs(G[2])&&(w.scale(G,G,G[2]),
w.set(this._up,-G[0],-G[1],1-G[2]),w.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(C,z,J=""){"number"===typeof C[0]&&isFinite(C[0])&&"number"===typeof C[1]&&isFinite(C[1])&&"number"===typeof C[2]&&isFinite(C[2])?w.exactEquals(C,z)||(w.copy(z,C),this._markViewDirty(),J.length&&this.notifyChange(J)):c.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=
this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(t.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(n.lookAt(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};b.__decorate([d.property()],a.Camera.prototype,"_viewport",void 0);b.__decorate([d.property()],a.Camera.prototype,"_padding",void 0);b.__decorate([d.property()],
a.Camera.prototype,"_fov",void 0);b.__decorate([d.property()],a.Camera.prototype,"_nearFar",void 0);b.__decorate([d.property()],a.Camera.prototype,"_viewDirty",void 0);b.__decorate([d.property()],a.Camera.prototype,"_viewMatrix",void 0);b.__decorate([d.property()],a.Camera.prototype,"_pixelRatio",void 0);b.__decorate([d.property()],a.Camera.prototype,"pixelRatio",null);b.__decorate([d.property()],a.Camera.prototype,"row",void 0);b.__decorate([d.property()],a.Camera.prototype,"column",void 0);b.__decorate([d.property()],
a.Camera.prototype,"_rows",void 0);b.__decorate([d.property()],a.Camera.prototype,"rows",null);b.__decorate([d.property()],a.Camera.prototype,"_columns",void 0);b.__decorate([d.property()],a.Camera.prototype,"columns",null);b.__decorate([d.property()],a.Camera.prototype,"eye",null);b.__decorate([d.property()],a.Camera.prototype,"center",null);b.__decorate([d.property()],a.Camera.prototype,"_center",void 0);b.__decorate([d.property()],a.Camera.prototype,"up",null);b.__decorate([d.property()],a.Camera.prototype,
"_up",void 0);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"viewForward",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"viewUp",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"viewRight",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"nearFar",null);b.__decorate([d.property()],a.Camera.prototype,"near",null);b.__decorate([d.property()],a.Camera.prototype,"far",null);b.__decorate([d.property()],a.Camera.prototype,"viewport",null);
b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"screenViewport",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"screenPadding",null);b.__decorate([d.property()],a.Camera.prototype,"x",null);b.__decorate([d.property()],a.Camera.prototype,"y",null);b.__decorate([d.property()],a.Camera.prototype,"width",null);b.__decorate([d.property()],a.Camera.prototype,"height",null);b.__decorate([d.property()],a.Camera.prototype,"fullWidth",null);b.__decorate([d.property()],a.Camera.prototype,
"fullHeight",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"_aspect",null);b.__decorate([d.property()],a.Camera.prototype,"padding",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"projectionMatrix",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"inverseProjectionMatrix",null);b.__decorate([d.property()],a.Camera.prototype,"fov",null);b.__decorate([d.property()],a.Camera.prototype,"fovX",null);b.__decorate([d.property()],a.Camera.prototype,
"fovY",null);a.Camera=A=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.Camera")],a.Camera);const B=p.create(),F=l.create(),G=q.create(),H=q.create(),L=m.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(C){C[C.TOP=0]="TOP";C[C.RIGHT=1]="RIGHT";C[C.BOTTOM=2]="BOTTOM";C[C.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ../../core/libs/gl-matrix-2/factories/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(){return[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]}function l(p,t){g.fromPoints(t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.NEAR_BOTTOM_LEFT],t[a.PointIndex.NEAR_TOP_LEFT],p[a.PlaneIndex.LEFT]);g.fromPoints(t[a.PointIndex.NEAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_TOP_RIGHT],p[a.PlaneIndex.RIGHT]);g.fromPoints(t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.NEAR_BOTTOM_RIGHT],
p[a.PlaneIndex.BOTTOM]);g.fromPoints(t[a.PointIndex.NEAR_TOP_LEFT],t[a.PointIndex.NEAR_TOP_RIGHT],t[a.PointIndex.FAR_TOP_RIGHT],p[a.PlaneIndex.TOP]);g.fromPoints(t[a.PointIndex.NEAR_BOTTOM_LEFT],t[a.PointIndex.NEAR_BOTTOM_RIGHT],t[a.PointIndex.NEAR_TOP_RIGHT],p[a.PlaneIndex.NEAR]);g.fromPoints(t[a.PointIndex.FAR_BOTTOM_RIGHT],t[a.PointIndex.FAR_BOTTOM_LEFT],t[a.PointIndex.FAR_TOP_LEFT],p[a.PlaneIndex.FAR])}function u(p,t){for(let r=0;6>r;r++)if(!g.clip(p[r],t))return!1;return!0}a.PlaneIndex=void 0;
(function(p){p[p.LEFT=0]="LEFT";p[p.RIGHT=1]="RIGHT";p[p.BOTTOM=2]="BOTTOM";p[p.TOP=3]="TOP";p[p.NEAR=4]="NEAR";p[p.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(p){p[p.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";p[p.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";p[p.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";p[p.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";p[p.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";p[p.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";p[p.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";p[p.FAR_TOP_LEFT=7]=
"FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const x={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,
a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]},w=[d.fromValues(-1,-1,-1,1),d.fromValues(1,-1,-1,1),d.fromValues(1,1,-1,1),d.fromValues(-1,1,-1,1),d.fromValues(-1,-1,1,1),d.fromValues(1,-1,1,1),d.fromValues(1,1,1,1),d.fromValues(-1,1,1,1)],q=new b.ObjectStack(f.create),v=n();a.computePlanes=
l;a.copy=function(p,t){for(let r=0;6>r;r++)g.copy(p[r],t[r]);return p};a.create=function(p){return p?[g.create(p[0]),g.create(p[1]),g.create(p[2]),g.create(p[3]),g.create(p[4]),g.create(p[5])]:[g.create(),g.create(),g.create(),g.create(),g.create(),g.create()]};a.createPoints=n;a.fromMatrix=function(p,t,r,y=v){p=h.multiply(e.sm4d.get(),t,p);h.invert(p,p);for(t=0;8>t;++t){const D=m.transformMat4(e.sv4d.get(),w[t],p);c.set(y[t],D[0]/D[3],D[1]/D[3],D[2]/D[3])}l(r,y)};a.intersectClipRay=function(p,t){for(let r=
0;6>r;r++)if(!g.clipInfinite(p[r],t))return!1;return!0};a.intersectsLineSegment=function(p,t,r){return u(p,f.fromLineSegmentAndDirection(t,r,q.get()))};a.intersectsPoint=function(p,t){for(let r=0;6>r;r++)if(0<g.signedDistance(p[r],t))return!1;return!0};a.intersectsRay=function(p,t){return u(p,f.fromRay(t,q.get()))};a.intersectsSphere=function(p,t){for(let r=0;6>r;r++){const y=p[r];if(y[0]*t[0]+y[1]*t[1]+y[2]*t[2]+y[3]>=t[3])return!1}return!0};a.numPlanes=6;a.numPoints=8;a.planePointIndices=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","./ray"],function(a,b,h,c){function k(g){return g?{ray:c.create(g.ray),c0:g.c0,c1:g.c1}:{ray:c.create(),c0:0,c1:Number.MAX_VALUE}}function m(g,e,n,l=k()){c.copy(g,l.ray);l.c0=e;l.c1=n;return l}function d(g,e,n){return h.add(n,g.ray.origin,h.scale(n,g.ray.direction,e))}const f=new b.ObjectStack(()=>k());a.copy=function(g,e=k()){return m(g.ray,g.c0,g.c1,
e)};a.create=k;a.fromLineSegmentAndDirection=function(g,e,n=k()){const l=h.length(g.vector);c.fromValues(g.origin,e,n.ray);n.c0=0;n.c1=l;return n};a.fromRay=function(g,e=k()){c.copy(g,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};a.fromValues=m;a.getAt=d;a.getEnd=function(g,e){return d(g,g.c1,e)};a.getStart=function(g,e){return d(g,g.c0,e)};a.wrap=function(g,e,n){const l=f.get();l.ray=g;l.c0=e;l.c1=n;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],
function(a){a.fovd2fovx=function(b,h,c){return 2*Math.atan(h*Math.tan(.5*b)/Math.sqrt(h*h+c*c))};a.fovd2fovy=function(b,h,c){return 2*Math.atan(c*Math.tan(.5*b)/Math.sqrt(h*h+c*c))};a.fovx2fovd=function(b,h,c){return 2*Math.atan(Math.sqrt(h*h+c*c)*Math.tan(.5*b)/h)};a.fovy2fovd=function(b,h,c){return 2*Math.atan(Math.sqrt(h*h+c*c)*Math.tan(.5*b)/c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=
void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH";b[b.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH";b[b.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN";
b[b.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS";b[b.ANTIALIASING=12]="ANTIALIASING";b[b.COMPOSITE=13]="COMPOSITE";b[b.BLIT=14]="BLIT";b[b.SSAO=15]="SSAO";b[b.HIGHLIGHT=16]="HIGHLIGHT";b[b.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT";b[b.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE";b[b.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=20]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=
21]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=22]="HUD_MATERIAL";b[b.LABEL_MATERIAL=23]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=24]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=26]="DRAPED_MATERIAL";b[b.DRAPED_WATER=27]="DRAPED_WATER";b[b.VOXEL=28]="VOXEL";b[b.MAX_SLOTS=29]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=
void 0;var b=a.TransparencyPassType||(a.TransparencyPassType={});b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,h,c,k,m){class d{constructor(){this.color=
c.create();this.intensity=1}}class f{constructor(){this.direction=c.create();this.ambient=new d;this.diffuse=new d}}class g{constructor(){this._shOrder=2;this._legacy=new f;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new k.SphericalHarmonicsAmbientLight;this._mainLight=new k.MainLight(c.create(),c.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(n){m.combineLights(n,this._shOrder,this._mainLight,
this._sphericalHarmonics);h.copy(this._legacy.direction,this._mainLight.direction);n=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*n;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*n;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*n;h.scale(this._legacy.diffuse.color,this._mainLight.intensity,n);h.copy(e,this._legacy.diffuse.color);h.scale(e,e,.4*this.globalFactor);h.add(this._legacy.ambient.color,this._legacy.ambient.color,e)}copyFrom(n){this._sphericalHarmonics.r=
Array.from(n.sh.r);this._sphericalHarmonics.g=Array.from(n.sh.g);this._sphericalHarmonics.b=Array.from(n.sh.b);h.copy(this._mainLight.direction,n.mainLight.direction);h.copy(this._mainLight.intensity,n.mainLight.intensity);this._mainLight.castShadows=n.mainLight.castShadows;this._mainLight.specularStrength=n.mainLight.specularStrength;this._mainLight.environmentStrength=n.mainLight.environmentStrength;this.globalFactor=n.globalFactor;this.noonFactor=n.noonFactor}lerpLighting(n,l,u){h.lerp(this._mainLight.intensity,
n.mainLight.intensity,l.mainLight.intensity,u);this._mainLight.environmentStrength=b.lerp(n.mainLight.environmentStrength,l.mainLight.environmentStrength,u);this._mainLight.specularStrength=b.lerp(n.mainLight.specularStrength,l.mainLight.specularStrength,u);h.copy(this._mainLight.direction,l.mainLight.direction);this._mainLight.castShadows=l.mainLight.castShadows;this.globalFactor=b.lerp(n.globalFactor,l.globalFactor,u);this.noonFactor=b.lerp(n.noonFactor,l.noonFactor,u);if(n.sh.r.length===l.sh.r.length)for(let x=
0;x<l.sh.r.length;x++)this._sphericalHarmonics.r[x]=b.lerp(n.sh.r[x],l.sh.r[x],u),this._sphericalHarmonics.g[x]=b.lerp(n.sh.g[x],l.sh.g[x],u),this._sphericalHarmonics.b[x]=b.lerp(n.sh.b[x],l.sh.b[x],u);else for(n=0;n<l.sh.r.length;n++)this._sphericalHarmonics.r[n]=l.sh.r[n],this._sphericalHarmonics.g[n]=l.sh.g[n],this._sphericalHarmonics.b[n]=l.sh.b[n]}}const e=c.create();a.SceneLighting=g;a.SunLight=f;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class h{constructor(d=b.create()){this.intensity=d}}class c{constructor(d=b.create(),f=b.fromValues(.57735,.57735,.57735)){this.intensity=d;this.direction=f}}class k{constructor(d=b.create(),f=b.fromValues(.57735,.57735,.57735),g=!0,e=1,n=1){this.intensity=d;this.direction=f;this.castShadows=g;this.specularStrength=e;this.environmentStrength=n}}class m{constructor(){this.r=[0];this.g=[0];this.b=[0]}}a.AmbientLight=h;a.FillLight=
c;a.MainLight=k;a.SphericalHarmonicsAmbientLight=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,b,h,c,k,m){function d(r){return(r+1)*(r+1)}function f(r){return b.clamp(Math.floor(Math.sqrt(r)-1),0,2)}function g(r,y,D){const E=r[0],A=r[1];
r=r[2];D=D||[];D.length=d(y);0<=y&&(D[0]=.28209479177);1<=y&&(D[1]=.4886025119*E,D[2]=.4886025119*r,D[3]=.4886025119*A);2<=y&&(D[4]=1.09254843059*E*A,D[5]=1.09254843059*A*r,D[6]=.31539156525*(3*r*r-1),D[7]=1.09254843059*E*r,D[8]=.54627421529*(E*E-A*A));return D}function e(r,y){r=d(r);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=r;for(let D=0;D<r;D++)y.r[D]=y.g[D]=y.b[D]=0;return y}function n(r,y){const D=f(y.r.length);for(const E of r)h.negate(p,E.direction),g(p,D,q),k.elementwiseProduct(q,
t),k.scalarProduct(q,E.intensity[0],v),k.add(y.r,v),k.scalarProduct(q,E.intensity[1],v),k.add(y.g,v),k.scalarProduct(q,E.intensity[2],v),k.add(y.b,v);return y}function l(r,y){g(p,0,q);for(const D of r)y.r[0]+=q[0]*t[0]*D.intensity[0]*4*Math.PI,y.g[0]+=q[0]*t[0]*D.intensity[1]*4*Math.PI,y.b[0]+=q[0]*t[0]*D.intensity[2]*4*Math.PI;return y}const u=[],x=[],w=[],q=[0],v=[0],p=c.create(),t=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(r,y,D,E){e(y,
E);h.set(D.intensity,0,0,0);y=!1;u.length=0;x.length=0;w.length=0;for(const A of r)A instanceof m.MainLight&&!y?(h.copy(D.direction,A.direction),h.copy(D.intensity,A.intensity),D.specularStrength=A.specularStrength,D.environmentStrength=A.environmentStrength,D.castShadows=A.castShadows,y=!0):A instanceof m.MainLight||A instanceof m.FillLight?u.push(A):A instanceof m.AmbientLight?x.push(A):A instanceof m.SphericalHarmonicsAmbientLight&&w.push(A);n(u,E);l(x,E);for(const A of w)k.add(E.r,A.r),k.add(E.g,
A.g),k.add(E.b,A.b)};a.computeCoefficients=g;a.initSHCoefficients=e;a.numberOfCoefficients=d;a.orderFromNumberOfCoefficients=f;a.projectAmbientLights=l;a.projectFillLights=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,h,c){c=c||b;c.length=b.length;for(let k=0;k<b.length;k++)c[k]=b[k]+h[k];return c};a.dotProduct=function(b,h){let c=0;for(let k=0;k<b.length;k++)c+=b[k]*h[k];
return c};a.elementwiseProduct=function(b,h,c){c=c||b;c.length=b.length;for(let k=0;k<b.length;k++)c[k]=b[k]*h[k];return c};a.scalarProduct=function(b,h,c){c=c||b;c.length=b.length;for(let k=0;k<b.length;k++)c[k]=b[k]*h;return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(G){return v.has(G)?v.get(G):"number"===typeof G?G:1}a.TaskPriority=void 0;(function(G){G.RESOURCE_CONTROLLER_IMMEDIATE="immediate";G.RESOURCE_CONTROLLER="schedule";G.SLIDE="slide";G.STREAM_DATA_LOADER="stream loader";G.ELEVATION_QUERY="elevation query";G.TERRAIN_SURFACE="terrain";G.SURFACE_GEOMETRY_UPDATES="surface geometry updates";G.LOD_RENDERER="LoD renderer";G.GRAPHICS_CORE="Graphics3D";G.I3S_CONTROLLER="I3S";G.POINT_CLOUD_LAYER="point cloud";
G.FEATURE_TILE_FETCHER="feature fetcher";G.OVERLAY="overlay";G.STAGE="stage";G.GRAPHICS_DECONFLICTOR="graphics deconflictor";G.FILTER_VISIBILITY="Graphics3D filter visibility";G.SCALE_VISIBILITY="Graphics3D scale visibility";G.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";G.POINT_OF_INTEREST_FREQUENT="POI frequent";G.POINT_OF_INTEREST_INFREQUENT="POI infrequent";G.LABELER="labeler";G.FEATURE_QUERY_ENGINE="feature query";G.FEATURE_TILE_TREE="feature tile tree";G.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";
G.ELEVATION_ALIGNMENT="elevation alignment";G.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";G.TEXT_TEXTURE_ATLAS="text texture atlas";G.TEXTURE_UNLOAD="texture unload";G.LINE_OF_SIGHT_TOOL="line of sight tool";G.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";G.ELEVATION_PROFILE="elevation profile";G.SNAPPING="snapping";G.SHADOW_ACCUMULATOR="shadow accumulator";G.CLOUDS_GENERATOR="clouds generator";G[G.NONE=0]="NONE";G[G.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority=
{}));const v=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,
4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.CLOUDS_GENERATOR,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.ELEVATION_ALIGNMENT_SCENE,
14],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),p=n.Milliseconds(6.5),t=n.Milliseconds(1),r=n.Milliseconds(30),y=n.Milliseconds(1E3/30),D=n.Milliseconds(100);var E;(function(G){class H{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(z=>z.needsUpdate)}constructor(){this._updating=
e.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new m("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new C;this._state=x.RenderState.INTERACTING;this._tasks=new d;this._runQueue=new d;this._load=0;this._idleStateCallbacks=new d;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=g.watch(()=>u.SCHEDULER_LOG_SLOW_TASKS,J=>this._debug=J,g.initial);for(const J of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[J],
new m(a.TaskPriority[J]));const z=this;this._test={FRAME_SAFETY_BUDGET:p,INTERACTING_BUDGET:y,IDLE_BUDGET:D,get availableBudget(){return z._budget.budget},usedBudget:0,getBudget:()=>z._budget,setBudget:J=>z._budget=J,updateTask:J=>this._updateTask(J),getState:J=>this._getState(J),getRuntime:J=>this._getRuntime(J),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(z=>z.remove());this._tasks.clear();
k.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(z){this._updatingChanged();z&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(z,J){J=new L(this,z,J);this._tasks.push(J);this._updatingChanged();this.performanceInfo.tasks.has(z)||this.performanceInfo.tasks.set(z,new m(z));return J}registerIdleStateCallbacks(z,
J){const K={idleBegin:z,idleEnd:J};this._idleStateCallbacks.push(K);this.state===x.RenderState.IDLE&&this._idleUpdatesStartFired&&K.idleBegin();const I=this;return{remove:()=>this._removeIdleStateCallbacks(K),set idleBegin(M){I._idleUpdatesStartFired&&(K.idleEnd(),I._state===x.RenderState.IDLE&&M());K.idleBegin=M},set idleEnd(M){K.idleEnd=M}}}get load(){return this._load}set state(z){this._state!==z&&(this._state=z,this.state!==x.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this._idleStateCallbacks.forAll(J=>J.idleEnd())))}get state(){return this._state}updateBudget(z){this._test.usedBudget=0;++this._frameNumber;let J=p,K=z.frameDuration,I=t;switch(this.state){case x.RenderState.IDLE:J=n.Milliseconds(0);K=n.Milliseconds(Math.max(D,z.frameDuration));I=r;break;case x.RenderState.INTERACTING:K=n.Milliseconds(Math.max(y,z.frameDuration))}K=n.Milliseconds(K-z.elapsedFrameTime-J);if(this.state!==x.RenderState.IDLE&&K<t&&!this._forceTask)return this._forceTask=!0,!1;K=n.Milliseconds(Math.max(K,
I));this._budget.reset(K,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case x.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(z=>z.idleBegin()));this._runIdle();break;case x.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(n.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(z){this._idleUpdatesStartFired&&
z.idleEnd();this._idleStateCallbacks.removeUnordered(z)}removeTask(z){this._tasks.removeUnordered(z);this._runQueue.removeUnordered(z);this._updatingChanged()}_updateTask(z){this._tasks.forAll(J=>{J.name===z&&J.setPriority(z)})}_getState(z){if(this._runQueue.some(K=>K.name===z))return a.TaskState.SCHEDULED;let J=a.TaskState.IDLE;this._tasks.forAll(K=>{K.name===z&&K.needsUpdate&&(1>=K.schedulePriority?J=a.TaskState.READY:J!==a.TaskState.READY&&(J=a.TaskState.WAITING))});return J}_getRuntime(z){let J=
0;this._tasks.forAll(K=>{K.name===z&&(J+=K.runtime)});return J}_resetRuntimes(){this._tasks.forAll(z=>z.runtime=0)}_getRunning(){const z=new Map;this._tasks.forAll(K=>{K.needsUpdate&&z.set(K.name,(z.get(K.name)||0)+1)});if(0===z.size)return null;let J="";z.forEach((K,I)=>{J=1<K?J+` ${K}x ${I}`:J+` ${I}`});return J}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const z=this._tasks.reduce((J,K)=>K.needsUpdate?++J:J,0);this._load=.9*this._load+z*(1-.9)}_schedule(){this._runQueue.filterInPlace(z=>
{if(z.needsUpdate)return!0;z.schedulePriority=z.basePriority;return!1});for(this._tasks.forAll(z=>{0===z.basePriority&&z.needsUpdate&&!this._runQueue.includes(z)&&z.blockFrame!==this._frameNumber&&this._runQueue.unshift(z)});0===this._runQueue.length;){let z=!1;this._tasks.forAll(J=>{if(J.needsUpdate&&0!==J.schedulePriority&&0!==J.basePriority&&J.blockFrame!==this._frameNumber)switch(z=!0,J.schedulePriority){case 1:J.schedulePriority=0;this._runQueue.push(J);break;default:--J.schedulePriority}});
if(!z)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const z=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var J=this._budget.now();const K=this._runQueue.pop();this._budget.resetProgress();try{K.task.runTask(this._budget)===w.Yield&&(K.blockFrame=this._frameNumber)}catch(I){c.getLogger("esri.views.support.Scheduler").error(`Exception in task "${K.name}"`,I),K.blockFrame=this._frameNumber}!this._budget.hasProgressed&&K.blockFrame!==this._frameNumber&&
K.needsUpdate&&(K.blockFrame=this._frameNumber);K.schedulePriority=K.basePriority;J=this._budget.now()-J;K.runtime+=J;this._frameTaskTimes.set(K.priority,this._frameTaskTimes.get(K.priority)+J);this._debug&&J>2*this._budget.budget&&console.log("Task",K.name,"used",J,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-z);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-
z)}_startFrameTaskTimes(){for(const z of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[z],0)}_recordFrameTaskTimes(z){this._frameTaskTimes.forEach((J,K)=>this.performanceInfo.tasks.get(K).record(J));this.performanceInfo.total.record(z)}get test(){return this._test}}G.Scheduler=H;class L{get task(){return this._task.value}get updating(){return this._queue.running}constructor(z,J,K){this._scheduler=z;this.name=J;this.runtime=this.blockFrame=0;this._queue=new l.PromiseQueue;this._handles=
new b;this.schedulePriority=this._basePriority=q(J);this._task=e.signal(null!=K?K:this._queue);this._handles.add(g.when(()=>this.task.running,I=>z.taskRunningChanged(I)))}remove(){this.processQueue(A);this._scheduler.removeTask(this);this.schedule=F.schedule;this.reschedule=F.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(z){if(this.name!==z){this.name=z;z=q(z);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=z;this._basePriority=
z}}get priority(){return this.name}set priority(z){this.setPriority(z)}get needsUpdate(){return this.updating||this.task.running}schedule(z,J,K){return this._queue.push(z,J,K)}reschedule(z,J,K){return this._queue.unshift(z,J,K)}processQueue(z){return this._queue.runTask(z)}}class C{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=x.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(z){if(this.done)return!1;!0===z()&&this.madeProgress();
return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(z){this._enabled=z}reset(z,J){this._begin=this.now();this._budget=z;this._state=J;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=
this._progressed=!1}get hasProgressed(){return this._progressed}}G.Budget=C})(E||={});a.TaskState=void 0;(function(G){G.SCHEDULED="s";G.READY="r";G.WAITING="w";G.IDLE="i"})(a.TaskState||(a.TaskState={}));const A=(()=>{const G=new E.Budget;G.enabled=!1;return G})();class B{remove(){}processQueue(){}schedule(G,H,L){try{if(f.isAborted(H)){const C=f.createAbortError();return L?Promise.resolve(L(C)):Promise.reject(C)}return f.when(G(A))}catch(C){return Promise.reject(C)}}reschedule(G,H,L){return this.schedule(G,
H,L)}}const F=new B;a.ImmediateTask=F;a.getTaskPriority=q;a.newScheduler=function(){return new E.Scheduler};a.noBudget=A;a.taskPriorities=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(a,b,h,c){class k{constructor(){this._tasks=[];this._runningTasks=h.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(d){if(0===
this.length)return c.Yield;for(;!d.done&&this._process(d);)d.madeProgress()}push(d,f,g){++this._runningTasks.value;return(new Promise((e,n)=>this._tasks.push(new m(e,n,d,f,g)))).finally(()=>--this._runningTasks.value)}unshift(d,f,g){++this._runningTasks.value;return(new Promise((e,n)=>this._tasks.unshift(new m(e,n,d,f,g)))).finally(()=>--this._runningTasks.value)}_process(d){if(0===this._tasks.length)return!1;const f=this._tasks.shift();try{const g=b.isAborted(f.signal);if(g&&!f.abortCallback)f.reject(b.createAbortError());
else{const e=g?f.abortCallback?.(b.createAbortError()):f.callback(d);b.isPromiseLike(e)?e.then(f.resolve,f.reject):f.resolve(e)}}catch(g){f.reject(g)}return!0}cancelAll(){const d=b.createAbortError();for(const f of this._tasks)if(f.abortCallback){const g=f.abortCallback(d);f.resolve(g)}else f.reject(d);this._tasks.length=0}}class m{constructor(d,f,g,e,n){this.resolve=d;this.reject=f;this.callback=g;this.signal=e;this.abortCallback=n}}a.PromiseQueue=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/support/Yield":function(){define(["exports"],function(a){const b=Symbol("Yield");a.Yield=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d){b=class extends b{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=
this.SCHEDULER_LOG_SLOW_TASKS=!1}};a.__decorate([h.property()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([h.property()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);b=a.__decorate([d.subclass("esri.views.support.DebugFlags")],b);return new b})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){a.Fog=class extends h{constructor(E){super(E);this._passParameters=new x.FogPassParameters;this._vao=p.createQuadVAO(E.context.renderContext.rctx,v.Pos2Tex);this._technique=new w.FogTechnique(E);E=l.getReferenceEllipsoid(E.view.spatialReference);this._planetRadius=E.radius;this._atmosphereRadius=E.radius+u.atmosphereHeight}destroy(){this._technique.release();this._vao.dispose()}set strength(E){this._passParameters.fogStrength=E}get strength(){return this._passParameters.fogStrength}render(E,
A){this._update(E,A);if(!(0>=this._passParameters.fogAmount)){var B=this._technique;if(B.compiled){var F=E.offscreenRenderingHelper;F.renderDepthDetached(()=>{this._passParameters.depthTexture=F.depthTexture;const G=E.rctx.bindTechnique(B,E.bindParameters,this._passParameters);this._renderFog(G,E)})}else this.context.requestRender()}}_renderFog(E,A){A=A.rctx;A.bindVAO(this._vao);E.assertCompatibleVertexAttributeLocations(this._vao);A.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4)}_update(E,A){var B=
E.bindParameters.camera;e.normalize(y,B.eye);E=Math.max(0,e.dot(y,E.bindParameters.lighting.mainLight.direction));const F=A.color;e.scale(D,F,.1);e.lerp(this._passParameters.fogColor,D,F,E);B=e.length(B.eye);this._passParameters.atmosphereC=B*B-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-c.smoothstep(.95*q.weatherHeightLimit,1*q.weatherHeightLimit,Math.abs(B-this._planetRadius)))*A.amount;this._passParameters.fogStrength=A.strength}static isSupported(E){return E.capabilities.depthTexture}};
b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"viewingMode",void 0);a.Fog=b.__decorate([g.subclass("esri.views.3d.environment.Fog")],a.Fog);class r{constructor(){this.color=n.create();this.amount=this.strength=0}}const y=n.create(),D=n.create();a.FogParameters=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(){const t=new u.ShaderBuilder;t.attributes.add(w.VertexAttribute.POSITION,"vec2");t.include(k.TextureCoordinateAttribute,{textureCoordinateType:k.TextureCoordinateAttributeType.Default});t.varyings.add("worldRay","vec3");t.varyings.add("eyeDir","vec3");const {vertex:r,fragment:y}=t;r.uniforms.add(new l.Matrix4PassUniform("inverseProjectionMatrix",(D,E)=>E.camera.inverseProjectionMatrix),new l.Matrix4PassUniform("inverseViewMatrix",(D,E)=>b.invertOrIdentity(p,
E.camera.viewMatrix)));r.code.add(n.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);y.uniforms.add(new e.FloatPassUniform("atmosphereC",D=>D.atmosphereC),new g.Float3PassUniform("cameraPosition",(D,E)=>E.camera.eye),new f.Float2PassUniform("nearFar",(D,E)=>E.camera.nearFar),new x.Texture2DPassUniform("depthTexture",D=>D.depthTexture),new e.FloatPassUniform("fogStrength",D=>D.fogStrength),new e.FloatPassUniform("fogAmount",D=>D.fogAmount),new g.Float3PassUniform("fogColor",D=>D.fogColor));t.include(d.Gamma);y.include(m.ReadLinearDepth);y.code.add(n.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);y.code.add(n.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);y.code.add(n.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`);return t}class v extends n.NoParameters{constructor(){super(...arguments);this.fogColor=c.create();this.fogStrength=4E-6;this.atmosphereC=1;this.fogAmount=0}}const p=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:v,build:q},Symbol.toStringTag,{value:"Module"}));a.Fog=h;a.FogPassParameters=v;a.build=q})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends k.ShaderTechnique{constructor(l){super(l,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(l){return new f.Program(l.rctx,n.shader.get().build(),d.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})}}n.shader=new c.ReloadableShaderModule(h.Fog,()=>new Promise((l,
u)=>a(["./Fog.glsl"],l,u)));b.FogTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../core/maybe ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){class y{constructor(A,B){this.type=k.AtmosphereType.Local;this._configuration=new f.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new m.SimpleAtmospherePassParameters;this._configuration.geometry=f.SimpleAtmosphereGeometry.Cylinder;this._technique=B.techniqueRepository.acquire(d.SimpleAtmosphereTechnique,this._configuration);A=B.renderContext.rctx;this._vao=this._createVertexArrayObject(A);this._vaoCount=r.vertexCount(this._vao,"geometry");
B=new t.TextureDescriptor;B.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;B.flipped=!0;B.width=1;B.height=512;this._passParameters.texture=new p.Texture(A,B,g.earthAtmosphereTextureSimple)}destroy(){this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()}render(A){const B=A.rctx,F=B.bindTechnique(this._technique,A.bindParameters,this._passParameters);var G=D;h.copy(G,A.bindParameters.camera.viewMatrix);G[12]=0;G[13]=0;G[14]=0;G[15]=1;F.setUniformMatrix4fv("view",
D);B.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);B.drawArrays(v.PrimitiveType.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(A){var B=u.createPolySphereData(1,2,!1);const {data:F,indices:G}=B[0][1];B=E.createBuffer(G.length);const H=B.position;for(let L=0;L<G.length;++L){const C=3*G[0===L%3?L+2:2===L%3?L-2:L];H.set(L,0,F[C]);H.set(L,1,F[C+1]);H.set(L,2,F[C+2])}return new x.VertexArrayObject(A,l.Default3D,{geometry:e.glLayout(E)},{geometry:q.BufferObject.createVertex(A,
v.Usage.STATIC_DRAW,B.buffer)})}}const D=c.create(),E=n.newLayout().vec3f(w.VertexAttribute.POSITION);a.LocalAtmosphere=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(t){const r=new l.ShaderBuilder,{vertex:y,fragment:D}=r;m.addMainLightDirection(y);t.geometry===c.SimpleAtmosphereGeometry.Underground?(r.attributes.add(x.VertexAttribute.POSITION,"vec2"),r.varyings.add("color","vec4"),y.uniforms.add(new f.Float3PassUniform("cameraPosition",(E,A)=>A.camera.eye),new g.FloatPassUniform("undergroundFadeAlpha",E=>E.undergroundFadeAlpha)),y.code.add(e.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),D.code.add(e.glsl`void main() {
fragColor = color;
}`)):(r.include(k.Transform,t),r.attributes.add(x.VertexAttribute.POSITION,"vec3"),r.varyings.add("vtc","vec2"),r.varyings.add("falloff","float"),t=t.geometry===c.SimpleAtmosphereGeometry.Cylinder,y.uniforms.add(new n.Matrix4PassUniform("proj",(E,A)=>A.camera.projectionMatrix),new n.Matrix4PassUniform("view",(E,A)=>A.camera.viewMatrix)),t||(r.varyings.add("innerFactor","float"),y.uniforms.add(new f.Float3PassUniform("silCircleCenter",E=>E.silhouette.center)),y.uniforms.add(new f.Float3PassUniform("silCircleV1",
E=>E.silhouette.v1)),y.uniforms.add(new f.Float3PassUniform("silCircleV2",E=>E.silhouette.v2)),y.uniforms.add(new d.Float2PassUniform("texV",E=>E.texV)),y.uniforms.add(new g.FloatPassUniform("innerScale",E=>E.innerScale))),y.code.add(e.glsl`
		void main(void) {
      ${t?e.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:e.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${e.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${e.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),D.uniforms.add(new u.Texture2DPassUniform("tex",E=>E.texture)),t||D.uniforms.add(new g.FloatPassUniform("altitudeFade",E=>E.altitudeFade)),D.code.add(e.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${t?e.glsl`fragColor = atmosphereColor;`:e.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return r}class q extends e.NoParameters{constructor(){super(...arguments);this.texV=b.create();this.undergroundFadeAlpha=this.innerScale=this.altitudeFade=0;this.silhouette=new v}}class v{constructor(){this.center=h.create();this.v1=h.create();this.v2=h.create()}}const p=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:v,SimpleAtmospherePassParameters:q,build:w},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=v;a.SimpleAtmosphere=p;a.SimpleAtmospherePassParameters=
q;a.build=w})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,h,c){a.SimpleAtmosphereGeometry=void 0;(function(m){m[m.Cone=0]="Cone";m[m.Cylinder=1]="Cylinder";m[m.Underground=2]="Underground";m[m.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));class k extends c.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.geometry=a.SimpleAtmosphereGeometry.Cone}}b.__decorate([h.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],k.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,h,c,k){class m extends h.InstancedDoubleConfiguration{}b.__decorate([k.parameter({constValue:!0})],m.prototype,"hasSliceHighlight",void 0);b.__decorate([k.parameter({constValue:!1})],m.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([k.parameter({constValue:c.BindType.Pass})],m.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){class p extends w.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasModelTransformation=this.instancedDoublePrecision=!1}}b.__decorate([w.parameter()],p.prototype,"instancedDoublePrecision",void 0);b.__decorate([w.parameter()],p.prototype,"hasModelTransformation",void 0);class t extends l.NoParameters{constructor(){super(...arguments);this.modelTransformation=null}}const r=c.create(),y=d.create();a.InstancedDoubleConfiguration=p;a.InstancedDoublePassParameters=
t;a.InstancedDoublePrecision=function(D,E){const A=E.hasModelTransformation,B=E.instancedDoublePrecision;A&&(D.vertex.uniforms.add(new x.Matrix4PassUniform("model",F=>F.modelTransformation??k.IDENTITY)),D.vertex.uniforms.add(new u.Matrix3PassUniform("normalLocalOriginFromModel",F=>{h.normalFromMat4(r,F.modelTransformation??k.IDENTITY);return r})));E.instanced&&B&&(D.attributes.add(q.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),D.attributes.add(q.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),D.attributes.add(q.VertexAttribute.INSTANCEMODEL,
"mat3"),D.attributes.add(q.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));D=D.vertex;B&&(D.include(g.DoublePrecision,E),D.uniforms.add(new n.Float3DrawUniform("viewOriginHi",(F,G)=>v.encodeDoubleHi(m.set(y,G.camera.viewInverseTransposeMatrix[3],G.camera.viewInverseTransposeMatrix[7],G.camera.viewInverseTransposeMatrix[11]),y)),new n.Float3DrawUniform("viewOriginLo",(F,G)=>v.encodeDoubleLo(m.set(y,G.camera.viewInverseTransposeMatrix[3],G.camera.viewInverseTransposeMatrix[7],G.camera.viewInverseTransposeMatrix[11]),
y))));D.code.add(l.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${A?B?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":B?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${B?l.glsl`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);D.code.add(l.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${A?B?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":B?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `);E.output===f.ShaderOutput.Normal&&(e.addViewNormal(D),D.code.add(l.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${A?B?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":B?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `));E.hasVertexTangents&&D.code.add(l.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${A?B?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":B?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){function b(f){return f===a.ShaderOutput.Shadow||f===a.ShaderOutput.ShadowHighlight||f===a.ShaderOutput.ShadowExcludeHighlight}function h(f){return f===a.ShaderOutput.Highlight||f===a.ShaderOutput.ObjectAndLayerIdColor}function c(f){return f===a.ShaderOutput.Color||f===a.ShaderOutput.Alpha}function k(f){return c(f)||f===a.ShaderOutput.Highlight}
function m(f){return c(f)||h(f)}function d(f){return m(f)||f===a.ShaderOutput.LinearDepth}a.ShaderOutput=void 0;(function(f){f[f.Color=0]="Color";f[f.LinearDepth=1]="LinearDepth";f[f.Depth=2]="Depth";f[f.Normal=3]="Normal";f[f.Shadow=4]="Shadow";f[f.ShadowHighlight=5]="ShadowHighlight";f[f.ShadowExcludeHighlight=6]="ShadowExcludeHighlight";f[f.Highlight=7]="Highlight";f[f.Alpha=8]="Alpha";f[f.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor";f[f.CompositeColor=10]="CompositeColor";f[f.COUNT=11]="COUNT"})(a.ShaderOutput||
(a.ShaderOutput={}));a.is2DGeometryOutput=function(f){return f===a.ShaderOutput.Color||h(f)};a.is3DGeometryOutput=function(f){return d(f)||f===a.ShaderOutput.Normal};a.isColorAlphaHighlightOIDOrDepth=d;a.isColorAlphaHighlightOrDepth=function(f){return k(f)||f===a.ShaderOutput.LinearDepth};a.isColorAlphaHighlightOrOID=m;a.isColorAlphaOrHighlight=k;a.isColorAlphaOrOID=function(f){return c(f)||f===a.ShaderOutput.ObjectAndLayerIdColor};a.isColorOrAlpha=c;a.isDepthLikeOutput=function(f){return b(f)||f===
a.ShaderOutput.Depth||f===a.ShaderOutput.LinearDepth||f===a.ShaderOutput.Normal||f===a.ShaderOutput.ObjectAndLayerIdColor};a.isOIDorHighlight=h;a.isShadowRelatedOutput=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:h},c){c.doublePrecisionRequiresObfuscation?h.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):h.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e){const n=h.create(),l=k.create();a.addCameraPosition=function(u,x){x.instancedDoublePrecision?u.constants.add("cameraPosition","vec3",k.ZEROS):u.uniforms.add(new m.Float3DrawUniform("cameraPosition",(w,q)=>c.set(l,q.camera.viewInverseTransposeMatrix[3]-w.origin[0],q.camera.viewInverseTransposeMatrix[7]-w.origin[1],q.camera.viewInverseTransposeMatrix[11]-w.origin[2])))};a.addPixelRatio=function(u){u.uniforms.add(new f.FloatPassUniform("pixelRatio",(x,w)=>w.camera.pixelRatio/
w.overlayStretch))};a.addProjViewLocalOrigin=function(u,x){x.instancedDoublePrecision?u.uniforms.add(new e.Matrix4PassUniform("proj",(w,q)=>q.camera.projectionMatrix),new e.Matrix4PassUniform("view",(w,q)=>b.translate(n,q.camera.viewMatrix,c.set(l,q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]))),new d.Float3PassUniform("localOrigin",(w,q)=>c.set(l,q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]))):
u.uniforms.add(new e.Matrix4PassUniform("proj",(w,q)=>q.camera.projectionMatrix),new g.Matrix4DrawUniform("view",(w,q)=>b.translate(n,q.camera.viewMatrix,w.origin)),new m.Float3DrawUniform("localOrigin",w=>w.origin))};a.addViewNormal=function(u){u.uniforms.add(new e.Matrix4PassUniform("viewNormal",(x,w)=>w.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"mat4",h.BindType.Draw,(d,f,g)=>d.setUniformMatrix4fv(k,m(f,g)))}}a.Matrix4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(h,c,k){for(let m=0;m<k;++m)c[m]=h[2*m]+h[2*m+1]};a.encodeDoubleArray=function(h,c,k){for(let m=0;m<
k;++m)c[2*m]=h[m],c[2*m+1]=h[m]-c[2*m]};a.encodeDoubleHi=function(h,c){const k=h.length;for(let m=0;m<k;++m)b[0]=h[m],c[m]=b[0];return c};a.encodeDoubleLo=function(h,c){const k=h.length;for(let m=0;m<k;++m)b[0]=h[m],b[1]=h[m]-b[0],c[m]=b[1];return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,h){a.Transform=function(c){b.addCalculateLinearDepth(c);
c.vertex.code.add(h.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);c.vertex.code.add(h.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,h,c,k){function m(g){g.varyings.add("linearDepth","float")}function d(g){g.vertex.uniforms.add(new c.Float2PassUniform("nearFar",(e,n)=>n.camera.nearFar))}function f(g){g.vertex.code.add(k.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(g,e){const {vertex:n}=g;switch(e.output){case b.ShaderOutput.Color:if(e.receiveShadows){m(g);n.code.add(k.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.LinearDepth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:g.include(h.VertexPosition,e);m(g);d(g);f(g);n.code.add(k.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}n.code.add(k.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=f;a.addLinearDepth=m;a.addNearFar=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u extends g.NoParameters{constructor(){super(...arguments);this.transformWorldFromViewTH=c.create();this.transformWorldFromViewTL=c.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=h.create()}}class x extends g.NoParameters{constructor(){super(...arguments);this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=c.create();this.transformWorldFromModelTL=c.create()}}a.VertexPosition=function(w,q){w.include(k.PositionAttribute);
const v=w.vertex;v.include(m.DoublePrecision,q);w.varyings.add("vPositionWorldCameraRelative","vec3");w.varyings.add("vPosition_view","vec3");v.uniforms.add(new f.Float3PassUniform("transformWorldFromViewTH",p=>p.transformWorldFromViewTH),new f.Float3PassUniform("transformWorldFromViewTL",p=>p.transformWorldFromViewTL),new n.Matrix3PassUniform("transformViewFromCameraRelativeRS",p=>p.transformViewFromCameraRelativeRS),new l.Matrix4PassUniform("transformProjFromView",p=>p.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",
p=>p.transformWorldFromModelRS),new d.Float3DrawUniform("transformWorldFromModelTH",p=>p.transformWorldFromModelTH),new d.Float3DrawUniform("transformWorldFromModelTL",p=>p.transformWorldFromModelTL));v.code.add(g.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);v.code.add(g.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${q.spherical?g.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:g.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);w.fragment.uniforms.add(new f.Float3PassUniform("transformWorldFromViewTL",p=>p.transformWorldFromViewTL));v.code.add(g.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);w.fragment.code.add(g.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=x;a.VertexPositionPassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,h){a.PositionAttribute=function(c){c.attributes.add(h.VertexAttribute.POSITION,"vec3");c.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"mat3",h.BindType.Draw,(d,f,g)=>d.setUniformMatrix3fv(k,m(f,g)))}}a.Matrix3DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends m.ShaderTechnique{initializeProgram(l){return new f.Program(l.rctx,n.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){return this.configuration.geometry===c.SimpleAtmosphereGeometry.Cylinder?e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:e.backFaceCullingParams,depthTest:{func:g.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:g.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}n.shader=new k.ReloadableShaderModule(h.SimpleAtmosphere,()=>new Promise((l,u)=>a(["./SimpleAtmosphere.glsl"],l,u)));b.SimpleAtmosphereTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,
11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,
11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,
0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,
56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,
14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,
43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,
54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,
95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,
120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,
151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,
255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,
242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,h){const c={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,
f32:b.DataType.FLOAT};a.glLayout=function(k,m=0){const d=k.stride;return Array.from(k.fields.keys()).map(f=>{const g=k.fields.get(f),e=g.constructor.ElementCount;var n=c[g.constructor.ElementType];if(!n)throw Error("BufferType not supported in WebGL");return new h.VertexElementDescriptor(f,e,n,g.offset,d,!(!g.optional||!g.optional.glNormalized),m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],function(a,b,h,c){class k{constructor(e,n){this.layout=e;this.buffer="number"===typeof n?new ArrayBuffer(n*e.stride):n;for(const l of e.fields.keys())n=e.fields.get(l),this[l]=new n.constructor(this.buffer,n.offset,this.stride)}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,n){return(e=this[e])&&e.elementCount===n.ElementCount&&
e.elementType===n.ElementType?e:null}slice(e,n){return new k(this.layout,this.buffer.slice(e*this.stride,n*this.stride))}copyFrom(e,n=0,l=0,u=e.count){const x=this.stride;0===x%4?(e=new Uint32Array(e.buffer,n*x,u*x/4),(new Uint32Array(this.buffer,l*x,u*x/4)).set(e)):(e=new Uint8Array(e.buffer,n*x,u*x),(new Uint8Array(this.buffer,l*x,u*x)).set(e));return this}get usedMemory(){return this.byteLength}dispose(){}}class m{constructor(e=null){this._lastAligned=this._stride=0;this._fields=new Map;e&&(this._stride=
e.stride,e.fields.forEach(n=>this._fields.set(n[0],{...n[1],constructor:g.get(n[1].constructor)})))}vec2f(e,n){this._appendField(e,b.BufferViewVec2f,n);return this}vec2f64(e,n){this._appendField(e,b.BufferViewVec2f64,n);return this}vec3f(e,n){this._appendField(e,b.BufferViewVec3f,n);return this}vec3f64(e,n){this._appendField(e,b.BufferViewVec3f64,n);return this}vec4f(e,n){this._appendField(e,b.BufferViewVec4f,n);return this}vec4f64(e,n){this._appendField(e,b.BufferViewVec4f64,n);return this}mat3f(e,
n){this._appendField(e,b.BufferViewMat3f,n);return this}mat3f64(e,n){this._appendField(e,b.BufferViewMat3f64,n);return this}mat4f(e,n){this._appendField(e,b.BufferViewMat4f,n);return this}mat4f64(e,n){this._appendField(e,b.BufferViewMat4f64,n);return this}vec4u8(e,n){this._appendField(e,b.BufferViewVec4u8,n);return this}f32(e,n){this._appendField(e,b.BufferViewFloat,n);return this}f64(e,n){this._appendField(e,b.BufferViewFloat64,n);return this}u8(e,n){this._appendField(e,b.BufferViewUint8,n);return this}u16(e,
n){this._appendField(e,b.BufferViewUint16,n);return this}i8(e,n){this._appendField(e,b.BufferViewInt8,n);return this}vec2i8(e,n){this._appendField(e,b.BufferViewVec2i8,n);return this}vec2i16(e,n){this._appendField(e,b.BufferViewVec2i16,n);return this}vec2u8(e,n){this._appendField(e,b.BufferViewVec2u8,n);return this}vec4u16(e,n){this._appendField(e,b.BufferViewVec4u16,n);return this}u32(e,n){this._appendField(e,b.BufferViewUint32,n);return this}_appendField(e,n,l){if(this._fields.has(e))c.assert(!1,
`${e} already added to vertex buffer layout`);else{var u=n.ElementCount*h.elementTypeSize(n.ElementType),x=this._stride;this._stride+=u;this._fields.set(e,{size:u,constructor:n,offset:x,optional:l})}}createBuffer(e){return new k(this,e)}createView(e){return new k(this,e)}clone(){const e=new m;e._stride=this._stride;e._fields=new Map;this._fields.forEach((n,l)=>e._fields.set(l,n));e.BufferType=this.BufferType;return e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(n=>
e=Math.max(e,h.elementTypeSize(n.constructor.ElementType)));this._stride=Math.floor((this._stride+e-1)/e)*e;this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}class d{constructor(e){this.fields=[];e.fields.forEach((n,l)=>{var u=n.constructor;this.fields.push([l,{...n,constructor:`${u.ElementType}_${u.ElementCount}`}])});this.stride=e.stride}}const f=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,
b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,
b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32],g=new Map;f.forEach(e=>g.set(`${e.ElementType}_${e.ElementCount}`,e));a.InterleavedBuffer=k;a.InterleavedLayout=m;a.PackedLayout=d;a.newLayout=function(){return new m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,b,h,c,k,m,d){class f extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Float32Array,P,R,ba,X);this.elementType="f32"}static fromTypedArray(P,R){return new f(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}f.ElementType="f32";class g extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Float32Array,P,R,ba,X);this.elementType="f32"}slice(P,R){return this.sliceBuffer(g,P,R)}static fromTypedArray(P,R){return new g(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}g.ElementType="f32";class e extends m.BufferViewVec3Impl{constructor(P,R=0,ba,X){super(Float32Array,
P,R,ba,X);this.elementType="f32"}slice(P,R){return this.sliceBuffer(e,P,R)}static fromTypedArray(P,R){return new e(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}e.ElementType="f32";class n extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Float32Array,P,R,ba,X);this.elementType="f32"}slice(P,R){return this.sliceBuffer(n,P,R)}static fromTypedArray(P,R){return new n(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}n.ElementType="f32";class l extends b.BufferViewMat3Impl{constructor(P,
R=0,ba,X){super(Float32Array,P,R,ba,X);this.elementType="f32"}slice(P,R){return this.sliceBuffer(l,P,R)}static fromTypedArray(P,R){return new l(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}l.ElementType="f32";class u extends b.BufferViewMat3Impl{constructor(P,R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(u,P,R)}static fromTypedArray(P,R){return new u(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}u.ElementType="f64";class x extends h.BufferViewMat4Impl{constructor(P,
R=0,ba,X){super(Float32Array,P,R,ba,X);this.elementType="f32"}slice(P,R){return this.sliceBuffer(x,P,R)}static fromTypedArray(P,R){return new x(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}x.ElementType="f32";class w extends h.BufferViewMat4Impl{constructor(P,R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(w,P,R)}static fromTypedArray(P,R){return new w(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}w.ElementType="f64";class q extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(q,P,R)}static fromTypedArray(P,R){return new q(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}q.ElementType="f64";class v extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(v,P,R)}static fromTypedArray(P,R){return new v(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}v.ElementType="f64";class p extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(p,P,R)}static fromTypedArray(P,R){return new p(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}p.ElementType="f64";class t extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Float64Array,P,R,ba,X);this.elementType="f64"}slice(P,R){return this.sliceBuffer(t,P,R)}static fromTypedArray(P,R){return new t(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}t.ElementType="f64";class r extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Uint8Array,P,R,ba,X);this.elementType="u8"}slice(P,R){return this.sliceBuffer(r,P,R)}static fromTypedArray(P,R){return new r(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}r.ElementType="u8";class y extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Uint8Array,P,R,ba,X);this.elementType="u8"}slice(P,R){return this.sliceBuffer(y,P,R)}static fromTypedArray(P,R){return new y(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}y.ElementType="u8";class D extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Uint8Array,P,R,ba,X);this.elementType="u8"}slice(P,R){return this.sliceBuffer(D,P,R)}static fromTypedArray(P,R){return new D(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}D.ElementType="u8";class E extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Uint8Array,P,R,ba,X);this.elementType="u8"}slice(P,R){return this.sliceBuffer(E,P,R)}static fromTypedArray(P,R){return new E(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}E.ElementType="u8";class A extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Uint16Array,P,R,ba,X);this.elementType="u16"}slice(P,R){return this.sliceBuffer(A,P,R)}static fromTypedArray(P,R){return new A(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}A.ElementType="u16";class B extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Uint16Array,P,R,ba,X);this.elementType="u16"}slice(P,R){return this.sliceBuffer(B,P,R)}static fromTypedArray(P,R){return new B(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}B.ElementType="u16";class F extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Uint16Array,P,R,ba,X);this.elementType="u16"}slice(P,R){return this.sliceBuffer(F,P,R)}static fromTypedArray(P,R){return new F(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}F.ElementType="u16";class G extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Uint16Array,P,R,ba,X);this.elementType="u16"}slice(P,R){return this.sliceBuffer(G,P,R)}static fromTypedArray(P,R){return new G(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}G.ElementType="u16";class H extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Uint32Array,P,R,ba,X);this.elementType="u32"}slice(P,R){return this.sliceBuffer(H,P,R)}static fromTypedArray(P,R){return new H(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}H.ElementType="u32";class L extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Uint32Array,P,R,ba,X);this.elementType="u32"}slice(P,R){return this.sliceBuffer(L,P,R)}static fromTypedArray(P,R){return new L(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}L.ElementType="u32";class C extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Uint32Array,P,R,ba,X);this.elementType="u32"}slice(P,R){return this.sliceBuffer(C,P,R)}static fromTypedArray(P,R){return new C(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}C.ElementType="u32";class z extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Uint32Array,P,R,ba,X);this.elementType="u32"}slice(P,R){return this.sliceBuffer(z,P,R)}static fromTypedArray(P,R){return new z(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}z.ElementType="u32";class J extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Int8Array,P,R,ba,X);this.elementType="i8"}slice(P,R){return this.sliceBuffer(J,P,R)}static fromTypedArray(P,R){return new J(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}J.ElementType="i8";class K extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Int8Array,P,R,ba,X);this.elementType="i8"}slice(P,R){return this.sliceBuffer(K,P,R)}static fromTypedArray(P,R){return new K(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}K.ElementType="i8";class I extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Int8Array,P,R,ba,X);this.elementType="i8"}slice(P,R){return this.sliceBuffer(I,P,R)}static fromTypedArray(P,R){return new I(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}I.ElementType="i8";class M extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Int8Array,P,R,ba,X);this.elementType="i8"}slice(P,R){return this.sliceBuffer(M,P,R)}static fromTypedArray(P,R){return new M(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}M.ElementType="i8";class S extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Int16Array,P,R,ba,X);this.elementType="i16"}slice(P,R){return this.sliceBuffer(S,P,R)}static fromTypedArray(P,R){return new S(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}S.ElementType="i16";class N extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Int16Array,P,R,ba,X);this.elementType="i16"}slice(P,R){return this.sliceBuffer(N,P,R)}static fromTypedArray(P,R){return new N(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}N.ElementType="i16";class V extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Int16Array,P,R,ba,X);this.elementType="i16"}slice(P,R){return this.sliceBuffer(V,P,R)}static fromTypedArray(P,R){return new V(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}V.ElementType="i16";class Q extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Int16Array,P,R,ba,X);this.elementType="i16"}slice(P,R){return this.sliceBuffer(Q,P,R)}static fromTypedArray(P,R){return new Q(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}Q.ElementType="i16";class T extends c.BufferViewScalarImpl{constructor(P,
R=0,ba,X){super(Int32Array,P,R,ba,X);this.elementType="i32"}slice(P,R){return this.sliceBuffer(T,P,R)}static fromTypedArray(P,R){return new T(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}T.ElementType="i32";class ia extends k.BufferViewVec2Impl{constructor(P,R=0,ba,X){super(Int32Array,P,R,ba,X);this.elementType="i32"}slice(P,R){return this.sliceBuffer(ia,P,R)}static fromTypedArray(P,R){return new ia(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}ia.ElementType="i32";class O extends m.BufferViewVec3Impl{constructor(P,
R=0,ba,X){super(Int32Array,P,R,ba,X);this.elementType="i32"}slice(P,R){return this.sliceBuffer(O,P,R)}static fromTypedArray(P,R){return new O(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}O.ElementType="i32";class U extends d.BufferViewVec4Impl{constructor(P,R=0,ba,X){super(Int32Array,P,R,ba,X);this.elementType="i32"}slice(P,R){return this.sliceBuffer(U,P,R)}static fromTypedArray(P,R){return new U(P.buffer,P.byteOffset,R,P.byteOffset+P.byteLength)}}U.ElementType="i32";a.BufferViewFloat=f;a.BufferViewFloat64=
q;a.BufferViewInt16=S;a.BufferViewInt32=T;a.BufferViewInt8=J;a.BufferViewMat3f=l;a.BufferViewMat3f64=u;a.BufferViewMat4f=x;a.BufferViewMat4f64=w;a.BufferViewUint16=A;a.BufferViewUint32=H;a.BufferViewUint8=r;a.BufferViewVec2f=g;a.BufferViewVec2f64=v;a.BufferViewVec2i16=N;a.BufferViewVec2i32=ia;a.BufferViewVec2i8=K;a.BufferViewVec2u16=B;a.BufferViewVec2u32=L;a.BufferViewVec2u8=y;a.BufferViewVec3f=e;a.BufferViewVec3f64=p;a.BufferViewVec3i16=V;a.BufferViewVec3i32=O;a.BufferViewVec3i8=I;a.BufferViewVec3u16=
F;a.BufferViewVec3u32=C;a.BufferViewVec3u8=D;a.BufferViewVec4f=n;a.BufferViewVec4f64=t;a.BufferViewVec4i16=Q;a.BufferViewVec4i32=U;a.BufferViewVec4i8=M;a.BufferViewVec4u16=G;a.BufferViewVec4u32=z;a.BufferViewVec4u8=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(a){class b{constructor(h,c,k=0,m,d){this.TypedArrayConstructor=h;this.elementCount=9;h=this.TypedArrayConstructor;void 0===m&&(m=9*h.BYTES_PER_ELEMENT);
const f=0===c.byteLength?0:k;this.typedBuffer=null==d?new h(c,f):new h(c,f,(d-k)/h.BYTES_PER_ELEMENT);this.typedBufferStride=m/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(h,c,k=this.count-c){c=this.typedBuffer.byteOffset+c*this.stride;return new h(this.buffer,c,this.stride,c+k*this.stride)}getMat(h,c){h*=this.typedBufferStride;for(let k=0;9>k;k++)c[k]=this.typedBuffer[h++];
return c}setMat(h,c){h*=this.typedBufferStride;for(let k=0;9>k;k++)this.typedBuffer[h++]=c[k]}get(h,c){return this.typedBuffer[h*this.typedBufferStride+c]}set(h,c,k){this.typedBuffer[h*this.typedBufferStride+c]=k}copyFrom(h,c,k){const m=this.typedBuffer,d=c.typedBuffer;h*=this.typedBufferStride;c=k*c.typedBufferStride;for(k=0;9>k;++k)m[h++]=d[c++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],
function(a){class b{constructor(h,c,k=0,m,d){this.TypedArrayConstructor=h;this.elementCount=16;h=this.TypedArrayConstructor;void 0===m&&(m=16*h.BYTES_PER_ELEMENT);const f=0===c.byteLength?0:k;this.typedBuffer=null==d?new h(c,f):new h(c,f,(d-k)/h.BYTES_PER_ELEMENT);this.typedBufferStride=m/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(h,c,k=this.count-c){c=this.typedBuffer.byteOffset+
c*this.stride;return new h(this.buffer,c,this.stride,c+k*this.stride)}getMat(h,c){h*=this.typedBufferStride;for(let k=0;16>k;k++)c[k]=this.typedBuffer[h++];return c}setMat(h,c){h*=this.typedBufferStride;for(let k=0;16>k;k++)this.typedBuffer[h++]=c[k]}get(h,c){return this.typedBuffer[h*this.typedBufferStride+c]}set(h,c,k){this.typedBuffer[h*this.typedBufferStride+c]=k}copyFrom(h,c,k){const m=this.typedBuffer,d=c.typedBuffer;h*=this.typedBufferStride;c=k*c.typedBufferStride;for(k=0;16>k;++k)m[h++]=
d[c++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(a){class b{constructor(h,c,k=0,m,d){this.TypedArrayConstructor=h;this.elementCount=1;h=this.TypedArrayConstructor;void 0===m&&(m=h.BYTES_PER_ELEMENT);const f=0===c.byteLength?0:k;this.typedBuffer=null==d?new h(c,f):new h(c,f,(d-k)/h.BYTES_PER_ELEMENT);this.stride=
m;this.typedBufferStride=m/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(h,c,k=this.count-c){c=this.typedBuffer.byteOffset+c*this.stride;return new h(this.buffer,c,this.stride,c+k*this.stride)}get(h){return this.typedBuffer[h*this.typedBufferStride]}set(h,c){this.typedBuffer[h*this.typedBufferStride]=c}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2"],function(a,b){class h{constructor(c,k,m=0,d,f){this.TypedArrayConstructor=c;this.elementCount=2;c=this.TypedArrayConstructor;void 0===d&&(d=2*c.BYTES_PER_ELEMENT);const g=0===k.byteLength?0:m;this.typedBuffer=null==f?new c(k,g):new c(k,g,(f-m)/c.BYTES_PER_ELEMENT);this.typedBufferStride=d/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(c,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new c(this.buffer,k,this.stride,k+m*this.stride)}getVec(c,k){c*=this.typedBufferStride;return b.set(k,this.typedBuffer[c],this.typedBuffer[c+1])}setVec(c,k){c*=this.typedBufferStride;this.typedBuffer[c++]=k[0];this.typedBuffer[c]=k[1]}get(c,k){return this.typedBuffer[c*this.typedBufferStride+k]}set(c,k,m){this.typedBuffer[c*this.typedBufferStride+
k]=m}setValues(c,k,m){c*=this.typedBufferStride;this.typedBuffer[c++]=k;this.typedBuffer[c]=m}copyFrom(c,k,m){const d=this.typedBuffer,f=k.typedBuffer;c*=this.typedBufferStride;k=m*k.typedBufferStride;d[c++]=f[k++];d[c]=f[k]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=2;a.BufferViewVec2Impl=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec32"],function(a,b){class h{constructor(c,
k,m=0,d,f){this.TypedArrayConstructor=c;this.elementCount=3;c=this.TypedArrayConstructor;void 0===d&&(d=3*c.BYTES_PER_ELEMENT);const g=0===k.byteLength?0:m;this.typedBuffer=null==f?new c(k,g):new c(k,g,(f-m)/c.BYTES_PER_ELEMENT);this.typedBufferStride=d/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(c,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new c(this.buffer,
k,this.stride,k+m*this.stride)}getVec(c,k){c*=this.typedBufferStride;return b.set(k,this.typedBuffer[c],this.typedBuffer[c+1],this.typedBuffer[c+2])}setVec(c,k){c*=this.typedBufferStride;this.typedBuffer[c++]=k[0];this.typedBuffer[c++]=k[1];this.typedBuffer[c]=k[2]}get(c,k){return this.typedBuffer[c*this.typedBufferStride+k]}set(c,k,m){this.typedBuffer[c*this.typedBufferStride+k]=m}setValues(c,k,m,d){c*=this.typedBufferStride;this.typedBuffer[c++]=k;this.typedBuffer[c++]=m;this.typedBuffer[c]=d}copyFrom(c,
k,m){const d=this.typedBuffer,f=k.typedBuffer;c*=this.typedBufferStride;k=m*k.typedBufferStride;d[c++]=f[k++];d[c++]=f[k++];d[c]=f[k]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=3;a.BufferViewVec3Impl=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec42"],function(a,b){class h{constructor(c,k,m=0,d,f){this.TypedArrayConstructor=c;this.start=m;this.elementCount=4;c=this.TypedArrayConstructor;
void 0===d&&(d=4*c.BYTES_PER_ELEMENT);const g=0===k.byteLength?0:m;this.typedBuffer=null==f?new c(k,g):new c(k,g,(f-m)/c.BYTES_PER_ELEMENT);this.typedBufferStride=d/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(c,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new c(this.buffer,k,this.stride,k+m*this.stride)}getVec(c,k){c*=this.typedBufferStride;
return b.set(k,this.typedBuffer[c++],this.typedBuffer[c++],this.typedBuffer[c++],this.typedBuffer[c])}setVec(c,k){c*=this.typedBufferStride;this.typedBuffer[c++]=k[0];this.typedBuffer[c++]=k[1];this.typedBuffer[c++]=k[2];this.typedBuffer[c]=k[3]}get(c,k){return this.typedBuffer[c*this.typedBufferStride+k]}set(c,k,m){this.typedBuffer[c*this.typedBufferStride+k]=m}setValues(c,k,m,d,f){c*=this.typedBufferStride;this.typedBuffer[c++]=k;this.typedBuffer[c++]=m;this.typedBuffer[c++]=d;this.typedBuffer[c]=
f}copyFrom(c,k,m){const d=this.typedBuffer,f=k.typedBuffer;c*=this.typedBufferStride;k=m*k.typedBufferStride;d[c++]=f[k++];d[c++]=f[k++];d[c++]=f[k++];d[c]=f[k]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;a.BufferViewVec4Impl=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(ba,X,da){function ha(ea,ca){ea>ca&&([ea,ca]=[ca,ea]);const W=ea.toString()+"."+ca.toString();if(Z[W])return Z[W];let Y=fa.length;fa.length+=3;y.add(fa,3*ea,fa,3*ca,fa,Y);y.scale(fa,Y,ba/y.length(fa,Y));Y/=3;return Z[W]=Y}let fa;da?(fa=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],da=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(da=ba*(1+Math.sqrt(5))/2,fa=[-ba,da,0,ba,da,0,-ba,-da,0,ba,-da,0,0,-ba,da,0,ba,da,0,-ba,-da,0,ba,-da,da,0,-ba,da,0,ba,
-da,0,-ba,-da,0,ba],da=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var aa=0;aa<fa.length;aa+=3)y.scale(fa,aa,ba/y.length(fa,aa));let Z={};for(aa=0;aa<X;aa++){const ea=da.length,ca=Array(4*ea);for(let W=0;W<ea;W+=3){const Y=da[W],ja=da[W+1],oa=da[W+2],ra=ha(Y,ja),ta=ha(ja,oa),ya=ha(oa,Y),Ca=4*W;ca[Ca]=Y;ca[Ca+1]=ra;ca[Ca+2]=ya;ca[Ca+3]=ja;ca[Ca+4]=ta;ca[Ca+5]=ra;ca[Ca+6]=oa;ca[Ca+7]=ya;ca[Ca+8]=ta;ca[Ca+9]=
ra;ca[Ca+10]=ta;ca[Ca+11]=ya}da=ca;Z={}}X=d.floatArrayFrom(fa);for(aa=0;aa<X.length;aa+=3)y.normalize(X,aa);return[[q.VertexAttribute.POSITION,new n.Attribute(d.floatArrayFrom(fa),da,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(X,da,3,!0)]]}function p(ba,X,da,ha,fa,aa,Z=c.fromValues(0,0,0)){var ea=X.length;const ca=d.newFloatArray(da.length*ea*3+(6*ha.length||0)),W=d.newFloatArray(da.length*ea*3+(ha?6:0)),Y=[],ja=[];let oa=0;var ra=0;const ta=k.create(),ya=k.create(),Ca=k.create(),pa=k.create(),
wa=k.create(),Ba=k.create(),la=k.create(),qa=k.create(),ua=k.create(),va=k.create(),Ga=k.create(),La=k.create(),Na=k.create(),Wa=g.create();h.set(ua,0,1,0);h.subtract(ya,da[1],da[0]);h.normalize(ya,ya);aa?(h.add(qa,da[0],Z),h.normalize(Ca,qa)):h.set(Ca,0,0,1);r(ya,Ca,ua,ua,wa,Ca,.99619469809);h.copy(pa,Ca);h.copy(La,wa);for(var Ia=0;Ia<ha.length;Ia++)h.scale(Ba,wa,ha[Ia][0]),h.scale(qa,Ca,ha[Ia][2]),h.add(Ba,Ba,qa),h.add(Ba,Ba,da[0]),ca[oa++]=Ba[0],ca[oa++]=Ba[1],ca[oa++]=Ba[2];W[ra++]=-ya[0];W[ra++]=
-ya[1];W[ra++]=-ya[2];for(Ia=0;Ia<fa.length;Ia++)Y.push(0<fa[Ia][0]?fa[Ia][0]:-fa[Ia][0]-1+ha.length),Y.push(0<fa[Ia][1]?fa[Ia][1]:-fa[Ia][1]-1+ha.length),Y.push(0<fa[Ia][2]?fa[Ia][2]:-fa[Ia][2]-1+ha.length),ja.push(0),ja.push(0),ja.push(0);Ia=ha.length;const Oa=ha.length-1;for(let Va=0;Va<da.length;Va++){let Ra=!1;0<Va&&(h.copy(ta,ya),Va<da.length-1?(h.subtract(ya,da[Va+1],da[Va]),h.normalize(ya,ya)):Ra=!0,h.add(va,ta,ya),h.normalize(va,va),h.add(Ga,da[Va-1],pa),g.fromPositionAndNormal(da[Va],va,
Wa),g.intersectRay(Wa,e.wrap(Ga,ta),qa)?(h.subtract(qa,qa,da[Va]),h.normalize(Ca,qa),h.cross(wa,va,Ca),h.normalize(wa,wa)):r(va,pa,La,ua,wa,Ca,.99619469809),h.copy(pa,Ca),h.copy(La,wa));aa&&(h.add(qa,da[Va],Z),h.normalize(Na,qa));for(let bb=0;bb<ea;bb++)if(h.scale(Ba,wa,X[bb][0]),h.scale(qa,Ca,X[bb][1]),h.add(Ba,Ba,qa),h.normalize(la,Ba),W[ra++]=la[0],W[ra++]=la[1],W[ra++]=la[2],h.add(Ba,Ba,da[Va]),ca[oa++]=Ba[0],ca[oa++]=Ba[1],ca[oa++]=Ba[2],!Ra){var Ua=(bb+1)%ea;Y.push(Ia+bb);Y.push(Ia+ea+bb);Y.push(Ia+
Ua);Y.push(Ia+Ua);Y.push(Ia+ea+bb);Y.push(Ia+ea+Ua);for(Ua=0;6>Ua;Ua++)ja.push(Y[Y.length-6+Ua]-Oa)}Ia+=ea}X=da[da.length-1];for(da=0;da<ha.length;da++)h.scale(Ba,wa,ha[da][0]),h.scale(qa,Ca,ha[da][1]),h.add(Ba,Ba,qa),h.add(Ba,Ba,X),ca[oa++]=Ba[0],ca[oa++]=Ba[1],ca[oa++]=Ba[2];ha=ra/3;W[ra++]=ya[0];W[ra++]=ya[1];W[ra++]=ya[2];ea=Ia-ea;for(ra=0;ra<fa.length;ra++)Y.push(0<=fa[ra][0]?Ia+fa[ra][0]:-fa[ra][0]-1+ea),Y.push(0<=fa[ra][2]?Ia+fa[ra][2]:-fa[ra][2]-1+ea),Y.push(0<=fa[ra][1]?Ia+fa[ra][1]:-fa[ra][1]-
1+ea),ja.push(ha),ja.push(ha),ja.push(ha);fa=[[q.VertexAttribute.POSITION,new n.Attribute(ca,Y,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(W,ja,3,!0)]];return new x.Geometry(ba,fa)}function t(ba,X,da,ha,fa){if(Math.abs(h.dot(X,ba))>fa)return!1;h.cross(da,ba,X);h.normalize(da,da);h.cross(ha,da,ba);h.normalize(ha,ha);return!0}function r(ba,X,da,ha,fa,aa,Z){return t(ba,X,fa,aa,Z)||t(ba,da,fa,aa,Z)||t(ba,ha,fa,aa,Z)}const y=l.Vec3Compact,D=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,
-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],E=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],B=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],F=Array(36);for(l=0;6>l;l++)for(var G=0;6>G;G++)F[6*l+G]=l;const H=Array(36);for(l=0;6>l;l++)H[6*l]=0,H[6*l+1]=1,H[6*l+2]=2,H[6*l+3]=2,H[6*l+4]=3,H[6*l+5]=0;const L=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],C=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],z=[5,1,0,5,2,1,5,3,2,5,0,3,4,
0,1,4,1,2,4,2,3,4,3,0],J=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];l=c.fromValues(-.5,0,-.5);G=c.fromValues(.5,0,-.5);const K=c.fromValues(0,0,.5),I=c.fromValues(0,.5,0),M=c.create(),S=c.create(),N=c.create(),V=c.create(),Q=c.create();h.subtract(M,l,I);h.subtract(S,l,G);h.cross(N,M,S);h.normalize(N,N);h.subtract(M,G,I);h.subtract(S,G,K);h.cross(V,M,S);h.normalize(V,V);h.subtract(M,K,I);h.subtract(S,K,l);h.cross(Q,M,S);h.normalize(Q,Q);const T=[l,G,K,I],ia=[0,-1,0,N[0],N[1],N[2],V[0],V[1],
V[2],Q[0],Q[1],Q[2]],O=[0,1,2,3,1,0,3,2,1,3,0,2],U=[0,0,0,1,1,1,2,2,2,3,3,3],P=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],R=k.create();a.cgToGIS=function(ba,X=ba){var da=ba.attributes;ba=da.get(q.VertexAttribute.POSITION).data;if(da=da.get(q.VertexAttribute.NORMAL).data){var ha=X.getMutableAttribute(q.VertexAttribute.NORMAL).data;for(let fa=0;fa<da.length;fa+=3){const aa=da[fa+1];ha[fa+1]=-da[fa+2];ha[fa+2]=aa}}if(ba)for(X=X.getMutableAttribute(q.VertexAttribute.POSITION).data,da=0;da<ba.length;da+=3)ha=
ba[da+1],X[da+1]=-ba[da+2],X[da+2]=ha};a.createBoxGeometry=function(ba,X){Array.isArray(X)||(X=[X,X,X]);const da=Array(24);for(let ha=0;8>ha;ha++)da[3*ha]=D[ha][0]*X[0],da[3*ha+1]=D[ha][1]*X[1],da[3*ha+2]=D[ha][2]*X[2];return new x.Geometry(ba,[[q.VertexAttribute.POSITION,new n.Attribute(da,B,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(E,F,3)],[q.VertexAttribute.UV0,new n.Attribute(A,H,2)]])};a.createConeGeometry=function(ba,X,da,ha,fa,aa=!0,Z=!0){let ea=0;var ca=c.fromValues(0,ea,0),W=c.fromValues(0,
ea+X,0),Y=c.fromValues(0,-1,0),ja=c.fromValues(0,1,0);fa&&(ea=X,W=c.fromValues(0,0,0),ca=c.fromValues(0,ea,0),Y=c.fromValues(0,1,0),ja=c.fromValues(0,-1,0));ca=[W,ca];Y=[Y,ja];ja=ha+2;W=Math.sqrt(X*X+da*da);if(fa)for(fa=ha-1;0<=fa;fa--){var oa=2*Math.PI/ha*fa,ra=c.fromValues(Math.cos(oa)*da,ea,Math.sin(oa)*da);ca.push(ra);oa=c.fromValues(X*Math.cos(oa)/W,-da/W,X*Math.sin(oa)/W);Y.push(oa)}else for(fa=0;fa<ha;fa++)oa=2*Math.PI/ha*fa,ra=c.fromValues(Math.cos(oa)*da,ea,Math.sin(oa)*da),ca.push(ra),oa=
c.fromValues(X*Math.cos(oa)/W,da/W,X*Math.sin(oa)/W),Y.push(oa);X=[];da=[];if(aa){for(aa=3;aa<ca.length;aa++)X.push(1),X.push(aa-1),X.push(aa),da.push(0),da.push(0),da.push(0);X.push(ca.length-1);X.push(2);X.push(1);da.push(0);da.push(0);da.push(0)}if(Z){for(Z=3;Z<ca.length;Z++)X.push(Z),X.push(Z-1),X.push(0),da.push(Z),da.push(Z-1),da.push(1);X.push(0);X.push(2);X.push(ca.length-1);da.push(1);da.push(2);da.push(Y.length-1)}Z=d.newFloatArray(3*ja);for(aa=0;aa<ja;aa++)Z[3*aa]=ca[aa][0],Z[3*aa+1]=ca[aa][1],
Z[3*aa+2]=ca[aa][2];ca=d.newFloatArray(3*ja);for(aa=0;aa<ja;aa++)ca[3*aa]=Y[aa][0],ca[3*aa+1]=Y[aa][1],ca[3*aa+2]=Y[aa][2];ca=[[q.VertexAttribute.POSITION,new n.Attribute(Z,X,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(ca,da,3,!0)]];return new x.Geometry(ba,ca)};a.createCylinderGeometry=function(ba,X,da,ha,fa,aa,Z){fa=fa?c.clone(fa):c.fromValues(1,0,0);aa=aa?c.clone(aa):c.fromValues(0,0,0);Z??=!0;var ea=c.create();h.normalize(ea,fa);var ca=c.create();h.scale(ca,ea,Math.abs(X));var W=c.create();
h.scale(W,ca,-.5);h.add(W,W,aa);const Y=c.fromValues(0,1,0);.2>Math.abs(1-h.dot(ea,Y))&&h.set(Y,0,0,1);const ja=c.create();h.cross(ja,ea,Y);h.normalize(ja,ja);h.cross(Y,ja,ea);X=2*ha+(Z?2:0);aa=ha+(Z?2:0);fa=d.newFloatArray(3*X);const oa=d.newFloatArray(3*aa),ra=d.newFloatArray(2*X),ta=Array(3*ha*(Z?4:2)),ya=Array(3*ha*(Z?4:2));Z&&(fa[3*(X-2)]=W[0],fa[3*(X-2)+1]=W[1],fa[3*(X-2)+2]=W[2],ra[2*(X-2)]=0,ra[2*(X-2)+1]=0,fa[3*(X-1)]=fa[3*(X-2)]+ca[0],fa[3*(X-1)+1]=fa[3*(X-2)+1]+ca[1],fa[3*(X-1)+2]=fa[3*
(X-2)+2]+ca[2],ra[2*(X-1)]=1,ra[2*(X-1)+1]=1,oa[3*(aa-2)]=-ea[0],oa[3*(aa-2)+1]=-ea[1],oa[3*(aa-2)+2]=-ea[2],oa[3*(aa-1)]=ea[0],oa[3*(aa-1)+1]=ea[1],oa[3*(aa-1)+2]=ea[2]);ea=0;const Ca=c.create(),pa=c.create();for(let qa=0;qa<ha;qa++){var wa=2*Math.PI/ha*qa;h.scale(Ca,Y,Math.sin(wa));h.scale(pa,ja,Math.cos(wa));h.add(Ca,Ca,pa);oa[3*qa]=Ca[0];oa[3*qa+1]=Ca[1];oa[3*qa+2]=Ca[2];h.scale(Ca,Ca,da);h.add(Ca,Ca,W);fa[3*qa]=Ca[0];fa[3*qa+1]=Ca[1];fa[3*qa+2]=Ca[2];ra[2*qa]=qa/ha;ra[2*qa+1]=0;fa[3*(qa+ha)]=
fa[3*qa]+ca[0];fa[3*(qa+ha)+1]=fa[3*qa+1]+ca[1];fa[3*(qa+ha)+2]=fa[3*qa+2]+ca[2];ra[2*(qa+ha)]=qa/ha;ra[2*qa+1]=1;wa=(qa+1)%ha;var Ba=ea++,la=qa;ta[Ba]=qa;ya[Ba]=la;Ba=ea++;la=qa;ta[Ba]=qa+ha;ya[Ba]=la;Ba=ea++;la=wa;ta[Ba]=wa;ya[Ba]=la;Ba=ea++;la=wa;ta[Ba]=wa;ya[Ba]=la;Ba=ea++;la=qa;ta[Ba]=qa+ha;ya[Ba]=la;Ba=ea++;la=wa;ta[Ba]=wa+ha;ya[Ba]=la}if(Z){for(da=0;da<ha;da++)Z=(da+1)%ha,ca=ea++,W=aa-2,ta[ca]=X-2,ya[ca]=W,ca=ea++,W=aa-2,ta[ca]=da,ya[ca]=W,ca=ea++,W=aa-2,ta[ca]=Z,ya[ca]=W;for(da=0;da<ha;da++)Z=
(da+1)%ha,ca=ea++,W=aa-1,ta[ca]=da+ha,ya[ca]=W,ca=ea++,W=aa-1,ta[ca]=X-1,ya[ca]=W,ca=ea++,W=aa-1,ta[ca]=Z+ha,ya[ca]=W}ha=[[q.VertexAttribute.POSITION,new n.Attribute(fa,ta,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(oa,ya,3,!0)],[q.VertexAttribute.UV0,new n.Attribute(ra,ta,2,!0)]];return new x.Geometry(ba,ha)};a.createDiamondGeometry=function(ba,X){Array.isArray(X)||(X=[X,X,X]);const da=Array(18);for(let ha=0;6>ha;ha++)da[3*ha]=L[ha][0]*X[0],da[3*ha+1]=L[ha][1]*X[1],da[3*ha+2]=L[ha][2]*X[2];
return new x.Geometry(ba,[[q.VertexAttribute.POSITION,new n.Attribute(da,z,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(C,J,3)]])};a.createExtrudedTriangle=function(ba,X,da,ha,fa,aa=0){const Z=Array(18);X=[[-da,aa,fa/2],[ha,aa,fa/2],[0,X+aa,fa/2],[-da,aa,-fa/2],[ha,aa,-fa/2],[0,X+aa,-fa/2]];for(da=0;6>da;da++)Z[3*da]=X[da][0],Z[3*da+1]=X[da][1],Z[3*da+2]=X[da][2];return new x.Geometry(ba,[[q.VertexAttribute.POSITION,new n.Attribute(Z,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};
a.createPathExtrusionGeometry=p;a.createPointGeometry=function(ba,X,da,ha,fa,aa,Z,ea,ca=null){da=da?k.clone(da):k.create();X=X?k.clone(X):k.fromValues(0,0,1);Z??=b.create();ha=ha?[255*ha[0],255*ha[1],255*ha[2],3<ha.length?255*ha[3]:255]:[255,255,255,255];const W=null!=fa&&2===fa.length?fa:[1,1];fa=f.getZeroIndexArray(1);Z=[[q.VertexAttribute.POSITION,new n.Attribute(da,fa,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(X,fa,3,!0)],[q.VertexAttribute.UV0,new n.Attribute(Z,fa,Z.length)],[q.VertexAttribute.COLOR,
new n.Attribute(ha,fa,4,!0)],[q.VertexAttribute.SIZE,new n.Attribute(W,fa,2)]];null!=aa&&(aa=[aa[0],aa[1],aa[2],aa[3]],Z.push([q.VertexAttribute.CENTEROFFSETANDDISTANCE,new n.Attribute(aa,fa,4)]));ea&&Z.push([q.VertexAttribute.FEATUREATTRIBUTE,new n.Attribute([ea[0],ea[1],ea[2],ea[3]],fa,4)]);return new x.Geometry(ba,Z,null,u.ContentObjectType.Point,ca)};a.createPolySphereData=v;a.createPolySphereGeometry=function(ba,X,da,ha){X=v(X,da,ha);return new x.Geometry(ba,X)};a.createPolylineGeometry=function(ba,
X,da,ha){w.assert(1<X.length,"createPolylineGeometry(): polyline needs at least 2 points");w.assert(3===X[0].length,"createPolylineGeometry(): malformed vertex");w.assert(null==da||da.length===X.length,"createPolylineGeometry: need same number of points and normals");w.assert(null==da||3===da[0].length,"createPolylineGeometry(): malformed normal");var fa=m.newDoubleArray(3*X.length);const aa=Array(2*(X.length-1));var Z=0,ea=0;for(var ca=0;ca<X.length;ca++){for(var W=0;3>W;W++)fa[Z++]=X[ca][W];0<ca&&
(aa[ea++]=ca-1,aa[ea++]=ca)}fa=[[q.VertexAttribute.POSITION,new n.Attribute(fa,aa,3,!0)]];if(da){Z=d.newFloatArray(3*da.length);ea=0;for(ca=0;ca<X.length;ca++)for(W=0;3>W;W++)Z[ea++]=da[ca][W];fa.push([q.VertexAttribute.NORMAL,new n.Attribute(Z,aa,3,!0)])}ha&&fa.push([q.VertexAttribute.COLOR,new n.Attribute(ha,f.getContinuousIndexArray(ha.length/4),4)]);return new x.Geometry(ba,fa,null,u.ContentObjectType.Line)};a.createSphereGeometry=function(ba,X,da,ha,fa={uv:!0}){var aa=-Math.PI,Z=2*Math.PI,ea=
-Math.PI/2,ca=Math.PI;da=Math.max(3,Math.floor(da));ha=Math.max(2,Math.floor(ha));var W=(da+1)*(ha+1);const Y=d.newFloatArray(3*W),ja=d.newFloatArray(3*W);W=d.newFloatArray(2*W);const oa=[];var ra=0;for(var ta=0;ta<=ha;ta++){const Ca=[],pa=ta/ha,wa=ea+pa*ca,Ba=Math.cos(wa);for(let la=0;la<=da;la++){const qa=la/da;var ya=aa+qa*Z;const ua=Math.cos(ya)*Ba,va=Math.sin(wa);ya=-Math.sin(ya)*Ba;Y[3*ra]=ua*X;Y[3*ra+1]=va*X;Y[3*ra+2]=ya*X;ja[3*ra]=ua;ja[3*ra+1]=va;ja[3*ra+2]=ya;W[2*ra]=qa;W[2*ra+1]=pa;Ca.push(ra);
++ra}oa.push(Ca)}X=[];for(aa=0;aa<ha;aa++)for(Z=0;Z<da;Z++)ea=oa[aa][Z],ca=oa[aa][Z+1],ra=oa[aa+1][Z+1],ta=oa[aa+1][Z],0===aa?(X.push(ea),X.push(ra),X.push(ta)):aa===ha-1?(X.push(ea),X.push(ca),X.push(ra)):(X.push(ea),X.push(ca),X.push(ra),X.push(ra),X.push(ta),X.push(ea));da=[[q.VertexAttribute.POSITION,new n.Attribute(Y,X,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(ja,X,3,!0)]];fa.uv&&da.push([q.VertexAttribute.UV0,new n.Attribute(W,X,2,!0)]);fa.offset&&(da[0][0]=q.VertexAttribute.OFFSET,da.push([q.VertexAttribute.POSITION,
new n.Attribute(Float64Array.from(fa.offset),f.getZeroIndexArray(X.length),3,!0)]));return new x.Geometry(ba,da)};a.createSquareGeometry=function(ba,X=P){var da=Array(12);for(var ha=0;4>ha;ha++)for(let fa=0;3>fa;fa++)da[3*ha+fa]=X[ha][fa];X=[0,1,2,2,3,0];ha=[0,0,0,0,0,0];da=[[q.VertexAttribute.POSITION,new n.Attribute(da,X,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute([0,0,1],ha,3,!0)],[q.VertexAttribute.UV0,new n.Attribute([0,0,1,0,1,1,0,1],X,2,!0)],[q.VertexAttribute.COLOR,new n.Attribute([255,
255,255,255],ha,4,!0)]];return new x.Geometry(ba,da)};a.createTetrahedronGeometry=function(ba,X){Array.isArray(X)||(X=[X,X,X]);const da=Array(12);for(let ha=0;4>ha;ha++)da[3*ha]=T[ha][0]*X[0],da[3*ha+1]=T[ha][1]*X[1],da[3*ha+2]=T[ha][2]*X[2];return new x.Geometry(ba,[[q.VertexAttribute.POSITION,new n.Attribute(da,O,3,!0)],[q.VertexAttribute.NORMAL,new n.Attribute(ia,U,3)]])};a.createTubeGeometry=function(ba,X,da,ha,fa,aa){ha=ha||10;fa=null!=fa?fa:!0;w.assert(1<X.length);const Z=[],ea=[];for(let ca=
0;ca<ha;ca++){Z.push([0,-ca-1,-((ca+1)%ha)-1]);const W=ca/ha*2*Math.PI;ea.push([Math.cos(W)*da,Math.sin(W)*da])}return p(ba,ea,X,[[0,0,0]],Z,fa,aa)};a.makeOrthoBasisDirUpFallback=r;a.transformInPlace=function(ba,X){ba=ba.getMutableAttribute(q.VertexAttribute.POSITION).data;for(let da=0;da<ba.length;da+=3)h.set(R,ba[da],ba[da+1],ba[da+2]),h.transformMat4(R,R,X),ba[da]=R[0],ba[da+1]=R[1],ba[da+2]=R[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports",
"../../core/typedArrayUtil"],function(a,b){a.copyInto=function(h,c){for(let k=0;k<c.length;++k)h[k]=c[k];return h};a.doubleArrayFrom=function(h){return(b.isArray(h)?h.length:h.byteLength/8)<=b.nativeArrayMaxSize?Array.from(h):new Float64Array(h)};a.doubleSubArray=function(h,c,k){return Array.isArray(h)?h.slice(c,c+k):h.subarray(c,c+k)};a.newDoubleArray=function(h,c=!1){return h<=b.nativeArrayMaxSize?c?Array(h).fill(0):Array(h):new Float64Array(h)};a.toFloat64Array=function(h){return Array.isArray(h)?
new Float64Array(h):h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.compactFloatArray=function(h){return b.isArray(h)?h.length<b.nativeArrayMaxSize?h:new Float32Array(h):h.length<b.nativeArrayMaxSize?Array.from(h):h};a.floatArrayFrom=function(h){return(b.isArray(h)?h.length:h.byteLength/8)<=b.nativeArrayMaxSize?Array.from(h):new Float32Array(h)};a.floatSubArray=function(h,
c,k){return Array.isArray(h)?h.slice(c,c+k):h.subarray(c,c+k)};a.newFloatArray=function(h,c=!1){return h<=b.nativeArrayMaxSize?c?Array(h).fill(0):Array(h):new Float32Array(h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){function h(e){let n=!0;for(const l of e){if(65536<=l)return b.isArray(e)?new Uint32Array(e):e;256<=l&&(n=!1)}return n?new Uint8Array(e):new Uint16Array(e)}function c(e){if(1===
e)return d;if(e<b.nativeArrayMaxSize)return Array.from(new Uint16Array(f.buffer,0,e));if(e<f.length)return new Uint16Array(f.buffer,0,e);if(e>m.length){m=new Uint32Array(Math.max(2*m.length,e));for(let n=0;n<m.length;n++)m[n]=n}return new Uint32Array(m.buffer,0,e)}function k(e){if(1===e)return d;if(e<b.nativeArrayMaxSize)return Array(e).fill(0);e>g.length&&(g=new Uint8Array(Math.max(2*g.length,e)));return new Uint8Array(g.buffer,0,e)}let m=(()=>{const e=new Uint32Array(131072);for(let n=0;n<e.length;++n)e[n]=
n;return e})();const d=[0],f=(()=>{const e=new Uint16Array(65536);for(let n=0;n<e.length;++n)e[n]=n;return e})();let g=new Uint8Array(65536);a.compactIndices=function(e){if(b.isArray(e)){if(e.length<b.nativeArrayMaxSize)return e}else if(e.length<b.nativeArrayMaxSize)return Array.from(e);let n=!0,l=!0;e.some((u,x)=>{n=n&&0===u;l=l&&u===x;return!n&&!l});return n?k(e.length):l?c(e.length):b.isArray(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?h(e):e};a.getContinuousIndexArray=c;a.getZeroIndexArray=
k;a.newIndexArray=function(e){return e<=b.nativeArrayMaxSize?Array(e):65536>=e?new Uint16Array(e):new Uint32Array(e)};a.newIntArray=function(e){return e<=b.nativeArrayMaxSize?Array(e):new Uint32Array(e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(h,c){const k=h[c],m=h[c+1];h=h[c+2];return Math.sqrt(k*k+m*m+h*h)};b.normalize=function(h,
c){var k=h[c];const m=h[c+1],d=h[c+2];k=1/Math.sqrt(k*k+m*m+d*d);h[c]*=k;h[c+1]*=k;h[c+2]*=k};b.scale=function(h,c,k){h[c]*=k;h[c+1]*=k;h[c+2]*=k};b.add=function(h,c,k,m,d,f=c){d=d||h;d[f]=h[c]+k[m];d[f+1]=h[c+1]+k[m+1];d[f+2]=h[c+2]+k[m+2]};b.subtract=function(h,c,k,m,d,f=c){d=d||h;d[f]=h[c]-k[m];d[f+1]=h[c+1]-k[m+1];d[f+2]=h[c+2]-k[m+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],
function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends f.ContentObject{constructor(q,v,p=null,t=g.ContentObjectType.Mesh,r=null,y=-1){super();this.material=q;this.mapPositions=p;this.type=t;this.objectAndLayerIdColor=r;this.edgeIndicesLength=y;this.visible=!0;this._attributes=new Map;this._boundingInfo=null;for(const [D,E]of v)this._attributes.set(D,{...E,indices:c.compactIndices(E.indices)}),D===u.VertexAttribute.POSITION&&(this.edgeIndicesLength=0>this.edgeIndicesLength?this._attributes.get(D).indices.length:
this.edgeIndicesLength)}instantiate(q={}){const v=new w(q.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);this._attributes.forEach((p,t)=>{p.exclusive=!1;v._attributes.set(t,p)});v._boundingInfo=this._boundingInfo;v.transformation=q.transformation||this.transformation;return v}get attributes(){return this._attributes}getMutableAttribute(q){let v=this._attributes.get(q);v&&!v.exclusive&&(v={...v,exclusive:!0,data:k.cloneAttributeData(v.data)},
this._attributes.set(q,v));return v}setAttributeData(q,v){const p=this._attributes.get(q);p&&this._attributes.set(q,{...p,exclusive:!0,data:v})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}computeAttachmentOrigin(q){return(this.type===g.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(q):
this.type===g.ContentObjectType.Line?this._computeAttachmentOriginLines(q):this._computeAttachmentOriginPoints(q))?(null!=this._transformation&&h.transformMat4(q,q,this._transformation),!0):!1}_computeAttachmentOriginTriangles(q){const v=this.attributes.get(u.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(v,q)}_computeAttachmentOriginLines(q){const v=this.attributes.get(u.VertexAttribute.POSITION);var p=e.computeAttachmentOriginLines;var t=this.material.parameters;t="isClosed"in
t&&t.isClosed?2<v.indices.length:!1;return p.call(e,v,t,q)}_computeAttachmentOriginPoints(q){const v=this.attributes.get(u.VertexAttribute.POSITION);return e.computeAttachmentOriginPoints(v,q)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const q=this.attributes.get(u.VertexAttribute.POSITION);if(!q||0===q.indices.length)return null;const v=this.type===g.ContentObjectType.Mesh?3:1;l.assert(0===q.indices.length%v,"Indexing error: "+q.indices.length+" not divisible by "+
v);const p=c.getContinuousIndexArray(q.indices.length/v);return new d.BoundingInfo(p,v,q)}get transformation(){return this._transformation??b.IDENTITY}set transformation(q){this._transformation=q&&q!==b.IDENTITY?b.clone(q):null}addHighlight(){const q=new n.Object3DStateID(m.Object3DState.Highlight);this.highlights=x.addObject3DStateID(this.highlights,q);return q}removeHighlight(q){this.highlights=x.removeObject3DStateID(this.highlights,q)}}a.Geometry=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(h){if(h.length<b.nativeArrayMaxSize)return Array.from(h);if(b.isArray(h))return Float64Array.from(h);if(!("BYTES_PER_ELEMENT"in h))return Array.from(h);switch(h.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(h);case 2:return b.isUint16Array(h)?Uint16Array.from(h):Int16Array.from(h);case 4:return Float32Array.from(h);default:case 8:return Float64Array.from(h)}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(a,b,h,c,k){class m{constructor(f,g,e){this.primitiveIndices=f;this._numIndexPerPrimitive=g;this.position=e;this._children=void 0;k.assert(1<=f.length);k.assert(3===e.size||4===e.size);const {data:n,size:l,indices:u}=e;k.assert(0===
u.length%this._numIndexPerPrimitive);k.assert(u.length>=f.length*this._numIndexPerPrimitive);var x=f.length;g=l*u[this._numIndexPerPrimitive*f[0]];d.clear();d.push(g);e=c.fromValues(n[g],n[g+1],n[g+2]);var w=c.clone(e);for(var q=0;q<x;++q){var v=this._numIndexPerPrimitive*f[q];for(var p=0;p<this._numIndexPerPrimitive;++p){g=l*u[v+p];d.push(g);let t=n[g];e[0]=Math.min(t,e[0]);w[0]=Math.max(t,w[0]);t=n[g+1];e[1]=Math.min(t,e[1]);w[1]=Math.max(t,w[1]);t=n[g+2];e[2]=Math.min(t,e[2]);w[2]=Math.max(t,w[2])}}this.bbMin=
e;this.bbMax=w;f=h.lerp(c.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(w[0]-e[0],w[1]-e[1]),w[2]-e[2]);e=this.radius*this.radius;for(w=0;w<d.length;++w)g=d.at(w),x=n[g]-f[0],q=n[g+1]-f[1],g=n[g+2]-f[2],v=x*x+q*q+g*g,v<=e||(v=Math.sqrt(v),p=.5*(v-this.radius),this.radius+=p,e=this.radius*this.radius,v=p/v,f[0]+=x*v,f[1]+=q*v,f[2]+=g*v);this.center=f;d.clear()}getChildren(){if(this._children||1>=h.squaredDistance(this.bbMin,this.bbMax))return this._children;var f=h.lerp(c.create(),
this.bbMin,this.bbMax,.5),g=this.primitiveIndices.length;const e=new Uint8Array(g),n=Array(8);for(var l=0;8>l;++l)n[l]=0;const {data:u,size:x,indices:w}=this.position;for(l=0;l<g;++l){var q=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[l];var v=x*w[p];let t=u[v],r=u[v+1],y=u[v+2];for(let D=1;D<this._numIndexPerPrimitive;++D){v=x*w[p+D];const E=u[v],A=u[v+1];v=u[v+2];E<t&&(t=E);A<r&&(r=A);v<y&&(y=v)}t<f[0]&&(q|=1);r<f[1]&&(q|=2);y<f[2]&&(q|=4);e[l]=q;++n[q]}f=0;for(l=0;8>l;++l)0<n[l]&&
++f;if(!(2>f)){f=Array(8);for(l=0;8>l;++l)f[l]=0<n[l]?new Uint32Array(n[l]):void 0;for(l=0;8>l;++l)n[l]=0;for(l=0;l<g;++l)q=e[l],f[q][n[q]++]=this.primitiveIndices[l];this._children=[];for(g=0;8>g;++g)void 0!==f[g]&&this._children.push(new m(f[g],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){d.prune()}}const d=new b({deallocator:null});a.BoundingInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports",
"../../../../core/uid"],function(a,b){class h{constructor(){this.id=b.generateUID()}}a.ContentObject=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/triangle"],function(a,b,h,c){const k=h.create(),m=h.create(),d=h.create(),f=h.create();a.computeAttachmentOriginLines=function(g,e,n){if(!g)return!1;
b.set(n,0,0,0);b.set(f,0,0,0);let l=0,u=0;const {size:x,data:w,indices:q}=g;g=q.length-1;e=g+(e?2:0);for(let p=0;p<e;p+=2){var v=q[p<g?p:g]*x;const t=q[p<g?p+1:0]*x;k[0]=w[v];k[1]=w[v+1];k[2]=w[v+2];m[0]=w[t];m[1]=w[t+1];m[2]=w[t+2];b.scale(k,b.add(k,k,m),.5);v=b.dist(k,m);0<v?(b.add(n,n,b.scale(k,k,v)),l+=v):0===l&&(b.add(f,f,k),u++)}return 0!==l?(b.scale(n,n,1/l),!0):0!==u?(b.scale(n,f,1/u),!0):!1};a.computeAttachmentOriginPoints=function(g,e){if(!g)return!1;const {size:n,data:l,indices:u}=g;b.set(e,
0,0,0);g=-1;let x=0;for(let w=0;w<u.length;w++){const q=u[w]*n;g!==q&&(e[0]+=l[q],e[1]+=l[q+1],e[2]+=l[q+2],x++);g=q}1<x&&b.scale(e,e,1/x);return 0<x};a.computeAttachmentOriginTriangles=function(g,e){if(!g)return!1;const {size:n,data:l,indices:u}=g;b.set(e,0,0,0);b.set(f,0,0,0);let x=g=0;for(let q=0;q<u.length-2;q+=3){var w=u[q]*n;const v=u[q+1]*n,p=u[q+2]*n;b.set(k,l[w],l[w+1],l[w+2]);b.set(m,l[v],l[v+1],l[v+2]);b.set(d,l[p],l[p+1],l[p+2]);(w=c.areaPoints3d(k,m,d))?(b.add(k,k,m),b.add(k,k,d),b.scale(k,
k,1/3*w),b.add(e,e,k),g+=w):(b.add(f,f,k),b.add(f,f,m),b.add(f,f,d),x+=3)}return 0===x&&0===g?!1:0!==g?(b.scale(e,e,1/g),!0):0!==x?(b.scale(e,f,1/x),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,h,c,k,m){function d(x){return x?{p0:c.clone(x.p0),p1:c.clone(x.p1),p2:c.clone(x.p2)}:
{p0:c.create(),p1:c.create(),p2:c.create()}}function f(x,w,q,v=d()){h.copy(v.p0,x);h.copy(v.p1,w);h.copy(v.p2,q);return v}function g(x,w,q){return.5*Math.abs((w[0]-x[0])*(q[1]-x[1])-(w[1]-x[1])*(q[0]-x[0]))}const e=new b.ObjectStack(k.create),n=new b.ObjectStack(()=>d()),l=c.create(),u=c.create();a.area2d=function(x){return g(x.p0,x.p1,x.p2)};a.areaPoints2d=g;a.areaPoints3d=function(x,w,q){h.subtract(l,w,x);h.subtract(u,q,x);return.5*h.length(h.cross(l,l,u))};a.copy=function(x,w=d()){return f(x.p0,
x.p1,x.p2,w)};a.create=d;a.distance2=function(x,w){var q=x.p0,v=x.p1;x=x.p2;const p=h.subtract(m.sv3d.get(),v,q),t=h.subtract(m.sv3d.get(),x,v),r=h.subtract(m.sv3d.get(),q,x),y=h.subtract(m.sv3d.get(),w,q);var D=h.subtract(m.sv3d.get(),w,v),E=h.subtract(m.sv3d.get(),w,x);const A=h.cross(p,p,r),B=h.dot(h.cross(m.sv3d.get(),p,A),y);D=h.dot(h.cross(m.sv3d.get(),t,A),D);E=h.dot(h.cross(m.sv3d.get(),r,A),E);if(0<B&&0<D&&0<E)return w=h.dot(A,y),w*w/h.dot(A,A);q=k.distance2(k.fromValues(q,p,e.get()),w);
v=k.distance2(k.fromValues(v,t,e.get()),w);w=k.distance2(k.fromValues(x,r,e.get()),w);return Math.min(q,v,w)};a.fromValues=f;a.intersectRay=function(x,w,q){const {direction:v,origin:p}=w,{p0:t,p1:r,p2:y}=x;var D=r[0]-t[0],E=r[1]-t[1],A=r[2]-t[2];x=y[0]-t[0];w=y[1]-t[1];const B=y[2]-t[2];var F=v[1]*B-w*v[2],G=v[2]*x-B*v[0];const H=v[0]*w-x*v[1];var L=D*F+E*G+A*H;if(-1E-5<L&&1E-5>L)return!1;L=1/L;const C=p[0]-t[0],z=p[1]-t[1],J=p[2]-t[2];F=L*(C*F+z*G+J*H);if(0>F||1<F)return!1;G=z*A-E*J;A=J*D-A*C;D=
C*E-D*z;E=L*(v[0]*G+v[1]*A+v[2]*D);if(0>E||1<F+E)return!1;q&&(h.scale(q,v,L*(x*G+w*A+B*D)),h.add(q,p,q));return!0};a.wrap=function(x,w,q){const v=n.get();v.p0=x;v.p1=w;v.p2=q;return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){class h{constructor(c){this.channel=c;this.id=b.generateUID()}}a.Object3DStateID=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,b,h){const c=b.create(),k=new Float32Array(6);a.addObject3DStateID=function(m,d){null==m&&(m=[]);m.push(d);return m};a.encodeDoubleVec3=function(m,d,f,g,e){c[0]=m.get(d,0);c[1]=m.get(d,1);c[2]=m.get(d,2);h.encodeDoubleArray(c,k,3);f.set(e,0,k[0]);g.set(e,0,k[1]);f.set(e,1,k[2]);g.set(e,1,k[3]);f.set(e,2,k[4]);
g.set(e,2,k[5])};a.removeObject3DStateID=function(m,d){if(null==m)return null;m=m.filter(f=>f!==d);return 0===m.length?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){function C(V,Q,T,ia,O){const U=d.length(V),P=ia*Math.sqrt(U*U-ia*ia)/U,R=O.v1,ba=O.v2;d.scale(O.center,V,Math.sqrt(ia*ia-P*P)/U);d.cross(R,V,Q);1>d.squaredLength(R)&&d.cross(R,V,T);d.scale(R,R,P/d.length(R));d.cross(ba,R,V);d.scale(ba,ba,P/d.length(ba));return P}const z=-l.innerAtmosphereDepth,J=v.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);class K{constructor(V,Q){this.view=V;this.type=
n.AtmosphereType.Mars;this._passParameters=new u.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;V=g.getReferenceEllipsoid(V.spatialReference);this._planetRadius=V.radius;this._outerRimWidth=V.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+z)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=this._texV1-
this._texV0;this._techniqueRepository=Q.techniqueRepository;V=Q.renderContext.rctx;this._cameraChangeHandle=h.watch(()=>this.view.state?.camera,()=>Q.requestRender(),h.syncAndInitial);this._vao=this._createRibbon(V);this._vaoCount=L.vertexCount(this._vao,"geometry");this._fadeVao=y.createQuadVAO(V);this._fadeVaoCount=L.vertexCount(this._fadeVao,"geometry");const T=new H.TextureDescriptor;T.wrapMode=F.TextureWrapMode.CLAMP_TO_EDGE;T.flipped=!0;T.width=1;T.height=512;this._passParameters.texture=new G.Texture(V,
T,q.marsAtmosphereTextureSimple);V=new w.SimpleAtmosphereTechniqueConfiguration;V.geometry=w.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(x.SimpleAtmosphereTechnique,V);V.geometry=w.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(x.SimpleAtmosphereTechnique,V)}destroy(){this._coneTechnique.release();this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);
this._fadeVao.dispose();this._vao.dispose()}render(V){this._update(V.bindParameters.camera);const Q=V.rctx;1>this._passParameters.undergroundFadeAlpha&&(Q.bindTechnique(this._coneTechnique,V.bindParameters,this._passParameters),Q.bindVAO(this._vao),Q.drawArrays(F.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(Q.bindTechnique(this._undergroundTechnique,V.bindParameters,this._passParameters),Q.bindVAO(this._fadeVao),Q.drawArrays(F.PrimitiveType.TRIANGLE_STRIP,
0,this._fadeVaoCount))}renderHaze(){}_update(V){var Q=f.create();const T=this._planetRadius;var ia=d.length(V.eye);const O=ia-T;this._passParameters.undergroundFadeAlpha=0>O?Math.min(-O/5E3,1):0;var U=T+z,P=T+Math.max(50,O);this._passParameters.innerScale=P*P/(Math.sqrt(P*P-T*T)*Math.sqrt(P*P-U*U)+T*U)-1;this._passParameters.altitudeFade=l.computeInnerAltitudeFade(O);d.scale(Q,V.eye,(T+50)/ia);C(Q,V.center,V.up,T,this._passParameters.silhouette);Q=this._computeScreenRimWidth(V,Q,V.up,this._passParameters.silhouette);
ia=J(O);U=this._texV0+.001953125*this._texVScale;P=this._texV0+Q*ia*this._texVScale;50<O&&(C(V.eye,V.center,V.up,T,this._passParameters.silhouette),V=this._computeScreenRimWidth(V,V.eye,V.up,this._passParameters.silhouette),V=a.clamp((V-1.5)/(Q-1.5),0,1),U=this._texV0+.001953125*V*this._texVScale,P=this._texV0+a.lerp(this._texV1,Q*ia,V)*this._texVScale);m.set(this._passParameters.texV,U,P)}_createRibbon(V){const Q=e.newFloatArray(1155),T=new Uint32Array(1920);Q[0]=0;Q[1]=0;Q[2]=-1;for(var ia=0;128>
ia;ia++){var O=9*ia+3;Q[O]=ia;Q[O+1]=this._innerRimFactor;Q[O+2]=-1;Q[O+3]=ia;Q[O+4]=this._middleRimFactor;Q[O+5]=0;Q[O+6]=ia;Q[O+7]=this._outerRimFactor;Q[O+8]=1;O=3*ia+1;var U=127===ia?1:O+3,P=15*ia;T[P]=O;T[P+1]=O+1;T[P+2]=U+1;T[P+3]=U+1;T[P+4]=U;T[P+5]=O;T[P+6]=O+1;T[P+7]=O+2;T[P+8]=U+2;T[P+9]=U+2;T[P+10]=U+1;T[P+11]=O+1;T[P+12]=O;T[P+13]=U;T[P+14]=0}ia=N.createBuffer(T.length);O=ia.position;for(U=0;U<T.length;++U)P=3*T[U],O.set(U,0,Q[P]),O.set(U,1,Q[P+1]),O.set(U,2,Q[P+2]);return new E.VertexArrayObject(V,
r.Default3D,{geometry:p.glLayout(N)},{geometry:B.BufferObject.createVertex(V,F.Usage.STATIC_DRAW,ia.buffer)})}_computeScreenRimWidth(V,Q,T,ia){d.add(M,ia.center,ia.v2);d.scale(S,M,this._outerRimFactor);c.lookAt(I,Q,M,T);D.project(M,I,V.projectionMatrix,V.viewport,M);D.project(S,I,V.projectionMatrix,V.viewport,S);return d.distance(M,S)/V.height}}const I=k.create(),M=f.create(),S=f.create(),N=t.newLayout().vec3f(A.VertexAttribute.POSITION);return K})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,
0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,
6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,
4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,
11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,
118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,
138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,
28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,
96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,
61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,
87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,
221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,
212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){a.Precipitation=class extends h{constructor(F){super(F);this._numParticles=25E4;this._rainSpeed=.1;this._snowSpeed=.01;this._passParameters=new x.PrecipitationPassParameters;this._animation=new p.AnimationTimer;this._updatingTracking=new l.UpdatingHandles;this._passParameters.time=0;this._passParameters.radius=u.getReferenceEllipsoid(F.view.spatialReference).radius;this._techniqueRepository=F.context.techniqueRepository}destroy(){this._updatingTracking.destroy();
this._numParticles=0;this._snowTechniqueCached=k.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=k.releaseMaybe(this._rainTechniqueCached);this._vao=k.disposeMaybe(this._vao);this._instanceIdBuffer=k.disposeMaybe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(null==this._rainTechniqueCached){const F=new w.PrecipitationTechniqueConfiguration;F.type=w.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(x.PrecipitationTechnique,
F)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const F=new w.PrecipitationTechniqueConfiguration;F.type=w.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(x.PrecipitationTechnique,F)}return this._snowTechniqueCached}update(F){return this._animation.advance(F)}render(F,G,H){const L="rainy"===H?this._rainTechnique:this._snowTechnique;if(L.compiled){var C=F.rctx;this._ensureResources(C);null!=L&&null!=this._vao&&null!=this._instanceIdBuffer&&
(null!=F.bindParameters.cloudsFade.data&&(this._passParameters.opacity=F.bindParameters.cloudsFade.opacity),0>=this._passParameters.opacity||(G=.5>G?c.lerp(0,.35,2*G):c.lerp(.35,1,2*(G-.5)),this._passParameters.time=("rainy"===H?this._rainSpeed:this._snowSpeed)*m.secondsFromMilliseconds(this._animation.time)%1E5,F=C.bindTechnique(L,F.bindParameters,this._passParameters),C.bindVAO(this._vao),F.assertCompatibleVertexAttributeLocations(this._vao),E.bindVertexBufferLayout(C,x.attributeLocations,this._instanceIdBuffer,
B,0),C.drawArraysInstanced(D.PrimitiveType.TRIANGLES,0,3,this._numParticles*G),E.unbindVertexBufferLayout(C,x.attributeLocations,this._instanceIdBuffer,B)))}else this.context.requestRender()}_ensureResources(F){null==this._vao&&(this._vao=this._createVertexArrayObject(F));null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(F))}_createInstanceIndices(F){const G=[];for(let H=0;H<this._numParticles;H++)G.push(H);return y.BufferObject.createVertex(F,D.Usage.STATIC_DRAW,new Float32Array(G))}_createVertexArrayObject(F){const G=
new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new t.VertexArrayObject(F,x.attributeLocations,{geometry:q.glLayout(A)},{geometry:y.BufferObject.createVertex(F,D.Usage.STATIC_DRAW,G)})}};b.__decorate([d.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);b.__decorate([d.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);b.__decorate([d.property()],a.Precipitation.prototype,
"_updatingTracking",void 0);a.Precipitation=b.__decorate([n.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const A=v.newLayout().vec3f(r.VertexAttribute.POSITION),B=q.glLayout(v.newLayout().f32(r.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends c.NoParameters{constructor(){super(...arguments);this.time=0;this.radius=1;this.width=500;this.opacity=1}}class l extends m.ShaderTechnique{initializeProgram(x){return new d.Program(x.rctx,l.shader.get().build(this.configuration),u)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:g.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams})}}l.shader=new k.ReloadableShaderModule(h.Precipitation,()=>new Promise((x,w)=>a(["./Precipitation.glsl"],x,w)));const u=new Map([[f.VertexAttribute.POSITION,0],[f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=n;b.PrecipitationTechnique=l;b.attributeLocations=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(q){const v=new g.ShaderBuilder;v.attributes.add(e.VertexAttribute.POSITION,"vec3");v.attributes.add(e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");v.vertex.uniforms.add(new k.Float3PassUniform("cameraPosition",(p,t)=>t.camera.eye));v.vertex.uniforms.add(new k.Float3PassUniform("offset",(p,t)=>{t=t.camera.eye;var r=.5*p.width;const y=1/p.width;r=b.floor(l,b.set(l,(t[0]+r)*y,(t[1]+r)*y,(t[2]+r)*y));return b.sub(r,t,b.scale(r,r,p.width))}));v.vertex.uniforms.add(new m.FloatPassUniform("width",
p=>p.width));v.vertex.uniforms.add(new f.Matrix4PassUniform("proj",(p,t)=>t.camera.projectionMatrix));v.vertex.uniforms.add(new f.Matrix4PassUniform("view",(p,t)=>t.camera.viewMatrix));v.vertex.uniforms.add(new m.FloatPassUniform("time",p=>p.time));v.varyings.add("vUv","vec2");v.vertex.code.add(d.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${q.type===c.PrecipitationType.Rain?d.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:d.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);v.fragment.uniforms.add(new m.FloatPassUniform("opacity",p=>p.opacity),new k.Float3PassUniform("particleColor",(p,t)=>{p=q.type===c.PrecipitationType.Rain?w:x;const r=b.scale(l,p,.7);b.normalize(u,t.camera.eye);t=Math.max(0,b.dot(u,t.lighting.mainLight.direction));return b.lerp(r,r,p,t)}));v.fragment.code.add(d.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${q.type===c.PrecipitationType.Rain?d.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:d.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return v}const l=h.create(),u=h.create(),x=h.fromValues(1,1,1),w=h.fromValues(.85,.85,.85);h=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));a.Precipitation=h;a.build=n})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){a.PrecipitationType=void 0;(function(k){k[k.Rain=0]="Rain";k[k.Snow=
1]="Snow";k[k.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.type=a.PrecipitationType.Rain}}b.__decorate([h.parameter({count:a.PrecipitationType.COUNT})],c.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../core/time"],function(a,
b){class h{constructor(){this.enabled=!0;this._time=b.Milliseconds(0)}get time(){return this._time}advance({deltaTime:k,fixedTime:m}){if(null!=m){if(this._time===m)return!1;this._time=m;return!0}this._time=b.Milliseconds(this._time+k);return 0!==k}}class c{constructor(k,m){this.deltaTime=k;this.fixedTime=m}}a.AnimationTimer=h;a.Parameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/support/UpdatingHandles ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){a.Stars=class extends c{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(z){super(z);this._loadDataTask=null;this._numPoints=0;this._passParameters=new p.StarPassParameters;this._updatingTracking=new v.UpdatingHandles}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=f.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=f.releaseMaybe(this._technique);this._vao=f.disposeMaybe(this._vao);C=null}render(z){const {rctx:J}=z;this._ensureResources(J);null!=this._technique&&null!=this._vao&&(this._technique.compiled?(z=J.bindTechnique(this._technique,z.bindParameters,this._passParameters),J.bindVAO(this._vao),z.assertCompatibleVertexAttributeLocations(this._vao),J.drawArrays(B.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())}_ensureResources(z){if(null==
this._technique&&null!=C){this._technique=new p.StarsTechnique({rctx:z,viewingMode:this.view.state.viewingMode});this._numPoints=C.byteLength/9;var J=new Float32Array(C,0,2*this._numPoints),K=new Uint8Array(C,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(z,J,K,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,I=>this._update(I),e.initial)}}_computeDayDuration(z){const J=new Date(z.getFullYear(),
0,1,11,58,56),K=new Date(z.getFullYear()+1,0,1,11,58,55);return(+z-+J)/(+K-+J)}_update(z){if(z){var J=z.getHours()/12,K=z.getMinutes()/60*(2/24),I=z.getSeconds()/60*(2/1440);J=(J+K+I-.9972222)%2;z=2*this._computeDayDuration(z);K=w.copy(this._passParameters.modelMatrix,H);w.rotateZ(K,K,-z*Math.PI);w.multiply(K,G,K);w.rotateZ(K,K,-J*Math.PI);this.requestRender()}}_hexToRGB(z){return[parseInt(z.substring(0,2),16),parseInt(z.substring(2,4),16),parseInt(z.substring(4,6),16)]}_unpackUint8Attributes(z){return 192<=
z?[2.9,z-192]:160<=z?[2.5,z-160]:128<=z?[2,z-128]:96<=z?[1.5,z-96]:64<=z?[1,z-64]:32<=z?[.7,z-32]:[.4,z]}_createVertexArrayObject(z,J,K,I){const M=L.createBuffer(I),S=M.position,N=M.color,V=M.size;for(let ia=0;ia<I;ia++){var Q=J[2*ia],T=J[2*ia+1];S.set(ia,0,-Math.cos(Q)*Math.sin(T));S.set(ia,1,-Math.sin(Q)*Math.sin(T));S.set(ia,2,-Math.cos(T));Q=this._unpackUint8Attributes(K[ia]);T=this._hexToRGB(F[Q[1]]);N.set(ia,0,255*T[0]);N.set(ia,1,255*T[1]);N.set(ia,2,255*T[2]);N.set(ia,3,255);V.set(ia,Q[0])}return new D.VertexArrayObject(z,
y.Default3D,{geometry:t.glLayout(L)},{geometry:A.BufferObject.createVertex(z,B.Usage.STATIC_DRAW,M.buffer)})}_createLoadDataTask(){if(null!=C)return null;const z=k.createTask(async J=>{({data:J}=await h.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:J}));this._verifyStarData(J);C=J});z.promise.catch(J=>{g.isAbortError(J)||d.getLogger(this).error(J)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return z}_verifyStarData(z){if(!z)throw new m("stars:no-data-received",
"Failed to create stars because star catalogue is missing");z=z.byteLength/9;if(0!==z%1||5E4<z||5E3>z)throw new m("stars:invalid-data","Failed to create stars because star catalogue data is invalid");}};b.__decorate([n.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([n.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);b.__decorate([n.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([n.property()],a.Stars.prototype,"_loadDataTask",
void 0);b.__decorate([n.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=b.__decorate([x.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=q.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),H=q.fromValues(1,0,0,0,0,.9174771405229186,
-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),L=r.newLayout().vec3f(E.VertexAttribute.POSITION).vec4u8(E.VertexAttribute.COLOR).f32(E.VertexAttribute.SIZE);let C=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u extends k.NoParameters{constructor(){super(...arguments);this.modelMatrix=h.create()}}class x extends d.ShaderTechnique{constructor(w){super(w,new f.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(w){return new e.Program(w.rctx,x.shader.get().build(),g.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(n.BlendFactor.SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:n.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})}}x.shader=new m.ReloadableShaderModule(c.Stars,()=>new Promise((w,q)=>a(["./Stars.glsl"],w,q)));b.StarPassParameters=u;b.StarsTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(){const l=new f.ShaderBuilder;l.attributes.add(g.VertexAttribute.POSITION,"vec3");l.attributes.add(g.VertexAttribute.COLOR,"vec4");l.attributes.add(g.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add(new d.Matrix4PassUniform("transform",(u,x)=>{b.copy(n,x.camera.projectionMatrix);n[10]=2.4E-7-1;n[11]=-1;n[14]=(2.4E-7-2)*x.camera.near;b.multiply(n,n,x.camera.viewMatrix);return b.multiply(n,n,u.modelMatrix)}),
new c.Float4PassUniform("viewport",(u,x)=>x.camera.fullViewport),new k.FloatPassUniform("pixelRatio",(u,x)=>x.camera.pixelRatio));l.vertex.code.add(m.glsl`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);l.fragment.code.add(m.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return l}const n=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.Stars=h;a.build=e})},"esri/views/3d/webgl-engine/effects/RenderPlugin":function(){define(["exports","../../../../core/Accessor","../core/shaderLibrary/ShaderOutput"],function(a,b,h){const c={required:[]},k={required:[h.ShaderOutput.LinearDepth]},m={required:[h.ShaderOutput.CompositeColor]},d={required:[h.ShaderOutput.Highlight]};h={required:[h.ShaderOutput.Depth,h.ShaderOutput.Normal]};
class f extends b{consumes(){return c}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(x){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(x){return!1}}class g extends f{}class e extends f{constructor(){super(...arguments);this.drapedPriority=0}}class n extends f{}class l extends f{}class u extends f{}a.ASyncPreparesRenderPlugin=u;a.AsyncRenderPlugin=l;a.ConsumesCompositeColor=m;a.ConsumesDepth=
k;a.ConsumesDepthNormal=h;a.ConsumesHighlight=d;a.ConsumesNone=c;a.SyncPrepareRenderPlugin=e;a.SyncPreparesRenderPlugin=n;a.SyncRenderPlugin=g;a.isPrepareRenderPlugin=function(x){return"prepareTechnique"in x};a.isPreparesRenderPlugin=function(x){return"prepareTechniques"in x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";b[b.Faded=
1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(a,b,h,c,k,m,d,f,
g,e,n){function l(Q,T,ia){T===g.ViewingMode.Global?d.normalize(S,Q.eye):d.set(S,0,0,1);d.scale(N,Q.viewForward,-1);T=n.angle(N,S);const O=Math.max(T-.5,0);h.fromRotation(M,-Math.max(.25,T-.25-.85*O/(O+1)),Q.viewRight);d.transformMat4(ia,N,M);d.add(ia,ia,d.scale(V,Q.viewRight,.2));d.normalize(ia,ia)}function u(Q,T,ia,O){const U=y,P=h.identity(r);if(ia===g.ViewingMode.Global)e.SunCalc.getPosition(Q,0,0,U),d.set(O,0,0,-1),h.rotateX(P,P,-U.azimuth),h.rotateY(P,P,-U.altitude);else{var R=q.planarDirection;
ia=R.globalAngles;R=(Math.abs(T[2])-R.localAltitude)/(R.globalAltitude-R.localAltitude);R=b.clamp(R,0,1);1>R?(e.SunCalc.getPosition(Q,T[1],T[0],U),U.azimuth=(1-R)*U.azimuth+R*ia.azimuth,U.altitude=(1-R)*U.altitude+R*ia.altitude):(U.azimuth=ia.azimuth,U.altitude=ia.altitude);d.set(O,0,-1,0);h.rotateZ(P,P,-U.azimuth);h.rotateX(P,P,-U.altitude)}d.transformMat4(O,O,P)}function x(Q){switch(Q){case "disabled":case "sunny":return new v(1,1);case "cloudy":return new v(1,1);case "rainy":return new v(.4,1.2);
case "snowy":return new v(.5,1.3);case "foggy":return new v(.2,1.6)}}function w(Q,T){const ia=(Q[0]+Q[1]+Q[2])/3;Q[0]+=(ia-Q[0])*T;Q[1]+=(ia-Q[1])*T;Q[2]+=(ia-Q[2])*T}const q={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class v{constructor(Q,T){this.direct=Q;this.ambient=
T}}const p=f.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);class t{constructor(){this.ambient={color:f.fromValues(1,1,1),intensity:.55};this.direct={color:f.fromValues(1,1,1),intensity:.55,directionToLightSource:f.clone(p)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1}}const r=c.create(),y={azimuth:0,altitude:0},D=f.fromValues(.01,.01,.01),E=f.fromValues(1,.6,.5),A=f.fromValues(1,.98,.98),B=f.fromValues(1,1,1),F=f.fromValues(.8,.8,1),
G=f.fromValues(.8,.8,1),H=f.fromValues(.98,.98,1),L=f.fromValues(1,1,1),C=m.fromValues(.01,q.local.ambientAtNight),z=m.fromValues(q.local.directAtTwilight,q.local.ambientAtTwilight),J=m.fromValues(.9*q.local.directAtNoon,q.local.ambientAtNoon),K=m.fromValues(q.local.directAtNoon,q.local.ambientAtNoon),I=new Date(0),M=c.create(),S=f.create(),N=f.create(),V=f.create();a.ColorAndIntensity=t;a.computeColorAndIntensity=function(Q,T,ia,O,U,P){d.set(P.ambient.color,1,1,1);P.ambient.intensity=q.global.ambient;
d.set(P.direct.color,1,1,1);P.direct.intensity=q.global.direct;var R=b.clamp((Math.abs(T[2])-q.local.altitude)/(q.global.altitude-q.local.altitude),0,1);P.globalFactor=R;var ba;null!=Q&&(ba=e.SunCalc.getTimes(Q,T[1],T[0]));if(1>R){if(null!=Q){var X=ba;var da=Q.valueOf();if(X.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN){var ha=da-36E5*(Q.getHours()+48)-6E4*Q.getMinutes();X=ha+432E6}else X.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(ha=da-2,X=da-1):(ha=X.sunrise.valueOf(),X=X.sunset.valueOf());
var fa=X-ha;var aa=ha+fa/2,Z=fa/4;const ea=aa-Z;Z=aa+Z;fa*=.06;const ca=ha-fa/2,W=ha+fa/2,Y=X-fa/2,ja=X+fa/2;ha=m.create();fa=f.create();X=f.create();da<ca||da>ja?(k.copy(ha,C),d.copy(fa,D),d.copy(X,F)):da<W?(da=(da-ca)/(W-ca),k.lerp(ha,C,z,da),d.lerp(fa,D,E,da),d.lerp(X,F,G,da)):da<ea?(da=(da-W)/(ea-W),k.lerp(ha,z,J,da),d.lerp(fa,E,A,da),d.lerp(X,G,H,da)):da<aa?(da=(da-ea)/(aa-ea),k.lerp(ha,J,K,da),d.lerp(fa,A,B,da),d.lerp(X,H,L,da)):da<Z?(da=(da-aa)/(Z-aa),k.lerp(ha,K,J,da),d.lerp(fa,B,A,da),d.lerp(X,
L,H,da)):da<Y?(da=(da-Z)/(Y-Z),k.lerp(ha,J,z,da),d.lerp(fa,A,E,da),d.lerp(X,H,G,da)):da<ja&&(da=(da-Y)/(ja-Y),k.lerp(ha,z,C,da),d.lerp(fa,E,D,da),d.lerp(X,G,F,da));da=0;switch(O){case "rainy":case "foggy":da=.8;break;case "snowy":da=.5}0<da&&(w(fa,da),w(X,da));aa=x(O);da=ha[0]*aa.direct;ha=ha[1]*aa.ambient}else X=x(O),da=q.local.directAtNoon*X.direct,fa=f.fromValues(1,1,1),ha=q.local.ambientAtNoon*X.ambient,X=f.fromValues(1,1,1);d.lerp(P.ambient.color,X,P.ambient.color,R);P.ambient.intensity=b.lerp(ha,
P.ambient.intensity,R);d.lerp(P.direct.color,fa,P.direct.color,R);P.direct.intensity=b.lerp(da,P.direct.intensity,R);P.specularStrength="rainy"===O||"snowy"===O||"foggy"===O?0:1;P.environmentStrength="rainy"===O?.7:"snowy"===O||"foggy"===O?.75:1}null!=Q?(O=Q.valueOf(),ba.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN?(R=O-36E5*(Q.getHours()+48)-6E4*Q.getMinutes(),ba=R+432E6):ba.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(R=O-2,ba=O-1):(R=ba.sunrise.valueOf(),ba=ba.sunset.valueOf()),
O=1-b.clamp(Math.abs(O-(R+(ba-R)/2))/432E5,0,1)):O=1;P.noonFactor=O;null!=Q?u(Q,T,ia,P.direct.directionToLightSource):l(U,ia,P.direct.directionToLightSource)};a.computeDirectionsOverTime=function(Q,T,ia,O,U){Q=Q.getTime();T=T.getTime()-Q;T=Math.floor(T/ia)+1;const P=Array(T);for(let R=0;R<T;++R)I.setTime(Q+ia*R),P[R]=f.create(),u(I,O,U,P[R]);return P};a.computeShadowsEnabled=function(Q,T){return T===g.ViewingMode.Global?!0:Math.abs(Q)<q.planarDirection.localAltitude};a.computeVirtualLightDirection=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports","./_commonjsHelpers"],function(a,b){var h={exports:{}};(function(c){(function(k){k=k();void 0!==k&&(c.exports=k)})(function(){function k(F){return new Date(864E5*(F+.5-2440588))}function m(F,G){return t(w(F)*q(E)-v(G)*w(E),q(F))}function d(F,G){return p(w(G)*q(E)+q(G)*w(E)*w(F))}function f(F,G,H){return t(w(F),q(F)*w(G)-v(H)*q(G))}function g(F,G,H){return p(w(G)*w(H)+q(G)*q(H)*q(F))}
function e(F){return y*(1.9148*w(F)+.02*w(2*F)+3E-4*w(3*F))}function n(F,G){F=y*(357.5291+.98560028*F);var H=e(F);F=F+H+102.9372*y+x;G||={dec:0,ra:0};G.dec=d(F,0);G.ra=m(F,0);return G}function l(F,G,H){return 2451545+F+.0053*w(G)-.0069*w(2*H)}function u(F){var G=y*(134.963+13.064993*F),H=y*(93.272+13.22935*F);F=y*(218.316+13.176396*F)+6.289*y*w(G);H=5.128*y*w(H);G=385001-20905*q(G);return{ra:m(F,H),dec:d(F,H),dist:G}}var x=Math.PI,w=Math.sin,q=Math.cos,v=Math.tan,p=Math.asin,t=Math.atan2,r=Math.acos,
y=x/180,D={dec:0,ra:0},E=23.4397*y,A={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(F,G,H,L){H=y*-H;G*=y;var C=F.valueOf()/864E5-.5+2440588-2451545;F=n(C,D);H=y*(280.16+360.9856235*C)-H-F.ra;L||={azimuth:0,altitude:0};L.azimuth=f(H,G,F.dec);L.altitude=g(H,G,F.dec);return L}},B=[[-.83,"sunrise","sunset"]];A.addTime=function(F,G,H){B.push([F,G,H])};A.getTimes=function(F,G,H){function L(T){var ia=z,O=M;T=r((w(T)-w(ia)*w(O))/(q(ia)*q(O)));return l(9E-4+(T+C)/(2*x)+J,K,I)}
var C=y*-H,z=y*G,J=Math.round(F.valueOf()/864E5-.5+2440588-2451545-9E-4-C/(2*x));F=9E-4+(0+C)/(2*x)+J;var K=y*(357.5291+.98560028*F);G=e(K);var I=K+G+102.9372*y+x,M=d(I,0);F=l(F,K,I);G={solarNoon:k(F),nadir:k(F-.5),polarException:A.PolarException.NORMAL};var S;H=0;for(S=B.length;H<S;H+=1){var N=B[H];var V=L(N[0]*y);var Q=F-(V-F);G[N[1]]=k(Q);G[N[2]]=k(V)}G.polarException=function(T){T=(w(T)-w(z)*w(M))/(q(z)*q(M));return-1>T?A.PolarException.MIDNIGHT_SUN:1<T?A.PolarException.POLAR_NIGHT:A.PolarException.NORMAL}(B[0][0]*
y);return G};A.getMoonPosition=function(F,G,H){H=y*-H;G*=y;var L=F.valueOf()/864E5-.5+2440588-2451545;F=u(L);H=y*(280.16+360.9856235*L)-H-F.ra;L=g(H,G,F.dec);L+=.017*y/v(L+10.26*y/(L+5.1*y));return{azimuth:f(H,G,F.dec),altitude:L,distance:F.dist}};A.getMoonFraction=function(F){var G=F.valueOf()/864E5-.5+2440588-2451545;F=n(G);G=u(G);F=r(w(F.dec)*w(G.dec)+q(F.dec)*q(G.dec)*q(F.ra-G.ra));F=t(149598E3*w(F),G.dist-149598E3*q(F));return(1+q(F))/2};return A})})(h);b=b.getDefaultExportFromCjs(h.exports);
a.SunCalc=b})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){b=class extends b{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(z){"pan"!==z&&"rotate"!==z||z===this._get("primaryDragAction")||(this._set("primaryDragAction",z),this._updateMode())}get mode(){return this._get("mode")}set mode(z){"default"!==z&&"pro"!==z||z===this._get("mode")||(this._set("mode",z),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??
!1}disconnect(){this.view.viewEvents.disconnect();this._inputManager=h.destroyMaybe(this._inputManager)}connect(){const z=this.view;this._source=new y.BrowserEventSource(this.view.surface,z.input);var J=[new B.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new G.SingleAndDoubleClick,new A.Drag(this.view.navigation),new H.VerticalTwoFingerDrag];this._inputManager=J=new D.InputManager({eventSource:this._source,recognizers:J});J.installHandlers("prevent-context-menu",[new E.PreventContextMenu],D.ViewEventPriorities.INTERNAL);
this._modeDragPan=new q.PinchAndPanNavigation(z,"primary");this._modeDragRotate=new n.DragRotate(z,"secondary",L.PivotPoint.CENTER);this._modeDragZoom=new l.DragZoom(z,"tertiary");J.installHandlers("navigation",[new v.PointerDownCancelAnimation(z),new e.DoubleClickZoom(z),new u.GamepadNavigation(z),new x.KeyboardNavigation(z,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),
new w.MouseWheelZoom(z),new t.SingleKeyResetTilt(z,"p"),new p.SingleKeyResetHeading(z,"n"),new n.DragRotate(z,"primary",L.PivotPoint.EYE,["b"]),new n.DragRotate(z,"secondary",L.PivotPoint.CENTER,["b"]),new q.PinchAndPanNavigation(z,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new r.TwoFingerTilt(z)],D.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(J);this._updateMode();this.addHandles(c.watch(()=>this.view.navigation?.browserTouchPanEnabled,K=>{this._source.browserTouchPanningEnabled=
!K},c.initial))}isModifierKeyDown(z){return this._inputManager?.isModifierKeyDown(z)??!1}_updateMode(){var z=this.primaryDragAction;if(z=C.get(this.mode)?.get(z))this._modeDragPan&&(this._modeDragPan.pointerAction=z.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=z.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=z.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};
a.__decorate([k.property()],b.prototype,"view",void 0);a.__decorate([k.property({value:"pan"})],b.prototype,"primaryDragAction",null);a.__decorate([k.property({value:"default"})],b.prototype,"mode",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property()],b.prototype,"latestPointerType",null);a.__decorate([k.property()],b.prototype,"latestPointerLocation",null);a.__decorate([k.property()],b.prototype,"multiTouchActive",null);a.__decorate([k.property()],
b.prototype,"_inputManager",void 0);b=a.__decorate([g.subclass("esri.views.3d.input.SceneInputManager")],b);const C=new Map;a=new Map;k=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});k.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});k.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});C.set("default",a);C.set("pro",k);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,h,c,k,m){class d extends k.InputHandler{constructor(f,g){super(!0);this._view=f;this.registerIncoming("double-click",g,e=>this._handleDoubleClick(e))}_handleDoubleClick(f){const g=f.data;if(m.eventMatchesPointerAction(g,"primary")){const e=this._view.state.isGlobal?new h.ZoomStepController({view:this._view,mode:"animation"}):new c.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/Math.log(.6),b.createScreenPointArray(g.x,
g.y));f.stopPropagation()}}}a.DoubleClickZoom=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){a.ZoomStepController=class extends t.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=n.create();this._tmpCamera=new E.Camera;this._tmpViewDir=n.create();this._tmpRayDir={origin:n.create(),direction:n.create()};this._targetOnSphere=n.create();this._tmpCenter=n.create();this._beginCamera=new E.Camera;this._constraintOptions=new w.ConstraintOptions(q.ConstraintTypes.ALL_EXCEPT_COLLISION,v.InteractionType.ZOOM,
null,this._beginCamera);this._sphere=u.create()}initialize(){this._intersector=A.newIntersector(this.view.state.viewingMode)}zoomStep(H,L){if(this.active){var C=this.view.state;this.animation.finished?this._beginCamera.copyFrom(C.camera):this.animation.cameraAt(1,this._beginCamera);var z=!1,J=!1;this.intersectionHelper.intersectScreen(L,this._zoomLocation,0===this.view.map.ground.opacity?r.contentIntersectorOptions:{})&&(z=0<H,J=!0);this._tmpCamera.copyFrom(C.camera);z?this.intersectionHelper.intersectRay(this._tmpCamera.ray,
this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,H,this._zoomLocation,L,J);this.begin(this._tmpCamera)}}animationSettings(){return{duration:c.Milliseconds(600),easing:B.outExpo}}_updateCamera(H,L,C,z,J){var K=l.getReferenceEllipsoid(this.view.spatialReference);
K=r.decideNavigationMode(H,z,K);var I=Math.abs(this.view.camera.position.z);e.normalize(G,H.eye);e.scale(G,G,-1);y.fromScreenAtEye(H,z,this._tmpRayDir);e.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const M=h.clamp(Math.min(r.zoomDistanceModifier,1/Math.abs(e.dot(G,this._tmpRayDir.direction)))*I,r.zoomMinDistanceModifier,r.zoomMaxDistanceModifier);if(K===r.NavigationMode.Horizontal){L=.6**L;this._sphere[3]=e.length(C);e.subtract(this._tmpViewDir,H.center,H.eye);J=Math.min(e.length(this._tmpViewDir),
M);K=J*L;1>=L&&4>K&&(K=4,L=K/J);if(1E-6>Math.abs(J-K))return;J=e.length(H.center);this._sphere[3]!==J&&(H.center=e.scale(F,H.center,(this._sphere[3]+L*(J-this._sphere[3]))/J));e.scale(this._tmpViewDir,this._tmpViewDir,-L);H.eye=e.add(F,H.center,this._tmpViewDir);x.applyAll(this.view,H,this._constraintOptions);1E-12<e.squaredDistance(C,H.center)&&D.intersectScreen(this._sphere,H,z,this._targetOnSphere)&&r.panToPosition(this._sphere,H,C,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,
!0)}else{K=.6**Math.abs(L);I=0<L?1:-1;e.subtract(this._tmpViewDir,C,H.eye);const S=e.length(this._tmpViewDir);z=this.view._stage.renderView.getMinimalDepthForArea(null,z[0],z[1],this.view.state.camera,60);z=null!=z?z:M;z=J&&0<L?Math.min(z,S):z;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,z);e.add(C,this._tmpRayDir.origin,this._tmpRayDir.direction);C=z*K;J=Math.max(4,1.01*H.nearFar[0]);0<L&&C<J&&(C=J,K=C/z);if(1E-6>Math.abs(z-C))return;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,
I*(1-K));H.eye=e.add(F,H.eye,this._tmpRayDir.direction);H.center=e.add(F,H.center,this._tmpRayDir.direction)}p.applySurfaceCollisionConstraint(this.view,H)}};a.ZoomStepController=b.__decorate([g.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const F=n.create(),G=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintOptions ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),
function(a,b,h,c,k,m,d,f,g,e){const n=[{type:k.ConstraintTypes.TILT,error:function(u,x,w){return g.getTiltConstraintError(u,x,w)*x.distance},apply:g.applyTiltConstraint},{type:k.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:k.ConstraintTypes.DISTANCE,error:m.getDistanceConstraintError,apply:m.applyDistanceConstraint}],l=new c.ConstraintOptions;a.applyAll=function(u,x,w=l,q=x){q!==x&&q.copyFrom(x);q.computeUp(u.state.viewingMode);x=!1;for(let p=
0;5>p;p++){let t=0;for(var v of n)if(h.hasConstraintType(w.selection,v.type)){const r=Math.abs(v.error(u,q,w));v.apply(u,q,w)&&(x=!0,t+=r)}if(0===t)break}v=h.hasConstraintType(w.selection,k.ConstraintTypes.COLLISION);a:switch(w.interactionType){case d.InteractionType.PAN:w=f.Mode.EYE_AND_CENTER;break a;case d.InteractionType.ASCEND:w=u.state.isGlobal?f.Mode.EYE_AND_CENTER_SCALE:f.Mode.EYE_AND_CENTER;break a;default:w=f.Mode.EYE}v&&f.applySurfaceCollisionConstraint(u,q,w)&&(x=!0);x&&q.computeUp(u.state.viewingMode);
return x};a.pixelDistanceToInteractionFactor=function(u){return e.inOutCubic(Math.min(1,u/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),function(a,b,h,c,k,m,d,f,g){function e(q,
v,p=m.defaultConstraintOptions){var t=q.state.constraints.altitude;t=q.state.isGlobal&&t?p.interactionType===f.InteractionType.TUMBLE&&m.hasConstraintType(p.selection,d.ConstraintTypes.TILT)?!1:!0:!1;if(!t||!q.state.constraints.altitude)return 0;var r=q.state.constraints.altitude;t=n;t.min=r.min;t.max=r.max;r=p.interactionType;if(r!==f.InteractionType.NONE){var {min:y,max:D}=t,{interactionStartCamera:E,interactionFactor:A}=p;if(E){p=r===f.InteractionType.TUMBLE||r===f.InteractionType.ZOOM;r=e(q,E);
var B=0===r?0:q.renderCoordsHelper.getAltitude(E.eye);t.min=y;t.max=D;m.adjustRangeForInteraction(r,B,p,A,.05*B,t)}}q=q.renderCoordsHelper.getAltitude(v.eye);q=b.clamp(q,t.min,t.max)-q;return 1E-6>=Math.abs(q)?0:q}const n={min:0,max:0},l=c.create(),u=c.create(),x=c.create(),w=c.create();a.applyAltitudeConstraint=function(q,v,p=m.defaultConstraintOptions){var t=e(q,v,p);if(0===t)return!1;const r=q.renderCoordsHelper,y=r.getAltitude(v.eye)+t;var D=m.interactionDirectionTowardsConstraintMinimization;
p=p.interactionDirection;t=Math.sign(t);q.renderCoordsHelper.worldUpAtPosition(v.eye,u);h.scale(u,u,t);D=D.call(m,v,p,u,l);q=h.copy(x,v.viewForward);D=r.intersectInfiniteManifold(k.wrap(v.eye,D),y,w);v.eye=null!=D?D:r.setAltitude(w,y,v.eye);v.center=g.closestPointOnRay(w,v.eye,q,v.center);return!0};a.getAltitudeConstraintError=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec32","./ConstraintOptions",
"./ConstraintTypes"],function(a,b,h,c){h=new h.ConstraintOptions(c.ConstraintTypes.NONE);a.adjustRangeForInteraction=function(k,m,d,f,g,e){0!==k&&(d?(e.min=Math.min(e.min,m),e.max=Math.max(e.max,m)):null!=f?(e.min-=Math.max(0,(m-e.min)*(1-f)),e.max+=Math.max(0,(m-e.max)*(1-f))):g&&(e.min-=Math.max(0,m-e.min-g),e.max+=Math.max(0,m-e.max-g)))};a.defaultConstraintOptions=h;a.hasConstraintType=function(k,m){return 0!==(k&m)};a.interactionDirectionTowardsConstraintMinimization=function(k,m,d,f){m=m||k.viewForward;
b.copy(f,m);b.scale(f,f,Math.sign(b.dot(m,d)));return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintOptions":function(){define(["exports","./ConstraintTypes","./InteractionType","./TiltMode"],function(a,b,h,c){class k{constructor(m=b.ConstraintTypes.ALL,d=h.InteractionType.NONE,f=0,g=null,e=null,n=c.TiltMode.TUMBLE){this.selection=m;this.interactionType=d;this.interactionFactor=f;this.interactionStartCamera=g;this.interactionDirection=
e;this.tiltMode=n}}a.ConstraintOptions=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes={});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=
a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/plane"],function(a,b,h,c,k){function m(g,e,n,l){const u=f;g?(n&&l&&(u.len=h.distance(e,n)),h.copy(u.dir,g)):l?(u.len=h.distance(e,
n),h.subtract(u.dir,n,e),h.scale(u.dir,u.dir,1/u.len)):(h.subtract(u.dir,n,e),h.normalize(u.dir,u.dir));return u}function d(g,e,n,l){l.clip[0]=0;l.clip[1]=n?l.len:Number.MAX_VALUE;for(n=0;n<g.length;n++){{var u=g[n],x=e;var w=l;const q=h.dot(k.getNormal(u),w.dir);u=-k.signedDistance(u,x);0>u&&0<=q?w=!1:-1E-6<q&&1E-6>q?w=0<u:!(0>u||0>q)||0>u&&0>q?(u/=q,0<q?u<w.clip[1]&&(w.clip[1]=u):u>w.clip[0]&&(w.clip[0]=u),w=w.clip[0]<=w.clip[1]):w=!0}if(!w)return!1}return!0}const f={dir:c.create(),len:0,clip:b.create()};
a.closestPointOnRay=function(g,e,n,l){l=h.dot(n,h.subtract(g,l,e));return h.add(g,e,h.scale(g,n,l))};a.frustumLineSegment=function(g,e,n,l){l=m(l,e,n,!0);return d(g,e,n,l)};a.frustumPoint=function(g,e){for(let n=0;6>n;n++)if(0<k.signedDistance(g[n],e))return!1;return!0};a.frustumRay=function(g,e,n,l){n=m(l,e,n,!1);return d(g,e,null,n)};a.frustumSphere=function(g,e,n){const l=e[0],u=e[1];e=e[2];return g[0][0]*l+g[0][1]*u+g[0][2]*e+g[0][3]>n||g[1][0]*l+g[1][1]*u+g[1][2]*e+g[1][3]>n||g[2][0]*l+g[2][1]*
u+g[2][2]*e+g[2][3]>n||g[3][0]*l+g[3][1]*u+g[3][2]*e+g[3][3]>n||g[4][0]*l+g[4][1]*u+g[4][2]*e+g[4][3]>n||g[5][0]*l+g[5][1]*u+g[5][2]*e+g[5][3]>n?!1:!0};a.planeSphere=function(g,e,n){return g[0]*e[0]+g[1]*e[1]+g[2]*e[2]+g[3]<n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,b,h,c,k,m,d){function f(q,v,p=m.defaultConstraintOptions){if(!q.state.isLocal)return 0;var t=q.state.constraints.distance;if(!q.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===t)return 0;e.min=0;e.max=t;t=e;var r=p.interactionType;if(r!==d.InteractionType.NONE){var {min:y,max:D}=t,{interactionStartCamera:E,interactionFactor:A}=p;if(E){p=r===d.InteractionType.ZOOM||r===d.InteractionType.PAN;r=f(q,E);var B=0===r?0:g(q,E);t.min=y;t.max=D;m.adjustRangeForInteraction(r,B,p,A,.05*B,
t)}}q=g(q,v);q=e.max-q;return-1E-6<=q?0:q}function g(q,v){q=q.pointsOfInterest.surfaceOrigin;return q.renderLocation?b.distance(v.eye,q.renderLocation):0}const e={min:0,max:0},n=h.create(),l=h.create(),u=h.create(),x=h.create(),w=h.create();a.applyDistanceConstraint=function(q,v,p=m.defaultConstraintOptions){var t=f(q,v,p);if(0===t)return!1;var r=q.pointsOfInterest.surfaceOrigin;if(!r.renderLocation)return!1;t=g(q,v)+t;const y=b.copy(n,v.eye);p=m.interactionDirectionTowardsConstraintMinimization(v,
p.interactionDirection,b.direction(x,v.eye,r.renderLocation),u);if(!k.intersectRay(k.fromCenterAndRadius(r.renderLocation,t),c.wrap(v.eye,p),w))return!1;v.eye=w;r=b.subtract(l,v.eye,y);v.center=b.add(w,v.center,r);r=q.renderCoordsHelper.getAltitude(v.center);q=q.renderCoordsHelper.intersectInfiniteManifold(v.ray,r,w);null!=q&&(v.center=q);return!0};a.getDistanceConstraintError=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../intersectionUtils"],function(a,b,h,c){a.Mode=void 0;(function(d){d[d.EYE=0]="EYE";d[d.EYE_AND_CENTER=1]="EYE_AND_CENTER";d[d.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const k=h.create(),m=h.create();a.applySurfaceCollisionConstraint=function(d,f,g=a.Mode.EYE){var e=d.state.constraints;if(!e.collision.enabled)return!1;var n=c.surfaceElevationBelowRenderLocation(d,f.eye);const l=d.renderCoordsHelper.getAltitude(f.eye);
e=n+e.collision.elevationMargin;if(l>=e)return!1;n=b.length(f.eye);b.subtract(k,f.center,f.eye);f.eye=d.renderCoordsHelper.setAltitude(m,e,f.eye);g===a.Mode.EYE_AND_CENTER?f.center=b.add(k,f.eye,k):g===a.Mode.EYE_AND_CENTER_SCALE&&(f.center=b.scale(k,f.center,(n-l+e)/n));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(F,G,H,L=!0){B.eyeCenterDistance=0;B.requiresTwoSteps=!1;const C=q(F,G,H,e.defaultConstraintOptions,B);if(0===C)return!1;c.fromRotation(r,-C,G.viewRight);switch(H.tiltMode){case u.TiltMode.LOOK_AROUND:m.transformMat4(t,G.viewForward,r);m.scale(t,t,B.eyeCenterDistance);G.center=m.add(y,G.eye,t);break;case u.TiltMode.TUMBLE:m.subtract(t,G.center,G.eye);m.transformMat4(t,t,r);G.eye=m.subtract(y,G.center,t);break;default:b.neverReached(H.tiltMode)}G.up=
m.transformMat4(y,G.up,r);return B.requiresTwoSteps&&L?w(F,G,H,!1):!0}function q(F,G,H,L=e.defaultConstraintOptions,C){if(!F.state.constraints.tilt)return 0;var z=F.state.constraints.tilt(G.distance,E);if(H.interactionType!==l.InteractionType.NONE){var {interactionStartCamera:J,interactionFactor:K}=H;if(J){var {min:I,max:M}=z,S=q(F,J,e.defaultConstraintOptions,H),N=0===S?0:x.viewAngle(F.renderCoordsHelper,J.center,J.eye);z.min=I;z.max=M;H.interactionType===l.InteractionType.TUMBLE?(e.hasConstraintType(H.selection,
n.ConstraintTypes.ALTITUDE)&&p(F,J,z),e.adjustRangeForInteraction(S,N,!0,K,D,z)):e.adjustRangeForInteraction(S,N,!1,K,D,z)}}L.interactionType===l.InteractionType.TUMBLE&&e.hasConstraintType(L.selection,n.ConstraintTypes.ALTITUDE)&&p(F,L.interactionStartCamera,z);if(H.tiltMode===u.TiltMode.LOOK_AROUND||L.tiltMode===u.TiltMode.LOOK_AROUND){a:{C&&(C.requiresTwoSteps=!1);switch(F.viewingMode){case "global":H=A;S=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;L=S+f.getReferenceEllipsoid(F.spatialReference).radius;
S=F.renderCoordsHelper.intersectManifold(G.ray,S,y);H.eyeCenterDistance=G.distance;H.centerIsOnSurface=!1;null!=S?(H.eyeCenterDistance=m.distance(G.eye,S),H.tiltAtCenter=x.viewAngle(F.renderCoordsHelper,S,G.eye),H.centerIsOnSurface=!0):F.state.isLocal?H.tiltAtCenter=x.viewAngle(F.renderCoordsHelper,G.center,G.eye):(g.closestPointOnSilhouette(g.fromRadius(g.tmpSphere,L),G.ray,y),H.eyeCenterDistance=m.distance(G.eye,y),H.tiltAtCenter=h.acosClamped(-m.dot(G.viewForward,m.normalize(y,y))));H.radius=L;
H.eyeRadius=m.length(G.eye);H.constraints=F.state.constraints;G=h.clamp(H.tiltAtCenter,z.min,z.max);if(1E-9<Math.abs(H.tiltAtCenter-G)){if(H.centerIsOnSurface){{const {constraints:V,eyeCenterDistance:Q,tiltAtCenter:T}=H;G=T;F=V.clampTilt(Q,T);z=v(H,F);if(V.clampTilt(z,T)!==F)for(z=0;10>z&&1E-9<Math.abs(F-G);)L=(G+F)/2,S=v(H,L),S=V.clampTilt(S,L),1E-9<Math.abs(S-L)?G=L:F=L,z++;G=F}z=G;F=h.asinClamped(H.radius/H.eyeRadius*Math.sin(H.tiltAtCenter));z=h.asinClamped(H.radius/H.eyeRadius*Math.sin(z));F=
H.eyeRadius>H.radius?F-z:z-F}else G=H.constraints.clampTilt(H.eyeCenterDistance,H.tiltAtCenter),C&&G<Math.PI/2&&(C.requiresTwoSteps=!0,G=Math.PI/2-1E-5),F=H.tiltAtCenter-Math.PI/2-(G-Math.PI/2);C&&(C.eyeCenterDistance=v(H,G));C=F}else C=0;break a;case "local":L=x.viewAngle(F.renderCoordsHelper,G.center,G.eye);H=h.clamp(L,z.min,z.max);z=L-H;1E-9<Math.abs(z)?(C&&(L=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,F=F.renderCoordsHelper.getAltitude(G.eye)-L,H=Math.cos(H),C.eyeCenterDistance=
1E-4<Math.abs(H)?F/H:G.distance),C=z):C=0;break a}C=void 0}return C}C=x.viewAngle(F.renderCoordsHelper,G.center,G.eye);H=h.clamp(C,z.min,z.max);C-=H;C=1E-9<Math.abs(C)?C:0;return C}function v(F,G){if(!F.centerIsOnSurface)return F.eyeCenterDistance;G=Math.PI-h.clamp(G,0,Math.PI);const H=h.asinClamped(F.radius/F.eyeRadius*Math.sin(G)),L=Math.sin(Math.PI-G-H)/Math.sin(G);return F.eyeRadius<F.radius&&1<L?Math.sin(Math.PI-G-(Math.PI-H))/Math.sin(G)*F.eyeRadius:L*F.eyeRadius}function p(F,G,H){var L=F.state.constraints;
if(!F.state.isLocal&&L.altitude&&G){var C=m.squaredLength(G.center),z=Math.sqrt(C);G=G.distance;var J=f.getReferenceEllipsoid(F.spatialReference).radius;F=L.altitude.min+J;L=L.altitude.max+J;F=(F*F-G*G-C)/(-2*z*G);H.min=Math.max(H.min,Math.min(Math.PI-h.acosClamped((L*L-G*G-C)/(-2*z*G)),H.max));H.max=Math.min(H.max,Math.PI-h.acosClamped(F))}}const t=d.create(),r=k.create(),y=d.create(),D=h.deg2rad(5),E={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,
tiltAtCenter:0},B={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=w;a.getTiltConstraintError=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,h,c){const k=c.create(),m=c.create();a.viewAngle=function(d,f,g){d.worldUpAtPosition(f,k);h.subtract(m,g,f);d=h.length(m);return 0===d?
0:b.acosClamped(h.dot(m,k)/d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(V){const Q=2*(V-Math.sqrt((V-1)*V)),T=Q/2/V;return ia=>ia<T?V*ia*ia:Q*ia-Q+1}function h(V,Q){return(T,ia)=>T<Q?Q*V(T/Q,ia):1-V((1-T)/(1-Q),ia)*(1-Q)}const c=V=>V,k=V=>V*V,m=V=>1-k(1-V),d=V=>.5>V?k(2*V)/2:(1-k(1-2*(V-.5))+1)/2,f=V=>V*V*V,g=V=>1-f(1-V),e=V=>.5>V?f(2*V)/2:(1-f(1-2*(V-.5))+1)/2,n=V=>V*V*V*V,l=V=>1-n(1-V),u=V=>
.5>V?n(2*V)/2:(1-n(1-2*(V-.5))+1)/2,x=V=>V*V*V*V*V,w=V=>1-x(1-V),q=V=>.5>V?x(2*V)/2:(1-x(1-2*(V-.5))+1)/2,v=V=>-Math.cos(V*Math.PI/2)+1,p=V=>1-v(1-V),t=V=>.5>V?v(2*V)/2:(1-v(1-2*(V-.5))+1)/2,r=V=>2**(10*(V-1)),y=V=>1-2**(10*(1-V-1)),D=V=>.5>V?2**(10*(2*V-1))/2:(1-2**(10*(1-2*(V-.5)-1))+1)/2,E=V=>-(Math.sqrt(1-V*V)-1),A=V=>1-E(1-V),B=V=>.5>V?E(2*V)/2:(1-E(1-2*(V-.5))+1)/2,F=h(b(1),1),G=h(b(1),0),H=h(b(1),.5),L=h(b(2),1),C=h(b(2),0),z=h(b(2),.5),J=h(b(3),1),K=h(b(3),0),I=h(b(3),.5),M=h(b(4),1),S=h(b(4),
0),N=h(b(4),.5);a.EasingFunctions={linear:c,"in-quad":k,"out-quad":m,"in-out-quad":d,"in-coast-quad":F,"out-coast-quad":G,"in-out-coast-quad":H,"in-cubic":f,"out-cubic":g,"in-out-cubic":e,"in-coast-cubic":L,"out-coast-cubic":C,"in-out-coast-cubic":z,"in-quart":n,"out-quart":l,"in-out-quart":u,"in-coast-quart":J,"out-coast-quart":K,"in-out-coast-quart":I,"in-quint":x,"out-quint":w,"in-out-quint":q,"in-coast-quint":M,"out-coast-quint":S,"in-out-coast-quint":N,"in-sine":v,"out-sine":p,"in-out-sine":t,
"in-expo":r,"out-expo":y,"in-out-expo":D,"in-circ":E,"out-circ":A,"in-out-circ":B};a.inCirc=E;a.inCoastCubic=L;a.inCoastQuad=F;a.inCoastQuart=J;a.inCoastQuint=M;a.inCubic=f;a.inExpo=r;a.inOutCirc=B;a.inOutCoastCubic=z;a.inOutCoastQuad=H;a.inOutCoastQuart=I;a.inOutCoastQuint=N;a.inOutCubic=e;a.inOutExpo=D;a.inOutQuad=d;a.inOutQuart=u;a.inOutQuint=q;a.inOutSine=t;a.inQuad=k;a.inQuart=n;a.inQuint=x;a.inSine=v;a.linear=c;a.outCirc=A;a.outCoastCubic=C;a.outCoastQuad=G;a.outCoastQuart=K;a.outCoastQuint=
S;a.outCubic=g;a.outExpo=y;a.outQuad=m;a.outQuart=l;a.outQuint=w;a.outSine=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){a.PointToPointAnimationController=class extends n.AnimationController{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(v){super(v);this.mode="interaction";this._hasTarget=!1}initialize(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new g}get isInteractive(){return"interaction"===this.mode}begin(v,p){this._hasTarget=!0;p=this.animationSettings(p);w.copyFrom(this.view.state.camera);
const t=u.newIntersector(this.view.state.viewingMode);this.intersectionHelper.intersectRay(w.ray,t,q)&&(w.center=q);this.animation.update(w,v,p);this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time;super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(v,p){this._hasTarget&&this.animation.step(v,p)}onControllerEnd(v){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,v),this.animation.currentTime=
this.animation.time);super.onControllerEnd(v)}animationSettings(v={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...v,easing:"string"===typeof v.easing?x.EasingFunctions[v.easing]:v.easing}}};b.__decorate([h.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);b.__decorate([h.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=
b.__decorate([d.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const w=new l.Camera,q=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../core/time ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,
b,h,c,k,m,d){class f{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=b.Milliseconds(0);this._animation=new d.Animation(()=>new k.Camera(e));this._current=new k.Camera(e)}update(e,n,l){const {source:u,target:x}=this._animation.definition,w=h.subtract(g,n.center,e.center),q=h.length(w);1E-5<=q?(w[0]/=q,w[1]/=q,w[2]/=q):(w[0]=0,w[1]=1,w[0]=0);h.copy(u.direction,w);h.copy(x.direction,w);u.copyFromRenderCamera(e);x.copyFromRenderCamera(n);
this._current.copyFrom(u);this._animation.update(u,x,l);this.currentTime=b.Milliseconds(0);e.almostEquals(n)&&(this.currentTime=this._animation.time)}cameraAt(e,n){this._animation.cameraAt(e,this._current);n=n||new m.Camera;this._current.copyToRenderCamera(n);return n}step(e,n){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,n)}}const g=c.create();
a.Animation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,h,c,k,m,d,f){class g{constructor(r){this.viewingMode=r;this.center=m.create();this.distance=
this.yaw=this.pitch=0;this.direction=m.clone(v);this.fov=55;this.size=1}pixelsPerPanAtZoom(r){return this.size/2/(this._zoomToPanScale*r)}zoomAtPixelsPerPan(r){return this.size/2/(this._zoomToPanScale*r)}pixelsPerRotateAtZoom(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)}compareTo(r,y){y||={pan:0,rotate:0,sourceZoom:0,targetZoom:0};if(this.viewingMode===d.ViewingMode.Global){var D=k.length(this.center);const E=k.length(r.center);D=(D+E)/2;y.pan=f.angle(this.center,r.center)*D}else y.pan=
k.distance(this.center,r.center);D=Math.abs(r.yaw-this.yaw);D>=Math.PI&&(D=2*Math.PI-D);y.rotate=Math.max(D,Math.abs(r.pitch-this.pitch));y.sourceZoom=this.distance;y.targetZoom=r.distance;return y}interpolate(r,y,D){this.viewingMode===d.ViewingMode.Global?f.slerp(r.center,y.center,D.pan,this.center):k.lerp(this.center,r.center,y.center,D.pan);this.distance=isFinite(y.distance)?y.distance*D.zoom:r.distance;this.pitch=b.lerp(r.pitch,y.pitch,D.rotate);r=r.yaw;y=y.yaw;Math.abs(y-r)>=Math.PI&&(r+=2*(r<
y?1:-1)*Math.PI);this.yaw=b.lerp(r,y,D.rotate)}copyFrom(r){k.copy(this.center,r.center);this.pitch=r.pitch;this.yaw=r.yaw;this.distance=r.distance;k.copy(this.direction,r.direction);this.size=r.size;this.copyFromCommon(r);this.viewingMode=r.viewingMode}copyFromRenderCamera(r){var y=this._lookAtOrientation(r.center,t);k.copy(this.center,r.center);k.subtract(u,r.center,r.eye);k.transformMat3(u,u,y);k.transformMat3(x,r.up,y);this.distance=k.length(u);0!==this.distance&&(u[0]/=this.distance,u[1]/=this.distance,
u[2]/=this.distance);this.pitch=this._eyeUpToPitch(u);y=u;const D=w;.5>Math.abs(x[2])?(k.copy(D,x),0<y[2]&&k.scale(D,D,-1)):k.copy(D,y);k.cross(n,D,q);k.normalize(n,n);this.yaw=f.angle(p,n,q);this.size=Math.sqrt(r.width*r.width+r.height*r.height);this.copyFromCommon(r)}copyFromCommon(r){this.fov=r.fov;this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(r){const y=this._lookAtOrientation(this.center,t);h.transpose(y,y);this._axisAngleVec3(p,this.pitch-Math.PI/2,v,u);this._axisAngleVec3(q,
this.yaw,u,u);this._axisAngleVec3(p,this.pitch-Math.PI/2,q,x);this._axisAngleVec3(q,this.yaw,x,x);k.scale(u,u,this.distance);k.transformMat3(u,u,y);k.transformMat3(x,x,y);r.center=this.center;r.eye=k.subtract(u,this.center,u);r.up=x}_axisAngleVec3(r,y,D,E){const A=Math.cos(y);y=Math.sin(y);k.scale(e,D,A);k.cross(n,r,D);k.scale(n,n,y);k.scale(l,r,(1-A)*k.dot(r,D));return k.add(E,k.add(E,e,n),l)}_lookAtOrientation(r,y=c.create()){this._upAtLookAt(r,l);k.cross(e,this.direction,l);k.normalize(e,e);0===
e[0]&&0===e[1]&&0===e[2]&&k.copy(e,p);k.cross(n,l,e);k.normalize(n,n);y[0]=e[0];y[1]=n[0];y[2]=l[0];y[3]=e[1];y[4]=n[1];y[5]=l[1];y[6]=e[2];y[7]=n[2];y[8]=l[2];return y}_upAtLookAt(r,y){return this.viewingMode===d.ViewingMode.Local?k.copy(y,q):k.normalize(y,r)}_eyeUpToPitch(r){return Math.PI-f.angle(q,r)}}const e=m.create(),n=m.create(),l=m.create(),u=m.create(),x=m.create(),w=m.create(),q=m.UNIT_Z,v=m.UNIT_Y,p=m.UNIT_X,t=c.create();a.Camera=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,b,h,c,k,m){const d={zoom:0,pan:0,rotate:0};a.Animation=class{get time(){return this._time}constructor(f){this._createCamera=f;this._time=b.Milliseconds(0);this.definition=new c.Definition(f);this.path=new m.Path}update(f,g,e){this.definition.update(f,g,e);this.path.update(this.definition,e);this._time=this._applyTimeSettings(b.millisecondsFromSeconds(isFinite(this.path.time)?
this.path.time:b.Seconds(0)),e);this._easing=e.easing??(1E3<=this._time?h.inOutCoastQuad:h.outExpo)}cameraAt(f,g){g=g||this._createCamera();f=Math.min(Math.max(0,f),1);f=this._normalizedEasing(f);f=this.path.interpolateComponentsAt(f,d);g.interpolate(this.definition.source,this.definition.target,f);return g}_normalizedEasing(f){const g=this._easing(0,this._time),e=this._easing(1,this._time);return(this._easing(f,this._time)-g)/(e-g)}_applyTimeSettings(f,g){const e=null!=g.speedFactor?g.speedFactor:
1;null!=g.duration?f=g.duration:null!=g.speedFactor&&(f=b.Milliseconds(f/e));return b.Milliseconds(Math.min(Math.max(null!=g.minDuration?g.minDuration:k.defaultSettings.minDuration/e,f),null!=g.maxDuration?g.maxDuration:k.defaultSettings.maxDuration/e))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","./Settings"],function(a,b){class h{constructor(c){this._createCamera=c;this.compared={sourceZoom:0,targetZoom:0,
pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=c();this.target=c()}clone(){const c=new h(this._createCamera);c.copyFrom(this);return c}copyFrom(c){this.update(c.source,c.target,c.settings)}update(c,k,m){this.source!==c&&this.source.copyFrom(c);this.target!==k&&this.target.copyFrom(k);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=m.desiredScreenFlow?m.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;
this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(c){c=this.target.pixelsPerPanAtZoom(c);return this.halfWindowSize/c}get hasZoom(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}get hasPan(){return 1E-9<this.compared.pan}get hasRotate(){return 1E-9<this.compared.rotate}}a.Definition=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports",
"../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define(["exports","../../easing","../Path","../Segment","./planning"],function(a,b,h,c,k){class m extends h.Path{constructor(d,f){super();this._preallocSegments=[new c.Segment,new c.Segment,new c.Segment];this._descensionSegment=this._ascensionSegment=
null;this.update(d,f)}update(d,f){if(d){this.definition?this.definition.copyFrom(d):this.definition=d.clone();var g=null;f?.apex&&(g=k.optimalDistance(d,f.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==g?this._updateWithoutApex():this._updateWithApex(g,f?.apex)}}segmentInterpolateComponentsAt(d,f,g){g=d.interpolateComponentsAt(f,g);d===this._ascensionSegment?g.zoom=b.outQuad(g.zoom):d===this._descensionSegment&&(g.zoom=b.inQuad(g.zoom));return g}_updateWithApex(d,
f){const [g,e,n]=this._preallocSegments,l=f?.ascensionFactor??.5;f=Math.min(1-l,null!=f?.ascensionFactor&&null!=f.descensionFactor?f.descensionFactor:.5);const u=1-l-f;g.definition?g.definition.copyFrom(this.definition):g.definition=this.definition.clone();g.definition.compared.targetZoom=d;g.definition.compared.pan=this.definition.compared.pan*l;g.definition.compared.rotate=this.definition.compared.rotate*l;g.update();this._ascensionSegment=g;this.segments.push(g);0<u&&(e.definition?e.definition.copyFrom(this.definition):
e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=d,e.definition.compared.targetZoom=d,e.definition.compared.pan=this.definition.compared.pan*u,e.definition.compared.rotate=this.definition.compared.rotate*u,e.update(),this.segments.push(e));n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone();n.definition.compared.sourceZoom=d;n.definition.compared.pan=this.definition.compared.pan*f;n.definition.compared.rotate=
this.definition.compared.rotate*f;n.update();this._descensionSegment=n;this.segments.push(n)}_updateWithoutApex(){const [d]=this._preallocSegments;d.update(this.definition);this.segments.push(d)}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../core/time"],function(a,b){a.Path=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((h,c)=>b.Seconds(h+c.time),b.Seconds(0))}interpolateComponentsAt(h,
c){h=Math.min(Math.max(h,0),1);h*=this.time;let k=0,m=0;const d=this.definition,f=this.segments.reduce((g,e)=>g||e.definition.hasZoom,!1);for(let g=0;g<this.segments.length;g++){const e=this.segments[g],n=e.definition;if(h<=e.time||g===this.segments.length-1){c=this.segmentInterpolateComponentsAt(e,0===e.time?0:h/e.time,c);d.hasPan&&!isNaN(c.pan)&&isFinite(d.compared.pan)?c.pan=(k+n.compared.pan*c.pan)/d.compared.pan:c.pan=1;d.hasRotate&&!isNaN(c.rotate)&&isFinite(d.compared.rotate)?c.rotate=(m+n.compared.rotate*
c.rotate)/d.compared.rotate:c.rotate=1;if(f&&!isNaN(c.zoom)&&isFinite(n.compared.targetZoom)){const {sourceZoom:l,targetZoom:u}=n.compared;c.zoom=(c.zoom*(u-l)+l)/this.segments[this.segments.length-1].definition.compared.targetZoom}else c.zoom=1;return c}h-=e.time;k+=n.compared.pan;m+=n.compared.rotate}}segmentInterpolateComponentsAt(h,c,k){return h.interpolateComponentsAt(c,k)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports",
"../../../core/time"],function(a,b){class h{get time(){return this._time}constructor(c){c&&this.update(c)}update(c){c&&(this.definition?this.definition.copyFrom(c):this.definition=c.clone());this._updatePrecomputedVariables();this._updatePixelFlow()}_updatePrecomputedVariables(){var c=this.definition;const k=c.compared,m=k.sourceZoom,d=k.targetZoom;this._zoomSign=m>d?1:-1;this._panPixelsAtSource=k.pan*c.source.pixelsPerPanAtZoom(m);c=(c.source.pixelsPerRotateAtZoom(m)+c.target.pixelsPerRotateAtZoom(d))/
2;this._rotatePixels=k.rotate*c}_updatePixelFlow(){var c=this.definition.compared.sourceZoom,k=this.definition.compared.targetZoom;const {hasZoom:m,hasPan:d,hasRotate:f}=this.definition;var g=0,e=0;m&&(d&&(g=(k/c-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),f&&(e=Math.log(c/k)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;c=this.definition.desiredPixelFlow;m&&d&&
f?(k=g+e+g*e,this._zoomPixelFlow=g*e/k*c,this._panPixelFlow=e/k*c,this._rotatePixelFlow=g/k*c):m&&d?(e=1+g,this._zoomPixelFlow=g/e*c,this._panPixelFlow=1/e*c):m&&f?(g=1+e,this._zoomPixelFlow=e/g*c,this._rotatePixelFlow=1/g*c):d&&f?(g=this._panPixelsAtSource/this._rotatePixels,e=1+g,this._panPixelFlow=g/e*c,this._rotatePixelFlow=1/e*c):d?this._panPixelFlow=c:m?this._zoomPixelFlow=c:f&&(this._rotatePixelFlow=c);this._time=f?this.rotateTime:m?this.zoomTime:d?this.panTime:b.Seconds(0)}get rotateTime(){return this.definition.hasRotate?
b.Seconds(this._rotatePixels/this._rotatePixelFlow):b.Seconds(0)}get zoomTime(){return this.definition.hasZoom?b.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):b.Seconds(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const c=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return b.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*
c+1)/(c*this._zoomPixelFlow))}return b.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return b.Seconds(0)}_interpolateComponentsZoom(c){if(0===c||1===c)return c;if(this.definition.hasZoom){const k=this.definition.compared.sourceZoom,m=this.definition.compared.targetZoom;return(k*(k/m)**-c-k)/(m-k)}return c}_interpolateComponentsPan(c){if(0===c||1===c)return c;if(this.definition.hasPan&&this.definition.hasZoom){const k=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/
this._panPixelsAtSource*this._panPixelFlow*(2**(k*c*this._time)-1)/(k*Math.LN2)}return c}_interpolateComponentsRotate(c){return c}interpolateComponentsAt(c,k){c=Math.min(Math.max(c,0),1);const m=this._interpolateComponentsZoom(c),d=this._interpolateComponentsPan(c);c=this._interpolateComponentsRotate(c);k?(k.zoom=m,k.pan=d,k.rotate=c):k={zoom:m,pan:d,rotate:c};return k}}a.Segment=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,b){function h(c,k){const m=Math.max(c.compared.sourceZoom,c.compared.targetZoom);c=c.source.zoomAtPixelsPerPan(c.desiredPixelFlow/c.compared.pan)/2;return c<m?null!=k.maximumDistance?m+(k.maximumDistance-m)/2:1.5*m:k.maximumDistance?Math.min(k.maximumDistance,c):c}a.optimalDistance=function(c,k){let m=h(c,k);const d={ascensionFactor:null!=k.ascensionFactor?k.ascensionFactor:.5,descensionFactor:null!=k.descensionFactor?k.descensionFactor:.5};var f=0===d.ascensionFactor,g=
0===d.descensionFactor;const e=f?b.tAscensionZoomOnly:b.tAscensionZoomPan,n=f?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,l=f?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,u=g?b.tDescensionZoomOnly:b.tDescensionZoomPan,x=g?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,w=g?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;f=E=>e(c,E,d)+b.tPanion(c,E,d)+u(c,E,d);g=E=>n(c,E,d)+b.dtPanion(c,E,d)+x(c,E,d);const q=E=>l(c,E,d)+b.ddtPanion(c,E,d)+w(c,E,d);let v=f(m);const p=b.tBaseLine(c);let t;const r=k.maximumIterations||
20,y=null!=k.maximumDistance?k.maximumDistance:Infinity;for(t=0;t<r;t++){var D=k.desiredSlope??1E-6;let E=g(m);Math.abs(E)>D&&(E+=D);D=E/q(m);if(isNaN(D)||m>=y&&0>D){if(!isFinite(y))return null;m=y;v=f(m);break}m-=D;if(m<c.compared.sourceZoom||m<c.compared.targetZoom)return null;D=f(m);if(.005>=Math.abs(D-v)/v)break;v=D}return v>.7*p||m<c.compared.sourceZoom||m<c.compared.targetZoom?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],
function(a){a.ddtAscensionZoomOnly=function(b,h){return-b.halfWindowSize/(h*h*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,h,c){const k=h-b.compared.sourceZoom,m=1/k,d=1/h,f=Math.log(b.compared.sourceZoom*d);c=(c.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(k))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*d*c+2*m*f+2*d-2*f*c/(k*k)-c/(h*h))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,h){return-b.halfWindowSize/(h*h*b.desiredPixelFlow*
Math.LN2)};a.ddtDescensionZoomPan=function(b,h,c){const k=h-b.compared.targetZoom,m=1/k,d=1/h,f=Math.log(h/b.compared.targetZoom);c=(b.halfWindowPanAtZoom(h)+c.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*d*c-2*m*f+2*d+2*f*c/(k*k)-c/(h*h))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,h,c){return-2*b.compared.pan*b.halfWindowSize*(c.ascensionFactor+c.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(h*
h*h))};a.dtAscensionZoomOnly=function(b,h){return b.halfWindowSize/(h*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,h,c){const k=1/h,m=Math.log(b.compared.sourceZoom*k),d=1/b.desiredPixelFlow,f=1/Math.LN2;h-=b.compared.sourceZoom;const g=1/h;c=(c.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(h))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*k*d*f*g*c-b.halfWindowSize*m*d*f*g+b.halfWindowSize*m*d*f*c/(h*h)};a.dtDescensionZoomOnly=function(b,h){return b.halfWindowSize/
(h*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,h,c){const k=Math.log(h/b.compared.targetZoom),m=1/b.desiredPixelFlow,d=1/Math.LN2,f=-h+b.compared.targetZoom,g=1/f;c=(-b.halfWindowPanAtZoom(h)-c.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*k*m*d*g+b.halfWindowSize*k*m*d*c/(f*f)+b.halfWindowSize*m*d*g*c/h};a.dtPanion=function(b,h,c){return b.compared.pan*b.halfWindowSize*(c.ascensionFactor+
c.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(h*h))};a.tAscensionZoomOnly=function(b,h){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/h)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,h,c){const k=b.halfWindowPanAtZoom(h-b.compared.sourceZoom);return-b.halfWindowSize*(c.ascensionFactor*Math.LN2*b.compared.pan+k)*Math.log(b.compared.sourceZoom/h)/(b.desiredPixelFlow*Math.LN2*k)};a.tBaseLine=function(b){var h=b.compared.sourceZoom-b.compared.targetZoom;if(0===
h)return b.compared.pan*b.halfWindowSize/(b.desiredPixelFlow*b.halfWindowPanAtZoom(b.compared.sourceZoom));const c=Math.LN2*b.compared.pan;h=b.halfWindowPanAtZoom(h);const k=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*h);return b.compared.sourceZoom<=b.compared.targetZoom?k*(c-h):k*(c+h)};a.tDescensionZoomOnly=function(b,h){return b.halfWindowSize*Math.log(h/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,
h,c){return b.halfWindowSize*(-b.halfWindowPanAtZoom(h)-c.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(h/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-h+b.compared.targetZoom))};a.tPanion=function(b,h,c){return-b.compared.pan*b.halfWindowSize*(c.ascensionFactor+c.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(h))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.AnimationController=class extends n.CameraController{constructor(){super(...arguments);this._asyncResult=null}get canStop(){return!0}set asyncResult(l){this._asyncResult&&(this._asyncResult.reject(c.createAbortError()),this._asyncResult=null);this.state===n.State.Finished||this.state===n.State.Stopped?(h.assertIsSome(l),this.state===n.State.Finished?l.resolve():l.reject(c.createAbortError())):this._asyncResult=l}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=
n.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==n.State.Ready&&this.state!==n.State.Running||(this.viewAnimation.state===e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=n.State.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===n.State.Finished?this.viewAnimation.finish():
this.state===n.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===n.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(c.createAbortError()))}finish(){this.finishController()}};a.AnimationController=b.__decorate([g.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){a.State=void 0;(function(g){g[g.Ready=0]="Ready";g[g.Rejected=1]="Rejected";g[g.Running=2]="Running";g[g.Stopped=3]="Stopped";g[g.Finished=4]="Finished"})(a.State||(a.State={}));a.CameraController=class extends h{constructor(g){super(g);this.state=a.State.Ready}get active(){return this.state===a.State.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return this.canStop?(this.state=a.State.Stopped,!0):!1}finishController(){this.state=a.State.Finished}get steppingFinished(){return!1}};
b.__decorate([c.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);b.__decorate([c.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([c.property()],a.CameraController.prototype,"state",void 0);b.__decorate([c.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=b.__decorate([f.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(pa,wa,Ba){Ba=k.fromRotation(q.sm4d.get(),Ba[3],n.axis(Ba));null==Ba||k.exactEquals(Ba,m.IDENTITY)||(g.subtract(Y,pa.eye,wa),g.transformMat4(Y,Y,Ba),pa.eye=g.add(Y,Y,wa),g.subtract(Y,pa.center,wa),g.transformMat4(Y,Y,Ba),pa.center=g.add(Y,Y,wa),pa.up=g.transformMat4(Y,pa.up,Ba))}function D(pa,wa,Ba,la){return Math.sin(pa/g.length(wa))*(Ba+la.radius)}function E(pa,wa,Ba,la){Ba=v.fromScreenAtEye(wa,Ba,ya);if(null==Ba)return!1;x.closestPointOnSilhouette(pa,
Ba,V);return x.intersectRay(pa,Ba,la)?g.squaredDistance(V,Ba.origin)<g.squaredDistance(la,Ba.origin)?(g.copy(la,V),!1):!0:(g.subtract(Q,wa.eye,wa.center),g.normalize(Q,Q),u.fromNormalAndOffset(Q,-g.dot(g.normalize(Q,Q),V),T),u.intersectRay(T,Ba,la),!1)}function A(pa,wa,Ba,la,qa,ua){var va=0;g.cross(ra,pa,wa);g.subtract(ja,pa,wa);g.length(pa)<=qa||!la.aboveGround?(g.cross(Ba,ja,la.eye),va=g.dot(pa,wa)/(g.length(pa)*g.length(wa)),.9999>va?va=h.acosClamped(va):(pa=g.length(g.cross(e.create(),pa,wa))/
(g.length(pa)*g.length(wa)),va=h.asinClamped(pa)),ua=Math.cos(h.clamp(b.cyclicalPI.normalize(h.deg2rad(ua)),0,S)),va=-va-Math.max(0,g.length(wa)-qa)/(ua*qa)):(g.subtract(ia,la.eye,la.center),g.cross(Ba,ja,ia),va=-g.length(ja)/qa);g.normalize(Ba,Ba);g.scale(Ba,Ba,g.length(ra));return va}function B(pa,wa,Ba,la){la=Math.cos(h.clamp(b.cyclicalPI.normalize(h.deg2rad(la)),0,S));wa=wa>Ba?-(wa-Ba)/(la*Ba):wa<-Ba?Math.PI-(wa+Ba)/(la*Ba):h.acosClamped(wa/Ba);return((pa>Ba?-(pa-Ba)/(la*Ba):pa<-Ba?Math.PI-(pa+
Ba)/(la*Ba):h.acosClamped(pa/Ba))-wa)*Ba}function F(pa,wa,Ba,la,qa,ua,va,Ga,La,Na){Ga=B(pa[2],wa[2],ua[3],Ga);wa=La?B(pa[0],wa[0],ua[3],180):wa[0]-pa[0];pa=Math.sin(va)*wa-Math.cos(va)*Ga;va=Math.cos(va)*wa+Math.sin(va)*Ga;g.normalize(Y,qa);qa=La?pa/Math.sqrt(Math.abs(ua[3]**2-g.dot(Ba,Y)**2)):pa/ua[3];Ba=va/Math.sqrt(Math.abs(ua[3]**2-g.dot(Ba,la)**2));d.set(Na,qa,Ba)}function G(pa,wa,Ba,la,qa,ua,va,Ga,La,Na){g.cross(ra,pa,wa);l.coordinateSystemFromOneAxisAndNormalVector(ua.up,ua.eye,R,ba,X);l.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],ua.eye,O,U,P);g.copy(Ba,U);g.copy(la,O);g.normalize(Ba,Ba);g.scale(Ba,Ba,g.length(ra));l.vectorCoordinates(pa,g.normalize(ba,ba),g.normalize(X,X),g.normalize(R,R),da);l.vectorCoordinates(wa,ba,X,R,ha);F(da,ha,pa,O,U,va,Ga,La,Na,qa)}function H(pa,wa,Ba,la,qa,ua,va){k.fromRotation(Z,qa,la);k.fromRotation(ea,va,ua);k.multiply(ca,Z,ea);g.subtract(wa,pa,Ba);g.transformMat4(wa,wa,ca);g.add(wa,wa,Ba)}function L(pa,wa,Ba,la,qa,ua){k.fromRotation(Z,la,Ba);k.fromRotation(ea,ua,qa);k.multiply(ca,Z,ea);
g.subtract(Y,pa.eye,wa);g.transformMat4(Y,Y,ca);pa.eye=g.add(Y,Y,wa);g.subtract(Y,pa.center,wa);g.transformMat4(Y,Y,ca);pa.center=g.add(Y,Y,wa);g.subtract(Y,pa.up,wa);g.transformMat4(Y,Y,ca);pa.up=g.add(Y,Y,wa)}function C(pa,wa,Ba,la,qa,ua){return(Math.abs(la)>Math.PI-M.Angle||Math.abs(la)<M.Angle)&&(Math.abs(pa[2])<Ba*M.Pole||Math.abs(wa)>Ba)&&ua.aboveGround&&qa<M.Tilt}function z(pa,wa,Ba,la,qa,ua){ua?(n.fromPoints(Ba,la,aa),y(wa,x.getCenter(pa),aa)):(Ba=A(Ba,la,ta,wa,pa[3],qa),y(wa,x.getCenter(pa),
n.wrapAxisAngle(ta,Ba)))}function J(pa,wa,Ba,la,qa,ua,va){const Ga=va?20:1;g.copy(W,la);oa.copyFrom(wa);let La;for(let Na=0;Na<Ga&&1E-12<g.squaredDistance(Ba,W);Na++)if(la=g.squaredDistance(Ba,W),G(Ba,W,U,O,fa,oa,pa,qa,ua,va),L(oa,x.getCenter(pa),O,fa[1],U,fa[0]),H(W,W,x.getCenter(pa),O,fa[1],U,fa[0]),La=g.squaredDistance(Ba,W),La<la||0===Na)wa.copyFrom(oa);else break}a.SpherePickPointFallback=void 0;(function(pa){pa[pa.Ellipsoid=0]="Ellipsoid";pa[pa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));r={exclude:new Set([r.terrainId])};const K=c.createScreenPointArray();a.NavigationMode=void 0;(function(pa){pa[pa.Vertical=0]="Vertical";pa[pa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const I={Elevation:3E4,Angle:h.deg2rad(16)},M={Pole:.95,Angle:h.deg2rad(18),Tilt:45},S=h.deg2rad(80),N=e.create(),V=e.create(),Q=e.create(),T=u.create(),ia=e.create(),O=e.create(),U=e.create(),P=e.create(),R=e.create(),ba=e.create(),X=e.create(),da=e.create(),
ha=e.create(),fa=f.create(),aa=n.create(),Z=m.create(),ea=m.create(),ca=m.create(),W=e.create(),Y=e.create(),ja=e.create(),oa=new t.Camera,ra=e.create(),ta=e.create(),ya={origin:e.create(),direction:e.create()},Ca={origin:e.create(),direction:e.create()};a.PreservingHeadingThreshold=M;a.TiltThresholdPanningSpeed=S;a.VerticalPanTresholds=I;a.applyPanPlanar=function(pa,wa,Ba){g.subtract(N,Ba,wa);pa.eye=g.subtract(Y,pa.eye,N);pa.center=g.subtract(Y,pa.center,N)};a.applyPanSphericalDirectRotation=z;a.applyPanSphericalPreserveHeading=
J;a.applyRotation=y;a.applyRotationWithTwoAxes=L;a.applyZoomOnSphere=function(pa,wa,Ba){wa.getScreenCenter(K);p.intersectScreen(pa,wa,K,Y)&&(wa.center=Y);pa=wa.distance;Ba*=pa;1E-6>Math.abs(pa-Ba)||(Ba=g.scale(q.sv3d.get(),wa.viewForward,Ba),wa.eye=g.subtract(Y,wa.center,Ba))};a.applyZoomToPoint=function(pa,wa,Ba,la){const qa=q.sv3d.get();Ba=1-Ba;g.subtract(qa,wa,pa.eye);const ua=g.length(qa);let va=ua*(1-Ba);0<=Ba&&va<la&&(va=la,Ba=-(va-ua)/ua);1E-6>Math.abs(ua-va)||(g.scale(qa,qa,Ba),pa.eye=g.add(Y,
pa.eye,qa),pa.center=g.lerp(Y,pa.center,wa,Ba))};a.centroid=function(pa,wa){g.set(wa,0,0,0);for(const Ba of pa)g.add(wa,wa,Ba);g.scale(wa,wa,1/pa.length)};a.contentIntersectorOptions=r;a.decideNavigationMode=function(pa,wa,Ba){if(g.length(pa.eye)-Ba.radius>I.Elevation)return a.NavigationMode.Horizontal;v.fromScreenAtEye(pa,wa,Ca);return-Math.sign(pa.relativeElevation)*(.5*Math.PI+w.angle(pa.eye,Ca.direction))<I.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.distanceClampValues=[1,
3E8];a.intersectPlaneFromScreenPoint=function(pa,wa,Ba,la){return u.intersectRay(pa,v.fromScreen(wa,Ba,ya),la)};a.intersectPlaneFromScreenPointAtEye=function(pa,wa,Ba,la){return u.intersectRay(pa,v.fromScreenAtEye(wa,Ba,ya),la)};a.lengthFromPoints=B;a.minHeightLimit=50;a.normalizeCoordinate=function(pa,wa,Ba){Ba[0]=wa[0]/(pa.fullWidth/pa.pixelRatio);Ba[1]=wa[1]/(pa.fullHeight/pa.pixelRatio);return Ba};a.normalizeRotationDelta=function(pa){for(;pa>Math.PI;)pa-=2*Math.PI;for(;pa<-Math.PI;)pa+=2*Math.PI;
return pa};a.offSurfaceTiltToEyeTiltGlobal=function(pa,wa,Ba,la){return D(Math.PI/2,wa,Ba,la)+(pa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=D;a.panDistanceModifier=5;a.panMotionToRotationMatrix=function(pa,wa,Ba,la,qa,ua,va,Ga,La){if(C(pa.center,g.dot(pa.up,pa.center),g.length(pa.center),-b.cyclicalPI.normalize(h.deg2rad(ua)),va,wa))switch(pa=-b.cyclicalPI.normalize(h.deg2rad(qa)),{eye:qa}=wa,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],qa,O,U,P),qa=Ba.translation[0]*la.pan,ua="zoom"===La.mode?
0:Ba.translation[1]*la.pan,wa=Math.max(Math.sqrt(Math.abs(1-g.dot(wa.center,O)**2/g.length(wa.center)**2)),.5),va=-Math.cos(pa)*ua+Math.sin(pa)*qa,k.rotate(Ga.pan.matrix,Ga.pan.matrix,(Math.sin(pa)*ua+Math.cos(pa)*qa)/wa,O),Ga.pan.enabled=!0,La.mode){case "pan":k.rotate(Ga.pan.matrix,Ga.pan.matrix,va,U);Ga.pan.enabled=!0;break;case "zoom":Ga.zoom=-Ba.translation[1]*la.zoom}else{const {eye:Na,viewRight:Wa}=wa;wa=g.cross(q.sv3d.get(),Wa,Na);pa=Ba.translation[0]*la.pan;0!==pa&&(k.rotate(Ga.pan.matrix,
Ga.pan.matrix,-pa,wa),Ga.pan.enabled=!0);switch(La.mode){case "pan":Ba=Ba.translation[1]*la.pan;0!==Ba&&(k.rotate(Ga.pan.matrix,Ga.pan.matrix,Ba,Wa),Ga.pan.enabled=!0);break;case "zoom":Ga.zoom=-Ba.translation[1]*la.zoom}}};a.panToPosition=function(pa,wa,Ba,la,qa,ua,va){C(Ba,g.dot(wa.up,Ba),pa[3],-b.cyclicalPI.normalize(h.deg2rad(qa)),ua,wa)?J(pa,wa,Ba,la,-b.cyclicalPI.normalize(h.deg2rad(qa)),ua,va):z(pa,wa,Ba,la,ua,va)};a.pickPointAndInitSphere=function(pa,wa,Ba,la,qa,ua){const va=e.create(),Ga=
x.create();let La=!0,Na=!0;pa.intersectScreen(Ba,va,ua)?Ga[3]=g.length(va):(Na=!1,Ga[3]=wa.aboveGround&&qa!==a.SpherePickPointFallback.Ellipsoid?Math.max(g.length(wa.center),.9*la.radius):g.length(wa.eye)-wa.relativeElevation,qa===a.SpherePickPointFallback.Silhouette?E(Ga,wa,Ba,va):La=p.intersectScreen(Ga,wa,Ba,va));return{sphere:Ga,scenePickPoint:La?va:null,hasGeometryIntersection:Na}};a.pivotDistanceModifier=30;a.preserveHeadingThreshold=C;a.rotatePivotDistanceModifier=5;a.rotatePivotMinDistanceModifier=
10;a.rotatePointAroundTwoAxes=H;a.rotateScreenPixelArea=90;a.rotationAngleAndAxisDirectRotation=A;a.rotationAnglesAndAxesHeadingPreserving=G;a.rotationAnglesHeadingPreserving=F;a.screenPixelArea=80;a.sphereOrPlanePointFromScreenPoint=E;a.zoomDistanceModifier=8;a.zoomMaxDistanceModifier=1508E5;a.zoomMinDistanceModifier=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ./vector ./vectorStacks".split(" "),
function(a,b,h,c,k,m){function d(u=e){return[u[0],u[1],u[2],u[3]]}function f(u,x,w,q,v=d()){v[0]=u;v[1]=x;v[2]=w;v[3]=q;return v}function g(u,x){u[3]=x;return u}const e=[0,0,1,0],n=h.create(),l=h.create();a.angle=function(u){return u[3]};a.axis=function(u){return u};a.compose=function(u,x,w){b.setAxisAngle(n,u,u[3]);b.setAxisAngle(l,x,x[3]);b.multiply(n,l,n);return g(w,b.getAxisAngle(w,n))};a.copy=function(u,x=d()){return f(u[0],u[1],u[2],u[3],x)};a.create=d;a.fromAxisAndAngle=function(u,x){const w=
d();c.copy(w,u);w[3]=x;return w};a.fromPoints=function(u,x,w){c.cross(w,u,x);c.normalize(w,w);w[3]=k.angle(u,x);return w};a.fromValues=f;a.setAngle=g;a.up=e;a.wrap=function(u,x,w,q){return f(u,x,w,q,m.sv4d.get())};a.wrapAxisAngle=function(u,x){return f(u[0],u[1],u[2],x,m.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,h,c,k,m){function d(e,n,l){return f(e,e.screenToRender(n,b.castRenderScreenPointArray3(m.sv3d.get())),l)}function f(e,n,l){const u=b.castRenderScreenPointArray3(h.copy(m.sv3d.get(),n));u[2]=0;if(!e.unprojectFromRenderScreen(u,l.origin))return null;n=b.castRenderScreenPointArray3(h.copy(m.sv3d.get(),n));n[2]=1;e=e.unprojectFromRenderScreen(n,m.sv3d.get());if(null==e)return null;c.subtract(l.direction,e,l.origin);return l}function g(e,n,l){c.copy(l.origin,e.eye);n=c.set(m.sv3d.get(),n[0],
n[1],1);e=e.unprojectFromRenderScreen(n,m.sv3d.get());if(null==e)return null;c.subtract(l.direction,e,l.origin);return l}a.fromRender=f;a.fromRenderAtEye=g;a.fromScreen=d;a.fromScreenAtEye=function(e,n,l){return g(e,e.screenToRender(n,b.castRenderScreenPointArray3(m.sv3d.get())),l)};a.fromScreenNormalized=function(e,n,l=k.create()){d(e,b.screenPointObjectToArray(n),l);c.normalize(l.direction,l.direction);return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports",
"../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,h,c){const k=b.create();a.intersectScreen=function(m,d,f,g){d=c.fromScreenAtEye(d,f,k);return h.intersectRay(m,d,g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){a.ZoomStepController=class extends v.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=n.create();this._tmpCamera=new t.Camera;this._tmpRayDir=n.create();this._tmpCenter=n.create();this._beginCamera=new t.Camera;this._constraintOptions=new u.ConstraintOptions(x.ConstraintTypes.ALL,w.InteractionType.ZOOM,null,this._beginCamera)}zoomStep(B,F){if(this.active){var G=this.view.state;this.animation.finished?this._beginCamera.copyFrom(G.camera):
this.animation.cameraAt(1,this._beginCamera);this._tmpCamera.copyFrom(G.camera);var H=r.newIntersector(this.view.state.viewingMode);G=!1;0<B?(G=this.intersectionHelper.intersectScreenFreePointFallback(F,this._zoomLocation,0===this.view.map.ground.opacity?p.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,H,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,H,this._zoomLocation)?this._tmpCamera.center=
this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);B=.6**B;F=this.view._stage.renderView.getMinimalDepthForArea(q.getVoxelWasm(this.view),F[0],F[1],this.view.state.camera,60);e.subtract(A,this._tmpCamera.eye,this._zoomLocation);e.normalize(A,A);H=h.clamp(Math.min(p.zoomDistanceModifier,1/Math.abs(e.dot(E,A)))*Math.abs(this.view.camera.position.z),p.zoomMinDistanceModifier,p.zoomMaxDistanceModifier);if(F=null!=F?F:H)if(H=n.create(),e.subtract(H,this._zoomLocation,this._tmpCamera.eye),
F<e.length(H)||!G)e.normalize(H,H),e.add(this._zoomLocation,this._tmpCamera.eye,e.scale(H,H,F));this._updateCamera(this._tmpCamera,B,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:c.Milliseconds(600),easing:y.outExpo}}_updateCamera(B,F,G){e.subtract(this._tmpRayDir,G,B.eye);const H=e.length(this._tmpRayDir);let L=H*F;const C=Math.max(4,1.01*B.nearFar[0]);0!==L&&(1>=F&&L<C&&(L=C,F=L/H),1E-6>Math.abs(H-L)||(e.scale(this._tmpRayDir,this._tmpRayDir,F),B.eye=e.subtract(D,
G,this._tmpRayDir),B.center=e.lerp(D,B.center,G,1-F),l.applyAll(this.view,B,this._constraintOptions)))}};a.ZoomStepController=b.__decorate([g.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const D=n.create(),E=n.fromValues(0,0,1),A=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/VoxelWasm":function(){define(["require","exports"],function(a,b){let h,c=null;const k=new Map;b.addLayerViewToWasm=async function(m){null==
c&&(null==h&&(h=new Promise((g,e)=>a(["../../../layers/VoxelWasmPerSceneView"],n=>g(Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}))),e))),c=await h);const d=m.view;let f=k.get(d);f||(f=new c.default({view:d}),k.set(d,f));return f.addVoxelLayer(m)};b.getVoxelWasm=function(m){return k.get(m)};b.removeLayerViewFromWasm=function(m){const d=m.view,f=k.get(d);f&&1>f.removeVoxelLayer(m)&&(k.delete(d),0===k.size&&(c=h=null))};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,h){if("touch"===b.pointerType)return!1;switch(h){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,h){switch(h){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,h,c,k){class m extends c.InputHandler{constructor(d,f,g,e){super(!0);this._view=d;this.pointerAction=f;this._pivot=g;this.registerIncoming("drag",e,n=>this._handleDrag(n))}_handleDrag(d){const f=
d.data;if(!(1<f.pointers.size)&&k.eventMatchesMousePointerAction(d.data,this.pointerAction)){var g=b.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new h.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(g);break;case "update":this._cameraController&&this._cameraController.update(g);
break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}d.stopPropagation()}}}Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>h.PivotPoint});a.DragRotate=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../../layers/VoxelWasm ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){a.PivotPoint=void 0;(function(H){H[H.CENTER=0]="CENTER";H[H.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=class extends A.InteractiveController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(H){super(H);this.pivot=a.PivotPoint.CENTER;this._rotScale=0;this._lastPoint=u.create();this._tmpWorldUp=w.create();this._tmpViewDir=w.create();this._tmpRotCurPoint=u.create();this._tmpTransf=n.create();
this._tmpAxis=w.create();this._tmpPivotPoint=w.create();this._pivotPos=w.create();this._constraintOptions=new p.ConstraintOptions(t.ConstraintTypes.ALL,r.InteractionType.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5}begin(H){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:x.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=r.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=y.TiltMode.LOOK_AROUND;this._constraintOptions.selection=
t.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const L=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?B.contentIntersectorOptions:{});L||x.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(H,L);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=r.InteractionType.TUMBLE;this._constraintOptions.tiltMode=y.TiltMode.TUMBLE;this._constraintOptions.selection=t.ConstraintTypes.ALL&
~t.ConstraintTypes.DISTANCE}B.normalizeCoordinate(this.startCamera,H,this._lastPoint)}}_constrainPivotPoint(H,L){const C=this.startCamera,z=w.create();x.subtract(z,this._pivotPos,C.eye);const J=x.length(z);var K=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(C.eye,G);K=Math.max(Math.min(B.rotatePivotDistanceModifier,1/Math.abs(x.dot(G,C.viewForward)))*K,B.rotatePivotMinDistanceModifier);L&&(K=Math.min(J,K));var I=q.getReferenceEllipsoid(this.view.spatialReference),
M=c.createScreenPointArray(C.width/C.pixelRatio*.5,C.height/C.pixelRatio*.5);I=B.decideNavigationMode(this.startCamera,M,I);M=this.view._stage.renderView.getMinimalDepthForArea(D.getVoxelWasm(this.view),C.fullWidth/C.pixelRatio*.5,C.fullHeight/C.pixelRatio*.5,C,2.5*B.rotateScreenPixelArea,B.rotateScreenPixelArea);H=this.view._stage.renderView.getMinimalDepthForArea(D.getVoxelWasm(this.view),H[0],H[1],C,B.rotateScreenPixelArea);if(null!=M||null!=H)M=M??H??0,H=null==H||I===B.NavigationMode.Horizontal?
M:H,K=M>H?H:M,K=L?Math.min(K,J):K;x.normalize(z,z);x.copy(this._pivotPos,x.add(this._tmpPivotPoint,C.eye,x.scale(this._tmpPivotPoint,z,K)))}update(H){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,H,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,H,this.currentCamera.eye,this._pivotPos)}v.applyAll(this.view,
this.currentCamera,this._constraintOptions);this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(H,L,C,z){this.view.renderCoordsHelper.worldUpAtPosition(z,this._tmpWorldUp);B.normalizeCoordinate(H,L,this._tmpRotCurPoint);L=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let J=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;x.subtract(this._tmpViewDir,C,z);C=x.length(this._tmpViewDir);C=h.acosClamped(x.dot(this._tmpViewDir,this._tmpWorldUp)/C);if(this.pivot===
a.PivotPoint.EYE){const K=.5*Math.PI-C,I=.495*Math.PI;L=K-Math.max(-I,Math.min(I,K+-.5*L))}L=h.clamp(L+C,E.TiltRange.min,E.TiltRange.max)-C;x.cross(this._tmpAxis,H.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(J=-J);e.fromRotation(this._tmpTransf,J,this._tmpWorldUp);e.rotate(this._tmpTransf,this._tmpTransf,L,this._tmpAxis);x.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);H.up=x.transformMat4(F,H.up,this._tmpTransf);x.add(F,z,this._tmpViewDir);l.copy(this._lastPoint,this._tmpRotCurPoint);
return F}};b.__decorate([k.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([g.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const F=w.create(),G=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,h,c,k,m,d,f,g,e){a.InteractiveController=class extends g.CameraController{constructor(){super(...arguments);this.startCamera=new e.Camera;this.currentCamera=new e.Camera;this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<f.interactingTimeout}stepController(n,l){l.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(l)}onControllerStart(n){this.state=g.State.Running;this.startCamera.copyFrom(n);this.currentCamera.copyFrom(n)}onControllerEnd(n){n.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),f.interactingTimeout);this.view.state.updateCamera(n=>this.stepController(0,n));this.steppingFinished&&this.finishController()}};b.__decorate([h.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);b.__decorate([h.property()],a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=b.__decorate([d.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/projection ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState ../../webgl/FramebufferObject".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M){a.ViewStateManager=class extends k{constructor(U){super(U);this.ready=!1;this._windowDevicePixelRatio=1;this._devicePixelRatioOverride=null;this._idleTimeout=300;this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:P=>this._devicePixelRatioOverride=P,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=
this.renderState},get idleTimeoutEnabled(){return 0<this.viewStateManager._idleTimeout},set idleTimeoutEnabled(P){this.viewStateManager._idleTimeout=P?300:0}};this._propertiesPool=new C.PropertiesPool({frustum:F.Frustum},this);this._cameraSetByUser=!1;this._gotoOperation=null;this._cameraChangeTime=0;this._tmpCanvasSize=new S}initialize(){this._cameraChangeTime=performance.now();this.addHandles([f.on(()=>this.view.state.events,"before-camera-change",U=>U&&this._updateElevation(U)),f.watch(()=>this.view.state?.camera,
(U,P)=>this._cameraChangedHandler(U,P),f.sync)]);f.when(()=>this.view.state?.camera,U=>this._updateElevation(U),{once:!0,sync:!0});this.addHandles([g.addFrameTask({prepare:()=>this._prepareFrame()}),f.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),f.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit();this._propertiesPool=d.destroyMaybe(this._propertiesPool)}get camera(){const U=
this._get("camera");if(!this.ready)return U;const P=L.internalToExternal(this.view,this.view.state.camera,T);return P&&U&&P.equals(U)?U:P.clone()}set camera(U){this._updatePropertyBeforeReady("camera",U)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(L.externalToInternal(this.view,U),{applyConstraints:!1})||m.getLogger(this).error("#camera\x3d","Invalid camera",U),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const U=this._get("contentCamera");if(!this.ready)return U;
const P=L.internalToExternal(this.view,this.view.state.contentCamera,T);return P&&U&&P.equals(U)?U:P.clone()}set contentCamera(U){this._updatePropertyBeforeReady("contentCamera",U)||(U=L.externalToInternal(this.view,U),null==U?this.view.state.contentCamera=null:(this._updateElevation(U),this.view.state.contentCamera=U))}installContentCameraReset(U){this.removeHandles("content-camera-reset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const P=this.zoom,
R=this.view.state.camera.distance**2,ba=q.fromArray(this.view.state.camera.center),X=U.sticky?this.contentCamera.clone():null;this.addHandles([f.watch(()=>this.contentCamera,()=>{U.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),f.watch(()=>this.zoom,da=>{void 0!==da&&void 0!==P&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(da-P)/2),2<Math.abs(da-P)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=X))}),
f.watch(()=>this.view.state.camera,da=>{da=w.squaredDistance(ba,da.center);this.test.contentCameraResetState.set("camera.center",da/R);da>R?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=X)})],"content-camera-reset");return!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(U){this._updatePropertyBeforeReady("center",U)||(U?this.isCompatible(U)?this.setStateCamera(this._centerToCamera(U),{applyConstraints:!0})?
this.view.pointsOfInterest.centerOnContent.runTask():m.getLogger(this).error("#center\x3d","Invalid center",U):m.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(U.spatialReference?U.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",U):m.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");var U=this.view;U=L.toExtent(U,U.state.camera,U.pointsOfInterest.centerOnContent.renderLocation);
return null!=U?U:this._get("extent")}set extent(U){this._updatePropertyBeforeReady("extent",U)||(U?this.isCompatible(U)?this.setStateCamera(this._extentToCamera(U),{applyConstraints:!0})||m.getLogger(this).error("#extent\x3d","Invalid extent",U):m.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(U.spatialReference?U.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",U):m.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}get frustum(){const U=
this._propertiesPool.get("frustum");U.renderCoordsHelper=this.view.renderCoordsHelper;U.update(this.view.state.camera);return U}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const U=this.view.map;return U&&"initialViewProperties"in U?U.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const U=this.view.pointsOfInterest.centerOnContent;return L.distanceToScale(this.view,U.distance,U.location.latitude)}return this._get("scale")}set scale(U){this._updatePropertyBeforeReady("scale",
U)||this.setStateCamera(this._scaleToCamera(U),{applyConstraints:!0})||m.getLogger(this).error("#scale\x3d","Invalid scale",U)}get padding(){if(!this.ready)return this._get("padding");var U=this.view.state.camera,P=U.padding;const R=U.pixelRatio;U=this._get("padding");const ba=Math.round(P[J.PaddingSide.TOP]/R),X=Math.round(P[J.PaddingSide.RIGHT]/R),da=Math.round(P[J.PaddingSide.BOTTOM]/R);P=Math.round(P[J.PaddingSide.LEFT]/R);return null!=U&&U.top===ba&&U.right===X&&U.bottom===da&&U.left===P?U:{top:ba,
right:X,bottom:da,left:P}}set padding(U){this._updatePropertyBeforeReady("padding",U)||(this._paddingToArray(U,this.view.state.camera.pixelRatio,O),this.view.state.updateCamera(P=>P.padding=O))}_paddingToArray(U,P,R){U?v.set(R,U.top||0,U.right||0,U.bottom||0,U.left||0):v.set(R,0,0,0,0);for(U=0;4>U;U++)R[U]=Math.round(R[U]*P)}get screenCenter(){const U=this.padding;return e.createScreenPoint((this.view.width-(U.left+U.right))/2+U.left,(this.view.height-(U.top+U.bottom))/2+U.top)}get viewpoint(){return this.ready?
z.fromCamera(this.view,this.camera):this._get("viewpoint")}set viewpoint(U){if(!this._updatePropertyBeforeReady("viewpoint",U))if(U)if(this.isCompatible(U))this.setStateCamera(this._viewpointToCamera(U),{applyConstraints:!U.camera})||m.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",U);else{var P=null!=U.camera?U.camera.position:U.targetGeometry;P=null!=P&&P.spatialReference;m.getLogger(this).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(P?P.wkid:
"none")+", view: "+this.view.spatialReference?.wkid+")",U)}else m.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}get zoom(){return this.ready?L.scaleToZoom(this.view,this.scale):this._get("zoom")}set zoom(U){this._updatePropertyBeforeReady("zoom",U)||void 0===U||this.setStateCamera(this._zoomToCamera(U),{applyConstraints:!0})||m.getLogger(this).error("#zoom\x3d","Invalid zoom",U)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=
this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var U=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio);U=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:U)*this.view.resolutionScale;this._tmpCanvasSize.width=
Math.round(this.view.surface.clientWidth*U);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*U);const P=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;P&&M.ensureAttachmentMaxSize(this._tmpCanvasSize,P);this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:U;this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,
this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(K.RenderFeature.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const U=this.view?._stage?.renderer;
return U&&(U.isFeatureEnabled(K.RenderFeature.PhysicalPixelRendering,I.RenderState.IDLE)||U.isFeatureEnabled(K.RenderFeature.PhysicalPixelRendering,I.RenderState.INTERACTING)||U.isFeatureEnabled(K.RenderFeature.PhysicalPixelRendering,I.RenderState.ANIMATING))}preinit(U){return this._isOverridden("center")&&!y.isLoadedOrLoadFor(this.center.spatialReference,U)||this._isOverridden("camera")&&!y.isLoadedOrLoadFor(this.camera.position.spatialReference,U)||this._isOverridden("extent")&&!y.isLoadedOrLoadFor(this.extent.spatialReference,
U)||this._isOverridden("viewpoint")&&(!y.isLoadedOrLoadFor(this.viewpoint.targetGeometry?.spatialReference,U)||!y.isLoadedOrLoadFor(this.viewpoint.camera?.position?.spatialReference,U))?!1:!0}init(){this._constraintsManager=new B.ConstraintsManager({view:this.view});this._prepareFrame();var U=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const P of U)this.set(P.name,P.value);this._cameraSetByUser||((U=this._initialViewpoint||this.view.initialExtent)&&this.isCompatible(U)?
this._setInitialView(U):this.view.state.viewingMode===D.ViewingMode.Local&&this.addHandles(f.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))}exit(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this._constraintsManager=
d.destroyMaybe(this._constraintsManager))}async goTo(U,P){P={animate:!0,...P};null!=this._gotoOperation&&this._gotoOperation.abort(P.animate);this._gotoOperation=new G.GoToOperation(U,P,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(A.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})}step(U){const P=this.view.state,R=P?.cameraController;R&&(P.updateCamera(ba=>R.stepController(U,ba)),R.steppingFinished&&
R.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const U=new Set,P=[];for(const {propertyName:R,overrides:ba}of V){const X=U.has(R),da=this._isOverridden(R);!X&&da&&P.push({name:R,value:this._get(R)});this._clearOverride(R);(X||da)&&ba.forEach(ha=>U.add(ha))}return P}_setInitialView(U){if(null!=U&&!this._cameraSetByUser)if(U instanceof h)this.setStateCamera(L.externalToInternal(this.view,U),{applyConstraints:!1});
else if(U instanceof c)if(U.targetGeometry instanceof t){var P=L.fromExtentSync(this.view,U.targetGeometry,0,.5,L.OrientationMode.LOCKED);null!=P&&this.setStateCamera(L.externalToInternal(this.view,P),{applyConstraints:!0})}else P={applyConstraints:!U.camera},U=this._viewpointToCamera(U),this.setStateCamera(U,P);else P=L.fromExtentSync(this.view,U,0,.5,L.OrientationMode.LOCKED),null!=P&&this.setStateCamera(L.externalToInternal(this.view,P),{applyConstraints:!0})}_updatePropertyBeforeReady(U,P){if(this.ready)return!1;
this._override(U,P);P&&N.has(U)&&this._override("hasInitialView",!0);return!0}isCompatible(U){return null==U?!1:U instanceof c?U.camera?this.isCompatible(U.camera):this.isCompatible(U.targetGeometry):U instanceof h?this.isCompatible(U.position):U.spatialReference&&!y.requiresLoad(U.spatialReference,this.view.spatialReference)}_getPreservingHeadingTilt(U=Q){this._cameraSetByUser?(U.heading=this.camera.heading,U.tilt=this.camera.tilt):(U.heading=0,U.tilt=.5);return U}_centerPointAtDistanceToCamera(U,
P,R=ia){const {heading:ba,tilt:X}=this._getPreservingHeadingTilt();U=L.getObserverForPointAtDistanceSync(this.view,ba,X,U,P,L.OrientationMode.ADJUST);if(null==U)return null;R.copyFrom(this.view.state.camera);R.eye=U.eye;R.center=U.center;R.up=U.up;return R}_centerToCamera(U){const P=this.view.pointsOfInterest.centerOnContent;P.runTask();return this._centerPointAtDistanceToCamera(U,P.distance)}_extentToCamera(U){const {heading:P,tilt:R}=this._getPreservingHeadingTilt();return(U=L.fromExtentSync(this.view,
U,P,R,L.OrientationMode.ADJUST,T))?L.externalToInternal(this.view,U):null}_scaleToCamera(U){if(null==U)return null;const P=this.view.pointsOfInterest.centerOnContent;P.runTask();const R=P.renderLocation;U=L.scaleToDistance(this.view,U,P.location.latitude);return this._centerPointAtDistanceToCamera(R,U)}_zoomToCamera(U){return this._scaleToCamera(L.zoomToScale(this.view,U))}_viewpointToCamera(U){return L.externalToInternal(this.view,z.toCameraSync(this.view,U))}setStateCamera(U,P){if(null==U||!this.view.state.stopActiveCameraController())return!1;
this._cameraSetByUser=!0;P.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(R=>{P.positionAndOrientationOnly?(R.eye=U.eye,R.center=U.center,R.up=U.up):R.copyFrom(U);P.applyConstraints&&E.applyAll(this.view,R)});P.applyConstraints||(this.view.state.cameraController=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:U}));return!0}_prepareFrame(){const {surface:U,canvas:P}=this.view;if(U&&P){this._windowDevicePixelRatio=window.devicePixelRatio;
var R=this._computeCanvasSize();if(0!==R.width&&0!==R.height){if(P.width!==R.width||P.height!==R.height)P.width=R.width,P.height=R.height;if(this.view.state){const ba=this.view.state.camera;if(ba.fullWidth!==R.width||ba.fullHeight!==R.height||ba.pixelRatio!==R.pixelRatio)ia.copyFrom(ba),ia.pixelRatio!==R.pixelRatio&&(this._paddingToArray(this.padding,R.pixelRatio,O),ia.padding=O),ia.fullWidth=R.width,ia.fullHeight=R.height,ia.pixelRatio=R.pixelRatio,this.view.state.camera=ia;this._updateViewState()}}}}_updateElevation(U){var P=
this.view.basemapTerrain?.spatialReference;const R=this.view.renderCoordsHelper?.getAltitude(U.eye)??0;P=P?A.surfaceElevationBelowRenderLocation(this.view,U.eye):0;U.relativeElevation=R-P}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=I.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=I.RenderState.INTERACTING:(this.view.state.mode===I.RenderState.ANIMATING&&(this._cameraChangeTime=0),performance.now()-
this._cameraChangeTime<this._idleTimeout?this.view.state.mode=I.RenderState.INTERACTING:this.view.state.mode=I.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(U,P){U&&P&&U.almostEquals(P)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};b.__decorate([n.property({type:h,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);b.__decorate([n.property({type:h,dependsOn:["view.state.contentCamera","ready"]})],
a.ViewStateManager.prototype,"contentCamera",null);b.__decorate([n.property({type:r})],a.ViewStateManager.prototype,"center",null);b.__decorate([n.property({type:t})],a.ViewStateManager.prototype,"extent",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);b.__decorate([n.property()],a.ViewStateManager.prototype,"_constraintsManager",void 0);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"constraintsManager",null);b.__decorate([n.property()],
a.ViewStateManager.prototype,"_initialViewpoint",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);b.__decorate([n.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);b.__decorate([n.property({type:Number})],a.ViewStateManager.prototype,"scale",null);b.__decorate([n.property()],a.ViewStateManager.prototype,"padding",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"screenCenter",null);b.__decorate([n.property({constructOnly:!0})],
a.ViewStateManager.prototype,"view",void 0);b.__decorate([n.property({type:c})],a.ViewStateManager.prototype,"viewpoint",null);b.__decorate([n.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);b.__decorate([n.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",
null);b.__decorate([n.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);b.__decorate([n.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=b.__decorate([x.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);class S{constructor(){this.height=this.width=0;this.pixelRatio=1}}const N=new Set("camera viewpoint extent scale center zoom".split(" ")),V=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",
overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Q={heading:0,tilt:0},T=new h,ia=new J.Camera,O=p.create();a.interactingTimeout=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintOptions ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.ConstraintsManager=class extends h{constructor(t){super(t);this.nearFarHeuristic=v.createNearFarHeuristic(t.view.state.viewingMode,t.view.basemapTerrain,t.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([k.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),k.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",
t=>this._updateCameraNearFar(t)),k.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),k.sync),k.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),k.sync),k.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),k.sync),k.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),k.sync),k.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),k.sync),k.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,
this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),k.sync)]);this.view.state.isLocal&&this.addHandles(k.watch(()=>this.view.renderDataExtent,t=>this._updateLocalSurfaceDistance(t),k.initial));this._updateNearFar();this.view.state.viewingMode!==n.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new p.SurfaceCollisionConstraint({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const t=this.view.constraints?.clipDistance;t&&"auto"!==t.mode&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,t))}_updateNearFar(){this.view.state.updateCamera(t=>this._updateCameraNearFar(t))}_updateCameraNearFar(t){const r=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(r?r.mode:"auto")?this._updateCameraNearFarManual(t,r):this._updateCameraNearFarAuto(t,r)}_updateCameraNearFarAuto(t,
r){this.nearFarHeuristic.compute(t.eye,t.center,this.view.renderDataExtent,u.surfaceElevationBelowRenderLocation(this.view,t.eye),t);r&&r.autoUpdate(t.near,t.far)}_updateCameraNearFarManual(t,r){r&&(t.near=r.near,t.far=r.far)}_updateCollision(){var t=this.view.map?.ground?.navigationConstraint?.type;t=t?"stay-above"===t:!0;const r=this.view.state.constraints.collision;t!==r.enabled&&((r.enabled=t)&&this._reapplyConstraints(w.ConstraintTypes.COLLISION),(t=this.view.constraints&&this.view.constraints.tilt)&&
"auto"!==t.mode||this._updateTiltAuto())}_updateAltitude(){const t=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=t&&this.view.state.viewingMode!==n.ViewingMode.Local?{min:t.min,max:t.max}:null;this._reapplyConstraints()}_updateTiltMax(){const t=this.view.constraints&&this.view.constraints.tilt;t&&"auto"!==t.mode&&(this._updateTiltManual(t),this._reapplyConstraints())}_updateTilt(){const t=this.view.constraints&&this.view.constraints.tilt;"manual"===(t?
t.mode:"auto")?this._updateTiltManual(t):this._updateTiltAuto();this._reapplyConstraints()}_updateTiltManual(t){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(c.deg2rad(t.max))}_updateTiltAuto(){const t=this.view.state.constraints;t.tilt=t.createDefaultTilt();this._updateTiltAutoMax()}_updateTiltAutoMax(){const t=this.view.constraints&&this.view.constraints.tilt;if(t&&"auto"===t.mode){var r=this.view.state.constraints;r.tilt&&(r=r.tilt(this.view.state.camera.distance).max,t.autoUpdate(c.rad2deg(r)))}}_updateLocalSurfaceDistance(t){if(null!=
t){var r=Math.max(t.width,t.height);0>=r||(null!=t.zmax&&null!=t.zmin&&(r=Math.max(r,t.zmax-t.zmin)),t=this.view.state,r=3*r/Math.atan(t.camera.fov/2),r!==t.constraints.distance&&(t.constraints.distance=r))}}_reapplyConstraints(t=w.ConstraintTypes.ALL){this.view.state.updateCamera(r=>l.applyAll(this.view,r,new x.ConstraintOptions(t,q.InteractionType.NONE,null)))}};b.__decorate([m.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([m.property({readOnly:!0})],a.ConstraintsManager.prototype,
"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([e.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(w,q,v,p){v=2/v;w/q>v?(p.far=w,p.near=p.far/q):(p.near=v,p.far=p.near*q);return p}class n{constructor(w,q){this._elevationProvider=w;this._referenceEllipsoid=m.getReferenceEllipsoid(q);this._unitInMeters=h.getMetersPerUnitForSR(q,this._referenceEllipsoid.metersPerDegree)}compute(w,q,v,p,t){t||={near:0,far:0};var r=w[2]*this._unitInMeters,y=r;p=r-p;var D=this._elevationProvider?.visibleElevationBounds;D&&(r=0<=p?y-this._unitInMeters*D.min:this._unitInMeters*D.max-
y);v=null!=v?v:new d({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});y=Math.max(v.xmax-v.xmin,v.ymax-v.ymin,4*Math.max(v.xmax-v.xmin,v.ymax-v.ymin));c.subtract(x,q,w);u[0]=0<x[0]?v.xmax:v.xmin;u[1]=0<x[1]?v.ymax:v.ymin;u[2]=0<x[2]?y/2:-y/2;c.subtract(u,u,w);c.normalize(x,x);w=1.1*c.dot(u,x)*this._unitInMeters;q=Math.sqrt(r*(r+2*this._referenceEllipsoid.radius));v=Math.max(v.xmax-v.xmin,v.ymax-v.ymin);D=1E-4*v*this._unitInMeters;r=b.clamp((r-D)/(.001*v*this._unitInMeters-D),0,1);r=Math.min(b.lerp(q,w,
r**3),q)*Math.max(Math.log(Math.abs(p)),1);return e(Math.min(r,Math.max(34064E4,y))/this._unitInMeters,2E4,this._unitInMeters,t)}}class l{constructor(w){this._referenceEllipsoid=m.getReferenceEllipsoid(w)}compute(w,q,v,p,t){t||={near:0,far:0};w=c.length(w);q=w-this._referenceEllipsoid.radius;q=Math.max(Math.abs(q-p),Math.abs(q));p=1.2*b.lerp(Math.sqrt(q*(q+2*(this._referenceEllipsoid.radius+Math.min(0,p)))),w+this._referenceEllipsoid.radius,g.computeInnerAltitudeFade(q));w=b.clamp(2E4-(Math.log(q)-
7.983)/9.011*19E3,1E3,2E4);return e(p,w,1,t)}}const u=k.create(),x=k.create();a.createNearFarHeuristic=function(w,q,v){return w===f.ViewingMode.Global?new l(v):new n(q,v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,h,c,k,m,d,f,g,e){a.SurfaceCollisionConstraint=class extends h{constructor(n){super(n)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",n=>this._handleElevationChangeEvent(n)))}_handleElevationChangeEvent(n){if(!this.view.state.cameraController){var l=this.view.state.camera;null!=n.spatialReference&&g.eyeWithinExtent(this.view,l,n.extent,n.spatialReference)&&this._applyToCurrentCamera()}}_applyToCurrentCamera(){this.view.state.updateCamera(n=>e.applySurfaceCollisionConstraint(this.view,
n,e.Mode.EYE_AND_CENTER))}};b.__decorate([c.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/frustum"],function(a,
b,h,c){function k(d,f,g){d.origin=f;d.endpoint=g;b.direction(d.direction,f,g)}class m{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(d){this.renderCoordsHelper=d;this.frustum=c.create();this._points=c.createPoints();this.lines=Array(12);this._origin=h.create();this._direction=h.create();this._altitude=null;for(d=0;12>d;d++)this.lines[d]={origin:null,direction:h.create(),
endpoint:null}}update(d){c.fromMatrix(d.viewMatrix,d.projectionMatrix,this.frustum,this._points);b.copy(this._origin,d.eye);b.copy(this._direction,d.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()}updatePoints(d){for(let f=0;f<this._points.length;f++)b.copy(this._points[f],d[f]);c.computePlanes(this.frustum,this._points);this._updateLines()}get altitude(){return this._altitude}intersectsSphere(d){return c.intersectsSphere(this.frustum,d)}intersectsRay(d){return c.intersectsRay(this.frustum,
d)}intersectsLineSegment(d,f){return c.intersectsLineSegment(this.frustum,d,f)}intersectsPoint(d){return c.intersectsPoint(this.frustum,d)}_updateLines(){const d=this._points;for(let f=0;4>f;f++){const g=f+4;k(this.lines[f],d[f],d[g]);k(this.lines[f+4],d[f],3===f?d[0]:d[f+1]);k(this.lines[f+8],d[g],3===f?d[4]:d[g+1])}}}m.planePointIndices=c.planePointIndices;m.nearFarLineIndices=[[c.PointIndex.NEAR_BOTTOM_LEFT,c.PointIndex.FAR_BOTTOM_LEFT],[c.PointIndex.NEAR_BOTTOM_RIGHT,c.PointIndex.FAR_BOTTOM_RIGHT],
[c.PointIndex.NEAR_TOP_RIGHT,c.PointIndex.FAR_TOP_RIGHT],[c.PointIndex.NEAR_TOP_LEFT,c.PointIndex.FAR_TOP_LEFT]];a.Frustum=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x{constructor(w,q,v){this.target=w;this.options=q;this.view=v;this.state="pending";this._animationController=null;this.promise=new Promise((p,t)=>{this._resolveCallback=p;this._rejectCallback=t;p=new AbortController;if(null!=this.options.signal)k.onAbort(this.options.signal,()=>{this.abort()});this._abortController=p;this.waitForReady()})}resolve(w){if("finished"!==this.state)return this.state="finished",this._resolveCallback(w)}reject(w){if("finished"!==
this.state)return this.state="finished",this._rejectCallback(w)}abort(w=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!w&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(k.createAbortError())}async waitForReady(){this.state="wait-for-ready";if(!this.view.ready)try{await m.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(w){return this.reject(w)}this.createViewPoint()}async createViewPoint(){if("finished"!==
this.state){this.state="wait-for-viewpoint";this._animationController=this.options.animate?this._getAnimationController():null;try{const q=await u.create(this.view,this.target,this._abortController.signal);if("finished"!==this.state){var w=q?this._getCameraFromViewpoint(q):null;null!=w&&(this.options.animate?null!=this._animationController&&this.startAnimation(w,this._animationController):(this.view.stateManager.setStateCamera(w.camera,{applyConstraints:!w.isFullySpecified,positionAndOrientationOnly:!0,
doNotCancelGoToOperation:!0}),this.resolve()))}}catch(q){this.reject(q)}}}_getCameraFromViewpoint(w){const q=!!(this.target instanceof h&&this.target.camera||this.target instanceof b);var v=w.camera;if(null==v)return null;if(!this.view.stateManager.isCompatible(v))return w=(w=v.position)&&w.spatialReference,this.reject(new c("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${w?w.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,
{camera:v})),null;v=l.externalToInternal(this.view,v);return null==v?(this.reject(new c("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:w,camera:v,isFullySpecified:q}}startAnimation(w,q){this.state="wait-for-animation-finish";const v=q.viewAnimation;if(null==v)this.reject(new c("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{v.update(w.viewpoint,"running");if(!q.active||null==q.viewAnimation||q.viewAnimation.target!==w.viewpoint||this.view.state.cameraController!==
q)return this.abort();if(w.isFullySpecified){var p=new n.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:w.camera});f.applySurfaceCollisionConstraint(this.view,w.camera,f.Mode.EYE_AND_CENTER)}else d.applyAll(this.view,w.camera);q.begin(w.camera,this.options);var t=r=>{if(null!=this.view.state)switch(q.state){case g.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case g.State.Ready:case g.State.Rejected:case g.State.Running:case g.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(r)}}};
v.when(()=>{const r=this.view.state.cameraController;p&&(r&&r.active?r instanceof e.PointToPointAnimationController&&null!=r.viewAnimation&&r.viewAnimation.target===w.viewpoint&&(this.view.state.cameraController=p):null!=q.viewAnimation&&q.viewAnimation.target===w.viewpoint&&q.state===g.State.Finished&&(this.view.state.cameraController=p))},r=>t(r));q.asyncResult={resolve:()=>t(),reject:r=>t(r)}}}_getAnimationController(){let w=null;var q=null;q=this.view.state.cameraController;q instanceof e.PointToPointAnimationController&&
(q.updateStateFromViewAnimation(),q.active&&(w=q,q=w.viewAnimation));return null!=w||(w=new e.PointToPointAnimationController({view:this.view,mode:"animation"}),q=w.viewAnimation,this.view.state.switchCameraController(w))?w:(null!=q&&q.stop(),this.reject(new c("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}a.GoToOperation=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,h,c,k,m,d,f,g,e){a.SurfaceCollisionCorrectionController=class extends e.CameraController{set desiredCamera(n){this._set("desiredCamera",n.clone())}constructor(n){super(n)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=e.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",n=>this._handleElevationChangeEvent(n)));this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(n){(null==
n.spatialReference||f.eyeWithinExtent(this.view,this.desiredCamera,n.extent,n.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(n=>{n.copyViewFrom(this.desiredCamera);g.applySurfaceCollisionConstraint(this.view,n,g.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=e.State.Stopped)})}};b.__decorate([h.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([d.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],
a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Multipoint".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J){async function K(pa,wa,Ba,la){var qa=wa.camera;if(null!=qa)return I(qa,F.getViewSR(pa),la);({targetGeometry:qa}=wa);if(null==qa)throw Error("Viewpoint has no targetGeometry!");const {camera:ua,mode:va}=M(pa,wa.rotation,Ba);if("point"===qa.type)return S(pa,wa,qa,ua,va,la);wa=qa.extent;if(null==wa)throw Error("Target geometry has no extent!");return F.fromExtentAsync(pa,wa,ua.heading,ua.tilt,va,la)}async function I(pa,wa,Ba){wa=
await q.projectWithZConversion(pa.position,wa,{signal:Ba});e.throwIfAborted(Ba);pa=pa.clone();pa.position=wa.clone();return pa}function M(pa,wa,Ba){pa=F.internalToExternal(pa,pa.state.camera);let la=F.OrientationMode.ADJUST;null!=wa&&(pa.heading=360-f.cyclicalDegrees.normalize(wa),la=F.OrientationMode.LOCKED);null!=Ba&&(pa.tilt=Ba);return{camera:pa,mode:la}}async function S(pa,wa,Ba,la,qa,ua){const va=pa.spatialReference;Ba=await q.projectWithZConversion(Ba.clone(),va,{signal:ua});e.throwIfAborted(ua);
wa=null!=wa.scale?F.scaleToDistance(pa,wa.scale,Ba.latitude):pa.state.camera.distance;return F.fromCenterDistanceAsync(pa,Ba,wa,la,qa,ua)}function N(pa,wa){return null==wa.scale&&null!=wa.zoom?F.zoomToScale(pa,wa.zoom):wa.scale}function V(pa,wa){let Ba=!1;null!=wa.heading?(pa.heading=wa.heading,Ba=!0):null!=wa.rotation&&(pa.heading=360-f.cyclicalDegrees.normalize(wa.rotation),Ba=!0);null!=wa.tilt&&(pa.tilt=wa.tilt,Ba=!0);null!=wa.fov&&(pa.fov=wa.fov);return Ba}function Q(pa,wa,Ba,la){var qa=pa.spatialReference||
C.WGS84;wa=null!=wa?wa:F.externalToInternal(pa,Ba);if(null==wa)return la;qa=new H({spatialReference:qa});if(!t.projectVectorToPoint(wa.center,pa.renderSpatialReference,qa))return la;la.targetGeometry=qa;la.scale=F.computeScale(pa,wa);la.rotation=f.cyclicalDegrees.normalize(360-Ba.heading);la.camera=Ba;return la}async function T(pa,wa,Ba,la){const qa=()=>new g("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!wa)throw qa();"mesh"===wa.type&&(wa=wa.extent);const ua=wa.spatialReference,
va=pa.spatialReference,Ga=pa.basemapTerrain.spatialReference;if(!wa.hasZ&&pa.basemapTerrain){let Na;switch(wa.type){case "point":Na=wa;break;case "multipoint":case "polyline":Na=wa.extent?.center;break;case "extent":Na=wa.center;break;case "polygon":Na=wa.centroid}null!=Na&&null!=Ga&&null!=pa.elevationProvider?(Na=await q.projectWithZConversion(Na,Ga,{signal:la}),Z[2]=G.getElevationAtPoint(pa.elevationProvider,Na)??0):Z[2]=0}const La=[];(0,Ca[wa.type])(wa,wa.hasZ?Na=>{La.push([Na[0],Na[1],Na[2]])}:
Na=>{La.push([Na[0],Na[1]])},Z);if(0===La.length)throw qa();pa=await q.projectWithZConversion(new J({spatialReference:ua,hasZ:wa.hasZ,hasM:!1,points:La}),va,{signal:la});wa.hasZ&&(Ba.hasZ=!0);if(wa.hasZ)for(const [Na,Wa,Ia]of pa.points)Z[0]=Na,Z[1]=Wa,Z[2]=Ia,y.expandWithVec3(Ba.boundingBox,Z);else for(const [Na,Wa]of pa.points)Z[0]=Na,Z[1]=Wa,y.expandWithVec3(Ba.boundingBox,Z)}async function ia(pa,wa,Ba,la,qa){const ua=await m.result(pa.whenViewForGraphic(wa));if(!1!==ua.ok&&null!=ua.value&&"whenGraphicBounds"in
ua.value)if(Ba=await m.result(ua.value.whenGraphicBounds(wa,{minDemResolution:Ba})),!1!==Ba.ok&&Ba.value){var {screenSpaceObjects:va,boundingBox:Ga}=Ba.value;y.expandWithAABB(la.boundingBox,Ga);va&&va.forEach(La=>{la.screenSpaceObjects.push(La)});isFinite(Ga[2])&&(la.hasZ=!0)}else await T(pa,wa.geometry,la,qa);else await T(pa,wa.geometry,la,qa)}async function O(pa,wa,Ba,la,qa){if(Array.isArray(wa)&&2===wa.length){const ua=wa[0],va=wa[1];if("number"===typeof ua&&"number"===typeof va){ya.x=ua;ya.y=
va;ya.z=void 0;ya.spatialReference=pa.spatialReference?.isGeographic?pa.spatialReference:C.WGS84;await T(pa,ya,la,qa);return}}wa&&"map"in wa&&"function"===typeof wa.map?await Promise.allSettled(wa.map(ua=>O(pa,ua,Ba,la,qa))):wa instanceof z?await T(pa,wa,la,qa):wa instanceof c&&await ia(pa,wa,Ba,la,qa)}async function U(pa,wa,Ba,la,qa){if(null!=wa.camera)return P(pa,wa.camera,la,qa);qa.scale=wa.scale;qa.rotation=wa.rotation;qa.targetGeometry=null!=wa.targetGeometry?wa.targetGeometry.clone():null;qa.camera=
null;null!=Ba.heading?qa.rotation=f.cyclicalDegrees.normalize(360-Ba.heading):null!=Ba.rotation&&(qa.rotation=Ba.rotation);wa=N(pa,Ba);null!=wa&&(qa.scale=wa);qa.camera=await K(pa,qa,Ba.tilt,la);return qa}async function P(pa,wa,Ba,la){Ba=await q.projectWithZConversion(wa.position,pa.spatialReference,{signal:Ba});wa=wa.clone();wa.fov=pa.camera.fov;wa.position=Ba;return Q(pa,null,wa,la)}async function R(pa,wa,Ba,la,qa,ua,va){const Ga=pa.renderSpatialReference;await p.projectPointToVectorAsync(wa,ra,
Ga,0,{signal:va});await p.projectPointToVectorAsync(Ba,oa,Ga,0,{signal:va});ua.targetGeometry=new H(wa);qa.position=new H(Ba);x.subtract(ja,ra,oa);F.directionToHeadingTilt(pa,oa,ja,la.up,qa);ua.scale=F.distanceToScale(pa,x.distance(oa,ra),ua.targetGeometry.latitude);ua.rotation=f.cyclicalDegrees.normalize(360-qa.heading);ua.camera=qa;return ua}async function ba(pa,wa,Ba,la,qa,ua){if(null==Ba)throw new g("createfromcenter","invalid point");ua.targetGeometry=Ba.clone();const va=B.cameraOnContentAlongViewDirection(pa);
if(wa.position)return R(pa,ua.targetGeometry,wa.position,va,la,ua,qa);if(wa.zoomFactor){var Ga=va.distance/wa.zoomFactor;const La=x.scale(Z,va.viewForward,-Ga);va.eye=x.add(Z,va.center,La);ua.scale=F.distanceToScale(pa,Ga,Ba.latitude)}F.internalToExternal(pa,va,la);Ga=V(la,wa)?F.OrientationMode.LOCKED:F.OrientationMode.ADJUST;wa.zoomFactor||(wa=N(pa,wa),null==wa?({renderSpatialReference:wa}=pa,await p.projectPointToVectorAsync(Ba,Z,wa,0,{signal:qa}),E.intersectsPoint(va.frustum,Z)?ua.scale=F.distanceToScale(pa,
x.distance(va.eye,Z),Ba.latitude):ua.scale=F.computeScale(pa,va)):ua.scale=wa,ua.camera=await F.fromCenterScale(pa,ua.targetGeometry,ua.scale,la,Ga,qa));return ua}async function X(pa,wa,Ba,la,qa){var ua=B.cameraOnContentAlongViewDirection(pa);x.copy(ja,ua.viewForward);F.directionToHeadingTilt(pa,ua.eye,ja,ua.up,ta);ua=pa.spatialReference;const {position:va}=wa;va?(qa=await q.projectWithZConversion(va,ua,{signal:qa}),Ba.position=qa):Ba.position=new H;Ba.heading=null!=wa.heading?wa.heading:ta.heading;
Ba.tilt=null!=wa.tilt?wa.tilt:ta.tilt;return Q(pa,null,Ba,la)}async function da(pa,wa,Ba,la,qa){const ua=B.cameraOnContentAlongViewDirection(pa),{spatialReference:va,renderSpatialReference:Ga}=pa,La=new H({spatialReference:va});return t.projectVectorToPoint(ua.center,Ga,La)?ba(pa,wa,La,Ba,la,qa):ba(pa,wa,null,Ba,la,qa)}async function ha(pa,wa,Ba,la,qa,ua){ua.targetGeometry=Ba.clone();const va=B.cameraOnContentAlongViewDirection(pa);F.internalToExternal(pa,va,la);wa=V(la,wa)?F.OrientationMode.LOCKED:
F.OrientationMode.ADJUST;ua.camera=await F.fromExtentAsync(pa,Ba,la.heading,la.tilt,wa,qa);return ua}async function fa(pa,wa,Ba,la,qa,ua,va,Ga){Ga.targetGeometry=Ba.clone();const La=B.cameraOnContentAlongViewDirection(pa);var Na=0;null!=Ba.z?Na=Ba.z:pa.basemapTerrain&&pa.elevationProvider&&(Na=G.getElevationAtPoint(pa.elevationProvider,Ba));x.set(Z,Ba.x,Ba.y,Na);v.computeTranslationToOriginAndRotation(pa.spatialReference,Z,ea,pa.renderSpatialReference);n.fromMat4(ca,ea);n.transpose(ca,ca);y.empty(W);
Ba=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Wa=0;Wa<Ba.length;Wa++){const Ia=Ba[Wa];let Oa=la[Ia[2]];isFinite(Oa)||(Oa=Na);x.set(Z,la[Ia[0]],la[Ia[1]],Oa);r.projectVectorToVector(Z,pa.spatialReference,Z,pa.renderSpatialReference);y.expandWithVec3(W,x.transformMat3(Z,Z,ca))}la=y.width(W);Na=y.height(W);Ba=y.depth(W);Wa=1/Math.tan(La.fovY/2);qa=Math.max(.5*Math.sqrt(la*la+Ba*Ba)*Math.max(Wa,1/Math.tan(La.fovX/2))+.5*Na,.5*Na*Wa+.5*Math.max(la,Ba))/qa;F.internalToExternal(pa,
La,ua);wa=V(ua,wa)?F.OrientationMode.LOCKED:F.OrientationMode.ADJUST;Ga.scale=F.distanceToScale(pa,qa,Ga.targetGeometry.latitude);Ga.camera=await F.fromCenterScale(pa,Ga.targetGeometry,Ga.scale,ua,wa,va);return Ga}function aa(pa){null!=pa?.camera&&(pa.rotation=f.cyclicalDegrees.normalize(360-pa.camera.heading));return pa}const Z=w.create(),ea=u.create(),ca=l.create(),W=y.create(),Y=D.create(),ja=w.create(),oa=w.create(),ra=w.create(),ta={heading:0,tilt:0},ya=new H,Ca={point(pa,wa,Ba){Ba[0]=pa.x;Ba[1]=
pa.y;null!=pa.z&&(Ba[2]=pa.z);wa(Ba)},polygon(pa,wa,Ba){const la=pa.hasZ;for(let qa=0;qa<pa.rings.length;qa++){const ua=pa.rings[qa];for(let va=0;va<ua.length;va++)Ba[0]=ua[va][0],Ba[1]=ua[va][1],la&&(Ba[2]=ua[va][2]),wa(Ba)}},polyline(pa,wa,Ba){const la=pa.hasZ;for(let qa=0;qa<pa.paths.length;qa++){const ua=pa.paths[qa];for(let va=0;va<ua.length;va++)Ba[0]=ua[va][0],Ba[1]=ua[va][1],la&&(Ba[2]=ua[va][2]),wa(Ba)}},multipoint(pa,wa,Ba){const la=pa.points;pa=pa.hasZ;for(let qa=0;qa<la.length;qa++)Ba[0]=
la[qa][0],Ba[1]=la[qa][1],pa&&(Ba[2]=la[qa][2]),wa(Ba)},extent(pa,wa,Ba){null!=pa.zmin&&null!=pa.zmax?(wa(x.set(Ba,pa.xmin,pa.ymin,pa.zmin)),wa(x.set(Ba,pa.xmax,pa.ymin,pa.zmin)),wa(x.set(Ba,pa.xmin,pa.ymax,pa.zmin)),wa(x.set(Ba,pa.xmax,pa.ymax,pa.zmin)),wa(x.set(Ba,pa.xmin,pa.ymin,pa.zmax)),wa(x.set(Ba,pa.xmax,pa.ymin,pa.zmax)),wa(x.set(Ba,pa.xmin,pa.ymax,pa.zmax)),wa(x.set(Ba,pa.xmax,pa.ymax,pa.zmax))):(wa(x.set(Ba,pa.xmin,pa.ymin,Ba[2])),wa(x.set(Ba,pa.xmax,pa.ymin,Ba[2])),wa(x.set(Ba,pa.xmin,
pa.ymax,Ba[2])),wa(x.set(Ba,pa.xmax,pa.ymax,Ba[2])))}};a.create=async function(pa,wa,Ba){if(wa&&pa.spatialReference){var la={target:void 0};"declaredClass"in wa||Array.isArray(wa)?la.target=wa:(Object.assign(la,wa),wa.center&&!la.target&&(la.target=wa.center));wa=la}else wa=null;if(!wa)throw new g("viewpointutils-create:no-target","Missing target for creating viewpoint");la=new b({fov:pa.camera.fov});const qa=new k({camera:la});if(wa.target instanceof k)return pa=await U(pa,wa.target,wa,Ba,qa),aa(pa);
if(wa.target instanceof b)return aa(await P(pa,wa.target,Ba,qa));var ua=null!=wa.scale||null!=wa.zoom;if(wa.target instanceof L){var va=wa.target.xmin===wa.target.xmax||wa.target.ymin===wa.target.ymax;return ua||va?aa(await ba(pa,wa,wa.target.center,la,Ba,qa)):aa(await ha(pa,wa,wa.target,la,Ba,qa))}va={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]};var Ga=ua?(Ga=N(pa,wa))?A.getResolutionInMetersForScale(Ga):void 0:void 0;await O(pa,wa.target,Ga,va,Ba);if(isFinite(va.boundingBox[0])){y.center(va.boundingBox,
Z);ya.x=Z[0];ya.y=Z[1];ya.z=Z[2];ya.spatialReference=pa.spatialReference;isFinite(ya.z)&&va.hasZ?Ga=y.isPoint(va.boundingBox):(ya.z=void 0,Ga=D.isPoint(y.toRect(va.boundingBox,Y)));if(ua||Ga)return aa(await ba(pa,wa,ya,la,Ba,qa));ua=va.screenSpaceObjects;if(ua.length){Ga=Number.NEGATIVE_INFINITY;for(let La=0;La<ua.length;La++){const Na=ua[La].screenSpaceBoundingRect;Ga=Math.max(Ga,Math.abs(Na[0]),Math.abs(Na[1]),Math.abs(Na[2]),Math.abs(Na[3]))}ua=.66-Ga/Math.min(pa.width,pa.height)*2}else ua=.66;
return aa(await fa(pa,wa,ya,va.boundingBox,ua,la,Ba,qa))}return wa.position?aa(await X(pa,wa,la,qa,Ba)):aa(await da(pa,wa,la,Ba,qa))};a.fromCamera=function(pa,wa,Ba=null){null==Ba&&(Ba=new k);return Q(pa,null,wa.clone(),Ba)};a.toCameraAsync=K;a.toCameraSync=function(pa,wa,Ba){var la=wa.camera;if(null!=la){a:{pa=F.getViewSR(pa);var qa=la.position;try{var ua=q.tryProjectWithZConversion(qa,pa)}catch(La){pa=null;break a}ua?(pa=la.clone(),pa.position=ua.clone()):pa=null}return pa}({targetGeometry:ua}=
wa);if(null==ua)return null;const {camera:va,mode:Ga}=M(pa,wa.rotation,Ba);if("point"===ua.type){a:{la=pa.spatialReference;try{qa=q.tryProjectWithZConversion(ua.clone(),la)}catch(La){pa=null;break a}qa?(ua=null!=wa.scale?F.scaleToDistance(pa,wa.scale,qa.latitude):pa.state.camera.distance,pa=F.fromCenterDistanceSync(pa,qa,ua,va,Ga)):pa=null}return pa}ua=ua.extent;return null==ua?null:F.fromExtentSync(pa,ua,va.heading,va.tilt,Ga)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports",
"../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],function(a,b,h,c){a.RenderFeature=void 0;(function(k){k[k.Antialiasing=0]="Antialiasing";k[k.HighQualityTransparency=1]="HighQualityTransparency";k[k.HighResolutionVoxel=2]="HighResolutionVoxel";k[k.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";k[k.SSAO=4]="SSAO";k[k.WaterReflection=5]="WaterReflection";k[k.HighResolutionShadows=6]="HighResolutionShadows";k[k.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(a.RenderFeature||
(a.RenderFeature={}));a.setupFeatureDefaults=function(k=!b("disable-feature:high-quality-idle"),m=null){const d=new h.NestedMap;k?(d.set(c.RenderState.IDLE,a.RenderFeature.Antialiasing,"low"!==m),d.set(c.RenderState.IDLE,a.RenderFeature.HighResolutionAtmosphere,"low"!==m),d.set(c.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,!0),d.set(c.RenderState.IDLE,a.RenderFeature.SSAO,!0),d.set(c.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),d.set(c.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,
!0)):(d.set(c.RenderState.ANIMATING,a.RenderFeature.HighResolutionShadows,!0),d.set(c.RenderState.INTERACTING,a.RenderFeature.HighResolutionShadows,!0));d.set(c.RenderState.IDLE,a.RenderFeature.HighResolutionShadows,!0);d.set(c.RenderState.IDLE,a.RenderFeature.HighResolutionVoxel,!0);return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports"],function(a){class b{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===
this._outer.size}get(h,c){return this._outer.get(h)?.get(c)}set(h,c,k){const m=this._outer.get(h);m?m.set(c,k):this._outer.set(h,new Map([[c,k]]))}delete(h,c){const k=this._outer.get(h);k&&(k.delete(c),0===k.size&&this._outer.delete(h))}forEach(h){this._outer.forEach((c,k)=>h(c,k))}}a.NestedMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,h,c,k,m){class d extends k.InputHandler{constructor(f,g,e){super(!0);this._view=f;this.pointerAction=g;this.registerIncoming("drag",e,n=>this._handleDrag(n))}_handleDrag(f){const g=f.data;if(!(1<g.pointers.size)&&m.eventMatchesMousePointerAction(f.data,this.pointerAction)){var e=b.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?
new h.ZoomController({view:this._view}):new c.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}f.stopPropagation()}}}a.DragZoom=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A){a.ZoomController=class extends D.InteractiveController{constructor(){super(...arguments);this._pickPoint=u.create();this._tmpP0=n.create();this._panAxisAngle=w.create();this._tmpRayDir=u.create();this._tmpRayDirPick=u.create();this._targetOnSphere=u.create();this._navMode=E.NavigationMode.Horizontal;this._tmpRay={origin:u.create(),direction:u.create()};this.dragBeginPoint=c.createScreenPointArray();this._normalizedAnchorPoint=n.create();this._constraintOptions=
new p.ConstraintOptions(t.ConstraintTypes.ALL_EXCEPT_COLLISION,r.InteractionType.ZOOM,0,this.startCamera);this._sphere=q.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(G){if(this.active){e.copy(this.dragBeginPoint,G);E.normalizeCoordinate(this.startCamera,G,this._normalizedAnchorPoint);var H=x.getReferenceEllipsoid(this.view.spatialReference),L=E.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,G,H,E.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?E.contentIntersectorOptions:{});this._navMode=E.decideNavigationMode(this.startCamera,G,H);if(this._navMode===E.NavigationMode.Horizontal)this._hasPickPoint=!!L.scenePickPoint,this._pickPoint=L.scenePickPoint??this._pickPoint,this._sphere=L.sphere;else{A.fromScreenAtEye(this.startCamera,G,this._tmpRay);l.normalize(this._tmpRay.direction,this._tmpRay.direction);let C;null!=L.scenePickPoint&&(l.subtract(this._tmpRayDirPick,this.startCamera.eye,L.scenePickPoint),C=l.length(this._tmpRayDirPick));
H=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,F);H=h.clamp(Math.min(E.pivotDistanceModifier,1/Math.abs(l.dot(F,this._tmpRay.direction)))*H,E.distanceClampValues[0],E.distanceClampValues[1]);G=this.view._stage.renderView.getMinimalDepthForArea(null,G[0],G[1],this.view.state.camera,E.screenPixelArea);H=null!=G?G:H;H=null!=C?Math.min(H,C):H;this._hasPickPoint=!0;l.scale(this._tmpRay.direction,this._tmpRay.direction,H);l.add(this._pickPoint,
this._tmpRay.origin,this._tmpRay.direction)}}}update(G){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===E.NavigationMode.Horizontal){l.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var H=l.length(this._tmpRayDir);E.normalizeCoordinate(this.currentCamera,G,this._tmpP0);var L=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),C=H*2**L;const z=this.view.state.constraints.minimumPoiDistance;
0>L&&C<z&&(C=z);if(1E-6>Math.abs(H-C))return;this._hasPickPoint&&C<H&&(L=1-(1-C/H)*(1-this._sphere[3]/l.length(this.currentCamera.center)),this.currentCamera.center=l.scale(B,this.currentCamera.center,L));l.scale(this._tmpRayDir,this._tmpRayDir,-C/H);this.currentCamera.eye=l.add(B,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(e.distance(this.dragBeginPoint,G));v.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._hasPickPoint&&(E.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),w.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),E.applyRotation(this.currentCamera,q.getCenter(this._sphere),this._panAxisAngle))}else{H=l.length(this._tmpRay.direction);E.normalizeCoordinate(this.currentCamera,G,this._tmpP0);G=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);C=H*2**G;L=this.view.state.constraints.minimumPoiDistance;0>G&&C<L&&(C=
L);if(1E-6>Math.abs(H-C))return;l.scale(this._tmpRayDir,this._tmpRay.direction,1-C/H);this.currentCamera.eye=l.add(B,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=l.add(B,this.currentCamera.center,this._tmpRayDir)}y.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}}end(){this.active&&this.finishController()}};a.ZoomController=b.__decorate([g.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const B=u.create(),
F=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../layers/VoxelWasm ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){a.ZoomController=class extends r.InteractiveController{constructor(){super(...arguments);this._tmpP=u.create();this._tmpDir=u.create();this._tmpN=u.create();this._tmpP0=n.create();this._tmpPoi=u.create();this._tmpRayDir=u.create();this.dragBeginPoint=c.createScreenPointArray();this._normalizedAnchorPoint=n.create();this._constraintOptions=new q.ConstraintOptions(v.ConstraintTypes.ALL,p.InteractionType.ZOOM,0,this.startCamera,u.create());this._plane=
x.create()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(A){if(this.active){e.copy(this.dragBeginPoint,A);y.normalizeCoordinate(this.startCamera,A,this._normalizedAnchorPoint);var B=this._intersectionHelper.intersectScreenFreePointFallback(A,this._tmpP,0===this.view.map.ground.opacity?y.contentIntersectorOptions:{});l.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var F=l.length(this._tmpDir);l.normalize(this._tmpDir,this._tmpDir);var G=Math.abs(this.view.camera.position.z);
G=h.clamp(Math.min(y.pivotDistanceModifier,1/Math.abs(l.dot(E,this._tmpDir)))*G,y.distanceClampValues[0],y.distanceClampValues[1]);A=this.view._stage.renderView.getMinimalDepthForArea(t.getVoxelWasm(this.view),A[0],A[1],this.view.state.camera,y.screenPixelArea);G=null!=A?A:G;G=B?Math.min(G,F):G;l.scale(this._tmpDir,this._tmpDir,G);l.add(this._tmpP,this.startCamera.eye,this._tmpDir);l.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);l.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&
l.negate(this._tmpN,this._tmpN);x.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane)}}update(A){if(this.active){y.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||l.copy(this._tmpPoi,this.currentCamera.center);y.normalizeCoordinate(this.currentCamera,A,this._tmpP0);var B=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);e.copy(this._normalizedAnchorPoint,this._tmpP0);l.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var F=l.length(this._tmpRayDir),
G=F*(1-B);this._constraintOptions.interactionDirection&&(l.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),l.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(B)/F));var H=this.view.state.constraints.minimumPoiDistance;0<=B&&G<H&&(G=H,B=-(G-F)/F);1E-6>Math.abs(F-G)||(l.scale(this._tmpRayDir,this._tmpRayDir,B),this.currentCamera.eye=l.add(D,this.currentCamera.eye,this._tmpRayDir),l.lerp(D,this.currentCamera.center,this._tmpPoi,
B),D[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],D[2]):Math.min(this.startCamera.center[2],D[2]),this.currentCamera.center=D,this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(e.distance(this.dragBeginPoint,A)),w.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}}end(){this.active&&this.finishController()}};a.ZoomController=b.__decorate([g.subclass("esri.views.3d.state.controllers.local.ZoomController")],
a.ZoomController);const D=u.create(),E=u.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define(["exports","../../../../core/Handles","../../../../core/reactiveUtils","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,h,c,k){class m extends k.InputHandler{constructor(d){super(!0);this._view=d;this._watchHandles=new b;this._handle=this.registerIncoming("gamepad",
f=>this._handleEventGamepad(f));this._handle.pause()}onInstall(d){super.onInstall(d);this._watchHandles.add([h.watch(()=>this._view.navigation.gamepad.enabled,f=>{f?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},h.initial),h.watch(()=>this._view.navigation.gamepad.device,f=>{this._cameraControllerGamepad&&f&&this._cameraControllerGamepad.gamepadDevice!==f&&(this._cameraControllerGamepad.finishController(),
this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll();super.onUninstall()}_handleEventGamepad(d){var f=this._view.navigation.gamepad.device;if(!f||d.data.device===f)if((f=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||c.GamepadKeyboardController.activatesFor(this._view,d.data))f||(f=new c.GamepadKeyboardController({view:this._view,gamepadDevice:d.data.device}),this._view.state.switchCameraController(f)&&(this._cameraControllerGamepad=f)),this._cameraControllerGamepad&&
this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===d.data.device&&this._cameraControllerGamepad.handleEventGamepad(d.data)}}a.GamepadNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C){a.GamepadKeyboardController=class extends A.InteractiveController{constructor(Q){super(Q);this._filteredSurfaceElevation=0;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];this._tmpCamera=new L.Camera;this._headingStart=0;this._constraintOptions=new t.ConstraintOptions(r.ConstraintTypes.ALL,y.InteractionType.NONE,0,new L.Camera,null,D.TiltMode.LOOK_AROUND)}handleEventGamepad(Q){const T=
C.extractTransformation(Q,this.view.navigation.gamepad,this._transformation);("end"===Q.action||C.isZeroTransformation(T))&&this.finishController()}activateDirection(Q){this._keysButtonState[Q]=1;C.extractTransformationKeyboard(this._keysButtonState,this._transformation)}deactivateDirection(Q){this._keysButtonState[Q]=0;Q=C.extractTransformationKeyboard(this._keysButtonState,this._transformation);C.isZeroTransformation(Q)&&this.finishController()}onControllerStart(Q){this._filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;super.onControllerStart(Q)}_updateFilteredSurfaceElevation(Q){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*Q}stepController(Q,T){this._updateStartHeading();this._updateFilteredSurfaceElevation(Q);this.currentCamera.copyViewFrom(T);this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);
this._calculateControlTransformation(Q,this.currentCamera,M);this._applyDisabledMovementTypes(M);this._applyPan(M.pan);this._applyRotate(M.rotate);this._applyZoom(M.zoom);this._applyAscend(M.ascend);this._constraintOptions.interactionType=y.InteractionType.NONE;this._constraintOptions.selection=r.ConstraintTypes.COLLISION;p.applyAll(this.view,this.currentCamera,this._constraintOptions);super.stepController(Q,T)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(Q){if(Q.enabled){var T=
this.currentCamera;n.subtract(S,T.center,T.eye);n.transformMat4(S,S,Q.matrix);T.center=n.add(S,S,T.eye);T.up=n.transformMat4(S,T.up,Q.matrix);this._constraintOptions.interactionType=y.InteractionType.LOOK_AROUND;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;p.applyAll(this.view,T,this._constraintOptions)}}_applyPan(Q,T=this.currentCamera){Q.enabled&&(T.eye=n.transformMat4(S,T.eye,Q.matrix),T.center=n.transformMat4(S,T.center,Q.matrix),this.view.state.isGlobal&&(T.up=n.transformMat4(S,
T.up,Q.matrix)),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.selection=r.ConstraintTypes.ALL,p.applyAll(this.view,T,this._constraintOptions))}_applyZoom(Q){if(Q){var T=this.currentCamera.viewForward;this.currentCamera.eye=n.add(S,this.currentCamera.eye,n.scale(v.sv3d.get(),T,Q));n.copy(N,T);n.negate(N,N);this._constraintOptions.interactionDirection=N;this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;
p.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_applyAscend(Q){if(Q){var T=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,v.sv3d.get());this._constraintOptions.interactionDirection=n.copy(N,T);this.view.state.isGlobal?(T=n.length(this.currentCamera.eye),Q=(T+Q)/T,this.currentCamera.eye=n.scale(S,this.currentCamera.eye,Q),this.currentCamera.center=n.scale(S,this.currentCamera.center,Q)):(Q=n.scale(v.sv3d.get(),
T,Q),this.currentCamera.eye=n.add(S,this.currentCamera.eye,Q),this.currentCamera.center=n.add(S,this.currentCamera.center,Q));this._updateCameraCenter();this._constraintOptions.interactionType=y.InteractionType.ASCEND;this._constraintOptions.selection=r.ConstraintTypes.COLLISION;p.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;p.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._constraintOptions.interactionDirection=null}}_calculateControlTransformation(Q,T,ia){ia.zoom=0;ia.ascend=0;ia.pan.enabled=!1;g.identity(ia.pan.matrix);ia.rotate.enabled=!1;g.identity(ia.rotate.matrix);Q=this._computeVelocities(Q);this.view.state.isLocal?this._calculateControlTransformationLocal(Q,T,ia):this._calculateControlTransformationGlobal(Q,T,ia)}_updateCameraCenter(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,
S)}_calculateControlTransformationLocal(Q,T,ia){const {viewRight:O,viewForward:U}=T,P=this._transformation;var R=this.view.navigation.gamepad,ba=n.set(v.sv3d.get(),U[0],U[1],0);n.normalize(ba,ba);var X=P.translation[0]*Q.pan;0!==X&&(X=n.scale(v.sv3d.get(),O,X),g.translate(ia.pan.matrix,ia.pan.matrix,X),ia.pan.enabled=!0);switch(R.mode){case "pan":R=-P.translation[1]*Q.pan;0!==R&&(ba=n.scale(v.sv3d.get(),ba,R),g.translate(ia.pan.matrix,ia.pan.matrix,ba),ia.pan.enabled=!0);ia.zoom=P.zoom*Q.zoom;break;
case "zoom":ia.zoom=(-P.translation[1]+P.zoom)*Q.zoom;break;default:h.neverReached(R.mode)}ia.ascend=P.translation[2]*Q.ascend;ba=-P.heading*Q.rotate;0!==ba&&(g.rotate(ia.rotate.matrix,ia.rotate.matrix,ba,this.view.renderCoordsHelper.worldUpAtPosition(T.eye,v.sv3d.get())),ia.rotate.enabled=!0);Q=P.tilt*Q.rotate;T=F.viewAngle(this.view.renderCoordsHelper,T.center,T.eye);if(T=c.clamp(T+Q,E.TiltRange.min,E.TiltRange.max)-T)g.rotate(ia.rotate.matrix,ia.rotate.matrix,T,O),ia.rotate.enabled=!0}_calculateControlTransformationGlobal(Q,
T,ia){const {eye:O,viewRight:U}=T,P=this._transformation;var R=this.view.navigation.gamepad,ba=n.cross(v.sv3d.get(),U,O);n.normalize(ba,ba);n.negate(ba,ba);B.panMotionToRotationMatrix(this.startCamera,T,P,Q,this.view.camera.heading,this._headingStart,this.view.camera.tilt,ia,R);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(M.pan,this._tmpCamera);R=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;ia.ascend=P.translation[2]*Q.ascend;ba=-P.heading*Q.rotate;0!==
ba&&(g.rotate(ia.rotate.matrix,ia.rotate.matrix,ba,this._tmpCamera.eye),ia.rotate.enabled=!0);T=this._clampTiltDeltaGlobalToValidRange(P.tilt*Q.rotate,T.ray,R);0!==T&&(g.rotate(ia.rotate.matrix,ia.rotate.matrix,T,this._tmpCamera.viewRight),ia.rotate.enabled=!0);ia.zoom+=P.zoom*Q.zoom}_clampTiltDeltaGlobalToValidRange(Q,T,ia){const O=u.getReferenceEllipsoid(this.view.spatialReference),U=B.onSurfaceTiltToEyeTiltGlobal(E.TiltRange.min,T.origin,ia,O);var P=0;let R=0;P=v.sv3d.get();this.view.renderCoordsHelper.intersectManifold(T,
ia,P)?(P=F.viewAngle(this.view.renderCoordsHelper,P,T.origin),P=B.onSurfaceTiltToEyeTiltGlobal(P,T.origin,ia,O),R=B.onSurfaceTiltToEyeTiltGlobal(E.TiltRange.max,T.origin,ia,O)):(w.closestPointOnSilhouette(w.fromRadius(w.tmpSphere,ia+O.radius),T,P),P=Math.PI+q.angle(T.direction,P),P=B.offSurfaceTiltToEyeTiltGlobal(P,T.origin,ia,O),R=B.offSurfaceTiltToEyeTiltGlobal(E.TiltRange.max,T.origin,ia,O));return c.clamp(P+Q,U,R)-P}_getPointAbsoluteSurfaceElevation(Q,T,ia){const {renderCoordsHelper:O}=this.view,
U=O.getAltitude(Q);T+=Math.abs(U-T);O.setAltitude(ia,T,Q);return T}_clampedDistanceToSurface(Q,T){const {renderCoordsHelper:ia}=this.view,{camera:O}=this.view.state;var {direction:U}=G.headingTiltToDirectionUp(this.view,T,0,80,V);U=ia.intersectManifoldClosestSilhouette(x.wrap(T,U),Q,v.sv3d.get());U=n.distance(T,U);Q=ia.intersectManifoldClosestSilhouette(x.wrap(T,n.direction(v.sv3d.get(),T,O.center)),Q,v.sv3d.get());T=n.distance(T,Q);return Math.min(U,T)}_computeHeadingRotateRadius(Q){const {renderCoordsHelper:T,
state:ia}=this.view,{camera:O,isGlobal:U}=ia;var P=T.intersectManifoldClosestSilhouette(O.ray,this._filteredSurfaceElevation,v.sv3d.get());if(U){const R=n.subtract(v.sv3d.get(),Q,P);P=n.length(R);n.scale(R,R,1/P);Q=n.normalize(v.sv3d.get(),Q);Q=c.acosClamped(n.dot(Q,R));return P*Math.sin(Math.min(J,Q))}Q=n.copy(v.sv3d.get(),Q);T.setAltitude(Q,this._filteredSurfaceElevation);return n.distance(P,Q)}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:5}_computeVelocities(Q){var T=
this._filteredSurfaceElevation,ia=T+u.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:O,isGlobal:U}=this.view.state;var P=v.sv3d.get();const R=this._getPointAbsoluteSurfaceElevation(O.eye,T,P);var ba=this._clampedDistanceToSurface(T,P);const X=O.width/2,da=.75*O.width,ha=.75*O.width;var fa=ba*Math.tan(.5*O.fovX)/X;ia=fa/ia;P=fa/this._computeHeadingRotateRadius(P);fa=(U?ia:fa)*da*Q;T=R-T;T=Math.max(this._minimumAscendVelocity()*Q,2**(da*Q/X)*T-T);ba=2**(da*Q/X)*ba-ba;Q*=c.clamp(P*
ha,K,I);return{pan:fa,ascend:T,zoom:ba,rotate:Q}}_applyDisabledMovementTypes(Q){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(Q.zoom=this.disableMovements.zoom?0:Q.zoom,Q.ascend=this.disableMovements.ascend?0:Q.ascend,Q.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&g.identity(Q.pan.matrix),Q.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&g.identity(Q.rotate.matrix))}static activatesFor(Q,
T){Q=C.extractTransformation(T,Q.navigation.gamepad,z);return!("end"===T.action||C.isZeroTransformation(Q))}};b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([f.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const z={translation:[0,0,0],
heading:0,tilt:0,zoom:0},J=c.deg2rad(80),K=c.deg2rad(30),I=c.deg2rad(80),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.create()},rotate:{enabled:!1,matrix:e.create()}},S=l.create(),N=l.create(),V=H.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec32"],function(a,b){function h(c){let k=c*c;0>c&&(k*=-1);return k}a.extractTransformation=function(c,k,m){const d=c.state;c=c.device;
k="forward-down"===k.tiltDirection?1:-1;"standard"===c.deviceType?(m.translation[0]=h(d.axes[0]),m.translation[1]=h(d.axes[1]),m.translation[2]=h(d.buttons[7])-h(d.buttons[6]),m.heading=h(d.axes[2]),m.tilt=h(d.axes[3])):"spacemouse"===c.deviceType&&(m.translation[0]=1.2*h(d.axes[0]),m.translation[1]=1.2*h(d.axes[1]),m.translation[2]=2*-h(d.axes[2]),m.heading=1.2*h(d.axes[5]),m.tilt=1.2*h(d.axes[3]));m.tilt*=k;b.scale(m.translation,m.translation,1);return m};a.extractTransformationKeyboard=function(c,
k){k.translation[0]=c[1]-c[0];k.translation[1]=c[3]-c[2];k.translation[2]=c[4]-c[5];k.heading=c[7]-c[6];k.tilt=c[8]-c[9];k.zoom=c[10]-c[11];return k};a.isZeroTransformation=function(c){return 0===c.translation[0]&&0===c.translation[1]&&0===c.translation[2]&&0===c.heading&&0===c.tilt&&0===c.zoom};a.resetTransformation=function(c){c.translation[0]=0;c.translation[1]=0;c.translation[2]=0;c.heading=0;c.tilt=0;return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports",
"../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler","../../../input/VisibilityChange"],function(a,b,h,c,k){var m;(function(f){f[f.LEFT=0]="LEFT";f[f.RIGHT=1]="RIGHT";f[f.FORWARD=2]="FORWARD";f[f.BACKWARD=3]="BACKWARD";f[f.UP=4]="UP";f[f.DOWN=5]="DOWN";f[f.HEADINGLEFT=6]="HEADINGLEFT";f[f.HEADINGRIGHT=7]="HEADINGRIGHT";f[f.TILTUP=8]="TILTUP";f[f.TILTDOWN=9]="TILTDOWN";f[f.ZOOMIN=10]="ZOOMIN";f[f.ZOOMOUT=11]="ZOOMOUT"})(m||={});class d extends c.InputHandler{constructor(f,
g){super(!0);this._view=f;this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:b.ViewingMode.Local};this._keyToNumber={[g.left]:m.LEFT,[g.right]:m.RIGHT,[g.forward]:m.FORWARD,[g.backward]:m.BACKWARD,[g.up]:m.UP,[g.down]:m.DOWN,[g.headingLeft]:m.HEADINGLEFT,[g.headingRight]:m.HEADINGRIGHT,[g.tiltUp]:m.TILTUP,[g.tiltDown]:m.TILTDOWN,[g.zoomIn]:m.ZOOMIN,[g.zoomOut]:m.ZOOMOUT};this.registerIncoming("key-down",null,e=>this._handleKeyDown(e));this.registerIncoming("key-up",null,e=>this._handleKeyUp(e));
this.registerIncoming("blur",null,()=>this._handleStop());this._visibilityHandle=k.onVisibilityChange(e=>e?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove();this._handleStop()}_handleKeyDown(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var g=this._keyToNumber[f.data.key];null!=g&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new h.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),
this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(g),f.stopPropagation()))}}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var g=this._keyToNumber[f.data.key];null!=g&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&
(this._cameraControllerKeyboard.deactivateDirection(g),f.stopPropagation())}}}a.KeyboardNavigation=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/VisibilityChange":function(){define(["exports"],function(a){a.onVisibilityChange=function(b){const h=()=>b("visible"===document.visibilityState);document.addEventListener("visibilitychange",h);return{remove:()=>document.addEventListener("visibilitychange",h)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/global/ZoomStepController","../../state/controllers/local/ZoomStepController","../../../input/InputHandler"],function(a,b,h,c,k){class m extends k.InputHandler{constructor(d,f){super(!0);this._view=d;this.registerIncoming("mouse-wheel",f,g=>this._handleMouseWheel(g))}_handleMouseWheel(d){if(this._view.navigation.mouseWheelZoomEnabled){var f=d.data;this._cameraController&&
this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new h.ZoomStepController({view:this._view,mode:"interaction"}):new c.ZoomStepController({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*f.deltaY,b.createScreenPointArray(f.x,f.y));d.preventDefault();d.stopPropagation()}}}a.MouseWheelZoom=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define(["exports",
"../../state/controllers/global/PinchAndPanController","../../state/controllers/local/PinchAndPanController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,h,c,k){class m extends c.InputHandler{constructor(d,f,g){super(!0);this._view=d;this.pointerAction=f;this._lastTimestamp=this._lastEndTimestamp=0;this.registerIncoming("drag",g,e=>this._handleDrag(e))}_handleDrag(d){if("mouse"!==d.data.pointerType||k.eventMatchesMousePointerAction(d.data,this.pointerAction)){var f=
d.timestamp-this._lastEndTimestamp;f=this._momentum&&this._momentum.active&&40>f;switch(d.data.action){case "start":case "update":if(f)break;this._controller&&this._controller.active?2<d.data.timestamp-this._lastTimestamp&&(this._controller.update(d.data),this._lastTimestamp=d.timestamp):this._startController(d);break;case "end":case "removed":this._endController(d,!0);break;case "added":this._endController(d,!1),this._startController(d)}d.stopPropagation()}}_endController(d,f){this._controller&&
this._controller.active&&(this._lastEndTimestamp=d.timestamp,d=this._controller.end(d.data),f&&d&&(this._momentum=d,this._view.state.switchCameraController(this._momentum)));this._controller=null}_startController(d){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(d.data);this._lastTimestamp=d.timestamp}_createController(){return this._view.state.isGlobal?new b.PinchAndPanController({view:this._view}):new h.PinchAndPanController({view:this._view})}}
a.PinchAndPanNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I){a.PinchAndPanController=class extends E.InteractiveController{constructor(){super(...arguments);this._smoothRotation=new D.ExponentialFalloff(.05);this._rotationAxis=u.create();this._beginHeading=this._beginAngle=0;this._panningPlane=q.create();this._beginRadius=0;this._smoothScaling=new D.ExponentialFalloff(.05);this._zoomCenterScreen=k.createScreenPointArray();this._zoomMomentumEstimator=new I.ZoomMomentumEstimator;this._rotationMomentumEstimator=
new K.RotationMomentumEstimator;this._panSphericalMomentumEstimator=new J.PanSphericalMomentumEstimator;this._panPlanarMomentumEstimator=new z.PanPlanarMomentumEstimator;this._adjustedSphere=v.create();this._tmp3d=u.create();this._tmpScreenPointArray=k.createScreenPointArray();this._beginScreenPoint=k.createScreenPointArray();this._beginScenePoint=u.create();this._screenPickPoint=k.createScreenPointArray();this._scenePickPoint=u.create();this._mode=L.NavigationMode.Horizontal;this._sphere=v.create();
this._pointerCount=0;this._tmpInteractionDirection=u.create();this._beginCamera=new C.Camera;this._constraintOptions=new t.ConstraintOptions(r.ConstraintTypes.ALL,y.InteractionType.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(M){if(this.active){this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled;this._beginHeading=
-h.cyclicalPI.normalize(c.deg2rad(this.view.camera.heading));this._beginRadius=M.radius;this._pointerCount=M.pointers.size;this._beginAngle=M.angle;this._smoothRotation.reset();k.screenPointObjectToArray(M.center,this._screenPickPoint);n.copy(this._beginScreenPoint,this._screenPickPoint);var S=x.getReferenceEllipsoid(this.view.spatialReference),N=L.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,S,L.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?
L.contentIntersectorOptions:{});null!=N.scenePickPoint&&(this._scenePickPoint=N.scenePickPoint,this._sphere=N.sphere,l.copy(this._beginScenePoint,this._scenePickPoint),this._mode=L.decideNavigationMode(this.startCamera,this._screenPickPoint,S),this._mode===L.NavigationMode.Vertical&&this._preparePlanarPanMode(M,N.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}}update(M){if(this.active){this.currentCamera.copyFrom(this.startCamera);var S=1<M.pointers.size;this._mode===L.NavigationMode.Horizontal?
(S&&this._zoomSpherical(M),this._panningSpherical(M),S&&this._rotateSpherical(M)):(S&&this._zoomPlanar(M),this._panningPlanar(M),S&&this._rotatePlanar(M));this.commitCamera()}}end(M){M.pointers.size===this._pointerCount&&this.update(M);this.finishController();if(M=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===L.NavigationMode.Horizontal?new H.ZoomSphericalMomentumController({view:this.view,momentum:M,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):
new G.ZoomPlanarMomentumController({view:this.view,momentum:M,zoomCenter:this._beginScenePoint});if(M=this._rotationMomentumEstimator.evaluateMomentum())return new F.RotationMomentumController({view:this.view,momentum:M,center:v.getCenter(this._sphere),axis:this._rotationAxis});if(this._mode===L.NavigationMode.Horizontal){if(M=this._panSphericalMomentumEstimator.evaluateMomentum())return new B.PanSphericalMomentumController({view:this.view,momentum:M})}else if(M=this._panPlanarMomentumEstimator.evaluateMomentum())return new A.PanPlanarMomentumController({view:this.view,
momentum:M});return null}_preparePlanarPanMode(M,S){var N=l.negate(this._tmp3d,this.startCamera.viewForward);q.fromPositionAndNormal(this._scenePickPoint,N,this._panningPlane);var V=k.createScreenPointArray(this._screenPickPoint[0],0);N=u.create();var Q=l.length(this.startCamera.eye);this._adjustedSphere[3]=Q<this._sphere[3]?Q-100:this._sphere[3];L.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,this.startCamera,V,N);V=k.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(N,
V);N=u.create();V=u.create();Q=u.create();l.subtract(N,this._scenePickPoint,this.currentCamera.eye);const T=l.length(N);l.normalize(N,N);var ia=L.panDistanceModifier*Math.max(Math.abs(this.view.camera.position.z),L.minHeightLimit);const O=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,L.screenPixelArea);ia=null!=O?O:ia;ia=S?Math.min(ia,T):ia;l.copy(Q,l.add(V,this.currentCamera.eye,l.scale(V,N,ia)));this._panningPlane[3]=
-l.dot(q.getNormal(this._panningPlane),Q);this.startCamera.center=l.add(V,this.startCamera.eye,l.scale(V,this.startCamera.viewForward,ia));M=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,M,this._beginScenePoint)}_zoomSpherical(M){const S=this._beginRadius/M.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(M.radius,40),120);this._smoothScaling.update(S);L.applyZoomOnSphere(this._sphere,this.currentCamera,
this._smoothScaling.value);k.screenPointObjectToArray(M.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*M.timestamp);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(M.radius-this._beginRadius);p.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(M){const S=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);L.sphereOrPlanePointFromScreenPoint(this._sphere,
this.currentCamera,S,this._tmp3d);L.preserveHeadingThreshold(this._beginScenePoint,l.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(L.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(S,this._tmp3d,.001*M.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):
(L.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(S,this._tmp3d,.001*M.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=y.InteractionType.PAN;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(n.distance(this._screenPickPoint,S));p.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(M){l.normalize(this._rotationAxis,
this._scenePickPoint);this.currentCamera.aboveGround||l.negate(this._rotationAxis,this._rotationAxis);var S=this._smoothRotation.value,N=L.normalizeRotationDelta(M.angle-S);S+=N;this._smoothRotation.gain=.00125*Math.min(Math.max(M.radius,40),120);this._smoothRotation.update(S);N=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(N,.001*M.timestamp);L.applyRotation(this.currentCamera,v.getCenter(this._sphere),w.wrapAxisAngle(this._rotationAxis,N));this._constraintOptions.interactionType=
y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(M.radius*S);p.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(M){const S=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);L.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,S,this._tmp3d)&&(L.applyPanPlanar(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(S,this._tmp3d,.001*M.timestamp),this._constraintOptions.interactionType=
y.InteractionType.PAN,this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(n.distance(this._beginScreenPoint,S)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),p.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(M){const S=this._beginRadius/M.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(M.radius,
40),120);this._smoothScaling.update(S);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*M.timestamp);L.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(M.radius-this._beginRadius);p.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(M){l.copy(this._rotationAxis,
this._beginScenePoint);this.currentCamera.aboveGround||l.negate(this._rotationAxis,this._rotationAxis);var S=this._smoothRotation.value;let N=M.angle-S;N=L.normalizeRotationDelta(N);this._smoothRotation.gain=.00125*Math.min(Math.max(M.radius,40),120);this._smoothRotation.update(S+N);S=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(S,.001*M.timestamp);L.applyRotation(this.currentCamera,v.getCenter(this._sphere),w.wrapAxisAngle(this._rotationAxis,S));this._constraintOptions.interactionType=
y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(M.radius*S);p.applyAll(this.view,this.currentCamera,this._constraintOptions)}};a.PinchAndPanController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports"],function(a){class b{constructor(h){this._gain=h}reset(h){this._value=
h}set gain(h){this._gain=h}get value(){return void 0===this._value?0:this._value}update(h){this._value=void 0===this._value?h:this._gain*h+(1-this._gain)*this._value}}a.ExponentialFalloff=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.PanPlanarMomentumController=class extends n.MomentumController{constructor(u){super(u);this.interactionType=e.InteractionType.PAN;this._tmpPan=g.create()}momentumStep(u,x){u=this.momentum.value(u);f.scale(this._tmpPan,this.momentum.direction,u);x.eye=f.subtract(l,x.eye,this._tmpPan);x.center=f.subtract(l,x.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan}};b.__decorate([h.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,
"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const l=g.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){a.MomentumController=class extends u.AnimationController{constructor(){super(...arguments);this._beginCamera=new x.Camera;this._elapsedTimeSec=0;this.constraintOptions=new e.ConstraintOptions(n.ConstraintTypes.ALL,l.InteractionType.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new f}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(w){this._beginCamera.copyFrom(w);
super.onControllerStart(w)}stepController(w,q){q.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=w;this.momentumStep(this._elapsedTimeSec,q);g.applyAll(this.view,q,this.constraintOptions)}};a.MomentumController=b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){const u=g.create(),x=g.create();a.PanSphericalMomentumController=class extends n.MomentumController{constructor(w){super(w);this.interactionType=e.InteractionType.PAN}momentumStep(w,q){const v=this.momentum.value1(w);w=this.momentum.value2(w);f.copy(x,q.eye);f.normalize(x,x);f.cross(this.momentum.axis2,x,this.momentum.axis1);l.applyRotationWithTwoAxes(q,u,this.momentum.axis1,v,this.momentum.axis2,w)}};b.__decorate([h.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,
"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){a.RotationMomentumController=class extends n.MomentumController{set center(u){this._set("center",f.clone(u))}set axis(u){this._set("axis",f.clone(u))}constructor(u){super(u);this.interactionType=e.InteractionType.TUMBLE}momentumStep(u,x){u=this.momentum.value(u);l.applyRotation(x,this.center,g.wrapAxisAngle(this.axis,u))}};b.__decorate([h.property({constructOnly:!0})],a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([h.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"center",null);b.__decorate([h.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){a.ZoomPlanarMomentumController=class extends n.MomentumController{set zoomCenter(u){this._set("zoomCenter",g.clone(u))}constructor(u){super(u);this.interactionType=e.InteractionType.ZOOM;this.constraintOptions.interactionDirection=g.create()}momentumStep(u,x){const {interactionDirection:w}=this.constraintOptions;w&&(f.copy(w,x.eye),u=this.momentum.valueDelta(0,u),l.applyZoomToPoint(x,this.zoomCenter,u,this.view.state.constraints.minimumPoiDistance),f.direction(w,
x.eye,w))}};b.__decorate([h.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([h.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){a.ZoomSphericalMomentumController=class extends x.MomentumController{set screenCenter(q){this._set("screenCenter",h.createScreenPointArray(q[0],q[1]))}set sceneCenter(q){this._set("sceneCenter",g.clone(q))}constructor(q){super(q);this.interactionType=u.InteractionType.ZOOM;this.radius=0;this._tmpSceneCenter=g.create();this._tmpZoomAxisAngle=e.create();this._sphere=n.create()}initialize(){this._sphere[3]=this.radius}momentumStep(q,v){q=this.momentum.valueDelta(0,
q);w.applyZoomOnSphere(this._sphere,v,q);this.constraintOptions.interactionType=u.InteractionType.ZOOM;l.applyAll(this.view,v,this.constraintOptions);w.sphereOrPlanePointFromScreenPoint(this._sphere,v,this.screenCenter,this._tmpSceneCenter);e.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);w.applyRotation(v,n.getCenter(this._sphere),this._tmpZoomAxisAngle);this.constraintOptions.interactionType=u.InteractionType.PAN}};b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,
"momentum",void 0);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],function(a,b,h,c,k){class m extends k.Momentum{constructor(f,g,e,n,l){super(f,g,e);this._sceneVelocity=n;this.direction=l}value(f){return super.valueFromInitialVelocity(this._sceneVelocity,f)}}class d{constructor(f=300,g=12,e=.84){this._minimumInitialVelocity=
f;this._stopVelocity=g;this._friction=e;this.enabled=!0;this._time=new c.FilteredFiniteDifference(.6);this._screen=[new c.FilteredFiniteDifference(.4),new c.FilteredFiniteDifference(.4)];this._scene=[new c.FilteredFiniteDifference(.6),new c.FilteredFiniteDifference(.6),new c.FilteredFiniteDifference(.6)];this._tmpDirection=h.create()}add(f,g,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(f[0]),this._screen[1].update(f[1]),this._scene[0].update(g[0]),
this._scene[1].update(g[1]),this._scene[2].update(g[2]),this._time.update(e))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var f=this._screen[0].filteredDelta,g=this._screen[1].filteredDelta;f=null==f||null==g?0:Math.sqrt(f*f+g*g);g=this._time.filteredDelta;f=null==g||null==f?0:f/g;return Math.abs(f)<
this._minimumInitialVelocity?null:this.createMomentum(f,this._stopVelocity,this._friction)}createMomentum(f,g,e){b.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=b.length(this._tmpDirection);0<n&&b.scale(this._tmpDirection,this._tmpDirection,1/n);const l=this._time.filteredDelta;return new m(f,g,e,null==l?0:n/l,this._tmpDirection)}}a.PanPlanarMomentum=m;a.PanPlanarMomentumEstimator=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){class b{constructor(h){this._gain=h;this.filteredDelta=this.lastValue=void 0}update(h){if(this.hasLastValue()){const c=this.computeDelta(h);this._updateDelta(c)}this.lastValue=h}reset(){this.filteredDelta=this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(h){return void 0===this.lastValue?NaN:h-this.lastValue}_updateDelta(h){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*h:h}}a.FilteredFiniteDifference=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(a){class b{constructor(h,c,k){this._initialVelocity=h;this._stopVelocity=c;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(h){return h>
this.duration}get friction(){return this._friction}value(h){return this.valueFromInitialVelocity(this._initialVelocity,h)}valueDelta(h,c){const k=this.value(h);return this.value(h+c)-k}valueFromInitialVelocity(h,c){c=Math.min(c,this.duration);const k=1-this.friction;return h*(k**c-1)/Math.log(k)}}a.Momentum=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../core/libs/gl-matrix-2/factories/vec2f64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,h,c,k,m,d,f){class g extends f.Momentum{constructor(n,l,u,x,w,q=0,v){super(n,l,u);this._angularVelocity1=x;this.axis1=w;this.angularVelocity2=q;this.axis2=v}value1(n){return super.valueFromInitialVelocity(this._angularVelocity1,n)}value2(n){return super.valueFromInitialVelocity(this.angularVelocity2,n)}}class e{constructor(n=300,l=12,u=.84){this._minimumInitialVelocity=n;this._stopVelocity=l;this._friction=u;this.enabled=!0;this._tmpAxis1=c.create();this._tmpAxis2=c.create();this._tmpAngles=
b.create();this._time=new m.FilteredFiniteDifference(.3);this._screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this._angle1=new d.FilteredValue(.6);this._angle2=new d.FilteredValue(.6);this._axis1=c.create();this._axis2=c.create();this._lastScene=c.create()}addMomentumDirectRotation(n,l,u,x,w,q){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(u))return;x=k.rotationAngleAndAxisDirectRotation(this._lastScene,l,this._tmpAxis2,x,w,q);this._angle2.update(0);
1E-5>h.squaredLength(this._tmpAxis2)?x=0:h.normalize(this._axis1,this._tmpAxis2);this._angle1.update(x);h.copy(this._lastScene,l)}this._screen[0].update(n[0]);this._screen[1].update(n[1]);this._time.update(u)}}addMomentumPreserveHeading(n,l,u,x,w,q,v){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(u))return;k.rotationAnglesAndAxesHeadingPreserving(this._lastScene,l,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,x,w,q,v,!1);1E-5>h.squaredLength(this._tmpAxis2)?(this._angle1.update(0),
this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),h.normalize(this._axis1,this._tmpAxis1),h.normalize(this._axis2,this._tmpAxis2));h.copy(this._lastScene,l)}this._screen[0].update(n[0]);this._screen[1].update(n[1]);this._time.update(u)}}reset(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var n=this._screen[0].filteredDelta,
l=this._screen[1].filteredDelta;n=null==n||null==l?null:Math.sqrt(n*n+l*l);l=this._time.filteredDelta;n=null==n||null==l?0:n/l;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(n,l,u){const x=this._time.filteredDelta,w=this._angle1.filteredValue,q=this._angle2.filteredValue;return new g(n,l,u,null==x||null==w?0:w/x,this._axis1,null==x||null==q?0:q/x,this._axis2)}}a.PanSphericalMomentum=g;a.PanSphericalMomentumEstimator=e;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports"],function(a){class b{constructor(h){this._gain=h}update(h){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*h:h}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}a.FilteredValue=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(a,b){class h extends b.MomentumEstimator{constructor(c=3,k=.01,m=.95,d=12){super(c,k,m,d)}add(c,k){const m=this.value.lastValue;if(null!=m){for(c-=m;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;c=m+c}super.add(c,k)}}a.RotationMomentumEstimator=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,
h,c){class k{constructor(m=2.5,d=.01,f=.95,g=12){this._minimumInitialVelocity=m;this._stopVelocity=d;this._friction=f;this._maxVelocity=g;this.enabled=!0;this.value=new h.FilteredFiniteDifference(.8);this.time=new h.FilteredFiniteDifference(.3)}add(m,d){if(this.enabled&&null!=d){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta()){const f=this.value.computeDelta(m);0>this.value.filteredDelta*f&&this.value.reset()}}this.time.update(d);this.value.update(m)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let m=this.value.filteredDelta/this.time.filteredDelta;m=b.clamp(m,-this._maxVelocity,this._maxVelocity);return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(m,d,f){return new c.Momentum(m,d,f)}}a.MomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(a,b,h){class c extends b.Momentum{constructor(m,d,f){super(m,d,f)}value(m){m=super.value(m);return Math.exp(m)}valueDelta(m,d){const f=super.value(m);m=super.value(m+d);return Math.exp(m-f)}}class k extends h.MomentumEstimator{constructor(m=2.5,d=.01,f=.95,g=12){super(m,d,f,g)}add(m,d){super.add(Math.log(m),d)}createMomentum(m,d,f){return new c(m,d,f)}}a.ZoomMomentum=c;a.ZoomMomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../input/util ../../../layers/VoxelWasm ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){const C=l.fromValues(0,0,1);var z=16/180*Math.PI;a.PinchAndPanController=class extends y.InteractiveController{constructor(){super(...arguments);this._rotationValueSmooth=new t.ExponentialFalloff(.05);this._scalingValueSmooth=new t.ExponentialFalloff(.05);this._planeHorizontal=x.create();this._planeVertical=x.create();this._rotationMomentumEstimator=new H.RotationMomentumEstimator;this._panMomentumEstimator=new G.PanPlanarMomentumEstimator(300,
12,.9);this._zoomMomentumEstimator=new L.ZoomMomentumEstimator;this._beginRadius=0;this._beginCenter=l.create();this._beginAngle=0;this._tmpPoints=[];this._panMode=B.NavigationMode.Horizontal;this._beginCenterScreen=c.createScreenPointArray();this._tmpCentroid3d=l.create();this._tmpCentroid2d=c.createScreenPointArray();this._tmp2d=c.createScreenPointArray();this._pointerCount=0;this._beginCamera=new F.Camera;this._constraintOptions=new q.ConstraintOptions(v.ConstraintTypes.ALL,p.InteractionType.NONE,
0,this._beginCamera)}begin(J){if(this.active){var K=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=K;this._rotationMomentumEstimator.enabled=K;this._panMomentumEstimator.enabled=K;this._beginRadius=J.radius;this._pointerCount=J.pointers.size;this._beginAngle=J.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();c.screenPointObjectToArray(J.center,this._beginCenterScreen);x.fromNormalAndOffset(C,0,this._planeHorizontal);var I=l.create();K=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,
I,0===this.view.map.ground.opacity?B.contentIntersectorOptions:{});var M=l.create();n.negate(M,this.startCamera.viewForward);var S=l.create();n.copy(S,C);var N=n.dot(M,S);this._panMode=h.asinClamped(0>N?-N:N)>=z?B.NavigationMode.Horizontal:B.NavigationMode.Vertical;var V=Math.min(B.panDistanceModifier,1/Math.abs(n.dot(S,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),B.minHeightLimit);x.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,I);this.startCamera.aboveGround||
x.negate(this._planeHorizontal,this._planeHorizontal);var Q=l.create(),T=l.create(),ia=l.create();n.subtract(Q,I,this.currentCamera.eye);var O=n.length(Q);n.normalize(Q,Q);this._panMode===B.NavigationMode.Vertical?(n.scale(S,S,N),n.subtract(x.getNormal(this._planeVertical),M,S),n.normalize(x.getNormal(this._planeVertical),x.getNormal(this._planeVertical)),x.setOffsetFromPoint(this._planeVertical,this._planeVertical,I),I=this.view._stage.renderView.getMinimalDepthForArea(r.getVoxelWasm(this.view),
this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,B.screenPixelArea),V=null!=I?I:V,V=K?Math.min(V,O):V,n.copy(ia,n.add(T,this.currentCamera.eye,n.scale(T,Q,V))),this._planeVertical[3]=-n.dot(x.getNormal(this._planeVertical),ia),this._computePlanePoints(J.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(n.copy(ia,n.add(T,this.currentCamera.eye,n.scale(T,Q,K?O:V))),this._planeHorizontal[3]=-n.dot(x.getNormal(this._planeHorizontal),ia),this._computePlanePoints(J.pointers,
this._planeHorizontal,this.startCamera,this._tmpPoints));B.centroid(this._tmpPoints,this._beginCenter);this._beginCamera.copyFrom(this.startCamera)}}update(J){if(this.active){this.currentCamera.copyFrom(this.startCamera);var K=1<J.pointers.size,I=this._panMode===B.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,M=this._beginCenter;if(K){const S=this._beginRadius/J.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(J.radius,40),120);this._scalingValueSmooth.update(S);
B.applyZoomToPoint(this.currentCamera,M,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*J.timestamp);this._constraintOptions.interactionType=p.InteractionType.ZOOM;this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(J.radius-this._beginRadius));w.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(J.pointers,I,this.currentCamera,this._tmpPoints);
B.centroid(this._tmpPoints,this._tmpCentroid3d);c.screenPointObjectToArray(J.center,this._tmpCentroid2d);B.applyPanPlanar(this.currentCamera,M,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*J.timestamp);this._constraintOptions.interactionType=p.InteractionType.PAN;this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(e.distance(this._beginCenterScreen,this._tmpCentroid2d));w.applyAll(this.view,this.currentCamera,this._constraintOptions);
K&&(K=this._rotationValueSmooth.value,I=B.normalizeRotationDelta(J.angle-K),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(J.radius,40),120),this._rotationValueSmooth.update(K+I),K=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(K,.001*J.timestamp),I=x.getNormal(this._planeHorizontal),B.applyRotation(this.currentCamera,M,u.wrapAxisAngle(I,K)),this._constraintOptions.interactionType=p.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(J.radius*
K)),w.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}}end(J){J.pointers.size===this._pointerCount&&this.update(J);this.finishController();return(J=this._zoomMomentumEstimator.evaluateMomentum())?new A.ZoomPlanarMomentumController({view:this.view,momentum:J,zoomCenter:this._beginCenter}):(J=this._rotationMomentumEstimator.evaluateMomentum())?new E.RotationMomentumController({view:this.view,momentum:J,center:this._beginCenter,axis:x.getNormal(this._planeHorizontal)}):
(J=this._panMomentumEstimator.evaluateMomentum())?new D.PanPlanarMomentumController({view:this.view,momentum:J}):null}_computePlanePoints(J,K,I,M){M.length=J.size;const S=this._tmp2d;let N=0;J.forEach(V=>{S[0]=V.x;S[1]=V.y;void 0===M[N]&&(M[N]=l.create());B.intersectPlaneFromScreenPointAtEye(K,I,S,M[N]);N+=1});return M}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};a.PinchAndPanController=b.__decorate([g.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../input/InputHandler"],function(a,b){class h extends b.InputHandler{constructor(c,k){super(!0);this.view=c;this.registerIncoming("pointer-down",k,()=>this.view.state.stopActiveCameraController())}}a.PointerDownCancelAnimation=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports",
"./SingleKey"],function(a,b){class h extends b.SingleKey{constructor(c,k,m){super(k,m);this.view=c}activate(){this.view.goTo({heading:0}).catch(()=>{})}}a.SingleKeyResetHeading=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../input/InputHandler"],function(a,b){class h extends b.InputHandler{constructor(c,k){super(!0);this.key=c;this.registerIncoming("key-down",k,m=>this._handleKeyDown(m))}_handleKeyDown(c){c.data.key===
this.key&&(this.activate(),c.stopPropagation())}}a.SingleKey=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","./SingleKey"],function(a,b){class h extends b.SingleKey{constructor(c,k,m){super(k,m);this.view=c}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}a.SingleKeyResetTilt=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports",
"../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,h,c){class k extends c.InputHandler{constructor(m,d=!1){super(!0);this._view=m;this._invert=d;this.registerIncoming("vertical-two-finger-drag",f=>this._handleTwoFinger(f))}_handleTwoFinger(m){const d=b.createScreenPointArray(0,m.data.delta*(this._invert?-1:1));switch(m.data.action){case "begin":this._cameraController?.end();this._cameraController=new h.RotateController({view:this._view,
pivot:h.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(d);break;case "update":this._cameraController?.update(d);break;case "end":this._cameraController?.end(),this._cameraController=null}}}a.TwoFingerTilt=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define(["exports","../../core/has","../../core/maybe","./gamepad/GamepadSource","../support/screenUtils"],function(a,
b,h,c,k){const m=b("edge"),d=b("chrome"),f=b("ff"),g=b("safari");class e{constructor(l,u){this._input=u;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=l;l.getAttribute("tabindex")||l.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new c.GamepadSource(l,this._input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}destroy(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(l=>
{this._releasePointerCaptureSafe(l)});this._gamepadSource=h.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(l){this._browserTouchPanningEnabled=l;this._updateTouchAction();this._updateTouchEventHandling()}set onEventReceived(l){this._callback=l}set activeEvents(l){for(const u in this._active)l&&
l.has(u)||(this._element.removeEventListener(n[u],this._active[u]),delete this._active[u]);l&&l.forEach(u=>{if(!this._active[u]&&n[u]){const x=(this._eventHandlers[u]||this._handleDefault).bind(this,u);this._element.addEventListener(n[u],x);this._active[u]=x}});this._gamepadSource.hasEventListeners=l?.has("gamepad")??!1}setPointerCapture(l,u){u?this._setPointerCatpureSafe(l.pointerId):(this._releasePointerCaptureSafe(l.pointerId),this._activePointerCaptures.delete(l.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(l){try{this._element.setPointerCapture(l),this._activePointerCaptures.add(l)}catch{}}_releasePointerCaptureSafe(l){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(l)||this._element.releasePointerCapture(l)}catch(u){}}_updateNormalizedPointerLikeEvent(l,u){l=k.createScreenPointFromNativeEvent(this._element,l);e.test.disableSubpixelCoordinates&&(l.x=Math.round(l.x),l.y=Math.round(l.y));
u.x=l.x;u.y=l.y;return u}_handleKey(l,u){const {key:x}=u;x&&"key-up"===l&&this._keyDownState.delete(x);u={native:u,key:x,repeat:!!x&&this._keyDownState.has(x)};x&&"key-down"===l&&this._keyDownState.add(u.key);this._callback(l,u)}_handlePointer(l,u){u=this._updateNormalizedPointerLikeEvent(u,{native:u,x:0,y:0,pointerType:u.pointerType,button:u.button,buttons:u.buttons,eventId:this._eventId++});this._callback(l,u)}_handlePointerPreventDefault(l,u){const x=this._updateNormalizedPointerLikeEvent(u,{native:u,
x:0,y:0,pointerType:u.pointerType,button:u.button,buttons:u.buttons,eventId:this._eventId++});u.preventDefault();this._callback(l,x)}_handleMouseWheel(l,u){let x=u.deltaY;switch(u.deltaMode){case 0:m&&(x=x/document.documentElement.clientHeight*600);break;case 1:x*=30;break;case 2:x*=900}m?x*=.7:d||g?x*=.6:f&&(x*=1.375);const w=Math.abs(x);100<w&&(x=x/w*200/(1+Math.exp(-.02*(w-100))));u=this._updateNormalizedPointerLikeEvent(u,{native:u,x:0,y:0,deltaY:x});this._callback(l,u)}_handlePointerCaptureLost(l,
u){this._activePointerCaptures.delete(u.pointerId);this._handleDefault(l,u)}_handleDefault(l,u){const x={native:u};u.preventDefault();this._callback(l,x)}_preventAltKeyDefault(l){"Alt"===l.key&&l.preventDefault()}_preventMultiTouchPanning(l){1<l.touches.length&&l.preventDefault()}}e.test={disableSubpixelCoordinates:!1};const n={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture",
"pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,h,c){class k{constructor(m,d){this._element=m;this._input=d;this._hasEventListeners=
!1;this._onConnectGamepad=f=>{this._connectGamepad(f.gamepad)};this._onDisconnectGamepad=f=>{f=f.gamepad;const g=f.index,e=this._inputDevices[g];e&&(this._emitGamepadEvent(f,c.extractState(e),!1),this._inputDevices.splice(g,1),this._latestUpdate.splice(g,1),this._input.gamepad.devices.remove(e),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;m=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&m)this._forEachGamepad(f=>
this._connectGamepad(f)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}destroy(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(m){this._hasEventListeners!==m&&(this._hasEventListeners=m,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&
0<this._inputDevices.length&&this._hasEventListeners}set onEvent(m){this._callback=m}_connectGamepad(m){const d=new h(m);"unknown"!==d.deviceType&&(this._inputDevices[m.index]=d,this._input.gamepad.devices.add(d));this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=b.addFrameTask({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=
null,this._latestUpdate=[])}_readGamepadState(){const m=document.hasFocus(),d=this._element.contains(document.activeElement),f="document"===this._input.gamepad.enabledFocusMode&&!m||"view"===this._input.gamepad.enabledFocusMode&&!d;this._forEachGamepad(g=>{var e=this._inputDevices[g.index];if(e){var n=this._latestUpdate[g.index];e=c.extractState(e);var l=f||c.stateIdle(e);n&&(n.timestamp===g.timestamp||!n.active&&l||c.stateEqual(n.state,e))||this._emitGamepadEvent(g,e,!l)}})}_forEachGamepad(m){const d=
window.navigator.getGamepads();for(let f=0;f<d.length;f++){const g=d[f];this._validate(g)&&m(g)}}_emitGamepadEvent(m,d,f){var g=this._latestUpdate[m.index];if((g=g&&g.active)||f)this._latestUpdate[m.index]={timestamp:m.timestamp,state:d,active:f},this._callback&&this._callback({device:this._inputDevices[m.index],state:d,action:!g&&f?"start":g&&f?"update":"end"})}_validate(m){if(!m||!m.connected)return!1;for(let d=0;d<m.axes.length;d++)if(isNaN(m.axes[d]))return!1;return!0}}a.GamepadSource=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const h=b.native;return h?{buttons:h.buttons.map(c=>c.pressed?c.value||1:0),axes:h.axes.map(c=>{{var k=b.axisThreshold;const m=Math.abs(c);c=m<k?0:Math.sign(c)*(m-k)/(1-k)}return c})}:{buttons:[],axes:[]}};a.stateEqual=function(b,h){if(b.axes.length!==h.axes.length||b.buttons.length!==h.buttons.length)return!1;for(var c=0;c<b.axes.length;c++)if(b.axes[c]!==
h.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(b.buttons[c]!==h.buttons[c])return!1;return!0};a.stateIdle=function(b){for(var h=0;h<b.axes.length;h++)if(0!==b.axes[h])return!1;for(h=0;h<b.buttons.length;h++)if(0!==b.buttons[h])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../InputHandler"],function(a,b){class h extends b.InputHandler{constructor(){super(!0);this.registerIncoming("context-menu",
c=>{c.data.native.preventDefault()})}}a.PreventContextMenu=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define(["exports","../../../core/screenUtils","../../../core/time","../InputHandler","./support"],function(a,b,h,c,k){function m(n){const l=[];n.forEach(u=>{l.push(b.createScreenPoint(u.event.x,u.event.y))});return k.fitCircleLSQ(l)}function d(n){const l=m(n);let u=0;n.forEach(x=>{var w=g(x,l);for(w-=x.lastAngle;w>Math.PI;)w-=2*
Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;w=x.lastAngle+w;x.lastAngle=w;u+=w-x.initialAngle});u/=n.size||1;return{angle:u,radius:l.radius,center:l.center}}function f(n){const l=new Map;n.forEach((u,x)=>l.set(x,u.event));return l}function g(n,l){n=n.event;return Math.atan2(n.y-l.center.y,n.x-l.center.x)}class e extends c.InputHandler{constructor(n){super(!1);this._navigationTouch=n;this._startStateModifiers=new Set;this._activePointerMap=new Map;this._isCurrentDragSuppressed=this._isDragging=!1;this._drag=
this.registerOutgoing("drag");this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this));this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(n,l,u,x){return{action:n,pointerType:this._pointerType,button:this._mouseButton,buttons:l.buttons,timestamp:x,pointers:f(this._activePointerMap),
pointer:l,angle:u.angle,radius:u.radius,center:u.center}}_addPointer(n){var l=n.native.pointerId;const u=d(this._activePointerMap).angle;n={event:n,initialAngle:0,lastAngle:0};this._activePointerMap.set(l,n);l=g(n,m(this._activePointerMap));n.initialAngle=l;n.lastAngle=l;this._updatePointerAngles(u)}_updatePointer(n){if(!n||null!=n.x||null!=n.y){var l=this._activePointerMap.get(n.native.pointerId);l?l.event=n:this._addPointer(n)}}_removePointer(n){const l=d(this._activePointerMap).angle;this._activePointerMap.delete(n);
this._updatePointerAngles(l)}_updatePointerAngles(n){const l=d(this._activePointerMap);this._activePointerMap.forEach(u=>{u.initialAngle=g(u,l)-n;u.lastAngle=g(u,l)-n})}_emitEvent(n,l,u){const x=d(this._activePointerMap);this._drag.emit(this._createPayload(n,l,x,u),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(n){const l=n.data.native.pointerId,u=h.Milliseconds(n.timestamp);this._activePointerMap.get(l)&&(1===this._activePointerMap.size?(this._updatePointer(n.data),!this._isCurrentDragSuppressed&&
this._emitEvent("end",n.data,u),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(l)):(this._removePointer(l),this._emitEvent("removed",n.data,h.Milliseconds(n.timestamp))))}_handlePointerDrag(n){const l=n.data,u=l.currentEvent,x=h.Milliseconds(n.timestamp);switch(l.action){case "start":case "update":this._isDragging?this._activePointerMap.has(u.native.pointerId)?(this._updatePointer(u),!this._isCurrentDragSuppressed&&this._emitEvent("update",u,x)):(this._addPointer(u),this._emitEvent("added",
u,x),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(u),this._pointerType=n.data.startEvent.pointerType,this._mouseButton=n.data.startEvent.button,this._startStateModifiers=n.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",u,x))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}a.Button=
void 0;(function(n){n[n.Left=0]="Left";n[n.Middle=1]="Middle";n[n.Right=2]="Right";n[n.Back=3]="Back";n[n.Forward=4]="Forward";n[n.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};a.euclideanDistance=function(h,c){const k=c.x-h.x;h=c.y-h.y;return Math.sqrt(k*k+h*h)};a.fitCircleLSQ=function(h,c){c?(c.radius=0,c.center.x=0,c.center.y=0):c={radius:0,center:b.createScreenPoint()};if(0===h.length)return c;if(1===h.length)return c.center.x=h[0].x,c.center.y=h[0].y,c;if(2===h.length){const [q,v]=h,[p,t]=[v.x-q.x,v.y-q.y];c.radius=Math.sqrt(p*p+t*t)/2;c.center.x=(q.x+v.x)/2;c.center.y=(q.y+v.y)/
2;return c}let k=0,m=0;for(c=0;c<h.length;c++)k+=h[c].x,m+=h[c].y;k/=h.length;m/=h.length;var d=h.map(q=>q.x-k),f=h.map(q=>q.y-m);let g=c=0;var e=0,n=0,l=0,u=0,x=0;for(var w=0;w<d.length;w++){const q=d[w],v=f[w],p=q*q,t=v*v;c+=p;g+=t;e+=q*v;n+=p*q;l+=t*v;u+=q*t;x+=v*p}d=c;f=e;w=g;n=.5*(n+u);l=.5*(l+x);x=d*w-e*f;u=(n*w-l*f)/x;l=(d*l-e*n)/x;x=b.createScreenPoint(u+k,l+m);return{radius:Math.sqrt(u*u+l*l+(c+g)/h.length),center:x}};a.getPointerId=function(h){({native:h}=h);const {pointerId:c,button:k,
pointerType:m}=h;return"mouse"===m?`${c}:${k}`:`${m}`};a.manhattanDistance=function(h,c){return Math.abs(c.x-h.x)+Math.abs(c.y-h.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define(["exports","../../../core/clock","../InputHandler","./support"],function(a,b,h,c){class k extends h.InputHandler{constructor(m=c.DefaultParameters.maximumDoubleClickDelay,d=c.DefaultParameters.maximumDoubleClickDistance,f=c.DefaultParameters.maximumDoubleTouchDelay,
g=c.DefaultParameters.maximumDoubleTouchDistance,e=b.clock){super(!1);this._maximumDoubleClickDelay=m;this._maximumDoubleClickDistance=d;this._maximumDoubleTouchDelay=f;this._maximumDoubleTouchDistance=g;this._clock=e;this._pointerState=new Map;this._immediateDoubleClick=this.registerOutgoing("immediate-double-click");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(m=>
{m.immediateDoubleClick&&m.immediateDoubleClick.timeoutHandle.remove()});super.onUninstall()}_handlePointerDown(m){m=m.data;const d=c.getPointerId(m);this._pointerState.has(d)||(this._pointerState.set(d,{downButton:m.native.button,x:m.x,y:m.y,immediateDoubleClick:null}),this.startCapturingPointer(m.native))}_handlePointerUp(m){const d=m.data;var f=c.getPointerId(d);if((f=this._pointerState.get(f))&&f.downButton===d.native.button){const g=f.immediateDoubleClick,e="touch"===m.data.native.pointerType?
this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;g?(g.timeoutHandle.remove(),c.manhattanDistance(g,m.data)>e?this._startImmediateDoubleClick(m,f):(this._immediateDoubleClick.emit(m.data,void 0,g.modifiers),this._removeState(d))):c.manhattanDistance(f,m.data)>e?this._removeState(d):this._startImmediateDoubleClick(m,f)}}_startImmediateDoubleClick(m,d){d.immediateDoubleClick={x:m.data.x,y:m.data.y,modifiers:m.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(m.data),
"touch"===m.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(m){const d=c.getPointerId(m);this._pointerState.delete(d);this.stopCapturingPointer(m.native);this.refreshHasPendingInputs()}}a.ImmediateDoubleClick=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(a,b,h,c,
k){class m extends c.InputHandler{constructor(d=k.DefaultParameters.maximumClickDelay,f=k.DefaultParameters.movementUntilMouseDrag,g=k.DefaultParameters.movementUntilPenDrag,e=k.DefaultParameters.movementUntilTouchDrag,n=k.DefaultParameters.holdDelay,l=b.clock){super(!1);this._maximumClickDelay=d;this._movementUntilMouseDrag=f;this._movementUntilPenDrag=g;this._movementUntilTouchDrag=e;this._holdDelay=n;this._clock=l;this._pointerState=new Map;this._pointerDrag=this.registerOutgoing("pointer-drag");
this._immediateClick=this.registerOutgoing("immediate-click");this._pointerHold=this.registerOutgoing("hold");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",u=>{this._handlePointerLoss(u,"pointer-up")});this.registerIncoming("pointer-capture-lost",u=>{this._handlePointerLoss(u,"pointer-capture-lost")});this.registerIncoming("pointer-cancel",u=>{this._handlePointerLoss(u,"pointer-cancel")});this._moveHandle=this.registerIncoming("pointer-move",
this._handlePointerMove.bind(this));this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(d=>{d.holdTimeout=h.removeMaybe(d.holdTimeout)});super.onUninstall()}_handlePointerDown(d){const f=d.data,g=f.native.pointerId;var e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(()=>{const n=this._pointerState.get(g);n&&(n.isDragging||(this._pointerHold.emit(n.previousEvent,void 0,d.modifiers),n.holdEmitted=!0),n.holdTimeout=null)},this._holdDelay));e={startEvent:f,previousEvent:f,
startTimestamp:d.timestamp,isDragging:!1,downButton:f.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(g,e);this.startCapturingPointer(f.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(d)}_createPointerDragData(d,f,g){return{action:d,startEvent:f.startEvent,previousEvent:f.previousEvent,currentEvent:g}}_handlePointerMove(d){const f=d.data,g=this._pointerState.get(f.native.pointerId);if(g){if(g.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
g,f),void 0,g.modifiers);else{const e=k.euclideanDistance(f,g.startEvent),n=this._getDragThreshold(f.native.pointerType);e>n&&this._startDragging(d)}g.previousEvent=f}}_getDragThreshold(d){switch(d){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(d){const f=d.data,g=f.native.pointerId;this._pointerState.forEach(e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||
(e.modifiers=d.modifiers,e.isDragging=!0,g===e.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",e,f)):this._pointerDrag.emit(this._createPointerDragData("start",e,e.previousEvent),d.timestamp))})}_handlePointerLoss(d,f){const g=d.data,e=g.native.pointerId,n=this._pointerState.get(e);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,"pointer-up"===f?g:n.previousEvent),void 0,
n.modifiers):"pointer-up"===f&&n.downButton===g.native.button&&d.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(g),this._pointerState.delete(e),this.stopCapturingPointer(g.native),0===this._pointerState.size&&this._moveHandle.pause())}}a.PointerClickHoldAndDrag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,h,c,k,m){class d extends k.InputHandler{constructor(f=m.DefaultParameters.maximumDoubleClickDelay,g=m.DefaultParameters.maximumDoubleClickDistance,e=m.DefaultParameters.maximumDoubleTouchDelay,n=m.DefaultParameters.maximumDoubleTouchDistance,l=b.clock){super(!1);this._maximumDoubleClickDelay=f;this._maximumDoubleClickDistance=g;this._maximumDoubleTouchDelay=e;this._maximumDoubleTouchDistance=n;this._clock=l;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=
this.registerOutgoing("double-click");this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this));this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(f=>f.doubleClickTimer=c.removeMaybe(f.doubleClickTimer))}get hasPendingInputs(){return h.someMap(this._pointerState,f=>null!=f.doubleClickTimer)}_clearDoubleClickTimer(f,g){const e=this._pointerState.get(f);e&&(e.doubleClickTimer=c.removeMaybe(e.doubleClickTimer),g&&this._click.emit(e.event.data,
void 0,e.event.modifiers),this._pointerState.delete(f),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(f){const g=this._pointerState.get(f);1===g.pointerDownCount&&this._click.emit(g.event.data,void 0,g.event.modifiers);g.doubleClickTimer=null;this._pointerState.delete(f);this.refreshHasPendingInputs()}_getPointerId(f){const {pointerId:g,pointerType:e,button:n}=f.native;return"mouse"===e?`${g}:${n}`:`${e}`}_handleImmediateClick(f){const g=f.data;var {pointerType:e}=g.native;const n=this._getPointerId(g);
if(this._pointerState.has(n)){var l=this._pointerState.get(n),{data:u,modifiers:x}=l.event;e="touch"===e?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;m.manhattanDistance(u,g)>e?(this._clearDoubleClickTimer(n,!0),this._startClick(f)):(this._clearDoubleClickTimer(n,!1),2===l.pointerDownCount&&this._doubleClick.emit(u,void 0,x))}else this._startClick(f)}_handlePointerDown(f){f=m.getPointerId(f.data);if(f=this._pointerState.get(f))f.pointerDownCount+=1}_startClick(f){var {data:g}=
f;const {native:{pointerType:e}}=g,n=m.getPointerId(g);g=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),"touch"===e?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(n,{event:f,doubleClickTimer:g,pointerDownCount:1});this.refreshHasPendingInputs()}}a.SingleAndDoubleClick=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../DragEventSeparator","../InputHandler"],
function(a,b,h){class c extends h.InputHandler{constructor(k=20,m=40){super(!1);this._threshold=k;this._maxDelta=m;this._state="ready";this._emittedArtificalEnd2=!1;this._vertical=this.registerOutgoing("vertical-two-finger-drag");this._artificalDrag=this.registerOutgoing("drag");this._dragEventSeparator=new b.DragEventSeparator({start:(d,f)=>this._observeStart(d,f),update:(d,f,g)=>this._observeUpdate(d,f,g),end:(d,f)=>this._observeEnd(f)});this.registerIncoming("drag",d=>this._dragEventSeparator.handle(d))}get failed(){return"failed"===
this._state}_observeStart(k,m){1===k&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),m.stopPropagation());this._state=2===k?"ready":"failed"}_observeUpdate(k,m,d){"failed"!==this._state&&2===k&&("active"===this._state?(this._vertical.emit({delta:m.data.center.y-
this._thresholdReachedCenter.y,action:"update"}),m.stopPropagation()):this._checkMovementWithinLimits(m.data,d.data)?this._checkVerticalThresholdReached(m.data,d.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=m.data.center,this._artificalDrag.emit({action:"end",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),
this._vertical.emit({delta:m.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),m.stopPropagation()):this._state="failed")}_observeEnd(k){"active"===this._state&&(this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",k.stopPropagation())}_checkMovementWithinLimits(k,m){let d=-Infinity,f=Infinity,g=-Infinity,e=Infinity;for(const {x:w,y:q}of m.pointers.values())d=Math.max(d,w),f=Math.min(f,w),g=Math.max(g,q),e=Math.min(e,q);let n=-Infinity,
l=Infinity,u=-Infinity,x=Infinity;for(const {x:w,y:q}of k.pointers.values())n=Math.max(n,w),l=Math.min(l,w),u=Math.max(u,q),x=Math.min(x,q);return Math.abs(k.center.x-m.center.x)<this._threshold&&Math.abs(n-l-(d-f))<=this._maxDelta&&Math.abs(u-x-(g-e))<=this._maxDelta}_checkVerticalThresholdReached(k,m){let d=Math.abs(k.center.y-m.center.y);k.pointers.forEach((f,g)=>{g=m.pointers.get(g);d=Math.min(d,Math.abs(f.y-g.y))});return d>=this._threshold}}a.VerticalTwoFingerDrag=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){class b{constructor(h){this._callbacks=h;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(h){const c=h.data,k=c.pointers.size;switch(c.action){case "start":this._currentCount=k;this._emitStart(h);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(h);break;case "update":this._emitUpdate(h);break;case "removed":this._startEvent&&
this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(h);break;case "end":this._emitEnd(h),this._currentCount=0}this._previousEvent=h}_emitStart(h){this._startEvent=h;this._callbacks.condition?.(this._currentCount,h)&&this._callbacks.start(this._currentCount,h,this._startEvent)}_emitUpdate(h){this._callbacks.condition?.(this._currentCount,h)&&this._callbacks.update(this._currentCount,h,this._startEvent)}_emitEnd(h){this._callbacks.condition?.(this._currentCount,h)&&this._callbacks.end(this._currentCount,
h,this._startEvent);this._startEvent=null}}a.DragEventSeparator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(p){p=p.layer;return!(!p?.featureReduction||"selection"!==p.featureReduction.type)}function v(p){(p=p.graphics3DGraphics)&&p.forEach(t=>t.setVisibilityFlag(u.VisibilityGroup.GRAPHIC,u.VisibilityFlag.DECONFLICTION,!0))}a.GraphicsDeconflictor=class extends l.Deconflictor{constructor(){super(...arguments);this._contexts=new Map;this.visibilityGroup=u.VisibilityGroup.GRAPHIC;this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([k.watch(()=>
this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),k.watch(()=>this.view?.map?.ground?.opacity,(p,t)=>{1!==p&&1!==t||this.setDirty()}),k.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},k.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(w.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new x.LabelDeconflictor({view:this.view,parent:this})}destroy(){this._labels=c.destroyMaybe(this._labels);this._frameTask=
c.removeMaybe(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(p){this._marginFactor=p;this.setDirty()}setDirty(){0<this._contexts.size&&(super.setDirty(),this._labels.setDirty())}runTask(p){super.runTask(p);this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(p,t){p=!(this._graphicSupportsDeconfliction(t)&&q(p));t.setVisibilityFlag(u.VisibilityGroup.GRAPHIC,u.VisibilityFlag.DECONFLICTION,p)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this._updateSlicePlane())}_updateSlicePlane(){const p=this.view?this.view.slicePlane:null;null!=p&&n.transform(p,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=p}_slicePlaneChanged(){h.someMap(this._contexts,(p,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(p){const t=this._getGraphicsContext(p);return{addGraphic:r=>this._addGraphic(p,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(p,
t),featureReductionChange:()=>this.enabledChanged(p,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(p,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(p){const t=this._contexts.get(p);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(p),this.setDirty())}_addGraphic(p,t,r){const y=r.graphic.uid;r=new l.DeconflictorGraphic(r,p.symbolCreationContext.slicePlaneEnabled);t.set(y,r);q(p)&&this.addToActiveGraphics(r);
p.labelsEnabled&&this._labels.addToActiveGraphics(r)}_removeGraphic(p,t){t=t.graphic.uid;const r=p.get(t);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),p.delete(t),this.setDirty())}enabledChanged(p,t){const r=q(p);r||v(p);this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(p,t){const r=p.symbolCreationContext.slicePlaneEnabled;t.forEach(y=>y.slicePlaneEnabled=r);this.setDirty()}getGraphicsLayers(p){return p.layers}_graphicSupportsDeconfliction(p){if(p.isDraped)return!1;
p=p.layers;if(!p?.length)return!1;for(const t of p)if(this.layerSupportsDeconfliction(t))return!0;return!1}_getGraphicsContext(p){var t=this._contexts.get(p);if(t)return t;t=new Map;this._contexts.set(p,t);this.setDirty();return t}};a.GraphicsDeconflictor=b.__decorate([e.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){function*C(ha){if(Map.prototype.entries){ha=ha.entries();for(let fa=ha.next();!fa.done;fa=ha.next())yield fa.value[1]}else yield*ha.values()}function*z(ha,fa,aa){fa.clear();ha.forEach((ea,ca)=>{const W=fa.pushNew();W.id=ca;W.visible=ea.graphics3DGraphic.getVisibilityFlag(aa,A.VisibilityFlag.DECONFLICTION);ca=ea.info?.[aa];W.prio=ea.graphics3DGraphic.deconflictionPriority;W.distance=ca?ca.distance:Number.MAX_VALUE});yield;const Z=
fa.iterableSort((ea,ca)=>ea.prio!==ca.prio?ca.prio-ea.prio:ea.distance!==ca.distance?ea.distance-ca.distance:ea.visible!==ca.visible?ea.visible?-1:1:ea.id-ca.id);for(let ea=Z.next();!ea.done;ea=Z.next())yield;fa.forAll(ea=>{const ca=ha.get(ea.id);ca&&(ha.delete(ea.id),ha.set(ea.id,ca))});fa.clear()}const J=w.create(),K=v.create(),I=v.create(),M=w.create(),S=l.create(),N=D.create(),V=y.create(),Q=w.create(),T=t.create();class ia{constructor(){this.aabr=t.create();this.distance=0;this.visible=this.culled=
!1}}class O{constructor(ha,fa){this.graphics3DGraphic=ha;this.slicePlaneEnabled=fa;this.info={}}}a.State=void 0;(function(ha){ha[ha.Idle=0]="Idle";ha[ha.Process=1]="Process";ha[ha.Sort=2]="Sort";ha[ha.Deconflict=3]="Deconflict";ha[ha.NumStates=4]="NumStates"})(a.State||(a.State={}));class U{constructor(){this.camera=new B.Camera;this.slicePlane=r.create();this.slicePlaneEnabled=!1}copyFrom(ha){this.camera.copyFrom(ha.camera);r.copy(ha.slicePlane,this.slicePlane);this.slicePlaneEnabled=ha.slicePlaneEnabled}}
a.Deconflictor=class extends h{get dirty(){return this._dirty}get state(){return this._state}constructor(ha){super(ha);this._dirty=!1;this._viewState=new U;this._state=a.State.Idle;this._active=new Map;this._visible=new Map;this._iterators=new R;this._accBinsNumX=15;this._accBinsNumY=20;this._accBinsSizeY=this._accBinsSizeX=0;this._accBins=null;this.accNumTests=0}destroy(){this._active.clear();this._visible.clear();this._iterators=null}setDirty(){!this._dirty&&0<this._active.size&&(this._dirty=!0,
this.notifyChange("updating"))}get updating(){return this._state!==a.State.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const ha=this._state/a.State.NumStates;return this._dirty?.5*ha:ha}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(ha){switch(this._state){case a.State.Idle:this._startUpdate(),ha.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ha))break;case a.State.Sort:if(this._state=a.State.Sort,
!this._sortVisibleGraphics(ha))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ha))break;default:E.drawAccelerationStruct(this,this._visible),this._state=a.State.Idle,this.notifyChange("updating")}}modifyGraphics(ha,fa){fa?ha.forEach(aa=>this.addToActiveGraphics(aa)):ha.forEach(aa=>this.removeFromActiveGraphics(aa));this.setDirty()}layerSupportsDeconfliction(ha){if(null==ha||"object3d"!==ha.type)return!1;ha=ha.stageObject;return 1===(ha?.geometries.length??
0)&&ha?.geometries[0]?.material instanceof H.HUDMaterial?!0:!1}_startUpdate(){E.prepare(this.view);this._dirty=!1;this._viewState.copyFrom(this.viewState);const {fullWidth:ha,fullHeight:fa}=this._viewState.camera;this._initBins(ha,fa);this._resetIterators()}addToActiveGraphics(ha){ha.info[this.visibilityGroup]=new ia;this._active.set(ha.graphics3DGraphic.graphic.uid,ha);this.setDirty()}removeFromActiveGraphics(ha){this._visible.delete(ha.graphics3DGraphic.graphic.uid);const fa=ha.graphics3DGraphic;
fa.destroyed||fa.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,!0);delete ha.info[this.visibilityGroup];this._active.delete(ha.graphics3DGraphic.graphic.uid);this.setDirty()}_processActiveGraphics(ha){const fa=this._ensureActiveGraphicsIterator(),aa=n.invertOrIdentity(S,this._viewState.camera.projectionMatrix),Z="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._viewState.camera.relativeElevation?N:null;let ea=0;null!=Z&&(x.transformMat4(D.getCenter(Z),
w.ZEROS,this._viewState.camera.viewMatrix),Z[3]=p.getReferenceEllipsoid(this.view.spatialReference).radius,ea=D.distanceToSilhouette(Z,w.ZEROS));for(;!ha.done;){ha.madeProgress();var ca=fa.next();if(!0===ca.done)return this._resetActiveGraphicsIterator(),!0;ca=ca.value;const W=ca?.info[this.visibilityGroup];W&&(this._collectGraphics3DGraphics(ca,aa,Z,ea),W.culled?this._visible.delete(ca.graphics3DGraphic.graphic.uid):this._visible.set(ca.graphics3DGraphic.graphic.uid,ca))}return!1}_sortVisibleGraphics(ha){const fa=
this._ensureSortGraphicsIterator();for(;!ha.done;){const aa=fa.next();ha.madeProgress();if(!0===aa.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(ha){const fa=this._ensureVisibleGraphicsIterator(),aa=this.visibilityGroup===A.VisibilityGroup.LABEL;for(;!ha.done;){ha.madeProgress();var Z=fa.next();if(!0===Z.done)return this._resetVisibleGraphicsIterator(),!0;Z=Z.value;const ca=Z.info[this.visibilityGroup];if(!ca||ca.culled)this._setGraphicVisibility(Z,!1);else{var ea=
Z.graphics3DGraphic;ea=!aa||ea.isVisible();ca.visible=ea&&!this._isConflicted(Z);ca.visible&&this._addToBins(Z);this._setGraphicVisibility(Z,ca.visible);E.drawPoly(ca,ca.visible)}}return!1}_resetIterators(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null}_ensureActiveGraphicsIterator(){this._iterators.active||(this._iterators.active=C(this._active));return this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){this._iterators.visible||
(this._iterators.visible=C(this._visible));return this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){this._iterators.sort||(this._iterators.sort=z(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(ha,fa,aa,Z){var ea=ha.graphics3DGraphic;if(!ea.destroyed){var ca=ha.info[this.visibilityGroup];if(ea.isVisible(A.VisibilityGroup.GRAPHIC,
A.VisibilityFlag.DECONFLICTION)){var W=this.getGraphicsLayers(ea);t.empty(ca.aabr);ea=null;for(const Y of W)if(this.layerSupportsDeconfliction(Y)){W=Y.stageObject.geometries[0].material;if(null==ea&&(ea=da,this._getProjectionInfo(Y,fa,ea),ea.isOutsideScreen||this._isCulledBySlice(ha,J)||null!=aa&&this._isCulledByHorizon(ea,aa,Z))){ca.culled=!0;return}this._expandBoundingRect(ca,Y,W,ea)}null==ea?ca.culled=!0:(ca.distance=ea.distance,ca.culled=!1)}else ca.culled=!0}}_getProjectionInfo(ha,fa,aa){const Z=
this._viewState.camera;ha=ha.stageObject;var ea=ha.geometries[0];const ca=ea.material;var W=D.getCenter(ha.boundingVolumeWorldSpace.bounds);x.transformMat4(J,W,Z.viewMatrix);W=ea.attributes;ea=W.get(G.VertexAttribute.NORMAL).data;W=W.get(G.VertexAttribute.CENTEROFFSETANDDISTANCE).data;ca.applyShaderOffsetsView(J,ea,ha.transformation,W,Z,aa.scaleInfo,J);q.set(K,J[0],J[1],J[2],1);q.transformMat4(I,K,Z.projectionMatrix);x.scale(aa.positionNDC,I,1/I[3]);ca.applyShaderOffsetsNDC(aa.positionNDC,W,Z,aa.positionNDC,
M);aa.distanceWithoutPolygonOffset=Z.depthNDCToWorld(M[2]);aa.distance=M[2]===aa.positionNDC[2]?aa.distanceWithoutPolygonOffset:Z.depthNDCToWorld(aa.positionNDC[2]);q.set(I,aa.positionNDC[0],aa.positionNDC[1],aa.positionNDC[2],1);q.transformMat4(K,I,fa);q.scale(K,K,1/K[3]);x.set(aa.positionView,J[0],J[1],J[2])}_isCulledByHorizon(ha,fa,aa){x.copy(V.direction,ha.positionView);x.set(V.origin,0,0,0);return D.intersectRay(fa,V,Q)?ha.distanceWithoutPolygonOffset>aa:!1}_isCulledBySlice(ha,fa){return ha.slicePlaneEnabled&&
this._viewState.slicePlaneEnabled&&r.extrusionContainsPoint(this._viewState.slicePlane,fa)}_expandBoundingRect(ha,fa,aa,{positionNDC:Z,scaleInfo:ea}){const ca=this._viewState.camera;fa=fa.getScreenSize(ba);F.applyPrecomputedScaleFactor(fa,ea.factor,fa);fa[0]*=ca.pixelRatio;fa[1]*=ca.pixelRatio;aa=t.offset(aa.calculateRelativeScreenBounds(fa,ea.factorAlignment.scale,T),c.lerp(0,ca.fullWidth,.5+.5*Z[0]),c.lerp(0,ca.fullHeight,.5+.5*Z[1]));Z=this.marginFactor;0!==Z&&(Z*=Math.min(t.width(aa),t.height(aa)),
aa[0]-=Z,aa[1]-=Z,aa[2]+=Z,aa[3]+=Z);t.expand(ha.aabr,aa,ha.aabr)}_isConflicted(ha){const fa=ha.graphics3DGraphic.graphic.uid;ha=ha.info[this.visibilityGroup];let aa=!0;for(let Z=Math.floor(ha.aabr[0]/this._accBinsSizeX);Z<=Math.floor(ha.aabr[2]/this._accBinsSizeX);Z++)if(!(0>Z||Z>=this._accBinsNumX))for(let ea=Math.floor(ha.aabr[1]/this._accBinsSizeY);ea<=Math.floor(ha.aabr[3]/this._accBinsSizeY);ea++){if(0>ea||ea>=this._accBinsNumY)continue;aa=!1;const ca=this._accBins[Z][ea];for(let W=0;W<ca.length;W++){const Y=
ca.data[W],ja=Y.info[this.visibilityGroup];if(ja&&ja.visible&&Y.graphics3DGraphic.graphic.uid!==fa&&(this.accNumTests++,t.intersects(ja.aabr,ha.aabr)))return!0}}return aa}_initBins(ha,fa){if(null==this._accBins){this._accBins=[];for(var aa=0;aa<this._accBinsNumX;aa++){this._accBins.push([]);var Z=this._accBins[this._accBins.length-1];for(let ea=0;ea<this._accBinsNumY;ea++)Z.push(new k)}}else for(aa=0;aa<this._accBinsNumX;aa++)for(Z=0;Z<this._accBinsNumY;Z++)this._accBins[aa][Z].clear();this._accBinsSizeX=
ha/this._accBinsNumX;this._accBinsSizeY=fa/this._accBinsNumY;this.accNumTests=0}_addToBins(ha){var fa=ha.info[this.visibilityGroup],aa=Math.floor(fa.aabr[0]/this._accBinsSizeX);const Z=Math.floor(fa.aabr[2]/this._accBinsSizeX),ea=Math.floor(fa.aabr[1]/this._accBinsSizeY);for(fa=Math.floor(fa.aabr[3]/this._accBinsSizeY);aa<=Z;aa++)if(!(0>aa||aa>=this._accBinsNumX))for(let ca=ea;ca<=fa;ca++)0>ca||ca>=this._accBinsNumY||this._accBins[aa][ca].push(ha)}_setGraphicVisibility(ha,fa){ha=ha.graphics3DGraphic;
ha.destroyed||(ha.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,fa),this.visibilityGroup===A.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ha,fa))}};b.__decorate([m.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([m.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);class P{constructor(){this.id=
0;this.visible=!1;this.distance=this.prio=0}}class R{constructor(ha=null,fa=null,aa=null){this.active=ha;this.visible=fa;this.sort=aa;this.sortArray=new k({allocator:Z=>Z||new P})}}const ba=u.create();class X{constructor(){this.positionView=w.create();this.positionNDC=w.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new L.ScaleInfo}get isOutsideScreen(){const ha=this.positionNDC;return-1>ha[0]||-1>ha[1]||-1>ha[2]||1<=ha[0]||1<=ha[1]}}const da=new X;a.DeconflictorGraphic=
O;a.DeconflictorViewState=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function h(n,l,u,x,w){f&&(f(),f=null);const q=g.height,v=e;v.beginPath();v.lineWidth=1;v.strokeStyle=w;v.moveTo(n,q-u);v.lineTo(l,q-u);v.stroke();v.lineTo(l,q-x);v.stroke();v.lineTo(l,q-u);v.stroke();v.lineTo(n,q-u);v.stroke();v.lineTo(n,q-u);v.stroke();v.closePath()}let c=!1,k=!1,m=!1,d=
!1,f=null,g,e;a.drawAccelerationStruct=function(n,l){if(k&&e){f&&(f(),f=null);var u=e,x=0;for(let w=0;w<n.accBinsNumX;w++)for(let q=0;q<n.accBinsNumY;q++){const v=n.accBins[w][n.accBinsNumY-1-q];x+=v.length;const p=w*n.accBinsSizeX,t=(w+1)*n.accBinsSizeX,r=q*n.accBinsSizeY,y=(q+1)*n.accBinsSizeY;u.fillText(v.length.toFixed(),p+5,r+15);h(p,t,r,y,"blue")}u.fillText("total totalShownLabels: "+x,70,40);u.fillText("total visible labels: "+l.size,70,50);u.fillText("total numTests: "+n.accNumTests,70,30)}};
a.drawPoly=function(n,l){c&&(l&&m||!l&&d)&&h(n.aabr[0],n.aabr[2],n.aabr[1],n.aabr[3],l?"green":"red")};a.prepare=function(n){m=b.debugFlags.DECONFLICTOR_SHOW_VISIBLE;d=b.debugFlags.DECONFLICTOR_SHOW_INVISIBLE;c=m||d;k=b.debugFlags.DECONFLICTOR_SHOW_GRID;f=null;c||k?f=()=>{null==g&&(g=document.createElement("canvas"),g.setAttribute("id","debugCanvas2d"),n.surface.parentElement.style.position="relative",n.surface.parentElement.appendChild(g));var {state:l}=n;const {camera:u,pixelRatio:x}=l,{width:w,
height:q}=u;l=q*x;g.setAttribute("width",`${w*x}px`);g.setAttribute("height",`${l}px`);g.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${w}px;height:${q}px`);e=g.getContext("2d");e.clearRect(0,0,w,q);e.font="12px Arial"}:g&&(g.parentElement.removeChild(g),g=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){h=class extends h{constructor(){super(...arguments);this.LINE_WIREFRAMES=this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=this.I3S_SHOW_MODIFICATIONS=this.I3S_TREE_SHOW_TILES=this.TERRAIN_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_FETCH_SHOW_TILES=this.DRAW_MESH_GEOMETRY_NORMALS=this.TESTS_DISABLE_FAST_UPDATES=this.TESTS_DISABLE_OPTIMIZATIONS=this.SHOW_POI=this.OVERLAY_SHOW_CENTER=
this.OVERLAY_DRAW_DEBUG_TEXTURE=this.TEXT_SHOW_BORDER=this.TEXT_SHOW_BASELINE=this.LABELS_SHOW_BORDER=this.DECONFLICTOR_SHOW_GRID=this.DECONFLICTOR_SHOW_INVISIBLE=this.DECONFLICTOR_SHOW_VISIBLE=this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1}};b.__decorate([c.property()],h.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([c.property()],h.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([c.property()],h.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([c.property()],
h.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([c.property()],h.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([c.property()],h.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([c.property()],h.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([c.property()],h.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([c.property()],h.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([c.property()],h.prototype,"SHOW_POI",void 0);b.__decorate([c.property()],h.prototype,"TESTS_DISABLE_OPTIMIZATIONS",
void 0);b.__decorate([c.property()],h.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([c.property()],h.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([c.property()],h.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([c.property()],h.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([c.property()],h.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([c.property()],h.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([c.property()],h.prototype,
"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([c.property()],h.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([c.property()],h.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([c.property()],h.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([c.property()],h.prototype,"LINE_WIREFRAMES",void 0);h=b.__decorate([f.subclass("esri.views.3d.support.DebugFlags")],h);b=new h;a.debugFlags=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityFlag=void 0;(function(b){b[b.USER=1]="USER";b[b.SCALE_RANGE=2]="SCALE_RANGE";b[b.FILTER=4]="FILTER";b[b.DECONFLICTION=8]="DECONFLICTION";b[b.ALL_GRAPHIC=15]="ALL_GRAPHIC";b[b.ALL_LABEL=255]="ALL_LABEL"})(a.VisibilityFlag||(a.VisibilityFlag={}));a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=1]="GRAPHIC";b[b.LABEL=16]="LABEL"})(a.VisibilityGroup||(a.VisibilityGroup={}));Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,h){function c(e,n,l){l=l.parameters;f.scale=Math.min(l.divisor/(n-l.offset),1);f.factor=Math.abs(e*e*e);return f}function k(e,n){return b.lerp(e*Math.max(n.scale,n.minScaleFactor),e,n.factor)}class m{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,
n,l,u={camera:{distance:0,fovY:0},divisor:0,offset:0},x){this._viewingMode=e;this._description=n;this._ellipsoidRadius=l;this.parameters=u;this._fontHeight=x;this._viewingMode===h.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){if(this.parameters&&
this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance)return!1;this._calculateParameters(e,this._ellipsoidRadius,this.parameters);return!0}overrideFontHeight(e){return e!==this._fontHeight?new m(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,n,l){const {scaleStart:u,scaleFallOffRange:x}=this._description,{fovY:w,distance:q}=e;var v=this._calculateCurvatureDependentParameters(e,n);n=this._coverageCompensation(e,
n,v);const {tiltAngle:p,scaleFallOffFactor:t}=v,r=Math.sin(p)*q,y=.5*Math.PI-p-w*(.5-u*n);v=r/Math.cos(y);n=(v-r/Math.cos(y+w*x*n)*t)/(1-t);l.camera.fovY=e.fovY;l.camera.distance=e.distance;l.offset=n;l.divisor=v-n;return l}_calculateCurvatureDependentParametersLocal(e,n,l=g){l.tiltAngle=this._description.curvatureDependent.min.tiltAngle;l.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return l}_calculateCurvatureDependentParametersGlobal(e,n,l=g){const u=this._description.curvatureDependent;
e=1+e.distance/n;e=Math.sqrt(e*e-1);const [x,w]=[u.min.curvature,u.max.curvature];e=b.clamp((e-x)/(w-x),0,1);const [q,v]=[u.min,u.max];l.tiltAngle=b.lerp(q.tiltAngle,v.tiltAngle,e);l.scaleFallOffFactor=b.lerp(q.scaleFallOffFactor,v.scaleFallOffFactor,e);return l}_surfaceCoverageCompensationLocal(e,n,l){return(e.fovY-l.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,n,l){const u=n*n;l=l.tiltAngle+.5*Math.PI;const {fovY:x,distance:w}=e;e=w*w+u-2*Math.cos(l)*w*n;const q=Math.sqrt(e);return(Math.acos(Math.sqrt(e-
u)/q)-Math.asin(n/(q/Math.sin(l)))+.5*x)/x}}const d={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minScaleFactor:0},g={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,n,l=[0,0]){n=Math.min(Math.max(n.scale,n.minScaleFactor),1);l[0]=e[0]*n;l[1]=e[1]*n;return l};a.applyScaleFactor=
k;a.getLabelSettings=function(e,n){const {curvatureDependent:l,scaleStart:u,scaleFallOffRange:x}=d;return new m(e,{curvatureDependent:{min:{curvature:l.min.curvature,tiltAngle:l.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:l.max.curvature,tiltAngle:l.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:u,scaleFallOffRange:x,minPixelSize:14},n)};a.getSettings=function(e,n){return new m(e,d,n)};a.precomputeScaleFactor=function(e,n,l,u){e=c(e,n,l);e.minScaleFactor=0;e=k(1,e);u.scale=e;u.factor=0;
u.minScaleFactor=l.minScaleFactor};a.scale=function(e,n,l,u){return k(e,c(n,l,u))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../layers/support/FastSymbolUpdates ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){function J(ca,W,Y,ja,oa,ra,ta,ya){W=W-oa-(0<ya[0]?ja[0]*ya[0]:0);let Ca=W+ja[0]+2*oa;Y=Y-oa-(0<ya[1]?ja[1]*ya[1]:0);oa=Y+ja[1]+2*oa;ya=ta.distanceFieldBoundingBox;ta.textureIsSignedDistanceField&&null!=ya&&(W+=ja[0]*ya[0],Y+=ja[1]*ya[1],Ca-=ja[0]*(1-ya[2]),oa-=ja[1]*(1-ya[3]),W-=ra,Ca+=ra,Y-=ra,oa+=ra);return ca[0]>W&&ca[0]<Ca&&ca[1]>Y&&ca[1]<oa}class K extends y.Material{constructor(ca){super(ca,new fa);this._configuration=new z.HUDMaterialTechniqueConfiguration;
this.produces=new Map([[D.RenderSlot.HUD_MATERIAL,W=>p.isColorAlphaHighlightOrOID(W)&&!this.parameters.drawInSecondSlot],[D.RenderSlot.LABEL_MATERIAL,W=>p.isColorAlphaHighlightOrOID(W)&&this.parameters.drawInSecondSlot],[D.RenderSlot.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[D.RenderSlot.DRAPED_MATERIAL,W=>p.isColorAlphaHighlightOrOID(W)]])}getConfiguration(ca,W){this._configuration.output=ca;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=
!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.draped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=
this.parameters.textureIsSignedDistanceField;this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=W.slot===D.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest;ca===p.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!q.debugFlags.LABELS_SHOW_BORDER);this._configuration.depthEnabled=
this.parameters.depthEnabled;this._configuration.transparencyPassType=W.transparencyPassType;this._configuration.multipassEnabled=W.multipassEnabled;this._configuration.cullAboveGround=W.multipassTerrain.cullAboveGround;return this._configuration}intersect(ca,W,Y,ja,oa,ra){if(Y.options.selectionMode&&Y.options.hud&&ca.visible&&Y.point){ja=this.parameters;oa=Y.point;var ta=Y.camera,{scaleX:ya,scaleY:Ca}=this._getScreenScale(ca);ya*=ta.pixelRatio;Ca*=ta.pixelRatio;c.fromMat4(ia,W);if(ca.attributes.has(B.VertexAttribute.FEATUREATTRIBUTE)){var pa=
ia,wa=pa[0],Ba=pa[1],la=pa[2],qa=pa[3],ua=pa[4],va=pa[5],Ga=pa[6],La=pa[7];const Na=pa[8],Wa=1/Math.sqrt(wa*wa+Ba*Ba+la*la),Ia=1/Math.sqrt(qa*qa+ua*ua+va*va),Oa=1/Math.sqrt(Ga*Ga+La*La+Na*Na);pa[0]=wa*Wa;pa[1]=Ba*Wa;pa[2]=la*Wa;pa[3]=qa*Ia;pa[4]=ua*Ia;pa[5]=va*Ia;pa[6]=Ga*Oa;pa[7]=La*Oa;pa[8]=Na*Oa}pa=ca.attributes.get(B.VertexAttribute.POSITION);wa=ca.attributes.get(B.VertexAttribute.SIZE);Ba=ca.attributes.get(B.VertexAttribute.NORMAL);ca=ca.attributes.get(B.VertexAttribute.CENTEROFFSETANDDISTANCE);
A.assert(3<=pa.size);la=L.calculateAnchorPosForRendering(ja);qa="screen"===this.parameters.centerOffsetUnits;for(ua=0;ua<pa.data.length/pa.size;ua++)va=ua*pa.size,g.set(S,pa.data[va],pa.data[va+1],pa.data[va+2]),g.transformMat4(S,S,W),va=ua*wa.size,da[0]=wa.data[va]*ya,da[1]=wa.data[va+1]*Ca,g.transformMat4(S,S,ta.viewMatrix),va=ua*ca.size,g.set(P,ca.data[va],ca.data[va+1],ca.data[va+2]),qa||(S[0]+=P[0],S[1]+=P[1],0!==P[2]&&(va=P[2],g.normalize(P,S),g.subtract(S,S,g.scale(P,P,va)))),va=ua*Ba.size,
g.set(N,Ba.data[va],Ba.data[va+1],Ba.data[va+2]),this._normalAndViewAngle(N,ia,ta,X),this._applyVerticalOffsetTransformationView(S,X,ta,M),ta.applyProjection(S,V),-1<V[0]&&(qa&&(P[0]||P[1])&&(V[0]+=P[0]*ta.pixelRatio,0!==P[1]&&(V[1]+=E.applyScaleFactor(P[1],M.factorAlignment)*ta.pixelRatio),ta.unapplyProjection(V,S)),V[0]+=this.parameters.screenOffset[0]*ta.pixelRatio,V[1]+=this.parameters.screenOffset[1]*ta.pixelRatio,V[0]=Math.floor(V[0]),V[1]=Math.floor(V[1]),E.applyPrecomputedScaleFactor(da,M.factor,
da),va=1*ta.pixelRatio,Ga=0,ja.textureIsSignedDistanceField&&(Ga=ja.outlineSize*ta.pixelRatio/2),J(oa,V[0],V[1],da,va,Ga,ja,la)&&(Ga=Y.ray,g.transformMat4(T,S,m.invert(U,ta.viewMatrix)),V[0]=oa[0],V[1]=oa[1],ta.unprojectFromRenderScreen(V,S)&&(va=e.create(),g.copy(va,Ga.direction),La=1/g.length(va),g.scale(va,va,La),Ga=g.distance(Ga.origin,S)*La,ra(Ga,va,-1,!0,1,T))))}}intersectDraped(ca,W,Y,ja,oa,ra){W=ca.attributes.get(B.VertexAttribute.POSITION);Y=ca.attributes.get(B.VertexAttribute.SIZE);const ta=
this.parameters,ya=L.calculateAnchorPosForRendering(ta);let {scaleX:Ca,scaleY:pa}=this._getScreenScale(ca);Ca*=ca.screenToWorldRatio;pa*=ca.screenToWorldRatio;const wa=2*ca.screenToWorldRatio;for(let qa=0;qa<W.data.length/W.size;qa++){var Ba=qa*W.size;const ua=W.data[Ba];Ba=W.data[Ba+1];var la=qa*Y.size;da[0]=Y.data[la]*Ca;da[1]=Y.data[la+1]*pa;la=0;ta.textureIsSignedDistanceField&&(la=ta.outlineSize*ca.screenToWorldRatio/2);J(ja,ua,Ba,da,wa,la,ta,ya)&&oa(ra.dist,ra.normal,-1,!1)}}createBufferWriter(){return new ea(this)}_normalAndViewAngle(ca,
W,Y,ja){l.isMat4(W)&&(W=c.fromMat4(O,W));g.transformMat3(ja.normal,ca,W);g.transformMat4(ja.normal,ja.normal,Y.viewInverseTransposeMatrix);ja.cosAngle=g.dot(Q,ha);return ja}_updateScaleInfo(ca,W,Y){const ja=this.parameters;null!=ja.screenSizePerspective?E.precomputeScaleFactor(Y,W,ja.screenSizePerspective,ca.factor):(ca.factor.scale=1,ca.factor.factor=0,ca.factor.minScaleFactor=0);null!=ja.screenSizePerspectiveAlignment?E.precomputeScaleFactor(Y,W,ja.screenSizePerspectiveAlignment,ca.factorAlignment):
(ca.factorAlignment.factor=ca.factor.factor,ca.factorAlignment.scale=ca.factor.scale,ca.factorAlignment.minScaleFactor=ca.factor.minScaleFactor)}applyShaderOffsetsView(ca,W,Y,ja,oa,ra,ta){W=this._normalAndViewAngle(W,Y,oa,X);this._applyVerticalGroundOffsetView(ca,W,oa,ta);this._applyVerticalOffsetTransformationView(ta,W,oa,ra);this._applyPolygonOffsetView(ta,W,ja[3],oa,ta);this._applyCenterOffsetView(ta,ja,ta);return ta}applyShaderOffsetsNDC(ca,W,Y,ja,oa){this._applyCenterOffsetNDC(ca,W,Y,ja);null!=
oa&&g.copy(oa,ja);this._applyPolygonOffsetNDC(ja,W,Y,ja);return ja}_applyPolygonOffsetView(ca,W,Y,ja,oa){var ra=ja.aboveGround?1:-1;Y=Math.sign(Y);0===Y&&(Y=ra);ra*=Y;if(0>=this.parameters.shaderPolygonOffset)return g.copy(oa,ca);W=h.clamp(Math.abs(W.cosAngle),.01,1);ja=1-Math.sqrt(1-W*W)/W/ja.viewport[2];0<ra?g.scale(oa,ca,ja):g.scale(oa,ca,1/ja);return oa}_applyVerticalGroundOffsetView(ca,W,Y,ja){const oa=g.length(ca),ra=Y.aboveGround?1:-1;Y=Y.computeRenderPixelSizeAtDist(oa)*t.HUDVerticalPixelOffset;
W=g.scale(S,W.normal,ra*Y);g.add(ja,ca,W);return ja}_applyVerticalOffsetTransformationView(ca,W,Y,ja){const oa=this.parameters;if(!oa.verticalOffset?.screenLength){if(oa.screenSizePerspective||oa.screenSizePerspectiveAlignment){var ra=g.length(ca);this._updateScaleInfo(ja,ra,W.cosAngle)}else ja.factor.scale=1,ja.factorAlignment.scale=1;return ca}ra=g.length(ca);Y=H.verticalOffsetAtDistance(Y,ra,oa.verticalOffset,W.cosAngle,oa.screenSizePerspectiveAlignment??oa.screenSizePerspective);this._updateScaleInfo(ja,
ra,W.cosAngle);g.scale(W.normal,W.normal,Y);return g.add(ca,ca,W.normal)}_applyCenterOffsetView(ca,W,Y){const ja="screen"!==this.parameters.centerOffsetUnits;Y!==ca&&g.copy(Y,ca);ja&&(Y[0]+=W[0],Y[1]+=W[1],W[2]&&(g.normalize(N,Y),g.add(Y,Y,g.scale(N,N,W[2]))));return Y}_applyCenterOffsetNDC(ca,W,Y,ja){const oa="screen"!==this.parameters.centerOffsetUnits;ja!==ca&&g.copy(ja,ca);oa||(ja[0]+=W[0]/Y.fullWidth*2,ja[1]+=W[1]/Y.fullHeight*2);return ja}_applyPolygonOffsetNDC(ca,W,Y,ja){const oa=this.parameters.shaderPolygonOffset;
ca!==ja&&g.copy(ja,ca);oa&&(ca=Y.aboveGround?1:-1,ja[2]-=(ca*Math.sign(W[3])||ca)*oa);return ja}createGLMaterial(ca){return new I(ca)}calculateRelativeScreenBounds(ca,W,Y=u.create()){var ja=this.parameters;Y[0]=ja.anchorPosition[0]*-ca[0]+ja.screenOffset[0]*W;Y[1]=ja.anchorPosition[1]*-ca[1]+ja.screenOffset[1]*W;Y[2]=Y[0]+ca[0];Y[3]=Y[1]+ca[1];return Y}_getScreenScale(ca){ca=ca.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE);if(null==ca)return{scaleX:1,scaleY:1};ca=n.fromArray(ca.data,ba);const [W,
Y]=w.evaluateModelTransformScale(R,this.parameters,ca);return{scaleX:W,scaleY:Y}}}class I extends r.GLTextureMaterial{constructor(ca){super({...ca,...ca.material.parameters})}selectProgram(ca){return this.ensureTechnique(C.HUDMaterialTechnique,ca)}beginSlot(ca){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.selectProgram(ca)}}const M=new F.ScaleInfo,S=e.create(),N=e.create(),V=n.create(),Q=e.create(),T=e.create(),ia=k.create(),
O=k.create(),U=d.create(),P=e.create(),R=e.create(),ba=n.create(),X={normal:Q,cosAngle:0},da=[0,0],ha=e.fromValues(0,0,1);class fa extends r.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.renderOccluded=y.RenderOccludedFlag.Occlude;this.isDecoration=!1;this.color=n.fromValues(1,1,1,1);this.texCoordScale=[1,1];this.polygonOffset=!1;this.anchorPosition=f.fromValues(.5,.5);this.screenOffset=[0,0];this.shaderPolygonOffset=1E-5;this.sampleSignedDistanceFieldTexelCenter=this.textureIsSignedDistanceField=
!1;this.outlineColor=n.fromValues(1,1,1,1);this.outlineSize=0;this.vvSizeEnabled=!1;this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.hasSlicePlane=!1;this.occlusionTest=this.pixelSnappingEnabled=!0;this.centerOffsetUnits="world";this.drawInSecondSlot=!1;this.depthEnabled=!0;this.draped=!1}}const aa=v.newLayout().vec3f(B.VertexAttribute.POSITION).vec3f(B.VertexAttribute.NORMAL).vec2f(B.VertexAttribute.UV0).vec4u8(B.VertexAttribute.COLOR).vec2f(B.VertexAttribute.SIZE).vec4f(B.VertexAttribute.CENTEROFFSETANDDISTANCE).vec4f(B.VertexAttribute.FEATUREATTRIBUTE),
Z=aa.clone().vec4u8(B.VertexAttribute.OBJECTANDLAYERIDCOLOR);class ea{constructor(ca){this._material=ca;this.vertexBufferLayout=b("enable-feature:objectAndLayerId-rendering")?Z:aa}elementCount(ca){return 6*ca.attributes.get(B.VertexAttribute.POSITION).indices.length}write(ca,W,Y,ja,oa){G.writePosition(Y.attributes.get(B.VertexAttribute.POSITION),ca,ja.position,oa,6);G.writeNormal(Y.attributes.get(B.VertexAttribute.NORMAL),W,ja.normal,oa,6);ca=Y.attributes.get(B.VertexAttribute.UV0).data;var ra;if(null==
ca||4>ca.length){ca=this._material.parameters;var ta=ra=0;var ya=ca.texCoordScale[0];var Ca=ca.texCoordScale[1]}else ra=ca[0],ta=ca[1],ya=ca[2],Ca=ca[3];ya=Math.min(1.99999,ya+1);Ca=Math.min(1.99999,Ca+1);ca=Y.attributes.get(B.VertexAttribute.POSITION).indices.length;W=oa;var pa=ja.uv0;for(let la=0;la<ca;++la)pa.set(W,0,ra),pa.set(W,1,ta),W++,pa.set(W,0,ya),pa.set(W,1,ta),W++,pa.set(W,0,ya),pa.set(W,1,Ca),W++,pa.set(W,0,ya),pa.set(W,1,Ca),W++,pa.set(W,0,ra),pa.set(W,1,Ca),W++,pa.set(W,0,ra),pa.set(W,
1,ta),W++;G.writeColor(Y.attributes.get(B.VertexAttribute.COLOR),4,ja.color,oa,6);const {data:wa,indices:Ba}=Y.attributes.get(B.VertexAttribute.SIZE);ca=Ba.length;ra=ja.size;W=oa;for(ta=0;ta<ca;++ta)for(ya=wa[2*Ba[ta]],Ca=wa[2*Ba[ta]+1],pa=0;6>pa;++pa)ra.set(W,0,ya),ra.set(W,1,Ca),W++;Y.attributes.get(B.VertexAttribute.CENTEROFFSETANDDISTANCE)?G.writeBufferVec4(Y.attributes.get(B.VertexAttribute.CENTEROFFSETANDDISTANCE),ja.centerOffsetAndDistance,oa,6):G.writeBufferVec4Zeros(ja.centerOffsetAndDistance,
oa,6*ca);Y.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE)?G.writeBufferVec4(Y.attributes.get(B.VertexAttribute.FEATUREATTRIBUTE),ja.featureAttribute,oa,6):G.writeBufferVec4Zeros(ja.featureAttribute,oa,6*ca);null!=Y.objectAndLayerIdColor&&(ca=Y.attributes.get(B.VertexAttribute.POSITION)?.indices)&&(ca=ca.length,ja=ja.getField(B.VertexAttribute.OBJECTANDLAYERIDCOLOR,x.BufferViewVec4u8),G.writeObjectAndLayerIdColor(Y.objectAndLayerIdColor,ja,ca,oa,6))}}a.HUDMaterial=K;a.Parameters=fa;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(c){return c instanceof Float32Array&&16<=c.length}function h(c){return Array.isArray(c)&&16<=c.length}a.isMat4=function(c){return b(c)||h(c)};a.isMat4f32=b;a.isMat4f64=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(O){return null!==O&&void 0!==O}function x(O){return"number"===typeof O}function w(O){return"string"===typeof O}function q(O,U){O&&O.push(U)}function v(O,U,P,R=d.create()){O=O||0;U=U||0;P=P||0;0!==O&&m.rotateZ(R,R,-O/180*Math.PI);0!==U&&m.rotateX(R,R,U/180*Math.PI);0!==P&&m.rotateY(R,R,P/180*Math.PI);return R}function p(O,U,P,R,ba){const X=O.minSize,da=O.maxSize;if(O.expression)return q(ba,"Could not convert size info: expression not supported"),!1;if(O.useSymbolValue)return O=
R.symbolSize[P],U.minSize[P]=O,U.maxSize[P]=O,U.offset[P]=U.minSize[P],U.factor[P]=0,U.type[P]=a.FastSizeType.DefinedSize,!0;if(u(O.field)){if(u(O.stops)){if(2===O.stops.length&&x(O.stops[0].size)&&x(O.stops[1].size))return t(O.stops[0].size,O.stops[1].size,O.stops[0].value,O.stops[1].value,U,P),U.type[P]=a.FastSizeType.DefinedSize,!0;q(ba,"Could not convert size info: stops only supported with 2 elements");return!1}if(x(X)&&x(da)&&u(O.minDataValue)&&u(O.maxDataValue))return t(X,da,O.minDataValue,
O.maxDataValue,U,P),U.type[P]=a.FastSizeType.DefinedSize,!0;if("unknown"===O.valueUnit)return q(ba,"Could not convert size info: proportional size not supported"),!1;if(null!=e.meterIn[O.valueUnit])return U.minSize[P]=-Infinity,U.maxSize[P]=Infinity,U.offset[P]=0,U.factor[P]=1/e.meterIn[O.valueUnit],U.type[P]=a.FastSizeType.DefinedSize,!0;q(ba,"Could not convert size info: scale-dependent size not supported");return!1}if(!u(O.field)){if(O.stops?.[0]&&x(O.stops[0].size))return U.minSize[P]=O.stops[0].size,
U.maxSize[P]=O.stops[0].size,U.offset[P]=U.minSize[P],U.factor[P]=0,U.type[P]=a.FastSizeType.DefinedSize,!0;if(x(X))return U.minSize[P]=X,U.maxSize[P]=X,U.offset[P]=X,U.factor[P]=0,U.type[P]=a.FastSizeType.DefinedSize,!0}q(ba,"Could not convert size info: unsupported variant of sizeInfo");return!1}function t(O,U,P,R,ba,X){R=0<Math.abs(R-P)?(U-O)/(R-P):0;ba.minSize[X]=0<R?O:U;ba.maxSize[X]=0<R?U:O;ba.offset[X]=O-P*R;ba.factor[X]=R}function r(O,U,P,R){if(O.normalizationField||O.valueRepresentation)return q(R,
"Could not convert size info: unsupported property"),null;var ba=O.field;if(null!=ba&&!w(ba))return q(R,"Could not convert size info: field is not a string"),null;if(!U.size)U.size=new z(O.field);else if(O.field)if(!U.size.field)U.size.field=O.field;else if(O.field!==U.size.field)return q(R,"Could not convert size info: multiple fields in use"),null;switch(O.axis){case "width":return(ba=p(O,U.size,0,P,R))?U:null;case "height":return(ba=p(O,U.size,2,P,R))?U:null;case "depth":return(ba=p(O,U.size,1,
P,R))?U:null;case "width-and-depth":return(ba=p(O,U.size,0,P,R))&&p(O,U.size,1,P,R),ba?U:null;case null:case void 0:case "all":return(ba=(ba=(ba=p(O,U.size,0,P,R))&&p(O,U.size,1,P,R))&&p(O,U.size,2,P,R))?U:null;default:return q(R,`Could not convert size info: unknown axis "${O.axis}""`),null}}function y(O,U,P){for(let R=0;3>R;++R){let ba=U.unitInMeters;O.type[R]===a.FastSizeType.DefinedSize&&(ba*=U.modelSize[R],O.type[R]=a.FastSizeType.DefinedScale);O.minSize[R]/=ba;O.maxSize[R]/=ba;O.offset[R]/=
ba;O.factor[R]/=ba}if(O.type[0]!==a.FastSizeType.Undefined)U=0;else if(O.type[1]!==a.FastSizeType.Undefined)U=1;else if(O.type[2]!==a.FastSizeType.Undefined)U=2;else return q(P,"No size axis contains a valid size or scale"),!1;for(P=0;3>P;++P)O.type[P]===a.FastSizeType.Undefined&&(O.minSize[P]=O.minSize[U],O.maxSize[P]=O.maxSize[U],O.offset[P]=O.offset[U],O.factor[P]=O.factor[U],O.type[P]=O.type[U]);return!0}function D(O,U,P){O[4*U]=P.r/255;O[4*U+1]=P.g/255;O[4*U+2]=P.b/255;O[4*U+3]=P.a}function E(O,
U,P){if(O.normalizationField)return q(P,"Could not convert color info: unsupported property"),null;if(w(O.field))if(O.stops){if(8<O.stops.length)return q(P,"Could not convert color info: too many color stops"),null;U.color=new J(O.field);O=O.stops;for(P=0;8>P;++P){const R=O[Math.min(P,O.length-1)];U.color.values[P]=R.value;D(U.color.colors,P,R.color)}}else return q(P,"Could not convert color info: missing stops or colors"),null;else if(O.stops&&0<=O.stops.length)for(O=O.stops&&0<=O.stops.length&&
O.stops[0].color,U.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},P=0;8>P;P++)U.color.values[P]=Infinity,D(U.color.colors,P,O);else return q(P,"Could not convert color info: no field and no colors/stops"),null;return U}function A(O,U,P){if(O.normalizationField)return q(P,"Could not convert opacity info: unsupported property"),null;if(w(O.field))if(O.stops){if(8<O.stops.length)return q(P,"Could not convert opacity info: too many opacity stops"),
null;U.opacity=new K(O.field);O=O.stops;for(P=0;8>P;++P){const R=O[Math.min(P,O.length-1)];U.opacity.values[P]=R.value;U.opacity.opacityValues[P]=R.opacity}}else return q(P,"Could not convert opacity info: missing stops or opacities"),null;else if(O.stops&&0<=O.stops.length)for(O=O.stops&&0<=O.stops.length?O.stops[0].opacity:0,U.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},P=0;8>P;P++)U.opacity.values[P]=Infinity,U.opacity.opacityValues[P]=O;else return q(P,"Could not convert opacity info: no field and no opacities/stops"),
null;return U}function B(O,U,P){O=2===P&&"arithmetic"===O.rotationType;U.offset[P]=O?90:0;U.factor[P]=O?-1:1;U.type[P]=1}function F(O,U,P){if(!w(O.field))return q(P,"Could not convert rotation info: field is not a string"),null;if(!U.rotation)U.rotation={field:O.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(O.field)if(!U.rotation.field)U.rotation.field=O.field;else if(O.field!==U.rotation.field)return q(P,"Could not convert rotation info: multiple fields in use"),null;switch(O.axis){case "tilt":return B(O,
U.rotation,0),U;case "roll":return B(O,U.rotation,1),U;case null:case void 0:case "heading":return B(O,U.rotation,2),U;default:return q(P,`Could not convert rotation info: unknown axis "${O.axis}""`),null}}function G(O,U,P){if(!O)return null;const R=O.reduce((ba,X)=>{if(!ba)return ba;if(X.valueExpression)return q(P,"Could not convert visual variables: arcade expressions not supported"),null;switch(X.type){case "size":return U.supports.size?r(X,ba,U,P):ba;case "color":return U.supports.color?E(X,ba,
P):ba;case "opacity":return U.supports.opacity?A(X,ba,P):null;case "rotation":return U.supports.rotation?F(X,ba,P):ba;default:return null}},new M);return 0<O.length&&R&&!R.size&&!R.color&&!R.opacity&&!R.rotation||R?.size&&!y(R.size,U,P)?null:R}function H(O,U,P){if(!!O!==!!U||O&&O.field!==U?.field)return!1;if(O&&"rotation"===P)for(P=0;3>P;P++)if(O.type[P]!==U.type[P]||O.offset[P]!==U.offset[P]||O.factor[P]!==U.factor[P])return!1;return!0}function L(O,U){O=new V(O);O.vvSize&&(O.vvSymbolAnchor=U.anchor,
m.identity(ia),v(U.rotation[2],U.rotation[0],U.rotation[1],ia),O.vvSymbolRotationMatrix=O.vvSymbolRotationMatrix||k.create(),c.fromMat4(O.vvSymbolRotationMatrix,ia));return O}a.FastSizeType=void 0;(function(O){O[O.Undefined=0]="Undefined";O[O.DefinedSize=1]="DefinedSize";O[O.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(O){O[O.Undefined=0]="Undefined";O[O.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));class C{constructor(O){this.field=
O}}class z extends C{constructor(O){super(O);this.minSize=[0,0,0];this.maxSize=[0,0,0];this.offset=[0,0,0];this.factor=[0,0,0];this.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]}}class J extends C{constructor(O){super(O);this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.values=[0,0,0,0,0,0,0,0]}}class K extends C{constructor(O){super(O);this.values=[0,0,0,0,0,0,0,0];this.opacityValues=[0,0,0,0,0,0,0,0]}}class I extends C{constructor(O){super(O);
this.offset=[0,0,0];this.factor=[1,1,1];this.type=[0,0,0]}}class M{}class S{constructor(O,U=[1,1,1],P=[1,1,1],R=1,ba=[0,0,0],X=[1,1,1],da=[0,0,0]){this.supports=O;this.modelSize=U;this.symbolSize=P;this.unitInMeters=R;this.anchor=ba;this.scale=X;this.rotation=da}}class N{constructor(O,U,P){this.visualVariables=O;this.materialParameters=U;this.requiresShaderTransformation=P}}class V extends l.NoParameters{constructor(O){super();this.vvSize=O?.size??null;this.vvColor=O?.color??null;this.vvOpacity=O?.opacity??
null}}const Q=d.create(),T=g.create(),ia=d.create();a.ConvertOptions=S;a.FastColorInfo=J;a.FastOpacityInfo=K;a.FastRotationInfo=I;a.FastSizeInfo=z;a.FastSymbolUpdatesState=N;a.FastVisualVariables=M;a.VisualVariablesParameters=V;a.convertVisualVariables=G;a.evaluateModelTransform=function(O,U,P){if(!O.vvSize)return P;m.copy(Q,P);P=O.vvSymbolRotationMatrix;m.set(ia,P[0],P[1],P[2],0,P[3],P[4],P[5],0,P[6],P[7],P[8],0,0,0,0,1);m.multiply(Q,Q,ia);for(P=0;3>P;++P)T[P]=h.clamp(O.vvSize.offset[P]+U[0]*O.vvSize.factor[P],
O.vvSize.minSize[P],O.vvSize.maxSize[P]);m.scale(Q,Q,T);m.translate(Q,Q,O.vvSymbolAnchor);return Q};a.evaluateModelTransformScale=function(O,U,P){if(!U.vvSize)return f.set(O,1,1,1),O;for(let R=0;3>R;++R)O[R]=h.clamp(U.vvSize.offset[R]+P[0]*U.vvSize.factor[R],U.vvSize.minSize[R],U.vvSize.maxSize[R]);return O};a.getAttributeValue=function(O,U){O=null==O?0:U.attributes[O];return"number"===typeof O&&isFinite(O)?O:0};a.getMaterialParameters=L;a.initFastSymbolUpdatesState=function(O,U){return!O||n.debugFlags.TESTS_DISABLE_FAST_UPDATES?
null:(O=G(O.visualVariables,U))?new N(O,L(O,U),!!O.size):null};a.updateFastSymbolUpdatesState=function(O,U,P){if(!U||!O)return!1;const R=O.visualVariables;U=G(U.visualVariables,P);if(!(U&&H(R.size,U.size,"size")&&H(R.color,U.color,"color")&&H(R.rotation,U.rotation,"rotation")&&H(R.opacity,U.opacity,"opacity")))return!1;O.visualVariables=U;O.materialParameters=L(U,P);O.requiresShaderTransformation=!!U.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f){a.HUD=function(g,e){g.include(h.ScreenSizePerspective);g.attributes.add(f.VertexAttribute.POSITION,"vec3");g.attributes.add(f.VertexAttribute.NORMAL,"vec3");g.attributes.add(f.VertexAttribute.CENTEROFFSETANDDISTANCE,"vec4");g=g.vertex;c.addProjViewLocalOrigin(g,e);c.addCameraPosition(g,e);g.uniforms.add(new k.Float4PassUniform("viewport",(n,l)=>l.camera.fullViewport),new m.FloatPassUniform("polygonOffset",n=>n.shaderPolygonOffset),new m.FloatPassUniform("cameraGroundRelative",
(n,l)=>l.camera.aboveGround?1:-1));e.hasVerticalOffset&&b.addVerticalOffset(g);g.constants.add("smallOffsetAngle","float",.984807753012208);g.code.add(d.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);g.code.add(d.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?d.glsl.float(0):d.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);e.draped&&!e.hasVerticalOffset||c.addViewNormal(g);e.draped||(g.uniforms.add(new m.FloatPassUniform("perDistancePixelRatio",(n,l)=>Math.tan(l.camera.fovY/2)/(l.camera.fullViewport[2]/2))),g.code.add(d.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${d.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `));e.screenCenterOffsetUnitsEnabled&&c.addPixelRatio(g);e.hasScreenSizePerspective&&h.addScreenSizePerspectiveAlignment(g);g.code.add(d.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective?e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled?"vec3 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${e.hasVerticalOffset?d.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":d.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)};a.HUDVerticalPixelOffset=.5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,h,c,k,m,d){function f(e){e.uniforms.add(new m.Float4PassUniform("verticalOffset",
(n,l)=>{const {minWorldLength:u,maxWorldLength:x,screenLength:w}=n.verticalOffset;return b.set(g,w*(l.camera.pixelRatio||1),Math.tan(.5*l.camera.fovY)/(.5*l.camera.fullViewport[3]),u,x)}))}const g=h.create();a.VerticalOffset=function(e,n){const l=e.vertex;n.hasVerticalOffset?(f(l),n.hasScreenSizePerspective&&(e.include(c.ScreenSizePerspective),c.addScreenSizePerspectiveAlignment(l),k.addCameraPosition(e.vertex,n)),l.code.add(d.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${n.spherical?d.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:d.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${n.hasScreenSizePerspective?d.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:d.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):l.code.add(d.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,h,c,k){function m(f){return b.set(d,
f.parameters.divisor,f.parameters.offset,f.minScaleFactor)}const d=h.create();a.ScreenSizePerspective=function(f){f.vertex.code.add(k.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);f.vertex.code.add(k.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`);f.vertex.code.add(k.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);f.vertex.code.add(k.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);f.vertex.code.add(k.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);f.vertex.code.add(k.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(f){f.uniforms.add(new c.Float3PassUniform("screenSizePerspective",g=>m(g.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(f){f.uniforms.add(new c.Float3PassUniform("screenSizePerspectiveAlignment",g=>m(g.screenSizePerspectiveAlignment||g.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./basicInterfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends m.ContentObject{constructor(u,x){super();this.type=d.ContentObjectType.Material;this.supportsEdges=!1;this._visible=!0;this._renderPriority=0;this._vertexAttributeLocations=f.Default3D;this._pp0=b.fromValues(0,0,1);this._pp1=b.fromValues(0,0,0);this._parameters=g.copyParameters(u,x);this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(u){return!1}setParameters(u,x=!0){g.updateParameters(this._parameters,u)&&(this.validateParameters(this._parameters),
x&&this.parametersChanged())}validateParameters(u){}get visible(){return this._visible}set visible(u){u!==this._visible&&(this._visible=u,this.parametersChanged())}shouldRender(u){return this.isVisible()&&this.isVisibleForOutput(u.output)&&(!this.parameters.isDecoration||u.bindParameters.decorations===k.Decorations.ON)&&0!==(this.parameters.renderOccluded&u.renderOccludedMask)}isVisibleForOutput(u){return!0}get renderPriority(){return this._renderPriority}set renderPriority(u){u!==this._renderPriority&&
(this._renderPriority=u,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(u){return this.isVisible()&&this.parameters.renderOccluded===u}intersectDraped(u,x,w,q,v,p){this._pp0[0]=this._pp1[0]=q[0];this._pp0[1]=this._pp1[1]=q[1];return this.intersect(u,x,w,this._pp0,this._pp1,v)}}class n extends c.Parameters{constructor(u,x,w){super(x,w);
this.camera=u}}a.RenderOccludedFlag=void 0;(function(u){u[u.None=0]="None";u[u.Occlude=1]="Occlude";u[u.Transparent=2]="Transparent";u[u.OccludeAndTransparent=4]="OccludeAndTransparent";u[u.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";u[u.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));class l extends h.NoParameters{constructor(){super(...arguments);this.renderOccluded=a.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.Material=e;a.MaterialParameters=l;a.UpdateParameters=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),function(a,b,h,c,k,m,d,f,g,e){function n(A,
B,F,G,H,L){if(null!=A){var C=x(B,F,r);m.setMin(t,A.bbMin);m.setMax(t,A.bbMax);null!=H&&H.applyToAabb(t);if(w(t,B,C,G)){const {primitiveIndices:z,position:J}=A;C=z?z.length:J.indices.length/3;if(1E3<C&&(A=A.getChildren(),void 0!==A)){for(const K of A)n(K,B,F,G,H,L);return}l(B,F,0,C,J.indices,J,z,H,L)}}}function l(A,B,F,G,H,L,C,z,J){if(C){const {data:aa,stride:Z}=L;L=A[0];var K=A[1];A=A[2];var I=B[0]-L,M=B[1]-K;for(B=B[2]-A;F<G;++F){var S=C[F],N=3*S,V=Z*H[N++],Q=aa[V++],T=aa[V++],ia=aa[V];V=Z*H[N++];
var O=aa[V++],U=aa[V++],P=aa[V];V=Z*H[N];N=aa[V++];var R=aa[V++];V=aa[V];null!=z&&([Q,T,ia]=z.applyToVertex(Q,T,ia,F),[O,U,P]=z.applyToVertex(O,U,P,F),[N,R,V]=z.applyToVertex(N,R,V,F));O-=Q;U-=T;P-=ia;N-=Q;R-=T;V-=ia;var ba=M*V-R*B,X=B*N-V*I;const ea=I*R-N*M;var da=O*ba+U*X+P*ea;if(!(Math.abs(da)<=Number.EPSILON)){Q=L-Q;T=K-T;ia=A-ia;ba=Q*ba+T*X+ia*ea;if(0<da){if(0>ba||ba>da)continue}else if(0<ba||ba<da)continue;X=T*P-U*ia;ia=ia*O-P*Q;T=Q*U-O*T;Q=I*X+M*ia+B*T;if(0<da){if(0>Q||ba+Q>da)continue}else if(0<
Q||ba+Q<da)continue;ia=(N*X+R*ia+V*T)/da;0<=ia&&(O=u(O,U,P,N,R,V,y),J(ia,O,S,!1))}}}else{var {data:ha,stride:fa}=L;C=A[0];L=A[1];K=A[2];A=B[0]-C;I=B[1]-L;M=B[2]-K;for(let aa=F,Z=3*F;aa<G;++aa)if(N=fa*H[Z++],T=ha[N++],ia=ha[N++],P=ha[N],N=fa*H[Z++],B=ha[N++],F=ha[N++],S=ha[N],N=fa*H[Z++],O=ha[N++],U=ha[N++],N=ha[N],null!=z&&([T,ia,P]=z.applyToVertex(T,ia,P,aa),[B,F,S]=z.applyToVertex(B,F,S,aa),[O,U,N]=z.applyToVertex(O,U,N,aa)),B-=T,F-=ia,S-=P,O-=T,U-=ia,N-=P,V=I*N-U*M,Q=M*O-N*A,da=A*U-O*I,R=B*V+F*
Q+S*da,!(Math.abs(R)<=Number.EPSILON)){T=C-T;ia=L-ia;P=K-P;V=T*V+ia*Q+P*da;if(0<R){if(0>V||V>R)continue}else if(0<V||V<R)continue;Q=ia*S-F*P;P=P*B-S*T;ia=T*F-B*ia;T=A*Q+I*P+M*ia;if(0<R){if(0>T||V+T>R)continue}else if(0<T||V+T<R)continue;P=(O*Q+U*P+N*ia)/R;0<=P&&(B=u(B,F,S,O,U,N,y),J(P,B,aa,!1))}}}function u(A,B,F,G,H,L,C){c.set(D,A,B,F);c.set(E,G,H,L);c.cross(C,D,E);c.normalize(C,C);return C}function x(A,B,F){return c.set(F,1/(B[0]-A[0]),1/(B[1]-A[1]),1/(B[2]-A[2]))}function w(A,B,F,G){return q(A,
B,F,G,Infinity)}function q(A,B,F,G,H){var L=(A[0]-G-B[0])*F[0],C=(A[3]+G-B[0])*F[0];let z=Math.min(L,C);L=Math.max(L,C);C=(A[1]-G-B[1])*F[1];const J=(A[4]+G-B[1])*F[1];L=Math.min(L,Math.max(C,J));if(0>L)return!1;z=Math.max(z,Math.min(C,J));if(z>L)return!1;C=(A[2]-G-B[2])*F[2];A=(A[5]+G-B[2])*F[2];L=Math.min(L,Math.max(C,A));if(0>L)return!1;z=Math.max(z,Math.min(C,A));return z>L?!1:z<H}function v(A,B){B=B?v(B):{};for(const F in A){let G=A[F];G?.forEach&&(G=p(G));null==G&&F in B||(B[F]=G)}return B}
function p(A){const B=[];A.forEach(F=>B.push(F));return B}const t=m.create(),r=k.create(),y=k.create(),D=k.create(),E=k.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=x;a.computeNormal=u;a.copyParameters=v;a.intersectAabbInvDir=w;a.intersectAabbInvDirBefore=q;a.intersectTriangleGeometry=function(A,B,F,G,H,L){A.visible&&(A.boundingInfo?(g.assert(A.type===d.ContentObjectType.Mesh),n(A.boundingInfo,F,G,B.tolerance,H,L)):(A=A.attributes.get(e.VertexAttribute.POSITION),
B=A.indices,l(F,G,0,B.length/3,B,A,void 0,H,L)))};a.intersectTriangles=l;a.updateParameters=function(A,B){let F=!1;for(const G in B){const H=B[G];void 0!==H&&(Array.isArray(H)?null===A[G]?(A[G]=H.slice(),F=!0):b.update(A[G],H)&&(F=!0):A[G]!==H&&(F=!0,A[G]=H))}return F};a.verticalOffsetAtDistance=function(A,B,F,G,H){let L=(F.screenLength||0)*A.pixelRatio;null!=H&&(L=f.scale(L,G,B,H));return h.clamp(L*Math.tan(.5*A.fovY)/(.5*A.fullHeight)*B,F.minWorldLength||0,null!=F.maxWorldLength?F.maxWorldLength:
Infinity)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(a){class b{constructor(){this.factor=new h;this.factorAlignment=new h}}class h{constructor(){this.minScaleFactor=this.factor=this.scale=0}}a.ScaleFactor=h;a.ScaleInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4",
"../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,h,c,k){function m(q,v,p){const {data:t,indices:r}=q;q=v.typedBuffer;v=v.typedBufferStride;const y=r.length;p*=v;for(let D=0;D<y;++D){const E=2*r[D];q[p]=t[E];q[p+1]=t[E+1];p+=v}}function d(q,v,p,t){const {data:r,indices:y}=q;q=v.typedBuffer;v=v.typedBufferStride;const D=y.length;p*=v;if(null==t||1===t)for(t=0;t<D;++t){var E=3*y[t];q[p]=r[E];q[p+1]=r[E+1];q[p+2]=r[E+2];p+=v}else for(E=0;E<
D;++E){const A=3*y[E];for(let B=0;B<t;++B)q[p]=r[A],q[p+1]=r[A+1],q[p+2]=r[A+2],p+=v}}function f(q,v,p,t=1){const {data:r,indices:y}=q;q=v.typedBuffer;v=v.typedBufferStride;const D=y.length;p*=v;if(1===t)for(t=0;t<D;++t){var E=4*y[t];q[p]=r[E];q[p+1]=r[E+1];q[p+2]=r[E+2];q[p+3]=r[E+3];p+=v}else for(E=0;E<D;++E){const A=4*y[E];for(let B=0;B<t;++B)q[p]=r[A],q[p+1]=r[A+1],q[p+2]=r[A+2],q[p+3]=r[A+3],p+=v}}function g(q,v,p,t,r=1){if(v){var {data:y,indices:D}=q;q=p.typedBuffer;p=p.typedBufferStride;var E=
D.length,A=v[0],B=v[1],F=v[2],G=v[4],H=v[5],L=v[6],C=v[8],z=v[9],J=v[10],K=v[12],I=v[13],M=v[14];t*=p;var S=0,N=0,V=0;v=b.hasIdentityRotation(v)?Q=>{S=y[Q]+K;N=y[Q+1]+I;V=y[Q+2]+M}:Q=>{const T=y[Q],ia=y[Q+1];Q=y[Q+2];S=A*T+G*ia+C*Q+K;N=B*T+H*ia+z*Q+I;V=F*T+L*ia+J*Q+M};if(1===r)for(r=0;r<E;++r)v(3*D[r]),q[t]=S,q[t+1]=N,q[t+2]=V,t+=p;else for(let Q=0;Q<E;++Q){v(3*D[Q]);for(let T=0;T<r;++T)q[t]=S,q[t+1]=N,q[t+2]=V,t+=p}}else d(q,p,t,r)}function e(q,v,p,t,r=1){if(v){var {data:y,indices:D}=q;q=p.typedBuffer;
p=p.typedBufferStride;var E=D.length,A=v[0],B=v[1],F=v[2],G=v[4],H=v[5],L=v[6],C=v[8],z=v[9],J=v[10],K=!b.isOrthoNormal(v);t*=p;var I=0,M=0,S=0;v=b.hasIdentityRotation(v)?V=>{I=y[V];M=y[V+1];S=y[V+2]}:V=>{const Q=y[V],T=y[V+1];V=y[V+2];I=A*Q+G*T+C*V;M=B*Q+H*T+z*V;S=F*Q+L*T+J*V};if(1===r)if(K)for(r=0;r<E;++r)v(3*D[r]),K=I*I+M*M+S*S,.999999>K&&1E-6<K?(K=1/Math.sqrt(K),q[t]=I*K,q[t+1]=M*K,q[t+2]=S*K):(q[t]=I,q[t+1]=M,q[t+2]=S),t+=p;else for(r=0;r<E;++r)v(3*D[r]),q[t]=I,q[t+1]=M,q[t+2]=S,t+=p;else for(let V=
0;V<E;++V){v(3*D[V]);if(K){var N=I*I+M*M+S*S;.999999>N&&1E-6<N&&(N=1/Math.sqrt(N),I*=N,M*=N,S*=N)}for(N=0;N<r;++N)q[t]=I,q[t+1]=M,q[t+2]=S,t+=p}}else d(q,p,t,r)}function n(q,v,p,t,r=1){if(v){var {data:y,indices:D}=q;q=p.typedBuffer;p=p.typedBufferStride;var E=D.length,A=v[0],B=v[1],F=v[2],G=v[4],H=v[5],L=v[6],C=v[8],z=v[9],J=v[10];v=!b.isOrthoNormal(v);t*=p;if(1===r)for(r=0;r<E;++r){var K=4*D[r],I=y[K],M=y[K+1],S=y[K+2];K=y[K+3];var N=A*I+G*M+C*S,V=B*I+H*M+z*S;I=F*I+L*M+J*S;v&&(M=N*N+V*V+I*I,.999999>
M&&1E-6<M&&(M=1/Math.sqrt(M),N*=M,V*=M,I*=M));q[t]=N;q[t+1]=V;q[t+2]=I;q[t+3]=K;t+=p}else for(K=0;K<E;++K){N=4*D[K];M=y[N];S=y[N+1];const Q=y[N+2];N=y[N+3];V=A*M+G*S+C*Q;I=B*M+H*S+z*Q;M=F*M+L*S+J*Q;v&&(S=V*V+I*I+M*M,.999999>S&&1E-6<S&&(S=1/Math.sqrt(S),V*=S,I*=S,M*=S));for(S=0;S<r;++S)q[t]=V,q[t+1]=I,q[t+2]=M,q[t+3]=N,t+=p}}else f(q,p,t,r)}function l(q,v,p,t,r=1){const {data:y,indices:D}=q;var E=p.typedBuffer,A=p.typedBufferStride;q=D.length;t*=A;if(v===y.length&&4===v)for(E[t]=y[0],E[t+1]=y[1],E[t+
2]=y[2],E[t+3]=y[3],E=new Uint32Array(p.typedBuffer.buffer,p.start),A/=4,t/=4,v=E[t],t+=A,q*=r,r=1;r<q;++r)E[t]=v,t+=A;else if(1===r)if(4===v)for(r=0;r<q;++r)v=4*D[r],E[t]=y[v],E[t+1]=y[v+1],E[t+2]=y[v+2],E[t+3]=y[v+3],t+=A;else for(r=0;r<q;++r)v=3*D[r],E[t]=y[v],E[t+1]=y[v+1],E[t+2]=y[v+2],E[t+3]=255,t+=A;else if(4===v)for(v=0;v<q;++v){p=4*D[v];for(var B=0;B<r;++B)E[t]=y[p],E[t+1]=y[p+1],E[t+2]=y[p+2],E[t+3]=y[p+3],t+=A}else for(v=0;v<q;++v)for(p=3*D[v],B=0;B<r;++B)E[t]=y[p],E[t+1]=y[p+1],E[t+2]=
y[p+2],E[t+3]=255,t+=A}function u(q,v,p){const {data:t,indices:r}=q;q=v.typedBuffer;v=v.typedBufferStride;const y=r.length,D=t[0];p*=v;for(let E=0;E<y;++E)q[p]=D,p+=v}function x(q,v,p,t,r=1){const y=v.typedBuffer;v=v.typedBufferStride;t*=v;if(1===r)for(r=0;r<p;++r)y[t]=q[0],y[t+1]=q[1],y[t+2]=q[2],y[t+3]=q[3],t+=v;else for(let D=0;D<p;++D)for(let E=0;E<r;++E)y[t]=q[0],y[t+1]=q[1],y[t+2]=q[2],y[t+3]=q[3],t+=v}function w(q,v,p,t,r,y){switch(q){case k.VertexAttribute.POSITION:c.assert(3===v.size);t=
r.getField(q,h.BufferViewVec3f);c.assert(!!t,`No buffer view for ${q}`);t&&g(v,p,t,y);break;case k.VertexAttribute.NORMAL:c.assert(3===v.size);p=r.getField(q,h.BufferViewVec3f);c.assert(!!p,`No buffer view for ${q}`);p&&e(v,t,p,y);break;case k.VertexAttribute.NORMALCOMPRESSED:c.assert(2===v.size);t=r.getField(q,h.BufferViewVec2i16);c.assert(!!t,`No buffer view for ${q}`);t&&m(v,t,y);break;case k.VertexAttribute.UV0:c.assert(2===v.size);t=r.getField(q,h.BufferViewVec2f);c.assert(!!t,`No buffer view for ${q}`);
t&&m(v,t,y);break;case k.VertexAttribute.COLOR:case k.VertexAttribute.SYMBOLCOLOR:t=r.getField(q,h.BufferViewVec4u8);c.assert(!!t,`No buffer view for ${q}`);c.assert(3===v.size||4===v.size);!t||3!==v.size&&4!==v.size||l(v,v.size,t,y);break;case k.VertexAttribute.COLORFEATUREATTRIBUTE:t=r.getField(q,h.BufferViewFloat);c.assert(!!t,`No buffer view for ${q}`);c.assert(1===v.size);t&&1===v.size&&u(v,t,y);break;case k.VertexAttribute.TANGENT:c.assert(4===v.size);p=r.getField(q,h.BufferViewVec4f);c.assert(!!p,
`No buffer view for ${q}`);p&&n(v,t,p,y);break;case k.VertexAttribute.PROFILERIGHT:case k.VertexAttribute.PROFILEUP:case k.VertexAttribute.PROFILEVERTEXANDNORMAL:case k.VertexAttribute.FEATUREVALUE:c.assert(4===v.size),t=r.getField(q,h.BufferViewVec4f),c.assert(!!t,`No buffer view for ${q}`),t&&f(v,t,y)}}a.writeBufferFloat=function(q,v,p,t=1){const {data:r,indices:y}=q;q=v.typedBuffer;v=v.typedBufferStride;const D=y.length;p*=v;if(1===t)for(t=0;t<D;++t)q[p]=r[y[t]],p+=v;else for(let E=0;E<D;++E){const A=
r[y[E]];for(let B=0;B<t;B++)q[p]=A,p+=v}};a.writeBufferMat3f=function(q,v,p){const {data:t,indices:r}=q;q=v.typedBuffer;v=v.typedBufferStride;const y=r.length;p*=v;for(let D=0;D<y;++D){const E=9*r[D];for(let A=0;9>A;++A)q[p+A]=t[E+A];p+=v}};a.writeBufferMat4f=function(q,v,p){const {data:t,indices:r}=q;q=v.typedBuffer;v=v.typedBufferStride;const y=r.length;p*=v;for(let D=0;D<y;++D){const E=16*r[D];for(let A=0;16>A;++A)q[p+A]=t[E+A];p+=v}};a.writeBufferVec2=m;a.writeBufferVec3=d;a.writeBufferVec4=f;
a.writeBufferVec4Zeros=function(q,v,p){const t=q.typedBuffer;q=q.typedBufferStride;v*=q;for(let r=0;r<p;++r)t[v]=0,t[v+1]=0,t[v+2]=0,t[v+3]=0,v+=q};a.writeColor=l;a.writeColorFeatureAttribute=u;a.writeDefaultAttribute=w;a.writeDefaultAttributes=function(q,v,p,t,r,y){for(const E of v.fields.keys()){v=q.attributes.get(E);var D=v?.indices;v&&D?w(E,v,p,t,r,y):E===k.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=q.objectAndLayerIdColor&&(v=q.attributes.get(k.VertexAttribute.POSITION)?.indices)&&(v=v.length,
D=r.getField(E,h.BufferViewVec4u8),x(q.objectAndLayerIdColor,D,v,y))}};a.writeNormal=e;a.writeObjectAndLayerIdColor=x;a.writePosition=g;a.writeTangent=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F){function G(C){const z=new E.ShaderBuilder;var J=C.signedDistanceFieldEnabled;z.include(g.HUD,C);z.include(m.SliceDraw,C);if(C.occlusionPass)return z.include(e.HUDOcclusionPass,C),z;const {vertex:K,fragment:I}=z;z.include(v.ScreenSizePerspective);I.include(q.RgbaFloatEncoding);I.include(w.ColorConversion);z.include(u.VisualVariables,C);z.include(d.ObjectAndLayerIdColor,C);z.include(n.HUDVisibility);z.varyings.add("vcolor","vec4");z.varyings.add("vtc",
"vec2");z.varyings.add("vsize","vec2");z.varyings.add("voccluded","float");K.uniforms.add(new r.Float4PassUniform("viewport",(N,V)=>V.camera.fullViewport),new t.Float2PassUniform("screenOffset",(N,V)=>b.set(L,2*N.screenOffset[0]*V.camera.pixelRatio,2*N.screenOffset[1]*V.camera.pixelRatio)),new t.Float2PassUniform("anchorPosition",N=>H(N)),new r.Float4PassUniform("materialColor",N=>N.color));p.addPixelRatio(K);J&&(K.uniforms.add(new r.Float4PassUniform("outlineColor",N=>N.outlineColor)),I.uniforms.add(new r.Float4PassUniform("outlineColor",
N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineColor:c.ZEROS),new y.FloatPassUniform("outlineSize",N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineSize:0)));C.pixelSnappingEnabled&&K.include(f.AlignPixel);C.hasScreenSizePerspective&&(v.addScreenSizePerspective(K),v.addScreenSizePerspectiveAlignment(K));C.debugDrawLabelBorder&&z.varyings.add("debugBorderCoords","vec4");z.attributes.add(F.VertexAttribute.UV0,"vec2");z.attributes.add(F.VertexAttribute.COLOR,"vec4");z.attributes.add(F.VertexAttribute.SIZE,
"vec2");z.attributes.add(F.VertexAttribute.FEATUREATTRIBUTE,"vec4");K.code.add(D.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${C.hasScreenSizePerspective?D.glsl`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:D.glsl`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${C.vvSize?"inputSize *\x3d vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);var M=D.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const S=C.pixelSnappingEnabled?J?D.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:D.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:D.glsl`posProj += quadOffset;`;K.code.add(D.glsl`
    ${C.occlusionTestEnabled?"if (visible) {":""}
    ${M}
    ${C.vvColor?"vcolor \x3d interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${C.output===k.ShaderOutput.ObjectAndLayerIdColor?D.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${D.glsl.float(x.symbolAlphaCutoff)};
    ${J?`alphaDiscard = alphaDiscard && outlineColor.a < ${D.glsl.float(x.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${S}
      gl_Position = posProj;
    }

    vtc = uv;

    ${C.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${C.occlusionTestEnabled?D.glsl`} else { vtc = vec2(0.0);
      ${C.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);I.uniforms.add(new A.Texture2DPassUniform("tex",N=>N.texture));M=C.debugDrawLabelBorder?D.glsl`(isBorder > 0.0 ? 0.0 : ${D.glsl.float(x.defaultMaskAlphaCutoff)})`:D.glsl.float(x.defaultMaskAlphaCutoff);J=D.glsl`
    ${C.debugDrawLabelBorder?D.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${C.sampleSignedDistanceFieldTexelCenter?D.glsl`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:D.glsl`
      vec2 samplePos = vtc;
      `}

    ${J?D.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${D.glsl.float(x.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:D.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${C.debugDrawLabelBorder?D.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(C.output){case k.ShaderOutput.Color:I.code.add(D.glsl`
        void main() {
          ${J}
          ${C.transparencyPassType===B.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
        }`);break;case k.ShaderOutput.Alpha:I.code.add(D.glsl`
        void main() {
          ${J}
          fragColor = vec4(fragColor.a);
        }`);break;case k.ShaderOutput.ObjectAndLayerIdColor:I.code.add(D.glsl`
        void main() {
          ${J}
          outputObjectAndLayerIdColor();
        }`);break;case k.ShaderOutput.Highlight:I.constants.add("occludedHighlightFlag","vec4",l.occludedHighlightFlag),I.constants.add("unoccludedHighlightFlag","vec4",l.unoccludedHighlightFlag),I.code.add(D.glsl`
        void main() {
          ${J}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return z}function H(C,z=L){if(C.textureIsSignedDistanceField){var J=C.anchorPosition;C=C.distanceFieldBoundingBox;null!=C?b.set(z,J[0]*(C[2]-C[0])+C[0],J[1]*(C[3]-C[1])+C[1]):b.set(z,0,0)}else b.copy(z,C.anchorPosition);return z}const L=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:G,calculateAnchorPosForRendering:H},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=h;a.build=G;a.calculateAnchorPosForRendering=H})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,h,c,k,m,d,f){function g(r,y,...D){if(y.hasSlicePlane){y.hasSliceInVertexProgram&&r.vertex.uniforms.add(...D);r.fragment.uniforms.add(...D);D=f.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var E=f.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;E=y.hasSliceHighlight?f.glsl`
        ${E}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:f.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;y.hasSliceInVertexProgram&&r.vertex.code.add(D);r.fragment.code.add(D);r.fragment.code.add(E)}else D=f.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.hasSliceInVertexProgram&&r.vertex.code.add(D),r.fragment.code.add(D)}function e(r,y,D){return r.instancedDoublePrecision?c.set(q,D.camera.viewInverseTransposeMatrix[3],D.camera.viewInverseTransposeMatrix[7],D.camera.viewInverseTransposeMatrix[11]):y.slicePlaneLocalOrigin}function n(r,y){return null!=r?c.subtract(v,y.origin,r):y.origin}function l(r,y,D){return r.hasSliceTranslatedView?null!=y?b.translate(t,D.camera.viewMatrix,y):D.camera.viewMatrix:
null}function u(r,y,D){if(null==D.slicePlane)return k.ZEROS;const E=e(r,y,D);y=n(E,D.slicePlane);r=l(r,E,D);return null!=r?c.transformMat4(v,y,r):y}function x(r,y,D,E){if(null==E||null==D.slicePlane)return k.ZEROS;const A=e(r,y,D);y=n(A,D.slicePlane);r=l(r,A,D);return null!=r?(c.add(p,E,y),c.transformMat4(v,y,r),c.transformMat4(p,p,r),c.subtract(p,p,v)):E}class w extends f.NoParameters{constructor(r){super();this.slicePlaneLocalOrigin=r}}const q=k.create(),v=k.create(),p=k.create(),t=h.create();a.SliceDraw=
function(r,y){g(r,y,new m.Float3DrawUniform("slicePlaneOrigin",(D,E)=>u(y,D,E)),new m.Float3DrawUniform("slicePlaneBasis1",(D,E)=>x(y,D,E,E.slicePlane?.basis1)),new m.Float3DrawUniform("slicePlaneBasis2",(D,E)=>x(y,D,E,E.slicePlane?.basis2)))};a.SlicePass=function(r,y){g(r,y,new d.Float3PassUniform("slicePlaneOrigin",(D,E)=>u(y,D,E)),new d.Float3PassUniform("slicePlaneBasis1",(D,E)=>x(y,D,E,E.slicePlane?.basis1)),new d.Float3PassUniform("slicePlaneBasis2",(D,E)=>x(y,D,E,E.slicePlane?.basis2)))};a.SlicePlaneParameters=
w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,h,c){a.ObjectAndLayerIdColor=function(k,m){const d=m.output===b.ShaderOutput.ObjectAndLayerIdColor;m=m.objectAndLayerIdColorInstanced;d&&(k.varyings.add("objectAndLayerIdColorVarying","vec4"),m?k.attributes.add(c.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
"vec4"):k.attributes.add(c.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));k.vertex.code.add(h.glsl`
     void forwardObjectAndLayerIdColor() {
      ${d?m?h.glsl`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:h.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:h.glsl``} }`);k.fragment.code.add(h.glsl`
      void outputObjectAndLayerIdColor() {
        ${d?h.glsl`fragColor = objectAndLayerIdColorVarying;`:h.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(a,b,h){a.AlignPixel=function(c){c.uniforms.add(new b.BooleanPassUniform("alignPixelEnabled",(k,m)=>m.alignPixelEnabled));c.code.add(h.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);c.code.add(h.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/MultipassGeometryTest.glsl","../shading/MultipassTerrainTest.glsl","../../shaderModules/interfaces"],function(a,b,h,c,k){a.HUDOcclusionPass=function(m,d){const {vertex:f,fragment:g}=m;f.include(b.AlignPixel);d.multipassEnabled&&(f.include(h.multipassGeometryTest),m.varyings.add("depth","float"));
f.code.add(k.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${d.multipassEnabled?k.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${d.multipassEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);m.include(c.multipassTerrainTest,d);g.code.add(k.glsl`
  void main() {
    fragColor = vec4(1);
    ${d.multipassEnabled?k.glsl`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define("exports ./AlignPixel.glsl ./HUDRenderStyle ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d){a.HUDVisibility=function(f){f.vertex.uniforms.add(new k.FloatPassUniform("renderTransparentlyOccludedHUD",(g,e)=>e.hudRenderStyle===
h.HUDRenderStyle.Occluded?1:e.hudRenderStyle===h.HUDRenderStyle.NotOccluded?0:.75),new c.Float4PassUniform("viewport",(g,e)=>e.camera.fullViewport),new d.Texture2DPassUniform("hudVisibilityTexture",(g,e)=>e.hudVisibility?.getTexture()));f.vertex.include(b.AlignPixel);f.vertex.code.add(m.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,h,c){const k=b.fromValues(1,1,0,1),m=b.fromValues(1,0,1,1);a.OutputHighlight=function(d){d.fragment.uniforms.add(new c.Texture2DPassUniform("depthTexture",(f,g)=>g.mainDepth));d.fragment.constants.add("occludedHighlightFlag",
"vec4",k).add("unoccludedHighlightFlag","vec4",m);d.fragment.code.add(h.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};a.occludedHighlightFlag=k;a.unoccludedHighlightFlag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,h,c,k,m,d,f){a.VisualVariables=function(g,e){const {vertex:n,attributes:l}=g;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&l.add(d.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");e.vvSize?(n.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",u=>u.vvSize.minSize)),n.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",u=>u.vvSize.maxSize)),n.uniforms.add(new b.Float3PassUniform("vvSizeOffset",u=>u.vvSize.offset)),n.uniforms.add(new b.Float3PassUniform("vvSizeFactor",u=>u.vvSize.factor)),
n.uniforms.add(new m.Matrix3PassUniform("vvSymbolRotationMatrix",u=>u.vvSymbolRotationMatrix)),n.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",u=>u.vvSymbolAnchor)),n.code.add(k.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),n.code.add(k.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?k.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):n.code.add(k.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);e.vvColor?(n.constants.add("vvColorNumber","int",f.vvColorNumber),n.uniforms.add(new c.FloatsPassUniform("vvColorValues",u=>u.vvColor.values,f.vvColorNumber),new h.Float4sPassUniform("vvColorColors",u=>u.vvColor.colors,f.vvColorNumber)),n.code.add(k.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?k.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):n.code.add(k.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m,d){super(k,"vec4",h.BindType.Pass,(f,g,e)=>f.setUniform4fv(k,m(g,e)),d)}}a.Float4sPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m,d){super(k,"float",h.BindType.Pass,(f,g,e)=>f.setUniform1fv(k,m(g,e)),d)}}a.FloatsPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,h){class c extends b.VisualVariablesParameters{constructor(){super(...arguments);
this.renderOccluded=h.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.VisualVariablePassParameters=c;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x extends m.ShaderTechnique{initializeConfiguration(v,p){p.spherical=v.viewingMode===h.ViewingMode.Global}initializeProgram(v){return new g.Program(v.rctx,x.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){const v=this.configuration.transparencyPassType,p=this.configuration,t=v===e.TransparencyPassType.NONE;var r=v===e.TransparencyPassType.FrontFace;const y=this.configuration.hasPolygonOffset?w:null;r=p.draped?null:(t||r)&&p.output!==
c.ShaderOutput.Highlight?p.depthEnabled||p.occlusionPass?u.defaultDepthWriteParams:null:null;return u.makePipelineState({blending:p.output===c.ShaderOutput.Color||p.output===c.ShaderOutput.Alpha||p.output===c.ShaderOutput.Highlight?t?q:f.oitBlending(v):null,depthTest:p.draped?null:{func:l.CompareFunction.LEQUAL},depthWrite:r,colorWrite:u.defaultColorWriteParams,polygonOffset:y})}get primitiveType(){return this.configuration.occlusionPass?l.PrimitiveType.POINTS:l.PrimitiveType.TRIANGLES}}x.shader=
new k.ReloadableShaderModule(n.HUDMaterial,()=>new Promise((v,p)=>a(["./HUDMaterial.glsl"],v,p)));const w={factor:0,units:-4},q=u.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,h,c){const k=c.separateBlendingParams(h.BlendFactor.SRC_ALPHA,
h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),m=c.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE),d=c.simpleBlendingParams(h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_ALPHA),f={factor:-1,units:-2};a.OITPolygonOffset=f;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=d;a.blendingColor=m;a.blendingDefault=k;a.getOITPolygonOffset=function(g){return g?f:null};a.oitBlending=function(g){return g===b.TransparencyPassType.FrontFace?null:g===b.TransparencyPassType.Alpha?
d:m};a.oitDepthTest=function(g,e=h.CompareFunction.LESS){return g===b.TransparencyPassType.NONE||g===b.TransparencyPassType.FrontFace?e:h.CompareFunction.LEQUAL};a.oitDepthWrite=function(g){return g===b.TransparencyPassType.FrontFace?c.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m){class d extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.hasPolygonOffset=this.hasSlicePlane=this.debugDrawLabelBorder=this.hasScreenSizePerspective=this.hasVerticalOffset=this.vvColor=this.vvSize=this.sampleSignedDistanceFieldTexelCenter=this.signedDistanceFieldEnabled=!1;this.pixelSnappingEnabled=
this.depthEnabled=!0;this.objectAndLayerIdColorInstanced=this.occlusionPass=this.cullAboveGround=this.multipassEnabled=this.draped=!1}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],d.prototype,"output",void 0);b.__decorate([c.parameter({count:k.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",void 0);b.__decorate([c.parameter()],d.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"spherical",void 0);b.__decorate([c.parameter()],
d.prototype,"occlusionTestEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"signedDistanceFieldEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"sampleSignedDistanceFieldTexelCenter",void 0);b.__decorate([c.parameter()],d.prototype,"vvSize",void 0);b.__decorate([c.parameter()],d.prototype,"vvColor",void 0);b.__decorate([c.parameter()],d.prototype,"hasVerticalOffset",void 0);b.__decorate([c.parameter()],d.prototype,"hasScreenSizePerspective",void 0);b.__decorate([c.parameter()],d.prototype,
"debugDrawLabelBorder",void 0);b.__decorate([c.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],d.prototype,"hasPolygonOffset",void 0);b.__decorate([c.parameter()],d.prototype,"depthEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"pixelSnappingEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"draped",void 0);b.__decorate([c.parameter()],d.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter()],
d.prototype,"occlusionPass",void 0);b.__decorate([c.parameter()],d.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([c.parameter({constValue:!0})],d.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([c.parameter({constValue:!1})],d.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.LabelDeconflictor=class extends f.Deconflictor{constructor(l){super(l);this.visibilityGroup=g.VisibilityGroup.LABEL;this.marginFactor=.05;this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(l){if(this.parent.running)return n.Yield;const u=performance.now();if(l.state!==e.RenderState.IDLE&&2E3>u-this._lastDeconfliction)return n.Yield;super.runTask(l);this.state===f.State.Idle&&(this._lastDeconfliction=u)}enabledChanged(l,u){this.modifyGraphics(u,
l.labelsEnabled)}getGraphicsLayers(l){return l.labelLayers}};b.__decorate([h.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([d.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./LabelParameters ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){function J(V){return!V||0===V.length}function K(V){return!0===V.labelsVisible&&!!V.labelingInfo?.some(Q=>!!Q.symbol)}class I{constructor(V,Q){this.labelingContext=V;this.graphics3DGraphic=Q;this.textInitialized=this.addedToTextureAtlas=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}}class M{constructor(V,Q,T,ia,O){this.labelClass=V;this.graphics3DSymbol=Q;this.graphics3DCalloutSymbolLayer=
T;this.textRenderParameters=ia;this.labelFunction=O;this.calloutSymbolLayerIndex=0}}class S{constructor(V,Q,T,ia,O,U,P,R){this.layer=Q;this.graphics3DCore=T;this.scaleVisibility=ia;this.emptySymbolLabelSupported=O;this.elevationInfoOverride=U;this.disablePlacement=P;this.active=R;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new L.WebGLLayer(V,{pickable:!0,disableOctree:!0},Q.uid)}destroy(){this.stageLayer.destroy()}}
a.Labeler=class extends h{constructor(V){super(V);this._dirty=!1;this._labels=new Map;this._labelingContexts=[]}setup(){this.dispose();this.addHandles([g.watch(()=>this.view.state?.camera,()=>this.setDirty()),g.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(C.TaskPriority.LABELER,this)]);this._textTextureAtlas=new H.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new B.MaterialCollection(this.view._stage);
this._calloutMaterialCollection=new B.MaterialCollection(this.view._stage)}dispose(){this.removeAllHandles();this._textTextureAtlas=d.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=d.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=d.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear()}destroy(){this.dispose();N.graphic=null;N.renderingInfo=null;N.layer=null}_activateLabelingContext(V){V.graphics.forEach((Q,T)=>
{const ia=new I(V,Q);this._labels.set(T,ia);V.labelsToInitialize.set(T,ia);Q.setVisibilityFlag(p.VisibilityGroup.LABEL,p.VisibilityFlag.USER,!0)});V.active=!0}_deactivateLabelingContext(V){V.graphics.forEach((Q,T)=>{Q.setVisibilityFlag(p.VisibilityGroup.LABEL,p.VisibilityFlag.USER,!1);this.setLabelGraphicVisibility(Q,!1);this._labels.delete(T)});V.active=!1}_addLabelTextureToAtlas(V){for(const Q of V.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const T=V.textRenderers[Q._labelIndex];
T&&(this._textTextureAtlas.addTextTexture(T,Q.stageObject),V.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(V){for(const Q of V.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const T=V.textRenderers[Q._labelIndex];null!=T&&(this._textTextureAtlas.removeTextTexture(T,Q.stageObject),V.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(V){this._updateLabels(V);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(V);
return z.Yield}_updateLabels(V){if(this._dirty){this._dirty=!1;for(const Q of this._labelingContexts)Q.active&&(Q.labelClassPromise&&Q.labelClassAbortController?this._dirty=!0:J(Q.labelClassContexts)?null===Q.labelClassContexts?this._deactivateLabelingContext(Q):(this._createLabelClassContext(Q),this._dirty=!0):m.someMap(Q.labelsToInitialize,(T,ia)=>{this._ensureGraphics3DResources(T)&&(this._labels.set(ia,T),this.deconflictor.setDirty(),V.madeProgress());if(T.visible&&T.textInitialized||!T.visible&&
T.hasGraphics3DResources)Q.labelsToInitialize.delete(ia),V.madeProgress();return V.done})&&(this._dirty=!0));this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(V){const Q=V.labelClassAbortController?.signal;V.layer.when&&await V.layer.when();f.throwIfAborted(Q);V.scaleVisibility&&V.scaleVisibility.updateScaleRangeActive();const T=V.graphics3DCore,ia=T.layer.labelingInfo?.filter(O=>!!O.symbol);ia&&0!==ia.length&&(await c.forEach(ia,async(O,U)=>{var P=O.symbol;const R=y.getGraphics3DSymbol(T.getOrCreateGraphics3DSymbol(P));
if(null==R)k.getLogger(this).error("Failed to create Graphics3DSymbol for label");else{await R.load();f.throwIfAborted(Q);var ba=null;v.hasCalloutSupport(P)&&P.hasVisibleCallout()&&(ba=t.make(P,T.symbolCreationContext),await ba.load(),f.throwIfAborted(Q));P=await c.result(q.createLabelFunction(O,V.layer.fieldsIndex,this.view.spatialReference));f.throwIfAborted(Q);if(!0===P.ok){const X=await this._createTextRenderParameters(R.symbol);f.throwIfAborted(Q);V.labelClassContexts[U]=new M(O,R,ba,X,P.value)}else k.getLogger(this).error(`Label expression failed to evaluate: ${P.error}`)}}),
f.throwIfAborted(Q))}async _createLabelClassContext(V){null==V.labelClassPromise&&(V.labelClassPromise=this._createLabelClassContextAsync(V).catch(Q=>{if(f.isAbortError(Q))throw Q;V.labelClassContexts.length=0}).then(()=>{V.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return V.labelClassPromise}async _createTextRenderParameters(V){V=V.symbolLayers.at(0);return"text"!==V?.type?null:G.TextRenderParameters.fromSymbol(V,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(V){for(var Q of V.labelClassContexts)--Q.graphics3DSymbol.referenced;
Q=V.labelClassAbortController;V.labelClassAbortController=new AbortController;d.abortMaybe(Q);V.labelClassContexts.length=0;V.labelClassPromise=null;this.notifyChange("updating")}_createTextSymbolGraphic(V,Q,T,ia,O,U){V=new D.LabelParameters(T,A.horizontalPlacementFromAnchor(T.anchor),A.verticalPlacementFromAnchor(T.anchor),V.text,x.fromValues(V.displayWidth,V.displayHeight));N.graphic=Q;N.renderingInfo=null;N.layer=ia;return O.createLabel(N,V,this._hudMaterialCollection,this._textTextureAtlas,()=>
{const P=E.getLabelPlacement(U);return P?P.elevationOffset:null})}_createLineCalloutGraphic(V,Q,T,ia,O){N.graphic=V;N.layer=O;N.renderingInfo=new r.LineCalloutSymbolLayerRenderingInfo(null,Q,ia.translation,ia.centerOffset,ia.screenOffset[0],ia.centerOffsetUnits,ia.elevationOffset,this._calloutMaterialCollection);return T.createGraphics3DGraphic(N)}_ensureGraphics3DResources(V){if(V.hasGraphics3DResources)return!1;const Q=V.graphics3DGraphic;if(Q.destroyed)return!1;this._ensureTextTextureResources(V);
const T=V.labelingContext,ia=T.labelClassContexts;if(J(ia)||!T.emptySymbolLabelSupported&&0===Q.layers.length)return!1;var O=!1,U=Q.graphic;const P=T.layer;var R=K(T.layer);for(let X=0;X<ia.length;X++){const da=V.textRenderers[X],ha=V.textLabelPlacements[X];if(null==da||null==ha)continue;const fa=ia[X];var ba=fa.graphics3DSymbol;const aa=ba.symbol&&"label-3d"===ba.symbol.type?ba.symbol:null;if(ba=ba.symbolLayers[0]){ba.setElevationInfoOverride(T.elevationInfoOverride);O=new E.LabelInfo(Q,aa,fa.labelClass);
O=this._createTextSymbolGraphic(da,U,ha,P,ba,O);if(null==O)return!1;O._labelClass=fa.labelClass;O._labelIndex=X;Q.addLabelGraphic(O,T.stageLayer);Q.deconflictionPriority=fa.textRenderParameters?.definition.size??0;Q.setVisibilityFlag(p.VisibilityGroup.LABEL,p.VisibilityFlag.USER,R);Q.setVisibilityFlag(p.VisibilityGroup.LABEL,p.VisibilityFlag.SCALE_RANGE,!0);Q.setVisibilityFlag(p.VisibilityGroup.LABEL,p.VisibilityFlag.DECONFLICTION,!1);O=!0;(R=fa.graphics3DCalloutSymbolLayer)&&ha.hasLabelVerticalOffset&&
(R.setElevationInfoOverride(T.elevationInfoOverride),U=this._createLineCalloutGraphic(U,aa,R,ha,P),null!=U&&(fa.calloutSymbolLayerIndex=Q.labelLayers.length,Q.addLabelGraphic(U,T.stageLayer)));break}}T.scaleVisibility&&O&&T.scaleVisibility.updateGraphicLabelScaleVisibility(Q);return V.hasGraphics3DResources=!0}_destroyGraphics3DResources(V){const Q=V.labelingContext.labelClassContexts;for(const T of V.graphics3DGraphic.labelLayers)if(null!=T._labelClass)Q[T._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(T);
V.graphics3DGraphic.deconflictionPriority=0;V.graphics3DGraphic.clearLabelGraphics();V.hasGraphics3DResources=!1}_ensureTextTextureResources(V){if(!V.textInitialized){var Q=V.labelingContext,T=Q.labelClassContexts;if(!J(T)){var ia=V.graphics3DGraphic.graphic;for(let P=0;P<T.length;P++){const R=T[P];V.textRenderers[P]=null;V.textLabelPlacements[P]=null;if(null==R?.textRenderParameters)continue;var O=R.labelFunction;let ba;if("arcade"===O.type)try{const X=O.needsHydrationToEvaluate()?w.hydrateGraphic(ia,
Q.layer):ia;ba=O.evaluate(X)}catch(X){ba=null}else ba=O.evaluate(ia);if(null!=ba&&""!==ba&&!/^\s+$/.test(ba)&&(O=R.graphics3DSymbol,O.symbolLayers[0]&&(O=E.getLabelPlacement({graphics3DGraphic:V.graphics3DGraphic,labelSymbol:"label-3d"===O.symbol?.type?O.symbol:null,labelClass:R.labelClass,disablePlacement:Q.disablePlacement}),null!=O))){var U=A.horizontalPlacementFromAnchor(O.anchor);U=A.textRenderAlignmentFromHorizontalPlacement(U);V.textRenderers[P]=new F.TextRenderer(ba,U,R.textRenderParameters,
H.TextTextureAtlas.maxSize);V.textLabelPlacements[P]=O}}V.textInitialized=!0}}}_destroyTextTextureResources(V){V.textInitialized=!1;V.textRenderers.length=0;V.textLabelPlacements.length=0}_addGraphic(V,Q){const T=Q.graphic.uid;V.graphics.set(T,Q);V.active&&(Q=new I(V,Q),this._labels.set(T,Q),V.labelsToInitialize.set(T,Q));this.setDirty();this.deconflictor.setDirty()}_removeGraphic(V,Q){Q=Q.graphic.uid;const T=this._labels.get(Q);V.graphics.delete(Q);T&&(this._destroyGraphic(T,Q),V.labelsToInitialize.delete(Q),
this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(V,Q){this._labels.delete(Q);V.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(V);this._destroyTextTextureResources(V);V.hasGraphics3DResources&&this._destroyGraphics3DResources(V)}async _labelingInfoChange(V,Q){if(Q)for(const T of Q){if(Q=V.graphics.get(T))this._removeGraphic(V,Q),this._addGraphic(V,Q)}else return this._visibilityInfoChange(V),this._resetLabels(V),this._createLabelClassContext(V)}_globalPropertyChanged(V,Q){for(const T of Q.labelClassContexts){const ia=
new Map;Q.graphics.forEach(O=>ia.set(O.graphic.uid,O));T.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(V,ia,O=>O.labelLayers[0]);T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(V,ia,O=>O.labelLayers[T.calloutSymbolLayerIndex])}}_visibilityInfoChange(V){const Q=K(V.layer);Q&&!V.active&&this._activateLabelingContext(V);!Q&&V.active&&this._deactivateLabelingContext(V);this.setDirty()}_resetAllLabels(){for(const V of this._labelingContexts)this._resetLabels(V)}_resetLabels(V){V.graphics.forEach((Q,
T)=>{if(Q=this._labels.get(T))this._destroyGraphic(Q,T),Q.visible=!1,V.labelsToInitialize.set(T,Q)});this._destroyLabelClassContext(V);this.setDirty();this.deconflictor.setDirty()}_findLabelingContext(V){for(const Q of this._labelingContexts)if(Q.graphics3DCore===V)return Q;return null}addGraphicsOwner(V,Q,T){const ia=T&&T.emptySymbolLabelSupported||!1,O=T?.elevationInfoOverride||null;T=T?.disablePlacement||null;if(!this._findLabelingContext(V)){var U=V.layer,P=new S(this.view._stage,U,V,Q,ia,O,T,
K(U));this._labelingContexts.push(P);this.setDirty();return{addGraphic:R=>this._addGraphic(P,R),removeGraphic:R=>this._removeGraphic(P,R),featureReductionChange:()=>{},layerLabelsEnabled:()=>K(P.layer),labelingInfoChange:R=>this._labelingInfoChange(P,R),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",P),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",P),visibilityInfoChange:()=>this._visibilityInfoChange(P),reset:()=>this._resetLabels(P),clear:()=>{}}}}removeGraphicsOwner(V){const Q=
this._findLabelingContext(V);Q&&(V=this._labelingContexts.indexOf(Q),this._labelingContexts.splice(V,1),Q.graphics.forEach(T=>this._removeGraphic(Q,T)),Q.destroy(),this.setDirty())}setLabelGraphicVisibility(V,Q){V=V.graphic.uid;const T=this._labels.get(V);T&&T.visible!==Q&&(Q&&!T.addedToTextureAtlas?(this._addLabelTextureToAtlas(T),T.textInitialized||T.labelingContext.labelsToInitialize.set(V,T)):!Q&&T.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(T),T.visible=Q,this.setDirty())}setDirty(){!this._dirty&&
0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(V=>!!V.labelClassPromise&&!!V.labelClassAbortController)}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const V=0<this._labelingContexts.length?this._labelingContexts.reduce((Q,T)=>Q+(T.labelClassPromise&&T.labelClassAbortController?0:1),0)/this._labelingContexts.length:
1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*V+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};b.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);b.__decorate([e.property({type:Boolean,readOnly:!0})],
a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([u.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const N=new r.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedPoint ../../geometry/SpatialReference".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(t){return"declaredClass"in t}function n(t){return"declaredClass"in t}function l(t){return"declaredClass"in t}function u(t){return null==t?null:e(t)?t:d.fromJSON(x(t))}function x(t){const {wkid:r,wkt:y,wkt2:D,latestWkid:E}=t.spatialReference,A={wkid:r,wkt:y,wkt2:D,latestWkid:E};switch(t.type){case "point":const {x:B,y:F,z:G,m:H}=t;return{x:B,y:F,z:G,m:H,spatialReference:A};case "polygon":const {rings:L,hasZ:C,hasM:z}=t;return{rings:w(L),hasZ:C,hasM:z,spatialReference:A};
case "polyline":const {paths:J,hasZ:K,hasM:I}=t;return{paths:w(J),hasZ:K,hasM:I,spatialReference:A};case "extent":const {xmin:M,xmax:S,ymin:N,ymax:V,zmin:Q,zmax:T,mmin:ia,mmax:O,hasZ:U,hasM:P}=t;return{xmin:M,xmax:S,ymin:N,ymax:V,zmin:Q,zmax:T,mmin:ia,mmax:O,hasZ:U,hasM:P,spatialReference:A};case "multipoint":const {points:R,hasZ:ba,hasM:X}=t;return{points:p(R)?q(R):R,hasZ:ba,hasM:X,spatialReference:A}}}function w(t){return v(t)?t.map(r=>q(r)):t}function q(t){return t.map(r=>Array.from(r))}function v(t){for(const r of t)if(0!==
r.length)return p(r);return!1}function p(t){return 0<t.length&&(m.isFloat32Array(t[0])||m.isFloat64Array(t[0]))}a.clonePoint=function(t,r){if(!t)return null;if(n(t)){if(null==r)return t.clone();if(n(r))return r.copy(t)}null!=r?(r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=f.makeDehydratedPoint(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0));return r};a.hydrateGeometry=
u;a.hydrateGraphic=function(t,r){return t?l(t)?t:new h({layer:r,sourceLayer:r,visible:t.visible,symbol:k.clone(t.symbol),attributes:k.clone(t.attributes),geometry:u(t.geometry)}):null};a.hydratedSpatialReference=function(t){const {wkid:r,wkt:y,wkt2:D,latestWkid:E}=t;return g.fromJSON({wkid:r,wkt:y,wkt2:D,latestWkid:E})};a.isHydratedGeometry=e;a.isHydratedGraphic=l;a.isHydratedPoint=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(w,q){if(null==w)return"";const v=q.domain;if(v)if("codedValue"===v.type||"coded-value"===v.type)for(var p of v.codedValues){if(p.code===w)return p.name}else if("range"===v.type){const {max:t,min:r}=d.getDomainRange(q);p=+w;if(null!=r&&null!=t&&r<=p&&p<=t)return v.name}f.isDateField(q)?w=k.formatDate(w,k.convertDateFormatToIntlOptions("short-date")):f.isNumericField(q)&&(w=m.formatNumber(+w));return w||""}const l=()=>h.getLogger("esri.layers.support.labelFormatUtils"),
u={type:"simple",evaluate(){return null}},x={getAttribute(w,q){return w.field(q)}};a.createLabelFunction=async function(w,q,v){if(!w||!w.symbol||!q)return u;const p=w.where,t=g.getLabelExpression(w);if("arcade"===t.type){const r=await e.createLabelExpression(t.expression,v,q);if(null==r)return u;w={type:"arcade",evaluate(y,D){try{const E="attributes"in y?r.repurposeFeature(y):y;E.contextTimeZone=D??null;const A=r.evaluate({$view:{timeZone:D},$feature:E},r.services);if(null!=A)return A.toString()}catch(E){l().error(new b("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:E,feature:y,expression:t}))}return null},needsHydrationToEvaluate(){return null==g.getSingleFieldArcadeExpression(t.expression)}}}else w={type:"simple",evaluate(r){return t.expression.replaceAll(/{[^}]*}/g,y=>{var D=y.slice(1,-1);D=q.get(D);if(!D)return y;y=null;"attributes"in r?r&&r.attributes&&(y=r.attributes[D.name]):y=r.field(D.name);return null==y?"":n(y,D)})}};if(p){let r;try{r=await c.parseWhereClause(p,q)}catch(D){return l().error(new b("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:p,error:D})),u}const y=w.evaluate;w.evaluate=(D,E)=>{const A="attributes"in D?void 0:x;try{if(r.testFeature(D,A))return y(D,E)}catch(B){l().error(new b("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:p,feature:D,error:B}))}return null}}return w};a.formatField=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,h,c){const k=()=>b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),m={line:c.Graphics3DLineCalloutSymbolLayer};a.make=function(d,f){if(!h.hasCalloutSupport(d))return k().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${d.type}' does not support callouts`),null;if(!d.callout)return null;const g=m[d.callout.type];return g?new g(d,
f):(k().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${d.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){class D extends u.Graphics3DSymbolLayer{constructor(H,L){super(H,null,L,B);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new y.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(H){const L=
this._materialParameters;L.horizontalScreenOffset=H.horizontalScreenOffset??0;L.centerOffsetUnits=H.centerOffsetUnits||"world";return L}get _materialParameters(){const H=new y.Parameters;var L=this.symbol,C=L.callout;H.color=null!=C.color?b.toUnitRGBA(C.color):[0,0,0,0];H.color[3]*=this._getLayerOpacity();H.size=h.pt2px(C.size||0);if(L.verticalOffset){const {screenLength:z,minWorldLength:J,maxWorldLength:K}=L.verticalOffset;H.verticalOffset={screenLength:h.pt2px(z),minWorldLength:J||0,maxWorldLength:null!=
K?K:Infinity}}H.borderColor=null!=C.border?.color?b.toUnitRGBA(C.border.color):null;C="object"===L.symbolLayers.at(0).type;L="label-3d"===L.type;H.occlusionTest=!C;H.shaderPolygonOffset=C?0:void 0;H.depthHUDAlignStart=L;H.hasSlicePlane=this._context.slicePlaneEnabled;H.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return H}_defaultElevationInfoNoZ(){return A}createGraphics3DGraphic(H){const L=H.renderingInfo;H=H.graphic;
const C=this.setGraphicElevationContext(H,new g.ElevationContext,L.elevationOffset||0);var z=L.symbol;const J="on-the-ground"===this._elevationContext.mode&&("cim"===z.type||!z.symbolLayers.some(K=>"object"===K.type||"text"===K.type));if("label-3d"!==z.type&&J||"point-3d"===z.type&&z.symbolLayers.every(K=>"text"===K.type&&!m.textSymbolLayerSupportsVerticalOffset(K)))return null;z=x.computeCentroid(H.geometry);return null==z?null:this._createAs3DShape(z,C,L,H.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(H,
L,C){C=f.elevationModeChangeUpdateType(D.elevationModeChangeTypes,C,this._elevationContext.mode);if(C!==f.SymbolUpdateType.UPDATE)return C;H.forEach(z=>{const J=L(z);null!=J&&this.updateGraphicElevationContext(z.graphic,J)});return C}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(H,L,C=0){super.setGraphicElevationContext(H,L);L.addOffsetRenderUnits(C);return L}updateGraphicElevationContext(H,
L){this.setGraphicElevationContext(H,L.elevationContext,null!=L.metadata?L.metadata.elevationOffset:0);L.needsElevationUpdates=f.needsElevationUpdates2D(L.elevationContext.mode)}computeComplexity(){return new q.SymbolComplexity({verticesPerFeature:6})}_createVertexData(H){const {translation:L,centerOffset:C}=H;H=L?new v.Attribute([L[0],L[1],L[2]],E,3,!0):new v.Attribute([0,0,0],E,3,!0);const z=C?new v.Attribute([C[0],C[1],C[2],C[3]],E,4,!0):new v.Attribute([0,0,0,1],E,4,!0);return[[r.VertexAttribute.POSITION,
H],[r.VertexAttribute.NORMAL,new v.Attribute([0,0,1],E,3,!0)],[r.VertexAttribute.CENTEROFFSETANDDISTANCE,z]]}_getOrCreateMaterial(H){const L=this._perInstanceMaterialParameters(H),C=y.LineCalloutMaterial.uniqueMaterialIdentifier(L);if(C===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=H.materialCollection){let z=H.materialCollection.get(C);null==z&&(z=new y.LineCalloutMaterial(L),H.materialCollection.add(C,z));return{material:z,isUnique:!1}}return{material:new y.LineCalloutMaterial(L),
isUnique:!0}}_createAs3DShape(H,L,C,z){var J=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:z,layerUid:this._context.layer.uid}),K=this._getOrCreateMaterial(C);J=new t.Geometry(K.material,this._createVertexData(C),null,p.ContentObjectType.Point,J);z=w.createStageObject(this._context,H,J,L,z);if(null==z)return null;K=new n.Graphics3DObject3DGraphicLayer(this,z.object,[J],K.isUnique?[K.material]:null,null,d.perObjectElevationAligner,L);K.metadata=new l.Graphics3DObjectMetadata(C.elevationOffset);
K.alignedSampledElevation=z.sampledElevation;K.needsElevationUpdates=f.needsElevationUpdates2D(L.mode);w.extendPointGraphicElevationContext(K,H,this._context.elevationProvider);return K}}D.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.UPDATE,staysOnTheGround:f.SymbolUpdateType.UPDATE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const E=[0],A={mode:"relative-to-ground",offset:0},B={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class F{constructor(H,L,C=c.create(),z=k.create(),
J=0,K="world",I=0,M=null){this.renderer=H;this.symbol=L;this.translation=C;this.centerOffset=z;this.horizontalScreenOffset=J;this.centerOffsetUnits=K;this.elevationOffset=I;this.materialCollection=M}}class G extends e.Graphics3DGraphicCreationContext{}a.Graphics3DLineCalloutSymbolLayer=D;a.LineCalloutCreationContext=G;a.LineCalloutSymbolLayerRenderingInfo=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ./elevationAlignmentUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(y,D,E,A,B){let F=!1;var G=y.transformation;D=D.requiresSampledElevationInfo;q[0]=G[12];q[1]=G[13];q[2]=G[14];y.invalidateBoundingInfo();var H=y.getMutableAttribute(l.VertexAttribute.POSITION);G=H.data;H=H.size;const L=G.length/H;y=new e.SamplePosition(y.mapPositions,E);let C=0,z=0;for(let J=0;J<L;J++){v[0]=G[C];v[1]=G[C+1];v[2]=G[C+2];A(y,r);D&&(z+=r.sampledElevation);if(g.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)G[C]=y.array[y.offset],G[C+1]=y.array[y.offset+
1],G[C+2]=r.z,d.projectBuffer(G,E,C,G,B.spatialReference,C,1),G[C]-=q[0],G[C+1]-=q[1],G[C+2]-=q[2],F=!0;else{w[0]=G[C]+q[0];w[1]=G[C+1]+q[1];w[2]=G[C+2]+q[2];B.setAltitude(w,r.z);G[C]=w[0]-q[0];G[C+1]=w[1]-q[1];G[C+2]=w[2]-q[2];const K=.01/B.unitInMeters;if(Math.abs(v[0]-G[C])>=K||Math.abs(v[1]-G[C+1])>=K||Math.abs(v[2]-G[C+2])>=K)F=!0}C+=H;y.offset+=3}return{update:F,averageGeometrySampledElevation:z/L}}const x=h.create(),w=k.create(),q=k.create(),v=k.create(),p=h.create(),t=k.create(),r=new f.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(y,D,E,A,B){var F=y.graphics3DSymbolLayer.lodRenderer;if(null==F)return 0;E=D.centerPointInElevationSR;A(E,r);D="absolute-height"!==D.mode?r.sampledElevation:0;A=F.instanceData;y=y.instanceIndex;A.getGlobalTransform(y,p);F=c.set(t,p[12],p[13],p[14]);g.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=E.x,w[1]=E.y,w[2]=r.z,m.computeTranslationToOriginAndRotation(E.spatialReference,w,p,B.spatialReference)&&A.setGlobalTransform(y,p)):B.setAltitudeOfTransformation(r.z,
p);B=.01/B.unitInMeters;(g.debugFlags.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(p[12]-F[0])>=B||Math.abs(p[13]-F[1])>=B||Math.abs(p[14]-F[2])>=B)&&A.setGlobalTransform(y,p);return D};a.perObjectElevationAligner=function(y,D,E,A,B,F){y=y.stageObject;const G=D.centerPointInElevationSR;E=0;y.usesVerticalDistanceToGround?(A(G,r),f.updateVertexPointGroundDistance(y,r.verticalDistanceToGround),E=r.sampledElevation):(A(G,r),"absolute-height"!==D.mode&&(E=r.sampledElevation));D=b.copy(x,F??y.transformation);
A=c.set(t,D[12],D[13],D[14]);g.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=G.x,w[1]=G.y,w[2]=r.z,m.computeTranslationToOriginAndRotation(G.spatialReference,w,D,B.spatialReference)&&(F?b.copy(F,D):y.transformation=D)):B.setAltitudeOfTransformation(r.z,D);B=.01/B.unitInMeters;if(Math.abs(D[12]-A[0])>=B||Math.abs(D[13]-A[1])>=B||Math.abs(D[14]-A[2])>=B)F?b.copy(F,D):y.transformation=D;return E};a.perVertexElevationAligner=function(y,D,E,A,B){y=y.stageObject;const F=y.geometries;let G=0;for(const H of F){if(!n.isGeometryWithMapPositions(H))continue;
const {update:L,averageGeometrySampledElevation:C}=u(H,D,E,A,B);G+=C;L&&y.geometryVertexAttributeUpdated(H,l.VertexAttribute.POSITION)}return G/F.length};a.sharedGeometryElevationAligner=function(y,D,E,A,B){y=y.stageObject;const F=y.geometries;if(0===F.length)return 0;let G=0,H=null,L=0,C=!1;for(const z of F){if(!n.isGeometryWithMapPositions(z))continue;const J=z.attributes.get(l.VertexAttribute.POSITION);if(J!==H){const {update:K,averageGeometrySampledElevation:I}=u(z,D,E,A,B);L=I;H=J;C=K}C&&y.geometryVertexAttributeUpdated(z,
l.VertexAttribute.POSITION);G+=L}return G/F.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../layers/graphics/dehydratedFeatureUtils ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(v,p,t,r,y){const D=(d.isDehydratedPoint(v)?v.z:f.isSamplePosition(v)?v.array[v.offset+2]:v[2])||0;switch(t.mode){case "on-the-ground":t=f.getElevationAtPoint(p,v,"ground")??0;y.verticalDistanceToGround=0;y.sampledElevation=t;y.z=t;break;case "relative-to-ground":v=f.getElevationAtPoint(p,v,"ground")??0;t=t.geometryZWithOffset(D,r);y.verticalDistanceToGround=t;y.sampledElevation=v;y.z=t+v;break;case "relative-to-scene":v=f.getElevationAtPoint(p,v,"scene")??0;
t=t.geometryZWithOffset(D,r);y.verticalDistanceToGround=t;y.sampledElevation=v;y.z=t+v;break;case "absolute-height":t=t.geometryZWithOffset(D,r);r=f.getElevationAtPoint(p,v,"ground")??0;y.verticalDistanceToGround=t-r;y.sampledElevation=r;y.z=t;break;default:y.z=0}}function n(v,p){for(let t=0;t<v.geometries.length;++t){const r=v.geometries[t].getMutableAttribute(g.VertexAttribute.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==p&&(r.data[3]=p,v.geometryVertexAttributeUpdated(v.geometries[t],g.VertexAttribute.CENTEROFFSETANDDISTANCE))}}
class l{constructor(){this.z=this.sampledElevation=this.verticalDistanceToGround=0}}a.SymbolUpdateType=void 0;(function(v){v[v.NONE=0]="NONE";v[v.UPDATE=1]="UPDATE";v[v.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const u={"absolute-height":{applyElevationAlignmentBuffer:function(v,p,t,r,y,D,E,A){D=A.calculateOffsetRenderUnits(E);A=A.featureExpressionInfoContext;p*=3;r*=3;for(E=0;E<y;++E){const B=v[p+1],F=v[p+2];t[r]=v[p];t[r+1]=B;t[r+2]=null==A?F+D:D;p+=3;r+=3}return 0},
requiresAlignment:function(v){const p=v.featureExpressionInfoContext;return 0!==v.meterUnitOffset||null!=p}},"on-the-ground":{applyElevationAlignmentBuffer:function(v,p,t,r,y,D){let E=0;const A=D.spatialReference;p*=3;r*=3;for(let B=0;B<y;++B){const F=v[p],G=v[p+1],H=D.getElevation(F,G,v[p+2],A,"ground")??0;E+=H;t[r]=F;t[r+1]=G;t[r+2]=H;p+=3;r+=3}return E/y},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(v,p,t,r,y,D,E,A){let B=0;E=A.calculateOffsetRenderUnits(E);
A=A.featureExpressionInfoContext;const F=D.spatialReference;p*=3;r*=3;for(let G=0;G<y;++G){const H=v[p],L=v[p+1],C=v[p+2],z=D.getElevation(H,L,C,F,"ground")??0;B+=z;t[r]=H;t[r+1]=L;t[r+2]=null==A?C+z+E:z+E;p+=3;r+=3}return B/y},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(v,p,t,r,y,D,E,A){let B=0;E=A.calculateOffsetRenderUnits(E);A=A.featureExpressionInfoContext;const F=D.spatialReference;p*=3;r*=3;for(let G=0;G<y;++G){const H=v[p],L=v[p+1],C=v[p+2],z=D.getElevation(H,
L,C,F,"scene")??0;B+=z;t[r]=H;t[r+1]=L;t[r+2]=null==A?C+z+E:z+E;p+=3;r+=3}return B/y},requiresAlignment:()=>!0}},x=h.create(),w=new l,q=c.create();a.SampleElevationInfo=l;a.applyElevationAlignmentForHUD=function(v,p,t,r,y){e(p,t,y,r,w);n(v,w.verticalDistanceToGround);t=w.sampledElevation;y=b.copy(x,v.transformation);q[0]=p.x;q[1]=p.y;q[2]=w.z;k.computeTranslationToOriginAndRotation(p.spatialReference,q,y,r.spatialReference)?v.transformation=y:console.warn("Could not locate symbol object properly, it might be misplaced");
return t};a.applyPerVertexElevationAlignment=function(v,p,t,r,y,D,E,A,B,F,G){const H=u[G.mode];let L=0;if(m.projectBuffer(v,p,t,r,B.spatialReference,y,A)&&(H.requiresAlignment(G)?(L=H.applyElevationAlignmentBuffer(r,y,D,E,A,B,F,G),v=D,y=E):v=r,m.projectBuffer(v,B.spatialReference,y,D,F.spatialReference,E,A)))return L};a.elevationModeChangeUpdateType=function(v,p,t){return null==p||null==t?v.definedChanged:"on-the-ground"===p&&"on-the-ground"===t?v.staysOnTheGround:p===t||"on-the-ground"!==p&&"on-the-ground"!==
t?a.SymbolUpdateType.UPDATE:v.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(v,p,t,r){e(v,p,t,r,w);return w.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(v){return"relative-to-ground"===v||"relative-to-scene"===v};a.needsElevationUpdates3D=function(v){return"absolute-height"!==v};a.updateVertexPointGroundDistance=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports",
"./Geometry"],function(a,b){class h extends b.Geometry{}a.GeometryWithMapPositions=h;a.isGeometryWithMapPositions=function(c){return null!=c.mapPositions};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,h){class c{constructor(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=
1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(k){this._unit=k;this._metersPerElevationInfoUnit=b.getMetersPerUnit(k)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit=
"meters"}set offsetMeters(k){this._meterUnitOffset=k;this._renderUnitOffset=0}set offsetElevationInfoUnits(k){this._meterUnitOffset=k*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}addOffsetRenderUnits(k){this._renderUnitOffset+=k}geometryZWithOffset(k,m){m=this.calculateOffsetRenderUnits(m);return null!=this.featureExpressionInfoContext?m:k+m}calculateOffsetRenderUnits(k){let m=this._meterUnitOffset;const d=this.featureExpressionInfoContext;null!=d&&(m+=h.execute(d)*this._metersPerElevationInfoUnit);
return m/k.unitInMeters+this._renderUnitOffset}setFromElevationInfo(k){this.mode=k.mode;this.unit=b.supportsUnit(k.unit)?k.unit:"meters";this.offsetElevationInfoUnits=k.offset??0}updateFeatureExpressionInfoContext(k,m,d){if(null==k)this._featureExpressionInfoContext=null;else{var f=k?.arcade;f&&null!=m&&null!=d?(this._featureExpressionInfoContext=h.clone(k),h.setContextFeature(this._featureExpressionInfoContext,h.createFeature(f.modules,m,d))):this._featureExpressionInfoContext=k}}static fromElevationInfo(k){const m=
new c;null!=k&&m.setFromElevationInfo(k);return m}}a.ElevationContext=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,h,c,k){a.clone=function(m){return{cachedResult:m.cachedResult,arcade:m.arcade?{func:m.arcade.func,context:m.arcade.modules.arcadeUtils.createExecContext(null,
{sr:m.arcade.context.spatialReference}),modules:m.arcade.modules}:null}};a.createContext=async function(m,d,f,g){m=m?.expression;if("string"!==typeof m)return null;var e="0"===m?0:null;if(null!=e)return{cachedResult:e};e=await k.loadArcade();h.throwIfAborted(f);f=e.arcadeUtils;m=f.createSyntaxTree(m);return f.dependsOnView(m)?(null!=g&&g.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:f.createFunction(m),context:f.createExecContext(null,{sr:d}),
modules:e}}};a.createContextWithoutExpressionSupport=function(m){m=m?.expression;return"string"===typeof m&&(m="0"===m?0:null,null!=m)?{cachedResult:m}:null};a.createFeature=function(m,d,f){return m.arcadeUtils.createFeature(d.attributes,d.geometry,f)};a.execute=function(m){if(null!=m){if(null!=m.cachedResult)return m.cachedResult;var d=m.arcade;d=d?.modules.arcadeUtils.executeFunction(d.func,d.context);"number"!==typeof d&&(d=m.cachedResult=0);return d}return 0};a.extractExpressionInfo=function(m,
d=!1){m=m?.featureExpressionInfo;d||"0"===m?.expression||(m=null);return m??null};a.setContextFeature=function(m,d){null!=m&&null==m.cachedResult&&(d&&m.arcade?(d._geometry&&(d._geometry=c.hydrateGeometry(d._geometry)),m.arcade.modules.arcadeUtils.updateExecContext(m.arcade.context,d)):b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["exports"],function(a){class b{constructor(h,c,k){this.graphic=h;this.renderingInfo=c;this.layer=k}}a.Graphics3DGraphicCreationContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(p){return p.isVisible()?p.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}class l{constructor(p,t,r){this.baseMaterial=p;this.edgeMaterials=t;this.properties=r}}class u{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(p,t,r,y,D,E,A,B=null){this.graphics3DSymbolLayer=p;this.stageObject=t;this._uniqueGeometries=r;this._uniqueMaterials=y;this._sharedResource=D;this.elevationAligner=
E;this.elevationContext=A;this._edgeState=B;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}initialize(p){this._stageLayer=p;p=p.stage;p.addMany(this._uniqueMaterials);p.addMany(this._uniqueGeometries);p.add(this.stageObject)}destroy(){if(this._stageLayer){var p=this._stageLayer.stage;p.removeMany(this._uniqueMaterials);p.removeMany(this._uniqueGeometries);p.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);p.renderer.edgeView?.removeObject(this.stageObject);this.stageObject.dispose();this._sharedResource?.release();this._visible=!1;this._stageLayer=null}}layerOpacityChanged(p,t){if(null!=this._edgeState){var r=n(this._edgeState.baseMaterial),y=!1;for(const D of this._edgeState.edgeMaterials)D.objectTransparency!==r&&(D.objectTransparency=r,y=!0);y&&this.resetEdgeObject(t);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[p])}}slicePlaneEnabledChanged(p,t){null!=this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:p},!t),this._edgeState.properties.hasSlicePlane=p)}setVisibility(p){if(null!=this._stageLayer&&this._visible!==p&&(this._visible=p,this.stageObject.visible=p,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const t=this._stageLayer.stage.renderer.ensureEdgeView();
t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,p):p&&this._addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(p,t,r,y){null!=this.elevationAligner&&(null!=r&&d.setContextFeature(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,p.spatialReference,(D,E)=>m.evaluateElevationInfoAtPoint(D,p,this.elevationContext,t,E),t),this.resetEdgeObject(y))}alignWithAbsoluteElevation(p,
t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(y,D)=>{D.sampledElevation=p;D.verticalDistanceToGround=0;D.z=p},t);this.resetEdgeObject(r)}getCenterObjectSpace(p=h.create()){return b.copy(p,k.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(p=c.create()){const t=this.stageObject.boundingVolumeObjectSpace;c.setMin(p,t.min);c.setMax(p,t.max);return p}computeAttachmentOrigin(p){const t=this.stageObject.effectiveTransformation;
if(this.useObjectOriginAsAttachmentOrigin)p.render.origin[0]+=t[12],p.render.origin[1]+=t[13],p.render.origin[2]+=t[14],p.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(q)&&(b.transformMat4(q,q,t),b.add(p.render.origin,p.render.origin,q),p.render.num++)}async getProjectedBoundingBox(p,t,r,y,D){D=this.getBoundingBoxObjectSpace(D);var E=v,A=c.isPoint(D)?1:E.length;for(var B=0;B<A;B++){const F=E[B];w[0]=D[F[0]];w[1]=D[F[1]];w[2]=D[F[2]];b.transformMat4(w,w,this.stageObject.transformation);
x[3*B]=w[0];x[3*B+1]=w[1];x[3*B+2]=w[2]}if(!p(x,0,A))return null;c.empty(D);p=null;this.calculateRelativeScreenBounds&&(p=this.calculateRelativeScreenBounds());for(E=0;E<3*A;E+=3){for(B=0;3>B;B++)D[B]=Math.min(D[B],x[E+B]),D[B+3]=Math.max(D[B+3],x[E+B]);p&&r.push({location:x.slice(E,E+3),screenSpaceBoundingRect:p})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){c.center(D,q);r="relative-to-scene"===this.elevationContext.mode?"scene":"ground";A=0;if(t.useViewElevation)A=t.service.getElevation(q[0],
q[1],r)??0;else try{const F=f.demResolutionForBoundingBox(D,t.service.spatialReference,t);A=await t.service.queryElevation(q[0],q[1],y,F,r)??0}catch(F){}c.offset(D,0,0,-this.alignedSampledElevation+A)}return D}addObjectState(p,t){p===g.Object3DState.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight());p===g.Object3DState.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(p){p.removeObject(this.stageObject)}resetEdgeObject(p){if(null!=this._edgeState){var t=
this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(t,p):t.removeObject(this.stageObject)}}_addOrUpdateEdgeObject(p,t){const r=this._edgeState;if(null!=r){var y=n(r.baseMaterial);for(const D of r.edgeMaterials)D.objectTransparency=y;p.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!t).then(()=>this._stageLayer?.sync())}}}const x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=h.create(),q=h.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,
1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=u;a.Object3DEdgeState=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(p){var t=p.paths[0];if(!t||0===t.length)return null;t=l.getPointOnPath(t,l.getPathLength(t)/2);return u.makeDehydratedPoint(t[0],t[1],t[2],p.spatialReference)}function q(p,t,r){r=r?p:x.clonePoint(p);return t&&p?f.projectPoint(p,r,t)?r:null:r}function v(p){const t=r=>null==r||0<=r;return Array.isArray(p)?p.every(t):null==p||0<=p}a.computeCentroid=function(p,t){if("point"===p.type)return q(p,t,!1);if(x.isHydratedGeometry(p))switch(p.type){case "extent":return q(p.center,
t,!1);case "polygon":return q(p.centroid,t,!1);case "polyline":return q(w(p),t,!0);case "mesh":return q(p.origin,t,!1)}else switch(p.type){case "extent":return p=u.makeDehydratedPoint(.5*(p.xmax+p.xmin),.5*(p.ymax+p.ymin),null!=p.zmin&&null!=p.zmax&&isFinite(p.zmin)&&isFinite(p.zmax)?.5*(p.zmax+p.zmin):void 0,p.spatialReference),q(p,t,!0);case "polygon":var r=p.rings[0];r&&0!==r.length?(r=n.ringsCentroid(p.rings,!!p.hasZ),p=u.makeDehydratedPoint(r[0],r[1],r[2],p.spatialReference)):p=null;return q(p,
t,!0);case "polyline":return q(w(p),t,!0)}};a.computeObjectRotation=function(p,t,r,y=c.create()){p&&h.rotateZ(y,y,-p/180*Math.PI);t&&h.rotateX(y,y,t/180*Math.PI);r&&h.rotateY(y,y,r/180*Math.PI);return y};a.computeObjectScale=function(p=k.ONES,t,r,y=1){const D=Array(3);if(null==t||null==r)D[0]=1,D[1]=1,D[2]=1;else{let A=0;for(let B=2;0<=B;B--){const F=p[B];let G;const H=null!=F,L=0===B&&!E&&!H,C=r[B];"symbol-value"===F||L?G=0!==C?t[B]/C:1:H&&"proportional"!==F&&isFinite(F)&&(G=0!==C?F/C:1);if(null!=
G){var E=D[B]=G;A=Math.max(A,Math.abs(G))}}for(p=2;0<=p;p--)null==D[p]?D[p]=E:0===D[p]&&(D[p]=.001*A)}for(E=2;0<=E;E--)D[E]/=y;return k.fromArray(D)};a.demResolutionForBoundingBox=function(p,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const y=b.getMetersPerUnitForSR(t),D=g.width(p)*y,E=g.depth(p)*y;p=g.height(p)*(t.isGeographic?1:y);return 0===D&&0===E&&0===p?r.minDemResolutionForPoints:.01*Math.max(D,E,p)};a.enlargeExtent=function(p,t,r,y=0){if(p){t||=e.create();let D=.5*p.width*(r-
1);r=.5*p.height*(r-1);p.width<1E-7*p.height?D+=r/20:p.height<1E-7*p.width&&(r+=D/20);m.set(t,p.xmin-D-y,p.ymin-r-y,p.xmax+D+y,p.ymax+r+y);return t}return null};a.isValidSize=v;a.mixinColorAndOpacity=function(p,t,r=null){const y=d.clone(d.ONES);null!=p&&(y[0]=p[0],y[1]=p[1],y[2]=p[2]);null!=t?y[3]=t:null!=p&&3<p.length&&(y[3]=p[3]);r&&(y[0]*=r,y[1]*=r,y[2]*=r,y[3]*=r);return y};a.overrideColor=function(p,t,r,y,D,E=[0,0,0,0]){for(let A=0;3>A;++A)E[A]=null!=p?.[A]?p[A]:null!=r?.[A]?r[A]:D[A];E[3]=null!=
t?t:null!=y?y:D[3];return E};a.validateSymbolLayerSize=function(p){return v(null!=p.isPrimitive?[p.width,p.depth,p.height]:p)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports"],function(a){class b{constructor(h,c=null){this.labelText=c;this.elevationOffset=h??0}}a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./defaultSymbolComplexity ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ../support/FastSymbolUpdates".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(y){const D={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};y&&"visualVariables"in y&&y.visualVariables&&y.visualVariables.forEach(E=>{switch(E.type){case "color":D.color=!0;if(E.stops)for(let A=0;A<E.stops.length;A++){const B=E.stops[A].color;B&&(D.opacity=!0,1>B.a&&(D.opacityAlwaysOpaque=!1))}break;case "opacity":D.opacity=!0;D.opacityAlwaysOpaque=!1;break;case "size":D.size=!0}});return D}const q=()=>c.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
class v extends u.Loadable{constructor(y,D,E,A){super(E.schedule);this.symbol=y;this.symbolLayer=D;this._context=E;this.ignoreDrivers=!1;this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};this._materials=[];this.usedMemory=0;this.logger=q();this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};this.skipHighSymbolLodsChanged=!0;this._renderPriority=A.renderPriority;this._renderPriorityStep=A.renderPriorityStep;this._elevationContext=new g.ElevationContext;
this.complexity=this.computeComplexity();this.ignoreDrivers=A.ignoreDrivers;this.ignoreDrivers||(this._drivenProperties=w(this._context.renderer));this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(y){if(this.ignoreDrivers)return!1;const D=this._drivenProperties;y=w(y);return y.color!==D.color||y.opacity!==D.opacity||y.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||y.size!==D.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(y,D,E,A){const B="polygons"in y?y.polygons:null,F=`${A} geometry failed to be created`;let G=null;y.projectionSuccess?!this._logGeometryValidationWarnings(D,E,A)&&B&&0===B.length&&"rings"===E&&0<D.length&&2<D[0].length&&(G=`${F} (filled rings should use clockwise winding - try reversing the order of vertices)`):G=`${F} (failed to project geometry to view spatial reference)`;G&&q().warnOncePerTick(G)}_logGeometryValidationWarnings(y,
D,E){E=`${E} geometry failed to be created`;return!y.length||1===y.length&&!y[0].length?(q().warnOncePerTick(`${E} (no ${D} were defined)`),!0):Array.isArray(y)&&Array.isArray(y[0])?!1:(q().warnOncePerTick(`${E} (${D} should be defined as a 2D array)`),!0)}_validateGeometry(y,D=null,E=null){return null==D||D.includes(y.type)?"point"!==y.type||isFinite(y.x)&&isFinite(y.y)?!0:(q().warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+
E+` symbol: ${y.type}`),!1)}_defaultElevationInfoNoZ(){return p}_defaultElevationInfoZ(){return t}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()}getDefaultElevationInfo(y){return y.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(y,D=this.getDefaultElevationInfo(y)){return this._elevationContext.mode||D.mode}setElevationInfoOverride(y){this._elevationInfoOverride=y;this._updateElevationContext()}setGraphicElevationContext(y,D=new g.ElevationContext){var E=y.geometry;const A=this.getDefaultElevationInfo(E);D.unit=null!=this._elevationContext.unit?this._elevationContext.unit:
A.unit;D.mode=this.getGeometryElevationMode(E,A);D.offsetMeters=this._elevationContext.meterUnitOffset??A.offset??0;if(E=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode="relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(E?e.zeroContext:this._elevationContext.featureExpressionInfoContext,y,this._context.layer);return D}prepareSymbolLayerPatch(y){}updateGeometry(y,D){return!1}updateTransform(y,D,E,A){return!1}onRemoveGraphic(y){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&
"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const y=this._context.layer.opacity;return null==y?1:y}_getCombinedOpacity(y,D=r){let E=1;this.draped||(E*=this._getLayerOpacity());if(this._drivenProperties.opacity)return E;null!=y?E*=y.a:D.hasIntrinsicColor||(E=0);return E}_getCombinedOpacityAndColor(y,D=r){D=this._getCombinedOpacity(y,D);if(this._drivenProperties.color)return n.mixinColorAndOpacity(null,D);y=null!=y?b.toUnitRGB(y):k.ONES;return n.mixinColorAndOpacity(y,
D)}_getVertexOpacityAndColor(y,D=null){y=n.mixinColorAndOpacity(this._drivenProperties.color?y.color:null,this._drivenProperties.opacity?y.opacity:null);D&&(y[0]*=D,y[1]*=D,y[2]*=D,y[3]*=D);return y}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return d.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)}globalPropertyChanged(y,D,E){switch(y){case "opacity":return this.layerOpacityChanged(D,E),!0;case "elevationInfo":return y=this._elevationContext.mode,this._updateElevationContext(),
this.layerElevationInfoChanged(D,E,y)===f.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,E);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(y,D,E){let A=f.SymbolUpdateType.UPDATE;y.forEach(B=>{const F=D(B);null!=F?(this.setGraphicElevationContext(B.graphic,
F.elevationContext),F.needsElevationUpdates=E(F.elevationContext.mode)):A=f.SymbolUpdateType.RECREATE});return A}applyRendererDiff(y,D){return l.ApplyRendererDiffResult.RecreateSymbol}getFastUpdateAttrValues(y){if(!this._fastUpdates)return null;const D=this._fastUpdates.visualVariables,E=D.size?x.getAttributeValue(D.size.field,y):0,A=D.color?x.getAttributeValue(D.color.field,y):0;y=D.opacity?x.getAttributeValue(D.opacity.field,y):0;return m.fromValues(E,A,y,0)}get draped(){return this._draped}ensureDrapedStatus(y){if(null==
this._draped)return this._draped=y,!0;y!==this.draped&&q().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??
null})}}}const p={mode:"on-the-ground",offset:0,unit:"meters"},t={mode:"absolute-height",offset:0,unit:"meters"},r={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/defaultSymbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ./SymbolComplexity ../support/edgeUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,h,c,k,m,d,f){function g(q){let v=0,p=0,t=0,r=!1,y=0;const D=new m.SymbolComplexityMemory;for(const E of q)null!=E&&(v+=E.verticesPerFeature,p+=E.verticesPerCoordinate,t+=E.drawCallsPerFeature,D.bytesPerFeature+=E.memory.bytesPerFeature,D.bytesPerFeatureLabel+=E.memory.bytesPerFeatureLabel,D.resourceBytes+=E.memory.resourceBytes,D.draped.bytesPerFeature+=E.memory.bytesPerFeature,D.draped.bytesPerFeatureLabel+=E.memory.bytesPerFeatureLabel,r=r||E.estimated,++y);return r?new m.EstimatedAggregateSymbolComplexity(y,
{verticesPerFeature:v,verticesPerCoordinate:p,drawCallsPerFeature:t,memory:D}):new m.AggregateSymbolComplexity(y,{verticesPerFeature:v,verticesPerCoordinate:p,drawCallsPerFeature:t,memory:D})}function e(q,v){const p=n(q,v);var t=d.hasEdges(v)?2:0;switch(v.type){case "extrude":return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:t,memory:p});case "fill":if("mesh-3d"===q.type)return new m.SymbolComplexity({drawCallsPerFeature:t,memory:p});if(null!=v.outline&&
0<v.outline.size)return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:p});case "water":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:p});case "line":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:p});case "object":if(v.resource?.href)return new m.EstimatedSymbolComplexity({verticesPerFeature:100,memory:p});v=v.resource?.primitive??h.defaultPrimitive;(q=x[v])?v=q:(q=k.primitiveLodResources(v,
new f.DefaultMaterial({})),q=l(q.levels),x[v]=new m.SymbolComplexity({verticesPerFeature:q}),v=x[v]);return{...v,memory:p};case "path":var r=q=0;switch(v.profile){case "circle":q=c.pathNumCircleProfileSubdivisions;break;case "quad":q=4;break;default:b.neverReached(v.profile);return}switch(v.join??"simple"){case "round":r=c.pathNumRoundJoinSubdivisions;break;case "miter":case "bevel":r=1;break;default:return}t=2*q;r=q*r*2;let y=-2*r-t;switch(v.cap){case "none":break;case "butt":case "square":y+=2*
(q-1);break;case "round":y+=2*(q*(c.pathNumRoundCapExtrusionSubdivisions-1)*2+q);break;default:return}return new m.SymbolComplexity({verticesPerFeature:y,verticesPerCoordinate:r+t,memory:p});case "text":case "icon":return new m.SymbolComplexity({verticesPerFeature:6,memory:p})}}function n(q,v){q="point-3d"===q.type;switch(v.type){case "extrude":return v.edges&&0<v.edges.size?w.EXTRUDE_EDGES:w.EXTRUDE;case "fill":return null!=v.outline&&0<v.outline.size?w.FILL_OUTLINE:w.FILL;case "water":return w.FILL;
case "line":return"round"===v.join?w.LINE_ROUND:w.LINE_MITER;case "path":switch(v.join){case "round":switch(v.profile){case "circle":return w.PATH_ROUND_CIRCLE;case "quad":return w.PATH_ROUND_QUAD;default:b.neverReached(v.profile);return}case "miter":case "bevel":switch(v.profile){case "circle":return w.PATH_MITER_CIRCLE;case "quad":return w.PATH_MITER_QUAD;default:b.neverReached(v.profile);return}case "simple":return;default:return}case "object":return q?w.OBJECT_POINT:w.OBJECT_POLYGON;case "icon":case "text":return q?
w.ICON_POINT:w.ICON_POLYGON}}function l(q){return q.reduce((v,p,t)=>v+1/10**t*p.numVertices,0)/q.reduce((v,p,t)=>v+1/10**t,0)}const u=new m.EstimatedSymbolComplexity({}),x={},w={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,
bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,
resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,
resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,
resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,
bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};a.averageSymbolComplexities=function(q){q=g(q);0<q.numComplexities&&(q.verticesPerFeature/=q.numComplexities,q.verticesPerCoordinate/=q.numComplexities,q.drawCallsPerFeature/=q.numComplexities,q.memory.bytesPerFeature/=q.numComplexities,q.memory.bytesPerFeatureLabel/=q.numComplexities,q.memory.resourceBytes/=q.numComplexities,q.memory.draped.bytesPerFeature/=q.numComplexities,
q.memory.draped.bytesPerFeatureLabel/=q.numComplexities);return q};a.defaultSymbolComplexity=function(q){if("web-style"===q.type)return u;const v=q.symbolLayers.toArray().map(p=>e(q,p));return g(v)};a.defaultSymbolLayerComplexity=e;a.defaultSymbolLayerMemoryComplexity=n;a.emptySymbolComplexity=u;a.estimateNumVerticesForLods=l;a.memoryEstimators=w;a.totalSymbolComplexities=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],
function(a){a.pathNumCircleProfileSubdivisions=10;a.pathNumRoundCapExtrusionSubdivisions=3;a.pathNumRoundJoinSubdivisions=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,h,c){const k=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,
minScreenSpaceRadius:65}];a.isValidPrimitive=function(m){switch(m){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(m,d){const f=(g,e,n=!1)=>new c.LodResources(g.map(l=>{const u=e(l.tesselation);n&&h.cgToGIS(u);return new c.LodLevelResources([new c.LodComponentResources(u)],l.minScreenSpaceRadius)}));switch(m){case "sphere":return f([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,
minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],g=>h.createPolySphereGeometry(d,.5,g,!0));case "cube":return f([{tesselation:0,minScreenSpaceRadius:0}],()=>h.createBoxGeometry(d,1));case "cone":return f(k,g=>h.createConeGeometry(d,1,.5,g,!1),!0);case "inverted-cone":return f(k,g=>h.createConeGeometry(d,1,.5,g,!0),!0);case "cylinder":return f(k,g=>h.createCylinderGeometry(d,1,.5,g,[0,0,1],[0,0,.5]));case "tetrahedron":return f([{tesselation:0,
minScreenSpaceRadius:0}],()=>h.createTetrahedronGeometry(d,1),!0);case "diamond":return f([{tesselation:0,minScreenSpaceRadius:0}],()=>h.createDiamondGeometry(d,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../VertexAttribute"],function(a,b,h){class c{constructor(d,f=null){this.geometry=d;this.textures=f}}class k{constructor(d,f,g){this.components=d;
this.minScreenSpaceRadius=f;this.pivotOffset=g;this.numVertices=this.geometries.reduce((e,n)=>e+n.attributes.get(h.VertexAttribute.POSITION).indices.length,0)}get geometries(){return b.unique(this.components.map(d=>d.geometry))}}class m{constructor(d){this.levels=d;this.levels.sort((f,g)=>f.minScreenSpaceRadius===g.minScreenSpaceRadius?f.numVertices-g.numVertices:f.minScreenSpaceRadius-g.minScreenSpaceRadius)}}a.LodComponentResources=c;a.LodLevelResources=k;a.LodResources=m;a.geometriesFromLodResources=
function(d){const f=[];d.levels.forEach(g=>g.components.forEach(e=>f.push(e.geometry)));return b.unique(f)};a.materialsFromLodResources=function(d){const f=[];d.levels.forEach(g=>g.components.forEach(e=>f.push(e.geometry.material)));return b.unique(f)};a.texturesFromLodResources=function(d){const f=[];d.levels.forEach(g=>g.components.forEach(e=>{null!=e.textures&&f.push(...e.textures)}));return b.unique(f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SymbolComplexity":function(){define(["exports"],
function(a){class b{constructor(d){this.estimated=!1;this.verticesPerFeature=d.verticesPerFeature??0;this.verticesPerCoordinate=d.verticesPerCoordinate??0;this.drawCallsPerFeature=d.drawCallsPerFeature??0;this.memory=d.memory??new m}}class h extends b{constructor(d){super(d);this.estimated=!0}}class c extends b{constructor(d,f){super(f);this.numComplexities=d}}class k extends h{constructor(d,f){super(f);this.numComplexities=d}}class m{constructor(){this.resourceBytes=this.bytesPerFeatureLabel=this.bytesPerFeature=
0;this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}a.AggregateSymbolComplexity=c;a.EstimatedAggregateSymbolComplexity=k;a.EstimatedSymbolComplexity=h;a.SymbolComplexity=b;a.SymbolComplexityMemory=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,h,c,k,m,d){function f(l,u){if(null==l)return null;const x=null!=l.color?k.fromArray(b.toUnitRGBA(l.color)):k.fromValues(0,0,0,0),w=c.pt2px(l.size),q=c.pt2px(l.extensionLength);switch(l.type){case "solid":return g({color:x,size:w,extensionLength:q,...u});case "sketch":return{...n,color:x,size:w,extensionLength:q,...u,type:"sketch"}}}function g(l){return{...e,...l,type:"solid"}}const e={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:d.Transparency.OPAQUE,
hasSlicePlane:!1},n={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:d.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(l,u){return f(l&&l.enabled&&l.edges||null,u)};a.createMaterialFromEdges=f;a.createSolidEdgeMaterial=g;a.hasEdges=function(l){return l&&l.enabled&&(m.isExtrudeSymbol3DLayer(l)||m.isFillSymbol3DLayer(l))&&null!=l.edges};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(M){const S=m.newLayout().vec3f(q.VertexAttribute.POSITION);M.normalType===f.NormalType.Compressed?S.vec2i16(q.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):S.vec3f(q.VertexAttribute.NORMAL);M.hasVertexTangents&&S.vec4f(q.VertexAttribute.TANGENT);(M.textureId||M.normalTextureId||M.metallicRoughnessTextureId||M.emissiveTextureId||M.occlusionTextureId)&&S.vec2f(q.VertexAttribute.UV0);M.hasVertexColors&&S.vec4u8(q.VertexAttribute.COLOR);
M.hasSymbolColors&&S.vec4u8(q.VertexAttribute.SYMBOLCOLOR);b("enable-feature:objectAndLayerId-rendering")&&S.vec4u8(q.VertexAttribute.OBJECTANDLAYERIDCOLOR);return S}class A extends u.Material{constructor(M){super(M,G);this.supportsEdges=!0;this.produces=new Map([[w.RenderSlot.OPAQUE_MATERIAL,S=>(d.is3DGeometryOutput(S)||d.isShadowRelatedOutput(S))&&!this.parameters.transparent],[w.RenderSlot.TRANSPARENT_MATERIAL,S=>(d.is3DGeometryOutput(S)||d.isShadowRelatedOutput(S))&&this.parameters.transparent&&
this.parameters.writeDepth],[w.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,S=>(d.is3DGeometryOutput(S)||d.isShadowRelatedOutput(S))&&this.parameters.transparent&&!this.parameters.writeDepth]]);this._configuration=new y.DefaultMaterialTechniqueConfiguration;this._vertexBufferLayout=E(this.parameters)}isVisibleForOutput(M){return M===d.ShaderOutput.Shadow||M===d.ShaderOutput.ShadowExcludeHighlight||M===d.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){var M=this.parameters;
if(!super.isVisible()||0===M.layerOpacity)return!1;const {hasInstancedColor:S,hasVertexColors:N,hasSymbolColors:V,vvColor:Q}=M,T="replace"===M.colorMixMode,ia=0<M.opacity;M=M.externalColor&&0<M.externalColor[3];const O=S||Q||V;return N&&O?T||ia:N?T?M:ia:O?T||ia:T?M:ia}getConfiguration(M,S){this._configuration.output=M;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;
this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=
this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?n.CullFaceOptions.None:this.parameters.cullFace;this._configuration.multipassEnabled=
S.multipassEnabled;this._configuration.cullAboveGround=S.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(M===d.ShaderOutput.Color||M===d.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?g.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===
this.parameters.doubleSidedType?g.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?g.NormalsDoubleSidedMode.WindingOrder:g.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=null!=S.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=
!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?e.PBRMode.Schematic:e.PBRMode.Normal:e.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),
this._configuration.transparencyPassType=S.transparencyPassType,this._configuration.enableOffset=S.camera.relativeElevation<x.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(S),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=
!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration}hasSnowCover(M){return null!=M.weather&&M.weatherVisible&&"snowy"===M.weather.type&&"enabled"===M.weather.snowCover}intersect(M,S,N,V,Q,T){if(null!=this.parameters.verticalOffset){const O=N.camera;h.set(K,S[12],S[13],S[14]);S=null;switch(N.viewingMode){case k.ViewingMode.Global:S=h.normalize(z,K);break;case k.ViewingMode.Local:S=
h.copy(z,C)}let U=0;var ia=h.subtract(I,K,O.eye);const P=h.length(ia);ia=h.scale(ia,ia,1/P);let R=null;this.parameters.screenSizePerspective&&(R=h.dot(S,ia));U+=t.verticalOffsetAtDistance(O,P,this.parameters.verticalOffset,R??0,this.parameters.screenSizePerspective);h.scale(S,S,U);h.transformMat3(J,S,N.transform.inverseRotation);V=h.subtract(H,V,J);Q=h.subtract(L,Q,J)}t.intersectTriangleGeometry(M,N,V,Q,v.getVerticalOffsetObject3D(N.verticalOffset),T)}createGLMaterial(M){return new B(M)}createBufferWriter(){return new p.DefaultBufferWriter(this._vertexBufferLayout)}}
class B extends l.GLTextureMaterial{constructor(M){super({...M,...M.material.parameters})}_updateShadowState(M){M.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:M.shadowMap.enabled})}_updateOccludeeState(M){M.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:M.hasOccludees})}beginSlot(M){if(this._output===d.ShaderOutput.Color||this._output===d.ShaderOutput.Alpha)this._updateShadowState(M),
this._updateOccludeeState(M);const S=this._material.parameters;this.updateTexture(S.textureId);const N=M.camera.viewInverseTransposeMatrix;h.set(S.origin,N[3],N[7],N[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(S.treeRendering?D.RealisticTreeTechnique:r.DefaultMaterialTechnique,M)}}class F extends r.DefaultMaterialPassParameters{constructor(){super(...arguments);this.hasVertexTangents=this.treeRendering=this.initTextureTransparent=!1}}const G=new F,H=c.create(),
L=c.create(),C=c.fromValues(0,0,1),z=c.create(),J=c.create(),K=c.create(),I=c.create();a.DefaultGLMaterial=B;a.DefaultMaterial=A;a.DefaultMaterialParameters=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,h,c){a.NormalType=void 0;(function(k){k[k.Attribute=
0]="Attribute";k[k.Compressed=1]="Compressed";k[k.Ground=2]="Ground";k[k.ScreenDerivative=3]="ScreenDerivative";k[k.COUNT=4]="COUNT"})(a.NormalType||(a.NormalType={}));a.NormalAttribute=function(k,m){switch(m.normalType){case a.NormalType.Compressed:k.attributes.add(c.VertexAttribute.NORMALCOMPRESSED,"vec2");k.vertex.code.add(h.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case a.NormalType.Attribute:k.attributes.add(c.VertexAttribute.NORMAL,"vec3");k.vertex.code.add(h.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalType.ScreenDerivative:k.fragment.code.add(h.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(m.normalType);case a.NormalType.COUNT:case a.NormalType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,h){a.NormalsDoubleSidedMode=void 0;(function(c){c[c.None=0]="None";c[c.View=1]="View";c[c.WindingOrder=2]="WindingOrder";c[c.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||
(a.NormalsDoubleSidedMode={}));a.Normals=function(c,k){c=c.fragment;c.code.add(h.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(k.doubleSidedMode){case a.NormalsDoubleSidedMode.None:c.code.add(h.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:c.code.add(h.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:c.code.add(h.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(k.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,b,h){class c{constructor(k){this.vertexBufferLayout=k}elementCount(k){return k.attributes.get(b.VertexAttribute.POSITION).indices.length}write(k,m,d,f,g){h.writeDefaultAttributes(d,this.vertexBufferLayout,
k,m,f,g)}}a.DefaultBufferWriter=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){class A extends g.VertexNormalPassParameters{constructor(){super(...arguments);this.usePBR=this.isSchematic=!1;this.mrrFactors=h.fromArray(r.defaultAdvancedMRRFactors);this.doubleSided=this.hasSymbolColors=this.hasVertexColors=!1;this.doubleSidedType="normal";this.cullFace=u.CullFaceOptions.Back;this.hasInstancedColor=this.isInstanced=!1;this.emissiveFactor=h.fromValues(0,0,0);this.instancedDoublePrecision=!1;this.normalType=d.NormalType.Attribute;
this.castShadows=this.receiveShadows=!0;this.shadowMappingEnabled=!1;this.ambient=h.fromValues(.2,.2,.2);this.diffuse=h.fromValues(.8,.8,.8);this.externalColor=c.fromValues(1,1,1,1);this.colorMixMode="multiply";this.layerOpacity=this.opacity=1;this.origin=h.create();this.hasSlicePlane=!1;this.hasSliceHighlight=!0;this.offsetTransparentBackfaces=!1;this.modelTransformation=this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.transparent=!1;this.writeDepth=
!0;this.customDepthTest=u.DepthTestFunction.Less;this.textureAlphaMode=u.AlphaDiscardMode.Blend;this.textureAlphaCutoff=e.defaultMaskAlphaCutoff;this.hasOccludees=this.textureAlphaPremultiplied=!1;this.renderOccluded=w.RenderOccludedFlag.Occlude;this.isDecoration=!1}}class B extends g.VertexNormalDrawParameters{constructor(){super(...arguments);this.slicePlaneLocalOrigin=this.origin=h.create()}}class F extends l.ShaderTechnique{initializeConfiguration(G,H){H.spherical=G.viewingMode===k.ViewingMode.Global;
H.doublePrecisionRequiresObfuscation=G.rctx.driverTest.doublePrecisionRequiresObfuscation.result;H.textureCoordinateType=H.hasColorTexture||H.hasMetallicRoughnessTexture||H.hasEmissionTexture||H.hasOcclusionTexture||H.hasNormalTexture?f.TextureCoordinateAttributeType.Default:f.TextureCoordinateAttributeType.None;H.objectAndLayerIdColorInstanced=H.instanced}initializeProgram(G){return this._initializeProgram(G,F.shader)}_initializeProgram(G,H){return new v.Program(G.rctx,H.get().build(this.configuration),
x.Default3D)}_convertDepthTestFunction(G){return G===u.DepthTestFunction.Lequal?D.CompareFunction.LEQUAL:D.CompareFunction.LESS}_makePipeline(G,H){const L=this.configuration,C=G===t.TransparencyPassType.NONE,z=G===t.TransparencyPassType.FrontFace;var J=E.makePipelineState,K=L.output!==m.ShaderOutput.Color&&L.output!==m.ShaderOutput.Alpha||!L.transparent?null:C?q.blendingDefault:q.oitBlending(G);var I=L.cullFace!==u.CullFaceOptions.None?!0:L.hasSlicePlane?!1:!L.transparent&&!L.doubleSidedMode;return J.call(E,
{blending:K,culling:I?E.cullingParams(L.cullFace):null,depthTest:{func:q.oitDepthTest(G,this._convertDepthTestFunction(L.customDepthTest))},depthWrite:C||z?L.writeDepth?E.defaultDepthWriteParams:null:null,colorWrite:E.defaultColorWriteParams,stencilWrite:L.hasOccludees?p.stencilWriteMaskOn:null,stencilTest:L.hasOccludees?H?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null,polygonOffset:C||z?null:q.getOITPolygonOffset(L.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,
!0);return this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(G){return G?this._occludeePipelineState:super.getPipeline()}}F.shader=new n.ReloadableShaderModule(y.DefaultMaterial,()=>new Promise((G,H)=>a(["./DefaultMaterial.glsl"],G,H)));b.DefaultMaterialDrawParameters=B;b.DefaultMaterialPassParameters=A;b.DefaultMaterialTechnique=F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends m.VertexPositionPassParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=h.create()}}class n extends m.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalGlobalFromModel=h.create();this.toMapSpace=c.create()}}a.VertexNormal=function(l,u){switch(u.normalType){case k.NormalType.Attribute:case k.NormalType.Compressed:l.include(k.NormalAttribute,u);l.varyings.add("vNormalWorld","vec3");l.varyings.add("vNormalView",
"vec3");l.vertex.uniforms.add(new f.Matrix3DrawUniform("transformNormalGlobalFromModel",x=>x.transformNormalGlobalFromModel),new g.Matrix3PassUniform("transformNormalViewFromGlobal",x=>x.transformNormalViewFromGlobal));l.vertex.code.add(d.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case k.NormalType.Ground:l.include(m.VertexPosition,u);l.varyings.add("vNormalWorld","vec3");l.vertex.code.add(d.glsl`
        void forwardNormal() {
          vNormalWorld = ${u.spherical?d.glsl`normalize(vPositionWorldCameraRelative);`:d.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case k.NormalType.ScreenDerivative:l.vertex.code.add(d.glsl`void forwardNormal() {}`);break;default:b.neverReached(u.normalType);case k.NormalType.COUNT:}};a.VertexNormalDrawParameters=n;a.VertexNormalPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,h){const c={func:h.CompareFunction.LESS},k={function:{func:h.CompareFunction.ALWAYS,
ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.ZERO}},m={function:{func:h.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.REPLACE}},d={function:{func:h.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.KEEP}};b={function:{func:h.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.KEEP}};a.depthCompareAlways={func:h.CompareFunction.ALWAYS};a.depthCompareLess=c;a.renderWhenBitIsNotSet=f=>({function:{func:h.CompareFunction.NOTEQUAL,
ref:f,mask:f},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=f=>({function:{func:h.CompareFunction.ALWAYS,ref:f,mask:f},operation:{fail:h.StencilOperation.KEEP,zFail:h.StencilOperation.KEEP,zPass:h.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=k;a.stencilToolMaskBaseParams=m;a.stencilToolMaskOccluderParams=d;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn=
{mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,h){a.defaultAdvancedMRRFactors=[1,1,.5];a.defaultEsriSymbologyMRRFactors=[0,1,.2];a.defaultSchematicMRRFactors=[0,.6,.2];a.useSchematicPBR=function({normalTexture:c,metallicRoughnessTexture:k,metallicFactor:m,roughnessFactor:d,emissiveTexture:f,emissiveFactor:g,
occlusionTexture:e}){return null==c&&null==k&&null==f&&(null==g||b.exactEquals(g,h.ZEROS))&&null==e&&(null==d||1===d)&&(null==m||1===m)};a.useSchematicPBRI3S=function({normalTexture:c,metallicRoughnessTexture:k,metallicFactor:m,roughnessFactor:d,emissiveTexture:f,emissiveFactor:g,occlusionTexture:e}){return null==c&&null==k&&null==f&&(null==g||b.exactEquals(g,h.ZEROS))&&null==e&&(null==d||1===d)&&(null==m||1===m||0===m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V){function Q(ia){const O=new M.ShaderBuilder,{vertex:U,fragment:P,varyings:R}=O;C.addProjViewLocalOrigin(U,ia);O.include(g.PositionAttribute);R.add("vpos","vec3");O.include(F.VisualVariables,ia);O.include(d.InstancedDoublePrecision,ia);O.include(x.VerticalOffset,ia);O.include(B.colorTextureUV,ia);if(ia.output===c.ShaderOutput.Color||ia.output===c.ShaderOutput.Alpha){O.include(B.normalTextureUV,ia);O.include(B.emissiveTextureUV,
ia);O.include(B.occlusionTextureUV,ia);O.include(B.metallicRoughnessTextureUV,ia);C.addCameraPosition(U,ia);O.include(f.NormalAttribute,ia);O.include(m.Transform,ia);const ba=ia.normalType===f.NormalType.Attribute||ia.normalType===f.NormalType.Compressed;ba&&ia.offsetBackfaces&&O.include(h.Offset);O.include(q.ComputeNormalTexture,ia);O.include(u.VertexNormal,ia);ia.instancedColor&&O.attributes.add(V.VertexAttribute.INSTANCECOLOR,"vec4");R.add("vPositionLocal","vec3");O.include(n.TextureCoordinateAttribute,
ia);O.include(b.ForwardLinearDepth,ia);O.include(e.SymbolColor,ia);O.include(l.VertexColor,ia);U.uniforms.add(new J.Float4PassUniform("externalColor",X=>X.externalColor));R.add("vcolorExt","vec4");ia.multipassEnabled&&R.add("depth","float");U.code.add(I.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${ia.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${I.glsl.float(G.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${ba?I.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${ia.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${ba&&ia.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${ia.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `)}switch(ia.output){case c.ShaderOutput.Alpha:O.include(k.SliceDraw,ia);O.include(H.DiscardOrAdjustAlphaPass,ia);O.include(r.multipassTerrainTest,ia);P.uniforms.add(new K.FloatPassUniform("opacity",ba=>ba.opacity),new K.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity));ia.hasColorTexture&&P.uniforms.add(new S.Texture2DPassUniform("tex",ba=>ba.texture));P.include(L.MixExternalColor);P.code.add(I.glsl`
      void main() {
        discardBySlice(vpos);
        ${ia.multipassEnabled?"terrainDepthTest(depth);":""}
        ${ia.hasColorTexture?I.glsl`
                vec4 texColor = texture(tex, ${ia.hasColorTextureTransform?I.glsl`colorUV`:I.glsl`vuv0`});
                ${ia.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I.glsl`vec4 texColor = vec4(1.0);`}
        ${ia.hasVertexColors?I.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case c.ShaderOutput.Color:O.include(k.SliceDraw,ia),O.include(p.EvaluateSceneLighting,ia),O.include(v.EvaluateAmbientOcclusion,ia),O.include(H.DiscardOrAdjustAlphaPass,ia),O.include(ia.instancedDoublePrecision?A.ReadShadowMapPass:A.ReadShadowMapDraw,ia),O.include(r.multipassTerrainTest,ia),C.addCameraPosition(P,ia),P.uniforms.add(U.uniforms.get("localOrigin"),new z.Float3PassUniform("ambient",ba=>ba.ambient),new z.Float3PassUniform("diffuse",ba=>ba.diffuse),new K.FloatPassUniform("opacity",
ba=>ba.opacity),new K.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity)),ia.hasColorTexture&&P.uniforms.add(new S.Texture2DPassUniform("tex",ba=>ba.texture)),O.include(E.PhysicallyBasedRenderingParameters,ia),O.include(D.PhysicallyBasedRendering,ia),P.include(L.MixExternalColor),O.include(y.Normals,ia),p.addAmbientBoostFactor(P),p.addLightingGlobalFactor(P),t.addMainLightIntensity(P),P.code.add(I.glsl`
      void main() {
        discardBySlice(vpos);
        ${ia.multipassEnabled?"terrainDepthTest(depth);":""}
        ${ia.hasColorTexture?I.glsl`
                vec4 texColor = texture(tex, ${ia.hasColorTextureTransform?I.glsl`colorUV`:I.glsl`vuv0`});
                ${ia.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${ia.normalType===f.NormalType.ScreenDerivative?I.glsl`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:I.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${ia.pbrMode===E.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${ia.receiveShadows?"readShadowMap(vpos, linearDepth)":ia.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${ia.hasVertexColors?I.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${ia.hasNormalTexture?I.glsl`
                mat3 tangentSpace = ${ia.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${ia.hasNormalTextureTransform?I.glsl`normalUV`:"vuv0"});`:I.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${ia.spherical?I.glsl`normalize(posWorld);`:I.glsl`vec3(0.0, 0.0, 1.0);`}

        ${ia.snowCover?I.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${ia.pbrMode===E.PBRMode.Normal||ia.pbrMode===E.PBRMode.Schematic?I.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${ia.snowCover?I.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:I.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${ia.transparencyPassType===N.TransparencyPassType.Color?I.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}O.include(w.DefaultMaterialAuxiliaryPasses,ia);return O}const T=Object.freeze(Object.defineProperty({__proto__:null,build:Q},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=T;a.build=Q})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(h){h.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,h,c,k,m){a.SymbolColor=function(d,f){f.hasSymbolColors?(d.include(b.DecodeSymbolColor),d.attributes.add(k.VertexAttribute.SYMBOLCOLOR,
"vec4"),d.varyings.add("colorMixMode","mediump float"),d.vertex.code.add(c.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(d.fragment.uniforms.add(new h.IntegerPassUniform("colorMixMode",g=>m.colorMixModes[g.colorMixMode])),d.vertex.code.add(c.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,h){a.DecodeSymbolColor=function(c){c.vertex.code.add(h.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${h.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${h.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${h.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${h.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(a,b){a.ColorMixModeEnum=void 0;(function(h){h[h.Multiply=1]="Multiply";h[h.Ignore=2]="Ignore";h[h.Replace=3]="Replace";h[h.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(h,c,k){if(null==h||c===a.ColorMixModeEnum.Ignore)k[0]=255,k[1]=255,k[2]=255,k[3]=255;else{var m=b.clamp(Math.round(85*
h[3]),0,85);c=0===m||c===a.ColorMixModeEnum.Tint?0:c===a.ColorMixModeEnum.Replace?85:170;k[0]=b.clamp(Math.round(255*h[0]),0,255);k[1]=b.clamp(Math.round(255*h[1]),0,255);k[2]=b.clamp(Math.round(255*h[2]),0,255);k[3]=m+c}};a.parseColorMixMode=function(h){switch(h){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"int",h.BindType.Pass,(d,f,g)=>d.setUniform1i(k,m(f,g)))}}a.IntegerPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(a,b,h){a.VertexColor=function(c,k){k.hasVertexColors?(c.attributes.add(h.VertexAttribute.COLOR,"vec4"),c.varyings.add("vColor","vec4"),c.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),c.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):c.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){a.DefaultMaterialAuxiliaryPasses=function(p,t){const {vertex:r,fragment:y}=p,D=t.hasColorTexture&&t.alphaDiscardMode!==v.AlphaDiscardMode.Opaque;switch(t.output){case h.ShaderOutput.LinearDepth:case h.ShaderOutput.Shadow:case h.ShaderOutput.ShadowHighlight:case h.ShaderOutput.ShadowExcludeHighlight:case h.ShaderOutput.ObjectAndLayerIdColor:x.addProjViewLocalOrigin(r,t);p.include(k.Transform,t);p.include(f.TextureCoordinateAttribute,t);p.include(l.VisualVariables,
t);p.include(e.OutputDepth,t);p.include(c.SliceDraw,t);p.include(d.ObjectAndLayerIdColor,t);b.addNearFar(p);p.varyings.add("depth","float");D&&y.uniforms.add(new q.Texture2DPassUniform("tex",E=>E.texture));r.code.add(w.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`);p.include(u.DiscardOrAdjustAlphaPass,t);y.code.add(w.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===h.ShaderOutput.ObjectAndLayerIdColor?w.glsl`outputObjectAndLayerIdColor();`:w.glsl`outputDepth(depth);`}
          }
        `);break;case h.ShaderOutput.Normal:x.addProjViewLocalOrigin(r,t);p.include(k.Transform,t);p.include(m.NormalAttribute,t);p.include(g.VertexNormal,t);p.include(f.TextureCoordinateAttribute,t);p.include(l.VisualVariables,t);D&&y.uniforms.add(new q.Texture2DPassUniform("tex",E=>E.texture));t.normalType===m.NormalType.ScreenDerivative&&p.varyings.add("vPositionView","vec3");r.code.add(w.glsl`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${t.normalType===m.NormalType.Attribute||t.normalType===m.NormalType.Compressed?w.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:w.glsl`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `);p.include(c.SliceDraw,t);p.include(u.DiscardOrAdjustAlphaPass,t);y.code.add(w.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===m.NormalType.ScreenDerivative?w.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:w.glsl`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break;case h.ShaderOutput.Highlight:x.addProjViewLocalOrigin(r,t),p.include(k.Transform,t),p.include(f.TextureCoordinateAttribute,t),p.include(l.VisualVariables,t),D&&y.uniforms.add(new q.Texture2DPassUniform("tex",E=>E.texture)),r.code.add(w.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),p.include(c.SliceDraw,t),p.include(u.DiscardOrAdjustAlphaPass,t),p.include(n.OutputHighlight,t),y.code.add(w.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloat16Encoding.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,h,c,k){a.OutputDepth=function(m,d){switch(d.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:m.fragment.include(h.Rgba4FloatEncoding);
m.fragment.code.add(k.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.LinearDepth:m.fragment.include(c.RgbaFloatEncoding),m.fragment.code.add(k.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Rgba4FloatEncoding=function(h){h.code.add(b.glsl`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,h,c,k,m){function d(f,g,e){const n=f.fragment;g.alphaDiscardMode!==m.AlphaDiscardMode.Mask&&g.alphaDiscardMode!==m.AlphaDiscardMode.MaskBlend||
n.uniforms.add(e);switch(g.alphaDiscardMode){case m.AlphaDiscardMode.Blend:return f.include(b.DiscardOrAdjustAlphaBlend);case m.AlphaDiscardMode.Opaque:n.code.add(k.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case m.AlphaDiscardMode.Mask:n.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case m.AlphaDiscardMode.MaskBlend:f.fragment.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(f,g){d(f,g,new h.FloatDrawUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(f,g){d(f,g,new c.FloatPassUniform("textureAlphaCutoff",
e=>e.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,h){a.DiscardOrAdjustAlphaBlend=function(c){c.fragment.code.add(h.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${h.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"float",h.BindType.Draw,(d,f,g)=>d.setUniform1f(k,m(f,g)))}}a.FloatDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g){a.ComputeNormalTexture=function(e,n){const l=e.fragment;n.hasVertexTangents?(e.attributes.add(g.VertexAttribute.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),n.doubleSidedMode===c.NormalsDoubleSidedMode.WindingOrder?l.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):l.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):l.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);n.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(e.include(h.VertexTextureCoordinates,n),l.uniforms.add(n.pbrTextureBindType===f.BindType.Pass?new d.Texture2DPassUniform("normalTexture",u=>u.textureNormal):new m.Texture2DDrawUniform("normalTexture",u=>u.textureNormal)),l.code.add(k.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../effects/ssao/SSAO"],function(a,b,h,c){a.EvaluateAmbientOcclusion=function(k,m){k=k.fragment;m.receiveAmbientOcclusion?(k.uniforms.add(new h.Texture2DPassUniform("ssaoTex",(d,f)=>f.ssao?.getTexture())),k.constants.add("blurSizePixelsInverse",
"float",1/c.blurSizePixels),k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../webgl/ManagedFBO ../RenderPlugin ./SSAOBlurTechnique ./SSAONoiseData ./SSAOParameters ./SSAOTechnique ../../lib/RenderFeature ../../lib/RenderSlot ../../../../../chunks/SSAO.glsl ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){a.SSAO=class extends u.SyncRenderPlugin{constructor(A){super(A);this._context=null;this._passParameters=new q.SSAOPassParameters;this._drawParameters=new q.BlurDrawParameters;this.produces=new Map([[t.RenderSlot.SSAO,()=>this._produces()]])}_produces(){return null!=this._enableTime&&null!=this._context}consumes(){return this._produces()?u.ConsumesDepthNormal:u.ConsumesNone}initializeRenderContext(A){this._context=A;this.addHandles([c.watch(()=>
this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(p.RenderFeature.SSAO),B=>B?this._enable():this._disable(),c.syncAndInitial)])}uninitializeRenderContext(){this._disable();this._context=null}_disable(){this._passParameters.noiseTexture=h.disposeMaybe(this._passParameters.noiseTexture);this._enableTime=null}destroy(){this._disable()}_enable(){if(null==this._enableTime&&this._context){var A=Uint8Array.from(atob(w.noiseData),F=>F.charCodeAt(0)),B=new E.TextureDescriptor;B.wrapMode=
y.TextureWrapMode.CLAMP_TO_EDGE;B.pixelFormat=y.PixelFormat.RGB;B.wrapMode=y.TextureWrapMode.REPEAT;B.hasMipmap=!0;B.width=32;B.height=32;this._passParameters.noiseTexture=new D.Texture(this._context.renderContext.rctx,B,A);null==this._ssaoTechnique&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(v.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(x.SSAOBlurTechnique));this._enableTime=k.Milliseconds(0);this._context?.requestRender()}}renderNode(A,
B,F){B=A.bindParameters;F=F?.get("normals");var G=F?.getTexture(),H=F?.getTexture(y.DepthStencilAttachment);if(null!=this._enableTime&&null!=this._context&&G&&H){if(this._ssaoTechnique.compiled&&this._blurTechnique.compiled){0===this._enableTime&&(this._enableTime=A.time);F=A.rctx;var L=B.camera,C=this.view.qualitySettings.fadeDuration;A=0<C?Math.min(C,A.time-this._enableTime)/C:1;this._passParameters.normalTexture=G;this._passParameters.depthTexture=H;this._passParameters.projScale=1/L.computeScreenPixelSizeAtDist(1);
this._passParameters.intensity=2/r.getRadius(L)**6*A;G=L.fullViewport[2];H=L.fullViewport[3];C=Math.round(G/2);var z=Math.round(H/2),J=this._context.fbos,K=J.acquire(G,H,"ssao input",l.ColorFormat.RG);F.setViewport(0,0,G,H);F.bindTechnique(this._ssaoTechnique,B,this._passParameters,this._drawParameters);F.screen.draw();var I=J.acquire(C,z,"ssao blur",l.ColorFormat.RED);this._drawParameters.colorTexture=K.getTexture();n.set(this._drawParameters.blurSize,0,2/H);F.bindTechnique(this._blurTechnique,B,
this._passParameters,this._drawParameters);F.setViewport(0,0,C,z);F.screen.draw();K.release();J=J.acquire(C,z,"ssao",l.ColorFormat.RED);F.setViewport(0,0,G,H);F.setClearColor(1,1,1,0);F.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._drawParameters.colorTexture=I.getTexture();n.set(this._drawParameters.blurSize,2/G,0);F.bindTechnique(this._blurTechnique,B,this._passParameters,this._drawParameters);F.setViewport(0,0,C,z);F.screen.draw();F.setViewport4fv(L.fullViewport);I.release();1>A&&this._context.requestRender();
return J}this._enableTime=A.time;this._context.requestRender()}}};b.__decorate([m.property({constructOnly:!0})],a.SSAO.prototype,"view",void 0);b.__decorate([m.property()],a.SSAO.prototype,"_context",void 0);a.SSAO=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],a.SSAO);a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAOBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.SSAOBlur,()=>new Promise((e,n)=>a(["../../shaders/SSAOBlur.glsl"],e,n)));b.SSAOBlurTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec32 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(){const x=new g.ShaderBuilder,w=x.fragment;x.include(h.ScreenSpacePass);w.include(c.ReadDepth);w.uniforms.add(new n.Texture2DPassUniform("depthMap",q=>q.depthTexture),new e.Texture2DDrawUniform("tex",q=>q.colorTexture),new k.Float2DrawUniform("blurSize",q=>q.blurSize),new d.FloatPassUniform("projScale",(q,v)=>{v=b.distance(v.camera.eye,v.camera.center);return 5E4<v?Math.max(0,q.projScale-(v-5E4)):q.projScale}),new m.Float2PassUniform("nearFar",(q,v)=>v.camera.nearFar));
w.code.add(f.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromDepthTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${f.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);x.outputs.add("fragBlur","float");w.code.add(f.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromDepthTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${f.glsl.int(4)}; r <= ${f.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `);return x}const u=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=u;a.build=l})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec2",h.BindType.Draw,(d,f,g,e)=>d.setUniform2fv(k,m(f,g,e)))}}a.Float2DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../core/shaderModules/interfaces"],function(a,b,h){class c extends h.NoParameters{constructor(){super(...arguments);this.projScale=1}}class k extends c{constructor(){super(...arguments);this.intensity=1}}class m extends h.NoParameters{}class d extends m{constructor(){super(...arguments);this.blurSize=
b.create()}}a.BlurDrawParameters=d;a.BlurPassParameters=c;a.SSAODrawParameters=m;a.SSAOPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAO.glsl ../../../../webgl/renderState".split(" "),function(a,b,h,
c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.SSAO,()=>new Promise((e,n)=>a(["../../shaders/SSAO.glsl"],e,n)));b.SSAOTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(){const w=new e.ShaderBuilder,q=w.fragment;w.include(c.ScreenSpacePass);w.include(m.CameraSpace);q.include(k.ReadDepth);q.uniforms.add(new f.FloatPassUniform("radius",(v,p)=>u(p.camera)));q.code.add(g.glsl`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);q.code.add(g.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);q.uniforms.add(new d.Float2PassUniform("nearFar",(v,p)=>p.camera.nearFar),new n.Texture2DPassUniform("normalMap",v=>v.normalTexture),new n.Texture2DPassUniform("depthMap",v=>v.depthTexture),new f.FloatPassUniform("projScale",v=>v.projScale),new n.Texture2DPassUniform("rnm",v=>v.noiseTexture),new d.Float2PassUniform("rnmScale",(v,p)=>b.set(x,p.camera.fullWidth/v.noiseTexture.descriptor.width,p.camera.fullHeight/v.noiseTexture.descriptor.height)),new f.FloatPassUniform("intensity",v=>v.intensity),
new d.Float2PassUniform("screenSize",(v,p)=>b.set(x,p.camera.fullWidth,p.camera.fullHeight)));w.outputs.add("fragOcclusion","float");q.code.add(g.glsl`
    void main(void) {
      float currentPixelDepth = linearDepthFromDepthTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${g.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromDepthTexture(depthMap, tcTap, nearFar);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${g.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `);return w}function u(w){return Math.max(10,20*w.computeScreenPixelSizeAtDist(Math.abs(4*w.relativeElevation)))}const x=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:l,getRadius:u},Symbol.toStringTag,{value:"Module"}));a.SSAO=h;a.build=l;a.getRadius=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,h,c,k,m,d,f){function g(u){const x=u.projectionMatrix;return 0===x[11]?c.set(n,2/(u.fullWidth*x[0]),2/(u.fullHeight*x[5]),(1+x[12])/x[0],(1+x[13])/x[5]):c.set(n,-2/(u.fullWidth*x[0]),-2/(u.fullHeight*x[5]),(1-x[8])/x[0],(1-x[9])/x[5])}function e(u){return 0===u.projectionMatrix[11]?b.set(l,0,1):b.set(l,1,0)}const n=k.create(),l=h.create();a.CameraSpace=function(u){u.fragment.uniforms.add(new d.Float4PassUniform("projInfo",(x,w)=>g(w.camera)));u.fragment.uniforms.add(new m.Float2PassUniform("zScale",
(x,w)=>e(w.camera)));u.fragment.code.add(f.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getProjectionInfo=g;a.getZScale=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(w){w.constants.add("ambientBoostFactor","float",l.ambientBoost)}function x(w){w.uniforms.add(new e.FloatPassUniform("lightingGlobalFactor",(q,v)=>v.lighting.globalFactor))}a.EvaluateSceneLighting=function(w,q){const v=w.fragment;w.include(c.EvaluateAmbientOcclusion,q);q.pbrMode!==d.PBRMode.Disabled&&w.include(m.PhysicallyBasedRendering,q);w.include(h.EvaluateAmbientLighting,q);w.include(f.PiUtils);v.code.add(n.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${q.pbrMode===d.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);u(v);x(v);k.addMainLightDirection(v);v.code.add(n.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${q.spherical?n.glsl`normalize(vPosWorld)`:n.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);k.addMainLightIntensity(v);v.code.add(n.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(q.pbrMode){case d.PBRMode.Disabled:case d.PBRMode.WaterOnIntegratedMesh:case d.PBRMode.Water:w.include(k.MainLighting);v.code.add(n.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case d.PBRMode.Normal:case d.PBRMode.Schematic:v.code.add(n.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);v.code.add(n.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);q.useFillLights?v.uniforms.add(new g.BooleanPassUniform("hasFillLights",(p,t)=>t.enableFillLights)):v.constants.add("hasFillLights","bool",!1);v.code.add(n.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);v.uniforms.add(new e.FloatPassUniform("lightingSpecularStrength",(p,t)=>t.lighting.mainLight.specularStrength),new e.FloatPassUniform("lightingEnvironmentStrength",(p,t)=>t.lighting.mainLight.environmentStrength));v.code.add(n.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);v.code.add(n.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${q.pbrMode!==d.PBRMode.Schematic||q.hasColorTexture?n.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:n.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case d.PBRMode.Simplified:case d.PBRMode.TerrainWithWater:w.include(k.MainLighting);v.code.add(n.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(q.pbrMode);case d.PBRMode.COUNT:}};a.addAmbientBoostFactor=u;a.addLightingGlobalFactor=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,h,c,k){a.PhysicallyBasedRendering=function(m,d){const f=m.fragment.code;
m.include(c.PiUtils);if(d.pbrMode===h.PBRMode.Normal||d.pbrMode===h.PBRMode.Schematic||d.pbrMode===h.PBRMode.Simplified||d.pbrMode===h.PBRMode.TerrainWithWater)f.add(k.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),f.add(k.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(d.pbrMode===h.PBRMode.Normal||d.pbrMode===h.PBRMode.Schematic)m.include(b.AnalyticalSkyModel),f.add(k.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),f.add(k.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),f.add(k.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),f.add(k.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(m,d){const f=m.fragment.code;m.include(c.PiUtils);f.add(k.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${d.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);f.add(k.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);f.add(k.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);f.add(k.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);f.add(k.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(h){h=h.fragment.code;h.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);h.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);h.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../util/RgbaFloat16Encoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(q){q=q.fragment;q.include(c.Rgba4FloatEncoding);q.uniforms.add(new e.Texture2DPassUniform("shadowMap",(v,p)=>p.shadowMap.depthTexture),new m.IntegerPassUniform("numCascades",(v,p)=>p.shadowMap.numCascades),new k.Float4PassUniform("cascadeDistances",(v,p)=>p.shadowMap.cascadeDistances));q.code.add(d.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}class l extends d.NoParameters{constructor(){super(...arguments);this.origin=h.create()}}class u extends l{}class x extends d.NoParameters{constructor(){super(...arguments);this.modelTransformation=b.IDENTITY}}class w extends x{constructor(){super(...arguments);this.origin=h.create()}}a.ReadShadowMapDraw=function(q,v){v.receiveShadows&&(q.fragment.uniforms.add(new f.Matrix4sDrawUniform("shadowMapMatrix",(p,t)=>t.shadowMap.getShadowMapMatrices(p.origin),4)),n(q))};a.ReadShadowMapDrawParameters=
u;a.ReadShadowMapParameters=x;a.ReadShadowMapPass=function(q,v){v.receiveShadows&&(q.fragment.uniforms.add(new g.Matrix4sPassUniform("shadowMapMatrix",(p,t)=>t.shadowMap.getShadowMapMatrices(p.origin),4)),n(q))};a.ReadShadowMapPassParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,
m,d){super(k,"mat4",h.BindType.Draw,(f,g,e,n)=>f.setUniformMatrix4fv(k,m(g,e,n)),d)}}a.Matrix4sDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m,d){super(k,"mat4",h.BindType.Pass,(f,g,e)=>f.setUniformMatrix4fv(k,m(g,e)),d)}}a.Matrix4sPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../attributes/TextureCoordinateAttribute.glsl","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,h,c,k){a.colorTextureUV=function(m,d){d.hasColorTextureTransform?(m.vertex.uniforms.add(new k.Matrix3PassUniform("colorTextureTransformMatrix",f=>f.colorTextureTransformMatrix??
b.IDENTITY)),m.varyings.add("colorUV","vec2"),m.vertex.code.add(c.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(c.glsl`void forwardColorUV(){}`)};a.emissiveTextureUV=function(m,d){d.hasEmissionTextureTransform&&d.textureCoordinateType!==h.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("emissiveTextureTransformMatrix",f=>f.emissiveTextureTransformMatrix??b.IDENTITY)),m.varyings.add("emissiveUV","vec2"),m.vertex.code.add(c.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(c.glsl`void forwardEmissiveUV(){}`)};a.metallicRoughnessTextureUV=function(m,d){d.hasMetallicRoughnessTextureTransform&&d.textureCoordinateType!==h.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",f=>f.metallicRoughnessTextureTransformMatrix??b.IDENTITY)),m.varyings.add("metallicRoughnessUV","vec2"),m.vertex.code.add(c.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(c.glsl`void forwardMetallicRoughnessUV(){}`)};a.normalTextureUV=function(m,d){d.hasNormalTextureTransform&&d.textureCoordinateType!==h.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("normalTextureTransformMatrix",f=>f.normalTextureTransformMatrix??b.IDENTITY)),m.varyings.add("normalUV","vec2"),m.vertex.code.add(c.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(c.glsl`void forwardNormalUV(){}`)};a.occlusionTextureUV=function(m,d){d.hasOcclusionTextureTransform&&d.textureCoordinateType!==h.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("occlusionTextureTransformMatrix",f=>f.occlusionTextureTransformMatrix??b.IDENTITY)),m.varyings.add("occlusionUV","vec2"),m.vertex.code.add(c.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(c.glsl`void forwardOcclusionUV(){}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,h,c){a.MixExternalColor=function(k){k.include(h.ColorConversion);k.code.add(c.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${c.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${c.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${c.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${c.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${c.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends n.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.alphaDiscardMode=g.AlphaDiscardMode.Opaque;this.doubleSidedMode=m.NormalsDoubleSidedMode.None;this.pbrMode=d.PBRMode.Disabled;this.cullFace=g.CullFaceOptions.None;this.transparencyPassType=e.TransparencyPassType.NONE;this.normalType=c.NormalType.Attribute;this.textureCoordinateType=k.TextureCoordinateAttributeType.None;this.customDepthTest=g.DepthTestFunction.Less;
this.hasSlicePlane=this.hasVerticalOffset=this.hasSymbolColors=this.hasVertexColors=this.spherical=!1;this.hasSliceHighlight=!0;this.doublePrecisionRequiresObfuscation=this.instancedDoublePrecision=this.objectAndLayerIdColorInstanced=this.instancedColor=this.instanced=this.textureAlphaPremultiplied=this.receiveAmbientOcclusion=this.receiveShadows=this.vvColor=this.vvSize=this.offsetBackfaces=this.hasModelTransformation=this.multipassEnabled=this.hasOccludees=this.hasVertexTangents=this.hasScreenSizePerspective=
this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasColorTexture=!1;this.writeDepth=!0;this.transparent=!1;this.enableOffset=!0;this.hasMetallicRoughnessTextureTransform=this.hasOcclusionTextureTransform=this.hasNormalTextureTransform=this.hasEmissionTextureTransform=this.hasColorTextureTransform=this.snowCover=this.cullAboveGround=!1}}b.__decorate([f.parameter({count:h.ShaderOutput.COUNT})],l.prototype,"output",void 0);b.__decorate([f.parameter({count:g.AlphaDiscardMode.COUNT})],
l.prototype,"alphaDiscardMode",void 0);b.__decorate([f.parameter({count:m.NormalsDoubleSidedMode.COUNT})],l.prototype,"doubleSidedMode",void 0);b.__decorate([f.parameter({count:d.PBRMode.COUNT})],l.prototype,"pbrMode",void 0);b.__decorate([f.parameter({count:g.CullFaceOptions.COUNT})],l.prototype,"cullFace",void 0);b.__decorate([f.parameter({count:e.TransparencyPassType.COUNT})],l.prototype,"transparencyPassType",void 0);b.__decorate([f.parameter({count:c.NormalType.COUNT})],l.prototype,"normalType",
void 0);b.__decorate([f.parameter({count:k.TextureCoordinateAttributeType.COUNT})],l.prototype,"textureCoordinateType",void 0);b.__decorate([f.parameter({count:g.DepthTestFunction.COUNT})],l.prototype,"customDepthTest",void 0);b.__decorate([f.parameter()],l.prototype,"spherical",void 0);b.__decorate([f.parameter()],l.prototype,"hasVertexColors",void 0);b.__decorate([f.parameter()],l.prototype,"hasSymbolColors",void 0);b.__decorate([f.parameter()],l.prototype,"hasVerticalOffset",void 0);b.__decorate([f.parameter()],
l.prototype,"hasSlicePlane",void 0);b.__decorate([f.parameter()],l.prototype,"hasSliceHighlight",void 0);b.__decorate([f.parameter()],l.prototype,"hasColorTexture",void 0);b.__decorate([f.parameter()],l.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([f.parameter()],l.prototype,"hasEmissionTexture",void 0);b.__decorate([f.parameter()],l.prototype,"hasOcclusionTexture",void 0);b.__decorate([f.parameter()],l.prototype,"hasNormalTexture",void 0);b.__decorate([f.parameter()],l.prototype,
"hasScreenSizePerspective",void 0);b.__decorate([f.parameter()],l.prototype,"hasVertexTangents",void 0);b.__decorate([f.parameter()],l.prototype,"hasOccludees",void 0);b.__decorate([f.parameter()],l.prototype,"multipassEnabled",void 0);b.__decorate([f.parameter()],l.prototype,"hasModelTransformation",void 0);b.__decorate([f.parameter()],l.prototype,"offsetBackfaces",void 0);b.__decorate([f.parameter()],l.prototype,"vvSize",void 0);b.__decorate([f.parameter()],l.prototype,"vvColor",void 0);b.__decorate([f.parameter()],
l.prototype,"receiveShadows",void 0);b.__decorate([f.parameter()],l.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([f.parameter()],l.prototype,"textureAlphaPremultiplied",void 0);b.__decorate([f.parameter()],l.prototype,"instanced",void 0);b.__decorate([f.parameter()],l.prototype,"instancedColor",void 0);b.__decorate([f.parameter()],l.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([f.parameter()],l.prototype,"instancedDoublePrecision",void 0);b.__decorate([f.parameter()],
l.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([f.parameter()],l.prototype,"writeDepth",void 0);b.__decorate([f.parameter()],l.prototype,"transparent",void 0);b.__decorate([f.parameter()],l.prototype,"enableOffset",void 0);b.__decorate([f.parameter()],l.prototype,"cullAboveGround",void 0);b.__decorate([f.parameter()],l.prototype,"snowCover",void 0);b.__decorate([f.parameter()],l.prototype,"hasColorTextureTransform",void 0);b.__decorate([f.parameter()],l.prototype,"hasEmissionTextureTransform",
void 0);b.__decorate([f.parameter()],l.prototype,"hasNormalTextureTransform",void 0);b.__decorate([f.parameter()],l.prototype,"hasOcclusionTextureTransform",void 0);b.__decorate([f.parameter()],l.prototype,"hasMetallicRoughnessTextureTransform",void 0);b.__decorate([f.parameter({constValue:!1})],l.prototype,"occlusionPass",void 0);b.__decorate([f.parameter({constValue:!0})],l.prototype,"hasVvInstancing",void 0);b.__decorate([f.parameter({constValue:!1})],l.prototype,"useCustomDTRExponentForWater",
void 0);b.__decorate([f.parameter({constValue:!1})],l.prototype,"supportsTextureAtlas",void 0);b.__decorate([f.parameter({constValue:!0})],l.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,h,c,k,m,d){class f extends m.DefaultMaterialTechnique{initializeConfiguration(g,e){super.initializeConfiguration(g,e);e.hasMetallicRoughnessTexture=!1;e.hasEmissionTexture=!1;e.hasOcclusionTexture=!1;e.hasNormalTexture=!1;e.hasModelTransformation=!1;e.normalType=h.NormalType.Attribute;e.doubleSidedMode=c.NormalsDoubleSidedMode.WindingOrder;e.hasVertexTangents=!1}initializeProgram(g){return this._initializeProgram(g,f.shader)}}f.shader=new k.ReloadableShaderModule(d.RealisticTree,()=>
new Promise((g,e)=>a(["./RealisticTree.glsl"],g,e)));b.RealisticTreeTechnique=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I){function M(N){const V=new z.ShaderBuilder,{vertex:Q,fragment:T,varyings:ia}=V;F.addProjViewLocalOrigin(Q,N);V.include(g.PositionAttribute);ia.add("vpos","vec3");V.include(D.VisualVariables,N);V.include(d.InstancedDoublePrecision,N);V.include(u.VerticalOffset,N);if(N.output===c.ShaderOutput.Color||N.output===c.ShaderOutput.Alpha)F.addCameraPosition(V.vertex,N),V.include(f.NormalAttribute,N),V.include(m.Transform,N),N.offsetBackfaces&&
V.include(h.Offset),N.instancedColor&&V.attributes.add(I.VertexAttribute.INSTANCECOLOR,"vec4"),ia.add("vNormalWorld","vec3"),ia.add("localvpos","vec3"),N.multipassEnabled&&ia.add("depth","float"),V.include(n.TextureCoordinateAttribute,N),V.include(b.ForwardLinearDepth,N),V.include(e.SymbolColor,N),V.include(l.VertexColor,N),Q.uniforms.add(new H.Float4PassUniform("externalColor",O=>O.externalColor)),ia.add("vcolorExt","vec4"),Q.code.add(C.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${N.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${C.glsl.float(E.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${N.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${N.multipassEnabled?C.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);N.output===c.ShaderOutput.Alpha&&(V.include(k.SliceDraw,N),V.include(A.DiscardOrAdjustAlphaPass,N),V.include(p.multipassTerrainTest,N),T.uniforms.add(new L.FloatPassUniform("opacity",O=>O.opacity),new L.FloatPassUniform("layerOpacity",O=>O.layerOpacity)),N.hasColorTexture&&T.uniforms.add(new J.Texture2DPassUniform("tex",O=>O.texture)),T.include(B.MixExternalColor),T.code.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.multipassEnabled?C.glsl`terrainDepthTest(depth);`:""}
        ${N.hasColorTexture?C.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?C.glsl`colorUV`:C.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        ${N.hasVertexColors?C.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));N.output===c.ShaderOutput.Color&&(V.include(k.SliceDraw,N),V.include(q.EvaluateSceneLighting,N),V.include(w.EvaluateAmbientOcclusion,N),V.include(A.DiscardOrAdjustAlphaPass,N),V.include(N.instancedDoublePrecision?y.ReadShadowMapPass:y.ReadShadowMapDraw,N),V.include(p.multipassTerrainTest,N),F.addCameraPosition(V.fragment,N),v.addMainLightDirection(T),q.addAmbientBoostFactor(T),q.addLightingGlobalFactor(T),T.uniforms.add(Q.uniforms.get("localOrigin"),Q.uniforms.get("view"),new G.Float3PassUniform("ambient",
O=>O.ambient),new G.Float3PassUniform("diffuse",O=>O.diffuse),new L.FloatPassUniform("opacity",O=>O.opacity),new L.FloatPassUniform("layerOpacity",O=>O.layerOpacity)),N.hasColorTexture&&T.uniforms.add(new J.Texture2DPassUniform("tex",O=>O.texture)),V.include(r.PhysicallyBasedRenderingParameters,N),V.include(t.PhysicallyBasedRendering,N),T.include(B.MixExternalColor),v.addMainLightIntensity(T),T.code.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.multipassEnabled?C.glsl`terrainDepthTest(depth);`:""}
        ${N.hasColorTexture?C.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?C.glsl`colorUV`:C.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${N.pbrMode===r.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${N.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":N.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${N.hasVertexColors?C.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${N.snowCover?C.glsl`albedo = mix(albedo, vec3(1), 0.9);`:C.glsl``}
        ${C.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${N.pbrMode===r.PBRMode.Normal||N.pbrMode===r.PBRMode.Schematic?N.spherical?C.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:C.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:C.glsl``}
        ${N.pbrMode===r.PBRMode.Normal||N.pbrMode===r.PBRMode.Schematic?C.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${N.snowCover?C.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:C.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${N.transparencyPassType===K.TransparencyPassType.Color?C.glsl`fragColor = premultiplyAlpha(fragColor);`:C.glsl``}
      }
    `));V.include(x.DefaultMaterialAuxiliaryPasses,N);return V}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=S;a.build=M})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.RecreateSymbol=0]="RecreateSymbol";b[b.RecreateGraphics=1]="RecreateGraphics";b[b.FastUpdate=2]="FastUpdate";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,h){class c{constructor(k){this.schedule=k;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(k,m){if(this._loadStatus===a.LoadStatus.LOADED)return k&&k(),this._loader??Promise.resolve();if(this._loadStatus===
a.LoadStatus.FAILED)return m&&m(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},d=>{this._loadError=d;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!h.isAbortError(d)&&this.logger&&d.message&&this.logger.warn(d.message);throw d;}));this._loader.then(k,m).catch(()=>{});return this._loader}abortLoad(){null!=
this._abortController?this._abortController=b.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null}}a.LoadStatus=void 0;(function(k){k[k.LOADING=0]="LOADING";k[k.LOADED=1]="LOADED";k[k.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,h,c,k,m,d,f,g){const e=b.create();a.createStageObject=function(n,l,u,x,w){const q=n.clippingExtent;h.projectPointToVector(l,e,n.elevationProvider.spatialReference);if(null!=q&&!c.containsPoint(q,e))return null;h.projectPointToVector(l,e,n.renderCoordsHelper.spatialReference);u.localOrigin=n.localOriginFactory.getOrigin(e);u=new g.Object3D({geometries:[u],castShadow:!1,layerUid:n.layer.uid,graphicUid:w,usesVerticalDistanceToGround:!0});n=d.applyElevationAlignmentForHUD(u,l,n.elevationProvider,
n.renderCoordsHelper,x);return{object:u,sampledElevation:n}};a.extendPointGraphicElevationContext=function(n,l,u){n=n.elevationContext;u=u.spatialReference;h.projectPointToVector(l,e,u);n.centerPointInElevationSR=m.makeDehydratedPoint(e[0],e[1],l.hasZ?e[2]:0,null!=u?u:null)};a.placePointOnGeometry=function(n){switch(n.type){case "point":return n;case "polygon":case "extent":return f.computeCentroid(n);case "polyline":var l=n.paths[0];if(!l||0===l.length)break;l=k.getPointOnPath(l,k.getPathLength(l)/
2);return m.makeDehydratedPoint(l[0],l[1],l[2],n.spatialReference);case "mesh":return n.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends g.ContentObject{get geometries(){return this._geometries}get transformation(){return this._transformation??h.IDENTITY}set transformation(E){this._transformation=b.copy(this._transformation??h.create(),E);this._invalidateBoundingVolume();this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(E){this._shaderTransformation=E?b.copy(this._shaderTransformation??h.create(),E):null;
this._invalidateBoundingVolume();this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(E={}){super();this.type=e.ContentObjectType.Object;this._parentLayer=this._shaderTransformation=null;this._visible=!0;this.castShadow=E.castShadow??!0;this.usesVerticalDistanceToGround=E.usesVerticalDistanceToGround??!1;this.graphicUid=E.graphicUid;this.layerUid=E.layerUid;E.isElevationSource&&(this.lastValidElevationBB=new q);
this._geometries=E.geometries?Array.from(E.geometries):[]}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(E){l.assert(null==this._parentLayer||null==E,"Object3D can only be added to a single Layer");this._parentLayer=E}addGeometry(E){E.visible=this._visible;this._geometries.push(E);this._emit("geometryAdded",{object:this,geometry:E});this._invalidateBoundingVolume()}removeGeometry(E){if(E=this._geometries.splice(E,1)[0])this._emit("geometryRemoved",{object:this,
geometry:E}),this._invalidateBoundingVolume()}removeAllGeometries(){for(;0<this._geometries.length;)this.removeGeometry(0)}geometryVertexAttributeUpdated(E,A,B=!1){this._emit("attributesChanged",{object:this,geometry:E,attribute:A,sync:B});u.affectsGeometry(A)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(E){if(this._visible!==E){this._visible=E;for(const A of this._geometries)A.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const E=new n.Object3DStateID(f.Object3DState.MaskOccludee);
for(const A of this._geometries)A.occludees=x.addObject3DStateID(A.occludees,E);this._emit("occlusionChanged",this);return E}removeOcclude(E){for(const A of this._geometries)A.occludees=x.removeObject3DStateID(A.occludees,E);this._emit("occlusionChanged",this)}highlight(){const E=new n.Object3DStateID(f.Object3DState.Highlight);for(const A of this._geometries)A.highlights=x.addObject3DStateID(A.highlights,E);this._emit("highlightChanged",this);return E}removeHighlight(E){for(const A of this._geometries)A.highlights=
x.removeObject3DStateID(A.highlights,E);this._emit("highlightChanged",this)}getCombinedStaticTransformation(E,A){return b.multiply(A,this.transformation,E.transformation)}getCombinedShaderTransformation(E,A=h.create()){return b.multiply(A,this.effectiveTransformation,E.transformation)}get boundingVolumeWorldSpace(){this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new v,this._validateBoundingVolume(this._bvWorldSpace,D.WorldSpace));return this._bvWorldSpace}get boundingVolumeObjectSpace(){this._bvObjectSpace||
(this._bvObjectSpace=this._bvObjectSpace||new v,this._validateBoundingVolume(this._bvObjectSpace,D.ObjectSpace));return this._bvObjectSpace}_validateBoundingVolume(E,A){A=A===D.ObjectSpace;for(var B of this._geometries){var F=B.boundingInfo;if(F){var G=E,H=A?B.transformation:this.getCombinedShaderTransformation(B),L=F.bbMin;F=F.bbMax;if(b.hasIdentityRotation(H))for(H=c.set(p,H[12],H[13],H[14]),c.add(t,L,H),c.add(r,F,H),L=0;3>L;++L)G.min[L]=Math.min(G.min[L],t[L]),G.max[L]=Math.max(G.max[L],r[L]);
else if(c.transformMat4(t,L,H),c.exactEquals(L,F))for(L=0;3>L;++L)G.min[L]=Math.min(G.min[L],t[L]),G.max[L]=Math.max(G.max[L],t[L]);else{c.transformMat4(r,F,H);for(var C=0;3>C;++C)G.min[C]=Math.min(G.min[C],t[C],r[C]),G.max[C]=Math.max(G.max[C],t[C],r[C]);for(C=0;3>C;++C){c.copy(t,L);c.copy(r,F);t[C]=F[C];r[C]=L[C];c.transformMat4(t,t,H);c.transformMat4(r,r,H);for(let z=0;3>z;++z)G.min[z]=Math.min(G.min[z],t[z],r[z]),G.max[z]=Math.max(G.max[z],t[z],r[z])}}}}c.lerp(m.getCenter(E.bounds),E.min,E.max,
.5);for(const z of this._geometries)B=z.boundingInfo,null!=B&&(L=A?z.transformation:this.getCombinedShaderTransformation(z),G=d.maxScale(L),c.transformMat4(y,B.center,L),L=c.distance(y,m.getCenter(E.bounds)),E.bounds[3]=Math.max(E.bounds[3],L+B.radius*G))}_invalidateBoundingVolume(){const E=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&E&&this._parentLayer.notifyObjectBBChanged(this,E)}_emit(E,A){this._parentLayer&&this._parentLayer.events.emit(E,A)}get test(){const E=
this;return{hasGeometry:A=>E._geometries.includes(A),getGeometryIndex:A=>E._geometries.indexOf(A)}}}class q{constructor(){this.min=k.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=k.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class v extends q{constructor(){super(...arguments);this.bounds=m.create()}}const p=k.create(),t=k.create(),r=k.create(),y=k.create();var D;
(function(E){E[E.WorldSpace=0]="WorldSpace";E[E.ObjectSpace=1]="ObjectSpace"})(D||={});a.Object3D=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends m.Material{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(p){super(p,new x);this.produces=new Map([[d.RenderSlot.LINE_CALLOUTS,t=>t===c.ShaderOutput.Color],[d.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,t=>t===c.ShaderOutput.Color]]);this._configuration=new n.LineCalloutTechniqueConfiguration;this._uniqueMaterialIdentifier=l.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(p,
t){p=t?.slot!==d.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.depthHudEnabled=p;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.multipassEnabled=t.multipassEnabled;return this._configuration}intersect(){}createGLMaterial(p){return new u(p)}createBufferWriter(){return new v}validateParameters(p){p=l.uniqueMaterialIdentifier(p);p!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=p)}static uniqueMaterialIdentifier(p){return JSON.stringify({horizontalScreenOffset:p.horizontalScreenOffset??0,centerOffsetUnits:p.centerOffsetUnits||"world"})}}class u extends k{beginSlot(p){return this.ensureTechnique(e.LineCalloutTechnique,
p)}}class x extends m.MaterialParameters{constructor(){super(...arguments);this.horizontalScreenOffset=0;this.color=[0,0,0,1];this.size=1;this.occlusionTest=!1;this.shaderPolygonOffset=1E-5;this.depthHUDAlignStart=!1;this.centerOffsetUnits="world";this.hasSlicePlane=!1}}const w=h.newLayout().vec3f(f.VertexAttribute.POSITION).vec3f(f.VertexAttribute.NORMAL).vec2f(f.VertexAttribute.UV0).vec4f(f.VertexAttribute.CENTEROFFSETANDDISTANCE),q=[b.fromValues(0,0),b.fromValues(1,0),b.fromValues(0,1),b.fromValues(1,
0),b.fromValues(1,1),b.fromValues(0,1)];class v{constructor(){this.vertexBufferLayout=w}elementCount(p){return 6*p.attributes.get(f.VertexAttribute.POSITION).indices.length}write(p,t,r,y,D){g.writePosition(r.attributes.get(f.VertexAttribute.POSITION),p,y.position,D,6);g.writeNormal(r.attributes.get(f.VertexAttribute.NORMAL),t,y.normal,D,6);g.writeBufferVec4(r.attributes.get(f.VertexAttribute.CENTEROFFSETANDDISTANCE),y.centerOffsetAndDistance,D,6);for(p=0;p<q.length;++p)y.uv0.setVec(D+p,q[p])}}a.LineCalloutMaterial=
l;a.Parameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends k.ShaderTechnique{initializeConfiguration(l,
u){u.spherical=l.viewingMode===h.ViewingMode.Global}initializeProgram(l){return new d.Program(l.rctx,n.shader.get().build(this.configuration),m.Default3D)}setPipelineState(l){l=l?g.CompareFunction.ALWAYS:g.CompareFunction.LESS;return this.configuration.depthHudEnabled?e.makePipelineState({depthTest:{func:l},depthWrite:e.defaultDepthWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:l},colorWrite:e.defaultColorWriteParams})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}n.shader=new c.ReloadableShaderModule(f.LineCallout,()=>new Promise((l,u)=>a(["./LineCallout.glsl"],l,u)));b.LineCalloutTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(r){const y=new w.ShaderBuilder,{vertex:D,fragment:E}=y;D.include(m.AlignPixel);y.include(d.HUD,r);y.include(k.SliceDraw,r);y.attributes.add(q.VertexAttribute.UV0,"vec2");D.uniforms.add(new l.Float4PassUniform("viewport",(A,B)=>B.camera.fullViewport),new u.FloatPassUniform("lineSize",(A,B)=>0<A.size?Math.max(1,A.size)*B.camera.pixelRatio:0),new n.Float2PassUniform("pixelToNDC",(A,B)=>b.set(t,2/B.camera.fullViewport[2],2/B.camera.fullViewport[3])),
new u.FloatPassUniform("borderSize",(A,B)=>null!=A.borderColor?B.camera.pixelRatio:0),new n.Float2PassUniform("screenOffset",(A,B)=>b.set(t,A.horizontalScreenOffset*B.camera.pixelRatio,0)));y.varyings.add("coverageSampling","vec4");y.varyings.add("lineSizes","vec2");r.multipassEnabled&&y.varyings.add("depth","float");r.occlusionTestEnabled&&y.include(f.HUDVisibility);r.hasScreenSizePerspective&&e.addScreenSizePerspectiveAlignment(D);D.code.add(x.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${r.occlusionTestEnabled?x.glsl`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${r.hasScreenSizePerspective?x.glsl`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x.glsl`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${r.multipassEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${r.depthHudEnabled?r.depthHudAlignStartEnabled?x.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${r.hasScreenSizePerspective?x.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);E.uniforms.add(new l.Float4PassUniform("uColor",A=>p(A.color)),new l.Float4PassUniform("borderColor",A=>p(A.borderColor)));r.multipassEnabled&&(E.include(g.multipassGeometryTest,r),E.uniforms.add(new n.Float2PassUniform("inverseViewport",(A,B)=>B.inverseViewport)));E.code.add(x.glsl`
    void main() {
      ${r.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${r.depthHudEnabled?x.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return y}function p(r){return null!=r?r:c.ZEROS}const t=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.LineCallout=h;a.build=v})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,h,c){class k extends c.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.multipassEnabled=this.hasSlicePlane=this.depthHudAlignStartEnabled=this.depthHudEnabled=this.hasScreenSizePerspective=this.hasVerticalOffset=!1}}b.__decorate([h.parameter()],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([h.parameter()],k.prototype,"spherical",void 0);b.__decorate([h.parameter()],k.prototype,"occlusionTestEnabled",void 0);b.__decorate([h.parameter()],k.prototype,"hasVerticalOffset",
void 0);b.__decorate([h.parameter()],k.prototype,"hasScreenSizePerspective",void 0);b.__decorate([h.parameter()],k.prototype,"depthHudEnabled",void 0);b.__decorate([h.parameter()],k.prototype,"depthHudAlignStartEnabled",void 0);b.__decorate([h.parameter()],k.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],k.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([h.parameter({constValue:!1})],k.prototype,
"draped",void 0);a.LineCalloutTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,h){a.getGraphics3DSymbol=function(c){return c instanceof h.Graphics3DWebStyleSymbol?c.graphics3DSymbol:c instanceof b.Graphics3DSymbol?c:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends n.Loadable{set symbol(x){this._symbol=x;x.symbolLayers.forEach((w,q)=>{q=this.symbolLayers[q];null!=q&&(q.symbol=x,q.symbolLayer=w)})}get symbol(){return this._symbol}constructor(x,w,q){super(w.schedule);this._symbol=x;this._context=w;this._backgroundLayers=q;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(x){let w=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(w=this._backgroundLayers.concat(w));
const q=w.length;for(;this.symbolLayers.length<w.length;)this.symbolLayers.push(null);this.symbolLayers.length=w.length;const v=[];for(let t=0;t<q;t++){var p=w.at(t);if(!1===p.enabled)continue;u.renderPriority=1-(1+t)/q;u.renderPriorityStep=1/q;u.ignoreDrivers=p.ignoreDrivers;const r=g.make(this.symbol,p,this._context,u);(p=c.onAbortOrThrow(x,()=>{this.symbolLayers[t]=null;r.destroy()}))&&v.push(p);this.symbolLayers[t]=r}await h.forEach(this.symbolLayers,async(t,r)=>{if(null!=t)try{await t.load(),
this._extentPadding+=Math.max(this._extentPadding,t.extentPadding)}catch{this.symbolLayers[r]=null}});v.forEach(t=>t.remove());c.throwIfAborted(x);if(this.symbolLayers.length&&!this.symbolLayers.some(t=>!!t))throw Error();}getSymbolLayerSize(x){x=this.symbolLayers[x];return null!=x?x.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(x=>x?.queryForSnapping)}createGraphics3DGraphic(x,w){const q=x.graphic,v=this.symbolLayers.map(p=>
p?.createGraphics3DGraphic(x)??null);return new m.Graphics3DGraphic(q,w||this,v,x.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return k.totalSymbolComplexities(this.symbolLayers.map(x=>null!=x?x.complexity:null))}globalPropertyChanged(x,w){const q=this.symbolLayers.length;for(let v=0;v<q;v++){const p=this.symbolLayers[v],t=r=>{r=r.layers[v];return r instanceof d.Graphics3DObject3DGraphicLayer?r:null};if(null!=p&&!p.globalPropertyChanged(x,
w,t))return!1}return!0}applyRendererDiff(x,w){return this.loadStatus!==n.LoadStatus.LOADED?e.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((q,v)=>q!==e.ApplyRendererDiffResult.RecreateSymbol&&null!=v?Math.min(q,v.applyRendererDiff(x,w)):q,e.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(x){if(this.loadStatus!==n.LoadStatus.FAILED&&"partial"===x.diff.type){var w=x.diff.diff;if(w.symbolLayers&&"partial"===w.symbolLayers.type){var q=w.symbolLayers.diff;this.symbolLayers.forEach((v,
p)=>{if(null!=v){var t=q[p];if(t){const r={diff:t,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};v.prepareSymbolLayerPatch(r);x.symbolStatePatches.push(...r.symbolLayerStatePatches);r.graphics3DGraphicPatches.length&&x.graphics3DGraphicPatches.push((y,D)=>{const E=y.layers[p];null!=E&&r.graphics3DGraphicPatches.forEach(A=>A(E,D))})}}})}}}updateGeometry(x,w){return this._updateGeometryOrTransform(x,(q,v)=>q.updateGeometry(v,w))}updateTransform(x,w,q,v){return this._updateGeometryOrTransform(x,
(p,t)=>p.updateTransform(t,w,q,v))}_updateGeometryOrTransform(x,w){for(let q=0;q<this.symbolLayers.length;q++){const v=this.symbolLayers[q];if(null==v)continue;const p=x.layers[q];if(!p||!w(v,p))return!1}return!0}onRemoveGraphic(x){for(let w=0;w<this.symbolLayers.length;w++){const q=this.symbolLayers[w];if(null==q)continue;const v=x.layers[w];if(null!=v)q.onRemoveGraphic(v)}}getFastUpdateStatus(){let x=0,w=0,q=0;this.symbolLayers.forEach(v=>{null!=v&&(v.loadStatus===n.LoadStatus.LOADING?x++:v.isFastUpdatesEnabled()?
q++:w++)});return{loading:x,slow:w,fast:q}}async queryForSnapping(x,w,q,v){var p=this.symbolLayers.filter(b.isSome).filter(t=>null!=t.queryForSnapping).map(t=>t.queryForSnapping(x,w,q,v));p=await Promise.all(p);c.throwIfAborted(v);return p.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const x of this.symbolLayers)null!=x&&x.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}
const u=new f.Graphics3DSymbolLayerCreationContext;a.Graphics3DSymbol=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){const t=new k(Array,D=>l.set(D,l.zero),null,10,5),r=u.create();class y{get labelLayers(){return this._labelLayers||b.emptyArray}get extent(){return this._extent}get isElevationSource(){return this.layers.some(D=>D?.isElevationSource)}constructor(D,E,A,B,F){this.graphic=D;this.graphics3DSymbol=E;this.layers=A;this._visibleFlags=v.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++E.referenced;this._featureExpressionFeature=F?p.createFeature(F,D,B):
null}initialize(D){this._layer=D;this._forEachSymbolLayerGraphic(E=>{E.initialize(D);E.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(D=>D.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(D=>D.destroy());this._labelLayers=null}addLabelGraphic(D,E){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(D);D.initialize(E);D.setVisibility(this.isVisible(v.VisibilityGroup.LABEL))}setCalloutGraphic(D){this._calloutLayer=
D;this._layer&&(D.initialize(this._layer),D.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let D=!1;this._forEachSymbolLayerGraphic(E=>{"draped"===E.type&&(D=!0)});return D}isVisible(D=v.VisibilityGroup.GRAPHIC,E){E=E?this._visibleFlags|E|v.VisibilityGroup.LABEL*E:this._visibleFlags;return D===v.VisibilityGroup.GRAPHIC?(E&v.VisibilityFlag.ALL_GRAPHIC)===v.VisibilityFlag.ALL_GRAPHIC:(E&v.VisibilityFlag.ALL_LABEL)===v.VisibilityFlag.ALL_LABEL}setVisibilityFlag(D,
E,A){const B=this.isVisible(D);this._visibleFlags=A?this._visibleFlags|D*E:this._visibleFlags&~(D*E);const F=this.isVisible(D);if(B===F)return!1;if(D===v.VisibilityGroup.LABEL)this._forEachLabelGraphic(G=>G.setVisibility(F));else{this._forEachSymbolLayerGraphic(H=>H.setVisibility(F));const G=this.isVisible(v.VisibilityGroup.LABEL);this._forEachLabelGraphic(H=>H.setVisibility(G))}return!0}getVisibilityFlag(D,E){return 0!==(this._visibleFlags&D*E)}computeExtent(D){if(!this._extent){var E=this.graphic.geometry;
if(null==E)return!1;this._extent=u.create();w.computeAABR(E,this._extent);E=E.spatialReference;if(!x.equals(E,D)&&!n.projectBoundingRect(this._extent,E,this._extent,D))return this._extent=null,!1}return!0}getAsOptimizedGeometry(D,E){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,D,E));return this._optimizedGeometry}_convertGraphicToOptimizedGeometry(D,E,A){D=D.geometry;if("mesh"===D.type||"extent"===D.type)D=e.fromExtent("mesh"===D.type?D.extent:
D);return q.convertFromGeometry(D,E,A)}get usedMemory(){let D=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(E=>D+=E.graphics3DSymbolLayer.usedMemory);return D}computeAttachmentOrigin(){const D={render:{origin:g.create(),num:0},draped:{origin:d.create(),num:0}};for(const E of this.layers)null!=E&&E.computeAttachmentOrigin(D);1<D.render.num&&f.scale(D.render.origin,D.render.origin,1/D.render.num);1<D.draped.num&&m.scale(D.draped.origin,D.draped.origin,1/D.draped.num);
return D}async getProjectedBoundingBox(D,E,A,B,F){F||={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]};F.boundingBox?l.empty(F.boundingBox):F.boundingBox=l.empty();F.requiresDrapedElevation=!1;await h.forEach(this.layers,async G=>{if(null!=G){var H="draped"===G.type?E:D,L=t.acquire();G=await G.getProjectedBoundingBox(H,A,F.screenSpaceObjects,B,L);isFinite(G[2])&&isFinite(G[5])||(F.requiresDrapedElevation=!0);G&&l.expandWithAABB(F.boundingBox,L);t.release(L)}});return l.allFinite(F.boundingBox)||
u.allFinite(l.toRect(F.boundingBox,r))?F:null}needsElevationUpdates(){for(const D of this.layers)if(null!=D&&("object3d"===D.type||"lod-instance"===D.type)&&D.needsElevationUpdates)return!0;return this._labelLayers?.some(D=>D?.needsElevationUpdates??!1)??!1}alignWithElevation(D,E,A){this._forEachRenderedGraphic(B=>{"object3d"!==B.type&&"lod-instance"!==B.type||B.alignWithElevation(D,E,this._featureExpressionFeature,A)})}alignWithAbsoluteElevation(D,E,A){this._forEachRenderedGraphic(B=>{"object3d"===
B.type&&B.alignWithAbsoluteElevation(D,E,A)})}addObjectStateSet(D,E){this._forEachSymbolLayerGraphic(A=>A.addObjectState(D,E))}removeObjectState(D){this._forEachSymbolLayerGraphic(E=>E.removeObjectState(D))}_forEachGraphicList(D,E){D?.forEach(A=>A&&E(A))}_forEachSymbolLayerGraphic(D){this._forEachGraphicList(this.layers,D);this._calloutLayer&&D(this._calloutLayer)}_forEachLabelGraphic(D){this._forEachGraphicList(this._labelLayers,D)}_forEachRenderedGraphic(D){this._forEachSymbolLayerGraphic(D);this._forEachLabelGraphic(D)}get test(){const D=
this;return{addLabelLayer:E=>{D._labelLayers||(D._labelLayers=[]);D._labelLayers.push(E)}}}}a.Graphics3DGraphic=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(r,y,D,E){return{uid:k.generateUID(),objectId:E&&r.attributes?r.attributes[E]:null,attributes:r.attributes,geometry:x(r.geometry,y,D),visible:!0}}function x(r,y,D){if(null==r)return null;switch(y){case "point":return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:null!=r.z,hasM:null!=r.m,type:"point",spatialReference:D};case "polyline":return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:D};case "polygon":return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,
type:"polygon",spatialReference:D};case "multipoint":return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:D}}}function w(r){if(null==r)return 0;let y=32;switch(r.type){case "point":y+=42;break;case "polyline":case "polygon":var D=0;const E=2+(r.hasZ?1:0)+(r.hasM?1:0);r="polyline"===r.type?r.paths:r.rings;for(const A of r)D+=A.length;y+=8*D*E+64;y+=128*D;y=y+34+32*(r.length+1);break;case "multipoint":D=r.points.length;y+=8*D*(2+(r.hasZ?1:0)+(r.hasM?1:0))+64;y+=128*
D;y=y+34+32;break;case "extent":y+=98;r.hasM&&(y+=32);r.hasZ&&(y+=32);break;case "mesh":y+=c.estimateSize(r.vertexAttributes.position,r.vertexAttributes.normal,r.vertexAttributes.uv,r.vertexAttributes.tangent)}return y}function q(r,y){return null!=r.objectId?r.objectId:r.attributes&&y?r.attributes[y]:null}function v(r,y,D,E){if(y?.size&&null!=D&&r)for(const A in r){if(!y.has(A))continue;const B=r[A];"string"===typeof B&&B.length>D&&(E(A),r[A]="")}}class p{constructor(r,y,D){this.uid=r;this.geometry=
y;this.attributes=D;this.visible=!0;this.centroid=this.objectId=null}}class t{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}a.equals=l.equals;a.DehydratedFeatureClass=p;a.DehydratedFeatureSetClass=t;a.computeAABB=function(r,y){d.empty(y);"mesh"===r.type&&(r=r.extent);switch(r.type){case "point":y[0]=
y[3]=r.x;y[1]=y[4]=r.y;r.hasZ&&(y[2]=y[5]=r.z);break;case "polyline":for(var D=0;D<r.paths.length;D++)d.expandWithNestedArray(y,r.paths[D],!!r.hasZ);break;case "polygon":for(D=0;D<r.rings.length;D++)d.expandWithNestedArray(y,r.rings[D],!!r.hasZ);break;case "multipoint":d.expandWithNestedArray(y,r.points,!!r.hasZ);break;case "extent":y[0]=r.xmin,y[1]=r.ymin,y[3]=r.xmax,y[4]=r.ymax,null!=r.zmin&&(y[2]=r.zmin),null!=r.zmax&&(y[5]=r.zmax)}};a.computeAABR=function(r,y){f.empty(y);"mesh"===r.type&&(r=r.extent);
switch(r.type){case "point":y[0]=y[2]=r.x;y[1]=y[3]=r.y;break;case "polyline":for(var D=0;D<r.paths.length;D++)f.expandWithNestedArray(y,r.paths[D]);break;case "polygon":for(D=0;D<r.rings.length;D++)f.expandWithNestedArray(y,r.rings[D]);break;case "multipoint":f.expandWithNestedArray(y,r.points);break;case "extent":y[0]=r.xmin,y[1]=r.ymin,y[2]=r.xmax,y[3]=r.ymax}};a.estimateGeometryObjectSize=w;a.estimateSize=function(r){let y;y=32+b.estimateAttributesObjectSize(r.attributes);return y=y+3+(8+w(r.geometry))};
a.fromFeatureSetJSON=function(r,y){const D=e.featureGeometryTypeKebabDictionary.fromJSON(r.geometryType),E=m.fromJSON(r.spatialReference),A=r.transform,B=r.objectIdFieldName,F=y?.maxStringAttributeLength,G=y?.maxStringAttributeFields;let H;y=r.features.map(L=>{const C=u(L,D,E,r.objectIdFieldName);L=C.geometry;v(C.attributes,G,F,z=>{H??=[];const J=q(C,B);null!=J&&H.push({objectId:J,attribute:z})});if(null!=L&&A)switch(L.type){case "point":C.geometry=g.unquantizePoint(A,L,L,L.hasZ,L.hasM);break;case "multipoint":C.geometry=
g.unquantizeMultipoint(A,L,L,!!L.hasZ,!!L.hasM);break;case "polygon":C.geometry=g.unquantizePolygon(A,L,L,!!L.hasZ,!!L.hasM);break;case "polyline":C.geometry=g.unquantizePolyline(A,L,L,!!L.hasZ,!!L.hasM);break;case "extent":C.geometry=L;break;case "mesh":C.geometry=L}return C});return{geometryType:D,features:y,spatialReference:E,fields:r.fields?.map(L=>n.fromJSON(L))??[],objectIdFieldName:r.objectIdFieldName,globalIdFieldName:r.globalIdFieldName,geohashFieldName:r.geohashFieldName,geometryProperties:r.geometryProperties,
hasZ:r.hasZ,hasM:r.hasM,exceededTransferLimit:r.exceededTransferLimit,transform:null,missingAttributes:H}};a.fromJSONGeometry=x;a.getObjectId=q;a.hasGeometry=function(r){return null!=r.geometry};a.hasVertices=function(r){if(null==r)return!1;switch(r.type){case "extent":case "point":return!0;case "polyline":for(const y of r.paths)if(0<y.length)return!0;return!1;case "polygon":for(const y of r.rings)if(0<y.length)return!0;return!1;case "multipoint":return 0<r.points.length;case "mesh":return!r.loaded||
0<r.vertexAttributes.position.length}};a.numVertices=function(r){if(null==r)return 0;switch(r.type){case "point":return 1;case "polyline":var y=0;for(var D of r.paths)y+=D.length;return y;case "polygon":D=0;for(y of r.rings)D+=y.length;return D;case "multipoint":return r.points.length;case "extent":return 2;case "mesh":return(r=r.vertexAttributes&&r.vertexAttributes.position)?r.length/3:0}};a.removeLargeStringAttributes=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../core/mathUtils","../../geometry/support/spatialReferenceUtils"],function(a,b,h,c){function k(e,n){if(e===n)return!0;if(null==e||null==n||e.length!==n.length)return!1;for(let l=0;l<e.length;l++){const u=e[l],x=n[l];if(u.length!==x.length)return!1;for(let w=0;w<u.length;w++)if(u[w]!==x[w])return!1}return!0}function m(e,n){if(e===n)return!0;if(null==e||null==n||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!k(e[l],n[l]))return!1;return!0}function d(e,n){return e===
n||null!=e&&null!=n&&c.equals(e.spatialReference,n.spatialReference)&&e.x===n.x&&e.y===n.y&&e.z===n.z&&e.m===n.m}function f(e,n){if(e===n)return!0;if(null==e||null==n||e.type!==n.type)return!1;switch(e.type){case "point":return d(e,n);case "extent":return e=e.hasZ!==n.hasZ||e.hasM!==n.hasM?!1:c.equals(e.spatialReference,n.spatialReference)?e.xmin===n.xmin&&e.ymin===n.ymin&&e.zmin===n.zmin&&e.xmax===n.xmax&&e.ymax===n.ymax&&e.zmax===n.zmax:!1,e;case "polyline":return e=e.hasZ!==n.hasZ||e.hasM!==n.hasM?
!1:c.equals(e.spatialReference,n.spatialReference)?m(e.paths,n.paths):!1,e;case "polygon":return e=e.hasZ!==n.hasZ||e.hasM!==n.hasM?!1:c.equals(e.spatialReference,n.spatialReference)?m(e.rings,n.rings):!1,e;case "multipoint":return e=e.hasZ!==n.hasZ||e.hasM!==n.hasM?!1:c.equals(e.spatialReference,n.spatialReference)?k(e.points,n.points):!1,e;case "mesh":return!1}}function g(e,n){if(e===n)return!0;if(!e||!n)return!1;const l=Object.keys(e),u=Object.keys(n);if(l.length!==u.length)return!1;for(const x of l)if(e[x]!==
n[x])return!1;return!0}a.equals=function(e,n){return e===n?!0:null!=e&&null!=n&&e.objectId===n.objectId&&f(e.geometry,n.geometry)&&g(e.attributes,n.attributes)?!0:!1};a.pointEquals=d;a.pointNear=function(e,n,l){return e===n||null!=e&&null!=n&&c.equals(e.spatialReference,n.spatialReference)&&h.floatEqualAbsolute(e.x,n.x,l)&&h.floatEqualAbsolute(e.y,n.y,l)&&h.floatEqualAbsolute(e.z??0,n.z??0,l)&&h.floatEqualAbsolute(e.m??0,n.m??0,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],
function(a){class b{constructor(c,k){this.scheduler=c;this.schedule=k;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}class h{constructor(){this.renderPriority=
0;this.renderPriorityStep=1;this.ignoreDrivers=!1}}a.Graphics3DSymbolCreationContext=b;a.Graphics3DSymbolLayerCreationContext=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){const l={icon:c.Graphics3DIconSymbolLayer,object:d.Graphics3DObjectSymbolLayer,line:k.Graphics3DLineSymbolLayer,path:f.Graphics3DPathSymbolLayer,fill:g.Graphics3DPolygonFillSymbolLayer,extrude:h.Graphics3DExtrudeSymbolLayer,text:e.Graphics3DTextSymbolLayer,water:n.Graphics3DWaterSymbolLayer},u={"mesh-3d":{fill:m.Graphics3DMeshFillSymbolLayer}};a.make=function(x,w,q,v){const p=u[x.type]?.[w.type]||l[w.type];return p?new p(x,w,q,v):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${w.type}`),null)};a.setSymbolClass=function(x,w){l[x]=w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/unitUtils ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec3 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Normals ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T){function ia(ya,Ca,pa,wa,Ba,la){const qa=q.getZeroIndexArray(Ca.length);Ca=[[Q.VertexAttribute.POSITION,new J.Attribute(wa.positions,Ca,3,!0)],[Q.VertexAttribute.NORMALCOMPRESSED,new J.Attribute(wa.normals,Ca,2,!0)],[Q.VertexAttribute.COLOR,new J.Attribute(Ba,qa,4,!0)]];return new M.Geometry(ya,Ca,wa.elevation,I.ContentObjectType.Mesh,la,pa)}function O(ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La,Na,Wa){let Ia=0;var Oa=2*
wa.count,Ua=wa.index,Va=wa.count,Ra=pa.length/3,bb=Oa;n.copy(W,Na);const gb=0<La?1:-1;Oa=3*Ua;let db=0;Ua=3*db;let ka=Va;Na=3*ka;for(let mb=0;mb<Va;++mb)Wa&&(W[0]=ya[Oa],W[1]=ya[Oa+1],W[2]=ya[Oa+2],n.normalize(W,W)),Ba[Ua]=ya[Oa],Ba[Ua+1]=ya[Oa+1],Ba[Ua+2]=ya[Oa+2],la[Ua]=Ca[Oa],la[Ua+1]=Ca[Oa+1],la[Ua+2]=Ca[Oa+2],qa[Ua]=-gb*W[0],qa[Ua+1]=-gb*W[1],qa[Ua+2]=-gb*W[2],ua[db]=0,Ba[Na]=ya[Oa]+La*W[0],Ba[Na+1]=ya[Oa+1]+La*W[1],Ba[Na+2]=ya[Oa+2]+La*W[2],la[Na]=Ca[Oa],la[Na+1]=Ca[Oa+1],la[Na+2]=Ca[Oa+2],
qa[Na]=gb*W[0],qa[Na+1]=gb*W[1],qa[Na+2]=gb*W[2],ua[ka]=La,Ua+=3,Na+=3,Oa+=3,db+=1,ka+=1;Ua=Oa=0;Na=3*bb;ya=0>La?oa:ja;Ca=0>La?ja:oa;for(Wa=0;Wa<Ra;++Wa)Ga[Ua]=pa[Oa+ya[0]],Ga[Ua+1]=pa[Oa+ya[1]],Ga[Ua+2]=pa[Oa+ya[2]],va[Na]=pa[Oa+Ca[0]]+Va,va[Na+1]=pa[Oa+Ca[1]]+Va,va[Na+2]=pa[Oa+Ca[2]]+Va,Ua+=3,Na+=3,Oa+=3;pa=2*wa.count;Oa=0;P(Ba,la,ua,qa,Ia,wa.pathLengths[0],wa.count,pa,va,Oa,La);pa+=4*wa.pathLengths[0];Oa+=2*wa.pathLengths[0];Ia+=wa.pathLengths[0];for(Ga=1;Ga<wa.pathLengths.length;++Ga)P(Ba,la,
ua,qa,Ia,wa.pathLengths[Ga],wa.count,pa,va,Oa,La),pa+=4*wa.pathLengths[Ga],Oa+=2*wa.pathLengths[Ga],Ia+=wa.pathLengths[Ga]}function U(ya,Ca,pa,wa,Ba,la,qa){wa[la]=wa[qa];qa*=3;la*=3;ya[la]=ya[qa];ya[la+1]=ya[qa+1];ya[la+2]=ya[qa+2];Ca[la]=Ca[qa];Ca[la+1]=Ca[qa+1];Ca[la+2]=Ca[qa+2];pa[la]=Ba[0];pa[la+1]=Ba[1];pa[la+2]=Ba[2]}function P(ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La){let Na=Ba,Wa=Ba+1,Ia=Ba+qa,Oa=Ba+qa+1,Ua=ua,Va=ua+1,Ra=ua+2*la;ua=ua+2*la+1;0>La&&(Na=Ba+qa+1,Oa=Ba);Ga*=3;for(let sb=0;sb<la;++sb){sb===
la-1&&(0<La?(Wa=Ba,Oa=Ba+qa):(Wa=Ba,Na=Ba+qa));var bb=ya,gb=Na,db=Wa,ka=Ia,mb=X;gb*=3;db*=3;ka*=3;n.set(da,bb[gb++],bb[gb++],bb[gb++]);n.set(ha,bb[db++],bb[db++],bb[db++]);n.set(fa,bb[ka++],bb[ka++],bb[ka++]);n.subtract(aa,ha,da);n.subtract(Z,fa,da);n.cross(mb,Z,aa);n.normalize(mb,mb);U(ya,Ca,wa,pa,X,Ua,Na);U(ya,Ca,wa,pa,X,Va,Wa);U(ya,Ca,wa,pa,X,Ra,Ia);U(ya,Ca,wa,pa,X,ua,Oa);va[Ga++]=Ua;va[Ga++]=Ra;va[Ga++]=ua;va[Ga++]=Ua;va[Ga++]=ua;va[Ga++]=Va;Na++;Wa++;Ia++;Oa++;Ua+=2;Va+=2;Ra+=2;ua+=2}}const R=
["polygon","extent"];class ba extends E.Graphics3DSymbolLayer{constructor(ya,Ca,pa,wa){super(ya,Ca,pa,wa);this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){var ya=A.validateSymbolLayerSize(this._getSymbolSize());if(ya)throw new h("graphics3dextrudesymbollayer:invalid-size",ya);}var Ca=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);ya=l.fromArray(Ca);Ca=Ca[3];const pa=1>Ca||this.needsDrivenTransparentPass;ya={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,diffuse:ya,ambient:ya,opacity:Ca,transparent:pa,cullFace:pa?K.CullFaceOptions.None:K.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:z.NormalType.Compressed};this._materials[ra.Main]=new T.DefaultMaterial(ya);this._materials[ra.Bottom]=new T.DefaultMaterial({...ya,cullFace:K.CullFaceOptions.Back});this._context.stage.addMany(this._materials)}destroy(){super.destroy();
this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(ya){const Ca=ya.graphic;if(!this._validateGeometry(Ca.geometry,R,this.symbolLayer.type))return null;const pa=this._getVertexOpacityAndColor(ya.renderingInfo,255),wa=this.setGraphicElevationContext(Ca);return this._createAs3DShape(Ca,ya.renderingInfo,pa,wa,Ca.uid)}layerOpacityChanged(ya,Ca){const pa=this._getCombinedOpacity(this.symbolLayer?.material?.color),wa=1>pa||this.needsDrivenTransparentPass;this._materials[ra.Main]?.setParameters({opacity:pa,
transparent:wa});this._materials[ra.Bottom]?.setParameters({opacity:pa,transparent:wa});const Ba=this._getLayerOpacity();ya.forEach(la=>{la=Ca(la);null!=la&&la.layerOpacityChanged(Ba,this._context.isAsync)})}layerElevationInfoChanged(ya,Ca){return this.updateGraphics3DGraphicElevationInfo(ya,Ca,y.needsElevationUpdates3D)}slicePlaneEnabledChanged(ya,Ca){this._materials[ra.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[ra.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
ya.forEach(pa=>{pa=Ca(pa);null!=pa&&pa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0}physicalBasedRenderingChanged(){const ya={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};this._materials[ra.Main]?.setParameters(ya);this._materials[ra.Bottom]?.setParameters(ya);return!0}_getExtrusionSize(ya){ya=ya.size&&this._drivenProperties.size?t.getDriverAxisSizeValue(ya.size,2)??0:this._getSymbolSize();return ya/=this._context.renderCoordsHelper.unitInMeters}applyRendererDiff(ya,
Ca){return this._drivenPropertiesChanged(Ca)?B.ApplyRendererDiffResult.RecreateSymbol:B.ApplyRendererDiffResult.RecreateGraphics}async queryForSnapping(ya,Ca,pa,wa){Ca=this._getExtrusionSize(pa)*this._context.renderCoordsHelper.unitInMeters/k.getMetersPerVerticalUnitForSR(Ca);const {objectId:Ba,target:la}=ya;pa=c.clone(la);pa.z=(pa.z??0)+Ca;switch(ya.type){case "edge":const {start:qa,end:ua}=ya;ya=c.clone(qa);wa=c.clone(ua);ya.z=(ya.z??0)+Ca;wa.z=(wa.z??0)+Ca;return[p.makeEdgeCandidate(Ba,pa,Infinity,
ya,wa)];case "vertex":return[p.makeVertexCandidate(Ba,pa,Infinity),p.makeEdgeCandidate(Ba,la,Infinity,la,pa)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(ya,Ca,pa,wa,Ba){var la=F.geometryAsPolygon(ya.geometry);if(null==la)return null;if(0===la.rings.length||!la.rings.some(db=>0<db.length))return this._logGeometryValidationWarnings(la.rings,"rings","ExtrudeSymbol3DLayer"),null;ya=C.geometryToRenderInfo(la,this._context.elevationProvider,this._context.renderCoordsHelper,
wa);this._logGeometryCreationWarnings(ya,la.rings,"rings","ExtrudeSymbol3DLayer");var qa=A.computeCentroid(la);if(null==qa)return null;var ua=[];const va=[],Ga=x.create(),La=e.create(),Na=l.create(),Wa=this._context.renderCoordsHelper.viewingMode===r.ViewingMode.Global;Wa||this._context.renderCoordsHelper.worldUpAtPosition(null,Na);u.computeTranslationToOriginAndRotation(la.spatialReference,[qa.x,qa.y,0],La,this._context.renderCoordsHelper.spatialReference);la=e.create();g.invert(la,La);qa=f.create();
d.normalFromMat4(qa,la);const {polygons:Ia,mapPositions:Oa,position:Ua}=ya;for(const db of Ia){qa=db.count;if(this._context.clippingExtent&&(x.empty(Ga),x.expandWithBuffer(Ga,db.mapPositions),!x.intersectsClippingArea(Ga,this._context.clippingExtent)))continue;var Va=m.earcut(db.mapPositions,db.holeIndices,3);if(0===Va.length)continue;var Ra=Va.length,bb=6*qa;qa=q.newIndexArray(bb+Ra);Ra=q.newIndexArray(Ra);var gb=w.newDoubleArray(3*bb);const ka=w.newDoubleArray(3*bb),mb=w.newDoubleArray(3*bb);bb=
w.newDoubleArray(bb);const sb=this._getExtrusionSize(Ca);O(Ua,Oa,Va,db,gb,mb,ka,bb,qa,Ra,sb,Na,Wa);v.transformMat4(gb,gb,la);Va=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Ba,layerUid:this._context.layer.uid});gb=new ta(gb,mb,N.compressNormals(ka),bb);ua.push(ia(this._materials[ra.Main],qa,qa.length-Ra.length,gb,pa,Va),ia(this._materials[ra.Bottom],Ra,0,gb,pa,Va));va.push(gb.heights)}if(0===ua.length)return null;Ca=new V.Object3D({geometries:ua,layerUid:this._context.layer.uid,
graphicUid:Ba,isElevationSource:!0});Ca.transformation=La;pa=G.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});ua=new D.Graphics3DObject3DGraphicLayer(this,Ca,ua,null,null,(db,ka,mb,sb,tb)=>{db=db.stageObject;const xa=db.geometries,Ha=xa.length;ka="absolute-height"!==ka.mode;let na=0;const za=db.transformation,Da=g.invertOrIdentity(e.create(),za);for(let Ma=0;Ma<Ha;Ma+=2){const Xa=xa[Ma];if(!S.isGeometryWithMapPositions(Xa))continue;const ab=Xa.getMutableAttribute(Q.VertexAttribute.POSITION).data,
Ja=va[Ma/2],Qa=new L.SamplePosition(Xa.mapPositions),Sa=ab.length/3;let cb=0,eb=!1,lb=0;for(let rb=0;rb<Sa;rb++){ea[0]=ab[cb];ea[1]=ab[cb+1];ea[2]=ab[cb+2];sb(Qa,Y);ka&&(lb+=Y.sampledElevation);H.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(n.set(ca,Qa.array[Qa.offset],Qa.array[Qa.offset+1],Y.z+Ja[cb/3]),null!=mb&&tb.toRenderCoords(ca,mb,ca)):(n.set(ca,ab[cb],ab[cb+1],ab[cb+2]),n.transformMat4(ca,ca,za),tb.setAltitude(ca,Y.z+Ja[cb/3]));n.transformMat4(ca,ca,Da);ab[cb]=ca[0];ab[cb+1]=ca[1];ab[cb+2]=ca[2];
const vb=.01/tb.unitInMeters;if(Math.abs(ea[0]-ab[cb])>=vb||Math.abs(ea[1]-ab[cb+1])>=vb||Math.abs(ea[2]-ab[cb+2])>=vb)eb=!0;Qa.offset+=3;cb+=3}eb&&(Xa.invalidateBoundingInfo(),db.geometryVertexAttributeUpdated(xa[Ma],Q.VertexAttribute.POSITION),xa[Ma+1].invalidateBoundingInfo(),db.geometryVertexAttributeUpdated(xa[Ma+1],Q.VertexAttribute.POSITION));na+=lb/Sa}return na/Ha},wa,null!=pa?{baseMaterial:this._materials[ra.Main],edgeMaterials:[pa],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:
null);ua.alignedSampledElevation=ya.sampledElevation;ua.needsElevationUpdates=y.needsElevationUpdates3D(wa.mode);return ua}}const X=l.create(),da=l.create(),ha=l.create(),fa=l.create(),aa=l.create(),Z=l.create(),ea=l.create(),ca=l.create(),W=l.create(),Y=new y.SampleElevationInfo,ja=[0,2,1],oa=[0,1,2];var ra;(function(ya){ya[ya.Main=0]="Main";ya[ya.Bottom=1]="Bottom"})(ra||={});class ta{constructor(ya,Ca,pa,wa){this.positions=ya;this.elevation=Ca;this.normals=pa;this.heights=wa}}a.Graphics3DExtrudeSymbolLayer=
ba;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(a,b){var h={exports:{}};(function(c){(function(k){k=k();void 0!==k&&(c.exports=k)})(function(){function k(F,G,H){H=H||2;var L=G&&G.length,C=L?G[0]*H:F.length,z=m(F,0,C,H,!0),J=[];if(!z||z.next===z.prev)return J;var K;if(L){var I=z;var M=H;z=[];var S;L=0;for(S=G.length;L<S;L++){var N=G[L]*M;var V=L<S-1?G[L+1]*M:F.length;N=m(F,N,V,M,!1);N===N.next&&(N.steiner=
!0);V=z;var Q=V.push,T=N,ia=N;do{if(T.x<ia.x||T.x===ia.x&&T.y<ia.y)ia=T;T=T.next}while(T!==N);Q.call(V,ia)}z.sort(e);for(L=0;L<z.length;L++)M=z[L],G=I,(I=l(M,G))?(S=y(I,M),M=d(I,I.next),S=n(S),d(S,S.next),M=n(M),I=n(G===I?M:G)):I=G,I=d(I,I.next);z=I}if(F.length>80*H){var O=K=F[0];var U=L=F[1];for(M=H;M<C;M+=H)G=F[M],I=F[M+1],G<O&&(O=G),I<U&&(U=I),G>K&&(K=G),I>L&&(L=I);K=Math.max(K-O,L-U);K=0!==K?1/K:0}f(z,J,H,O,U,K);return J}function m(F,G,H,L,C){if(C===0<B(F,G,H,L))for(C=G;C<H;C+=L)var z=D(C,F[C],
F[C+1],z);else for(C=H-L;C>=G;C-=L)z=D(C,F[C],F[C+1],z);z&&q(z,z.next)&&(F=z.next,E(z),z=F);return z}function d(F,G){if(!F)return F;G||=F;do{var H=!1;if(F.steiner||!q(F,F.next)&&0!==w(F.prev,F,F.next))F=F.next;else{G=F.prev;E(F);F=G;if(F===F.next)break;H=!0}}while(H||F!==G);return G}function f(F,G,H,L,C,z,J){if(F){if(!J&&z){var K=F,I=K;do null===I.z&&(I.z=u(I.x,I.y,L,C,z)),I.prevZ=I.prev,I=I.nextZ=I.next;while(I!==K);I.prevZ.nextZ=null;I.prevZ=null;K=I;var M,S,N,V,Q=1;do{I=K;var T=K=null;for(S=0;I;){S++;
var ia=I;for(M=N=0;M<Q&&(N++,ia=ia.nextZ,ia);M++);for(V=Q;0<N||0<V&&ia;)0!==N&&(0===V||!ia||I.z<=ia.z)?(M=I,I=I.nextZ,N--):(M=ia,ia=ia.nextZ,V--),T?T.nextZ=M:K=M,M.prevZ=T,T=M;I=ia}T.nextZ=null;Q*=2}while(1<S)}for(K=F;F.prev!==F.next;){I=F.prev;ia=F.next;if(z)T=g(F,L,C,z);else a:if(T=F,S=T.prev,N=T,Q=T.next,0<=w(S,N,Q))T=!1;else{for(M=T.next.next;M!==T.prev;){if(x(S.x,S.y,N.x,N.y,Q.x,Q.y,M.x,M.y)&&0<=w(M.prev,M,M.next)){T=!1;break a}M=M.next}T=!0}if(T)G.push(I.i/H),G.push(F.i/H),G.push(ia.i/H),E(F),
K=F=ia.next;else if(F=ia,F===K){if(!J)f(d(F),G,H,L,C,z,1);else if(1===J){F=d(F);J=G;K=H;I=F;do ia=I.prev,T=I.next.next,!q(ia,T)&&v(ia,I,I.next,T)&&r(ia,T)&&r(T,ia)&&(J.push(ia.i/K),J.push(I.i/K),J.push(T.i/K),E(I),E(I.next),I=F=T),I=I.next;while(I!==F);F=d(I);f(F,G,H,L,C,z,2)}else if(2===J)a:{J=F;do{for(K=J.next.next;K!==J.prev;){if(I=J.i!==K.i){T=T=T=T=void 0;I=J;ia=K;if(T=I.next.i!==ia.i&&I.prev.i!==ia.i){b:{T=I;do{if(T.i!==I.i&&T.next.i!==I.i&&T.i!==ia.i&&T.next.i!==ia.i&&v(T,T.next,I,ia)){T=!0;
break b}T=T.next}while(T!==I);T=!1}T=!T}if(T){if(T=r(I,ia)&&r(ia,I)){T=I;S=!1;N=(I.x+ia.x)/2;Q=(I.y+ia.y)/2;do T.y>Q!==T.next.y>Q&&T.next.y!==T.y&&N<(T.next.x-T.x)*(Q-T.y)/(T.next.y-T.y)+T.x&&(S=!S),T=T.next;while(T!==I);T=S}T=T&&(w(I.prev,I,ia.prev)||w(I,ia.prev,ia))||q(I,ia)&&0<w(I.prev,I,I.next)&&0<w(ia.prev,ia,ia.next)}I=T}if(I){F=y(J,K);J=d(J,J.next);F=d(F,F.next);f(J,G,H,L,C,z);f(F,G,H,L,C,z);break a}K=K.next}J=J.next}while(J!==F)}break}}}}function g(F,G,H,L){var C=F.prev,z=F.next;if(0<=w(C,
F,z))return!1;var J=C.x>F.x?C.x>z.x?C.x:z.x:F.x>z.x?F.x:z.x,K=C.y>F.y?C.y>z.y?C.y:z.y:F.y>z.y?F.y:z.y,I=u(C.x<F.x?C.x<z.x?C.x:z.x:F.x<z.x?F.x:z.x,C.y<F.y?C.y<z.y?C.y:z.y:F.y<z.y?F.y:z.y,G,H,L);G=u(J,K,G,H,L);H=F.prevZ;for(L=F.nextZ;H&&H.z>=I&&L&&L.z<=G;){if(H!==F.prev&&H!==F.next&&x(C.x,C.y,F.x,F.y,z.x,z.y,H.x,H.y)&&0<=w(H.prev,H,H.next))return!1;H=H.prevZ;if(L!==F.prev&&L!==F.next&&x(C.x,C.y,F.x,F.y,z.x,z.y,L.x,L.y)&&0<=w(L.prev,L,L.next))return!1;L=L.nextZ}for(;H&&H.z>=I;){if(H!==F.prev&&H!==F.next&&
x(C.x,C.y,F.x,F.y,z.x,z.y,H.x,H.y)&&0<=w(H.prev,H,H.next))return!1;H=H.prevZ}for(;L&&L.z<=G;){if(L!==F.prev&&L!==F.next&&x(C.x,C.y,F.x,F.y,z.x,z.y,L.x,L.y)&&0<=w(L.prev,L,L.next))return!1;L=L.nextZ}return!0}function e(F,G){return F.x-G.x}function n(F){if(F.next.prev===F)return F;let G=F;do{const H=G.next;if(H.prev===G||H===G||H===F)break;G=H}while(1);return G}function l(F,G){var H=G,L=F.x,C=F.y,z=-Infinity;do{if(C<=H.y&&C>=H.next.y&&H.next.y!==H.y){var J=H.x+(C-H.y)*(H.next.x-H.x)/(H.next.y-H.y);
if(J<=L&&J>z){z=J;if(J===L){if(C===H.y)return H;if(C===H.next.y)return H.next}var K=H.x<H.next.x?H:H.next}}H=H.next}while(H!==G);if(!K)return null;if(L===z)return K;G=K;J=K.x;var I=K.y,M=Infinity;H=K;do{if(L>=H.x&&H.x>=J&&L!==H.x&&x(C<I?L:z,C,J,I,C<I?z:L,C,H.x,H.y)){var S=Math.abs(C-H.y)/(L-H.x);var N;if((N=r(H,F))&&!(N=S<M)&&(N=S===M)&&!(N=H.x>K.x)&&(N=H.x===K.x)){N=K;var V=H;N=0>w(N.prev,N,V.prev)&&0>w(V.next,N,N.next)}N&&(K=H,M=S)}H=H.next}while(H!==G);return K}function u(F,G,H,L,C){F=32767*(F-
H)*C;G=32767*(G-L)*C;F=(F|F<<8)&16711935;F=(F|F<<4)&252645135;F=(F|F<<2)&858993459;G=(G|G<<8)&16711935;G=(G|G<<4)&252645135;G=(G|G<<2)&858993459;return(F|F<<1)&1431655765|((G|G<<1)&1431655765)<<1}function x(F,G,H,L,C,z,J,K){return 0<=(C-J)*(G-K)-(F-J)*(z-K)&&0<=(F-J)*(L-K)-(H-J)*(G-K)&&0<=(H-J)*(z-K)-(C-J)*(L-K)}function w(F,G,H){return(G.y-F.y)*(H.x-G.x)-(G.x-F.x)*(H.y-G.y)}function q(F,G){return F.x===G.x&&F.y===G.y}function v(F,G,H,L){var C=t(w(F,G,H)),z=t(w(F,G,L)),J=t(w(H,L,F)),K=t(w(H,L,G));
return C!==z&&J!==K||0===C&&p(F,H,G)||0===z&&p(F,L,G)||0===J&&p(H,F,L)||0===K&&p(H,G,L)?!0:!1}function p(F,G,H){return G.x<=Math.max(F.x,H.x)&&G.x>=Math.min(F.x,H.x)&&G.y<=Math.max(F.y,H.y)&&G.y>=Math.min(F.y,H.y)}function t(F){return 0<F?1:0>F?-1:0}function r(F,G){return 0>w(F.prev,F,F.next)?0<=w(F,G,F.next)&&0<=w(F,F.prev,G):0>w(F,G,F.prev)||0>w(F,F.next,G)}function y(F,G){var H=new A(F.i,F.x,F.y),L=new A(G.i,G.x,G.y),C=F.next,z=G.prev;F.next=G;G.prev=F;H.next=C;C.prev=H;L.next=H;H.prev=L;z.next=
L;L.prev=z;return L}function D(F,G,H,L){F=new A(F,G,H);L?(F.next=L.next,F.prev=L,L.next.prev=F,L.next=F):(F.prev=F,F.next=F);return F}function E(F){F.next.prev=F.prev;F.prev.next=F.next;F.prevZ&&(F.prevZ.nextZ=F.nextZ);F.nextZ&&(F.nextZ.prevZ=F.prevZ)}function A(F,G,H){this.i=F;this.x=G;this.y=H;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(F,G,H,L){for(var C=0,z=H-L;G<H;G+=L)C+=(F[z]-F[G])*(F[G+1]+F[z+1]),z=G;return C}k.deviation=function(F,G,H,L){var C=G&&G.length,
z=Math.abs(B(F,0,C?G[0]*H:F.length,H));if(C){C=0;for(var J=G.length;C<J;C++)z-=Math.abs(B(F,G[C]*H,C<J-1?G[C+1]*H:F.length,H))}for(C=G=0;C<L.length;C+=3){J=L[C]*H;var K=L[C+1]*H,I=L[C+2]*H;G+=Math.abs((F[J]-F[I])*(F[K+1]-F[J+1])-(F[J]-F[K])*(F[I+1]-F[J+1]))}return 0===z&&0===G?0:Math.abs((G-z)/z)};k.flatten=function(F){for(var G=F[0][0].length,H={vertices:[],holes:[],dimensions:G},L=0,C=0;C<F.length;C++){for(var z=0;z<F[C].length;z++)for(var J=0;J<G;J++)H.vertices.push(F[C][z][J]);0<C&&(L+=F[C-1].length,
H.holes.push(L))}return H};return k})})(h);b=b.getDefaultExportFromCjs(h.exports);a.earcut=b})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,h,c,k,m,d=!1){return{objectId:b,target:h,distance:c,type:"edge",start:k,end:m,draped:d}};a.makeVertexCandidate=function(b,h,c){return{objectId:b,target:h,distance:c,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports",
"../../Color","../visualVariables/support/visualVariableUtils"],function(a,b,h){function c(m,d){if(!m||m.symbol)return null;d=d?.renderer;return m&&null!=d&&d.getObservationRenderer?d.getObservationRenderer(m):d}async function k(m,d){if(null!=m.symbol)return m.symbol;const f=c(m,d);return null!=f?f.getSymbolAsync(m,d):null}a.getDriverAxisSizeValue=function(m,d=0){m=m[d];return"number"===typeof m&&isFinite(m)?m:null};a.getDriverAxisSizeValueAny=function(m){for(let d=0;3>d;d++){const f=m[d];if("number"===
typeof f)return isFinite(f)?f:0}return 0};a.getRenderer=c;a.getRenderingInfo=function(m,d){const f=c(m,d);if(null!=m.symbol)var g=m.symbol;else g=c(m,d),g=null!=g&&"dot-density"!==g.type?g.getSymbol(m,d):null;if(null==g)return null;g={renderer:f,symbol:g};if(!(null!=f&&"visualVariables"in f&&f.visualVariables))return g;d=h.getVisualVariableValues(f,m,d)??[];m=["proportional","proportional","proportional"];for(const {variable:e,value:n}of d)switch(e.type){case "color":g.color=n.toRgba();break;case "size":if("outline"===
e.target)g.outlineSize=n;else switch(d=e.useSymbolValue?"symbol-value":n,e.axis){case "width":m[0]=d;break;case "depth":m[1]=d;break;case "height":m[2]=d;break;case "width-and-depth":m[0]=m[1]=d;break;default:m[0]=m[1]=m[2]=d}break;case "opacity":g.opacity=n;break;case "rotation":switch(e.axis){case "tilt":g.tilt=n;break;case "roll":g.roll=n;break;default:g.heading=n}}if("proportional"!==m[0]||"proportional"!==m[1]||"proportional"!==m[2])g.size=m;return g};a.getRenderingInfoAsync=async function(m,
d){var f=c(m,d),g=await k(m,d);if(!g)return null;g={renderer:f,symbol:g};if(!(f&&"visualVariables"in f&&f.visualVariables))return g;d=h.getVisualVariableValues(f,m,d)??[];m=["proportional","proportional","proportional"];for(const {variable:e,value:n}of d)"color"===e.type?g.color=b.toUnitRGBA(n):"size"===e.type?"outline"===e.target?g.outlineSize=n:(d=e.axis,f=e.useSymbolValue?"symbol-value":n,"width"===d?m[0]=f:"depth"===d?m[1]=f:"height"===d?m[2]=f:m[0]="width-and-depth"===d?m[1]=f:m[1]=m[2]=f):"opacity"===
e.type?g.opacity=n:"rotation"===e.type&&"tilt"===e.axis?g.tilt=n:"rotation"===e.type&&"roll"===e.axis?g.roll=n:"rotation"===e.type&&(g.heading=n);if(isFinite(m[0])||isFinite(m[1])||isFinite(m[2]))g.size=m;return g};a.getSymbolAsync=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/mathUtils ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec32 ../../../../geometry/support/Axis ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(r,y,D,E){const A=Array.isArray(y[0])?(F,G)=>y[F][G]:(F,G)=>y[3*F+G],B=E?c.getMetersPerUnitForSR(E)/c.getMetersPerVerticalUnitForSR(E):1;return g.fromManyPoints(r,(F,G)=>m.set(F,A(G,0)*B,A(G,1)*B,A(G,2)),D)}function v(r,y,D){r=q(p,r,y,D)?g.getNormal(p):[0,0,1];return Math.abs(r[2])>Math.cos(h.deg2rad(80))?d.Axis.Z:Math.abs(r[1])>Math.abs(r[0])?d.Axis.Y:d.Axis.X}const p=g.create();class t{constructor(r,y,D){this.renderData=r;this.layerUid=y;this.graphicUid=
D;this.outGeometries=[]}}a.PolygonCreationDataBase=t;a.createColorGeometry=function(r){const y=[[u.VertexAttribute.POSITION,new e.Attribute(r.attributeData.position,r.indices,3,!0)]],D=f.getZeroIndexArray(r.indices.length);null!=r.attributeData.colorFeature?y.push([u.VertexAttribute.COLORFEATUREATTRIBUTE,new e.Attribute([r.attributeData.colorFeature],D,1,!0)]):r.attributeData.color&&y.push([u.VertexAttribute.COLOR,new e.Attribute(r.attributeData.color,D,4,!0)]);r.attributeData.uvMapSpace&&y.push([u.VertexAttribute.UVMAPSPACE,
new e.Attribute(r.attributeData.uvMapSpace,r.indices,4,!0)]);r.attributeData.boundingRect&&y.push([u.VertexAttribute.BOUNDINGRECT,new e.Attribute(r.attributeData.boundingRect,r.indices,9,!0)]);return new l.Geometry(r.material,y,r.mapPositions,n.ContentObjectType.Mesh,r.attributeData.objectAndLayerIdColor)};a.createIndices3D=function(r,y,D){D=v(r,(0<y.length?y[0]:r.length/3)-1,D);if(D!==d.Axis.Z){r=r.slice();for(let E=0;E<r.length;E+=3)r[E+D]=r[E+2]}return k.earcut(r,y,3)};a.createWaterGeometry=function(r,
y=null){const D=[[u.VertexAttribute.POSITION,new e.Attribute(r.attributeData.position,r.indices,3,!0)],[u.VertexAttribute.UV0,new e.Attribute(r.attributeData.uv0,r.indices,2,!0)]];return new l.Geometry(r.material,D,r.mapPositions,n.ContentObjectType.Mesh,y)};a.fitPlane=q;a.geometryAsPolygon=function(r){switch(r.type){case "extent":if(r instanceof x)return w.fromExtent(r);break;case "polygon":return r}return null};a.leastSignificantAxis=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,h,c,k,m){function d(x,w,q=null){return x.filter(({count:v})=>1<v).map(({index:v,count:p})=>{const t=3*v,r=3*p;return null!=q?new e(v,p,h.doubleSubArray(w,t,r),h.doubleSubArray(q,t,r)):new g(v,
p,h.doubleSubArray(w,t,r))})}function f(x,w,q=null){const v=[];for(const {index:p,count:t,holeIndices:r,pathLengths:y}of x){if(1>=t)continue;x=3*p;const D=3*t,E=r.map(A=>A-p);x=null!=q?new n(p,t,h.doubleSubArray(w,3*p,3*t),h.doubleSubArray(q,x,D),E,y):new l(p,t,h.doubleSubArray(w,3*p,3*t),E,y);v.push(x)}return v}class g{constructor(x,w,q){this.index=x;this.count=w;this.position=q}}class e extends g{constructor(x,w,q,v){super(x,w,q);this.mapPositions=v}}class n extends e{constructor(x,w,q,v,p,t){super(x,
w,q,v);this.holeIndices=p;this.pathLengths=t}}class l extends g{constructor(x,w,q,v,p){super(x,w,q);this.holeIndices=v;this.pathLengths=p}}class u{constructor(x,w,q,v,p,t){this.position=x;this.mapPositions=w;this.polygons=q;this.outlines=v;this.projectionSuccess=p;this.sampledElevation=t}}a.PolygonRenderInfo=u;a.PolygonVertexData=n;a.PolygonVertexDataDraped=l;a.geometryToRenderInfo=function(x,w,q,v){const p=c.pathsToTriangulationInfo(x.rings,!!x.hasZ,c.CounterClockwiseMode.CCW_IS_HOLE,x.spatialReference),
t=h.newDoubleArray(p.position.length);x=k.applyPerVertexElevationAlignment(p.position,x.spatialReference,0,t,0,p.position,0,p.position.length/3,w,q,v);w=null!=x;return new u(p.position,t,f(p.polygons,p.position,t),d(p.outlines,p.position,t),w,x)};a.geometryToRenderInfoDraped=function(x,w){const q=c.pathsToTriangulationInfo(x.rings,!1,c.CounterClockwiseMode.CCW_IS_HOLE);x=b.projectBuffer(q.position,x.spatialReference,0,q.position,w,0,q.position.length/3);for(w=2;w<q.position.length;w+=3)q.position[w]=
m.drapedZ;return{position:q.position,polygons:f(q.polygons,q.position),outlines:d(q.outlines,q.position),projectionSuccess:x}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./Axis ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate ../../views/3d/layers/graphics/polygonUtils".split(" "),function(a,b,h,c,k,m,d,f){function g(u,x,w){if(1===u.length)return u[0];x=k.newDoubleArray(x);w=
Array(w);let q=0,v=0,p=0;for(const t of u){for(u=0;u<t.position.length;u++)x[q++]=t.position[u];for(const r of t.faces)w[v++]=r+p;p=q/3}return{position:x,faces:m.compactIndices(w)}}function e(u,x,w,q){const v=u.length,p=Array(v),t=Array(v),r=Array(v);let y=0,D=0,E=0;var A=0;for(var B=0;B<v;++B)A+=u[B].length;A=k.newDoubleArray(3*A);B=0;for(let L=v-1;0<=L;L--){var F=u[L],G=w===a.CounterClockwiseMode.CCW_IS_HOLE?l(F,x,q):!1;if(G&&1!==v)p[y++]=F;else{var H=F.length;for(let C=0;C<y;++C)H+=p[C].length;
H={index:B,pathLengths:Array(y+1),count:H,holeIndices:Array(y)};H.pathLengths[0]=F.length;0<F.length&&(r[E++]={index:B,count:F.length});B=G?n(F,F.length-1,-1,A,B,F.length,x):n(F,0,1,A,B,F.length,x);for(F=0;F<y;++F)G=p[F],H.holeIndices[F]=B,H.pathLengths[F+1]=G.length,0<G.length&&(r[E++]={index:B,count:G.length}),B=n(G,0,1,A,B,G.length,x);y=0;0<H.count&&(t[D++]=H)}}for(u=0;u<y;++u)w=p[u],0<w.length&&(r[E++]={index:B,count:w.length}),B=n(w,0,1,A,B,w.length,x);t.length=D;r.length=E;return{position:A,
polygons:t,outlines:r}}function n(u,x,w,q,v,p,t){v*=3;for(let r=0;r<p;++r){const y=u[x];q[v++]=y[0];q[v++]=y[1];q[v++]=t?y[2]:0;x+=w}return v/3}function l(u,x,w){if(x){x=f.leastSignificantAxis(u,u.length-1,w);if(x===h.Axis.X)return!c.isClockwise(u,h.Axis.Y,h.Axis.Z);if(x===h.Axis.Y)return!c.isClockwise(u,h.Axis.X,h.Axis.Z)}return!c.isClockwise(u,h.Axis.X,h.Axis.Y)}a.CounterClockwiseMode=void 0;(function(u){u[u.NONE=0]="NONE";u[u.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode=
{}));a.isCounterClockwise=l;a.pathsToTriangulationInfo=e;a.triangulate=function(u){u=e(u.rings,u.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE,u.spatialReference);const x=[];let w=0,q=0;for(var v of u.polygons){const t=v.index,r=k.doubleSubArray(u.position,3*t,3*v.count);var p=v.holeIndices.map(y=>y-t);p=m.compactIndices(b.earcut(r,p,3));x.push({position:r,faces:p});w+=r.length;q+=p.length}v=g(x,w,q);u=Array.isArray(v.position)?d.deduplicate(v.position,3,{originalIndices:v.faces}):d.deduplicate(v.position.buffer,
6,{originalIndices:v.faces});v.position=k.doubleArrayFrom(new Float64Array(u.buffer));v.faces=u.indices;return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,h){let c=null;a.deduplicate=function(k,m,d){var f=Array.isArray(k),g=f?k.length/m:k.byteLength/(4*m),e=f?k:new Uint32Array(k,0,g*m),n=d?.minReduction??0;const l=(k=d?.originalIndices||null)?k.length:
0;var u=d?.componentOffsets||null;d=0;if(u)for(var x=0;x<u.length-1;x++){var w=u[x+1]-u[x];w>d&&(d=w)}else d=g;var q=Math.floor(1.1*d)+1;if(null==c||c.length<2*q)c=new Uint32Array(b.nextHighestPowerOfTwo(2*q));for(d=0;d<2*q;d++)c[d]=0;d=0;const v=(w=!!u&&!!k)?l:g;x=h.newIndexArray(g);var p=new Uint32Array(l),t=0!==n?Math.ceil(7.84*1.96/(n*n)*n*(1-n)):v,r=1,y=u?u[1]:v;for(let F=0;F<v;F++){if(F===t){var D=1-d/F;if(D+1.96*Math.sqrt(D*(1-D)/F)<n)return null;t*=2}if(F===y){for(y=0;y<2*q;y++)c[y]=0;if(k)for(y=
u[r-1];y<u[r];y++)p[y]=x[k[y]];y=u[++r]}D=w?k[F]:F;const G=D*m;var E=0;for(var A=0;A<m;A++)E=e[G+A]+E|0,E=E+(E<<11)+(E>>>2)|0;E>>>=0;A=E%q;let H=d;for(;0!==c[2*A+1];){if(c[2*A]===E){const L=c[2*A+1]-1;var B=L*m;a:{for(let C=0;C<m;C++)if(e[G+C]!==e[B+C]){B=!1;break a}B=!0}if(B){H=x[L];break}}A++;A>=q&&(A-=q)}H===d&&(c[2*A]=E,c[2*A+1]=D+1,d++);x[D]=H}if(0!==n&&1-d/g<n)return null;if(w){for(g=u[r-1];g<p.length;g++)p[g]=x[k[g]];x=h.compactIndices(p)}f=f?Array(d):new Uint32Array(d*m);d=0;for(t=0;t<v;t++)if(x[t]===
d){g=e;n=(w?k[t]:t)*m;u=f;q=d*m;p=m;for(r=0;r<p;r++)u[q+r]=g[n+r];d++}if(k&&!w){m=new Uint32Array(l);for(e=0;e<m.length;e++)m[e]=x[k[e]];x=h.compactIndices(m)}return{buffer:Array.isArray(f)?f:f.buffer,indices:x,uniqueCount:d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayContent ./OverlayRenderTargets ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../../chunks/OverlayCompositing.glsl ../webgl-engine/shaders/OverlayCompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X){a.OverlayRenderer=class extends H.SyncRenderPlugin{constructor(aa){super(aa);this._renderTargets=this._overlays=null;this._overlayParameters=new O.OverlayCompositingPassParameters;this._hasWater=this.hasHighlights=!1;this._renderers=new Map;this._sortedDrapeSourceRenderersDirty=!1;this._sortedRenderers=new m;this._passParameters=new F.TextureOnlyPassParameters;this._materialRepository=null;this._screenToWorldRatio=
1;this._localOriginFactory=null;this.unloadedMemory=0;this.ignoresMemoryFactor=!1;this._camera=new L.Camera;this.worldToPCSRatio=1;this.events=new h;this.longitudeCyclical=null;this.produces=new Map([[I.RenderSlot.DRAPED_MATERIAL,Z=>Z!==A.ShaderOutput.Highlight||this.hasHighlights],[I.RenderSlot.DRAPED_WATER,()=>this._hasWater]]);this._hasDrapedRasterSource=this._hasDrapedFeatureSource=this._hasTargetWithoutRasterImage=!1}initialize(){const aa=this.view._stage.renderer.fboCache,Z=this.view._stage.renderView,
{waterTextures:ea,stippleTextures:ca,markerTextures:W}=Z;this._shaderTechniques=new G.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:v.ViewingMode.Local,stippleTextureRepository:ca,markerTextureRepository:W,waterTextureRepository:ea});this._renderContext=new K.OverlayRenderContext(this._rctx,new M.ShadowMap(aa,this.view.state.viewingMode),null);this.addHandles([d.watch(()=>ea.updating,()=>this.events.emit("content-changed"),d.syncAndInitial),d.watch(()=>this.spatialReference,Y=>this._localOriginFactory=
new z.GridLocalOriginFactory(Y),d.syncAndInitial),d.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]);this._materialRepository=new C.GLMaterialRepository(Z.textureRepository,this._shaderTechniques,()=>{this.notifyChange("rendersOccludedDraped");this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=I.RenderSlot.DRAPED_MATERIAL;this._bindParameters.mainDepth=
null;this._camera.near=1;this._camera.far=1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new ia.AmbientLight(q.fromValues(1,1,1))]);this.addHandles(this.view.resourceController.scheduler.registerTask(P.TaskPriority.STAGE,this))}destroy(){this._renderers.forEach(aa=>
aa.destroy());this._renderers.clear();this._debugTextureTechnique=k.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=k.disposeMaybe(this._passParameters.texture);this._shaderTechniques=k.destroyMaybe(this._shaderTechniques);this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(aa){this.pluginContext=
aa}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||c.someMap(this._renderers,aa=>aa.updating)}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMemoryForMaterial(aa){return Array.from(this._renderers.values()).reduce((Z,ea)=>Z+ea.getMemoryForMaterial(aa),0)}get layers(){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();return this._sortedRenderers.map(aa=>aa.drapeSource.layer).filter(aa=>
!!aa)}createGeometryDrapeSourceRenderer(aa){return this.createDrapeSourceRenderer(aa,S.SortedRenderGeometryRenderer)}createDrapeSourceRenderer(aa,Z,ea){const ca=this._renderers.get(aa);null!=ca&&ca.destroy();Z=new Z({...ea,rendererContext:this,drapeSource:aa});this._renderers.set(aa,Z);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in aa&&this.addHandles(d.watch(()=>aa.fullOpacity,()=>this.events.emit("content-changed")),aa);return Z}removeDrapeSourceRenderer(aa){if(null!=aa){var Z=this._renderers.get(aa);
null!=Z&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(aa),this.removeHandles(aa),Z.destroy())}}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(aa){this._hasTargetWithoutRasterImage=this._overlays?f.someSet(aa,Z=>Z.drapeTargetType===p.DrapeTargetType.WithoutRasterImage):!1}ensureDrapeSources(aa){this._overlays?(this._hasDrapedFeatureSource=f.someSet(aa,
Z=>Z.drapeSourceType===p.DrapeSourceType.Features),this._hasDrapedRasterSource=f.someSet(aa,Z=>Z.drapeSourceType===p.DrapeSourceType.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(aa,Z,ea=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new E.OverlayRenderTargets(this.view._stage.renderer.fboCache),
this._overlays=[new y.Overlay,new y.Overlay]);this.ensureDrapeTargets(aa);this.ensureDrapeSources(Z);this._bindParameters.overlayStretch=ea}disposeOverlays(){this._overlays=null;this._renderTargets=k.disposeMaybe(this._renderTargets);this.events.emit("textures-disposed")}getTexture(aa){if(null!=aa)return aa===D.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(D.OverlayContent.Color):this._renderTargets?.getTexture(aa)}get running(){return this.updating}runTask(aa){this._processDrapeSources(aa,
()=>!0)}_processDrapeSources(aa,Z){let ea=!1;for(const [ca,W]of this._renderers){if(aa.done)break;(ca.destroyed||Z(ca))&&W.commitChanges()&&(ea=!0,aa.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ea=!0,this._updateSortedDrapeSourceRenderers());ea&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=c.someMap(this._renderers,
ca=>ca.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(P.noBudget,aa=>aa.updatePolicy===T.UpdatePolicy.SYNC)}get isEmpty(){return t.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!c.someMap(this._renderers,aa=>!aa.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const aa=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=fa;const Z=this._sortedRenderers.some(({renderer:ea})=>
ea.shouldRender(this._renderContext));this._renderContext.renderOccludedMask=aa;return Z}renders(aa){return t.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&aa!==D.OverlayContent.Occluded||this._sortedRenderers.some(({renderer:Z})=>Z.shouldRender(this._renderContext))}get mode(){return this.isEmpty?B.OverlayMode.Disabled:this._renderTargets?.getTexture(D.OverlayContent.WaterNormal)?B.OverlayMode.EnabledWithWater:this._renderTargets?.getTexture(D.OverlayContent.Color)?B.OverlayMode.Enabled:B.OverlayMode.Disabled}updateAnimation(aa){let Z=
!1;this._renderers.forEach(ea=>Z=ea.updateAnimation(aa)||Z);return Z}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(aa){if(this._overlays&&this._renderTargets){for(const Z of this._overlays)this.longitudeCyclical?Z.setupGeometryViewsCyclical(this.longitudeCyclical):Z.setupGeometryViewsDirect();for(const Z of this._renderTargets.targets)if(Z.content!==D.OverlayContent.ColorNoRasterImage||this._needsColorWithoutRasterImage)this._drawTarget(r.OverlayIndex.INNER,Z,aa),
this._drawTarget(r.OverlayIndex.OUTER,Z,aa)}}_drawTarget(aa,Z,ea){const ca=this._overlays[aa],W=ca.canvasGeometries;if(0!==W.numViews){var {alignPixelEnabled:Y,contentPixelRatio:ja}=ea;this._screenToWorldRatio=ja*ca.mapUnitsPerPixel/this._bindParameters.overlayStretch;var oa=Z.output;if(!(this.isEmpty||oa===A.ShaderOutput.Highlight&&!this.hasHighlights||oa===A.ShaderOutput.Normal&&!this.hasWater)&&ca.hasSomeSizedView()){var ra=this._rctx;this._camera.pixelRatio=ca.pixelRatio*ja;this._renderContext.output=
oa;this._bindParameters.alignPixelEnabled=Y;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=oa===A.ShaderOutput.Normal?I.RenderSlot.DRAPED_WATER:I.RenderSlot.DRAPED_MATERIAL;Z.content===D.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=fa);if(this.renders(Z.content)){ea=ca.resolution;this._rctx.setViewport(aa===r.OverlayIndex.INNER?0:ea,0,ea,ea);var ta=2*
ca.resolution,ya=ca.resolution,Ca=Z.fbo;Ca.bind(ra,ta,ya);aa===r.OverlayIndex.INNER&&(ra.setClearColor(0,0,0,0),ra.clearSafe(R.ClearBufferBit.COLOR_BUFFER_BIT));if(t.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&Z.content!==D.OverlayContent.Occluded)for(ea=0;ea<W.numViews;ea++)this._setViewParameters(W.extents[ea],ca),this._ensureDebugPatternResources(ca.resolution,ha[aa]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();
this._sortedRenderers.forAll(({drapeSource:pa,renderer:wa})=>{if(Z.content!==D.OverlayContent.ColorNoRasterImage||pa.drapeSourceType!==p.DrapeSourceType.RasterImage){var {fullOpacity:Ba}=pa;pa=null!=Ba&&1>Ba&&oa===A.ShaderOutput.Color?this.bindTemporaryFramebuffer(ta,ya):null;for(let la=0;la<W.numViews;la++)this._setViewParameters(W.extents[la],ca),wa.render(this._renderContext);pa&&(Ca.bind(ra,ta,ya),this._overlayParameters.texture=pa.getTexture(),this._overlayParameters.opacity=Ba,this._overlayParameters.overlayIndex=
aa,wa=this.pluginContext.techniqueRepository.acquire(U.OverlayCompositingTechnique),this._rctx.bindTechnique(wa,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),wa.release(),pa.release())}});ra.bindFramebuffer(null);aa===r.OverlayIndex.OUTER&&Ca.generateMipMap()}this._renderContext.renderOccludedMask=K.defaultRenderOccludedMask}}}bindTemporaryFramebuffer(aa,Z){const ea=this.view._stage.renderer.fboCache;aa=ea.acquire(aa,Z,"overlay tmp");ea.rctx.clearSafe(R.ClearBufferBit.COLOR_BUFFER_BIT);
return aa}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(aa,Z,ea,ca){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let W=0;for(const {renderer:Y}of this._sortedRenderers)W=Y.intersect?.(aa,Z,ea,ca,W)??W}_updateSortedDrapeSourceRenderers(){this._sortedRenderers.clear();if(0!==this._renderers.size){var aa=this.view.map.allLayers,Z=aa.length;this._renderers.forEach((ea,ca)=>{const W=
aa.indexOf(ca.layer),Y=0<=W;this._sortedRenderers.push(new da(ca,ea,Z*(ca.renderGroup??(Y?p.DrapedRenderGroup.MapLayer:p.DrapedRenderGroup.ViewLayer))+(Y?W:0)))});this._sortedRenderers.sort((ea,ca)=>ea.index-ca.index)}}_setViewParameters(aa,Z){const ea=this._camera;ea.viewport=[0,0,Z.resolution,Z.resolution];x.ortho(ea.projectionMatrix,0,aa[2]-aa[0],0,aa[3]-aa[1],ea.near,ea.far);x.fromTranslation(ea.viewMatrix,[-aa[0],-aa[1],0])}_updateHasWater(){const aa=c.someMap(this._renderers,Z=>Z.hasWater);
aa!==this._hasWater&&(this._hasWater=aa,this.events.emit("has-water",aa))}_ensureDebugPatternResources(aa,Z){w.set(this._passParameters.color,Z[0],Z[1],Z[2]);if(!this._passParameters.texture){Z=new Uint8Array(aa*aa*4);var ea=0;for(let ca=0;ca<aa;ca++)for(let W=0;W<aa;W++){const Y=Math.floor(W/10),ja=Math.floor(ca/10);2>Y||2>ja||10*Y>aa-20||10*ja>aa-20?(Z[ea++]=255,Z[ea++]=255,Z[ea++]=255,Z[ea++]=255):(Z[ea++]=255,Z[ea++]=255,Z[ea++]=255,Y&1&&ja&1?Z[ea++]=W&1^ca&1?0:255:Z[ea++]=Y&1^ja&1?0:128)}aa=
new X.TextureDescriptor(aa);aa.samplingMode=R.TextureSamplingMode.NEAREST;this._passParameters.texture=new ba.Texture(this._rctx,aa,Z);aa=new V.TextureTechniqueConfiguration;aa.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniques.acquire(N.TextureTechnique,aa)}}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map(({drapeSource:aa})=>aa),getDrapeSourceRenderer:aa=>this._renderers.get(aa)}}};b.__decorate([g.property()],
a.OverlayRenderer.prototype,"hasHighlights",void 0);b.__decorate([g.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);b.__decorate([g.property()],a.OverlayRenderer.prototype,"_shaderTechniques",void 0);b.__decorate([g.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([g.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([g.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);b.__decorate([g.property({type:Boolean,
readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);b.__decorate([g.property()],a.OverlayRenderer.prototype,"isEmpty",null);b.__decorate([g.property({readOnly:!0})],a.OverlayRenderer.prototype,"rendersOccludedDraped",null);a.OverlayRenderer=b.__decorate([u.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);class da{constructor(aa,Z,ea){this.drapeSource=aa;this.renderer=Z;this.index=ea}}const ha=[[1,.5,.5],[.5,.5,1]],fa=J.RenderOccludedFlag.OccludeAndTransparent;a.drapedZ=
-2;a.overlayRenderOccludedFlag=fa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";b[b.Outline=2]="Outline";b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup=
{}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=
1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define(["exports",
"../../../geometry/support/aaBoundingRect","../webgl-engine/lib/LocalOriginFactory"],function(a,b,h){class c{constructor(){this._extent=b.create();this.resolution=0;this.renderLocalOrigin=h.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new k}get extent(){return this._extent}setupGeometryViewsCyclical(m){this.setupGeometryViewsDirect();var d=.001*m.range;if(this._extent[0]-d<=m.min){const f=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b.offset(this._extent,
m.range,0,f)}this._extent[2]+d>=m.max&&(d=this.canvasGeometries.extents[this.canvasGeometries.numViews++],b.offset(this._extent,-m.range,0,d))}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1;b.copy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let m=0;m<this.canvasGeometries.numViews;m++){const d=this.canvasGeometries.extents[m];if(d[0]!==d[2]&&d[1]!==d[3])return!0}return!1}}class k{constructor(){this.extents=[b.create(),b.create(),b.create()];this.numViews=0}}
a.Overlay=c;a.OverlayStretch=1.3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class h{constructor(c,k){this.vec3=c;this.id=k}}a.LocalOrigin=h;a.fromValues=function(c,k,m,d){return new h(b.fromValues(c,k,m),d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayContent":function(){define(["exports"],
function(a){a.OverlayContent=void 0;var b=a.OverlayContent||(a.OverlayContent={});b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.WaterNormal=3]="WaterNormal";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTargets":function(){define("exports ../../../core/has ./OverlayContent ./OverlayFramebufferObject ../webgl/ManagedFBO ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),
function(a,b,h,c,k,m){class d{constructor(g,e,n,l,u=k.ColorFormat.RGBA_MIPMAP){this.output=n;this.content=l;this.fbo=new c.OverlayFramebufferObject(g,u,e)}get valid(){return this.fbo.valid}}class f{constructor(g){this.targets=[new d(g,"overlay color",m.ShaderOutput.Color,h.OverlayContent.Color),new d(g,"overlay IM color",m.ShaderOutput.Color,h.OverlayContent.ColorNoRasterImage),new d(g,"overlay highlight",m.ShaderOutput.Highlight,h.OverlayContent.Highlight,k.ColorFormat.RGBA4),new d(g,"overlay water",
m.ShaderOutput.Normal,h.OverlayContent.WaterNormal),new d(g,"overlay occluded",m.ShaderOutput.Color,h.OverlayContent.Occluded)];b("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new d(g,"overlay oid",m.ShaderOutput.ObjectAndLayerIdColor,h.OverlayContent.ObjectAndLayerIdColor))}getTexture(g){return this.targets[g]?.fbo.texture}dispose(){for(const g of this.targets)g.fbo.dispose()}computeValidity(){return this.targets.reduce((g,e,n)=>e.valid?g|=1<<n:g,0)}}a.OverlayRenderTargets=f;a.RenderTargetDescriptor=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define(["exports","../../../core/maybe"],function(a,b){class h{constructor(c,k,m){this._fbos=c;this._format=k;this._name=m}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=b.releaseMaybe(this._handle)}get texture(){return this._handle?.getTexture()}bind(c,k,m){this._handle&&this._handle.fbo.width===k&&this._handle.fbo.height===m?c.bindFramebuffer(this._handle?.fbo):
(this._handle?.release(),this._handle=this._fbos.acquire(k,m,this._name,this._format))}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}a.OverlayFramebufferObject=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/OverlayContent ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(r,y){y.pbrMode!==g.PBRMode.Water&&y.pbrMode!==g.PBRMode.WaterOnIntegratedMesh&&y.pbrMode!==g.PBRMode.TerrainWithWater||r.include(e.Water,y);const {vertex:D,fragment:E}=r;r.varyings.add("vtcOverlay","vec4");D.code.add(u.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);E.code.add(u.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);E.code.add(u.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);E.code.add(u.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(y.pbrMode===g.PBRMode.Water||y.pbrMode===g.PBRMode.WaterOnIntegratedMesh||y.pbrMode===g.PBRMode.TerrainWithWater)f.addMainLightDirection(E),f.addMainLightIntensity(E),E.code.add(u.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function v(r,y){return r.identifier===m.RenderPassIdentifier.Material&&r.output===d.ShaderOutput.Color?y.overlay?.getTexture(k.OverlayContent.ColorNoRasterImage):r.identifier===m.RenderPassIdentifier.Material&&r.output===d.ShaderOutput.ObjectAndLayerIdColor?y.overlay?.getTexture(k.OverlayContent.ObjectAndLayerIdColor):r.identifier===m.RenderPassIdentifier.Highlight?y.overlay?.getTexture(k.OverlayContent.Highlight):null}a.OverlayMode=void 0;(function(r){r[r.Disabled=0]="Disabled";r[r.Enabled=1]=
"Enabled";r[r.EnabledWithWater=2]="EnabledWithWater";r[r.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));class p extends w.Uniform{constructor(r){super(r,"vec4")}}const t=b.create();a.OverlayIM=function(r,y){const {vertex:D,fragment:E}=r;D.uniforms.add(new n.Float4DrawUniform("overlayTexOffset",(A,B)=>{const F=B.overlay?.overlays[c.OverlayIndex.INNER]?.extent;h.hasArea(F)&&(t[0]=A.toMapSpace[0]/h.width(F)-F[0]/h.width(F),t[1]=A.toMapSpace[1]/h.height(F)-F[1]/h.height(F));B=B.overlay?.overlays[c.OverlayIndex.OUTER]?.extent;
h.hasArea(B)&&(t[2]=A.toMapSpace[0]/h.width(B)-B[0]/h.width(B),t[3]=A.toMapSpace[1]/h.height(B)-B[1]/h.height(B));return t}),new n.Float4DrawUniform("overlayTexScale",(A,B)=>{const F=B.overlay?.overlays[c.OverlayIndex.INNER]?.extent;h.hasArea(F)&&(t[0]=A.toMapSpace[2]/h.width(F),t[1]=A.toMapSpace[3]/h.height(F));B=B.overlay?.overlays[c.OverlayIndex.OUTER]?.extent;h.hasArea(B)&&(t[2]=A.toMapSpace[2]/h.width(B),t[3]=A.toMapSpace[3]/h.height(B));return t}));E.constants.add("overlayOpacity","float",1);
E.uniforms.add(new x.Texture2DPassUniform("ovColorTex",(A,B)=>v(A,B)));q(r,y)};a.OverlayTerrain=function(r,y){const {vertex:D,fragment:E}=r;D.uniforms.add(new p("overlayTexOffset"),new p("overlayTexScale"));E.uniforms.add(new l.FloatPassUniform("overlayOpacity",A=>A.overlayOpacity),new x.Texture2DPassUniform("ovColorTex",(A,B)=>B.overlay?.getTexture(A.overlayContent)));q(r,y)};a.getIMColorTexture=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,h,c){class k extends c.VertexNormalPassParameters{constructor(){super(...arguments);this.origin=this.slicePlaneLocalOrigin=b.create();this.modelTransformation=null}}class m extends c.VertexNormalDrawParameters{}a.RenderPassIdentifier=void 0;(function(e){e[e.Material=0]="Material";e[e.ShadowMap=1]="ShadowMap";e[e.Highlight=2]="Highlight"})(a.RenderPassIdentifier||
(a.RenderPassIdentifier={}));class d extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Material;this.output=h.ShaderOutput.Color;this.transparent=!1}}class f extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.ShadowMap}}class g extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Highlight}}a.DrawParameters=m;a.HighlightPassParameters=g;a.MaterialPassParameters=d;a.PassParameters=k;a.ShadowMapPassParameters=
f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d,f,g,e){a.Water=function(n,l){n.include(c.PhysicallyBasedRenderingWater,
l);n.include(h.Gamma);n.include(b.FoamColor);l.hasCloudsReflections&&n.include(m.CloudsParallaxShading,l);l.hasScreenSpaceReflections&&n.include(k.ScreenSpaceReflections,l);n=n.fragment;n.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod",
"float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);n.code.add(f.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);n.uniforms.add(new d.FloatPassUniform("lightingSpecularStrength",(u,x)=>x.lighting.mainLight.specularStrength),new d.FloatPassUniform("lightingEnvironmentStrength",(u,x)=>x.lighting.mainLight.environmentStrength));n.code.add(f.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);l.hasCloudsReflections&&n.code.add(f.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);l.hasScreenSpaceReflections?(n.uniforms.add(new g.Matrix4PassUniform("view",(u,x)=>x.camera.viewMatrix),new e.Texture2DPassUniform("lastFrameColorTexture",(u,x)=>x.ssr.lastFrameColor?.getTexture()),new d.FloatPassUniform("fadeFactorSSR",(u,x)=>x.ssr.fadeFactor)),n.code.add(f.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):n.code.add(f.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);l.hasCloudsReflections?l.hasScreenSpaceReflections?n.code.add(f.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):n.code.add(f.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):n.code.add(f.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(h){h.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(h){h.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../output/ReadDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d){a.ScreenSpaceReflections=function(f,g){f=f.fragment;f.include(b.ReadLinearDepth);
f.uniforms.add(new h.Float2PassUniform("nearFar",(e,n)=>n.camera.nearFar));f.uniforms.add(new d.Texture2DPassUniform("depthMap",(e,n)=>n.linearDepth?.getTexture()));f.uniforms.add(new m.Matrix4PassUniform("proj",(e,n)=>n.camera.projectionMatrix));f.uniforms.add(new c.FloatPassUniform("invResolutionHeight",(e,n)=>1/n.camera.height));f.uniforms.add(new m.Matrix4PassUniform("reprojectionMatrix",(e,n)=>n.ssr.reprojectionMatrix));f.code.add(k.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${g.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"vec4",h.BindType.Draw,(d,f,g)=>d.setUniform4fv(k,m(f,g)))}}a.Float4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d){function f(){const n=new m.ShaderBuilder;n.include(h.ScreenSpacePass);n.fragment.uniforms.add(new d.Texture2DPassUniform("tex",l=>l.texture),new c.Float3PassUniform("uColor",l=>l.color));n.fragment.code.add(k.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`);return n}class g extends k.NoParameters{constructor(){super(...arguments);this.color=b.fromValues(1,1,1)}}const e=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:g,build:f},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=e;a.TextureOnlyPassParameters=g;a.build=f})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,h){class c{constructor(d){this._context=
d;this._perConstructorInstances=new b.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(d=>d.forEach(f=>f.technique.destroy()));this._perConstructorInstances.clear()}acquire(d,f=m){const g=f.key;let e=this._perConstructorInstances.get(d,g);if(null==e){const n=new d(this._context,f,()=>this.release(n));e=new k(n);this._perConstructorInstances.set(d,
g,e)}++e.refCount;return e.technique}releaseAndAcquire(d,f,g){if(null!=g){if(f.key===g.key)return g;this.release(g)}return this.acquire(d,f)}release(d){null==d||this._perConstructorInstances.empty||(d=this._perConstructorInstances.get(d.constructor,d.key),null!=d&&(--d.refCount,0===d.refCount&&(d.refZeroFrame=this._frameCounter)))}frameUpdate(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((d,f)=>{d.forEach((g,e)=>{0===g.refCount&&g.refZeroFrame+this._keepAliveFrameCount<
this._frameCounter&&(g.technique.destroy(),this._perConstructorInstances.delete(f,e))})})}async reloadAll(){const d=[];this._perConstructorInstances.forEach((f,g)=>{d.push((async(e,n)=>{if(n=n.shader)await n.reload(),e.forEach(l=>l.technique.reload(this._context))})(f,g))});await Promise.all(d)}}class k{constructor(d){this.technique=d;this.refZeroFrame=this.refCount=0}}const m=new h.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(a,b,h,c,k){class m{constructor(f,g,e,n){this._textureRepository=f;this._techniqueRepository=g;this.materialChanged=e;this.requestRender=n;this._id2glMaterialRef=new c.NestedMap}dispose(){this._textureRepository.destroy()}acquire(f,g,e){this._ownMaterial(f);g=f.produces.get(g);if(!g||!g(e))return null;g=this._id2glMaterialRef.get(e,
f.id);null==g&&(g=f.createGLMaterial({material:f,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:e}),g=new d(g),this._id2glMaterialRef.set(e,f.id,g));g.ref();return g.glMaterial}release(f,g){const e=this._id2glMaterialRef.get(g,f.id);null!=e&&(e.unref(),e.referenced||(h.disposeMaybe(e.glMaterial),this._id2glMaterialRef.delete(g,f.id)))}_ownMaterial(f){f.repository&&f.repository!==this&&b.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");
f.repository=this}}class d{constructor(f){this.glMaterial=f;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;k.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}a.GLMaterialRepository=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/uid ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/projectBuffer ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){class q{constructor(p){this._originSR=p;this._rootOriginId="root/"+b.generateUID();this._origins=new Map;this._objects=new Map;this._gridSize=5E5}getOrigin(p){var t=this._origins.get(this._rootOriginId);if(null==t){t=l.gridLocalOriginFactory.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,e.fromValues(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(p);p=e.fromValues(p[0]+Math.random()-.5,p[1]+Math.random()-.5,p[2]+Math.random()-.5,this._rootOriginId);
this._origins.set(this._rootOriginId,p);return p}var r=this._gridSize;const y=Math.round(p[0]/r),D=Math.round(p[1]/r),E=Math.round(p[2]/r),A=`${y}/${D}/${E}`;let B=this._origins.get(A);const F=.5*r;h.subtract(v,p,t.vec3);v[0]=Math.abs(v[0]);v[1]=Math.abs(v[1]);v[2]=Math.abs(v[2]);if(v[0]<F&&v[1]<F&&v[2]<F)return B&&(r=Math.max(...v),h.subtract(v,p,B.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<r)?B:t;B||(B=e.fromValues(y*r,D*r,E*r,A),this._origins.set(A,B));return B}_drawOriginBox(p,
t=k.fromValues(1,1,0,1)){const r=window.view,y=r._stage;var D=t.toString();if(!this._objects.has(D)){this._material=new w.RibbonLineMaterial({width:2,color:t});y.add(this._material);t=new x.WebGLLayer(y,{pickable:!1});var E=new n.Object3D({castShadow:!1});y.add(E);t.add(E);this._objects.set(D,E)}D=this._objects.get(D);t=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];E=t.length;const A=Array(3*E),B=[],F=.5*this._gridSize;for(let G=0;G<E;G++)A[3*G]=p[0]+(t[G]&1?F:-F),A[3*G+1]=p[1]+(t[G]&2?F:-F),A[3*G+2]=p[2]+
(t[G]&4?F:-F),0<G&&B.push(G-1,G);m.projectBuffer(A,this._originSR,0,A,r.renderSpatialReference,0,E);p=new g.Geometry(this._material,[[u.VertexAttribute.POSITION,new d.Attribute(A,B,3,!0)]],null,f.ContentObjectType.Line);y.add(p);D.addGeometry(p)}get test(){const p=this;return{set gridSize(t){p._gridSize=t}}}}const v=c.create();a.GridLocalOriginFactory=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory=
{rootOrigin:null};a.textTextureAtlas={stableRendering:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends m.ContentObject{get objects(){return this._objects}constructor(l,u,x=""){super();
this.stage=l;this.apiLayerUid=x;this.type=d.ContentObjectType.Layer;this.events=new b;this.pickable=this.visible=!0;this.sliceable=!1;this._objects=new k;this._objectsAdded=new k;this._handles=new h;this.apiLayerUid=x;this.visible=u?.visible??!0;this.pickable=u?.pickable??!0;this.updatePolicy=u?.updatePolicy??e.UpdatePolicy.ASYNC;this._disableOctree=u?.disableOctree??!1;l.add(this);for(const w of f.DirtyEventNames)this._handles.add(this.events.on(w,q=>l.handleEvent(w,q)))}destroy(){this._handles.size&&
(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(l){this._objects.push(l);l.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:l});null!=this._octree&&this._objectsAdded.push(l)}remove(l){this._objects.removeUnordered(l)&&(l.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:l}),null!=this._octree&&(this._objectsAdded.removeUnordered(l)||this._octree.remove([l])))}addMany(l){this._objects.pushArray(l);for(const u of l)u.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:l});null!=this._octree&&this._objectsAdded.pushArray(l)}removeMany(l){const u=[];this._objects.removeUnorderedMany(l,l.length,u);if(0!==u.length){for(const x of u)x.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:u});if(null!=this._octree){for(l=0;l<u.length;)this._objectsAdded.removeUnordered(u[l])?(u[l]=u[u.length-1],--u.length):++l;this._octree.remove(u)}}}sync(){this.updatePolicy!==e.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(l,
u){null==this._octree||this._objectsAdded.includes(l)||this._octree.update(l,u)}getSpatialQueryAccelerator(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new g(l=>l.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=
c.destroyMaybe(this._octree);this._objectsAdded.clear()}}a.WebGLLayer=n;a.isWebGLLayer=function(l){return null!=l&&l.type===d.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved transformationChanged shaderTransformationChanged visibilityChanged occlusionChanged highlightChanged geometryAdded geometryRemoved attributesChanged".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,h,c,k,m,d,f){function g(K,I,M){M[0]=K[0]+I;M[1]=K[1]+I;M[2]=K[2]+I}function e(K,I,M,S){if(1===I)K=M(K[0]),d.copy(K,S);
else{E[0]=Infinity;E[1]=Infinity;E[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(let T=0;T<I;T++){var N=M(K[T]);if(x(N[3])){var V=E,Q=N;V[0]=Math.min(V[0],Q[0]-Q[3]);V[1]=Math.min(V[1],Q[1]-Q[3]);V[2]=Math.min(V[2],Q[2]-Q[3]);V=A;V[0]=Math.max(V[0],N[0]+N[3]);V[1]=Math.max(V[1],N[1]+N[3]);V[2]=Math.max(V[2],N[2]+N[3])}}h.lerp(d.getCenter(S),E,A,.5);S[3]=Math.max(A[0]-E[0],A[1]-E[1],A[2]-E[2])/2}}function n(K,I,M){if(!z.length)for(var S=0;8>S;++S)z.push({index:0,distance:0});for(S=0;8>
S;++S){const N=v[S];z.data[S].index=S;z.data[S].distance=u(K,I,N)}z.sort((N,V)=>N.distance-V.distance);for(K=0;8>K;++K)M[K]=z.data[K].index}function l(K,I){let M=Infinity,S;for(let N=0;8>N;++N){const V=u(K,I,p[N]);V<M&&(M=V,S=p[N])}return S}function u(K,I,M){return I*(K[0]*M[0]+K[1]*M[1]+K[2]*M[2])}function x(K){return!isNaN(K)&&-Infinity!==K&&Infinity!==K&&0<K}class w{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(K,
I){this.objectToBoundingSphere=K;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new q;this._objectCount=0;I&&(void 0!==I.maximumObjectsPerNode&&(this._maximumObjectsPerNode=I.maximumObjectsPerNode),void 0!==I.maximumDepth&&(this._maximumDepth=I.maximumDepth))}destroy(){this._degenerateObjects.clear();q.clearPool();r[0]=null;B.prune();z.prune()}add(K,I=K.length){this._objectCount+=I;this._grow(K,I);const M=q.acquire();for(let S=0;S<I;S++){const N=K[S];
this._isDegenerate(N)?this._degenerateObjects.add(N):(M.init(this._root),this._add(N,M))}q.release(M)}remove(K,I=null){this._objectCount-=K.length;const M=q.acquire();for(const S of K)K=I??d.copy(this.objectToBoundingSphere(S),F),x(K[3])?(M.init(this._root),this._remove(S,K,M)):this._degenerateObjects.delete(S);q.release(M);this._shrink()}update(K,I){if(x(I[3])||!this._isDegenerate(K))r[0]=K,K=r,this.remove(K,I),this.add(K)}forEachAlongRay(K,I,M){const S=m.wrap(K,I);this._forEachNode(this._root,N=>
{if(!this._intersectsNode(S,N))return!1;N=N.node;N.terminals.forAll(V=>{this._intersectsObject(S,V)&&M(V)});null!==N.residents&&N.residents.forAll(V=>{this._intersectsObject(S,V)&&M(V)});return!0})}forEachAlongRayWithVerticalOffset(K,I,M,S){const N=m.wrap(K,I);this._forEachNode(this._root,V=>{if(!this._intersectsNodeWithOffset(N,V,S))return!1;V=V.node;V.terminals.forAll(Q=>{this._intersectsObjectWithOffset(N,Q,S)&&M(Q)});null!==V.residents&&V.residents.forAll(Q=>{this._intersectsObjectWithOffset(N,
Q,S)&&M(Q)});return!0})}forEach(K){this._forEachNode(this._root,I=>{I=I.node;I.terminals.forAll(K);null!==I.residents&&I.residents.forAll(K);return!0});this._degenerateObjects.forEach(K)}forEachDegenerateObject(K){this._degenerateObjects.forEach(K)}findClosest(K,I,M,S=()=>!0,N=Infinity){let V=Infinity,Q=Infinity,T=null;const ia=l(K,I),O=U=>{--N;if(S(U)){var P=this.objectToBoundingSphere(U);if(k.intersectsSphere(M,P)){var R=u(K,I,d.getCenter(P)),ba=R-P[3];P=R+P[3];ba<V&&(V=ba,Q=P,T=U)}}};this._forEachNodeDepthOrdered(this._root,
U=>{if(0>=N||!k.intersectsSphere(M,U.bounds))return!1;h.scale(D,ia,U.halfSize);h.add(D,D,d.getCenter(U.bounds));if(u(K,I,D)>Q)return!1;U=U.node;U.terminals.forAll(P=>O(P));null!==U.residents&&U.residents.forAll(P=>O(P));return!0},K,I);return T}forEachInDepthRange(K,I,M,S,N,V,Q){let T=-Infinity,ia=Infinity;const O={setRange:X=>{M===w.DepthOrder.FRONT_TO_BACK?(T=Math.max(T,X.near),ia=Math.min(ia,X.far)):(T=Math.max(T,-X.far),ia=Math.min(ia,-X.near))}};O.setRange(S);const U=u(I,M,K),P=l(I,M),R=l(I,-M),
ba=X=>{if(Q(X)){var da=this.objectToBoundingSphere(X),ha=d.getCenter(da);ha=u(I,M,ha)-U;var fa=ha+da[3];ha-da[3]>ia||fa<T||!k.intersectsSphere(V,da)||N(X,O)}};this._forEachNodeDepthOrdered(this._root,X=>{if(!k.intersectsSphere(V,X.bounds))return!1;h.scale(D,P,X.halfSize);h.add(D,D,d.getCenter(X.bounds));if(u(I,M,D)-U>ia)return!1;h.scale(D,R,X.halfSize);h.add(D,D,d.getCenter(X.bounds));if(u(I,M,D)-U<T)return!1;X=X.node;X.terminals.forAll(da=>ba(da));null!==X.residents&&X.residents.forAll(da=>ba(da));
return!0},I,M)}forEachNode(K){this._forEachNode(this._root,I=>K(I.node,I.bounds,I.halfSize,I.depth))}forEachNeighbor(K,I){const M=d.getRadius(I),S=d.getCenter(I),N=T=>{const ia=this.objectToBoundingSphere(T);var O=d.getRadius(ia);O=M+O;return 0>=h.squaredDistance(d.getCenter(ia),S)-O*O?K(T):!0};let V=!0;const Q=T=>{V&&=N(T)};this._forEachNode(this._root,T=>{var ia=d.getRadius(T.bounds);ia=M+ia;if(0<h.squaredDistance(d.getCenter(T.bounds),S)-ia*ia)return!1;T=T.node;T.terminals.forAll(Q);V&&null!==
T.residents&&T.residents.forAll(Q);return V});V&&this.forEachDegenerateObject(Q)}_intersectsNode(K,I){g(d.getCenter(I.bounds),2*-I.halfSize,E);g(d.getCenter(I.bounds),2*I.halfSize,A);return f.rayBoxTest(K.origin,K.direction,E,A)}_intersectsNodeWithOffset(K,I,M){g(d.getCenter(I.bounds),2*-I.halfSize,E);g(d.getCenter(I.bounds),2*I.halfSize,A);M.applyToMinMax(E,A);return f.rayBoxTest(K.origin,K.direction,E,A)}_intersectsObject(K,I){I=this.objectToBoundingSphere(I);return 0<I[3]?d.intersectsRay(I,K):
!0}_intersectsObjectWithOffset(K,I,M){I=this.objectToBoundingSphere(I);return 0<I[3]?d.intersectsRay(M.applyToBoundingSphere(I),K):!0}_forEachNode(K,I){K=q.acquire().init(K);const M=[K];for(;0!==M.length;){K=M.pop();if(I(K)&&!K.isLeaf())for(let S=0;S<K.node.children.length;S++)K.node.children[S]&&M.push(q.acquire().init(K).advance(S));q.release(K)}}_forEachNodeDepthOrdered(K,I,M,S=w.DepthOrder.FRONT_TO_BACK){K=q.acquire().init(K);const N=[K];for(n(M,S,J);0!==N.length;){K=N.pop();if(I(K)&&!K.isLeaf())for(M=
7;0<=M;--M)S=J[M],K.node.children[S]&&N.push(q.acquire().init(K).advance(S));q.release(K)}}_remove(K,I,M){B.clear();I=M.advanceTo(I,(S,N)=>{B.push(S.node);B.push(N)})?M.node.terminals:M.node.residents;I.removeUnordered(K);if(0===I.length)for(K=B.length-2;0<=K&&this._purge(B.data[K],B.data[K+1]);K-=2);}_nodeIsEmpty(K){if(0!==K.terminals.length)return!1;if(null!==K.residents)return 0===K.residents.length;for(let I=0;I<K.children.length;I++)if(K.children[I])return!1;return!0}_purge(K,I){0<=I&&(K.children[I]=
null);return this._nodeIsEmpty(K)?(null===K.residents&&(K.residents=new b({shrink:!0})),!0):!1}_add(K,I){I.advanceTo(this.objectToBoundingSphere(K))?I.node.terminals.push(K):(I.node.residents.push(K),I.node.residents.length>this._maximumObjectsPerNode&&I.depth<this._maximumDepth&&this._split(I))}_split(K){const I=K.node.residents;K.node.residents=null;for(let M=0;M<I.length;M++){const S=q.acquire().init(K);this._add(I.at(M),S);q.release(S)}}_grow(K,I){0!==I&&(e(K,I,M=>this.objectToBoundingSphere(M),
G),x(G[3])&&!this._fitsInsideTree(G)&&(this._nodeIsEmpty(this._root.node)?(d.copy(G,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(K=this._rootBoundsForRootAsSubNode(G),this._placingRootViolatesMaxDepth(K)?this._rebuildTree(G,K):this._growRootAsSubNode(K),q.release(K))))}_rebuildTree(K,I){h.copy(d.getCenter(H),d.getCenter(I.bounds));H[3]=I.halfSize;e([K,H],2,M=>M,L);K=q.acquire().init(this._root);this._root.initFrom(null,L,L[3]);this._root.increaseHalfSize(1.25);
this._forEachNode(K,M=>{this.add(M.node.terminals.data,M.node.terminals.length);null!==M.node.residents&&this.add(M.node.residents.data,M.node.residents.length);return!0});q.release(K)}_placingRootViolatesMaxDepth(K){const I=Math.log(K.halfSize/this._root.halfSize)*Math.LOG2E;let M=0;this._forEachNode(this._root,S=>{M=Math.max(M,S.depth);return M+I<=this._maximumDepth});return M+I>this._maximumDepth}_rootBoundsForRootAsSubNode(K){var I=K[3],M=-Infinity;const S=this._root.bounds,N=this._root.halfSize;
for(var V=0;3>V;V++){var Q=Math.max(0,Math.ceil((S[V]-N-(K[V]-I))/(2*N)));const T=Math.max(0,Math.ceil((K[V]+I-(S[V]+N))/(2*N)))+1;M=Math.max(M,2**Math.ceil(Math.log(Q+T)*Math.LOG2E));C[V].min=Q;C[V].max=T}for(K=0;3>K;K++)I=C[K].min,V=C[K].max,Q=(M-(I+V))/2,I+=Math.ceil(Q),V+=Math.floor(Q),y[K]=S[K]-N-I*N*2+(V+I)*N;M*=N;y[3]=M*t;return q.acquire().initFrom(null,y,M,0)}_growRootAsSubNode(K){const I=this._root.node;h.copy(d.getCenter(G),d.getCenter(this._root.bounds));G[3]=this._root.halfSize;this._root.init(K);
K.advanceTo(G,null,!0);K.node.children=I.children;K.node.residents=I.residents;K.node.terminals=I.terminals}_shrink(){for(;;){const K=this._findShrinkIndex();if(-1===K)break;this._root.advance(K);this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let K=null;const I=this._root.node.children;let M=0,S=0;for(;S<I.length&&null==K;)M=S++,K=I[M];for(;S<I.length;)if(I[S++])return-1;return M}_isDegenerate(K){K=this.objectToBoundingSphere(K)[3];return!x(K)}_fitsInsideTree(K){const I=
this._root.bounds,M=this._root.halfSize;return K[3]<=M&&K[0]>=I[0]-M&&K[0]<=I[0]+M&&K[1]>=I[1]-M&&K[1]<=I[1]+M&&K[2]>=I[2]-M&&K[2]<=I[2]+M}toJSON(){const {maximumDepth:K,maximumObjectsPerNode:I,_objectCount:M}=this,S=this._nodeToJSON(this._root.node);return{maximumDepth:K,maximumObjectsPerNode:I,objectCount:M,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:S}}}_nodeToJSON(K){const I=K.children.map(S=>S?this._nodeToJSON(S):null),M=K.residents?.map(S=>this.objectToBoundingSphere(S));
K=K.terminals?.map(S=>this.objectToBoundingSphere(S));return{children:I,residents:M,terminals:K}}static fromJSON(K){const I=new w(M=>M,{maximumDepth:K.maximumDepth,maximumObjectsPerNode:K.maximumObjectsPerNode});I._objectCount=K.objectCount;I._root.initFrom(K.root.node,K.root.bounds,K.root.halfSize,K.root.depth);return I}}class q{constructor(){this.bounds=d.create();this.halfSize=0;this.initFrom(null,null,0,0)}init(K){return this.initFrom(K.node,K.bounds,K.halfSize,K.depth)}initFrom(K,I,M,S=this.depth){this.node=
null!=K?K:q.createEmptyNode();I&&d.copy(I,this.bounds);this.halfSize=M;this.depth=S;return this}increaseHalfSize(K){this.halfSize*=K;this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*t}advance(K){let I=this.node.children[K];I||(I=q.createEmptyNode(),this.node.children[K]=I);this.node=I;this.halfSize/=2;this.depth++;K=v[K];this.bounds[0]+=K[0]*this.halfSize;this.bounds[1]+=K[1]*this.halfSize;this.bounds[2]+=K[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();
return this}advanceTo(K,I,M=!1){for(;;){if(this.isTerminalFor(K))return I&&I(this,-1),!0;if(this.isLeaf()){if(!M)return I&&I(this,-1),!1;this.node.residents=null}const S=this._childIndex(K);I&&I(this,S);this.advance(S)}}isLeaf(){return null!=this.node.residents}isTerminalFor(K){return K[3]>this.halfSize/2}_childIndex(K){const I=this.bounds;return(I[0]<K[0]?1:0)+(I[1]<K[1]?2:0)+(I[2]<K[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new b({shrink:!0}),
residents:new b({shrink:!0})}}static acquire(){return q._pool.acquire()}static release(K){q._pool.release(K)}static clearPool(){q._pool.prune()}}q._pool=new a(q);(function(K){K=K.DepthOrder||(K.DepthOrder={});K[K.FRONT_TO_BACK=1]="FRONT_TO_BACK";K[K.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(w||={});const v=[c.fromValues(-1,-1,-1),c.fromValues(1,-1,-1),c.fromValues(-1,1,-1),c.fromValues(1,1,-1),c.fromValues(-1,-1,1),c.fromValues(1,-1,1),c.fromValues(-1,1,1),c.fromValues(1,1,1)],p=[c.fromValues(-1,-1,-1),
c.fromValues(-1,-1,1),c.fromValues(-1,1,-1),c.fromValues(-1,1,1),c.fromValues(1,-1,-1),c.fromValues(1,-1,1),c.fromValues(1,1,-1),c.fromValues(1,1,1)],t=Math.sqrt(3),r=[null],y=d.create(),D=c.create(),E=c.create(),A=c.create(),B=new b,F=d.create(),G=d.create(),H=d.create(),L=d.create(),C=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z=new b,J=[0,0,0,0,0,0,0,0];return w})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||
(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A){function B(aa,Z,ea,ca,W){for(let Y=0;Y<W;Y++)ea[ca++]=aa[Z++];return ca}var F;(function(aa){aa[aa.LEFT_JOIN_START=-2]="LEFT_JOIN_START";aa[aa.LEFT_JOIN_END=-1]="LEFT_JOIN_END";aa[aa.LEFT_CAP_START=-4]="LEFT_CAP_START";aa[aa.LEFT_CAP_END=-5]="LEFT_CAP_END";aa[aa.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";aa[aa.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";aa[aa.RIGHT_CAP_START=4]="RIGHT_CAP_START";aa[aa.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(F||={});class G extends q.Material{constructor(aa){super(aa,
new L);this._configuration=new A.RibbonLineTechniqueConfiguration;this.produces=new Map([[v.RenderSlot.OPAQUE_MATERIAL,Z=>Z===x.ShaderOutput.Highlight||Z===x.ShaderOutput.ObjectAndLayerIdColor||(Z===x.ShaderOutput.Color||Z===x.ShaderOutput.Alpha)&&this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil],[v.RenderSlot.OPAQUE_NO_SSAO_DEPTH,Z=>Z===x.ShaderOutput.LinearDepth],[v.RenderSlot.OCCLUDER_MATERIAL,Z=>x.isColorAlphaHighlightOIDOrDepth(Z)&&this.parameters.renderOccluded===
q.RenderOccludedFlag.OccludeAndTransparentStencil],[v.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,Z=>x.isColorAlphaHighlightOIDOrDepth(Z)&&this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil],[v.RenderSlot.TRANSPARENT_MATERIAL,Z=>(Z===x.ShaderOutput.Color||Z===x.ShaderOutput.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==q.RenderOccludedFlag.OccludeAndTransparentStencil],[v.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Z=>(Z===x.ShaderOutput.Color||
Z===x.ShaderOutput.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==q.RenderOccludedFlag.OccludeAndTransparentStencil],[v.RenderSlot.DRAPED_MATERIAL,Z=>x.is2DGeometryOutput(Z)]]);this._vertexAttributeLocations=E.vertexAttributeLocations}getConfiguration(aa,Z){this._configuration.output=aa;this._configuration.draped=Z.slot===v.RenderSlot.DRAPED_MATERIAL;aa=null!=this.parameters.stipplePattern&&aa!==x.ShaderOutput.Highlight;this._configuration.stippleEnabled=aa;this._configuration.stippleOffColorEnabled=
aa&&null!=this.parameters.stippleOffColor;this._configuration.stipplePreferContinuous=aa&&this.parameters.stipplePreferContinuous;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;aa=this._configuration;if(null!=this.parameters.markerParameters){var ea=this.parameters.markerParameters;ea=ea.anchor===y.LineMarkerAnchor.Tip&&
ea.hideOnShortSegments&&"begin-end"===ea.placement&&ea.worldSpace}else ea=!1;aa.applyMarkerOffset=ea;this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=
0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=Z.transparencyPassType;this._configuration.multipassEnabled=Z.multipassEnabled;this._configuration.cullAboveGround=Z.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration}intersectDraped(aa,Z,ea,ca,W,Y){if(ea.options.selectionMode){Z=aa.attributes.get(t.VertexAttribute.POSITION).data;
ea=aa.attributes.get(t.VertexAttribute.SIZE);var ja=this.parameters.width;this.parameters.vvSize?(ea=aa.attributes.get(t.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ja*=c.clamp(this.parameters.vvSize.offset[0]+ea*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ea&&(ja*=ea.data[0]);ea=ca[0];ca=ca[1];aa=(ja/2+4)*aa.screenToWorldRatio;ja=Number.MAX_VALUE;var oa=0;for(let pa=0;pa<Z.length-5;pa+=3){var ra=Z[pa],ta=Z[pa+1],ya=ea-ra,Ca=ca-ta;ra=Z[pa+
3]-ra;ta=Z[pa+4]-ta;const wa=c.clamp((ra*ya+ta*Ca)/(ra*ra+ta*ta),0,1);ya=ra*wa-ya;Ca=ta*wa-Ca;Ca=ya*ya+Ca*Ca;Ca<ja&&(ja=Ca,oa=pa/3)}ja<aa*aa&&W(Y.dist,Y.normal,oa,!1)}}intersect(aa,Z,ea,ca,W,Y){if(ea.options.selectionMode&&aa.visible)if(p.isTranslationMatrix(Z)){var ja=aa.attributes;ca=ja.get(t.VertexAttribute.POSITION).data;aa=this.parameters.width;this.parameters.vvSize?(W=ja.get(t.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],aa*=c.clamp(this.parameters.vvSize.offset[0]+W*this.parameters.vvSize.factor[0],
this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ja.has(t.VertexAttribute.SIZE)&&(aa*=ja.get(t.VertexAttribute.SIZE).data[0]);var oa=ea.camera,ra=M;m.copy(ra,ea.point);W=aa*oa.pixelRatio/2+4*oa.pixelRatio;d.set(R[0],ra[0]-W,ra[1]+W,0);d.set(R[1],ra[0]+W,ra[1]+W,0);d.set(R[2],ra[0]+W,ra[1]-W,0);d.set(R[3],ra[0]-W,ra[1]-W,0);for(aa=0;4>aa;aa++)if(!oa.unprojectFromRenderScreen(R[aa],ba[aa]))return;l.fromPoints(oa.eye,ba[0],ba[1],X);l.fromPoints(oa.eye,ba[1],ba[2],da);l.fromPoints(oa.eye,
ba[2],ba[3],ha);l.fromPoints(oa.eye,ba[3],ba[0],fa);var ta=Number.MAX_VALUE;aa=0;ja=this.parameters.isClosed&&2<ja.get(t.VertexAttribute.POSITION).indices.length?ca.length-2:ca.length-5;for(let Ca=0;Ca<ja;Ca+=3){z[0]=ca[Ca]+Z[12];z[1]=ca[Ca+1]+Z[13];z[2]=ca[Ca+2]+Z[14];var ya=(Ca+3)%ca.length;J[0]=ca[ya]+Z[12];J[1]=ca[ya+1]+Z[13];J[2]=ca[ya+2]+Z[14];if(!(0>l.signedDistance(X,z)&&0>l.signedDistance(X,J)||0>l.signedDistance(da,z)&&0>l.signedDistance(da,J)||0>l.signedDistance(ha,z)&&0>l.signedDistance(ha,
J)||0>l.signedDistance(fa,z)&&0>l.signedDistance(fa,J))){oa.projectToRenderScreen(z,S);oa.projectToRenderScreen(J,N);if(0>S[2]&&0<N[2])d.subtract(K,z,J),ya=oa.frustum,ya=-l.signedDistance(ya[e.PlaneIndex.NEAR],z)/d.dot(K,l.getNormal(ya[e.PlaneIndex.NEAR])),d.scale(K,K,ya),d.add(z,z,K),oa.projectToRenderScreen(z,S);else if(0<S[2]&&0>N[2])d.subtract(K,J,z),ya=oa.frustum,ya=-l.signedDistance(ya[e.PlaneIndex.NEAR],J)/d.dot(K,l.getNormal(ya[e.PlaneIndex.NEAR])),d.scale(K,K,ya),d.add(J,J,K),oa.projectToRenderScreen(J,
N);else if(0>S[2]&&0>N[2])continue;S[2]=0;N[2]=0;ya=n.distance2(n.fromPoints(S,N,T),ra);ya<ta&&(ta=ya,d.copy(V,z),d.copy(Q,J),aa=Ca/3)}}Z=ea.rayBegin;ea=ea.rayEnd;ta<W*W&&(ca=Number.MAX_VALUE,n.closestLineSegmentPoint(n.fromPoints(V,Q,T),n.fromPoints(Z,ea,ia),I)&&(d.subtract(I,I,Z),ca=d.length(I),d.scale(I,I,1/ca),ca/=d.distance(Z,ea)),Y(ca,I,aa,!1))}else h.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}get _layout(){const aa=
u.newLayout().vec3f(t.VertexAttribute.POSITION).vec3f(t.VertexAttribute.PREVPOSITION).vec3f(t.VertexAttribute.NEXTPOSITION).f32(t.VertexAttribute.SUBDIVISIONFACTOR).vec2f(t.VertexAttribute.UV0);this.parameters.vvSize?aa.f32(t.VertexAttribute.SIZEFEATUREATTRIBUTE):aa.f32(t.VertexAttribute.SIZE);this.parameters.vvColor?aa.f32(t.VertexAttribute.COLORFEATUREATTRIBUTE):aa.vec4f(t.VertexAttribute.COLOR);this.parameters.vvOpacity&&aa.f32(t.VertexAttribute.OPACITYFEATUREATTRIBUTE);b("enable-feature:objectAndLayerId-rendering")&&
aa.vec4u8(t.VertexAttribute.OBJECTANDLAYERIDCOLOR);return aa}createBufferWriter(){return new C(this._layout,this.parameters)}createGLMaterial(aa){return new H(aa)}validateParameters(aa){"miter"!==aa.join&&(aa.miterLimit=0);null!=aa.markerParameters&&(aa.markerScale=aa.markerParameters.width/aa.width)}}class H extends w{constructor(){super(...arguments);this._stipplePattern=null}dispose(){super.dispose();this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null}_updateOccludeeState(aa){aa.hasOccludees!==
this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:aa.hasOccludees})}beginSlot(aa){this._output!==x.ShaderOutput.Color&&this._output!==x.ShaderOutput.Alpha||this._updateOccludeeState(aa);const Z=this._material.parameters.stipplePattern;this._stipplePattern!==Z&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(Z,this._stipplePattern)}),this._stipplePattern=Z);return this.ensureTechnique(E.RibbonLineTechnique,aa)}}class L extends r.VisualVariablePassParameters{constructor(){super(...arguments);
this.width=0;this.color=g.ONES;this.join="miter";this.cap=A.CapType.BUTT;this.miterLimit=5;this.writeDepth=!0;this.hasPolygonOffset=!1;this.stippleTexture=null;this.stipplePreferContinuous=!0;this.markerParameters=null;this.markerScale=1;this.isClosed=this.vvFastUpdate=this.hasSlicePlane=!1;this.innerWidth=this.falloff=0;this.wireframe=this.hasOccludees=!1}}class C{constructor(aa,Z){this.vertexBufferLayout=aa;this._parameters=Z;this.numJoinSubdivisions=0;aa=Z.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=
aa;break;case "round":this.numJoinSubdivisions=D.ribbonlineNumRoundJoinSubdivisions+aa}}_isClosed(aa){return this._parameters.isClosed?2<aa.attributes.get(t.VertexAttribute.POSITION).indices.length:!1}allocate(aa){return this.vertexBufferLayout.createBuffer(aa)}elementCount(aa){var Z=aa.attributes.get(t.VertexAttribute.POSITION).indices.length/2+1;aa=this._isClosed(aa);Z=(aa?2:4)+((aa?Z:Z-1)-(aa?0:1))*(2*this.numJoinSubdivisions+4);Z+=2;this._parameters.wireframe&&(Z=2+4*(Z-2));return Z}write(aa,
Z,ea,ca,W){Z=O;const Y=U,ja=P,oa=ea.attributes.get(t.VertexAttribute.POSITION);var ra=oa.indices;const ta=oa.data.length/3,ya=ea.attributes.get(t.VertexAttribute.DISTANCETOSTART)?.data;ra&&ra.length!==2*(ta-1)&&console.warn("RibbonLineMaterial does not support indices");const Ca=ea.attributes.get(t.VertexAttribute.SIZEFEATUREATTRIBUTE)?.data[0]??ea.attributes.get(t.VertexAttribute.SIZE)?.data[0]??1;let pa=[1,1,1,1],wa=0;const Ba=this.vertexBufferLayout.fields.has(t.VertexAttribute.COLORFEATUREATTRIBUTE);
Ba?wa=ea.attributes.get(t.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ea.attributes.has(t.VertexAttribute.COLOR)&&(pa=ea.attributes.get(t.VertexAttribute.COLOR).data);const la=b("enable-feature:objectAndLayerId-rendering")?ea.objectAndLayerIdColor:null,qa=this.vertexBufferLayout.fields.has(t.VertexAttribute.OPACITYFEATUREATTRIBUTE),ua=qa?ea.attributes.get(t.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]:0,va=new Float32Array(ca.buffer),Ga=b("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ca.buffer):
null;ra=this.vertexBufferLayout.stride/4;let La=W*ra;W=La;let Na=0;const Wa=ya?(bb,gb,db)=>Na=ya[db]:(bb,gb,db)=>Na+=d.distance(bb,gb),Ia=b("enable-feature:objectAndLayerId-rendering"),Oa=(bb,gb,db,ka,mb,sb,tb)=>{va[La++]=gb[0];va[La++]=gb[1];va[La++]=gb[2];va[La++]=bb[0];va[La++]=bb[1];va[La++]=bb[2];va[La++]=db[0];va[La++]=db[1];va[La++]=db[2];va[La++]=ka;va[La++]=tb;va[La++]=mb;va[La++]=Ca;Ba?va[La++]=wa:(bb=Math.min(4*sb,pa.length-4),va[La++]=pa[bb],va[La++]=pa[bb+1],va[La++]=pa[bb+2],va[La++]=
pa[bb+3]);qa&&(va[La++]=ua);Ia&&(null!=la&&(Ga[4*La]=la[0],Ga[4*La+1]=la[1],Ga[4*La+2]=la[2],Ga[4*La+3]=la[3]),La++)};La+=ra;d.set(Y,oa.data[0],oa.data[1],oa.data[2]);aa&&d.transformMat4(Y,Y,aa);if(ea=this._isClosed(ea)){var Ua=oa.data.length-3;d.set(Z,oa.data[Ua],oa.data[Ua+1],oa.data[Ua+2]);aa&&d.transformMat4(Z,Z,aa)}else d.set(ja,oa.data[3],oa.data[4],oa.data[5]),aa&&d.transformMat4(ja,ja,aa),Oa(Y,Y,ja,1,F.LEFT_CAP_START,0,0),Oa(Y,Y,ja,1,F.RIGHT_CAP_START,0,0),d.copy(Z,Y),d.copy(Y,ja);Ua=ea?0:
1;const Va=ea?ta:ta-1;for(let bb=Ua;bb<Va;bb++){var Ra=(bb+1)%ta*3;d.set(ja,oa.data[Ra],oa.data[Ra+1],oa.data[Ra+2]);aa&&d.transformMat4(ja,ja,aa);Wa(Z,Y,bb);Oa(Z,Y,ja,0,F.LEFT_JOIN_END,bb,Na);Oa(Z,Y,ja,0,F.RIGHT_JOIN_END,bb,Na);Ra=this.numJoinSubdivisions;for(let gb=0;gb<Ra;++gb){const db=(gb+1)/(Ra+1);Oa(Z,Y,ja,db,F.LEFT_JOIN_END,bb,Na);Oa(Z,Y,ja,db,F.RIGHT_JOIN_END,bb,Na)}Oa(Z,Y,ja,1,F.LEFT_JOIN_START,bb,Na);Oa(Z,Y,ja,1,F.RIGHT_JOIN_START,bb,Na);d.copy(Z,Y);d.copy(Y,ja)}ea?(d.set(ja,oa.data[3],
oa.data[4],oa.data[5]),aa&&d.transformMat4(ja,ja,aa),Na=Wa(Z,Y,Va),Oa(Z,Y,ja,0,F.LEFT_JOIN_END,Ua,Na),Oa(Z,Y,ja,0,F.RIGHT_JOIN_END,Ua,Na)):(Na=Wa(Z,Y,Va),Oa(Z,Y,Y,0,F.LEFT_CAP_END,Va,Na),Oa(Z,Y,Y,0,F.RIGHT_CAP_END,Va,Na));B(va,W+ra,va,W,ra);La=B(va,La-ra,va,La,ra);this._parameters.wireframe&&this._addWireframeVertices(ca,W,La,ra)}_addWireframeVertices(aa,Z,ea,ca){const W=new Float32Array(aa.buffer,ea*Float32Array.BYTES_PER_ELEMENT);aa=new Float32Array(aa.buffer,Z*Float32Array.BYTES_PER_ELEMENT,ea-
Z);Z=0;for(ea=0;ea<aa.length-1;ea+=2*ca)Z=B(aa,ea,W,Z,ca),Z=B(aa,ea+2*ca,W,Z,ca),Z=B(aa,ea+1*ca,W,Z,ca),Z=B(aa,ea+2*ca,W,Z,ca),Z=B(aa,ea+1*ca,W,Z,ca),Z=B(aa,ea+3*ca,W,Z,ca)}}const z=f.create(),J=f.create(),K=f.create(),I=f.create(),M=f.create(),S=k.createRenderScreenPointArray3(),N=k.createRenderScreenPointArray3(),V=f.create(),Q=f.create(),T=n.create(),ia=n.create(),O=f.create(),U=f.create(),P=f.create(),R=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),
k.createRenderScreenPointArray3()],ba=[f.create(),f.create(),f.create(),f.create()],X=l.create(),da=l.create(),ha=l.create(),fa=l.create();a.Parameters=L;a.RibbonLineMaterial=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m){a.LineMarkerSpace=void 0;(function(f){f[f.Draped=0]="Draped";f[f.Screen=1]="Screen";f[f.World=2]="World";f[f.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(f){f[f.Center=0]="Center";f[f.Tip=1]="Tip";f[f.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));class d extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;
this.writeDepth=this.hasSlicePlane=this.occluder=!1;this.space=a.LineMarkerSpace.Screen;this.hasCap=this.hideOnShortSegments=!1;this.anchor=a.LineMarkerAnchor.Center;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.vvOpacity=this.vvColor=this.vvSize=this.hasTip=!1}get draped(){return this.space===a.LineMarkerSpace.Draped}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],d.prototype,"output",void 0);b.__decorate([c.parameter({count:k.TransparencyPassType.COUNT})],d.prototype,
"transparencyPassType",void 0);b.__decorate([c.parameter()],d.prototype,"occluder",void 0);b.__decorate([c.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],d.prototype,"writeDepth",void 0);b.__decorate([c.parameter({count:a.LineMarkerSpace.COUNT})],d.prototype,"space",void 0);b.__decorate([c.parameter()],d.prototype,"hideOnShortSegments",void 0);b.__decorate([c.parameter()],d.prototype,"hasCap",void 0);b.__decorate([c.parameter({count:a.LineMarkerAnchor.COUNT})],d.prototype,
"anchor",void 0);b.__decorate([c.parameter()],d.prototype,"hasTip",void 0);b.__decorate([c.parameter()],d.prototype,"vvSize",void 0);b.__decorate([c.parameter()],d.prototype,"vvColor",void 0);b.__decorate([c.parameter()],d.prototype,"vvOpacity",void 0);b.__decorate([c.parameter()],d.prototype,"hasOccludees",void 0);b.__decorate([c.parameter()],d.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter({constValue:!1})],d.prototype,
"occlusionPass",void 0);b.__decorate([c.parameter({constValue:!0})],d.prototype,"hasVvInstancing",void 0);b.__decorate([c.parameter({constValue:!0})],d.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A){function B(G){const H=new r.ShaderBuilder,{attributes:L,varyings:C,constants:z,vertex:J,fragment:K}=H;H.include(n.PiUtils);H.include(m.RibbonVertexPosition,G);H.include(f.LineStipple,G);const I=G.applyMarkerOffset&&!G.draped;I&&(J.uniforms.add(new v.FloatPassUniform("markerScale",T=>T.markerScale)),H.include(g.MarkerSizing,{space:E.LineMarkerSpace.World,draped:!1}));G.output===h.ShaderOutput.LinearDepth&&H.include(d.OutputDepth,G);H.include(k.ObjectAndLayerIdColor,
G);x.addProjViewLocalOrigin(J,G);J.uniforms.add(new t.Matrix4PassUniform("inverseProjectionMatrix",(T,ia)=>ia.camera.inverseProjectionMatrix),new w.Float2PassUniform("nearFar",(T,ia)=>ia.camera.nearFar),new v.FloatPassUniform("miterLimit",T=>"miter"!==T.join?0:T.miterLimit),new q.Float4PassUniform("viewport",(T,ia)=>ia.camera.fullViewport));J.constants.add("LARGE_HALF_FLOAT","float",65500);L.add(D.VertexAttribute.POSITION,"vec3");L.add(D.VertexAttribute.PREVPOSITION,"vec3");L.add(D.VertexAttribute.NEXTPOSITION,
"vec3");L.add(D.VertexAttribute.SUBDIVISIONFACTOR,"float");L.add(D.VertexAttribute.UV0,"vec2");C.add("vColor","vec4");C.add("vpos","vec3");C.add("vLineDistance","float");C.add("vLineWidth","float");b.addLinearDepth(H);const M=G.multipassEnabled&&(G.output===h.ShaderOutput.Color||G.output===h.ShaderOutput.Alpha);M&&C.add("depth","float");const S=G.stippleEnabled;S&&C.add("vLineSizeInv","float");z.add("aaWidth","float",G.stippleEnabled?0:1);const N=G.capType===A.CapType.ROUND,V=G.stippleEnabled&&N,
Q=G.falloffEnabled||V;Q&&C.add("vLineDistanceNorm","float");N&&(C.add("vSegmentSDF","float"),C.add("vReverseSegmentSDF","float"));J.code.add(p.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);J.code.add(p.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);b.addCalculateLinearDepth(H);J.code.add(p.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${M?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);x.addPixelRatio(J);J.code.add(p.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${S?p.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `);I&&J.code.add(p.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);J.code.add(p.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(G.stippleEnabled||N)&&J.code.add(p.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${N?p.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);J.code.add(p.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);G.roundJoins?J.code.add(p.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${G.stippleEnabled?p.glsl`min(1.0, subdivisionFactor * ${p.glsl.float(1.5)})`:p.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):J.code.add(p.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);J.code.add(p.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${G.capType!==A.CapType.BUTT?p.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);J.code.add(p.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${Q?p.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);N&&J.code.add(p.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);G.stippleEnabled&&(G.draped?J.uniforms.add(new v.FloatPassUniform("worldToScreenRatio",(T,ia)=>1/ia.screenToPCSRatio)):J.code.add(p.glsl`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),J.code.add(p.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),G.draped?J.code.add(p.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):J.code.add(p.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),J.uniforms.add(new v.FloatPassUniform("stipplePatternPixelSize",T=>f.computePixelSize(T))),J.code.add(p.glsl`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`));J.code.add(p.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${G.wireframe&&!G.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);M&&H.include(e.multipassTerrainTest,G);H.include(c.SliceDraw,G);K.include(u.ColorConversion);K.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);
    ${M?"terrainDepthTest(depth);":""}
  `);G.wireframe?K.code.add(p.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(N&&K.code.add(p.glsl`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${p.glsl.float(l.symbolAlphaCutoff)}) {
          discard;
        }
      `),V?K.code.add(p.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${p.glsl.float(l.symbolAlphaCutoff)}, stippleCoverage);
      `):K.code.add(p.glsl`float stippleAlpha = getStippleAlpha();`),G.output!==h.ShaderOutput.ObjectAndLayerIdColor&&K.code.add(p.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),K.uniforms.add(new q.Float4PassUniform("intrinsicColor",T=>T.color)),K.code.add(p.glsl`vec4 color = intrinsicColor * vColor;`),G.innerColorEnabled&&(K.uniforms.add(new q.Float4PassUniform("innerColor",T=>T.innerColor??T.color),new v.FloatPassUniform("innerWidth",(T,ia)=>T.innerWidth*ia.camera.pixelRatio)),
K.code.add(p.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),K.code.add(p.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),G.falloffEnabled&&(K.uniforms.add(new v.FloatPassUniform("falloff",T=>T.falloff)),K.code.add(p.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),G.stippleEnabled||K.code.add(p.glsl`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`));K.code.add(p.glsl`
    ${G.output===h.ShaderOutput.ObjectAndLayerIdColor?p.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${p.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${G.output===h.ShaderOutput.Alpha?p.glsl`fragColor = vec4(finalColor.a);`:""}
    ${G.output===h.ShaderOutput.Color?p.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${G.output===h.ShaderOutput.Color&&G.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${G.output===h.ShaderOutput.Highlight?p.glsl`fragColor = vec4(1.0);`:""}
    ${G.output===h.ShaderOutput.LinearDepth?p.glsl`outputDepth(linearDepth);`:""}
    ${G.output===h.ShaderOutput.ObjectAndLayerIdColor?p.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return H}const F=Object.freeze(Object.defineProperty({__proto__:null,build:B,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"}));a.RibbonLine=F;a.build=B;a.ribbonlineNumRoundJoinSubdivisions=1})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d){a.RibbonVertexPosition=function(f,g){const e=f.vertex;e.uniforms.add(new c.FloatPassUniform("intrinsicWidth",n=>n.width));g.vvSize?(f.attributes.add(d.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),e.uniforms.add(new h.Float3PassUniform("vvSizeMinSize",n=>n.vvSize.minSize),new h.Float3PassUniform("vvSizeMaxSize",n=>n.vvSize.maxSize),new h.Float3PassUniform("vvSizeOffset",n=>n.vvSize.offset),new h.Float3PassUniform("vvSizeFactor",n=>n.vvSize.factor)),e.code.add(m.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(f.attributes.add(d.VertexAttribute.SIZE,"float"),e.code.add(m.glsl`float getSize(){
return intrinsicWidth * size;
}`));g.vvOpacity?(f.attributes.add(d.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),e.constants.add("vvOpacityNumber","int",8),e.uniforms.add(new k.FloatsPassUniform("vvOpacityValues",n=>n.vvOpacity.values,8),new k.FloatsPassUniform("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,8)),e.code.add(m.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.code.add(m.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);g.vvColor?(f.include(b.VisualVariables,g),f.attributes.add(d.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),e.code.add(m.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(f.attributes.add(d.VertexAttribute.COLOR,"vec4"),e.code.add(m.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,h,c,k,m,d,f,g){function e(u,x){const w=
!(x.draped&&x.stipplePreferContinuous),{vertex:q,fragment:v}=u;v.include(b.RgbaFloatEncoding);x.draped||(h.addCameraPosition(q,x),q.uniforms.add(new k.FloatPassUniform("worldToScreenPerDistanceRatio",(p,t)=>1/t.camera.perScreenPixelRatio)),q.code.add(m.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));u.varyings.add("vStippleDistance","float");u.varyings.add("vStippleDistanceLimits","vec2");u.varyings.add("vStipplePatternStretch","float");q.code.add(m.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${l};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);q.code.add(m.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);q.code.add(m.glsl`
    if (segmentLengthPseudoScreen >= ${w?"patternLength":"1e4"}) {
  `);h.addPixelRatio(q);q.code.add(m.glsl`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`);v.uniforms.add(new d.Texture2DPassUniform("stipplePatternTexture",p=>p.stippleTexture),new k.FloatPassUniform("stipplePatternSDFNormalizer",p=>(p=p.stipplePattern)?(Math.floor(.5*(f.computeLongestPattern(p)-1))+.5)/p.pixelRatio:1),new k.FloatPassUniform("stipplePatternPixelSizeInv",p=>1/n(p)));v.code.add(m.glsl`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`);x.stippleOffColorEnabled?(v.uniforms.add(new c.Float4PassUniform("stippleOffColor",p=>g.ensureColor4(p.stippleOffColor))),v.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):v.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function n(u){const x=u.stipplePattern;return x?f.computeTextureSize(u.stipplePattern)/x.pixelRatio:1}const l=m.glsl.float(.4);a.LineStipple=function(u,x){u.constants.add("stippleAlphaColorDiscard","float",.001);u.constants.add("stippleAlphaHighlightDiscard","float",.5);x.stippleEnabled?e(u,x):u.fragment.code.add(m.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,h,c,k,m){function d(e){return e.pattern.map(n=>Math.round(n*e.pixelRatio))}function f(e){if(null==e)return 1;e=d(e);
return Math.floor(e.reduce((n,l)=>n+l))}function g(e){return d(e).reduce((n,l)=>Math.max(n,l))}a.computeLongestPattern=g;a.computeTextureSize=f;a.createStippleTextureRepository=function(e,n){return new h.ProceduralTextureRepository(l=>{var u=d(l),x=1/l.pixelRatio,w=f(l);l=g(l);const q=(Math.floor(.5*(l-1))+.5)*x;l=[];let v=1;for(var p of u){for(let y=0;y<p;y++)l.push(v*(Math.min(y,p-1-y)+.5)*x/q*.5+.5);v=-v}u=Math.round(u[0]/2);u=[...l.slice(u),...l.slice(0,u)];x=new Uint8Array(4*w);p=0;for(const y of u)b.packFloatRGBA(y,
x,p),p+=4;const {encodedData:t,textureSize:r}={encodedData:x,textureSize:w};w=new m.TextureDescriptor;w.internalFormat=c.PixelFormat.RGBA;w.width=r;w.height=1;w.wrapMode=c.TextureWrapMode.REPEAT;return new k.Texture(e,w,t)},l=>`${l.pattern.join(",")}-r${l.pixelRatio}`,n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function h(d,f=0){let g=0;for(let e=0;4>e;e++)g+=d[f+e]*k[e];return g}const c=[1,256,
65536,16777216],k=[1/256,1/65536,1/16777216,1/4294967296],m=h(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(d,f,g=0){d=b.clamp(d,0,m);for(let l=0;4>l;l++){var e=Math,n=d*c[l];f[g+l]=e.floor.call(e,256*(n-Math.floor(n)))}};a.unpackFloatRGBA=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports","../../../../core/uid"],function(a,b){class h{constructor(k,m,d){this._createTexture=
k;this._parametersKey=m;this._repository=new Map;this._orphanCache=d.newCache(`procedural-texture-repository:${b.generateUID()}`,f=>f.dispose())}destroy(){for(const [,{texture:k}]of this._repository)k.dispose();this._repository.clear();this._orphanCache.destroy()}swap(k,m=null){k=this._acquire(k);this.release(m);return k}release(k){if(null!=k){k=this._parametersKey(k);var m=this._repository.get(k);m&&(m.refCount--,0===m.refCount&&(this._repository.delete(k),{texture:m}=m,this._orphanCache.put(k,m,
m.usedMemory)))}}_acquire(k){if(null==k)return null;const m=this._parametersKey(k);var d=this._repository.get(m);if(d)return d.refCount++,d.texture;k=this._orphanCache.pop(m)??this._createTexture(k);d=new c(k);this._repository.set(m,d);return k}}class c{constructor(k){this.texture=k;this.refCount=1}}a.ProceduralTextureRepository=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec42",
"../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,h){const c=h.create();a.ensureColor4=function(k){return null==k?h.ZEROS:4===k.length?k:b.set(c,k[0],k[1],k[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m){a.MarkerSizing=function(d,f){const {vertex:g,constants:e}=d;e.add("markerSizePerLineWidth","float",b.markerSizePerLineWidth);h.addPixelRatio(g);null==g.uniforms.get("markerScale")&&g.constants.add("markerScale","float",1);g.code.add(k.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);f.space===m.LineMarkerSpace.World&&(g.constants.add("maxSegmentLengthFraction","float",.45),g.uniforms.add(new c.FloatPassUniform("perRenderPixelRatio",(n,l)=>l.camera.perRenderPixelRatio)),g.code.add(k.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(a,b,h,c,k){a.createMarkerTexture=function(m,d){m=b.createPrimitive(m,64,32,6.4);const f=new k.TextureDescriptor;f.internalFormat=h.PixelFormat.RGBA;f.width=64;f.height=64;f.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new c.Texture(d,f,m)};a.markerSizePerLineWidth=
10;a.markerSymbolSize=32;a.markerTextureSize=64;a.markerThickness=6.4;a.markerTipThicknessFactor=.25;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,h,c,k){function m(t,r=128,y=.5*r,D=0){switch(t){case "circle":return d(r,y);case "square":return f(r,y);case "cross":return e(r,y,D);
case "x":return n(r,y,D);case "kite":return g(r,y);case "triangle":return l(r,y);case "arrow":return u(r,y);default:return d(r,y)}}function d(t,r){const y=t/2-.5;return p(t,q(y,y,r/2))}function f(t,r){return x(t,r,!1)}function g(t,r){return x(t,r,!0)}function e(t,r,y=0){return w(t,r,!1,y)}function n(t,r,y=0){return w(t,r,!0,y)}function l(t,r){return p(t,v(t/2,r,r/2))}function u(t,r){const y=r/2,D=t/2,E=.8*r,A=q(D,(t-r)/2-E,Math.sqrt(E*E+y*y)),B=v(D,r,y);return p(t,(F,G)=>Math.max(B(F,G),-A(F,G)))}
function x(t,r,y){y&&(r/=Math.SQRT2);return p(t,(D,E)=>{D=D-.5*t+.25;E=-E+.5*t-.75;if(y){const A=(D+E)/Math.SQRT2;E=(E-D)/Math.SQRT2;D=A}return Math.max(Math.abs(D),Math.abs(E))-.5*r})}function w(t,r,y,D=0){r-=D;y&&(r*=Math.SQRT2);const E=.5*r;return p(t,(A,B)=>{A-=.5*t;B=-B+.5*t-1;if(y){const F=(A+B)/Math.SQRT2;B=(B-A)/Math.SQRT2;A=F}A=Math.abs(A);B=Math.abs(B);A=A>B?A>E?Math.sqrt((A-E)*(A-E)+B*B):B:B>E?Math.sqrt(A*A+(B-E)*(B-E)):A;return A-=D/2})}function q(t,r,y){return(D,E)=>{D-=t;E-=r;return Math.sqrt(D*
D+E*E)-y}}function v(t,r,y){const D=Math.sqrt(r*r+y*y);return(E,A)=>{A=A-t+r/2+.75;return Math.max((r*(Math.abs(E-t)-y)+y*A)/D,-A)}}function p(t,r){const y=new Uint8Array(4*t*t);for(let D=0;D<t;D++)for(let E=0;E<t;E++){const A=E+t*D;let B=r(E,D);B=B/t+.5;h.packFloatRGBA(B,y,4*A)}return y}a.createArrow=u;a.createCircle=d;a.createCross=e;a.createKite=g;a.createPrimitive=m;a.createSquare=f;a.createTexture=function(t,r=128,y=.5*r,D=0){t=m(t,r,y,D);return new c.Texture(t,{mipmap:!1,wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,
t:k.TextureWrapMode.CLAMP_TO_EDGE},width:r,height:r,components:4,noUnpackFlip:!0,reloadable:!0})};a.createTriangle=l;a.createX=n;a.defaultSymbolSizeRatio=.5;a.defaultTexSize=128;a.requiresHalfTexelOffset=function(t){return"cross"===t||"x"===t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(B){return B instanceof HTMLVideoElement?{width:B.videoWidth,height:B.videoHeight}:B}class D extends u.ContentObject{get parameters(){return this._parameters}constructor(B,F){super();this._data=B;this.type=x.ContentObjectType.Texture;this._loadingController=this._loadingPromise=this._glTexture=null;this.events=new c;this._parameters={...A,...F};this._startPreload(B)}dispose(){this.unload();this._data=this.frameUpdate=void 0}_startPreload(B){null!=
B&&(B instanceof HTMLVideoElement?(this.frameUpdate=F=>this._frameUpdate(B,F),this._startPreloadVideoElement(B)):B instanceof HTMLImageElement&&this._startPreloadImageElement(B))}_startPreloadVideoElement(B){if(!(f.isBlobProtocol(B.src)||"auto"===B.preload&&B.crossOrigin)){B.preload="auto";B.crossOrigin="anonymous";const F=!B.paused;B.src=B.src;if(F&&B.autoplay){const G=()=>{B.removeEventListener("canplay",G);B.play()};B.addEventListener("canplay",G)}}}_startPreloadImageElement(B){f.isDataProtocol(B.src)||
f.isBlobProtocol(B.src)||B.crossOrigin||(B.crossOrigin="anonymous",B.src=B.src)}_createDescriptor(B){const F=new r.TextureDescriptor;F.wrapMode=this._parameters.wrap??p.TextureWrapMode.REPEAT;F.flipped=!this._parameters.noUnpackFlip;F.samplingMode=this._parameters.mipmap?p.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:p.TextureSamplingMode.LINEAR;F.hasMipmap=!!this._parameters.mipmap;F.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha;F.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?
B.parameters.maxMaxAnisotropy:1);return F}get glTexture(){return this._glTexture}get memoryEstimate(){var B;if(!(B=this._glTexture?.usedMemory)){B=this._data;var F=this._parameters;if(null==B)B=0;else if(d.isArrayBuffer(B)||d.isUint8Array(B))B=F.encoding===n.TextureEncodingMimeType.KTX2_ENCODING?l.estimateMemoryKTX2(B,!!F.mipmap):F.encoding===n.TextureEncodingMimeType.BASIS_ENCODING?l.estimateMemoryBasis(B,!!F.mipmap):B.byteLength;else{var {width:G,height:H}=B instanceof Image||B instanceof ImageData||
B instanceof HTMLCanvasElement||B instanceof HTMLVideoElement?y(B):F;B=(F.mipmap?4/3:1)*G*H*(F.components||4)||0}}return B}load(B){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const F=this._data;if(null==F)return this._glTexture=new t.Texture(B,this._createDescriptor(B),null);this._parameters.reloadable||(this._data=void 0);return"string"===typeof F?this._loadFromURL(B,F):F instanceof Image?this._loadFromImageElement(B,F):F instanceof HTMLVideoElement?
this._loadFromVideoElement(B,F):F instanceof ImageData||F instanceof HTMLCanvasElement?this._loadFromImage(B,F):(d.isArrayBuffer(F)||d.isUint8Array(F))&&this._parameters.encoding===n.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(B,F):(d.isArrayBuffer(F)||d.isUint8Array(F))&&this._parameters.encoding===n.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(B,F):(d.isArrayBuffer(F)||d.isUint8Array(F))&&this._parameters.encoding===n.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(B,
F):d.isUint8Array(F)?this._loadFromPixelData(B,F):d.isArrayBuffer(F)?this._loadFromPixelData(B,new Uint8Array(F)):null}_frameUpdate(B,F){if(null==this._glTexture||B.readyState<E.HAVE_CURRENT_DATA||F===B.currentTime)return F;this._glTexture.setData(B);this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this._parameters.updateCallback&&this._parameters.updateCallback();return B.currentTime}_loadFromDDSData(B,F){return this._glTexture=w.createDDSTexture(B,this._createDescriptor(B),
F)}_loadFromKTX2(B,F){return this._loadAsync(()=>l.createTextureKTX2(B,this._createDescriptor(B),F).then(G=>this._glTexture=G))}_loadFromBasis(B,F){return this._loadAsync(()=>l.createTextureBasis(B,this._createDescriptor(B),F).then(G=>this._glTexture=G))}_loadFromPixelData(B,F){v.assert(0<this._parameters.width&&0<this._parameters.height);const G=this._createDescriptor(B);G.pixelFormat=1===this._parameters.components?p.PixelFormat.LUMINANCE:3===this._parameters.components?p.PixelFormat.RGB:p.PixelFormat.RGBA;
G.width=this._parameters.width??0;G.height=this._parameters.height??0;return this._glTexture=new t.Texture(B,G,F)}_loadFromURL(B,F){return this._loadAsync(async G=>{const H=await g.requestImage(F,{signal:G});m.throwIfAborted(G);return this._loadFromImage(B,H)})}_loadFromImageElement(B,F){return F.complete?this._loadFromImage(B,F):this._loadAsync(async G=>{const H=await e.loadImageAsync(F,F.src,!1,G);m.throwIfAborted(G);return this._loadFromImage(B,H)})}_loadFromVideoElement(B,F){return F.readyState>=
E.HAVE_CURRENT_DATA?this._loadFromImage(B,F):this._loadFromVideoElementAsync(B,F)}_loadFromVideoElementAsync(B,F){return this._loadAsync(G=>new Promise((H,L)=>{const C=()=>{F.removeEventListener("loadeddata",z);F.removeEventListener("error",J);k.removeMaybe(K)},z=()=>{F.readyState>=E.HAVE_CURRENT_DATA&&(C(),H(this._loadFromImage(B,F)))},J=I=>{C();L(I||new h("Failed to load video"))};F.addEventListener("loadeddata",z);F.addEventListener("error",J);const K=m.onAbort(G,()=>J(m.createAbortError()))}))}_loadFromImage(B,
F){if(!(F instanceof HTMLVideoElement)){var {maxTextureSize:G}=B.parameters;F=this._parameters.downsampleUncompressed?q.downsampleImage(F,G):q.ensureImageMaxSize(F,G)}G=y(F);this._parameters.width=G.width;this._parameters.height=G.height;const H=this._createDescriptor(B);H.pixelFormat=3===this._parameters.components?p.PixelFormat.RGB:p.PixelFormat.RGBA;H.width=G.width;H.height=G.height;return this._glTexture=new t.Texture(B,H,F)}_loadAsync(B){const F=new AbortController;this._loadingController=F;
const G=B(F.signal);this._loadingPromise=G;B=()=>{this._loadingController===F&&(this._loadingController=null);this._loadingPromise===G&&(this._loadingPromise=null)};G.then(B,B);return G}unload(){this._glTexture=k.disposeMaybe(this._glTexture);if(null!=this._loadingController){const B=this._loadingController;this._loadingPromise=this._loadingController=null;B.abort()}this.events.emit("unloaded")}}var E;(function(B){B[B.HAVE_NOTHING=0]="HAVE_NOTHING";B[B.HAVE_METADATA=1]="HAVE_METADATA";B[B.HAVE_CURRENT_DATA=
2]="HAVE_CURRENT_DATA";B[B.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";B[B.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(E||={});const A={wrap:{s:p.TextureWrapMode.REPEAT,t:p.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};a.Texture=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,b){a.requestImage=async function(h,c){({data:h}=await b(h,{responseType:"image",
...c}));return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,h,c,k,m){async function d(){null==u&&(u=b.getBasisTranscoder(),l=await u);return u}function f(x,w,q,v,p){w=m.getBytesPerElementFormat(w?c.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:c.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);
return Math.ceil(q*v*w*(p&&1<x?(4**x-1)/(3*4**(x-1)):1))}function g(x){return 1<=x.getNumImages()&&!x.isUASTC()}function e(x){return 1<=x.getFaces()&&x.isETC1S()}function n(x,w,q,v,p,t,r,y){const {compressedTextureETC:D,compressedTextureS3TC:E}=x.capabilities,[A,B]=D?v?[h.TextureFormat.ETC2_RGBA,c.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[h.TextureFormat.ETC1_RGB,c.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:E?v?[h.TextureFormat.BC3_RGBA,c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:
[h.TextureFormat.BC1_RGB,c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[h.TextureFormat.RGBA32,c.PixelFormat.RGBA];q=w.hasMipmap?q:Math.min(1,q);v=[];for(let F=0;F<q;F++)v.push(new Uint8Array(r(F,A))),y(F,A,v[F]);w.internalFormat=B;w.hasMipmap=1<v.length;w.samplingMode=w.hasMipmap?c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:c.TextureSamplingMode.LINEAR;w.width=p;w.height=t;return new k.Texture(x,w,{type:"compressed",levels:v})}let l=null,u=null;a.createTextureBasis=async function(x,w,q){null==
l&&(l=await d());const v=new l.BasisFile(new Uint8Array(q));if(!g(v))return null;v.startTranscoding();x=n(x,w,v.getNumLevels(0),v.getHasAlpha(),v.getImageWidth(0,0),v.getImageHeight(0,0),(p,t)=>v.getImageTranscodedSizeInBytes(0,p,t),(p,t,r)=>v.transcodeImage(r,0,p,t,0,0));v.close();v.delete();return x};a.createTextureKTX2=async function(x,w,q){null==l&&(l=await d());const v=new l.KTX2File(new Uint8Array(q));if(!e(v))return null;v.startTranscoding();x=n(x,w,v.getLevels(),v.getHasAlpha(),v.getWidth(),
v.getHeight(),(p,t)=>v.getImageTranscodedSizeInBytes(p,0,0,t),(p,t,r)=>v.transcodeImage(r,p,0,0,t,0,-1,-1));v.close();v.delete();return x};a.estimateMemoryBasis=function(x,w){if(null==l)return x.byteLength;x=new l.BasisFile(new Uint8Array(x));w=g(x)?f(x.getNumLevels(0),x.getHasAlpha(),x.getImageWidth(0,0),x.getImageHeight(0,0),w):0;x.close();x.delete();return w};a.estimateMemoryKTX2=function(x,w){if(null==l)return x.byteLength;x=new l.KTX2File(new Uint8Array(x));w=e(x)?f(x.getLevels(),x.getHasAlpha(),
x.getWidth(),x.getHeight(),w):0;x.close();x.delete();return w};a.loadBasis=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(a,b,h){let c;b.getBasisTranscoder=function(){if(null==c){const k=m=>h.getAssetUrl(`esri/libs/basisu/${m}`);c=(new Promise((m,d)=>a(["../../chunks/basis_transcoder"],m,d))).then(m=>m.basis_transcoder).then(({default:m})=>m({locateFile:k}).then(d=>{d.initializeBasis();delete d.then;
return d}))}return c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";
b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(a,b,h,c){function k(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<24)}function m(n,l){var u=new Int32Array(n,0,31);if(542327876!==u[0])return d().error("Invalid magic number in DDS header"),null;if(!(u[20]&4))return d().error("Unsupported format, must contain a FourCC code"),null;var x=u[21];let w;switch(x){case f:x=8;w=h.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case g:x=16;w=h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:x=16;w=h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return d().error("Unsupported FourCC code:",String.fromCharCode(x&255,x>>8&255,x>>16&255,x>>24&255)),null}let q=1,v=u[4],p=u[3];if(0!==(v&3)||0!==(p&3))d().warn("Rounding up compressed texture size to nearest multiple of 4."),v=v+3&-4,p=p+3&-4;const t=v,r=p;u[2]&131072&&!1!==l&&(q=Math.max(1,u[7]));let y=u[1]+4;const D=[];for(let E=0;E<
q;++E)u=(v+3>>2)*(p+3>>2)*x,l=new Uint8Array(n,y,u),D.push(l),y+=u,v=Math.max(1,v>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:D},internalFormat:w,width:t,height:r}}const d=()=>b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),f=k("DXT1"),g=k("DXT3"),e=k("DXT5");a.createDDSTexture=function(n,l,u){u=m(u,l.hasMipmap??!1);if(null==u)throw Error("DDS texture data is null");const {textureData:x,internalFormat:w,width:q,height:v}=u;l.samplingMode=1<x.levels.length?h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:
h.TextureSamplingMode.LINEAR;l.hasMipmap=1<x.levels.length;l.internalFormat=w;l.width=q;l.height=v;return new c.Texture(n,l,x)};a.createDDSTextureData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m){a.CapType=void 0;(function(f){f[f.BUTT=0]="BUTT";f[f.SQUARE=1]="SQUARE";f[f.ROUND=2]="ROUND";f[f.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));class d extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.capType=a.CapType.BUTT;this.transparencyPassType=k.TransparencyPassType.NONE;this.stippleOffColorEnabled=this.stippleEnabled=this.draped=this.writeDepth=this.hasPolygonOffset=this.hasSlicePlane=this.occluder=!1;this.stipplePreferContinuous=
!0;this.objectAndLayerIdColorInstanced=this.wireframe=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.innerColorEnabled=this.falloffEnabled=this.vvOpacity=this.vvColor=this.vvSize=this.applyMarkerOffset=this.roundJoins=!1}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],d.prototype,"output",void 0);b.__decorate([c.parameter({count:a.CapType.COUNT})],d.prototype,"capType",void 0);b.__decorate([c.parameter({count:k.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",
void 0);b.__decorate([c.parameter()],d.prototype,"occluder",void 0);b.__decorate([c.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],d.prototype,"hasPolygonOffset",void 0);b.__decorate([c.parameter()],d.prototype,"writeDepth",void 0);b.__decorate([c.parameter()],d.prototype,"draped",void 0);b.__decorate([c.parameter()],d.prototype,"stippleEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"stippleOffColorEnabled",void 0);b.__decorate([c.parameter()],d.prototype,
"stipplePreferContinuous",void 0);b.__decorate([c.parameter()],d.prototype,"roundJoins",void 0);b.__decorate([c.parameter()],d.prototype,"applyMarkerOffset",void 0);b.__decorate([c.parameter()],d.prototype,"vvSize",void 0);b.__decorate([c.parameter()],d.prototype,"vvColor",void 0);b.__decorate([c.parameter()],d.prototype,"vvOpacity",void 0);b.__decorate([c.parameter()],d.prototype,"falloffEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"innerColorEnabled",void 0);b.__decorate([c.parameter()],
d.prototype,"hasOccludees",void 0);b.__decorate([c.parameter()],d.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter()],d.prototype,"wireframe",void 0);b.__decorate([c.parameter()],d.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([c.parameter({constValue:!1})],d.prototype,"occlusionPass",void 0);b.__decorate([c.parameter({constValue:!0})],d.prototype,"hasVvInstancing",void 0);b.__decorate([c.parameter({constValue:!0})],
d.prototype,"hasSliceTranslatedView",void 0);a.RibbonLineTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){const x=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.PREVPOSITION,1],[e.VertexAttribute.NEXTPOSITION,2],[e.VertexAttribute.SUBDIVISIONFACTOR,3],[e.VertexAttribute.UV0,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);class w extends k.ShaderTechnique{initializeProgram(v){return new d.Program(v.rctx,
w.shader.get().build(this.configuration),x)}_makePipelineState(v,p){const t=this.configuration,r=v===g.TransparencyPassType.NONE,y=v===g.TransparencyPassType.FrontFace,D=h.isDepthLikeOutput(t.output);return u.makePipelineState({blending:t.output===h.ShaderOutput.Color||t.output===h.ShaderOutput.Alpha?r?m.blendingDefault:m.oitBlending(v):null,depthTest:{func:m.oitDepthTest(v)},depthWrite:r?t.writeDepth||D?u.defaultDepthWriteParams:null:m.oitDepthWrite(v),colorWrite:u.defaultColorWriteParams,stencilWrite:t.hasOccludees?
f.stencilWriteMaskOn:null,stencilTest:t.hasOccludees?p?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:r||y?t.hasPolygonOffset?q:null:m.OITPolygonOffset})}initializePipeline(){var v=this.configuration;v.occluder&&(v=v.hasPolygonOffset?q:null,this._occluderPipelineTransparent=u.makePipelineState({blending:m.blendingDefault,polygonOffset:v,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),
this._occluderPipelineOpaque=u.makePipelineState({blending:m.blendingDefault,polygonOffset:v,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=u.makePipelineState({blending:null,polygonOffset:v,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=
this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?l.PrimitiveType.LINES:l.PrimitiveType.TRIANGLE_STRIP}getPipeline(v,p,t){return v?this._occludeePipelineState:this.configuration.occluder?t?this._occluderPipelineTransparent:p?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}w.shader=new c.ReloadableShaderModule(n.RibbonLine,
()=>new Promise((v,p)=>a(["./RibbonLine.glsl"],v,p)));const q={factor:0,units:-4};b.RibbonLineTechnique=w;b.vertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,b,h,c,k,m){class d{constructor(e,n,l=null){this.rctx=e;this.sliceHelper=l;this.lastFrameCamera=new k.Camera;this.output=
h.ShaderOutput.Color;this.renderOccludedMask=g;this.bindParameters=new c.BindParameters(n,null!=l?l.plane:null);this.bindParameters.alignPixelEnabled=!0}}class f extends d{constructor(e,n,l,u){super(e,l,u);this.offscreenRenderingHelper=n;this.sliceHelper=u;this.time=b.Milliseconds(0)}}const g=m.RenderOccludedFlag.Occlude|m.RenderOccludedFlag.OccludeAndTransparent|m.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=d;a.RenderContext=f;a.defaultRenderOccludedMask=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../ViewingMode ../../webgl/ManagedFBO ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(fa,aa){f.set(X,fa[aa],fa[aa+3]);return X}a.SnapshotSlot=void 0;(function(fa){fa[fa.Highlight=0]="Highlight";fa[fa.ExcludeHighlight=1]="ExcludeHighlight"})(a.SnapshotSlot||(a.SnapshotSlot={}));class D{constructor(){this.camera=new q.CascadeCamera;this.lightMat=d.create()}}class E{constructor(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=
0}}class A{constructor(fa,aa){this._fbos=fa;this._viewingMode=aa;this._enabled=!1;this._snapshots=[];this._textureHeight=0;this._numCascades=1;this.settings=new E;this._projectionView=d.create();this._projectionViewInverse=d.create();this._modelViewLight=d.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=u.create();this._cascades=[new D,new D,new D,new D];this._lastOrigin=null;this._maxTextureWidth=Math.min(b("esri-mobile")?4096:16384,fa.rctx.parameters.maxTextureSize)}dispose(){this.enabled=
!1;this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return l.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}disposeOffscreenBuffers(){this._handle=c.releaseMaybe(this._handle);
this._discardSnapshots()}set maxCascades(fa){this.settings.maxNumCascadesHighQuality=h.clamp(Math.floor(fa),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(fa){(this._enabled=fa)||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let fa=0;fa<this._numCascades;++fa)I[fa]=this._cascades[fa];I.length=this._numCascades;return I}start(fa,aa,Z,ea,ca){p.assert(this.enabled);const {near:W,
far:Y}=this._clampNearFar(Z);this._computeCascadeDistances(W,Y,ea);this._textureHeight=this._computeTextureHeight(fa,ca,ea);this._setupMatrices(fa,aa);const {viewMatrix:ja,projectionMatrix:oa}=fa;for(fa=0;fa<this._numCascades;++fa)this._constructCascade(fa,oa,ja,aa);this._lastOrigin=null;this.clear()}finish(){p.assert(this.enabled);this._handle?.detachDepth()}getShadowMapMatrices(fa){if(!this._lastOrigin||!e.exactEquals(fa,this._lastOrigin)){this._lastOrigin=this._lastOrigin||n.create();e.copy(this._lastOrigin,
fa);for(let aa=0;aa<this._numCascades;++aa){m.translate(M,this._cascades[aa].lightMat,fa);for(let Z=0;16>Z;++Z)S[16*aa+Z]=M[Z]}}return S}moveSnapshot(fa){p.assert(this.enabled);this._handle?.detachDepth();this._snapshots[fa]?.release();this._snapshots[fa]=this._handle;this._handle=null;this.clear()}copySnapshot(fa){var aa=this._handle?.getTexture()?.descriptor;if(this.enabled&&aa){this._snapshots[fa]?.release();var {width:Z,height:ea}=aa;this._snapshots[fa]=this._fbos.acquire(Z,ea,fa===a.SnapshotSlot.Highlight?
"shadow highlight snapshot":"shadow no highlight snapshot",w.ColorFormat.RGBA4);aa=this._fbos.rctx;this._bindFbo();fa=aa.bindTexture(this._snapshots[fa]?.getTexture(),r.Texture.TEXTURE_UNIT_FOR_UPDATES);aa.gl.copyTexSubImage2D(t.TextureType.TEXTURE_2D,0,0,0,0,0,Z,ea);aa.bindTexture(fa,r.Texture.TEXTURE_UNIT_FOR_UPDATES)}}getSnapshot(fa){return this.enabled?this._snapshots[fa]?.getTexture():null}clear(){const fa=this._fbos.rctx;this._ensureFbo();this._bindFbo();fa.setClearColor(1,1,1,1);fa.clearSafe(t.ClearBufferBit.COLOR_BUFFER_BIT|
t.ClearBufferBit.DEPTH_BUFFER_BIT)}_computeTextureHeight(fa,aa,Z){fa=v.applyTextureResizeModulo(Math.floor(Math.min(window.devicePixelRatio,aa)/fa.pixelRatio*Math.max(fa.fullWidth,fa.fullHeight)*(Z?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality)));return v.applyTextureResizeFloorModulo(Math.min(this._maxTextureWidth,this._numCascades*fa)/this._numCascades)}_ensureFbo(){if(this._handle?.fbo.width!==this._textureWidth||this._handle?.fbo.height!==this._textureHeight)this._handle?.release(),
this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",w.ColorFormat.RGBA4);this._handle?.acquireDepth(w.DepthFormat.DEPTH16_BUFFER)}_discardSnapshot(fa){this._snapshots[fa]=c.releaseMaybe(this._snapshots[fa])}_discardSnapshots(){for(let fa=0;fa<this._snapshots.length;++fa)this._discardSnapshot(fa);this._snapshots.length=0}_bindFbo(){const fa=this._fbos.rctx;fa.unbindTexture(this.depthTexture);fa.bindFramebuffer(this._handle?.fbo)}_constructCascade(fa,aa,Z,ea){const ca=
this._cascades[fa];var W=-this._cascadeDistances[fa],Y=-this._cascadeDistances[fa+1];W=(aa[10]*W+aa[14])/Math.abs(aa[11]*W+aa[15]);aa=(aa[10]*Y+aa[14])/Math.abs(aa[11]*Y+aa[15]);p.assert(W<aa);for(Y=0;8>Y;++Y){l.set(F,0===Y%4||3===Y%4?-1:1,0===Y%4||1===Y%4?-1:1,4>Y?W:aa,1);var ja=G[Y];l.transformMat4(ja,F,this._projectionViewInverse);ja[0]/=ja[3];ja[1]/=ja[3];ja[2]/=ja[3]}e.negate(K,G[0]);ca.camera.viewMatrix=m.translate(B,this._modelViewLight,K);for(W=0;8>W;++W)e.transformMat4(G[W],G[W],ca.camera.viewMatrix);
W=G[0][2];aa=G[0][2];for(Y=1;8>Y;++Y)W=Math.min(W,G[Y][2]),aa=Math.max(aa,G[Y][2]);W-=200;aa+=200;ca.camera.near=-aa;ca.camera.far=-W;Y=ca.camera;ja=1/G[0][3];var oa=1/G[4][3];p.assert(ja<oa);ja+=Math.sqrt(ja*oa);var ra=Math.sin(h.acosClamped(Z[2]*ea[0]+Z[6]*ea[1]+Z[10]*ea[2]));Z=G;var ta=ja/ra;ea=H;var ya=L,Ca=C;oa=z;ja=J;f.set(N,0,0);for(var pa=0;4>pa;++pa)f.add(N,N,Z[pa]);f.scale(N,N,.25);f.set(V,0,0);for(pa=4;8>pa;++pa)f.add(V,V,Z[pa]);f.scale(V,V,.25);f.lerp(Q[0],Z[4],Z[5],.5);f.lerp(Q[1],Z[5],
Z[6],.5);f.lerp(Q[2],Z[6],Z[7],.5);f.lerp(Q[3],Z[7],Z[4],.5);pa=0;var wa=f.squaredDistance(Q[0],N);for(var Ba=1;4>Ba;++Ba){var la=f.squaredDistance(Q[Ba],N);la<wa&&(wa=la,pa=Ba)}f.subtract(T,Q[pa],Z[pa+4]);pa=T[0];T[0]=-T[1];T[1]=pa;f.subtract(ia,V,N);0>f.dot(ia,T)&&f.negate(T,T);f.lerp(T,T,ia,ra);f.normalize(T,T);ra=pa=f.dot(f.subtract(O,Z[0],N),T);for(wa=1;8>wa;++wa)Ba=f.dot(f.subtract(O,Z[wa],N),T),Ba<ra?ra=Ba:Ba>pa&&(pa=Ba);f.copy(ea,N);f.scale(O,T,ra-ta);f.add(ea,ea,O);Ba=-1;la=1;ta=wa=0;for(let qa=
0;8>qa;++qa){f.subtract(U,Z[qa],ea);f.normalize(U,U);const ua=T[0]*U[1]-T[1]*U[0];0<ua?ua>Ba&&(Ba=ua,wa=qa):ua<la&&(la=ua,ta=qa)}p.verify(0<Ba,"leftArea");p.verify(0>la,"rightArea");f.scale(P,T,ra);f.add(P,P,N);f.scale(R,T,pa);f.add(R,R,N);ba[0]=-T[1];ba[1]=T[0];ya=p.rayRay2D(ea,Z[ta],R,f.add(O,R,ba),1,ya);Ca=p.rayRay2D(ea,Z[wa],R,O,1,Ca);oa=p.rayRay2D(ea,Z[wa],P,f.add(O,P,ba),1,oa);Z=p.rayRay2D(ea,Z[ta],P,O,1,ja);p.verify(ya,"rayRay");p.verify(Ca,"rayRay");p.verify(oa,"rayRay");p.verify(Z,"rayRay");
Ca=H;Z=L;ea=z;oa=J;ja=Y.projectionMatrix;f.subtract(da,ea,oa);f.scale(da,da,.5);ha[0]=da[0];ha[1]=da[1];ha[2]=0;ha[3]=da[1];ha[4]=-da[0];ha[5]=0;ha[6]=da[0]*da[0]+da[1]*da[1];ha[7]=da[0]*da[1]-da[1]*da[0];ha[8]=1;ha[6]=-f.dot(y(ha,0),Ca);ha[7]=-f.dot(y(ha,1),Ca);Ca=f.dot(y(ha,0),ea)+ha[6];ya=f.dot(y(ha,1),ea)+ha[7];ta=f.dot(y(ha,0),oa)+ha[6];oa=f.dot(y(ha,1),oa)+ha[7];Ca=-(Ca+ta)/(ya+oa);ha[0]+=ha[1]*Ca;ha[3]+=ha[4]*Ca;ha[6]+=ha[7]*Ca;Ca=1/(f.dot(y(ha,0),ea)+ha[6]);ya=1/(f.dot(y(ha,1),ea)+ha[7]);
ha[0]*=Ca;ha[3]*=Ca;ha[6]*=Ca;ha[1]*=ya;ha[4]*=ya;ha[7]*=ya;ha[2]=ha[1];ha[5]=ha[4];ha[8]=ha[7];ha[7]+=1;Ca=f.dot(y(ha,1),Z)+ha[7];ya=f.dot(y(ha,2),Z)+ha[8];ta=f.dot(y(ha,1),ea)+ha[7];oa=f.dot(y(ha,2),ea)+ha[8];Ca=-.5*(Ca/ya+ta/oa);ha[1]+=ha[2]*Ca;ha[4]+=ha[5]*Ca;ha[7]+=ha[8]*Ca;Ca=f.dot(y(ha,1),Z)+ha[7];ya=f.dot(y(ha,2),Z)+ha[8];ta=-ya/Ca;ha[1]*=ta;ha[4]*=ta;ha[7]*=ta;ja[0]=ha[0];ja[1]=ha[1];ja[2]=0;ja[3]=ha[2];ja[4]=ha[3];ja[5]=ha[4];ja[6]=0;ja[7]=ha[5];ja[8]=0;ja[9]=0;ja[10]=1;ja[11]=0;ja[12]=
ha[6];ja[13]=ha[7];ja[14]=0;ja[15]=ha[8];Y.projectionMatrix[10]=2/(W-aa);Y.projectionMatrix[14]=-(W+aa)/(W-aa);m.multiply(ca.lightMat,ca.camera.projectionMatrix,ca.camera.viewMatrix);W=this._textureHeight;ca.camera.viewport=[fa*W,0,W,W]}_setupMatrices(fa,aa){m.multiply(this._projectionView,fa.projectionMatrix,fa.viewMatrix);m.invert(this._projectionViewInverse,this._projectionView);fa=this._viewingMode===x.ViewingMode.Global?fa.eye:e.set(K,0,0,1);m.lookAt(this._modelViewLight,[0,0,0],[-aa[0],-aa[1],
-aa[2]],fa)}_clampNearFar(fa){let {near:aa,far:Z}=fa;2>aa&&(aa=2);2>Z&&(Z=2);aa>=Z&&(aa=2,Z=4);return{near:aa,far:Z}}_computeCascadeDistances(fa,aa,Z){Z=Z?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(p.logWithBase(aa/fa,4)),Z);Z=(aa-fa)/this._numCascades;aa=(aa/fa)**(1/this._numCascades);let ea=fa;for(let ca=0;ca<this._numCascades+1;++ca)this._cascadeDistances[ca]=h.lerp(ea,fa,this.settings.splitSchemeLambda),ea*=aa,fa+=Z}get test(){return{cascades:this._cascades,
textureHeight:this._textureHeight}}}const B=d.create(),F=u.create(),G=[];for(let fa=0;8>fa;++fa)G.push(u.create());const H=g.create(),L=g.create(),C=g.create(),z=g.create(),J=g.create(),K=n.create(),I=[],M=d.create(),S=d.IDENTITY.concat(d.IDENTITY,d.IDENTITY,d.IDENTITY,d.IDENTITY),N=g.create(),V=g.create(),Q=[g.create(),g.create(),g.create(),g.create()],T=g.create(),ia=g.create(),O=g.create(),U=g.create(),P=g.create(),R=g.create(),ba=g.create(),X=g.create(),da=g.create(),ha=k.create();a.ShadowMap=
A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ./Camera".split(" "),function(a,b,h,c,k,m,d,f,g){a.CascadeCamera=class extends g.Camera{constructor(){super(...arguments);
this._projectionMatrix=f.create()}get projectionMatrix(){return this._projectionMatrix}};b.__decorate([h.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);b.__decorate([h.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/sphere ../../terrain/Intersector ../core/shaderLibrary/ShaderOutput ./ChangeSet ./Intersector ./IntersectorInterfaces ./Material ./ModelDirtyTypes ./rendererUtils ./RenderSlot ../materials/renderers/MergedRenderer".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){function D(B,F,G,H,L,C,z){const J=new l.OverlayTarget(C,z,F);F=K=>{K.set(q.IntersectorType.OVERLAY,J,B.dist,B.normal,B.transformation,G,H)};(null==L.results.min.drapedLayerOrder||G>=L.results.min.drapedLayerOrder)&&(null==L.results.min.dist||L.results.ground.dist<=L.results.min.dist)&&F(L.results.min);L.options.store!==q.StoreResults.MIN&&(null==L.results.max.drapedLayerOrder||G<L.results.max.drapedLayerOrder)&&(null==L.results.max.dist||L.results.ground.dist>
L.results.max.dist)&&F(L.results.max);L.options.store===q.StoreResults.ALL&&(C=w.newIntersectorResult(L.ray),F(C),L.results.all.push(C))}a.SortedRenderGeometryRenderer=class extends h{constructor(B){super(B);this._pending=new E;this._changes=new x.ChangeSet;this._materialRenderers=new c;this._sortedMaterialRenderers=new c;this._geometries=new Map;this._hasWater=this._hasHighlights=!1}destroy(){this._changes.prune();this._materialRenderers.forAll(B=>B.destroy());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();
this._geometries.clear();this._pending.clear()}get updating(){return!this._pending.empty||0<this._changes.updates.length}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some(B=>0!==B.numGeometries&&!B.queryRenderOccludedState(v.RenderOccludedFlag.Occlude))}get isEmpty(){return!this.updating&&
0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(B){return null==B?0:this._materialRenderers.find(F=>F.materialReference===B)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();let B=!1;t.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((F,G)=>{var H=this._materialRenderers.find(L=>L.materialReference===G);!H&&0<F.adds.length&&(H=new y.MergedRenderer({material:G}),H.initializeRenderContext(this.rendererContext.pluginContext,
this._materialRepository),this._materialRenderers.push(H),B=!0);H&&(H.modify(F),0===H.numGeometries&&(this._materialRenderers.removeUnordered(H),H.destroy(),B=!0))});this._changes.clear();B&&this._updateSortedMaterialRenderers();this._hasHighlights=this._materialRenderers.some(F=>(F=F.produces.get(r.RenderSlot.DRAPED_MATERIAL))?F(u.ShaderOutput.Highlight):!1);this._hasWater=this._materialRenderers.some(F=>(F=F.produces.get(r.RenderSlot.DRAPED_WATER))?F(u.ShaderOutput.Normal):!1);this.notifyChange("updating");
return!0}addGeometries(B,F){if(0!==B.length){var G=this._validateRenderGeometries(B);for(var H of G)this._geometries.set(H.id,H);H=this._pending.empty;for(const L of G)this._pending.adds.add(L);H&&this.notifyChange("updating");F===p.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(B)}}removeGeometries(B,F){const G=this._pending.empty,H=this._pending.adds;for(const L of B)H.has(L)?(this._pending.removed.add(L),H.delete(L)):this._pending.removed.has(L)||this._pending.removes.add(L),this._geometries.delete(L.id);
G&&!this._pending.empty&&this.notifyChange("updating");F===p.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(B)}modifyGeometries(B,F){const G=0===this._changes.updates.length;for(const H of B){const L=this._changes.updates.pushNew();L.renderGeometry=this._validateRenderGeometry(H);L.updateType=F}G&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case p.DirtyState.TRANSFORMATION:case p.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(B);case p.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(B)}}updateAnimation(B){let F=
!1;this._sortedMaterialRenderers.forAll(G=>F=!!G.updateAnimation&&G.updateAnimation(B)||F);return F}shouldRender(B){return this._sortedMaterialRenderers.some(F=>F.prepareTechnique(B))}render(B){this._sortedMaterialRenderers.forAll(F=>{const G=F.prepareTechnique(B);null!=G&&F.renderNode(B,G)})}intersect(B,F,G,H,L){this._geometries.forEach(C=>{if(!H||H(C)){this._intersectRenderGeometry(C,G,F,0,B,L);var z=this.rendererContext.longitudeCyclical;z&&(C.boundingSphere[0]-C.boundingSphere[3]<z.min&&this._intersectRenderGeometry(C,
G,F,z.range,B,L),C.boundingSphere[0]+C.boundingSphere[3]>z.max&&this._intersectRenderGeometry(C,G,F,-z.range,B,L));L++}});return L}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();this._materialRenderers.forAll((B,F)=>{B.drapedPriority=F;this._sortedMaterialRenderers.push(B)});this._sortedMaterialRenderers.sort((B,F)=>F.materialReference?.renderPriority===B.materialReference?.renderPriority?B.drapedPriority-F.drapedPriority:(F.materialReference?.renderPriority||0)-(B.materialReference?.renderPriority||
0))}_processAddsRemoves(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let B=0;B<this._changes.updates.length;)this._pending.has(this._changes.updates.data[B].renderGeometry)?this._changes.updates.removeUnorderedIndex(B):B++;this._pending.clear()}_intersectRenderGeometry(B,F,G,H,L,C){if(B.visible){var z=0;H+=B.transformation[12];z=B.transformation[13];A[0]=
G[0]-H;A[1]=G[1]-z;B.screenToWorldRatio=this.rendererContext.screenToWorldRatio;B.material.intersectDraped(B,null,L,A,(J,K,I)=>{D(F,I,C,B.material.renderPriority,L,B.layerUid,B.graphicUid)},F)}}_notifyGraphicGeometryChanged(B){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const G of B)if(B=G.graphicUid,null!=B&&B!==F){this.drapeSource.notifyGraphicGeometryChanged(B);var F=B}}_notifyGraphicVisibilityChanged(B){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const G of B)if(B=
G.graphicUid,null!=B&&B!==F){this.drapeSource.notifyGraphicVisibilityChanged(B);var F=B}}_validateRenderGeometries(B){for(const F of B)this._validateRenderGeometry(F);return B}_validateRenderGeometry(B){null==B.localOrigin&&(B.localOrigin=this._localOriginFactory.getOrigin(n.getCenter(B.boundingSphere)));return B}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);b.__decorate([k.property()],
a.SortedRenderGeometryRenderer.prototype,"updating",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);b.__decorate([k.property({constructOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);b.__decorate([k.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,
"isEmpty",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRenderers",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);class E{constructor(){this.adds=new Set;this.removes=new Set;this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&
0===this.removed.size}has(B){return this.adds.has(B)||this.removes.has(B)||this.removed.has(B)}clear(){this.adds.clear();this.removes.clear();this.removed.clear()}}const A=e.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,h,c){class k extends h.Graphic3DTarget{constructor(m,
d,f){super(m,d);this.triangleNr=f}}a.OverlayTarget=k;a.isOverlayIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.OVERLAY&&!!m.target};a.isTerrainIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.TERRAIN&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){class h{constructor(){this.adds=
new b;this.removes=new b;this.updates=new b({allocator:m=>m||new c,deallocator:m=>{m.renderGeometry=null;return m}})}clear(){this.adds.clear();this.removes.clear();this.updates.clear()}prune(){this.adds.prune();this.removes.prune();this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class c{}class k{constructor(){this.adds=[];this.removes=[];this.updates=[]}}a.ChangeSet=h;a.MaterialChangeSet=k;a.RenderGeometryUpdate=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState=
{}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.RendererTarget=void 0;(function(h){h[h.Default=0]="Default";h[h.Screenshot=1]="Screenshot";h[h.ObjectAndLayerID=2]="ObjectAndLayerID"})(a.RendererTarget||(a.RendererTarget={}));a.splitRenderGeometryChangeSetByMaterial=function(h){const c=new Map,k=m=>{let d=c.get(m);d||(d=new b.MaterialChangeSet,c.set(m,d));return d};h.removes.forAll(m=>
{1<=m.geometry.indexCount&&k(m.material).removes.push(m)});h.adds.forAll(m=>{1<=m.geometry.indexCount&&k(m.material).adds.push(m)});h.updates.forAll(m=>{1<=m.renderGeometry.geometry.indexCount&&k(m.renderGeometry.material).updates.push(m)});return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../../lib/GLMaterials ../../lib/ModelDirtyTypes ../../lib/RenderSlot ../../lib/Util ../DrawParameters ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G){function H(N,V){let Q;if(!N.some(ia=>{if(ia.numElements<V)return!1;Q=ia;return!0}))return null;const T=Q.from;Q.from+=V;Q.from>=Q.to&&N.removeUnordered(Q);return T}function L(N){S.length<N&&(S=new Float32Array(N));return S}function C(N){N*=4;return 1024>=N?1024:262144>N?k.nextHighestPowerOfTwo(N):Math.max(Math.min(262144*Math.ceil(1.5*N/262144),16777216),N)}a.MergedRenderer=class extends v.SyncPrepareRenderPlugin{constructor(N){super(N);
this._bufferWriter=this._glMaterials=this._vaoCache=null;this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._produces=new Map;this.drapedPriority=0}destroy(){this._glMaterials=m.disposeMaybe(this._glMaterials);this._dataByOrigin.forEach(N=>N.dispose());this._dataByOrigin.clear();this._vaoCache=m.disposeMaybe(this._vaoCache)}initialize(){this.material.produces.forEach((N,V)=>{this._produces.set(V,Q=>0===this._dataByOrigin.size||Q===q.ShaderOutput.Highlight&&!this._hasHighlights?
!1:N(Q))})}get produces(){return this._produces}initializeRenderContext(N,V){const {rctx:Q}=N.renderContext;this._glMaterials=new p.GLMaterials(this.material,V??N.materialRepository);this._bufferWriter=this.material.createBufferWriter();this._vaoCache=new G.VaoCache(Q,this.material.vertexAttributeLocations,w.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(N){return this.material.queryRenderOccludedState(N)}get materialReference(){return this.material}get numGeometries(){let N=
0;this._dataByOrigin.forEach(V=>N+=V.buffers.reduce((Q,T)=>Q+=T.instances.size,0));return N}get usedMemory(){let N=0;this._dataByOrigin.forEach(V=>N+=V.buffers.reduce((Q,T)=>Q+T.vao.usedMemory,0));return N}forEachGeometry(N){this._dataByOrigin.forEach(V=>V.buffers.forEach(Q=>Q.instances.forEach(T=>N(T.geometry))))}modify(N){this._updateGeometries(N.updates);this._addAndRemoveGeometries(N.adds,N.removes);this._updateDrawCommands()}_updateGeometries(N){const V=this._bufferWriter;if(null!==V){var Q=
V.vertexBufferLayout.stride/4;for(const ia of N){N=ia.renderGeometry;const O=this._dataByOrigin.get(N.localOrigin.id)?.findBuffer(N.id);if(null==O)break;const U=O.instances.get(N.id);if(ia.updateType&(t.DirtyState.GEOMETRY|t.DirtyState.TRANSFORMATION)){var T=V.elementCount(U.geometry.geometry)*Q;T=L(T);const P=V.vertexBufferLayout.createView(T.buffer);this._writeGeometry(N,P,0);O.vao.vertexBuffers.geometry.setSubData(T,U.from*Q,0,U.numElements*Q)}ia.updateType&(t.DirtyState.HIGHLIGHT|t.DirtyState.OCCLUDEE|
t.DirtyState.VISIBILITY)&&(O.drawCommandsDirty=!0)}}}_computeDeltas(N,V){const Q=new d.NestedMap;for(var T of N){N=T.localOrigin;if(null==N)continue;let ia=Q.get(N.id,null);null==ia&&(ia=new z(N.vec3),Q.set(N.id,null,ia));ia.changes.push(T)}for(const ia of V)V=ia.localOrigin,null!=V&&(T=this._dataByOrigin.get(V.id)?.findBuffer(ia.id),null!=T&&(N=Q.get(V.id,T),null==N&&(N=new z(V.vec3),Q.set(V.id,T,N)),N.changes.push(ia)));return Q}_addAndRemoveGeometries(N,V){if(null!==this._bufferWriter&&null!==
this._vaoCache){var {_bufferWriter:Q,_dataByOrigin:T}=this,ia=Q.vertexBufferLayout.stride/4,O=this._computeDeltas(N,V);O.forEach((U,P)=>{const R=U.get(null),ba=null!=R?R.changes:[];O.delete(P,null);let X=T.get(P);U.forEach((da,ha)=>{O.delete(P,ha);if(null==ha)y.assert(!1,"No VAO for removed geometries");else if(ha.instances.size===da.changes.length)this._vaoCache.deleteVao(ha.vao),h.removeUnordered(X.buffers,ha),0===X.buffers.length&&0===ba.length&&T.delete(P);else{var fa=ha.numElements,aa=ha.vao.byteSize/
4,Z=ba.reduce((ca,W)=>ca+Q.elementCount(W.geometry),0),ea=da.changes.reduce((ca,W)=>ca+Q.elementCount(W.geometry),0);fa=Math.min((fa+Z-ea)*ia,4194304);Z=fa>aa;65536<fa&&fa<aa/2?(da.changes.forEach(({id:ca})=>ha.deleteInstance(ca)),ha.instances.forEach(({geometry:ca})=>ba.push(ca)),this._vaoCache.deleteVao(ha.vao),h.removeUnordered(X.buffers,ha)):Z?this._applyAndRebuild(ha,ba,da):this._applyRemoves(ha,da)}});if(0<ba.length)for(null==X&&(X=new F.PerOriginData(R.origin),T.set(P,X)),X.buffers.forEach(da=>
this._applyAdds(da,ba));0<ba.length;)X.buffers.push(this._applyAndRebuild(new B.PerBufferData,ba,null))})}}_updateDrawCommands(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(N=>{N.buffers.forEach(V=>{V.drawCommandsDirty&&(V.hasHiddenInstances=!1,V.hasHighlights=!1,V.hasOccludees=!1,c.someMap(V.instances,Q=>{V.updateDrawState(Q);return V.hasHiddenInstances&&V.hasHighlights&&V.hasOccludees}),V.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));this._hasHighlights=
this._hasHighlights||V.hasHighlights;this._hasOccludees=this._hasOccludees||V.hasOccludees})})}_applyAndRebuild(N,V,Q){if(null!=Q)for(var T of Q.changes)N.deleteInstance(T.id);const ia=this._bufferWriter;Q=ia.vertexBufferLayout.stride;T=Q/4;var O=Math.floor(4194304/T);let U=N.numElements;for(;0<V.length;){const X=V.pop();var P=ia.elementCount(X.geometry);if(U+P>O&&0<U){V.push(X);break}U+=P;P=new A.Instance(X,0,0);y.assert(null==N.instances.get(X.id));N.addInstance(X.id,P)}V=U*T;O=L(V);const R=ia.vertexBufferLayout.createView(O.buffer);
let ba=0;N.hasHiddenInstances=!1;N.hasHighlights=!1;N.hasOccludees=!1;N.instances.forEach((X,da)=>{this._writeGeometry(X.geometry,R,ba);const ha=ba;ba+=ia.elementCount(X.geometry.geometry);N.updateInstance(da,ha,ba);N.updateDrawState(X)});this._vaoCache.deleteVao(N.vao);N.vao=this._vaoCache.newVao(C(V));N.vao.vertexBuffers.geometry.setSubData(O,0,0,ba*T);N.holes.clear();V=N.holes.pushNew();V.from=ba;V.to=Math.floor(N.vao.byteSize/Q);N.updateDrawCommands(Q);return N}_applyRemoves(N,V){if(0!==V.changes.length&&
null!==this._bufferWriter){for(var Q of V.changes){var T=Q.id;if(V=N.instances.get(T)){N.deleteInstance(T);if(T=M.back()){if(T.to===V.from){T.to=V.to;continue}if(T.from===V.to){T.from=V.from;continue}}T=M.pushNew();T.from=V.from;T.to=V.to}}E.mergeAdjacentRanges(M);var ia=this._bufferWriter.vertexBufferLayout.stride/4;Q=M.reduce((P,R)=>Math.max(P,R.numElements),0)*ia;var O=L(Q);O.fill(0,0,Q);var U=N.vao.vertexBuffers.geometry;M.forAll(P=>U.setSubData(O,P.from*ia,0,P.numElements*ia));N.holes.pushArray(M.data,
M.length);M.forAll((P,R)=>M.data[R]=null);M.clear();N.drawCommandsDirty=!0}}_applyAdds(N,V){if(0!==V.length&&null!==this._bufferWriter)if(B.hasVao(N)){var Q=this._bufferWriter,T=Q.vertexBufferLayout.stride/4,ia=N.numElements,O=V.reduce((aa,Z)=>aa+Q.elementCount(Z.geometry),0);ia=Math.min((ia+O)*T,4194304);O=4*ia;if(N.vao.byteSize<C(4128768)&&O>N.vao.byteSize)this._applyAndRebuild(N,V,null);else{E.mergeAdjacentRanges(N.holes);var U=[];for(var P of V)O=Q.elementCount(P.geometry),O=H(N.holes,O),U.push(O);
var R=N.vao.vertexBuffers.geometry,ba=0,X=0,da=0,ha=L(ia),fa=Q.vertexBufferLayout.createView(ha.buffer);V.forEach((aa,Z)=>{Z=U[Z];if(null!=Z){if(da!==Z){var ea=da-X;0<ea&&R.setSubData(ha,X*T,0,ea*T);X=Z;ba=0}ea=Q.elementCount(aa.geometry);this._writeGeometry(aa,fa,ba);ba+=ea;da=Z+ea;Z=new A.Instance(aa,Z,Z+ea);y.assert(null==N.instances.get(aa.id));N.addInstance(aa.id,Z);N.drawCommandsDirty=!0}});P=da-X;0<P&&R.setSubData(ha,X*T,0,P*T);h.filterInPlace(V,(aa,Z)=>null==U[Z])}}else this._applyAndRebuild(N,
V,null)}_writeGeometry(N,V,Q){if(null!==this._bufferWriter){var T=N.localOrigin.vec3;y.setMatrixTranslation3(J,-T[0],-T[1],-T[2]);T=u.multiply(K,J,N.transformation);u.invert(I,T);u.transpose(I,I);this._bufferWriter.write(T,I,N.geometry,V,Q)}}updateAnimation(N){return this.material.update(N)}prepareTechnique(N){if(!this.material.shouldRender(N))return null;const {output:V,bindParameters:Q}=N;var T=this.material.produces.get(Q.slot);if(!T||!T(V)||(T=V===q.ShaderOutput.Highlight||V===q.ShaderOutput.ShadowHighlight)&&
!this._hasHighlights)return null;const ia=V===q.ShaderOutput.ShadowExcludeHighlight,O=!(T||ia);for(const P of this._dataByOrigin.values())for(const R of P.buffers){if(T&&!R.hasHighlights)continue;var U=(T?R.drawCommandsHighlight:ia&&R.needsMultipleCommands()?R.drawCommandsShadowHighlightRest:R.drawCommandsDefault)||null;const ba=O&&R.drawCommandsOccludees||null;if(U?.length||ba?.length)if(U=this._glMaterials.load(N.rctx,Q.slot,V),U=null!=U?U.beginSlot(Q):null,null!=U)return U}return null}renderNode(N,
V){const {output:Q,bindParameters:T}=N,ia=Q===q.ShaderOutput.Highlight||Q===q.ShaderOutput.ShadowHighlight,O=Q===q.ShaderOutput.ShadowExcludeHighlight,U=!(ia||O),P=N.rctx,R=N.bindParameters.slot===r.RenderSlot.OCCLUDER_MATERIAL;N=N.bindParameters.slot===r.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;P.runAppleAmdDriverHelper();P.bindTechnique(V,T,this.material.parameters);for(const ba of this._dataByOrigin.values())for(const X of ba.buffers){if(ia&&!X.hasHighlights)continue;const da=(ia?X.drawCommandsHighlight:
O&&X.needsMultipleCommands()?X.drawCommandsShadowHighlightRest:X.drawCommandsDefault)||null,ha=U&&X.drawCommandsOccludees||null;if(da?.length||ha?.length)V.program.bindDraw(new D.DrawParameters(ba.origin),T,this.material.parameters),V.ensureAttributeLocations(X.vao),P.bindVAO(X.vao),da?.length&&(P.setPipelineState(V.getPipeline(!1,R,N)),da.forAll(fa=>P.drawArrays(V.primitiveType,fa.first,fa.count))),ha?.length&&(P.setPipelineState(V.getPipeline(!0,R,N)),ha.forAll(fa=>P.drawArrays(V.primitiveType,
fa.first,fa.count)))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};b.__decorate([g.property({constructOnly:!0})],a.MergedRenderer.prototype,"material",void 0);a.MergedRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],a.MergedRenderer);class z{constructor(N){this.origin=N;this.changes=[]}}const J=x.create(),K=x.create(),I=x.create(),M=new f({allocator:N=>N||new E.BufferRange,deallocator:null});
let S=new Float32Array(65536);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","./basicInterfaces"],function(a,b){class h{constructor(c,k){this._material=c;this._repository=k;this._map=new Map}dispose(){this._map.forEach((c,k)=>{null!=c&&this._repository.release(this._material,k)})}load(c,k,m){const d=this._material.produces.get(k);if(!d||!d(m))return null;this._map.has(m)||this._map.set(m,this._repository.acquire(this._material,
k,m));k=this._map.get(m);if(null!=k){if(k.ensureResources(c)===b.ResourceState.LOADED)return k;this._repository.requestRender()}return null}}a.GLMaterials=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,h){class c extends h.VertexNormalDrawParameters{constructor(k=b.create()){super();
this.slicePlaneLocalOrigin=this.origin=k}}a.DrawParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports"],function(a){class b{constructor(h=0,c=0){this.from=h;this.to=c}get numElements(){return this.to-this.from}}a.BufferRange=b;a.mergeAdjacentRanges=function(h){const c=new Map;h.forAll(m=>c.set(m.from,m));for(var k=!0;k;){k=!1;for(let m=0;m<h.length;++m){k=h.data[m];const d=c.get(k.to);if(!d)return;
k.to=d.to;c.delete(d.from);h.removeUnordered(d);k=!0}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","./BufferRange"],function(a,b){class h extends b.BufferRange{constructor(c,k,m){super(k,m);this.geometry=c}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}a.Instance=
h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports","../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(a,b,h,c){function k(){return new b({allocator:g=>g||new c.DrawCommand,deallocator:g=>g})}function m(g,e){const n=g.back();null==n?(g=g.pushNew(),g.first=e.from,g.count=e.numElements):n.first+n.count>=e.from?n.count=e.from-n.first+e.numElements:(g=g.pushNew(),g.first=
e.from,g.count=e.numElements)}class d{constructor(){this._numElements=0;this._instances=new Map;this.holes=new b({allocator:g=>g||new h.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=k();this.drawCommandsHighlight=k();this.drawCommandsOccludees=k();this.drawCommandsShadowHighlightRest=k()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(g,e){this.deleteInstance(g);
this._instances.set(g,e);this._numElements+=e.numElements}deleteInstance(g){const e=this._instances.get(g);e&&(this._numElements-=e.numElements,this._instances.delete(g))}updateInstance(g,e,n){if(g=this._instances.get(g))this._numElements-=g.numElements,g.from=e,g.to=n,this._numElements+=g.numElements}updateDrawState(g){g.isVisible?(g.hasHighlights&&(this.hasHighlights=!0),g.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(g){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();
this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){g=Array.from(this._instances.values()).sort((n,l)=>n.from===l.from?n.to-l.to:n.from-l.from);for(var e of g)e.isVisible&&(m(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),m(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}else{const n=this.drawCommandsDefault.pushNew();e=this.holes.front();
null!=this.vao&&1===this.holes.length&&e.to===Math.floor(this.vao.byteSize/g)?(n.first=0,n.count=e.from):(n.first=Infinity,n.count=0,this._instances.forEach(l=>{n.first=Math.min(n.first,l.from);n.count=Math.max(n.count,l.to)}),n.count-=n.first)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}class f extends d{}a.PerBufferData=d;a.PerVaoData=f;a.hasVao=function(g){return null!=g.vao};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],
function(a){class b{constructor(){this.count=this.first=0}}a.DrawCommand=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],function(a){class b{constructor(h){this.origin=h;this.buffers=[]}dispose(){this.buffers.forEach(h=>h.vao.dispose());this.buffers.length=0}findBuffer(h){return this.buffers.find(c=>c.instances.has(h))}}a.PerOriginData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define(["exports","../../../../../core/MemCachePool","../../lib/VertexArrayObject","../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,h,c,k){class m{constructor(d,f,g){this._rctx=d;this._locations=f;this._layout=g;this._cache=new b.MemCachePool(d.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(d){let f=this._cache.pop(d.toString());if(f)return f;f=new h.VertexArrayObject(this._rctx,this._locations,
{geometry:this._layout},{geometry:c.BufferObject.createVertex(this._rctx,k.Usage.STATIC_DRAW)});f.vertexBuffers.geometry.setSize(d);return f}deleteVao(d){null!=d&&this._cache.put(d.byteSize.toString(),d)}}a.VaoCache=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCachePool":function(){define(["exports","./MemCache"],function(a,b){class h{constructor(c,k){this._cache=c(k,(m,d,f)=>this._remove(m,d,f))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(c){return this._cache.getSize(c)}pop(c){const k=
this._cache.peek(c);if(k){var m=k.pop();if(0<k.length){if(m){const d=this._cache.getSize(c)-Math.round(m.usedMemory);this._cache.updateSize(c,k,d)}}else this._cache.pop(c);return m}}put(c,k,m=b.NoPriority){const d=this._cache.peek(c);d?(d.push(k),k=this._cache.getSize(c)+Math.round(k.usedMemory),this._cache.updateSize(c,d,k)):this._cache.put(c,[k],k.usedMemory,m)}_remove(c,k,m){switch(k){case b.RemoveMode.ALL:return c.forEach(d=>d.dispose()),0;case b.RemoveMode.SOME:if(c=c.shift())m-=Math.round(c.usedMemory),
c.dispose();return m}}}a.MemCachePool=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g){class e extends k.ShaderTechnique{initializeProgram(n){return new d.Program(n.rctx,
e.shader.get().build(),m.Default3D)}initializePipeline(){return this.configuration.hasAlpha?g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({colorWrite:g.defaultColorWriteParams})}}e.shader=new c.ReloadableShaderModule(h.TextureOnly,()=>new Promise((n,l)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],n,l)));b.TextureTechnique=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasAlpha=!1}}b.__decorate([h.parameter()],c.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/OverlayCompositing.glsl":function(){define("exports ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d,f){function g(){const l=
new d.ShaderBuilder;l.include(h.ScreenSpacePass);l.fragment.uniforms.add(new f.Texture2DPassUniform("tex",u=>u.texture));l.fragment.uniforms.add(new k.IntegerPassUniform("overlayIdx",u=>u.overlayIndex));l.fragment.uniforms.add(new c.FloatPassUniform("opacity",u=>u.opacity));l.fragment.code.add(m.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return l}class e extends m.NoParameters{constructor(){super(...arguments);this.overlayIndex=b.OverlayIndex.INNER;this.opacity=1}}const n=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:e,build:g},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=n;a.OverlayCompositingPassParameters=e;a.build=g})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends c.ShaderTechnique{initializeProgram(n){return new m.Program(n.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return g.makePipelineState({blending:g.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams})}}e.shader=new h.ReloadableShaderModule(d.OverlayCompositing,()=>new Promise((n,l)=>a(["./OverlayCompositing.glsl"],n,l)));b.OverlayCompositingTechnique=e;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/FloatArray"],function(a,b,h,c,k){function m(e,n,l,u,x,w=2){var q=1/(Math.abs(l)+Math.abs(u)+Math.abs(x));l*=q;u*=q;q=0>=x?(0<=u?1:-1)*(1-Math.abs(l)):u;n*=w;e[n]=f(0>=x?(0<=l?1:-1)*(1-Math.abs(u)):l);e[n+1]=f(q)}function d(e,n,l,u=2){u*=l;l=g(n[u]);n=g(n[u+1]);u=1-Math.abs(l)-
Math.abs(n);e[2]=u;0>u?(e[0]=(0<=l?1:-1)*(1-Math.abs(n)),e[1]=(0<=n?1:-1)*(1-Math.abs(l))):(e[0]=l,e[1]=n);h.normalize(e,e)}function f(e){return b.clamp(Math.round(32767*e),-32767,32767)}function g(e){return b.clamp(e/32767,-1,1)}a.compressAndTransformNormals=function(e,n){const l=e.length/3,u=new Int16Array(2*l);let x=0;const w=c.create();for(let q=0;q<l;++q)w[0]=e[x++],w[1]=e[x++],w[2]=e[x++],h.transformMat3(w,w,n),m(u,q,w[0],w[1],w[2]);return u};a.compressNormal=m;a.compressNormals=function(e){const n=
e.length/3,l=new Int16Array(2*n);let u=0;for(let x=0;x<n;++x)m(l,x,e[u++],e[u++],e[u++]);return l};a.decodeInt16=g;a.decompressNormal=d;a.decompressNormals=function(e,n=2){const l=e.length/n,u=k.newFloatArray(3*l),x=c.create();let w=0;for(let q=0;q<l;++q)d(x,e,q,n),u[w++]=x[0],u[w++]=x[1],u[w++]=x[2];return u};a.encodeInt16=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../Color ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/OverrideHelper ../../../../symbols/cim/utils ../../../../symbols/support/cimSymbolUtils ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/Symbol3DAnchorPosition2D ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O){function U(Z){return null==Z?!1:"cross"===Z||"x"===Z}const P=u.fromValues(0,0,1),R=N.defaultTexSize,ba=N.defaultSymbolSizeRatio,X=[ba/2,ba/2,1-ba/2,1-ba/2];class da extends z.Graphics3DSymbolLayer{getCachedSize(){return{size:this._getIconSize()}}constructor(Z,ea,ca,W){super(Z,ea,ca,W);this._cimSymbolMaterials=new Map;this._cimSymbolTextures=new Map;this._size=this._cimMaterialParametersInfo=null;this._symbolTextureRatio=
1;this._outlineSize=0;this._patchTask=null;this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(Z){this._validateOrThrow();const ea=this._prepareMaterialParameters();var ca=this._getPrimitive();if(null!=ca)this._prepareResourcesPrimitive(ea,ca);else{ca=A.getIconHref(this.symbolLayer);const W=n.dataComponents(ca);W&&"application/json"===W.mediaType?await this._prepareResourcesCIM(ea,JSON.parse(W.data),Z):await this._prepareResourcesHref(ea,ca,Z)}}_validateOrThrow(){if(!this._drivenProperties.size){var Z=
J.validateSymbolLayerSize(this._getIconSize());if(Z)throw new k("graphics3diconsymbollayer:invalid-size",Z);}}_getIconSize(){var Z=this.symbolLayer;Z=Math.round(null!=Z.size?g.pt2px(Z.size):16);return this._drivenProperties.size?Math.max(Z,64):Z}_generateTextureCIM(Z){var ea=this._cimData;ea&&ea.symbol||this.logger.error("Can't create texture, CIM data is undefined");if(ea.primitiveOverrides){ea=m.clone(ea);var ca=ea.primitiveOverrides;t.OverrideHelper.evaluateOverrides(ca,Z,this._arcadeInfo.geometryType,
null,null);t.OverrideHelper.applyOverrides(ea.symbol,ca)}ca=e.numericHash(JSON.stringify(ea));var W=this._cimSymbolTextures.get(ca);if(W)return W;W=this._context.sharedResources.cimSymbolRasterizer;const Y=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;Y&&t.OverrideHelper.applyDictionaryTextOverrides(ea.symbol,Z,Y);Z=null!=this._cimScaleFactorOrFunction?r.evaluateValueOrFunction(this._cimScaleFactorOrFunction,Z):1;1!==Z&&ea.symbol&&y.scaleCIMSymbol(ea.symbol,
Z,!0);(Z=p.CIMSymbolHelper.getEnvelope(ea,null,W.resourceManager))&&Z.width&&Z.height?(ea=W.rasterize({type:"cim",data:ea},Z.width,Z.height,Z.x+Z.width/2,Z.y+Z.height/2,1,"esriGeometryPoint"),Z=new E.Symbol3DAnchorPosition2D({x:-Z.x/Z.width-.5,y:(Z.height+Z.y)/Z.height-.5}),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",Z),W=new ia.Texture(ea,{width:ea?.width??1,height:ea?.height??1})):W=new ia.Texture(new ImageData(1,1),{width:1,height:1});this._cimSymbolTextures.set(ca,
W);this._context.stage.add(W);return W}_prepareMaterialParameters(){const Z={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ea=this.symbol;if(ea&&"point-3d"===ea.type&&ea.hasVisibleVerticalOffset()){const {screenLength:ca,minWorldLength:W,maxWorldLength:Y}=ea.verticalOffset;Z.verticalOffset={screenLength:g.pt2px(ca),minWorldLength:W||0,maxWorldLength:null!=Y?Y:Infinity}}this._context.screenSizePerspectiveEnabled&&(Z.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
Z.occlusionTest=!0;Z.hasSlicePlane=this._context.slicePlaneEnabled;return Z}_prepareResourcesPrimitive(Z,ea){var ca=this._getOutlineSize();if(U(ea)&&0===ca)throw Error("Nothing to render");this._outlineSize=ca;Z.color=this._getFillColor();Z.outlineColor=this._getOutlineColor();Z.outlineSize=this._outlineSize;null!=this._context.sharedResources.textures&&(this._textureHandle=ca=this._context.sharedResources.textures.fromData(`${ea}-icon`,()=>N.createTexture(ea)),Z.textureId=ca.texture.id);Z.textureIsSignedDistanceField=
!0;Z.sampleSignedDistanceFieldTexelCenter=N.requiresHalfTexelOffset(ea);Z.distanceFieldBoundingBox=X;ca=this._getIconSize();this._size=[ca,ca];this._symbolTextureRatio=1/ba;this._createMaterialAndAddToStage(Z,this._context.stage)}async _prepareResourcesHref(Z,ea,ca){this._outlineSize=this._getOutlineSize();Z.color=this._getFillColor();Z.outlineColor=this._getOutlineColor();Z.outlineSize=this._outlineSize;Z.textureIsSignedDistanceField=!1;const W=this._getIconSize(),Y=W*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;
if(null!=this._context.sharedResources.textures){ca=await c.result(this._context.sharedResources.textures.fromUrl(ea,Y,{signal:ca}));if(!1===ca.ok)throw f.throwIfAbortError(ca.error),new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ea})`);this._textureHandle=ca.value;ea=ca.value.texture;this._size=this._computeSizeFromTexture(ea,W);Z.textureId=ea.id}this._createMaterialAndAddToStage(Z,this._context.stage)}async _prepareResourcesCIM(Z,ea,ca){this._cimData=
ea;if(!this._context.sharedResources.cimSymbolRasterizer){var W=(await new Promise((oa,ra)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],oa,ra))).CIMSymbolRasterizer;f.throwIfAborted(ca);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new W(this._context.renderCoordsHelper.spatialReference))}var Y=this._context.sharedResources.cimSymbolRasterizer;W=[];const ja=ea?.symbol;p.CIMSymbolHelper.fetchResources(ja,Y.resourceManager,W,ca);p.CIMSymbolHelper.fetchFonts(ja,
Y.resourceManager,W);Y=this._context.layer.fields?this._context.layer.fields.map(oa=>oa.toJSON()):[];this._arcadeInfo={spatialReference:this._context.renderCoordsHelper.spatialReference,fields:Y,geometryType:"esriGeometryPoint"};ea?.primitiveOverrides&&W.push(t.OverrideHelper.createRenderExpressions(ea.primitiveOverrides,this._arcadeInfo));0<W.length&&(await Promise.all(W),f.throwIfAborted(ca));if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression&&
(ea=this._context.renderer,ea.scaleExpression)){const oa=await v.createRendererExpression(ea.scaleExpression,this._context.layer.spatialReference,Y);this._cimScaleFactorOrFunction=(ra,ta,ya)=>{ra=B(oa,ra,{$view:ya},"esriGeometryPoint",ta);return null!==ra?ra:1}}f.throwIfAborted(ca);this._cimMaterialParametersInfo=Z;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=
!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||D.defaultPrimitive}_getOutlineSize(){var Z=0;Z=this.symbolLayer;if(null!=Z.outline?.size)return Math.max(g.pt2px(Z.outline.size),0);Z=this._getPrimitive();Z=U(Z)?1.5:0;return Math.max(Z,0)}_getOutlineColor(){const Z=this._getLayerOpacity(),ea=this.symbolLayer?.outline?.color;if(null!=ea){const ca=h.toUnitRGB(ea);return[ca[0],ca[1],ca[2],ea.a*Z]}return[0,
0,0,0]}_getFillColor(){if(U(this._getPrimitive()))return F.transparentUnit;const Z=null==this._getPrimitive();return this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color,{hasIntrinsicColor:Z})}_getAnchorPos(Z,ea){return"relative"===Z?l.fromValues((ea.x||0)+.5,-(ea.y||0)+.5):Z in I.namedAnchorToHUDMaterialAnchorPos?I.namedAnchorToHUDMaterialAnchorPos[Z]:I.namedAnchorToHUDMaterialAnchorPos.center}_createMaterialAndAddToStage(Z,ea){if(this._cimData){this._fastUpdates=null;let ca=Z.textureId?
this._cimSymbolMaterials.get(Z.textureId):null;ca||(ca=new O.HUDMaterial(Z),this._cimSymbolMaterials.set(Z.textureId??0,ca),ea.add(ca));return ca}(this._fastUpdates=S.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&(Z={...Z,...this._fastUpdates.materialParameters});this._materials[0]=new O.HUDMaterial(Z);ea.add(this._materials[0]);return this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(Z=>{Z.setParameters({verticalOffset:null,
screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy();this._patchTask=d.abortMaybe(this._patchTask);this._forEachMaterial(Z=>this._context.stage.remove(Z));this._materials.length=0;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(Z=>this._context.stage.remove(Z));this._cimSymbolTextures.clear();this._textureHandle=d.releaseMaybe(this._textureHandle)}_getScaleFactor(Z,ea){if(this._drivenProperties.size&&
Z.size){for(let ca=0;3>ca;ca++){const W=Z.size[ca];W&&"symbol-value"!==W&&"proportional"!==W&&(Z.size[ca]=g.pt2px(W))}if("symbol-value"===Z.size[0])return 1;if(isFinite(+Z.size[0]))return+Z.size[0]/ea;if(isFinite(+Z.size[2]))return+Z.size[2]/ea}return 1}createGraphics3DGraphic(Z){const ea=Z.graphic;if(!this._validateGeometry(ea.geometry))return null;var ca=[0,0];let W;if(this._cimData){if(!this._cimData.symbol)return null;var Y=this._generateTextureCIM(ea);W=this._createMaterialAndAddToStage({textureId:Y.id,
...this._cimMaterialParametersInfo},this._context.stage);ca=[Y.parameters.width,Y.parameters.height]}else ca=this._size,W=this._materials[0];Y=M.placePointOnGeometry(ea.geometry);if(null==Y)return this.logger.warn(`unsupported geometry type for icon symbol: ${ea.geometry.type}`),null;var ja=Z.renderingInfo;const oa=this._getVertexOpacityAndColor(ja);let ra=1;this._fastUpdates?.visualVariables.size||(ra=this._getScaleFactor(ja,ca[0]>ca[1]?ca[0]:ca[1]));ra*=this._symbolTextureRatio;ca=l.fromValues(ca[0]*
ra,ca[1]*ra);ja=this.setGraphicElevationContext(ea);this.ensureDrapedStatus("on-the-ground"===ja.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ea,Y,W,oa,ca,Z.layer.uid):this._createAs3DShape(ea,Y,W,oa,ca,ja,ea.uid)}layerOpacityChanged(){const Z=this._getFillColor(),ea=this._getOutlineColor();this._forEachMaterial(ca=>{ca.setParameters({color:Z});ca.setParameters({outlineColor:ea})})}layerElevationInfoChanged(Z,ea,ca){const W=this._elevationContext.mode;
ca=H.elevationModeChangeUpdateType(da.elevationModeChangeTypes,ca,W);if(ca!==H.SymbolUpdateType.UPDATE)return ca;const Y=H.needsElevationUpdates2D(W)||"absolute-height"===W;return this.updateGraphics3DGraphicElevationInfo(Z,ea,()=>Y)}slicePlaneEnabledChanged(){this.draped||this._forEachMaterial(Z=>{Z.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(Z,ea){for(const ca in Z.diff)switch(ca){case "visualVariables":if(S.updateFastSymbolUpdatesState(this._fastUpdates,
ea,this._fastVisualVariableConvertOptions()))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);else return K.ApplyRendererDiffResult.RecreateSymbol;break;default:return K.ApplyRendererDiffResult.RecreateSymbol}return K.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(Z){this._patchTask?.abort();"partial"===Z.diff.type&&this._preparePatchResource(Z,Z.diff.diff)}_preparePatchResource(Z,ea){if(ea.resource&&"partial"===ea.resource.type&&(ea=ea.resource.diff,"complete"===
ea?.href?.type)){var ca=ea.href.newValue,{textures:W}=this._context.sharedResources;if(null!=ca&&null!=W){var Y=this._getIconSize(),ja=Y*this._context.graphicsCoreOwner.view.state.pixelRatio;Z.symbolLayerStatePatches.push(()=>{this._patchTask=d.abortMaybe(this._patchTask);this._patchTask=c.createTask(oa=>this._context.schedule(async(ra,ta)=>{ra=await c.result(W.fromUrl(ca,ja,{signal:ta}));f.throwIfAborted(ta);(ta=!ra.ok)&&f.throwIfAbortError(ra.error);this._textureHandle=d.releaseMaybe(this._textureHandle);
this._patchTask=null;if(ta)this._forEachMaterial(Ca=>{Ca.visible=!1;Ca.setParameters({textureId:null})}),this.logger.error(new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ca})`));else{this._textureHandle=ra.value;var ya=ra.value.texture;this._size=this._computeSizeFromTexture(ya,Y);this._forEachMaterial(Ca=>{Ca.setParameters({textureId:ya.id});Ca.visible=!0})}},oa))});delete ea.href}}}_defaultElevationInfoNoZ(){return ha}_createAs3DShape(Z,ea,
ca,W,Y,ja,oa){Z=this.getFastUpdateAttrValues(Z);const ra=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:oa,layerUid:this._context.layer.uid});W=Q.createPointGeometry(ca,P,null,W,Y,fa,null,Z,ra);oa=M.createStageObject(this._context,ea,W,ja,oa);if(null==oa)return null;const ta=new C.Graphics3DObject3DGraphicLayer(this,oa.object,[W],null,null,G.perObjectElevationAligner,ja);ta.alignedSampledElevation=oa.sampledElevation;ta.needsElevationUpdates=H.needsElevationUpdates2D(ja.mode)||
"absolute-height"===ja.mode;ta.getScreenSize=this._createScreenSizeGetter(Y,Z);ta.calculateRelativeScreenBounds=ya=>ca.calculateRelativeScreenBounds(ta.getScreenSize(),1,ya);M.extendPointGraphicElevationContext(ta,ea,this._context.elevationProvider);return ta}_createAsOverlay(Z,ea,ca,W,Y,ja){ca.renderPriority=this._renderPriority;const oa=u.create();w.projectPointToVector(ea,oa,this._context.overlaySR);oa[2]=V.drapedZ;ea=this._context.clippingExtent;if(null!=ea&&!q.containsPoint(ea,oa))return null;
ea=this.getFastUpdateAttrValues(Z);const ra=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Z.uid,layerUid:this._context.layer.uid});W=Q.createPointGeometry(ca,P,oa,W,Y,null,null,ea,ra);Z=new T.RenderGeometry(W,{layerUid:ja,graphicUid:Z.uid});const ta=new L.Graphics3DDrapedGraphicLayer(this,[Z],null,this._context.drapeSourceRenderer);ta.getScreenSize=this._createScreenSizeGetter(Y,ea);ta.calculateRelativeScreenBounds=ya=>ca.calculateRelativeScreenBounds(ta.getScreenSize(),1,ya);
return ta}_createScreenSizeGetter(Z,ea){const ca=this._outlineSize+2;if(this._fastUpdates&&ea){const ja=Z[0]/this._symbolTextureRatio,oa=Z[1]/this._symbolTextureRatio;return(ra=l.create())=>{const [ta,ya]=S.evaluateModelTransformScale(aa,this._fastUpdates.materialParameters,ea);ra[0]=ta*ja+ca;ra[1]=ya*oa+ca;return ra}}const W=Z[0]/this._symbolTextureRatio+ca,Y=Z[1]/this._symbolTextureRatio+ca;return(ja=l.create())=>{ja[0]=W;ja[1]=Y;return ja}}_fastVisualVariableConvertOptions(){var Z=Math.max(this._size[0],
this._size[1]);const ea=u.fromValues(Z,Z,Z),ca=g.px2pt(1);Z*=ca;Z=u.fromValues(Z,Z,Z);return new S.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ea,Z,ca)}_forEachMaterial(Z){this._materials.forEach(Z);this._cimSymbolMaterials.forEach(Z)}_computeSizeFromTexture({parameters:Z},ea){Z=(Z.width??1)/(Z.height??1);return 1<Z?[ea,Math.round(ea/Z)]:[Math.round(ea*Z),ea]}test(){return{...super.test(),material:this._materials[0]}}}da.PRIMITIVE_SIZE=[R*ba,R*ba];da.elevationModeChangeTypes={definedChanged:H.SymbolUpdateType.UPDATE,
staysOnTheGround:H.SymbolUpdateType.NONE,onTheGroundChanged:H.SymbolUpdateType.RECREATE};const ha={mode:"relative-to-ground",offset:0},fa=x.fromValues(0,0,0,1),aa=u.create();b.Graphics3DIconSymbolLayer=da;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,h){function c(l){l=h.toCIMSymbolJSON(l);if("CIMTextSymbol"===l?.type)return l.height??0;let u=0;if(l?.symbolLayers)for(const x of l.symbolLayers)h.isCIMMarker(x)&&
null!=x.size&&x.size>u?u=x.size:h.isCIMStroke(x)&&null!=x.width&&x.width>u?u=x.width:h.isCIMFill(x);return u}function k(l,u,x,w){if(l)if("CIMTextSymbol"===l.type)null!=l.height&&(l.height*=u);else{if(x&&l.effects)for(const q of l.effects)f(q,u);if(l.symbolLayers)for(const q of l.symbolLayers)switch(q.type){case "CIMPictureMarker":case "CIMVectorMarker":m(q,u,w);break;case "CIMPictureStroke":case "CIMSolidStroke":!w?.preserveOutlineWidth&&q.width&&(q.width*=u);break;case "CIMPictureFill":q.height&&
(q.height*=u);q.offsetX&&(q.offsetX*=u);q.offsetY&&(q.offsetY*=u);break;case "CIMHatchFill":k(q.lineSymbol,u,!0,{...w,preserveOutlineWidth:!1}),q.offsetX&&(q.offsetX*=u),q.offsetY&&(q.offsetY*=u),q.separation&&(q.separation*=u)}}}function m(l,u,x){if(l&&(l.markerPlacement&&d(l.markerPlacement,u),l.offsetX&&(l.offsetX*=u),l.offsetY&&(l.offsetY*=u),l.anchorPoint&&"Absolute"===l.anchorPointUnits&&(l.anchorPoint={x:l.anchorPoint.x*u,y:l.anchorPoint.y*u}),l.size=null!=l.size?l.size*u:0,"CIMVectorMarker"===
l.type&&l.markerGraphics))for(const w of l.markerGraphics)l.scaleSymbolsProportionally||k(w.symbol,u,!0,x)}function d(l,u){h.isCIMMarkerStrokePlacement(l)&&l.offset&&(l.offset*=u);switch(l.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":l.customEndingOffset&&(l.customEndingOffset*=u);l.offsetAlongLine&&(l.offsetAlongLine*=u);if(l.placementTemplate&&l.placementTemplate.length){var x=l.placementTemplate.map(w=>w*u);l.placementTemplate=x}break;case "CIMMarkerPlacementAlongLineVariableSize":l.maxRandomOffset&&
(l.maxRandomOffset*=u);l.placementTemplate&&l.placementTemplate.length&&(x=l.placementTemplate.map(w=>w*u),l.placementTemplate=x);break;case "CIMMarkerPlacementOnLine":l.startPointOffset&&(l.startPointOffset*=u);break;case "CIMMarkerPlacementAtExtremities":l.offsetAlongLine&&(l.offsetAlongLine*=u);break;case "CIMMarkerPlacementAtRatioPositions":l.beginPosition&&(l.beginPosition*=u);l.endPosition&&(l.endPosition*=u);break;case "CIMMarkerPlacementPolygonCenter":l.offsetX&&(l.offsetX*=u);l.offsetY&&
(l.offsetY*=u);break;case "CIMMarkerPlacementInsidePolygon":l.offsetX&&(l.offsetX*=u),l.offsetY&&(l.offsetY*=u),l.stepX&&(l.stepX*=u),l.stepY&&(l.stepY*=u)}}function f(l,u){switch(l.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":l.width&&(l.width*=u);break;case "CIMGeometricEffectBuffer":l.size&&(l.size*=u);break;case "CIMGeometricEffectCut":l.beginCut&&(l.beginCut*=u);l.endCut&&(l.endCut*=u);l.middleCut&&(l.middleCut*=u);break;case "CIMGeometricEffectDashes":l.customEndingOffset&&
(l.customEndingOffset*=u);l.offsetAlongLine&&(l.offsetAlongLine*=u);if(l.dashTemplate&&l.dashTemplate.length){const x=l.dashTemplate.map(w=>w*u);l.dashTemplate=x}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":l.length&&(l.length*=u);break;case "CIMGeometricEffectMove":l.offsetX&&(l.offsetX*=u);l.offsetY&&(l.offsetY*=u);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":l.offset&&(l.offset*=u);break;case "CIMGeometricEffectRegularPolygon":l.radius&&
(l.radius*=u);break;case "CIMGeometricEffectTaperedPolygon":l.fromWidth&&(l.fromWidth*=u);l.length&&(l.length*=u);l.toWidth&&(l.toWidth*=u);break;case "CIMGeometricEffectWave":l.amplitude&&(l.amplitude*=u),l.period&&(l.period*=u)}}function g(l,u){if(l){var x="CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===l.type;if(x?.symbolLayers)for(const w of x.symbolLayers)if(!(w.colorLocked||l&&(h.isCIMStroke(w)||h.isCIMMarker(w)&&w.markerPlacement&&h.isCIMMarkerStrokePlacement(w.markerPlacement))))switch(w.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":w.tintColor&&
e(u,w.tintColor);break;case "CIMVectorMarker":w.markerGraphics?.forEach(q=>{g(q.symbol,u)});break;case "CIMSolidStroke":case "CIMSolidFill":e(u,w.color);break;case "CIMHatchFill":g(w.lineSymbol,u)}}}function e(l,u){for(const x of l)if(x.join(".")===u.join("."))return;l.push(u)}function n(l,u,x){if(l){var w="CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===w?.type;if(w?.symbolLayers)for(const q of w.symbolLayers)if(!q.colorLocked){if(l)if(x){if({layersToColor:w}=x,(h.isCIMStroke(q)||h.isCIMMarker(q)&&
q.markerPlacement&&h.isCIMMarkerStrokePlacement(q.markerPlacement))&&"fill"===w||h.isCIMFill(q)&&"outline"===w)continue}else if(h.isCIMStroke(q)||h.isCIMMarker(q)&&q.markerPlacement&&h.isCIMMarkerStrokePlacement(q.markerPlacement))continue;w=u.toArray();switch(q.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":q.tintColor=w;break;case "CIMVectorMarker":q.markerGraphics?.forEach(v=>{n(v.symbol,u,x)});break;case "CIMSolidStroke":case "CIMSolidFill":q.color=w;break;case "CIMHatchFill":n(q.lineSymbol,
u,x)}}}}a.applyCIMSymbolColor=function(l,u,x){u instanceof b||(u=new b(u));(l=h.toCIMSymbolJSON(l))&&n(l,u,x)};a.applyCIMSymbolRotation=function(l,u,x=!1){l=h.toCIMSymbolJSON(l);x&&0!==u&&(u=360-u);if("CIMTextSymbol"===l?.type)l.angle=u;else if("CIMPointSymbol"===l?.type&&l.symbolLayers){x=u-(l.angle||0);for(const w of l.symbolLayers)if(h.isCIMMarker(w)){let q=w.rotation||0;q=w.rotateClockwise?q-x:q+x;w.rotation=q}l.angle=u}};a.getCIMSymbolColor=function(l){l=h.toCIMSymbolJSON(l);const u=[];g(l,u);
return u.length?new b(h.normalizeAlpha(u[0])):null};a.getCIMSymbolRotation=function(l,u=!1){l=h.toCIMSymbolJSON(l);return"CIMTextSymbol"===l?.type||"CIMPointSymbol"===l?.type?(l=l.angle,null!=l&&0!==l&&u?360-l:l??0):0};a.getCIMSymbolSize=c;a.getCIMSymbolType=function(l){l=h.toCIMSymbolJSON(l);if(!l)return null;switch(l.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=m;a.scaleCIMSymbol=k;a.scaleCIMSymbolTo=function(l,u,x){if(l){var w=h.toCIMSymbolJSON(l);l=c(l);if(0===l){if(w)if("CIMTextSymbol"===w.type)w.height=u;else if(w.symbolLayers)for(const q of w.symbolLayers)switch(q.type){case "CIMPictureMarker":case "CIMVectorMarker":q.size=u;break;case "CIMPictureStroke":case "CIMSolidStroke":q.width=u}}else k(w,u/l,!1,x)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l){function u(A){A=A.symbolLayers;if(!A)return null;let B=null;A.forEach(F=>{"object"===F.type&&F.resource?.href||(B="water"===F.type?F.color:F.material?F.material.color:null)});return B?
new h(B):null}function x(A,B){if(null==B||null==A)return A;A=A.toRgba();A[3]*=B;return new h(A)}function w(A,B,F){if(A=A.symbolLayers){var G=H=>{B=B??H??(null!=F?E:null);return x(B,F)};A.forEach(H=>{if("object"!==H.type||!H.resource?.href||B)if("water"===H.type)H.color=G(H.color);else{const L=G(null!=H.material?H.material.color:null);null==H.material?H.material=new l.Symbol3DMaterial({color:L}):H.material.color=L;null!=F&&"outline"in H&&null!=H.outline?.color&&(H.outline.color=x(H.outline.color,F))}})}}
async function q(A,B){(A=A.symbolLayers)&&await k.forEach(A,async F=>v(F,B))}async function v(A,B){switch(A.type){case "extrude":A.size="number"===typeof B[2]?B[2]:0;break;case "icon":case "line":case "text":B=p(B);null!=B&&(A.size=B);break;case "path":const F=r(B,f.ONES,[A.width,void 0,A.height]);A.width=D(B[0],A.width,1,F);A.height=D(B[2],A.height,1,F);break;case "object":await t(A,B)}}function p(A){for(const B of A)if("number"===typeof B)return B;return null}async function t(A,B){const {resourceSize:F,
symbolSize:G}=await y(A),H=r(B,F,G);A.width=D(B[0],G[0],F[0],H);A.depth=D(B[1],G[1],F[1],H);A.height=D(B[2],G[2],F[2],H)}function r(A,B,F){for(let G=0;3>G;G++){const H=A[G];switch(H){case "symbol-value":return A=F[G],null!=A?A/B[G]:1;case "proportional":break;default:if(H&&B[G])return H/B[G]}}return 1}async function y(A){var {computeObjectLayerResourceSize:B}=await new Promise((z,J)=>a(["./symbolLayerUtils"],z,J));B=await B(A,10);const {width:F,height:G,depth:H}=A;A=[F,H,G];let L=1;for(var C=0;3>
C;C++){const z=A[C];if(null!=z){L=z/B[C];break}}for(C=0;3>C;C++)null==A[C]&&(A[C]=B[C]*L);return{resourceSize:B,symbolSize:A}}function D(A,B,F,G){switch(A){case "proportional":return F*G;case "symbol-value":return null!=B?B:F;default:return A}}const E=new h("white");b.applyColorToSymbol=function(A,B,F){if(A&&(B||null!=F))if(B&&=new h(B),c.isSymbol3D(A))w(A,B,F);else if(c.isSymbol2D(A)){if(B=B??A.color)A.color=x(B,F);null!=F&&"outline"in A&&A.outline?.color&&(A.outline.color=x(A.outline.color,F))}};
b.applyOpacityToColor=x;b.applyRotationToSymbol=function(A,B,F){A&&null!=B&&(c.isSymbol3D(A)?(A=A.symbolLayers)&&A.forEach(G=>{if(G&&"object"===G.type)switch(F){case "tilt":G.tilt=B;break;case "roll":G.roll=B;break;default:G.heading=B}}):!c.isSymbol2D(A)||"simple-marker"!==A.type&&"picture-marker"!==A.type&&"text"!==A.type||(A.angle=B))};b.applySizesToSymbol=async function(A,B){if(A&&B){if(c.isSymbol3D(A))return q(A,B);if(c.isSymbol2D(A)&&(B=p(B),null!=B))switch(A.type){case "simple-marker":A.size=
B;break;case "picture-marker":const F=A.width/A.height;1<F?(A.width=B,A.height=B*F):(A.width=B*F,A.height=B);break;case "simple-line":A.width=B;break;case "text":A.font.size=B}}};b.fetchWebStyleSymbol=async function(A,B){const F=await A.fetchSymbol(B);return F?F:A.fetchCIMSymbol(B)};b.getCSSFilterFromEffectList=function(A){if(!A)return null;A=A.effects.filter(B=>"bloom"!==B.type).map(B=>B.toJSON());return g.effectFunctionsFromJSON(A)};b.getColorFromSymbol=function(A,B){if(!A)return null;let F=null;
c.isSymbol3D(A)?F=u(A):c.isSymbol2D(A)&&(F="cim"===A.type?e.getCIMSymbolColor(A):A.color?new h(A.color):null);return F?x(F,B):null};b.getIconHref=function(A){return A.resource?.href??""};b.getSymbolOutlineSize=function(A){return A?c.isSymbol3D(A)?(A=(A=A.symbolLayers?.at(-1))&&"outline"in A?A?.outline?.size:void 0,null!=A?A:0):d.px2pt(n.getStroke(A)?.width):0};b.isVolumetricSymbol=function(A){if(null==A||!("symbolLayers"in A)||null==A.symbolLayers)return!1;switch(A.type){case "point-3d":return A.symbolLayers.some(B=>
"object"===B.type);case "line-3d":return A.symbolLayers.some(B=>"path"===B.type);case "polygon-3d":return A.symbolLayers.some(B=>"object"===B.type||"extrude"===B.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(A){return null!=A&&"polygon-3d"===A.type&&A.symbolLayers.some(B=>"extrude"===B.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,b,h,c,k,m,d){function f(u){if(!u)return null;let x=null;switch(u.type){case "simple-fill":case "picture-fill":case "simple-marker":x=f(u.outline);break;case "simple-line":const w=m.pt2px(u.width);null!=u.style&&"none"!==u.style&&0!==w&&(x={color:u.color,style:l(u.style),width:w,cap:u.cap,join:"miter"===u.join?m.pt2px(u.miterLimit):u.join},x.dashArray=g(x).join(",")||"none");break;default:x=null}return x}function g(u){if(!u?.style)return[];const {dashArray:x,style:w,width:q}=u;if("string"===
typeof x&&"none"!==x)return x.split(",").map(t=>Number(t));const v=q??0,p=e.has(w)?e.get(w).map(t=>t*v):[];if("butt"!==u.cap)for(const [t,r]of p.entries())p[t]=1===t%2?r+v:Math.max(r-v,1);return p}const e=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),n=new k.LRUCache(1E3),l=(()=>{const u={};return x=>
{if(u[x])return u[x];const w=x.replaceAll("-","");return u[x]=w}})();h=new h([128,128,128]);a.defaultThematicColor=h;a.dekebabifyLineStyle=l;a.getDashArray=g;a.getFill=function(u){const x=u.style;let w=null;if(u)switch(u.type){case "simple-marker":"cross"!==x&&"x"!==x&&(w=u.color);break;case "simple-fill":"solid"===x?w=u.color:"none"!==x&&(w={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${x}.png`),width:5,height:5});break;case "picture-fill":w={type:"pattern",src:u.url,width:m.pt2px(u.width)*
u.xscale,height:m.pt2px(u.height)*u.yscale,x:m.pt2px(u.xoffset),y:m.pt2px(u.yoffset)};break;case "text":w=u.color;break;case "cim":w=d.getCIMSymbolColor(u)}return w};a.getPatternUrlWithColor=function(u,x){const w=u+"-"+x;return void 0!==n.get(w)?Promise.resolve(n.get(w)):c(u,{responseType:"image"}).then(q=>{q=q.data;const v=q.naturalWidth,p=q.naturalHeight,t=document.createElement("canvas");t.width=v;t.height=p;const r=t.getContext("2d");r.fillStyle=x;r.fillRect(0,0,v,p);r.globalCompositeOperation=
"destination-in";r.drawImage(q,0,0);q=t.toDataURL();n.put(w,q);return q})};a.getStroke=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b){b=b.ZEROS;a.labelMarginPx=4;a.suspendResumeExtentOptimism=1.2;a.transparentUnit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,h,c,k,m,d,f){class g{constructor(u,x,w,q){this.graphics3DSymbolLayer=u;this.renderGeometries=x;this.boundingBox=w;this._drapeSourceRenderer=q;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}initialize(u){this.stage=u.stage}setVisibility(u){if(null!=this.stage&&this._visible!==u)if((this._visible=u)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,f.DirtyOperation.ADD);else if(u||this._addedToStage){for(const x of this.renderGeometries)x.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,f.DirtyState.VISIBILITY)}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,f.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null}getCenterObjectSpace(u=h.create()){return b.set(u,0,0,0)}getBoundingBoxObjectSpace(u=c.create()){return c.empty(u)}addObjectState(u,x){u===d.Object3DState.Highlight&&(this.renderGeometries.forEach(w=>{const q=w.geometry.addHighlight();
x.addRenderGeometry(w,q,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,f.DirtyState.HIGHLIGHT))}removeObjectState(u){this.renderGeometries.forEach(x=>{u.removeRenderGeometry(x)})}removeRenderGeometryObjectState(u,x){u.geometry.removeHighlight(x);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,f.DirtyState.HIGHLIGHT)}computeAttachmentOrigin(u){for(const x of this.renderGeometries)x.geometry.computeAttachmentOrigin(l)&&
(u.draped.origin[0]+=l[0],u.draped.origin[1]+=l[1],u.draped.num++)}async getProjectedBoundingBox(u,x,w,q,v){c.empty(v);for(let p=0;p<this.renderGeometries.length;p++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[p],u,e,w),c.expandWithRect(v,e);if(x){c.center(v,l);let p;u=m.demResolutionForBoundingBox(v,x.service.spatialReference,x);try{p=await x.service.queryElevation(l[0],l[1],q,u,"ground")}catch(t){}null!=p&&(v[2]=Math.min(v[2],p),v[5]=Math.max(v[5],p))}return v}_getRenderGeometryProjectedBoundingRect(u,
x,w,q){if(this.boundingBox)c.set(n,this.boundingBox);else{u=u.boundingSphere;const v=u[3];n[0]=u[0]-v;n[1]=u[1]-v;n[2]=u[2]-v;n[3]=u[0]+v;n[4]=u[1]+v;n[5]=u[2]+v}x(n,0,2);this.calculateRelativeScreenBounds&&q.push({location:c.center(n),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return c.toRect(n,w)}}const e=k.create(),n=c.create(),l=h.create();a.Graphics3DDrapedGraphicLayer=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,h,c){const k=Object.freeze({left:0,center:.5,right:1}),m=Object.freeze({"bottom-left":h.fromValues(0,0),bottom:h.fromValues(.5,0),"bottom-right":h.fromValues(1,0),left:h.fromValues(0,.5),center:h.fromValues(.5,.5),right:h.fromValues(1,.5),"top-left":h.fromValues(0,1),top:h.fromValues(.5,1),"top-right":h.fromValues(1,1)});a.anchorFromPlacements=function(d,
f){switch(f){case "bottom":return"left"===d?"bottom-left":"right"===d?"bottom-right":"bottom";case "center":return d;case "top":return"left"===d?"top-left":"right"===d?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(d){switch(d){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX=k;a.namedAnchorToHUDMaterialAnchorPos=m;a.textRenderAlignmentFromHorizontalPlacement=
function(d){switch(d){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(d){return"middle"===d?"center":d};a.verticalPlacementFromAnchor=function(d){switch(d){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};a.verticalScreenOffsetFromAlignment=
function(d,f){switch(d){case "top":return b.set(f,0,c.textVerticalPaddingPx);case "bottom":return b.set(f,0,-c.textVerticalPaddingPx);default:return b.copy(f,h.ZEROS)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(a,b,h,c,k){class m{constructor(e,n,l,u){this.text=e;this._alignment=n;this._parameters=l;this._maxSize=
u;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`;this._lines=e.replaceAll(" ","\u00a0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let n=0;n<this._lines.length-1;n++)e+=this._lineSpacing;e+=this._metrics.lastLineDescent;return Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+
this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const n=k.getTextHelperCanvas(f,512,512).getContext("2d");this._parameters.setFontProperties(n,this._fontSize);let l=2*this._haloSize;var e=this._parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"bold"===e.weight||"bolder"===e.weight)l+=.3*n.measureText("A").width;this._textWidths.length=0;let u=this._lineWidths.length=0,x,w,q=0,v=0;
this._lines.forEach((p,t)=>{p=n.measureText(p);const r=p.width,y=r+l;this._textWidths.push(r);this._lineWidths.push(y);u=Math.max(u,y);q=Math.max(q,p.actualBoundingBoxAscent);v=Math.max(v,p.actualBoundingBoxDescent);0===t&&(x=p);t===this._lines.length-1&&(w=p)});e=c.getFontMetrics(this._parameters);q=Math.max(q,e.maxAscent);v=Math.max(v,e.maxDescent);this._metricsCached=new g(x.actualBoundingBoxAscent,"underline"===this._parameters.definition.font.decoration?v:w.actualBoundingBoxDescent,q,v,u)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+
this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){null==this._renderPixelRatio&&(this._renderPixelRatio=Math.min(this._parameters.definition.pixelRatio,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight)));return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case a.TextRenderAlignment.Left:return this._horizontalPadding;
case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[e])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,n,l){e.save();n/=this.renderPixelRatio;l/=this.renderPixelRatio;const u=n,x=l;var w=this._haloSize;const q=this._firstLineYOffset+this._metrics.firstLineAscent;n+=w;l+=q;const v=0<this._haloSize;v&&this._renderHalo(e,u,x,w,q);this._parameters.setFontProperties(e,this._renderedFontSize);for(w=0;w<this._lines.length;++w){const p=
this._lines[w],t=this._getLineXOffset(w);v&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,p,n+t,l),this._renderLineDecoration(e,n+t,l,this._textWidths[w]));e.globalCompositeOperation="source-over";e.fillStyle=this._parameters.textStyle;this._fillText(e,p,n+this._getLineXOffset(w),l);this._renderLineDecoration(e,n+t,l,this._textWidths[w]);l+=this._lineSpacing}if(h.debugFlags.TEXT_SHOW_BASELINE)for(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([2,2]),
e.lineWidth=1,n=x+q,l=0;l<this._lines.length;++l)this._drawLine(e,[u,n],[u+this.displayWidth,n]),n+=this._lineSpacing;h.debugFlags.TEXT_SHOW_BORDER&&(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[u,x],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(e,u,x,this._parameters.definition.background.borderRadius*this.renderPixelRatio),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill());
e.restore()}_renderLineDecoration(e,n,l,u,x=!1){if("none"!==this._parameters.definition.font.decoration&&0!==u){var w=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":l+=2*w;break;case "line-through":l-=.33*this._midLineAscent}var q=x?this._haloSize:0;e.strokeStyle=x?this._parameters.haloStyle:this._parameters.textStyle;e.lineWidth=this._toRenderUnit(w+2*q);e.beginPath();e.moveTo(this._toRenderUnit(n-q),this._toRenderUnit(l));e.lineTo(this._toRenderUnit(n+
u+q),this._toRenderUnit(l));e.stroke()}}_roundedRect(e,n,l,u){n=this._toRenderUnit(n);l=this._toRenderUnit(l);const x=this.renderedWidth,w=this.renderedHeight;0===u?e.rect(n,l,x,w):(u=b.clamp(u,0,Math.floor(w/2)),e.beginPath(),e.moveTo(n,l+u),e.arcTo(n,l,n+u,l,u),e.lineTo(n+x-u,l),e.arcTo(n+x,l,n+x,l+u,u),e.lineTo(n+x,l+w-u),e.arcTo(n+x,l+w,n+x-u,l+w,u),e.lineTo(n+u,l+w),e.arcTo(n,l+w,n,l+w-u,u),e.closePath())}_renderHalo(e,n,l,u,x){const w=this.renderedWidth,q=this.renderedHeight,v=k.getTextHelperCanvas(f,
Math.max(w,512),Math.max(q,512)),p=v.getContext("2d");p.clearRect(0,0,w,q);this._parameters.setFontProperties(p,this._renderedFontSize);p.fillStyle=this._parameters.haloStyle;p.strokeStyle=this._parameters.haloStyle;var t=3>this._renderedHaloSize;p.lineJoin=t?"miter":"round";t?this._renderHaloEmulated(p,u,x):this._renderHaloNative(p,u,x);for(t=0;t<this._lines.length;++t){const r=this._getLineXOffset(t);this._renderLineDecoration(p,u+r,x,this._textWidths[t],!0);x+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3];
e.drawImage(v,0,0,w,q,this._toRenderUnit(n),this._toRenderUnit(l),w,q);e.globalAlpha=1}_renderHaloEmulated(e,n,l){for(let u=0;u<this._lines.length;++u){const x=this._lines[u],w=this._getLineXOffset(u);for(const [q,v]of d)this._fillText(e,x,n+w+this._haloSize*q,l+this._haloSize*v);l+=this._lineSpacing}}_renderHaloNative(e,n,l){const u=2*this._haloSize;for(let x=0;x<this._lines.length;++x){const w=this._lines[x],q=this._getLineXOffset(x);for(let v=0;5>v;v++)e.lineWidth=this._toRenderUnit((.6+.1*v)*
u),this._strokeText(e,w,n+q,l);l+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,n,l,u){e.fillText(n,this._toRenderUnit(l),this._toRenderUnit(u))}_strokeText(e,n,l,u){e.strokeText(n,this._toRenderUnit(l),this._toRenderUnit(u))}_drawLine(e,n,l){e.beginPath();e.moveTo(this._toRoundedRenderUnit(n[0])+.5,this._toRoundedRenderUnit(n[1])+.5);e.lineTo(this._toRoundedRenderUnit(l[0])+
.5,this._toRoundedRenderUnit(l[1])+.5);e.stroke()}_drawBox(e,n,l){var u=this._toRenderUnit(n[0]);n=this._toRenderUnit(n[1]);var x=this._toRenderUnit(l[0]);const w=this._toRenderUnit(l[1]);l=Math.floor(u)+.5;u=Math.ceil(u+x)-.5;x=Math.floor(n)+.5;n=Math.ceil(n+w)-.5;e.beginPath();e.moveTo(l,x);e.lineTo(u,x);e.lineTo(u,n);e.lineTo(l,n);e.lineTo(l,x);e.stroke()}}const d=[];for(let e=0;360>e;e+=22.5)d.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);a.TextRenderAlignment=void 0;(function(e){e[e.Left=
0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const f={canvas:null};class g{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,n,l,u,x){this.firstLineAscent=e;this.lastLineDescent=n;this.maxLineAscent=l;this.maxLineDescent=u;this.displayWidth=x}}a.TextRenderer=m;a.textVerticalPaddingPx=
1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(a,b){const h=new Map;class c{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(d,f){this.maxAscent=d;this.maxDescent=f}}const k={canvas:null},m=(()=>{let d="";for(let f=32;127>f;f++)d+=String.fromCharCode(f);return d})();a.getFontMetrics=function(d){const {size:f}=d.definition,g=d.fontString(f);var e=h.get(g);e||
(e=b.getTextHelperCanvas(k,0,0).getContext("2d"),d.setFontProperties(e,f),d=e.measureText(m),e=new c(d.actualBoundingBoxAscent,d.actualBoundingBoxDescent),h.set(g,e));return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(a){a.getTextHelperCanvas=function(b,h,c){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=h;b.canvas.height=c;return b.canvas};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../core/uid ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,h,c,k,m,d){class f{constructor(e,n={}){this.geometry=e;this.screenToWorldRatio=1;this._transformation=c.create();this._boundingSphere=this._shaderTransformation=null;this.id=
b.generateUID();this.layerUid=n.layerUid;this.graphicUid=n.graphicUid;this.castShadow=n.castShadow??!1;null!=n.objectShaderTransformation&&this.objectShaderTransformationChanged(n.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){h.copy(this._transformation,e);this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=
c.create()),h.multiply(this._shaderTransformation,e,this.geometry.transformation));this._boundingSphere=null}get boundingSphere(){if(!this.boundingInfo)return m.NullSphere;null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=m.create()),k.transformMat4(m.getCenter(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*d.maxScale(this.shaderTransformation));return this._boundingSphere}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??
this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}class g extends f{}a.RenderGeometry=f;a.ValidatedRenderGeometry=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../geometry ../../../../core/Error ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){const F=["polyline","polygon","extent"],G=new w.ConvertOptions({size:!0,color:!0,rotation:!1,opacity:!0});class H extends l.Graphics3DSymbolLayer{constructor(z,J,K,I){super(z,J,K,I)}async doLoad(){this._fastUpdates=w.initFastSymbolUpdatesState(this._context.renderer,G);if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:c.px2pt(1)))throw new h("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");
}_getMaterialParameters(z,J=!1){const K=this._getCombinedOpacityAndColor(J&&this._markerColor||this._materialColor);this._patternHidesLine&&!J&&(K[3]=0);z={width:this._computeMaterialWidth(this.symbolLayer?.size),color:K,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:x.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:z,stipplePattern:D.getStipplePatternForLinePattern(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?
{...z,...this._fastUpdates.materialParameters}:z}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){null==this._materials[C.Line]&&(this._materials[C.Line]=new E.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[C.Line]));return this._materials[C.Line]}get _ringMaterial(){null==this._materials[C.Ring]&&(this._materials[C.Ring]=new E.RibbonLineMaterial(this._getMaterialParameters(!0)),
this._context.stage.add(this._materials[C.Ring]));return this._materials[C.Ring]}get _wireframeLineMaterial(){null==this._materials[C.LineWireframe]&&(this._materials[C.LineWireframe]=new E.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[C.LineWireframe]));return this._materials[C.LineWireframe]}get _wireframeRingMaterial(){null==this._materials[C.RingWireframe]&&(this._materials[C.RingWireframe]=new E.RibbonLineMaterial({...this._getMaterialParameters(!0),
wireframe:!0}),this._context.stage.add(this._materials[C.RingWireframe]));return this._materials[C.RingWireframe]}get _markerMaterial(){null==this._materials[C.Marker]&&null!=this.symbolLayer.marker&&(this._materials[C.Marker]=new y.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:x.parseLineMarkerStyle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[C.Marker]));return this._materials[C.Marker]}destroy(){super.destroy();
this._forEachMaterial(z=>this._context.stage.remove(z));this._materials.length=0}_getDrivenSize(z){return this._drivenProperties.size&&z.size?c.pt2px(d.getDriverAxisSizeValueAny(z.size)):1}_getDrivenColor(z){const J=k.fromValues(1,1,1,1);this._drivenProperties.color&&z.color&&(J[0]=z.color[0],J[1]=z.color[1],J[2]=z.color[2],0<z.color.length&&(J[3]=z.color[3]));this._drivenProperties.opacity&&z.opacity&&(J[3]=z.opacity);return J}createGraphics3DGraphic(z){const J=z.graphic;if(!this._validateGeometry(J.geometry,
F,this.symbolLayer.type))return null;const K=this.setGraphicElevationContext(J);this.ensureDrapedStatus("on-the-ground"===K.mode);return this.draped?this._createAsOverlay(z,this._context.layer.uid):this._createAs3DShape(z,K,J.uid)}applyRendererDiff(z,J){for(const K in z.diff)switch(K){case "visualVariables":const I=this._fastUpdates;if(w.updateFastSymbolUpdatesState(I,J,G))this._forEachMaterial(M=>M?.setParameters(I.materialParameters));else return u.ApplyRendererDiffResult.RecreateSymbol;break;default:return u.ApplyRendererDiffResult.RecreateSymbol}return u.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(z){if("partial"===
z.diff.type){var J=z.diff.diff,K={};"complete"===J.size?.type&&(K.width=this._computeMaterialWidth(J.size.newValue),delete J.size);"complete"===J.cap?.type&&(K.cap=x.parseCapType(J.cap.newValue??"butt"),delete J.cap);var I=this._prepareMarkerPatch(z,J);this._prepareMaterialPatch(z,J,I);z.symbolLayerStatePatches.push(()=>this._forEachMaterial(M=>M?.setParameters(K)))}}layerOpacityChanged(){this._forEachMaterial((z,J)=>this._updateMaterialLayerOpacity(z,J===C.Marker))}_forEachMaterial(z){this._materials.forEach(z)}_updateMaterialLayerOpacity(z,
J=!1){if(null!=z){var K=z.parameters.color,I=this.symbolLayer?.material?.color;J=this._patternHidesLine&&!J?0:this._getCombinedOpacity(I);K=k.fromValues(K[0],K[1],K[2],J);z.setParameters({color:K})}}layerElevationInfoChanged(z,J,K){const I=this._elevationContext.mode;K=g.elevationModeChangeUpdateType(H.elevationModeChangeTypes,K,I);if(K!==g.SymbolUpdateType.UPDATE)return K;const M=g.needsElevationUpdates2D(I);return this.updateGraphics3DGraphicElevationInfo(z,J,()=>M)}slicePlaneEnabledChanged(){const z=
{hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(J=>J?.setParameters(z));return!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(z){switch(z.type){case "extent":if(z instanceof A)return B.fromExtent(z);break;case "polygon":case "polyline":return z}return null}_createAs3DShape(z,J,K){const I=this._getGeometryAsPolygonOrPolyline(z.graphic.geometry);var M="polygon"===I.type?I.rings:I.paths,S=[];const N=m.create(),V=p.geometryToRenderInfo(I,this._context.elevationProvider,
this._context.renderCoordsHelper,J);this._logGeometryCreationWarnings(V,M,"polygon"===I.type?"rings":"paths","LineSymbol3DLayer");for(M=0;M<V.lines.length;M++){var Q=V.lines[M],T=Q.position;Q=Q.mapPositions;if(null!=this._context.clippingExtent&&(m.empty(N),m.expandWithBuffer(N,Q),!m.intersectsClippingArea(N,this._context.clippingExtent)))continue;T=this._createGeometry("polygon"===I.type?this._ringMaterial:this._lineMaterial,z,T,Q,I.type,L.ELEVATED,K);S.push(T);q.debugFlags.LINE_WIREFRAMES&&S.push(T.instantiate({material:"polygon"===
I.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));null!=this._markerMaterial&&S.push(T.instantiate({material:this._markerMaterial}))}if(0===S.length)return null;z=new t.Object3D({geometries:S,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:K});S=new n.Graphics3DObject3DGraphicLayer(this,z,S,null,null,f.sharedGeometryElevationAligner,J);S.alignedSampledElevation=V.sampledElevation;S.needsElevationUpdates=g.needsElevationUpdates2D(J.mode);return S}_createGeometry(z,J,K,I,M,
S,N){S=S===L.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null;M="polygon"===M;const V=this._fastUpdates?.visualVariables.color,Q=this._fastUpdates?.visualVariables.size,T=this._fastUpdates?.visualVariables.opacity;N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:N,layerUid:this._context.layer.uid});J={position:K,size:Q?null:this._getDrivenSize(J.renderingInfo),color:V?null:this._getDrivenColor(J.renderingInfo),sizeFeature:Q?
w.getAttributeValue(Q.field,J.graphic):null,colorFeature:V?w.getAttributeValue(V.field,J.graphic):null,opacityFeature:T?w.getAttributeValue(T.field,J.graphic):null};return v.createGeometry(z,{overlayInfo:S,removeDuplicateStartEnd:M,mapPositions:I,attributeData:J},N)}_createAsOverlay(z,J){const K=z.graphic,I=this._getGeometryAsPolygonOrPolyline(K.geometry);var M="polygon"===I.type?I.rings:I.paths;const S="polygon"===I.type?this._ringMaterial:this._lineMaterial;S.renderPriority=this._renderPriority;
const N=q.debugFlags.LINE_WIREFRAMES?"polygon"===I.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,V=this._markerMaterial;null!=N&&(N.renderPriority=this._renderPriority-.001);null!=V&&(V.renderPriority=this._renderPriority-.002);const Q=[],T=m.create(),ia=m.empty();var O=p.geometryToRenderInfoDraped(I,this._context.overlaySR);this._logGeometryCreationWarnings(O,M,"polygon"===I.type?"rings":"paths","LineSymbol3DLayer");for(const U of O.lines)m.empty(T),m.expandWithBuffer(T,U.position),
m.intersectsClippingArea(T,this._context.clippingExtent)&&(m.expandWithAABB(ia,T),M=P=>{P=this._createGeometry(P,z,U.position,void 0,I.type,L.DRAPED,K.uid);P=new r.RenderGeometry(P,{layerUid:J,graphicUid:K.uid});Q.push(P)},null!=V&&(M(V),O=this.symbolLayer.marker.placement,"begin"!==O&&"begin-end"!==O||m.expandWithBuffer(T,U.position,0,1),"end"!==O&&"begin-end"!==O||m.expandWithBuffer(T,U.position,U.position.length-3,1)),M(S),q.debugFlags.LINE_WIREFRAMES&&M(N));return new e.Graphics3DDrapedGraphicLayer(this,
Q,ia,this._context.drapeSourceRenderer)}get _patternHidesLine(){const z=this.symbolLayer.pattern;return null!=z&&"style"===z.type&&"none"===z.style}_computeMaterialWidth(z){z=z??c.px2pt(1);return this._drivenProperties.size?this._fastUpdates?.visualVariables.size?c.pt2px(1):1:c.pt2px(z)}_prepareMaterialPatch(z,J,K){var I=J.material;null==I?K.changed&&K.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[C.Marker],z):"collection"!==I.type&&
(I=this._getCombinedOpacityAndColor("complete"===I.type?I.newValue?.color:"complete"===I.diff.color?.type?I.diff.color.newValue:null),K.useMaterialColor&&this._patchMaterialColor(k.clone(I),this._materials[C.Marker],z),this._patternHidesLine&&(I[3]=0),this._patchMaterialColor(I,this._materials[C.Line],z),delete J.material)}_prepareMarkerPatch(z,J){const K=J.marker,I=this._markerMaterial;if(null==K||"partial"!==K.type||null==K.diff||null!=K.diff.placement||null!=K.diff.style&&"complete"!==K.diff.style.type||
null!=K.diff.color&&"complete"!==K.diff.color.type||null==I)return{changed:!1,useMaterialColor:null==this._markerColor};var M=K.diff.color;const S=null!=M;M=S?M.newValue:null;const N=null==M&&null==this._markerColor;M&&this._patchMaterialColor(this._getCombinedOpacityAndColor(M),I,z);const V=K.diff.style?.newValue;V&&z.symbolLayerStatePatches.push(()=>I.setParameters({markerPrimitive:x.parseLineMarkerStyle(V)}));delete J.marker;return{changed:S,useMaterialColor:N}}_patchMaterialColor(z,J,K){null!=
J&&K.symbolLayerStatePatches.push(()=>J.setParameters({color:z}))}}H.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.RECREATE,staysOnTheGround:g.SymbolUpdateType.NONE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};var L;(function(z){z[z.DRAPED=0]="DRAPED";z[z.ELEVATED=1]="ELEVATED"})(L||={});var C;(function(z){z[z.Line=0]="Line";z[z.Ring=1]="Ring";z[z.LineWireframe=2]="LineWireframe";z[z.RingWireframe=3]="RingWireframe";z[z.Marker=4]="Marker"})(C||={});a.Graphics3DLineSymbolLayer=H;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,h){a.parseCapType=function(c){switch(c){case "butt":return h.CapType.BUTT;case "square":return h.CapType.SQUARE;case "round":return h.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(c){return"diamond"===c?"kite":c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){const w=h.create(),q=h.create();a.createGeometry=function(v,p,t=null){const r=[],y=p.mapPositions,{attributeData:{position:D},removeDuplicateStartEnd:E}=p;var A=D.length;A=D[0]===D[A-3]&&D[1]===D[A-2]&&D[2]===D[A-1]&&E;var B=D.length/3-(A?1:0),F=Array(2*(B-1)),G=A?D.slice(0,-3):D,H=0;for(var L=0;L<B-1;L++)F[H++]=L,F[H++]=L+1;r.push([x.VertexAttribute.POSITION,new n.Attribute(G,F,3,A)]);B=r[0][1].data;A=g.getZeroIndexArray(r[0][1].indices.length);null==p.attributeData.colorFeature&&
r.push([x.VertexAttribute.COLOR,new n.Attribute(p.attributeData.color??c.ONES,A,4)]);null==p.attributeData.sizeFeature&&r.push([x.VertexAttribute.SIZE,new n.Attribute([p.attributeData.size??1],A,1,!0)]);p.attributeData.normal&&r.push([x.VertexAttribute.NORMAL,new n.Attribute(p.attributeData.normal,A,3)]);null!=p.attributeData.colorFeature&&r.push([x.VertexAttribute.COLORFEATUREATTRIBUTE,new n.Attribute([p.attributeData.colorFeature],A,1,!0)]);null!=p.attributeData.sizeFeature&&r.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,
new n.Attribute([p.attributeData.sizeFeature],A,1,!0)]);null!=p.attributeData.opacityFeature&&r.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,new n.Attribute([p.attributeData.opacityFeature],A,1,!0)]);if(null!=p.overlayInfo&&p.overlayInfo.renderCoordsHelper.viewingMode===e.ViewingMode.Global&&p.overlayInfo.spatialReference.isGeographic){A=d.newDoubleArray(B.length);p=k.getReferenceEllipsoid(p.overlayInfo.spatialReference);for(F=0;F<A.length;F+=3)m.lonLatToWebMercatorComparable(B,F,A,F,p);p=B.length/
3;B=f.newFloatArray(p+1);F=w;G=q;L=H=0;b.set(F,A[L++],A[L++]);L++;B[0]=0;for(let C=1;C<p+1;++C)C===p&&(L=0),b.set(G,A[L++],A[L++]),L++,H+=b.dist(F,G),B[C]=H,[F,G]=[G,F];r.push([x.VertexAttribute.DISTANCETOSTART,new n.Attribute(B,r[0][1].indices,1,!0)])}return new u.Geometry(v,r,y,l.ContentObjectType.Line,t)};a.lineStripsToParameters=function(v,p){if(null==v||0===v.length)return[];const t=[];v.forEach(r=>{const y=d.newDoubleArray(3*r.length);r.forEach((D,E)=>{y[3*E]=D[0];y[3*E+1]=D[1];y[3*E+2]=D[2]});
t.push({attributeData:{position:y,normal:p},removeDuplicateStartEnd:!1})});return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,h,c,k,m){function d(f,g,e=null){const n=[];for(const {index:l,
count:u}of f){if(1>=u)continue;f=3*l;const x=3*u;n.push({position:h.doubleSubArray(g,3*l,3*u),mapPositions:null!=e?h.doubleSubArray(e,f,x):void 0})}return n}a.geometryToRenderInfo=function(f,g,e,n){const {position:l,outlines:u}=c.pathsToTriangulationInfo("polygon"===f.type?f.rings:f.paths,!!f.hasZ,"polygon"===f.type?c.CounterClockwiseMode.CCW_IS_HOLE:c.CounterClockwiseMode.NONE,f.spatialReference),x=h.newDoubleArray(l.length);f=k.applyPerVertexElevationAlignment(l,f.spatialReference,0,x,0,l,0,l.length/
3,g,e,n);g=null!=f;return{lines:g?d(u,l,x):[],projectionSuccess:g,sampledElevation:f}};a.geometryToRenderInfoDraped=function(f,g){const {position:e,outlines:n}=c.pathsToTriangulationInfo("polygon"===f.type?f.rings:f.paths,!1,"polygon"===f.type?c.CounterClockwiseMode.CCW_IS_HOLE:c.CounterClockwiseMode.NONE);f=b.projectBuffer(e,f.spatialReference,0,e,g,0,e.length/3);for(g=2;g<e.length;g+=3)e[g]=m.drapedZ;return{lines:f?d(n,e):[],projectionSuccess:f}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(a,b,h,c,k,m,
d,f,g,e,n,l,u){class x extends d.Material{constructor(r){super(r,new q);this.produces=new Map([[f.RenderSlot.OPAQUE_MATERIAL,y=>y===k.ShaderOutput.Highlight||k.isColorOrAlpha(y)&&this.parameters.renderOccluded===d.RenderOccludedFlag.OccludeAndTransparentStencil],[f.RenderSlot.OPAQUE_NO_SSAO_DEPTH,y=>y===k.ShaderOutput.LinearDepth],[f.RenderSlot.OCCLUDER_MATERIAL,y=>k.isColorAlphaHighlightOrDepth(y)&&this.parameters.renderOccluded===d.RenderOccludedFlag.OccludeAndTransparentStencil],[f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,
y=>k.isColorAlphaHighlightOrDepth(y)&&this.parameters.renderOccluded===d.RenderOccludedFlag.OccludeAndTransparentStencil],[f.RenderSlot.TRANSPARENT_MATERIAL,y=>k.isColorOrAlpha(y)&&this.parameters.writeDepth],[f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,y=>k.isColorOrAlpha(y)&&!this.parameters.writeDepth],[f.RenderSlot.DRAPED_MATERIAL,y=>y===k.ShaderOutput.Color||y===k.ShaderOutput.Highlight]]);this._vertexAttributeLocations=n.vertexAttributeLocations;this._configuration=new l.LineMarkerTechniqueConfiguration;
this._layout=this.createLayout()}getConfiguration(r,y){this._configuration.output=r;this._configuration.space=y.slot===f.RenderSlot.DRAPED_MATERIAL?l.LineMarkerSpace.Draped:this.parameters.worldSpace?l.LineMarkerSpace.World:l.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==u.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===d.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=y.transparencyPassType;this._configuration.multipassEnabled=
y.multipassEnabled;this._configuration.cullAboveGround=y.multipassTerrain.cullAboveGround;return this._configuration}intersect(){}createLayout(){const r=c.newLayout().vec3f(g.VertexAttribute.POSITION).vec3f(g.VertexAttribute.PREVPOSITION).vec2f(g.VertexAttribute.UV0);this.parameters.worldSpace&&r.vec3f(g.VertexAttribute.NORMAL);this.parameters.vvSize?r.f32(g.VertexAttribute.SIZEFEATUREATTRIBUTE):r.f32(g.VertexAttribute.SIZE);this.parameters.vvColor?r.f32(g.VertexAttribute.COLORFEATUREATTRIBUTE):r.vec4f(g.VertexAttribute.COLOR);
this.parameters.vvOpacity&&r.f32(g.VertexAttribute.OPACITYFEATUREATTRIBUTE);return r}createBufferWriter(){return new v(this._layout,this.parameters)}createGLMaterial(r){return new w(r)}}class w extends m.GLTextureMaterial{constructor(){super(...arguments);this._markerPrimitive=null}dispose(){super.dispose();this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null}_updateParameters(r){const y=this._material.parameters.markerPrimitive;y!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(y,
this._markerPrimitive)}),this._markerPrimitive=y);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(n.LineMarkerTechnique,r)}_updateOccludeeState(r){r.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:r.hasOccludees})}beginSlot(r){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(r);return this._updateParameters(r)}}class q extends e.VisualVariablePassParameters{constructor(){super(...arguments);
this.width=0;this.color=[1,1,1,1];this.markerPrimitive="arrow";this.placement="end";this.cap=u.CapType.BUTT;this.anchor=l.LineMarkerAnchor.Center;this.hideOnShortSegments=this.worldSpace=this.hasTip=!1;this.writeDepth=!0;this.hasOccludees=this.vvFastUpdate=this.hasSlicePlane=!1;this.markerTexture=null}}class v{constructor(r,y){this.vertexBufferLayout=r;this._parameters=y}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(r,y,D,E,A){const B=D.attributes.get(g.VertexAttribute.POSITION).data,
F=B.length/3;let G=[1,0,0];y=D.attributes.get(g.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=y&&(G=y.data);let H=1,L=0;this._parameters.vvSize?L=D.attributes.get(g.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:D.attributes.has(g.VertexAttribute.SIZE)&&(H=D.attributes.get(g.VertexAttribute.SIZE).data[0]);let C=[1,1,1,1],z=0;this._parameters.vvColor?z=D.attributes.get(g.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:D.attributes.has(g.VertexAttribute.COLOR)&&(C=D.attributes.get(g.VertexAttribute.COLOR).data);
let J=0;this._parameters.vvOpacity&&(J=D.attributes.get(g.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const K=new Float32Array(E.buffer);let I=this.vertexBufferLayout.stride/4*A;const M=(N,V,Q,T)=>{K[I++]=N[0];K[I++]=N[1];K[I++]=N[2];K[I++]=V[0];K[I++]=V[1];K[I++]=V[2];K[I++]=Q[0];K[I++]=Q[1];this._parameters.worldSpace&&(K[I++]=G[0],K[I++]=G[1],K[I++]=G[2]);this._parameters.vvSize?K[I++]=L:K[I++]=H;this._parameters.vvColor?K[I++]=z:(N=Math.min(4*T,C.length-4),K[I++]=C[N],K[I++]=C[N+1],K[I++]=
C[N+2],K[I++]=C[N+3]);this._parameters.vvOpacity&&(K[I++]=J)};let S;(function(N){N[N.ASCENDING=1]="ASCENDING";N[N.DESCENDING=-1]="DESCENDING"})(S||={});D=(N,V)=>{const Q=b.set(p,B[3*N],B[3*N+1],B[3*N+2]),T=t;let ia=N+V;do b.set(T,B[3*ia],B[3*ia+1],B[3*ia+2]),ia+=V;while(b.equals(Q,T)&&0<=ia&&ia<F);r&&(b.transformMat4(Q,Q,r),b.transformMat4(T,T,r));M(Q,T,[-1,-1],N);M(Q,T,[1,-1],N);M(Q,T,[1,1],N);M(Q,T,[-1,-1],N);M(Q,T,[1,1],N);M(Q,T,[-1,1],N)};E=this._parameters.placement;"begin"!==E&&"begin-end"!==
E||D(0,S.ASCENDING);"end"!==E&&"begin-end"!==E||D(F-1,S.DESCENDING)}}const p=h.create(),t=h.create();a.LineMarkerMaterial=x;a.Parameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ./LineMarkerTechniqueConfiguration ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){const x=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.PREVPOSITION,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.NORMAL,3],[e.VertexAttribute.COLOR,4],[e.VertexAttribute.COLORFEATUREATTRIBUTE,4],[e.VertexAttribute.SIZE,5],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,5],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,6]]);class w extends k.ShaderTechnique{initializeProgram(q){return new d.Program(q.rctx,w.shader.get().build(this.configuration),x)}_makePipelineState(q,
v){const p=this.configuration,t=q===g.TransparencyPassType.NONE;return u.makePipelineState({blending:p.output===h.ShaderOutput.Color||p.output===h.ShaderOutput.Alpha?t?m.blendingDefault:m.oitBlending(q):null,depthTest:p.space===l.LineMarkerSpace.Draped?null:{func:m.oitDepthTest(q)},depthWrite:p.space===l.LineMarkerSpace.Draped?null:t?p.writeDepth?u.defaultDepthWriteParams:null:m.oitDepthWrite(q),colorWrite:u.defaultColorWriteParams,stencilWrite:p.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:p.hasOccludees?
v?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){this.configuration.occluder&&(this._occluderPipelineTransparent=u.makePipelineState({blending:m.blendingDefault,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=u.makePipelineState({blending:m.blendingDefault,depthTest:f.depthCompareAlways,depthWrite:null,
colorWrite:u.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=u.makePipelineState({blending:null,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(q,
v,p){return q?this._occludeePipelineState:this.configuration.occluder?p?this._occluderPipelineTransparent:v?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}w.shader=new c.ReloadableShaderModule(n.LineMarker,()=>new Promise((q,v)=>a(["./LineMarker.glsl"],q,v)));b.LineMarkerTechnique=w;b.vertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(F){const G=new t.ShaderBuilder,H=F.multipassEnabled&&(F.output===c.ShaderOutput.Color||F.output===c.ShaderOutput.Alpha),L=F.space===E.LineMarkerSpace.World;G.include(m.RibbonVertexPosition,F);G.include(f.MarkerSizing,F);F.output===c.ShaderOutput.LinearDepth&&G.include(d.OutputDepth,F);const {vertex:C,fragment:z}=G;z.include(l.RgbaFloatEncoding);u.addProjViewLocalOrigin(C,F);G.attributes.add(D.VertexAttribute.POSITION,"vec3");G.attributes.add(D.VertexAttribute.PREVPOSITION,
"vec3");G.attributes.add(D.VertexAttribute.UV0,"vec2");G.varyings.add("vColor","vec4");G.varyings.add("vpos","vec3");G.varyings.add("vUV","vec2");G.varyings.add("vSize","float");h.addLinearDepth(G);H&&G.varyings.add("depth","float");F.hasTip&&G.varyings.add("vLineWidth","float");C.uniforms.add(new x.Float2PassUniform("nearFar",(J,K)=>K.camera.nearFar),new w.Float4PassUniform("viewport",(J,K)=>K.camera.fullViewport));C.code.add(v.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);C.code.add(v.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);L?(G.attributes.add(D.VertexAttribute.NORMAL,"vec3"),u.addViewNormal(C),C.constants.add("tiltThreshold","float",.7),C.code.add(v.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):C.code.add(v.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);C.code.add(v.glsl`
      #define vecN ${L?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${L?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${F.anchor===E.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);F.space===E.LineMarkerSpace.Screen&&(C.uniforms.add(new p.Matrix4PassUniform("inverseProjectionMatrix",(J,K)=>K.camera.inverseProjectionMatrix)),C.code.add(v.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),C.code.add(v.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),C.uniforms.add(new q.FloatPassUniform("perScreenPixelRatio",(J,K)=>K.camera.perScreenPixelRatio)),C.code.add(v.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${F.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));u.addPixelRatio(C);h.addCalculateLinearDepth(G);C.code.add(v.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`);L?(F.hideOnShortSegments&&C.code.add(v.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),C.code.add(v.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(C.code.add(v.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),F.space===E.LineMarkerSpace.Screen&&C.code.add(v.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));C.code.add(v.glsl`
        ${H?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${L?"":"vUV *\x3d displacedPosScreen.w;"}

        ${F.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);H&&G.include(g.multipassTerrainTest,F);G.include(k.SliceDraw,F);z.uniforms.add(new w.Float4PassUniform("intrinsicColor",J=>J.color),new r.Texture2DPassUniform("tex",J=>J.markerTexture));z.include(n.ColorConversion);G.constants.add("texelSize","float",1/b.markerTextureSize);z.code.add(v.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);F.hasTip&&(G.constants.add("relativeMarkerSize","float",b.markerSymbolSize/b.markerTextureSize),G.constants.add("relativeTipLineWidth","float",b.markerTipThicknessFactor),z.code.add(v.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${L?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));G.constants.add("symbolAlphaCutoff","float",e.symbolAlphaCutoff);z.code.add(v.glsl`
  void main() {
    discardBySlice(vpos);
    ${H?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${L?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${F.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${F.output===c.ShaderOutput.ObjectAndLayerIdColor?v.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${F.output===c.ShaderOutput.Alpha?v.glsl`fragColor = vec4(finalColor.a);`:""}
    ${F.output===c.ShaderOutput.Color?v.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${F.output===c.ShaderOutput.Color&&F.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${F.output===c.ShaderOutput.Highlight?v.glsl`fragColor = vec4(1.0);`:""}
    ${F.output===c.ShaderOutput.LinearDepth?v.glsl`outputDepth(linearDepth);`:""}
  }
  `);return G}const B=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.LineMarker=B;a.build=A})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],function(a){function b(k){null!=k?(k=c[k],k=null==k?k:{pattern:k.slice(),pixelRatio:8}):k=null;return k}const h={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},c={dash:h.dash,"dash-dot":[...h.dash,...h.dot],dot:h.dot,"long-dash":h["long-dash"],
"long-dash-dot":[...h["long-dash"],...h.dot],"long-dash-dot-dot":[...h["long-dash"],...h.dot,...h.dot],none:null,"short-dash":h["short-dash"],"short-dash-dot":[...h["short-dash"],...h["short-dot"]],"short-dash-dot-dot":[...h["short-dash"],...h["short-dot"],...h["short-dot"]],"short-dot":h["short-dot"],solid:null};a.createStipplePatternSimple=function(k){return{pattern:[k,k],pixelRatio:2}};a.getStipplePatternForLinePattern=function(k){return null!=k&&"style"===k.type?b(k.style):null};a.getStipplePatternForPatternStyle=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToPoint ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshTextureTransform ../../../../geometry/support/meshVertexSpaceUtils ../../../../chunks/vec3 ../../../../geometry/support/meshUtils/georeference ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/sources/interfaces ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DMeshObject3DGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./MeshFastUpdateProcessor ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa){const aa=["mesh"];class Z extends M.Graphics3DSymbolLayer{constructor(la,qa,ua,va){super(la,qa,ua,va);this._materialInfoCache=new S.MaterialInfoCache;this._fastUpdateProcessor=new S.MeshFastUpdateProcessor;this._textures=new Map;this.ensureDrapedStatus(!1)}async doLoad(){Q.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new da.NativeLineMaterial({color:[1,0,1,
1]}),this._debugFaceNormalMaterial=new da.NativeLineMaterial({color:[0,1,1,1]}))}destroy(){super.destroy();this._textures.forEach(la=>la.unload());this._context.stage.removeMany(this._materialInfoCache.materials);this._context.stage.removeMany(Array.from(this._textures.values()));this._materialInfoCache.clear();this._textures.clear();this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(la){const qa=la.graphic;if(!this._validateGeometry(qa.geometry,
aa,"fill on mesh-3d"))return null;const ua=this.setGraphicElevationContext(qa);return this._createAs3DShape(qa,la.renderingInfo,ua,qa.uid)}onRemoveGraphic(la){this._fastUpdateProcessor.onRemoveGraphic(la,this._materialInfoCache,this._context)}layerOpacityChanged(la,qa){const ua=this._getLayerOpacity();this._updateMaterialParameters(va=>{va.material.setParameters({layerOpacity:ua});const Ga=va.material.parameters;this._setMaterialTransparentParameter(Ga,va);va.material.setParameters({transparent:Ga.transparent})});
la.forEach(va=>qa(va)?.layerOpacityChanged(ua,this._context.isAsync))}layerElevationInfoChanged(la,qa){return this.updateGraphics3DGraphicElevationInfo(la,qa,J.needsElevationUpdates3D)}slicePlaneEnabledChanged(la,qa){this._updateMaterialParameters(({material:ua})=>{ua.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});la.forEach(ua=>qa(ua)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync));return!0}physicalBasedRenderingChanged(){const la=this._usePBR();
this._updateMaterialParameters(({material:qa})=>qa.setParameters({usePBR:la}));return!0}updateTransform(la,qa,ua,va){const Ga=this._context.renderCoordsHelper.spatialReference,La=ya,{origin:Na,transform:Wa}=ua;u.computeTranslationToOriginAndRotation(qa,g.set(W,Na.x,Na.y,Na.z??0),La,Ga);switch(va){case G.MeshTransformUpdateAction.EnableFastUpdates:this._fastUpdateProcessor.enable(la,this._materialInfoCache,this._context);break;case G.MeshTransformUpdateAction.DisableFastUpdates:this._fastUpdateProcessor.disable(la,
this._materialInfoCache,this._context);break;case G.MeshTransformUpdateAction.UpdateFastLocalOrigin:la.updateFastLocalOrigin(La,Wa,this._context.localOriginFactory)}const {elevationContext:Ia}=la;Ia.centerPointInElevationSR=this._getCenterPointInElevationSR(La);const {elevationProvider:Oa,renderCoordsHelper:Ua}=this._context;la.alignedSampledElevation=z.perObjectElevationAligner(la,Ia,Oa.spatialReference,(Va,Ra)=>J.evaluateElevationInfoAtPoint(Va,Oa,Ia,Ua,Ra),Ua,La);la.updateTransform(La,Wa,this._context.isAsync);
return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(la){return null==la?"-":la instanceof b?la.toHex():la.contentHash}_materialPropertiesDefault(la,qa){const ua=this._requiresSymbolVertexColors(),va=!!la.vertexAttributes.color;la=!!la.vertexAttributes.tangent;return{hasSymbolVertexColors:ua,hasVertexColors:va,hasVertexTangents:la,uid:`vc:${va},vt:${la},vct${qa},svc:${ua}`}}_textureTransformUid(la){const {offset:qa,scale:ua,
rotation:va}=la??wa;return`${qa[0]},${qa[1]},${va},${ua[0]},${ua[1]}`}_materialProperties(la,qa,ua){la=this._materialPropertiesDefault(la,ua);if(!qa.material)return la;const {color:va,colorTexture:Ga,colorTextureTransform:La,normalTexture:Na,normalTextureTransform:Wa,doubleSided:Ia,alphaCutoff:Oa,alphaMode:Ua}=qa.material;ua=this._colorOrTextureUid(va);var Va=this._colorOrTextureUid(Ga),Ra=this._textureTransformUid(La),bb=this._colorOrTextureUid(Na),gb=this._textureTransformUid(Wa);la.color=va;la.colorTexture=
Ga;la.normalTexture=Na;la.uid=`${la.uid},cmuid:${ua},ctmuid:${Va},cttuid:${Ra},ntmuid:${bb},nttuid:${gb},ds:${Ia},ac:${Oa},am:${Ua}`;if(qa.material instanceof r){const {metallic:db,roughness:ka,metallicRoughnessTexture:mb,metallicRoughnessTextureTransform:sb,emissiveColor:tb,emissiveTexture:xa,emissiveTextureTransform:Ha,occlusionTexture:na,occlusionTextureTransform:za}=qa.material;qa=this._colorOrTextureUid(mb);ua=this._textureTransformUid(sb);Va=this._colorOrTextureUid(tb);Ra=this._colorOrTextureUid(xa);
bb=this._textureTransformUid(Ha);gb=this._colorOrTextureUid(na);const Da=this._textureTransformUid(za);la.metallic=db;la.roughness=ka;la.metallicRoughnessTexture=mb;la.emissiveColor=tb;la.emissiveTexture=xa;la.occlusionTexture=na;la.colorTextureTransform=this._convertTextureTransform(La);la.normalTextureTransform=this._convertTextureTransform(Wa);la.emissiveTextureTransform=this._convertTextureTransform(Ha);la.occlusionTextureTransform=this._convertTextureTransform(za);la.metallicRoughnessTextureTransform=
this._convertTextureTransform(sb);la.uid=`${la.uid},mrm:${db},mrr:${ka},mrt:${qa},mrtt:${ua},emuid:${Va},etmuid:${Ra},ett:${bb},otmuid:${gb},ott:${Da}`}return la}_convertTextureTransform(la){if(!la)return null;const {scale:qa,offset:ua,rotation:va}=la;return{scale:qa,offset:ua,rotation:c.deg2rad(va)}}_setInternalColorValueParameters(la,qa){qa.diffuse=b.toUnitRGB(la);qa.opacity=la.a}_getLoadableTextureResource(la){return la.data??la.url}_getInternalTextureId(la){return this._getInternalTexture(la,
ia.AlphaDiscardMode.Opaque)?.id}_getInternalTexture(la,qa){const ua=this._getLoadableTextureResource(la);if(!ua)return null;const va=`${la.contentHash}/${qa}`;var Ga=this._textures.get(va);Ga||(Ga=null,Ga=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,la={wrap:this._castTextureWrap(la.wrap),noUnpackFlip:!0,maxAnisotropy:Ga,mipmap:1<Ga},L.isEncodedMeshTexture(ua)?(Ga=ua.data,la.preMultiplyAlpha=!1,la.encoding=ua.encoding):(Ga=ua,la.preMultiplyAlpha=qa!==ia.AlphaDiscardMode.Opaque,
la.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),Ga=new R.Texture(Ga,la),this._textures.set(va,Ga),Ga.load(this._context.stage.renderView.renderingContext),this._context.stage.add(Ga));return Ga}_castTextureWrap(la="repeat"){return"string"===typeof la?(la=this._castTextureWrapIndividual(la),{s:la,t:la}):{s:this._castTextureWrapIndividual(la.horizontal),t:this._castTextureWrapIndividual(la.vertical)}}_castTextureWrapIndividual(la){switch(la){case "clamp":return fa.TextureWrapMode.CLAMP_TO_EDGE;
case "mirror":return fa.TextureWrapMode.MIRRORED_REPEAT;default:return fa.TextureWrapMode.REPEAT}}_setInternalMaterialParameters(la,qa){null!=la.color&&this._setInternalColorValueParameters(la.color,qa);if(null!=la.colorTexture){const ua=this._getInternalTexture(la.colorTexture,qa.textureAlphaMode);ua?(qa.textureId=ua.id,qa.textureAlphaPremultiplied=!!ua.parameters.preMultiplyAlpha):qa.textureId=void 0}la.normalTexture&&(qa.normalTextureId=this._getInternalTextureId(la.normalTexture));la.emissiveColor&&
(qa.emissiveFactor=b.toUnitRGB(la.emissiveColor));la.emissiveTexture&&(qa.emissiveTextureId=this._getInternalTextureId(la.emissiveTexture));la.occlusionTexture&&(qa.occlusionTextureId=this._getInternalTextureId(la.occlusionTexture));la.metallicRoughnessTexture&&(qa.metallicRoughnessTextureId=this._getInternalTextureId(la.metallicRoughnessTexture));qa.colorTextureTransformMatrix=C.getTransformMatrix(la.colorTextureTransform);qa.normalTextureTransformMatrix=C.getTransformMatrix(la.normalTextureTransform);
qa.occlusionTextureTransformMatrix=C.getTransformMatrix(la.occlusionTextureTransform);qa.emissiveTextureTransformMatrix=C.getTransformMatrix(la.emissiveTextureTransform);qa.metallicRoughnessTextureTransformMatrix=C.getTransformMatrix(la.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(la){let qa=this.symbolLayer.material?.colorMixMode??null;if(this._drivenProperties.color)la.externalColor=n.ONES;else{const ua=this.symbolLayer.material?.color??null;ua?la.externalColor=b.toUnitRGBA(ua):
(qa=null,la.externalColor=n.ONES)}qa&&(la.colorMixMode=qa);la.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(la){la=la.vertexAttributes.color;if(null==la)return!1;for(let qa=3;qa<la.length;qa+=4)if(255!==la[qa])return!0;return!1}_getOrCreateMaterial(la,qa){var ua=qa.material?.color,va=qa.material?.colorTexture,Ga=qa.material?.alphaMode;const La="blend"===Ga;ua="opaque"!==Ga&&(this._hasTransparentVertexColors(la)||null!=ua&&1>ua.a||va?.transparent||La);la=this._materialProperties(la,
qa,ua);if(va=this._materialInfoCache.byUid(la.uid))return va.material;ua={uid:la.uid,material:null,isComponentTransparent:ua,alphaMode:qa.material?qa.material.alphaMode:"opaque"};va=ha.useSchematicPBR({normalTexture:la.normalTexture,metallicRoughnessTexture:la.metallicRoughnessTexture,metallicFactor:la.metallic,roughnessFactor:la.roughness,emissiveTexture:la.emissiveTexture,emissiveFactor:b.toUnitRGB(la.emissiveColor),occlusionTexture:la.occlusionTexture});Ga={usePBR:this._usePBR(),isSchematic:va,
hasVertexColors:la.hasVertexColors,hasSymbolColors:la.hasSymbolVertexColors,hasVertexTangents:la.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ia.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Ga.mrrFactors=va?[...ha.defaultSchematicMRRFactors]:[la.metallic,la.roughness,ha.defaultAdvancedMRRFactors[2]];qa.material&&(Ga.doubleSided=qa.material.doubleSided,
Ga.cullFace=qa.material.doubleSided?ia.CullFaceOptions.None:ia.CullFaceOptions.Back,Ga.textureAlphaCutoff=qa.material.alphaCutoff);this._setExternalMaterialParameters(Ga);this._setMaterialTransparentParameter(Ga,ua);this._setInternalMaterialParameters(la,Ga);qa=new X.DefaultMaterial(Ga);ua.material=qa;this._materialInfoCache.set(la.uid,ua);this._context.stage.add(qa);return qa}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(la,qa){la.transparent=this.needsDrivenTransparentPass||
qa.isComponentTransparent||1>la.layerOpacity||1>la.opacity||la.externalColor&&1>la.externalColor[3];la.textureAlphaMode="auto"===qa.alphaMode?la.transparent?ia.AlphaDiscardMode.MaskBlend:ia.AlphaDiscardMode.Opaque:"opaque"===qa.alphaMode?ia.AlphaDiscardMode.Opaque:"mask"===qa.alphaMode?ia.AlphaDiscardMode.Mask:ia.AlphaDiscardMode.Blend}_addDebugNormals(la,qa){var ua=qa.length,va=la.spatialReference.isGeographic?20015077/180:1;const Ga=.1*Math.max(la.extent.width*va,la.extent.height*va,la.extent.zmax-
la.extent.zmin);var La=[];const Na=[];la=[];va=[];for(let Ra=0;Ra<ua;Ra++){var Wa=qa[Ra],Ia=Wa.attributes.get(ba.VertexAttribute.POSITION),Oa=Wa.attributes.get(ba.VertexAttribute.NORMAL);Wa=Ia.data;Ia=Ia.indices;const bb=Oa.data;Oa=Oa.indices;for(let gb=0;gb<Ia.length;gb++){var Ua=3*Ia[gb];const db=3*Oa[gb];for(var Va=0;3>Va;Va++)La.push(Wa[Ua+Va]);for(Va=0;3>Va;Va++)La.push(Wa[Ua+Va]+bb[db+Va]*Ga);Na.push(Na.length);Na.push(Na.length);if(0===gb%3){this._calculateFaceNormal(Wa,Ia,gb,oa);this._getFaceVertices(Wa,
Ia,gb,W,Y,ja);g.add(W,W,Y);g.add(W,W,ja);g.scale(W,W,1/3);for(Ua=0;3>Ua;Ua++)la.push(W[Ua]);for(Ua=0;3>Ua;Ua++)la.push(W[Ua]+oa[Ua]*Ga);va.push(va.length);va.push(va.length)}}}ua=qa[0].transformation;La=new U.Geometry(this._debugVertexNormalMaterial,[[ba.VertexAttribute.POSITION,new T.Attribute(La,Na,3,!0)]],null,O.ContentObjectType.Line);qa.push(La);La.transformation=ua;la=new U.Geometry(this._debugFaceNormalMaterial,[[ba.VertexAttribute.POSITION,new T.Attribute(la,va,3,!0)]],null,O.ContentObjectType.Line);
la.transformation=ua;qa.push(la)}_createAs3DShape(la,qa,ua,va){la=la.geometry;if("mesh"!==la.type)return null;qa=this._createGeometryInfo(la,qa,va);if(null==qa)return null;const {geometries:Ga,objectTransformation:La}=qa;Q.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(la,Ga);va=new P.Object3D({geometries:Ga,layerUid:this._context.layer.uid,graphicUid:va});va.transformation=La;qa=(qa=N.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()}))?new I.Object3DEdgeState(Ga[0].material,
[qa],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;qa=new K.Graphics3DMeshObject3DGraphicLayer(this,va,Ga,null,null,z.perObjectElevationAligner,ua,qa);this._fastUpdateProcessor.onAddGraphic();qa.needsElevationUpdates=J.needsElevationUpdates3D(ua.mode);qa.useObjectOriginAsAttachmentOrigin=!0;ua.centerPointInElevationSR=this._getCenterPointInElevationSR(va.transformation);const {elevationProvider:Na,renderCoordsHelper:Wa}=this._context;qa.alignedSampledElevation=z.perObjectElevationAligner(qa,
ua,Na.spatialReference,(Ia,Oa)=>J.evaluateElevationInfoAtPoint(Ia,Na,ua,Wa,Oa),Wa);return qa}_getCenterPointInElevationSR(la){const qa=F.makeDehydratedPoint(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);w.projectVectorToPoint([la[12],la[13],la[14]],this._context.renderCoordsHelper.spatialReference,qa);return qa}_createComponentNormals(la,qa,ua,va){switch(ua.shading||"flat"){default:case "source":return this._createComponentNormalsSource(la,
qa,ua,va);case "flat":return this._createComponentNormalsFlat(la,va);case "smooth":return this._createComponentNormalsSmooth(la,va)}}_createComponentNormalsSource(la,qa,ua,va){if(null==qa)return this._createComponentNormalsFlat(la,va);let Ga=!1;if(!ua.trustSourceNormals)for(ua=0;ua<va.length;ua+=3){this._calculateFaceNormal(la,va,ua,oa);for(let La=0;3>La;La++){const Na=3*va[ua+La];W[0]=qa[Na];W[1]=qa[Na+1];W[2]=qa[Na+2];0>g.dot(oa,W)&&(qa[Na]=-qa[Na],qa[Na+1]=-qa[Na+1],qa[Na+2]=-qa[Na+2],Ga=!0)}}return new ea(qa,
va,Ga)}_createComponentNormalsFlat(la,qa){const ua=v.newFloatArray(qa.length),va=Array(3*qa.length);for(let Ga=0;Ga<qa.length;Ga+=3){const La=this._calculateFaceNormal(la,qa,Ga,oa);for(let Na=0;3>Na;Na++)ua[Ga+Na]=La[Na],va[Ga+Na]=Ga/3}return new ea(ua,va,!1)}_createComponentNormalsSmooth(la,qa){const ua={};for(var va=0;va<qa.length;va+=3){var Ga=this._calculateFaceNormal(la,qa,va,oa);for(var La=0;3>La;La++){var Na=qa[va+La];let Wa=ua[Na];Wa||(Wa={normal:e.create(),count:0},ua[Na]=Wa);g.add(Wa.normal,
Wa.normal,Ga);Wa.count++}}la=v.newFloatArray(3*qa.length);va=Array(3*qa.length);for(Ga=0;Ga<qa.length;Ga++){La=ua[qa[Ga]];1!==La.count&&(g.normalize(La.normal,La.normal),La.count=1);for(Na=0;3>Na;Na++)la[3*Ga+Na]=La.normal[Na];va[Ga]=Ga}return new ea(la,va,!1)}_getFaceVertices(la,qa,ua,va,Ga,La){const Na=3*qa[ua],Wa=3*qa[ua+1];qa=3*qa[ua+2];va[0]=la[Na];va[1]=la[Na+1];va[2]=la[Na+2];Ga[0]=la[Wa];Ga[1]=la[Wa+1];Ga[2]=la[Wa+2];La[0]=la[qa];La[1]=la[qa+1];La[2]=la[qa+2]}_calculateFaceNormal(la,qa,ua,
va){this._getFaceVertices(la,qa,ua,W,Y,ja);g.subtract(Y,Y,W);g.subtract(ja,ja,W);g.cross(W,Y,ja);g.normalize(va,W);return va}_getOrCreateComponents(la){return la.components??pa}_createPositionBuffer(la,qa){let ua=la.vertexAttributes.position;const va=qa.reprojection===Ba.ECEF?qa.transformBeforeProject:null;va&&(ua=E.transformMat4(new Float64Array(ua.length),ua,va));if(qa.reprojection===Ba.NONE)return qa.needsBufferCopy?new Float64Array(ua):ua;qa=va?ua:new Float64Array(ua.length);x.projectBuffer(ua,
la.spatialReference,0,qa,this._context.renderCoordsHelper.spatialReference,0,ua.length/3);return qa}_createNormalBuffer(la,qa,ua){let va=la.vertexAttributes.normal;if(null==va)return null;var Ga=ua.reprojection===Ba.ECEF?ua.transformBeforeProject:null;Ga&&(va=B.transformNormal(va,new Float32Array(va.length),Ga));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ua.reprojection===Ba.NONE)return ua.needsBufferCopy&&la.vertexAttributes.normal===va?new Float32Array(va):va;ua=la.vertexAttributes.position;
Ga=Ga?va:new Float32Array(va.length);return B.projectNormalToPCPF(va,ua,qa,la.spatialReference,Ga)}_createTangentBuffer(la,qa,ua){let va=la.vertexAttributes.tangent;if(null==va)return null;var Ga=ua.reprojection===Ba.ECEF?ua.transformBeforeProject:null;Ga&&(va=B.transformTangent(va,new Float32Array(va.length),Ga));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ua.reprojection===Ba.NONE)return ua.needsBufferCopy&&la.vertexAttributes.normal===va?new Float32Array(va):va;ua=la.vertexAttributes.position;
Ga=Ga?va:new Float32Array(va.length);return B.projectTangentToPCPF(va,ua,qa,la.spatialReference,Ga)}_createColorBuffer(la){return la.vertexAttributes.color}_createSymbolColorBuffer(la){if(this._requiresSymbolVertexColors()){la=this._getVertexOpacityAndColor(la);const qa=V.parseColorMixMode(this.symbolLayer?.material?.colorMixMode),ua=new Uint8Array(4);V.encodeSymbolColor(la,qa,ua);return ua}return null}_createBuffers(la,qa){var ua=la.vertexAttributes&&la.vertexAttributes.position;if(!ua)return this.logger.warn("Mesh geometry must contain position vertex attributes"),
null;var va=la.vertexAttributes.normal;const Ga=la.vertexAttributes.uv;var La=la.vertexAttributes.tangent;if(va&&va.length!==ua.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(La&&La.length/4!==ua.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Ga&&Ga.length/2!==ua.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;La=this._computeReprojectionInfo(la);ua=this._createPositionBuffer(la,La);va=this._createColorBuffer(la);qa=this._createSymbolColorBuffer(qa);const Na=this._createNormalBuffer(la,ua,La),Wa=this._createTangentBuffer(la,ua,La);la=La.reprojection===Ba.NONE&&La.objectTransformation?La.objectTransformation:this._transformOriginLocal(la,ua,Na,Wa);La=La.reprojection===Ba.NONE&&La.geometryTransformation?La.geometryTransformation:f.create();return{positionBuffer:ua,normalBuffer:Na,tangentBuffer:Wa,uvBuffer:Ga,
colorBuffer:va,symbolColorBuffer:qa,objectTransformation:la,geometryTransformation:La}}_computeReprojectionInfo(la){var {vertexSpace:qa}=la;const ua="georeferenced"===qa.type?this._context.renderCoordsHelper.viewingMode===H.ViewingMode.Local?Ba.NONE:Ba.ECEF:Ba.NONE;if(D.isRelativeVertexSpace(qa)){const va=qa.origin;qa=f.create();const Ga=la.transform?.localMatrix??f.IDENTITY;if(ua===Ba.NONE)return u.computeTranslationToOriginAndRotation(la.spatialReference,va,qa,this._context.renderCoordsHelper.spatialReference),
la=f.clone(Ga),{reprojection:ua,objectTransformation:qa,geometryTransformation:la,needsBufferCopy:!1};la=d.fromTranslation(f.create(),va);d.multiply(la,la,Ga);return{reprojection:ua,transformBeforeProject:la,needsBufferCopy:!0}}return{reprojection:ua,needsBufferCopy:!0}}_transformOriginLocal(la,qa,ua,va){const Ga=this._context.renderCoordsHelper.spatialReference;var La=la.anchor;ca[0]=La.x;ca[1]=La.y;ca[2]=La.z??0;La=f.create();u.computeTranslationToOriginAndRotation(la.spatialReference,ca,La,Ga);
d.invert(ra,La);E.transformMat4(qa,qa,ra);if(ua||va)k.fromMat4(ta,La),k.transpose(ta,ta),ua&&E.transformMat3(ua,ua,ta),va&&E.transformMat3(va,va,ta,4);return La}_validateFaces(la,qa){la=la.vertexAttributes.position.length/3;if(qa=qa.faces){let ua=-1;for(let va=0;va<qa.length;va++){const Ga=qa[va];Ga>ua&&(ua=Ga)}if(la<=ua)return this.logger.warn(`Vertex index ${ua} is out of bounds of the mesh position buffer`),!1}else if(0!==la%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0}_getOrCreateFaces(la,qa){return qa.faces??p.getContinuousIndexArray(la.vertexAttributes.position.length/3)}_isOutsideClippingArea(la){if(!this._context.clippingExtent)return!1;var qa=la.vertexAttributes?.position;if(!qa)return!1;la=A.project({positions:qa,transform:la.transform,vertexSpace:la.vertexSpace,inSpatialReference:la.spatialReference,outSpatialReference:this._context.elevationProvider.spatialReference??la.spatialReference,localMode:this._context.stage.viewingMode===H.ViewingMode.Local});
qa=la.length/3;q.empty(Ca);q.expandWithBuffer(Ca,la,0,qa);return!q.intersectsClippingArea(Ca,this._context.clippingExtent)}_createGeometryInfo(la,qa,ua){if(!l.canProjectWithoutEngine(la.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(la))return null;qa=this._createBuffers(la,qa);if(null==qa)return null;const {positionBuffer:va,uvBuffer:Ga,colorBuffer:La,
symbolColorBuffer:Na,normalBuffer:Wa,tangentBuffer:Ia,objectTransformation:Oa,geometryTransformation:Ua}=qa;var Va=this._getOrCreateComponents(la);qa=[];let Ra=!1;var bb=d.getTranslation(W,Oa);bb=this._context.localOriginFactory.getOrigin(bb);for(const db of Va){if(!this._validateFaces(la,db))return null;var gb=this._getOrCreateFaces(la,db);if(0===gb.length)continue;Va=this._createComponentNormals(va,Wa,db,gb);Va.didFlipNormals&&(Ra=!0);Va=[[ba.VertexAttribute.POSITION,new T.Attribute(va,gb,3,!0)],
[ba.VertexAttribute.NORMAL,new T.Attribute(Va.normals,Va.indices,3,!0)]];La&&Va.push([ba.VertexAttribute.COLOR,new T.Attribute(La,gb,4,!0)]);Na&&Va.push([ba.VertexAttribute.SYMBOLCOLOR,new T.Attribute(Na,p.getZeroIndexArray(gb.length),4,!0)]);Ga&&Va.push([ba.VertexAttribute.UV0,new T.Attribute(Ga,gb,2,!0)]);Ia&&Va.push([ba.VertexAttribute.TANGENT,new T.Attribute(Ia,gb,4,!0)]);gb=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ua,layerUid:this._context.layer.uid});const ka=this._getOrCreateMaterial(la,
db);Va=new U.Geometry(ka,Va,null,O.ContentObjectType.Mesh,gb);Va.transformation=Ua;Va.localOrigin=bb;qa.push(Va)}Ra&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:qa,objectTransformation:Oa}}_updateMaterialParameters(la){this._materialInfoCache.forEachMaterialInfo(la);this._fastUpdateProcessor.forEachMaterialInfo(la);this._fastUpdateProcessor.forEachClonedMaterial((qa,
ua)=>{ua.setParameters(qa.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class ea{constructor(la,qa,ua){this.normals=la;this.indices=qa;this.didFlipNormals=ua}}const ca=e.create(),W=e.create(),Y=e.create(),ja=e.create(),oa=e.create(),ra=f.create(),ta=m.create(),ya=f.create(),Ca=q.create(),pa=[new t],wa=new y;var Ba;(function(la){la[la.NONE=0]="NONE";la[la.ECEF=1]="ECEF"})(Ba||={});a.Graphics3DMeshFillSymbolLayer=Z;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){var l;b=l=class extends b.JSONSupport{static from(u){return f.ensureClass(l,
u)}constructor(u){super(u);this.material=this.faces=null;this.name=void 0;this.shading="source";this.trustSourceNormals=!1}castFaces(u){return n.castArray(u,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},c.getLogger(this))}castMaterial(u){return u&&"object"===typeof u&&("metallic"in u||"roughness"in u||"metallicRoughnessTexture"in u)?f.ensureClass(e,u):f.ensureClass(g,u)}clone(){return new l({faces:h.clone(this.faces),shading:this.shading,material:h.clone(this.material),trustSourceNormals:this.trustSourceNormals,
name:this.name})}cloneWithDeduplication(u,x){u={faces:h.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(u,x):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new l(u)}get memoryUsage(){let u=0;null!=this.faces&&(u+=this.faces.byteLength);null!=this.material&&(u+=this.material.memoryUsage);return u}};a.__decorate([k.property({json:{write:!0}})],b.prototype,"faces",void 0);a.__decorate([m.cast("faces")],b.prototype,"castFaces",
null);a.__decorate([k.property({type:g,json:{write:!0}})],b.prototype,"material",void 0);a.__decorate([m.cast("material")],b.prototype,"castMaterial",null);a.__decorate([k.property()],b.prototype,"name",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);a.__decorate([k.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=l=a.__decorate([d.subclass("esri.geometry.support.MeshComponent")],b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),
function(a,b,h,c,k,m,d,f,g,e){var n;h=n=class extends h.JSONSupport{constructor(l){super(l);this.colorTextureTransform=this.colorTexture=this.color=null;this.normalTextureTransform=this.normalTexture=void 0;this.alphaMode="auto";this.alphaCutoff=.5;this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,u){const x=null!=l?l.get(this):null;if(x)return x;u=new n(this.clonePropertiesWithDeduplication(u));null!=l&&l.set(this,u);return u}clonePropertiesWithDeduplication(l){return{color:null!=
this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(l),normalTexture:this.normalTexture?.cloneWithDeduplication(l),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let l;l=null!=this.color?16:0;null!=this.colorTexture&&(l+=this.colorTexture.memoryUsage);
l+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(l+=this.normalTexture.memoryUsage);return l+=null!=this.normalTextureTransform?20:0}};a.__decorate([c.property({type:b,json:{write:!0}})],h.prototype,"color",void 0);a.__decorate([c.property({type:g,json:{write:!0}})],h.prototype,"colorTexture",void 0);a.__decorate([c.property({type:e,json:{write:!0}})],h.prototype,"colorTextureTransform",void 0);a.__decorate([c.property({type:g,json:{write:!0}})],h.prototype,"normalTexture",void 0);
a.__decorate([c.property({type:e,json:{write:!0}})],h.prototype,"normalTextureTransform",void 0);a.__decorate([c.property({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0);a.__decorate([c.property({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0);a.__decorate([c.property({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0);return h=n=a.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],h)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){var l;const u=new WeakMap;let x=0;b=l=class extends c.JSONSupport{constructor(w){super(w);this.wrap="repeat"}get url(){return this._get("url")||null}set url(w){this._set("url",w);w&&this._set("data",null)}get data(){return this._get("data")||null}set data(w){this._set("data",w);w&&this._set("url",null)}writeData(w,q,v,p){w instanceof HTMLImageElement?(w={type:"image-element",src:n.toJSON(w.src,p),crossOrigin:w.crossOrigin},q[v]=w):w instanceof HTMLCanvasElement?(w=
w.getContext("2d").getImageData(0,0,w.width,w.height),w={type:"canvas-element",imageData:this._encodeImageData(w)},q[v]=w):w instanceof HTMLVideoElement?(w={type:"video-element",src:n.toJSON(w.src,p),autoplay:w.autoplay,loop:w.loop,muted:w.muted,crossOrigin:w.crossOrigin,preload:w.preload},q[v]=w):w instanceof ImageData&&(w={type:"image-data",imageData:this._encodeImageData(w)},q[v]=w)}readData(w){switch(w.type){case "image-element":var q=new Image;q.src=w.src;q.crossOrigin=w.crossOrigin;return q;
case "canvas-element":return w=this._decodeImageData(w.imageData),q=document.createElement("canvas"),q.width=w.width,q.height=w.height,q.getContext("2d").putImageData(w,0,0),q;case "image-data":return this._decodeImageData(w.imageData);case "video-element":return q=document.createElement("video"),q.src=w.src,q.crossOrigin=w.crossOrigin,q.autoplay=w.autoplay,q.loop=w.loop,q.muted=w.muted,q.preload=w.preload,q}}get transparent(){var w=this.data,q=this.url;return w instanceof HTMLCanvasElement?this._imageDataContainsTransparent(w.getContext("2d").getImageData(0,
0,w.width,w.height)):w instanceof ImageData?this._imageDataContainsTransparent(w):q&&(w=q.substr(q.length-4,4).toLowerCase(),q=q.substr(0,15).toLocaleLowerCase(),".png"===w||"data:image/png;"===q)?!0:!1}set transparent(w){this._overrideIfSome("transparent",w)}get contentHash(){const w="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",q=(v="")=>`d:${v},t:${this.transparent},w:${w}`;if(null!=this.url)return q(this.url);if(null!=this.data){if(this.data instanceof
HTMLImageElement||this.data instanceof HTMLVideoElement)return q(this.data.src);u.has(this.data)||u.set(this.data,++x);return q(u.get(this.data))}return q()}get memoryUsage(){let w;w=0+(null!=this.url?this.url.length:0);if(null!=this.data){const q=this.data;"data"in q?w+=q.data.byteLength:q instanceof HTMLImageElement?w+=q.naturalWidth*q.naturalHeight*3:q instanceof HTMLCanvasElement&&(w+=q.width*q.height*3)}return w}clone(){const w={url:this.url,data:this.data,wrap:this._cloneWrap()};return new l(w)}cloneWithDeduplication(w){var q=
w.get(this);if(q)return q;q=this.clone();w.set(this,q);return q}_cloneWrap(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(w){let q="";for(let v=0;v<w.data.length;v++)q+=String.fromCharCode(w.data[v]);return{data:btoa(q),width:w.width,height:w.height}}_decodeImageData(w){const q=atob(w.data),v=new Uint8ClampedArray(q.length);for(let p=0;p<q.length;p++)v[p]=q.charCodeAt(p);return h.wrapImageData(v,w.width,w.height)}_imageDataContainsTransparent(w){for(let q=
3;q<w.data.length;q+=4)if(255!==w.data[q])return!0;return!1}static from(w){return"string"===typeof w?new l({url:w}):w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof ImageData||w instanceof HTMLVideoElement?new l({data:w}):m.ensureClass(l,w)}};a.__decorate([k.property({type:String,json:{write:n.write}})],b.prototype,"url",null);a.__decorate([k.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),k.property()],b.prototype,"data",null);a.__decorate([e.writer("data")],
b.prototype,"writeData",null);a.__decorate([f.reader("data")],b.prototype,"readData",null);a.__decorate([k.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"wrap",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"contentHash",null);return b=l=a.__decorate([g.subclass("esri.geometry.support.MeshTexture")],b)})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),
function(a,b,h,c,k,m,d){function f(u,x,w){w||(n||(n=document.createElement("canvas"),n.width=1,n.height=1),w=n);return w.getContext("2d").createImageData(u,x)}async function g(u,x){u=window.URL.createObjectURL(u);try{const {data:w}=await h(u,{...x,responseType:"image"});return w}catch(w){if(!k.isAbortError(w))throw new c("invalid-image",`Could not fetch requested image at ${u}`);throw w;}finally{window.URL.revokeObjectURL(u)}}async function e(u,x){const w=m.dataComponents(u);if(w?.isBase64)return{arrayBuffer:d.base64ToArrayBuffer(w.data),
mediaType:w.mediaType};x=await h(u,{responseType:"array-buffer",...x});u=x.data;x=x.getHeader?.("Content-Type")??"";return{arrayBuffer:u,mediaType:x}}let n=null,l=!0;b.createEmptyImageData=function(u,x,w){if(!u||!x)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(u,x)}catch(q){l=!1}return f(u,x,w)};b.getImageData=async function(u,x){const {arrayBuffer:w,mediaType:q}=await e(u,x);u="image/png"===q;if("image/gif"===q){const {isAnimatedGIF:v,parseGif:p}=await new Promise((t,
r)=>a(["./image/gif"],t,r));if(v(w))return p(w,x)}if(u){const {isAnimatedPNG:v,parseApng:p}=await new Promise((t,r)=>a(["./image/apng"],t,r));if(v(w))return p(w,x)}u=new Blob([w],{type:q});return g(u,x)};b.wrapImageData=function(u,x,w,q){if(!x||!w)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(u,x,w)}catch(v){l=!1}x=f(x,w,q);x.data.set(u,0);return x};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){b=class extends b.ClonableMixin(h.JSONSupport){constructor(g){super(g);this.offset=[0,0];this.rotation=0;this.scale=[1,1]}};a.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"offset",void 0);a.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotation",void 0);a.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);return b=a.__decorate([f.subclass("esri.geometry.support.MeshTextureTransform")],
b)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,h,c,k,m,d,f,g,e){var n;c=n=class extends f{constructor(l){super(l);this.emissiveTexture=this.emissiveColor=null;this.emissiveTextureTransform=void 0;this.occlusionTexture=
null;this.occlusionTextureTransform=void 0;this.roughness=this.metallic=1;this.metallicRoughnessTexture=null;this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,u){const x=null!=l?l.get(this):null;if(x)return x;u=new n(this.clonePropertiesWithDeduplication(u));null!=l&&l.set(this,u);return u}getMemoryUsage(){let l=super.getMemoryUsage();l+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&(l+=this.emissiveTexture.memoryUsage);
l+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(l+=this.occlusionTexture.memoryUsage);l+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(l+=this.metallicRoughnessTexture.memoryUsage);return l+=null!=this.metallicRoughnessTextureTransform?20:0}clonePropertiesWithDeduplication(l){return{...super.clonePropertiesWithDeduplication(l),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(l),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),
occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(l),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(l),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};a.__decorate([h.property({type:b,json:{write:!0}})],c.prototype,"emissiveColor",void 0);a.__decorate([h.property({type:g,json:{write:!0}})],c.prototype,"emissiveTexture",
void 0);a.__decorate([h.property({type:e,json:{write:!0}})],c.prototype,"emissiveTextureTransform",void 0);a.__decorate([h.property({type:g,json:{write:!0}})],c.prototype,"occlusionTexture",void 0);a.__decorate([h.property({type:e,json:{write:!0}})],c.prototype,"occlusionTextureTransform",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],c.prototype,"metallic",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,
max:1}})],c.prototype,"roughness",void 0);a.__decorate([h.property({type:g,json:{write:!0}})],c.prototype,"metallicRoughnessTexture",void 0);a.__decorate([h.property({type:e,json:{write:!0}})],c.prototype,"metallicRoughnessTextureTransform",void 0);return c=n=a.__decorate([d.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],c)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){function g(u,x,w,q){const {loggerTag:v,stride:p}=x;return 0!==u.length%p?(q.error(v,`Invalid array length, expected a multiple of ${p}`),new w([])):u}function e(u,x,w,q,v){if(!u)return u;if(u instanceof x)return g(u,q,x,v);for(const p of w)if(u instanceof p)return g(new x(u),q,x,v);if(Array.isArray(u))return g(new x(u),q,x,v);w=w.map(p=>`'${p.name}'`);v.error(`Failed to set property, expected one of ${w}, but got ${u.constructor.name}`);return new x([])}function n(u,x,w){const q=
Array(u.length);for(let v=0;v<u.length;v++)q[v]=u[v];x[w]=q}var l;a.MeshVertexAttributes=l=class extends h.JSONSupport{constructor(u){super(u);this.color=null;this.position=new Float64Array(0);this.tangent=this.normal=this.uv=null}castColor(u){return e(u,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},k.getLogger(this))}castPosition(u){u&&u instanceof Float32Array&&k.getLogger(this).warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return e(u,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},k.getLogger(this))}castUv(u){return e(u,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},k.getLogger(this))}castNormal(u){return e(u,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},k.getLogger(this))}castTangent(u){return e(u,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},k.getLogger(this))}clone(){const u={position:c.clone(this.position),uv:c.clone(this.uv),normal:c.clone(this.normal),
tangent:c.clone(this.tangent),color:c.clone(this.color)};return new l(u)}clonePositional(){const u={position:c.clone(this.position),normal:c.clone(this.normal),tangent:c.clone(this.tangent),uv:this.uv,color:this.color};return new l(u)}get memoryUsage(){let u;u=0+this.position.byteLength;null!=this.uv&&(u+=this.uv.byteLength);null!=this.normal&&(u+=this.normal.byteLength);null!=this.tangent&&(u+=this.tangent.byteLength);null!=this.color&&(u+=this.color.byteLength);return u}};b.__decorate([m.property({json:{write:n}})],
a.MeshVertexAttributes.prototype,"color",void 0);b.__decorate([d.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([m.property({nonNullable:!0,json:{write:n}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([d.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([m.property({json:{write:n}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([d.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([m.property({json:{write:n}})],
a.MeshVertexAttributes.prototype,"normal",void 0);b.__decorate([d.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([m.property({json:{write:n}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([d.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=l=b.__decorate([f.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/georeference":function(){define("exports ../../../core/unitUtils ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../DoubleArray ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../meshVertexSpaceUtils ../../../chunks/vec3 ./geographicUtils ./projection".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(z,J,K){if(t.isGlobal(J.spatialReference,K?.geographic)){var I=J.spatialReference,M=F(J,K,H),S=new Float64Array(z.position.length);J=z.position;var N=I;var V=S;p.transformMat4(V,J,M);J=new Float64Array(J.length);N=r.projectFromPCPF(V,J,N);M=f.normalFromMat4(C,M);V=S;J=z.normal;K=M;var Q=I;if(null==J)V=null;else{var T=new Float32Array(J.length);p.transformMat3(T,J,K);r.projectNormalFromPCPF(T,N,V,Q,T);V=T}z=z.tangent;if(null==z)z=null;else{J=
new Float32Array(z.length);p.transformMat3(J,z,M,4);for(M=3;M<J.length;M+=4)J[M]=z[M];r.projectTangentFromPCPF(J,N,S,I,J);z=J}z={position:N,normal:V,tangent:z}}else{I=new Float64Array(z.position.length);N=z.position;S=J.x;M=J.y;V=J.z??0;J=G(K?K.unit:null,J.spatialReference);for(K=0;K<N.length;K+=3)I[K]=N[K]*J+S,I[K+1]=N[K+1]*J+M,I[K+2]=N[K+2]*J+V;z={position:I,normal:z.normal,tangent:z.tangent}}return z}function D(z,J=k.IDENTITY){const {position:K,normal:I,tangent:M}=z;z=p.transformMat4(new Float64Array(K.length),
K,J);const S=null!=I?r.transformNormal(I,new Float32Array(I.length),J):null;J=null!=M?r.transformTangent(M,new Float32Array(M.length),J):null;return{position:z,normal:S,tangent:J}}function E(z,J,K,I){const {position:M,normal:S,tangent:N}=z;if(!v.isRelativeVertexSpace(J))return{position:M,normal:S,tangent:N};I=v.vertexSpaceOriginToPoint(J,I);z=D(z,K?.localMatrix);return y(z,I,{geographic:"local"===J.type})}function A(z,J,K){if(t.isGlobal(J.spatialReference,K?.geographic)){const N=J.spatialReference;
F(J,K,H);var I=c.invert(L,H);J=new Float64Array(z.position.length);K=I;var M=r.projectToPCPF(z.position,N,J),S=new Float64Array(M.length);p.transformMat4(S,M,K);K=S;I=f.normalFromMat4(C,I);S=z.normal;M=I;null==S?M=null:(S=r.projectNormalToPCPF(S,z.position,J,N,new Float32Array(S.length)),p.transformMat3(S,S,M),M=S);S=z.tangent;null==S?z=null:(z=r.projectTangentToPCPF(S,z.position,J,N,new Float32Array(S.length)),p.transformMat3(z,z,I,4));z={position:K,normal:M,tangent:z}}else z=B(z,J,K);return z}function B(z,
J,K){const I=new Float64Array(z.position.length),M=z.position,S=J.x,N=J.y,V=J.z??0;J=G(K?K.unit:null,J.spatialReference);for(K=0;K<M.length;K+=3)I[K]=(M[K]-S)/J,I[K+1]=(M[K+1]-N)/J,I[K+2]=(M[K+2]-V)/J;return{position:I,normal:z.normal,tangent:z.tangent}}function F(z,J,K){n.computeTranslationToOriginAndRotation(z.spatialReference,[z.x,z.y,z.z??0],K,e.getSphericalPCPF(z.spatialReference));z=G(J?J.unit:null,z.spatialReference);c.scale(K,K,[z,z,z]);return K}function G(z,J){if(null==z)return 1;J=b.getMetersPerCartesianUnitForSR(J);
return 1/b.convertUnit(J,"meters",z)}const H=k.create(),L=k.create(),C=h.create();a.applyTransform=D;a.georeference=y;a.georeferenceApplyTransform=E;a.georeferenceByTransform=function(z,J,K){if(K?.useTransform){const {position:I,normal:M,tangent:S}=z,{x:N,y:V,z:Q}=J;z=d.fromValues(N,V,Q??0);return{vertexAttributes:{position:I,normal:M,tangent:S},vertexSpace:K.geographic??!0?new w({origin:z}):new x({origin:z}),transform:new q}}return{vertexAttributes:y(z,J,K),vertexSpace:new x,transform:null}};a.project=
function({positions:z,transform:J,vertexSpace:K,inSpatialReference:I,outSpatialReference:M,outPositions:S,localMode:N}){const V=K.origin??d.ZEROS;J=null!=K.origin?J?.localMatrix??k.IDENTITY:k.IDENTITY;if("georeferenced"===K.type){S=S??u.newDoubleArray(z.length);c.equals(J,k.IDENTITY)?u.copyInto(S,z):p.transformMat4(S,z,J);if(!m.exactEquals(V,d.ZEROS)){const [T,ia,O]=V;for(z=0;z<S.length;z+=3)S[z]+=T,S[z+1]+=ia,S[z+2]+=O}l.projectBuffer(S,I,0,S,M,0,S.length/3);return S}K=I;const Q=e.getSphericalPCPF(I);
K=M.isWebMercator&&N||!g.canProjectWithoutEngine(I,Q)?K:Q;n.computeTranslationToOriginAndRotation(I,V,H,K);c.multiply(H,H,J);I=S??u.newDoubleArray(z.length);p.transformMat4(I,z,H);l.projectBuffer(I,K,0,I,M,0,I.length/3);return I};a.ungeoreference=A;a.ungeoreferenceByTransform=function(z,J,K,I,M){if(!v.isRelativeVertexSpace(J))return A(z,I,M);const {spatialReference:S}=I;z=E(z,J,K,S);return I.equals(v.vertexSpaceOriginToPoint(J,S))?B(z,I,M):A(z,I,M)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/MeshLocalVertexSpace":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/factories/vec3f64".split(" "),function(a,b,h,c,k,m,d,f,g,e){b=class extends b.ClonableMixin(h.JSONSupport){constructor(n){super(n);this.type="local";
this.origin=e.create()}};a.__decorate([f.enumeration({local:"local"},{readOnly:!0})],b.prototype,"type",void 0);a.__decorate([c.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"origin",void 0);return b=a.__decorate([g.subclass("esri.geometry.support.MeshLocalVertexSpace")],b)})},"esri/geometry/support/MeshTransform":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/factories/mat4f64 ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./axisAngleDegrees".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){var w;b=w=class extends b.JSONSupport{constructor(v){super(v);this.translation=u.create();this.rotationAxis=u.fromArray(x.up);this.rotationAngle=0;this.scale=u.fromValues(1,1,1)}get rotation(){return x.fromAxisAndAngle(this.rotationAxis,this.rotationAngle)}set rotation(v){this.rotationAxis=u.clone(x.axis(v));this.rotationAngle=x.angle(v)}get localMatrix(){const v=g.create();e.setAxisAngle(q,x.axis(this.rotation),x.angleRad(this.rotation));f.fromRotationTranslationScale(v,
q,this.translation,this.scale);return v}get localMatrixInverse(){return f.invert(g.create(),this.localMatrix)}applyLocal(v,p){return l.transformMat4(p,v,this.localMatrix)}applyLocalInverse(v,p){return l.transformMat4(p,v,this.localMatrixInverse)}equals(v){return this===v||null!=v&&f.exactEquals(this.localMatrix,v.localMatrix)}clone(){const v={translation:u.clone(this.translation),rotationAxis:u.clone(this.rotationAxis),rotationAngle:this.rotationAngle,scale:u.clone(this.scale)};return new w(v)}};
a.__decorate([h.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"translation",void 0);a.__decorate([h.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAxis",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAngle",void 0);a.__decorate([h.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);a.__decorate([h.property()],b.prototype,"rotation",null);a.__decorate([h.property()],
b.prototype,"localMatrix",null);a.__decorate([h.property()],b.prototype,"localMatrixInverse",null);b=w=a.__decorate([d.subclass("esri.geometry.support.MeshTransform")],b);const q=n.create();return b})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/Logger"],function(a,b){a.isGlobal=function(h,c){return h.isGeographic||h.isWebMercator&&(c??!0)};a.validateGeographicFlag=function(h,c,k){const m="local"===h.type;null!=k?.geographic&&k.geographic!==m&&b.getLogger(c).warnOnce(`Specifying the 'geographic' parameter (${k.geographic}) for a Mesh vertex space of type "${h.type}" is not supported. This parameter will be ignored.`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec3".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(A,B,F,G,H,L){if(B){var C=F.count,z=f.getSphericalPCPF(H);if(v(H))for(F=0;F<C;F++)G.getVec(F,r),B.getVec(F,y),g.computeTranslationToOriginAndRotation(z,r,D,z),h.fromMat4(E,D),A===t.FROM_PCPF&&h.transpose(E,E),m.transformMat3(y,y,E),L.setVec(F,y);else for(H=0;H<C;H++){G.getVec(H,r);B.getVec(H,y);g.computeTranslationToOriginAndRotation(z,r,D,z);h.fromMat4(E,D);var J=l.y2lat(F.get(H,1));J=Math.cos(J);A===t.TO_PCPF&&(J=1/J);E[0]*=J;E[1]*=J;E[2]*=J;E[3]*=
J;E[4]*=J;E[5]*=J;A===t.FROM_PCPF&&h.transpose(E,E);m.transformMat3(y,y,E);m.normalize(y,y);L.setVec(H,y)}return L}}function q(A){return v(A)||A.isWebMercator}function v(A){return A.isWGS84||n.isCGCS2000(A)||n.isMars(A)||n.isMoon(A)}const p=()=>b.getLogger("esri.geometry.support.meshUtils.normalProjection");var t;(function(A){A[A.TO_PCPF=0]="TO_PCPF";A[A.FROM_PCPF=1]="FROM_PCPF"})(t||={});const r=d.create(),y=d.create(),D=k.create(),E=c.create();a.projectFromPCPF=function(A,B,F){e.projectBuffer(A,
f.getSphericalPCPF(F),0,B,F,0,A.length/3);return B};a.projectNormalFromPCPF=function(A,B,F,G,H){if(!q(G))return p().error("Cannot convert to spatial reference from PCPF"),H;w(t.FROM_PCPF,u.BufferViewVec3f.fromTypedArray(A),u.BufferViewVec3f64.fromTypedArray(B),u.BufferViewVec3f64.fromTypedArray(F),G,u.BufferViewVec3f.fromTypedArray(H));return H};a.projectNormalToPCPF=function(A,B,F,G,H){if(!q(G))return p().error("Cannot convert spatial reference to PCPF"),H;w(t.TO_PCPF,u.BufferViewVec3f.fromTypedArray(A),
u.BufferViewVec3f64.fromTypedArray(B),u.BufferViewVec3f64.fromTypedArray(F),G,u.BufferViewVec3f.fromTypedArray(H));return H};a.projectTangentFromPCPF=function(A,B,F,G,H){if(!q(G))return p().error("Cannot convert to spatial reference from PCPF"),H;w(t.FROM_PCPF,u.BufferViewVec3f.fromTypedArray(A,16),u.BufferViewVec3f64.fromTypedArray(B),u.BufferViewVec3f64.fromTypedArray(F),G,u.BufferViewVec3f.fromTypedArray(H,16));for(B=3;B<A.length;B+=4)H[B]=A[B];return H};a.projectTangentToPCPF=function(A,B,F,G,
H){if(!q(G))return p().error("Cannot convert spatial reference to PCPF"),H;w(t.TO_PCPF,u.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT),u.BufferViewVec3f64.fromTypedArray(B),u.BufferViewVec3f64.fromTypedArray(F),G,u.BufferViewVec3f.fromTypedArray(H,4*Float32Array.BYTES_PER_ELEMENT));for(B=3;B<A.length;B+=4)H[B]=A[B];return H};a.projectToPCPF=function(A,B,F){e.projectBuffer(A,B,0,F,f.getSphericalPCPF(B),0,A.length/3);return F};a.transformNormal=function(A,B,F){h.normalFromMat4(E,
F);x.transformMat3(B,A,E);h.isOrthoNormal(E)||x.normalize(B,B);return B};a.transformTangent=function(A,B,F){h.normalFromMat4(E,F);x.transformMat3(B,A,E,4);h.isOrthoNormal(E)||x.normalize(B,B,4);if(A!==B)for(F=3;F<A.length;F+=4)B[F]=A[F];return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],function(a){a.MeshTransformUpdateAction=void 0;var b=a.MeshTransformUpdateAction||(a.MeshTransformUpdateAction={});b[b.EnableFastUpdates=
0]="EnableFastUpdates";b[b.DisableFastUpdates=1]="DisableFastUpdates";b[b.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/basicInterfaces"],function(a,b,h){class c{constructor(k){this.data=k;this.type="encoded-mesh-texture";this.encoding=h.TextureEncodingMimeType.KTX2_ENCODING}}a.EncodedMeshTexture=c;a.imageFromBinaryData=
async function(k,m){if(m===h.TextureEncodingMimeType.KTX2_ENCODING)return new c(k);k=new Blob([k],{type:m});const d=URL.createObjectURL(k),f=new Image;if(b("esri-iPhone"))return new Promise((g,e)=>{const n=()=>{u();g(f)},l=x=>{u();e(x)},u=()=>{URL.revokeObjectURL(d);f.removeEventListener("load",n);f.removeEventListener("error",l)};f.addEventListener("load",n);f.addEventListener("error",l);f.src=d});try{f.src=d,await f.decode()}catch(g){console.warn("Failed decoding HTMLImageElement")}URL.revokeObjectURL(d);
return f};a.isEncodedMeshTexture=function(k){return"encoded-mesh-texture"===k?.type};a.jsonFromBinaryData=async function(k){k=await (new Blob([k])).text();return JSON.parse(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../core/libs/gl-matrix-2/math/mat3"],function(a,b,h,c){a.getTransformMatrix=
function(k){if(null==k)return null;var m=null!=k.offset?k.offset:h.ZEROS,d=null!=k.rotation?k.rotation:0;k=null!=k.scale?k.scale:h.ONES;m=b.fromValues(1,0,0,0,1,0,m[0],m[1],1);d=b.fromValues(Math.cos(d),-Math.sin(d),0,Math.sin(d),Math.cos(d),0,0,0,1);k=b.fromValues(k[0],0,0,0,k[1],0,0,0,1);const f=b.create();c.multiply(f,d,k);c.multiply(f,m,f);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends g.Graphics3DObject3DGraphicLayer{constructor(){super(...arguments);this._originalGeometries=[];this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(t,r){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:y}=this,D=y.geometries.slice();y.removeAllGeometries();var E=b.getTranslation(n,y.transformation);r=r.getOrigin(E);for(const A of D)E=
t(A.material),E=A.instantiate({material:E}),E.localOrigin=r,y.addGeometry(E);this._originalGeometries=D}}disableFastTransformUpdates(t){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:r}=this,y=r.geometries.map(D=>t(D.material));r.removeAllGeometries();for(let D=0;D<this._originalGeometries.length;D++){const E=this._originalGeometries[D],A=y[D];A.setParameters({modelTransformation:null});A===E.material?r.addGeometry(E):r.addGeometry(E.instantiate({material:A}))}this._originalGeometries.length=
0}}updateFastLocalOrigin(t,r,y){if(this._fastTransformUpdatesEnabled){var {stageObject:D}=this;if(0!==D.geometries.length){var E=D.geometries[0].localOrigin,A=b.getTranslation(n,t),B=y.getOrigin(A);if(B!==E){var F=r?.localMatrix??h.IDENTITY;D.shaderTransformation=null;D.transformation=t;D.geometries.forEach(G=>{G.transformation=F;G.localOrigin=B})}}}}updateTransform(t,r,y){const {stageObject:D}=this,E=r?.localMatrix??h.IDENTITY;if(this._fastTransformUpdatesEnabled){var A=D.geometries[0].transformation;
r=b.multiply(l,D.transformation,A);t=b.multiply(u,t,E);A=b.multiply(w,t,b.invert(w,A));D.shaderTransformation=A;this._setFastMaterialTransformation({matA:r,matB:t})}else D.shaderTransformation=null,D.transformation=t,D.geometries.forEach(B=>{B.transformation=E});this._fastUpdateEdgeTransform()||this.resetEdgeObject(y)}alignWithElevation(t,r,y,D){if(this._fastTransformUpdatesEnabled){null!=y&&f.setContextFeature(this.elevationContext.featureExpressionInfoContext,y);var {stageObject:E}=this;if(E.geometries[0].material.parameters.modelTransformation){y=
b.multiply(l,E.transformation,E.geometries[0].transformation);var A=b.copy(x,E.effectiveTransformation);this.alignedSampledElevation=m.perObjectElevationAligner(this,this.elevationContext,t.spatialReference,(B,F)=>d.evaluateElevationInfoAtPoint(B,t,this.elevationContext,r,F),r,A);E.shaderTransformation=A;E=b.multiply(u,A,E.geometries[0].transformation);this._setFastMaterialTransformation({matA:y,matB:E});this._fastUpdateEdgeTransform()||this.resetEdgeObject(D)}}else super.alignWithElevation(t,r,y,
D)}_setFastMaterialTransformation({matA:t,matB:r}){const {stageObject:y}=this;if(0!==y.geometries.length){var D=b.fromTranslation(p,c.scale(n,y.geometries[0].localOrigin.vec3,-1));t=b.multiply(q,D,t);r=b.multiply(v,D,r);D=b.invert(q,t);r=b.multiply(v,r,D);for(const E of y.geometries)E.material.setParameters({modelTransformation:r})}}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}}const n=k.create(),l=h.create(),
u=h.create(),x=h.create(),w=h.create(),q=h.create(),v=h.create(),p=h.create();a.Graphics3DMeshObject3DGraphicLayer=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/MeshFastUpdateProcessor":function(){define(["exports","../../webgl-engine/materials/DefaultMaterial"],function(a,b){class h{constructor(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}enable(k,m,d){k.enableFastTransformUpdates(f=>
{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(f))return f;var g=m.byMaterial(f);this._fastTransformOriginalMaterials.set(f,g);m.delete(f);return f}g=new b.DefaultMaterial(f.parameters);d.stage.add(g);this._fastTransformClonedMaterials.set(g,f);return g},d.localOriginFactory)}disable(k,m,d){const f=new Set,g=new Set;k.disableFastTransformUpdates(e=>{if(!this._fastTransformClonedMaterials.has(e)){var n=this._fastTransformOriginalMaterials.get(e);if(m.has(n.uid))return f.add(e),
m.byUid(n.uid).material;g.add(e);return n.material}n=this._fastTransformClonedMaterials.get(e);this._fastTransformClonedMaterials.delete(e);d.stage.remove(e);return n});for(const e of f)this._fastTransformOriginalMaterials.delete(e),d.stage.remove(e);for(const e of g)k=this._fastTransformOriginalMaterials.get(e),this._fastTransformOriginalMaterials.delete(e),m.set(k.uid,k)}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(k,m,d){this._graphicReferenceCount--;this.disable(k,m,d)}forEachMaterialInfo(k){this._fastTransformOriginalMaterials.forEach(k)}forEachClonedMaterial(k){this._fastTransformClonedMaterials.forEach(k)}destroy(k){k.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));
k.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:m})=>m));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()}}class c{constructor(){this._byUid=new Map;this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),k=>k.material)}byUid(k){return this._byUid.get(k)}byMaterial(k){return this._byMaterial.get(k)}set(k,m){this._byUid.set(k,m);this._byMaterial.set(m.material,m)}delete(k){const m=this._byMaterial.get(k)?.uid;
m&&(this._byUid.delete(m),this._byMaterial.delete(k))}has(k){return this._byUid.has(k)}forEachMaterialInfo(k){this._byUid.forEach(k)}clear(){this._byUid.clear();this._byMaterial.clear()}}a.MaterialInfoCache=c;a.MeshFastUpdateProcessor=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){class D extends x.Material{constructor(O){super(O,new A);this._configuration=new y.NativeLineTechniqueConfiguration;this.produces=new Map([[w.RenderSlot.OPAQUE_MATERIAL,U=>U===l.ShaderOutput.Color||U===l.ShaderOutput.Highlight||U===l.ShaderOutput.ObjectAndLayerIdColor]])}getConfiguration(O){this._configuration.output=O;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.hasOccludees=this.parameters.hasOccludees;return this._configuration}intersect(O,U,P,R,ba,X){if(P.options.selectionMode&&O.visible)if(q.isTranslationMatrix(U)){ba=O.attributes.get(v.VertexAttribute.POSITION).data;var da=P.camera,ha=M;k.copy(ha,P.point);m.set(S[0],ha[0]-2,ha[1]+2,0);m.set(S[1],ha[0]+2,ha[1]+2,0);m.set(S[2],ha[0]+2,ha[1]-2,0);m.set(S[3],ha[0]-2,ha[1]-2,0);for(O=0;4>O;O++)if(!da.unprojectFromRenderScreen(S[O],
N[O]))return;n.fromPoints(da.eye,N[0],N[1],V);n.fromPoints(da.eye,N[1],N[2],Q);n.fromPoints(da.eye,N[2],N[3],T);n.fromPoints(da.eye,N[3],N[0],ia);R=Number.MAX_VALUE;O=0;for(let aa=0;aa<ba.length-5;aa+=3)if(B[0]=ba[aa]+U[12],B[1]=ba[aa+1]+U[13],B[2]=ba[aa+2]+U[14],F[0]=ba[aa+3]+U[12],F[1]=ba[aa+4]+U[13],F[2]=ba[aa+5]+U[14],!(0>n.signedDistance(V,B)&&0>n.signedDistance(V,F)||0>n.signedDistance(Q,B)&&0>n.signedDistance(Q,F)||0>n.signedDistance(T,B)&&0>n.signedDistance(T,F)||0>n.signedDistance(ia,B)&&
0>n.signedDistance(ia,F))){da.projectToRenderScreen(B,L);da.projectToRenderScreen(F,C);if(0>L[2]&&0<C[2]){m.subtract(G,B,F);var fa=da.frustum;fa=-n.signedDistance(fa[g.PlaneIndex.NEAR],B)/m.dot(G,n.getNormal(fa[g.PlaneIndex.NEAR]));m.scale(G,G,fa);m.add(B,B,G);da.projectToRenderScreen(B,L)}else if(0<L[2]&&0>C[2])m.subtract(G,F,B),fa=da.frustum,fa=-n.signedDistance(fa[g.PlaneIndex.NEAR],F)/m.dot(G,n.getNormal(fa[g.PlaneIndex.NEAR])),m.scale(G,G,fa),m.add(F,F,G),da.projectToRenderScreen(F,C);else if(0>
L[2]&&0>C[2])continue;L[2]=0;C[2]=0;fa=e.distance2(e.fromPoints(L,C,K),ha);fa<R&&(R=fa,m.copy(z,B),m.copy(J,F),O=aa/3)}U=P.rayBegin;P=P.rayEnd;4>R&&(R=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(z,J,K),e.fromPoints(U,P,I),H)&&(m.subtract(H,H,U),R=m.length(H),m.scale(H,H,1/R),R/=m.distance(U,P)),X(R,H,O,!1))}else b.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}intersectDraped(O,U,P,R,ba,X){if(P.options.selectionMode){U=
O.attributes.get(v.VertexAttribute.POSITION).data;var da=O.attributes.get(v.VertexAttribute.SIZE);P=R[0];R=R[1];O=(((da?da.data[0]:0)+1)/2+4)*O.screenToWorldRatio;da=Number.MAX_VALUE;var ha=0;for(let ca=0;ca<U.length-5;ca+=3){var fa=U[ca],aa=U[ca+1],Z=P-fa,ea=R-aa;fa=U[ca+3]-fa;aa=U[ca+4]-aa;const W=h.clamp((fa*Z+aa*ea)/(fa*fa+aa*aa),0,1);Z=fa*W-Z;ea=aa*W-ea;ea=Z*Z+ea*ea;ea<da&&(da=ea,ha=ca/3)}da<O*O&&ba(X.dist,X.normal,ha,!1)}}createGLMaterial(O){return new E(O)}createBufferWriter(){return new p.DefaultBufferWriter(this.parameters.hasVertexColors?
t.PositionColorLayout:t.PositionLayout)}}class E extends u{_updateOccludeeState(O){O.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:O.hasOccludees})}beginSlot(O){this._output===l.ShaderOutput.Color&&this._updateOccludeeState(O);return this.ensureTechnique(r.NativeLineTechnique,O)}}class A extends x.MaterialParameters{constructor(){super(...arguments);this.color=f.ONES;this.hasSlicePlane=this.hasVertexColors=!1;this.width=1;this.hasOccludees=!1}}const B=
d.create(),F=d.create(),G=d.create(),H=d.create(),L=c.createRenderScreenPointArray3(),C=c.createRenderScreenPointArray3(),z=d.create(),J=d.create(),K=e.create(),I=e.create(),M=d.create(),S=[c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3(),c.createRenderScreenPointArray3()],N=[d.create(),d.create(),d.create(),d.create()],V=n.create(),Q=n.create(),T=n.create(),ia=n.create();a.NativeLineMaterial=D;a.Parameters=A;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(a,b,h){const c=b.newLayout().vec3f(h.VertexAttribute.POSITION),k=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec2f(h.VertexAttribute.UV0),m=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec4u8(h.VertexAttribute.COLOR),d=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec4u8(h.VertexAttribute.OBJECTANDLAYERIDCOLOR),
f=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec2f(h.VertexAttribute.UV0).vec4u8(h.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec4u8(h.VertexAttribute.COLOR).vec4u8(h.VertexAttribute.OBJECTANDLAYERIDCOLOR);a.PositionColorLayout=m;a.PositionColorLayoutObjectAndLayerId=b;a.PositionLayout=c;a.PositionLayoutObjectAndLayerId=d;a.PositionUVLayout=k;a.PositionUVLayoutObjectAndLayerId=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends k.ShaderTechnique{initializeProgram(u){return new d.Program(u.rctx,l.shader.get().build(this.configuration),m.Default3D)}initializePipeline(){const u=this.configuration,x=n.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),w=(q,v=null,p=null)=>n.makePipelineState({blending:v,depthTest:f.depthCompareLess,depthWrite:p,colorWrite:n.defaultColorWriteParams,stencilWrite:u.hasOccludees?
f.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?q?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null});return u.output===h.ShaderOutput.Color?(this._occludeePipelineState=w(!0,u.transparent?x:null,n.defaultDepthWriteParams),w(!1,u.transparent?x:null,n.defaultDepthWriteParams)):w(!1)}get primitiveType(){return e.PrimitiveType.LINES}getPipeline(u){return u?this._occludeePipelineState:super.getPipeline()}}l.shader=new c.ReloadableShaderModule(g.NativeLine,()=>new Promise((u,x)=>a(["./NativeLine.glsl"],
u,x)));b.NativeLineTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(q){const v=new l.ShaderBuilder,{vertex:p,fragment:t}=v;v.include(c.Transform,q);v.include(k.VertexColor,q);f.addProjViewLocalOrigin(p,q);v.attributes.add(u.VertexAttribute.POSITION,"vec3");v.varyings.add("vpos","vec3");p.code.add(n.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`);q.output===b.ShaderOutput.Highlight&&v.include(m.OutputHighlight,q);v.include(h.SliceDraw,q);t.uniforms.add(new e.FloatPassUniform("alphaCoverage",(r,y)=>Math.min(1,r.width*y.camera.pixelRatio)));q.hasVertexColors||t.uniforms.add(new g.Float4PassUniform("constantColor",r=>r.color));t.code.add(n.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${q.hasVertexColors?"vColor":"constantColor"};

    ${q.output===b.ShaderOutput.ObjectAndLayerIdColor?n.glsl`color.a = 1.0;`:""}

    if (color.a < ${n.glsl.float(d.symbolAlphaCutoff)}) {
      discard;
    }

    ${q.output===b.ShaderOutput.Color?n.glsl`fragColor = highlightSlice(color, vpos);`:""}
    ${q.output===b.ShaderOutput.Highlight?n.glsl`outputHighlight();`:""}
  }
  `);return v}const w=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.NativeLine=w;a.build=x})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,h,c,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=h.ShaderOutput.Color;this.hasOccludees=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([c.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],m.prototype,"hasVertexColors",void 0);b.__decorate([c.parameter()],m.prototype,"transparent",void 0);b.__decorate([c.parameter()],m.prototype,"hasOccludees",void 0);a.NativeLineTechniqueConfiguration=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./defaultSymbolComplexity ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./SymbolComplexity ./webStyleUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N){class V{constructor(R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y){this.lodResources=R;this.lodRenderer=ba;this.stageResources=X;this.originalMaterialParameters=da;this.resourceSize=ha;this.isEsriSymbolResource=fa;this.isWosr=aa;this.resourceBoundingBox=Z;this.symbolSize=ea;this.extentPadding=ca;this.physicalBasedRenderingEnabled=W;this.pivotOffset=Y}}class Q extends y.Graphics3DSymbolLayer{getCachedSize(){const [R,ba,X]=null!=this._resources?
this._resources.symbolSize:[1,1,1];return{width:R,depth:ba,height:X}}constructor(R,ba,X,da){super(R,ba,X,da);this._resources=null;this._optionalFields=[];this._instanceIndexToGraphicUid=new Map;this._hasLoadedPBRTextures=!1;this._disposeResourceHandles=[];this.skipHighSymbolLodsChanged=!1;this.ensureDrapedStatus(!1);this._hasLoadedPBRTextures=X.physicalBasedRenderingEnabled}async doLoad(R){if(!this._drivenProperties.size&&D.validateSymbolLayerSize(this.symbolLayer))throw Error();if(this._isPrimitive){var ba=
this.symbolLayer.resource;ba=ba&&H.isValidPrimitive(ba.primitive)?ba.primitive:w.defaultPrimitive;this._resources=await this._createResourcesForPrimitive(ba,R)}else ba=(await C.getResourceUrlFromSymbolStyle(this.symbol.styleOrigin))?.href??this.symbolLayer.resource.href,this._resources=await this._createResourcesForUrl(ba,R);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?
this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(R,ba=this.symbolLayer?.material?.color){ba=this._getCombinedOpacity(ba);const X=1>ba||this.needsDrivenTransparentPass;R.transparent=X;R.opacity=ba;R.cullFace=X?J.CullFaceOptions.None:J.CullFaceOptions.Back;return R}async _createResourcesForPrimitive(R,ba){var X=
this.symbolLayer;const da=x.create(q.objectSymbolLayerPrimitiveBoundingBox(R)),ha=e.fromArray(x.size(da)),fa=e.fromArray(q.objectSymbolLayerSizeWithResourceSize(ha,X)),aa=g.length(fa);var Z={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...N.defaultSchematicMRRFactors],ambient:e.ONES,diffuse:e.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ea=
!!Z.usePBR;this._setMaterialTransparencyParameters(Z);const ca=this.symbol;if("point-3d"===ca.type&&ca.verticalOffset){const {screenLength:W,minWorldLength:Y,maxWorldLength:ja}=ca.verticalOffset;Z.verticalOffset={screenLength:k.pt2px(W),minWorldLength:Y||0,maxWorldLength:null!=ja?ja:Infinity};Z.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(Z.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?Z.externalColor=n.ONES:(X=null!=
X.material?X.material.color:null,X=null!=X?b.toUnitRGBA(X):n.ONES,Z.externalColor=X);this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(da,fa,ha,null));Z.isInstanced=!0;this._fastUpdates?(Object.assign(Z,this._fastUpdates.materialParameters),this._optionalFields.push(K.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(Z.hasInstancedColor=!0,this._optionalFields.push(K.VertexAttribute.COLOR));h("enable-feature:objectAndLayerId-rendering")&&
this._optionalFields.push(K.VertexAttribute.OBJECTANDLAYERIDCOLOR);Z=new S.DefaultMaterial(Z);Z=H.primitiveLodResources(R,Z);if(!Z)throw Error(`Unknown object symbol primitive: ${R}`);R=M.materialsFromLodResources(Z).map(W=>({opacity:1,transparent:W.parameters.transparent}));X=await this._createStageResources(Z,ea,ba);ba=await this._createLodRenderer(Z,ba);return new V(Z,ba,X,R,ha,!1,!1,da,fa,aa,ea,null)}async _createResourcesForUrl(R,ba){var X={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)))?(Object.assign(X.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(K.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(X.materialParameters.hasInstancedColor=!0,this._optionalFields.push(K.VertexAttribute.COLOR));
h("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(K.VertexAttribute.OBJECTANDLAYERIDCOLOR);var da=this.symbol;if("point-3d"===da.type&&da.verticalOffset){const {screenLength:Ca,minWorldLength:pa,maxWorldLength:wa}=da.verticalOffset;X.materialParameters.verticalOffset={screenLength:k.pt2px(Ca),minWorldLength:pa||0,maxWorldLength:null!=wa?wa:Infinity};X.materialParameters.castShadows=!1}da=this._context.physicalBasedRenderingEnabled;X.signal=ba;X.usePBR=da;X.skipHighLods=this._context.skipHighSymbolLods;
var ha=await F.fetch(R,X);R=ha.isEsriSymbolResource;X=ha.isWosr;const fa=B.makeLodResources(ha.lods),aa=this._context,Z=this._getExternalColorParameters(this.symbolLayer.material),ea=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:!0}),ca=this.needsDrivenTransparentPass;var W=M.materialsFromLodResources(fa);const Y=M.materialsFromLodResources(fa).map(Ca=>({opacity:Ca.parameters.opacity||1,transparent:Ca.parameters.transparent}));W.forEach(Ca=>{const pa=Ca.parameters;
Ca.setParameters(Z);const wa=pa.opacity*ea;Ca.setParameters({opacity:wa,transparent:1>wa||ca||pa.transparent});aa.screenSizePerspectiveEnabled&&Ca.setParameters({screenSizePerspective:aa.sharedResources.screenSizePerspectiveSettings})});ha=ha.referenceBoundingBox;const ja=e.fromArray(x.size(ha)),oa=e.fromArray(fa.levels[0].pivotOffset),ra=e.fromArray(q.objectSymbolLayerSizeWithResourceSize(ja,this.symbolLayer)),ta=g.length(ra),ya=this._fastUpdates;z.updateFastSymbolUpdatesState(ya,this._context.renderer,
this._fastVisualVariableConvertOptions(ha,ra,ja,oa))&&W.forEach(Ca=>Ca.setParameters(ya.materialParameters));W=await this._createStageResources(fa,da,ba);ba=await this._createLodRenderer(fa,ba);return new V(fa,ba,W,Y,ja,R,X,ha,ra,ta,da,oa)}_addDisposeResource(R){this._disposeResourceHandles.push(R)}async _createStageResources(R,ba,X){const da=this._context.stage,ha=M.materialsFromLodResources(R);ba!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();da.addMany(ha);
this._addDisposeResource(()=>da.removeMany(ha));const fa=M.texturesFromLodResources(R);da.addMany(fa);this._addDisposeResource(()=>{fa.forEach(Z=>Z.unload());da.removeMany(fa)});await Promise.all(fa.map(Z=>this._context.stage.schedule(()=>Z.load(da.renderView.renderingContext),X)));c.throwIfAborted(X);const aa=M.geometriesFromLodResources(R);da.addMany(aa);this._addDisposeResource(()=>da.removeMany(aa));return{materials:ha,textures:fa,geometries:aa}}async _createLodRenderer(R,ba){const X=this._context.stage,
da=this._fastUpdates,ha=new I.LodRenderer({symbol:R,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:fa=>this._instanceIndexToGraphicUid.get(fa),notifyGraphicGeometryChanged:fa=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(fa)),notifyGraphicVisibilityChanged:fa=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(fa))},shaderTransformation:da?{applyTransform:(fa,aa,Z)=>{fa.getFeatureAttribute(aa,
U);d.copy(Z,z.evaluateModelTransform(da.materialParameters,U,Z))},scaleFactor:(fa,aa,Z)=>{aa.getFeatureAttribute(Z,U);z.evaluateModelTransformScale(fa,da.materialParameters,U)}}:null},this._context.scheduler);ha.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{X.removeRenderPlugin(ha);ha.destroy()});await X.addRenderPlugin(ha,ba);return ha}_getExternalColorParameters(R){const ba={};this._drivenProperties.color?ba.externalColor=n.ONES:null!=R?.color?ba.externalColor=
b.toUnitRGBA(R.color):(ba.externalColor=n.ONES,ba.colorMixMode="ignore");return ba}destroy(){super.destroy();this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(R=>R());this._disposeResourceHandles.length=0;this._resources=null}createGraphics3DGraphic(R){const ba=R.graphic;if(!this._validateGeometry(ba.geometry))return null;const X=G.placePointOnGeometry(ba.geometry);if(null==X)return this.logger.warn(`unsupported geometry type for icon symbol: ${ba.geometry.type}`),
null;const da=this.setGraphicElevationContext(ba);return this._createAs3DShape(ba,X,R.renderingInfo,da,ba.uid,R.layer.uid)}notifyDestroyGraphicLayer(R){this._instanceIndexToGraphicUid.delete(R.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null!=this._resources){var R=this._drivenProperties.opacity,ba=!this._isPrimitive,X=this._resources.stageResources.materials,da=this._resources.originalMaterialParameters;for(let fa=0;fa<X.length;fa++){const aa=X[fa];var ha=da[fa];const Z=
this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:ba})*ha.opacity;ha=1>Z||R||ha.transparent;aa.setParameters({opacity:Z,transparent:ha});this._isPrimitive&&aa.setParameters({cullFace:ha?J.CullFaceOptions.None:J.CullFaceOptions.Back})}}}layerElevationInfoChanged(R,ba){return this.updateGraphics3DGraphicElevationInfo(R,ba,t.needsElevationUpdates3D)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;
for(const R of this._resources.stageResources.materials)R.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const {stageResources:R,isWosr:ba}=this._resources;for(const X of R.materials)this._isPrimitive?X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):ba||X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&
!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0}applyRendererDiff(R,ba){if(null==this._resources)return E.ApplyRendererDiffResult.RecreateSymbol;const {stageResources:{materials:X},lodRenderer:da,resourceBoundingBox:ha,symbolSize:fa,resourceSize:aa,pivotOffset:Z}=this._resources;for(const ea in R.diff)switch(ea){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,ba,this._fastVisualVariableConvertOptions(ha,fa,aa,Z))){for(const ca of X)ca.setParameters(this._fastUpdates.materialParameters);
da.notifyShaderTransformationChanged()}else return E.ApplyRendererDiffResult.RecreateSymbol;break;default:return E.ApplyRendererDiffResult.RecreateSymbol}return E.ApplyRendererDiffResult.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();var R=this._resources.lodResources;const ba=v.estimateNumVerticesForLods(R.levels),X=ha=>Array.from(ha.attributes.values()).reduce((fa,aa)=>fa+m.estimateSize(aa.data,aa.indices),0),da=M.geometriesFromLodResources(R).reduce((ha,
fa)=>ha+X(fa),0);R=M.texturesFromLodResources(R).reduce((ha,fa)=>ha+fa.memoryEstimate,0)+da;R={...v.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:R};return new L.SymbolComplexity({verticesPerFeature:ba,memory:R})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(R,ba,X,da,ha,fa){if(!this._hasLodRenderer()||null==this._resources)return null;R=this.getFastUpdateAttrValues(R);var aa=this._context.clippingExtent;u.projectPointToVector(ba,T,this._context.elevationProvider.spatialReference);
if(null!=aa&&!x.containsPoint(aa,T))return null;aa=this._requiresTerrainElevation(da);const Z=this._computeGlobalTransform(ba,da,O,P),ea=this._computeLocalTransform(this._resources,this.symbolLayer,X,ia),ca=this._resources.lodRenderer.instanceData,W=ca.addInstance();this._instanceIndexToGraphicUid.set(W,ha);ca.setLocalTransform(W,ea,!1);ca.setGlobalTransform(W,Z);R&&ca.setFeatureAttribute(W,R);null==this._fastUpdates&&this._hasPerInstanceColor()&&ca.setColor(W,D.mixinColorAndOpacity(X.color,X.opacity,
255));null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&ca.setObjectAndLayerIdColor(W,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ha,layerUid:fa}));X=new r.Graphics3DLodInstanceGraphicLayer(this,W,p.perLodInstanceElevationAligner,da);aa&&(X.alignedSampledElevation=P.sampledElevation);X.needsElevationUpdates=t.needsElevationUpdates3D(da.mode);G.extendPointGraphicElevationContext(X,ba,this._context.elevationProvider);return X}_computeGlobalTransform(R,
ba,X,da){t.evaluateElevationInfoAtPoint(R,this._context.elevationProvider,ba,this._context.renderCoordsHelper,da);T[0]=R.x;T[1]=R.y;T[2]=da.z;l.computeTranslationToOriginAndRotation(R.spatialReference,T,X,this._context.renderCoordsHelper.spatialReference);return X}_computeLocalTransform(R,ba,X,da){d.identity(da);this._applyObjectRotation(X,!1,da);this._applyObjectRotation(ba,!0,da);this._applyObjectScale(R,X,da);this._applyAnchor(R,ba,da);return da}_applyObjectScale(R,ba,X){this._fastUpdates?.requiresShaderTransformation||
(R=D.computeObjectScale(this._drivenProperties.size&&ba.size?ba.size:R.symbolSize,R.symbolSize,R.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===R[0]&&1===R[1]&&1===R[2]||d.scale(X,X,R))}prepareSymbolLayerPatch(R){if("partial"===R.diff.type){var ba=R.diff.diff;this._preparePatchTransform(R,ba);this._preparePatchColor(R,ba)}}updateGeometry(R,ba){if(null==this._resources)return!0;const X=ba&&G.placePointOnGeometry(ba);if(null==X)return!1;ba=this.getGeometryElevationMode(ba);if(R.elevationContext.mode!==
ba)return!1;this._computeGlobalTransform(X,R.elevationContext,O,P);this._requiresTerrainElevation(R.elevationContext)&&(R.alignedSampledElevation=P.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(R.instanceIndex,O,!0);G.extendPointGraphicElevationContext(R,X,this._context.elevationProvider);return!0}_preparePatchTransform(R,ba){if((ba.heading||ba.tilt||ba.roll||ba.width||ba.height||ba.depth||ba.anchor||ba.anchorPosition)&&null!=this._resources){var X=(ja,oa,ra)=>(null!=
ja&&"complete"===ja.type?ja.newValue:oa)??ra,da=X(ba.heading,this.symbolLayer.heading,0),ha=X(ba.tilt,this.symbolLayer.tilt,0),fa=X(ba.roll,this.symbolLayer.roll,0),aa=X(ba.width,this.symbolLayer.width,void 0),Z=X(ba.height,this.symbolLayer.height,void 0),ea=X(ba.depth,this.symbolLayer.depth,void 0),ca=X(ba.anchor,this.symbolLayer.anchor,void 0);X=X(ba.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete ba.heading;delete ba.tilt;delete ba.roll;delete ba.width;delete ba.height;delete ba.depth;
delete ba.anchor;delete ba.anchorPosition;var W={heading:da,tilt:ha,roll:fa,anchor:ca,anchorPosition:X},Y=this._resources;this.loadStatus===A.LoadStatus.LOADED&&R.symbolLayerStatePatches.push(()=>{Y.symbolSize=e.fromArray(q.objectSymbolLayerSizeWithResourceSize(Y.resourceSize,{width:aa,height:Z,depth:ea,isPrimitive:this.symbolLayer.isPrimitive}))});R.graphics3DGraphicPatches.push((ja,oa)=>{oa=this._computeLocalTransform(Y,W,oa,ia);Y.lodRenderer.instanceData.setLocalTransform(ja.instanceIndex,oa,!0)})}}_preparePatchColor(R,
ba){if(ba.material&&"partial"===ba.material.type&&(ba=ba.material.diff,ba.color&&"complete"===ba.color.type&&null!=ba.color.newValue&&null!=ba.color.oldValue)){var X=ba.color.newValue,da=null!=X?b.toUnitRGBA(X):n.ONES;delete ba.color;var ha=this._resources;null!=ha&&R.graphics3DGraphicPatches.push(fa=>{this._hasPerInstanceColor()?(ha.lodRenderer.instanceData.setColor(fa.instanceIndex,da),fa=this._setMaterialTransparencyParameters({},X)):fa=this._setMaterialTransparencyParameters({externalColor:da},
X);for(const aa of ha.stageResources.materials)aa.setParameters(fa)})}}_requiresTerrainElevation(R){return"absolute-height"!==R.mode}_applyObjectRotation(R,ba,X){if(!this._fastUpdates?.requiresShaderTransformation||!ba)return D.computeObjectRotation(R.heading,R.tilt,R.roll,X)}_computeAnchor(R,ba,X){const da=e.create();switch(X.anchor){case "center":g.copy(da,x.center(R));g.negate(da,da);break;case "top":ba=x.center(R);g.set(da,-ba[0],-ba[1],-R[5]);break;case "bottom":ba=x.center(R);g.set(da,-ba[0],
-ba[1],-R[2]);break;case "relative":ba=x.center(R);R=x.size(R);X=(X=X.anchorPosition)?e.fromValues(X.x,X.y,X.z):e.ZEROS;g.multiply(da,R,X);g.add(da,da,ba);g.negate(da,da);break;default:null!=ba?g.negate(da,ba):g.copy(da,e.ZEROS)}return da}_applyAnchor(R,ba,X){this._fastUpdates?.requiresShaderTransformation||(R=this._computeAnchor(R.resourceBoundingBox,R.pivotOffset,ba))&&d.translate(X,X,R)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(R,
ba,X,da){const ha=null!=R?e.fromArray(x.size(R)):e.ONES;R=null!=R?this._computeAnchor(R,da,this.symbolLayer):e.ZEROS;da=this._context.renderCoordsHelper.unitInMeters;X=D.computeObjectScale(null!=ba?ba:void 0,ba,X,da);const fa=e.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new z.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ha,ba??e.ONES,da,R,X,fa)}}const T=e.create(),ia=f.create(),O=f.create(),U=n.create(),P=new t.SampleElevationInfo;
a.Graphics3DObjectSymbolLayer=Q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(v,p,t,r){this.graphics3DSymbolLayer=v;this.instanceIndex=p;this.elevationAligner=t;this.elevationContext=r;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}initialize(){}setVisibility(v){const p=this._lodRenderer.instanceData;v!==p.getVisible(this.instanceIndex)&&p.setVisible(this.instanceIndex,v)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),
this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(v,p,t){this.elevationAligner&&(d.setContextFeature(this.elevationContext.featureExpressionInfoContext,t),t=this.elevationAligner(this,this.elevationContext,v.spatialReference,(r,y)=>m.evaluateElevationInfoAtPoint(r,v,this.elevationContext,p,y),p),null!=t&&(this.alignedSampledElevation=t))}getCenterObjectSpace(v=c.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,q);return h.transformMat4(v,
this._lodRenderer.baseBoundingSphere.center,q)}getBoundingBoxObjectSpace(v=k.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,q);const p=this._lodRenderer.baseBoundingBox;k.empty(v);for(let t=0;8>t;++t)h.set(u,0===(t&1)?p[0]:p[3],0===(t&2)?p[1]:p[4],0===(t&4)?p[2]:p[5]),h.transformMat4(u,u,q),k.expandWithVec3(v,u);return v}computeAttachmentOrigin(v){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,q);v.render.origin[0]+=q[12];v.render.origin[1]+=
q[13];v.render.origin[2]+=q[14];v.render.num++}async getProjectedBoundingBox(v,p,t,r,y){y=this.getBoundingBoxObjectSpace(y);var D=w;const E=k.isPoint(y)?1:D.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,q);for(var A=0;A<E;A++){const B=D[A];u[0]=y[B[0]];u[1]=y[B[1]];u[2]=y[B[2]];h.transformMat4(u,u,q);l[3*A]=u[0];l[3*A+1]=u[1];l[3*A+2]=u[2]}if(!v(l,0,E))return null;k.empty(y);v=null;this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds());for(D=0;D<
3*E;D+=3){for(A=0;3>A;A++)y[A]=Math.min(y[A],l[D+A]),y[A+3]=Math.max(y[A+3],l[D+A]);v&&t.push({location:l.slice(D,D+3),screenSpaceBoundingRect:v})}if(p&&(k.center(y,x),"absolute-height"!==this.elevationContext.mode)){let B;t=f.demResolutionForBoundingBox(y,p.service.spatialReference,p);try{B=await p.service.queryElevation(x[0],x[1],r,t,"ground")}catch(F){}null!=B&&k.offset(y,0,0,-this.alignedSampledElevation+B)}return y}addObjectState(v,p){v===g.Object3DState.Highlight&&(v=new e.Object3DStateID(v),
this._addHighlightId(v),p.addExternal(t=>{this._removeHighlightId(t)},v))}removeObjectState(v){this._highlights.forEach(p=>v.remove(p))}_addHighlightId(v){this._highlights.add(v);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(v){this._highlights.delete(v);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this._highlights.size)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],u=c.create(),x=c.create(),w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],q=b.create();a.Graphics3DLodInstanceGraphicLayer=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function h(k,m){const d=k.stageResources.geometries.map(f=>new b.LodComponentResources(f,k.stageResources.textures));m=null==k.lodThreshold||0===
k.lodThreshold&&0<m?c(d):k.lodThreshold;return new b.LodLevelResources(d,m,k.pivotOffset)}function c(k){k=k.reduce((m,{geometry:d})=>m+d.indexCount/3,0);return Math.sqrt(20*k/Math.PI)}a.makeLodResources=function(k){return new b.LodResources(k.map((m,d)=>h(m,d)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec2 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J){function K(N){const V=N.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return V?{fileType:"gltf",url:V[1],specifiedLodIndex:null!=V[4]?Number(V[4]):null}:N.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:N,specifiedLodIndex:null}:{fileType:"unknown",url:N,specifiedLodIndex:null}}function I(N,V,Q,T){const ia=N.model,O=[],U=new Map,P=new Map,R=ia.lods.length,ba=g.empty();ia.lods.forEach((X,da)=>{const ha=!0===T.skipHighLods&&
(1<R&&0===da||3<R&&1===da)||!1===T.skipHighLods&&null!=T.singleLodIndex&&da!==T.singleLodIndex;if(!ha||0===da){var fa=new D.ProcessedObjectResource(X.name,X.lodThreshold,[0,0,0]);X.parts.forEach(aa=>{const Z=ha?new C.DefaultMaterial({}):M(ia,aa,fa,V,Q,U,P);var ea=null!=Z?Z:new C.DefaultMaterial({});const ca=aa.attributes.position.count,W=t.convertPrimitiveToTriangles(aa.indices||ca,aa.primitiveType);var Y=e.newFloatArray(3*ca);const {typedBuffer:ja,typedBufferStride:oa}=aa.attributes.position;l.transformMat4(Y,
ja,aa.transform,3,oa);Y=[[L.VertexAttribute.POSITION,new B.Attribute(Y,W,3,!0)]];if(null!=aa.attributes.normal){var ra=e.newFloatArray(3*ca);const {typedBuffer:Ca,typedBufferStride:pa}=aa.attributes.normal;h.normalFromMat4(S,aa.transform);l.transformMat3(ra,Ca,S,3,pa);Y.push([L.VertexAttribute.NORMAL,new B.Attribute(ra,W,3,!0)])}if(null!=aa.attributes.tangent){ra=e.newFloatArray(4*ca);const {typedBuffer:Ca,typedBufferStride:pa}=aa.attributes.tangent;h.normalFromMat4(S,aa.transform);u.transformMat3(ra,
Ca,S,4,pa);Y.push([L.VertexAttribute.TANGENT,new B.Attribute(ra,W,4,!0)])}if(null!=aa.attributes.texCoord0){ra=e.newFloatArray(2*ca);const {typedBuffer:Ca,typedBufferStride:pa}=aa.attributes.texCoord0;x.normalizeIntegerBuffer(ra,Ca,2,pa);Y.push([L.VertexAttribute.UV0,new B.Attribute(ra,W,2,!0)])}null!=aa.attributes.color&&(ra=new Uint8Array(4*ca),4===aa.attributes.color.elementCount?aa.attributes.color instanceof n.BufferViewVec4f?u.scale(ra,aa.attributes.color,255):aa.attributes.color instanceof
n.BufferViewVec4u8?q.copy(ra,aa.attributes.color):aa.attributes.color instanceof n.BufferViewVec4u16&&u.scale(ra,aa.attributes.color,1/256):(ra.fill(255),aa.attributes.color instanceof n.BufferViewVec3f?l.scale(ra,aa.attributes.color,255,4):aa.attributes.color instanceof n.BufferViewVec3u8?w.copy(ra,aa.attributes.color.typedBuffer,4,aa.attributes.color.typedBufferStride):aa.attributes.color instanceof n.BufferViewVec3u16&&l.scale(ra,aa.attributes.color,1/256,4)),Y.push([L.VertexAttribute.COLOR,new B.Attribute(ra,
W,4,!0)]));aa={geometry:new G.Geometry(ea,Y),vertexCount:ca};const {geometry:ta,vertexCount:ya}=aa;aa=ta.boundingInfo;null!=aa&&0===da&&(g.expandWithVec3(ba,aa.bbMin),g.expandWithVec3(ba,aa.bbMax));null!=Z&&(fa.stageResources.geometries.push(ta),fa.numberOfVertices+=ya)});ha||O.push(fa)}});return{engineResources:O,referenceBoundingBox:ba}}function M(N,V,Q,T,ia,O,U){const P=V.material+(V.attributes.normal?"_normal":"")+(V.attributes.color?"_color":"")+(V.attributes.texCoord0?"_texCoord0":"")+(V.attributes.tangent?
"_tangent":""),R=N.materials.get(V.material);var ba=null!=V.attributes.texCoord0;const X=null!=V.attributes.normal;if(null==R)return null;a:{switch(R.alphaMode){case "BLEND":var da=F.AlphaDiscardMode.Blend;break a;case "MASK":da=F.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:da=F.AlphaDiscardMode.Opaque;break a}da=void 0}if(!O.has(P)){if(ba){var ha=(ja,oa=!1)=>{if(null!=ja&&!U.has(ja)){const ra=N.textures.get(ja);if(null!=ra){const ta=ra.data;U.set(ja,new H.Texture(r.isEncodedMeshTexture(ta)?
ta.data:ta,{...ra.parameters,preMultiplyAlpha:r.isEncodedMeshTexture(ta)?!1:oa,encoding:r.isEncodedMeshTexture(ta)&&null!=ta.encoding?ta.encoding:void 0}))}}};ha(R.textureColor,da!==F.AlphaDiscardMode.Opaque);ha(R.textureNormal);ha(R.textureOcclusion);ha(R.textureEmissive);ha(R.textureMetallicRoughness)}ha=R.color[0]**(1/z.colorGamma);const fa=R.color[1]**(1/z.colorGamma),aa=R.color[2]**(1/z.colorGamma),Z=R.emissiveFactor[0]**(1/z.colorGamma),ea=R.emissiveFactor[1]**(1/z.colorGamma),ca=R.emissiveFactor[2]**
(1/z.colorGamma),W=null!=R.textureColor&&ba?U.get(R.textureColor):null,Y=J.useSchematicPBR({normalTexture:R.textureNormal,metallicRoughnessTexture:R.textureMetallicRoughness,metallicFactor:R.metallicFactor,roughnessFactor:R.roughnessFactor,emissiveTexture:R.textureEmissive,emissiveFactor:R.emissiveFactor,occlusionTexture:R.textureOcclusion});O.set(P,new C.DefaultMaterial({...T,transparent:da===F.AlphaDiscardMode.Blend,customDepthTest:F.DepthTestFunction.Lequal,textureAlphaMode:da,textureAlphaCutoff:R.alphaCutoff,
diffuse:[ha,fa,aa],ambient:[ha,fa,aa],opacity:R.opacity,doubleSided:R.doubleSided,doubleSidedType:"winding-order",cullFace:R.doubleSided?F.CullFaceOptions.None:F.CullFaceOptions.Back,hasVertexColors:!!V.attributes.color,hasVertexTangents:!!V.attributes.tangent,normalType:X?A.NormalType.Attribute:A.NormalType.ScreenDerivative,castShadows:!0,textureId:null!=W?W.id:void 0,colorMixMode:R.colorMixMode,normalTextureId:null!=R.textureNormal&&ba?U.get(R.textureNormal).id:void 0,textureAlphaPremultiplied:null!=
W&&!!W.parameters.preMultiplyAlpha,occlusionTextureId:null!=R.textureOcclusion&&ba?U.get(R.textureOcclusion).id:void 0,emissiveTextureId:null!=R.textureEmissive&&ba?U.get(R.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=R.textureMetallicRoughness&&ba?U.get(R.textureMetallicRoughness).id:void 0,emissiveFactor:[Z,ea,ca],mrrFactors:Y?[...J.defaultSchematicMRRFactors]:[R.metallicFactor,R.roughnessFactor,T.mrrFactors[2]],isSchematic:Y,colorTextureTransformMatrix:y.getTransformMatrix(R.colorTextureTransform),
normalTextureTransformMatrix:y.getTransformMatrix(R.normalTextureTransform),occlusionTextureTransformMatrix:y.getTransformMatrix(R.occlusionTextureTransform),emissiveTextureTransformMatrix:y.getTransformMatrix(R.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:y.getTransformMatrix(R.metallicRoughnessTextureTransform),...ia}))}V=O.get(P);Q.stageResources.materials.push(V);ba&&(ba=fa=>{null!=fa&&Q.stageResources.textures.push(U.get(fa))},ba(R.textureColor),ba(R.textureNormal),ba(R.textureOcclusion),
ba(R.textureEmissive),ba(R.textureMetallicRoughness));return V}const S=c.create();a.fetch=async function(N,V){N=K(b.adjustStaticAGOUrl(N));if("wosr"===N.fileType){N=await (V.cache?V.cache.loadWOSR(N.url,V):E.load(N.url,V));const {engineResources:X,referenceBoundingBox:da}=E.processLoadResult(N,V);return{lods:X,referenceBoundingBox:da,isEsriSymbolResource:!1,isWosr:!0}}const Q=await (V.cache?V.cache.loadGLTF(N.url,V,!!V.usePBR):p.loadGLTF(new v.DefaultLoadingContext(V.streamDataRequester),N.url,V,
V.usePBR)),T=Q.model.meta?.ESRI_proxyEllipsoid,ia=Q.meta.isEsriSymbolResource&&null!=T&&"EsriRealisticTreesStyle"===Q.meta.ESRI_webstyle;if(ia&&!Q.customMeta.esriTreeRendering){Q.customMeta.esriTreeRendering=!0;a:for(let X=0;X<Q.model.lods.length;++X){var O=Q.model.lods[X];for(var U of O.parts){O=U.attributes.normal;if(null==O)break a;const da=U.attributes.position,ha=da.count,fa=f.create(),aa=f.create(),Z=f.create(),ea=new Uint8Array(4*ha),ca=new Float64Array(3*ha),W=k.invert(m.create(),U.transform);
let Y=0,ja=0;for(let oa=0;oa<ha;oa++){da.getVec(oa,aa);O.getVec(oa,fa);d.transformMat4(aa,aa,U.transform);d.subtract(Z,aa,T.center);d.divide(Z,Z,T.radius);const ra=Z[2];var P=d.length(Z);P=Math.min(.45+.55*P*P,1);d.divide(Z,Z,T.radius);null!==W&&d.transformMat4(Z,Z,W);d.normalize(Z,Z);X+1!==Q.model.lods.length&&1<Q.model.lods.length&&(-1<ra?d.lerp(Z,Z,fa,.2):d.lerp(Z,Z,fa,Math.min(-4*ra-3.8,1)));ca[Y]=Z[0];ca[Y+1]=Z[1];ca[Y+2]=Z[2];Y+=3;ea[ja]=255*P;ea[ja+1]=255*P;ea[ja+2]=255*P;ea[ja+3]=255;ja+=
4}U.attributes.normal=new n.BufferViewVec3f(ca);U.attributes.color=new n.BufferViewVec4u8(ea)}}}U=!!V.usePBR;U=Q.meta.isEsriSymbolResource?{usePBR:U,isSchematic:!1,treeRendering:ia,mrrFactors:[...J.defaultEsriSymbologyMRRFactors]}:{usePBR:U,isSchematic:!1,treeRendering:!1,mrrFactors:[...J.defaultAdvancedMRRFactors]};const {engineResources:R,referenceBoundingBox:ba}=I(Q,U,{...V.materialParameters,treeRendering:ia},V.skipHighLods&&null==N.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:N.specifiedLodIndex});
return{lods:R,referenceBoundingBox:ba,isEsriSymbolResource:Q.meta.isEsriSymbolResource,isWosr:!1}};a.gltfToEngineResources=I;a.parseUrl=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,h=/^qaext.arcgis.com$/,c=/^[\w-]*\.mapsdevext.arcgis.com$/,k=/^[\w-]*\.mapsqa.arcgis.com$/,m=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,h,/^jsapps.esri.com$/,c,k];a.adjustStaticAGOUrl=function(d,
f){return d?(f=f||globalThis.location.hostname)?null!=f.match(b)||null!=f.match(c)?d.replace("static.arcgis.com","staticdev.arcgis.com"):null!=f.match(h)||null!=f.match(k)?d.replace("static.arcgis.com","staticqa.arcgis.com"):d:d:d};a.devHostnames=m;a.isDevEnvironment=function(d){d=d||globalThis.location.hostname;return m.some(f=>null!=d?.match(f))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec4":function(){define(["exports","../geometry/support/buffer/math/common"],
function(a,b){function h(e,n,l){if(e.count!==n.count)b.getMathLogger().error("source and destination buffers need to have the same number of elements");else{var u=e.count,x=l[0],w=l[1],q=l[2],v=l[3],p=l[4],t=l[5],r=l[6],y=l[7],D=l[8],E=l[9],A=l[10],B=l[11],F=l[12],G=l[13],H=l[14];l=l[15];var L=e.typedBuffer;e=e.typedBufferStride;var C=n.typedBuffer;n=n.typedBufferStride;for(let J=0;J<u;J++){const K=J*e;var z=J*n;const I=C[z],M=C[z+1],S=C[z+2];z=C[z+3];L[K]=x*I+p*M+D*S+F*z;L[K+1]=w*I+t*M+E*S+G*z;L[K+
2]=q*I+r*M+A*S+H*z;L[K+3]=v*I+y*M+B*S+l*z}}}function c(e,n,l){k(e.typedBuffer,n.typedBuffer,l,e.typedBufferStride,n.typedBufferStride)}function k(e,n,l,u=4,x=u){if(e.length/u!==n.length/x)b.getMathLogger().error("source and destination buffers need to have the same number of elements");else{var w=e.length/u,q=l[0],v=l[1],p=l[2],t=l[3],r=l[4],y=l[5],D=l[6],E=l[7];l=l[8];var A=0,B=0;for(let F=0;F<w;F++){const G=n[A],H=n[A+1],L=n[A+2],C=n[A+3];e[B]=q*G+t*H+D*L;e[B+1]=v*G+r*H+E*L;e[B+2]=p*G+y*H+l*L;e[B+
3]=C;A+=x;B+=u}}}function m(e,n){const l=Math.min(e.count,n.count),u=e.typedBuffer;e=e.typedBufferStride;const x=n.typedBuffer;n=n.typedBufferStride;for(let v=0;v<l;v++){const p=v*e;var w=v*n;const t=x[w],r=x[w+1];w=x[w+2];var q=t*t+r*r+w*w;0<q&&(q=1/Math.sqrt(q),u[p]=q*t,u[p+1]=q*r,u[p+2]=q*w)}}function d(e,n,l){f(e.typedBuffer,n,l,e.typedBufferStride)}function f(e,n,l,u=4){const x=Math.min(e.length/u,n.count),w=n.typedBuffer;n=n.typedBufferStride;let q=0,v=0;for(let p=0;p<x;p++)e[v]=l*w[q],e[v+
1]=l*w[q+1],e[v+2]=l*w[q+2],e[v+3]=l*w[q+3],q+=n,v+=u}const g=Object.freeze(Object.defineProperty({__proto__:null,normalize:m,scale:f,scaleView:d,transformMat3:k,transformMat3View:c,transformMat4:h},Symbol.toStringTag,{value:"Module"}));a.normalize=m;a.scale=f;a.scaleView=d;a.transformMat3=k;a.transformMat3View=c;a.transformMat4=h;a.vec4=g})},"esri/chunks/vec2":function(){define(["exports","../core/typedArrayUtil"],function(a,b){function h(d,f){c(d.typedBuffer,f.typedBuffer,d.typedBufferStride,f.typedBufferStride)}
function c(d,f,g=2,e=g){const n=f.length/2;let l=0,u=0;if(b.isArray(f)||b.isFloat(f))for(var x=0;x<n;++x)d[l]=f[u],d[l+1]=f[u+1],l+=g,u+=e;else if(x=b.maximumValue(f),b.isSigned(f))for(var w=0;w<n;++w)d[l]=Math.max(f[u]/x,-1),d[l+1]=Math.max(f[u+1]/x,-1),l+=g,u+=e;else for(w=0;w<n;++w)d[l]=f[u]/x,d[l+1]=f[u+1]/x,l+=g,u+=e}function k(d,f,g,e){const n=d.typedBuffer,l=d.typedBufferStride;d=e?.count??d.count;e=(e?.dstIndex??0)*l;for(let u=0;u<d;++u)n[e]=f,n[e+1]=g,e+=l}const m=Object.freeze(Object.defineProperty({__proto__:null,
fill:k,normalizeIntegerBuffer:c,normalizeIntegerBufferView:h},Symbol.toStringTag,{value:"Module"}));a.fill=k;a.normalizeIntegerBuffer=c;a.normalizeIntegerBufferView=h;a.vec2=m})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(m,d){h(m.typedBuffer,d.typedBuffer,m.typedBufferStride,d.typedBufferStride)}function h(m,d,f=3,g=f){const e=d.length/g;let n=0,l=0;for(let u=0;u<e;++u)m[n]=d[l],m[n+1]=d[l+1],m[n+2]=d[l+2],n+=f,l+=g}function c(m,d,f,g,e){const n=m.typedBuffer,l=m.typedBufferStride;
m=e?.count??m.count;e=(e?.dstIndex??0)*l;for(let u=0;u<m;++u)n[e]=d,n[e+1]=f,n[e+2]=g,e+=l}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:h,copyView:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=h;a.copyView=b;a.fill=c;a.vec3=k})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(m,d){h(m.typedBuffer,d,m.typedBufferStride)}function h(m,d,f=4){const g=d.typedBuffer,e=d.typedBufferStride;d=d.count;let n=0,l=0;for(let u=0;u<d;++u)m[n]=g[l],m[n+1]=g[l+
1],m[n+2]=g[l+2],m[n+3]=g[l+3],n+=f,l+=e}function c(m,d,f,g,e,n){const l=m.typedBuffer,u=m.typedBufferStride;m=n?.count??m.count;n=(n?.dstIndex??0)*u;for(let x=0;x<m;++x)l[n]=d,l[n+1]=f,l[n+2]=g,l[n+3]=e,n+=u}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:h,copyView:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=h;a.copyView=b;a.fill=c;a.vec4=k})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,h,c,k,m){class d{constructor(g){this._streamDataRequester=g}async loadJSON(g,e){return this._load("json",g,e)}async loadBinary(g,e){return m.isDataProtocol(g)?(k.throwIfAborted(e),m.dataToArrayBuffer(g)):this._load("binary",g,e)}async loadImage(g,e){return this._load("image",g,e)}async _load(g,e,n){if(null==this._streamDataRequester)return(await b(e,{responseType:f[g]})).data;g=await h.result(this._streamDataRequester.request(e,g,n));if(!0===g.ok)return g.value;k.throwIfAbortError(g.error);
throw new c("",`Request for resource failed: ${g.error}`);}}const f={image:"image",binary:"array-buffer",json:"json","image+type":void 0};a.DefaultLoadingContext=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/factories/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,h,c,k,m){function d(l){let u=null;l.json.nodes.forEach(x=>{x=x.extras;
null!=x&&(x.ESRI_proxyEllipsoid||x.ESRI_lod)&&(u=x)});return u}async function f(l,u){async function x(t,r){const y=w.nodes[t];t=l.getNodeTransform(t);null!=y.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=y.mesh){const D=w.meshes[y.mesh];for(const E of D.primitives)p.push(u(E,t,r,D.name))}for(const D of y.children||[])p.push(x(D,r))}const w=l.json;var q=w.scenes[w.scene||0].nodes;const v=1<q.length,p=[];for(const t of q)q=w.nodes[t],
p.push(x(t,0)),q.extensions?.MSFT_lod&&Array.isArray(q.extensions.MSFT_lod.ids)&&!v&&q.extensions.MSFT_lod.ids.forEach((r,y)=>x(r,y+1));await Promise.all(p)}function g(l,u,x){const w=v=>{const p=`${x}_tex_${v&&v.id}${v?.name?"_"+v.name:""}`;v&&!l.textures.has(p)&&(v=c.makeTextureSource(v.data,{wrap:{s:v.wrapS,t:v.wrapT},mipmap:n.has(v.minFilter),noUnpackFlip:!0}),l.textures.set(p,v));return p},q=`${x}_mat_${u.id}_${u.name}`;l.materials.has(q)||(u=c.makeMaterialParameters({color:[u.color[0],u.color[1],
u.color[2]],opacity:u.color[3],alphaMode:u.alphaMode,alphaCutoff:u.alphaCutoff,doubleSided:u.doubleSided,colorMixMode:u.ESRI_externalColorMixMode,textureColor:u.colorTexture?w(u.colorTexture):void 0,textureNormal:u.normalTexture?w(u.normalTexture):void 0,textureOcclusion:u.occlusionTexture?w(u.occlusionTexture):void 0,textureEmissive:u.emissiveTexture?w(u.emissiveTexture):void 0,textureMetallicRoughness:u.metallicRoughnessTexture?w(u.metallicRoughnessTexture):void 0,emissiveFactor:[u.emissiveFactor[0],
u.emissiveFactor[1],u.emissiveFactor[2]],colorTextureTransform:u.colorTextureTransform,normalTextureTransform:u.normalTextureTransform,occlusionTextureTransform:u.occlusionTextureTransform,emissiveTextureTransform:u.emissiveTextureTransform,metallicRoughnessTextureTransform:u.metallicRoughnessTextureTransform,metallicFactor:u.metallicFactor,roughnessFactor:u.roughnessFactor}),l.materials.set(q,u));return q}let e=0;const n=new Set([m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST]);
a.loadGLTF=async function(l,u,x={},w=!0){const q=await k.GLTFResource.load(l,u,x),v=`gltf_${e++}`,p={lods:[],materials:new Map,textures:new Map,meta:d(q)};l=!(!q.json.asset.extras||"symbolResource"!==q.json.asset.extras.ESRI_type);u=q.json.asset.extras?.ESRI_webstyleSymbol?.webstyle;const t=new Map;await f(q,async(y,D,E,A)=>{const B=t.get(E)??0;t.set(E,B+1);var F=void 0!==y.mode?y.mode:m.PrimitiveType.TRIANGLES,G=F===m.PrimitiveType.TRIANGLES||F===m.PrimitiveType.TRIANGLE_STRIP||F===m.PrimitiveType.TRIANGLE_FAN?
F:null;if(null==G)b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+m.PrimitiveType[F]+"). Skipping primitive.");else if(q.hasPositions(y)){F=q.getPositionData(y,x);var H=q.getMaterial(y,x,w),L=q.hasNormals(y)?q.getNormalData(y,x):null,C=q.hasTangents(y)?q.getTangentData(y,x):null,z=q.hasTextureCoordinates(y)?q.getTextureCoordinates(y,x):null,J=q.hasVertexColors(y)?q.getVertexColors(y,x):null;y=q.getIndexData(y,x);D={name:A,transform:h.clone(D),attributes:{position:await F,
normal:L?await L:null,texCoord0:z?await z:null,color:J?await J:null,tangent:C?await C:null},indices:await y,primitiveType:G,material:g(p,await H,v)};G=null;null!=p.meta?.ESRI_lod&&"screenSpaceRadius"===p.meta.ESRI_lod.metric&&(G=p.meta.ESRI_lod.thresholds[E]);p.lods[E]=p.lods[E]||{parts:[],name:A,lodThreshold:G};p.lods[E].parts[B]=D}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});for(var r of p.lods)r.parts=r.parts.filter(y=>!!y);r=await q.getLoadedBuffersSize();
return{model:p,meta:{isEsriSymbolResource:l,uri:q.uri,ESRI_webstyle:u},customMeta:{},size:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(h={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,
textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...h}};a.makeTextureSource=function(h,c={}){return{data:h,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...c.wrap},noUnpackFlip:!0,mipmap:!1,...c}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/quat ../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(C){switch(C.componentType){case r.DataType.BYTE:return new l.BufferViewVec2i8(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount);case r.DataType.UNSIGNED_BYTE:return new l.BufferViewVec2u8(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount);case r.DataType.SHORT:return new l.BufferViewVec2i16(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount);case r.DataType.UNSIGNED_SHORT:return new l.BufferViewVec2u16(C.raw,
C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount);case r.DataType.UNSIGNED_INT:return new l.BufferViewVec2u32(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount);case r.DataType.FLOAT:return new l.BufferViewVec2f(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount)}}class D{constructor(C,z,J,K){this._context=C;this.uri=z;this.json=J;this._glbBuffer=K;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"];this._baseUri=p.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==J.scenes)throw new b("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==J.meshes)throw new b("gltf-loader-unsupported-feature","Meshes must be defined");if(null==J.nodes)throw new b("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}static async load(C,z,J){if(m.isDataProtocol(z)){var K=m.dataComponents(z);if(K&&"model/gltf-binary"!==K.mediaType)try{const I=JSON.parse(K.isBase64?atob(K.data):K.data);return new D(C,z,I)}catch{}K=m.dataToArrayBuffer(z);if(D._isGLBData(K))return this._fromGLBData(C,z,K)}if(H.test(z)||"gltf"===J?.expectedType)return J=await C.loadJSON(z,J),new D(C,z,J);K=await C.loadBinary(z,J);if(D._isGLBData(K))return this._fromGLBData(C,z,K);if(L.test(z)||"glb"===J?.expectedType)throw new b("gltf-loader-invalid-glb",
"This is not a valid glb file.");J=await C.loadJSON(z,J);return new D(C,z,J)}static _isGLBData(C){if(null==C)return!1;C=new w.BinaryStreamReader(C);return 4<=C.remainingBytes()&&1179937895===C.readUint32()}static async _fromGLBData(C,z,J){J=await D._parseGLBData(J);return new D(C,z,J.json,J.binaryData)}static async _parseGLBData(C){const z=new w.BinaryStreamReader(C);if(12>z.remainingBytes())throw new b("gltf-loader-error","glb binary data is insufficiently large.");var J=z.readUint32(),K=z.readUint32();
const I=z.readUint32();if(1179937895!==J)throw new b("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(C.byteLength<I)throw new b("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==K)throw new b("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");C=0;let M,S;for(;8<=z.remainingBytes();){J=z.readUint32();K=z.readUint32();if(0===C){if(1313821514!==K)throw new b("gltf-loader-error",
"First glb chunk must be JSON.");if(0>J)throw new b("gltf-loader-error","No JSON data found.");M=await t.jsonFromBinaryData(z.readUint8Array(J))}else if(1===C){if(5130562!==K)throw new b("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");S=z.readUint8Array(J)}else h.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");C+=1}if(!M)throw new b("gltf-loader-error","No glb JSON chunk detected.");return{json:M,binaryData:S}}async getBuffer(C,
z){const J=this.json.buffers[C];if(null==J.uri){if(null==this._glbBuffer)throw new b("gltf-loader-error","glb buffer not present");return this._glbBuffer}C=await this._getBufferLoader(C,z);if(C.byteLength!==J.byteLength)throw new b("gltf-loader-error","Buffer byte lengths should match.");return C}async _getBufferLoader(C,z){const J=this._bufferLoaders.get(C);if(J)return J;z=this._context.loadBinary(this._resolveUri(this.json.buffers[C].uri),z).then(K=>new Uint8Array(K));this._bufferLoaders.set(C,
z);return z}async getAccessor(C,z){if(!this.json.accessors)throw new b("gltf-loader-unsupported-feature","Accessors missing.");C=this.json.accessors[C];if(null==C?.bufferView)throw new b("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(C.type in[q.AttributeType.MAT2,q.AttributeType.MAT3,q.AttributeType.MAT4])throw new b("gltf-loader-unsupported-feature",`AttributeType ${C.type} is not supported`);const J=this.json.bufferViews[C.bufferView];z=await this.getBuffer(J.buffer,
z);const K=F[C.type],I=G[C.componentType],M=K*I,S=J.byteStride||M;return{raw:z.buffer,byteStride:S,byteOffset:z.byteOffset+(J.byteOffset||0)+(C.byteOffset||0),entryCount:C.count,isDenselyPacked:S===M,componentCount:K,componentByteSize:I,componentType:C.componentType,min:C.min,max:C.max,normalized:!!C.normalized}}async getIndexData(C,z){if(null!=C.indices)if(C=await this.getAccessor(C.indices,z),C.isDenselyPacked)switch(C.componentType){case r.DataType.UNSIGNED_BYTE:return new Uint8Array(C.raw,C.byteOffset,
C.entryCount);case r.DataType.UNSIGNED_SHORT:return new Uint16Array(C.raw,C.byteOffset,C.entryCount);case r.DataType.UNSIGNED_INT:return new Uint32Array(C.raw,C.byteOffset,C.entryCount)}else switch(C.componentType){case r.DataType.UNSIGNED_BYTE:return u.makeDense(this._wrapAccessor(l.BufferViewUint8,C));case r.DataType.UNSIGNED_SHORT:return u.makeDense(this._wrapAccessor(l.BufferViewUint16,C));case r.DataType.UNSIGNED_INT:return u.makeDense(this._wrapAccessor(l.BufferViewUint32,C))}}async getPositionData(C,
z){if(null==C.attributes.POSITION)throw new b("gltf-loader-unsupported-feature","No POSITION vertex data found.");C=await this.getAccessor(C.attributes.POSITION,z);if(C.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+r.DataType[C.componentType]);if(3!==C.componentCount)throw new b("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+C.componentCount.toFixed());
return this._wrapAccessor(l.BufferViewVec3f,C)}async getNormalData(C,z){if(null==C.attributes.NORMAL)throw new b("gltf-loader-error","No NORMAL vertex data found.");C=await this.getAccessor(C.attributes.NORMAL,z);if(C.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+r.DataType[C.componentType]);if(3!==C.componentCount)throw new b("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
C.componentCount.toFixed());return this._wrapAccessor(l.BufferViewVec3f,C)}async getTangentData(C,z){if(null==C.attributes.TANGENT)throw new b("gltf-loader-error","No TANGENT vertex data found.");C=await this.getAccessor(C.attributes.TANGENT,z);if(C.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+r.DataType[C.componentType]);if(4!==C.componentCount)throw new b("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+
C.componentCount.toFixed());return new l.BufferViewVec4f(C.raw,C.byteOffset,C.byteStride,C.byteOffset+C.byteStride*C.entryCount)}async getTextureCoordinates(C,z){if(null==C.attributes.TEXCOORD_0)throw new b("gltf-loader-error","No TEXCOORD_0 vertex data found.");C=await this.getAccessor(C.attributes.TEXCOORD_0,z);if(2!==C.componentCount)throw new b("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+C.componentCount.toFixed());if(C.componentType===r.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec2f,
C);if(!C.normalized)throw new b("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return y(C)}async getVertexColors(C,z){if(null==C.attributes.COLOR_0)throw new b("gltf-loader-error","No COLOR_0 vertex data found.");C=await this.getAccessor(C.attributes.COLOR_0,z);if(4!==C.componentCount&&3!==C.componentCount)throw new b("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+C.componentCount.toFixed());
if(4===C.componentCount){if(C.componentType===r.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec4f,C);if(C.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec4u8,C);if(C.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec4u16,C)}else if(3===C.componentCount){if(C.componentType===r.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec3f,C);if(C.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec3u8,
C);if(C.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec3u16,C)}throw new b("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+r.DataType[C.componentType]);}hasPositions(C){return void 0!==C.attributes.POSITION}hasNormals(C){return void 0!==C.attributes.NORMAL}hasVertexColors(C){return void 0!==C.attributes.COLOR_0}hasTextureCoordinates(C){return void 0!==C.attributes.TEXCOORD_0}hasTangents(C){return void 0!==C.attributes.TANGENT}async getMaterial(C,
z,J){var K=C.material?this._materialCache.get(C.material):void 0;if(!K){K=null!=C.material?v.material(this.json.materials[C.material]):v.material();const I=K.pbrMetallicRoughness,M=this.hasVertexColors(C),S=this.getTexture(I.baseColorTexture,z),N=this.getTexture(K.normalTexture,z),V=J?this.getTexture(K.occlusionTexture,z):void 0,Q=J?this.getTexture(K.emissiveTexture,z):void 0;z=J?this.getTexture(I.metallicRoughnessTexture,z):void 0;C=null!=C.material?C.material:-1;K={alphaMode:K.alphaMode,alphaCutoff:K.alphaCutoff,
color:I.baseColorFactor,doubleSided:!!K.doubleSided,colorTexture:await S,normalTexture:await N,name:K.name,id:C,occlusionTexture:await V,emissiveTexture:await Q,emissiveFactor:K.emissiveFactor,metallicFactor:I.metallicFactor,roughnessFactor:I.roughnessFactor,metallicRoughnessTexture:await z,hasVertexColors:M,ESRI_externalColorMixMode:K.extras.ESRI_externalColorMixMode,colorTextureTransform:I?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:K.normalTexture?.extensions?.KHR_texture_transform,
occlusionTextureTransform:K.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:K.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:I?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return K}async getTexture(C,z){if(C){if(0!==(C.texCoord||0))throw new b("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");var J=C.index;C=this.json.textures[J];var K=v.textureSampler(null!=C.sampler?this.json.samplers[C.sampler]:
{}),I=this._getTextureSourceId(C),M=this.json.images[I],S=await this._loadTextureImageData(J,C,z);return c.getOrCreateMapValue(this._textureCache,J,()=>{const N=Q=>33071===Q||33648===Q||10497===Q,V=Q=>{throw new b("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${Q}`);};return{data:S,wrapS:N(K.wrapS)?K.wrapS:V(K.wrapS),wrapT:N(K.wrapT)?K.wrapT:V(K.wrapT),minFilter:K.minFilter,name:M.name,id:J}})}}getNodeTransform(C){if(void 0===C)return E;var z=this._nodeTransformCache.get(C);if(!z){z=this.getNodeTransform(this._getNodeParent(C));
const J=this.json.nodes[C];J.matrix?z=f.multiply(g.create(),z,J.matrix):J.translation||J.rotation||J.scale?(z=g.clone(z),J.translation&&f.translate(z,z,J.translation),J.rotation&&(B[3]=e.getAxisAngle(B,J.rotation),f.rotate(z,z,B[3],B)),J.scale&&f.scale(z,z,J.scale)):z=g.clone(z);this._nodeTransformCache.set(C,z)}return z}_wrapAccessor(C,z){return new C(z.raw,z.byteOffset,z.byteStride,z.byteOffset+z.byteStride*(z.entryCount-1)+z.componentByteSize*z.componentCount)}_resolveUri(C){return m.makeAbsolute(C,
this._baseUri)}_getNodeParent(C){return this._nodeParentMap.get(C)}_checkVersionSupported(){const C=d.Version.parse(this.json.asset.version,"glTF");A.validate(C)}_checkRequiredExtensionsSupported(){const C=this.json;if(C.extensionsRequired&&!C.extensionsRequired.every(z=>this._supportedExtensions.includes(z)))throw new b("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+C.extensionsRequired.join(", "));}_computeNodeParents(){this.json.nodes.forEach((C,
z)=>{C.children&&C.children.forEach(J=>{this._nodeParentMap.set(J,z)})})}async _loadTextureImageData(C,z,J){const K=this._textureLoaders.get(C);if(K)return K;z=this._createTextureLoader(z,J);this._textureLoaders.set(C,z);return z}_getTextureSourceId(C){if(void 0!==C.extensions&&null!==C.extensions.KHR_texture_basisu)return C.extensions.KHR_texture_basisu.source;if(null!==C.source)return C.source;throw new b("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");
}async _createTextureLoader(C,z){C=this._getTextureSourceId(C);C=this.json.images[C];if(C.uri)return C.uri.endsWith(".ktx2")?(z=await this._context.loadBinary(this._resolveUri(C.uri),z),new t.EncodedMeshTexture(new Uint8Array(z))):this._context.loadImage(this._resolveUri(C.uri),z);if(null==C.bufferView)throw new b("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==C.mimeType)throw new b("gltf-loader-unsupported-feature","Image mimeType must be defined.");const J=this.json.bufferViews[C.bufferView];
z=await this.getBuffer(J.buffer,z);if(null!=J.byteStride)throw new b("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return t.imageFromBinaryData(new Uint8Array(z.buffer,z.byteOffset+(J.byteOffset||0),J.byteLength),C.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const C=await k.allSettledValues(Array.from(this._bufferLoaders.values())),z=await k.allSettledValues(Array.from(this._textureLoaders.values()));return C.reduce((J,
K)=>J+(K?.byteLength??0),0)+z.reduce((J,K)=>J+(K?t.isEncodedMeshTexture(K)?K.data.byteLength:K.width*K.height*4:0),0)}}const E=f.fromXRotation(g.create(),Math.PI/2),A=new d.Version(2,0,"glTF"),B=n.create(),F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},G={[r.DataType.BYTE]:1,[r.DataType.UNSIGNED_BYTE]:1,[r.DataType.SHORT]:2,[r.DataType.UNSIGNED_SHORT]:2,[r.DataType.FLOAT]:4,[r.DataType.INT]:4,[r.DataType.UNSIGNED_INT]:4},H=/\.gltf$/i,L=/\.glb$/i;a.GLTFResource=D;a.transformGltfToEngine=E;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(c,k){const m=c.count;k||=new c.TypedArrayConstructor(m);for(let d=0;d<m;d++)k[d]=c.get(d);return k}const h=Object.freeze(Object.defineProperty({__proto__:null,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.makeDense=b;a.scalar=h})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){class b{constructor(h){this._data=
h;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const h=this._offset4;this._offset4+=1;return this._dataUint32[h]}readUint8Array(h){const c=4*this._offset4;this._offset4+=h/4;return new Uint8Array(this._data,c,h)}remainingBytes(){return this._data.byteLength-4*this._offset4}}a.BinaryStreamReader=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=
void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils",
"../../../webgl/enums"],function(a,b,h){const c={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},k={pbrMetallicRoughness:c,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},m={ESRI_externalColorMixMode:"tint"},d={magFilter:h.TextureSamplingMode.LINEAR,minFilter:h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:h.TextureWrapMode.REPEAT,wrapT:h.TextureWrapMode.REPEAT};a.material=(f={})=>{const g={...c,...f.pbrMetallicRoughness};var e={...m,...f.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:b.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...k,...f,pbrMetallicRoughness:g,extras:e}};a.textureSampler=f=>({...d,...f});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let h,c;b.replace(/^(.*\/)?([^/]*)$/,(k,m,d)=>{h=m||"";c=d||"";return""});return{dirPart:h,filePart:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(a,b,h,c){a.convertPrimitiveToTriangles=function(k,m){switch(m){case c.PrimitiveType.TRIANGLES:return k="number"===typeof k?h.getContinuousIndexArray(k):b.isUint8Array(k)?new Uint16Array(k):k,k;case c.PrimitiveType.TRIANGLE_STRIP:m="number"===typeof k?k:k.length;if(3>m)k=[];else{m-=2;var d=h.newIndexArray(3*m);if("number"===
typeof k){k=0;for(var f=0;f<m;f+=1)0===f%2?(d[k++]=f,d[k++]=f+1):(d[k++]=f+1,d[k++]=f),d[k++]=f+2}else{f=0;for(var g=0;g<m;g+=1)0===g%2?(d[f++]=k[g],d[f++]=k[g+1]):(d[f++]=k[g+1],d[f++]=k[g]),d[f++]=k[g+2]}k=d}return k;case c.PrimitiveType.TRIANGLE_FAN:m="number"===typeof k?k:k.length;if(3>m)k=new Uint16Array(0);else{m-=2;d=65536>=m?new Uint16Array(3*m):new Uint32Array(3*m);if("number"===typeof k)for(k=0,f=0;f<m;++f)d[k++]=0,d[k++]=f+1,d[k++]=f+2;else{f=k[0];g=k[1];var e=0;for(let n=0;n<m;++n){const l=
k[n+2];d[e++]=f;d[e++]=g;g=d[e++]=l}}k=d}return k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],function(a){class b{constructor(){this.geometries=[];this.materials=[];this.textures=[]}}class h{constructor(c,k,m){this.name=c;this.lodThreshold=k;this.pivotOffset=m;this.stageResources=new b;this.numberOfVertices=0}}a.ProcessedObjectResource=h;a.ProcessedObjectStageResources=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/Indices ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){async function y(z,J){const K=J?.streamDataRequester;if(K)return D(z,K,J);z=await h.result(b(z,J));if(!0===z.ok)return z.value.data;f.throwIfAbortError(z.error);E(z.error)}async function D(z,J,K){z=await h.result(J.request(z,"json",K));if(!0===z.ok)return z.value;f.throwIfAbortError(z.error);E(z.error.details.url)}function E(z){throw new k("",`Request for object resource failed: ${z}`);}function A(z){var J=z.params,K=J.topology;let I=!0;J.vertexAttributes||
(L().warn("Geometry must specify vertex attributes"),I=!1);switch(J.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:K=J.faces;if(!K)L().warn("Indexed geometries must specify faces"),I=!1;else if(J.vertexAttributes)for(const M in J.vertexAttributes)J=K[M],J?.values?(null!=J.valueType&&"UInt32"!==J.valueType&&(L().warn(`Unsupported indexed geometry indices type '${J.valueType}', only UInt32 is currently supported`),I=!1),null!=J.valuesPerElement&&1!==J.valuesPerElement&&
(L().warn(`Unsupported indexed geometry values per element '${J.valuesPerElement}', only 1 is currently supported`),I=!1)):(L().warn(`Indexed geometry does not specify face indices for '${M}' attribute`),I=!1);break;default:L().warn(`Unsupported topology '${K}'`),I=!1}z.params.material||(L().warn("Geometry requires material"),I=!1);z=z.params.vertexAttributes;for(const M in z)z[M].values||(L().warn("Geometries with externally defined attributes are not yet supported"),I=!1);return I}function B(z){const J=
n.empty();z.forEach(K=>{K=K.boundingInfo;null!=K&&(n.expandWithVec3(J,K.bbMin),n.expandWithVec3(J,K.bbMax))});return J}async function F(z,J){const K=[];for(const S in z){var I=z[S],M=I.images[0].data;if(!M){L().warn("Externally referenced texture data is not yet supported");continue}M=I.encoding+";base64,"+M;const N="/textureDefinitions/"+S,V="rgba"===I.channels?I.alphaChannelUsage||"transparency":"none",Q={noUnpackFlip:!0,wrap:{s:r.TextureWrapMode.REPEAT,t:r.TextureWrapMode.REPEAT},preMultiplyAlpha:G(V)!==
w.AlphaDiscardMode.Opaque};I=null!=J&&J.disableTextures?Promise.resolve(null):u.requestImage(M,J);K.push(I.then(T=>({refId:N,image:T,parameters:Q,alphaChannelUsage:V})))}z=await Promise.all(K);J={};for(const S of z)J[S.refId]=S;return J}function G(z){switch(z){case "mask":return w.AlphaDiscardMode.Mask;case "maskAndTransparency":return w.AlphaDiscardMode.MaskBlend;case "none":return w.AlphaDiscardMode.Opaque;case "transparency":return w.AlphaDiscardMode.Blend;default:return w.AlphaDiscardMode.Blend}}
function H(z){z=z.params;return{id:1,material:z.material,texture:z.texture,region:z.texture}}const L=()=>m.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),C=new g.Version(1,2,"wosr");a.createTextureResources=F;a.load=async function(z,J){z=await y(z,J);J=await F(z.textureDefinitions??{},J);let K=0;for(const I in J)if(J.hasOwnProperty(I)){const M=J[I];K+=M?.image?M.image.width*M.image.height*4:0}return{resource:z,textures:J,size:K+c.estimateNestedObjectSize(z)}};a.processLoadResult=function(z,
J){const K=[],I=[],M=[],S=new d.NestedMap,N=z.resource;var V=g.Version.parse(N.version||"1.0","wosr");C.validate(V);V=N.model.name;const Q=N.model.geometries,T=N.materialDefinitions??{};z=z.textures;let ia=0;const O=new Map;for(let fa=0;fa<Q.length;fa++){const aa=Q[fa];if(!A(aa))continue;var U=H(aa),P=aa.params.vertexAttributes;const Z=[];var R=ea=>{if("PerAttributeArray"===aa.params.topology)return null;const ca=aa.params.faces;for(const W in ca)if(W===ea)return ca[W].values;return null},ba=P[p.VertexAttribute.POSITION];
ba=ba.values.length/ba.valuesPerElement;for(const ea in P){var X=P[ea],da=X.values,ha=R(ea)??l.getContinuousIndexArray(ba);Z.push([ea,new x.Attribute(da,ha,X.valuesPerElement,!0)])}P=U.texture;if((R=z&&z[P])&&!O.has(P)){const {image:ea,parameters:ca}=R;ba=new v.Texture(ea,ca);I.push(ba);O.set(P,ba)}ba=(ba=O.get(P))?ba.id:void 0;U=U.material;X=S.get(U,P);null==X&&(X=U.substring(U.lastIndexOf("/")+1),X=T[X].params,1===X.transparency&&(X.transparency=0),da=R&&R.alphaChannelUsage,da=0<X.transparency||
"transparency"===da||"maskAndTransparency"===da,ha=R?G(R.alphaChannelUsage):void 0,R={ambient:e.fromArray(X.diffuse),diffuse:e.fromArray(X.diffuse),opacity:1-(X.transparency||0),transparent:da,textureAlphaMode:ha,textureAlphaCutoff:.33,textureId:ba,initTextureTransparent:!0,doubleSided:!0,cullFace:w.CullFaceOptions.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:R?.parameters.preMultiplyAlpha??!1},J?.materialParameters&&Object.assign(R,J.materialParameters),X=new t.DefaultMaterial(R),
S.set(U,P,X));M.push(X);P=new q.Geometry(X,Z);ia+=Z.find(ea=>ea[0]===p.VertexAttribute.POSITION)?.[1]?.indices.length??0;K.push(P)}return{engineResources:[{name:V,stageResources:{textures:I,materials:M,geometries:K},pivotOffset:N.model.pivotOffset,numberOfVertices:ia,lodThreshold:null}],referenceBoundingBox:B(K)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.colorGamma=
2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/webStyleUtils":function(){define(["exports","../../../../core/Error","../../../../symbols/support/styleUtils","../../../../symbols/support/webStyleSymbolUtils"],function(a,b,h,c){a.getResourceUrlFromSymbolStyle=async function(k){if(null===k||null==k.styleName&&null==k.styleUrl)return null;var m=k.name;if(null==m)throw new b("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");
const d={portal:k.portal};k=await h.fetchStyle(k,d).catch(()=>null);if(null===k)return null;const f=c.getStyleItemFromStyle(m,k.data);if(f&&!f.formatInfos?.some(g=>"gltf_basisu"===g.type))return null;m=await c.fetchSymbolFromStyle(k,m,d,"webRef",(g,e)=>h.symbolUrlFromStyleItem(g,e,["gltf_basisu","gltf"])).catch(()=>null);if(null===m||"point-3d"!==m.type)return null;m=m.symbolLayers.items[0];return"object"===m.type?m.resource:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(w,q){return q.items.find(v=>v.name===w)}function u(w,q,v,p,t,r){const y=null!=v?.portal?v.portal:m.getDefault(),D={portal:y,url:k.urlToObject(w.baseUrl),origin:"portal-item"},E=l(q,w.data);if(!E)return Promise.reject(new c("symbolstyleutils:symbol-name-not-found",`The symbol name '${q}' could not be found`,{symbolName:q}));t=d.fromJSON(t(E,p),D);let A=E.thumbnail?.href??null;const B=E.thumbnail?.imageData;h.isDevEnvironment()&&(t=h.adjustStaticAGOUrl(t)??
"",A=h.adjustStaticAGOUrl(A));const F={portal:y,url:k.urlToObject(k.removeFile(t)),origin:"portal-item"};return e.requestJSON(t,r).then(G=>{G="cimRef"===p?e.makeCIMSymbolRef(G.data):G.data;if((G=f.fromJSON(G,F))&&b.isSymbol3D(G)){if(A){const H=d.fromJSON(A,D);G.thumbnail=new n.Thumbnail({url:H})}else B&&(G.thumbnail=new n.Thumbnail({url:`data:image/png;base64,${B}`}));w.styleUrl?G.styleOrigin=new g({portal:v.portal,styleUrl:w.styleUrl,name:q}):w.styleName&&(G.styleOrigin=new g({portal:v.portal,styleName:w.styleName,
name:q}))}return G})}function x(w,q,v){const p=e.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,w),t=null!=q.portal?q.portal:m.getDefault();return e.requestJSON(p,v).then(r=>{r=e.makeCIMSymbolRef(r.data);return f.fromJSON(r,{portal:t,url:k.urlToObject(k.removeFile(p)),origin:"portal-item"})})}a.fetchSymbolFromStyle=u;a.getStyleItemFromStyle=l;a.resolveWebStyleSymbol=function(w,q,v,p){const t=w.name;return null==t?Promise.reject(new c("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
w.styleName&&"Esri2DPointSymbolsStyle"===w.styleName?x(t,q,p):e.fetchStyle(w,q,p).then(r=>u(r,t,q,v,e.symbolUrlFromStyleItem,p))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M){function S(ba,X,da){const ha=ba.allocateHead();ba=ba.view;J.encodeDoubleVec3(X.modelOrigin,da,ba.modelOriginHi,ba.modelOriginLo,ha);ba.model.copyFrom(ha,X.model,da);ba.modelNormal.copyFrom(ha,X.modelNormal,da);X.color&&ba.color&&ba.color.copyFrom(ha,X.color,da);X.objectAndLayerIdColor&&ba.objectAndLayerIdColor&&ba.objectAndLayerIdColor.copyFrom(ha,X.objectAndLayerIdColor,da);X.featureAttribute&&ba.featureAttribute&&ba.featureAttribute.copyFrom(ha,
X.featureAttribute,da)}function N(ba){let X=q.newLayout().vec3f(B.VertexAttribute.INSTANCEMODELORIGINHI).vec3f(B.VertexAttribute.INSTANCEMODELORIGINLO).mat3f(B.VertexAttribute.INSTANCEMODEL).mat3f(B.VertexAttribute.INSTANCEMODELNORMAL);null!=ba&&ba.includes("featureAttribute")&&(X=X.vec4f(B.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=ba&&ba.includes("color")&&(X=X.vec4u8(B.VertexAttribute.INSTANCECOLOR));null!=ba&&ba.includes("objectAndLayerIdColor")&&(X=X.vec4u8(B.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));
return X}const V=ba=>{const X=ba.baseBoundingSphere.radius;ba=ba.levels.map(da=>da.minScreenSpaceRadius);return new H.LevelSelector(X,ba)};a.LodRenderer=class extends p.ASyncPreparesRenderPlugin{constructor(ba,X){super(ba);this.type=y.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[[]];this._highlightRenderInstanceData=[[]];this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]];this._cycleStartIndex=this._instanceIndex=
0;this._slicePlane=!1;this._camera=new t.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.produces=new Map([[E.RenderSlot.OPAQUE_MATERIAL,da=>this._produces(da)],[E.RenderSlot.TRANSPARENT_MATERIAL,da=>this._hasTransparentLevels()?this._produces(da):!1]]);this._instanceData=new F.InstanceData({shaderTransformation:ba.shaderTransformation},ba.optionalFields);this.addHandles(X.registerTask(I.TaskPriority.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=N(this.optionalFields);
this._glInstanceBufferLayout=w.glLayout(this._instanceBufferLayout,1);this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:ba})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(ba)}),this._instanceData.events.on("instance-visibility-changed",({index:ba})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(ba)}),this._instanceData.events.on("instance-highlight-changed",
()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return 1<this.symbol.levels.length}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(ba){this._slicePlane=ba}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((ba,
X)=>X.reduce((da,ha)=>da+ha.usedMemory,ba),0)}get renderStats(){const ba=this._instanceData.size,X=[];this._levels.forEach((da,ha)=>{ha=this._allRenderInstanceData[0][ha].size+this._allRenderInstanceData[1][ha].size;da=da.triangleCount;X.push({renderedInstances:ha,renderedTriangles:ha*da,trianglesPerInstance:da})});return{totalInstances:ba,renderedInstances:X.reduce((da,ha)=>da+ha.renderedInstances,0),renderedTriangles:X.reduce((da,ha)=>da+ha.renderedTriangles,0),levels:X}}async initializeRenderContext(ba,
X){this._context=ba;const da=ba.renderContext.rctx,ha=await Promise.allSettled(this.symbol.levels.map(aa=>{this._defaultRenderInstanceData[0].push(new C.RenderInstanceData(da,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new C.RenderInstanceData(da,this._instanceBufferLayout));return L.LodLevel.create(ba,aa,X)})),fa=ha.map(aa=>"fulfilled"===aa.status?aa.value:null).filter(h.isSome);if(k.isAborted(X)||fa.length!==ha.length){fa.forEach(aa=>aa.destroy());k.throwIfAborted(X);
for(const aa of ha)if("rejected"===aa.status)throw aa.reason;}this._levels=fa;this._levelSelector=V(this)}uninitializeRenderContext(){this._invalidateOctree();this._levels.forEach(ba=>ba.destroy());this._defaultRenderInstanceData[0].forEach(ba=>ba.destroy());this._highlightRenderInstanceData[0].forEach(ba=>ba.destroy())}_hasTransparentLevels(){return this._levels.some(ba=>ba.components.some(X=>(X=X.material.produces.get(E.RenderSlot.TRANSPARENT_MATERIAL))&&X(v.ShaderOutput.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(ba=>
0<ba.size)}_produces(ba){return ba!==v.ShaderOutput.Highlight&&ba!==v.ShaderOutput.ShadowHighlight||this.hasHighlights()}prepareRender(ba){if(!x.debugFlags.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const X=ba.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(ba.bindParameters.contentCamera);X||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(I.noBudget),this._needFullCycle=!1)}}prepareTechniques(ba){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleForOutput(ba.output))return null;const X=this._getInstanceDatas(ba.output);if(!X)return null;const da=[];X.forEach(ha=>this.levels.forEach((fa,aa)=>{fa.components.forEach(Z=>da.push(this._beginComponent(ba,ha[aa],Z)))}));return da}renderNode(ba,X){const da=this._getInstanceDatas(ba.output);if(da&&null!=X){var ha=0;ba.rctx.bindVAO();da.forEach(fa=>this.levels.forEach((aa,Z)=>{aa.components.forEach(ea=>this._renderComponent(ba,X[ha++],fa[Z],ea,Z))}))}}_getInstanceDatas(ba){const X=
ba!==v.ShaderOutput.Highlight&&ba!==v.ShaderOutput.ShadowHighlight;ba=ba!==v.ShaderOutput.ShadowExcludeHighlight;return X&&ba?this._allRenderInstanceData:X?this._defaultRenderInstanceData:ba?this._highlightRenderInstanceData:null}intersect(ba,X,da,ha){if(this.baseMaterial.isVisible()&&null!=this._octree){var fa=l.create();n.subtract(fa,ha,da);var aa=Z=>{this._instanceData.getCombinedModelTransform(Z,ia);ba.transform.set(ia);n.transformMat4(O,da,ba.transform.inverse);n.transformMat4(U,ha,ba.transform.inverse);
const ea=this._instanceData.getState(Z),ca=this._instanceData.getLodLevel(Z),W=this._levels.length;A.assert(0!==(ea&F.StateFlags.ACTIVE),"invalid instance state");A.assert(0<=ca&&ca<W,"invaid lod level");this._levels[ca].intersect(ba,X,O,U,Z,this.metadata,W)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(aa):this._octree.forEachAlongRay(da,fa,aa)}}notifyShaderTransformationChanged(){this._invalidateOctree();this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const ba=
this._instanceData,X=ba.view?.state;if(!X)return null;this._octreeCached=new G.InstanceOctree(ba,this.baseBoundingSphere);for(let da=0;da<ba.capacity;++da)X.get(da)&F.StateFlags.ACTIVE&&this._octreeCached.addInstance(da)}return this._octreeCached}_invalidateOctree(){this._octreeCached=c.destroyMaybe(this._octreeCached)}queryDepthRange(ba){if(null==this._octree)return{near:Infinity,far:-Infinity};var X=ba.viewForward,da=this._octree.findClosest(X,D.DepthOrder.FRONT_TO_BACK,ba.frustum);const ha=this._octree.findClosest(X,
D.DepthOrder.BACK_TO_FRONT,ba.frustum);if(null==da||null==ha)return{near:Infinity,far:-Infinity};const fa=ba.eye,aa=this._instanceData.view;aa.boundingSphere.getVec(da,T);n.subtract(T,T,fa);da=n.dot(T,X)-T[3];aa.boundingSphere.getVec(ha,T);n.subtract(T,T,fa);X=n.dot(T,X)+T[3];return{near:Math.max(ba.near,da),far:Math.min(ba.far,X)}}_requestUpdateCycle(ba=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;ba&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++;
this._allRenderInstanceData.forEach(ba=>ba.forEach(X=>X.startUpdateCycle()))}get running(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}runTask(ba){const {_enableLevelSelection:X,_camera:da,_levelSelector:ha}=this;this._allRenderInstanceData.forEach(oa=>oa.forEach(ra=>ra.beginUpdate()));const fa=this._instanceData,aa=fa.view;let Z=fa.size;const ea=fa.capacity;let ca=this._instanceIndex;const W=Math.ceil(ea/500);for(let oa=0;oa<Z&&!ba.done;++oa){ca===this._cycleStartIndex&&
this._startUpdateCycle();const ra=aa.state.get(ca);var Y=0;if(ra&F.StateFlags.ALLOCATED){var ja=aa.lodLevel.get(ca);ra&F.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][ja].freeTail();ra&F.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][ja].freeTail();ra&F.StateFlags.REMOVE?fa.freeInstance(ca):ra&F.StateFlags.VISIBLE?(ja=0,X&&(aa.modelOrigin.getVec(ca,Q),ja=ha.selectLevel(Q,fa.getCombinedMedianScaleFactor(ca),da)),Y=ra&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED),
0<=ja&&(ra&F.StateFlags.HIGHLIGHT?(S(this._highlightRenderInstanceData[0][ja],aa,ca),Y|=F.StateFlags.HIGHLIGHT_ACTIVE):(S(this._defaultRenderInstanceData[0][ja],aa,ca),Y|=F.StateFlags.DEFAULT_ACTIVE)),aa.state.set(ca,Y),aa.lodLevel.set(ca,ja)):(Y=ra&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED),aa.state.set(ca,Y));null!=this._octreeCached&&(ja=!!(ra&F.StateFlags.ACTIVE),Y=!!(Y&F.StateFlags.ACTIVE),!ja&&Y?this._octreeCached.addInstance(ca):ja&&!Y?this._octreeCached.removeInstance(ca):ja&&Y&&
ra&F.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ca),this._octreeCached.addInstance(ca)));ca=ca+1===ea?0:ca+1;0===ca%W&&ba.madeProgress()}else ca=ca+1===ea?0:ca+1,Z++}this._instanceIndex=ca;this._allRenderInstanceData.forEach(oa=>oa.forEach(ra=>ra.endUpdate()));this._context.requestRender()}_beginComponent(ba,X,da){if(0===X.size)return null;X=da.glMaterials.load(ba.rctx,ba.bindParameters.slot,ba.output);return null!=X?X.beginSlot(ba.bindParameters):null}_renderComponent(ba,X,
da,ha,fa){if(X){var {bindParameters:aa,rctx:Z}=ba;Z.runAppleAmdDriverHelper();var ea=Z.bindTechnique(X,aa,ha.material.parameters,R);Z.bindVAO(ha.vao);X.ensureAttributeLocations(ha.vao);x.debugFlags.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&ba.output===v.ShaderOutput.Color&&(ea.setUniform4fv("externalColor",P[Math.min(fa,P.length-1)]),ea.setUniform1i("colorMixMode",z.colorMixModes.replace));ba=da.capacity;fa=da.headIndex;ea=da.tailIndex;var ca=da.firstIndex,W=this._glInstanceBufferLayout,Y=(ja,oa)=>
{M.bindVertexBufferLayout(Z,r.Default3D,da.buffer,W,ja);Z.drawArraysInstanced(X.primitiveType,0,ha.vertexCount,oa-ja);M.unbindVertexBufferLayout(Z,r.Default3D,da.buffer,W)};ha.material.parameters.transparent&&null!=ca?fa>ea?(A.assert(ca>=ea&&ca<=fa,"invalid firstIndex"),Y(ca,fa),Y(ea,ca)):fa<ea&&(ca<=fa?(A.assert(0<=ca&&ca<=fa,"invalid firstIndex"),Y(ca,fa),Y(ea,ba),Y(0,ca)):(A.assert(ca>=ea&&ca<=ba,"invalid firstIndex"),Y(ca,ba),Y(0,fa),Y(ea,ca))):fa>ea?Y(ea,fa):fa<ea&&(Y(0,fa),Y(ea,ba));Z.bindVAO(null)}}};
b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"metadata",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_instanceData",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_cycleStartIndex",
void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);b.__decorate([m.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"running",null);a.LodRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const Q=l.create(),T=u.create(),ia=e.create(),O=l.create(),U=l.create(),P=[u.fromValues(1,0,1,1),u.fromValues(0,
0,1,1),u.fromValues(0,1,0,1),u.fromValues(1,1,0,1),u.fromValues(1,0,0,1)],R=new K.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y){a.StateFlags=void 0;(function(G){G[G.ALLOCATED=1]="ALLOCATED";G[G.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";G[G.VISIBLE=4]="VISIBLE";G[G.HIGHLIGHT=8]="HIGHLIGHT";G[G.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";G[G.REMOVE=32]="REMOVE";G[G.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";G[G.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));class D{constructor(G){this.localTransform=G.getField(r.VertexAttribute.LOCALTRANSFORM,q.BufferViewMat4f64);this.globalTransform=
G.getField(r.VertexAttribute.GLOBALTRANSFORM,q.BufferViewMat4f64);this.modelOrigin=G.getField(r.VertexAttribute.MODELORIGIN,q.BufferViewVec3f64);this.model=G.getField(r.VertexAttribute.INSTANCEMODEL,q.BufferViewMat3f);this.modelNormal=G.getField(r.VertexAttribute.INSTANCEMODELNORMAL,q.BufferViewMat3f);this.modelScaleFactors=G.getField(r.VertexAttribute.MODELSCALEFACTORS,q.BufferViewVec2f);this.boundingSphere=G.getField(r.VertexAttribute.BOUNDINGSPHERE,q.BufferViewVec4f64);this.featureAttribute=G.getField(r.VertexAttribute.FEATUREATTRIBUTE,
q.BufferViewVec4f);this.color=G.getField(r.VertexAttribute.COLOR,q.BufferViewVec4u8);this.objectAndLayerIdColor=G.getField(r.VertexAttribute.OBJECTANDLAYERIDCOLOR,q.BufferViewVec4u8);this.state=G.getField(r.VertexAttribute.STATE,q.BufferViewUint8);this.lodLevel=G.getField(r.VertexAttribute.LODLEVEL,q.BufferViewUint8)}}a.InstanceData=class extends h{constructor(G,H){super(G);this.events=new k;this._next=this._size=this._capacity=0;G=p.newLayout().mat4f64(r.VertexAttribute.LOCALTRANSFORM).mat4f64(r.VertexAttribute.GLOBALTRANSFORM).vec4f64(r.VertexAttribute.BOUNDINGSPHERE).vec3f64(r.VertexAttribute.MODELORIGIN).mat3f(r.VertexAttribute.INSTANCEMODEL).mat3f(r.VertexAttribute.INSTANCEMODELNORMAL).vec2f(r.VertexAttribute.MODELSCALEFACTORS);
H.includes(r.VertexAttribute.FEATUREATTRIBUTE)&&(G=G.vec4f(r.VertexAttribute.FEATUREATTRIBUTE));H.includes(r.VertexAttribute.COLOR)&&(G=G.vec4u8(r.VertexAttribute.COLOR));H.includes(r.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(G=G.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR));this._layout=G=G.u8(r.VertexAttribute.STATE).u8(r.VertexAttribute.LODLEVEL);this._capacity=y.initialCapacity;this._buffer=this._layout.createBuffer(this._capacity);this._view=new D(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+
1>this._capacity&&this._grow();const G=this._findSlot();this._view.state.set(G,a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return G}removeInstance(G){const H=this._view.state;t.assert(0<=G&&G<this._capacity&&0!==(H.get(G)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(G,a.StateFlags.ACTIVE)?this._setStateFlags(G,a.StateFlags.REMOVE):this.freeInstance(G);this.events.emit("instances-changed")}freeInstance(G){const H=this._view.state;t.assert(0<=
G&&G<this._capacity&&0!==(H.get(G)&a.StateFlags.ALLOCATED),"invalid instance handle");H.set(G,0);this._size--}setLocalTransform(G,H,L=!0){this._view.localTransform.setMat(G,H);L&&this.updateModelTransform(G)}getLocalTransform(G,H){this._view.localTransform.getMat(G,H)}setGlobalTransform(G,H,L=!0){this._view.globalTransform.setMat(G,H);L&&this.updateModelTransform(G)}getGlobalTransform(G,H){this._view.globalTransform.getMat(G,H)}updateModelTransform(G){const H=this._view;var L=E;const C=A;H.localTransform.getMat(G,
B);H.globalTransform.getMat(G,F);const z=l.multiply(F,F,B);x.set(L,z[12],z[13],z[14]);H.modelOrigin.setVec(G,L);e.fromMat4(C,z);H.model.setMat(G,C);L=v.scaleFromMatrix(E,z);L.sort();H.modelScaleFactors.set(G,0,L[1]);H.modelScaleFactors.set(G,1,L[2]);e.invert(C,C);e.transpose(C,C);H.modelNormal.setMat(G,C);this._setStateFlags(G,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:G})}getModelTransform(G,H){const L=this._view;L.model.getMat(G,A);L.modelOrigin.getVec(G,
E);H[0]=A[0];H[1]=A[1];H[2]=A[2];H[3]=0;H[4]=A[3];H[5]=A[4];H[6]=A[5];H[7]=0;H[8]=A[6];H[9]=A[7];H[10]=A[8];H[11]=0;H[12]=E[0];H[13]=E[1];H[14]=E[2];H[15]=1}applyShaderTransformation(G,H){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,G,H)}getCombinedModelTransform(G,H){this.getModelTransform(G,H);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,G,H);return H}getCombinedLocalTransform(G,H){this._view.localTransform.getMat(G,H);null!=this.shaderTransformation&&
this.shaderTransformation.applyTransform(this,G,H)}getCombinedMaxScaleFactor(G){let H=this._view.modelScaleFactors.get(G,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(E,this,G),H*=Math.max(E[0],E[1],E[2]));return H}getCombinedMedianScaleFactor(G){let H=this._view.modelScaleFactors.get(G,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(E,this,G);G=E[0];var L=E[1];H*=Math.max(Math.min(G,L),Math.min(Math.max(G,L),E[2]))}return H}getModel(G,H){this._view.model.getMat(G,
H)}setFeatureAttribute(G,H){this._view.featureAttribute.setVec(G,H)}getFeatureAttribute(G,H){this._view.featureAttribute.getVec(G,H)}setColor(G,H){this._view.color.setVec(G,H)}setObjectAndLayerIdColor(G,H){this._view.objectAndLayerIdColor.setVec(G,H)}setVisible(G,H){H!==this.getVisible(G)&&(this._setStateFlag(G,a.StateFlags.VISIBLE,H),this.events.emit("instance-visibility-changed",{index:G}))}getVisible(G){return this._getStateFlag(G,a.StateFlags.VISIBLE)}setHighlight(G,H){H!==this.getHighlight(G)&&
(this._setStateFlag(G,a.StateFlags.HIGHLIGHT,H),this.events.emit("instance-highlight-changed"))}getHighlight(G){return this._getStateFlag(G,a.StateFlags.HIGHLIGHT)}getState(G){return this._view.state.get(G)}getLodLevel(G){return this._view.lodLevel.get(G)}countFlags(G){let H=0;for(let L=0;L<this._capacity;++L)this.getState(L)&G&&++H;return H}_setStateFlags(G,H){const L=this._view.state;H|=L.get(G);L.set(G,H)}_clearStateFlags(G,H){const L=this._view.state;H=L.get(G)&~H;L.set(G,H)}_setStateFlag(G,H,
L){L?this._setStateFlags(G,H):this._clearStateFlags(G,H)}_getStateFlag(G,H){return!!(this._view.state.get(G)&H)}_grow(){this._capacity=Math.max(y.initialCapacity,Math.floor(this._capacity*c.reallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);this._view=new D(this._buffer)}_findSlot(){const G=this._view.state;let H=this._next;for(;G.get(H)&a.StateFlags.ALLOCATED;)H=H+1===this._capacity?0:H+1;this._next=H+1===this._capacity?0:H+1;return H}};b.__decorate([m.property({constructOnly:!0})],
a.InstanceData.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.InstanceData.prototype,"_size",void 0);b.__decorate([m.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const E=w.create(),A=n.create(),B=u.create(),F=u.create();a.InstanceDataView=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,h,c,k,m){class d{constructor(g){this.modelOriginHi=g.getField(k.VertexAttribute.INSTANCEMODELORIGINHI,h.BufferViewVec3f);this.modelOriginLo=g.getField(k.VertexAttribute.INSTANCEMODELORIGINLO,h.BufferViewVec3f);this.model=g.getField(k.VertexAttribute.INSTANCEMODEL,h.BufferViewMat3f);this.modelNormal=g.getField(k.VertexAttribute.INSTANCEMODELNORMAL,h.BufferViewMat3f);this.featureAttribute=g.getField(k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,h.BufferViewVec4f);this.color=g.getField(k.VertexAttribute.INSTANCECOLOR,
h.BufferViewVec4u8);this.objectAndLayerIdColor=g.getField(k.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,h.BufferViewVec4u8)}}class f{constructor(g,e){this._rctx=g;this._instanceBufferLayout=e;this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const g=
this._headIndex,e=this._tailIndex;return g>=e?g-e:g+this._capacity-e}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._tailIndex=this._headIndex=0;this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){c.assert(!this._updating,
"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex}endUpdate(){c.assert(this._updating,"not updating");this.size<b.reallocShrinkThreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1}allocateHead(){c.assert(this._updating,"not updating");this.isFull&&this._grow();const g=this.headIndex;this._captureFirstIndex&&(this._firstIndex=g,this._captureFirstIndex=!1);
this._incrementHead();c.assert(this._headIndex!==this._tailIndex,"invalid pointers");return g}freeTail(){c.assert(this._updating,"not updating");c.assert(0<this.size,"invalid size");const g=this._tailIndex===this._firstIndex;this._incrementTail();g&&(this._firstIndex=this._tailIndex)}_grow(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocGrowthFactor)))}_shrink(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocShrinkFactor)))}_resize(g){c.assert(this._updating,"not updating");
if(g!==this._capacity){var e=new m(this._rctx,this._instanceBufferLayout.stride,g);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const n=this.size,l=this._compactInstances(e);c.assert(l===n,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=l;this._prevHeadIndex=0}this._resized=!0;this._capacity=g;this._buffer=e;this._view=new d(this._instanceBufferLayout.createView(this._buffer.array))}}_compactInstances(g){const e=
this._headIndex,n=this._tailIndex;return n<e?(this._buffer.copyRange(n,e,g),e-n):n>e?(this._buffer.copyRange(n,this._capacity,g),0<e&&this._buffer.copyRange(0,e,g,this._capacity-n),e+(this._capacity-n)):0}_incrementHead(g=1){this._headIndex=(this._headIndex+g)%this._capacity}_incrementTail(g=1){this._tailIndex=(this._tailIndex+g)%this._capacity}_transferRange(g,e){g<e?this._buffer.transferRange(g,e):g>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(g,this._capacity))}}a.RenderInstanceData=
f;a.RenderInstanceDataView=d;a.initialCapacity=64;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b){class h{constructor(c,k,m){this._elementSize=k;this._buffer=a.BufferObject.createVertex(c,b.Usage.STATIC_DRAW);this.resize(m)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+
this._buffer.usedMemory}copyRange(c,k,m,d=0){c=new Uint8Array(this.array,c*this.elementSize,(k-c)*this.elementSize);(new Uint8Array(m.array,d*this.elementSize)).set(c)}transferAll(){this._buffer.setData(this._array)}transferRange(c,k){c*=this._elementSize;k*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),c,c,k)}resize(c){const k=c*this._elementSize,m=new ArrayBuffer(k);this._array&&(c>=this._capacity?(new Uint8Array(m)).set(new Uint8Array(this._array)):(new Uint8Array(m)).set((new Uint8Array(this._array)).subarray(0,
c*this._elementSize)));this._array=m;this._buffer.setSize(k);this._capacity=c}}return h})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,h,c,k,m){class d extends m{constructor(f,g){super(e=>c.wrap(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25});this._instanceData=
f;this._boundingSphere=g;this._tmpSphere=c.create();this._tmpMat4=b.create()}addInstance(f){const g=this._instanceData.view.boundingSphere,e=this._instanceData.getCombinedModelTransform(f,this._tmpMat4);h.transformMat4(c.getCenter(this._tmpSphere),this._boundingSphere.center,e);this._tmpSphere[3]=this._boundingSphere.radius*k.maxScale(e);g.setVec(f,this._tmpSphere);this.add([f])}removeInstance(f){this.remove([f])}}a.InstanceOctree=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],function(a){class b{constructor(h,c){this._worldSpaceRadius=h;this._minScreenSpaceRadii=c}selectLevel(h,c,k){h=k.computeScreenPixelSizeAt(h);c=this._worldSpaceRadius*c/h;h=0;for(k=1;k<this._minScreenSpaceRadii.length;++k)c>=this._minScreenSpaceRadii[k]&&(h=k);return h}}a.LevelSelector=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,h,c,k,m){class d{static async create(f,g,e){const n=await Promise.allSettled(g.components.map(u=>f.controller.schedule(()=>new m.LodComponentData(f,u),e))),l=n.map(u=>"fulfilled"===u.status?u.value:null).filter(b.isSome);if(h.isAborted(e)||l.length!==n.length){l.forEach(u=>u.destroy());h.throwIfAborted(e);for(const u of n)if("rejected"===u.status)throw u.reason;}return new d(g.minScreenSpaceRadius,l)}constructor(f,g){this.minScreenSpaceRadius=f;this.components=g}destroy(){this.components.forEach(f=>
f.destroy())}intersect(f,g,e,n,l,u,x){this.components.forEach(w=>w.intersect(f,g,e,n,l,u,this.boundingSphere,x))}get boundingBox(){if(null==this._boundingBox){const f=k.empty();this.components.forEach(g=>{null!=g.boundingInfo&&(k.expandWithVec3(f,g.boundingInfo.bbMin),k.expandWithVec3(f,g.boundingInfo.bbMax))});this._boundingBox=f}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const f=this.boundingBox,g=c.create();k.center(f,g);this._boundingSphere={center:g,radius:.5*
k.diameter(f)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((f,g)=>f+g.triangleCount,0)}}a.LodLevel=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(l,u){const x=l.renderContext.rctx;u=u.geometry;this._materialRepository=l.materialRepository;u.material.setParameters({instancedDoublePrecision:!0});l=u.material.createBufferWriter();const w=l.vertexBufferLayout,q=l.elementCount(u),v=w.createBuffer(q);l.write(null,null,u,v,0);this.geometry=u;this.material=u.material;this.glMaterials=new c.GLMaterials(u.material,this._materialRepository);this.vertexBufferLayout=w;this.vbo=g.BufferObject.createVertex(x,
e.Usage.STATIC_DRAW,v.buffer);this.vao=new d.VertexArrayObject(x,h.Default3D,{geometry:b.glLayout(w)},{geometry:this.vbo});this.vertexCount=q}destroy(){this.glMaterials.dispose();this.vbo.dispose();this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(l,u,x,w,q,v,p,t){const r=this.geometry.id;this.material.intersect(this.geometry,l.transform.transform,l,x,w,(y,D,E,A,B)=>{0<=y&&(null==u||u(l.rayBegin,l.rayEnd,y))&&(E=new f.LodTarget(v.layerUid,
v.graphicUid(q),r,E,p,t),(null==l.results.min.drapedLayerOrder||B>=l.results.min.drapedLayerOrder)&&(null==l.results.min.dist||y<l.results.min.dist)&&l.results.min.set(m.IntersectorType.LOD,E,y,D,l.transform.transform,B),l.options.store!==m.StoreResults.MIN&&(null==l.results.max.drapedLayerOrder||B>=l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||y>l.results.max.dist)&&l.results.max.set(m.IntersectorType.LOD,E,y,D,l.transform.transform,B),l.options.store===m.StoreResults.ALL&&(A=k.newIntersectorResult(l.results.min.ray),
A.set(m.IntersectorType.LOD,E,y,D,l.transform.transform,B),l.results.all.push(A)))})}}a.LodComponentData=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],function(a,b,h,c){class k extends h.Graphic3DTarget{constructor(m,d,f,g,e,n){super(m,d);this.layerUid=m;this.graphicUid=d;this.geometryId=f;this.triangleNr=g;this.baseBoundingSphere=
e;this.numLodLevels=n}}a.LodTarget=k;a.isLodIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.LOD&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M){function S(O,U,P){const {origin:R,positions:ba}=O;let X=O.offset;switch(U){default:case H.UpVectorAlignment.World:for(const da of O.vertices)T[0]=ba[X++]+R[0],T[1]=ba[X++]+R[1],T[2]=ba[X++]+R[2],P.worldUpAtPosition(T,T),da.setFrameFromUpVector(T);break;case H.UpVectorAlignment.Path:T[0]=ba[X]+R[0],T[1]=ba[X+1]+R[1],T[2]=ba[X+2]+R[2],P.worldUpAtPosition(T,T),C.computeMinimumRotationTangentFrame(O,T)}}function N(O,U,P){switch(O){case "symbol-value":return P;
case "proportional":return U;default:return O}}const V=["polyline"];class Q extends q.Graphics3DSymbolLayer{constructor(O,U,P,R){super(O,U,P,R);this._intrinsicSize=d.fromValues(1,1);this._upVectorAlignment=H.UpVectorAlignment.Path;this._stencilWidth=.1;this.usedMemory=0;this.ensureDrapedStatus(!1)}async doLoad(){var O=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height;const U=null!=this.symbolLayer.height?this.symbolLayer.height:O;this._vvConvertOptions=new t.ConvertOptions({size:!0,
color:!0,rotation:!1,opacity:!0},[1,1,1],[O,1,U],this._context.renderCoordsHelper.unitInMeters);this._fastUpdates=0<this._context.renderer?.visualVariables?.length?t.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var P=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?H.UpVectorAlignment.World:H.UpVectorAlignment.Path;var R=this.symbolLayer.profile||"circle";switch(R){default:case "circle":this._profile=z.circleProfiles[P];
break;case "quad":this._profile=z.quadProfiles[P]}switch(this.symbolLayer.join){case "round":this._extruder=new G.MiterExtruder(0,w.pathNumRoundJoinSubdivisions);break;case "bevel":this._extruder=new G.MiterExtruder(0,1);break;case "miter":this._extruder=new G.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new G.SimpleExtruder}P=this.symbolLayer.cap||"butt";switch(P){case "none":this._startCap=new F.NoCapBuilder;this._endCap=new F.NoCapBuilder;break;default:this._startCap=new F.TriangulationCapBuilder(this._profile,
0);this._endCap=new F.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new F.TriangulationCapBuilder(this._profile,-.5);this._endCap=new F.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":R="quad"===R,this._startCap=new F.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:R,subdivisions:w.pathNumRoundCapExtrusionSubdivisions}),this._endCap=new F.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:R,subdivisions:w.pathNumRoundCapExtrusionSubdivisions})}var ba=
this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);R=g.fromArray(ba);ba=ba[3];const X=1>ba||this.needsDrivenTransparentPass;P={diffuse:R,ambient:R,opacity:ba,transparent:X,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:X||"none"===P?D.CullFaceOptions.None:D.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(m.set(this._intrinsicSize,O,U),!v.isValidSize(this._intrinsicSize[0])||!v.isValidSize(this._intrinsicSize[1])))throw new h("graphics3dpathsymbollayer:invalid-size",
"Symbol sizes may not be negative values");this._fastUpdates?.visualVariables.size||m.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(O={...P,...this._fastUpdates.materialParameters,size:d.fromArray(this._intrinsicSize)},this._materials[0]=new M.PathMaterial(O)):(P.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,P.normalType=y.NormalType.Compressed,this._materials[0]=new I.DefaultMaterial(P));this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials[0]=null;this._materials.length=0}createGraphics3DGraphic(O){const U=O.graphic;if(!this._validateGeometry(U.geometry,V,this.symbolLayer.type))return null;const P=this.setGraphicElevationContext(U);return this._createAs3DShape(U,O.renderingInfo,P,U.uid)}layerOpacityChanged(){const O=this._getCombinedOpacity(this.symbolLayer?.material?.color),U=1>O||this.needsDrivenTransparentPass;
this._materials[0]?.setParameters({opacity:O,transparent:U})}layerElevationInfoChanged(O,U){return this.updateGraphics3DGraphicElevationInfo(O,U,u.needsElevationUpdates3D)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0}applyRendererDiff(O,U){for(const P in O.diff)switch(P){case "visualVariables":if(t.updateFastSymbolUpdatesState(this._fastUpdates,
U,this._vvConvertOptions))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);else return p.ApplyRendererDiffResult.RecreateSymbol;break;default:return p.ApplyRendererDiffResult.RecreateSymbol}return p.ApplyRendererDiffResult.FastUpdate}_getVertexData(O){let U=0;const P=O.paths,R=[],ba=O.spatialReference,X=this._context.elevationProvider.spatialReference,da=this._context.renderCoordsHelper.spatialReference;for(var ha of P)U+=ha.length;ha=l.newDoubleArray(3*U);let fa=0;for(const aa of P){R.push({offset:fa,
numVertices:aa.length});for(const Z of aa)ha[fa++]=Z[0],ha[fa++]=Z[1],ha[fa++]=O.hasZ?Z[2]:0}if(null!=X&&!ba.equals(X)&&!e.projectBuffer(ha,ba,0,ha,X,0,U))return null;null==X||X.equals(da)?O=l.doubleArrayFrom(ha):(O=l.newDoubleArray(3*U),e.projectBuffer(ha,X,0,O,da,0,U));return{pathVertexDataInfos:R,vertexDataES:ha,vertexDataRS:O}}_createAs3DShape(O,U,P,R){this.usedMemory=0;var ba=O.geometry;const X=this._getVertexData(ba);if(null==X)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===X.pathVertexDataInfos.length)return 0!==ba.paths.length&&ba.paths.some(Y=>0<Y.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var da=[];ba=ba.spatialReference;const ha=n.create(),fa=this._context.renderCoordsHelper,aa=new r.SamplePosition(X.vertexDataES);for(const Y of X.pathVertexDataInfos){var Z=Y.numVertices;if(!(2>Z)){var ea=Y.offset;if(null!=this._context.clippingExtent&&(n.empty(ha),n.expandWithBuffer(ha,X.vertexDataES,ea,
Z),!n.intersectsClippingArea(ha,this._context.clippingExtent)))continue;var ca=[];Z=ea+3*Z;for(var W=ea;W<Z;W+=3){aa.offset=W;const ja=u.evaluateElevationAlignmentAtPoint(aa,this._context.elevationProvider,P,fa);f.set(T,X.vertexDataRS[W],X.vertexDataRS[W+1],X.vertexDataRS[W+2]);fa.setAltitude(T,ja);X.vertexDataRS[W]=T[0];X.vertexDataRS[W+1]=T[1];X.vertexDataRS[W+2]=T[2];ca.push(J.newPathVertex(this._upVectorAlignment))}ea=new A.Path(ca,X.vertexDataES,X.vertexDataRS,ea);S(ea,this._upVectorAlignment,
this._context.renderCoordsHelper);ea=new B.PathBuilder(ea,this._profile,this._extruder,this._startCap,this._endCap);ca=null;this._fastUpdates?(W=this._fastUpdates.visualVariables,ca=t.getAttributeValue(W.size?.field,O)??0,Z=t.getAttributeValue(W.color?.field,O)??0,W=t.getAttributeValue(W.opacity?.field,O)??0,ca=new L.FastUpdatePathGeometry(ea,ca,Z,W)):(ca=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(Z=U.size,ca[0]*=N(Z[0],"symbol-value"===Z[2]?this.symbolLayer.height||
0:Z[2],this.symbolLayer.width||0),ca[1]*=N(Z[2],"symbol-value"===Z[0]?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)),Z=void 0,this._drivenProperties.color&&(Z=U.color),this._drivenProperties.opacity&&null!=U.opacity&&(Z=Z?[Z[0],Z[1],Z[2],U.opacity]:[1,1,1,U.opacity]),W=new L.StaticPathGeometry(ea),W.bake(ca),Z&&W.bakeVertexColors(Z),ca=W);Z=ca.createGeometryData();W=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:R,layerUid:this._context.layer.uid});ca=new H.PathGeometry(this._materials[0],
Z,ca,ba,this._stencilWidth,W);ca.transformation=c.translate(k.create(),k.IDENTITY,ea.path.origin);da.push(ca);this.usedMemory+=ea.usedMemory}}if(0===da.length)return null;O=new E.Object3D({geometries:da,layerUid:this._context.layer.uid,graphicUid:R});da=new x.Graphics3DObject3DGraphicLayer(this,O,da,null,null,(Y,ja,oa,ra,ta)=>{ja=this._upVectorAlignment;Y=Y.stageObject;oa=Y.geometries;var ya=0;for(const Ba of oa){if(!H.isPathGeometry(Ba))continue;const la=Ba.path,qa=la.builder.path;var Ca=qa,pa=ra,
wa=ta;let ua=0;const {origin:va,vertices:Ga,positions:La,positionsES:Na}=Ca,Wa=Ca.offset+3*Ga.length;for(let Ia=Ca.offset;Ia<Wa;Ia+=3)f.set(T,Na[Ia],Na[Ia+1],Na[Ia+2]),pa(T,ia),ua+=ia.sampledElevation,T[0]=La[Ia]+va[0],T[1]=La[Ia+1]+va[1],T[2]=La[Ia+2]+va[2],wa.setAltitude(T,ia.z),La[Ia]=T[0]-va[0],La[Ia+1]=T[1]-va[1],La[Ia+2]=T[2]-va[2];Ca.updatePathVertexInformation();ya+=ua/Ga.length;ja!==H.UpVectorAlignment.World&&S(qa,ja,ta);la.onPathChanged(Ba);Ba.invalidateBoundingInfo();Y.geometryVertexAttributeUpdated(Ba,
K.VertexAttribute.POSITION)}return ya/oa.length},P);da.alignedSampledElevation=0;da.needsElevationUpdates=u.needsElevationUpdates3D(P.mode);return da}}const T=g.create(),ia=new u.SampleElevationInfo;a.Graphics3DPathSymbolLayer=Q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/FloatArray"],
function(a,b,h,c,k){class m{constructor(d,f,g,e){this.vertices=d;this.positionsES=f;this.offset=e;var n=d.length;e=this.offset+3*Math.floor(n/2);d=g[e];f=g[e+1];e=g[e+2];this.origin=c.fromValues(d,f,e);this.positions=k.newFloatArray(3*n);n=this.offset+3*n;for(let l=this.offset;l<n;l+=3)this.positions[l]=g[l]-d,this.positions[l+1]=g[l+1]-f,this.positions[l+2]=g[l+2]-e;this.updatePathVertexInformation()}get usedMemory(){return b.estimateSize(this.positions)}updatePathVertexInformation(){const d=this.vertices.length;
var f=this.vertices[0];let g=this.offset;const e=this.positions;f.vRight[0]=e[g+3]-e[g];f.vRight[1]=e[g+4]-e[g+1];f.vRight[2]=e[g+5]-e[g+2];g+=3;let n=h.length(f.vRight);f.vMinSiblingLength=n;h.normalize(f.vRight,f.vRight);var l=f;for(f=1;f<d;++f){const u=this.vertices[f];u.vLeft=l.vRight;f<d-1?(u.vRight[0]=e[g+3]-e[g],u.vRight[1]=e[g+4]-e[g+1],u.vRight[2]=e[g+5]-e[g+2],l=h.length(u.vRight),u.vMinSiblingLength=Math.min(n,l),n=l,h.normalize(u.vRight,u.vRight)):(h.copy(u.vRight,u.vLeft),u.vMinSiblingLength=
n);l=u;g+=3}}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(a,b,h,c){class k{constructor(m,d,f,g,e,n={}){this.path=m;this.profile=d;this.extruder=f;this.startCap=g;this.endCap=e;this.options=n;this._extrusionVertexCount=0;g=this.path.vertices.length-2;this.numExtrusionProfiles=
f.numProfilesPerJoin()*g+2;this.numVerticesTotal=d.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.startCap.numVertices;this.endCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.endCap.numVertices;this.pathVertexData=c.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=h.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=h.newFloatArray(4*this.numVerticesTotal);this.profileVertexAndNormals=
h.newFloatArray(4*this.numVerticesTotal);this.positions=h.floatSubArray(m.positions,m.offset,3*m.vertices.length);this._rebuildGeometry();this.buildTopology()}get usedMemory(){return b.estimateSize(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(m,d,f,g,e){const n=4*this._extrusionVertexCount;this.profileRightAxes[n]=d.right[0];this.profileRightAxes[n+1]=d.right[1];this.profileRightAxes[n+2]=d.right[2];
this.profileUpAxes[n]=d.up[0];this.profileUpAxes[n+1]=d.up[1];this.profileUpAxes[n+2]=d.up[2];this.profileVertexAndNormals[n]=f[0];this.profileVertexAndNormals[n+1]=f[1];this.profileVertexAndNormals[n+2]=g[0];this.profileVertexAndNormals[n+3]=g[1];this.pathVertexData[this._extrusionVertexCount]=m;e?(m=this.path.vertices[m],d=m.maxStretchDistance,this.profileRightAxes[n+3]=m.rotationRight[0]*d,this.profileUpAxes[n+3]=m.rotationRight[1]*d):(this.profileRightAxes[n+3]=0,this.profileUpAxes[n+3]=0);++this._extrusionVertexCount}emitCapVertex(m,
d,f,g,e,n){const l=4*this._extrusionVertexCount;this.profileRightAxes[l]=d.right[0];this.profileRightAxes[l+1]=d.right[1];this.profileRightAxes[l+2]=d.right[2];this.profileRightAxes[l+3]=e;this.profileUpAxes[l]=d.up[0];this.profileUpAxes[l+1]=d.up[1];this.profileUpAxes[l+2]=d.up[2];this.profileUpAxes[l+3]=n;this.profileVertexAndNormals[l]=f[0];this.profileVertexAndNormals[l+1]=f[1];this.profileVertexAndNormals[l+2]=g[0];this.profileVertexAndNormals[l+3]=g[1];this.pathVertexData[this._extrusionVertexCount]=
m;++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const {positions:m,offset:d,vertices:f}=this.path;this.positions=h.floatSubArray(m,d,3*f.length);let g=0;const e=(l,u,x,w,q)=>this.emitCapVertex(g,l,u,x,w,q),n=(l,u,x,w)=>this.emitVertex(g,l,u,x,w);this.startCap.rebuildConnectingProfileGeometry(f[g],this.profile,e);for(g=1;g<f.length-1;++g)this.extruder.extrude(f[g],this.profile,n);this.endCap.rebuildConnectingProfileGeometry(f[g],this.profile,e);g=0;this.startCap.rebuildCapGeometry(f[g],
e);g=f.length-1;this.endCap.rebuildCapGeometry(f[g],e)}buildTopology(){const m=this.profile.vertices.length,d=this.profile.numSegments,f=this.numExtrusionProfiles-1;var g=d*f*6;this.startCap.indexBufferStart=g;this.startCap.firstProfileVertexIndex=0;g+=this.startCap.numIndices;this.endCap.indexBufferStart=g;this.endCap.firstProfileVertexIndex=m*(this.numExtrusionProfiles-1);const e=[],n=[],l=[];g=(u,x,w)=>{e.push(u);e.push(x);e.push(w);n.push(u);n.push(x);n.push(w);l.push(this.pathVertexData[u]);
l.push(this.pathVertexData[x]);l.push(this.pathVertexData[w])};for(let u=0;u<d;++u){const x=this.profile.indices[2*u],w=this.profile.indices[2*u+1];for(let q=0;q<f;++q){const v=q*m+x,p=(q+1)*m+w,t=q*m+w;g(v,(q+1)*m+x,p);g(v,p,t)}}this.startCap.buildTopology(this.path.vertices[0],g);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],g);this.vertexIndices=c.compactIndices(e);this.normalIndices=c.compactIndices(n);this.pathVertexIndices=c.compactIndices(l)}onPathChanged(){this._rebuildGeometry()}}
a.PathBuilder=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64"],function(a,b,h){class c{rebuildConnectingProfileGeometry(e,n,l){for(let u=0;u<n.vertices.length;++u)l(e.frame,n.vertices[u],n.normals[u],0,0)}}class k extends c{constructor(){super();this.numIndices=this.numVertices=0}rebuildCapGeometry(){}buildTopology(){}}
class m extends c{constructor(e,n=0,l=!1){super();this.profile=e;this.profilePlaneOffset=n;this.flip=l}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,n,l){const u=this.profilePlaneOffset;for(let x=0;x<n.vertices.length;++x)l(e.frame,n.vertices[x],n.normals[x],u,0)}rebuildCapGeometry(e,n){const l=this.profile,u=this.flip?1:-1,x=this.profilePlaneOffset,w=g;b.set(w,0,0);for(let q=0;q<l.vertices.length;++q)n(e.frame,
l.vertices[q],w,x,u)}buildTopology(e,n){e=this.profile;const l=this.vertexBufferStart+e.indices[0];for(let u=1;u<e.numSegments;++u){const x=this.vertexBufferStart+e.indices[2*u],w=this.vertexBufferStart+e.indices[2*u+1];this.flip?n(w,x,l):n(l,x,w)}}}class d extends c{constructor(e){super();this.flip=!1;this.sign=0;this.breakNormals=!1;this.numSegments=3;this.profile=e.profile;this.sign=(this.flip=e.flip)?1:-1;this.breakNormals=e.breakNormals;this.numSegments=e.subdivisions}get numVertices(){let e=
this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;this.breakNormals&&(e+=this.profile.vertices.length);return e}get numIndices(){let e;const n=this.profile;e=2*n.numSegments*(this.numSegments-1);for(let l=0;l<n.numSegments;++l)e=n.poleIndices[n.indices[2*l]]===n.poleIndices[n.indices[2*l+1]]?e+1:e+2;return 3*e}rebuildCapGeometry(e,n){const l=this.profile;e=e.frame;const u=.5*this.sign,x=f,w=g;b.set(w,0,0);for(var q of l.poles)q.normal?n(e,q.position,q.normal,u,0):n(e,q.position,
w,u,this.sign);if(this.breakNormals)for(q=0;q<l.vertices.length;++q)n(e,l.vertices[q],l.normals[q],0,0);for(q=0;q<this.numSegments-1;++q){var v=(1-(q+1)/this.numSegments)*Math.PI*.5;const p=Math.sin(v);v=Math.cos(v);for(let t=0;t<l.vertices.length;++t){const r=l.poles[l.poleIndices[t]];b.subtract(x,l.vertices[t],r.position);b.scale(x,x,p);r.normal?(b.add(x,x,r.position),n(e,x,r.normal,u*v,0)):(b.normalize(w,x),b.scale(w,w,p),b.add(x,x,r.position),n(e,x,w,u*v,this.sign*v))}}}buildTopology(e,n){e=this.profile;
const l=this.breakNormals?this.vertexBufferStart+e.poles.length:this.firstProfileVertexIndex,u=this.breakNormals?this.vertexBufferStart+e.poles.length+e.vertices.length:this.vertexBufferStart+e.poles.length;for(let x=0;x<e.numSegments;++x){const w=e.indices[2*x],q=e.indices[2*x+1],v=this.vertexBufferStart+e.poleIndices[w],p=this.vertexBufferStart+e.poleIndices[q];let t=l+w,r=l+q;for(let y=0;y<this.numSegments-1;++y){const D=u+y*e.vertices.length+w,E=u+y*e.vertices.length+q;this.flip?(n(D,r,t),n(r,
D,E)):(n(t,r,D),n(E,D,r));t=D;r=E}this.flip?(n(v,r,t),v!==p&&n(v,p,r)):(n(t,r,v),v!==p&&n(r,p,v))}}}const f=h.create(),g=h.create();a.NoCapBuilder=k;a.PathCapBuilder=c;a.RoundCapBuilder=d;a.TriangulationCapBuilder=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64".split(" "),
function(a,b,h,c,k,m,d){class f{}class g{numProfilesPerJoin(){return 1}extrude(w,q,v){for(let p=0;p<q.vertices.length;++p)v(w.frame,q.vertices[p],q.normals[p],!1)}}class e{constructor(w,q){this.cutoffAngle=w;this.numBendSubdivisions=q}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(w,q,v){var p=x;const {rotationAngle:t,rotationRight:r,frame:y}=w;if(Math.abs(t)>=this.cutoffAngle){var D=w.rotationFrameUp;for(var E=0;E<this.numBendSubdivisions+1;++E){b.fromRotation(u,.5*-t+E*t/this.numBendSubdivisions,
D);var A=p,B=y,F=u;m.transformMat4(A.up,B.up,F);m.transformMat4(A.right,B.right,F);for(A=0;A<q.vertices.length;++A)0<=c.dot(q.vertices[A],r)*t?v(p,q.vertices[A],q.normals[A],!1):(B=w.applyMiterStretch(l,q.vertices[A]),v(y,B,q.normals[A],!0))}}else for(p=0;p<this.numBendSubdivisions+1;++p)for(D=0;D<q.vertices.length;++D)E=0<=c.dot(q.vertices[D],r)*t,A=w.applyMiterStretch(l,q.vertices[D]),v(y,A,q.normals[D],!E)}}class n{constructor(){this.up=d.create();this.right=d.create()}}const l=k.create(),u=h.create(),
x=new n;a.Frame2D=n;a.MiterExtruder=e;a.PathExtruder=f;a.SimpleExtruder=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","./ContentObjectType","./Geometry"],function(a,b,h){class c extends h.Geometry{constructor(k,m,d,f,g,e){super(k,m,null,b.ContentObjectType.Mesh,e);this.path=d;this.geometrySR=f;this.stencilWidth=g}}a.UpVectorAlignment=void 0;(function(k){k[k.World=0]="World";k[k.Path=1]="Path"})(a.UpVectorAlignment||
(a.UpVectorAlignment={}));a.PathGeometry=c;a.isPathGeometry=function(k){return"path"in k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./Normals ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u{constructor(E){this.builder=E}onPathChanged(E){this.builder.onPathChanged()}}class x extends u{constructor(E){super(E);this.vertexAttributeColor=m.fromValues(255,255,255,255);this.size=[];this.vertexAttributePosition=d.newFloatArray(3*this.builder.numVerticesTotal);this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(E){this.vertexAttributeColor[0]=255*E[0];this.vertexAttributeColor[1]=255*E[1];this.vertexAttributeColor[2]=
255*E[2];this.vertexAttributeColor[3]=255*(3<E.length?E[3]:1)}bake(E){this.size=E;const {numVerticesTotal:A,pathVertexData:B,path:F,positions:G,profileRightAxes:H,profileUpAxes:L,profileVertexAndNormals:C}=this.builder;for(let I=0;I<A;++I){var z=B[I],J=0===z||z===F.vertices.length-1;z*=3;const M=r;let S=0,N=0;const V=4*I,Q=c.set(y,H[V],H[V+1],H[V+2]),T=c.set(D,L[V],L[V+1],L[V+2]);var K=b.set(q,C[V]*E[0],C[V+1]*E[1]);if(J)c.cross(M,T,Q),S=H[V+3]*E[0],N=L[V+3];else{J=v;const ia=p;b.set(J,H[V+3],L[V+
3]);const O=b.length(J);b.normalize(J,J);const U=b.dot(K,J);if(Math.abs(U)>O){b.set(ia,-J[1],J[0]);const P=b.dot(K,ia);b.scale(J,J,O*Math.sign(U));b.scale(ia,ia,P);b.add(K,J,ia)}c.set(M,0,0,0)}K=c.set(t,Q[0]*K[0]+T[0]*K[1],Q[1]*K[0]+T[1]*K[1],Q[2]*K[0]+T[2]*K[1]);J=3*I;this.vertexAttributePosition[J]=G[z]+K[0]+M[0]*S;this.vertexAttributePosition[J+1]=G[z+1]+K[1]+M[1]*S;this.vertexAttributePosition[J+2]=G[z+2]+K[2]+M[2]*S;z=b.set(q,C[V+2],C[V+3]);e.compressNormal(this.vertexAttributeNormal,I,Q[0]*
z[0]+T[0]*z[1]+M[0]*N,Q[1]*z[0]+T[1]*z[1]+M[1]*N,Q[2]*z[0]+T[2]*z[1]+M[2]*N)}}createGeometryData(){const E=this.builder.vertexIndices.length,{normalIndices:A,vertexIndices:B}=this.builder;return[[n.VertexAttribute.POSITION,new g.Attribute(this.vertexAttributePosition,B,3,!0)],[n.VertexAttribute.NORMALCOMPRESSED,new g.Attribute(this.vertexAttributeNormal,A,2,!0)],[n.VertexAttribute.COLOR,new g.Attribute(this.vertexAttributeColor,f.getZeroIndexArray(E),4)]]}onPathChanged(E){super.onPathChanged(E);this.bake(this.size)}intersect(E,
A,B){const F=this.builder.vertexIndices,G=new g.Vertices(this.vertexAttributePosition,3);l.intersectTriangles(E,A,0,F.length/3,F,G,void 0,void 0,B)}}class w extends u{constructor(E,A,B,F){super(E);this.sizeAttributeValue=A;this.colorAttributeValue=B;this.opacityAttributeValue=F;this.vvData=null;this.baked=new x(E);this.vvData=d.newFloatArray(4*this.builder.path.vertices.length);for(E=0;E<this.builder.path.vertices.length;++E)this.vvData[4*E]=A,this.vvData[4*E+1]=B,this.vvData[4*E+2]=F,this.vvData[4*
E+3]=0===E||E===this.builder.path.vertices.length-1?1:0}createGeometryData(){const {positions:E,profileRightAxes:A,profileUpAxes:B,profileVertexAndNormals:F,pathVertexIndices:G,vertexIndices:H}=this.builder;return[[n.VertexAttribute.POSITION,new g.Attribute(E,G,3,!0)],[n.VertexAttribute.PROFILERIGHT,new g.Attribute(A,H,4,!0)],[n.VertexAttribute.PROFILEUP,new g.Attribute(B,H,4,!0)],[n.VertexAttribute.PROFILEVERTEXANDNORMAL,new g.Attribute(F,H,4,!0)],[n.VertexAttribute.FEATUREVALUE,new g.Attribute(this.vvData,
G,4,!0)]]}onPathChanged(E){super.onPathChanged(E);if(E=E.getMutableAttribute(n.VertexAttribute.POSITION))E.data=this.builder.positions}}const q=h.create(),v=h.create(),p=h.create(),t=k.create(),r=k.create(),y=k.create(),D=k.create();a.FastUpdatePathGeometry=w;a.PathGeometryData=u;a.StaticPathGeometry=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),
function(a,b,h,c,k,m,d){const f=c.create();a.computeMinimumRotationTangentFrame=function(g,e){let n=null;const l=g.vertices.length,u=c.create(),x=c.create(),w=c.create(),q=c.create(),v=c.create(),p=c.create(),t=k.create();let r=g.vertices[0];h.copy(x,e);h.set(u,0,1,0);d.makeOrthoBasisDirUpFallback(r.vRight,x,u,u,w,x,.99619469809);h.copy(r.frame.up,x);h.copy(r.frame.right,w);e=g.positions;let y=g.offset;n=r;for(let E=1;E<l;++E){r=g.vertices[E];h.add(v,r.vLeft,r.vRight);var D=h.length(v);0<D?(D=1/Math.sqrt(D),
v[0]*=D,v[1]*=D,v[2]*=D):(v[0]=r.vRight[0],v[1]=r.vRight[1],v[2]=r.vRight[2]);p[0]=e[y]+n.frame.up[0];p[1]=e[y+1]+n.frame.up[1];p[2]=e[y+2]+n.frame.up[2];y+=3;D=h.set(f,e[y],e[y+1],e[y+2]);k.fromPositionAndNormal(D,v,t);k.intersectRay(t,m.wrap(p,r.vLeft),q)?(q[0]-=e[y],q[1]-=e[y+1],q[2]-=e[y+2],h.normalize(x,q),h.cross(w,v,x),h.normalize(w,w)):d.makeOrthoBasisDirUpFallback(v,n.frame.up,n.frame.right,u,w,x,.99619469809);h.copy(r.frame.up,x);h.copy(r.frame.right,w);n=r}};a.profileSpaceToVertexSpace=
function(g,e,n){g[0]=n[0]*e.right[0]+n[1]*e.up[0];g[1]=n[0]*e.right[1]+n[1]*e.up[1];g[2]=n[0]*e.right[2]+n[1]*e.up[2]};a.vertexSpaceToProfileSpace=function(g,e,n){b.set(g,h.dot(n,e.right),h.dot(n,e.up))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../core/typedArrayUtil","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../layers/graphics/Graphics3DPathSymbolLayerConstants"],function(a,
b,h,c){function k(n){const l=c.pathNumCircleProfileSubdivisions,u=new d,x={v0:0,v1:0};u.addPole(h.fromValues(0,0));for(var w=0;w<l;++w){var q=2*w*Math.PI/l,v=Math.cos(q);const p=Math.sin(q);q=h.fromValues(.5*v,.5*p);v=h.fromValues(v,p);u.addVertex(q,v)}for(w=0;w<l-1;++w)u.addSegment({v0:w,v1:w+1},x);u.addSegment({v0:l-1,v1:0},x);"center"!==n&&(n=f[n],u.translate(n[0],n[1]));return u}function m(n){const l=new d,u=h.fromValues(-.5,-.5),x=h.fromValues(.5,-.5),w=h.fromValues(.5,.5),q=h.fromValues(-.5,
.5),v=h.fromValues(0,-1),p=h.fromValues(1,0),t=h.fromValues(0,1),r=h.fromValues(-1,0);l.addPole(h.fromValues(0,.5),t);l.addPole(h.fromValues(0,.5));l.addPole(h.fromValues(0,-.5));l.addPole(h.fromValues(0,-.5),v);l.addVertex(u,v);l.addVertex(x,v);l.addSegment({v0:0,v1:1},{v0:3,v1:3});l.addVertex(x,p);l.addVertex(w,p);l.addSegment({v0:2,v1:3},{v0:2,v1:1});l.addVertex(w,t);l.addVertex(q,t);l.addSegment({v0:4,v1:5},{v0:0,v1:0});l.addVertex(q,r);l.addVertex(u,r);l.addSegment({v0:6,v1:7},{v0:1,v1:2});"center"!==
n&&(n=f[n],l.translate(n[0],n[1]));return l}class d{constructor(){this.vertices=[];this.normals=[];this.indices=[];this.poles=[];this.poleIndices=[]}addVertex(n,l){this.vertices.push(h.clone(n));this.normals.push(h.clone(l));return this.vertices.length-1}addPole(n,l=null){this.poles.push({position:h.clone(n),normal:l?h.clone(l):null});return this.poles.length-1}addSegment(n,l=null){this.indices.push(n.v0);this.indices.push(n.v1);l&&(this.poleIndices.push(l.v0),this.poleIndices.push(l.v1))}get numSegments(){return this.indices.length/
2}translate(n,l){for(const u of this.vertices)u[0]+=n,u[1]+=l;for(const u of this.poles)u.position[0]+=n,u.position[1]+=l}get usedMemory(){return this.vertices.length*b.estimateSize(this.vertices[0])*2+b.estimateSize(this.indices)}}const f={top:[0,-.5],bottom:[0,.5]},g={center:k("center"),top:k("top"),bottom:k("bottom")},e={center:m("center"),top:m("top"),bottom:m("bottom")};a.PathProfile=d;a.circleProfiles=g;a.quadProfiles=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat2 ../../../../core/libs/gl-matrix-2/factories/mat2f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./PathExtruder ./PathGeometry".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(){this.vLeft=f.create();this.vRight=f.create();this.vMinSiblingLength=0;this.frame=new g.Frame2D}setFrameFromUpVector(B){d.copy(this.frame.up,B);d.add(D,this.vLeft,this.vRight);d.normalize(D,D);d.scale(y,this.frame.up,d.dot(D,this.frame.up));d.subtract(E,D,y);d.normalize(E,E);d.cross(this.frame.right,E,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class l extends n{get rotationFrameUp(){return this.frame.up}get rotationRight(){return m.UNIT_X}get rotationAngle(){d.scale(t,
this.frame.up,d.dot(this.frame.up,this.vLeft));d.subtract(t,this.vLeft,t);d.negate(t,t);d.normalize(t,t);d.scale(r,this.frame.up,d.dot(this.frame.up,this.vRight));d.subtract(r,this.vRight,r);d.normalize(r,r);d.cross(p,this.rotationFrameUp,this.vLeft);return Math.sign(d.dot(p,this.vRight))*(Math.PI-b.acosClamped(d.dot(t,r)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(B,F){var G=this.rotationAngle;if(0>=Math.abs(G))return F;G=b.reciprocalClamped(Math.cos(.5*
G));return k.set(B,(1+(G-1))*F[0],F[1])}}class u extends n{get rotationFrameUp(){const B=Math.sign(d.dot(this.frame.right,this.vRight));d.cross(x,this.vRight,this.vLeft);d.scale(x,x,B);return d.normalize(x,x)}get rotationRight(){var B=this.rotationFrameUp,F=d.dot(B,this.frame.up);B=d.dot(B,this.frame.right);d.scale(q,this.frame.up,-B);d.scale(v,this.frame.right,F);d.add(q,q,v);d.normalize(q,q);F=this.frame;B=q;k.set(w,d.dot(B,F.right),d.dot(B,F.up));return w}get rotationAngle(){const B=Math.sign(d.dot(this.frame.right,
this.vRight));d.negate(p,this.vLeft);return-B*(Math.PI-b.acosClamped(d.dot(p,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*b.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(B,F){var G=this.rotationAngle;if(0===Math.abs(G))return F;G=b.reciprocalClamped(Math.cos(.5*G));const H=this.rotationRight;G=h.set(A,1+(G-1)*H[0]*H[0],(G-1)*H[0]*H[1],(G-1)*H[0]*H[1],1+(G-1)*H[1]*H[1]);return k.transformMat2(B,F,G)}}const x=f.create(),w=m.create(),q=f.create(),
v=f.create(),p=f.create(),t=f.create(),r=f.create(),y=f.create(),D=f.create(),E=f.create(),A=c.create();a.PathVertex=n;a.newPathVertex=function(B){switch(B){case e.UpVectorAlignment.World:return new l;case e.UpVectorAlignment.Path:return new u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["exports","./common"],function(a,b){function h(B,F){B[0]=F[0];B[1]=F[1];B[2]=F[2];B[3]=F[3];return B}function c(B){B[0]=1;B[1]=0;B[2]=
0;B[3]=1;return B}function k(B,F,G,H,L){B[0]=F;B[1]=G;B[2]=H;B[3]=L;return B}function m(B,F){if(B===F){const G=F[1];B[1]=F[2];B[2]=G}else B[0]=F[0],B[1]=F[2],B[2]=F[1],B[3]=F[3];return B}function d(B,F){const G=F[0],H=F[1],L=F[2];F=F[3];let C=G*F-L*H;if(!C)return null;C=1/C;B[0]=F*C;B[1]=-H*C;B[2]=-L*C;B[3]=G*C;return B}function f(B,F){const G=F[0];B[0]=F[3];B[1]=-F[1];B[2]=-F[2];B[3]=G;return B}function g(B){return B[0]*B[3]-B[2]*B[1]}function e(B,F,G){const H=F[0],L=F[1],C=F[2];F=F[3];const z=G[0],
J=G[1],K=G[2];G=G[3];B[0]=H*z+C*J;B[1]=L*z+F*J;B[2]=H*K+C*G;B[3]=L*K+F*G;return B}function n(B,F,G){const H=F[0],L=F[1],C=F[2];F=F[3];const z=Math.sin(G);G=Math.cos(G);B[0]=H*G+C*z;B[1]=L*G+F*z;B[2]=H*-z+C*G;B[3]=L*-z+F*G;return B}function l(B,F,G){const H=F[1],L=F[2],C=F[3],z=G[0];G=G[1];B[0]=F[0]*z;B[1]=H*z;B[2]=L*G;B[3]=C*G;return B}function u(B,F){const G=Math.sin(F);F=Math.cos(F);B[0]=F;B[1]=G;B[2]=-G;B[3]=F;return B}function x(B,F){B[0]=F[0];B[1]=0;B[2]=0;B[3]=F[1];return B}function w(B){return"mat2("+
B[0]+", "+B[1]+", "+B[2]+", "+B[3]+")"}function q(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2)}function v(B,F,G,H){B[2]=H[2]/H[0];G[0]=H[0];G[1]=H[1];G[3]=H[3]-B[2]*G[1];return[B,F,G]}function p(B,F,G){B[0]=F[0]+G[0];B[1]=F[1]+G[1];B[2]=F[2]+G[2];B[3]=F[3]+G[3];return B}function t(B,F,G){B[0]=F[0]-G[0];B[1]=F[1]-G[1];B[2]=F[2]-G[2];B[3]=F[3]-G[3];return B}function r(B,F){return B[0]===F[0]&&B[1]===F[1]&&B[2]===F[2]&&B[3]===F[3]}function y(B,F){const G=B[0],H=B[1],L=B[2];B=B[3];const C=F[0],
z=F[1],J=F[2];F=F[3];const K=b.getEpsilon();return Math.abs(G-C)<=K*Math.max(1,Math.abs(G),Math.abs(C))&&Math.abs(H-z)<=K*Math.max(1,Math.abs(H),Math.abs(z))&&Math.abs(L-J)<=K*Math.max(1,Math.abs(L),Math.abs(J))&&Math.abs(B-F)<=K*Math.max(1,Math.abs(B),Math.abs(F))}function D(B,F,G){B[0]=F[0]*G;B[1]=F[1]*G;B[2]=F[2]*G;B[3]=F[3]*G;return B}function E(B,F,G,H){B[0]=F[0]+G[0]*H;B[1]=F[1]+G[1]*H;B[2]=F[2]+G[2]*H;B[3]=F[3]+G[3]*H;return B}const A=Object.freeze(Object.defineProperty({__proto__:null,LDU:v,
add:p,adjoint:f,copy:h,determinant:g,equals:y,exactEquals:r,frob:q,fromRotation:u,fromScaling:x,identity:c,invert:d,mul:e,multiply:e,multiplyScalar:D,multiplyScalarAndAdd:E,rotate:n,scale:l,set:k,str:w,sub:t,subtract:t,transpose:m},Symbol.toStringTag,{value:"Module"}));a.LDU=v;a.add=p;a.adjoint=f;a.copy=h;a.determinant=g;a.equals=y;a.exactEquals=r;a.frob=q;a.fromRotation=u;a.fromScaling=x;a.identity=c;a.invert=d;a.mat2=A;a.mul=e;a.multiply=e;a.multiplyScalar=D;a.multiplyScalarAndAdd=E;a.rotate=n;
a.scale=l;a.set=k;a.str=w;a.sub=t;a.subtract=t;a.transpose=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function h(d){return[d[0],d[1],d[2],d[3]]}function c(d,f,g,e){return[d,f,g,e]}function k(d,f){return new Float64Array(d,f,4)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:h,create:b,createView:k,fromValues:c},Symbol.toStringTag,{value:"Module"}));
a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.mat2f64=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends f.Material{constructor(p){super(p,new v);this.supportsEdges=!0;this.produces=new Map([[e.RenderSlot.OPAQUE_MATERIAL,t=>(this.parameters.castShadows&&k.isShadowRelatedOutput(t)||k.is3DGeometryOutput(t))&&!this.parameters.transparent],[e.RenderSlot.TRANSPARENT_MATERIAL,t=>(this.parameters.castShadows&&k.isShadowRelatedOutput(t)||k.is3DGeometryOutput(t))&&this.parameters.transparent]]);this._vertexAttributeLocations=u.vertexAttributeLocations;this._configuration=
new u.PathTechniqueConfiguration;this._vertexBufferLayout=w.getVertexBufferLayout()}getConfiguration(p,t){this._configuration.output=p;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(p===k.ShaderOutput.Color||
p===k.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.WindingOrder:m.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=t.ssao;this._configuration.transparencyPassType=t.transparencyPassType;this._configuration.multipassEnabled=
t.multipassEnabled;this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(p){return p===k.ShaderOutput.Shadow||p===k.ShaderOutput.ShadowExcludeHighlight||p===k.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&0<this.parameters.opacity}intersect(p,t,r,y,D,E){if(g.isPathGeometry(p)){t=p.path;var A=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:G,
factor:H,minSize:L,maxSize:C}=this.parameters.vvSize;var B=t.sizeAttributeValue;A[0]*=b.clamp(G[0]+B*H[0],L[0],C[0]);A[1]*=b.clamp(G[2]+B*H[2],L[2],C[2])}B=Math.max(A[0],A[1]);p=p.boundingInfo;if(null==p)this._intersectTriangles(t,A,y,D,E);else{p=h.fromValues(p.bbMin[0]-B,p.bbMin[1]-B,p.bbMin[2]-B,p.bbMax[0]+B,p.bbMax[1]+B,p.bbMax[2]+B);B=[D[0]-y[0],D[1]-y[1],D[2]-y[2]];var F=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]);x.intersectAabbInvDir(p,y,[F/B[0],F/B[1],F/B[2]],r.tolerance)&&this._intersectTriangles(t,
A,y,D,E)}}}_intersectTriangles(p,t,r,y,D){p.baked.size&&p.baked.size[0]===t[0]&&p.baked.size[1]===t[1]||p.baked.bake(t);p.baked.intersect(r,y,D)}createBufferWriter(){return new l.DefaultBufferWriter(this._vertexBufferLayout)}createGLMaterial(p){return new q(p)}static getVertexBufferLayout(){return c.newLayout().vec3f(n.VertexAttribute.POSITION).vec4f(n.VertexAttribute.PROFILERIGHT).vec4f(n.VertexAttribute.PROFILEUP).vec4f(n.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(n.VertexAttribute.FEATUREVALUE)}}
class q extends d{_updateOccludeeState(p){p.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:p.hasOccludees})}_updateShadowState(p){null!=this.technique&&p.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:p.shadowMap.enabled})}beginSlot(p){if(this._output===k.ShaderOutput.Color||this._output===k.ShaderOutput.Alpha)this._updateShadowState(p),this._updateOccludeeState(p);return this.ensureTechnique(u.PathTechnique,
p)}}class v extends u.PathPassParameters{constructor(){super(...arguments);this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}a.PathMaterial=w;a.PathMaterialParameters=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){const y=new Map([[v.VertexAttribute.POSITION,0],[v.VertexAttribute.PROFILERIGHT,1],[v.VertexAttribute.PROFILEUP,2],[v.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[v.VertexAttribute.FEATUREVALUE,4]]);class D extends d.PathVertexPositionPassParameters{constructor(){super(...arguments);this.ambient=c.fromValues(.2,.2,.2);this.diffuse=c.fromValues(.8,.8,.8);this.specular=c.fromValues(0,0,0);this.opacity=1;this.origin=c.create();this.modelTransformation=
null}}class E extends n.ShaderTechnique{initializeConfiguration(B,F){F.spherical=B.viewingMode===k.ViewingMode.Global;F.doublePrecisionRequiresObfuscation=B.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(B){return new x.Program(B.rctx,E.shader.get().build(this.configuration),y)}initializePipeline(){const B=this.configuration.transparencyPassType,F=this.configuration,G=B===q.TransparencyPassType.NONE,H=B===q.TransparencyPassType.FrontFace;return r.makePipelineState({blending:F.output!==
m.ShaderOutput.Color&&F.output!==m.ShaderOutput.Alpha||!F.transparent?null:G?u.blendingDefault:u.oitBlending(B),culling:F.hasSlicePlane&&!F.transparent&&F.doubleSidedMode!==f.NormalsDoubleSidedMode.None?r.frontFaceCullingParams:null,depthTest:{func:u.oitDepthTest(B)},depthWrite:G||H?r.defaultDepthWriteParams:null,colorWrite:r.defaultColorWriteParams,stencilWrite:F.hasOccludees?w.stencilWriteMaskOn:null,stencilTest:F.hasOccludees?w.stencilBaseAllZerosParams:null,polygonOffset:G||H?null:u.OITPolygonOffset})}}
E.shader=new e.ReloadableShaderModule(t.Path,()=>new Promise((B,F)=>a(["../shaders/Path.glsl"],B,F)));class A extends p.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=m.ShaderOutput.Color;this.doubleSidedMode=f.NormalsDoubleSidedMode.None;this.transparencyPassType=q.TransparencyPassType.NONE;this.doublePrecisionRequiresObfuscation=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.transparent=this.hasSlicePlane=this.vvOpacity=this.vvColor=this.vvSize=this.receiveAmbientOcclusion=
this.receiveShadows=this.spherical=!1}}h.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],A.prototype,"output",void 0);h.__decorate([l.parameter({count:f.NormalsDoubleSidedMode.COUNT})],A.prototype,"doubleSidedMode",void 0);h.__decorate([l.parameter({count:q.TransparencyPassType.COUNT})],A.prototype,"transparencyPassType",void 0);h.__decorate([l.parameter()],A.prototype,"spherical",void 0);h.__decorate([l.parameter()],A.prototype,"receiveShadows",void 0);h.__decorate([l.parameter()],A.prototype,
"receiveAmbientOcclusion",void 0);h.__decorate([l.parameter()],A.prototype,"vvSize",void 0);h.__decorate([l.parameter()],A.prototype,"vvColor",void 0);h.__decorate([l.parameter()],A.prototype,"vvOpacity",void 0);h.__decorate([l.parameter()],A.prototype,"hasSlicePlane",void 0);h.__decorate([l.parameter()],A.prototype,"transparent",void 0);h.__decorate([l.parameter()],A.prototype,"hasOccludees",void 0);h.__decorate([l.parameter()],A.prototype,"multipassEnabled",void 0);h.__decorate([l.parameter()],
A.prototype,"cullAboveGround",void 0);h.__decorate([l.parameter()],A.prototype,"doublePrecisionRequiresObfuscation",void 0);h.__decorate([l.parameter({constValue:!1})],A.prototype,"occlusionPass",void 0);h.__decorate([l.parameter({constValue:g.PBRMode.Disabled})],A.prototype,"pbrMode",void 0);h.__decorate([l.parameter({constValue:!0})],A.prototype,"hasVvInstancing",void 0);h.__decorate([l.parameter({constValue:!1})],A.prototype,"useCustomDTRExponentForWater",void 0);h.__decorate([l.parameter({constValue:!1})],
A.prototype,"useFillLights",void 0);h.__decorate([l.parameter({constValue:!1})],A.prototype,"hasColorTexture",void 0);b.PathPassParameters=D;b.PathTechnique=E;b.PathTechniqueConfiguration=A;b.vertexAttributeLocations=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends e.VisualVariablePassParameters{constructor(){super(...arguments);this.size=b.fromValues(1,1)}}a.PathVertexPosition=function(l,u){const x=g.VertexAttribute.FEATUREVALUE;l.attributes.add(x,"vec4");const w=l.vertex;w.code.add(f.glsl`
  bool isCapVertex() {
    return ${x}.w == 1.0;
  }
  `);w.uniforms.add(new c.Float2PassUniform("size",q=>q.size));u.vvSize?(w.uniforms.add(new k.Float3PassUniform("vvSizeMinSize",q=>q.vvSize.minSize),new k.Float3PassUniform("vvSizeMaxSize",q=>q.vvSize.maxSize),new k.Float3PassUniform("vvSizeOffset",q=>q.vvSize.offset),new k.Float3PassUniform("vvSizeFactor",q=>q.vvSize.factor)),w.code.add(f.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${x}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):w.code.add(f.glsl`vec2 getSize(){
return size;
}`);u.vvOpacity?(w.constants.add("vvOpacityNumber","int",8),w.uniforms.add(new d.FloatsPassUniform("vvOpacityValues",q=>q.vvOpacity.values,8),new d.FloatsPassUniform("vvOpacityOpacities",q=>q.vvOpacity.opacityValues,8)),w.code.add(f.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${x}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):w.code.add(f.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);u.vvColor?(w.constants.add("vvColorNumber","int",e.vvColorNumber),w.uniforms.add(new d.FloatsPassUniform("vvColorValues",q=>q.vvColor.values,e.vvColorNumber),new m.Float4sPassUniform("vvColorColors",q=>q.vvColor.colors,e.vvColorNumber)),w.code.add(f.glsl`
    vec4 getColor() {
      float value = ${x}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):w.code.add(f.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);l.include(h.PositionAttribute);l.attributes.add(g.VertexAttribute.PROFILERIGHT,"vec4");l.attributes.add(g.VertexAttribute.PROFILEUP,"vec4");l.attributes.add(g.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");w.code.add(f.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);w.code.add(f.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);w.code.add(f.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);w.code.add(f.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(B){const F=new y.ShaderBuilder,{vertex:G,fragment:H}=F;v.addProjViewLocalOrigin(G,B);F.varyings.add("vpos","vec3");F.include(m.PathVertexPosition,B);if(B.output===h.ShaderOutput.Color||B.output===h.ShaderOutput.Alpha)F.include(k.Transform,B),F.include(w.ReadShadowMapDraw,B),F.include(b.ForwardLinearDepth,B),F.varyings.add("vnormal","vec3"),F.varyings.add("vcolor","vec4"),B.multipassEnabled&&F.varyings.add("depth","float"),G.code.add(r.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${B.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${B.output===h.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);F.include(l.multipassTerrainTest,B);switch(B.output){case h.ShaderOutput.Alpha:F.include(c.SliceDraw,B);H.uniforms.add(new t.FloatPassUniform("opacity",L=>L.opacity));H.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${B.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case h.ShaderOutput.Color:F.include(c.SliceDraw,B);F.include(e.EvaluateSceneLighting,B);F.include(g.EvaluateAmbientOcclusion,B);F.include(w.ReadShadowMapDraw,B);F.include(u.Normals,B);v.addCameraPosition(H,B);e.addAmbientBoostFactor(H);e.addLightingGlobalFactor(H);H.uniforms.add(G.uniforms.get("localOrigin"),new p.Float3PassUniform("ambient",L=>L.ambient),new p.Float3PassUniform("diffuse",L=>L.diffuse),new p.Float3PassUniform("specular",L=>L.specular),new t.FloatPassUniform("opacity",
L=>L.opacity));H.include(q.ColorConversion);n.addMainLightIntensity(H);H.code.add(r.glsl`
        void main() {
          discardBySlice(vpos);
          ${B.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${B.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":B.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${B.transparencyPassType===D.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case h.ShaderOutput.LinearDepth:case h.ShaderOutput.Shadow:case h.ShaderOutput.ShadowHighlight:case h.ShaderOutput.ShadowExcludeHighlight:F.include(k.Transform,B);b.addNearFar(F);F.varyings.add("depth","float");G.code.add(r.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);F.include(c.SliceDraw,B);F.include(d.OutputDepth,B);H.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case h.ShaderOutput.Normal:F.include(k.Transform,B);F.include(x.NormalUtils,B);v.addViewNormal(G);F.varyings.add("vnormal","vec3");G.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);F.include(c.SliceDraw,B);H.code.add(r.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case h.ShaderOutput.Highlight:F.include(k.Transform,B),F.include(x.NormalUtils,B),F.varyings.add("vnormal","vec3"),G.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),F.include(c.SliceDraw,B),F.include(f.OutputHighlight,B),H.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return F}const A=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));a.Path=A;a.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(h,c){c.spherical?h.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):h.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);c.spherical?h.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):h.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){const F=["polyline","polygon","extent"],G=new q.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});class H extends n.Graphics3DSymbolLayer{constructor(K,I,M,S){super(K,I,M,S);this._needsUV=!1}async doLoad(){this._fastUpdates=q.initFastSymbolUpdatesState(this._context.renderer,G)}_createMaterials(){if(!(0<this._materials.length)){var K=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._materials[J.Fill]=v.createMaterial(this.symbolLayer,
{color:K,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._materials[J.Fill]instanceof A.PatternMaterial;K=this.symbolLayer.outline;if(this._isValidOutline(K)){const I=E.getStipplePatternForLinePattern(K.pattern);this._materials[J.Outline]=new B.RibbonLineMaterial({width:h.pt2px(K.size),color:this._getOutlineColor(),
hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:I,cap:x.parseCapType(K.patternCap||"butt")})}this._context.stage.addMany(this._materials)}}_isValidOutline(K){return null!=K?.size&&0<K.size&&null!=K.color&&(null==K.pattern||"style"!==K.pattern.type||"none"!==K.pattern.style)}destroy(){super.destroy();this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(K){const I=K.graphic;if(!this._validateGeometry(I.geometry,
F,this.symbolLayer.type))return null;K=this._getVertexOpacityAndColor(K.renderingInfo,255);const M=this.setGraphicElevationContext(I);this.ensureDrapedStatus("on-the-ground"===M.mode);this._createMaterials();return this.draped?this._createAsOverlay(I,K):this._createAs3DShape(I,K,M)}applyRendererDiff(K,I){for(const M in K.diff)switch(M){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,I,G))this._materials[J.Fill]?.setParameters(this._fastUpdates.materialParameters);else return u.ApplyRendererDiffResult.RecreateSymbol;
break;default:return u.ApplyRendererDiffResult.RecreateSymbol}return u.ApplyRendererDiffResult.FastUpdate}layerOpacityChanged(){if(null!=this._materials[J.Fill]){var K=this._materials[J.Fill].parameters.color;const I=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._materials[J.Fill].setParameters({color:[K[0],K[1],K[2],I],forceTransparentMode:this.needsDrivenTransparentPass})}null!=this._materials[J.Outline]&&(K=this._materials[J.Outline].parameters.color,this._materials[J.Outline].setParameters({color:[K[0],
K[1],K[2],this._getOutlineOpacity()]}))}layerElevationInfoChanged(K,I,M){const S=this._elevationContext.mode;M=f.elevationModeChangeUpdateType(H.elevationModeChangeTypes,M,S);if(M!==f.SymbolUpdateType.UPDATE)return M;const N=f.needsElevationUpdates2D(S);return this.updateGraphics3DGraphicElevationInfo(K,I,()=>N)}slicePlaneEnabledChanged(){this._materials[J.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[J.Outline]&&this._materials[J.Outline].setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(K,I,M){const S=w.geometryAsPolygon(K.geometry);if(!S)return null;var N=r.geometryToRenderInfo(S,this._context.elevationProvider,this._context.renderCoordsHelper,M);I=new C(N,I,this._context.layer.uid,K.uid);N=I.renderData.position.length/3;this._needsUV&&(I.uvMapSpace=d.newFloatArray(4*N,!0),I.boundingRect=m.newDoubleArray(9*N,!0),p.createMapSpaceUVCoords(I.uvMapSpace,I.boundingRect,I.renderData.position,this._context.renderCoordsHelper));
I.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(I);this._createAs3DShapeFill(K,I);this._materials[J.Outline]&&this._createAs3DShapeOutline(I);this._logGeometryCreationWarnings(I.renderData,S.rings,"rings","FillSymbol3DLayer");if(0===I.outGeometries.length)return null;K=new y.Object3D({geometries:I.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:K.uid});K=new e.Graphics3DObject3DGraphicLayer(this,K,I.outGeometries,null,null,v.uvElevationAligner,
M);K.alignedSampledElevation=I.renderData.sampledElevation;K.needsElevationUpdates=f.needsElevationUpdates2D(M.mode);return K}_createAs3DShapeFill(K,I){var M=I.renderData.polygons;for(const {position:S,mapPositions:N,holeIndices:V,index:Q,count:T}of M){if(null!=this._context.clippingExtent&&(k.empty(L),k.expandWithBuffer(L,N),!k.intersectsClippingArea(L,this._context.clippingExtent)))continue;M=w.createIndices3D(N,V,this._context.elevationProvider.spatialReference);if(0===M.length)continue;const ia=
this._fastUpdates?.visualVariables.color;M=w.createColorGeometry({material:this._materials[J.Fill],indices:M,mapPositions:N,attributeData:{position:S,color:ia?null:I.color,colorFeature:ia?q.getAttributeValue(ia.field,K):null,uvMapSpace:this._needsUV?d.floatSubArray(I.uvMapSpace,4*Q,4*T):null,boundingRect:this._needsUV?m.doubleSubArray(I.boundingRect,9*Q,9*T):null,objectAndLayerIdColor:I.objectAndLayerIdColor}});I.outGeometries.push(M)}}_createAs3DShapeOutline(K){if(null!=this._materials[J.Outline]){var I=
K.renderData.outlines;for(const {mapPositions:M,position:S}of I){if(null!=this._context.clippingExtent&&(k.empty(L),k.expandWithBuffer(L,M),!k.intersectsClippingArea(L,this._context.clippingExtent)))continue;I=t.createGeometry(this._materials[J.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:M,attributeData:{position:S}},K.objectAndLayerIdColor);K.outGeometries.push(I)}}}_createAsOverlay(K,I){const M=w.geometryAsPolygon(K.geometry);if(null==M)return null;this._materials[J.Fill].renderPriority=
this._renderPriority+this._renderPriorityStep/2;null!=this._materials[J.Outline]&&(this._materials[J.Outline].renderPriority=this._renderPriority);var S=r.geometryToRenderInfoDraped(M,this._context.overlaySR);I=new z(S,I,this._context.layer.uid,K.uid);S=I.renderData.position.length/3;this._needsUV&&(I.uvMapSpace=d.newFloatArray(4*S,!0),p.createMapSpaceUVCoordsDraped(I.uvMapSpace,I.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));I.outBoundingBox=
k.empty();I.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(I);this._createAsOverlayFill(K,I);this._materials[J.Outline]&&this._createAsOverlayOutline(I);this._logGeometryCreationWarnings(I.renderData,M.rings,"rings","FillSymbol3DLayer");return 0===I.outGeometries.length?null:new g.Graphics3DDrapedGraphicLayer(this,I.outGeometries,I.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(K,I){var M=I.renderData.polygons;for(const {position:N,holeIndices:V,
index:Q,count:T}of M){var S=k.empty(L);k.expandWithBuffer(S,N);k.intersectsClippingArea(S,this._context.clippingExtent)&&(M=c.earcut(N,V,3),0!==M.length&&(k.expandWithAABB(I.outBoundingBox,S),S=this._fastUpdates?.visualVariables.color,M=w.createColorGeometry({material:this._materials[J.Fill],indices:M,attributeData:{position:N,color:S?null:I.color,colorFeature:S?q.getAttributeValue(S.field,K):null,uvMapSpace:this._needsUV?d.floatSubArray(I.uvMapSpace,4*Q,4*T):null,objectAndLayerIdColor:I.objectAndLayerIdColor}}),
I.outGeometries.push(new D.RenderGeometry(M,I))))}}_createAsOverlayOutline(K){if(null!=this._materials[J.Outline]){var I=K.renderData.outlines;for(let S=0;S<I.length;++S){var {position:M}=I[S];k.empty(L);k.expandWithBuffer(L,M);k.intersectsClippingArea(L,this._context.clippingExtent)&&(k.expandWithAABB(K.outBoundingBox,L),M=t.createGeometry(this._materials[J.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,
attributeData:{position:M}},K.objectAndLayerIdColor),K.outGeometries.push(new D.RenderGeometry(M,K)))}}}_getOutlineOpacity(){const K=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=K?K.a:0)}_getOutlineColor(){const K=this.symbolLayer?.outline?.color,I=this._getOutlineOpacity();return l.mixinColorAndOpacity(null!=K?b.toUnitRGB(K):null,I)}test(){return{...super.test(),createAsOverlay:(K,I)=>this._createAsOverlay(K,I),createAs3DShape:(K,I,M)=>this._createAs3DShape(K,
I,M)}}}H.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.RECREATE,staysOnTheGround:f.SymbolUpdateType.NONE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const L=k.create();class C extends w.PolygonCreationDataBase{constructor(K,I,M,S){super(K,M,S);this.color=I}}class z extends w.PolygonCreationDataBase{constructor(K,I,M,S){super(K,M,S);this.color=I}}var J;(function(K){K[K.Fill=0]="Fill";K[K.Outline=1]="Outline"})(J||={});a.Graphics3DPolygonFillSymbolLayer=H;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,h,c,k,m,d,f,g){function e(u){switch(u){case "horizontal":return g.Style.Horizontal;case "vertical":return g.Style.Vertical;
case "cross":return g.Style.Cross;case "forward-diagonal":return g.Style.ForwardDiagonal;case "backward-diagonal":return g.Style.BackwardDiagonal;case "diagonal-cross":return g.Style.DiagonalCross}}function n(u){return u.material instanceof f.PatternMaterial&&!u.material.parameters.draped}function l(u,x){if(n(u)){const w=u.attributes.get(m.VertexAttribute.POSITION).data,q=u.getMutableAttribute(m.VertexAttribute.UVMAPSPACE).data;u=u.getMutableAttribute(m.VertexAttribute.BOUNDINGRECT).data;k.createMapSpaceUVCoords(q,
u,w,x)}}a.createMaterial=function(u,x){u=u?.pattern??null;if(null==u)return new d.ColorMaterial(x);if("none"===u.style||"solid"===u.style)return"none"===u.style&&(x.color=h.fromValues(0,0,0,0),x.forceTransparentMode=!0),new d.ColorMaterial(x);x.style=e(u.style);return new f.PatternMaterial(x)};a.parsePatternStyle=e;a.requiresUVUpdates=n;a.updateMapSpaceUVCoords=l;a.uvElevationAligner=function(u,x,w,q,v){x=c.perVertexElevationAligner(u,x,w,q,v);u=u.stageObject.geometries;for(const p of u)l(p,v);return x};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(L,C,z,J,K,I,M){k.set(L,C*K[0]+z*I[0]+J*M[0],C*K[1]+z*I[1]+J*M[1],C*K[2]+z*I[2]+J*M[2])}const u=m.create(),x=m.create(),w=e.create(),q=m.create(),v=m.create(),p=m.create(),t=c.create(),r=c.create(),y=m.create(),D=m.create(),E=m.create(),A=b.create(),B=m.create(),F=m.create(),G=m.create(),H=m.create();a.createMapSpaceUVCoords=function(L,C,z,J,K=1){k.set(q,1,0,0);k.set(v,0,1,0);k.set(p,0,0,1);k.set(H,0,0,0);for(var I=0;I<z.length-3;I+=3)H[0]+=z[I],H[1]+=z[I+
1],H[2]+=z[I+2];k.scale(u,H,1/(z.length/3-1));if(e.fromArray(w,z)){null!=J?(J.basisMatrixAtPosition(u,A),k.set(B,A[0],A[1],A[2]),k.set(F,A[4],A[5],A[6]),k.set(G,A[8],A[9],A[10])):(k.set(B,1,0,0),k.set(F,0,1,0),k.set(G,0,0,1));J=e.getNormal(w);0>k.dot(J,G)&&k.scale(J,J,-1);k.copy(p,J);I=k.dot(J,F);var M=k.dot(J,B);Math.abs(I)>Math.abs(M)?(k.scaleAndAdd(q,B,J,-M),k.normalize(q,q),k.cross(v,q,J),k.normalize(v,v),k.scale(v,v,-1)):(k.scaleAndAdd(v,F,J,-I),k.normalize(v,v),k.cross(q,v,J),k.normalize(q,
q))}h.set(t,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);h.set(r,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(J=0;J<z.length;J+=3)k.set(x,z[J],z[J+1],z[J+2]),I=k.dot(q,x),M=k.dot(v,x),t[0]=Math.min(t[0],I),t[1]=Math.min(t[1],M),r[0]=Math.max(r[0],I),r[1]=Math.max(r[1],M);J=k.dot(p,u);l(y,t[0],t[1],J,q,v,p);l(D,r[0],t[1],J,q,v,p);l(E,t[0],r[1],J,q,v,p);k.subtract(D,D,y);k.scale(D,D,.5);k.subtract(E,E,y);k.scale(E,E,.5);k.add(y,y,D);k.add(y,y,E);J=t[0]-t[0]%K;I=t[1]-t[1]%K;for(M=0;M<
z.length;M+=3){k.set(x,z[M],z[M+1],z[M+2]);var S=M/3,N=4*S;L[N]=(k.dot(q,x)-J)/K;L[N+1]=(k.dot(v,x)-I)/K;L[N+2]=J/K;L[N+3]=I/K;S*=9;for(N=0;3>N;N++)C[S+N]=y[N],C[S+N+3]=D[N],C[S+N+6]=E[N]}};a.createMapSpaceUVCoordsDraped=function(L,C,z,J,K=1){if(z.isGeographic&&J===n.ViewingMode.Global){J=g.newDoubleArray(C.length);var I=C.length;z=d.getReferenceEllipsoid(z);for(var M=0;M<I;M+=3)f.lonLatToWebMercatorComparable(C,M,J,M,z);C=J}h.set(t,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(J=0;J<C.length;J+=
3)t[0]=Math.min(t[0],C[J]),t[1]=Math.min(t[1],C[J+1]);J=t[0]-t[0]%K;I=t[1]-t[1]%K;for(z=0;z<C.length;z+=3)M=z/3*4,L[M]=(C[z]-J)/K,L[M+1]=(C[z+1]-I)/K,L[M+2]=J/K,L[M+3]=I/K};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./TriangleMaterial ./VisualVariablePassParameters ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){class q extends l.TriangleMaterial{constructor(t){super(t,new p);this.supportsEdges=!0;this.produces=new Map([[g.RenderSlot.OPAQUE_MATERIAL,r=>r===k.ShaderOutput.Highlight||k.isColorAlphaOrOID(r)&&!this._isTransparent],[g.RenderSlot.OPAQUE_NO_SSAO_DEPTH,r=>r===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth&&!this._isTransparent],[g.RenderSlot.TRANSPARENT_MATERIAL,r=>k.isColorAlphaOrOID(r)&&this._isTransparent&&this.parameters.writeDepth],[g.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,
r=>r===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[g.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(k.isColorAlphaOrOID(r)||r===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[g.RenderSlot.DRAPED_MATERIAL,r=>k.is2DGeometryOutput(r)]]);this._configuration=new w.ColorMaterialTechniqueConfiguration}getConfiguration(t,r){this._configuration.output=t;this._configuration.cullFace=
this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this._isTransparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=r.transparencyPassType;this._configuration.enableOffset=
r.camera.relativeElevation<f.OITPolygonOffsetLimit;this._configuration.multipassEnabled=r.multipassEnabled;this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.draped=this.parameters.draped;return this._configuration}createGLMaterial(t){return new v(t)}createBufferWriter(){const t=c.newLayout().vec3f(e.VertexAttribute.POSITION);b("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(e.VertexAttribute.OBJECTANDLAYERIDCOLOR);
this.parameters.vvColor?t.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):t.vec4u8(e.VertexAttribute.COLOR);return new n.DefaultBufferWriter(t)}get _isTransparent(){return 1>this.parameters.color[3]||this.parameters.forceTransparentMode}}class v extends d{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(t);
return this.ensureTechnique(x.ColorMaterialTechnique,t)}}class p extends u.VisualVariablePassParameters{constructor(){super(...arguments);this.color=h.ZEROS;this.forceTransparentMode=!1;this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=m.CullFaceOptions.None;this.draped=this.hasOccludees=!1}}a.ColorMaterial=q;a.Parameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports",
"../lib/Material","./internal/MaterialUtil"],function(a,b,h){class c extends b.Material{intersect(k,m,d,f,g,e){return h.intersectTriangleGeometry(k,d,f,g,void 0,e)}}a.TriangleMaterial=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/VisualVariablePassParameters ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends l.VisualVariablePassParameters{constructor(){super(...arguments);this.color=h.ZEROS}}class q extends m.ShaderTechnique{initializeProgram(p){return new g.Program(p.rctx,q.shader.get().build(this.configuration),d.Default3D)}_createPipeline(p,t){const r=this.configuration,y=p===n.TransparencyPassType.NONE,D=p===n.TransparencyPassType.FrontFace;return x.makePipelineState({blending:r.output!==c.ShaderOutput.Color&&r.output!==c.ShaderOutput.Alpha||!r.transparent?
null:y?f.blendingDefault:f.oitBlending(p),culling:x.cullingParams(r.cullFace),depthTest:r.draped?null:{func:f.oitDepthTest(p)},depthWrite:r.draped?null:y||D?r.writeDepth?x.defaultDepthWriteParams:null:null,colorWrite:x.defaultColorWriteParams,stencilWrite:r.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:r.hasOccludees?t?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:y||D?r.polygonOffset?v:null:f.getOITPolygonOffset(r.enableOffset)})}initializePipeline(){this._occludeePipelineState=
this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(p){return p?this._occludeePipelineState:super.getPipeline()}}q.shader=new k.ReloadableShaderModule(u.ColorMaterial,()=>new Promise((p,t)=>a(["./ColorMaterial.glsl"],p,t)));const v={factor:1,units:1};b.ColorMaterialPassParameters=w;b.ColorMaterialTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){function r(D){const E=new v.ShaderBuilder,{vertex:A,fragment:B,attributes:F,varyings:G}=E;x.addProjViewLocalOrigin(A,D);E.include(k.Transform,D);E.include(d.VertexColor,D);E.include(n.VisualVariables,D);E.include(m.ObjectAndLayerIdColor,D);F.add(t.VertexAttribute.POSITION,"vec3");D.vvColor&&F.add(t.VertexAttribute.COLORFEATUREATTRIBUTE,"float");G.add("vColor","vec4");G.add("vpos","vec3");const H=D.multipassEnabled&&(D.output===h.ShaderOutput.Color||
D.output===h.ShaderOutput.Alpha);H&&G.add("depth","float");A.uniforms.add(new w.Float4PassUniform("eColor",C=>C.color));var L=D.output===h.ShaderOutput.LinearDepth;L&&(E.include(f.OutputDepth,D),b.addNearFar(E),b.addLinearDepth(E));A.code.add(q.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${D.hasVertexColors?"vColor *\x3d eColor;":D.vvColor?"vColor \x3d eColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d eColor;"}
      ${H?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${L?q.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:q.glsl`transformPosition(proj, view, vpos);`}
    }
  `);E.include(c.SliceDraw,D);H&&E.include(e.multipassTerrainTest,D);B.include(u.ColorConversion);(L=D.output===h.ShaderOutput.Highlight)&&E.include(g.OutputHighlight,D);B.code.add(q.glsl`
  void main() {
    discardBySlice(vpos);
    ${H?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${D.output===h.ShaderOutput.ObjectAndLayerIdColor?q.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${q.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${D.output===h.ShaderOutput.Alpha?q.glsl`fragColor = vec4(fColor.a);`:""}

    ${D.output===h.ShaderOutput.Color?q.glsl`fragColor = highlightSlice(fColor, vpos); ${D.transparencyPassType===p.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${L?q.glsl`outputHighlight();`:""};
    ${D.output===h.ShaderOutput.LinearDepth?q.glsl`outputDepth(linearDepth);`:""};
    ${D.output===h.ShaderOutput.ObjectAndLayerIdColor?q.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return E}const y=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=y;a.build=r})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,h,c,k,m,d){class f extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=h.ShaderOutput.Color;this.cullFace=k.CullFaceOptions.None;this.transparencyPassType=m.TransparencyPassType.NONE;this.polygonOffset=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=this.enableOffset=!0;this.draped=this.vvColor=this.objectAndLayerIdColorInstanced=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=!1}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],f.prototype,"output",void 0);b.__decorate([c.parameter({count:k.CullFaceOptions.COUNT})],
f.prototype,"cullFace",void 0);b.__decorate([c.parameter({count:m.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",void 0);b.__decorate([c.parameter()],f.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],f.prototype,"hasVertexColors",void 0);b.__decorate([c.parameter()],f.prototype,"transparent",void 0);b.__decorate([c.parameter()],f.prototype,"polygonOffset",void 0);b.__decorate([c.parameter()],f.prototype,"enableOffset",void 0);b.__decorate([c.parameter()],f.prototype,
"writeDepth",void 0);b.__decorate([c.parameter()],f.prototype,"hasOccludees",void 0);b.__decorate([c.parameter()],f.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],f.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter()],f.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([c.parameter()],f.prototype,"vvColor",void 0);b.__decorate([c.parameter()],f.prototype,"draped",void 0);b.__decorate([c.parameter({constValue:!1})],f.prototype,"occlusionPass",void 0);b.__decorate([c.parameter({constValue:!0})],
f.prototype,"hasVvInstancing",void 0);b.__decorate([c.parameter({constValue:!1})],f.prototype,"vvSize",void 0);b.__decorate([c.parameter({constValue:!1})],f.prototype,"vvOpacity",void 0);a.ColorMaterialTechniqueConfiguration=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){class p extends x.TriangleMaterial{constructor(D){super(D,new y);this.supportsEdges=!0;this.produces=new Map([[g.RenderSlot.OPAQUE_MATERIAL,E=>k.isOIDorHighlight(E)],[g.RenderSlot.TRANSPARENT_MATERIAL,E=>k.isColorOrAlpha(E)],[g.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,E=>E===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth],[g.RenderSlot.DRAPED_MATERIAL,E=>this.parameters.draped&&E===k.ShaderOutput.Color||k.isOIDorHighlight(E)]]);this._vertexAttributeLocations=
v.vertexAttributeLocations;this._configuration=new v.PatternTechniqueConfiguration}getConfiguration(D,E){this._configuration.output=D;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;
this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=E.transparencyPassType;this._configuration.enableOffset=E.camera.relativeElevation<f.OITPolygonOffsetLimit;this._configuration.multipassEnabled=E.multipassEnabled;this._configuration.cullAboveGround=E.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration}createGLMaterial(D){return new t(D)}createBufferWriter(){const D=
c.newLayout().vec3f(n.VertexAttribute.POSITION).vec4f(n.VertexAttribute.UVMAPSPACE);this.parameters.draped||D.mat3f(n.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?D.f32(n.VertexAttribute.COLORFEATUREATTRIBUTE):D.vec4u8(n.VertexAttribute.COLOR);return new r(D)}}class t extends d{_updateParameters(D){return this.ensureTechnique(v.PatternTechnique,D)}_updateOccludeeState(D){D.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:D.hasOccludees})}beginSlot(D){this._output!==
k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(D);return this._updateParameters(D)}}class r extends l.DefaultBufferWriter{write(D,E,A,B,F){for(const H of this.vertexBufferLayout.fields.keys()){const L=A.attributes.get(H);var G=L?.indices;if(L&&G)switch(H){case n.VertexAttribute.UVMAPSPACE:e.assert(4===L.size);(G=B.getField(H,h.BufferViewVec4f))&&q.writeBufferVec4(L,G,F);break;case n.VertexAttribute.BOUNDINGRECT:e.assert(9===L.size);(G=B.getField(H,h.BufferViewMat3f))&&
this.writeBoundingRect(L,D,G,F);break;default:q.writeDefaultAttribute(H,L,D,E,B,F)}}}writeBoundingRect(D,E,A,B){const {data:F,indices:G}=D;D=A.typedBuffer;A=A.typedBufferStride;const H=G.length;B*=A;for(let C=0;C<H;++C){const z=9*G[C];var L=F[z];const J=F[z+1],K=F[z+2];D[B]=E[0]*L+E[4]*J+E[8]*K+E[12];D[B+1]=E[1]*L+E[5]*J+E[9]*K+E[13];D[B+2]=E[2]*L+E[6]*J+E[10]*K+E[14];for(L=3;9>L;++L)D[B+L]=F[z+L];B+=A}}}class y extends w.VisualVariablePassParameters{constructor(){super(...arguments);this.color=b.fromValues(1,
1,1,1);this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=m.CullFaceOptions.None;this.hasOccludees=!1;this.style=u.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}a.Parameters=y;a.PatternMaterial=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=
1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){class p extends m.ShaderTechnique{initializeProgram(D){return new e.Program(D.rctx,p.shader.get().build(this.configuration),y)}_setPipelineState(D,E){const A=this.configuration,B=D===l.TransparencyPassType.NONE,F=D===l.TransparencyPassType.FrontFace;return v.makePipelineState({blending:A.output===c.ShaderOutput.Color||A.output===c.ShaderOutput.Alpha?B?g.blendingDefault:g.oitBlending(D):null,culling:v.cullingParams(A.cullFace),depthTest:A.draped?null:{func:g.oitDepthTest(D)},
depthWrite:A.draped?null:B?v.defaultDepthWriteParams:g.oitDepthWrite(D),colorWrite:v.defaultColorWriteParams,stencilWrite:A.hasOccludees?n.stencilWriteMaskOn:null,stencilTest:A.hasOccludees?E?n.stencilToolMaskBaseParams:n.stencilBaseAllZerosParams:null,polygonOffset:B||F?A.polygonOffset?t:null:g.getOITPolygonOffset(A.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,
!1)}getPipeline(D){return D?this._occludeePipelineState:super.getPipeline()}}p.shader=new k.ReloadableShaderModule(q.Pattern,()=>new Promise((D,E)=>a(["./Pattern.glsl"],D,E)));const t={factor:1,units:1};class r extends x.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=c.ShaderOutput.Color;this.cullFace=f.CullFaceOptions.None;this.transparencyPassType=l.TransparencyPassType.NONE;this.hasOccludees=this.polygonOffset=this.hasVertexColors=this.hasSlicePlane=!1;this.enableOffset=
!0;this.vvColor=this.cullAboveGround=this.multipassEnabled=!1}}h.__decorate([d.parameter({count:c.ShaderOutput.COUNT})],r.prototype,"output",void 0);h.__decorate([d.parameter({count:f.CullFaceOptions.COUNT})],r.prototype,"cullFace",void 0);h.__decorate([d.parameter({count:w.Style.COUNT})],r.prototype,"style",void 0);h.__decorate([d.parameter({count:l.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);h.__decorate([d.parameter()],r.prototype,"hasSlicePlane",void 0);h.__decorate([d.parameter()],
r.prototype,"hasVertexColors",void 0);h.__decorate([d.parameter()],r.prototype,"polygonOffset",void 0);h.__decorate([d.parameter()],r.prototype,"hasOccludees",void 0);h.__decorate([d.parameter()],r.prototype,"patternSpacing",void 0);h.__decorate([d.parameter()],r.prototype,"lineWidth",void 0);h.__decorate([d.parameter()],r.prototype,"enableOffset",void 0);h.__decorate([d.parameter()],r.prototype,"draped",void 0);h.__decorate([d.parameter()],r.prototype,"multipassEnabled",void 0);h.__decorate([d.parameter()],
r.prototype,"cullAboveGround",void 0);h.__decorate([d.parameter()],r.prototype,"vvColor",void 0);h.__decorate([d.parameter({constValue:!0})],r.prototype,"writeDepth",void 0);h.__decorate([d.parameter({constValue:!1})],r.prototype,"occlusionPass",void 0);h.__decorate([d.parameter({constValue:!1})],r.prototype,"hasVvInstancing",void 0);h.__decorate([d.parameter({constValue:!1})],r.prototype,"vvSize",void 0);h.__decorate([d.parameter({constValue:!1})],r.prototype,"vvOpacity",void 0);const y=new Map([[u.VertexAttribute.POSITION,
0],[u.VertexAttribute.COLOR,3],[u.VertexAttribute.UVMAPSPACE,4],[u.VertexAttribute.COLORFEATUREATTRIBUTE,5],[u.VertexAttribute.BOUNDINGRECT,6]]);b.PatternTechnique=p;b.PatternTechniqueConfiguration=r;b.vertexAttributeLocations=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(A){const B=new v.ShaderBuilder,F=A.multipassEnabled&&(A.output===h.ShaderOutput.Color||A.output===h.ShaderOutput.Alpha),{vertex:G,fragment:H,attributes:L,varyings:C}=B;u.addProjViewLocalOrigin(G,A);B.include(k.Transform,A);B.include(m.VertexColor,A);B.include(e.VisualVariables,A);A.draped?G.uniforms.add(new w.FloatPassUniform("worldToScreenRatio",(J,K)=>1/K.screenToPCSRatio)):L.add(t.VertexAttribute.BOUNDINGRECT,"mat3");L.add(t.VertexAttribute.POSITION,
"vec3");L.add(t.VertexAttribute.UVMAPSPACE,"vec4");A.vvColor&&L.add(t.VertexAttribute.COLORFEATUREATTRIBUTE,"float");C.add("vColor","vec4");C.add("vpos","vec3");C.add("vuv","vec2");F&&C.add("depth","float");G.uniforms.add(new x.Float4PassUniform("uColor",J=>J.color));var z=A.style===r.Style.ForwardDiagonal||A.style===r.Style.BackwardDiagonal||A.style===r.Style.DiagonalCross;z&&G.code.add(q.glsl`
      const mat2 rotate45 = mat2(${q.glsl.float(.70710678118)}, ${q.glsl.float(-.70710678118)},
                                 ${q.glsl.float(.70710678118)}, ${q.glsl.float(.70710678118)});
    `);A.draped||(u.addCameraPosition(G,A),G.uniforms.add(new w.FloatPassUniform("worldToScreenPerDistanceRatio",(J,K)=>1/K.camera.perScreenPixelRatio)),G.code.add(q.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),G.code.add(q.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),G.code.add(q.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${q.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));G.code.add(q.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${z?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${z?" * rotate45":""};

      ${A.draped?"":q.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${q.glsl.float(A.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(z=A.output===h.ShaderOutput.LinearDepth)B.include(d.OutputDepth,A),b.addNearFar(B),b.addLinearDepth(B);G.code.add(q.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${F?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${A.hasVertexColors?"vColor *\x3d uColor;":A.vvColor?"vColor \x3d uColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d uColor;"}
      gl_Position = ${z?q.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:q.glsl`transformPosition(proj, view, vpos);`}
    }
  `);B.include(c.SliceDraw,A);H.include(l.ColorConversion);A.draped&&H.uniforms.add(new w.FloatPassUniform("texelSize",(J,K)=>1/K.camera.pixelRatio));A.output===h.ShaderOutput.Highlight&&B.include(f.OutputHighlight,A);F&&B.include(g.multipassTerrainTest,A);A.output!==h.ShaderOutput.Highlight&&(H.code.add(q.glsl`
      const float lineWidth = ${q.glsl.float(A.lineWidth)};
      const float spacing = ${q.glsl.float(A.patternSpacing)};
      const float spacingINV = ${q.glsl.float(1/A.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),A.draped||H.code.add(q.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));H.code.add(q.glsl`
    void main() {
      discardBySlice(vpos);
      ${F?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${A.output!==h.ShaderOutput.Highlight?q.glsl`color.a *= ${D(A)};`:""}

      ${A.output===h.ShaderOutput.ObjectAndLayerIdColor?q.glsl`color.a = 1.0;`:""}

      if (color.a < ${q.glsl.float(n.symbolAlphaCutoff)}) {
        discard;
      }

      ${A.output===h.ShaderOutput.Alpha?q.glsl`fragColor = vec4(color.a);`:""}

      ${A.output===h.ShaderOutput.Color?q.glsl`fragColor = color; ${A.transparencyPassType===p.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${A.output===h.ShaderOutput.Highlight?q.glsl`outputHighlight();`:""}
      ${A.output===h.ShaderOutput.LinearDepth?q.glsl`outputDepth(linearDepth);`:""};
    }
  `);return B}function D(A){function B(F){return A.draped?q.glsl`coverage(vuv.${F}, texelSize)`:q.glsl`sampleAA(vuv.${F})`}switch(A.style){case r.Style.ForwardDiagonal:case r.Style.Horizontal:return B("y");case r.Style.BackwardDiagonal:case r.Style.Vertical:return B("x");case r.Style.DiagonalCross:case r.Style.Cross:return q.glsl`
        1.0 - (1.0 - ${B("x")}) * (1.0 - ${B("y")})
      `;default:return"0.0"}}const E=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.Pattern=E;a.build=y})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../core/Error ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./LabelParameters ./placementUtils ./pointUtils ../../webgl-engine/lib/FontMetrics ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(H,L,C){H&&H.forEach(z=>{const J=L(z);null!=J&&C(J,z.graphic)})}function A(H,L){if("baseline"===L.verticalPlacement)return k.fromValues(q.horizontalPlacementToAnchorX[L.horizontalPlacement],null!=H?H.baselineAnchorY:0);H=q.anchorFromPlacements(L.horizontalPlacement,L.verticalPlacement);return q.namedAnchorToHUDMaterialAnchorPos[H]}const B=m.fromValues(0,0,1);class F extends u.Graphics3DSymbolLayer{constructor(H,L,C,z){super(H,L,C,z);
this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const H=x.validateSymbolLayerSize(this.symbolLayer.size);if(H)throw new b("graphics3dtextsymbollayer:invalid-size",H);}await this._createTextRenderParameters()}async _createTextRenderParameters(){this._textRenderParameters=await r.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)}destroy(){super.destroy()}createGraphics3DGraphic(H){H=
H.graphic;const L=v.placePointOnGeometry(H.geometry);if(null==L)return this.logger.warn(`unsupported geometry type for text symbol: ${H.geometry.type}`),null;const C=this.symbolLayer.text;if(null==C||""===C)return null;var z=d.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=z&&!d.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+
`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;var {verticalAlignment:J}=this.symbolLayer;z=new w.LabelPlacement(z);q.verticalScreenOffsetFromAlignment(J,z.screenOffset);J=new w.LabelParameters(z,this.symbolLayer.horizontalAlignment,q.verticalPlacementFromAlignment(J));return this._createAs3DShape(H,L,C,J)}createLabel(H,L,C,z,J){H=H.graphic;const K=v.placePointOnGeometry(H.geometry);if(null==K)return this.logger.warn(`unsupported geometry type for label: ${H.geometry.type}`),
null;const I=L.text;return!I||/^\s+$/.test(I)?null:this._createAs3DShape(H,K,I,L,C,z,J)}setGraphicElevationContext(H,L,C=0){super.setGraphicElevationContext(H,L);L.addOffsetRenderUnits(C);return L}layerOpacityChanged(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1}layerElevationInfoChanged(H,L){E(H,L,(C,z)=>{this.updateGraphicElevationContext(z,C)});return g.SymbolUpdateType.UPDATE}slicePlaneEnabledChanged(H,L){E(H,L,C=>{for(const z of C.stageObject.geometries)z.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});
return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(H,L){const C=L.elevationContext;this.setGraphicElevationContext(H,C,null!=L.metadata?L.metadata.elevationOffset:0);L.needsElevationUpdates=g.needsElevationUpdates2D(C.mode)||"absolute-height"===C.mode}_defaultElevationInfoNoZ(){return G}_createAs3DShape(H,L,C,z,J=null,K=null,I=()=>z.placement.elevationOffset){const M=this.setGraphicElevationContext(H,new e.ElevationContext,z.placement.elevationOffset);
var S="polyline"===H.geometry?.type,N=H.uid;let V=null,Q=null;if(null==K){var T=q.textRenderAlignmentFromHorizontalPlacement(z.horizontalPlacement);V=new y(C,T,this._textRenderParameters);let U=null;if(null!=this._context.sharedResources.textures){Q=this._context.sharedResources.textures.fromData(V.key,()=>V.create());Q.texture.events.on("unloaded",()=>U?.release());T=this._context.stage.renderView.textureRepository.acquire(Q.texture.id);if(null==T||h.isPromiseLike(T))return Q.release(),null;U=T}}T=
A(V,z);T={occlusionTest:!0,screenOffset:z.placement.screenOffset,anchorPosition:T,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:z.placement.centerOffsetUnits,drawInSecondSlot:!0};K?T.textureId=K.id:Q&&(T.textureId=Q.texture.id);if(null!=z.placement.verticalOffset){const {screenLength:U,minWorldLength:P,maxWorldLength:R}=z.placement.verticalOffset;T.verticalOffset={screenLength:c.pt2px(U),minWorldLength:P||0,maxWorldLength:null!=R?R:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:U,
screenSizePerspectiveSettingsLabels:P}=this._context.sharedResources;K=p.getFontMetrics(this._textRenderParameters);T.screenSizePerspective=P.overrideFontHeight(K.maxHeight);T.screenSizePerspectiveAlignment=U}S&&(T.shaderPolygonOffset=1E-4);T.hasSlicePlane=this._context.slicePlaneEnabled;S=(U,P)=>{const R=JSON.stringify(P);let ba=U.get(R);null==ba&&(ba=new D.HUDMaterial(P),U.add(R,ba));return ba};S=J?S(J,T):new D.HUDMaterial(T);K=z.placement.translation;T=V?k.fromValues(V.displayWidth,V.displayHeight):
k.ZEROS;const ia=z.placement.centerOffset,O=k.create();K=t.createPointGeometry(S,B,K,null,T,ia,O,null);N=v.createStageObject(this._context,L,K,M,N);if(null==N)return null;J=new n.Graphics3DObject3DGraphicLayer(this,N.object,[K],null==J?[S]:null,Q,(U,P,R,ba,X,da)=>{const ha=I()||z.placement.elevationOffset;P=this.setGraphicElevationContext(H,P,ha);return f.perObjectElevationAligner(U,P,R,ba,X,da)},M);J.alignedSampledElevation=N.sampledElevation;J.needsElevationUpdates=g.needsElevationUpdates2D(M.mode)||
"absolute-height"===M.mode;J.getScreenSize=(U=k.create())=>{U[0]=V?V.displayWidth:z.displaySize[0];U[1]=V?V.displayHeight:z.displaySize[1];return U};C=new l.Graphics3DObjectMetadata(z.placement.elevationOffset,C);J.metadata=C;v.extendPointGraphicElevationContext(J,L,this._context.elevationProvider);return J}}const G={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelParameters":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,h,c){class k{constructor(d,f="center",g=!1,e=b.create(),n=c.fromValues(0,0,0,-1),l="world",u=h.create(),x=0){this.verticalOffset=d;this.anchor=f;this.hasLabelVerticalOffset=g;this.screenOffset=e;this.centerOffset=n;this.centerOffsetUnits=l;this.translation=u;this.elevationOffset=x}}class m{constructor(d,f="center",g="center",
e=null,n=b.create()){this.placement=d;this.horizontalPlacement=f;this.verticalPlacement=g;this.text=e;this.displaySize=n}}a.LabelParameters=m;a.LabelPlacement=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(a,b,h,c,k,m){class d{constructor(g){this.definition=
g;this.key=JSON.stringify(g);this.haloSize=Math.round(g.halo.size);this.textStyle=this._colorToRGBA(g.color);this.haloStyle=this._colorToRGB(g.halo.color);this.backgroundStyle=0!==g.background.color[3]?this._colorToRGBA(g.background.color):null}fontString(g){const e=this.definition.font;return`${e.style} ${e.weight} ${g}px ${e.family}, ${"sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji"}`}setFontProperties(g,e){g.font=this.fontString(e);g.textAlign="left";g.textBaseline=
"alphabetic"}_colorToRGB(g){return`rgb(${g.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}_colorToRGBA(g){return`rgba(${g.slice(0,3).map(e=>Math.floor(255*e)).toString()},${g[3]})`}static async fromSymbol(g,e){var n=b.toUnitRGBA(g?.material?.color)??m.ZEROS,l=null!=g.size?k.pt2px(g.size):12;const u=g.lineHeight,x=null!=g.background?b.toUnitRGBA(g.background.color):m.ZEROS,w={family:g.font?.family??"sans-serif",decoration:g.font?.decoration??"none",weight:g.font?.weight??"normal",style:g.font?.style??
"normal"};var q=g.halo;q=null!=q?.color&&0<q.size?{size:k.pt2px(q.size),color:b.toUnitRGBA(q.color)}:{size:0,color:m.ZEROS};e=new d({color:n,size:l,background:{color:x,padding:null!=g.background?[.65*l,.5*l]:[0,0],borderRadius:null!=g.background?.375*l:0},lineSpacingFactor:u,font:w,halo:q,pixelRatio:e});if(g.font){n=!1;l=e.fontString(l);try{n=(await document.fonts.load(l)).some(v=>!h.isCachedFontFace(v))}catch(v){c.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${l}'. Some text symbology may be rendered using the default browser font.`)}if(!n&&
!f.has(g.font.family))try{await h.loadFont(g.font)}catch(v){}}return e}}const f=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));a.TextRenderParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["./TextHelperCanvas","./TextRenderer","./TextTextureAtlas","./Texture","../../../webgl/enums"],
function(a,b,h,c,k){class m{constructor(f,g,e){this._renderer=new b.TextRenderer(f,g,e,h.TextTextureAtlas.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const f=a.getTextHelperCanvas(d,this._renderer.renderedWidth,this._renderer.renderedHeight),g=f.getContext("2d");g.save();this._renderer.render(g,
0,0);g.restore();return new c.Texture(f,{wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,t:k.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const d={canvas:null};return m})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ./VertexAttribute ../../../support/Scheduler ../../../support/Yield ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(H,L){H.geometries[0].setAttributeData(v.VertexAttribute.UV0,L.uv);H.geometryVertexAttributeUpdated(H.geometries[0],v.VertexAttribute.UV0,!0)}a.TextTextureAtlas=class extends h{constructor(H){super(H);this.type=x.ContentObjectType.Texture;this.id=m.generateUID();this.events=new c;this._glTexture=null;this._atlas=new B(256,256);this._needsRepack=!1;this._canRepack=!0;this._elementsToRender=new Map;this._elements=new Map;this._stageObjects=
new Map;this.updating=!1}initialize(){this._canvas=document.createElement("canvas");this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style","display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._updateCanvasElementSize(this._atlas);this._reset()}unload(){this._glTexture=k.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){G=w.textTextureAtlas.stableRendering?
2:0;return[4094-G,4094-G-2]}load(H){if(this._glTexture)return this._glTexture;const L=new D.TextureDescriptor;L.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;L.samplingMode=r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;L.hasMipmap=!0;L.preMultiplyAlpha=!0;L.maxAnisotropy=H.parameters.maxMaxAnisotropy;this._glTexture=new y.Texture(H,L,this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(p.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture}dispose(){this._elements.clear();
this._elementsToRender.clear();this._frameWorker=k.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=k.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null}_updateCanvasElementSize(H){this._canvas.setAttribute("width",H.width.toString());this._canvas.setAttribute("height",H.height.toString())}_resizeAtlas(H,L){const {width:C,height:z}=this._atlas;if(C!==H||z!==L)this._atlas.width=H,this._atlas.height=L,this._glTexture?.resize(H,
L),this._glTexture?.updateData(0,0,0,C,z,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(J=>{this._stageObjects.get(J.textRenderer.key)?.forEach(K=>E(K,J))}),this._reset()}_reset(){this._elementsToRender.clear();this._atlas.reset();this._needsRepack=!0;this.setDirty()}_addAtlasElement(H,L,C,z){const J=this._atlas;if(J.width<C||J.height<z)return!1;let K=J.cursors.get(z);if(!K){if(J.height<J.nextY+z)return!1;K=[new F(J.nextY)];J.cursors.set(z,K);J.nextY+=z}let I=K.find(M=>
J.width>=M.x+C);if(null==I){if(J.height<J.nextY+z)return!1;I=new F(J.nextY);J.nextY+=z;K.push(I)}H.setNewPosition(I);this._elements.set(L,H);this._elementsToRender.set(L,H);I.x+=C;return!0}_ensureStageObjects(H){var L=this._stageObjects.get(H);if(L)return L;L=new Set;this._stageObjects.set(H,L);return L}_addStageObject(H,L){this._ensureStageObjects(H).add(L)}_removeStageObject(H,L){this._stageObjects.get(H)?.delete(L)&&(L.geometries[0].setAttributeData(v.VertexAttribute.SIZE,[0,0]),L.geometryVertexAttributeUpdated(L.geometries[0],
v.VertexAttribute.SIZE),this._elementsToRender.delete(H))}_processAddition(H){const L=H.textRenderer.key;if(this._needsRepack)this._elements.set(L,H);else{var C=this._atlas,z=H.textRenderer.renderedWidth+2,J=H.textRenderer.renderedHeight+2+2;this._addAtlasElement(H,L,z,J)||(this._canRepack?this._reset():C.width<z?(z=Math.min(q.applyTextureResizeModulo(Math.max(z,1.5*C.width)),4096),this._resizeAtlas(z,C.height)):(z=Math.min(q.applyTextureResizeModulo(Math.max(C.nextY+J,1.5*C.height)),4096),z>C.height?
this._resizeAtlas(C.width,z):4096>C.width&&(z=Math.min(q.applyTextureResizeModulo(1.5*C.width),4096),this._resizeAtlas(z,C.height))),this._elements.set(L,H))}}_renderElement(H){const L=H.commitNewPosition();this._ctx.clearRect(L[0]-2,L[1]-2,H.textRenderer.renderedWidth+4,H.textRenderer.renderedHeight+4);H.textRenderer.render(this._ctx,L[0],L[1]);this._stageObjects.get(H.textRenderer.key)?.forEach(C=>E(C,H))}get running(){return this.updating}runTask(H){if(null==this._glTexture)return t.Yield;for(;this._needsRepack&&
(this._canRepack||4096>this._atlas.height&&4096>this._atlas.height);){this._canRepack=this._needsRepack=!1;const L=this._elements;this._elements=new Map;L.forEach(C=>this._processAddition(C));H.madeProgress()}if(0<this._elementsToRender.size){for(const [L,C]of this._elementsToRender){if(H.done)break;this._renderElement(C);this._elementsToRender.delete(L);H.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=0<this._elementsToRender.size}addTextTexture(H,L){var C=H.key;this._addStageObject(C,
L);C=this._elements.get(C);null==C&&(C=new A(this._atlas,H),this._processAddition(C),this.setDirty());L.geometries[0].setAttributeData(v.VertexAttribute.SIZE,[C.textRenderer.displayWidth,C.textRenderer.displayHeight]);L.geometryVertexAttributeUpdated(L.geometries[0],v.VertexAttribute.SIZE);E(L,C)}removeTextTexture(H,L){H=H.key;this._elements.get(H)&&(this._removeStageObject(H,L),(L=this._stageObjects.get(H))&&0!==L.size||this._elements.delete(H),0===L?.size&&this._stageObjects.delete(H),this._canRepack=
!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const {_elements:H,_stageObjects:L,_atlas:C}=this,z=this;return{elements:H,stageObjects:L,atlas:C,resizeAtlas:(J,K)=>z._resizeAtlas(J,K),run:J=>z.runTask(J)}}};b.__decorate([d.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([d.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=b.__decorate([n.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],a.TextTextureAtlas);
class A{constructor(H,L){this._atlas=H;this.textRenderer=L;this._uv=u.create();this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return u.ZEROS;const {renderedWidth:H,renderedHeight:L}=this.textRenderer;return l.set(this._uv,this._xOffset/this._atlas.width,(this._yOffset+L)/this._atlas.height,(this._xOffset+H)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(H){this._newPosition[0]=H.x;this._newPosition[1]=H.y}commitNewPosition(){this._xOffset=this._newPosition[0];
this._yOffset=this._newPosition[1];return this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class B{constructor(H,L){this.width=H;this.height=L;this.cursors=new Map;this.nextY=0}reset(){this.cursors.clear();this.nextY=G}}class F{constructor(H){this.y=H;this.x=G}}let G=0;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../Color ../../../../core/unitUtils ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){const E=["polyline","polygon","extent"];class A extends q.Graphics3DSymbolLayer{constructor(z,J,K,I){super(z,J,K,I)}async doLoad(){}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}createGraphics3DGraphic(z){z=z.graphic;if(!this._validateGeometry(z.geometry,E,this.symbolLayer.type))return null;const J=this.setGraphicElevationContext(z);this.ensureDrapedStatus("on-the-ground"===J.mode);this.ensureMaterial();
return this.draped?this._createAsOverlay(z):this._createAs3DShape(z,J,z.uid)}ensureMaterial(){if(!this._materials[0]){var z=new y.WaterMaterialParameters,J=this.symbolLayer.color;null!=J&&(z.color=b.toUnitRGBA(J));J=this._getCombinedOpacity(J,{hasIntrinsicColor:!0});z.color=[z.color[0],z.color[1],z.color[2],J];z.transparent=1>J||this.needsDrivenTransparentPass;z.waveDirection=null!=this.symbolLayer.waveDirection?A.headingVectorFromAngle(this.symbolLayer.waveDirection):m.fromValues(0,0);J=D.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];z.waveStrength=J.waveStrength;z.waveTextureRepeat=J.textureRepeat;z.waveVelocity=J.waveVelocity;z.flowStrength=J.perturbationStrength;z.hasSlicePlane=this._context.slicePlaneEnabled;z.draped=this.draped;this._materials[0]=new y.WaterMaterial(z);this._context.stage.add(this._materials[0])}}layerOpacityChanged(){if(null!=this._materials[0]){var z=this._materials[0].parameters.color,J=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._materials[0].setParameters({color:[z[0],
z[1],z[2],J],transparent:1>J||this.needsDrivenTransparentPass})}}layerElevationInfoChanged(z,J,K){const I=this._elevationContext.mode;K=u.elevationModeChangeUpdateType(A.elevationModeChangeTypes,K,I);if(K!==u.SymbolUpdateType.UPDATE)return K;const M=u.needsElevationUpdates2D(I);return this.updateGraphics3DGraphicElevationInfo(z,J,()=>M)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(z,
J,K){const I=v.geometryAsPolygon(z.geometry);if(null==I)return null;const M=p.geometryToRenderInfo(I,this._context.elevationProvider,this._context.renderCoordsHelper,J),S=M.position.length/3,N=n.newDoubleArray(2*S);this._createUVCoordsFromVertices(N,M.mapPositions,S,this._context.elevationProvider.spatialReference);z=new L(M,N,this._context.layer.uid,z.uid);z.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(z);this._create3DShapeGeometries(z);this._logGeometryCreationWarnings(z.renderData,
I.rings,"rings","WaterSymbol3DLayer");if(0===z.outGeometries.length)return null;K=new t.Object3D({geometries:z.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:K});K=new w.Graphics3DObject3DGraphicLayer(this,K,z.outGeometries,null,null,l.perVertexElevationAligner,J);K.alignedSampledElevation=z.renderData.sampledElevation;K.needsElevationUpdates=u.needsElevationUpdates2D(J.mode);return K}_createUVCoordsFromVertices(z,J,K,I){I=h.getMetersPerUnitForSR(I);e.empty(F);for(var M=0;M<
K;M++)k.set(G,J[3*M],J[3*M+1]),e.expandPointInPlace(F,G);d.scale(F,F,I);M=F[1]%A.unitSizeOfTexture;B[0]=F[0]-F[0]%A.unitSizeOfTexture;B[1]=F[1]-M;for(M=0;M<K;M++)z[2*M]=(J[3*M]*I-B[0])/A.unitSizeOfTexture,z[2*M+1]=(J[3*M+1]*I-B[1])/A.unitSizeOfTexture}_create3DShapeGeometries(z){var J=z.renderData.polygons;const K=z.uvCoords;for(const {count:I,index:M,position:S,mapPositions:N,holeIndices:V}of J){if(null!=this._context.clippingExtent&&(g.empty(H),g.expandWithBuffer(H,N),!g.intersectsClippingArea(H,
this._context.clippingExtent)))continue;J=c.earcut(N,V,3);if(0===J.length)continue;const Q=n.doubleSubArray(K,2*M,2*I);J=v.createWaterGeometry({material:this._materials[0],indices:J,mapPositions:N,attributeData:{position:S,uv0:Q}},z.objectAndLayerIdColor);z.outGeometries.push(J)}}_createAsOverlay(z){const J=v.geometryAsPolygon(z.geometry);if(null==J)return null;this._materials[0].renderPriority=this._renderPriority;const K=p.geometryToRenderInfoDraped(J,this._context.overlaySR),I=K.position.length/
3,M=n.newDoubleArray(2*I);this._createUVCoordsFromVertices(M,K.position,I,this._context.overlaySR);z=new C(K,M,this._context.layer.uid,z.uid);z.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(z);z.outBoundingBox=g.empty();this._createAsOverlayWater(z);this._logGeometryCreationWarnings(z.renderData,J.rings,"rings","WaterSymbol3DLayer");return 0===z.outGeometries.length?null:new x.Graphics3DDrapedGraphicLayer(this,z.outGeometries,z.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(z){const J=
z.uvCoords;var K=z.renderData.polygons;for(const {position:I,holeIndices:M,index:S,count:N}of K){g.empty(H);g.expandWithBuffer(H,I);if(!g.intersectsClippingArea(H,this._context.clippingExtent))continue;g.expandWithAABB(z.outBoundingBox,H);K=c.earcut(I,M,3);if(0===K.length)continue;const V=n.doubleSubArray(J,2*S,2*N);K=v.createWaterGeometry({material:this._materials[0],indices:K,attributeData:{position:I,uv0:V}},z.objectAndLayerIdColor);z.outGeometries.push(new r.RenderGeometry(K,z))}}static headingVectorFromAngle(z){const J=
m.create();z=f.toRadian(z);J[0]=Math.sin(z);J[1]=Math.cos(z);return J}test(){return{...super.test(),create3DShape:z=>this._createAs3DShape(z.graphic,z.elevationContext,z.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}A.unitSizeOfTexture=100;A.elevationModeChangeTypes={definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};const B=m.create(),F=e.create(),G=m.create(),H=g.create();class L extends v.PolygonCreationDataBase{constructor(z,
J,K,I){super(z,K,I);this.uvCoords=J}}class C extends v.PolygonCreationDataBase{constructor(z,J,K,I){super(z,K,I);this.uvCoords=J}}a.Graphics3DWaterSymbolLayer=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../core/has ../../../../core/time ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){class v extends x.TriangleMaterial{constructor(t){super(t,new p);this._configuration=new q.WaterTechniqueConfiguration;this._animation=new f.AnimationTimer;this.produces=new Map([[n.RenderSlot.OPAQUE_MATERIAL,r=>d.isColorOrAlpha(r)&&!this.parameters.transparent||d.isOIDorHighlight(r)],[n.RenderSlot.TRANSPARENT_MATERIAL,r=>d.isColorOrAlpha(r)&&this.parameters.transparent||d.isOIDorHighlight(r)],[n.RenderSlot.DRAPED_MATERIAL,r=>this.parameters.draped&&r===d.ShaderOutput.Color||
d.isOIDorHighlight(r)],[n.RenderSlot.DRAPED_WATER,r=>r===d.ShaderOutput.Normal]])}getConfiguration(t,r){this._configuration.output=t;this._configuration.writeDepth=!0;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;
this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=r.transparencyPassType;this._configuration.enableOffset=r.camera.relativeElevation<e.OITPolygonOffsetLimit;this._configuration.multipassEnabled=r.multipassEnabled;this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround;return this._configuration}update(t){this._animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(t.camera.relativeElevation,
t.camera.distance);t=this._animation.advance(t);this.setParameters({timeElapsed:h.secondsFromMilliseconds(this._animation.time)*this.parameters.animationSpeed},!1);return this._animation.enabled&&t}createGLMaterial(t){return new w.WaterGLMaterial(t)}createBufferWriter(){return new l.DefaultBufferWriter(b("enable-feature:objectAndLayerId-rendering")?u.PositionUVLayoutObjectAndLayerId:u.PositionUVLayout)}get test(){return{animationEnabled:this._animation.enabled}}}class p extends g.MaterialParameters{constructor(){super(...arguments);
this.waveStrength=.06;this.waveTextureRepeat=32;this.waveDirection=c.fromValues(1,0);this.waveVelocity=.05;this.flowStrength=.015;this.flowOffset=-.5;this.animationSpeed=.35;this.timeElapsed=0;this.color=m.fromValues(0,0,0,0);this.transparent=!0;this.draped=this.hasSlicePlane=!1;this.receiveShadows=!0;this.hasCloudsReflections=this.hasScreenSpaceReflections=!1;this.origin=k.create();this.modelTransformation=null}}a.WaterMaterial=v;a.WaterMaterialParameters=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","./WaterTechnique"],function(a,b,h,c){class k extends h{_updateShadowState(m){m.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:m.shadowMap.enabled})}_updateSSRState(m){m=null!=m.ssr.lastFrameColor;m!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:m})}_updateCloudsReflectionState(m){m=
null!=m.cloudsFade.data;m!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:m})}ensureResources(m){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(m)}beginSlot(m){this._output===b.ShaderOutput.Color&&(this._updateShadowState(m),this._updateSSRState(m),this._updateCloudsReflectionState(m));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(c.WaterTechnique,
m)}}a.WaterGLMaterial=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){class p extends d.WaterDistortionPassParameters{}class t extends g.ShaderTechnique{initializeConfiguration(y,D){D.spherical=y.viewingMode===c.ViewingMode.Global;D.doublePrecisionRequiresObfuscation=y.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(y){return new u.Program(y.rctx,t.shader.get().build(this.configuration),n.Default3D)}_setPipelineState(y){const D=this.configuration,E=y===x.TransparencyPassType.NONE,A=y===x.TransparencyPassType.FrontFace;
return v.makePipelineState({blending:D.output!==k.ShaderOutput.Normal&&D.output!==k.ShaderOutput.Highlight&&D.output!==k.ShaderOutput.ObjectAndLayerIdColor&&D.transparent?E?l.blendingDefault:l.oitBlending(y):null,depthTest:D.draped?null:{func:l.oitDepthTest(y)},depthWrite:D.draped?null:E?D.writeDepth?v.defaultDepthWriteParams:null:l.oitDepthWrite(y),colorWrite:v.defaultColorWriteParams,polygonOffset:E||A?null:l.getOITPolygonOffset(D.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}
t.shader=new f.ReloadableShaderModule(q.WaterSurface,()=>new Promise((y,D)=>a(["../shaders/WaterSurface.glsl"],y,D)));class r extends w.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.transparencyPassType=x.TransparencyPassType.NONE;this.transparent=this.hasSlicePlane=this.receiveShadows=this.spherical=!1;this.enableOffset=!0;this.cullAboveGround=this.multipassEnabled=this.draped=this.objectAndLayerIdColorInstanced=this.hasCloudsReflections=this.doublePrecisionRequiresObfuscation=
this.hasScreenSpaceReflections=this.writeDepth=!1}}h.__decorate([e.parameter({count:k.ShaderOutput.COUNT})],r.prototype,"output",void 0);h.__decorate([e.parameter({count:x.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);h.__decorate([e.parameter()],r.prototype,"spherical",void 0);h.__decorate([e.parameter()],r.prototype,"receiveShadows",void 0);h.__decorate([e.parameter()],r.prototype,"hasSlicePlane",void 0);h.__decorate([e.parameter()],r.prototype,"transparent",void 0);h.__decorate([e.parameter()],
r.prototype,"enableOffset",void 0);h.__decorate([e.parameter()],r.prototype,"writeDepth",void 0);h.__decorate([e.parameter()],r.prototype,"hasScreenSpaceReflections",void 0);h.__decorate([e.parameter()],r.prototype,"doublePrecisionRequiresObfuscation",void 0);h.__decorate([e.parameter()],r.prototype,"hasCloudsReflections",void 0);h.__decorate([e.parameter()],r.prototype,"objectAndLayerIdColorInstanced",void 0);h.__decorate([e.parameter()],r.prototype,"draped",void 0);h.__decorate([e.parameter()],
r.prototype,"multipassEnabled",void 0);h.__decorate([e.parameter()],r.prototype,"cullAboveGround",void 0);h.__decorate([e.parameter({constValue:!1})],r.prototype,"occlusionPass",void 0);h.__decorate([e.parameter({constValue:m.PBRMode.Water})],r.prototype,"pbrMode",void 0);h.__decorate([e.parameter({constValue:!0})],r.prototype,"useCustomDTRExponentForWater",void 0);h.__decorate([e.parameter({constValue:!0})],r.prototype,"highStepCount",void 0);h.__decorate([e.parameter({constValue:!1})],r.prototype,
"useFillLights",void 0);b.WaterMaterialPassParameters=p;b.WaterTechnique=t;b.WaterTechniqueConfiguration=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./FoamRendering.glsl ./ReadShadowMap.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends d.ReadShadowMapPassParameters{}const u=k.create(),x=h.create();a.WaterDistortion=function(w){w.fragment.uniforms.add(new n.Texture2DPassUniform("texWaveNormal",q=>q.waveNormal),new n.Texture2DPassUniform("texWavePerturbation",q=>q.wavePerturbation),new g.Float4PassUniform("waveParams",q=>c.set(u,q.waveStrength,q.waveTextureRepeat,q.flowStrength,q.flowOffset)),new f.Float2PassUniform("waveDirection",q=>b.set(x,q.waveDirection[0]*q.waveVelocity,q.waveDirection[1]*
q.waveVelocity)));w.include(m.FoamIntensity);w.fragment.code.add(e.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A){function B(G){const H=new D.ShaderBuilder,{vertex:L,fragment:C}=H;p.addProjViewLocalOrigin(L,G);H.include(k.Transform,G);H.attributes.add(A.VertexAttribute.POSITION,"vec3");H.attributes.add(A.VertexAttribute.UV0,"vec2");const z=new t.Float4PassUniform("waterColor",J=>J.color);if(G.output===h.ShaderOutput.Color&&G.draped)return H.varyings.add("vpos","vec3"),L.uniforms.add(z),L.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),C.uniforms.add(z),C.code.add(y.glsl`void main() {
fragColor = waterColor;
}`),H;if(G.output===h.ShaderOutput.Color||G.output===h.ShaderOutput.Alpha)H.include(n.NormalUtils,G),H.include(b.ForwardLinearDepth,G),H.varyings.add("vuv","vec2"),H.varyings.add("vpos","vec3"),H.varyings.add("vnormal","vec3"),H.varyings.add("vtbnMatrix","mat3"),G.multipassEnabled&&H.varyings.add("depth","float"),L.uniforms.add(z),L.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${G.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${G.output===h.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);H.include(e.multipassTerrainTest,G);switch(G.output){case h.ShaderOutput.Alpha:H.include(c.SliceDraw,G);C.uniforms.add(z);C.code.add(y.glsl`
        void main() {
          discardBySlice(vpos);
          ${G.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case h.ShaderOutput.Color:H.include(g.MainLighting);H.include(f.EvaluateAmbientLighting,{pbrMode:l.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});H.include(w.WaterDistortion);H.include(c.SliceDraw,G);H.include(u.ReadShadowMapDraw,G);H.include(x.Water,G);C.uniforms.add(z,new r.FloatPassUniform("timeElapsed",J=>J.timeElapsed),L.uniforms.get("view"),L.uniforms.get("localOrigin"));p.addCameraPosition(C,G);C.include(v.ColorConversion);g.addMainLightDirection(C);g.addMainLightIntensity(C);
C.code.add(y.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${G.receiveShadows?y.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${G.transparencyPassType===E.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case h.ShaderOutput.Normal:H.include(n.NormalUtils,G);H.include(w.WaterDistortion,G);H.include(c.SliceDraw,G);H.varyings.add("vpos","vec3");H.varyings.add("vuv","vec2");L.uniforms.add(z);L.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);C.uniforms.add(new r.FloatPassUniform("timeElapsed",J=>J.timeElapsed));C.code.add(y.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case h.ShaderOutput.Highlight:H.include(d.OutputHighlight,G);H.varyings.add("vpos","vec3");L.uniforms.add(z);L.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `);H.include(c.SliceDraw,G);C.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case h.ShaderOutput.ObjectAndLayerIdColor:H.include(m.ObjectAndLayerIdColor,G),H.varyings.add("vpos","vec3"),L.uniforms.add(z),L.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),H.include(c.SliceDraw,G),C.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return H}const F=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=F;a.build=B})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,
textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},
"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["exports",
"./defaultSymbolComplexity","./interfaces","./Loadable"],function(a,b,h,c){class k extends c.Loadable{constructor(m,d,f){super(d);this.symbol=m;this._convert=f;this.symbologySnappingSupported=!1;this.graphics3DSymbol=null;this.referenced=0}getSymbolLayerSize(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(m):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}async doLoad(m){m=await this.symbol.fetchSymbol({signal:m});m.id=this.symbol.id;this.graphics3DSymbol=this._convert(m);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(m,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:b.emptySymbolComplexity}globalPropertyChanged(m,d){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(m,
d):!1}applyRendererDiff(m,d){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(m,d):h.ApplyRendererDiffResult.RecreateSymbol}prepareSymbolPatch(m){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(m)}updateGeometry(m,d){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(m,d):!1}updateTransform(m,d,f,g){return this.graphics3DSymbol?.updateTransform(m,d,f,g)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}a.Graphics3DWebStyleSymbol=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./graphicSymbolUtils ./LabelParameters ../../webgl-engine/lib/TextRenderer ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(B){B=f.getGraphics3DSymbol(B.graphics3DGraphic.graphics3DSymbol);return null!=B?B.symbol.symbolLayers.at(0):null}function u(B,F){var G=F.graphics3DGraphic.graphic.geometry;if(null==G)return null;if(null!=F.disablePlacement)return F.labelClass.labelPlacement?(r().warnOncePerTick(x(B?.placement,F.disablePlacement.logEntityDescription)),w(F)):B;G=G.type;switch(G){case "polyline":case "polygon":case "extent":case "multipoint":if(F.labelClass.labelPlacement)return r().warnOncePerTick(x(B?.placement,
`'${G}' geometries`)),w(F)}return B}function x(B,F){return`the requested label placement '${B}' is currently unsupported for ${F} in SceneView.`}function w(B){const F=B.graphics3DGraphic.graphic.geometry;if(null==F)return null;switch(F.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};case "polygon":return B=l(B),null!=B&&"extrude"===B.type?D["above-center"]:{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};
case "point":return D["above-center"];case "mesh":return D["above-center"]}}function q(B,F=E){({graphics3DGraphic:B}=B);(B=B.layers[0]?.stageObject.geometries[0].material??null)&&B instanceof n.HUDMaterial?(B=B.parameters.anchorPosition,F[0]=2*(B[0]-.5),F[1]=2*(B[1]-.5)):(F[0]=0,F[1]=0);return F}function v(B,F,G){G=null!=G?G.getBoundingBoxObjectSpace(A):A;G=k.fromValues(G[3]-G[0],G[4]-G[1],G[5]-G[2]);B.centerOffset[0]=Math.sqrt(G[0]*G[0]+G[1]*G[1])/2*F.normalizedOffset[0];const H=B.translation[2],
L=G[2]/2*F.normalizedOffset[1];B.translation[2]=0;B.elevationOffset=H+L;G=c.length(G);B.centerOffset[2]=G/2*F.normalizedOffset[2]}function p(B){const F=B.labelClass.labelPlacement,{labelSymbol:G,graphics3DGraphic:H}=B;var L=f.getGraphics3DSymbol(H.graphics3DSymbol);L="point-3d"===L?.symbol.type?L.symbol:null;B=D[F]||w(B);if(null!=L&&L.supportsCallout()&&L.hasVisibleVerticalOffset()&&!H.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:t(L.verticalOffset),anchor:null,normalizedOffset:null};
if(G&&G.hasVisibleVerticalOffset()&&(null==L||!L.supportsCallout()||!L.verticalOffset||H.isDraped)){if(!(L=!B)){a:switch(B.placement){case "above-center":L=!0;break a;default:L=!1}L=!L}return L?(r().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+F+" placement)"),null):{placement:"above-center",verticalOffset:t(G.verticalOffset),anchor:"bottom",normalizedOffset:[0,B.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function t(B){const {screenLength:F,minWorldLength:G,maxWorldLength:H}=B;return{screenLength:F,minWorldLength:G,maxWorldLength:H}}const r=()=>h.getLogger("esri.views.3d.layers.graphics.labelPlacement");class y{constructor(B,F,G,H=null){this.graphics3DGraphic=B;this.labelSymbol=F;this.labelClass=G;this.disablePlacement=H}}const D={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",
normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",
normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],
"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const B in b){const F=D[B];b[B].forEach(G=>{D[G]=F})}Object.freeze&&(Object.freeze(D),Object.keys(D).forEach(B=>{Object.freeze(D[B]);Object.freeze(D[B]?.normalizedOffset)}));const E=[0,0],A=m.create();a.LabelInfo=y;a.getLabelPlacement=function(B){var F=p(B);if(null==F)return null;if(F.anchor)var G=F;else{G=B.labelClass.labelPlacement;var H=D[G],L=H||w(B);G&&!H&&r().warnOncePerTick(`the requested label placement '${G}' is currently unsupported in SceneView.`);
G=u(L,B)}if(null==G)return null;F=new g.LabelPlacement(F.verticalOffset,G.anchor,!!F.hasLabelVerticalOffset);H=B.graphics3DGraphic.graphic.geometry;if(null==H)B=null;else{switch(H.type){case "point":L=l(B);if(null!=L)switch(H=B.graphics3DGraphic.layers[0],null!=H?H.getCenterObjectSpace(F.translation):c.set(F.translation,0,0,0),L.type){case "icon":case "text":({graphics3DGraphic:L}=B);H=null!=H?H.getScreenSize():null;L.isDraped||null==H?F.hasLabelVerticalOffset||"center"===F.anchor||(D[B.labelClass.labelPlacement]&&
r().warnOncePerTick(`the requested placement '${G.placement}' is currently unsupported for draped graphics`),F.anchor="center"):(B=q(B),F.screenOffset[0]=H[0]/2*(G.normalizedOffset[0]-B[0]),B=H[1]/2*(G.normalizedOffset[1]-B[1]),F.hasLabelVerticalOffset?(F.centerOffset[1]=B,F.centerOffsetUnits="screen"):F.screenOffset[1]=B);break;case "object":v(F,G,H)}break;case "polygon":H=l(B);if(null!=H)switch(H.type){case "extrude":B=B.graphics3DGraphic.layers[0],null!=B?(B.getBoundingBoxObjectSpace(A),m.center(A,
F.translation),F.translation[2]=m.height(A)/2):c.set(F.translation,0,0,0),v(F,G,B)}break;case "mesh":v(F,G,B.graphics3DGraphic.layers[0])}B=d.labelMarginPx-e.textVerticalPaddingPx;F.screenOffset[0]+=B*G.normalizedOffset[0];F.screenOffset[1]+=B*G.normalizedOffset[1];B=F}return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){class b{constructor(h){this._stage=h;this._materials=new Map}get(h){return this._materials.get(h)}add(h,
c){this._materials.set(h,c);this._stage.add(c)}dispose(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()}}a.MaterialCollection=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){a.FeatureTileTree3D=class extends h{get tilingScheme(){const y=this.tilingSchemeOwner.tilingScheme;return y?y.clone():null}set filterExtent(y){if(null==y||y.spatialReference.equals(this.viewState.spatialReference)){var D=this._get("filterExtent");D===y||null!=D&&y&&D.equals(y)||(y=null!=y?y.clone():null,this._set("filterExtent",y),this._setDirty())}else m.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}get _filterExtentRect(){if(null==
this.filterExtent)return null;const y=w.create();p.toBoundingRect(this.filterExtent,y,this.tilingScheme.spatialReference);return y}get _rootTileIds(){const {tilingScheme:y}=this;return this._filterExtentRect&&y?y.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(y){y!==this._get("suspended")&&(this._set("suspended",y),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(y){super(y);this.tiles=new c;this.tileSize=512;this._idToTile=new Map;this._clients=
new Set;this._dirty=!1;this._pendingTiles=null;this._newTiles=new f}initialize(){this.addHandles([g.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),g.sync),g.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),g.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(t.TaskPriority.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=d.removeMaybe(this._frameWorker)}addClient(){const y=
e.generateUID();this._clients.add(y);1===this._clients.size&&this._setDirty();return k.makeHandle(()=>this._removeClient(y))}_removeClient(y){this._clients.delete(y);this._hasClients||this._clear()}get _hasClients(){return 0<this._clients.size}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(t.noBudget))}_clear(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")}get running(){return this.updating}runTask(y){this._dirty=
!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=t.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(y);this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=t.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new v.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,
tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()}_getRootTiles(){const {tilingScheme:y}=this;return this._rootTileIds.map(D=>new q.FeatureTileDescriptor3D(D[0],D[1],D[2],y))}_purgeHorizonTiles(y){y.sort((D,E)=>{D=D.measures.screenRect;E=E.measures.screenRect;
return D[1]+D[3]-(E[1]+E[3])});if(!(50<y.length))return y.toArray();w.empty(r);for(let D=0;D<y.length;D++)if(w.expand(r,y.data[D].measures.screenRect,r),10<w.height(r))return y.data.slice(D,y.length);return[]}_subdivideTilesForView(y){if(this._pendingTiles){for(var {tilingScheme:D}=this;0<this._pendingTiles.length&&!y.done;){const E=this._pendingTiles.pop();y.madeProgress();if(!this._filterExtentRect||w.intersects(this._filterExtentRect,E.extent))this._tileMeasurements.updateTile(E),E.measures.visibility!==
q.Visibility.INVISIBLE&&(E.measures.shouldSplit?(D.ensureMaxLod(E.lij[0]+1),this._pendingTiles.push(...E.getChildren())):this._newTiles.push(E))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(y){for(var D of this.tiles.items)D.used=!1;y=y.filter(E=>{const A=this._idToTile.get(E.id);A?(A.copyMeasurementsFrom(E),A.used=!0):this._idToTile.set(E.id,E);return!A});D=this.tiles.items.filter(E=>
E.used?!1:(this._idToTile.delete(E.id),!0));this.tiles.removeMany(D);this.tiles.addMany(y);this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((y,D)=>y.measures.visibility!==D.measures.visibility?y.measures.visibility===q.Visibility.VISIBLE_ON_SURFACE?-1:1:y.measures.distance-D.measures.distance);this.tiles.forEach((y,D)=>y.loadPriority=D)}};b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([n.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([n.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"terrain",void 0);b.__decorate([n.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([n.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([n.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([n.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([n.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);b.__decorate([n.property({readOnly:!0})],a.FeatureTileTree3D.prototype,
"_rootTileIds",null);b.__decorate([n.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([n.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);const r=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],
function(a,b){class h{constructor(c,k,m,d=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;d&&this.acquire(c,k,m,d)}acquire(c,k,m,d){this.tilingScheme=d;this.id=h.id(c,k,m);this.lij[0]=c;this.lij[1]=k;this.lij[2]=m;d.getExtent(c,k,m,this.extent);this.resolution=d.resolutionAtLevel(c)}release(){this.tilingScheme=null}getChildren(c){const k=this.lij[0]+
1,m=2*this.lij[1],d=2*this.lij[2];if(!c)return[new h(k,m,d,this.tilingScheme),new h(k,m+1,d,this.tilingScheme),new h(k,m,d+1,this.tilingScheme),new h(k,m+1,d+1,this.tilingScheme)];c[0].acquire(k,m,d,this.tilingScheme);c[1].acquire(k,m+1,d,this.tilingScheme);c[2].acquire(k,m,d+1,this.tilingScheme);c[3].acquire(k,m+1,d+1,this.tilingScheme);return c}copyMeasurementsFrom(c){this.measures.visibility=c.measures.visibility;this.measures.shouldSplit=c.measures.shouldSplit;this.measures.distance=c.measures.distance;
b.copy(c.measures.screenRect,this.measures.screenRect)}static id(c,k,m){return`${c}/${k}/${m}`}}a.Visibility=void 0;(function(c){c[c.INVISIBLE=0]="INVISIBLE";c[c.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";c[c.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ../../../ViewingMode ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(E,A,B,F){const G=d.signedDistance(F,A);F=d.signedDistance(F,B);const H=Math.abs(F-G);h.scale(E,A,Math.abs(F)/H);h.scaleAndAdd(E,E,B,Math.abs(G)/H)}class x{constructor(E){this._camera=new l.Camera;this._focusOnMap=[0,0];this._screenRect=k.create();this._tileSize=E.tileSize;this._renderCoordsHelper=E.renderCoordsHelper;this._tilingScheme=E.tilingScheme;this._visibility=new n.FeatureTileVisibility3D(E.renderCoordsHelper)}begin(E,A,B){this._camera.copyFrom(E);
this._surfaceElevation=B;this._focusOnMap[0]=A.x;this._focusOnMap[1]=A.y;k.fromValues(0,0,E.fullWidth,E.fullHeight,this._screenRect);this._visibility.begin(this._camera,B)}end(){this._visibility.end()}updateTile(E){E.measures.visibility=this._visibility.calculate(E);E.measures.distance=k.distance(E.extent,this._focusOnMap);E.measures.visibility!==e.Visibility.INVISIBLE&&this._updateScreenMeasure(E)}_updateScreenMeasure(E){const A=E.measures.screenRect;k.empty(A);let B=0;var F=E.lij,G=F[0];const H=
G+2,L=F[1]<<2,C=F[2]<<2;var z=this._tileSizeWithBias(E);z*=z;var J=this._camera;const {frustum:K,viewport:I}=J;if(this._renderCoordsHelper.viewingMode===g.ViewingMode.Local||G>n.globalTileLevelThreshold){G=q;this._tilingScheme.getExtent(F[0],F[1],F[2],G);const M=w,S=y;F=k.empty();for(let N=0;4>N;++N)this._toRenderCoords(G,D[N][0],D[N][1],S[N]),J.projectToScreen(S[N],M[N]),k.expandPointInPlace(F,M[N]);J=n.isConvexHullOutsideOfFrustum(K,S,4);G=F[0]>I[2]||F[1]>I[3]||F[2]<I[0]||F[3]<I[1];if(J||G){E.measures.shouldSplit=
!1;return}}for(J=0;4>J;J++)for(G=0;4>G;G++)if(B+=this._computeScreenArea(H,L+J,C+G,A),B>z){E.measures.shouldSplit=!0;return}E.measures.shouldSplit=!1}_tileSizeWithBias(E){return E.measures.visibility===e.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize}_computeScreenArea(E,A,B,F){this._tilingScheme.ensureMaxLod(E);const G=q;this._tilingScheme.getExtent(E,A,B,G);E=p;this._toRenderCoords(G,0,3,E[0]);this._toRenderCoords(G,2,3,E[1]);this._toRenderCoords(G,2,1,E[2]);this._toRenderCoords(G,
0,1,E[3]);return this._computeTriangleScreenArea([E[0],E[1],E[2]],F)+this._computeTriangleScreenArea([E[2],E[1],E[3]],F)}_computeTriangleScreenArea(E,A){const B=this._camera.frustum[m.PlaneIndex.NEAR];var F=0,G=-1,H=-1;for(var L=0;3>L;++L)0<d.signedDistance(B,E[L])?(F++,-1===G&&(G=L)):-1===H&&(H=L);return 0===F?this._computeTriangleScreenAreaInside(E,A):1===F?(H=r,F=(G+1)%3,L=(G+2)%3,h.copy(H[0],E[F]),h.copy(H[1],E[L]),u(H[2],E[L],E[G],B),L=this._computeTriangleScreenAreaInside(H,A),u(H[1],E[F],E[G],
B),E=this._computeTriangleScreenAreaInside(H,A),L+E):2===F?(G=r,F=H,h.copy(G[0],E[F]),L=(H+2)%3,u(G[1],E[F],E[(H+1)%3],B),u(G[2],E[F],E[L],B),this._computeTriangleScreenAreaInside(G,A)):0}_computeTriangleScreenAreaInside(E,A){for(let B=0;3>B;B++)this._camera.projectToRenderScreen(E[B],t),this._camera.renderToScreen(t,w[B]),k.expand(A,w[B],A);return f.areaPoints2d(w[0],w[1],w[2])}_toRenderCoords(E,A,B,F){v[0]=E[A];v[1]=E[B];v[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(v,this._tilingScheme.spatialReference,
F);return F}}const w=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],q=k.create(),v=c.create(),p=[c.create(),c.create(),c.create(),c.create()],t=b.createRenderScreenPointArray3(),r=[c.create(),c.create(),c.create()],y=[c.create(),c.create(),c.create(),c.create()],D=[[0,3],[2,3],[2,1],[0,1]];a.FeatureTileMeasurements3D=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVec3Array ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(la,qa,ua){c.cross(la,qa,ua);c.normalize(la,la);return la}function v(la,qa,ua){c.sub(la,qa,ua);c.normalize(la,la);return la}function p(la,qa){c.scale(la,la,qa/c.len(la));return la}function t(la,qa,ua){for(const Na of G){a:{var va=la[Na];var Ga=qa,La=ua;for(let Wa=0;Wa<La;++Wa)if(0>e.signedDistance(va,Ga[Wa])){va=!1;break a}va=!0}if(va)return!0}return!1}function r(la,qa){for(const ua of qa)if(1E-5>c.dot(ua,la))return!1;return!0}function y(la,qa,ua,
va){var Ga=ja;q(Ga,la,qa);la=Ba;qa=Infinity;let La=-Infinity;for(var Na of ua)ua=c.dot(Ga,Na),qa=Math.min(qa,ua),La=Math.max(La,ua);la[0]=qa;la[1]=La;a:{Na=la[0];ua=la[1];la=Infinity;qa=-Infinity;for(const Wa of va)if(va=c.dot(Ga,Wa),la=Math.min(la,va),qa=Math.max(qa,va),la<=ua&&qa>=Na){Ga=!1;break a}Ga=!0}return Ga}class D{constructor(la){this._renderCoordsHelper=la;this._surfaceElevation=0;this._cache=new Map;this._frustumBoundingSphereCenter=k.create();this._frustumBoundingSphereRadius=0;this._frustum=
new x.Frustum(la);this._extendedFrustum=new x.Frustum(la);this._intersector=new w.FrustumExtentIntersection({renderCoordsHelper:la});this._renderCoordsHelper=la}begin(la,qa){this._surfaceElevation=qa;this._aboveGround=this._renderCoordsHelper.getAltitude(la.eye)>qa;this._frustum.update(la);this._shortenFrustumFarPlane(this._frustum);this._updateExtendedFrustum(la);this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(la){const qa=this._renderCoordsHelper.viewingMode===l.ViewingMode.Global&&
2<=la.lij[0]&&6>la.lij[0],ua=this._getOrCalculateSingleTileVisibility(la,!qa);return ua!==u.Visibility.INVISIBLE&&qa?this._calculateAggregatedChildrenVisibility(la):ua}_shortenFrustumFarPlane(la){var qa=x.Frustum.nearFarLineIndices;const ua=la.mutablePoints;for(const va of qa){const [Ga,La]=va;qa=ua[Ga];c.subtract(E,ua[La],qa);c.scale(E,E,.95);c.add(ua[La],qa,E)}la.updatePoints(ua)}_calculateAggregatedChildrenVisibility(la){let qa=u.Visibility.INVISIBLE;var ua=this._cache.get(la.id);if(null!=ua)return ua;
ua=F.acquire();la.getChildren(ua);for(const va of ua){const Ga=this.calculate(va);if(Ga!==u.Visibility.INVISIBLE&&(qa=Ga,Ga===u.Visibility.VISIBLE_ON_SURFACE))break}F.release(ua);this._cache.set(la.id,qa);return qa}_getOrCalculateSingleTileVisibility(la,qa){var ua=this._cache.get(la.id);if(null!=ua)return ua;ua=this._calculateSingleTileVisibility(la);qa&&this._cache.set(la.id,ua);return ua}_calculateSingleTileVisibility(la){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===l.ViewingMode.Global&&
12>la.lij[0]){if(this._calculateSingleTileVisibilitySided(la,!1)===u.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(la,!0)}else return this._calculateSingleTileVisibilitySided(la,this._aboveGround)}_isTileVisibleInFrustum(la){return this._renderCoordsHelper.viewingMode===l.ViewingMode.Local?this._isTileVisibleInFrustumLocal(la):this._isTileVisibleInFrustumGlobal(la)}_updateFrustumBoundingSphere(){var la=this._frustum;const qa=la.origin,ua=T;c.normalize(ua,la.direction);var va=
ia;c.sub(va,la.points[4],qa);la=c.dot(va,va);va=c.dot(ua,va);va=.5*la/va;c.scaleAndAdd(this._frustumBoundingSphereCenter,qa,ua,va);this._frustumBoundingSphereRadius=1+va}_isTileVisibleInFrustumLocal(la){var qa=la.tilingScheme.spatialReference,ua=la.extent,va=this._renderCoordsHelper.spatialReference;la=L;la[0]=ua[0];la[1]=ua[1];la[2]=0;la[3]=ua[2];la[4]=ua[3];la[5]=0;if(!d.projectBuffer(la,qa,0,la,va,0,2))return!1;qa=C;c.set(qa[0],la[0],la[1],0);c.set(qa[1],la[3],la[1],0);c.set(qa[2],la[3],la[4],
0);c.set(qa[3],la[0],la[4],0);var Ga=z;c.set(Ga,.5*(la[0]+la[3]),.5*(la[1]+la[4]),.5*(la[2]+la[5]));la=J;c.set(la,0,0,1);var La=.5*c.dist(qa[0],qa[2]);ua=this._frustum;va=this._frustumBoundingSphereRadius;const Na=this._frustumBoundingSphereCenter;var Wa=U;c.sub(Wa,Na,Ga);Wa=c.dot(la,Wa);const Ia=O;c.scaleAndAdd(Ia,Ga,la,Wa);if(c.dist(Ia,Na)>La+va)return!1;Ga=H;La=Wa+va;va=Wa-va;for(Wa=0;4>Wa;++Wa)c.scaleAndAdd(Ga[Wa],qa[Wa],la,La),c.scaleAndAdd(Ga[Wa+4],qa[Wa],la,va);return!t(ua.planes,Ga,8)}_isTileVisibleInFrustumGlobal(la){var qa=
la.tilingScheme.spatialReference,ua=la.extent,va=this._renderCoordsHelper.spatialReference;if(3>la.lij[0])return!0;const Ga=C;var La=.5*(ua[0]+ua[2]),Na=0<Ga[0][2],Wa=0>Ga[3][2],Ia=Na||Wa,Oa=ua[Na?1:3];c.set(Ga[0],ua[0],ua[1],0);c.set(Ga[1],ua[2],ua[1],0);c.set(Ga[2],ua[2],ua[3],0);c.set(Ga[3],ua[0],ua[3],0);c.set(Ga[4],La,Oa,0);if(!f.projectVec3Array(Ga,qa,0,Ga,va,0,Ia?5:4))return!1;ua=m.getReferenceEllipsoid(va).radius;Ia&&(La=k.fromValues(0,0,1),va=I,q(va,La,Ga[0]),Ia=M,q(Ia,La,Ga[1]),Na?(Na=K,
Wa=Ga[4],Oa=S,q(Oa,Wa,La),q(Na,Oa,Wa),La=Ga[0],c.cross(La,va,Na),p(La,ua),va=Ga[1],c.cross(va,Ia,Na),p(va,ua)):Wa&&(Na=K,Wa=Ga[4],Oa=S,q(Oa,Wa,La),q(Na,Wa,Oa),La=Ga[3],c.cross(La,Na,va),p(La,ua),va=Ga[2],c.cross(va,Na,Ia),p(va,ua)));La=z;Ia=da;c.sub(Ia,Ga[3],Ga[0]);c.normalize(Ia,Ia);va=ha;c.add(va,Ga[0],Ga[3]);c.scale(va,va,.5);Wa=-c.dot(va,Ia);va=fa;Oa=aa;c.add(va,Ga[0],Ga[1]);c.scale(va,va,.5);c.add(Oa,Ga[2],Ga[3]);c.scale(Oa,Oa,.5);Na=Z;c.sub(Na,Oa,va);c.normalize(Na,Na);Ia=-(Wa+c.dot(Ia,va))/
c.dot(Ia,Na);c.scaleAndAdd(La,va,Na,Ia);p(La,ua);c.scale(J,La,1/ua);Na=P;va=this._frustumBoundingSphereRadius;Oa=this._frustumBoundingSphereCenter;const Ua=this._frustum;Ia=Ua.planes;if(Ga.some(gb=>Ua.intersectsPoint(gb))||Ua.intersectsPoint(La))return!0;var Va=N;c.normalize(Va,La);La=R;c.sub(La,Oa,Na);Wa=c.dot(La,Va);if(Wa<-va)return!1;La=Q;c.normalize(La,Ga[0]);La=c.dot(La,Va);if(0>=La)return!0;var Ra=V;c.scale(Ra,Va,Wa);Oa=c.dist(Ra,Oa);qa=qa.isWGS84;Va=la.lij;la=qa&&Va[2]===2**Va[0]-1;Ra=(qa=
qa&&0===Va[2])?Ca:la?ta:oa;la=qa?pa:la?ya:ra;qa=Ua.points;Va=wa;for(var bb of Ra){Ra=ea;const gb=ca,db=Ga[bb],ka=Na;v(Ra,Ga[(bb+1)%4],db);v(gb,ka,db);q(Va,gb,Ra);if(r(Va,qa))return!1}bb=null;if(Wa<2*va){bb=2.5*va;if(Oa>La*bb+va)return!1;va=X;bb/=La;for(La=0;4>La;++La)c.scale(va[La],Ga[La],bb/ua);c.set(va[4],0,0,0);bb=va}else{bb=(Wa+va)/La;va=(Wa-va)/La;La=ba;for(Na=0;4>Na;++Na)Wa=Ga[Na],c.scale(La[Na+4],Wa,va/ua),c.scale(La[Na],Wa,bb/ua);bb=La}if(t(Ia,bb,bb.length))return!1;ua=Ua.lines;Ia=W;va=Y;
for(const gb of la){c.normalize(Ia,Ga[gb]);for(const db of ua)if(c.normalize(va,db.direction),y(va,Ia,bb,qa))return!1}return!0}_calculateSingleTileVisibilitySided(la,qa){return this._isTileVisibleInFrustum(la)?(this._intersector.update(la.extent,la.tilingScheme.spatialReference,this._surfaceElevation,qa),la=m.getReferenceEllipsoid(la.tilingScheme.spatialReference).radius,this._intersector.isVisibleInFrustum(this._frustum,la,!0)?u.Visibility.VISIBLE_ON_SURFACE:u.Visibility.VISIBLE_WHEN_EXTENDED):u.Visibility.INVISIBLE}_updateExtendedFrustum(la){this._extendedFrustum.update(la);
this._shortenFrustumFarPlane(this._extendedFrustum);var qa=this._renderCoordsHelper.worldUpAtPosition(la.eye,E);this._aboveGround||c.negate(qa,qa);if(this._hasExtendedFrustum=b.acosClamped(-c.dot(qa,la.viewForward))>la.fovY/2){la=this._extendedFrustumParameters();qa=this._extendedFrustum.mutablePoints;for(let ua=0;4>ua;ua++){const va=la.pointIndices[ua],Ga=qa[va],La=this._renderCoordsHelper.getAltitude(Ga);if(la.needsAltitudeAdjustment(La)){this._renderCoordsHelper.worldUpAtPosition(Ga,E);switch(va){case g.PointIndex.FAR_BOTTOM_LEFT:case g.PointIndex.FAR_TOP_LEFT:case g.PointIndex.NEAR_BOTTOM_LEFT:case g.PointIndex.NEAR_TOP_LEFT:e.projectVector(this._extendedFrustum.planes[g.PlaneIndex.LEFT],
E,E);break;case g.PointIndex.FAR_BOTTOM_RIGHT:case g.PointIndex.FAR_TOP_RIGHT:case g.PointIndex.NEAR_BOTTOM_RIGHT:case g.PointIndex.NEAR_TOP_RIGHT:e.projectVector(this._extendedFrustum.planes[g.PlaneIndex.RIGHT],E,E)}c.scale(E,E,la.direction);this._renderCoordsHelper.intersectInfiniteManifold(n.wrap(Ga,E),la.zWithMargin,Ga)}}this._extendedFrustum.updatePoints(qa);e.fromPoints(qa[g.PointIndex.NEAR_BOTTOM_LEFT],qa[g.PointIndex.NEAR_BOTTOM_RIGHT],qa[g.PointIndex.NEAR_TOP_RIGHT],A);e.fromPoints(qa[g.PointIndex.NEAR_BOTTOM_RIGHT],
qa[g.PointIndex.NEAR_TOP_RIGHT],qa[g.PointIndex.NEAR_TOP_LEFT],B);0>c.dot(e.getNormal(A),e.getNormal(B))&&(la=this._extendedFrustum.mutablePoints,this._aboveGround?[la[g.PointIndex.NEAR_BOTTOM_LEFT],la[g.PointIndex.NEAR_BOTTOM_RIGHT]]=[la[g.PointIndex.NEAR_BOTTOM_RIGHT],la[g.PointIndex.NEAR_BOTTOM_LEFT]]:[la[g.PointIndex.NEAR_TOP_LEFT],la[g.PointIndex.NEAR_TOP_RIGHT]]=[la[g.PointIndex.NEAR_TOP_RIGHT],la[g.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(la))}}_extendedFrustumParameters(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const la=this._surfaceElevation-1;return{zWithMargin:la,pointIndices:x.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(qa){return qa>la}}}_extendedFrustumParametersBelowSurface(){const la=this._surfaceElevation+1;return{zWithMargin:la,pointIndices:x.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(qa){return qa<la}}}}const E=k.create(),
A=e.create(),B=e.create(),F=new h(Array,la=>{4!==la.length&&(la[0]=new u.FeatureTileDescriptor3D,la[1]=new u.FeatureTileDescriptor3D,la[2]=new u.FeatureTileDescriptor3D,la[3]=new u.FeatureTileDescriptor3D)},la=>{la[0].release();la[1].release();la[2].release();la[3].release()}),G=[g.PlaneIndex.LEFT,g.PlaneIndex.RIGHT,g.PlaneIndex.BOTTOM,g.PlaneIndex.TOP,g.PlaneIndex.FAR],H=[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()],L=[0,0,0,0,0,0],C=[k.create(),k.create(),
k.create(),k.create(),k.create()],z=k.create(),J=k.create(),K=k.create(),I=k.create(),M=k.create(),S=k.create(),N=k.create(),V=k.create(),Q=k.create(),T=k.create(),ia=k.create(),O=k.create(),U=k.create(),P=k.fromValues(0,0,0),R=k.create(),ba=[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()],X=[k.create(),k.create(),k.create(),k.create(),k.create()],da=k.create(),ha=k.create(),fa=k.create(),aa=k.create(),Z=k.create(),ea=k.create(),ca=k.create(),W=k.create(),
Y=k.create(),ja=k.create(),oa=[0,1,2,3],ra=[0,1,2,3],ta=[0,1,3],ya=[0,1,3],Ca=[1,2,3],pa=[1,2,3],wa=k.create(),Ba=[0,0];a.FeatureTileVisibility3D=D;a.globalTileLevelThreshold=3;a.isConvexHullOutsideOfFrustum=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVec3Array":function(){define(["exports","../../chunks/vec32","./projectors"],function(a,b,h){a.projectVec3Array=function(c,k,m,d,f,g,e=1){k=h.getProjector(k,f,h.projectorCache);if(null==k)return!1;
if(k===h.copy3){if(c===d&&m===g)return!0;e=m+e;for(let n=m,l=g;n<e;++n,++l)b.copy(d[l],c[n]);return!0}e=m+e;for(let n=m,l=g;n<e;++n,++l)k(c[n],0,d[l],0);return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){const r=.5*Math.PI,y=r/Math.PI*180;class D{constructor(C){this._renderCoordsHelper=C.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:d.create(),direction:d.create()};for(C=0;4>C;C++)this._extent[C]={origin:d.create(),direction:d.create(),cap:{next:null,direction:d.create()}},this._planes[C]=q.create();this._planes[x.PlaneIndex.NEAR]=q.create();this._planes[x.PlaneIndex.FAR]=q.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(C,z,J,K=!0){const I=this._extent;this._toRenderBoundingExtent(C,z,J);m.add(this._center.origin,I[0].origin,I[2].origin);m.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);K||m.scale(this._center.direction,this._center.direction,-1);for(J=0;4>J;J++){const M=I[J];this._renderCoordsHelper.worldUpAtPosition(M.origin,M.direction);const S=I[3===J?0:J+1];M.cap.next=S.origin;m.direction(M.cap.direction,
M.origin,S.origin);q.fromVectorsAndPoint(M.direction,M.cap.direction,M.origin,this._planes[J]);K||m.scale(M.direction,M.direction,-1)}q.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this._planes[x.PlaneIndex.NEAR]);K?q.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.FAR]):(q.copy(this._planes[x.PlaneIndex.FAR],this._planes[x.PlaneIndex.NEAR]),q.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(C[0]-C[2]),
Math.abs(C[1]-C[3]));this._maxSpanSpatialReference=z;this._minGlobalAltitude=.9*f.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(C,z,J=!1){if(null==C)return!1;if(this._renderCoordsHelper.viewingMode===p.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:r*z))return!0;if(null!=C.altitude&&C.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(C)}if(0===this._maxSpan)return z=this._extent[0],!J&&C.intersectsRay(v.wrap(z.origin,
z.direction))?!0:!1;for(z=0;z<this._extent.length;z++){var K=this._extent[z];if(!J&&C.intersectsRay(v.wrap(K.origin,K.direction))||C.intersectsLineSegment(w.fromPoints(K.origin,K.cap.next,L),K.cap.direction))return!0}J=J?this._planes:this._planesWithoutFar;for(z=0;z<C.lines.length;z++)if(K=C.lines[z],t.frustumLineSegment(J,K.origin,K.endpoint,K.direction))return!0;return!1}_toRenderBoundingExtentGlobal(C,z,J){u.center(C,A);A[2]=J;g.computeTranslationToOriginAndRotation(z,A,B,this._renderCoordsHelper.spatialReference);
c.invert(F,B);l.empty(G);for(const {x0:K,x1:I,y0:M,y1:S}of E)for(let N=0;5>N;N++){const V=N/4;A[0]=h.lerp(C[K],C[I],V);A[1]=h.lerp(C[M],C[S],V);A[2]=J;n.projectVectorToVector(A,z,A,this._renderCoordsHelper.spatialReference);m.transformMat4(A,A,F);l.expandWithVec3(G,A)}m.set(this._extent[0].origin,G[0],G[1],G[2]);m.set(this._extent[1].origin,G[3],G[1],G[2]);m.set(this._extent[2].origin,G[3],G[4],G[2]);m.set(this._extent[3].origin,G[0],G[4],G[2]);for(C=0;4>C;++C)m.transformMat4(this._extent[C].origin,
this._extent[C].origin,B)}_toRenderBoundingExtentLocal(C,z,J){e.projectBoundingRect(C,z,H,this._renderCoordsHelper.spatialReference);m.set(this._extent[0].origin,H[0],H[1],J);m.set(this._extent[1].origin,H[2],H[1],J);m.set(this._extent[2].origin,H[2],H[3],J);m.set(this._extent[3].origin,H[0],H[3],J)}_toRenderBoundingExtent(C,z,J){switch(this._renderCoordsHelper.viewingMode){case p.ViewingMode.Global:this._toRenderBoundingExtentGlobal(C,z,J);break;case p.ViewingMode.Local:this._toRenderBoundingExtentLocal(C,
z,J);break;default:b.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(C){if(0>q.signedDistance(C.planes[x.PlaneIndex.NEAR],this._center.origin)&&0>m.dot(this._center.direction,C.direction))return!0;for(let z=0;4>z;z++){const J=this._extent[z];if(0>q.signedDistance(C.planes[x.PlaneIndex.NEAR],J.origin)&&0>m.dot(J.direction,C.direction))return!0}return!1}}const E=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],A=d.create(),B=k.create(),
F=k.create(),G=l.create(),H=u.create(),L=w.create();a.FrustumExtentIntersection=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/projection/projectBuffer"],function(a,b,h){const c=b.create();a.projectToBoundingBox=function(k,m,d){if(null==k||null==d)return!1;let f;c[0]=null!=k.xmin?k.xmin:0;c[1]=null!=k.ymin?k.ymin:0;c[2]=null!=k.zmin?k.zmin:0;f=h.projectBuffer(c,
k.spatialReference,0,m,d,0,1);c[0]=null!=k.xmax?k.xmax:0;c[1]=null!=k.ymax?k.ymax:0;c[2]=null!=k.zmax?k.zmax:0;f=f&&h.projectBuffer(c,k.spatialReference,0,m,d,3,1);null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.zmin&&(m[2]=-Infinity);null==k.xmax&&(m[3]=Infinity);null==k.ymax&&(m[4]=Infinity);null==k.zmax&&(m[5]=Infinity);return f};a.toBoundingRect=function(k,m,d){if(null==k||null==d)return!1;let f;c[0]=null!=k.xmin?k.xmin:0;c[1]=null!=k.ymin?k.ymin:0;c[2]=null!=k.zmin?k.zmin:
0;f=h.projectBuffer(c,k.spatialReference,0,c,d,0,1);m[0]=c[0];m[1]=c[1];c[0]=null!=k.xmax?k.xmax:0;c[1]=null!=k.ymax?k.ymax:0;c[2]=null!=k.zmax?k.zmax:0;f=f&&h.projectBuffer(c,k.spatialReference,0,c,d,0,1);m[2]=c[0];m[3]=c[1];null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.xmax&&(m[2]=Infinity);null==k.ymax&&(m[3]=Infinity);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){b=class extends b{constructor(){super(...arguments);this._propertiesPool=new p.PropertiesPool({camera:t.Camera},this);this._lastSeenCameraProjectionValues=new t.Camera;this.mode=r.RenderState.ANIMATING;this._cssCamera=new t.Camera;this._camera=new t.Camera;this.contentPixelRatio=this.rasterPixelRatio=1;this.events=new h;this.viewingMode=x.ViewingMode.Global;this._cameraChanged=!1;this._updateQueue=[];this._processingUpdates=!1}init(D,E){this._set("viewingMode",
D);this._set("spatialReference",E);this._set("constraints",new w.Constraints({mode:this.viewingMode}))}exit(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new p.PropertiesPool({camera:t.Camera},this)}destroy(){this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===x.ViewingMode.Global){const D=l.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new t.Camera({eye:n.fromValues(4*
D,0,0),center:n.fromValues(D,0,0),up:n.fromValues(0,0,1)})}else this.camera=new t.Camera({eye:n.fromValues(0,0,100),center:n.fromValues(0,0,0),up:n.fromValues(0,1,0)})}get animation(){return this.cameraController instanceof q.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const D=this._cssCamera.copyFrom(this.camera),{height:E,width:A,pixelRatio:B}=this.camera;D.pixelRatio=1;D.height=Math.round(E/B);D.width=Math.round(A/B);return D}get camera(){return this._camera}set camera(D){D!==
y&&y.copyFrom(D);y.computeUp(this.viewingMode);this.events.emit("before-camera-change",y);D=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,y)&&(this._lastSeenCameraProjectionValues.copyFrom(y),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!D.equals(y)&&(this._camera=this._propertiesPool.get("camera").copyFrom(y),this._cameraChanged=!D.almostEquals(y))){const E=e.afterDispatch(()=>{this._cameraChanged=!1;E.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===
this.rasterPixelRatio&&this.mode===r.RenderState.IDLE}get updating(){return this.mode!==r.RenderState.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(D){this._contentCamera=null!=D?D.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===x.ViewingMode.Global}get isLocal(){return this.viewingMode===x.ViewingMode.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&
!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(D){this.stopActiveCameraController()?(this.cameraController?.destroy(),D&&(this.removeHandles("ViewStateHandles"),this.addHandles(c.when(()=>D.state===v.State.Finished||D.state===v.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(E=>D.onControllerEnd(E))},{sync:!0,once:!0}),"ViewStateHandles"),D.onControllerStart(this.camera)),this._set("cameraController",D)):D&&(D.state=v.State.Rejected)}switchCameraController(D){this.cameraController=
D;return D.state!==v.State.Rejected}stopActiveCameraController(){return this.cameraController&&!this.cameraController.stopController()?!1:!0}updateCamera(D){this._updateQueue.push(D);this._processUpdateQueue()}_processUpdateQueue(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var D=this._updateQueue.shift();y.copyFrom(this._get("camera"));D(y);this.camera=y;this._processingUpdates=!1;this._processUpdateQueue()}}_cameraProjectionChanged(D,E){return D.fov!==
E.fov||D.fullViewport[0]!==E.fullViewport[0]||D.fullViewport[1]!==E.fullViewport[1]||D.fullViewport[2]!==E.fullViewport[2]||D.fullViewport[3]!==E.fullViewport[3]||D.padding[t.PaddingSide.TOP]!==E.padding[t.PaddingSide.TOP]||D.padding[t.PaddingSide.RIGHT]!==E.padding[t.PaddingSide.RIGHT]||D.padding[t.PaddingSide.BOTTOM]!==E.padding[t.PaddingSide.BOTTOM]||D.padding[t.PaddingSide.LEFT]!==E.padding[t.PaddingSide.LEFT]?!0:!1}};a.__decorate([k.property()],b.prototype,"mode",void 0);a.__decorate([k.property({readOnly:!0,
type:u})],b.prototype,"animation",null);a.__decorate([k.property({type:t.Camera})],b.prototype,"cssCamera",null);a.__decorate([k.property()],b.prototype,"_cssCamera",void 0);a.__decorate([k.property({type:t.Camera})],b.prototype,"camera",null);a.__decorate([k.property()],b.prototype,"_camera",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"pixelRatio",null);a.__decorate([k.property()],b.prototype,"rasterPixelRatio",void 0);a.__decorate([k.property()],b.prototype,"contentPixelRatio",
void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"alignPixelEnabled",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({})],b.prototype,"_contentCamera",void 0);a.__decorate([k.property({type:t.Camera})],b.prototype,"contentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"constraints",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,
"events",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"isGlobal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"isLocal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"viewingMode",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"spatialReference",void 0);a.__decorate([k.property()],b.prototype,"navigating",null);a.__decorate([k.property()],b.prototype,"stationary",null);a.__decorate([k.property()],b.prototype,"_cameraChanged",void 0);a.__decorate([k.property()],
b.prototype,"cameraController",null);a=b=a.__decorate([g.subclass("esri.views.3d.state.ViewState")],b);const y=new t.Camera;return a})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/hitTest ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(E){t&&t.viewingMode===E||(t=l.newIntersector(E));return t}class q{constructor(E,A,B){this.viewingMode=E;this._forEachLayer=A;this._view=B;this._externalIntersectionHandlers=new b;this._tolerance=l.defaultTolerance;this._tmpRay=d.create();this._tmpRegion=m.create();this._validateHUDIntersector=l.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}intersectScreen(E,A,B){return this.intersectRay(this._getPickRay(E,this._tmpRay),
w(this.viewingMode),A,B)}intersectScreenFreePointFallback(E,A,B){return this.intersectRayFreePointFallback(this._getPickRay(E,this._tmpRay),A,B)}intersectRayFreePointFallback(E,A,B){return this.intersectRay(E,w(this.viewingMode),A,B)||this._intersectRayFreePointLocal(E,A)}intersectRay(E,A,B,F){A.options.selectionMode=!1;A.options.store=u.StoreResults.MIN;this.computeIntersection(E,A,F);return A.results.min?A.results.min.getIntersectionPoint(B):!1}getCenterRayWithSubpixelOffset(E,A,B=.5,F=.5){E.getRenderCenter(D,
B,F);D[0]+=.0466;D[1]-=.0123;return n.fromRenderAtEye(E,D,A)}intersectIntersectorScreen(E,A,B){this.computeIntersection(this._getPickRay(E,this._tmpRay),A,B)}intersectToolIntersectorScreen(E,A,B){E=this._getPickRay(E,this._tmpRay);this.intersectToolIntersectorRay(E,A,B)}intersectToolIntersectorRay(E,A,B){A.options.selectionMode=!0;this.computeIntersection(E,A,B);const F=A.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||x.isValidIntersectorResult(F)&&F.intersector!==u.IntersectorType.TERRAIN||
(A.options.selectionMode=!1,this.computeIntersection(E,A,B))}setTolerance(E=l.defaultTolerance){this._tolerance=E}addIntersectionHandler(E){this._externalIntersectionHandlers.push(E);this._externalIntersectionHandlers.sort((A,B)=>A.type===u.IntersectorType.TERRAIN?1:B.type===u.IntersectorType.TERRAIN?-1:0)}removeIntersectionHandler(E){null!=this._externalIntersectionHandlers.removeUnordered(E)&&this._externalIntersectionHandlers.sort((A,B)=>A.type===u.IntersectorType.TERRAIN?1:B.type===u.IntersectorType.TERRAIN?
-1:0)}_getPickRay(E,A){return n.fromScreen(this._view.state.camera,E,A)}_intersectRayFreePointLocal(E,A){if(this.viewingMode!==g.ViewingMode.Local||null==E)return!1;c.add(A,E.origin,c.normalize(f.sv3d.get(),E.direction));return!1}intersectElevationFromScreen(E,A,B=0,F=null){return this._intersectElevation(this._getPickRay(E,this._tmpRay),A,B,F)}_intersectElevation(E,A,B=0,F=null){if(null==E)return null;var G=null!=A?A.mode:"absolute-height",H=A?.offset??0,L="on-the-ground"!==G?H+B:0;A=L/this._view.renderCoordsHelper.unitInMeters;
if("absolute-height"===G)return this._view.renderCoordsHelper.intersectInfiniteManifold(E,L,y)?(B=e.computeMapPointFromVec3d(this._view,y),B.z??(B.z=0),B.z-=H,B):null;H=this._view.state.camera;const C=h.castRenderScreenPointArray3(f.sv3d.get());H.projectToRenderScreen(E.origin,C);L=new r(null,this._forEachLayer);const z=this._view.slicePlane,J=null!=z?x.sliceFilterPredicate(z):null,K=l.newIntersector(this.viewingMode);K.options.store=u.StoreResults.MIN;K.options.verticalOffset=A;A=E.origin;E=c.add(f.sv3d.get(),
A,E.direction);K.reset(A,E,H);K.point=C;const I=F?"type"in F&&"graphics"===F.type?M=>M.layerUid!==F.uid:M=>M.graphicUid!==F.uid:null;switch(G){case "relative-to-scene":K.intersect(L.layers,C,this._tolerance,null,M=>(!I||I(M))&&!!M.lastValidElevationBB);this._externalIntersectionHandlers.forAll(M=>{M.type!==u.IntersectorType.I3S&&M.type!==u.IntersectorType.TERRAIN&&M.type!==u.IntersectorType.TILES3D||M.intersect(K,M.slicePlaneEnabled?J:null,K.rayBegin,K.rayEnd,C)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(M=>
{M.isGround&&M.intersect(K,M.slicePlaneEnabled?J:null,K.rayBegin,K.rayEnd,C)})}return K.results.min.getIntersectionPoint(y)?(G=e.computeMapPointFromVec3d(this._view,y),G.z=B,G):null}computeIntersection(E,A,B,F){if(null!=E){var G=this._view.state.camera,H=h.castRenderScreenPointArray3(f.sv3d.get());G.projectToRenderScreen(E.origin,H);var L=new r(B,this._forEachLayer);A.options.selectOpaqueTerrainOnly=!B||!("include"in B||"exclude"in B);var C=E.origin,z=c.add(f.sv3d.get(),E.origin,E.direction);A.reset(C,
z,G);A.intersect(L.layers,H,this._tolerance);E=this._view.slicePlane;var J=null!=E?x.sliceFilterPredicate(E):null;A.intersect(L.sliceableLayers,H,this._tolerance,J);var K=B&&(B.requiresGroundFeedback||B.enableDraped);this._externalIntersectionHandlers.forAll(I=>{var M=I.layerUid;const S=Array.isArray(M);M=S?M:[M];S&&(A.options.filteredLayerUids=[]);let N=!1;for(const V of M)L.filterLayerUid(V)?N=!0:S&&A.options.filteredLayerUids.push(V);A.options.isFiltered=!N;(I.isGround&&K||!A.options.isFiltered)&&
I.intersect(A,I.slicePlaneEnabled?J:null,C,z,H,F)});E=f.sv3d.get();G=this._view.basemapTerrain;if(B&&B.enableDraped&&null!=G.spatialReference&&A.results.ground.getIntersectionPoint(E)){B=G.overlayManager.renderer;const I=this._view.renderCoordsHelper.spatialReference,M=f.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(E,M,G.spatialReference);M[2]=this._view.elevationProvider?.getElevation(E[0],E[1],E[2],I,"ground")??0;B.intersect(A,M,A.results.ground,S=>L.filterRenderGeometry(S))}A.sortResults();
this._processHUDResults(A)}}_processHUDResults(E){var A=E.results.hud;m.copy(this._tmpRegion,m.negativeInfinity);const B=this._view.state.camera,F=[],G=this._tmpRegion;var H=I=>{const M=new p(I);B.projectToRenderScreen(I.target.center,M.screenPoint);M.screenPoint[0]=Math.floor(M.screenPoint[0]);M.screenPoint[1]=Math.floor(M.screenPoint[1]);F.push(M);m.expandPointInPlace(G,M.screenPoint)};E.sortResults(A.all);null!=A.min.dist&&H(A.min);for(var L of A.all)A.min.target.object!==L.target.object&&A.max.target.object!==
L.target.object&&H(L);null!=A.max.dist&&A.max.target.object!==A.min.target.object&&H(A.max);if(F.length){G[0]===G[2]&&(G[2]+=1);G[1]===G[3]&&(G[3]+=1);A=B.fullWidth;H=B.fullHeight;var C=Math.max(0,G[0]-1),z=Math.max(0,G[1]-1);L=Math.min(m.width(G)+2,A-C);var J=Math.min(m.height(G)+2,H-z);if(!(0>=L||0>=J)){var K=new Uint8Array(L*J*4);this._view._stage.renderer.readHUDVisibility(C,z,L,J,K);C=!0;z=null==E.results.max.dist;J=0;for(const I of F)for(const M of v){const S=4*(Math.min(I.screenPoint[0]+M[0],
A)-G[0]+(Math.min(I.screenPoint[1]+M[1],H)-G[1])*L);if(!(0>S||S>=K.length)&&K[S]){C&&(E.results.min.copy(I.result),C=!1);z&&E.results.max.copy(I.result);E.options.store===u.StoreResults.ALL&&E.results.all.splice(J++,0,I.result);break}}}}}}const v=(()=>{const E=[];for(let A=-1;1>=A;A++)for(let B=-1;1>=B;B++)E.push([B+1,A+1]);return E})();class p{constructor(E){this.result=E;this.screenPoint=h.createRenderScreenPointArray3()}}let t;class r{constructor(E,A){this.layers=[];this.sliceableLayers=[];this.include=
E?.include;this.exclude=E?.exclude;A(B=>{B.pickable&&this.filterLayerUid(B.apiLayerUid)&&(B.sliceable?this.sliceableLayers:this.layers).push(B)})}filterLayerUid(E){const {include:A,exclude:B}=this;return null==E?null==A&&null==B:(null==A||A.has(E))&&(null==B||!B.has(E))}filterRenderGeometry(E){return this.filterLayerUid(E.layerUid)}}const y=k.create(),D=h.createRenderScreenPointArray3();a.SceneIntersectionHelper=q;a.isIntersectionHandler=function(E){return"object"===typeof E&&"intersect"in E};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/hitTest":function(){define("exports ../../../geometry ../../../Graphic ../../../core/iteratorUtils ../../../core/screenUtils ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectVectorToVector ../../../layers/LayerConstants ../../../layers/support/layerUtils ./debugFlags ./ElevationProvider ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/intersectorUtilsConversions ../webgl-engine/lib/verticalOffsetUtils ../../../geometry/SpatialReference ../../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){function t(H,L,C){return L.getIntersectionPoint(F)?(C=D(H,F,C),L.intersector===u.IntersectorType.TERRAIN&&H.basemapTerrain&&(C.z=n.getElevationAtPoint(H.basemapTerrain,C)??0),C):null}function r(H){var L=H.sourceLayer,C=H.layer;if(L=L&&"objectIdField"in L?L:C&&"objectIdField"in C?C:L)if(C=L.objectIdField??f.fallbackObjectIDAttribute,C=H.attributes?.[C])return`o-${L.id}-${C}`;return`u-${H.uid}`}function y(H,L){L=r(L);return null==H||(null==H.include||H.include.has(L))&&
(null==H.exclude||!H.exclude.has(L))}function D(H,L,C){let z=H.spatialReference||v.WGS84;d.projectVectorToVector(L,H.renderSpatialReference,F,z)?L=F:(z=v.WGS84,d.projectVectorToVector(L,H.renderSpatialReference,F,z)&&(L=F));C?(C.x=L[0],C.y=L[1],C.z=L[2],C.spatialReference=z):C=new p(L,z);return C}function E(H,L){const C=A(H,L.include,G.INCLUDE);H=A(H,L.exclude,G.EXCLUDE);return{include:C.layerUids,exclude:H.layerUids,graphics:{include:C.graphicUids,exclude:H.graphicUids}}}function A(H,L,C,z={layerUids:void 0,
graphicUids:void 0}){if(!L)return z;if(L instanceof h){var J=r(L);z.graphicUids||(z.graphicUids=new Set);z.graphicUids.add(J);C===G.INCLUDE&&(null!=H.graphicsView&&L.layer===H?B(z,H.graphicsView.processor.layer.id):L.layer&&B(z,L.layer.uid))}else if(c.isIterable(L))for(J of L)J===H.graphics&&null!=H.graphicsView?B(z,H.graphicsView.processor.layer.id):J===H.map.ground?B(z,q.terrainId):A(H,J,C,z);else"uid"in L&&B(z,L.uid);return z}function B(H,L){H.layerUids||(H.layerUids=new Set);H.layerUids.add(L)}
const F=m.create();var G;(function(H){H[H.INCLUDE=0]="INCLUDE";H[H.EXCLUDE=1]="EXCLUDE"})(G||={});a.computeMapPointFromVec3d=D;a.externalToInternalIntersectOptions=E;a.getGraphicFilterUid=r;a.hitTest=async function(H,L,C,z){z=C?E(H,C):z;var J=k.createScreenPointArray(L.x,L.y);z.requiresGroundFeedback=!0;z.enableDraped=!0;C=l.newIntersector(H.state.viewingMode);C.options.selectionMode=!0;C.options.store=u.StoreResults.ALL;H.sceneIntersectionHelper.intersectIntersectorScreen(J,C,z);J=C.results.all;
var K=z.graphics;z=[];let I=null;for(let V=0;V<J.length;V++){var M=J[V],S=w.toOwner(M,H);if(null!=S&&(S===H.map.ground||"type"in S&&g.isIntegratedMeshLayer(S.type)))break;S=w.toHit(M,H);if(null!=S){if("graphic"===S.type){null==I&&V!==J.length-1&&(I=new Set);if(null!=I){var N=r(S.graphic);if(I.has(N))continue;I.add(N)}if(!y(K,S.graphic))continue}N=t(H,M);M=M.distanceInRenderSpace;if("media"===S.type){const Q=S.element.toSource(N);z.push({...S,mapPoint:N,distance:M,sourcePoint:Q})}else z.push({...S,
mapPoint:N,distance:M})}}J=C.results.ground;K=w.toOwner(J,H);K=null!=K&&"type"in K&&g.isIntegratedMeshLayer(K.type)?K:null;H={screenPoint:L,results:z,ground:{mapPoint:t(H,J),distance:x.isValidIntersectorResult(J)?J.distanceInRenderSpace:0,layer:K}};e.debugFlags.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(H.intersector=C);return H};a.intersectResultToMapPoint=t;a.toMap=function(H,L,C,z){z=C?E(H,C):z;const J=null!=z.graphics&&(null!=z.graphics.include||null!=z.graphics.exclude);L=k.screenPointObjectToArray(L);
z.enableDraped=z.include&&!z.include.has(q.terrainId)||z.exclude&&z.exclude.has(q.terrainId);const K=H.sceneIntersectionHelper,I=l.newIntersector(H.state.viewingMode);I.options.selectionMode=!0;I.options.store=J?u.StoreResults.ALL:u.StoreResults.MIN;I.options.hud=!C?.excludeHud;K.intersectIntersectorScreen(L,I,z);if(J){for(const M of I.results.all)if(C=w.toHit(M,H),null==C||"graphic"!==C.type||y(z.graphics,C.graphic))return t(H,M);return null}return t(H,I.results.min)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(v,p){return null==v?null:f.isObjectIntersectorResult(v)||f.isHudIntersectorResult(v)?n(v.target?.object,p):m.isPclIntersectorResult(v)?(v=v.target.createGraphic(),{type:"graphic",graphic:v,layer:v.layer}):m.isVoxelIntersectorResult(v)?(v=v.target.createVoxelGraphic(),{type:"graphic",graphic:v,layer:v.layer}):m.isTiles3DIntersectorResult(v)?(v=v.target.createTiles3DGraphic(),{type:"graphic",graphic:v,layer:v.layer}):d.isOverlayIntersectorResult(v)||g.isLodIntersectorResult(v)?
n(v.target,p):m.isI3sIntersectorResult(v)?l(v.target,p):null}function n(v,p){if(null==v?.graphicUid)return null;const t=w(v,p);if(null==t)return null;if(t===p.graphics)return null==p.graphicsView||"number"!==typeof v.graphicUid?null:p.graphicsView.getHit(v.graphicUid);p=p.allLayerViews.find(r=>r.layer===t);return!p||p.suspended||null==v.graphicUid?null:"getHit"in p?p.getHit(v.graphicUid):null}function l(v,p){const t=w(v,p);return null==t?null:(p=p.allLayerViews.find(r=>r.layer===t))&&!p.suspended&&
"getGraphicFromIntersectorTarget"in p?x(p.getGraphicFromIntersectorTarget(v)):null}function u(v,p){const t=w(v,p);return null==t?null:(p=p.allLayerViews.find(r=>r.layer===t))&&!p.suspended&&"getAABBFromIntersectorTarget"in p?p.getAABBFromIntersectorTarget(v):null}function x(v){return null!=v?{type:"graphic",graphic:v,layer:v.layer}:null}function w(v,p){return null==v?.layerUid?null:null!=p.graphicsView&&v.layerUid===p.graphicsView.processor.layer.id?p.graphics:p.map.findLayerByUid(v.layerUid)}const q=
h.create();a.getIntersectedFeatureBSRadius=function(v,p){return f.isObjectIntersectorResult(v)||f.isHudIntersectorResult(v)?k.getRadius(v.target.object.boundingVolumeWorldSpace.bounds):g.isLodIntersectorResult(v)?(b.getScaling(q,v.transformation),v.target.baseBoundingSphere.radius*Math.max(q[0],q[1],q[2])):m.isI3sIntersectorResult(v)?(v=u(v.target,p))?.5*c.diameter(v):null:null};a.hasLod=function(v){return f.isObjectIntersectorResult(v)||f.isHudIntersectorResult(v)?!1:g.isLodIntersectorResult(v)?
1<v.target.numLodLevels:m.isI3sIntersectorResult(v)?!0:!1};a.toGraphic=function(v,p){v=e(v,p);return null!=v&&"graphic"===v.type?v.graphic:null};a.toHit=e;a.toOwner=function(v,p){return f.isObjectIntersectorResult(v)||f.isHudIntersectorResult(v)?w(v.target?.object,p):d.isTerrainIntersectorResult(v)?p.map?.ground:m.isPclIntersectorResult(v)||m.isI3sIntersectorResult(v)||d.isOverlayIntersectorResult(v)||m.isVoxelIntersectorResult(v)?w(v.target,p):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,h,c){class k extends h.Graphic3DTarget{constructor(g,e,n,l){super(e,n);this.point=g;this.createGraphic=l}}class m extends h.LayerTarget{constructor(g,e,n,l,u){super(g);this.layerUid=g;this.sublayerUid=e;this.nodeIndex=n;this.componentIndex=l;this.triangleNr=u}}class d extends h.Graphic3DTarget{constructor(g,
e,n){super(e,null);this.point=g;this.createVoxelGraphic=n}}class f extends h.Graphic3DTarget{constructor(g,e){super(g,null);this.createTiles3DGraphic=e}}a.I3sTarget=m;a.PclTarget=k;a.Tiles3DTarget=f;a.VoxelTarget=d;a.isI3sIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.I3S&&!!g.target};a.isPclIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.PCL&&!!g.target};a.isTiles3DIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&
g.intersector===b.IntersectorType.TILES3D&&!!g.target};a.isVoxelIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.VOXEL&&!!g.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery ./ElevationRange".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(v,p,t,r,y,D,E){for(const A of p)p=A.getElevation(t,r,y,D,E),null!=p&&(v=null!=v?Math.max(p,v):p);return v}a.CombinedElevationProvider=class extends c.EventedMixin(h){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(v){super(v);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this._cacheEnabled=!1}destroy(){this._cachedQuery=k.destroyMaybe(this._cachedQuery)}enableCache(v){v||(this.lastElevationQuery=
null);this._cacheEnabled=v}getElevation(v,p,t,r,y){if(this._cacheEnabled&&null!=this.lastElevationQuery){var D=this.lastElevationQuery;if(v===D.x&&p===D.y&&t===D.z&&u.equals(r,D.spatialReference)&&y===D.queryContext)return D.result}D=q(null,this._im,v,p,t,r,y);null==D&&(D=q(D,this._ground,v,p,t,r,y));"scene"===y&&(D=q(D,this._scene,v,p,t,r,y));this._cacheEnabled&&(this.lastElevationQuery={x:v,y:p,z:t,spatialReference:r,queryContext:y,result:D});return D}getSphereElevationBounds(v,p){const t=new w.ElevationRange,
r=y=>{y.getSphereElevationBounds&&(y=y.getSphereElevationBounds(v,p),null!=y&&t.expandElevationRangeValues(y.elevationRangeMin,y.elevationRangeMax))};for(const y of[this._im,this._ground,this._scene])y.forEach(r);return t}getRootElevationBounds(){const v=new w.ElevationRange;for(const p of[this._im,this._ground,this._scene])p.forEach(t=>{t.getRootElevationBounds&&(t=t.getRootElevationBounds(),null!=t&&v.expandElevationRangeValues(t.elevationRangeMin,t.elevationRangeMax))});return v}async queryElevation(v,
p,t,r,y,D=null,E=0){const A=this._getElevationQuery(r);try{const B=await A.queryElevation(v,p,D,E);return"scene"===y?q(B,this._scene,v,p,t,r,y):B}catch(B){return m.throwIfAbortError(B),this.getElevation(v,p,t,r,y)}}register(v,p){this.addHandles(p.on("elevation-change",t=>this.emit("elevation-change",t)),p);this._providersFromContext(v).push(p)}unregister(v){this.removeHandles(v);for(const p of[this._im,this._ground,this._scene]){const t=p.indexOf(v);-1<t&&p.splice(t,1)}}_providersFromContext(v){switch(v){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}}_getElevationQuery(v=this.view.spatialReference){const p=this._cachedQuery;if(null!=p&&u.equals(v,p.spatialReference))return p;p?.destroy({completeTasks:!0});const {wkid:t,wkt:r,wkt2:y,latestWkid:D}=v;return this._cachedQuery=v=new x.ElevationQuery(this.view.resourceController.scheduler,new l({wkid:t,wkt:r,wkt2:y,latestWkid:D}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};b.__decorate([d.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);b.__decorate([d.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=b.__decorate([n.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../geometry ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,h,c,k,m){class d{constructor(g,e){this.spatialReference=g;this._view=e}getElevation(g,e,n){return this._view.elevationProvider.getElevation(g,e,0,this.spatialReference,n)}async queryElevation(g,e,n,l,u){return this._view.elevationProvider.queryElevation(g,e,0,this.spatialReference,u,n,l)}}class f{constructor(g,e,n,l){this.spatialReference=e;this._getElevationQueryProvider=n;this._queries=[];this._queryOptions={...l,ignoreInvisibleLayers:!0};this._frameTask=g.registerTask(k.TaskPriority.ELEVATION_QUERY,
this)}destroy({completeTasks:g}={completeTasks:!1}){this._frameTask.remove();if(this.running)if(g)this.runTask(k.noBudget);else for(const e of this._queries)e.result.reject(c.createAbortError())}queryElevation(g,e,n,l=0){const u=c.createResolver(),x={x:g,y:e,minDemResolution:l,result:u,signal:n};this._queries.push(x);c.onAbort(n,()=>{h.remove(this._queries,x);u.reject(c.createAbortError())});return u.promise}get running(){return 0<this._queries.length}runTask(g){const e=this._queries;this._queries=
[];const n=this._getElevationQueryProvider();if(n){var l=e.map(q=>[q.x,q.y]),u=e.reduce((q,v)=>Math.min(q,v.minDemResolution),Infinity);l=new m({points:l,spatialReference:this.spatialReference});var x=1<e.length&&e.some(q=>!!q.signal)?new AbortController:null,w=null!=x?x.signal:e[0].signal;if(null!=x){let q=0;e.forEach(v=>c.onAbort(v.signal,()=>{q++;v.result.reject(c.createAbortError());q===e.length&&x.abort()}))}n.queryElevation(l,{...this._queryOptions,minDemResolution:u,signal:w}).then(q=>{e.forEach((v,
p)=>{null!=v.signal&&v.signal.aborted?v.result.reject(c.createAbortError()):v.result.resolve(q.geometry.points[p][2])})}).catch(q=>{e.forEach(v=>v.result.reject(q))})}else e.forEach(q=>q.result.reject());g.madeProgress()}get test(){const g=this;return{update:()=>0<g._queries.length&&g.runTask(k.noBudget)}}}a.ElevationQuery=f;a.ViewElevationProvider=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationRange":function(){define(["exports"],function(a){class b{constructor(h=
Infinity,c=-Infinity){this.elevationRangeMin=h;this.elevationRangeMax=c}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(h,c){this.elevationRangeMin=Math.min(this.elevationRangeMin,h);this.elevationRangeMax=Math.max(this.elevationRangeMax,c)}expandElevationRange(h){this.elevationRangeMin=Math.min(this.elevationRangeMin,h.elevationRangeMin);this.elevationRangeMax=Math.max(this.elevationRangeMax,h.elevationRangeMax)}setElevationRange(h){this.elevationRangeMin=
h.elevationRangeMin;this.elevationRangeMax=h.elevationRangeMax}}a.ElevationRange=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has","../../../core/time"],function(a,b){function h(){const m=!!a("esri-mobile"),d=!!a("ios"),f=b.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxNumberOfDrawCalls:8E3,maxTotalNumberOfVertices:255E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,
skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0},fadeDuration:b.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,
reflections:!1,ambientOcclusion:!1,memoryLimit:200+k.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:625E4,polygonLodFactor:m?.8:1,polylineLodFactor:m?1.2:1.5,snapshotAvailable:!d,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:m},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},
pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:m},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},fadeDuration:f,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:m?600+k.GalaxyS20:750+k.FullHD,additionalCacheMemory:m?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1E5,
maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:125E5,polygonLodFactor:m?1.2:2,polylineLodFactor:m?1.2:2,snapshotAvailable:!d,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},
fadeDuration:f,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:m?900+k.SurfacePro7:1500+k.FullHDRetina,additionalCacheMemory:m?-150:0,frameRate:0,maximumPixelRatio:m?1:Infinity}}}class c{static isValidProfile(m){return m in c.profiles}static getDefaultProfile(){return a("esri-iPhone")?"low":"medium"}static apply(m,d){m=c.profiles[m];d.graphics3D.maxTotalNumberOfFeatures=m.graphics3D.maxTotalNumberOfFeatures;
d.graphics3D.maxNumberOfDrawCalls=m.graphics3D.maxNumberOfDrawCalls;d.graphics3D.maxTotalNumberOfVertices=m.graphics3D.maxTotalNumberOfVertices;d.graphics3D.polygonLodFactor=m.graphics3D.polygonLodFactor;d.graphics3D.polylineLodFactor=m.graphics3D.polylineLodFactor;d.graphics3D.snapshotAvailable=m.graphics3D.snapshotAvailable;d.graphics3D.skipHighSymbolLods=m.graphics3D.skipHighSymbolLods;d.graphics3D.uncompressedTextureDownsamplingEnabled=m.graphics3D.uncompressedTextureDownsamplingEnabled;d.sceneService.object.lodFactor=
m.sceneService.object.lodFactor;d.sceneService.point.lodFactor=m.sceneService.point.lodFactor;d.sceneService.integratedMesh.lodFactor=m.sceneService.integratedMesh.lodFactor;d.sceneService.pointCloud.lodFactor=m.sceneService.pointCloud.lodFactor;d.sceneService.uncompressedTextureDownsamplingEnabled=m.sceneService.uncompressedTextureDownsamplingEnabled;d.tiledSurface.lodBias=m.tiledSurface.lodBias;d.tiledSurface.angledSplitBias=m.tiledSurface.angledSplitBias;d.tiledSurface.vtlContentZoom=m.tiledSurface.vtlContentZoom;
d.tiledSurface.reduceTileLevelDifferences=m.tiledSurface.reduceTileLevelDifferences;d.heatmap.pixelRatio=m.heatmap.pixelRatio;d.heatmap.maxTotalNumberOfFeatures=m.heatmap.maxTotalNumberOfFeatures;d.fadeDuration=m.fadeDuration;d.antialiasingEnabled=m.antialiasingEnabled;d.physicallyBasedRenderingEnabled=m.physicalBasedRenderingEnabled;d.highQualityTransparency=m.highQualityTransparency;d.highResolutionAtmosphere=m.highResolutionAtmosphere;d.reflections=m.reflections;d.ambientOcclusion=m.ambientOcclusion;
d.memoryLimit=m.memoryLimit;d.additionalCacheMemory=m.additionalCacheMemory;d.frameRate=m.frameRate;d.maximumPixelRatio=m.maximumPixelRatio}}c.test={reset(){const m=h();for(const d of Object.keys(m))c.profiles[d]=m[d]}};const k={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};(c||={}).profiles=h();return c})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../webgl-engine/effects/highlight/HighlightDefaults".split(" "),
function(a,b,h,c,k,m,d,f,g){h=class extends h{constructor(){super(...arguments);this.color=g.defaultColor.clone();this.haloColor=null;this.haloOpacity=g.defaultHaloOpacity;this.fillOpacity=g.defaultFillOpacity;this.shadowOpacity=g.defaultShadowOpacity;this.shadowColor=g.defaultShadowColor.clone();this.shadowDifference=g.defaultShadowDifference}};a.__decorate([c.property({type:b})],h.prototype,"color",void 0);a.__decorate([c.property({type:b})],h.prototype,"haloColor",void 0);a.__decorate([c.property()],
h.prototype,"haloOpacity",void 0);a.__decorate([c.property()],h.prototype,"fillOpacity",void 0);a.__decorate([c.property()],h.prototype,"shadowOpacity",void 0);a.__decorate([c.property({type:b})],h.prototype,"shadowColor",void 0);a.__decorate([c.property()],h.prototype,"shadowDifference",void 0);return h=a.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],h)})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDefaults":function(){define(["exports","../../../../../Color"],function(a,
b){const h=new b([0,255,255]);b=new b([0,0,0]);a.defaultColor=h;a.defaultFillOpacity=.25;a.defaultHaloOpacity=1;a.defaultShadowColor=b;a.defaultShadowDifference=.2;a.defaultShadowOpacity=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(l,u){this.spatialReference=u;this.unitInMeters=c.getMetersPerUnitForSR(this.spatialReference,k.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=m.getGeometryServiceURL(l&&"portalItem"in l?l.portalItem:void 0).catch(()=>{throw new h("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}async toGeographic(l){var u=await this._geometryServiceURLPromise;let x=!0;Array.isArray(l[0])&&
"number"!==typeof l[0]||(l=[l],x=!1);l=l.map(w=>w instanceof g?w:new g(w,this.spatialReference));l=new f({geometries:l,outSpatialReference:e.WGS84});u=(await d.project(u,l)).map(w=>"point"===w.type?[w.x,w.y]:void 0).filter(w=>!!w);return x?u:u[0]}}a.MapCoordsHelper=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,h,c,k,m){async function d(f=null,g){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!f)throw new h("internal:geometry-service-url-not-configured");f="portal"in f?f.portal||c.getDefault():f;await f.load({signal:g});g=f.helperServices?.geometry?.url;if(!g)throw new h("internal:geometry-service-url-not-configured");return g}a.getGeometryServiceURL=d;a.projectGeometry=async function(f,g,e=null,n){e=await d(e,n);const l=new m;l.geometries=[f];l.outSpatialReference=g;if((f=await k.project(e,
l,{signal:n}))&&Array.isArray(f)&&1===f.length)return f[0];throw new h("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,h,c,k,m,d){const f=h.ensureType(d);a.project=async function(g,e,n){e=f(e);g=k.parseUrl(g);const l=
{...g.query,f:"json",...e.toJSON()},u=e.outSpatialReference,x=c.getJsonType(e.geometries[0]);e=k.asValidOptions(l,n);return b(g.path+"/project",e).then(({data:{geometries:w}})=>m.decodeGeometries(w,x,u))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,h,c,k,m,d,f,g){b=class extends b.JSONSupport{constructor(e){super(e);this.geometries=[];this.transformForward=this.transformation=this.outSpatialReference=null}toJSON(){const e=this.geometries.map(u=>u.toJSON()),n=this.geometries[0],l={};l.outSR=g.srToRESTValue(this.outSpatialReference);l.inSR=g.srToRESTValue(n.spatialReference);l.geometries=JSON.stringify({geometryType:f.getJsonType(n),geometries:e});this.transformation&&(l.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(l.transformForward=this.transformForward);return l}};a.__decorate([h.property()],b.prototype,"geometries",void 0);a.__decorate([h.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);a.__decorate([h.property()],b.prototype,"transformation",void 0);a.__decorate([h.property()],b.prototype,"transformForward",void 0);return b=a.__decorate([d.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/support/popupHitTest":function(){define(["exports",
"../../../layers/support/layerUtils","../terrain/LayerClass","../../support/hitTestSelectUtils"],function(a,b,h,c){function k(f,g){const e=new Set,n=[];var l=f.basemapTerrain.numLayers(h.LayerClass.MAP);for(--l;0<=l;l--){const u=f.basemapTerrain.layerViewByIndex(l,h.LayerClass.MAP);e.add(u.layer.uid);n.push(u)}f=f.basemapTerrain.overlayManager.renderer.layers;for(const {uid:u}of f)if(f=g.get(u))e.add(u),n.push(f);n.reverse();return{layerUids:e,layerViews:n}}function m(f){const g=new Map;for(const e of f.allLayerViews)g.set(e.layer.uid,
e);return g}const d={layerUids:new Set,layerViews:[]};a.popupHitTest=async function(f,g){const {results:e,ground:n}=await c.hitTestSelectSimilarDistance(f,g),l=(!n.layer||!b.isIntegratedMeshLayer(n.layer.type))&&n.mapPoint,u=[];g=m(f);const x=l?k(f,g):d;let w=f=0;const q=()=>{const p=x.layerViews[w];l&&p&&"fetchPopupFeaturesAtLocation"in p&&u.push({mapPoint:n.mapPoint,layerView:p});++w};let v=null;for(;f<e.length||w<x.layerViews.length;){const p=e[f];if(p&&"graphic"!==p.type)++f;else if(p){const t=
x.layerUids.has(p.layer?.uid)&&p.distance===n.distance,r=g.get(p.layer?.uid);v??=p.mapPoint;w<x.layerViews.length&&(t||(p.distance??0)>n.distance)&&x.layerViews[w]!==r?q():(u.push({graphic:p.graphic,layerView:r}),++f)}else q()}v??=n.mapPoint;return{hits:u,location:v}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=
1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(a){function b(h){return"graphic"===h?.type}a.filterGraphicHits=function(h){return h.filter(b)};a.findFirstGraphicHit=function(h){return h.find(b)??null};a.hitTestSelectSimilarDistance=async function(h,c){if("2d"===h.type)return h.hitTest(c);h=await h.hitTest(c);if(0===h.results.length)return h;
c=h.results[0];const k=1.05*(c.distance??0),m=h.results.findIndex(d=>(d.distance??0)>k);-1!==m&&(h.results=h.results.slice(0,m));c&&h.ground.distance>k&&(h.ground.mapPoint=null);return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){let g=class extends b{constructor(){super(...arguments);this.minTotalNumberOfFeatures=2E3;this.maxTotalNumberOfFeatures=5E4;this.maxNumberOfDrawCalls=17E3;this.maxTotalNumberOfVertices=17E5;this.snapshotAvailable=!0;this.polylineLodFactor=this.polygonLodFactor=1;this.uncompressedTextureDownsamplingEnabled=this.skipHighSymbolLods=!1}};a.__decorate([c.property()],g.prototype,"minTotalNumberOfFeatures",void 0);a.__decorate([c.property()],g.prototype,"maxTotalNumberOfFeatures",
void 0);a.__decorate([c.property()],g.prototype,"maxNumberOfDrawCalls",void 0);a.__decorate([c.property()],g.prototype,"maxTotalNumberOfVertices",void 0);a.__decorate([c.property()],g.prototype,"snapshotAvailable",void 0);a.__decorate([c.property()],g.prototype,"polygonLodFactor",void 0);a.__decorate([c.property()],g.prototype,"polylineLodFactor",void 0);a.__decorate([c.property()],g.prototype,"skipHighSymbolLods",void 0);a.__decorate([c.property()],g.prototype,"uncompressedTextureDownsamplingEnabled",
void 0);g=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],g);let e=class extends b{constructor(){super(...arguments);this.lodFactor=1}};a.__decorate([c.property()],e.prototype,"lodFactor",void 0);e=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],e);let n=class extends b{constructor(){super(...arguments);this.object=new e;this.point=new e;this.integratedMesh=new e;this.pointCloud=new e;this.uncompressedTextureDownsamplingEnabled=
!1}};a.__decorate([c.property({type:e})],n.prototype,"object",void 0);a.__decorate([c.property({type:e})],n.prototype,"point",void 0);a.__decorate([c.property({type:e})],n.prototype,"integratedMesh",void 0);a.__decorate([c.property({type:e})],n.prototype,"pointCloud",void 0);a.__decorate([c.property()],n.prototype,"uncompressedTextureDownsamplingEnabled",void 0);n=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],n);let l=class extends b{constructor(){super(...arguments);
this.lodBias=0;this.vtlContentZoom=this.angledSplitBias=1;this.reduceTileLevelDifferences=!0}};a.__decorate([c.property()],l.prototype,"lodBias",void 0);a.__decorate([c.property()],l.prototype,"angledSplitBias",void 0);a.__decorate([c.property()],l.prototype,"vtlContentZoom",void 0);a.__decorate([c.property()],l.prototype,"reduceTileLevelDifferences",void 0);l=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],l);let u=class extends b{constructor(){super(...arguments);
this.pixelRatio=1;this.maxTotalNumberOfFeatures=5E4}};a.__decorate([c.property()],u.prototype,"pixelRatio",void 0);a.__decorate([c.property()],u.prototype,"maxTotalNumberOfFeatures",void 0);u=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],u);b=class extends b{constructor(){super(...arguments);this.graphics3D=new g;this.sceneService=new n;this.tiledSurface=new l;this.heatmap=new u;this.fadeDuration=h.Milliseconds(400);this.antialiasingEnabled=!0;this.physicallyBasedRenderingEnabled=
!1;this.highQualityTransparency=!0;this.ambientOcclusion=this.reflections=this.highResolutionAtmosphere=!1;this.memoryLimit=750;this.additionalCacheMemory=0;this.frameRate=void 0;this.maximumPixelRatio=Infinity}};a.__decorate([c.property({type:g})],b.prototype,"graphics3D",void 0);a.__decorate([c.property({type:n})],b.prototype,"sceneService",void 0);a.__decorate([c.property({type:l})],b.prototype,"tiledSurface",void 0);a.__decorate([c.property({type:u})],b.prototype,"heatmap",void 0);a.__decorate([c.property()],
b.prototype,"fadeDuration",void 0);a.__decorate([c.property()],b.prototype,"antialiasingEnabled",void 0);a.__decorate([c.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);a.__decorate([c.property()],b.prototype,"highQualityTransparency",void 0);a.__decorate([c.property()],b.prototype,"highResolutionAtmosphere",void 0);a.__decorate([c.property()],b.prototype,"reflections",void 0);a.__decorate([c.property()],b.prototype,"ambientOcclusion",void 0);a.__decorate([c.property()],b.prototype,
"memoryLimit",void 0);a.__decorate([c.property()],b.prototype,"additionalCacheMemory",void 0);a.__decorate([c.property()],b.prototype,"frameRate",void 0);a.__decorate([c.property()],b.prototype,"maximumPixelRatio",void 0);return b=a.__decorate([f.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){class p{constructor(t,r,y,D){this.viewingMode=t;this.spatialReference=r;this.unitInMeters=y;this._coordinateSystem=D;this._tmpCoordinateSystem=l.create(D);this.referenceEllipsoid=m.getReferenceEllipsoid(r);this.sphericalPCPF=d.getSphericalPCPF(r)}set extent(t){t&&l.setExtent(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return l.altitudeAt(this._coordinateSystem,t)}setAltitude(t,r,y=t){return l.setAltitudeAt(this._coordinateSystem,y,r,
t)}setAltitudeOfTransformation(t,r){l.setAltitudeOfTransformation(this._coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return l.normalAt(this._coordinateSystem,t,r)}worldBasisAtPosition(t,r,y){return l.axisAt(this._coordinateSystem,t,r,y)}basisMatrixAtPosition(t,r){const y=this.worldBasisAtPosition(t,n.Axis.X,w.sv3d.get()),D=this.worldBasisAtPosition(t,n.Axis.Y,w.sv3d.get());t=this.worldBasisAtPosition(t,n.Axis.Z,w.sv3d.get());c.set(r,y[0],y[1],y[2],0,D[0],D[1],D[2],0,t[0],t[1],t[2],0,0,0,0,1);return r}headingAtPosition(t,
r){const y=this.worldUpAtPosition(t,w.sv3d.get());t=this.worldBasisAtPosition(t,n.Axis.Y,w.sv3d.get());r=x.angleAroundAxis(r,t,y);return b.rad2deg(r)}intersectManifoldClosestSilhouette(t,r,y){l.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);l.intersectRayClosestSilhouette(this._tmpCoordinateSystem,t,y);return y}intersectManifold(t,r,y){l.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=w.sv3d.get();return l.intersectRay(this._tmpCoordinateSystem,t,r)?k.copy(y,r):null}intersectInfiniteManifold(t,
r,y){if(this.viewingMode===v.ViewingMode.Global)return this.intersectManifold(t,r,y);l.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=this._tmpCoordinateSystem.value;const D=w.sv3d.get();return u.intersectRay(r.plane,t,D)?k.copy(y,D):null}toRenderCoords(t,r,y){return q.isDehydratedPoint(t)?f.projectPointToVector(t,r,this.spatialReference):e.projectVectorToVector(t,r,y,this.spatialReference)}fromRenderCoords(t,r,y=null){return q.isDehydratedPoint(r)?(null!=y&&(r.spatialReference=y),
g.projectVectorToPoint(t,this.spatialReference,r)?r:null):e.projectVectorToVector(t,this.spatialReference,r,y)?r:null}static create(t,r){switch(t){case v.ViewingMode.Local:return new p(v.ViewingMode.Local,r,h.getMetersPerUnitForSR(r),l.createLocal());case v.ViewingMode.Global:return new p(v.ViewingMode.Global,r,1,l.createGlobal(r))}}static renderUnitScaleFactor(t,r){return h.getMetersPerCartesianUnitForSR(t)/h.getMetersPerCartesianUnitForSR(r)}}a.RenderCoordsHelper=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){h=class extends h{constructor(){super(...arguments);this.updating=!1}};b.__decorate([e.property({readOnly:!0})],h.prototype,"updating",void 0);h=b.__decorate([x.subclass("esri.views.3d.support.ResourceControllerMain")],h);let t=class extends h{constructor(){super(...arguments);this._normalTask=this._immediateTask=p.ImmediateTask;this._updatingObjects=f.signal([]);this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=
p.newScheduler();this._memoryController=q.newMemoryController(this.view);this._streamDataLoader=new v.StreamDataLoader;this._streamDataLoader.setup(w.maxDownloadSlots,w.downloadSlotsPerClient,this._scheduler);this.addHandles([m.watch(()=>this.view.state?.mode,r=>{null!=r&&(this._scheduler.state=r)},m.sync),m.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=d.addFrameTask({update:r=>this._frame(r)});this._immediateTask=this._scheduler.registerTask(p.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(p.TaskPriority.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=k.removeMaybe(this._frameTask);this._streamDataLoader=k.destroyMaybe(this._streamDataLoader);this._memoryController=k.destroyMaybe(this._memoryController);this._scheduler=k.destroyMaybe(this._scheduler);this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||
this._updatingObjects?.value.some(r=>r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(r){const y=this._streamDataLoader;return{request(D,E,A){return y.request(D,E,r,A)},get busy(){return!y.hasDownloadSlots(r)}}}addUpdatingObject(r){const y=this._updatingObjects;y.value=[...y.value,r];return c.makeHandle(()=>{y.value=y.value.filter(D=>D!==r)})}_frame(r){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(g.secondsFromMilliseconds(r.deltaTime)),
!this._scheduler))return;this._memoryController.update();this._scheduler.updateBudget(r)&&this._scheduler.frame()}}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r)}}};b.__decorate([e.property()],t.prototype,"view",void 0);b.__decorate([e.property()],t.prototype,"_scheduler",void 0);b.__decorate([e.property()],t.prototype,"_memoryController",void 0);b.__decorate([e.property()],t.prototype,
"_streamDataLoader",void 0);b.__decorate([e.property()],t.prototype,"_immediateTask",void 0);b.__decorate([e.property()],t.prototype,"_normalTask",void 0);b.__decorate([e.property()],t.prototype,"_updatingObjects",void 0);b.__decorate([e.property({readOnly:!0})],t.prototype,"updating",null);t=b.__decorate([x.subclass("esri.views.3d.support.ResourceControllerImpl")],t);a.newResourceController=function(r){return new t({view:r})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],
function(a){a.ClientType=void 0;(function(h){h[h.ELEVATION=0]="ELEVATION";h[h.BASEMAP=1]="BASEMAP";h[h.I3S_INDEX=2]="I3S_INDEX";h[h.I3S_DATA=3]="I3S_DATA";h[h.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const h=[];h[a.ClientType.ELEVATION]=10;h[a.ClientType.BASEMAP]=10;h[a.ClientType.I3S_INDEX]=10;h[a.ClientType.I3S_DATA]=10;h[a.ClientType.SYMBOLOGY]=5;return h})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/MemCache ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){let l=class extends h{constructor(u){super(u);this._quality=1;this._usedMemory=0;this._updating=!1;this._downscaleMemoryUsed=
this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=0;this._cacheStorage=new k.MemCacheStorage;this._warnMemoryUsage=null;this._numQualityChanges=0;this._maxMemory=750;this._additionalCacheMemory=0;this.addHandles(m.addFrameTask({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(u){null==u||0>=u||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<u&&this._updateQuality(1),this._maxMemory=u)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(u){null!=
u&&(this._additionalCacheMemory=u)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(u,x){return new k.MemCache(u,this._cacheStorage,x)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(!(0>=this._memoryPredicted)||this._updating){var u=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=
this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(u){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):.1<this._quality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,u=this._updateQuality(this._quality/
1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,u=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=u}}_updateQuality(u){u=Math.min(Math.max(u,.1),1);if(u===this._quality)return!1;this._quality=u;++this._numQualityChanges;return!0}_layersUpdating(){return this.view.allLayerViews.some(u=>!!u.updating)}_updateMemory(){if(this.view){this.view._stage?.renderer?.tick();
var u=this.view._stage?.renderer?.usedMemory,x=(this.view.basemapTerrain?.usedMemory??0)+(u?u.fbos+u.edges+u.plugins:0),w=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(v=>{if(n.isMemoryManagedView(v)){const p=v.ignoresMemoryFactor?this._quality:1;x+=v.usedMemory*p;w+=v.unloadedMemory*p}});var q=null==this._warnMemoryUsage||Math.round(10*x)!==Math.round(10*this._warnMemoryUsage);u=1048576*this.maxMemory;if(x>u&&q){this._warnMemoryUsage=x;q=p=>(p/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+
" MB";const v=Math.round(100*this._quality);c.getLogger(this).warn(`Memory Limit exceeded! Limit: ${q(u)} Current: ${q(x)} Projected: ${q(x+w)} Quality: ${v}%`)}this._usedMemory=x/u;this._memoryPredicted=(x+w)/u;this._cacheStorage.maxSize=Math.max(0,u-x+1048576*this.additionalCacheMemory)}}get test(){const u=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const x=u._numQualityChanges;u._numQualityChanges=0;return x},disableMemCache:()=>u.disableMemCache()}}};b.__decorate([d.property({constructOnly:!0})],
l.prototype,"view",void 0);b.__decorate([d.property()],l.prototype,"maxMemory",null);b.__decorate([d.property()],l.prototype,"additionalCacheMemory",null);b.__decorate([d.property({readOnly:!0})],l.prototype,"memoryFactor",null);b.__decorate([d.property({readOnly:!0})],l.prototype,"updating",null);b.__decorate([d.property({readOnly:!0})],l.prototype,"usedMemory",null);b.__decorate([d.property({readOnly:!0})],l.prototype,"usedCacheMemory",null);b.__decorate([d.property()],l.prototype,"_quality",void 0);
b.__decorate([d.property()],l.prototype,"_usedMemory",void 0);b.__decorate([d.property()],l.prototype,"_updating",void 0);b.__decorate([d.property()],l.prototype,"_stableQuality",void 0);b.__decorate([d.property()],l.prototype,"_maxMemory",void 0);b.__decorate([d.property()],l.prototype,"_additionalCacheMemory",void 0);l=b.__decorate([e.subclass("esri.views.3d.support.MemoryController")],l);a.minQuality=.1;a.newMemoryController=function(u){return new l({view:u})};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(y){if(2>y.byteLength)return"unknown";y=new Uint8Array(y,0,y.byteLength);return 137===y[0]&&80===y[1]?"image/png":71===y[0]&&73===y[1]?"image/gif":66===y[0]&&77===y[1]?"image/bmp":255===y[0]&&216===y[1]?"image/jpeg":"unknown"}a.StreamDataLoader=class extends c{constructor(){super(...arguments);this._tasks=new Map;this._onLoadQueue=[];this._doneQueue=[];this.updating=!1}setup(y,D,E){this._loadQueue=new x.AsyncWorkerQueue((A,B)=>this._startLoading(A,
B),(A,B)=>this._doneLoadingCB(A,B),y,D);E&&(this._frameTask=E.registerTask(q.TaskPriority.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=f.removeMaybe(this._frameTask);this._tasks.forEach(y=>f.abortMaybe(y.abortController));this._loadQueue=f.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null}hasDownloadSlots(y){return this._loadQueue.hasQuota(y)}request(y,D,E,A={}){const B=g.createResolver();B.__signal=null!=A?A.signal:null;const F=this._createOrUpdateTask(y,D,E,
A,B);g.onAbort(A,()=>this._cancelRequest(F,B));return B.promise}_createTask(y,D,E,A,B,F){y=new r(y,D,E,A,B);this._updateTask(y,F);this._tasks.set(B,y);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(y);return y}_cancelRequest(y,D){k.removeUnordered(y.resolvers,D);D.reject(g.createAbortError());0===y.resolvers.length&&(y.status===a.TaskStatus.DOWNLOADING&&(y.status=a.TaskStatus.CANCELLED,this._loadQueue.cancel(y),y.abortController?.abort(),y.request=null,y.abortController=null),
y.status=a.TaskStatus.CANCELLED,this._tasks.delete(y.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(y,D){y.resolvers.push(D)}_createOrUpdateTask(y,D,E,A,B){const F=`${A?.uid||y}:${D}:${E}`,G=this._tasks.get(F);return G?(this._updateTask(G,B),G):this._createTask(y,A,D,E,F,B)}_doneLoadingCB(y,D){this._loadQueue&&(w.assert(y.status===a.TaskStatus.DOWNLOADING),y.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:y,err:D}):this._doneLoading(y,D))}get running(){return 0<
this._doneQueue.length||0<this._onLoadQueue.length}runTask(y){for(;!y.done&&0<this._onLoadQueue.length;){var D=this._onLoadQueue.shift();g.throwIfAborted(D.task.abortController);D.task.abortController=null;D.callback(D.task);y.madeProgress()}for(;!y.done&&0<this._doneQueue.length;)D=this._doneQueue.shift(),D.task.status!==a.TaskStatus.DOWNLOADED&&(D.err=D.err||g.createAbortError()),this._doneLoading(D.task,D.err),y.madeProgress()}_doneLoading(y,D){if(D&&!g.isAbortError(D)&&0<y.numRetries)--y.numRetries,
this._loadQueue.push(y);else{var E=y.result instanceof HTMLImageElement?0:y.resolvers.length;for(const A of y.resolvers)if(D)g.isAbortError(D)?A.reject(D):A.reject(new m("stream-data-loader:request-error",`Failed to request resource at '${y.url}'. ${D}`,{url:y.url,error:D}));else{--E;const B=0<E?d.clone(y.result):y.result;A.resolve(B)}this._tasks.delete(y.key);0===this._tasks.size&&this._set("updating",!1)}}_startLoading(y,D){if(y.status===a.TaskStatus.CANCELLED)return!1;y.startTime=performance.now();
y.status=a.TaskStatus.DOWNLOADING;let E,A;switch(y.docType){case "binary":A="array-buffer";E=0;break;case "image":A="image";break;case "image+type":A="array-buffer";break;default:A="json"}y.abortController=new AbortController;const B=y.abortController.signal;y.request=h(y.url,{...y.options,responseType:A,timeout:E,signal:B});let F=()=>{};const G=L=>{y.duration=performance.now()-y.startTime;y.size=L instanceof ArrayBuffer?L.byteLength:y.size||0;y.result=L;this._frameTask?this._onLoadQueue.push({callback:D,
task:y}):(y.abortController=null,D(y))},H=L=>{y.status===a.TaskStatus.DOWNLOADING&&D(y,L);F()};if("image+type"!==y.docType)return y.request.then(L=>G(L.data),H),!0;y.request.then(L=>{L=L.data;const C=v(L);A="image";y.size=L.byteLength;if("unknown"===C)y.request=h(y.url,{responseType:A,timeout:E,signal:B}),y.request.then(J=>G(J.data),H);else{L=new Blob([L],{type:C});var z=window.URL.createObjectURL(L);F=()=>window.URL.revokeObjectURL(z);y.request=h(z,{responseType:A,timeout:E,signal:B});y.request.then(J=>
G(new t(J.data,C,F)),H)}},H);return!0}get test(){return{loadQueue:this._loadQueue}}};b.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([u.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);const p={numRetries:0};class t{constructor(y,D,E){this.image=y;this.type=D;this.release=E}get isOpaque(){return"image/jpeg"===this.type}}class r extends x.BaseTask{constructor(y,D,E,A,B){super(A);this.url=y;this.options=
D;this.docType=E;this.key=B;this.result=null;this.status=a.TaskStatus.QUEUED;this.abortController=this.request=null;this.resolvers=[];this.startTime=0;this.numRetries=p.numRetries}}a.TaskStatus=void 0;(function(y){y[y.QUEUED=1]="QUEUED";y[y.DOWNLOADING=2]="DOWNLOADING";y[y.DOWNLOADED=3]="DOWNLOADED";y[y.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=t;a.isImageWithType=function(y){return"image"in y&&"type"in y};a.test=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../webgl-engine/lib/Util"],function(a,b){class h{constructor(d){this.client=d;this._cancelled=!1;this.duration=this.size=0}}class c{constructor(d){this.typeWorkerQuota=d;this.tasks=[];this.numWorkers=0;this.statistics=new k}}class k{constructor(){this.speed=this.duration=this.size=this.requests=0}}class m{constructor(d,f,g,e){this._workerFunc=d;this._callbackFunc=f;this._maxTotalNumWorkers=g;this._totalNumWorkers=0;this._clients=
e.map(n=>new c(n))}destroy(){this._clients.length=0}hasQuota(d){return(d=this._clients[d])?this._totalNumWorkers<this._maxTotalNumWorkers||d.numWorkers+d.tasks.length<d.typeWorkerQuota:!1}push(d){const f=this._clients[d.client];f&&(this._totalNumWorkers<this._maxTotalNumWorkers?(f.numWorkers++,this._totalNumWorkers++,this._workerFunc(d,(g,e)=>this._taskCallback(g,e))):f.tasks.push(d))}cancel(d){this._taskFinished(d);d._cancelled=!0}_taskFinished(d){const f=this._clients[d.client];this._totalNumWorkers--;
f&&(f.numWorkers--,f.statistics.requests++,f.statistics.size+=d.size||0,f.statistics.duration+=d.duration||0,f.statistics.speed=0<f.statistics.duration?f.statistics.size/f.statistics.duration:0,b.assert(0<=f.numWorkers));this._next()}_next(){for(const d of this._clients)if(d&&d.numWorkers<d.typeWorkerQuota&&this._processQueue(d))return;for(const d of this._clients)if(d&&this._processQueue(d))break}_processQueue(d){for(;0<d.tasks.length;)if(this._workerFunc(d.tasks.shift(),(f,g)=>this._taskCallback(f,
g)))return d.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(d,f){d._cancelled||(this._callbackFunc(d,f),this._taskFinished(d))}getStatsForType(d){return(d=this._clients[d])?{quota:d.typeWorkerQuota,workers:d.numWorkers,queueSize:d.tasks.length,requestStats:d.statistics}:null}get test(){const d=this;return{set workerFunc(f){d._workerFunc=f}}}}a.AsyncWorkerQueue=m;a.BaseTask=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/ByteSizeUnit",
"../layers/support/LayerViewPerformanceInfo","./LayerPerformanceInfo"],function(a,b,h){class c{constructor(k){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];this.fboMemory=this.cachedMemory=0;if(null!=k.resourceController){const m=k.resourceController.memoryController;this.totalMemory=(m.maxMemory??0)*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(m.usedMemory*this.totalMemory);this.quality=k.quality;this.load=k.resourceController.scheduler.load;
this.cachedMemory=m.usedCacheMemory}this.terrainMemory=k.basemapTerrain?.usedMemory??0;this.edgesMemory=k._stage.renderer.usedMemory.edges??0;this.fboMemory=k._stage.renderer.usedMemory.fbos??0;k.allLayerViews.items.forEach(m=>{b.isPerformanceInfoLayerView(m)&&this.layerPerformanceInfos.push(new h(m))});this.layerPerformanceInfos.sort((m,d)=>d.memory-m.memory)}}return c})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var b=a.ByteSizeUnit||(a.ByteSizeUnit=
{});b[b.KILOBYTES=1024]="KILOBYTES";b[b.MEGABYTES=1048576]="MEGABYTES";b[b.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/LayerViewPerformanceInfo":function(){define(["exports"],function(a){class b{constructor(h,c=0,k=0,m=0,d=0,f=null){this.usedMemory=h;this.displayedFeatures=c;this.totalFeatures=k;this.maximumFeatures=m;this.nodes=d;this.core=f}}a.LayerViewPerformanceInfo=b;a.isPerformanceInfoLayerView=function(h){return"performanceInfo"in
h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(function(){class a{constructor(b){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;b=b.performanceInfo;this.memory=b.usedMemory;this.displayedNumberOfFeatures=b.displayedFeatures;this.maximumNumberOfFeatures=b.maximumFeatures;this.totalNumberOfFeatures=b.totalFeatures}}return a})},
"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){class l{constructor(x){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=
null;this._viewState=x.viewState;this._view=x.view;this._pointsOfInterest=x.pointsOfInterest;this.streamDataRequester=x.resourceController.createStreamDataRequester(g.ClientType.SYMBOLOGY);this.objectResourceCache=new f.ObjectResourceCache((q,v)=>x.resourceController.memoryController.newCache(q,v));this.textures=new e.StreamTextureCollection(this.streamDataRequester,x.view._stage,x.resourceController.scheduler);const w=d.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=
n.getSettings(x.viewingMode,w);this.screenSizePerspectiveSettingsLabels=n.getLabelSettings(x.viewingMode,w)}destroy(){this.textures.destroy();this.streamDataRequester=null}addGraphicsOwner(x){if(!x)return c.makeHandle();this._graphicsOwners.push(x);const w=m.watch(()=>x.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return c.makeHandle(()=>{w.remove();b.removeUnordered(this._graphicsOwners,x);this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){var x=
this._graphicsOwners.some(w=>!0===w.layer?.screenSizePerspectiveEnabled);x&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new h,x=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([m.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,x,m.sync),this._viewState.events.on("camera-projection-changed",x)]),this._updateScreenSizePerspectiveSettings()):x||(this._screenSizePerspectiveHandles=k.destroyMaybe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){u.distance=
this._pointsOfInterest.centerOnSurfaceInfrequent.distance;u.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(u);this.screenSizePerspectiveSettingsLabels.update(u);this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const u={distance:0,fovY:0};a.SharedSymbolResources=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(a,b,h,c,k,m){class d{constructor(f){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=f("gltf-resources",()=>{});this._wosrMemCache=f("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(f=>f.abortController.abort());this._wosrLoading.forEach(f=>f.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(f,g,e){const n=e?`gltfPBR:${f}`:`gltf:${f}`,l=this._gltfMemCache.get(n);return null!=l?Promise.resolve(l):this._loadOnce(this._gltfLoading,
this._gltfMemCache,n,u=>k.loadGLTF(new c.DefaultLoadingContext(u.streamDataRequester),f,u,e),g)}loadWOSR(f,g){const e=`wosr:${f}:${g.disableTextures}`,n=this._wosrMemCache.get(e);return null!=n?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,e,l=>m.load(f,l),g)}async _loadOnce(f,g,e,n,l){h.throwIfAborted(l);const u=h.onAbort(l,()=>this._abortLoad(f,e));var x=f.get(e);x?x.refCount++:(x=new AbortController,n=n({...l,signal:x.signal}),x={refCount:1,abortController:x,promise:n},
f.set(e,x));try{const w=await x.promise;g.put(e,w,w.size);f.delete(e);h.throwIfAborted(l);return w}finally{b.removeMaybe(u)}}_abortLoad(f,g){const e=f.get(g);null!=e&&0<--e.refCount||(f.delete(g),null!=e&&e.abortController.abort())}}a.ObjectResourceCache=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),
function(a,b,h,c,k,m){class d extends c.TextureCollection{constructor(f,g,e){super(g,e);this._streamDataRequester=f}async fromUrl(f,g,e){b.throwIfAborted(e);e=e?.signal;const n=this.makeUid(f,g);let l=this._textureRequests.get(n);if(!l){const u=new AbortController,x=this._streamDataRequester.request(f,"image",{uid:n,signal:u.signal});l=new c.TextureRequest;l.abortController=u;const w=l;this._textureRequests.set(n,l);l.textureAsync=x.then(async q=>{q=this._createTexture(f,q,g);w.texture=q;w.abortController=
null;await q.load(this._stage.renderView.renderingContext);this._stage.add(q);return new c.TextureResult(n,q,()=>this._release(n))},q=>{w.abortController=null;throw q;})}l.referenceCount++;try{return await b.whenOrAbort(l.textureAsync,e)}catch(u){throw this._release(n),u;}}_createTexture(f,g,e){const n={width:g.width,height:g.height,wrap:{s:m.TextureWrapMode.CLAMP_TO_EDGE,t:m.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(h.isSVG(f)){if(e||0===g.width&&0===g.height)f=g.width?
g.height/g.width:1,e=e||64,1<f?(g.width=Math.round(e/f),g.height=e):(g.width=e,g.height=Math.round(e*f));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new k.Texture(g,n)}}a.StreamTextureCollection=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g){a.TextureCollection=class extends h{constructor(l,u){super({});this._stage=l;this._textureRequests=new Map;this._frameTask=u?.registerTask(g.TaskPriority.TEXTURE_UNLOAD)??g.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();this._frameTask?.remove();this._textureRequests?.forEach(l=>this._releaseTextureRequest(l));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(l,u){const x=this.makeUid(l);l=this._textureRequests.get(x);
l||(l=new n,l.texture=u(),this._stage&&(l.texture.load(this._stage.renderView.renderingContext),this._stage.add(l.texture)),this._textureRequests.set(x,l));l.referenceCount++;return new e(x,l.texture,()=>this._release(x))}_release(l){const u=this._textureRequests.get(l);u?(1>u.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+l),u.referenceCount--,1>u.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(l))):console.warn(`TextureCollection: texture doesn't exist: '${l}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(l){if(this._textureRequests){var u=
this._textureRequests.get(l);!u||0<u.referenceCount||(u.texture?.unload(),this._releaseTextureRequest(u),this._textureRequests.delete(l))}}_releaseTextureRequest(l){l.texture?this._stage?.remove(l.texture):l.abortController&&(l.abortController.abort(),l.abortController=null)}makeUid(l,u=null){return null!=u?`${l}.${u}px`:l}};b.__decorate([c.property()],a.TextureCollection.prototype,"_frameTask",void 0);b.__decorate([c.property()],a.TextureCollection.prototype,"updating",null);a.TextureCollection=
b.__decorate([f.subclass("esri.views.3d.support.TextureCollection")],a.TextureCollection);class e{constructor(l,u,x){this.uid=l;this.texture=u;this.release=x}}class n{constructor(){this.referenceCount=0}}a.TextureRequest=n;a.TextureResult=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F){a.PointsOfInterest=class extends h{constructor(z){super(z);this.renderPointOfView=n.create();this._pois=[];this._debugCenters=new Map;this._tmpRay=l.create();this._centerRayDirty=!0;this._surfaceAltitudeAtCenter=0;this._surfaceAltitudeAtCenterDirty=!0;this._contentAltitudeAtCenter=0;this._contentAltitudeAtCenterDirty=!0;this._propertiesPool=new w.PropertiesPool({renderPointOfView:G},this)}initialize(){const {state:z,basemapTerrain:J,renderCoordsHelper:K,
map:I}=this.view;this._surfaceIntersector=E.newIntersector(z.viewingMode);this._surfaceIntersector.options.backfacesTerrain=z.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=A.StoreResults.MIN;this._contentIntersector=E.newIntersector(z.viewingMode);var M=()=>this._estimateSurfaceAltitudeAtCenter();const S=this.view.resourceController.scheduler,N=this.view.basemapTerrain?.elevationQueryCache,V={state:z,scheduler:S,surface:J,renderCoordsHelper:K};
this._set("centerOnSurfaceInfrequent",new p.CenterOnSurface({...V,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:M}));this._set("centerOnSurfaceFrequent",new p.CenterOnSurface({...V,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:M}));this._set("centerOnContent",new p.CenterOnSurface({...V,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",
new v.CameraOnSurface({...V,cache:N,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:I}));this._set("surfaceGeometryUpdates",new D.SurfaceGeometryUpdates({...V,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new t.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:K}));this._set("surfaceOrigin",new y.StableSurfaceCenter({cache:N,view:this.view}));this._set("focus",new r.Focus({state:z,
scheduler:S,surface:J,renderCoordsHelper:K,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(Q,T)=>this._estimateSurfaceIntersectionAtRenderPoint(Q,this.view.state.contentCamera,T)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);M=this.view.graphics;this._debugCenters.set(this.centerOnContent,new x.PointGraphics(M,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,
new x.PointGraphics(M,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new x.PointGraphics(M,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(M,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new x.PointGraphics(M,"green","Focus"));this.addHandles([c.watch(()=>z.contentCamera,Q=>this._cameraChanged(Q),c.sync),c.watch(()=>J.extent,()=>this._updateCenterPointsOfInterest()),c.when(()=>!J.updating,()=>this._updateCenterPointsOfInterest(),
c.sync),c.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),c.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),c.when(()=>u.debugFlags.SHOW_POI,Q=>this._setDebug(Q),c.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const Q of this._pois)Q.runTask()}destroy(){this._setDebug(!1);this._propertiesPool.destroy();for(const z of this._pois)z.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&
!this._pois.some(z=>z.updating))}get _centerRay(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const z=this._centerRay;if(null==z)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(z,
this._contentIntersector,H,C)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const z=this._centerRay;if(null==z)return this._surfaceAltitudeAtCenter;const J=z.origin,K=e.add(H,z.origin,
z.direction);this._surfaceIntersector.resetWithRay(z,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,J,K);this._surfaceIntersector.results.min.getIntersectionPoint(H)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H));return this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(z,J,K){z=q.fromRenderAtEye(J,z,L);if(null==z)return null;const I=z.origin,M=e.add(H,z.origin,z.direction);this._surfaceIntersector.resetWithRay(z,
J);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,I,M);return this._surfaceIntersector.results.min.getIntersectionPoint(K)?K:null}_cameraChanged(z){this._updateCenterPointsOfInterest();z=z.eye;e.exactEquals(this.renderPointOfView,z)||this._set("renderPointOfView",e.copy(this._propertiesPool.get("renderPointOfView"),z))}_updateCenterPointsOfInterest(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const z of this._pois)z.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=
!0;this.centerOnContent.updateRenderLocation()}_setDebug(z){if(z)for(const J of this._pois)this.addHandles(c.watch(()=>J.renderLocation,K=>this._debugCenters.get(J)?.show(K,J.renderCoordsHelper.spatialReference),c.initial),"debug");else this._debugCenters.forEach(J=>J.hide()),this.removeHandles("debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const z of this._pois)z.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};b.__decorate([k.property()],a.PointsOfInterest.prototype,
"centerOnContent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,
"surfaceOrigin",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);b.__decorate([k.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([g.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const G=Array,H=n.create(),
L=l.create(),C={exclude:new Set([B.terrainId])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/Collection ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),function(a,b,h,c,k,m,d,f,g){class e{constructor(n,l,u=""){this.graphics=n;this._symbol=new m({symbolLayers:new k([new d({material:{color:l},
outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new f({text:u,halo:{color:"white",size:1/.75},material:{color:l},size:12})])})}show(n,l){null!=l&&(this.hide(),n=new g({x:n[0],y:n[1],z:n[2],spatialReference:l}),this._graphic=new h({geometry:n,symbol:this._symbol}),this.graphics.add(this._graphic))}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)}}a.PointGraphics=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){const t=Array;a.CameraOnSurface=class extends v.PointOfInterest{constructor(y){super(y);this._dirty=!1;this._propertiesPool=new q.PropertiesPool({location:u,renderLocation:t},this);this._estimatedSurfaceAltitude=0;this._pendingElevationQueryController=null;this.renderLocation=l.create();this._tmpPoint=new u}initialize(){this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this));this.runTask();if(this.map){const y=()=>this._setDirty();
this.addHandles(k.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest();this._propertiesPool=h.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const y=this._propertiesPool.get("location");y.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y);return y}get scale(){const y=this._camera,D=n.distance(y.eye,
this.renderLocation);return w.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},D,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty();this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const y=this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&
this._dirty}runTask(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map?.ground)return this._updateSurfaceAltitude(0),p.Yield;var y=this.state.spatialReference;this._tmpPoint.spatialReference=y;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===x.ViewingMode.Global&&(y.isWGS84||y.isWebMercator);let D=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:D.signal,
cache:this.cache,minDemResolution:y?1E6:0}).then(E=>this._updateSurfaceAltitude(E.geometry.z??0)).catch(E=>{c.isAbortError(E)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===D&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));D=null});this._pendingElevationQueryController=D;return p.Yield}_updateSurfaceAltitude(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(r,
this._estimatedSurfaceAltitude,this._camera.eye);n.exactEquals(this._get("renderLocation"),r)||(this._set("renderLocation",n.copy(this._propertiesPool.get("renderLocation"),r)),this.notifyChange("renderLocation"))}};b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([m.property()],
a.CameraOnSurface.prototype,"location",null);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([m.property()],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([m.property()],a.CameraOnSurface.prototype,"scale",null);b.__decorate([m.property()],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const r=l.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d,f){a.PointOfInterest=class extends h{constructor(g){super(g)}};b.__decorate([c.property({constructOnly:!0})],
a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([c.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([c.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=b.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){const r=Array;a.CenterOnSurface=class extends p.PointOfInterest{constructor(A){super(A);this._propertiesPool=new v.PropertiesPool({location:u,renderLocation:r},this);this.distance=this._latestSurfaceAltitude=this._currentSurfaceAltitude=0;this.renderLocation=n.create();this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()}destroy(){this._frameWorker=c.removeMaybe(this._frameWorker);this._propertiesPool=
c.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const A=this._propertiesPool.get("location");A.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,A);return A}updateRenderLocation(){this.updating=!0;this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();
this._updateRenderLocation();this.updating=!1;return t.Yield}_updateRenderLocation(){const A=y;let B=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,A);var F=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!B&&F&&(B=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,A))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);F=D;B&&this._latestSurfaceAltitudeChangesDistanceSignificantly(A,F)&&(e.copy(A,F),this._currentSurfaceAltitude=this._latestSurfaceAltitude);
B?this.distance=e.distance(this._camera.eye,A):(e.scale(A,this._camera.viewForward,this._get("distance")),e.add(A,A,this._camera.eye));e.exactEquals(this._get("renderLocation"),A)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),A))}_calculateSurfaceIntersection(A,B){var F=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(F.ray,A,B))return!1;if(this.state.isGlobal){const G=l.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;A=G+A;
const H=e.squaredLength(F.eye),L=H<A*A,C=e.distance(F.eye,B);L&&C>G/4&&(e.scale(B,F.viewForward,A-Math.sqrt(H)),e.add(B,B,F.eye))}else F=this.surface?.ready?this.surface.extent:null,null!=F&&x.projectBoundingRect(F,this.surface?.spatialReference,E,this.renderCoordsHelper.spatialReference)&&(B[0]=h.clamp(B[0],E[0],E[2]),B[1]=h.clamp(B[1],E[1],E[3]));return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(A,B){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==A)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,
B)){if(q.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)return!0;const F=this._camera.eye;A=e.distance(F,A);B=e.distance(F,B);if(.05<Math.abs(B-A)/A)return!0}return!1}};b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",
void 0);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([g.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const y=n.create(),D=n.create(),E=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports",
"../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,h,c){class k{constructor(d){this._handles=new h;this.events=new b;this._contentLayerViews=d.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",f=>this._layerViewsChanged(f)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=c.destroyMaybe(this._handles);this._contentLayerViews.destroy()}_layerViewsChanged(d){d.added.forEach(f=>
{"esri.views.3d.layers.SceneLayerView3D"===f.declaredClass&&this._handles.add(f.on("visible-geometry-changed",()=>this._contentChanged()),f.uid)});d.removed.forEach(f=>this._handles.remove(f.uid))}_contentChanged(){this.events.emit("request-update",m)}}const m={};a.ContentGeometryUpdates=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){const y=Array;a.Focus=class extends v.PointOfInterest{constructor(B){super(B);this._propertiesPool=new q.PropertiesPool({location:x,renderLocation:y},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([k.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),k.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(t.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=c.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const B=this._propertiesPool.get("location");B.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,B);return B}get worldUnitsPerContentPixel(){const {camera:B,contentPixelRatio:F}=this.state;return B.computeRenderPixelSizeAt(this.renderLocation)*(B.pixelRatio/F)}get running(){return this._dirty}runTask(){var B=
this._get("renderLocation");const F=this.centerOnSurface.renderLocation;var G=this.renderCoordsHelper,H=this.state.contentCamera;this._dirty=!1;G.worldUpAtPosition(F,D);G=Math.max(0,(Math.acos(l.dot(D,H.viewForward))-.5*Math.PI)*(H.aboveGround?1:-1));if(Number.isNaN(G))return B&&l.equals(B,F)||(B=this._propertiesPool.get("renderLocation"),l.copy(B,F),this._set("renderLocation",B)),r.Yield;G=1-h.clamp(G/(.5*Math.PI),0,1);G*=G*G;this._calculateScreenHorizontalEdgeOnSurface(A);H=this._propertiesPool.get("renderLocation");
l.lerp(H,F,A,G);B&&l.equals(B,H)||this._set("renderLocation",H);return r.Yield}_calculateScreenHorizontalEdgeOnSurface(B){const F=this.state.contentCamera;var G=F.getRenderCenter(m.createRenderScreenPointArray3());G[1]=F.aboveGround?F.padding[p.PaddingSide.BOTTOM]:F.fullHeight-F.padding[p.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(G,B))return B;const H=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return F.unprojectFromRenderScreen(G,E)&&(l.subtract(E,
E,F.eye),G=l.normalize(E,E),this.renderCoordsHelper.intersectInfiniteManifold(w.wrap(F.eye,G),H,B))?B:this.renderCoordsHelper.setAltitude(B,H,F.eye)}updateRenderLocation(){this._dirty=!0}};b.__decorate([d.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);b.__decorate([d.property()],a.Focus.prototype,"updating",null);b.__decorate([d.property()],a.Focus.prototype,"location",null);b.__decorate([d.property()],a.Focus.prototype,"renderLocation",void 0);b.__decorate([d.property()],a.Focus.prototype,"worldUnitsPerContentPixel",null);a.Focus=b.__decorate([n.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const D=u.create(),E=u.create(),A=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){a.StableSurfaceCenter=class extends h{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const x=n.create();this.view.renderCoordsHelper.toRenderCoords(this.location,x);return x}constructor(x){super(x);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([k.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],
()=>this._update()),k.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var x=u.center(this.surfaceView.extent);x=new l({x:x[0],y:x[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=
new AbortController,this.surface.queryElevation(x,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(w=>{this._updateController=null;this._set("location",w.geometry)}).catch(w=>{c.isAbortError(w)||w&&"elevation-query:invalid-layer"===w.name||console.error("StableSurfaceCenter failed to update: ",w)})):this._set("location",x)}}};b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,
"cache",void 0);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surface",null);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){a.SurfaceGeometryUpdates=class extends h{constructor(p){super(p);this._tileGeometryUpdateExtent=n.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new c;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",p=>this._tileGeometryChanged(p)),this.scheduler.registerTask(l.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return u.Yield;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",x);n.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return u.Yield}_tileGeometryChanged(p){this._tileGeometryUpdateSpatialReference=p.spatialReference;n.expand(this._tileGeometryUpdateExtent,p.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let p=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=
this.centerOnSurfaces[t];r.distance>p.distance&&(p=r)}return p}_centerIntersectsExtent(p,t){const r=this.state.contentCamera.eye,y=v,D=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(r,w,t);this.renderCoordsHelper.fromRenderCoords(D.renderLocation,q,t);w[0]<q[0]?(y[0]=w[0],y[2]=q[0]):(y[0]=q[0],y[2]=w[0]);w[1]<q[1]?(y[1]=w[1],y[3]=q[1]):(y[1]=q[1],y[3]=w[1]);return n.intersects(y,p)}};b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",
void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([k.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,
"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([g.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const x={},w=e.create(),q=e.create(),v=n.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/SpatialReference ../../../geometry/projection/projectors ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../chunks/sphere ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/ElevationRange ../support/ElevationUpdateEvent ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja,oa,ra,ta,ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La,Na){function Wa(xa,Ha,na){for(const za of xa)if(za.containsPointXY(Ha,na)){for(xa=za;xa&&!xa.renderData;)xa=xa.children[(Ha>xa.extentMidX?1:0)+(na<xa.extentMidY?2:0)];return X.sampleElevation(Ha,na,xa?.renderData?.geometryState.samplerData??null)}return null}function Ia(xa,Ha){!xa.isLeaf||xa.level<ja.maxTileNeighborLevelDelta||
Va(xa,na=>{Ha&&Oa(na);var za=0===na.maxLevelDeltaNeighborCount&&0===na.unmergableChildCount;na.maxLevelDeltaNeighborCount++;if(za)for(na=na.parent;na;)if(za=0===na.maxLevelDeltaNeighborCount&&0===na.unmergableChildCount,na.unmergableChildCount++,za)na=na.parent;else break})}function Oa(xa){if(!xa.hasPendingUpdate(pa.TileUpdate.SPLIT)){for(var Ha=xa.parent;Ha&&Ha.resetPendingUpdate(pa.TileUpdate.MERGE);)Ha=Ha.parent;xa.resetPendingUpdate(pa.TileUpdate.MERGE);xa.isLeaf&&xa.setPendingUpdate(pa.TileUpdate.SPLIT);
xa.level<ja.maxTileNeighborLevelDelta||Va(xa,na=>{Oa(na)})}}function Ua(xa){xa.level<ja.maxTileNeighborLevelDelta||Va(xa,Ha=>{Ha.maxLevelDeltaNeighborCount--;if(0===Ha.maxLevelDeltaNeighborCount&&0===Ha.unmergableChildCount)for(Ha=Ha.parent;Ha;)if(Ha.unmergableChildCount--,0===Ha.maxLevelDeltaNeighborCount&&0===Ha.unmergableChildCount)Ha=Ha.parent;else break})}function Va(xa,Ha){if(!(xa.level<ja.maxTileNeighborLevelDelta)){var na=xa.level-ja.maxTileNeighborLevelDelta,za=xa.lij[1]>>ja.maxTileNeighborLevelDelta,
Da=xa.lij[2]>>ja.maxTileNeighborLevelDelta,Ma=Xa=>Xa.isLeaf||Xa.level===na;for(let Xa=0;4>Xa;++Xa){const ab=xa.findNeighborTile(ta.neighborEdgeIndices[Xa],Ma);if(!ab||ab.level!==na)continue;const Ja=ab.lij;Ja[1]===za&&Ja[2]===Da||Ha(ab)}}}var Ra;c=Ra=class extends d.EventedMixin(c){constructor(xa){super(xa);this._scaleRangeQueries=new ca.ScaleRangeQueries;this._iteratorPool=new l(wa.IteratorPreorder,Ha=>Ha.remove=()=>this._iteratorPool.release(Ha));this._postorderIterator=new wa.IteratorPostorder;
this._hasPendingUpdates=!1;this._asyncWorkItems=this._pendingUpdates=0;this._allTilesSorted=this._allTilesDirty=!0;this._usedMemory=null;this._performanceInfo=new ra;this._viewChangeUpdateDirty=this._inFrameTask=this._viewChanged=!1;this._eyePosRenderSR=D.create();this._eyePosSurfaceSR=D.create();this._splitLimits=new Y.SplitLimits;this._frustum=C.create();this._viewProjectionMatrix=r.create();this._layerViews=[[],[]];this._layerIndexByUid=[new Map,new Map];this._basemapLayerViewHandles=new Map;this._watchUpdatingTracking=
new E.UpdatingHandles;this._frameTask=La.ImmediateTask;this._allTiles=new u;this._upsampleInfoPool=new l(la.UpsampleInfo);this._shouldEmitChangeEvent=!1;this._rootTilesExtent=L.create();this.updatingProgress=.5;this._maxNumUpdating=1;this.maxTextureScale=1.2;this._spatialReference=B.WebMercator;this._elevationProjectorCache=new Map;this.visibleElevationBounds=new ba.ElevationBounds(Infinity,-Infinity);this.rootTileElevationBounds=new ba.ElevationBounds(Infinity,-Infinity);this._sebProjectorMap=new Map;
this._sebProjectorCache=F.createEmptyProjectorCache();this._tilingSchemeSpatialReference=null;this._updatingRootTiles=!1;this._pendingTilesForElevationUpdateEvent=new Set;this._pendingTilesToUpdate=new Set;this.totalTileUpdates=this.totalGeometryUpdates=0;this._oneBatchPerFrameTask=!0;this._layerViewsDirty=!1;this.unloadedMemory=0;this._isWebMercatorOnPlateCarree=this._isWebMercator=this.ignoresMemoryFactor=!1;this.overlayManager=new aa.OverlayManager({...xa,surface:this});this._isGlobal=!xa.view?.state?.isLocal;
this._isGeographic=this._spatialReference?.isGeographic??!1;this._tileConstructor=this._isGlobal?W.SphericalPatch:Z.PlanarPatch}initialize(){const xa=this.view,Ha=xa.resourceController;this._lercDecoder=N.acquireDecoder(Ha);const na=Ha.memoryController;this._tileCache=new n.MemCachePool((Xa,ab)=>na.newCache(Xa,ab),"terrain-tile");this._upsampleMapCache=na.newCache("terrain-upsample",Xa=>Xa.unloadMapData());this._elevationQueryCache=new I.ElevationQueryTileCache(na.newCache("elevation-query"));const za=
this.overlayManager;this._renderer=new oa.TerrainRenderer(za.renderer,xa._stage,this._allTiles,A.getReferenceEllipsoid(xa.spatialReference).radius,na);this.addHandles([w.watch(()=>za.renderer.isEmpty,()=>this._evaluateTransparency()),w.watch(()=>this.renderer.visible,Xa=>this.suspended=!Xa)],"overlayManager");this.addHandles([w.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?ha.TextureUpdate.UNFADED:ha.TextureUpdate.IMMEDIATE)},
w.syncAndInitial),w.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ha.TextureUpdate.UNFADED:ha.TextureUpdate.IMMEDIATE),w.syncAndInitial),w.watch(()=>this.backgroundColor,(Xa,ab)=>{Xa?.equals(ab)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(Xa))},w.sync),w.watch(()=>this.snapLevel,()=>this._viewChanged=!0,w.sync),w.watch(()=>this.view.pointsOfInterest,Xa=>{this._renderer.pointsOfInterest=Xa;this._watchUpdatingTracking.removeAll();
Xa&&this._watchUpdatingTracking.add(()=>Xa.focus.renderLocation,()=>this._allTilesSorted=!1)}),w.watch(()=>T.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES,Xa=>{Xa&&!this._treeDebugger?(new Promise((ab,Ja)=>a(["../layers/support/TerrainTileTree3DDebugger"],ab,Ja))).then(({TerrainTileTree3DDebugger:ab})=>{!this._treeDebugger&&T.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new ab({view:xa}))}):Xa||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},w.initial)]);var {spatialReference:Da}=
xa;this._extentHelper=da.create(this.viewingMode,{layers:xa.map.allLayers,layerViews:xa.allLayerViews,viewSpatialReference:Da});const Ma=new m({getCollections:()=>xa.defaultsFromMap?.mapCollections?.map(({layers:Xa})=>Xa),getChildrenFunction:Xa=>Xa&&"layers"in Xa?Xa.layers:null});Da=new Ba.TilingSchemeLogic({layers:Ma,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Da});this._set("tilingSchemeLogic",Da);this._updateTilingScheme();this._elevationDataRequester=Ha.createStreamDataRequester(P.ClientType.ELEVATION);
this._mapDataRequester=Ha.createStreamDataRequester(P.ClientType.BASEMAP);this._frameTask=Ha.scheduler.registerTask(La.TaskPriority.TERRAIN_SURFACE,this);this.addHandles([w.watch(()=>this._extentHelper.stencilEnabledExtents,Xa=>this._renderer.setStencilEnabledLayerExtents(Xa),w.initial),w.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),w.sync),w.watch(()=>this.extent,()=>this._updateRootTiles(),w.initial),xa.on("resize",()=>this._viewChangeUpdate()),w.watch(()=>{const Xa=
xa.state;return[this._lodBias,this.lodSnapping,xa.quality,Xa.camera,Xa.contentCamera,Xa.fixedContentCamera]},()=>this._viewChangeUpdate(),w.syncAndInitial),w.watch(()=>xa.qualitySettings?.fadeDuration,Xa=>this._renderer.textureFadingEnabled=0<Xa,w.initial),w.watch(()=>xa.qualitySettings?.physicallyBasedRenderingEnabled,Xa=>this._renderer.pbrMode=Xa?ua.PBRMode.Simplified:ua.PBRMode.Disabled,w.initial),w.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),w.sync)]);this.addHandles(xa.allLayerViews.on("after-changes",
()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove();this._watchUpdatingTracking.destroy();this._lercDecoder=e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((xa,Ha)=>this._unregisterTiledLayerView(Ha));this._mapDataRequester=this._elevationDataRequester=null;
this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tileCache=e.destroyMaybe(this._tileCache);ya.Tile.prune();this._treeDebugger=e.destroyMaybe(this._treeDebugger);this._renderer=e.destroyMaybe(this._renderer);this._iteratorPool=e.destroyMaybe(this._iteratorPool);this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("view",null);this._extentHelper=e.destroyMaybe(this._extentHelper);this._upsampleInfoPool=
e.destroyMaybe(this._upsampleInfoPool);V.printAllocations();Ca.printAllocations()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===ha.LODSnapping.ON){var xa=this.view,Ha=this.tilingScheme;const za=xa.pointsOfInterest?.cameraOnSurface?.scale;if(Ha&&za){var na=xa.state.contentCamera;na=Q.directionToHeadingTilt(xa,na.eye,na.viewForward,na.up).tilt;90<na&&(na=180-na);na=2*(na/90)**2;Ha=Ha.levelAtScale(za);xa=Math.min(Ha-na+xa.qualitySettings.tiledSurface.lodBias,
this._splitLimits.maxLod||Infinity);return 0>=xa?null:xa}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?ha.LODSnapping.ON:ha.LODSnapping.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){var {spatialReference:xa}=this,{clippingArea:Ha}=this.view;
if(null==Ha||null==xa)return null;const na=L.create();xa=U.toBoundingRect(Ha,na,xa)?na:null;Ha=this._get("extent");return L.equals(xa,Ha)?Ha:xa}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const xa=L.intersection(this.groundExtent,this._userClippingExtent,L.create()),Ha=this._get("extent");return L.equals(xa,Ha)?Ha:xa}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-
this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(xa){this.view.map.ground.opacity=xa}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(xa){this._renderer.renderOrder=xa;this._set("renderOrder",xa)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(xa){this.view.map.ground.surfaceColor=
xa}set slicePlaneEnabled(xa){this._renderer.slicePlaneEnabled=xa;this._set("slicePlaneEnabled",xa);this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(xa){xa!==this._renderer.wireframe&&(this._renderer.wireframe=xa,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===oa.TransparencyMode.Opaque}set suspended(xa){this._set("suspended",xa);this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??
0}intersect(xa,Ha,na,za){this._renderer.intersect(xa,Ha,na,za)}getElevation(xa,Ha,na,za){const Da=this._rootTiles;if(!Da?.length||0===Da[0].layerInfo[fa.LayerClass.ELEVATION].length)return null;let Ma=this._elevationProjectorCache.get(za);void 0===Ma&&(Ma=F.getProjector(za,this._spatialReference)??null,this._elevationProjectorCache.set(za,Ma));if(null==Ma)return f.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;xa=y.set(bb,
xa,Ha,na);Ma(xa,0,xa,0);return Wa(Da,xa[0],xa[1])}getElevations(xa,Ha,na){const za=this._rootTiles;var Da=za?za[0].layerInfo[fa.LayerClass.ELEVATION].length:0;if(za?.length&&0!==Da)for(Da=0;Da<Ha;++Da){var Ma=3*Da;Ma=Wa(za,xa[Ma],xa[Ma+1]);na(Da,Ma)}else for(xa=0;xa<Ha;++xa)na(xa,null)}getScale(xa){if(!this.tilingScheme)return null;if(!G.projectPointToVector(xa,bb,this.spatialReference))return f.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),
null;xa=this._rootTiles;if(null!=xa)for(var Ha of xa)if(Ha?.containsPoint(bb)){for(;Ha.children[0]&&!Ha.rendered;){xa=Ha.children[0].extent;let na=0;bb[0]>xa[2]&&(na+=1);bb[1]<xa[1]&&(na+=2);Ha=Ha.children[na]}return this._getLodBiasCorrectedScale(Ha.level)}return Infinity}_ensureSEBProject(xa){var Ha=this._sebProjectorMap.get(xa);if(Ha)return Ha;Ha=F.getProjector(xa,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;this._sebProjectorMap.set(xa,Ha);return Ha}getSphereElevationBounds(xa,
Ha){Ha=this._ensureSEBProject(Ha);if(null==Ha)return f.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;J.copy(xa,gb);xa=J.getCenter(gb);Ha(xa,0,xa,0);const na=new ia.ElevationRange,za=Da=>{if(Da&&L.intersectsSphere(Da.extent,gb))if(Da.isLeaf||Da.rendered)na.expandElevationRangeValues(Da.elevationBounds[0],Da.elevationBounds[1]);else for(const Ma of Da.children)za(Ma)};xa=this._rootTiles;if(null!=xa)for(const Da of xa)za(Da);
return na}getRootElevationBounds(){return new ia.ElevationRange(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(xa,Ha){if(!this.tilingScheme)return null;if(!G.projectPointToVector(xa,J.getCenter(gb),this.spatialReference))return f.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;gb[3]=Ha;let na=null;const za=Da=>{if(Da&&L.intersectsSphere(Da.extent,gb)){const Ma=Da.children;if(Ma[0]&&!Da.rendered)for(const Xa of Ma)za(Xa);
else Da=this._getLodBiasCorrectedScale(Da.level),na=null==na?Da:Math.min(na,Da)}};xa=this._rootTiles;if(null!=xa)for(const Da of xa)za(Da);return na}queryVisibleScaleRange(xa,Ha,na,za){Ha=Ha?this.tilingScheme.levelAtScale(Ha):0;na=na?this.tilingScheme.levelAtScale(na):Infinity;const Da=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(xa,Ha+Da,na+Da,za)}_evaluateTransparency(){var xa=this.baseOpacity;const Ha=this.overlayManager.renderer.isEmpty;var na=this._renderer.transparency;xa=this._allSurfaceLayersTransparent()?
Ha?oa.TransparencyMode.Empty:oa.TransparencyMode.TransparentWithDraped:1<=xa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?oa.TransparencyMode.Opaque:oa.TransparencyMode.Semitransparent;if(na=na!==xa)this._renderer.transparency=xa,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});return na}_updateTilingScheme(){const xa=this.tilingSchemeLogic.tilingScheme;if(xa!==this.tilingScheme){ta.weakAssert(!!xa,"tiling scheme cannot be reset to undefined");
this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var Ha=xa?.spatialReference??B.WebMercator;this._spatialReference=Ha;this._isWebMercatorOnPlateCarree=(this._isWebMercator=!!Ha?.isWebMercator)&&z.isPlateCarree(this.view?.renderSpatialReference);this._isGeographic=Ha?.isGeographic??!1;this._set("tilingScheme",xa);this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference;this._sebProjectorMap.clear();this._updateClippingExtent();xa&&(this._updateTiledLayers(),
this._renderer.setTileSize(xa.pixelSize),this.overlayManager.setSpatialReference(xa.spatialReference),this._updateRootTiles())}}_acquireTile(xa,Ha,na,za){const Da=this._tileCache.pop(Ra._tileMemcacheKey);return Da?(Da.init(xa,Ha,na,za,this),Da):new this._tileConstructor(xa,Ha,na,za,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const {extent:xa,tilingScheme:Ha}=this;if(Ha){var na=db,za=Ha.rootTilesInExtent(xa,na,5*ja.maxRootTiles);if(null!=this._rootTiles){if(za.length>
ja.maxRootTiles){f.getLogger(this).warn(ja.tooManyRootTilesAfterChangeError);return}const Da=this._rootTiles.map(Xa=>Xa.lij),Ma=k.difference(Da,za,ya.lijEquals);this._updatingRootTiles=!0;if(0<Ma.removed.length||0<Ma.added.length){const Xa=this._rootTiles.filter(ab=>-1<Ma.removed.findIndex(Ja=>ya.lijEquals(Ja,ab.lij))?(this._purgeTile(ab),!1):!0);Ma.added.forEach(ab=>Xa.push(this._newRootTile(ab)));this._setRootTiles(Xa)}}else this._updatingRootTiles=!0,za.length>ja.maxRootTiles&&(f.getLogger(this).warn(ja.tooManyRootTilesForLayerError),
za=Ha.rootTilesInExtent(xa,na,ja.maxRootTiles)),this._setRootTiles(za.map(Da=>this._newRootTile(Da)));L.equals(na,this._rootTilesExtent)||(this._rootTilesExtent=L.create(na));this.renderer.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}}_updateAllTileGeometries(){const xa=this._allTiles.filter(Ha=>Ha.isLoaded&&Ha.intersectsClippingArea);xa.forEach(Ha=>
this._renderer.updateTileGeometryState(Ha));xa.forEach(Ha=>Ha.renderData.updateNeighborData());this._updateTilesGeometries(xa);this._pendingTilesToUpdate.clear()}_updateTilesGeometries(xa){if(0!==xa.length){xa.sort(wa.compareTilesByLij);var Ha=this.renderer;xa.forEach(na=>Ha.updateGeometryIfNeeded(na));xa.forEach(na=>this._pendingTilesForElevationUpdateEvent.add(na))}}_shouldSplit(xa){return xa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===pa.TileUpdate.SPLIT}_newRootTile(xa){xa=
this._acquireTile(0,xa[1],xa[2],null);this._shouldSplit(xa)&&xa.setPendingUpdate(pa.TileUpdate.SPLIT);this._loadTile(xa);this._markTileToUpdate(xa);this._updateRootTileElevationBounds();return xa}_setRootTiles(xa){this._rootTiles=xa;this._allTiles.clear();if(null!=xa){const Ha=this._iteratorPool.acquire();for(Ha.reset(xa);!Ha.done;)this._allTiles.push(Ha.next());Ha.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(xa)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&
(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(xa){xa.updateClippingStatus(this.extent)&&xa.resetPendingUpdate(pa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(xa)}_updateTilesVisibility(xa){if(null!=xa){var Ha=
wa.hasLoadableSiblings(xa),na=this.visibleElevationBounds,za=Ha?na.min:Infinity;Ha=Ha?na.max:-Infinity;var Da=this.extent,Ma=this._viewProjectionMatrix;this.setTileTreeDirty();var Xa=this._iteratorPool.acquire();for(Xa.reset(xa);!Xa.done;)xa=Xa.next(),xa.updateClippingStatus(Da)&&xa.resetPendingUpdate(pa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(xa),xa.computeVisibility(),xa.updateScreenDepth(Ma),xa.renderData&&(xa=xa.elevationBounds,za=Math.min(xa[0],za),Ha=Math.max(xa[1],Ha));Xa.remove();
this._allTilesDirty=this._viewChanged=!0;this._updatePendingTileGeometries();isFinite(za)&&isFinite(Ha)&&(na.min!==za||na.max!==Ha)&&(this.visibleElevationBounds=new ba.ElevationBounds(za,Ha))}}_updateRootTileElevationBounds(){let xa=Infinity,Ha=-Infinity;var na=this._rootTiles;null!=na&&na.forEach(({elevationBounds:za})=>{xa=Math.min(xa,za[0]);Ha=Math.max(Ha,za[1])});na=this.rootTileElevationBounds;if(na.min!==xa||na.max!==Ha)this.rootTileElevationBounds=new ba.ElevationBounds(xa,Ha)}_updateViewDependentParameters(){const {camera:xa,
contentCamera:Ha}=this.view.state,na=Math.tan(.5*Ha.fovX),za=Math.tan(.5*Ha.fovY),Da=this.tilingScheme.pixelSize,Ma=2**-this._lodBias*xa.pixelRatio;this._splitLimits.aboveGround=xa.aboveGround;this._splitLimits.fovX=na;this._splitLimits.fovY=za;this._splitLimits.relativeWidthLimit=Da/xa.width*this.maxTextureScale*Ma;this._splitLimits.relativeHeightLimit=Da/xa.height*this.maxTextureScale*Ma;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;
this._splitLimits.frustum=this.view.state.fixedContentCamera?C.copy(this._splitLimits.frustum??C.create(),Ha.frustum):null;C.copy(this._frustum,xa.frustum);t.multiply(this._viewProjectionMatrix,Ha.projectionMatrix,Ha.viewMatrix);y.copy(this._eyePosRenderSR,Ha.eye);H.projectVectorToVector(xa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(xa){xa.updateVisibility();this._renderer.updateTileGeometryState(xa)&&this._markTileToUpdate(xa);this._usedMemory=
null}_markAllTileNeighborsForUpdate(xa){xa.forEachLoadedNeighbor(Ha=>{this._layerViews[fa.LayerClass.MAP].some(ta.isVectorTileLayerView)&&Ha.setPendingUpdate(pa.TileUpdate.TEXTURE_FADING);this._pendingTilesToUpdate.add(Ha)})}_updateTileTexture(xa,Ha){const na=xa.resetPendingUpdate(pa.TileUpdate.TEXTURE_FADING)?pa.TileUpdate.TEXTURE_FADING:xa.resetPendingUpdate(pa.TileUpdate.TEXTURE_NOFADING)?pa.TileUpdate.TEXTURE_NOFADING:!1;na&&(this._renderer.updateTileTexture(xa,na),this._usedMemory=null,Ha.madeProgress())}_emitElevationUpdateEventForTiles(){if(this._shouldEmitChangeEvent){var xa=
mb.extent;L.empty(xa);this._pendingTilesForElevationUpdateEvent.forEach(Ha=>L.expand(xa,Ha.extent,xa));this._pendingTilesForElevationUpdateEvent.clear();mb.spatialReference=this.spatialReference;this.emit("elevation-change",mb);this._shouldEmitChangeEvent=!1}}runTask(xa){this._handleLayerViewChanges(xa);this._frameTask.processQueue(xa);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,xa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(xa);
this._sortTiles(xa);const Ha=!this.view.state.fixedContentCamera;this._mergeAndSplit(xa,Ha);this._updateElevation(xa);this._updateTextures(xa);Ha||this._mergeAndSplit(xa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._updatePendingTileGeometries();this._emitElevationUpdateEventForTiles();xa.done&&xa.hasProgressed&&this.requestUpdate();this.notifyChange("updatingProgressValue");ta.enableTerrainInternalChecks&&this._checkTileInvariant();if(!xa.hasProgressed)return Na.Yield}_checkTileInvariant(){const xa=
new Map;this._allTiles.forAll(Ha=>xa.set(Ha,new Set));this._allTiles.forAll(Ha=>{ta.weakAssert(Ha.rendered===Ha.isLeaf,` rendered ${Ha.rendered} != ${Ha.isLeaf} leaf`);if(!Ha.isLeaf){var na=Ha.children.reduce((Ma,Xa)=>Ma+(0===Xa.unmergableChildCount&&0===Xa.maxLevelDeltaNeighborCount?0:1),0);ta.weakAssert(Ha.unmergableChildCount===na,` Tile[${Ha.lij.toString()}] unmergeable child count mismatch:`+` actual ${Ha.unmergableChildCount} vs ${na}`);if(Ha.hasPendingUpdate(pa.TileUpdate.MERGE)){ta.weakAssert(!Ha.hasPendingUpdate(pa.TileUpdate.SPLIT),
"Tile can be both split and merge at the same time");for(var za of Ha.children)ta.weakAssert(za.isLeaf||za.hasPendingUpdate(pa.TileUpdate.MERGE),"Child of tile to merge must also merge")}}for(na=0;4>na;++na){if(Ha.rendered&&(za=Ha.renderData?.geometryState.edgePeerNeighbors[na],null!=za)){var Da=Ha.level-za.level<=ja.maxTileNeighborLevelDelta;Da||(console.log(`tile level delta [${Ha.lij.toString()}] vs [${za.lij.toString()}] > ${ja.maxTileNeighborLevelDelta}  (edge[${na}])`),ta.weakAssert(Da,`tile level delta [${Ha.level}] vs [${za.level}] > ${ja.maxTileNeighborLevelDelta}`));
ta.weakAssert(Ha.level-za.level<=ja.maxTileNeighborLevelDelta,`Max tile lod delta exceeded: [${Ha.lij.toString()}] vs [${za.lij.toString()}]`)}Da=Ha.level-ja.maxTileNeighborLevelDelta;za=Ha.findNeighborTile(ta.neighborEdgeIndices[na],Ma=>Ma.isLeaf||Ma.level===Ha.level);if(null!=za){if(Ha.isLeaf&&Ha.level>=ja.maxTileNeighborLevelDelta){let Ma=za;for(;Ha.level-Ma.level<ja.maxTileNeighborLevelDelta;)Ma=Ma.parent;ya.lijEquals([Da,Ha.lij[1]>>ja.maxTileNeighborLevelDelta,Ha.lij[2]>>ja.maxTileNeighborLevelDelta],
Ma.lij)||(Da=xa.get(Ma),ta.weakAssert(!Da.has(Ha),"Cannot already have neighbor"),Da.add(Ha))}ta.weakAssert(za.rendered||za.level===Ha.level,"Non-same-level-neighbor of rendered must be rendered");ta.weakAssert(Ha.level-za.level<=ja.maxTileNeighborLevelDelta,`Tile level delta [${Ha.level}] vs [${za.level}] > ${ja.maxTileNeighborLevelDelta}`)}}});this._allTiles.forAll(Ha=>{const na=Ha.maxLevelDeltaNeighborCount,za=xa.get(Ha);ta.weakAssert(na===za.size,`Tile[${Ha.lij.toString()}] merge-blocker mismatch: actual ${na} vs ${za.size}`)})}_updateAllTilesStatus(xa){if(this._viewChanged&&
this._rootTiles&&!xa.done){this._viewChanged=!1;var Ha=new tb(this._allTiles.length);Ha.pushAll(this._rootTiles);var na=this.snapLevel,za=this._splitLimits,Da=this._eyePosRenderSR;this._allTiles.forAll(ab=>{ab.maxLevelDeltaNeighborCount=0;ab.unmergableChildCount=0});for(var Ma=this._viewProjectionMatrix;!Ha.empty;){const ab=Ha.pop();var Xa=ab.parent;const Ja=(Xa=null!=Xa&&Xa.hasPendingUpdate(pa.TileUpdate.MERGE))?pa.TileUpdate.MERGE:ab.shouldSplit(za,Da,na),Qa=Ja===pa.TileUpdate.SPLIT;ab.isLeaf?Ia(ab,
Qa):Ha.pushAll(ab.children);Xa?(ab.resetPendingUpdate(pa.TileUpdate.SPLIT),ab.isLeaf||ab.setPendingUpdate(pa.TileUpdate.MERGE),this._updateClippingStatus(ab),ab.updateVisibility(),ab.updateScreenDepth(Ma)):Qa?(ab.resetPendingUpdate(pa.TileUpdate.MERGE),ab.isLeaf&&ab.setPendingUpdate(pa.TileUpdate.SPLIT)):(ab.resetPendingUpdate(pa.TileUpdate.SPLIT)&&ab.updateAgentSuspension(),Ja===pa.TileUpdate.ELEVATION&&ab.updateAgents(fa.LayerClass.ELEVATION),ab.isLeaf||(ab.setPendingUpdate(pa.TileUpdate.MERGE),
ab.resetPendingUpdate(pa.TileUpdate.SPLIT)))}this.requestUpdate();!this._shortBatches&&this._oneBatchPerFrameTask||this._updatePendingTileGeometries();xa.madeProgress()}}_sortTiles(xa){xa.done||this._allTilesSorted||(wa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),xa.madeProgress())}_markTileToUpdate(xa){ta.internalAssert(xa.isLoaded);xa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(xa),
this._markAllTileNeighborsForUpdate(xa))}_updatePendingTileGeometries(){const xa=this._pendingTilesToUpdate,Ha=Array.from(xa.keys()).filter(Da=>Da.isLoaded&&Da.intersectsClippingArea);if(0===Ha.length)xa.clear();else{var na=(Da,Ma)=>{!Ma?.isLoaded||!Ma.intersectsClippingArea||Ma.level<Da.level||xa.has(Ma)||(xa.add(Ma),Ha.push(Ma),Ma.renderData.updateNeighborData())};Ha.sort(wa.compareTilesByLij);var za=Ha.length;for(let Da=0;Da<za;++Da){const Ma=Ha[Da];ta.internalAssert(Ma.isLoaded);ta.internalAssert(Ma.intersectsClippingArea);
const Xa=Ma.renderData;Xa.updateNeighborData();const ab=Xa.dirtyEdgeResolutions,Ja=Xa.geometryState,Qa=Sa=>{const cb=ta.neighborCornerIndices[Sa];na(Ma,Ja.cornerPeerNeighbors[Sa]?.findCorner(ta.oppositeCorner(cb),eb=>eb.isLoaded))};for(let Sa=0;4>Sa;++Sa)if(ab&1<<Sa){const cb=Xa.geometryState.edgePeerNeighbors[Sa];cb&&cb?.level>=Ma.level&&cb.forAllSubtreeOnSide(ta.oppositeEdge(ta.neighborEdgeIndices[Sa]),eb=>eb.isLoaded&&eb.intersectsClippingArea?(ta.internalAssert(xa.has(eb)||0>wa.compareTilesByLij(Ma,
eb)),na(Ma,eb),!0):!1);Qa((Sa+1)%4);Qa(Sa)}}xa.clear();this._updateTilesGeometries(Ha);this._shouldEmitChangeEvent=!0;ta.enableTerrainInternalChecks&&ta.enableWaterproofnessTests&&this.checkAllTilesWaterproofness()}}_mergeAndSplit(xa,Ha){if(!this.suspended&&!xa.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var na=!1,za=this.view.state.fixedContentCamera,Da=!1;!xa.done;){Da=!0;let Ma=!1;const Xa=!this._allTiles.some(ab=>{if(!na&&!za&&!ab.visible)return xa.done;var Ja=ab;
if(ab.hasPendingUpdate(pa.TileUpdate.MERGE)){if(!Ha||0<ab.unmergableChildCount)return xa.done;for(ab.resetPendingUpdate(pa.TileUpdate.MERGE);null!=Ja.parent&&0===Ja.parent.unmergableChildCount&&Ja.parent.resetPendingUpdate(pa.TileUpdate.MERGE);)Ja=Ja.parent;this._mergeTile(Ja);Ma=!0;xa.madeProgress()}else if(ab.resetPendingUpdate(pa.TileUpdate.SPLIT)){Ja=!0;const Qa=ab.level;if(Qa>=ja.maxTileNeighborLevelDelta){const Sa=cb=>cb.isLeaf||Qa-cb.level<ja.maxTileNeighborLevelDelta;for(let cb=0;4>cb;++cb){const eb=
ab.findNeighborTile(ta.neighborEdgeIndices[cb],Sa);null!=eb&&Qa-eb.level===ja.maxTileNeighborLevelDelta&&(Ja=!1,ta.enableTerrainInternalChecks&&(ta.internalAssert(eb.isLeaf),ta.internalAssert(eb.hasPendingUpdate(pa.TileUpdate.SPLIT))))}}Ja?(this._splitTile(ab),xa.madeProgress(),Ma=!0):ab.setPendingUpdate(pa.TileUpdate.SPLIT)}return xa.done});Ma&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries());if(Xa)if(!na)na=!0;else{if(!Ma)break}else this._allTilesDirty=
!0}Da?xa.madeProgress():this._allTilesDirty=!0;!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries();this._sortTiles(xa)}}_updateElevation(xa){xa.done||(this._allTiles.some(Ha=>{Ha.resetPendingUpdate(pa.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Ha),this._shortBatches&&this._updatePendingTileGeometries(),xa.madeProgress());return xa.done}),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(xa){xa.done||this._allTiles.some(Ha=>{this._updateTileTexture(Ha,
xa);return xa.done})}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(va.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.quality)*ja.maxMemoryLodBias}_getLodBiasCorrectedScale(xa){const Ha=this.tilingScheme.levels;xa=g.clamp(xa-this._lodBias,0,Ha.length-1);const na=xa-Math.floor(xa);return Ha[Math.floor(xa)].scale*(1-na)+Ha[Math.ceil(xa)].scale*na}_removeAllTiles(){null!=
this._rootTiles&&(this._rootTiles.forEach(xa=>this._purgeTile(xa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.renderer.visible=!1}_purgeDescendantTiles(xa){if(xa.children[0]){var Ha=xa.children.slice();xa.unsetChildren();for(xa=0;4>xa;++xa)this._purgeTile(Ha[xa])}}_purgeTile(xa){xa.isLeaf?Ua(xa):this._purgeDescendantTiles(xa);this._allTiles.removeUnordered(xa);this._unloadTile(xa);this._tileCache.put(Ra._tileMemcacheKey,xa)}_unloadTile(xa){this._pendingTilesToUpdate.delete(xa);
this._pendingTilesForElevationUpdateEvent.delete(xa);xa.unload(this._renderer)}_splitTile(xa){ta.weakAssert(xa.isLeaf,"Tile that is already split should not be split again!");ta.weakAssert(xa.rendered,"Tile marked to split is not rendered");Ua(xa);var Ha=xa.level+1;const na=2*xa.lij[1],za=2*xa.lij[2];Ha=xa.setChildren(this._createTile(Ha,na,za,xa),this._createTile(Ha,na,za+1,xa),this._createTile(Ha,na+1,za,xa),this._createTile(Ha,na+1,za+1,xa));this._allTiles.pushArray(Ha);xa.updateAgentSuspension();
ta.weakAssert(xa.rendered,"parent should be rendered");this._unloadTile(xa);Ha.forEach(Da=>this._loadTile(Da));Ha.forEach(Da=>this._pendingTilesToUpdate.add(Da));this._markAllTileNeighborsForUpdate(xa);this._emitTileScaleChange(xa,xa.level+1);this._allTilesDirty=!0;this._shortBatches&&this._updatePendingTileGeometries();Ha.forEach(Da=>Ia(Da,Da.hasPendingUpdate(pa.TileUpdate.SPLIT)));++this._performanceInfo.numSplit}_emitTileScaleChange(xa,Ha=xa.level){sb.spatialReference=this.spatialReference;sb.extent=
xa.extent;sb.scale=this._getLodBiasCorrectedScale(Ha);this.emit("scale-change",sb)}_createTile(xa,Ha,na,za){ta.weakAssert(!!za,"_createTile sanity check");xa=this._acquireTile(xa,Ha,na,za);xa.updateClippingStatus(this.extent);xa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(xa)&&xa.setPendingUpdate(pa.TileUpdate.SPLIT);return xa}get _shortBatches(){return this.view.state.mode!==Ga.RenderState.IDLE}_mergeTile(xa){ta.weakAssert(!xa.hasPendingUpdate(pa.TileUpdate.SPLIT),"_mergeTile sanity check");
ta.weakAssert(!xa.isLeaf,"Cannot merge a leaf");xa.isLeaf||(this._purgeDescendantTiles(xa),ta.weakAssert(!xa.renderData,"_mergeTile sanity check"),this._loadTile(xa),this._markTileToUpdate(xa),this._emitTileScaleChange(xa),this._shortBatches&&this._updatePendingTileGeometries(),Ia(xa,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(xa){xa.load();this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(xa)}_elevationDataArrived(xa,
Ha,na){na=new X.ElevationData(xa.lij,xa.extent,na);xa.dataArrived(Ha,fa.LayerClass.ELEVATION,na);na=[xa];xa=xa.level;const za=this._iteratorPool.acquire();for(za.reset(na);!za.done;){const Da=za.next();Da.findElevationBoundsForLayer(Ha,xa);Da.computeElevationBounds()}0===xa&&this._updateRootTileElevationBounds();za.remove();this._updateTilesVisibility(na)}_handleLayerViewChanges(xa=La.noBudget){if(this._layerViewsDirty){var Ha=this._layerViewsDirty=!1,na=new Set,za=-1;for(let Ma=this.view.allLayerViews.length-
1;0<=Ma;Ma--){var Da=this.view.allLayerViews.items[Ma];na.add(Da.uid);if(ta.isSurfaceLayerView(Da)||ta.isGroupLayerView(Da))if(this._basemapLayerViewHandles.has(Da.uid)&&!ta.isGroupLayerView(Da)){const Xa=this._layerClassFromLayerView(Da);Da=this._getLayerIdxByUID(Xa,Da.uid);if(null!=Da){if(Da<za||null==za)Ha=!0;za=Da}}else this._registerTiledLayerView(Da),Da.layer.loaded&&(Ha=!0)}this._basemapLayerViewHandles.forEach((Ma,Xa)=>{na.has(Xa)||(this._unregisterTiledLayerView(Xa),Ha=!0)});Ha&&this._updateTiledLayers();
this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();xa.madeProgress()}}_allSurfaceLayersTransparent(){let xa=0===this.view.map?.ground?.opacity;for(const Ha of this.view.allLayerViews.items)if(ta.isMapTileLayerView(Ha)&&!S.isBaseLayer(Ha.layer)&&0!==Ha.fullOpacity){xa=!1;break}return xa}_hasCompositeBlendMode(){for(const xa of this.view.allLayerViews.items)if((ta.isBlendableLayerView(xa)||ta.isGroupLayerView(xa))&&qa.isCompositeBlendMode(qa.blendModeFromString[xa.layer.blendMode]))return!0;
return!1}_layerClassFromLayerView(xa){return ta.isElevationLayerView(xa)?fa.LayerClass.ELEVATION:fa.LayerClass.MAP}_registerTiledLayerView(xa){const Ha=[];(ta.isBlendableLayerView(xa)||ta.isGroupLayerView(xa))&&Ha.push(w.watch(()=>xa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(ha.TextureUpdate.UNFADED)}));if(!ta.isGroupLayerView(xa)){const na=this._layerClassFromLayerView(xa);Ha.push(w.watch(()=>xa.suspended,()=>this._updateTiledLayers()));
Ha.push(w.watch(()=>xa.fullOpacity,()=>this._updateTileTextures(ha.TextureUpdate.UNFADED)));Ha.push(w.watch(()=>"effectiveScaleRange"in xa.layer?xa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(na)));Ha.push(xa.on("data-changed",()=>{const za=this._getLayerIdxByUID(na,xa.uid);null!=za&&this._invalidateLayerData(za,na)}))}this._unregisterTiledLayerView(xa.uid);this._basemapLayerViewHandles.set(xa.uid,Ha)}_unregisterTiledLayerView(xa){const Ha=this._basemapLayerViewHandles.get(xa);if(Ha){for(const na of Ha)na.remove();
this._basemapLayerViewHandles.delete(xa)}}_updateTiledLayers(){if(this.tilingScheme&&!this.view.suspended){var xa=[[],[]],Ha=null;this.view.allLayerViews.forEach(za=>{if(za.layer&&!za.suspended&&ta.isSurfaceLayerView(za)&&za.fullExtent){var Da=this._layerClassFromLayerView(za);if(Da===fa.LayerClass.MAP){const Ma=za.displayLevelRange.maxLevel;Infinity!==Ma&&(null===Ha||Ma>Ha)&&(Ha=Ma)}xa[Da].push(za)}});for(const za of fa.LayerClasses){var na=this._layerViews[za];const Da=xa[za];Da.reverse();const Ma=
Da.length;let Xa=na.length!==Ma;const ab=Array(Ma),Ja=Array(na.length);this._layerIndexByUid[za].clear();for(let Qa=0;Qa<Ma;Qa++){this._layerIndexByUid[za].set(Da[Qa].uid,Qa);const Sa=na.indexOf(Da[Qa]);ab[Qa]=Sa;Qa!==Sa&&(Xa=!0);-1<Sa&&(Ja[Sa]=Qa)}if(Xa){na=this._postorderIterator;for(na.reset(this._rootTiles);!na.done;)na.next().modifyLayers(Ja,ab,za);this._layerViews[za]=Da;this._restartAllAgents(za);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(Ha)&&this._viewChangeUpdate()}}_restartAllAgents(xa){const Ha=
this._postorderIterator;for(Ha.reset(this._rootTiles);!Ha.done;){const na=Ha.next();na.restartAgents(xa);xa===fa.LayerClass.ELEVATION&&na.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(xa,Ha){return this._layerViews[Ha][xa]}numLayers(xa){return this._layerViews[xa].length}_updateTileTextures(xa){this._allTiles.forAll(Ha=>{Ha.updateAgents(fa.LayerClass.MAP);xa===ha.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ha,pa.TileUpdate.TEXTURE_NOFADING):Ha.updateRenderData(fa.LayerClass.MAP,
xa)});this._evaluateTransparency()}_invalidateLayerData(xa,Ha){this._allTiles.forAll(na=>na.removeLayerAgent(xa,Ha));this._allTiles.forAll(na=>na.invalidateLayerData(xa,Ha))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(xa=va.RenderRequestType.UPDATE){this.renderer.setNeedsRender(xa)}requestUpdate(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(xa,Ha,na,za){const Da=this.layerViewByIndex(Ha,na);Ha=Da.layer;if(!Ha.tilemapCache||ta.isVectorTileLayerView(Da))return this._requestTileData(xa,
na,Da,za);++this._asyncWorkItems;return Ha.tilemapCache.fetchAvailability(xa.lij[0],xa.lij[1],xa.lij[2],{...za,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ma=>{--this._asyncWorkItems;x.throwIfAborted(za);x.isAbortError(Ma)||this._dataMissing(xa,na,Da,{notInTilemap:!0});throw Ma;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(xa,na,Da,za),za.signal))}_requestTileData(xa,Ha,na,za){return Ha===fa.LayerClass.ELEVATION?ta.isElevationLayerView(na)?this._requestElevationTileData(xa,
na,za):Promise.reject():ta.isMapTileLayerView(na)?this._requestMapTileData(xa,na,za):Promise.reject()}_requestElevationTileData(xa,Ha,na){++this._asyncWorkItems;const za=Xa=>{if(!x.isAborted(na)){var ab=this._layerIndexByUid[fa.LayerClass.ELEVATION].get(Ha.uid);null==ab?f.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",fa.LayerClass.ELEVATION,xa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(xa,ab,Xa))}},Da=Xa=>{x.isAbortError(Xa)||
(this._dataMissing(xa,fa.LayerClass.ELEVATION,Ha,Xa),this.requestUpdate())};if(ta.useFetchTileForLayer(Ha.layer))return Ha.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],{noDataValue:ja.elevationNodataValue,signal:na.signal}).then(Xa=>{if(x.isAborted(na))f.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>za(Xa),na.signal,Da)},Da).finally(()=>{--this._asyncWorkItems});
const Ma=Ha.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);return this._elevationDataRequester.request(Ma,"binary",na).then(Xa=>this._lercDecoder.decode(Xa,{noDataValue:ja.elevationNodataValue},na.signal)).then(Xa=>{Xa?za(new M.ElevationTileData(Xa)):Da(Error("LERC decoding failed"))},Da).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(xa,Ha,na){++this._asyncWorkItems;const za=(Ja,Qa)=>{--this._asyncWorkItems;ta.releaseTileData(Qa);x.isAborted(na)||(this._dataMissing(xa,fa.LayerClass.MAP,Ha,
Ja),this.requestUpdate())},Da=Ja=>Qa=>za(Qa,Ja),Ma=Ja=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();x.isAborted(na)?ta.releaseTileData(Ja):this._mapTileDataArrived(xa,Ha,Ja)},na.signal,Da(Ja)).catch(Da(Ja)),Xa=(Ja,Qa=null)=>this._frameTask.schedule(()=>za(Ja,Qa));if(ta.isVectorTileLayerView(Ha)){var ab=Ha.schemaHelper.getLevelRowColumn(xa.lij);return Ha.fetchTile(ab[0],ab[1],ab[2],na).then(Ma,Xa)}if(ta.isImageryTileLayerView(Ha))return Ha.fetchTile(xa.lij[0],xa.lij[1],
xa.lij[2],na).then(Ma,Xa);if(ta.isTileLayerView(Ha)&&ta.useFetchTileForLayer(Ha.layer))return Ha.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],na).then(Ja=>{x.isAborted(na)?(f.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Xa(x.createAbortError())):Ma(Ja)},Xa);ab=Ha.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);K.isRefreshableLayer(Ha.layer)&&Ha.layer.refreshTimestamp&&(ab+=`${ab.includes("?")?
"\x26":"?"}_ts=${Ha.layer.refreshTimestamp}`);return this._mapDataRequester.request(ab,Ha.hasMixedImageFormats?"image+type":"image",na).then(Ma,Xa)}_mapTileDataArrived(xa,Ha,na){Ha=this._getLayerIdxByUID(fa.LayerClass.MAP,Ha.uid);null!=Ha?xa.dataArrived(Ha,fa.LayerClass.MAP,na):(ta.releaseTileData(na),f.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(xa,Ha){return this._layerIndexByUid[xa].get(Ha)}_dataMissing(xa,Ha,na,za){na=this._getLayerIdxByUID(Ha,na.uid);
null!=na?xa.dataMissing(na,Ha,za):f.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(xa){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ha=>{Ha.renderData&&this.overlayManager.setTileParameters(Ha)}),this._renderer.setNeedsRender(xa))}get performanceInfo(){const xa=this._performanceInfo;xa.numNodes=this._allTiles.length;xa.numLeaves=xa.numVisible=xa.numRendered=xa.numLoadedPerLevel.length=xa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ha=>
{Ha.isLeaf&&xa.numLeaves++;const na=Ha.level;Ha.renderData&&(xa.numLoadedPerLevel[na]=(xa.numLoadedPerLevel[na]||0)+1);Ha.visible&&(xa.numVisible++,Ha.rendered&&(xa.numRenderedPerLevel[na]=(xa.numRenderedPerLevel[na]||0)+1,xa.numRendered++))});return xa}get usedMemory(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return this._usedMemory??0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((xa,Ha)=>xa+Ha.usedMemory,
0)):null}getUsedMemoryForLayerView(xa){let Ha=0;const na=this._layerClassFromLayerView(xa),za=this._getLayerIdxByUID(na,xa.uid);null!=za&&this._allTiles.forAll(Da=>Ha+=Da.getUsedMemoryForLayer(na,za));return Ha}getTile(xa){if(null==xa||null==this._rootTiles)return null;const Ha=xa.split("/").map(Ma=>+Ma);if(0===Ha[0])return this._rootTiles.find(Ma=>Ma.lij[1]===Ha[1]&&Ma.lij[2]===Ha[2]);xa=Ha[0];const na=Ha[1]>>xa,za=Ha[2]>>xa;let Da;this._rootTiles.some(Ma=>Ma.lij[1]===na&&Ma.lij[2]===za?(Da=Ma,!0):
!1);if(Da){for(xa=1<<Ha[0]-1;Da.lij[0]<Ha[0];){let Ma=Ha[1]&xa?2:0;0<(Ha[2]&xa)&&Ma++;if(!Da.children[Ma])return null;Da=Da.children[Ma];xa>>=1}ta.weakAssert(Da.lij[0]===Ha[0]&&Da.lij[1]===Ha[1]&&Da.lij[2]===Ha[2],"not the right tile?");return Da}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(xa){this._renderer.renderPatchBorders=xa}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(xa){this._renderer.visualizeNormals=
xa}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(xa){this._renderer.renderingDisabled=xa}get test(){const xa=this;return{renderer:xa._renderer,lercDecoder:xa._lercDecoder,forceReload:()=>{null!=xa._rootTiles&&0<xa._rootTiles.length&&(xa._mergeTile(xa._rootTiles[0]),xa._viewChangeUpdate())},getTiles:()=>xa._allTiles.toArray(),getRenderedTiles(){ka.clear();xa._allTiles.forAll(na=>{na.visible&&na.rendered&&ka.push(na)});const Ha=ka.toArray();wa.sortTiles(xa.renderOrder,
Ha);return Ha},lockTilingScheme(Ha,na){xa._extentHelper.defaultTiledLayersExtent=na;xa.tilingSchemeLogic.test.lockTilingScheme(Ha)}}}checkAllTilesWaterproofness(){if(ta.enableWaterproofnessTests){var xa=this._rootTiles;if(null!=xa){var Ha=Da=>0<Da?.renderData?.geometry?.indices?.length,na=Da=>{if(Da.intersectsClippingArea)if(Da.renderData&&!Da.renderData.geometryState&&console.error("Tile[",Da.lij,"] has renderData but not geometryState"),Da.renderData&&!Da.renderData.geometry&&console.error("Tile[",
Da.lij,"] has renderData but not geometryInfo"),!Da.renderData?.geometry||0<(Da.renderData.geometry.indices?.length??0)||console.error("Tile[",Da.lij,"] has renderData but no indices - geometryInfo: ",Da.renderData.geometry),Ha(Da)){Da.checkGeometryWaterproofness();for(const ab of Da.children){var Ma=ab,Xa=Da;Ha(Ma)&&console.error("Tile[",Ma.lij,"] has geometry although parent[",Xa.lij,"] has geom")}}else if(Da.isLeaf)console.error("Tile[",Da.lij,"] has no geometry and no children, from root to leaf");
else for(Ma of Da.children)na(Ma)},za=Da=>{const Ma=Da.parent?.visible??!0,Xa=Da.visible;Da.computeVisibility();const ab=Da.visible;Xa!==ab&&Ma&&console.error(" Tile[",Da.lij,"] has out of date visibility: ",Xa," instead of ",ab);if(!Da.isLeaf)for(const Ja of Da.children)za(Ja)};for(const Da of xa)na(Da),za(Da)}}}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(xa){return this._isGlobal&&
xa[2]===this.lijEastEnd(xa[0])-1}isWestEndWrap(xa){return this._isGlobal&&0===xa[2]}lijEastEnd(xa){return 1<<xa+(this._isGeographic?1:0)}wrapEastWest(xa){const Ha=this.lijEastEnd(xa[0]),na=xa[2];return 0<=na&&na<Ha?xa:this._isGlobal?[xa[0],xa[1],(na+(0>na?Ha:0))%Ha]:null}enableInternalChecks(xa){ta.enableInternalTerrainChecks(xa)}enableWaterproofnessChecks(xa){ta.enableTerrainWaterproofnessChecks(xa)}};c._tileMemcacheKey="TerrainTileMemcache";b.__decorate([q.property()],c.prototype,"_renderer",void 0);
b.__decorate([q.property({constructOnly:!0})],c.prototype,"_scaleRangeQueries",void 0);b.__decorate([q.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([q.property({constructOnly:!0})],c.prototype,"overlayManager",void 0);b.__decorate([q.property()],c.prototype,"_hasPendingUpdates",void 0);b.__decorate([q.property()],c.prototype,"_asyncWorkItems",void 0);b.__decorate([q.property()],c.prototype,"_allTilesDirty",void 0);b.__decorate([q.property()],c.prototype,"_allTilesSorted",
void 0);b.__decorate([q.property()],c.prototype,"_viewChanged",void 0);b.__decorate([q.property()],c.prototype,"_splitLimits",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([q.property()],c.prototype,"_frameTask",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"snapLevel",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"lodSnapping",null);b.__decorate([q.property()],c.prototype,"_userClippingExtent",null);b.__decorate([q.property()],
c.prototype,"_rootTilesExtent",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"groundExtent",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"_tilingSchemeExtent",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"running",null);b.__decorate([q.property(R.updatingProgress)],c.prototype,"updatingProgress",void 0);b.__decorate([q.property({readOnly:!0})],
c.prototype,"updatingProgressValue",null);b.__decorate([q.property()],c.prototype,"_maxNumUpdating",void 0);b.__decorate([q.property()],c.prototype,"baseOpacity",null);b.__decorate([q.property()],c.prototype,"hasCompositeBlendMode",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"viewingMode",null);b.__decorate([q.property()],c.prototype,"maxTextureScale",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"ready",null);b.__decorate([q.property({value:ea.RenderOrder.FRONT_TO_BACK})],
c.prototype,"renderOrder",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"rootTiles",null);b.__decorate([q.property()],c.prototype,"_rootTiles",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"spatialReference",null);b.__decorate([q.property({type:h})],c.prototype,"backgroundColor",null);b.__decorate([q.property({value:!1})],c.prototype,"slicePlaneEnabled",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"tilingScheme",void 0);b.__decorate([q.property({readOnly:!0})],
c.prototype,"tilingSchemeLocked",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"tilingSchemeLogic",void 0);b.__decorate([q.property()],c.prototype,"wireframe",null);b.__decorate([q.property({value:!1})],c.prototype,"suspended",null);b.__decorate([q.property()],c.prototype,"fadeDuration",null);b.__decorate([q.property()],c.prototype,"visibleElevationBounds",void 0);b.__decorate([q.property()],c.prototype,"rootTileElevationBounds",void 0);b.__decorate([q.property()],c.prototype,"_layerViewsDirty",
void 0);b.__decorate([q.property()],c.prototype,"renderPatchBorders",null);b.__decorate([q.property()],c.prototype,"visualizeNormals",null);b.__decorate([q.property()],c.prototype,"renderingDisabled",null);b=c=Ra=b.__decorate([p.subclass("esri.views.3d.terrain.TerrainSurface")],c);const bb=D.create(),gb=J.create(),db=L.create(),ka=new u,mb=new O.ElevationUpdateEvent("ground"),sb={spatialReference:null,extent:null,scale:0};class tb{constructor(xa){this.capacity=xa;this._tail=this._head=0;this._data=
Array(xa)}push(xa){const Ha=this._tail;if(Ha<this.capacity)this._data[Ha]=xa,this._tail=Ha+1;else throw Error("Queue full");}pushAll(xa){const Ha=xa.length;if(0!==Ha){var na=this._tail;if(na+Ha<=this.capacity){for(let za=0;za<Ha;++za)this._data[na+za]=xa[za];this._tail=na+Ha}else throw Error("Queue full");}}pop(){const xa=this._head;if(xa<this._tail){const Ha=this._data[xa];this._head=xa+1;return Ha}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}return b})},
"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){class b{constructor(h){this._store=h}destroy(){this._store.destroy()}get(h){return this._store.get(h)}put(h,c){this._store.put(h,c,c.values.byteLength+256)}}a.ElevationQueryTileCache=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports"],function(a){class b{constructor(h,c,k,m){this._maxValue=this._minValue=this._hasNoDataValues=null;
"pixelData"in h?(this.values=h.pixelData,this.width=h.width,this.height=h.height,this.noDataValue=h.noDataValue):(this.values=h,this.width=c,this.height=k,this.noDataValue=m)}get hasNoDataValues(){null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}get minValue(){this._ensureBounds();return this._minValue}get maxValue(){this._ensureBounds();return this._maxValue}_ensureBounds(){if(null==this._minValue){var {noDataValue:h,values:c}=
this,k=Infinity,m=-Infinity,d=!0;for(const f of c)f===h?this._hasNoDataValues=!0:(k=f<k?f:k,m=f>m?f:m,d=!1);d?this._maxValue=this._minValue=0:(this._minValue=k,this._maxValue=-3E38<m?m:0)}}}a.ElevationTileData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../core/workers/WorkerHandle"],function(a,b){class h extends b.WorkerHandle{constructor(k=null){super("LercWorker","_decode",{_decode:m=>[m.buffer]},k,{strategy:"dedicated"});
this.schedule=k;this.ref=0}decode(k,m,d){return k&&0!==k.byteLength?this.invoke({buffer:k,options:m},d):Promise.resolve(null)}release(){0>=--this.ref&&(c.forEach((k,m)=>{k===this&&c.delete(m)}),this.destroy())}}const c=new Map;a.acquireDecoder=function(k=null){let m=c.get(k);m||(null!=k?(m=new h(d=>k.immediate.schedule(d)),c.set(k,m)):(m=new h,c.set(null,m)));++m.ref;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),
function(a,b,h,c,k,m){class d{constructor(f,g,e,n,l={}){this._mainMethod=g;this._transferLists=e;this._listeners=[];this._promise=m.open(f,{...l,schedule:n}).then(u=>{if(void 0===this._thread){this._thread=u;this._promise=null;l.hasInitialize&&this.broadcast({},"initialize");for(const x of this._listeners)this._connectListener(x)}else u.close()});this._promise.catch(u=>c.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${f} worker: ${u}`))}on(f,g){const e={removed:!1,eventName:f,
callback:g,threadHandle:null};this._listeners.push(e);this._connectListener(e);return h.makeHandle(()=>{e.removed=!0;b.remove(this._listeners,e);this._thread&&null!=e.threadHandle&&e.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(f,g){return this.invokeMethod(this._mainMethod,f,g)}invokeMethod(f,g,e){if(this._thread){var n=this._transferLists[f];n=n?n(g):[];return this._thread.invoke(f,
g,{transferList:n,signal:e})}return this._promise?this._promise.then(()=>{k.throwIfAborted(e);return this.invokeMethod(f,g,e)}):Promise.reject(null)}broadcast(f,g){return this._thread?Promise.all(this._thread.broadcast(g,f)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(f,g)):Promise.reject()}get promise(){return this._promise}_connectListener(f){this._thread&&this._thread.on(f.eventName,f.callback).then(g=>{f.removed||(f.threadHandle=g)})}}a.WorkerHandle=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,h,c,k,m,d,f){class g extends f.TiledDisplayObject{constructor(n,l,u,x,w,q,v,p=null){super(n,l,u,x,w,q,4096,4096);this.styleRepository=v;this._memCache=p;this.type="vector-tile";
this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=0;this._processed=!1;this._referenced=1;this.id=n.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-
this.lastOpacityUpdate<d.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<d.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(n){this.changeDataImpl(n);this.requestRender();this.ready();this._processed=!0}deleteLayerData(n){let l=!1;for(const u of n)if(n=this.layerData.get(u))this._memoryUsedByLayerData-=n.memoryUsed,n.type===k.BucketType.SYMBOL&&
this.symbols.delete(u)&&(l=!0),n.destroy(),this.layerData.delete(u);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);l&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,e.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===
--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(n){this.featureIndex?.clear();let l=!1;if(n){const {bucketsWithData:u,emptyBuckets:x}=n;n=this._createRenderBuckets(u);if(x&&0<x.byteLength){const w=new Uint32Array(x);for(const q of w)this._deleteLayerData(q)}for(const [w,q]of n)this._deleteLayerData(w),q.type===k.BucketType.SYMBOL&&(this.symbols.set(w,
q.symbols),l=!0),this._memoryUsedByLayerData+=q.memoryUsed,this.layerData.set(w,q);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const [,u]of this.layerData)u.type===k.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);l&&this.emit("symbols-changed")}attachWithContext(n){this.stage={context:n,trashDisplayObject(l){l.processDetach()},untrashDisplayObject(){return!1}}}setTransform(n){super.setTransform(n);var l=this.resolution/(n.resolution*n.pixelRatio);const u=
this.width/this.rangeX*l;l*=this.height/this.rangeY;const x=[0,0];n.toScreen(x,[this.x,this.y]);const w=this.transforms.tileUnitsToPixels;h.identity(w);h.translate(w,w,x);h.rotate(w,w,Math.PI*n.rotation/180);h.scale(w,w,[u,l,1])}_createTransforms(){return{displayViewScreenMat3:c.create(),tileMat3:c.create(),tileUnitsToPixels:c.create()}}static _destroyRenderBuckets(n){if(n){var l=new Set;for(const u of n.values())l.has(u)||(u.destroy(),l.add(u));n.clear()}}_createRenderBuckets(n){const l=new Map,
u=new Map;for(const x of n){n=this._deserializeBucket(x,u);for(const w of n.layerUIDs)l.set(w,n)}return l}_deserializeBucket(n,l){let u=l.get(n);if(u)return u;switch((new Uint32Array(n))[0]){case k.BucketType.FILL:u=new m.FillRenderBucket(n,this.styleRepository);break;case k.BucketType.LINE:u=new m.LineRenderBucket(n,this.styleRepository);break;case k.BucketType.SYMBOL:u=new m.SymbolRenderBucket(n,this.styleRepository,this);break;case k.BucketType.CIRCLE:u=new m.CircleRenderBucket(n,this.styleRepository)}l.set(n,
u);return u}_deleteLayerData(n){if(this.layerData.has(n)){var l=this.layerData.get(n);this._memoryUsedByLayerData-=l.memoryUsed;l.destroy();this.layerData.delete(n)}}}const e=new Map;a.VectorTile=g;a.printAllocations=function(){e.forEach((n,l)=>{console.log(`\n${l.key}:`);n[0].forEach(u=>console.log(u));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");n[1].forEach(u=>console.log(u))})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["exports"],
function(a){function b(){const d=new Float32Array(9);d[0]=1;d[4]=1;d[8]=1;return d}function h(d){const f=new Float32Array(9);f[0]=d[0];f[1]=d[1];f[2]=d[2];f[3]=d[3];f[4]=d[4];f[5]=d[5];f[6]=d[6];f[7]=d[7];f[8]=d[8];return f}function c(d,f,g,e,n,l,u,x,w){const q=new Float32Array(9);q[0]=d;q[1]=f;q[2]=g;q[3]=e;q[4]=n;q[5]=l;q[6]=u;q[7]=x;q[8]=w;return q}function k(d,f){return new Float32Array(d,f,9)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:h,create:b,createView:k,fromValues:c},
Symbol.toStringTag,{value:"Module"}));a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.mat3f32=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=
2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l){class u{constructor(p,t){this.layerUIDs=[];this.isDestroyed=!1;this._data=p;let r=1;p=new Uint32Array(p);this.layerUIDs=
[];const y=p[r++];for(let D=0;D<y;D++)this.layerUIDs[D]=p[r++];this.bufferDataOffset=r;t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(p){null!=this._data&&(this.doPrepareForRendering(p,this._data,this.bufferDataOffset),this._data=null)}}class x extends u{constructor(p,
t){super(p,t);this.type=f.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;p=new Uint32Array(p);t=this.bufferDataOffset;this.lineIndexStart=p[t++];this.lineIndexCount=p[t++];const r=p[t++];if(0<r){this.patternMap=new Map;for(let y=0;y<r;y++){const D=p[t++],E=p[t++],A=p[t++];this.patternMap.set(D,[E,A])}}this.bufferDataOffset=t}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=
b.disposeMaybe(this.vao)}doPrepareForRendering(p,t,r){var y=new Uint32Array(t);t=new Int32Array(y.buffer);var D=y[r++];t=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*r,D));r+=D;D=y[r++];y=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*r,D));r+=D;r=this.layer.lineMaterial;this.vao=new l.VertexArrayObject(p,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:t},y)}}class w extends u{constructor(p,t){super(p,t);this.type=f.BucketType.FILL;
this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;p=new Uint32Array(p);t=this.bufferDataOffset;this.fillIndexStart=p[t++];this.fillIndexCount=p[t++];this.outlineIndexStart=p[t++];this.outlineIndexCount=p[t++];const r=p[t++];if(0<r){this.patternMap=new Map;for(let y=0;y<r;y++){const D=p[t++],E=p[t++],A=p[t++];this.patternMap.set(D,[E,A])}}this.bufferDataOffset=t}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??
0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=b.disposeMaybe(this.fillVAO);this.outlineVAO=b.disposeMaybe(this.outlineVAO)}doPrepareForRendering(p,t,r){var y=new Uint32Array(t),D=new Int32Array(y.buffer),E=y[r++];t=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,E));r+=E;var A=y[r++];E=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,
4*r,A));r+=A;A=y[r++];D=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,A));r+=A;A=y[r++];y=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*r,A));r+=A;A=this.layer;r=A.fillMaterial;A=A.outlineMaterial;this.fillVAO=new l.VertexArrayObject(p,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:t},E);this.outlineVAO=new l.VertexArrayObject(p,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:D},y)}}class q extends u{constructor(p,t,r){super(p,
t);this.type=f.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];t=new Uint32Array(p);const y=new Int32Array(p);p=new Float32Array(p);let D=this.bufferDataOffset;this.isIconSDF=!!t[D++];var E=t[D++],A=t[D++],B=t[D++];E=new k(E,A,B,0);A=t[D++];for(B=0;B<A;B++){var F=t[D++],G=t[D++],H=t[D++];this.iconPerPageElementsMap.set(F,[G,H])}A=t[D++];for(B=0;B<A;B++)F=
t[D++],G=t[D++],H=t[D++],this.glyphPerPageElementsMap.set(F,[G,H]);A=t[D++];B=t[D++];this.iconOpacity=new Int32Array(A);this.textOpacity=new Int32Array(B);this.bufferDataOffset=D=g.deserializeSymbols(t,y,p,D,this.symbols,r,E)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+h.estimateSize(this.iconOpacity)+h.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let p=
0;for(const [,t]of this.iconPerPageElementsMap)p+=t[1];for(const [,t]of this.glyphPerPageElementsMap)p+=t[1];return p/3}doDestroy(){this.iconVAO=b.disposeMaybe(this.iconVAO);this.textVAO=b.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var p=this.iconOpacity,t=this.iconVAO.vertexBuffers.opacity;0<p.length&&p.byteLength===t.usedMemory&&t.setSubData(p,0,0,p.length);p=this.textOpacity;t=this.textVAO.vertexBuffers.opacity;0<p.length&&p.byteLength===t.usedMemory&&
t.setSubData(p,0,0,p.length)}}doPrepareForRendering(p,t,r){var y=new Uint32Array(t),D=new Int32Array(y.buffer),E=y[r++];t=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,E));r+=E;var A=y[r++];E=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*r,A));r+=A;A=y[r++];D=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,A));r+=A;A=y[r++];y=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*r,A));
r+=A;r=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,this.iconOpacity.buffer);A=e.BufferObject.createVertex(p,n.Usage.STATIC_DRAW,this.textOpacity.buffer);var B=this.layer;const F=B.iconMaterial;B=B.textMaterial;this.iconVAO=new l.VertexArrayObject(p,F.getAttributeLocations(),F.getLayoutInfo(),{geometry:t,opacity:r},E);this.textVAO=new l.VertexArrayObject(p,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:D,opacity:A},y)}}class v extends u{constructor(p,t){super(p,t);this.type=f.BucketType.CIRCLE;
this.circleIndexCount=this.circleIndexStart=0;p=new Uint32Array(p);t=this.bufferDataOffset;this.circleIndexStart=p[t++];this.circleIndexCount=p[t++];this.bufferDataOffset=t}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=b.disposeMaybe(this.vao)}doPrepareForRendering(p,t,r){var y=new Uint32Array(t);t=new Int32Array(y.buffer);var D=y[r++];t=e.BufferObject.createVertex(p,
n.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*r,D));r+=D;D=y[r++];y=e.BufferObject.createIndex(p,n.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*r,D));r+=D;r=this.layer.circleMaterial;this.vao=new l.VertexArrayObject(p,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:t},y)}}a.CircleRenderBucket=v;a.FillRenderBucket=w;a.LineRenderBucket=x;a.RenderBucketBase=u;a.SymbolRenderBucket=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils",
"./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,b,h,c,k){const m=new c("0/0/0/0");class d{static create(e,n){e[1]>n[1]&&([e,n]=[n,e]);const [l,u]=e,[x,w]=n;e=x-l;n=w-u;n=0!==n?e/n:0;const q=(Math.ceil(u)-u)*n,v=(Math.floor(u)-u)*n;return new d(l,Math.floor(u),Math.ceil(w),n,0>e?q:v,0>e?v:q,0>e?x:l,0>e?l:x)}constructor(e,n,l,u,x,w,q,v){this.x=e;this.ymin=n;this.ymax=l;this.invM=u;this.leftAdjust=x;this.rightAdjust=w;this.leftBound=q;this.rightBound=v}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+
this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const f=[[0,0],[0,0],[0,0],[0,0]];class g{constructor(e,n=null,l=e.lods[0].level,u=e.lods[e.lods.length-1].level){this.tileInfo=e;this.fullExtent=n;this.scales=[];this._infoByScale={};this._infoByLevel={};const x=e.lods.filter(q=>q.level>=l&&q.level<=u);this.minScale=x[0].scale;this.maxScale=x[x.length-1].scale;const w=this._lodInfos=x.map(q=>b.create(e,q,n));x.forEach((q,v)=>{this._infoByLevel[q.level]=
w[v];this._infoByScale[q.scale]=w[v];this.scales[v]=q.scale},this);this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"===typeof e?e:e.level]}getTileBounds(e,n,l=!1){m.set(n);return(n=this._infoByLevel[m.level])?n.getTileBounds(e,m,l):e}getTileCoords(e,n,l=!1){m.set(n);return(n=this._infoByLevel[m.level])?n.getTileCoords(e,m,l):e}getTileCoverage(e,n=192,l=!0,u="closest"){if(!l&&(e.scale>this.minScale||e.scale<this.maxScale))return null;
l="closest"===u?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale);u=h.pool.acquire(l);const x=this._wrap;var w=Infinity;let q=-Infinity;const v=u.spans;f[0][0]=f[0][1]=f[1][1]=f[3][0]=-n;f[1][0]=f[2][0]=e.size[0]+n;f[2][1]=f[3][1]=e.size[1]+n;for(p of f)e.toMap(p,p),p[0]=l.getColumnForX(p[0]),p[1]=l.getRowForY(p[1]);e=[];var p=3;for(n=0;4>n;n++)f[n][1]===f[p][1]?p=n:(p=d.create(f[n],f[p]),w=Math.min(p.ymin,w),q=Math.max(p.ymax,q),void 0===e[p.ymin]&&(e[p.ymin]=[]),e[p.ymin].push(p),
p=n);if(null==w||null==q||100<q-w)return null;for(n=[];w<q;){null!=e[w]&&(n=n.concat(e[w]));p=Infinity;var t=-Infinity;for(var r=n.length-1;0<=r;r--){var y=n[r];p=Math.min(p,y.getLeftCol());t=Math.max(t,y.getRightCol())}p=Math.floor(p);t=Math.floor(t);if(w>=l.first[1]&&w<=l.last[1])if(x)if(l.size[0]<l.worldSize[0])for(r=Math.floor(t/l.worldSize[0]),y=Math.floor(p/l.worldSize[0]);y<=r;y++)v.push(new k(w,Math.max(l.getFirstColumnForWorld(y),p),Math.min(l.getLastColumnForWorld(y),t)));else v.push(new k(w,
p,t));else p>l.last[0]||t<l.first[0]||(p=Math.max(p,l.first[0]),t=Math.min(t,l.last[0]),v.push(new k(w,p,t)));w+=1;for(p=n.length-1;0<=p;p--)t=n[p],t.ymax>=w?t.incrRow():n.splice(p,1)}return u}getTileParentId(e){m.set(e);e=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>e)return null;this._getTileIdAtLOD(m,this._lodInfos[e],m);return m.id}getTileResolution(e){return(e=this._infoByLevel["object"===typeof e?e.level:e])?e.resolution:-1}getTileScale(e){return(e=this._infoByLevel[e.level])?e.scale:
-1}intersects(e,n){m.set(n);n=this._infoByLevel[m.level];const l=e.lodInfo;if(l.resolution>n.resolution){this._getTileIdAtLOD(m,l,m);var u=l.denormalizeCol(m.col,m.world);for(var x of e.spans)if(x.row===m.row&&x.colFrom<=u&&x.colTo>=u)return!0}if(l.resolution<n.resolution){const [q,v,p,t]=e.spans.reduce((r,y)=>{r[0]=Math.min(r[0],y.row);r[1]=Math.max(r[1],y.row);r[2]=Math.min(r[2],y.colFrom);r[3]=Math.max(r[3],y.colTo);return r},[Infinity,-Infinity,Infinity,-Infinity]);u=n.denormalizeCol(m.col,m.world);
e=l.getColumnForX(n.getXForColumn(u));x=l.getRowForY(n.getYForRow(m.row));u=l.getColumnForX(n.getXForColumn(u+1))-1;n=l.getRowForY(n.getYForRow(m.row+1))-1;return!(e>t||u<p||x>v||n<q)}const w=l.denormalizeCol(m.col,m.world);return e.spans.some(q=>q.row===m.row&&q.colFrom<=w&&q.colTo>=w)}normalizeBounds(e,n,l){e[0]=n[0];e[1]=n[1];e[2]=n[2];e[3]=n[3];this._wrap&&(n=a.getInfo(this.tileInfo.spatialReference),l=-l*(n.valid[1]-n.valid[0]),e[0]+=l,e[2]+=l);return e}getSmallestInfoForScale(e){const n=this.scales;
if(this._infoByScale[e])return this._infoByScale[e];if(e>n[0])return this._infoByScale[n[0]];for(let l=1;l<n.length-1;l++)if(e>n[l]+1E-6)return this._infoByScale[n[l-1]];return this._infoByScale[n[n.length-1]]}getClosestInfoForScale(e){const n=this.scales;if(this._infoByScale[e])return this._infoByScale[e];e=n.reduce((l,u)=>Math.abs(u-e)<Math.abs(l-e)?u:l,n[0]);return this._infoByScale[e]}scaleToLevel(e){const n=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let l=n.length-
1;0<=l;l--)if(e<n[l])return l===n.length-1?this._infoByScale[n[n.length-1]].level:this._infoByScale[n[l]].level+(n[l]-e)/(n[l]-n[l+1]);return this._infoByScale[n[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,n,l){const u=this._infoByLevel[l.level];e.set(l);if(n.resolution<u.resolution)return null;if(n.resolution===u.resolution)return e;e.level=n.level;e.col=Math.floor(l.col*u.resolution/n.resolution+.01);e.row=Math.floor(l.row*u.resolution/n.resolution+.01);return e}}
return g})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(a,b){function h(m,d,f){m[0]=d;m[1]=f;return m}const c=new b("0/0/0/0");class k{static create(m,d,f=null){var g=a.getInfo(m.spatialReference);const e=d.origin||[m.origin.x,m.origin.y],n=[m.size[0]*d.resolution,m.size[1]*d.resolution],l=[-Infinity,-Infinity],u=[Infinity,Infinity],x=[Infinity,Infinity];null!=f&&(h(l,Math.max(0,Math.floor((f.xmin-e[0])/n[0])),Math.max(0,
Math.floor((e[1]-f.ymax)/n[1]))),h(u,Math.max(0,Math.floor((f.xmax-e[0])/n[0])),Math.max(0,Math.floor((e[1]-f.ymin)/n[1]))),h(x,u[0]-l[0]+1,u[1]-l[1]+1));const {cols:w,rows:q}=d;!f&&w&&q&&(h(l,w[0],q[0]),h(u,w[1],q[1]),h(x,w[1]-w[0]+1,q[1]-q[0]+1));let v;m.isWrappable?(m=[Math.ceil(Math.round((g.valid[1]-g.valid[0])/d.resolution)/m.size[0]),x[1]],g=[Math.floor((g.origin[0]-e[0])/n[0]),l[1]],f=[m[0]+g[0]-1,u[1]],v=!0):(g=l,f=u,m=x,v=!1);return new k(d.level,d.resolution,d.scale,e,l,u,x,n,g,f,m,v)}constructor(m,
d,f,g,e,n,l,u,x,w,q,v){this.level=m;this.resolution=d;this.scale=f;this.origin=g;this.first=e;this.last=n;this.size=l;this.norm=u;this.worldStart=x;this.worldEnd=w;this.worldSize=q;this.wrap=v}normalizeCol(m){if(!this.wrap)return m;const d=this.worldSize[0];return 0>m?d-1-Math.abs((m+1)%d):m%d}denormalizeCol(m,d){return this.wrap?this.worldSize[0]*d+m:m}getWorldForColumn(m){return this.wrap?Math.floor(m/this.worldSize[0]):0}getFirstColumnForWorld(m){return m*this.worldSize[0]+this.first[0]}getLastColumnForWorld(m){return m*
this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(m){return(m-this.origin[0])/this.norm[0]}getXForColumn(m){return this.origin[0]+m*this.norm[0]}getRowForY(m){return(this.origin[1]-m)/this.norm[1]}getYForRow(m){return this.origin[1]-m*this.norm[1]}getTileBounds(m,d,f=!1){c.set(d);var g=f?c.col:this.denormalizeCol(c.col,c.world),e=c.row;d=this.getXForColumn(g);f=this.getYForRow(e+1);g=this.getXForColumn(g+1);e=this.getYForRow(e);m[0]=d;m[1]=f;m[2]=g;m[3]=e;return m}getTileCoords(m,d,f=!1){c.set(d);
d=f?c.col:this.denormalizeCol(c.col,c.world);Array.isArray(m)?h(m,this.getXForColumn(d),this.getYForRow(c.row)):(m.x=this.getXForColumn(d),m.y=this.getYForRow(c.row));return m}}return k})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(a){class b{static getId(h,c,k,m){return"object"===typeof h?`${h.level}/${h.row}/${h.col}/${h.world}`:`${h}/${c}/${k}/${m}`}constructor(h,c,k,m){this.set(h,c,k,m)}get key(){return this}get id(){return this.toString()}set id(h){this.set(h)}get hash(){return(this.world&
3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(h,c,k,m){this.set(h,c,k,m)}contains(h){const c=h.level-this.level;return 0<=c&&this.row===h.row>>c&&this.col===h.col>>c&&this.world===h.world}containsChild(h){const c=h.level-this.level;return 0<c&&this.row===h.row>>c&&this.col===h.col>>c&&this.world===h.world}equals(h){return this.level===h.level&&this.row===h.row&&this.col===h.col&&this.world===h.world}clone(){return new b(this)}release(){this.world=this.col=this.row=this.level=
0}set(h,c,k,m){if(null==h)this.world=this.col=this.row=this.level=0;else if("object"===typeof h)this.level=h.level||0,this.row=h.row||0,this.col=h.col||0,this.world=h.world||0;else if("string"===typeof h){const [d,f,g,e]=h.split("/");this.level=parseFloat(d);this.row=parseFloat(f);this.col=parseFloat(g);this.world=parseFloat(e)}else this.level=+h,this.row=+c,this.col=+k,this.world=+m||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?
null:new b(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(h,c){return`${this.level}/${this.row+c}/${this.col+h}/${this.world}`}getChildKeys(){const h=this.level+1,c=this.row<<1,k=this.col<<1,m=this.world;return[new b(h,c,k,m),new b(h,c,k+1,m),new b(h,c+1,k,m),new b(h,c+1,k+1,m)]}compareRowMajor(h){return this.row<h.row?-1:this.row>h.row?1:this.col<h.col?-1:this.col>h.col?1:0}}b.pool=new a(b,null,null,25,50);return b})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool",
"./TileKey"],function(a,b){class h{constructor(){this.spans=[]}acquire(c){this.lodInfo=c}release(){this.lodInfo=null;this.spans.length=0}*keys(){const c=this.lodInfo;for(const {row:k,colFrom:m,colTo:d}of this.spans)for(let f=m;f<=d;f++){const g=c.getWorldForColumn(f);yield new b(c.level,k,c.normalizeCol(f),g)}}forEach(c,k){const {spans:m,lodInfo:d}=this,{level:f}=d;if(0!==m.length)for(const {row:g,colFrom:e,colTo:n}of m)for(let l=e;l<=n;l++)c.call(k,f,g,d.normalizeCol(l),d.getWorldForColumn(l))}}
h.pool=new a(h);return h})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(b,h,c){this.row=b;this.colFrom=h;this.colTo=c}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(q,v){q.length=0;v.forEach(p=>q.push(p));return q}const l=new Set,u=[],x=new Map,w=[0,0];b=class extends b{constructor(q){super(q);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:q,process:v,strategy:p}=this;this._queue=new e.QueueProcessor({concurrency:q,process:(t,r)=>{t=this._keyToItem.get(t);return v(t,{signal:r})},peeker:"scale-first"===p?t=>this._peekByScaleFirst(t):t=>this._peekByCenterFirst(t)})}destroy(){this.clear();
this._queue=h.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(q){this._queue.abort("string"===typeof q?q:q.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(q){return"string"===typeof q?this._keyToItem.has(q):this._keyToItem.has(q.id)}isOngoing(q){q="string"===typeof q?q:q.id;return this.has(q)&&this._queue.isOngoing(q)}pause(){this._queue.pause()}push(q){const v=q.key.id;if(this._queue.has(v))return this._queue.get(v);
const p=this._queue.push(v),t=()=>{this._keyToItem.delete(v)};this._keyToItem.set(v,q);p.then(t,t);return p}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(q){if(!this.state)return q.values().next().value;const v=this.tileInfoView;let p=Number.NEGATIVE_INFINITY,t=Number.POSITIVE_INFINITY;q.forEach(A=>{A=this._keyToItem.get(A);const B=this.tileInfoView.getTileScale(A.key);x.has(B)||(x.set(B,[]),p=Math.max(B,p),t=Math.min(B,t));x.get(B).push(A.key);l.add(B)});let r=this.state.scale;
x.has(r)||(n(u,l),u.sort((A,B)=>A-B),r=u.reduce((A,B)=>Math.abs(B-r)<Math.abs(A-r)?B:A,u[0]));r=Math.min(r,p);r=Math.max(r,t);q=x.get(r);const y=v.getClosestInfoForScale(r),D=y.getColumnForX(this.state.center[0]),E=y.getRowForY(this.state.center[1]);q.sort((A,B)=>{const F=y.denormalizeCol(A.col,A.world),G=y.denormalizeCol(B.col,B.world);return Math.sqrt((D-F)*(D-F)+(E-A.row)*(E-A.row))-Math.sqrt((D-G)*(D-G)+(E-B.row)*(E-B.row))});l.clear();x.clear();return q[0].id}_peekByCenterFirst(q){if(!this.state)return q.values().next().value;
const v=this.tileInfoView,p=this.state.center;let t=Number.POSITIVE_INFINITY,r;q.forEach(y=>{y=this._keyToItem.get(y);v.getTileCoords(w,y.key);const D=g.distance(w,p);D<t&&(t=D,r=y.key)});return r.id}};a.__decorate([c.property({constructOnly:!0})],b.prototype,"concurrency",void 0);a.__decorate([c.property({constructOnly:!0})],b.prototype,"process",void 0);a.__decorate([c.property()],b.prototype,"state",void 0);a.__decorate([c.property({constructOnly:!0})],b.prototype,"strategy",void 0);a.__decorate([c.property({constructOnly:!0})],
b.prototype,"tileInfoView",void 0);return b=a.__decorate([f.subclass("esri.views.2d.tiling.TileQueue")],b)})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(a,b,h,c,k,m,d){class f{constructor(e,n){this.item=e;this.controller=n;this.promise=null}}class g{constructor(e){this._task=this._schedule=null;this._deferreds=new k;this._controllers=new k;
this._processingItems=new k;this._pausedSignal=d.signal(!1);this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new c(e.peeker);this.process=e.process;const n=e.scheduler;e.priority&&n&&(this._task=n.registerTask(e.priority,this))}destroy(){this.clear();this._schedule=b.removeMaybe(this._schedule);this._task=b.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){(e=this._controllers.get(e))&&
e.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(n=>e.push(n));this._controllers.clear();e.forEach(n=>n.abort());this._processingItems.clear();this._cancelNext()}forEach(e){this._deferreds.forEach((n,l)=>e(l))}get(e){return(e=this._deferreds.get(e))?e.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,n){const l=this.get(e);if(l)return l;
const u=new AbortController;let x=null;n&&(x=h.onAbort(n,()=>u.abort()));const w=()=>{q.remove();null!=x&&x.remove();this._removeItem(e);this._queue.remove(e);this._scheduleNext()},q=h.onAbortOrThrow(u.signal,()=>{const p=this._processingItems.get(e);p&&p.controller.abort();w();v.reject(h.createAbortError())}),v=h.createResolver();this._deferreds.set(e,v);this._controllers.set(e,u);v.promise.then(w,w);this._queue.push(e);this._scheduleNext();return v.promise}last(){return this._queue.last()}lastPromise(){const e=
this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();e&&this._removeItem(e);return e}reset(){const e=[];this._processingItems.forEach(n=>e.push(n));this._processingItems.clear();for(const n of e)this._queue.push(n.item),n.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());this.clear();return e}get running(){return!this._pausedSignal.value&&
0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e);this._controllers.delete(e);this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=m.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<
this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,n){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(n))}_processError(e,n){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(n))}_canProcessFulfillment(e){return this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e?!0:!1}_process(e){if(null!=e){var n=new AbortController,
l=new f(e,n);this._processingItems.set(e,l);try{var u=this.process(e,n.signal)}catch(x){this._processError(l,x)}h.isPromiseLike(u)?(l.promise=u,u.then(x=>this._processResult(l,x),x=>this._processError(l,x))):this._processResult(l,u)}}get test(){return{update:e=>this.runTask(e)}}}a.QueueProcessor=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],
function(a,b,h,c){const k=new c(0,0,0,0),m=new Map,d=[],f=[];class g{constructor(e){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=e.acquireTile;this.releaseTile=e.releaseTile;this.tileInfoView=e.tileInfoView;null!=e.resampling&&(this.resampling=e.resampling);e.cachePolicy&&(this.cachePolicy=e.cachePolicy);e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy);
null!=e.buffer&&(this.buffer=e.buffer);e.cacheSize&&(this._tileCache=new b(e.cacheSize,this.tileInfoView,n=>{this.releaseTile(n)}))}destroy(){this.tileIndex.clear()}update(e){const {resampling:n,tileIndex:l}=this,{scale:u,center:x,resolution:w}=e.state,{minScale:q,maxScale:v}=this.tileInfoView,p=!e.stationary&&u>this._previousScale;this._previousScale=u;if(!n&&(u>q||u<v))this.tiles.length=0,this.clear();else if(e=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:t,
lodInfo:r}=e,{level:y}=r;this.tiles.length=0;l.forEach(B=>B.visible=!0);var D=0,E=0;if(0<t.length)for(const {row:B,colFrom:F,colTo:G}of t)for(var A=F;A<=G;A++){D++;const H=k.set(y,B,r.normalizeCol(A),r.getWorldForColumn(A)).id;let L=l.get(H);if(L)L.isReady?(m.set(H,L),E++):p||this._addParentTile(H,m);else{if(this._tileCache?.has(H)){if(L=this._tileCache.pop(H),this.tileIndex.set(H,L),L.isReady){m.set(H,L);E++;continue}}else L=this.acquireTile(k),this.tileIndex.set(H,L);p||this._addParentTile(H,m)}}D=
E===D;for(const [B,F]of l)m.has(B)||(k.set(B),E=this.tileInfoView.intersects(e,k),A="purge"===this.cachePolicy?k.level!==y:k.level>y,!E||!p&&D?!A&&E||d.push(F):F.isReady?A&&"purge"===this.cachePolicy&&this._hasReadyAncestor(k,y)?d.push(F):f.push(F):A&&d.push(F));for(const B of f)B.isReady&&m.set(B.key.id,B);for(const B of d)this._tileCache?this._tileCache.add(B):this.releaseTile(B),l.delete(B.key.id);for(const B of m.values())this.tiles.push(B);for(const B of l.values())m.has(B.key.id)||(B.visible=
!1);this._tileCache?.prune(y,x,w);h.pool.release(e);f.length=0;d.length=0;m.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:e}=this;for(const n of e.values())this.releaseTile(n);e.clear()}refresh(e){for(const n of this.tileIndex.values())this.tiles.includes(n)?e(n):d.push(n);for(const n of d)this.releaseTile(n),this.tileIndex.delete(n.key.id);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,n){let l=null;for(;;){e=this.tileInfoView.getTileParentId(e);
if(!e)break;if(this.tileIndex.has(e)){if(l=this.tileIndex.get(e),l?.isReady){n.has(l.key.id)||n.set(l.key.id,l);break}}else if(this._tileCache?.has(e)&&(l=this._tileCache.pop(e),this.tileIndex.set(e,l),l?.isReady)){n.has(l.key.id)||n.set(l.key.id,l);break}}}_hasReadyAncestor(e,n){const l=a.create();this.tileInfoView.getTileBounds(l,e,!0);for(const u of this.tileIndex.values())if(u.isReady&&u.key.level>=n&&u.key.level<e.level){const x=a.create();this.tileInfoView.getTileBounds(x,u.key,!0);if(a.contains(x,
l))return!0}return!1}}return g})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(a){class b{constructor(h,c,k){this.maxSize=h;this._tileInfoView=c;this._removedFunc=k;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(h){return this._tilePerId.has(h)}get(h){return this._tilePerId.get(h)}pop(h){const c=this._tilePerId.get(h);if(c){var k=this._tileKeysPerLevel[c.key.level];this._tilePerId["delete"](h);
for(let m=0;m<k.length;m++)if(k[m].id===h){k.splice(m,1);break}c.visible=!0;return c}}add(h){h.visible=!1;const c=h.key,k=c.id;this._tilePerId.has(k)||(this._tilePerId.set(k,h),h=c.level,this._tileKeysPerLevel[h]||(this._tileKeysPerLevel[h]=[]),this._tileKeysPerLevel[h].push(c))}prune(h,c,k){let m=this._tilePerId.size;if(!(m<=this.maxSize)){for(var d=this._tileKeysPerLevel.length-1;m>this.maxSize&&0<=d;)d!==h&&(m=this._pruneAroundCenterTile(m,c,k,d)),d--;m>this.maxSize&&(m=this._pruneAroundCenterTile(m,
c,k,h))}}_pruneAroundCenterTile(h,c,k,m){m=this._tileKeysPerLevel[m];if(!m||0===m.length)return h;const {size:d,origin:f}=this._tileInfoView.tileInfo,g=k*d[0],e=k*d[1],n=[0,0],l=[0,0];for(m.sort((u,x)=>{n[0]=f.x+g*(u.col+.5);n[1]=f.y-e*(u.row+.5);l[0]=f.x+g*(x.col+.5);l[1]=f.y-e*(x.row+.5);return a.squaredDistance(n,c)-a.squaredDistance(l,c)});0<m.length&&(k=m.pop(),this._removeTile(k.id),h--,h!==this.maxSize););return h}_removeTile(h){const c=this._tilePerId.get(h);this._removedFunc&&c&&this._removedFunc(c);
this._tilePerId["delete"](h)}}return b})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","../GeometryUtils","./core"],function(a,b,h,c){class k{constructor(m,d,f){this._rows=Math.ceil(d/f);this._columns=Math.ceil(m/f);this._cellSize=f;this.cells=Array(this._rows);for(m=0;m<this._rows;m++)for(this.cells[m]=Array(this._columns),d=0;d<this._columns;d++)this.cells[m][d]=[]}getCell(m,d){d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._rows-1);m=Math.min(Math.max(Math.floor(m/
this._cellSize),0),this._columns-1);return this.cells[d]&&this.cells[d][m]||null}getCellSpan(m,d,f,g){return[Math.min(Math.max(Math.floor(m/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}a.GridIndex=k;a.deserializeSymbols=
function(m,d,f,g,e,n,l){const u=d[g++];for(let q=0;q<u;q++){const v=new c.VTLSymbol(n,l);v.xTile=d[g++];v.yTile=d[g++];v.hash=d[g++];v.priority=d[g++];v.featureIndex=d[g++];var x=d[g++];for(var w=0;w<x;w++){const p=d[g++],t=d[g++],r=d[g++],y=d[g++],D=!!d[g++],E=d[g++],A=f[g++],B=f[g++],F=d[g++],G=d[g++];v.colliders.push({xTile:p,yTile:t,dxPixels:r,dyPixels:y,hard:D,partIndex:E,width:F,height:G,minLod:A,maxLod:B})}x=m[g++];for(w=0;w<x;w++)v.textVertexRanges.push([m[g++],m[g++]]);x=m[g++];for(w=0;w<
x;w++)v.iconVertexRanges.push([m[g++],m[g++]]);e.push(v)}return g};a.isSearchCircleOverlapingSymbol=function(m,d,f,g){var e=m.colliders;let n,l,u;for(const x of e)if(m.unique.show&&m.unique.parts[x.partIndex].show&&(e=x.xScreen-g[0]+x.dxScreen,n=x.yScreen-g[1]+x.dyScreen,l=e+x.width,u=n+x.height,h.isCircleOverlapingRect(f,d.x,d.y,e,n,l,u)))return!0;return!1};a.tileCoordChange=function(m,d,f,g,e,n){f-=e;if(0<=f)return(d>>f)+(g-(n<<f))*(m>>f);f=-f;return d-(n-(g<<f))*(m>>f)<<f};a.writeOpacityToBuffers=
function(m,d,f){for(const [w,q]of m.symbols){{var g=m,e=d,n=f,l=q;const v=g.layerData.get(w);if(v.type===b.BucketType.SYMBOL){for(const p of l){l=p.unique;var u=void 0;if(p.selectedForRendering){var x=l.parts[0];u=x.startOpacity;x=x.targetOpacity;g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===x;u=n?Math.floor(127*u)|x<<7:x?255:0;u|=u<<24|u<<16|u<<8}else u=0;for(const [t,r]of p.iconVertexRanges)for(x=t;x<t+r;x+=4)v.iconOpacity[x/4]=u;p.selectedForRendering?(u=l.parts[1],l=u.startOpacity,u=u.targetOpacity,
g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===u,l=n?Math.floor(127*l)|u<<7:u?255:0,u=l<<24|l<<16|l<<8|l):u=0;for(const [t,r]of p.textVertexRanges)for(l=t;l<t+r;l+=4)v.textOpacity[l/4]=u}v.lastOpacityUpdate=e;v.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){class b{constructor(c,k){this.sourceTile=k;this.hash=this.yTile=this.xTile=0;this.priority=1;this.featureIndex=
0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=c}}class h{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}a.VTLSymbol=b;a.VTLUniqueSymbol=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.collisionGridCellSize=32;a.declutterBudget=1.5;
a.declutterTiles=!0;a.fadeDuration=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,h,c){class k extends h.DisplayObject{constructor(m,d,f,g,e,n,l=e,u=n){super();this.tileDebugInfoTexture=null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,
bytesReserved:0}};this._destroyed=!1;this.key=new c(m);this.resolution=d;this.x=f;this.y=g;this.width=e;this.height=n;this.rangeX=l;this.rangeY=u}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null);this._destroyed=!0}get debugSlot(){let m=this;for(;m.parent!==this._stage;){if(!m.parent)return 0;m=m.parent}return this._stage.children.indexOf(m)}setTransform(m){const d=this.resolution/(m.resolution*m.pixelRatio),f=this.transforms.tileMat3,[g,e]=
m.toScreenNoRotation([0,0],[this.x,this.y]);b.set(f,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,g,e,1);b.multiply(this.transforms.displayViewScreenMat3,m.displayViewMat3,f)}get destroyed(){return this._destroyed}}a.TiledDisplayObject=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(a,b,h,c){const k=0===h("mapview-transitions-duration")?
0:1/h("mapview-transitions-duration");class m extends b{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(d){this._clips=d;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(d){this._opacity!==
d&&(this._opacity=Math.min(1,Math.max(d,0)),this.requestRender())}get stage(){return this._stage}set stage(d){if(this._stage!==d){var f=this._stage;(this._stage=d)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):f?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(d){this._visible!==d&&(this._visible=
d,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=c.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;
this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=c.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(d){this.updateTransitionProperties(d.deltaTime,d.state.scale);this.setTransform(d.state)}afterRender(d){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(d){}processRender(d){this.stage&&this.computedVisible&&this.doRender(d)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(d,f){if(this.fadeTransitionEnabled&&0!==k){f=this._fadeOutResolver||!this.visible?0:this.opacity;const g=this.computedOpacity;g===f?this.computedVisible=this.visible:(d*=k,this.computedOpacity=g>f?Math.max(f,g-d):Math.min(f,g+d),this.computedVisible=0<this.computedOpacity,d=f===this.computedOpacity,this.inFadeTransition=!d,d||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=
this.visible}onAttach(){}onDetach(){}doRender(d){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}a.DisplayObject=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationUpdateEvent":function(){define(["exports","../../../geometry/support/aaBoundingRect"],function(a,b){class h{constructor(c="scene"){this.context=c;this.extent=b.empty()}}a.ElevationUpdateEvent=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){class b{constructor(h=0,c=0){this.min=h;this.max=c;this.level=0;this.hasNoDataValues=!1}copyFrom(h){this.min=h.min;this.max=
h.max;this.level=h.level;this.hasNoDataValues=h.hasNoDataValues}}a.ElevationBounds=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],function(a,b,h,c,k){class m{constructor(f,g,e){this.type="elevation";this.level=f[0];this.i=f[1];this.j=f[2];this.extent=g;this.samplerData=new h.ElevationSamplerData(e,g)}computeMinMaxValue(f,
g,e,n){n.min=Infinity;n.max=-Infinity;n.hasNoDataValues=!1;f-=this.level;if(0>=f)return n;var l=2**f;if(Math.floor(g/l)!==this.i||Math.floor(e/l)!==this.j)return n;var u=Infinity,x=-Infinity,w=this.samplerData.data.width,q=this.samplerData.data.values,v=.5*k.elevationNodataValue;f=(w-1)/l;e=(e-this.j*l)*f;let p=(g-this.i*l)*f;if(1>f){const y=Math.floor(e),D=Math.floor(p);var t=y+D*w;g=q[t];l=q[t+1];var r=q[t+w];t=q[t+w+1];if(g+l+r+t<v)return u=e-y,v=p-D,x=c.bilerp(g,l,r,t,u,v),w=c.bilerp(g,l,r,t,
u+f,v),q=c.bilerp(g,l,r,t,u,v+f),f=c.bilerp(g,l,r,t,u+f,v+f),n.min=Math.min(x,w,q,f),n.max=Math.max(x,w,q,f),n;e=y;p=D;f=1}else e=Math.floor(e),p=Math.floor(p),f=Math.ceil(f);for(g=e;g<=e+f;g++)for(l=p;l<=p+f;l++)r=q[g+l*w],r<v?(u=Math.min(u,r),x=Math.max(x,r)):n.hasNoDataValues=!0;n.min=u;n.max=x;return n}}const d=.5*k.elevationNodataValue;a.ElevationData=m;a.sampleElevation=function(f,g,e){if(null==e)return null;for(const w of e){if(!w)continue;var n=w.safeWidth;e=b.clamp(w.dy*(w.y1-g),0,n);n=b.clamp(w.dx*
(f-w.x0),0,n);const q=Math.floor(e),v=Math.floor(n);var l=w.data.width,u=q*l+v,x=w.data.values;const p=x[u],t=x[u+1];u+=l;l=x[u];x=x[u+1];if(p+l+t+x<d)return e-=q,n-=v,f=p+(t-p)*n,f+(l+(x-l)*n-f)*e}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){class b{constructor(h,c){this.data=h;this.safeWidth=.99999999*(h.width-1);this.dx=(h.width-1)/(c[2]-c[0]);this.dy=(h.width-1)/(c[3]-c[1]);this.x0=
c[0];this.y1=c[3]}}a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(p,t){return null==p||p.spatialReference.equals(t)?p:g.projectWithoutEngine(p,p.spatialReference,t)}a.ExtentHelper=class extends h{constructor(p){super(p)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const p=
[];this.layerViews.forEach(t=>{t=t.layer;n.isIntegratedMeshOperationalLayer(t.operationalLayerType)&&null!=this.viewSpatialReference&&(t=w(t.fullExtent,this.viewSpatialReference),null!=t&&p.push(e.fromExtent(t)))});return p}};b.__decorate([c.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([c.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([c.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);
b.__decorate([c.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([c.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([c.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);b.__decorate([c.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([c.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelper")],
a.ExtentHelper);let q=class extends a.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?u.webmercatorWorldExtent:u.geographicWorldExtent}};q=b.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],q);let v=class extends a.ExtentHelper{_computeLayerViewsExtent(){const p=e.empty(),t=this.viewSpatialReference;this.layerViews.forEach(D=>{const E=D.layer;
!D.isResolved()||"graphics"===E.type&&E.internal||(D=w("fullExtentInLocalViewSpatialReference"in D&&D.fullExtentInLocalViewSpatialReference||D.layer.fullExtent,t),e.expand(p,D,p))});const r=e.allFinite(p)?p:null,y=this._get("layerViewsExtent");return e.equals(r,y)?y:r}_computeTiledLayersExtent(){const p=this.tilingScheme;if(!p)return null;const t=this.viewSpatialReference,r=e.empty();this.layers.forEach(E=>{if(E.loaded&&n.isTiledLayer(E)){const F=x.getTiledLayerInfo(E,t,l.ViewingMode.Local);if(null!=
F){var {tileInfo:A,fullExtent:B}=F;null!=A&&null!=B&&(x.isProjectableRasterLayer(E)||p.compatibleWith(A)&&B.spatialReference.equals(p.spatialReference))&&e.expand(r,B,r)}}});e.expand(r,this.defaultTiledLayersExtent,r);const y=e.allFinite(r)?r:null,D=this._get("tiledLayersExtent");return e.equals(y,D)?D:y}};v=b.__decorate([f.subclass("esri.views.3d.terrain.ExtentHelperLocal")],v);a.create=function(p,t){return p===l.ViewingMode.Global?new q(t):new v(t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./ITile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,h,c,k,m,d,f,g){function e(E){return"imagery-tile"===E?.type||"wcs"===E?.type}function n(E){return"imagery-tile-3d"===E?.type}function l(E){return"tile-3d"===E?.type}function u(E){return"vector-tile-3d"===
E?.type}function x(E){return"wmts-3d"===E?.type}function w(E){return"elevation-3d"===E?.type}function q(E){return E&&(l(E)||n(E)||u(E)||x(E))}function v(E){return null!=E?.data&&"type"in E.data&&"vector-tile"===E.data.type}function p(E,A,B,F){return y[F].checkIfTileInfoSupportedForViewSR(E,B,A)}function t(E,A,B){E=c.getTileMaxtrixSetFromActiveLayer(E);if(null!=E)if(b.isCollection(E)){if(E=E.find(F=>null==p(F.tileInfo,F.fullExtent,A,B)))return{tileInfo:E.tileInfo,fullExtent:E.fullExtent}}else return{tileInfo:E.tileInfo,
fullExtent:E.fullExtent};return{tileInfo:null,fullExtent:null}}function r(E){return E.isWGS84||E.isWebMercator||h.isCGCS2000(E)||!h.isEarth(E)}const y={[k.ViewingMode.Global]:g.terrainUtilsSpherical,[k.ViewingMode.Local]:f.terrainUtilsPlanar};a.enableTerrainInternalChecks=!1;a.enableWaterproofnessTests=!1;const D={force512VTL:!1};f=[d.NeighborIndex.NORTH,d.NeighborIndex.EAST,d.NeighborIndex.SOUTH,d.NeighborIndex.WEST];g=[d.NeighborIndex.NORTH_EAST,d.NeighborIndex.SOUTH_EAST,d.NeighborIndex.SOUTH_WEST,
d.NeighborIndex.NORTH_WEST];a.almostEquals=function(E,A,B=1E-5){return Math.abs(E-A)<B};a.checkIfTileInfoSupportedForView=p;a.enableInternalTerrainChecks=function(E){a.enableTerrainInternalChecks=E};a.enableTerrainWaterproofnessChecks=function(E){a.enableWaterproofnessTests=E;a.enableTerrainInternalChecks=a.enableTerrainInternalChecks||E};a.eps=1E-5;a.getLayerWithExtentRange=function(E){return n(E)?{fullExtent:E.fullExtent,minScale:E.layer.minScale,maxScale:E.layer.maxScale,tilemapCache:null}:E.layer};
a.getTileInfoAndExtentFromWMTSLayer=t;a.getTiledLayerInfo=function(E,A,B){var F=null;let G=null;if("wmts"===E?.type)E=t(E,A,B),F=E.tileInfo,G=E.fullExtent;else if(G=e(E)?E.getCompatibleFullExtent(A):E.fullExtent,F=B===k.ViewingMode.Local,e(E))F=E.getCompatibleTileInfo(A,G,F);else if("vector-tile"===E?.type){F=F&&!r(A)||D.force512VTL;const H=E.tileInfo.spatialReference.isGeographic;F=F?E.tileInfo:E.tileInfo.getOrCreateCompatible(256,H?1:2)}else F=E.tileInfo;return null!=F&&null!=G&&null==p(F,G,A,B)?
{tileInfo:F,fullExtent:G}:null};a.internalAssert=function(E,A){if(a.enableTerrainInternalChecks&&!E)throw E=Error().stack?.slice(5),console.warn("Terrain internal: "+(A??"")+" at "+E),Error("Assertion failed"+(A?": "+A:""));};a.isBlendableLayerView=function(E){return E&&(l(E)||x(E)||n(E)||u(E))};a.isEast=function(E){return E===d.NeighborIndex.NORTH_EAST||E===d.NeighborIndex.EAST||E===d.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=w;a.isGroupLayerView=function(E){return"group"===E?.type};a.isImageryTileLayerView=
n;a.isImageryTileRenderInfo=function(E){E=E?.sourceLayerInfo?.data;return null!=E&&"type"in E&&"raster-tile"===E.type};a.isMapTileLayerView=q;a.isNorth=function(E){return E===d.NeighborIndex.NORTH_EAST||E===d.NeighborIndex.NORTH||E===d.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(E){return E===d.NeighborIndex.NORTH_WEST||E===d.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=e;a.isRasterTileRenderInfo=function(E){E=E?.sourceLayerInfo?.data;return E instanceof HTMLImageElement||E instanceof
m.ImageWithType||E instanceof HTMLCanvasElement||E instanceof ImageData};a.isSouth=function(E){return E===d.NeighborIndex.SOUTH_EAST||E===d.NeighborIndex.SOUTH||E===d.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(E){return q(E)||w(E)};a.isTextureTileRenderInfo=function(E){E=E?.sourceLayerInfo?.data;return null!=E&&"type"in E&&"tile-texture"===E.type};a.isTileLayerView=l;a.isVectorTileLayerView=u;a.isVectorTilePerLayerInfo=v;a.isVectorTileRenderInfo=function(E){return v(E?.sourceLayerInfo)||
!!E?.isVTLBackground};a.isWMTSLayerView=x;a.isWest=function(E){return E===d.NeighborIndex.NORTH_WEST||E===d.NeighborIndex.WEST||E===d.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(E){return E===d.NeighborIndex.NORTH_WEST||E===d.NeighborIndex.SOUTH_WEST};a.lij2s=function(E){return"["+E[0]+","+E[1]+","+E[2]+"]"};a.neighborCornerIndices=g;a.neighborEdgeIndices=f;a.oppositeCorner=function(E){return E===d.NeighborIndex.NORTH_EAST?d.NeighborIndex.SOUTH_WEST:E===d.NeighborIndex.NORTH_WEST?d.NeighborIndex.SOUTH_EAST:
E===d.NeighborIndex.SOUTH_WEST?d.NeighborIndex.NORTH_EAST:d.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(E){return E===d.NeighborIndex.NORTH?d.NeighborIndex.SOUTH:E===d.NeighborIndex.EAST?d.NeighborIndex.WEST:E===d.NeighborIndex.SOUTH?d.NeighborIndex.NORTH:d.NeighborIndex.EAST};a.releaseTileData=function(E){null!=E&&"release"in E&&E.release();return null};a.test=D;a.useFetchTileForLayer=function(E){return E.fetchTile&&!1!==E.hasOverriddenFetchTile};a.v32s=function(E){return"("+E[0]+","+E[1]+
","+E[2]+")"};a.vtlAssumes256PixelSizeAsDefault=r;a.weakAssert=function(E,A){E||console.warn("Terrain: "+A)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ITile":function(){define(["exports"],function(a){a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";
b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,h,c,k,m,d,f){function g(v,p,t=0){v=v.extent;return null==v?!1:0===t?m.containsPoint(v,p):m.containsPointWithMargin(v,p,t*Math.min(v[2]-v[0],v[3]-v[1]))}function e(v,p,t,r){h.copy(u,t);u[r]=p[r];r=h.subtract(u,u,p);var y=h.subtract(x,v,p);y=h.dot(y,r);const D=h.dot(r,r);p=0>=y?p:D<=y?t:h.add(u,p,h.scale(r,r,y/D));v=h.subtract(u,v,p);return Math.PI/2-Math.atan(v[2]/Math.sqrt(v[0]*v[0]+v[1]*v[1]))}function n(v,p,t){v=v.extent;if(null==v)return 0;w[0]=v[0];w[1]=v[1];w[2]=t;q[0]=v[2];q[1]=
v[3];q[2]=t;v=t=Infinity;p[0]<w[0]?t=e(p,w,q,0):p[0]>q[0]&&(t=e(p,q,w,0));p[1]<w[1]?v=e(p,w,q,1):p[1]>q[1]&&(v=e(p,q,w,1));return Math.min(t,v)}function l(v,p,t){if(null==v)return f.getMissingTileInfoError();if(v.spatialReference.isGeographic&&!k.canProjectToWGS84ComparableLonLat(v.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var r=f.TilingScheme.checkUnsupported(v);if(null!=r)return r;if(null==
t)return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var y=v.lods;r=y[0].resolution*2**y[0].level;var D=[r*v.size[0],r*v.size[1]];const E=[v.origin.x,v.origin.y];t=m.fromExtent(t);const A=m.create();f.TilingScheme.computeRowColExtent(t,D,E,A);D=(A[2]-A[0])*(A[3]-A[1]);D>d.maxRootTiles?(y=y[0].scale*2**y[0].level,r=Math.max((t[3]-t[1])/v.size[1],(t[2]-t[0])/v.size[0])*y/r,t=Math.floor(Math.log(r)/Math.log(10)),r=Math.ceil(r/10**t)*10**t,r=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:r,requiredNumRootTiles:D,allowedNumRootTiles:d.maxRootTiles})):r=null}if(r)return r;v=v.spatialReference;return null==p||v.equals(p)||p.isWGS84&&v.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const u=c.create(),
x=c.create(),w=c.create(),q=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:l,isInsideExtent:g,tiltToExtentEdge:n},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=l;a.isInsideExtent=g;a.terrainUtilsPlanar=c;a.tiltToExtentEdge=n})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,
b,h,c,k){function m(){return!0}function d(){return 0}function f(e,n){if(null==e)return k.getMissingTileInfoError();const l=e.lods.length-1,u=e.spatialReference,x=h.canProjectToWGS84ComparableLonLat(u)||c.isMars(u)||c.isMoon(u);if(u.isWebMercator){if(!k.TilingScheme.makeWebMercatorAuxiliarySphere(l).compatibleWith(e))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(x){if(!k.TilingScheme.makeGCSWithTileSize(e.spatialReference,
e.size[0],l).compatibleWith(e))return e.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(null!=n&&!e.spatialReference.equals(n))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const g=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:f,isInsideExtent:m,tiltToExtentEdge:d},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=f;a.isInsideExtent=m;a.terrainUtilsSpherical=g;a.tiltToExtentEdge=d})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/requireUtils ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q){const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let ia;a.OverlayManager=class extends h{constructor(fa){super(fa);this._renderSR=this._spatialReference=null;this._overlaySREqualsRenderSR=!0;this._drapeSources=new Set;this._drapeTargets=new Set;this._drawTexturesAnimateDirty=this._drawTexturesDirty=this._contentUpdated=
this._placementDirty=!1;this._longitudeCyclical=null;this._latestOriginId=0;this._maxResolution=k("esri-mobile")?2048:4096;this._animationTimeLast=0}initialize(){const fa=this.view;this.renderer=new C.OverlayRenderer({view:fa,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});fa._stage.renderer.plugins.add(this.renderer);const aa=()=>this.setDrawTexturesDirty();this._groundIntersector=J.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this.addHandles([f.watch(()=>this.renderer.hasHighlights,aa),this.renderer.events.on("has-water",Z=>fa._stage?.renderer.setParameters({hasOverlayWater:Z})),this.renderer.events.on("content-changed",aa),f.watch(()=>fa.state.camera.pixelRatio,aa),f.watch(()=>fa.state.alignPixelEnabled,aa),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),f.watch(()=>[fa.pointsOfInterest?.renderPointOfView,
fa.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),f.watch(()=>[fa.state?.pixelRatio,fa.state?.contentPixelRatio],()=>this.setPlacementDirty(),f.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),fa.on("resize",()=>this.setPlacementDirty()),fa.resourceController.scheduler.registerTask(V.TaskPriority.OVERLAY,this),fa._stage.renderView.events.on("force-camera-for-screenshot",Z=>{this._updateOverlays(V.noBudget,Z.camera,z.RenderRequestType.BACKGROUND);
this.renderer.hasOverlays&&this._drawOverlays(z.RenderRequestType.BACKGROUND,Z)})]);fa._stage.renderer.renderOverlay=Z=>this._renderOverlay(Z)}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{});ia&&(ia.hide(),ia=null);this.renderer=d.destroyMaybe(this.renderer)}get running(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||G.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&
!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(fa){this._contentUpdated=
!1;this.renderer.processSyncDrapeSources();if(this.renderer.hasOverlays)return this._dispatchAnimationUpdate(fa),this._drawOverlays(z.RenderRequestType.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(fa){this._spatialReference=fa;this.renderer.spatialReference=fa;this._longitudeCyclical=null;const aa=this.view.renderSpatialReference;null!=fa&&null!=aa?(this._renderSR=aa,this._overlaySREqualsRenderSR=fa.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=
fa.isWebMercator?new c.Cyclical(-2.0037508342787E7,2.0037508342787E7):new c.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(fa,aa,Z){this._drapeSources.add(fa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);aa=this.renderer.createDrapeSourceRenderer(fa,aa,Z);this._updateDrapeSourceExtent(fa);this._setContentDirty();this.notifyChange("running");
return aa}registerGeometryDrapeSource(fa){return this.registerDrapeSource(fa,M.SortedRenderGeometryRenderer)}_updateDrapeSourceExtent(fa){2===this.renderer.overlays.length&&null!=fa.setDrapingExtent&&null!=this._spatialReference&&fa.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(fa){this._drapeSources.has(fa)&&(this._drapeSources.delete(fa),this.renderer.removeDrapeSourceRenderer(fa),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),
this.notifyChange("running"))}registerDrapeTarget(fa){this._drapeTargets.add(fa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(fa){this._drapeTargets.delete(fa);this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty();this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(fa){return this._updateOverlays(fa,this.view.state.contentCamera,z.RenderRequestType.UPDATE)}_updateOverlays(fa,aa,Z){if(!this._spatialReference)return Q.Yield;
var ea=this._computeOverlayResolution(aa);this._computeOverlayExtents(aa,ea,R);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,R.stretch);aa=this._updateOverlay(L.OverlayIndex.INNER,R.inner,ea,1*R.pixelRatioAdjustment,R.mapUnitsPerPixel);const ca=y.width(R.inner)/y.width(R.outer);ea=this._updateOverlay(L.OverlayIndex.OUTER,R.outer,ea,ca*R.pixelRatioAdjustment,R.mapUnitsPerPixel);if(aa===ha.EXTENT||ea===ha.EXTENT)this._drapeSources.forEach(W=>this._updateDrapeSourceExtent(W)),this.surface.updateTileOverlayParams(Z);
aa===ha.NONE&&ea===ha.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;fa.madeProgress()}_computeOverlayResolution(fa){const aa=this.view.state.contentPixelRatio*this.view.resolutionScale;return Math.min(S.applyTextureResizeModulo(Math.ceil(1.5*Math.max(fa.fullWidth/fa.pixelRatio*aa,fa.fullHeight/fa.pixelRatio*aa))),this._maxResolution)}_updateOverlay(fa,aa,Z,ea,ca){if(0===this.renderer.overlays.length)return ha.NONE;fa=this.renderer.overlays[fa];const W=fa.mapUnitsPerPixel;fa.mapUnitsPerPixel=
ca;fa.pixelRatio=ea;ea=fa.extent;const Y=G.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(aa[2]-aa[0],aa[3]-aa[1],ea[2]-ea[0],ea[3]-ea[1]);if(Math.abs(ea[0]-aa[0])<=Y&&Math.abs(ea[1]-aa[1])<=Y&&Math.abs(ea[2]-aa[2])<=Y&&Math.abs(ea[3]-aa[3])<=Y&&Z===fa.resolution)return W===ca?ha.NONE:ha.RERENDER_ONLY;y.copy(fa.extent,aa);fa.resolution=Z;aa=y.center(fa.extent);fa.renderLocalOrigin=K.fromValues(aa[0],aa[1],0,`OV_${this._latestOriginId++}`);return ha.EXTENT}setTileParameters(fa){const aa=fa.renderData.overlay;
if(0<this.renderer.overlays.length){const Z=this.renderer.overlays[L.OverlayIndex.INNER],ea=this.renderer.overlays[L.OverlayIndex.OUTER];fa=fa.extent;this._rectInsideRect(Z.extent,fa)||this._rectanglesOverlap(fa,Z.extent)||this._rectanglesOverlap(fa,ea.extent)?(this._setTileOverlayData(fa,L.OverlayIndex.INNER,aa),this._setTileOverlayData(fa,L.OverlayIndex.OUTER,aa)):(this._clearTileOverlayData(L.OverlayIndex.INNER,aa),this._clearTileOverlayData(L.OverlayIndex.OUTER,aa))}else this._clearTileOverlayData(L.OverlayIndex.INNER,
aa),this._clearTileOverlayData(L.OverlayIndex.OUTER,aa)}overlayPixelSizeInMapUnits(fa,aa){if(0===this.renderer.overlays.length)return aa();aa=this.renderer.overlays[L.OverlayIndex.INNER];const Z=this.renderer.overlays[L.OverlayIndex.OUTER];fa=this._pointIsInExtent(fa,aa.extent)?aa:Z;return(fa.extent[2]-fa.extent[0])/fa.resolution}_setTileOverlayData(fa,aa,Z){if(0!==this.renderer.overlays.length){var ea=this.renderer.overlays[aa].extent,ca=y.width(ea),W=y.height(ea),Y=fa[0];if(this._longitudeCyclical){Y=
this._longitudeCyclical.minimalMonotonic(ea[0],Y);const ja=this._longitudeCyclical.minimalMonotonic(ea[0],fa[2]);Y>ja&&(Y=ja-(fa[2]-fa[0]))}Z.setScale(aa,y.width(fa)/ca,y.height(fa)/W);Z.setOffset(aa,(Y-ea[0])/ca,(fa[1]-ea[1])/W)}}_clearTileOverlayData(fa,aa){aa.setScale(fa,-1,-1);aa.setOffset(fa,-1,-1)}async reloadShaders(){N.removeLoadedShaderModules();await this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(V.noBudget)}_dispatchAnimationUpdate(fa){var aa=g.Milliseconds(fa-this._animationTimeLast);
if(aa>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty)aa=g.Milliseconds(aa/this.surface.view._stage.renderer.animationTimeDilation),aa=new I.UpdateParameters(this.view.state.camera,aa,this.view.state.forcedAnimationTime),this.renderer.updateAnimation(aa)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=fa}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=
!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(fa,aa,Z,ea){Z=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(fa,da,aa,Z);if(null==Z)return!1;aa=Z.origin;Z=w.add(P,Z.origin,Z.direction);this._groundIntersector.reset(aa,Z,fa);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,null,aa,Z);return this._groundIntersector.results.min.getIntersectionPoint(ea)}_findHorizonBasedPointOfInterest(fa,
aa){var Z=.5;Z=this.view.renderCoordsHelper.getAltitude(fa.eye);const ea=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ca=m.clamp(ea.estimatedSurfaceAltitude,fa.aboveGround?-Infinity:Z+1E-5,fa.aboveGround?Z-1E-5:Infinity);Z=fa.aboveGround;if("global"===this.view.viewingMode){var W=P;E.closestPointOnSilhouette(E.fromRadius(E.tmpSphere,t.getReferenceEllipsoid(this.view.spatialReference).radius+ca),D.wrap(fa.eye,fa.viewForward),W);w.subtract(W,W,fa.eye);ca=c.cyclicalPI.normalize(A.angleAroundAxis(fa.viewForward,
W,fa.viewRight))/fa.fovY+.5;W=0>=ca||1<=ca?.5:.55;Z=Z?W*ca:ca+W*(1-ca)}else ca=p.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-fa.viewForward[2])),1,0),ca=v.transformMat4(ca,ca,fa.projectionMatrix)[1],ca=m.clamp(.5+.5*ca,0,1),Z=1===ca||0===ca?.5:Z?.55*ca:1-.55*(1-ca);return this._intersectGroundFromView(fa,.5,Z,aa)?w.sqrDist(aa,fa.eye)<ea.distance*ea.distance:!1}_computeOverlayExtents(fa,aa,Z){var ea=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ca=q.create();this._findHorizonBasedPointOfInterest(fa,
ca)||w.copy(ca,ea);G.debugFlags.OVERLAY_SHOW_CENTER?(null==ia&&(ia=new H.PointGraphics(this.view.graphics,"red")),ia.show(ca,this._renderSR)):null!=ia&&ia.hide();var W=Math.max(.1,w.distance(fa.eye,ca));const Y=F.viewAngle(this.view.renderCoordsHelper,ea,fa.eye);this._overlaySREqualsRenderSR||r.projectVectorToVector(ca,this._renderSR,ca,this._spatialReference);ea=this.surface.extent;var ja=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,oa=ja&&this._spatialReference?
1/t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;W=fa.perScreenPixelRatio/this.view.state.contentPixelRatio*W*oa;Z.mapUnitsPerPixel=W/this._worldToPCSRatio;Z.stretch=this._overlayStretch;W=aa*W/2*Z.stretch;var ra=!1;ja=ja?90:Infinity;this._isSpherical&&ea&&this._spatialReference&&(this._spatialReference.isWebMercator?(W/=Math.cos(B.y2lat(ca[1])),ja=ea[3]):(ra=!0,W/=t.getReferenceEllipsoid(this._spatialReference).metersPerDegree,ja=90),W>=ja&&(W=ja,ca[1]=0,this._spatialReference.isWebMercator&&
(ca[0]=0)));oa=1;ra&&(oa=1/Math.max(.2,Math.cos(Math.abs(m.deg2rad(ca[1])))),180<W*oa&&(oa=180/W),Z.mapUnitsPerPixel*=oa);ra=Math.log(2)/12;W=Math.exp(Math.round(Math.log(W)/ra)*ra);const ta=W*oa;ra=.5*aa/(32*ta);var ya=.5*aa/(32*W);ca[0]=Math.round(ca[0]*ra)/ra;ca[1]=Math.round(ca[1]*ya)/ya;ra=Z.inner;ra[0]=ca[0]-ta;ra[1]=ca[1]-W;ra[2]=ca[0]+ta;ra[3]=ca[1]+W;this._isSpherical&&this._shiftExtentToFitBounds(ra,Infinity,ja);ya=Z.outer;6*ta>y.width(ea)?y.copy(ya,ea):Math.PI/2-Math.abs(Y-Math.PI/2)<=
.25*Math.PI?(ya[0]=ra[0]-ta,ya[1]=ra[1]-W,ya[2]=ra[2]+ta,ya[3]=ra[3]+W):(r.projectVectorToVector(fa.eye,this._renderSR,P,this._spatialReference),x.subtract(U,ca,P),fa=-Math.atan2(U[1],U[0])+.125*Math.PI,0>fa&&(fa+=2*Math.PI),v.scale(U,T[Math.floor(fa/(.25*Math.PI))],2*W),U[0]*=oa,U[2]*=oa,v.add(ya,ra,U));this._isSpherical?(ya[0]=this._longitudeCyclical.clamp(ya[0]),ya[2]=this._longitudeCyclical.clamp(ya[2]),ya[1]=Math.max(ya[1],-ja),ya[3]=Math.min(ya[3],ja)):(fa=y.intersection(ra,ea,ba),ea=y.intersection(ya,
ea,X),y.contains(fa,ea)&&(ya[2]=ya[0],ya[3]=ya[1]));aa=Math.abs(ra[2]-ra[0])/aa;Z.mapUnitsPerPixel=Math.max(Z.mapUnitsPerPixel,aa);Z.pixelRatioAdjustment=Z.mapUnitsPerPixel/aa}_drawOverlays(fa,aa){if(this.renderer.hasOverlays){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;var Z=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;var ea=this.renderer.computeValidity();this.renderer.releaseRenderTargets();this.renderer.drawOverlays(aa);
aa=this.renderer.computeValidity();ea!==aa&&this.surface.updateTileOverlayParams(z.RenderRequestType.UPDATE);Z?(this.surface.requestRender(fa),fa===z.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(z.RenderRequestType.BACKGROUND);return this.renderer}}_rectanglesOverlap(fa,aa){return null==fa?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(aa[0],aa[2],fa[0])||this._longitudeCyclical.contains(aa[0],aa[2],fa[2])||this._longitudeCyclical.contains(fa[0],
fa[2],aa[0]))&&!(fa[1]>aa[3]||fa[3]<aa[1]):y.intersects(fa,aa)}_rectInsideRect(fa,aa){return null==aa?!1:this._longitudeCyclical?this._longitudeCyclical.contains(fa[0],fa[2],aa[0])&&this._longitudeCyclical.contains(fa[0],fa[2],aa[2])&&aa[1]>fa[1]&&aa[3]<fa[3]:y.contains(fa,aa)}_pointIsInExtent(fa,aa){if(this._longitudeCyclical)return this._longitudeCyclical.contains(aa[0],aa[2],fa.x)&&fa.y>=aa[1]&&fa.y<=aa[3];const Z=fa.x;fa=fa.y;return Z>aa[0]&&Z<aa[2]&&fa>aa[1]&&fa<aa[3]}_shiftExtentToFitBounds(fa,
aa,Z){let ea=0,ca=0;fa[0]<-aa?ea=fa[0]+aa:fa[2]>aa&&(ea=aa-fa[2]);fa[1]<-Z?ca=fa[1]+Z:fa[3]>Z&&(ca=Z-fa[3]);y.offset(fa,ea,ca)}get test(){return{renderer:this.renderer,update:()=>this.runTask(V.noBudget)}}};b.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);b.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);b.__decorate([e.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([e.property()],a.OverlayManager.prototype,
"_contentUpdated",void 0);b.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);b.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([e.property()],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);b.__decorate([e.property()],a.OverlayManager.prototype,"suspended",
null);b.__decorate([e.property()],a.OverlayManager.prototype,"updating",null);b.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccludedDraped",null);a.OverlayManager=b.__decorate([u.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);class O{constructor(){this.inner=y.create();this.outer=y.create();this.mapUnitsPerPixel=0;this.pixelRatioAdjustment=1;this.stretch=1.3}}const U=p.create(),P=q.create(),R=new O,ba=y.create(),X=y.create(),da=D.create();var ha;
(function(fa){fa[fa.NONE=0]="NONE";fa[fa.EXTENT=1]="EXTENT";fa[fa.RERENDER_ONLY=2]="RERENDER_ONLY"})(ha||={});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const h=Object.keys(b);for(const c of h)c.includes(".glsl")&&delete b[c]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/SpatialReference ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./ITile ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends e.Tile{constructor(x,w,q,v,p){super();this._horizontalScaleFactor=1;this._extentInRenderSR=m.create();this._baseUsedMemory=900;this.init(x,w,q,v,p)}init(x,w,q,v,p){super.init(x,w,q,v,p);x=p.view.renderSpatialReference;w=p.spatialReference;this._horizontalScaleFactor=x=null!=x&&d.isPlateCarree(x)&&null!=w&&w.isGeographic?this.ellipsoid.radius*Math.PI/180:1;({isWebMercatorOnPlateCarree:q}=p);p=this._extentInRenderSR;w=this.extent;if(q)x=b.fromValues(w[0],
w[1],0),c.projectVectorToVector(x,h.WebMercator,x,h.PlateCarree),w=b.fromValues(w[2],w[3],0),c.projectVectorToVector(w,h.WebMercator,w,h.PlateCarree),p[0]=x[0],p[1]=x[1],p[2]=w[0],p[3]=w[1];else for(q=0;4>q;++q)p[q]=w[q]*x;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]);this.centerAtSeaLevel[1]=.5*(p[1]+p[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();var x=this._extentInRenderSR;
const w=.5*(x[2]-x[0]);x=.5*(x[3]-x[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(w*w+x*x),.5*(this.elevationBounds[0]-this.elevationBounds[1]))}_calculateFrustumVisibilityStatus(x){var w=this._aabb();const q=w[0],v=w[1],p=w[2],t=w[3],r=w[4];w=w[5];let y=!0;for(let E=0;6>E;E++){var D=x[E];const A=D[0],B=D[1],F=D[2];D=D[3];if(0<=A*(0<A?q:t)+B*(0<B?v:r)+F*(0<F?p:w)+D)return f.TileFrustumVisibility.OUTSIDE;y=y&&0>=A*(0>A?q:t)+B*(0>B?v:r)+F*(0>F?p:w)+D}return y?f.TileFrustumVisibility.INSIDE:
f.TileFrustumVisibility.INTERSECTS}_aabb(){const x=this._extentInRenderSR;return k.wrap(x[0],x[1],this.elevationBounds[0],x[2],x[3],this.elevationBounds[1])}intersectsRay(x,w,q,v){u[0]=1/w[0];u[1]=1/w[1];u[2]=1/w[2];return n.intersectAabbInvDirBefore(this._aabb(),x,u,q,v)}createGeometry(){g.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()}getDefaultVerticesPerSide(){return 9>this.level?3:2}updateCornerElevations(){g.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){g.updateEdgesAndCornersPlanar(this.renderData,
this._horizontalScaleFactor)}updateEdgeElevationsAndResolutions(){g.updateEdgeElevationsAndResolutionsPlanar(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}}const u=b.create();a.PlanarPatch=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./ITile ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(X,da,ha){const {tile:fa,localOrigin:aa,geometry:Z}=X,{extent:ea,ellipsoid:ca}=fa,{boundingBox:W,numVerticesPerSide:Y,vertexAttributes:ja,poleVerticesStartIndex:oa}=Z,ra=Y-1,ta=aa[0],ya=aa[1],Ca=aa[2],pa=ca.radius,wa=ea[1],Ba=ea[3],la=[];let qa=oa;X=(ua,va)=>{va*=Y;N(-ta,-ya,-Ca+ua*pa,W);la.push({connectedRowOffset:va,connectedOuterEdgeOffset:1===ua?0:2,rowOffset:qa,latitudeResolution:6});va=Math.PI/2-2*Math.atan(Math.exp(-(-1===ua?wa:Ba)/pa));const Ga=
ua*Math.PI/2-va;ua=.99*(1===ua?1:-1);const La=pa+0,{position:Na,uv0:Wa}=ja,{typedBuffer:Ia,typedBufferStride:Oa}=ja.normalCompressed;for(let Va=1;6>=Va;++Va){var Ua=va+Va/6*Ga;const Ra=Math.cos(Ua);Ua=Math.sin(Ua);for(let bb=0;bb<=ra;bb++){const gb=bb/ra,db=O.cosLonLUT[bb]*Ra,ka=O.sinLonLUT[bb]*Ra,mb=Ua,sb=db*La-ta,tb=ka*La-ya,xa=mb*La-Ca;N(sb,tb,xa,W);Na.setValues(qa,sb,tb,xa);f.encodeUVInBuffer(Wa,qa,gb,ua);x.compressNormal(Ia,qa,db,ka,mb,Oa);++qa}}};da&&X(-1,0);ha&&X(1,ra);return la}function q(X){X.tile.intersectsClippingArea&&
(J(X),v(X))}function v(X,da=!1){const {geometry:ha,geometryState:fa,tile:aa,localOrigin:Z}=X,{level:ea,extent:ca,extentInRadians:W,ellipsoid:Y}=aa,ja=Y.radius,oa=W[0],ra=W[2],ta=W[1],ya=W[3],{samplerData:Ca}=fa,pa=ca[0],wa=ca[2],Ba=ca[1],la=ca[3],qa=p(X),{boundingBox:ua,vertexAttributes:va}=ha,Ga=Z[0],La=Z[1],Na=Z[2];var Wa=va.position;const Ia=Wa.typedBuffer,Oa=Wa.typedBufferStride,Ua=va.uv0;for(let db=0;4>db;++db){const ka=1===db||3===db;Wa=fa.edgeResolutions[db];n.internalAssert(b.isPowerOfTwo(Wa));
const mb=Wa+1;var Va=e.neighborTileIfLoadedOrSelf(aa,fa.edgePeerNeighbors[db]);if(S(aa,Va,db)){z(X,db,Va);continue}const sb=null!=Va;n.internalAssert(!sb||Va.level===aa.level);n.internalAssert(!sb||0>=u.compareTilesByLij(aa,Va));var Ra=Va?.renderData?.geometryState;if(n.enableTerrainInternalChecks){var bb=aa.surface;if(!Va&&bb&&!bb.updatingRootTiles){var gb=n.neighborEdgeIndices[db];const pb=aa.findNeighborTile(gb,Db=>Db.isLoaded||Db.isLeaf||Db.level===aa.level);pb?pb.intersectsClippingArea&&(n.internalAssert(!pb.isLoaded),
n.internalAssert(!pb.isLeaf),n.internalAssert(pb.level===ea)):n.internalAssert(null==bb?.rootTiles||!aa.shouldHaveNeighbor(gb))}}const tb=1===db?ca[2]:ca[0],xa=(Va=Va?.extent)&&ka?1===db?Va[0]:Va[2]:tb,Ha=0===db?ca[3]:ca[1],na=1===db?1:0,za=0===db?1:0,Da=1===db?ra:oa,Ma=0===db?ya:ta,Xa=Math.sin(Da),ab=Math.cos(Da),Ja=Math.sin(Ma),Qa=Math.cos(Ma),Sa=Ra?.samplerData;Ra=(pb,Db,Jb)=>k.sampleElevation(pb,Db,Ca);bb=(pb,Db,Jb)=>.5*(k.sampleElevation(pb,Db,Ca)+k.sampleElevation(Jb,Db,Sa));const cb=sb?bb:
Ra;Ra=ha.outerEdgesOffsetAndLength[2*db];const eb=da&&3<mb?mb-3:1;bb=null!=Ca&&Ca.some(pb=>null!=pb);gb=null!=Sa&&Sa.some(pb=>null!=pb);const lb=bb||gb,rb=1/Wa,vb=Ra;n.internalAssert(!Va||n.almostEquals(Va[2]-Va[0],ca[2]-ca[0]));(()=>{const pb=1===db?-1:3===db?1:0,Db=0===db?-1:2===db?1:0,Jb=(ca[2]-ca[0])*rb,Rb=pb*Jb,ac=Db*Jb,kc=ra-oa,gc=ka?pb*kc*rb:0,Fb=ka?0:Db*rb,Tb=za,Ob=ka?Da+gc:Da,Ub=ka?Math.sin(Ob):Xa,jb=ka?Math.cos(Ob):ab,sa=ka?Da-gc:Da,Fa=ka?Math.sin(sa):Xa,Pa=ka?Math.cos(sa):ab,Ta=ka?Ma:qa(Tb+
Fb),$a=ka?Ja:Math.sin(Ta),hb=ka?Qa:Math.cos(Ta),ib=ka?Ma:qa(Tb-Fb),ob=ka?Ja:Math.sin(ib),qb=ka?Qa:Math.cos(ib);let yb=0,wb=0,Bb=0;const zb=0*rb,Sb=ka?tb:pa*(1-zb)+wa*zb,nb=ka?xa:Sb,xb=ka?Ba*(1-zb)+la*zb:Ha,Ab=ka?Da:oa*(1-zb)+ra*zb,Nb=ka?Xa:Math.sin(Ab),cc=ka?ab:Math.cos(Ab),hc=ka?qa(zb):Ma,ec=ka?Math.sin(hc):Ja,fc=ka?Math.cos(hc):Qa,Lb=ja+cb(Sb,xb,nb);yb=cc*fc*Lb;wb=Nb*fc*Lb;Bb=ec*Lb;let Mb=0,Vb=0,Wb=0;const Kb=1*rb,Zb=ka?tb:pa*(1-Kb)+wa*Kb,$b=ka?xa:Zb,Cb=ka?Ba*(1-Kb)+la*Kb:Ha,Pb=ka?Da:oa*(1-Kb)+
ra*Kb,Hb=ka?Xa:Math.sin(Pb),xc=ka?ab:Math.cos(Pb),Qb=ka?qa(Kb):Ma,dc=ka?Math.sin(Qb):Ja,vc=ka?Math.cos(Qb):Qa,nc=ja+cb(Zb,Cb,$b);Mb=xc*vc*nc;Vb=Hb*vc*nc;Wb=dc*nc;for(let lc=1;lc<mb-1;lc+=eb){let tc=0,yc=0,Ac=0;const uc=(lc+1)*rb,Pc=ka?tb:pa*(1-uc)+wa*uc,Xc=ka?xa:Pc,zc=ka?Ba*(1-uc)+la*uc:Ha,Bc=ka?Da:oa*(1-uc)+ra*uc,Qc=ka?Xa:Math.sin(Bc),Gc=ka?ab:Math.cos(Bc),Cc=ka?qa(uc):Ma,Rc=ka?Math.sin(Cc):Ja,Sc=ka?Math.cos(Cc):Qa,zd=ja+cb(Pc,zc,Xc);tc=Gc*Sc*zd;yc=Qc*Sc*zd;Ac=Rc*zd;const Zd=tc,$d=yc,ae=Ac,Ad=Mb,
Bd=Vb,Yc=Wb;Mb=Zd;Vb=$d;Wb=ae;const vd=vb+lc,Cd=vd*Oa,be=Ad-Ga,ce=Bd-La,de=Yc-Na;Ia[Cd]=be;Ia[Cd+1]=ce;Ia[Cd+2]=de;N(be,ce,de,ua);const ee=lc*rb;f.encodeUVInBuffer(Ua,vd,ka?na:ee,ka?ee:za);const fe=yb,Xe=wb,Ye=Bb;yb=Ad;wb=Bd;Bb=Yc;const Tc=Ad,Zc=Bd,Hc=Yc,$c=1/Math.sqrt(Tc*Tc+Zc*Zc+Hc*Hc),ge=Hc*$c;let Uc=0,Vc=0,Wc=0;if(lb&&.999>ge*ge){let Dd=0,Ed=0,Fd=0;const Gd=0===db?-1:1;Dd=Gd*(Zd-fe);Ed=Gd*($d-Xe);Fd=Gd*(ae-Ye);const Ic=lc*rb,he=ka?tb:pa*(1-Ic)+wa*Ic,Ze=ka?xa:he,ie=ka?Ba*(1-Ic)+la*Ic:Ha,je=ka?
Da:oa*(1-Ic)+ra*Ic,ke=ka?Xa:Math.sin(je),le=ka?ab:Math.cos(je),me=ka?qa(Ic):Ma,ne=ka?Math.sin(me):Ja,oe=ka?Math.cos(me):Qa;let Hd=Tc,Id=Zc,Jd=Hc;if(sb){const Kd=ja+k.sampleElevation(Ze-Rb,ie-ac,Sa),$e=ka?Fa:ke,af=ka?ne:ob,pe=ka?oe:qb;Hd=(ka?Pa:le)*pe*Kd;Id=$e*pe*Kd;Jd=af*Kd}const Ld=ja+k.sampleElevation(he+Rb,ie+ac,Ca),qe=ka?oe:hb,re=(ka?jb:le)*qe*Ld,se=(ka?Ub:ke)*qe*Ld,te=(ka?ne:$a)*Ld;sb||(Hd=2*Tc-re,Id=2*Zc-se,Jd=2*Hc-te);const Md=3===db?-1:1,ue=Md*(Hd-re),ve=Md*(Id-se),we=Md*(Jd-te);Uc=Fd*ve-
Ed*we;Vc=Dd*we-Fd*ue;Wc=Ed*ue-Dd*ve;const Nd=1/Math.sqrt(Uc*Uc+Vc*Vc+Wc*Wc);Uc*=Nd;Vc*=Nd;Wc*=Nd}else Uc=Tc*$c,Vc=Zc*$c,Wc=Hc*$c;ha.setEdgeNormalFromValues(db,lc,Uc,Vc,Wc)}})()}}function p(X){({tile:X}=X);if(X.surface.isWebMercator){const ha=X.extent,fa=X.ellipsoid.radius;return aa=>Math.PI/2-2*Math.atan(Math.exp(-(ha[1]*(1-aa)+ha[3]*aa)/fa))}const da=X.extentInRadians;return ha=>da[1]*(1-ha)+da[3]*ha}function t(X,da){X.tile.intersectsClippingArea&&(J(X),r(X,!1))}function r(X,da){const {geometry:ha,
geometryState:fa,tile:aa,localOrigin:Z}=X,{surface:ea,extent:ca}=aa,{clippingArea:W,samplerData:Y}=fa,ja=null!=W?W:U,oa=ca[0],ra=ca[2],ta=ca[1],ya=ca[3],Ca=[ya>ja[3],ra>ja[2],ta<ja[1],oa<ja[0]],pa=aa.horizontalScale,wa=y(ea.isWebMercatorOnPlateCarree,aa.ellipsoid.radius,pa),{minu:Ba,minv:la,maxu:qa,maxv:ua,boundingBox:va}=ha,Ga=Math.max(oa,ja[0]),La=Math.min(ra,ja[2]),Na=Math.max(ta,ja[1]),Wa=Math.min(ya,ja[3]),Ia=Z[0],Oa=Z[1],Ua=Z[2];for(let Va=0;4>Va;++Va){const Ra=1===Va||3===Va,bb=fa.edgeResolutions[Va];
n.internalAssert(b.isPowerOfTwo(bb));const gb=bb+1,db=Ca[Va],ka=e.neighborTileIfLoadedOrSelf(aa,fa.edgePeerNeighbors[Va]);if(!db&&S(aa,ka,Va)){z(X,Va,ka);continue}const mb=null!=ka&&!db,sb=ka?.renderData?.geometryState;if(n.enableTerrainInternalChecks&&(n.internalAssert(!mb||ka.level===aa.level),n.internalAssert(!mb||0>=u.compareTilesByLij(aa,ka)),aa&&!ka&&!ea.updatingRootTiles)){const Pa=n.neighborEdgeIndices[Va],Ta=aa.findNeighborTile(Pa,$a=>$a.isLoaded||$a.isLeaf||$a.level===aa.level);ea.updatingRootTiles||
(Ta?Ta.intersectsClippingArea&&(n.internalAssert(!Ta.isLoaded),n.internalAssert(!Ta.isLeaf),n.internalAssert(Ta.level===aa.level)):n.internalAssert(null==ea?.rootTiles||!aa.shouldHaveNeighbor(Pa)))}const tb=b.clamp(1===Va?ra:oa,Ga,La),xa=b.clamp(0===Va?ya:ta,Na,Wa),Ha=sb?.samplerData,na=da&&3<gb?gb-3:1,za=b.clamp(1===Va?1:0,Ba,qa),Da=b.clamp(0===Va?1:0,la,ua),Ma=(Pa,Ta)=>k.sampleElevation(Pa,Ta,Y),Xa=(Pa,Ta)=>.5*(k.sampleElevation(Pa,Ta,Ha)+k.sampleElevation(Pa,Ta,Y)),ab=mb?Xa:Ma,Ja=(ra-oa)/bb,Qa=
Ra?1===Va?Ja:-Ja:0,Sa=Ra?0:0===Va?Ja:-Ja,cb=-Qa,eb=-Sa;let lb=0,rb=0,vb=0;const pb=0/bb,Db=Ra?tb:b.clamp(oa*(1-pb)+ra*pb,Ga,La),Jb=Ra?b.clamp(ta*(1-pb)+ya*pb,Na,Wa):xa,Rb=ab(Db,Jb);lb=Db*pa;rb=wa(Jb);vb=Rb;let ac=0,kc=0,gc=0;const Fb=1/bb,Tb=Ra?tb:b.clamp(oa*(1-Fb)+ra*Fb,Ga,La),Ob=Ra?b.clamp(ta*(1-Fb)+ya*Fb,Na,Wa):xa,Ub=ab(Tb,Ob),jb=Tb*pa,sa=wa(Ob),Fa=Ub;ac=jb;kc=sa;gc=Fa;for(let Pa=1;Pa<gb-1;Pa+=na){const Ta=Pa/bb,$a=ac,hb=kc,ib=gc,ob=Ra?za:b.clamp(Ta,Ba,qa),qb=Ra?b.clamp(Ta,la,ua):Da,yb=$a-Ia,wb=
hb-Oa,Bb=ib-Ua;N($a,wb,Bb,va);ha.setEdgeVertexFromValuesRawPositionUV(Va,Pa,yb,wb,Bb,ob,qb);const zb=(Pa+1)/bb,Sb=Ra?tb:b.clamp(oa*(1-zb)+ra*zb,Ga,La),nb=Ra?b.clamp(ta*(1-zb)+ya*zb,Na,Wa):xa,xb=ab(Sb,nb);ac=Sb*pa;kc=wa(nb);gc=xb;const Ab=ac,Nb=kc,cc=gc,hc=lb,ec=rb,fc=vb;lb=$a;rb=hb;vb=ib;let Lb=0,Mb=0,Vb=0;if(Ra){const Kb=Nb-hb,Zb=cc-ib,$b=ec-hb,Cb=fc-ib,Pb=b.clamp(ta*(1-Ta)+ya*Ta,Na,Wa),Hb=tb+cb,xc=Hb*pa,Qb=k.sampleElevation(Hb,Pb,Y),dc=xc-$a,vc=Qb-ib,nc=3===Va?-1:1;Lb=nc*(-$b+Kb)*vc;Mb=nc*dc*(-Cb+
Zb);Vb=-nc*dc*(-$b+Kb);if(mb){const lc=tb+Qa,tc=lc*pa,yc=k.sampleElevation(lc,Pb,Ha),Ac=tc-$a;Lb=(-$b+Kb)*(vc-(yc-ib));Mb=(dc-Ac)*(-Cb+Zb);Vb=-(dc-Ac)*(-$b+Kb)}}else{const Kb=Ab-$a,Zb=cc-ib,$b=hc-$a,Cb=fc-ib,Pb=b.clamp(oa*(1-Ta)+ra*Ta,Ga,La),Hb=xa+eb,xc=k.sampleElevation(Pb,Hb,Y)-ib,Qb=wa(Hb)-hb,dc=2===Va?-1:1;Lb=dc*Qb*(-Cb+Zb);Mb=dc*(-$b+Kb)*xc;Vb=-dc*Qb*(-$b+Kb);if(mb){const vc=Pb,nc=xa+Sa,lc=wa(nc),tc=k.sampleElevation(vc,nc,Ha)-ib,yc=lc-hb;Lb=(-Qb+yc)*(-Cb+Zb);Mb=(-$b+Kb)*(-xc+tc);Vb=-(-Qb+yc)*
(-$b+Kb)}}const Wb=1/Math.sqrt(Lb*Lb+Mb*Mb+Vb*Vb);ha.setEdgeNormalFromValues(Va,Pa,Lb*Wb,Mb*Wb,Vb*Wb)}}}function y(X,da,ha){return X?fa=>(Math.PI/2-2*Math.atan(Math.exp(-fa/da)))*da:fa=>fa*ha}function D(X,da,ha){const {numVerticesPerSide:fa,vertexAttributes:aa,maxEdgeVertexCount:Z}=X,ea=fa-1;var ca=aa.count;const W=2*(fa-3)*(fa-3);var Y=4*(ea+Z-3);const ja=e.zeroToFour.reduce((ta,ya)=>ta+(ea+X.getEdgeCount(ya)-3),0),oa=da.reduce((ta,ya)=>ta+ea*(2*(ya.latitudeResolution-1)+1),0),ra=3*(ha?2:1);Y=(W+
Y+oa)*ra;ca=65536<=ca?new Uint32Array(Y):new Uint16Array(Y);for(let ta=0;ta<Y;++ta)ca[ta]=0;X.indices=ca;X.indexCount=(W+ja+oa)*ra;X.poleIndicesStartIndex=W*ra;X.edgeIndicesStartIndex=(W+oa)*ra;ha?(F(X),G(X,da),H(X)):(E(X),A(X,da),B(X))}function E(X){const {numVerticesPerSide:da,indices:ha,vertexAttributes:fa}=X;({position:X}=fa);const {typedBuffer:aa,typedBufferStride:Z}=X;X=da-2;const ea=da-3,ca=da-3;let W=0;for(let Y=0;Y<ea;++Y){const ja=Y*X;for(let oa=0;oa<ca;++oa){const ra=ja+oa,ta=ra+1,ya=ta+
X,Ca=ya-1;Q(ra,ta,ya,Ca,Z,aa)?(ha[W]=ra,ha[W+1]=ta,ha[W+2]=ya,ha[W+3]=ya,ha[W+4]=Ca,ha[W+5]=ra):(ha[W]=ra,ha[W+1]=ta,ha[W+2]=Ca,ha[W+3]=Ca,ha[W+4]=ta,ha[W+5]=ya);W+=6}}}function A(X,da){const {numVerticesPerSide:ha,indices:fa,poleIndicesStartIndex:aa}=X,Z=ha-1;let ea=aa;for(const ca of da){da=X.getEdgeVertexIndex(ca.connectedOuterEdgeOffset,0);let W=1;for(let Y=0;Y<ca.latitudeResolution;++Y){const ja=0===Y?ca.rowOffset:da+ha;for(let oa=0;oa<Z;oa++){const ra=ja+oa;fa[ea]=da;fa[ea+1]=da+1;fa[ea+2]=
ra;Y<ca.latitudeResolution-1?(fa[ea+3]=da+1,fa[ea+4]=ra+1,fa[ea+5]=ra,ea+=6):ea+=3;da+=W}da=ja;W=1}}}function B(X){const {indices:da,numVerticesPerSide:ha,edgeIndicesStartIndex:fa}=X,aa=ha-1,Z=aa-2;let ea=fa;for(let ja=0;4>ja;++ja){var ca=ba[ja];let oa=0,ra=0;const ta=X.getEdgeCount(ja),ya=ca.count;n.internalAssert(ya===aa-1);var W=1===ja||2===ja;const Ca=W?1:2;W=W?2:1;const pa=X.getEdgeFirstVertexIndex(ja),wa=ca.vertex0Index;for(ca=ca.stride;oa<ta-1||ra<ya-1;){const Ba=wa+ra*ca,la=pa+1*oa;var Y=
oa<ta-1;const qa=ra<ya-1,ua=Y?aa*(oa+.5)/(ta-1):0,va=qa?1+Z*(ra+.5)/(ya-1):0;(Y=Y&&(!qa||ua<=va))?++oa:++ra;Y=Y?la+1:Ba+ca;da[ea]=Ba;da[ea+Ca]=la;da[ea+W]=Y;ea+=3}}X.indexCount=ea}function F(X){const {indices:da,numVerticesPerSide:ha,vertexAttributes:fa}=X;({position:X}=fa);const {typedBuffer:aa,typedBufferStride:Z}=X;X=ha-2;let ea=0;for(let ca=0;ca<ha-3;++ca){const W=ca*X;for(let Y=0;Y<ha-3;++Y){const ja=ca*X+Y,oa=ja+1,ra=oa+X,ta=ra-1,ya=W+Y,Ca=ya+1,pa=Ca+X;Q(ya,Ca,pa,pa-1,Z,aa)?(T(da,ea,ja,oa,ra),
ea+=6,T(da,ea,ra,ta,ja)):(T(da,ea,ja,oa,ta),ea+=6,T(da,ea,ta,ra,oa));ea+=6}}}function G(X,da){const {indices:ha,numVerticesPerSide:fa,poleIndicesStartIndex:aa}=X,Z=fa-1;let ea=aa;for(const ca of da){da=X.getEdgeVertexIndex(ca.connectedOuterEdgeOffset,0);let W=1;for(let Y=0;Y<ca.latitudeResolution;++Y){const ja=0===Y?ca.rowOffset:da+fa;for(let oa=0;oa<Z;oa++)T(ha,ea,da,da+1,ja+oa),ea+=6,Y<ca.latitudeResolution-1&&(T(ha,ea,da+1,ja+oa+1,ja+oa),ea+=6),da+=W;da=ja;W=1}}}function H(X){const {indices:da,
numVerticesPerSide:ha,edgeIndicesStartIndex:fa}=X,aa=ha-1,Z=aa-2;let ea=fa;for(let ja=0;4>ja;++ja){var ca=ba[ja];let oa=0,ra=0;const ta=X.getEdgeCount(ja),ya=ca.count;n.internalAssert(ya===aa-1);var W=1===ja||2===ja;const Ca=W?1:3;W=W?3:1;const pa=X.getEdgeFirstVertexIndex(ja),wa=ca.vertex0Index;for(ca=ca.stride;oa<ta-1||ra<ya-1;){const Ba=wa+ra*ca,la=pa+1*oa;var Y=oa<ta-1;const qa=ra<ya-1,ua=Y?aa*(oa+.5)/(ta-1):0,va=qa?1+Z*(ra+.5)/(ya-1):0;(Y=Y&&(!qa||ua<=va))?++oa:++ra;Y=Y?la+1:Ba+ca;da[ea]=Ba;
da[ea+Ca]=la;da[ea+Ca+1]=la;da[ea+W]=Y;da[ea+W+1]=Y;da[ea+5]=Ba;ea+=6}}X.indexCount=ea}function L(X){const {geometry:da,geometryState:ha}=X;({edgeResolutions:X}=ha);const {numVerticesPerSide:fa,edgeVerticesStartIndex:aa}=da,Z=fa-2;let ea=aa;for(let W=0;4>W;++W){var ca=0===W||2===W;ca=(ca?0:1)*Z+(ca?1:0);const Y=ba[W];Y.vertex0Index=(0===W?Z-1:0)*Z+(1===W?Z-1:0);Y.stride=ca;Y.count=Z;ca=X[W]+1;da.outerEdgesOffsetAndLength[2*W]=ea;da.outerEdgesOffsetAndLength[2*W+1]=ca;ea+=ca}}function C(X){L(X);X.geometryState.wireframe?
H(X.geometry):B(X.geometry)}function z(X,da,ha){var fa=(da+2)%4;const {geometryState:aa,geometry:Z,tile:ea,localOrigin:ca}=X;var W=ea.level-ha.level;X=1===da||3===da;const Y=aa.edgeResolutions[da];n.internalAssert(b.isPowerOfTwo(Y));const ja=Y+1,{boundingBox:oa,minu:ra,minv:ta,maxu:ya,maxv:Ca,vertexAttributes:pa}=Z,wa=b.clamp(1===da?1:0,ra,ya),Ba=b.clamp(0===da?1:0,ta,Ca);var la=ha.renderData,qa=la.geometryState,ua=la.geometry,va=ua.getEdgeCount(fa);ha=ea.getNeighborEdgeStartVertexIndex(da,ha)*Y;
W=Y*2**W;n.internalAssert(qa.edgeResolutions[fa]===W);n.internalAssert(va-1===W);qa=la.localOrigin[0]-ca[0];va=la.localOrigin[1]-ca[1];la=la.localOrigin[2]-ca[2];da=Z.getEdgeFirstVertexIndex(da);var Ga=pa.position;W=Ga.typedBuffer;Ga=Ga.typedBufferStride;var La=pa.normalCompressed;const Na=La.typedBuffer;La=La.typedBufferStride;const Wa=pa.uv0;var Ia=ua.vertexAttributes;fa=ua.getEdgeFirstVertexIndex(fa);ua=Ia.position.typedBuffer;const Oa=Ia.position.typedBufferStride,Ua=Ia.normalCompressed.typedBuffer;
Ia=Ia.normalCompressed.typedBufferStride;for(let gb=1;gb<ja-1;++gb){const db=da+gb;var Va=fa+(ha+gb),Ra=db*Ga,bb=Va*Oa;const ka=ua[bb]+qa,mb=ua[bb+1]+va;bb=ua[bb+2]+la;W[Ra]=ka;W[Ra+1]=mb;W[Ra+2]=bb;N(ka,mb,bb,oa);Ra=db*La;Va*=Ia;Na[Ra]=Ua[Va];Na[Ra+1]=Ua[Va+1];Ra=gb/Y;Va=X?wa:b.clamp(Ra,ra,ya);Ra=X?b.clamp(Ra,ta,Ca):Ba;f.encodeUVInBuffer(Wa,db,Va,Ra)}}function J(X){const {geometry:da,geometryState:ha,localOrigin:fa,tile:aa}=X,{clippingArea:Z,samplerData:ea}=ha,{minu:ca,minv:W,maxu:Y,maxv:ja,boundingBox:oa,
vertexAttributes:ra}=da,{surface:ta,ellipsoid:ya,extent:Ca,extentInRadians:pa,horizontalScale:wa}=aa,Ba="local"===ta.view?.viewingMode,la=ya.radius;let qa=0,ua=0,va=0;const Ga=()=>{const Sa=null!=Z&&(Ca[3]>Z[3]||Ca[2]>Z[2]||Ca[1]<Z[1]||Ca[0]<Z[0]),cb=y(ta.isWebMercatorOnPlateCarree,la,wa);return(eb,lb,rb)=>{eb=0===eb?Ca[0]:Ca[2];lb=0===lb?Ca[1]:Ca[3];eb=Sa?b.clamp(eb,Z[0],Z[2]):eb;lb=Sa?b.clamp(lb,Z[1],Z[3]):lb;qa=eb*wa;ua=cb(lb);va=rb}},La=(Sa,cb,eb)=>{var lb=pa[0===cb?1:3];Sa=pa[0===Sa?0:2];cb=
Math.cos(lb);lb=Math.sin(lb);const rb=Math.sin(Sa);eb=la+eb;qa=Math.cos(Sa)*cb*eb;ua=rb*cb*eb;va=lb*eb},Na=Ba?Ga():La;let Wa=0,Ia=0,Oa=0,Ua=0,Va=0,Ra=0,bb=0,gb=0,db=0;const ka=Ba&&ta.isWebMercatorOnPlateCarree,mb=(Sa,cb,eb,lb,rb)=>{var vb=0,pb=0;let Db=0;Ba?(eb=ka?(Math.PI/2-2*Math.atan(Math.exp(-eb/la)))*la:eb*wa,vb=cb*wa-qa,pb=eb-ua,Db=lb-va):(vb=p(Sa),Sa=Sa.tile,pb=Sa.extent,Sa=Sa.extentInRadians,cb=(cb-pb[0])/(pb[2]-pb[0]),cb=Sa[0]*(1-cb)+Sa[2]*cb,vb=vb((eb-pb[1])/(pb[3]-pb[1])),eb=Math.cos(vb),
Sa=Math.sin(vb),pb=Math.sin(cb),lb=la+lb,vb=Math.cos(cb)*eb*lb-qa,pb=pb*eb*lb-ua,Db=Sa*lb-va);switch(rb){case 0:bb+=vb;gb+=pb;db+=Db;break;case 1:Ua-=vb;Va-=pb;Ra-=Db;break;case 2:bb-=vb;gb-=pb;db-=Db;break;case 3:Ua+=vb,Va+=pb,Ra+=Db}},sb=Z??U,tb=Ca[0],xa=Ca[2],Ha=Ca[1],na=Ca[3],za=[na>sb[3],xa>sb[2],Ha<sb[1],tb<sb[0]],Da=Math.max(tb,sb[0]),Ma=Math.min(xa,sb[2]),Xa=Math.max(Ha,sb[1]),ab=Math.min(na,sb[3]),Ja=Sa=>{var cb=ha.cornerNeighborCornerTiles;Ia=Wa=0;Oa=1;db=gb=bb=Ra=Va=Ua=0;var eb=Infinity;
for(var lb=0;4>lb;++lb)eb=Math.min(eb,cb[4*Sa+lb]?.level??Infinity);for(lb=0;4>lb;++lb){var rb=cb[4*Sa+lb];P[lb]=rb?.level===eb?rb:null}Sa=1;cb=0;for(eb=0;4>eb;++eb)if(lb=P[eb])Sa=Math.max(Sa,lb?.renderData.geometryState.numVerticesPerSide),cb=lb.extent[2]-lb.extent[0];n.internalAssert(1<Sa);Sa=cb/Sa;for(cb=0;4>cb;++cb){rb=P[(cb+3)%4];var vb=P[cb%4];if(rb||vb){lb=0===cb?1:1===cb?2:2===cb?3:0;var pb=0===cb?2:1===cb?3:2===cb?0:1;if(rb&&vb){var Db=ia[cb][0]*Sa,Jb=ia[cb][1]*Sa,Rb=rb.extent;eb=Math.max(sb[0],
Math.min(sb[2],Rb[0===lb||1===lb?2:0]+Db));lb=Math.max(sb[1],Math.min(sb[3],Rb[0===lb||3===lb?3:1]+Jb));Rb=vb.extent;Db=Math.max(sb[0],Math.min(sb[2],Rb[0===pb||1===pb?2:0]+Db));pb=Math.max(sb[1],Math.min(sb[3],Rb[0===pb||3===pb?3:1]+Jb));rb=rb.renderData;Jb=vb.renderData;vb=k.sampleElevation(eb,lb,rb.geometryState.samplerData);pb=k.sampleElevation(Db,pb,Jb.geometryState.samplerData);mb(rb,eb,lb,.5*(vb+pb),cb)}else eb=rb??vb,rb=rb?lb:pb,vb=eb.extent,pb=ia[cb],lb=Math.max(sb[0],Math.min(sb[2],vb[0===
rb||1===rb?2:0]+pb[0]*Sa)),rb=Math.max(sb[1],Math.min(sb[3],vb[0===rb||3===rb?3:1]+pb[1]*Sa)),eb=eb.renderData,vb=k.sampleElevation(lb,rb,eb.geometryState.samplerData),mb(eb,lb,rb,vb,cb)}}Ba||(Sa=Math.sqrt(qa*qa+ua*ua+va*va),Wa=qa/Sa,Ia=ua/Sa,Oa=va/Sa);if(Ba||.999>Oa*Oa)Sa=Math.sqrt(Ua*Ua+Va*Va+Ra*Ra),Ua/=Sa,Va/=Sa,Ra/=Sa,Sa=Math.sqrt(bb*bb+gb*gb+db*db),bb/=Sa,gb/=Sa,db/=Sa,Wa=Ra*gb-Va*db,Ia=Ua*db-Ra*bb,Oa=Va*bb-Ua*gb,Sa=1/Math.sqrt(Wa*Wa+Ia*Ia+Oa*Oa),Wa*=Sa,Ia*=Sa,Oa*=Sa},Qa=ha.cornerNeighborCornerTiles;
for(let Sa=0;4>Sa;++Sa){const cb=Sa,eb=(Sa+1)%4,lb=0===Sa||1===Sa?1:0,rb=0===Sa||3===Sa?1:0,vb=b.clamp(lb,ca,Y),pb=b.clamp(rb,W,ja),Db=da.getEdgeFirstVertexIndex(cb),Jb=da.getEdgeCount(cb),Rb=0===Sa||3===Sa?Jb-1:0,ac=da.getEdgeFirstVertexIndex(eb),kc=da.getEdgeCount(eb),gc=0===Sa||1===Sa?kc-1:0;let Fb=-1;for(let Ub=0;4>Ub;++Ub){const jb=Qa[4*Sa+Ub],sa=Qa[4*Sa+Fb];jb&&(-1===Fb||0<u.compareTilesByLij(sa,jb))&&(Fb=Ub)}const Tb=Fb,Ob=Qa[4*Sa+Tb];if(Ob!==aa){const Ub=aa.level-Ob.level,jb=2**Ub,sa=[Ob.lij[0]+
Ub,Ob.lij[1]*jb,Ob.lij[2]*jb],Fa=[sa[1]+jb===aa.lij[1],0===Sa&&(1===Tb||0===Tb&&Ob!==Qa[4*Sa+3])||1===Sa&&(0===Tb||1===Tb&&Ob!==Qa[4*Sa+2]),sa[1]===aa.lij[1]+1,2===Sa&&(3===Tb||2===Tb&&Ob!==Qa[4*Sa+1])||3===Sa&&(2===Tb||3===Tb&&Ob!==Qa[4*Sa])],Pa=Fa.reduce((Cb,Pb)=>Cb+(Pb?1:0),0);n.internalAssert(1===Pa||2===Pa);let Ta=-1,$a=-1;const hb=Ob.renderData;if(1===Pa){const Cb=Fa.findIndex(Hb=>Hb);n.internalAssert(0<=Cb&&3>=Cb);Ta=(Cb+2)%4;const Pb=ha.edgeResolutions[Cb];$a=aa.getNeighborEdgeStartVertexIndex(Cb,
Ob)*Pb+Pb*(0===Cb&&0===Sa||1===Cb&&0===Sa||2===Cb&&1===Sa||3===Cb&&3===Sa?1:0)}else{n.internalAssert(Fa[1]||Fa[3]);Ta=Fa[1]?3:1;const Cb=hb.geometryState.edgeResolutions[Ta];$a=0===Sa||3===Sa?0:Cb}const ib=hb.geometry,ob=Db+Rb,qb=ac+gc,yb=ib.getEdgeFirstVertexIndex(Ta)+$a,wb=ib.vertexAttributes,Bb=hb.localOrigin,zb=wb.position,Sb=zb.typedBuffer,nb=yb*zb.typedBufferStride,xb=Sb[nb]+Bb[0]-fa[0],Ab=Sb[nb+1]+Bb[1]-fa[1],Nb=Sb[nb+2]+Bb[2]-fa[2];N(xb,Ab,Nb,oa);const cc=ra.position,hc=cc.typedBuffer,ec=
ob*cc.typedBufferStride;hc[ec]=xb;hc[ec+1]=Ab;hc[ec+2]=Nb;const fc=qb*cc.typedBufferStride;hc[fc]=xb;hc[fc+1]=Ab;hc[fc+2]=Nb;const Lb=ra.uv0;f.encodeUVInBuffer(Lb,ob,vb,pb);f.encodeUVInBuffer(Lb,qb,vb,pb);const Mb=wb.normalCompressed.typedBuffer,Vb=yb*wb.normalCompressed.typedBufferStride,Wb=ra.normalCompressed,Kb=Wb.typedBuffer,Zb=ob*Wb.typedBufferStride;Kb[Zb]=Mb[Vb];Kb[Zb+1]=Mb[Vb+1];const $b=qb*Wb.typedBufferStride;Kb[$b]=Mb[Vb];Kb[$b+1]=Mb[Vb+1]}else{const Ub=za[eb];let jb=void 0;if(za[cb]||
Ub){const Ta=b.clamp(tb*(1-lb)+xa*lb,Da,Ma),$a=b.clamp(Ha*(1-rb)+na*rb,Xa,ab);jb=k.sampleElevation(Ta,$a,ea)}else jb=K(Qa,Sa);Na(lb,rb,jb);Ja(Sa);const sa=qa-fa[0],Fa=ua-fa[1],Pa=va-fa[2];N(sa,Fa,Pa,oa);da.setEdgeVertexFromValuesRawPositionUVNormal(cb,Rb,sa,Fa,Pa,vb,pb,Wa,Ia,Oa);da.setEdgeVertexFromValuesRawPositionUVNormal(eb,gc,sa,Fa,Pa,vb,pb,Wa,Ia,Oa)}}for(let Sa=0;4>Sa;++Sa)P[Sa]=null}function K(X,da){const ha=4*da;da=e.zeroToFour.reduce((ea,ca)=>Math.min(ea,X[ha+ca]?.level??Infinity),Infinity);
n.enableTerrainInternalChecks&&(n.internalAssert(!X[ha+0]||!X[ha+2]||l.isCornerNeighbor(X[ha+0],X[ha+2],d.NeighborIndex.SOUTH_WEST)),n.internalAssert(!X[ha+1]||!X[ha+3]||l.isCornerNeighbor(X[ha+1],X[ha+3],d.NeighborIndex.NORTH_WEST)));let fa=0,aa=0;for(let ea=0;4>ea;++ea){var Z=X[ha+ea];if(Z&&Z.level===da){const ca=Z.extent;Z=k.sampleElevation(ca[0===ea||1===ea?0:2],ca[0===ea||3===ea?1:3],Z.renderData?.geometryState?.samplerData);aa+=Z;fa++}}da=fa?aa/fa:0;n.internalAssert(null!=da);return da}function I(X){const {vao:da,
geometry:ha}=X,{vertexAttributes:fa,edgeVerticesStartIndex:aa}=ha;X=fa.position.typedBuffer;da.vertexBuffers.geometry.setSubData(X,aa,aa,X.length)}function M(X){const {vao:da,geometry:ha}=X,{indices:fa,indexCount:aa,edgeIndicesStartIndex:Z}=ha;da.indexBuffer.setSubData(fa,Z,Z,aa)}function S(X,da,ha){if(!da)return!1;X=u.compareTilesByLij(X,da);return 0<X||0===X&&2<=ha}function N(X,da,ha,fa){X<fa[0]?fa[0]=X:X>fa[3]&&(fa[3]=X);da<fa[1]?fa[1]=da:da>fa[4]&&(fa[4]=da);ha<fa[2]?fa[2]=ha:ha>fa[5]&&(fa[5]=
ha)}function V(X){const {edgeResolutions:da,numVerticesPerSide:ha}=X;X=1+Math.max(...da);return Math.max(ha,X)}function Q(X,da,ha,fa,aa,Z){var ea=X*aa;X=Z[ea];const ca=Z[ea+1];ea=Z[ea+2];var W=da*aa;da=Z[W];const Y=Z[W+1];W=Z[W+2];var ja=ha*aa;ha=Z[ja];const oa=Z[ja+1];ja=Z[ja+2];const ra=fa*aa;fa=Z[ra];aa=Z[ra+1];Z=Z[ra+2];return(da-fa)*(da-fa)+(Y-aa)*(Y-aa)+(W-Z)*(W-Z)>(X-ha)*(X-ha)+(ca-oa)*(ca-oa)+(ea-ja)*(ea-ja)}function T(X,da,ha,fa,aa){X[da]=ha;X[da+1]=fa;X[da+2]=fa;X[da+3]=aa;X[da+4]=aa;X[da+
5]=ha}const ia=[[0,1],[1,0],[0,-1],[-1,0]],O=new g.PatchGeometryLUT,U=c.fromValues(-Infinity,-Infinity,Infinity,Infinity),P=[null,null,null,null];class R{constructor(){this.vertex0Index=0;this.stride=1;this.count=0}getVertexIndex(X){n.internalAssert(0<=X&&X<this.count);return this.vertex0Index+this.stride*X}}const ba=[new R,new R,new R,new R];a.createPlanarGlobePatch=function(X,da){const {tile:ha,geometryState:fa,geometry:aa}=X,{extent:Z,surface:ea}=ha,{wireframe:ca}=fa,W=Z[0],Y=Z[1],ja=Z[2]-W,oa=
Z[3]-Y,{numVerticesPerSide:ra,clippingArea:ta}=fa,ya=null!=ta?Math.max(0,(ta[0]-W)/ja):0,Ca=null!=ta?Math.max(0,(ta[1]-Y)/oa):0,pa=null!=ta?Math.min(1,(ta[2]-W)/ja):1,wa=null!=ta?Math.min(1,(ta[3]-Y)/oa):1,Ba=(ra-2)**2,la=V(fa),qa=ea.renderer.tileGeometryCache.acquire(Ba+4*la),{boundingBox:ua}=aa;h.empty(ua);aa.numVerticesPerSide=ra;aa.vertexAttributes=qa;aa.maxEdgeVertexCount=la;aa.minu=ya;aa.minv=Ca;aa.maxu=pa;aa.maxv=wa;{const {tile:jb}=X;if(jb.intersectsClippingArea){var {geometry:va,geometryState:Ga,
localOrigin:La}=X,{samplerData:Na,clippingArea:Wa,numVerticesPerSide:Ia}=Ga,{surface:Oa,extent:Ua,ellipsoid:Va}=jb,{isWebMercatorOnPlateCarree:Ra}=Oa,bb=null!=Wa?Wa:U,gb=Ua[0],db=Ua[1],ka=Ua[2],mb=Ua[3],sb=Math.max(gb,bb[0]),tb=Math.min(ka,bb[2]),xa=Math.max(db,bb[1]),Ha=Math.min(mb,bb[3]),na=Va.radius,da=jb.horizontalScale,za=Ia-1,Da=Ia-2,{minu:Ma,minv:Xa,maxu:ab,maxv:Ja,boundingBox:Qa,vertexAttributes:Sa}=va,cb=Sa.position,eb=Sa.uv0,{typedBuffer:lb,typedBufferStride:rb}=Sa.normalCompressed,vb=La[0],
pb=La[1],Db=La[2],Jb=cb.typedBuffer,Rb=cb.typedBufferStride,ac=0,kc=b.clamp(db,xa,Ha),gc=Ra?(Math.PI/2-2*Math.atan(Math.exp(-kc/na)))*na:kc*da,Fb=1/za,Tb=b.clamp(db*(1-Fb)+mb*Fb,xa,Ha),Ob=gc,Ub=Ra?(Math.PI/2-2*Math.atan(Math.exp(-Tb/na)))*na:Tb*da;for(let sa=1;sa<=Da;sa++){const Fa=sa/za,Pa=b.clamp(db*(1-Fa)+mb*Fa,xa,Ha),Ta=b.clamp(Fa,Xa,Ja),$a=Ub,hb=(sa-1)/za,ib=b.clamp(db*(1-hb)+mb*hb,xa,Ha),ob=Ob,qb=(sa+1)/za,yb=b.clamp(db*(1-qb)+mb*qb,xa,Ha),wb=Ra?(Math.PI/2-2*Math.atan(Math.exp(-yb/na)))*na:
yb*da,Bb=b.clamp(qb,Xa,Ja);Ob=Ub;Ub=wb;const zb=b.clamp(gb,sb,tb);let Sb=zb*da,nb=k.sampleElevation(zb,Pa,Na);const xb=1/za,Ab=b.clamp(xb,Ma,ab),Nb=b.clamp(gb*(1-Ab)+ka*Ab,sb,tb);let cc=Ab,hc=Nb,ec=Nb*da,fc=k.sampleElevation(Nb,Pa,Na);if(1===sa){const Lb=ec-vb,Mb=Ob-pb,Vb=fc-Db,Wb=0*Rb;Jb[Wb]=Lb;Jb[Wb+1]=Mb;Jb[Wb+2]=Vb;N(Lb,Mb,Vb,Qa);const Kb=b.clamp(xb,Ma,ab);f.encodeUVInBuffer(eb,ac,Kb,Ta)}for(let Lb=1;Lb<=Da;Lb++){const Mb=ec,Vb=fc,Wb=(Lb+1)/za,Kb=b.clamp(Wb,Ma,ab),Zb=b.clamp(gb*(1-Wb)+ka*Wb,sb,
tb),$b=hc;hc=Zb;const Cb=ac+1,Pb=Cb*Rb;if(1===sa||Lb===Da){const zc=k.sampleElevation(Zb,Pa,Na),Bc=Zb*da,Qc=$a,Gc=zc;if(1===sa&&Lb<Da){const Cc=Bc-vb,Rc=Qc-pb,Sc=Gc-Db;Jb[Pb]=Cc;Jb[Pb+1]=Rc;Jb[Pb+2]=Sc;N(Cc,Rc,Sc,Qa);f.encodeUVInBuffer(eb,Cb,Kb,Ta)}ec=Bc;fc=Gc}else ec=Jb[Pb]+vb,fc=Jb[Pb+2]+Db;const Hb=ec,xc=fc,Qb=Sb,dc=nb;Sb=Mb;nb=Vb;const vc=(ac-Da)*Rb,nc=1===sa?k.sampleElevation($b,ib,Na):Jb[vc+2]+Db,lc=k.sampleElevation($b,yb,Na);if(sa<Da){const zc=ac+Da,Bc=zc*Rb,Qc=Mb-vb,Gc=wb-pb,Cc=lc-Db;Jb[Bc]=
Qc;Jb[Bc+1]=Gc;Jb[Bc+2]=Cc;N(Qc,Gc,Cc,Qa);const Rc=cc;cc=Kb;f.encodeUVInBuffer(eb,zc,Rc,Bb)}const tc=Hb-Qb,yc=ob-wb,Ac=yc*(xc-dc),uc=tc*(nc-lc),Pc=-yc*tc,Xc=Ac*Ac+uc*uc+Pc*Pc;if(0===Xc)x.compressNormal(lb,ac,0,0,1,rb);else{const zc=1/Math.sqrt(Xc);x.compressNormal(lb,ac,Ac*zc,uc*zc,Pc*zc,rb)}++ac}}}}aa.edgeVerticesStartIndex=Ba;L(X);t(X);D(aa,[],ca);X.intersectionData=null};a.createSphericalGlobePatch=function(X,da){const {tile:ha,geometry:fa,geometryState:aa}=X,{extentInRadians:Z,surface:ea}=ha,
{isWebMercator:ca,renderer:W}=ea,{numVerticesPerSide:Y,wireframe:ja}=aa,oa=Y-1,ra=(Y-2)**2,ta=ca&&(da===m.PatchType.HAS_SOUTH_POLE||da===m.PatchType.HAS_BOTH_POLES),ya=ca&&(da===m.PatchType.HAS_NORTH_POLE||da===m.PatchType.HAS_BOTH_POLES),Ca=6*((ta?1:0)+(ya?1:0))*Y,pa=V(aa),wa=W.tileGeometryCache.acquire(ra+Ca+4*pa);fa.numVerticesPerSide=Y;fa.vertexAttributes=wa;fa.maxEdgeVertexCount=pa;const {boundingBox:Ba}=fa;h.empty(Ba);const la=p(X);O.update(oa,Z,la);{const {tile:Ja}=X;if(Ja.intersectsClippingArea){var {geometry:qa,
geometryState:ua,localOrigin:va}=X,{numVerticesPerSide:Ga,samplerData:La}=ua,Na=Ga-2,Wa=Ga-1,{vertexAttributes:Ia,boundingBox:Oa}=qa,Ua=Ia.position,Va=Ia.uv0,{typedBuffer:Ra,typedBufferStride:bb}=Ia.normalCompressed,{extent:gb}=Ja,db=gb[0],ka=gb[2],mb=gb[1],sb=gb[3],tb=Ja.ellipsoid.radius,xa=va[0],Ha=va[1],na=va[2],za=Ua.typedBuffer,Da=Ua.typedBufferStride,Ma=1/Wa,Xa=0;if(1<=Na){const Qa=mb*(1-Ma)+sb*Ma,Sa=O.sinLatLUT[1],cb=O.cosLatLUT[1];for(let eb=1;eb<=Na;eb++){const lb=eb*Ma,rb=O.sinLonLUT[eb],
vb=O.cosLonLUT[eb],pb=tb+k.sampleElevation(db*(1-lb)+ka*lb,Qa,La),Db=-xa+pb*vb*cb,Jb=-Ha+pb*rb*cb,Rb=-na+pb*Sa;N(Db,Jb,Rb,Oa);const ac=(eb-1)*Da;za[ac]=Db;za[ac+1]=Jb;za[ac+2]=Rb;f.encodeUVInBuffer(Va,eb-1,lb,Ma)}}for(let Qa=1;Qa<=Na;Qa++){const Sa=Qa*Ma,cb=mb*(1-Sa)+sb*Sa,eb=O.sinLatLUT[Qa],lb=O.cosLatLUT[Qa],rb=Qa+1,vb=rb*Ma,pb=mb*(1-vb)+sb*vb,Db=O.sinLatLUT[rb],Jb=O.cosLatLUT[rb],Rb=O.sinLonLUT[0],ac=O.cosLonLUT[0],kc=tb+k.sampleElevation(db,cb,La);let gc=ac*lb*kc-xa,Fb=Rb*lb*kc-Ha,Tb=eb*kc-na;
const Ob=Xa*Da;let Ub=za[Ob],jb=za[Ob+1],sa=za[Ob+2];for(let Fa=1;Fa<=Na;Fa++){const Pa=Fa*Ma,Ta=db*(1-Pa)+ka*Pa,$a=O.sinLonLUT[Fa],hb=O.cosLonLUT[Fa];let ib=0,ob=0,qb=0;if(Fa<Na){const Cb=(Xa+1)*Da;ib=za[Cb];ob=za[Cb+1];qb=za[Cb+2]}else{const Cb=O.sinLonLUT[Wa],Pb=O.cosLonLUT[Wa],Hb=tb+k.sampleElevation(ka,cb,La);ib=Pb*lb*Hb-xa;ob=Cb*lb*Hb-Ha;qb=eb*Hb-na}const yb=gc,wb=Fb,Bb=Tb;gc=Ub;Fb=jb;Tb=sa;Ub=ib;jb=ob;sa=qb;const zb=ib-yb,Sb=ob-wb,nb=qb-Bb;let xb=0,Ab=0,Nb=0;if(1<Qa){const Cb=(Xa-Na)*Da;xb=
za[Cb];Ab=za[Cb+1];Nb=za[Cb+2]}else{const Cb=O.sinLatLUT[0],Pb=O.cosLatLUT[0],Hb=tb+k.sampleElevation(Ta,mb,La);xb=hb*Pb*Hb-xa;Ab=$a*Pb*Hb-Ha;Nb=Cb*Hb-na}const cc=tb+k.sampleElevation(Ta,pb,La),hc=hb*Jb*cc-xa,ec=$a*Jb*cc-Ha,fc=Db*cc-na;if(Qa<Na){const Cb=Xa+Na,Pb=Cb*Da;za[Pb]=hc;za[Pb+1]=ec;za[Pb+2]=fc;N(hc,ec,fc,Oa);f.encodeUVInBuffer(Va,Cb,Pa,vb)}const Lb=xb-hc,Mb=Ab-ec,Vb=Nb-fc;let Wb=hb*lb,Kb=$a*lb,Zb=eb;.999>Zb*Zb&&(Wb=nb*Mb-Sb*Vb,Kb=zb*Vb-nb*Lb,Zb=Sb*Lb-zb*Mb);const $b=1/Math.sqrt(Wb*Wb+Kb*
Kb+Zb*Zb);x.compressNormal(Ra,Xa,Wb*$b,Kb*$b,Zb*$b,bb);++Xa}}}}fa.poleVerticesStartIndex=ra;const ab=w(X,ta,ya);fa.edgeVerticesStartIndex=ra+Ca;L(X);q(X);D(fa,ab,ja);X.intersectionData=null};a.updateCornerSpherical=function(X){X.tile.intersectsClippingArea&&(J(X),v(X,!0),I(X),X.intersectionData=null)};a.updateCornersPlanar=function(X,da){X.tile.intersectsClippingArea&&(J(X),r(X,!0),I(X),X.intersectionData=null)};a.updateEdgeElevationsAndResolutionsPlanar=function(X,da){X.tile.intersectsClippingArea&&
(C(X),t(X),I(X),M(X),X.intersectionData=null)};a.updateEdgeElevationsAndResolutionsSpherical=function(X){X.tile.intersectsClippingArea&&(C(X),q(X),I(X),M(X),X.intersectionData=null)};a.updateEdgesAndCornersPlanar=function(X,da){X.tile.intersectsClippingArea&&(t(X),I(X),X.intersectionData=null)};a.updateEdgesAndCornersSpherical=function(X){X.tile.intersectsClippingArea&&(q(X),I(X),X.intersectionData=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/maybe ../../../chunks/vec32 ../../../geometry/support/aaBoundingBox ./terrainUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,h,c,k,m){function d(g,e,n,l){g.setValues(e,16384*n,16384*l)}class f{constructor(){this.indices=null;this.poleIndicesStartIndex=this.edgeIndicesStartIndex=this.indexCount=0;this.vertexAttributes=null;this.maxEdgeVertexCount=this.poleVerticesStartIndex=this.edgeVerticesStartIndex=0;this.boundingBox=c.empty();this.minv=this.minu=this.numVerticesPerSide=0;this.maxv=this.maxu=1;this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=b.releaseMaybe(this.vertexAttributes);
this.indices=null}reset(){this.vertexAttributes=this.indices=null;c.empty(this.boundingBox);this.numVerticesPerSide=0}getEdgeFirstVertexIndex(g){return this.outerEdgesOffsetAndLength[2*g]}getEdgeCount(g){return this.outerEdgesOffsetAndLength[2*g+1]}getEdgeVertexIndex(g,e){return this.getEdgeAttributeIndex(g,e)}getEdgeVertexPosition(g,e,n,l){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(g,l),e);h.add(e,e,n)}getEdgeNormal(g,e,n){const {typedBuffer:l,typedBufferStride:u}=this.vertexAttributes.normalCompressed;
m.decompressNormal(e,l,this.getEdgeAttributeIndex(g,n),u)}setEdgeNormalFromValues(g,e,n,l,u){this._setNormal(this.getEdgeAttributeIndex(g,e),n,l,u)}setEdgeVertexFromValuesRawPositionUV(g,e,n,l,u,x,w){g=this.getEdgeAttributeIndex(g,e);this.vertexAttributes.position.setValues(g,n,l,u);this._setUV(g,x,w)}setEdgeVertexFromValuesRawPositionUVNormal(g,e,n,l,u,x,w,q,v,p){g=this.getEdgeAttributeIndex(g,e);this.vertexAttributes.position.setValues(g,n,l,u);this._setUV(g,x,w);this._setNormal(g,q,v,p)}_getEdgeVertexRaw(g,
e){this.vertexAttributes.position.getVec(g,e)}_setNormal(g,e,n,l){const {typedBuffer:u,typedBufferStride:x}=this.vertexAttributes.normalCompressed;m.compressNormal(u,g,e,n,l,x)}_setUV(g,e,n){d(this.vertexAttributes.uv0,g,e,n)}getEdgeAttributeIndex(g,e){k.internalAssert(0<=e&&e<this.getEdgeCount(g));return this.getEdgeFirstVertexIndex(g)+e}}a.PatchGeometry=f;a.encodeUVInBuffer=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports",
"./TerrainConst"],function(a,b){class h{constructor(){this.sinLonLUT=Array(b.maxPatchTesselation+1);this.cosLonLUT=Array(b.maxPatchTesselation+1);this.sinLatLUT=Array(b.maxPatchTesselation+1);this.cosLatLUT=Array(b.maxPatchTesselation+1)}update(c,k,m){const d=k[0];k=k[2];for(let g=0;g<=c;g++){var f=g/c;const e=d*(1-f)+k*f;this.sinLonLUT[g]=Math.sin(e);this.cosLonLUT[g]=Math.cos(e);f=m(f);this.sinLatLUT[g]=Math.sin(f);this.cosLatLUT[g]=Math.cos(f)}}}a.PatchGeometryLUT=h;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./ITile ./LayerClass ./PatchGeometry ./TerrainConst ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(I,M){return M?.isLoaded||M===I?M:null}class B{constructor(){this.geometry=new u.PatchGeometry;this._texture=this._vao=this.geometryState=this.intersectionData=null;this._textureRef=new q.TextureFader(()=>this.tile.surface.fadeDuration);this.overlay=new p;this._localOrigin=null;this._geometryStateChangedSinceLastUpdate=!0;this._hasGeometry=!1;this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(I,
M){this.clear();this._tile=I;this.geometry.reset();this.intersectionData=null;this.geometryState=new e.GeometryState;this._localOrigin=M;this.overlay.clear()}clear(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null}updateGeometryIfNeeded(I){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||
this.dirtyEdgeResolutions||this.dirtyEdges)this._updateGeometry(I),this._geometryStateChangedSinceLastUpdate=!1;if(w.enableTerrainInternalChecks&&this.tile.intersectsClippingArea)for(I=0;4>I;++I)w.internalAssert(this.geometry.getEdgeCount(I)===this.geometryState.edgeResolutions[I]+1)}_calculateEdgeResolution(I,M){const S=this.tile,N=this.geometryState.numVerticesPerSide-1;if(!S.surface.isGlobal){var V=S.surface.extent;if(null!=V&&(0===I&&S.extent[3]>V[3]||1===I&&S.extent[2]>V[2]||2===I&&S.extent[1]<
V[1]||3===I&&S.extent[0]<V[0]))return N}const Q=S.level;V=w.neighborEdgeIndices[I];if(!M)return w.internalAssert(null==S.surface?.rootTiles||S.surface.updatingRootTiles||!S.shouldHaveNeighbor(V)),N;if(M.isLoaded)return V=M.renderData.geometryState,M=Q-M.level,w.internalAssert(0<=M),0===M?Math.max(V.numVerticesPerSide-1,N):Math.max(1,V.edgeResolutions[(I+2)%4]/2**M);w.internalAssert(!M.isLeaf);let T=N;M.forAllSubtreeOnSide(w.oppositeEdge(V),ia=>{if(ia===S)return!0;if(ia.isLoaded)return T=Math.max(T,
2**(ia.level-Q)),!0;w.internalAssert(!ia.isLeaf);return!1});return T}updateNeighborData(){const I=this.tile;if(I.intersectsClippingArea){var M=I.renderData.geometryState,S=P=>(P.isLoaded||P.level===I.level)&&P?.intersectsClippingArea,N=M.edgePeerNeighbors,V=M.edgePeerNeighborSamplerVersions;for(var Q=0;4>Q;++Q){var T=I.findNeighborTile(w.neighborEdgeIndices[Q],S),ia=A(I,T),O=ia?.renderData?.geometryState.samplerDataVersion??-1,U=A(I,N[Q]);ia=ia!==U;U=V[Q]!==O;w.enableTerrainInternalChecks&&T&&(w.internalAssert(I.level>=
T.level),w.internalAssert(I.level-T.level<=x.maxTileNeighborLevelDelta));N[Q]=T;if(ia||U)V[Q]=O,this._markEdgeDirty(Q);O=M.edgeResolutions[Q];T=this._calculateEdgeResolution(Q,T);w.internalAssert(h.isPowerOfTwo(T));w.internalAssert(1<=T);M.edgeResolutions[Q]=T;O!==T&&this._markEdgeResolutionDirty(Q)}for(let P=0;4>P;++P){T=I.findNeighborTile(w.neighborCornerIndices[P],S);M.cornerPeerNeighbors[P]=T;V=A(I,N[P]);Q=A(I,N[(P+1)%4]);T=A(I,T);J[P]=T;J[(P+1)%4]=Q;J[(P+2)%4]=I;J[(P+3)%4]=V;w.internalAssert(J.some(X=>
X?.isLoaded||X===I));const R=J.reduce((X,da)=>Math.min(X,da?.level??Infinity),Infinity);J.forEach((X,da)=>{X&&X?.level>R&&(J[da]=null)});w.internalAssert(J.some(X=>X?.isLoaded||X===I));const ba=M.cornerNeighborCornerTiles;V=M.cornerNeighborCornerTileSamplerVersions;for(Q=0;4>Q;++Q){T=J[Q];O=T?.renderData.geometryState.samplerDataVersion??-1;ia=4*P+Q;U=ba[ia]!==T;const X=!U&&V[ia]!==O;if(U||X)ba[ia]=T,V[ia]=O,this._markCornerDirty(P)}w.enableTerrainInternalChecks&&w.internalAssert(K.some(X=>ba[4*P+
X]?.isLoaded||ba[4*P+X]===I))}w.enableTerrainInternalChecks&&w.internalAssert(this.geometryState.edgeResolutions.every(P=>0<P));for(M=0;4>M;++M)J[M]=null}}_updateGeometry(I){if(this.tile.intersectsClippingArea){w.enableTerrainInternalChecks&&w.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(U=>0<U));this.intersectionData=null;var {tile:M,_vao:S,geometry:N,geometryState:V}=this,Q={geometry:N},T=!S||!Q||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||
this.numVerticesPerSideChanged;Q=0!==this.dirtyEdgeResolutions;var ia=V.edgeResolutions.reduce((U,P)=>U+P+1,0);T=T||Q&&ia>(N?.maxEdgeVertexCount??0);ia=!T&&Q;Q=!ia&&(0!==this.dirtyEdges||Q);var O=!Q&&0!==this.dirtyCorners;T?(this.releaseGeometry(),this._createGeometry(I)):ia?M.updateEdgeElevationsAndResolutions():Q||O?M.updateEdgeElevations():O?M.updateCornerElevations():console.warn("Update for no reason?");this._modifiedFlags=0}}get hasGeometry(){return this._hasGeometry}releaseGeometry(){this._hasGeometry=
!1;this.intersectionData=null;if(!this._vao)return!1;this._vao=c.disposeMaybe(this._vao);this.geometry.release();return!0}ensureTexture(I,M,S){M=M?E.PixelFormat.RGBA:E.PixelFormat.RGB;null==this._texture||this._texture.descriptor.width===I&&this._texture.descriptor.pixelFormat===M||this.releaseTexture();null==this._texture&&(this._texture=S(),this.tile.setMemoryDirty());return this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return 0!==
(this._modifiedFlags&1)}get samplerDataChanged(){return 0!==(this._modifiedFlags&2)}get clippingAreaChanged(){return 0!==(this._modifiedFlags&4)}get wireframeChanged(){return 0!==(this._modifiedFlags&8)}get dirtyEdges(){return this._modifiedFlags>>4&15}get dirtyCorners(){return this._modifiedFlags>>8&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>12&15}_markCornerDirty(I){this._modifiedFlags|=1<<I<<8}_markEdgeDirty(I){this._modifiedFlags|=1<<I<<4;this._markCornerDirty((I+0)%4);this._markCornerDirty((I+
3)%4)}_markEdgeResolutionDirty(I){this._modifiedFlags|=1<<I<<12;this._markEdgeDirty(I)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=65520}updateGeometryState(){var I=this._getElevationInfo();const M=this.tile;var S=I.samplerData?M.getElevationVerticesPerSide(I.maxTileLevel):M.getDefaultVerticesPerSide();const N=Math.max(S,5);let V=M.clippingArea;if(!M.intersectsClippingArea||M.isWithinClippingArea)V=null;S=this.geometryState;let Q=!1;S.numVerticesPerSide!==N&&(this._modifiedFlags|=1,S.numVerticesPerSide=
N,S.samplerDataVersion++,Q=!0);I.changed&&(this._modifiedFlags|=2,S.samplerData=I.samplerData,S.samplerDataVersion++,Q=!0);b.equals(S.clippingArea,V)||(this._modifiedFlags=4,S.clippingArea=V,Q=!0);I=M.surface.wireframe;S.wireframe!==I&&(this._modifiedFlags=8,S.wireframe=I,Q=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=Q);Q&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate}_createGeometry(I){this.tile.createGeometry();
const M=this.geometry.vertexAttributes,S=this.geometry.indices,N=I.gl;this._vao=new r.VertexArrayObject(I,y.terrainVertexAttributeLocations,{geometry:g.glLayout(M.layout)},{geometry:D.BufferObject.createVertex(I,N.STATIC_DRAW,M.buffer)},D.BufferObject.createIndex(I,N.STATIC_DRAW,S));this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(I,M=q.ActivationTime.Immediate){null!=I&&I.texture!==this._texture&&this.releaseTexture();this._textureRef.push(I,M)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){var I=
this.geometryState.samplerData;const M=this.tile.layerInfo[l.LayerClass.ELEVATION],S=M.length,N=Array(S);let V=0;var Q=0;let T=!1;for(let U=0;U<S;U++){var ia=M[U];if(null!=ia.upsampleInfo){ia=ia.upsampleInfo.tile;var O=ia.layerInfo[l.LayerClass.ELEVATION][U].data;O=O&&O.samplerData;I&&I[V]===O||(T=!0);N[V++]=O;Q=Math.max(Q,ia.lij[0])}else ia.data&&(O=this.tile.surface.layerViewByIndex(U,l.LayerClass.ELEVATION),t.fallsWithinLayer(this.tile,O.layer,!1)&&(Q=ia.data,I&&I[V]===Q.samplerData||(T=!0),N[V++]=
Q.samplerData,Q=this.tile.level))}null!=I&&I.length!==V&&(T=!0);if(I=0<V)N.length=V;return{changed:T,samplerData:I?N:null,maxTileLevel:Q}}get estimatedGeometryMemoryUsage(){return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}get texture(){return this._texture}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){if(w.enableTerrainInternalChecks){var I=this.tile;if(I.isLoaded&&I.intersectsClippingArea&&
0!==I.level){var M=I.surface.extent;if(null==M||I.intersectsExtent(M)){var S=w.neighborEdgeIndices.map((T,ia)=>null!=M?0>(2>ia?-1:1)*(I.extent[3-ia]-M[3-ia]):!1),N=I.level;w.internalAssert(0===this.dirtyCorners);w.internalAssert(0===this.dirtyEdges);w.internalAssert(0===this.dirtyEdgeResolutions);w.internalAssert(!this.numVerticesPerSideChanged);w.internalAssert(!this.samplerDataChanged);w.internalAssert(!this.clippingAreaChanged);w.internalAssert(!this.wireframeChanged);var V=w.neighborCornerIndices.map(T=>
I.findNeighborCornerTileExact(T,ia=>!ia.intersectsClippingArea||ia.isLoaded||ia.level===I.level)??null).map(T=>T?.intersectsClippingArea?T:null),Q=this.geometryState;for(let T=0;4>T;++T){const ia=Q.cornerPeerNeighbors[T],O=V[T];w.internalAssert(O===ia,`Tile[${I.lij}].corner[${T}] out of date: cur=[${ia?.lij}] exp=[${O?.lij}]`)}w.neighborEdgeIndices.forEach((T,ia)=>{if(!S[ia]){var O=I.findNeighborTile(T,Ba=>(Ba.level===N||Ba?.isLoaded)&&Ba?.intersectsClippingArea);if(O){w.internalAssert(O.isLoaded||
O.level===I.level);w.internalAssert(O===this.geometryState.edgePeerNeighbors[ia]);var U=N-O.level;if(O.isLoaded){var P=O.renderData;w.internalAssert(v.isEdgeNeighbor(I,O,T));w.internalAssert(0<=U);var R=2**U;if(0>U)w.internalAssert(!1);else{var ba=I.renderData,X=ba.geometry,da=ba.localOrigin,ha=X.getEdgeCount(ia),fa=X.numVerticesPerSide-1,aa=P.geometry;if(aa){var Z=P.localOrigin,ea=this.geometryState.edgePeerNeighbors[ia];ea?.isLoaded&&(ea=ea.renderData,w.internalAssert(ba.geometryState.edgePeerNeighborSamplerVersions[ia]===
ea.geometryState.samplerDataVersion),w.internalAssert(this.geometryState.edgePeerNeighborSamplerVersions[ia]===ea.geometryState.samplerDataVersion));var ca=(ia+2)%4,W=aa.getEdgeCount(ca);ea=ha-1;var Y=W-1;w.internalAssert(ea*R===Y,`Tile[${I.lij}]:e${ia},res=${ea} edgeRes mismatch with`+` Neighbor[${O.lij}]:e${ca},res=${Y} (expected:${ea*R})`);ea=I.extent;Y=T===n.NeighborIndex.NORTH||T===n.NeighborIndex.SOUTH;var ja=W-1,oa=ja>>U,ra=ha-1;if(1>oa)w.internalAssert(1===ra);else{w.internalAssert(oa===ra);
w.internalAssert(h.isPowerOfTwo(oa));ra=aa.numVerticesPerSide-1;w.internalAssert(0<U||oa===Math.max(ra,fa));U=I.getNeighborEdgeStartVertexIndex(ia,O);w.internalAssert(0<=U&&U<R);R=U*oa;w.internalAssert(0<=R&&R<=ja-oa);var ta=0,ya=R;X.getEdgeVertexPosition(ia,F,da,0);X.getEdgeVertexPosition(ia,G,da,ha-1);R=k.distance(F,G);R=Math.max(1,1E-4*R);for(U=0;U<=oa;++U){X.getEdgeVertexPosition(ia,F,da,ta);aa.getEdgeVertexPosition(ca,G,Z,ya);fa=U/oa;var Ca=Y?ea[0]+fa*(ea[2]-ea[0]):T===n.NeighborIndex.WEST?ea[0]:
ea[2],pa=Y?T===n.NeighborIndex.SOUTH?ea[1]:ea[3]:ea[1]+fa*(ea[3]-ea[1]);const Ba=I.surface.extent;if(null==Ba||d.containsXY(Ba,Ca,pa)){fa=k.dist(F,G);ja=k.len(F)-f.earth.radius;ra=k.len(G)-f.earth.radius;var wa=fa<R;wa||(console.warn("Tile edge vertex position mismatch: between"+` [${I.lij}].edge${ia}[${ta}/${ha}] and`+` [${O.lij}].edge${ca}[${ya}/${W}]`),null!=Ba&&console.warn("  surface extent\x3d ",Ba," x,y\x3d",Ca,",",pa),Ca=m.create(),k.subtract(Ca,ba.localOrigin,P.localOrigin),0<k.len(Ca)&&
console.warn(`   localOrigins: ${ba.localOrigin} vs ${P.localOrigin}`+` d=${k.len(Ca)} [${Ca}]`),(()=>{const qa=m.clone(F),ua=m.clone(G);I.updateEdgeElevations();O.updateEdgeElevations();X.getEdgeVertexPosition(ia,F,da,ta);aa.getEdgeVertexPosition(ca,G,Z,ya);const va=m.create();k.sub(va,F,qa);0<k.len(va)&&console.warn(`  XXX Tile[${I.lij}] edge out of date: ${qa} vs ${F} d=${k.len(va)} [${va}]`);k.sub(va,G,ua);0<k.len(va)&&console.warn(`  XXX Neighbor[${O.lij}] edge out of date: ${ua} vs ${G} d=${k.len(va)} [${va}]`)})(),
Ca=X.getEdgeCount(ia),pa=aa.getEdgeCount(W),w.internalAssert(wa,"Mismatch in tile"+` [${I.lij}].edge[${ia}][${ta}/${Ca}] vs neighbor`+` [${O.lij}].edge[${ca}][${ya}/${pa}]`+` ${w.v32s(F)} vs ${w.v32s(G)}  dist=${fa} h(t|n|d)=${ja}|${ra}|${ra-ja}`));X.getEdgeNormal(ia,H,ta);aa.getEdgeNormal(ca,L,ya);k.normalize(C,H);k.normalize(z,L);const la=k.dot(C,z);fa=.01>1-la||I===O;if(!fa){const qa=m.create();k.sub(qa,H,L);ja=()=>`Mismatch in tile edge normal ${w.lij2s(I.lij)} (${ta}/${ha-1}) edge ${ia} vs neighbor ${w.lij2s(O.lij)}  (${ya}/${W-
1}) nedge ${ca} :`+`${w.v32s(H)} vs ${w.v32s(L)}  dot = ${la} : ${w.v32s(qa)}`;console.warn("Mismatch in tile edge normal: ",ja());I.updateEdgeElevations();O.updateEdgeElevations();ra=m.create();wa=m.create();X.getEdgeNormal(ia,ra,ta);aa.getEdgeNormal(ca,wa,ya);k.equals(H,ra)||console.warn("Missing update in tile normal: ",w.v32s(H)," \x3d\x3e ",w.v32s(ra));k.equals(L,wa)||console.warn("Missing update in neighbor normal: ",w.v32s(L)," \x3d\x3e ",w.v32s(wa));w.internalAssert(fa,ja())}}ta+=1;ya+=1}}}else w.internalAssert(!1)}}else w.internalAssert(!O.isLeaf),
w.internalAssert(0===U)}else T=!I.surface.updatingRootTiles&&null!=I.surface.rootTiles&&0<I.surface.rootTiles.length&&I.shouldHaveNeighbor(T),w.internalAssert(!T)}})}}else w.internalAssert(I?.isLoaded)}}}const F=m.create(),G=m.create(),H=m.create(),L=m.create(),C=m.create(),z=m.create(),J=[null,null,null,null],K=[0,1,2,3];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>q.ActivationTime});a.PatchRenderData=B;a.neighborTileIfLoadedOrSelf=A;a.zeroToFour=K;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){class b{constructor(){this.numVerticesPerSide=0;this.samplerData=null;this.samplerDataVersion=0;this.clippingArea=null;this.wireframe=!1;this.cornerPeerNeighbors=[null,null,null,null];this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.edgeResolutions=
[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}}a.GeometryState=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../core/maybe","./interfaces"],function(a,b,h){class c{constructor(k){this._getFadeDuration=k;this._delayedTime=this._fadeStart=0}clear(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);
this._delayed=b.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){var k=this._delayed||this._waiting||this._next||this._current;k!==this._current&&(this._current=null,this.clear(),this._current=k)}k=c.test.fadeMoment;null!=this._delayed&&(k=k||performance.now(),k>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){k=k||performance.now();const m=this._next.type!==h.TextureUpdate.FADING,
d=k-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||m||d)b.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(k)}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;var k=c.test.fadeMoment||performance.now();k=Math.max(0,k-this._fadeStart);const m=this._fadeDuration;return k>m?0:1-k/m}get isFading(){return null!=this._next||
null!=this._delayed}push(k,m=a.ActivationTime.Immediate){this._delayed=b.destroyMaybe(this._delayed);this._push(k,m)}_push(k,m){this._isFadingEnabled||this.clear();if(null==this._current)this._current=k;else{var d=c.test.fadeMoment||performance.now();m!==a.ActivationTime.Immediate?(this._delayed=k,this._delayedTime=d+m):null==this._next?(this._next=k,this._fadeStart=this._alignFadeStart(d)):null!=k&&(b.destroyMaybe(this._waiting),this._waiting=k)}}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():
.5*this._getFadeDuration()}_alignFadeStart(k){const m=this._getFadeDuration();return k+m-k%m}get _isFadingEnabled(){return 0<this._getFadeDuration()}}c.test={fadeMoment:0};a.ActivationTime=void 0;(function(k){k[k.Immediate=0]="Immediate";k[k.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./ITile ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){function C(O){O.dispose();O instanceof v.ElevationTileAgent?S.release(O):O instanceof y.MapTileAgent&&M.release(O)}function z(O,U){return O[0]===U[0]&&O[1]===U[1]&&O[2]===U[2]}function J(O,U,P){return null==O||null==U||U===O?!1:O.level>=U.level?K(O,U,P):K(U,O,A.oppositeCorner(P))}function K(O,U,P){A.internalAssert(O.level>=U.level);var R=A.isWestCorner(P),ba=A.isNorthCorner(P),X=O.extent;P=U.extent;var da=[R?X[0]:X[2],ba?X[3]:X[1]];
const ha=[R?P[2]:P[0],ba?P[1]:P[3]];R=1E-5*(X[2]-X[0]);ba=A.almostEquals(da[0],ha[0],R)||O.surface.isGlobal&&A.almostEquals(da[0],-ha[0],R);da=A.almostEquals(da[1],ha[1],R);if(ba&&da)return!0;if(O.level===U.level||!ba&&!da)return A.internalAssert(!1),!1;ba?(O=X[1],X=X[3],P=P[1]-R<=O&&O<=X&&X<=P[3]+R):(O=X[0],X=X[2],P=P[0]-R<=O&&O<=X&&X<=P[2]+R);A.internalAssert(P);return P}class I{constructor(){this._lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=
!0;this._previouslyRendered=!1;this.extent=n.create();this._elevationBounds=m.create();this.layerInfo=[[],[]];this.extentInRadians=n.create();this.centerAtSeaLevel=f.create();this._center=[f.create(),l.create(),f.create()];this.up=f.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=
0;this.distanceToPOI=-1;this._lastPOI=f.create();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0}get lij(){return this._lij}static prune(){M.prune(0);S.prune(0);F.TilePerLayerInfo.prune()}get _isCached(){return!this.isLeaf&&0>=this._mapDataRefCount}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[a.CenterPosition.MIDDLE][3]}get visible(){this._dirty&&
this.computeVisibility();return this._visible}get frustumVisibility(){this._dirty&&this.computeVisibility();return this._frustumVisibility}computeVisibility(){this._dirty=!1;var O=this.parent?.frustumVisibility??t.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=O===t.TileFrustumVisibility.INSIDE?t.TileFrustumVisibility.INSIDE:O===t.TileFrustumVisibility.OUTSIDE?t.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);O=this._frustumVisibility!==t.TileFrustumVisibility.OUTSIDE&&
this._intersectsClippingArea;O!==this._visible&&(this._visible=O,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const O=!!this.renderData;O!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=O,this._surface.renderer.setDirty());return O}init(O,U,P,R,ba){this._lij[0]=O;this._lij[1]=U;this._lij[2]=
P;this.ellipsoid=e.getReferenceEllipsoid(ba.tilingScheme.spatialReference);ba.tilingScheme.getExtent(O,U,P,this.extent);ba.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;ba.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=
0;this.elevationLevel=O;R&&R.elevationBounds?k.copy(this._elevationBounds,R.elevationBounds):k.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=R;this.unsetChildren();this._surface=ba;this.updateVisibility();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0;for(const X of r.LayerClasses){O=ba.numLayers(X);U=this.layerInfo[X];for(const da of U)da.release();U.length=O;for(P=0;P<O;P++)U[P]=F.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),
X===r.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(P,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(ba.tilingScheme.pixelSize,E.maxPatchTesselation)}dispose(){A.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(var O of r.LayerClasses){for(const U of this.layerInfo[O])U.release();this.layerInfo[O].length=0}this._parent=null;for(O=0;4>O;++O)this._children[O]=null;this._surface=null;this.setMemoryDirty()}refMapData(){++this._mapDataRefCount;
this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const O=this._cachedMemory;0<O&&this._surface.upsampleMapCache.put(this.key,this,O)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){this._ensureUsedMemory();return this.layerInfo[r.LayerClass.MAP].reduce((O,
U)=>O+(U instanceof x.VectorTile?U.usedMemory/U.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const O=this._surface.tilingScheme.pixelSize;return O*O*4}_ensureUsedMemory(){if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory;let O=this._mapTileMemoryInternal=0;for(var {data:U}of this.layerInfo[r.LayerClass.MAP])U instanceof x.VectorTile?O+=this._getTerrainDataMemory(U):this._mapTileMemoryInternal+=this._getTerrainDataMemory(U);U=this._cpuImageMemorySize;
for(const P of this.layerInfo[r.LayerClass.ELEVATION])this._usedMemory+=P.data?U:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0);this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+O);return this._usedMemory}getUsedMemoryForLayer(O,U){U=this.layerInfo[O][U];return U?.data?O===r.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(U.data):O===
r.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(O){return O instanceof G?O.texture.usedMemory:O instanceof HTMLImageElement||O instanceof w.ImageWithType?this._cpuImageMemorySize:O instanceof D.RasterTile?O.memoryUsage:O instanceof x.VectorTile?O.usedMemory/O.referenced:0}updateScreenDepth(O){var U=this._center[a.CenterPosition.MIDDLE];const P=U[0],R=U[1];U=U[2];const ba=O[2]*P+O[6]*R+O[10]*U+O[14];this.screenDepth=0>ba?0:ba/(O[3]*P+O[7]*R+O[11]*U+O[15])}shouldSplit(O,U,
P){if(!this.visible||O.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(O.frustum)===t.TileFrustumVisibility.OUTSIDE))return H.TileUpdate.NONE;const R=this.level;d.subtract(V,l.getCenter(this._center[a.CenterPosition.MIDDLE]),U);var ba=d.squaredLength(V),X=V;let da=l.getCenter(this._center[a.CenterPosition.MIDDLE]);d.subtract(Q,this._center[a.CenterPosition.TOP],U);var ha=d.squaredLength(Q);ha<ba&&(ba=ha,X=Q,da=this._center[a.CenterPosition.TOP]);d.subtract(T,this._center[a.CenterPosition.BOTTOM],
U);ha=d.squaredLength(T);ha<ba&&(ba=ha,X=T,da=this._center[a.CenterPosition.BOTTOM]);if(this._edgeLen2>ba&&R<O.maxLod)return H.TileUpdate.SPLIT;ba=Math.sqrt(ba);const fa=this._edgeLen/(O.fovX*ba*2),aa=()=>{if(R<O.maxLod)return this.elevationLevel=R,H.TileUpdate.NONE;const W=R+Math.ceil(-Math.log2(O.relativeWidthLimit/fa));return W!==this.elevationLevel?(this.elevationLevel=W,H.TileUpdate.ELEVATION):H.TileUpdate.NONE},Z=null!=P?P-R:Infinity;if(.5>=Z)return aa();const ea=d.dot(this.up,V);ha=this._elevationBounds[1]-
this._elevationBounds[0];const ca=ha/this.edgeLen;if(O.aboveGround&&0<ea&&.001>ca&&0<ea/ba-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-ca)return H.TileUpdate.NONE;P=null!=P?3-Math.min(Z,2):1;if(fa*P<O.relativeWidthLimit||R>=O.maxLod)return aa();if(7>R)return H.TileUpdate.SPLIT;d.scale(ia,this.up,ea);d.subtract(ia,ia,X);X=d.squaredLength(ia);if(X<=this.radius*this.radius)return H.TileUpdate.SPLIT;d.scale(ia,ia,this.radius/Math.sqrt(X));d.add(ia,ia,da);d.subtract(ia,U,ia);return Math.min(1,
(Math.abs(d.dot(ia,this.up))+.5*ha+this._curvatureHeight)/d.length(ia))*(this._edgeLen/(O.fovY*ba*2))*P<.1/O.angledSplitBias*O.relativeHeightLimit?H.TileUpdate.NONE:H.TileUpdate.SPLIT}setChildren(O,U,P,R){A.weakAssert(!!(O&&U&&P&&R),"Null child passed");const ba=this._children;ba[0]=O;ba[1]=U;ba[2]=P;ba[3]=R;return ba}unsetChildren(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();
for(const O of r.LayerClasses)this._createOrUpdateAgents(0,O);this.surface.renderer.loadTile(this)}unload(O){O.unloadTile(this);for(const U of r.LayerClasses){O=this.layerInfo[U];for(const P of O)P.loadingAgent&&P.loadingAgent!==B.tileAgentDone&&(C(P.loadingAgent),P.loadingAgent=null),P.pendingUpdates=0}this.resetPendingUpdate(H.TileUpdate.GEOMETRY);this.resetPendingUpdate(H.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(H.TileUpdate.TEXTURE_FADING);this.unrefMapData()}unloadMapData(){const O=
this.layerInfo[r.LayerClass.MAP];for(const U of O)U.loadingAgent&&U.loadingAgent!==B.tileAgentDone&&(C(U.loadingAgent),U.loadingAgent=null),U.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()}updateClippingStatus(O){if(n.equals(O,this._clippingArea))return!1;var U=this._intersectsClippingArea;const P=this._isWithinClippingArea;null!=O?(this._intersectsClippingArea=this.intersectsExtent(O),this._isWithinClippingArea=this._isWithinExtent(O)):this._isWithinClippingArea=
this._intersectsClippingArea=!0;this._clippingArea=O;this.updateVisibility();O=P&&this._isWithinClippingArea;U=!P&&!U&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||O||U||this.setPendingUpdate(H.TileUpdate.GEOMETRY);return!0}updateVisibility(){this._dirty=!0;this._surface.setTileTreeDirty()}getLayerInfo(O,U){return this.layerInfo[U][O]}hasLayerData(O,U){O=this.layerInfo[U][O];return!(!O?.data||O.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const O of r.LayerClasses){const U=
this.layerInfo[O];for(const P of U)if(P.loadingAgent&&P.loadingAgent!==B.tileAgentDone&&P.loadingAgent.updating)return!0}return!1}_isSuspended(O){return this.hasPendingUpdate(H.TileUpdate.SPLIT)?!0:O===r.LayerClass.ELEVATION?!1:!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(O){return(this._pendingUpdates&O)===O}setPendingUpdate(O){const U=this._pendingUpdates;this._pendingUpdates|=O;O===H.TileUpdate.SPLIT||O===H.TileUpdate.MERGE?this._surface.setTileTreeDirty():
this._surface.requestUpdate();return U!==this._pendingUpdates}resetPendingUpdate(O){return this.hasPendingUpdate(O)?(this._pendingUpdates&=~O,!0):!1}requestLayerData(O,U,P){const R=this.layerInfo[U][O];if(R.waitingAgents.has(P))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),P.tile.lij.toString(),U,O),!0;R.waitingAgents.push(P);if(R.data&&!R.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",
this._lij.toString(),P.tile.lij.toString(),U,O),P.dataArrived(this,R.data&&"type"in R.data&&"vector-tile"===R.data.type),!0;if(R.requestPromise)return!0;h.abortMaybe(R.requestAbort);R.requestAbort=new AbortController;const ba=this._surface.requestTileData(this,O,U,R.requestAbort);if(!ba)return R.requestAbort=null,!1;O=()=>{R.requestPromise===ba&&(R.requestPromise=null,R.requestAbort=null)};R.requestPromise=ba;ba.then(O,O);return!0}get isLeaf(){return null==this._children[0]}hasLij(O){return this._lij[0]===
O[0]&&this._lij[1]===O[1]&&this._lij[2]===O[2]}findByLij(O){if(this.hasLij(O))return this;const U=this._children;return U[0]?U[0].findByLij(O)||U[1].findByLij(O)||U[2].findByLij(O)||U[3].findByLij(O):null}distanceToSquared(O){return d.squaredLength(d.subtract(ia,l.getCenter(this._center[a.CenterPosition.MIDDLE]),O))}containsPoint(O){const U=this.extent;return O[0]>=U[0]&&O[1]>=U[1]&&O[0]<=U[2]&&O[1]<=U[3]}containsPointXY(O,U){const P=this.extent;return O>=P[0]&&U>=P[1]&&O<=P[2]&&U<=P[3]}unrequestLayerData(O,
U,P){O=this.layerInfo[U][O];U=O.waitingAgents;P=null!=U.removeUnordered(P);A.weakAssert(P,"agent has not requested this piece of map data");1>U.length&&(O.abortRequest(),this.setMemoryDirty())}dataArrived(O,U,P){const R=null!=P&&"type"in P&&"vector-tile"===P.type;O=this.layerInfo[U][O];O.data=P;O.dataInvalidated=!1;O.waitingAgents.forAll(ba=>ba.dataArrived(this,R));O.waitingAgents.clear();this.setMemoryDirty()}dataMissing(O,U,P){P.notInTilemap||console.error(`Tile ${this._lij.toString()} layer ${U}/${O} error ${P}`);
O=this.layerInfo[U][O];O.dataMissing=!0;O.waitingAgents.forAll(R=>R.dataMissing());O.waitingAgents.clear();this.setMemoryDirty()}updateRenderData(O,U,P){P&&this.forEachLoadedNeighbor(R=>R.updateRenderData(O,U));switch(O){case r.LayerClass.MAP:return this._updateTexture(U);case r.LayerClass.ELEVATION:return this._updateGeometry()}}_updateTexture(O){this.renderData&&(this.resetPendingUpdate(O===p.TextureUpdate.FADING?H.TileUpdate.TEXTURE_NOFADING:H.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(O===
p.TextureUpdate.FADING?H.TileUpdate.TEXTURE_FADING:H.TileUpdate.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(H.TileUpdate.GEOMETRY);for(const O of this.layerInfo[r.LayerClass.ELEVATION])O.pendingUpdates|=H.TileUpdate.GEOMETRY}invalidateLayerData(O,U){this.layerInfo[U][O].invalidateSourceData();this.restartAgents(U)}computeElevationBounds(){const O=this._elevationBounds,U=O[0],P=O[1];k.set(O,Infinity,-Infinity);const R=this.layerInfo[r.LayerClass.ELEVATION];let ba=!0;for(const X of R)null!=
X.elevationBounds&&(O[0]=Math.min(O[0],X.elevationBounds.min),O[1]=Math.max(O[1],X.elevationBounds.max),X.elevationBounds.hasNoDataValues||(ba=!1));ba&&(O[0]=Math.min(O[0],0),O[1]=Math.max(O[1],0));if(U!==O[0]||P!==O[1])this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const O=this._elevationBounds,U=this._center;d.scale(ia,this.up,.5*(O[0]+O[1]));d.add(l.getCenter(U[a.CenterPosition.MIDDLE]),this.centerAtSeaLevel,ia);d.scale(ia,this.up,O[0]);d.add(U[a.CenterPosition.TOP],
this.centerAtSeaLevel,ia);d.scale(ia,this.up,O[1]);d.add(U[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,ia)}findElevationBoundsForLayer(O,U){const P=this.layerInfo[r.LayerClass.ELEVATION][O],R=E.getElevationDesiredResolutionLevel(this.level),ba=Math.max(this.elevationLevel-R,0);var X=P.elevationBounds;if(!(null!=X&&X.level>=U&&X.level<=ba)&&(U=this._surface.layerViewByIndex(O,r.LayerClass.ELEVATION),U=A.getLayerWithExtentRange(U),L.fallsWithinLayer(this,U,!1))){U=N;X=!1;var da=P.data;if(da&&da.level<=
ba)O=P.data,U.min=O.samplerData.data.minValue,U.max=O.samplerData.data.maxValue,U.hasNoDataValues=O.samplerData.data.hasNoDataValues,U.level=this.level,X=!0;else{da=0;let ha,fa;for(let aa=this._parent;aa&&(!fa||da<R)&&!(da=this.elevationLevel-aa.level,ha=fa||ha,fa=aa.layerInfo[r.LayerClass.ELEVATION][O].data,!fa&&ha&&aa.level<=ba);aa=aa.parent);if(fa=fa||ha)fa.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],U),Infinity!==U.min&&(U.level=fa.level,X=!0)}X&&(null==P.elevationBounds&&(P.elevationBounds=
new q.ElevationBounds),P.elevationBounds.copyFrom(U))}}modifyLayers(O,U,P){P=this.layerInfo[P];for(var R of P)R.loadingAgent&&R.loadingAgent!==B.tileAgentDone&&(C(R.loadingAgent),R.loadingAgent=null),R.waitingAgents.clear();for(R=0;R<P.length;++R)void 0===O[R]&&P[R].release();O=Array(...P);R=U.length;P.length=R;for(let ba=0;ba<R;ba++){const X=U[ba];P[ba]=-1<X?O[X]:F.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(O){this.renderData&&(this._createOrUpdateAgents(0,
O),this.updateRenderData(O,p.TextureUpdate.FADING))}updateAgents(O){if(this.renderData){const U=this.layerInfo[O];for(const P of U)P.loadingAgent===B.tileAgentDone&&(P.loadingAgent=null);this._createOrUpdateAgents(0,O)}}updateAgentSuspension(){for(const O of r.LayerClasses){const U=this._isSuspended(O);for(const P of this.layerInfo[O])P.loadingAgent&&P.loadingAgent!==B.tileAgentDone&&(P.loadingAgent.setSuspension(U),P.loadingAgent===B.tileAgentDone&&this.updateRenderData(O,p.TextureUpdate.FADING))}}removeLayerAgent(O,
U){O=this.layerInfo[U][O];O.loadingAgent&&O.loadingAgent!==B.tileAgentDone&&O.loadingAgent.dispose();O.loadingAgent=null}agentDone(O,U){const P=this.layerInfo[U][O];P.loadingAgent=B.tileAgentDone;P.data||null!=P.upsampleInfo||this._createOrUpdateAgents(O+1,U)}_hasBlendableAncestor(O){return"normal"!==O.blendMode||u.isGroupLayer(O.parent)&&this._hasBlendableAncestor(O.parent)}_hasBlendModes(O,U,P){for(;O<U;++O){const R=this._surface.layerViewByIndex(O,P);if(A.isBlendableLayerView(R)&&"normal"!==R?.layer?.blendMode||
u.isGroupLayer(R?.layer?.parent)&&this._hasBlendableAncestor(R?.layer?.parent))return!0}return!1}_createOrUpdateAgents(O,U){const P=this.layerInfo[U];if(0!==P.length){var R=this._isSuspended(U);for(let ha=O;ha<P.length;++ha){const fa=P[ha];var ba=!1;const aa=this._surface.layerViewByIndex(ha,U);var X=A.getLayerWithExtentRange(aa);if(fa.loadingAgent)L.fallsWithinLayer(this,X,!1)?(fa.loadingAgent!==B.tileAgentDone&&fa.loadingAgent.setSuspension(R),fa.loadingAgent!==B.tileAgentDone&&(ba=fa.loadingAgent.update())):
fa.dispose();else if(L.fallsWithinLayer(this,X,!1)){ba=ha;X=U;var da=R;const Z=X===r.LayerClass.ELEVATION?S.acquire():M.acquire();Z.init(this,ba,X,da);fa.loadingAgent=Z;(ba=fa.loadingAgent.startLoading())?fa.loadingAgent===B.tileAgentDone&&this.setPendingUpdate(H.TileUpdate.GEOMETRY):(C(fa.loadingAgent),fa.loadingAgent=B.tileAgentDone)}fa.loadingAgent===B.tileAgentDone&&this.updateRenderData(U,p.TextureUpdate.FADING);if(!this._hasBlendModes(O,P.length,U)&&ba&&aa.isOpaque)break}}}_isWithinExtent(O){const U=
this.extent;return U[0]>=O[0]&&O[2]>=U[2]&&U[1]>=O[1]&&O[3]>=U[3]}intersectsExtent(O){const U=this.extent;return U[2]>=O[0]&&O[2]>=U[0]&&U[3]>=O[1]&&O[3]>=U[1]}getElevationVerticesPerSide(O){var U=this.elevationLevel-this.level;O=Math.max(this.level-O,E.getElevationDesiredResolutionLevel(this.level)-U);O=b.clamp((this.maxTesselation>>O)+1,2,this.maxTesselation+1);U=this.getDefaultVerticesPerSide();return Math.max(O,U)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(O,U){if(!O)return null;
var P=this.surface.rootTiles;if(null!=P)for(var R of P){{P=R.lij;const ba=O[0]-P[0];P=0>ba?!1:O[1]>>ba===P[1]&&O[2]>>ba===P[2]}if(P){for(P=O[0]-R.level-1;0<=P&&!R.isLeaf&&!U(R);)R=R.children[2*(O[1]>>P&1)+(O[2]>>P&1)],P--;return U(R)?R:null}}return null}findNeighborTile(O,U){const P=this._lij;return(O=this.getNeighborLIJ(P,O))?z(P,O)?U(this)?this:null:this._findLIJ(O,U):null}findCorner(O,U){O=O===t.NeighborIndex.NORTH_EAST?1:O===t.NeighborIndex.NORTH_WEST?0:O===t.NeighborIndex.SOUTH_WEST?2:3;let P=
this;for(;P.children[0]&&(!U||!U(P));)P=P.children[O];return P}findNeighborCornerTileExact(O,U){return this.findNeighborTile(O,P=>U(P)||P.level===this.level)?.findCorner(A.oppositeCorner(O),U)||null}forAllSubtreeOnSide(O,U){const P=O===t.NeighborIndex.NORTH?[0,1]:O===t.NeighborIndex.NORTH_EAST?[1]:O===t.NeighborIndex.EAST?[1,3]:O===t.NeighborIndex.SOUTH_EAST?[3]:O===t.NeighborIndex.SOUTH?[2,3]:O===t.NeighborIndex.SOUTH_WEST?[2]:O===t.NeighborIndex.WEST?[0,2]:[0],R=ba=>{const X=ba.children;!U(ba)&&
X[0]&&P.forEach(da=>R(X[da]))};R(this)}getNeighborEdgeStartVertexIndex(O,U){if(!U)return 0;var P=this.level-U.level;A.internalAssert(!A.enableTerrainInternalChecks||0<=P);if(0===P)return 0;P=2**P;var R=(O=1===(O&1))?0:1;U=U.lij[R+1]*P;R=this._lij[R+1];const ba=R-U;O=O?P-1-ba:ba;A.enableTerrainInternalChecks&&(A.internalAssert(U<=R&&R<U+P),A.internalAssert(0<=O&&O<P));return O}forEachLoadedNeighbor(O){const U=this.level,P=R=>R.level===U||R.isLoaded;A.neighborEdgeIndices.forEach(R=>{const ba=this.findNeighborTile(R,
P);null!=ba&&ba!==this&&ba.forAllSubtreeOnSide(A.oppositeEdge(R),X=>X.isLoaded?(O(X,R),!0):!1)});A.neighborCornerIndices.forEach(R=>{const ba=this.findNeighborTile(R,P)?.findCorner(A.oppositeCorner(R),X=>X.isLoaded);A.internalAssert(!ba||J(this,ba,R));ba?.isLoaded&&O(ba,R)})}getNeighborLIJ(O,U){const P=A.isNorth(U)?-1:A.isSouth(U)?1:0;U=A.isWest(U)?-1:A.isEast(U)?1:0;O=[O[0],O[1]+P,O[2]+U];return 0>O[1]?null:this.surface.isGlobal?this.wrapLIJ(O):0>O[2]?null:O}wrapLIJ(O){return!O||0>O[1]||O[1]>=2**
O[0]?null:this.surface.wrapEastWest(O)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this._lij[2]}get isNorthEnd(){return 0===this._lij[1]}get isSouthEnd(){const O=this.surface.extent?.[1]??null;return null!=O&&this.extent[1]+g.getEpsilon()>=O}checkGeometryWaterproofness(){A.enableWaterproofnessTests&&
(A.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(O){const U=this.extent,P=this.surface.rootTilesExtent,R=.25*(U[2]-U[0]);if(A.isNorth(O)&&U[3]+R>=P[3]||A.isSouth(O)&&U[1]-R<=P[1])return!1;const ba=this.surface.isGlobal;return!ba&&A.isWest(O)&&U[0]-R<=P[0]||!ba&&A.isEast(O)&&U[2]+R>=P[2]?!1:!0}updateDistanceToPOI(O){var U=this._lastPOI;if(!(0<=this.distanceToPOI&&U[0]===O[0]&&U[1]===O[1]&&U[2]===O[2])){d.copy(this._lastPOI,O);var P=this._center[a.CenterPosition.MIDDLE];
U=O[0]-P[0];var R=O[1]-P[1];O=O[2]-P[2];this.distanceToPOI=U*U+R*R+O*O}}}const M=new c(y.MapTileAgent),S=new c(v.ElevationTileAgent),N=new q.ElevationBounds;a.CenterPosition=void 0;(function(O){O[O.TOP=0]="TOP";O[O.MIDDLE=1]="MIDDLE";O[O.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));const V=f.create(),Q=f.create(),T=f.create(),ia=f.create();a.Tile=I;a.isCornerNeighbor=J;a.isEdgeNeighbor=function(O,U,P){if(null==O||null==U)return!1;if(0===O.level&&0===U.level&&(O.isEastEnd&&U.isWestEnd&&
P===t.NeighborIndex.EAST||O.isWestEnd&&U.isEastEnd&&P===t.NeighborIndex.WEST))return!0;const R=Math.max(1E-6*(O.extent[2]-O.extent[0]),1);switch(P){case t.NeighborIndex.NORTH:return A.almostEquals(O.extent[3],U.extent[1],R);case t.NeighborIndex.SOUTH:return A.almostEquals(O.extent[1],U.extent[3],R);case t.NeighborIndex.EAST:return A.almostEquals(O.extent[2],U.extent[0],R)||A.almostEquals(O.extent[2],-U.extent[0],R);case t.NeighborIndex.WEST:return A.almostEquals(O.extent[0],U.extent[2],R)||A.almostEquals(O.extent[0],
-U.extent[2],R)}};a.lijEquals=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,b,h){class c extends h.TileAgent{constructor(){super(...arguments);this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return b.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}a.ElevationTileAgent=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define(["exports","./interfaces","./TerrainConst","./terrainUtils","./tileUtils"],function(a,b,h,c,k){class m{get updating(){return!!this._tileRequested}init(e,n,l,u){this.tile=e;this._layerIdx=n;this._layerClass=l;this._suspended=u;this._tileLayerInfo=e.getLayerInfo(n,l);this._tileRequested=null;e=this._findAncestorWithData();this._setUpsampleTile(e)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&
(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null}setSuspension(e){e!==this._suspended&&((this._suspended=e)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();this._setUpsampleTile(e);return this._requestNext()}dataArrived(e,n){this._setUpsampleTile(e,
n);this._tileRequested=null;e===this.tile?this.tile.updateRenderData(this._layerClass,b.TextureUpdate.FADING,n):this._requestNext()}dataMissing(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,
this);this._tileRequested=null}null!=e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone();return!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,n=this._layerClass;var l=this.tile.surface.layerViewByIndex(e,n),u=c.getLayerWithExtentRange(l);const {minLevel:x,maxLevel:w}=l.dataLevelRange,q=this._desiredMinLevelDelta,v=this._progressiveLevelModulo+q,p=this._scaleRangeEnabled?k.fallsWithinLayer:()=>!0;let t=this.tile;const r=t.level;let y;
const D=this._tileLayerInfo.upsampleInfo,E=null!=D?D.tile.level:-1,A=null!=D?E-r>=q:!1,B=u?.tilemapCache;for(l="vector-tile-3d"===l.type?l.schemaHelper:null;t&&p(t,u,!1)&&t.level>=x;){const F=t.level,G=r-F,H=t.layerInfo[n][e];if(H.data&&G>=q){(!A||F>E)&&this._setUpsampleTile(t);H.dataInvalidated&&(y=t);break}const L=l?.getLevelRowColumn(t.lij)??t.lij;if("unavailable"!==B?.getAvailability(L[0],L[1],t.lij[2])&&F<=w&&!H.data&&!H.dataMissing){if(!y||t.level===x||0===F%h.progressiveLoadingModulo||r-y.level<
q)y=t;if(G>=v)break}t=t.parent}null!=y&&r-y.level<q&&(D?y=null:(u=this._findAncestorWithData(),null!=u&&(this._setUpsampleTile(u),y=u.layerInfo[n][e].dataInvalidated?u:null)));return y}_findAncestorWithData(){const e=this.tile.elevationLevel,n=this._desiredMinLevelDelta;let l;for(let u=this.tile;u;u=u.parent)if(u.hasLayerData(this._layerIdx,this._layerClass)){if(e-u.level>=n)return u;l=u}return l}_setUpsampleTile(e,n){this._tileLayerInfo.setUpsampleInfo(this.tile,e);this.tile.updateRenderData(this._layerClass,
b.TextureUpdate.FADING,n)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class d extends m{get _desiredMinLevelDelta(){throw f;}get _progressiveLevelModulo(){throw f;}dispose(){}}const f=Error("Abstract method called on TileAgent"),g=new d;a.TileAgent=m;a.tileAgentDone=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../core/PooledArray","./RenderOrder"],function(a,
b,h){function c(x,w){w(x);if(!x.isLeaf)for(const q of x.children)c(q,w)}function k(x,w){x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function m(x,w){const q=w.screenDepth-x.screenDepth;if(0!==q)return q;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function d(x,w){const q=x.screenDepth-w.screenDepth;if(0!==q)return q;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function f(x,w,q){const v=x.screenDepth,p=w.screenDepth;return v<p?-q:v>p?q:k(x,w)}function g(x,w,q,v){const p=
e(x,v);v=e(w,v);return p===v?f(x,w,q):x?q:-q}function e(x,w){for(const q of w)if(x.intersectsExtent(q))return!0;return!1}function n(x,w){const q=x.distanceToPOI-w.distanceToPOI;if(0!==q)return q;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}class l{constructor(){this._queue=new b;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(x){this._queue.clear();this._queue.push(x);this._last=void 0}reset(x=null){this._queue.clear();null!=x&&this._queue.pushArray(x);
this._last=void 0}skipSubtree(){this._last=void 0}next(){const x=this._last?.children;x?.[0]&&this._queue.pushArray(x);return this._last=this._queue.pop()}}class u{constructor(){this._q=new b}get done(){return 0===this._q.length}reset(x){this._q.clear();if(null!=x)for(this._q.pushArray(x),x=0;x<this._q.length;++x){const w=this._q.data[x];w.isLeaf||this._q.pushArray(w.children)}}next(){return this._q.pop()}}a.IteratorPostorder=u;a.IteratorPreorder=l;a.compareTiles=f;a.compareTilesByLij=k;a.compareTilesWithStencil=
g;a.computeUpsampleInfo=function(x,w,q){let v=1,p=0,t=0;for(;x!==w;)if(v*=.5,p*=.5,t*=.5,x.lij[2]&1&&(p+=.5),0===(x.lij[1]&1)&&(t+=.5),x=x.parent,null==x)throw Error("tile was not a descendant of upsampleTile");q.init(w,p,t,v)};a.fallsWithinLayer=function(x,w,q){if(null==w?.fullExtent)return!1;const v=w.fullExtent,p=x.extent;if(q){if(p[0]<v.xmin||p[1]<v.ymin||p[2]>v.xmax||p[3]>v.ymax)return!1}else if(v.xmin>p[2]||v.ymin>p[3]||v.xmax<p[0]||v.ymax<p[1])return!1;x=x.surface.tilingScheme.levels[x.level].scale;
q=w.minScale;if(0<q&&x>1.00000001*q)return!1;w=w.maxScale;return 0<w&&x<.99999999*w?!1:!0};a.hasLoadableSiblings=function(x){for(let w=0;w<x.length;w++){const q=x[w],v=q.parent;if(v)for(let p=0;4>p;p++){const t=v.children[p];if(t&&t!==q)return!0}}return!1};a.sortTiles=function(x,w,q=null){null==q||0===q.length?x===h.RenderOrder.BACK_TO_FRONT?w.sort(m):w.sort(d):w.sort((v,p)=>g(v,p,x,q))};a.sortTilesByPOI=function(x,w){const q=x.length;for(let v=0;v<q;++v)x.at(v).updateDistanceToPOI(w);x.sort(n)};
a.tilesAreRelated=function(x,w){if(!x||!w||x[0]===w[0])return!1;const q=x[0]<w[0],v=q?x:w;x=q?w:x;w=1<<x[0]-v[0];return Math.floor(x[1]/w)===v[1]&&Math.floor(x[2]/w)===v[2]};a.traverseTilesPreorder=function(x,w){if(Array.isArray(x))for(let q=0;q<x.length;q++)c(x[q],w);else c(x,w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=
-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,b,h){class c extends h.TileAgent{constructor(){super();this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return b.progressiveLoadingModulo}}a.MapTileAgent=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/RasterTile":function(){define(["exports","../../../core/maybe","../../../chunks/RasterColorizer.glsl","../../webgl/enums","../../webgl/rasterUtils"],function(a,b,h,c,k){const m={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class d{constructor(f,g,e=null,n=null){this.lij=f;this.type="raster-tile";this._interpolation=
this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.source=g;this.width=e||g.width;this.height=n||g.height}get source(){return this._source}set source(f){this._source=f;this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...m,maxCutOff:[1,1,1],factor:[1,1,1]}:
this._symbolizerParameters||m}set symbolizerParameters(f){this._symbolizerParameters=f}get bandIds(){return this._bandIds}set bandIds(f){null!=f&&0<f.length?this._bandIds&&f.every((g,e)=>this._bandIds?.[e]?g===this._bandIds[e]:!1)||(this._bandIds=f,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(f){this._interpolation=f;null!=this._rasterTexture&&(f=this._getRasterTextureInterpolation(f),this._rasterTexture.setSamplingMode("bilinear"===
f?c.TextureSamplingMode.LINEAR:c.TextureSamplingMode.NEAREST))}get transformGrid(){return this._transformGrid}set transformGrid(f){this._transformGrid=f;this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}bind(f){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(f,this.bandIds);null!=this._rasterTexture&&(this._updateColormapTexture(f),this.transformGrid&&null==this._transformGridTexture&&
(this._transformGridTexture=k.createTransformTexture(f,this.transformGrid)));return!0}getUniforms(){const {symbolizerParameters:f,transformGrid:g,width:e,height:n,opacity:l}=this,u=k.getCommonUniforms(g,[e,n],[this.source.width,this.source.height],l),x=k.getColormapUniforms(f.colormap,f.colormapOffset),w="stretch"===this.symbolizerParameters.type?k.getStretchUniforms(this.symbolizerParameters):null,q="hillshade"===this.symbolizerParameters.type?k.getShadedReliefUniforms(this.symbolizerParameters):
null;return new h.ColorizerUniforms(u,x,w||q,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const {symbolizerParameters:f}=this;return"bilinear"===this.interpolation&&null!=f.colormap&&"stretch"===f.type}get memoryUsage(){null==this._memoryUsed&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(f=>null!=f?f.descriptor.width*f.descriptor.height*4:0).reduce((f,g)=>f+g,0));return this._memoryUsed}release(){this._rasterTexture=
b.disposeMaybe(this._rasterTexture);this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._colormapTexture=b.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0}_updateRasterTexture(f,g){const e=this.source?this.source.extractBands(g):null;e&&e.pixels&&0<e.pixels.length?(g=null==g&&null==this.bandIds||null!=g&&null!=this.bandIds&&g.join("")===this.bandIds.join(""),null!=this._rasterTexture&&g||(this._rasterTexture=b.disposeMaybe(this._rasterTexture),
g=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=k.createRasterTexture(f,e,g,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=b.disposeMaybe(this._rasterTexture)}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(f){return"lut"===this.symbolizerParameters.type||"nearest"===f||"majority"===
f||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(f){const g=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!g)this._colormapTexture=k.createColormapTexture(f,e),this._colormap=e;else if(e.length!==g.length||e.some((n,l)=>n!==g[l]))this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormapTexture=k.createColormapTexture(f,e),this._colormap=e}}a.RasterTile=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(A){const B=new w.ShaderBuilder;B.include(d.TileComposite);B.include(k.Common,A);B.include(c.Colormap,A);B.include(m.TileBackground,A);B.fragment.code.add(x.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);A.colorizerType===h.RasterColorizerType.Stretch?p(B,A):A.colorizerType===h.RasterColorizerType.Lut?B.fragment.code.add(x.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):A.colorizerType===h.RasterColorizerType.Hillshade&&t(B,A);return B}function p(A,B){A.fragment.uniforms.add(new u.IntegerPassUniform("u_bandCount",G=>G.symbolizer.u_bandCount),new l.FloatsPassUniform("u_minCutOff",G=>G.symbolizer.u_minCutOff,3),new l.FloatsPassUniform("u_maxCutOff",G=>G.symbolizer.u_maxCutOff,3),new l.FloatsPassUniform("u_factor",G=>G.symbolizer.u_factor,3),new n.FloatPassUniform("u_minOutput",G=>G.symbolizer.u_minOutput),new n.FloatPassUniform("u_maxOutput",G=>G.symbolizer.u_maxOutput),
new g.BooleanPassUniform("u_useGamma",G=>G.symbolizer.u_useGamma),new l.FloatsPassUniform("u_gamma",G=>G.symbolizer.u_gamma,3),new l.FloatsPassUniform("u_gammaCorrection",G=>G.symbolizer.u_gammaCorrection,3),new n.FloatPassUniform("u_opacity",G=>G.common.u_opacity));A.fragment.code.add(x.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const F=B.applyColormap?x.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;A.fragment.code.add(x.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${B.stretchType===h.RasterColorizerStretchType.Noop?x.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:x.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${F}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function t(A,B){A=A.fragment;A.uniforms.add(new q.Texture2DPassUniform("u_image",F=>F.u_image),new u.IntegerPassUniform("u_hillshadeType",F=>F.symbolizer.u_hillshadeType),new l.FloatsPassUniform("u_sinZcosAs",F=>F.symbolizer.u_sinZcosAs,6),new l.FloatsPassUniform("u_sinZsinAs",F=>F.symbolizer.u_sinZsinAs,6),new l.FloatsPassUniform("u_cosZs",F=>F.symbolizer.u_cosZs,6),new l.FloatsPassUniform("u_weights",F=>F.symbolizer.u_weights,6),new e.Float2PassUniform("u_factor",F=>F.symbolizer.u_factor),
new n.FloatPassUniform("u_minValue",F=>F.symbolizer.u_minValue),new n.FloatPassUniform("u_maxValue",F=>F.symbolizer.u_maxValue),new e.Float2PassUniform("u_srcImageSize",F=>F.common.u_srcImageSize));A.include(f.ColorConversion);A.code.add(x.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);A.code.add(x.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);B=B.applyColormap?x.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;A.code.add(x.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${B}
    }
  `)}class r extends k.CommonPassParameters{constructor(A,B,F,G,H,L){super(A,G,H);this.colormap=B;this.symbolizer=F;this.u_colormap=L;this.backgroundColor=b.ZEROS;this.fboTexture=null;this.baseOpacity=1}}class y extends r{}class D extends r{}const E=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:D,ColorizerStretchUniforms:y,ColorizerUniforms:r,build:v},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=D;a.ColorizerStretchUniforms=y;a.ColorizerUniforms=
r;a.RasterColorizer=E;a.build=v})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,h,c){a.Colormap=function(k){k.fragment.uniforms.add(new c.Texture2DPassUniform("u_colormap",m=>m.u_colormap),new b.FloatPassUniform("u_colormapOffset",m=>m.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",m=>m.colormap.u_colormapMaxIndex),
new b.FloatPassUniform("u_opacity",m=>m.common.u_opacity));k.fragment.code.add(h.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d){class f extends h.TileCompositePassParameters{constructor(g,e,n){super();this.common=g;this.u_image=e;this.u_transformGrid=
n}}a.Common=function(g,e){g.include(b.Projection);g.fragment.uniforms.add(new d.Texture2DPassUniform("u_image",n=>n.u_image),new c.BooleanPassUniform("u_flipY",n=>n.common.u_flipY),new c.BooleanPassUniform("u_applyTransform",n=>n.common.u_applyTransform));({requireBilinearWithNN:e}=e);e&&g.fragment.uniforms.add(new k.Float2PassUniform("u_srcImageSize",n=>n.common.u_srcImageSize));g.fragment.code.add(m.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);e?g.fragment.code.add(m.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):g.fragment.code.add(m.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,h,c){a.Projection=function(k){k.fragment.uniforms.add(new c.Texture2DPassUniform("u_transformGrid",m=>m.u_transformGrid),new b.Float2PassUniform("u_transformSpacing",m=>m.common.u_transformSpacing),
new b.Float2PassUniform("u_targetImageSize",m=>m.common.u_targetImageSize));k.fragment.code.add(h.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,h,c,k,m){class d extends k.NoParameters{constructor(){super(...arguments);this.scale=1;this.offset=b.ZEROS}}a.TileComposite=
function(f){f.attributes.add(m.VertexAttribute.POSITION,"vec2");f.attributes.add(m.VertexAttribute.UV0,"vec2");f.vertex.uniforms.add(new c.FloatPassUniform("scale",g=>g.scale));f.vertex.uniforms.add(new h.Float2PassUniform("offset",g=>g.offset));f.varyings.add("uv","vec2");f.varyings.add("vuv","vec2");f.vertex.code.add(k.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,
b,h,c,k,m,d,f,g){a.BlendLayersOutput=void 0;(function(n){n[n.Composite=0]="Composite";n[n.ColorComposite=1]="ColorComposite";n[n.GridComposite=2]="GridComposite";n[n.GroupBackgroundComposite=3]="GroupBackgroundComposite";n[n.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(n){n[n.NotRequired=0]="NotRequired";n[n.Required=1]="Required";n[n.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;(function(n){n[n.Off=
0]="Off";n[n.On=1]="On";n[n.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));class e extends f.NoParameters{constructor(){super(...arguments);this.baseOpacity=1;this.backgroundColor=b.ZEROS;this.fboTexture=null}}a.TileBackground=function(n,l){const u=l.output===a.BlendLayersOutput.GridComposite,x=l.output===a.BlendLayersOutput.ColorComposite,w=l.output===a.BlendLayersOutput.GroupBackgroundComposite,q=l.output===a.BlendLayersOutput.Composite;u&&n.fragment.include(c.BackgroundGrid);
x&&n.fragment.uniforms.add(new m.Float3PassUniform("backgroundColor",r=>r.backgroundColor));const v=l.baseOpacityMode===a.BaseOpacityMode.Required;v&&n.fragment.uniforms.add(new d.FloatPassUniform("baseOpacity",r=>r.baseOpacity));q&&n.fragment.uniforms.add(new g.Texture2DPassUniform("fboColor",r=>r.fboTexture));const p=l.blendMode!==h.LayerBlendMode.Normal,t=l.premultipliedSource===a.PremultipliedAlphaSource.On;n.fragment.include(k.BlendModes,l);n.fragment.code.add(f.glsl`
    vec4 getBackground(vec2 uv) {
      return ${v?f.glsl`baseOpacity *`:""} ${w?f.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:x?f.glsl`vec4(backgroundColor, 1.0)`:u?f.glsl`vec4(gridColor(uv), 1.0)`:f.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${p?f.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:f.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!t&&(q&&!v||w)?f.glsl`colorLayer * opacity;`:f.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(h){h.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,h){a.BlendModes=function(c,k){k=k.blendMode;if(k!==b.LayerBlendMode.Normal){k===b.LayerBlendMode.Reflect&&c.code.add(h.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);k!==b.LayerBlendMode.ColorDodge&&k!==b.LayerBlendMode.VividLight||c.code.add(h.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);k!==b.LayerBlendMode.ColorBurn&&k!==b.LayerBlendMode.VividLight||c.code.add(h.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);k===b.LayerBlendMode.Overlay&&c.code.add(h.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);k===b.LayerBlendMode.HardLight&&c.code.add(h.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);k===b.LayerBlendMode.SoftLight&&c.code.add(h.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);k===b.LayerBlendMode.VividLight&&c.code.add(h.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(k===b.LayerBlendMode.Hue||k===b.LayerBlendMode.Saturation||k===b.LayerBlendMode.Color||k===b.LayerBlendMode.Luminosity)c.code.add(h.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),k!==b.LayerBlendMode.Hue&&k!==b.LayerBlendMode.Saturation||c.code.add(h.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);c.code.add(h.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${k===b.LayerBlendMode.Multiply?h.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Average?h.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Lighten?h.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Darken?h.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Lighter?h.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:k===b.LayerBlendMode.Plus?h.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:k===b.LayerBlendMode.Minus?h.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:k===b.LayerBlendMode.Screen?h.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Difference?h.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Invert?h.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.DestinationOver?h.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:k===b.LayerBlendMode.DestinationAtop?h.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:k===b.LayerBlendMode.DestinationOut?h.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:k===b.LayerBlendMode.SourceAtop?h.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.SourceOut?
h.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:k===b.LayerBlendMode.Xor?h.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:k===b.LayerBlendMode.DestinationIn?h.glsl`return vec4(cb * ob * ol, ol * ob);`:k===b.LayerBlendMode.SourceIn?h.glsl`return vec4(cl * ol * ob, ol * ob);`:k===b.LayerBlendMode.Hue?h.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Saturation?h.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Color?h.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Luminosity?h.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Exclusion?h.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Reflect?h.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorDodge?h.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorBurn?h.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Overlay?h.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.SoftLight?h.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.HardLight?h.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.VividLight?h.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:h.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],function(a,b,h,c,k){a.createColormapTexture=function(m,d){const f=new k.TextureDescriptor;f.internalFormat=h.PixelFormat.RGBA;f.width=d.length/4;f.height=1;f.samplingMode=h.TextureSamplingMode.NEAREST;f.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new c.Texture(m,f,d)};a.createRasterTexture=
function(m,d,f="nearest",g=!1){const e=(g=!(g&&"u8"===d.pixelType))?h.PixelType.FLOAT:h.PixelType.UNSIGNED_BYTE,n=null==d.pixels||0===d.pixels.length?null:g?d.getAsRGBAFloat():d.getAsRGBA(),l=m.capabilities.textureFloat?.textureFloatLinear,u=new k.TextureDescriptor;u.width=d.width;u.height=d.height;u.internalFormat=g?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;u.samplingMode=!l||"bilinear"!==f&&"cubic"!==f?h.TextureSamplingMode.NEAREST:h.TextureSamplingMode.LINEAR;u.dataType=e;u.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;
return new c.Texture(m,u,n)};a.createTransformTexture=function(m,d){const {spacing:f,offsets:g,coefficients:e,size:[n,l]}=d;var u=1<f[0];d=new k.TextureDescriptor;d.width=u?4*n:n;d.height=l;d.internalFormat=h.SizedPixelFormat.RGBA32F;d.dataType=h.PixelType.FLOAT;d.samplingMode=h.TextureSamplingMode.NEAREST;d.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;const x=new Float32Array(u?n*l*16:2*g.length);if(u&&null!=e)for(let w=0,q=0;w<e.length;w++)x[q++]=e[w],2===w%3&&(x[q++]=1);else for(u=0;u<l;u++)for(let w=
0;w<n;w++){const q=4*(u*n+w),v=2*(w*l+u);x[q]=g[v];x[q+1]=g[v+1];x[q+3]=-1===g[v]?0:1}return new c.Texture(m,d,x)};a.getBasicGridUniforms=function(m,d){return{u_scale:m,u_offset:d}};a.getColormapUniforms=function(m,d){return{u_colormapOffset:d||0,u_colormapMaxIndex:m?m.length/4-1:0}};a.getCommonUniforms=function(m,d,f,g=1,e=!0){return{u_flipY:e,u_applyTransform:!!m,u_opacity:g,u_transformSpacing:m?m.spacing:b.ZEROS,u_transformGridSize:m?m.size:b.ZEROS,u_targetImageSize:d,u_srcImageSize:f}};a.getShadedReliefUniforms=
function(m){return{u_hillshadeType:m.hillshadeType,u_sinZcosAs:m.sinZcosAs,u_sinZsinAs:m.sinZsinAs,u_cosZs:m.cosZs,u_weights:m.weights,u_factor:m.factor,u_minValue:m.minValue,u_maxValue:m.maxValue}};a.getStretchUniforms=function(m){return{u_bandCount:m.bandCount,u_minOutput:m.outMin,u_maxOutput:m.outMax,u_minCutOff:m.minCutOff,u_maxCutOff:m.maxCutOff,u_factor:m.factor,u_useGamma:m.useGamma,u_gamma:m.gamma,u_gammaCorrection:m.gammaCorrection}};a.getUniformLocationInfos=function(m,d){m=m.gl;d=d.glName;
const f=new Map;if(null==d)return f;const g=m.getProgramParameter(d,m.ACTIVE_UNIFORMS);let e;for(let n=0;n<g;n++)(e=m.getActiveUniform(d,n))&&f.set(e.name,{location:m.getUniformLocation(d,e.name),info:e});return f};a.setTextures=function(m,d,f,g){f.length===g.length&&(g.some(e=>null==e)||f.some(e=>null==e)||f.forEach((e,n)=>{d.setUniform1i(e,n);m.bindTexture(g[n],n)}))};a.setUniforms=function(m,d,f){Object.keys(f).forEach(g=>{var e=d.get(g)||d.get(g+"[0]");if(e){var n=f[g];if(null!==e&&null!=n)switch({info:e}=
e,e.type){case h.UniformType.FLOAT:1<e.size?m.setUniform1fv(g,n):m.setUniform1f(g,n);break;case h.UniformType.FLOAT_VEC2:m.setUniform2fv(g,n);break;case h.UniformType.FLOAT_VEC3:m.setUniform3fv(g,n);break;case h.UniformType.FLOAT_VEC4:m.setUniform4fv(g,n);break;case h.UniformType.FLOAT_MAT3:m.setUniformMatrix3fv(g,n);break;case h.UniformType.FLOAT_MAT4:m.setUniformMatrix4fv(g,n);break;case h.UniformType.INT:1<e.size?m.setUniform1iv(g,n):m.setUniform1i(g,n);break;case h.UniformType.BOOL:m.setUniform1i(g,
n?1:0);break;case h.UniformType.INT_VEC2:case h.UniformType.BOOL_VEC2:m.setUniform2iv(g,n);break;case h.UniformType.INT_VEC3:case h.UniformType.BOOL_VEC3:m.setUniform3iv(g,n);break;case h.UniformType.INT_VEC4:case h.UniformType.BOOL_VEC4:m.setUniform4iv(g,n)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,h,c,k,m){class d{constructor(){this.waitingAgents=new c;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}static acquire(e){const n=f.acquire();n._init(e);return n}release(){this.dispose();g.delete(this);f.release(this)}dispose(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=k.releaseTileData(this._data)}static prune(){f.prune(0)}_init(e){this.waitingAgents.clear();
this._data=k.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=e;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),
this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,n){if(e===n||null==n)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===n)return;this._upsampleInfo.tile.unrefMapData()}n.refMapData();m.computeUpsampleInfo(e,n,this._upsampleInfo)}}get data(){return this._data}set data(e){k.releaseTileData(this._data);this._data=e}}const f=new h(d,null,()=>{}),g=new Map;a.TilePerLayerInfo=d;a.printAllocations=
function(){0<g.size&&(console.log(`${g.size} live TilePerLayerInfo allocations:`),g.forEach(e=>console.log(e,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(function(){class a{constructor(b,h){this._texture=b;this._cache=h;this.type="tile-texture";this._refCount=1}retain(){++this._refCount}release(){--this._refCount;0===this._refCount&&(this._cache?this._cache.put(`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`,
this):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}}return a})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.GEOMETRY=8]="GEOMETRY";
b[b.TEXTURE_NOFADING=16]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=32]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a){class b{constructor(){this._scales=a.fromValues(-1,-1,-1,-1);this._offsets=a.fromValues(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=
-1}setScale(h,c,k){this._scales[2*h]=c;this._scales[2*h+1]=k}setOffset(h,c,k){this._offsets[2*h]=c;this._offsets[2*h+1]=k}get scales(){return this._scales}get offsets(){return this._offsets}}return b})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u extends m.ShaderTechnique{constructor(){super(...arguments);this.useStencil=!1}initializeConfiguration(w,q){q.spherical=w.viewingMode===h.ViewingMode.Global}initializeProgram(w){return new f.Program(w.rctx,u.shader.get().build(this.configuration),x)}initializePipeline(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)}_createPipeline(w){const q=this.configuration,v=q.backfaceCullingEnabled&&!q.renderOccluded;return l.makePipelineState({blending:q.renderOccluded?
l.simpleBlendingParams(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:v?l.backFaceCullingParams:null,depthTest:q.renderOccluded?null:{func:n.CompareFunction.LESS},depthWrite:q.renderOccluded?null:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams,stencilTest:w?g.renderWhenBitIsNotSet(d.StencilBits.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}u.shader=new k.ReloadableShaderModule(c.Terrain,()=>
new Promise((w,q)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],w,q)));const x=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,1],[e.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=u;b.terrainVertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C){function z(M){const S=new L.ShaderBuilder,{vertex:N,fragment:V,varyings:Q}=S;S.include(l.PositionAttribute);S.include(n.NormalAttribute,M);S.include(u.TextureCoordinateAttribute,M);var T=()=>{S.include(r.NormalUtils,M);N.code.add(G.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};B.addProjViewLocalOrigin(N,M);S.include(e.Transform,M);const ia=M.overlayMode!==E.OverlayMode.Disabled;var O=ia&&M.invisible;switch(M.output){case f.ShaderOutput.Color:S.include(A.TerrainTexture,M);S.include(p.EvaluateSceneLighting,M);ia&&S.include(E.OverlayTerrain,{...M,pbrMode:M.pbrMode===y.PBRMode.Simplified?y.PBRMode.TerrainWithWater:y.PBRMode.Water});(O=M.overlayMode===E.OverlayMode.EnabledWithWater)&&S.include(x.VertexTangent,M);Q.add("vnormal","vec3");Q.add("vpos","vec3");Q.add("vup",
"vec3");T();M.screenSizePerspective&&B.addViewNormal(N);(T=M.receiveShadows&&!M.renderOccluded)&&S.include(d.ForwardLinearDepth,M);M.screenSizePerspective&&(Q.add("screenSizeDistanceToCamera","float"),Q.add("screenSizeCosAngle","float"));N.code.add(G.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${O?G.glsl`forwardVertexTangent(vnormal);`:G.glsl``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${ia?G.glsl`setOverlayVTC(uv);`:""}
          ${M.tileBorders?G.glsl`forwardTextureCoordinates();`:""}

          ${M.screenSizePerspective?G.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${T?G.glsl`forwardLinearDepth();`:""}

        }
      `);S.include(g.SliceDraw,M);S.include(p.EvaluateSceneLighting,M);S.include(v.EvaluateAmbientOcclusion,M);S.include(D.ReadShadowMapDraw,M);B.addCameraPosition(V,M);p.addAmbientBoostFactor(V);p.addLightingGlobalFactor(V);V.uniforms.add(N.uniforms.get("localOrigin"),new F.Float3PassUniform("viewDirection",(U,P)=>c.normalize(I,c.set(I,P.camera.viewMatrix[12],P.camera.viewMatrix[13],P.camera.viewMatrix[14]))));O&&V.uniforms.add(new C.Texture2DPassUniform("ovWaterTex",(U,P)=>P.overlay?.getTexture(m.OverlayContent.WaterNormal)),
new H.Matrix4DrawUniform("view",(U,P)=>b.translate(K,P.camera.viewMatrix,U.origin)));V.code.add(G.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);t.addMainLightDirection(V);t.addMainLightIntensity(V);V.code.add(G.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${M.receiveShadows&&!M.renderOccluded?"readShadowMap(vpos, linearDepth)":M.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${ia?G.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${M.invisible?G.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${M.pbrMode===y.PBRMode.Simplified||M.pbrMode===y.PBRMode.TerrainWithWater?G.glsl`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:G.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${O?G.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${M.screenSizePerspective?G.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${M.visualizeNormals?M.spherical?G.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:G.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${M.tileBorders?G.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case f.ShaderOutput.LinearDepth:O&&S.include(E.OverlayTerrain,M);S.include(w.OutputDepth,M);d.addLinearDepth(S);d.addNearFar(S);N.code.add(G.glsl`
              void main(void) {
                ${O?G.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);V.code.add(G.glsl`
              void main() {
                ${O?G.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case f.ShaderOutput.Shadow:case f.ShaderOutput.ShadowHighlight:case f.ShaderOutput.ShadowExcludeHighlight:S.include(w.OutputDepth,M);d.addLinearDepth(S);d.addNearFar(S);N.code.add(G.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);V.code.add(G.glsl`void main() {
outputDepth(linearDepth);
}`);break;case f.ShaderOutput.Normal:O&&S.include(E.OverlayTerrain,M);Q.add("vnormal","vec3");B.addViewNormal(N);T();N.code.add(G.glsl`
        void main(void) {
          ${O?G.glsl`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `);V.code.add(G.glsl`
        void main() {
          ${O?G.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case f.ShaderOutput.Highlight:ia&&S.include(E.OverlayTerrain,M),N.code.add(G.glsl`
          void main() {
            ${ia?G.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),S.include(q.OutputHighlight,M),V.code.add(G.glsl`
          void main() {
            ${ia?G.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}M.output===f.ShaderOutput.ObjectAndLayerIdColor&&(ia?(S.include(E.OverlayTerrain,{...M,pbrMode:y.PBRMode.Disabled}),N.code.add(G.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),V.code.add(G.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(N.code.add(G.glsl`void main(void) {}`),V.code.add(G.glsl`void main() {
fragColor = vec4(0.0);
}`)));return S}class J extends A.OverlayTerrainPassParameters{}const K=h.create(),I=k.create();h=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:J,build:z},Symbol.toStringTag,{value:"Module"}));a.Terrain=h;a.TerrainPassParameters=J;a.build=z})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.VertexTangent=function(h,c){h.varyings.add("tbnTangent","vec3");h.varyings.add("tbnBiTangent",
"vec3");c.spherical?h.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):h.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);h.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/interfaces ../../shaderModules/Uniform".split(" "),function(a,b,h,c,k,m){class d extends b.ReadShadowMapPassParameters{constructor(){super(...arguments);this.overlayOpacity=1}}class f extends m.Uniform{constructor(l){super(l,"float")}}class g extends m.Uniform{constructor(l){super(l,
"vec3")}}class e extends m.Uniform{constructor(l){super(l,"vec4")}}class n extends m.Uniform{constructor(l){super(l,"sampler2D")}}a.Float3Uniform=g;a.OverlayTerrainPassParameters=d;a.TerrainTexture=function(l,u){const {vertex:x,fragment:w,varyings:q}=l;q.add("vtc","vec2");x.uniforms.add(new e("texOffsetAndScale"));w.uniforms.add(new n("tex"));w.uniforms.add(new g("textureOpacities"));if(l=u.textureFadingEnabled&&!u.renderOccluded)x.uniforms.add(new e("nextTexOffsetAndScale")),q.add("nvtc","vec2"),
w.uniforms.add(new n("texNext")),w.uniforms.add(new g("nextTexOpacities")),w.uniforms.add(new f("fadeFactor"));const v=u.tileBlendInput===c.TileBlendInput.ColorComposite;(u=u.tileBlendInput===c.TileBlendInput.GridComposite)&&w.include(h.BackgroundGrid);v&&w.uniforms.add(new g("backgroundColor"));x.code.add(k.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${l?k.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:k.glsl``}
  }`);w.code.add(k.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${u||v?k.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${v?k.glsl`backgroundColor`:k.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:k.glsl`return color;`}
    }`);l?w.code.add(k.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):w.code.add(k.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u{constructor(){this.extent=l.create();this.maxLevel=this.minLevel=0;this.callback=null}}a.ScaleRangeQueries=class extends h{constructor(){super(...arguments);this._queries=new k({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new k({initialSize:30});this._queryPool=new c(u)}queryVisibleLevelRange(x,w,q,v){const p=this._queryPool.acquire();n.copy(p.extent,x);p.minLevel=null==w?-Number.MAX_VALUE:w;p.maxLevel=null==q?Number.MAX_VALUE:q;p.callback=v;this._queryQueue.push(p);
this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const x=this._queryQueue.pop();this._queries.push(x)}this._queriesInvPtr=this._queries.length}process(){for(let x=0;x<this._queries.length;x++){const w=this._queries.data[x];this._queryPool.release(w);w.callback(x>=this._queriesInvPtr);w.callback=null}this._queries.clear();this.notifyChange("updating")}queriesForTile(x){const w=
x.level;let q=0;for(;q<this._queriesInvPtr;){const v=this._queries.data[q],p=v.extent;w>=v.minLevel&&w<=v.maxLevel&&p[0]<=x.extent[2]&&p[2]>=x.extent[0]&&p[1]<=x.extent[3]&&p[3]>=x.extent[1]?(this._queries.swapElements(q,this._queriesInvPtr-1),this._queriesInvPtr--):q++}}};b.__decorate([m.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=b.__decorate([e.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../core/mathUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/lonLatToSphericalPCPF ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./ITile ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(D,E,A,B,F,G){D=B-D;E=F-E;A=G-A;return D*
D+E*E+A*A}class q extends u.Tile{constructor(D,E,A,B,F){super();this._convexHull=Array(24);this._boundingSphere=f.create();this._baseUsedMemory=1816;this.init(D,E,A,B,F)}init(D,E,A,B,F){super.init(D,E,A,B,F);E=this.ellipsoid.radius;A=this.extentInRadians[0];B=this.extentInRadians[1];F=this.extentInRadians[2];const G=this.extentInRadians[3],H=b.lerp(B,G,.5),L=b.lerp(A,F,.5);this._edgeLen=(F-A)*Math.cos(0===D?0:Math.min(Math.abs(B),Math.abs(G)))*E;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=
E-Math.sqrt(E*E-this._edgeLen2/4);k.lonLatToSphericalPCPF(this.centerAtSeaLevel,L,H,this.ellipsoid.radius);h.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const D=this._center;if(0===this.lij[0])h.set(f.getCenter(D[u.CenterPosition.MIDDLE]),0,0,0),h.set(D[u.CenterPosition.TOP],0,0,0),h.set(D[u.CenterPosition.BOTTOM],0,0,0),D[u.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();
const H=D[u.CenterPosition.MIDDLE],L=this.convexHull;var E=0;for(let C=0;8>C;++C){var A=Math,B=A.max;var F=f.getCenter(H);var G=3*C;F=w(F[0],F[1],F[2],L[G],L[G+1],L[G+2]);E=B.call(A,E,F)}D[u.CenterPosition.MIDDLE][3]=Math.sqrt(E)}}_calculateFrustumVisibilityStatus(D){if(!d.intersectsSphere(D,this._boundingSphere))return e.TileFrustumVisibility.OUTSIDE;if(10>this.lij[0])return e.TileFrustumVisibility.INTERSECTS;const E=this.convexHull,A=this.surface.view.state.camera.near;let B=!0;for(let G=0;G<d.numPlanes;G++){var F=
D[G];const H=F[0],L=F[1],C=F[2];F=F[3]-(G===d.PlaneIndex.NEAR?A:0);let z=!1;for(let J=0;8>J;++J){const K=3*J;if(0>H*E[K]+L*E[K+1]+C*E[K+2]+F){if(z=!0,!B)break}else B=!1}if(!z)return e.TileFrustumVisibility.OUTSIDE}return B?e.TileFrustumVisibility.INSIDE:e.TileFrustumVisibility.INTERSECTS}computeElevationBounds(){super.computeElevationBounds();this._updateBoundingVolumes()}createGeometry(){n.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull();
this._updateBoundingSphere();l.enableTerrainInternalChecks&&this._checkBVs()}_updateBoundingSphere(){const D=this._boundingSphere,E=f.getCenter(D);var A=this.elevationBounds,B=this.ellipsoid.radius,F=A[1];if(0===this.level)h.set(E,0,0,0),D[3]=B+F;else{F=this.extentInRadians;var G=.5*(F[0]+F[2]),H=F[3];p(r,G,F[1],B);p(y,G,H,B);h.add(E,r,y);h.scale(E,E,(B+.5*(A[0]+A[1]))/h.len(E));A=this.convexHull;B=0;for(F=0;8>F;++F){G=E[0]-A[3*F];H=E[1]-A[3*F+1];const L=E[2]-A[3*F+2];B=Math.max(B,Math.sqrt(G*G+H*
H+L*L))}D[3]=B+2}}_updateConvexHull(){var D=this.extentInRadians,E=this.ellipsoid.radius;if(0!==this.level){var A=this.elevationBounds,B=this._getPatchType(),F=this.surface.isWebMercator,G=F&&B===g.PatchType.HAS_NORTH_POLE,H=(B=F&&B===g.PatchType.HAS_SOUTH_POLE)||G;F=Math.PI/2;var L=D[0],C=D[2];B=B?-F:D[1];var z=G?F:D[3],J=.5*(L+C);D=A[0];var K=E+(H?Math.min(0,D-1):D);D=c.create();G=c.create();F=c.create();var I=c.create();p(D,L,B,K);p(G,L,z,K);p(F,C,z,K);p(I,C,B,K);L=(Q,T)=>{for(let ia=0;3>ia;++ia)this._convexHull[3*
T+ia]=Q[ia]};L(D,0);L(G,1);L(F,2);L(I,3);A=A[1];var M=E+(H?Math.max(0,A+1):A),S=c.create();E=c.create();A=c.create();p(E,J,z,K);p(A,J,B,K);h.add(S,E,A);h.normalize(S,S);var N=c.create(),V=c.create();B=(Q,T)=>{h.sub(V,Q,T);h.normalize(V,V);T=-h.dot(Q,N)/h.dot(V,N);l.internalAssert(0<=T);h.scale(V,V,T);h.add(Q,Q,V)};2**this.lij[0]>2*this.lij[1]?(E=c.create(),h.cross(E,t,A),h.normalize(E,E),h.cross(N,A,E),h.normalize(N,N),l.internalAssert(l.almostEquals(h.dot(N,A)/h.len(A),0)),B(D,G),B(I,F),L(D,0),L(I,
3)):2**this.lij[0]!==2*this.lij[1]&&(A=c.create(),h.cross(A,t,E),h.normalize(A,A),h.cross(N,A,E),h.normalize(N,N),B(G,D),B(F,I),L(G,1),L(F,2));E=(Q,T)=>{const ia=M/h.dot(T,S);for(let O=0;3>O;++O)this._convexHull[3*Q+O]=T[O]*ia};E(4,D);E(5,G);E(6,F);E(7,I)}}_getPatchType(){const D=this.lij[1],E=D===(1<<this.level)-1;return 0===D?E?g.PatchType.HAS_BOTH_POLES:g.PatchType.HAS_NORTH_POLE:E?g.PatchType.HAS_SOUTH_POLE:g.PatchType.REGULAR}intersectsRay(D,E,A,B){var F=this._boundingSphere;A=F[3]+A;var G=F[0]-
D[0];B=F[1]-D[1];D=F[2]-D[2];F=(G*E[0]+B*E[1]+D*E[2])/(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);G=E[0]*F-G;B=E[1]*F-B;E=E[2]*F-D;return G*G+B*B+E*E<A*A}getDefaultVerticesPerSide(){return this.level<v.length?v[this.level]+1:2}updateCornerElevations(){n.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevations(){n.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){n.updateEdgeElevationsAndResolutionsSpherical(this.renderData);
this._updateBoundingVolumes()}_checkBVs(){if(l.enableTerrainInternalChecks&&!(2>=this.level)){var D=this._boundingSphere,E=D[3],A=f.getCenter(D);D=c.create();var B=this.ellipsoid.radius,F=this.elevationBounds;F[1]-F[0];var G=B+F[0],H=this._center[u.CenterPosition.MIDDLE][3],L=this.convexHull,C=(ta,ya)=>{for(let Ca=0;3>Ca;++Ca)ta[Ca]=L[3*ya+Ca]},z=c.create(),J=c.create(),K=c.create(),I=c.create(),M=c.create(),S=(ta,ya,Ca,pa)=>{C(J,ta);C(K,ya);C(I,Ca);h.sub(J,J,K);h.sub(I,I,K);h.cross(z,J,I);h.normalize(z,
z);var wa=h.dot(z,K);C(M,pa);const Ba=h.dot(z,M);wa=Math.abs(Ba-wa);l.internalAssert(l.almostEquals(wa,0),`Non coplanar ${ta},${ya},${Ca},${pa} diff = ${wa}`)};S(0,1,2,3);S(4,5,6,7);S(0,1,4,5);S(1,2,5,6);S(2,3,6,7);S(3,0,7,4);var N=m.newDoubleArray(24),V=c.create(),Q=c.create(),T=c.create(),ia=c.create();S=(ta,ya,Ca,pa)=>{C(V,ya);C(Q,Ca);C(T,pa);h.sub(V,V,Q);h.normalize(V,V);h.sub(T,T,Q);h.normalize(T,T);h.cross(ia,V,T);h.normalize(ia,ia);ya=h.dot(ia,Q);ta*=4;for(Ca=0;3>Ca;++Ca)N[ta+Ca]=ia[Ca];N[ta+
3]=ya};S(0,0,1,2);S(1,1,0,4);S(2,1,5,2);S(3,3,2,6);S(4,4,0,3);S(5,4,6,5);var O=(ta,ya,Ca,pa)=>{ta*=4;return N[ta]*ya+N[ta+1]*Ca+N[ta+2]*pa-N[ta+3]},U=(ta,ya,Ca,pa)=>-1<=O(ta,ya,Ca,pa),P=2**this.lij[0]>2*this.lij[1];S=(ta,ya,Ca)=>Math.sqrt(w(ta,ya,Ca,A[0],A[1],A[2]))<E;var R=this.extentInRadians,ba=.5*(R[0]+R[2]),X=R[1],da=R[3];R=c.create();var ha=c.create();p(R,ba,da,G);p(ha,ba,X,G);G=P?"Upper":"Lower";P=!0;for(ba=0;6>ba;++ba){for(X=0;8>X;++X)da=3*X,da=-1<=O(ba,L[da],L[da+1],L[da+2]),P&&=da,l.internalAssert(da,
`Tile[${this.lij}] Convex hull point ${X} outside of plane ${ba}`);l.internalAssert(U(ba,ha[0],ha[1],ha[2]),`Tile[${this.lij}] (${G}) bottom mid outside of plane ${ba}`);l.internalAssert(U(ba,R[0],R[1],R[2]),`Tile[${this.lij}] (${G}) top mid outside of plane ${ba}`)}l.internalAssert(P,"Not all convex hull points are inside  convex hull polyhedron");l.internalAssert(S(ha[0],ha[1],ha[2]),`Tile[${this.lij}] (${G}) bottom mid outside of bounding sphere`);l.internalAssert(S(R[0],R[1],R[2]),`Tile[${this.lij}] (${G}) top mid outside of bounding sphere`);
for(U=0;8>U;++U)R=3*U,R=S(L[R],L[R+1],L[R+2]),l.internalAssert(R,`Tile[${this.lij}] Convex hull point ${U} outside of bounding sphere`);for(S=0;6>S;++S)for(U=0;8>U;++U)R=3*U,-1<=O(S,L[R],L[R+1],L[R+2])||console.error(`Tile[${this.lij}] Convex hull point ${U} outside of plane ${S}`);({extentInRadians:S}=this);S=Math.round(Math.max(S[2]-S[0],S[3]-S[1])*B);({renderData:U}=this);if(U){var {geometry:fa,geometryState:aa,localOrigin:Z}=U;if(U=fa.vertexAttributes?.position){R=c.create();ha=fa.numVerticesPerSide-
2;var {indices:ea,indexCount:ca,edgeVerticesStartIndex:W,poleVerticesStartIndex:Y}=fa;if(ea)for(G=new Set,P=0;P<ca;++P){const ta=ea[P];if(G.has(ta))continue;G.add(ta);const ya=ta<Y,Ca=ta>=W;let pa=!1;ba=-1;if(Ca)for(X=W,da=0;4>da;++da){var ja=aa.edgeResolutions[da];if(ta===X||ta===X+ja-1){pa=!0;break}X+=ja;if(ta<X){ba=da;break}}ba=Ca?aa.edgePeerNeighbors[ba]:null;const wa=Ca&&ba&&0<x.compareTilesByLij(this,ba);U.getVec(ta,D);h.add(R,D,Z);ba=h.len(R)-B;X=0;da=!1;ja=F[0]-ba;const Ba=ba-F[1],la=1<ja,
qa=1<Ba;var oa=la||qa;const ua=()=>{const va=Ca&&!pa;return`Tile[${this.lij}].vertex[${ta}]:${ya?"internal":va?"edge":pa?"corner":"pole"}`+(la?"(below)":qa?"(above)":"")+(wa?"(Neighbor)":"")};var ra=h.dist(R,A);ra>=E+0&&(ra-=E,oa||(console.error(`${ua()} is out of the bounding sphere by ${ra.toFixed(0)} / ${E.toFixed(0)}`+"[tol\x3d0]"+` h=${ba.toFixed(0)} / [${F[0].toFixed(0)}..${F[1].toFixed(0)}] (${(ra/E).toFixed(0)})`),da=!0));for(oa=0;6>oa;++oa)if(!(-1<=O(oa,R[0],R[1],R[2]))){ra=O(oa,R[0],R[1],
R[2]);const va=ta%ha,Ga=(ta-va)/ha;0===oa&&ja||5===oa&&Ba||(console.error(`${ua()} (${va},${Ga})|${ha}] is out of the bounding trapezoid plane ${oa}`+` h=${Math.round(ba)} / [${Math.round(F[0])}..${Math.round(F[1])}] dist=${Math.round(ra)}`+` radii = ${Math.round(E)}/${Math.round(H)}} : maxL = ${S}`),++X)}if(da||0<X)break}}}}}get convexHull(){return this._convexHull}}const v=[128,64,64,32,16,8,8,4],p=(D,E,A,B)=>{const F=Math.sin(E),G=Math.cos(A);A=Math.sin(A);D[0]=B*G*Math.cos(E);D[1]=B*G*F;D[2]=
B*A},t=[0,0,1],r=c.create(),y=c.create();a.SphericalPatch=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/lonLatToSphericalPCPF":function(){define(["exports"],function(a){a.lonLatToSphericalPCPF=function(b,h,c,k){const m=Math.cos(c);b[0]=Math.cos(h)*m*k;b[1]=Math.sin(h)*m*k;b[2]=Math.sin(c)*k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){a.SplitLimits=class extends h{constructor(){super(...arguments);this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}};b.__decorate([c.property()],a.SplitLimits.prototype,"fovX",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"fovY",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"relativeHeightLimit",
void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"maxLod",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"aboveGround",void 0);b.__decorate([c.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=b.__decorate([f.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../Color ../../../core/has ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./OverlayContent ./OverlayRenderer ./PatchRenderData ./RenderOrder ./TerrainAttributesCache ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa){const aa=v.create();a.TransparencyMode=void 0;(function(Y){Y[Y.Opaque=0]="Opaque";Y[Y.Semitransparent=1]="Semitransparent";Y[Y.TransparentWithDraped=2]="TransparentWithDraped";Y[Y.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=class extends M.SyncPrepareRenderPlugin{get _isGlobal(){return this._stage.viewingMode===t.ViewingMode.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(Y,
ja,oa,ra,ta){super({});this._overlayRenderer=Y;this._stage=ja;this._allTiles=oa;this._ellipsoidRadius=ra;this.type=T.IntersectorType.TERRAIN;this.isGround=!0;this._tileSize=256;this._techniqueConfiguration=new ha.TerrainTechniqueConfiguration;this._passParameters=new K.TerrainPassParameters;this._drawParameters=new ba.DrawParameters;this._renderDataPool=new d(A.PatchRenderData);this._visiblePatchesByOrigin=new Map;this._allPatchesByOrigin=new Map;this._patchSortingDirty=this._patchesByOriginDirty=
!0;this._tileIterator=new C.IteratorPreorder;this._transparencyState=a.TransparencyMode.Opaque;this._castShadows=!1;this._tileRenderer=this._emptyTex=null;this._stencilEnabledLayerExtents=[];this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;this.renderOccludedFlags=ia.RenderOccludedFlag.Occlude;this.produces=new Map([[O.RenderSlot.OPAQUE_TERRAIN,()=>this._produces()],[O.RenderSlot.TRANSPARENT_TERRAIN,()=>this._produces()],[O.RenderSlot.OCCLUDED_TERRAIN,()=>this._produces()]]);
this._tileTextureCache=new m.MemCachePool((ya,Ca)=>ta.newCache(ya,Ca),"TileTexture");this.tileGeometryCache=new F.TerrainAttributesCache(ta)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this);this.addHandles(f.watch(()=>this._overlayRenderer.rendersOccludedDraped,Y=>{this.renderOccludedFlags=Y?E.overlayRenderOccludedFlag:ia.RenderOccludedFlag.Occlude;this.setNeedsRender()},f.sync))}destroy(){this._stage.removeRenderPlugin(this);this._tileTextureCache.destroy();this.tileGeometryCache.destroy()}_produces(){return this.visible&&
!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?M.ConsumesDepth:M.ConsumesNone}set renderingDisabled(Y){this._set("renderingDisabled",!!Y);this.setDirty()}set visible(Y){this._set("visible",!!Y);this.setDirty()}set transparency(Y){this._transparencyState!==Y&&(this._techniqueConfiguration.invisible=Y===a.TransparencyMode.TransparentWithDraped||Y===a.TransparencyMode.Empty,this._transparencyState=Y,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(Y){this._techniqueConfiguration.tileBorders!==
Y&&(this._techniqueConfiguration.tileBorders=Y,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(Y){this._techniqueConfiguration.visualizeNormals!==Y&&(this._techniqueConfiguration.visualizeNormals=Y,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(Y){this._techniqueConfiguration.backfaceCullingEnabled!==
Y&&(this._techniqueConfiguration.backfaceCullingEnabled=Y,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(Y){this._set("renderOrder",Y);this._setSortingDirty()}get layerUid(){return R.terrainId}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(Y){this._techniqueConfiguration.hasSlicePlane!==Y&&(this._techniqueConfiguration.hasSlicePlane=Y,this.setNeedsRender())}set textureFadingEnabled(Y){this._techniqueConfiguration.textureFadingEnabled!==
Y&&(this._techniqueConfiguration.textureFadingEnabled=Y,this.setNeedsRender())}set pbrMode(Y){this._techniqueConfiguration.pbrMode!==Y&&(this._techniqueConfiguration.pbrMode=Y,this.setNeedsRender())}setDebugScreenSizePerspective(Y){this._techniqueConfiguration.screenSizePerspective!==Y&&(this._techniqueConfiguration.screenSizePerspective=Y,this.setNeedsRender())}setRootTiles(Y){this._rootTiles=Y;this.setDirty()}setStencilEnabledLayerExtents(Y){this._stencilEnabledLayerExtents=Y;this._setSortingDirty()}setTileSize(Y){this._tileSize=
Y;null!=this._tileRenderer&&(this._tileRenderer.tileSize=Y);this.setDirty()}_prepareTileForLoading(Y){Y.renderData||(Y.renderData=this._renderDataPool.acquire(),Y.renderData.init(Y,this._getLocalOriginOfTile(Y)))}loadTile(Y){this._prepareTileForLoading(Y);this.updateTileGeometryState(Y);this.updateTileTexture(Y,L.TileUpdate.TEXTURE_FADING)}updateTileTexture(Y,ja){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(Y,ja===L.TileUpdate.TEXTURE_FADING?r.TextureUpdate.FADING:r.TextureUpdate.UNFADED),
this.setNeedsRender(),Y.resetPendingUpdate(ja))}updateTileGeometryState(Y){for(const ja of Y.layerInfo[y.LayerClass.ELEVATION])ja.pendingUpdates&=~L.TileUpdate.GEOMETRY;Y.resetPendingUpdate(L.TileUpdate.GEOMETRY);(Y=Y.renderData.updateGeometryState())&&this.setDirty();return Y}updateGeometryIfNeeded(Y){Y.isLoaded&&Y.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(Y){const ja=Y.renderData;ja&&(ja.releaseGeometry(),this._renderDataPool.release(ja),ja.clear(),Y.renderData=null,Y.setMemoryDirty(),
this.setDirty())}_getLocalOriginOfTile(Y){const ja=Math.max(0,7*Math.floor((Y.level-3)/7));if(this._isGlobal&&0===ja)return w.ZEROS;for(;Y.parent&&Y.level>ja;)Y=Y.parent;return Y.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(Y){this._get("wireframe")!==Y&&(this._set("wireframe",Y),this.setNeedsRender())}setDirty(Y=N.RenderRequestType.UPDATE){this._patchesByOriginDirty=!0;this._context.requestRender(Y)}_setSortingDirty(Y=
N.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(Y)}setNeedsRender(Y=N.RenderRequestType.UPDATE){this._context.requestRender(Y)}initializeRenderContext(Y){this._context=Y;this._tileRenderer=new H.TileRenderer(this._rctx,this._tileSize,this._techniques,this._tileTextureCache);this.updateTileBackground();this._emptyTex=V.createEmptyTexture(this._rctx)}uninitializeRenderContext(){this._emptyTex=k.disposeMaybe(this._emptyTex);this._tileRenderer=k.disposeMaybe(this._tileRenderer)}intersect(Y,
ja,oa,ra){if(!(!this._rootTiles||Y.options.selectOpaqueTerrainOnly&&Y.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var ta=Z,ya=ea;x.subtract(ta,ra,oa);x.set(ya,1/ta[0],1/ta[1],1/ta[2]);var Ca=Y.results.min,pa=Y.results.max,wa=Y.results.ground,Ba=Y.options.store===T.StoreResults.MIN,la=!!Y.results.ground.target,qa=R.getVerticalOffsetTerrain(Y.verticalOffset),ua=Y.tolerance,va,Ga=Ba&&null!=Ca.dist?Ca.dist:Infinity,La=Wa=>{var Ia=Wa.renderData;if(Ia?.vao){var Oa=Ia.geometry;
v.set(aa,Oa.boundingBox);var Ua=Ia.localOrigin;null!=qa&&(qa.localOrigin=Ua,qa.applyToAabb(aa));ca[0]=oa[0]-Ua[0];ca[1]=oa[1]-Ua[1];ca[2]=oa[2]-Ua[2];if(X.intersectAabbInvDirBefore(aa,ca,ya,ua,Ga)){var Va=(db,ka,mb)=>{db.set(this.type,Wa,ka,mb,u.IDENTITY);Ga=Ba&&null!=Ca.dist?Ca.dist:Infinity};Ia=(db,ka)=>{null!=ka&&0<=db&&(Y.options.backfacesTerrain||0>x.dot(ka,ta))&&(Y.options.invisibleTerrain||!Y.options.selectionMode||null==ja||ja(oa,ra,db))&&((null==wa.dist||db<wa.dist)&&Va(wa,db,ka),Y.options.isFiltered||
(Y.options.store===T.StoreResults.ALL&&(null==va?(va=Q.newIntersectorResult(Y.ray),Va(va,db,ka),Y.results.all.push(va)):db<va.dist&&Va(va,db,ka)),(null==Ca.dist||db<Ca.dist)&&Va(Ca,db,ka),Y.options.store!==T.StoreResults.MIN&&(null==pa.dist||db>pa.dist)&&Va(pa,db,ka)))};var Ra=W;x.subtract(Ra,ra,Ua);var {indices:bb,indexCount:gb}=Oa;Oa=Oa.vertexAttributes;Ua=Oa.getField(P.VertexAttribute.POSITION,p.BufferViewVec3f);Oa=new S.Vertices(Ua.typedBuffer,3,Oa.stride/4);Ua=gb/3;if(!qa&&Ua>z.componentMinimalSizeForIntersectionData){const db=
Wa.renderData;null==db.intersectionData&&(db.intersectionData=new z.ComponentIntersectionData(bb,0,Ua,Oa));db.intersectionData.intersectRay(ca,Ra,Ia)}else X.intersectTriangles(ca,Ra,0,Ua,bb,Oa,null,qa,Ia)}}},Na=this._rootTiles;null!=Na&&(()=>{const Wa=this._tileIterator;Wa.reset(Na);const Ia=Y.options.invisibleTerrain;for(let Oa=Wa.next();Oa;Oa=Wa.next())!(Oa.visible||Ia&&Oa.intersectsClippingArea)||null==qa&&!Oa.intersectsRay(oa,ta,ua,Ga)||la&&this._useStencilForTile(Oa)?Wa.skipSubtree():La(Oa)})()}}processScaleRangeQueries(Y,
ja){if(!ja.done)for(this._updatePatchGroups();Y.updating&&!ja.done;){Y.prepare();for(const oa of this._visiblePatchesByOrigin.values())for(const ra of oa)null!=ra.renderData?.textureReference&&Y.queriesForTile(ra);Y.process();ja.madeProgress()}}prepareTechnique(Y){const ja=c("enable-feature:terrain-shadows")&&Y.bindParameters.shadowMap.enabled;ja!==this._castShadows&&(this._castShadows=ja,this._patchesByOriginDirty=!0);if(Y.bindParameters.slot===O.RenderSlot.OCCLUDED_TERRAIN){if(0===(Y.renderOccludedMask&
E.overlayRenderOccludedFlag))return null}else if(Y.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?O.RenderSlot.OPAQUE_TERRAIN:O.RenderSlot.TRANSPARENT_TERRAIN))return null;if(this.transparency===a.TransparencyMode.Empty)return null;switch(Y.output){case J.ShaderOutput.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=null!=Y.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=Y.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=
Y.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=Y.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(J.ShaderOutput.Color,Y.bindParameters.slot===O.RenderSlot.OCCLUDED_TERRAIN);case J.ShaderOutput.Shadow:case J.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.ShaderOutput.Shadow,
!1);break;case J.ShaderOutput.LinearDepth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.ShaderOutput.LinearDepth,!1);case J.ShaderOutput.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.ShaderOutput.Normal,!1);case J.ShaderOutput.ObjectAndLayerIdColor:return this._updateTechnique(J.ShaderOutput.ObjectAndLayerIdColor,!1);case J.ShaderOutput.Highlight:if(this._overlayRenderer.hasHighlights)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.ShaderOutput.Highlight,!1)}return null}renderNode(Y,ja){this._updatePatchGroups();ja.useStencil=!1;switch(Y.output){case J.ShaderOutput.Color:this._renderMaterialPass(Y,ja,Y.bindParameters.slot===O.RenderSlot.OCCLUDED_TERRAIN?D.OverlayContent.Occluded:D.OverlayContent.Color);break;case J.ShaderOutput.LinearDepth:case J.ShaderOutput.Normal:this._renderAuxiliaryPass(Y,ja,D.OverlayContent.Color,this._visiblePatchesByOrigin);
break;case J.ShaderOutput.Highlight:this._renderAuxiliaryPass(Y,ja,D.OverlayContent.Highlight,this._visiblePatchesByOrigin);break;case J.ShaderOutput.Shadow:case J.ShaderOutput.ShadowExcludeHighlight:this._renderAuxiliaryPass(Y,ja,null,this._allPatchesByOrigin);break;case J.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(Y,ja,D.OverlayContent.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(Y){if(null!=this._tileRenderer){var ja=this._tileRenderer;if(null!=Y){Y=
h.toUnitRGBA(Y);var oa=w.fromValues(Y[0]||0,Y[1]||0,Y[2]||0)}ja.setBackground(oa);this._allTiles.forAll(ra=>ja.updateTileTexture(ra,r.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=ja.backgroundIsGrid?I.TileBlendInput.GridComposite:null!=ja.backgroundColor?I.TileBlendInput.ColorComposite:I.TileBlendInput.LayerOnly;this.setNeedsRender()}}_updatePatchGroups(){this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&
this.renderOrder!==B.RenderOrder.NONE){const Y=Array.from(this._visiblePatchesByOrigin.values()),ja=this._stencilEnabledLayerExtents;for(const oa of Y)C.sortTiles(this.renderOrder,oa,ja);Y.sort((oa,ra)=>C.compareTiles(oa[0],ra[0],this.renderOrder));this._visiblePatchesByOrigin=new Map(Y.map(oa=>[oa[0].renderData.localOrigin,oa]));this._patchSortingDirty=!1}}_rebuildPatchGroups(){const Y=this._rootTiles;if(null!=Y){Y[0]?.surface.checkAllTilesWaterproofness();this._visiblePatchesByOrigin.clear();this._allPatchesByOrigin.clear();
for(const ja of Y)this._rebuildPatchGroupsForRootTile(ja)}}_rebuildPatchGroupsForRootTile(Y){const ja=this._tileIterator;for(ja.resetOne(Y);!ja.done;){Y=ja.next();var oa=Y.renderData;if(oa){oa=oa.localOrigin;if(this._castShadows){var ra=this._allPatchesByOrigin.get(oa);ra||(ra=[],this._allPatchesByOrigin.set(oa,ra));ra.push(Y)}Y.visible?(ra=this._visiblePatchesByOrigin.get(oa),ra||(ra=[],this._visiblePatchesByOrigin.set(oa,ra)),ra.push(Y),ja.skipSubtree()):(this._numTilesCulled++,ja.skipSubtree())}else this._numTilesCulled++}}_useStencilForTile(Y){for(const ja of this._stencilEnabledLayerExtents)if(Y.intersectsExtent(ja))return!0;
return!1}_renderAuxiliaryPass(Y,ja,oa,ra){const ta=Y.rctx;this._passParameters.overlayContent=oa;ta.bindTechnique(ja,Y.bindParameters,this._passParameters);const ya=0<this._stencilEnabledLayerExtents.length;ra.forEach(Ca=>{this._drawParameters.origin=Ca[0].renderData.localOrigin;ja.program.bindDraw(this._drawParameters,Y.bindParameters,this._passParameters);for(let pa=0;pa<Ca.length;pa++)this._renderPatch(Y,ja,Ca[pa],fa.PrimitiveType.TRIANGLES,ya,oa)});Y.rctx.bindVAO(null)}_renderMaterialPass(Y,ja,
oa){var {rctx:ra}=Y;this._passParameters.overlayContent=oa;ra.bindTechnique(ja,Y.bindParameters,this._passParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;var ta=Y.bindParameters.camera;ra=ja.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&U.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ta.fovY});ta=0<this._stencilEnabledLayerExtents.length;
const ya=oa===D.OverlayContent.Occluded;ya&&(ra.bindTexture("tex",this._emptyTex),ra.setUniform3fv("textureOpacities",w.ZEROS),ra.setUniform4fv("texOffsetAndScale",q.ZEROS));var Ca=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:w.ZEROS;this._techniqueConfiguration.tileBlendInput===I.TileBlendInput.ColorComposite&&ra.setUniform3fv("backgroundColor",Ca);Ca=this.wireframe?fa.PrimitiveType.LINES:fa.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&
ra.bindTexture("texNext",this._emptyTex);var pa=this._visiblePatchesByOrigin;for(const wa of pa.values()){ja.program.bindDraw(new ba.DrawParameters(wa[0].renderData.localOrigin),Y.bindParameters,this._passParameters);this._numOriginsRendered++;for(const Ba of wa){pa=Ba.renderData;const la=pa.textureReference;if(null!=la){if(!ya){ra.setUniform4fv("texOffsetAndScale",la.offsetAndScale);ra.bindTexture("tex",la.texture.texture);const qa=pa.textureFadeFactor,ua=1>qa?pa.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&
null!=ua&&1>qa?(ra.setUniform1f("fadeFactor",qa),ra.setUniform4fv("nextTexOffsetAndScale",ua.offsetAndScale),ra.setUniform3fv("nextTexOpacities",ua.opacities),ra.bindTexture("texNext",ua.texture.texture)):ra.setUniform1f("fadeFactor",1);pa.textureIsFading&&this.setNeedsRender();ra.setUniform3fv("textureOpacities",la.opacities)}this._renderPatch(Y,ja,Ba,Ca,ta,oa);Ba.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}Y.rctx.bindVAO(null)}_renderPatch(Y,ja,oa,ra,ta,ya){const Ca=oa.renderData,
pa=Ca.vao,wa=pa?.indexBuffer;if(pa&&null!=wa){var Ba=ja.program;null==ya||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(Ba,Ca.overlay);ta&&(ja.useStencil=this._useStencilForTile(oa),Y.rctx.setPipelineState(ja.getPipeline()));ja=Ca.geometry.indexCount;Y.rctx.bindVAO(pa);Ba.assertCompatibleVertexAttributeLocations(pa);Y.rctx.drawElements(ra,ja,wa.indexType,0)}else G.enableTerrainInternalChecks&&console.error("Rendered tile with no indices: ",oa.lij," : ",Ca)}_bindOverlayPatchData(Y,ja){Y.setUniform4fv("overlayTexOffset",
ja.offsets);Y.setUniform4fv("overlayTexScale",ja.scales)}_updateTechnique(Y,ja){this._techniqueConfiguration.output=Y;this._techniqueConfiguration.renderOccluded=ja;return this._shaderTechnique=this._techniques.releaseAndAcquire(da.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)}get test(){return{tileRenderer:this._tileRenderer}}};b.__decorate([g.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);b.__decorate([g.property()],a.TerrainRenderer.prototype,"renderOccludedFlags",
void 0);b.__decorate([g.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);b.__decorate([g.property({value:!0})],a.TerrainRenderer.prototype,"visible",null);b.__decorate([g.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);b.__decorate([g.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);b.__decorate([g.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);b.__decorate([g.property({value:B.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,
"renderOrder",null);b.__decorate([g.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=b.__decorate([l.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);const Z=w.create(),ea=w.create(),ca=w.create(),W=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributesCache":function(){define(["exports","../../../core/MemCachePool","./TerrainAttributes"],function(a,b,h){class c{constructor(k){this._storage=
new b.MemCachePool((m,d)=>k.newCache(m,d),"TileGeometry")}acquire(k){k=4*Math.ceil(k/4);const m=this._storage,d=k.toString(),f=m.pop(d);if(f)return f;const g=h.terrainAttributesLayout.createBuffer(k);g.release=()=>m.put(d,g);return g}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}a.TerrainAttributesCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributes":function(){define(["exports","../support/buffer/InterleavedLayout","../webgl-engine/lib/VertexAttribute"],
function(a,b,h){b=b.newLayout().vec3f(h.VertexAttribute.POSITION).vec2i16(h.VertexAttribute.UV0).vec2i16(h.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});a.terrainAttributesLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../core/maybe ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./ITile ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(I,M,S){z.layerIndex=M;z.vtlNeighborInfos.clear();const N=I.layerInfo[e.LayerClass.MAP][M];h.set(z.offset,0,0);z.tile=I;z.scale=1;z.sourceLod=I.lij;z.sourceLayerInfo=N;z.isVTLBackground=S;if(N.data)return S&&I.forEachLoadedNeighbor((Q,T)=>{if(Q.level===I.level){var ia=Q.layerInfo[e.LayerClass.MAP][M];if(n.isVectorTilePerLayerInfo(ia)&&N.data!==ia.data){var O=z.vtlNeighborInfos.pushNew();O.offset=K[T];O.sourceLod=Q.lij;O.sourceLayerInfo=
ia}}}),z;const V=N.upsampleInfo;return V?(S=V.tile.layerInfo[e.LayerClass.MAP][M],z.tile=V.tile,h.copy(z.offset,V.offset),z.scale=V.scale,z.sourceLod=V.tile.lij,z.sourceLayerInfo=S,z):S?z:null}function B(I){let M="normal"!==I.blendMode;k.isGroupLayer(I.parent)&&(M=B(I.parent)||M);return M}function F(I,M){k.isGroupLayer(I.parent)&&F(I.parent,M);const S=I.uid;if(null!=S&&""!==S){const N=L.get(S);N?N.start=M:L.set(S,new G(M,M,I.blendMode,I.opacity,t.BlendLayersOutput.Composite,1))}}class G{constructor(I,
M,S,N,V,Q){this.start=I;this.end=M;this.blendMode=S;this.opacity=N;this.output=V;this.baseOpacity=Q}}class H{constructor(I,M,S,N){this._rctx=I;this.tileSize=M;this._techniques=S;this._cache=N;this._passParameters=new d.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new x.TileCompositor(this._rctx,this._techniques);this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=
b.disposeMaybe(this._composition);this._backgroundTexture=b.releaseMaybe(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateTileTexture(I,M){if(I.renderData){var S=I.surface,N=S.baseOpacity,V=0,Q=0,T=this.tileSize,ia=!1,O=!1,U=S.view.state.contentPixelRatio,P=!1;L.clear();C.length=0;for(var R=I.layerInfo[e.LayerClass.MAP],ba=0,X=null;ba<R.length;ba++){const aa=S.layerViewByIndex(ba,e.LayerClass.MAP);var da=aa.layer.opacity;
const Z=aa.fullOpacity;O=O||k.isBaseLayer(aa.layer);if(n.isBlendableLayerView(aa)){var ha="normal"!==aa.layer.blendMode;if(k.isGroupLayer(aa.layer.parent)){var fa=aa.layer.parent.uid;null!=fa&&""!==fa&&(ha=B(aa.layer.parent)||ha)}ha&&(P=ha,ia=!1)}if(0!==da||P){if(++Q,da=n.isVectorTileLayerView(aa),ha=A(I,ba,da))R[ba].pendingUpdates&=~(v.TileUpdate.TEXTURE_NOFADING&v.TileUpdate.TEXTURE_FADING),k.isGroupLayer(aa.layer.parent)&&(fa=aa.layer.parent.uid,null!=fa&&""!==fa&&F(aa.layer.parent,ba)),da?T=Math.max(T,
this.tileSize*U):1===N&&1===Z&&(aa.isOpaque||this._dataToTexture(ha)&&ha.sourceLayerInfo.data.descriptor.isOpaque)&&(ia=!0),++V,null===X&&(X=ba)}else R[ba].pendingUpdates&=~(v.TileUpdate.TEXTURE_NOFADING&v.TileUpdate.TEXTURE_FADING)}S=T/this.tileSize;N=this._ensureBackgroundTexture(this.tileSize);0===V||null===X?this._useBackgroundTexture(I,Q,N):(1!==V||P||!this._useLayerTexture(I,X))&&this._composeMapLayers(I,M,ba-1,O,T,S,!ia||P,L,P)}}_ensureBackgroundTexture(I){null==this._backgroundTexture&&(this._backgroundTexture=
this._buildTexture(I,!1),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bind(I),this._passParameters.offset=c.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,null!=this.backgroundColor),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1);return this._backgroundTexture}_useBackgroundTexture(I,
M,S){let N=l.ActivationTime.Immediate;if(I.surface.view.layerViewManager.updating||0<M)N=l.ActivationTime.Delayed;M=I.renderData;null==M.textureReference&&(N=l.ActivationTime.Immediate);M.setTextureReference(new u.TextureReference(S,f.TextureUpdate.FADING,J,I.surface.baseOpacity,0,1),N)}_useLayerTexture(I,M){var S=I.surface.layerViewByIndex(M,e.LayerClass.MAP),N=k.isBaseLayer(S.layer);const V=N?I.surface.baseOpacity:1;N=N?1:I.surface.baseOpacity;S=S.fullOpacity;M=A(I,M,!1);return this._dataToTexture(M)?
(I.renderData.setTextureReference(new u.TextureReference(M.sourceLayerInfo.data,f.TextureUpdate.FADING,M,V,N,S)),!0):!1}_composeMapLayers(I,M,S,N,V,Q,T,ia,O){this._composition.ensureBuffer(V);const U=I.surface.baseOpacity;let P=!1,R=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ba=!1,X=0;for(let aa=S;0<=aa;aa--){S=I.surface.layerViewByIndex(aa,e.LayerClass.MAP);var da=n.isVectorTileLayerView(S);da=A(I,aa,da);const Z=S.layer.opacity;if(!da||0===Z&&!O)continue;const ea=!k.isBaseLayer(S.layer)&&!P;ea&&
(P=!0);let ca=!1;ia.forEach(W=>{W.start===aa&&(W.output=N?t.BlendLayersOutput.Composite:T&&ea?this.backgroundIsGrid?t.BlendLayersOutput.GridComposite:t.BlendLayersOutput.ColorComposite:t.BlendLayersOutput.Composite,W.baseOpacity=ea?U:1,C.push(W),this._composition.openGroup(V),ca=!0)});this._passParameters.baseOpacity=ea&&!ca&&1>U?U:1;var ha=0===X;ha=ca?t.BlendLayersOutput.GroupBackgroundComposite:T&&ha?this.backgroundIsGrid?t.BlendLayersOutput.GridComposite:t.BlendLayersOutput.ColorComposite:t.BlendLayersOutput.Composite;
S=p.blendModeFromString[n.isBlendableLayerView(S)?S.layer.blendMode:"normal"];this._passParameters.opacity=Z;n.isVectorTileRenderInfo(da)?ba=this._composition.drawVectorData(this._passParameters,ha,V,S,da,Q,this.tileSize,ba):n.isImageryTileRenderInfo(da)?(this._composition.drawImageryTileData(this._passParameters,ha,V,S,da),this._hasNearestInterpolation(da)&&(R=y.TextureSamplingMode.NEAREST)):this._dataToTexture(da)&&(this._passParameters.texture=da.sourceLayerInfo.data.texture,this._passParameters.offset=
da.offset,this._passParameters.scale=da.scale,this._composition.drawRasterData(this._passParameters,ha,V,S));for(;0<C.length&&C[C.length-1].end===aa;)S=C.pop(),this._passParameters.baseOpacity=S.baseOpacity,this._passParameters.opacity=S.opacity,this._passParameters.offset=c.ZEROS,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,S.output,V,p.blendModeFromString[S.blendMode]);X++}I=I.renderData;const fa=O||P&&1>U;O=I.ensureTexture(V,fa,()=>this._buildTexture(V,fa,R));this._composition.copyFBOToTexture(O);
this._composition.unbind();I.setTextureReference(new u.TextureReference(O,M,J,P?1:U,0,1))}_hasNearestInterpolation(I){I=I.sourceLayerInfo.data;return I.source?"nearest"===I.interpolation:!1}_dataToTexture(I){if(n.isRasterTileRenderInfo(I)){const M=I.sourceLayerInfo;M.data=this._buildTexture(M.data,!0);I.tile.setMemoryDirty()}return n.isTextureTileRenderInfo(I)}setBackground(I){this._backgroundColor!==I&&(this._backgroundColor=I,this._backgroundDirty=!0)}_buildTexture(I,M,S=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==
I)return null;const N=new E.TextureDescriptor;N.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;N.samplingMode=S;N.maxAnisotropy=this._maxAnisotropy;N.preMultiplyAlpha=!0;N.flipped=!0;N.hasMipmap=!0;M||(N.pixelFormat=y.PixelFormat.RGB);M=this._rctx;let V;if("number"===typeof I)N.width=N.height=I,(V=this._cache.pop(`${I} ${N.pixelFormat}`))?V.retain():V=new q(new D.Texture(M,N),this._cache);else if(m.isImageWithType(I))N.isOpaque=I.isOpaque,N.isOpaque&&(N.pixelFormat=y.PixelFormat.RGB),(V=this._cache.pop(`${I} ${N.pixelFormat}`))?
(V.retain(),V.texture.setData(I.image)):V=new q(new D.Texture(M,N,I.image),this._cache),I.release();else try{N.width=I.width,N.height=I.height,V=new q(new D.Texture(M,N,I))}catch(Q){V=new q(r.createEmptyTexture(M)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}I=M.bindTexture(V.texture,D.Texture.TEXTURE_UNIT_FOR_UPDATES);V.generateMipmap();M.bindTexture(I,D.Texture.TEXTURE_UNIT_FOR_UPDATES);return V}get test(){return{backgroundTexture:this._backgroundTexture}}}
const L=new Map,C=[],z=new w.TileRenderInfo,J={offset:[0,0],scale:1},K=[];K[g.NeighborIndex.NORTH]=[0,-1];K[g.NeighborIndex.NORTH_EAST]=[-1,-1];K[g.NeighborIndex.EAST]=[-1,0];K[g.NeighborIndex.SOUTH_EAST]=[-1,1];K[g.NeighborIndex.SOUTH]=[0,1];K[g.NeighborIndex.SOUTH_WEST]=[1,1];K[g.NeighborIndex.WEST]=[1,0];K[g.NeighborIndex.NORTH_WEST]=[1,-1];a.GroupInfo=G;a.TileRenderer=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../../core/libs/gl-matrix-2/factories/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends m.TileCompositePassParameters{constructor(){super(...arguments);this.baseOpacity=this.opacity=1;this.fboTexture=this.texture=null;this.backgroundColor=c.ZEROS}}class q extends g.ShaderTechnique{initializeProgram(p){return new l.Program(p.rctx,q.shader.get().build(this.configuration),n.Default3D)}initializePipeline(){return x.makePipelineState({blending:x.simpleBlendingParams(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:x.defaultColorWriteParams})}}
q.shader=new f.ReloadableShaderModule(d.BlendLayers,()=>new Promise((p,t)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],p,t)));class v extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.background=d.BackgroundMode.BelowLayer}}h.__decorate([e.parameter()],v.prototype,"background",void 0);b.BlendLayersPassParameters=w;b.BlendLayersTechnique=q;b.BlendLayersTechniqueConfiguration=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","./BlendModeTechniqueConfiguration","../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h,c,k){class m extends h.BlendModeTechniqueConfiguration{constructor(){super(...arguments);this.output=c.BlendLayersOutput.Composite;this.baseOpacityMode=c.BaseOpacityMode.NotRequired;this.premultipliedSource=c.PremultipliedAlphaSource.Off}}b.__decorate([k.parameter({count:c.BlendLayersOutput.COUNT})],
m.prototype,"output",void 0);b.__decorate([k.parameter({count:c.BaseOpacityMode.COUNT})],m.prototype,"baseOpacityMode",void 0);b.__decorate([k.parameter()],m.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,h,c){class k extends c.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blendMode=h.LayerBlendMode.Normal}}b.__decorate([c.parameter({count:h.LayerBlendMode.COUNT})],k.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(l){const u=new f.ShaderBuilder;u.include(c.TileComposite);if(l.background===a.BackgroundMode.Only)return(l=l.output===h.BlendLayersOutput.ColorComposite)?u.fragment.uniforms.add(new k.Float3PassUniform("backgroundColor",x=>x.backgroundColor)):u.fragment.include(b.BackgroundGrid),u.fragment.code.add(d.glsl`
    void main() {
      fragColor = vec4(${l?d.glsl`backgroundColor`:d.glsl`gridColor(uv)`}, 1.0);
    }
  `),u;u.include(h.TileBackground,l);u.fragment.uniforms.add(new g.Texture2DPassUniform("tex",x=>x.texture));u.fragment.uniforms.add(new m.FloatPassUniform("opacity",x=>x.opacity));u.fragment.code.add(d.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return u}a.BackgroundMode=void 0;(function(l){l[l.BelowLayer=0]="BelowLayer";l[l.Only=1]="Only";l[l.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const n=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:e},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=n;a.build=e})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../core/libs/gl-matrix-2/factories/vec4f64"],
function(a,b,h){class c{constructor(k,m,d,f,g,e){this.texture=k;this.type=m;k.retain();this.offsetAndScale=h.fromValues(d.offset[0],d.offset[1],d.scale,d.scale);this.opacities=b.fromValues(f,g,e)}destroy(){this.texture.release()}}a.TextureReference=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){class r{constructor(y,D){this._rctx=y;this._techniqueRepository=D;this._fbos=[];this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._bindParameters=new x.BindParameters(null,null);this._blendLayersTechniqueConfig=new d.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=q.createQuadVAO(this._rctx,w.Pos2Tex)}dispose(){this._fbos.forEach(h.disposeMaybe);this._fbos=
null;this._vtFBO=h.disposeMaybe(this._vtFBO);this._vaoQuad=h.disposeMaybe(this._vaoQuad);this._vectorTileHelper=h.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=h.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=h.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=h.releaseMaybe(this._blendLayersTechnique)}_getBlendLayersTechnique(y,D,E,A=l.PremultipliedAlphaSource.Off,B=u.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=D;this._blendLayersTechniqueConfig.blendMode=
y;this._blendLayersTechniqueConfig.baseOpacityMode=E;this._blendLayersTechniqueConfig.premultipliedSource=A;this._blendLayersTechniqueConfig.background=B;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(d.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)}drawBackground(y,D){D=this._getBlendLayersTechnique(n.LayerBlendMode.Normal,D?l.BlendLayersOutput.ColorComposite:l.BlendLayersOutput.GridComposite,l.BaseOpacityMode.NotRequired,l.PremultipliedAlphaSource.Off,
u.BackgroundMode.Only);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}_render(y){this._rctx.bindVAO(this._vaoQuad);y.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,t.vertexCount(this._vaoQuad,"geometry"))}drawGroup(y,D,E,A,B=l.PremultipliedAlphaSource.On){D===l.BlendLayersOutput.Composite&&(y.fboTexture=this._fbos[this.getLastOnHoldId()].get(E).colorTexture);y.texture=this.currentFBO(E).colorTexture;this.closeGroup(E);
D=this._getBlendLayersTechnique(A,D,1>y.baseOpacity?l.BaseOpacityMode.Required:l.BaseOpacityMode.NotRequired,B);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}drawRasterData(y,D,E,A,B=l.PremultipliedAlphaSource.Off){if(null!=y.texture){var F=1>y.baseOpacity?l.BaseOpacityMode.Required:l.BaseOpacityMode.NotRequired;y.fboTexture=D===l.BlendLayersOutput.GroupBackgroundComposite||A===n.LayerBlendMode.Normal&&F===l.BaseOpacityMode.NotRequired&&B===l.PremultipliedAlphaSource.Off?null:
this.switch(E).colorTexture;D=this._getBlendLayersTechnique(A,D,F,B);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}}drawImageryTileData(y,D,E,A,B){var F=B.sourceLayerInfo.data;if(F.source&&(B.tile.surface.layerViewByIndex(B.layerIndex,f.LayerClass.MAP).ensureSymbolizerParameters(F),F.bind(this._rctx))){var G=1>y.baseOpacity?l.BaseOpacityMode.Required:l.BaseOpacityMode.NotRequired;y.fboTexture=A===n.LayerBlendMode.Normal&&G===l.BaseOpacityMode.NotRequired?null:this.switch(E).colorTexture;
D=this._getRasterColorizerTechnique(F,D,A,G);F.opacity=y.opacity;F=F.getUniforms();F.scale=B.scale;F.offset=B.offset;F.backgroundColor=y.backgroundColor;F.fboTexture=y.fboTexture;F.baseOpacity=y.baseOpacity;y=this._rctx.bindTechnique(D,null,F);this._render(y)}}_getRasterColorizerTechnique(y,D,E,A){const B=y.symbolizerParameters,F=["stretch","lut","hillshade"].indexOf(B.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new g.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=D;this._rasterColorizerConfig.blendMode=E;this._rasterColorizerConfig.baseOpacityMode=A;this._rasterColorizerConfig.colorizerType=F;this._rasterColorizerConfig.applyColormap=!!B.colormap;this._rasterColorizerConfig.requireBilinearWithNN=y.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=y.hasStretchTypeNone()?k.RasterColorizerStretchType.Noop:k.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=
this._techniqueRepository.releaseAndAcquire(g.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)}drawVectorData(y,D,E,A,B,F,G,H){const L=this._rctx,C=B.sourceLayerInfo.data,z=B.tile.surface.layerViewByIndex(B.layerIndex,f.LayerClass.MAP);var J=1>y.baseOpacity?l.BaseOpacityMode.Required:l.BaseOpacityMode.NotRequired;const K=J===l.BaseOpacityMode.Required||1>y.opacity||A!==n.LayerBlendMode.Normal||D!==l.BlendLayersOutput.Composite,I=K?l.PremultipliedAlphaSource.On:
l.PremultipliedAlphaSource.Off;J=this._getBlendLayersTechnique(A,D,J,I);L.setPipelineState(J.getPipeline());let M=J=null;K?(M=this.currentFBO(E),null==this._vtFBO&&(this._vtFBO=new e.MultiSizeFramebuffer(this._rctx)),J=this._vtFBO.get(E),L.bindFramebuffer(J),this._clearCurrentFBO()):H&&L.clearSafe(v.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(L,B.sourceLod,z.painter,z.layer.styleRepository,z.schemaHelper,Math.round(1/B.scale),B.offset,G,F,z.contentZoom),C&&this._vectorTileHelper.renderContent(L,
B.sourceLod,C,B.vtlNeighborInfos,z.painter,z.layer.styleRepository,z.schemaHelper,Math.round(1/B.scale),B.offset,G,F,z.contentZoom)}catch(S){b.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",S)}return null!=J?(L.bindFramebuffer(M),y.texture=J.colorTexture,y.offset=c.ZEROS,y.scale=1,this.drawRasterData(y,D,E,A,I),H):!0}copyFBOToTexture(y){const D=this._rctx,E=D.bindTexture(y.texture,p.Texture.TEXTURE_UNIT_FOR_UPDATES),A=y.descriptor;D.gl.copyTexImage2D(v.TextureType.TEXTURE_2D,
0,A.pixelFormat,0,0,A.width,A.height,0);y.generateMipmap();D.bindTexture(E,p.Texture.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.setClearStencil(0);this._rctx.clearSafe(v.ClearBufferBit.COLOR_BUFFER_BIT|v.ClearBufferBit.DEPTH_BUFFER_BIT|v.ClearBufferBit.STENCIL_BUFFER_BIT)}_initFBO(y,D,E){this._rctx.bindFramebuffer(y);E&&(this._rctx.setViewport(0,0,D,D),this._clearCurrentFBO())}ensureBuffer(y){this._lastUsedIds.length=
0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(y)}bind(y,D=0,E=!0){this._current=D;if(D>=this._fbos.length)for(let A=this._fbos.length;A<=D;A++)this._fbos.push(new e.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[D].get(y),y,E)}_bindNextFreeBuffer(y){0<this._lastUsedIds.length?this.bind(y,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(y,this._lastCreatedBufferId))}openGroup(y){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(y)}switch(y){const D=
this.currentFBO(y),E=this._current;this._bindNextFreeBuffer(y);this._lastUsedIds.push(E);return D}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(y){const D=this._current;this._bindNextFreeBuffer(y);this._lastUsedIds.push(D);this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(y){return this._fbos[this._current].get(y)}}a.TileCompositor=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../geometry ../../../../Viewpoint ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../ViewState ./style/StyleDefinition ../webgl/RenderableTile ../webgl/TileReshuffleManager ../../../webgl/enums ../../../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x{constructor(){this._renderParams={reshuffleManager:new n.TileReshuffleManager,context:null,drawPhase:1,state:new f({viewpoint:new h({targetGeometry:new u(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,
timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=new e.RenderableTile(new k(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(w,q,v,p,t,r,y,D,E,A){const B=this._backgroundTile;this._updateRenderParameters(w,q,B,v,t,r,y,D,E,A);this._renderParams.stencilSymbols=!1;v.drawBackground(this._renderParams,B,p)}renderContent(w,
q,v,p,t,r,y,D,E,A,B,F){this._stencilSymbols(w,q,v,p,t,r,y,Math.round(1/D),E,A,B,F);let G=1;v.stencilRef=G++;w.setStencilFunction(l.CompareFunction.EQUAL,v.stencilRef,255);this._render(w,q,v,t,r,y,D,E,A,B,F);p.forAll(H=>{H.sourceLayerInfo.data.stencilRef=G++;this._renderSymbols(w,H.sourceLod,H.sourceLayerInfo.data,t,r,y,Math.round(1/D),H.offset,A,B,F)})}_stencilSymbols(w,q,v,p,t,r,y,D,E,A,B,F){let G=1;v.stencilRef=G++;w.setDepthTestEnabled(!1);w.setDepthWriteEnabled(!1);w.setStencilTestEnabled(!0);
w.setBlendingEnabled(!1);w.setColorMask(!1,!1,!1,!1);w.setStencilOp(l.StencilOperation.KEEP,l.StencilOperation.KEEP,l.StencilOperation.REPLACE);w.setStencilWriteMask(255);w.setStencilFunction(l.CompareFunction.ALWAYS,v.stencilRef,255);this._stencilTileSymbols(w,q,v,t,r,y,D,E,A,B,F);for(const H of p.toArray()){const {sourceLod:L,offset:C,sourceLayerInfo:z}=H;z.data.stencilRef=G++;w.setStencilFunction(l.CompareFunction.ALWAYS,z.data.stencilRef,255);this._stencilTileSymbols(w,L,z.data,t,r,y,D,C,A,B,
F)}w.setStencilWriteMask(0);w.setBlendingEnabled(!0);w.setDepthTestEnabled(!0);w.setColorMask(!0,!0,!0,!0)}_renderSymbols(w,q,v,p,t,r,y,D,E,A,B){w.setStencilFunction(l.CompareFunction.EQUAL,v.stencilRef,255);this._render(w,q,v,p,t,r,y,D,E,A,B,g.StyleLayerType.SYMBOL)}_render(w,q,v,p,t,r,y,D,E,A,B,F){this._updateRenderParameters(w,q,v,p,r,y,D,E,A,B);this._renderParams.stencilSymbols=!1;p.drawTile(this._renderParams,v,t,F)}_stencilTileSymbols(w,q,v,p,t,r,y,D,E,A,B){this._updateRenderParameters(w,q,
v,p,r,y,D,E,A,B);this._renderParams.stencilSymbols=!0;v.triangleCount=0;p.drawSymbols(this._renderParams,v,t)}_updateRenderParameters(w,q,v,p,t,r,y,D,E,A){"type"in v&&"vector-tile"===v.type&&!v.stage&&v.attachWithContext(w);const B=q[0]-t.getLevelShift(q[0]),F=this._renderParams;F.context=w;F.painter=p;F.glyphMosaic=p.glyphMosaic;F.spriteMosaic=p.spriteMosaic;F.pixelRatio=E*A;F.displayLevel=B;F.requiredLevel=B;w=t.getScale(q[0]);const [G,H]=t.getOffset(q,r*w);q=.125*r*w/D;v=v.transforms.displayViewScreenMat3;
v[0]=q;v[4]=-q;v[6]=-1-G-y[0]*r*2;v[7]=1+H+(1-y[1])*r*2-2;F.state.size[0]=D/A;F.state.size[1]=D/A;F.state.pixelRatio=A}}a.VectorTileRendererHelper3D=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/ViewState":function(){define("../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/math/common ../../core/libs/gl-matrix-2/math/mat2d ../../core/libs/gl-matrix-2/factories/mat2df32 ../../core/libs/gl-matrix-2/factories/mat2df64 ../../core/libs/gl-matrix-2/math/mat3 ../../core/libs/gl-matrix-2/factories/mat3f32 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f32 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ../../geometry/support/normalizeUtils ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){var A;const B=[0,0];b=A=class extends c.JSONSupport{constructor(F){super(F);this._viewpoint2D={center:p.create(),rotation:0,scale:0,spatialReference:void 0};this.center=[0,0];this.extent=new D;this.id=0;this.inverseTransform=u.create();this.scale=this.rotation=this.resolution=0;this.transform=u.create();this.transformNoRotation=u.create();this.displayMat3=w.create();this.displayViewMat3=w.create();this.viewMat3=w.create();this.viewMat2d=l.create();
this.worldScreenWidth=0;this.size=[0,0]}set pixelRatio(F){this._set("pixelRatio",F);this._update()}set size(F){this._set("size",F);this._update()}set viewpoint(F){if(F){const G=this._viewpoint2D,H=F.targetGeometry;G.center[0]=H.x;G.center[1]=H.y;G.rotation=F.rotation;G.scale=F.scale;G.spatialReference=H.spatialReference}this._update()}copy(F){const G=this.size,H=this.viewpoint;H&&G?(this.viewpoint=y.copy(H,F.viewpoint),this._set("size",q.copy(G,F.size))):(this.viewpoint=F.viewpoint.clone(),this._set("size",
[F.size[0],F.size[1]]));this._set("pixelRatio",F.pixelRatio);return this}clone(){return new A({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(F,G,H){if(t.isVec2(G))return q.transformMat2d(F,G,this.inverseTransform);B[0]=G;B[1]=H;return q.transformMat2d(F,B,this.inverseTransform)}toScreen(F,G,H){if(t.isVec2(G))return q.transformMat2d(F,G,this.transform);B[0]=G;B[1]=H;return q.transformMat2d(F,B,this.transform)}toScreenNoRotation(F,G,H){if(t.isVec2(G))return q.transformMat2d(F,
G,this.transformNoRotation);B[0]=G;B[1]=H;return q.transformMat2d(F,B,this.transformNoRotation)}toScreenClosest(F,G,H){t.isVec2(G)?(B[0]=G[0],B[1]=G[1]):(B[0]=G,B[1]=H);[G]=B;const {center:L,extent:C,spatialReference:z,transform:J}=this;if(G<C.xmin||G>C.xmax)B[0]=r.getClosestDenormalizedXToReference(G,L[0],z);return q.transformMat2d(F,B,J)}getScreenTransform(F,G){const {center:H}=this._viewpoint2D,L=this._get("pixelRatio")||1,C=this._get("size");y.getMatrix(F,H,C,G,0,L);return F}_update(){const {center:F,
spatialReference:G,scale:H,rotation:L}=this._viewpoint2D,C=this._get("pixelRatio")||1,z=this._get("size"),J=new h({targetGeometry:new E(F[0],F[1],G),scale:H,rotation:L});this._set("viewpoint",J);if(z&&G&&H){this.resolution=y.getResolution(J);this.rotation=L;this.scale=H;this.spatialReference=G;q.copy(this.center,F);x.set(this.displayMat3,0!==z[0]?2/z[0]:0,0,0,0,0!==z[1]?-2/z[1]:0,0,-1,1,1);var K=x.identity(this.viewMat3),I=v.fromValues(z[0]/2,z[1]/2),M=v.fromValues(-z[0]/2,-z[1]/2),S=e.toRadian(L);
x.translate(K,K,I);x.rotate(K,K,S);x.translate(K,K,M);x.multiply(this.displayViewMat3,this.displayMat3,K);K=n.fromTranslation(this.viewMat2d,I);n.rotate(K,K,S);n.translate(K,K,M);y.getExtent(this.extent,J,z);y.getTransform(this.transform,J,z,C);n.invert(this.inverseTransform,this.transform);y.getTransformNoRotation(this.transformNoRotation,J,z,C);this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",this.id+1);return this}}};a.__decorate([k.property({readOnly:!0})],
b.prototype,"id",void 0);a.__decorate([k.property({value:1,json:{write:!0}})],b.prototype,"pixelRatio",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"size",null);a.__decorate([k.property()],b.prototype,"spatialReference",void 0);a.__decorate([k.property({type:h,json:{write:!0}})],b.prototype,"viewpoint",null);return b=A=a.__decorate([g.subclass("esri.views.2d.ViewState")],b)})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["exports"],function(a){function b(){return[1,
0,0,1,0,0]}function h(f){return[f[0],f[1],f[2],f[3],f[4],f[5]]}function c(f,g,e,n,l,u){return[f,g,e,n,l,u]}function k(f,g){return new Float64Array(f,g,6)}const m=b(),d=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:h,create:b,createView:k,fromValues:c},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=h;a.create=b;a.createView=k;a.fromValues=c;a.mat2df64=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],
function(a){function b(c){return c instanceof Float32Array&&2<=c.length}function h(c){return Array.isArray(c)&&2<=c.length}a.isVec2=function(c){return b(c)||h(c)};a.isVec2f32=b;a.isVec2f64=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/unitUtils ../../core/libs/gl-matrix-2/math/common ../../core/libs/gl-matrix-2/math/mat2d ../../core/libs/gl-matrix-2/factories/mat2df64 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/normalizeUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(R,ba){return ba.type?f.set(R,ba.x,ba.y):f.copy(R,ba)}function p(R,ba){return Math.max(R.width/Math.max(1,ba[0]),R.height/Math.max(1,ba[1]))*F(R.spatialReference)}async function t(R,ba,X,da){if(!R||Array.isArray(R)&&!R.length)return null;h.isCollection(R)&&(R=R.toArray());if(Array.isArray(R)&&R.length&&"object"===typeof R[0]){var ha=R.every(W=>"attributes"in W);var fa=R.some(W=>!W.geometry),aa=R;if(ha&&fa&&ba&&ba.allLayerViews){ha=new Map;for(var Z of R)R=
Z.layer,fa=ha.get(R)||[],aa=Z.attributes[R.objectIdField],null!=aa&&fa.push(aa),ha.set(R,fa);const W=[];ha.forEach((Y,ja)=>{const oa=ba.allLayerViews.find(ra=>ra.layer.id===ja.id);if(oa&&"queryFeatures"in oa){const ra=ja.createQuery();ra.objectIds=Y;ra.returnGeometry=!0;W.push(oa.queryFeatures(ra))}});Z=await Promise.all(W);R=[];for(var ea of Z)if(ea&&ea.features&&ea.features.length)for(var ca of ea.features)null!=ca.geometry&&R.push(ca.geometry);aa=R}for(const W of aa)da=await t(W,ba,X,da);return da}if(Array.isArray(R)&&
2===R.length&&"number"===typeof R[0]&&"number"===typeof R[1])ha=new l(R);else if(R instanceof n)ha=R;else if("geometry"in R)if(R.geometry)ha=R.geometry;else if(R.layer){const W=R.layer;(ea=ba.allLayerViews.find(Y=>Y.layer.id===W.id))&&"queryFeatures"in ea&&(ca=W.createQuery(),ca.objectIds=[R.attributes[W.objectIdField]],ca.returnGeometry=!0,ha=(await ea.queryFeatures(ca))?.features?.[0]?.geometry)}if(null==ha)return null;switch(ha.type){case "point":ea=new e({xmin:ha.x,ymin:ha.y,xmax:ha.x,ymax:ha.y,
spatialReference:ha.spatialReference});break;case "extent":case "multipoint":case "polygon":case "polyline":ea=w.getDenormalizedExtent(ha);break;default:ea=ha.extent}if(!ea)return null;u.isLoaded()||u.canProjectWithoutEngine(ea.spatialReference,X)||await u.load();X=u.project(ea,X);return X?da=da?da.union(X):X:null}function r(R){if(R&&(!Array.isArray(R)||"number"!==typeof R[0])&&("object"===typeof R||Array.isArray(R)&&"object"===typeof R[0])){if("layer"in R&&null!=R.layer?.minScale&&null!=R.layer.maxScale){var ba=
R.layer;return{min:ba.minScale,max:ba.maxScale}}if(Array.isArray(R)&&R.length&&R.every(X=>"layer"in X)){let X=ba=0;for(const da of R)R=da.layer,R?.minScale&&R.maxScale&&(ba=R.minScale<ba?R.minScale:ba,X=R.maxScale>X?R.maxScale:X);return ba&&X?{min:ba,max:X}:null}}}function y(R,ba){return q.equals(R.wkid?R:R.spatialReference||x.WGS84,ba)?R:u.project(R,ba)}function D(R,ba){const X=R.targetGeometry,da=ba.targetGeometry;X.x=da.x;X.y=da.y;X.spatialReference=da.spatialReference;R.scale=ba.scale;R.rotation=
ba.rotation;return R}function E(R,ba,X){return X?f.set(R,.5*(ba[0]-X.right+X.left),.5*(ba[1]-X.bottom+X.top)):f.scale(R,ba,.5)}function A(R){return R.scale*B(R.targetGeometry?.spatialReference)}function B(R){return null!=R&&q.isValid(R)?1/(39.37*c.getMetersPerUnitForSR(R)*96):1}function F(R){return q.isValid(R)?39.37*c.getMetersPerUnitForSR(R)*96:1}function G(R){return(R=q.getInfo(R))?R.valid[1]-R.valid[0]:0}const H=180/Math.PI,L=function(){const R=g.create();return function(ba,X,da){const ha=X.targetGeometry;
v(R,ha);X=.5*A(X);ba.xmin=R[0]-X*da[0];ba.ymin=R[1]-X*da[1];ba.xmax=R[0]+X*da[0];ba.ymax=R[1]+X*da[1];ba.spatialReference=ha.spatialReference;return ba}}(),C=function(){const R=g.create();return function(ba,X,da){return f.sub(ba,f.scale(ba,X,.5),E(R,X,da))}}(),z=function(){const R=d.create(),ba=g.create();return function(X,da,ha,fa){const aa=A(da);da=k.toRadian(da.rotation)||0;f.set(ba,aa,aa);m.fromScaling(R,ba);m.rotate(R,R,da);m.translate(R,R,C(ba,ha,fa));m.translate(R,R,[0,fa.top-fa.bottom]);return f.set(X,
R[4],R[5])}}(),J=function(){const R=g.create(),ba=g.create(),X=g.create();return function(da,ha,fa,aa,Z,ea){f.negate(R,ha);f.scale(ba,fa,.5*ea);f.set(X,1/aa*ea,-1/aa*ea);m.fromTranslation(da,ba);Z&&m.rotate(da,da,Z);m.scale(da,da,X);m.translate(da,da,R);return da}}(),K=function(){const R=g.create();return function(ba,X,da,ha){const fa=A(X),aa=k.toRadian(X.rotation)||0;v(R,X.targetGeometry);return J(ba,R,da,fa,aa,ha)}}(),I=function(){const R=g.create();return function(ba,X,da,ha){const fa=A(X);v(R,
X.targetGeometry);return J(ba,R,da,fa,0,ha)}}(),M=function(){const R=g.create(),ba=g.create(),X=[0,0,0];return function(da,ha,fa){f.subtract(R,da,ha);f.normalize(R,R);f.subtract(ba,da,fa);f.normalize(ba,ba);f.cross(X,R,ba);da=Math.acos(f.dot(R,ba)/(f.length(R)*f.length(ba)))*H;0>X[2]&&(da=-da);isNaN(da)&&(da=0);return da}}(),S=function(){const R=g.create();return function(ba,X,da,ha){const fa=ba.targetGeometry;D(ba,X);z(R,X,da,ha);fa.x+=R[0];fa.y+=R[1];return ba}}(),N=function(){return function(R,
ba,X){D(R,ba);ba=R.targetGeometry;ba.x=X.x;ba.y=X.y;ba.spatialReference=X.spatialReference;return R}}(),V=function(){const R=g.create();return function(ba,X,da,ha,fa){fa||="center";f.sub(R,da,ha);f.scale(R,R,.5);da=R[0];ha=R[1];switch(fa){case "center":f.set(R,0,0);break;case "left":f.set(R,-da,0);break;case "top":f.set(R,0,ha);break;case "right":f.set(R,da,0);break;case "bottom":f.set(R,0,-ha);break;case "top-left":f.set(R,-da,ha);break;case "bottom-left":f.set(R,-da,-ha);break;case "top-right":f.set(R,
da,ha);break;case "bottom-right":f.set(R,da,-ha)}P(ba,X,R);return ba}}(),Q=function(){const R=g.create();return function(ba,X,da,ha,fa){D(ba,X);isNaN(da)||0===da||(O(R,ha,X,fa),ba.scale=X.scale*da,U(R,R,ba,fa),P(ba,ba,f.set(R,R[0]-ha[0],ha[1]-R[1])));return ba}}(),T=function(){const R=g.create();return function(ba,X,da,ha,fa,aa){D(ba,X);isNaN(da)||0===da||(O(R,fa,X,aa),ba.scale=X.scale*da,ba.rotation+=ha,U(R,R,ba,aa),P(ba,ba,f.set(R,R[0]-fa[0],fa[1]-R[1])));return ba}}(),ia=function(){const R=g.create(),
ba=g.create();return function(X,da,ha,fa,aa,Z,ea){C(ba,Z,ea);f.add(R,aa,ba);return fa?T(X,da,ha,fa,R,Z):Q(X,da,ha,R,Z)}}(),O=function(){const R=d.create();return function(ba,X,da,ha){var fa=f.transformMat2d;K(R,da,ha,1);da=m.invert(R,R);return fa.call(f,ba,X,da)}}(),U=function(){const R=d.create();return function(ba,X,da,ha){return f.transformMat2d(ba,X,K(R,da,ha,1))}}(),P=function(){const R=g.create(),ba=d.create();return function(X,da,ha){D(X,da);const fa=A(da),aa=X.targetGeometry;m.fromRotation(ba,
k.toRadian(da.rotation)||0);m.scale(ba,ba,g.fromValues(fa,fa));f.transformMat2d(R,ha,ba);aa.x+=R[0];aa.y+=R[1];return X}}();a.addPadding=S;a.angleBetween=M;a.centerAt=N;a.copy=D;a.create=async function(R,ba){if(!R||!ba)return new b({targetGeometry:new l,scale:0,rotation:0});let X=ba.spatialReference;const {constraints:da,padding:ha,viewpoint:fa,size:aa}=ba,Z=[ha?aa[0]-ha.left-ha.right:aa[0],ha?aa[1]-ha.top-ha.bottom:aa[1]];let ea=null;R instanceof b?ea=R:R.viewpoint?ea=R.viewpoint:R.target&&"esri.Viewpoint"===
R.target.declaredClass&&(ea=R.target);let ca=null;if(ea?.targetGeometry)ca=ea.targetGeometry;else if(R instanceof e)ca=R;else if(R||R&&("center"in R||"extent"in R||"target"in R))ca=await t(R.center,ba,X)||await t(R.extent,ba,X)||await t(R.target,ba,X)||await t(R,ba,X);!ca&&fa?.targetGeometry?ca=fa.targetGeometry:!ca&&ba.extent&&(ca=ba.extent);if(!X){var W=ba.spatialReference||ba.extent||ca;X=W.wkid?W:W.spatialReference||x.WGS84}u.isLoaded()||q.equals(ca.spatialReference,X)||u.canProjectWithoutEngine(ca.spatialReference,
X)||await u.load();W=y("center"in ca?ca.center:ca,X);!1!==ba.pickClosestTarget&&"point"===W.type&&"point"===fa.targetGeometry?.type&&(W.x=w.getClosestDenormalizedXToReference(W.x,fa.targetGeometry.x,W.spatialReference));var Y=0;null!=ea?.targetGeometry&&"point"===ea.targetGeometry.type?Y=ea.scale:"scale"in R&&R.scale?Y=R.scale:"zoom"in R&&-1!==R.zoom&&da&&da.effectiveLODs?Y=da.zoomToScale(R.zoom):Array.isArray(ca)||"point"===ca.type||"extent"===ca.type&&0===ca.width&&0===ca.height?(Y=y(ba.extent,
X),Y=null!=Y?p(Y,Z):ba.extent?p(ba.extent,Z):fa.scale):Y=p(y(ca.extent,X),Z);if(ba=r(R.target??R))ba.min&&ba.min<Y?Y=ba.min:ba.max&&ba.max>Y&&(Y=ba.max);ba=0;ea?ba=ea.rotation:R.hasOwnProperty("rotation")?ba=R.rotation:fa&&(ba=fa.rotation);R=new b({targetGeometry:W,scale:Y,rotation:ba});da&&(R=da.fit(R),da.constrainByGeometry(R),da.rotationEnabled||(R.rotation=fa.rotation));return R};a.extentToScale=p;a.getAnchor=E;a.getExtent=L;a.getMatrix=J;a.getPaddingMapTranslation=z;a.getPaddingScreenTranslation=
C;a.getResolution=A;a.getResolutionToScaleFactor=F;a.getScaleToResolutionFactor=B;a.getTransform=K;a.getTransformNoRotation=I;a.getWorldScreenWidth=function(R,ba){return Math.round(G(R)/ba)};a.getWorldWidth=G;a.padAndScaleAndRotateBy=ia;a.resize=V;a.rotateBy=function(R,ba,X){D(R,ba);R.rotation+=X;return R};a.rotateTo=function(R,ba,X){D(R,ba);R.rotation=X;return R};a.scaleAndRotateBy=T;a.scaleTo=function(R,ba,X){D(R,ba);R.scale=X;return R};a.setExtent=function(R,ba,X,da,ha){N(R,ba,X.center);R.scale=
p(X,da);ha?.constraints?.constrain(R);return R};a.toMap=O;a.toScreen=U;a.translateBy=P;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(a,b){a.StyleLayerType=void 0;(function(c){c[c.BACKGROUND=0]="BACKGROUND";c[c.FILL=1]="FILL";c[c.LINE=2]="LINE";c[c.SYMBOL=3]="SYMBOL";c[c.CIRCLE=4]="CIRCLE"})(a.StyleLayerType||(a.StyleLayerType={}));a.Visibility=void 0;
(function(c){c[c.VISIBLE=0]="VISIBLE";c[c.NONE=1]="NONE"})(a.Visibility||(a.Visibility={}));a.SymbolPlacement=void 0;(function(c){c[c.POINT=0]="POINT";c[c.LINE=1]="LINE";c[c.LINE_CENTER=2]="LINE_CENTER"})(a.SymbolPlacement||(a.SymbolPlacement={}));a.RotationAlignment=void 0;(function(c){c[c.MAP=0]="MAP";c[c.VIEWPORT=1]="VIEWPORT";c[c.AUTO=2]="AUTO"})(a.RotationAlignment||(a.RotationAlignment={}));a.TextJustification=void 0;(function(c){c[c.AUTO=0]="AUTO";c[c.LEFT=1]="LEFT";c[c.CENTER=2]="CENTER";
c[c.RIGHT=3]="RIGHT"})(a.TextJustification||(a.TextJustification={}));a.SymbolAnchor=void 0;(function(c){c[c.CENTER=0]="CENTER";c[c.LEFT=1]="LEFT";c[c.RIGHT=2]="RIGHT";c[c.TOP=3]="TOP";c[c.BOTTOM=4]="BOTTOM";c[c.TOP_LEFT=5]="TOP_LEFT";c[c.TOP_RIGHT=6]="TOP_RIGHT";c[c.BOTTOM_LEFT=7]="BOTTOM_LEFT";c[c.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(a.SymbolAnchor||(a.SymbolAnchor={}));a.TextTransform=void 0;(function(c){c[c.NONE=0]="NONE";c[c.UPPERCASE=1]="UPPERCASE";c[c.LOWERCASE=2]="LOWERCASE"})(a.TextTransform||
(a.TextTransform={}));a.TranslateAnchor=void 0;(function(c){c[c.MAP=0]="MAP";c[c.VIEWPORT=1]="VIEWPORT"})(a.TranslateAnchor||(a.TranslateAnchor={}));a.TextWritingMode=void 0;(function(c){c[c.HORIZONTAL=0]="HORIZONTAL";c[c.VERTICAL=1]="VERTICAL"})(a.TextWritingMode||(a.TextWritingMode={}));class h{}h.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};h.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};
h.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:b.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:b.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};h.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",
default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:a.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",
default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:a.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},
"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:a.TextTransform.NONE},
"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[a.TextWritingMode.HORIZONTAL]}};h.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};h.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};h.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",
default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};h.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},
"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};h.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",
minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},
"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};h.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",
minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};h.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,
0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};a.StyleDefinition=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32",
"./TiledDisplayObject"],function(a,b,h){class c extends h.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:b.create(),tileMat3:b.create()}}}a.RenderableTile=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(a){class b{constructor(){this._candidateTiles=[]}schedule(h){this._candidateTiles.includes(h)||this._candidateTiles.push(h)}reshuffle(h){const c=[];for(const k of this._candidateTiles)0<
h?(k.reshuffle(),h--):c.push(k);this._candidateTiles=c}}a.TileReshuffleManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x extends f.ShaderTechnique{initializeProgram(q){return new n.Program(q.rctx,x.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return u.makePipelineState({blending:u.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:u.defaultColorWriteParams})}}x.shader=new d.ReloadableShaderModule(m.RasterColorizer,()=>new Promise((q,v)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],q,v)));
class w extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.colorizerType=c.RasterColorizerType.Stretch;this.stretchType=c.RasterColorizerStretchType.Noop;this.applyColormap=!0;this.requireBilinearWithNN=!1}}h.__decorate([g.parameter({count:c.RasterColorizerType.COUNT})],w.prototype,"colorizerType",void 0);h.__decorate([g.parameter({count:c.RasterColorizerStretchType.COUNT})],w.prototype,"stretchType",void 0);h.__decorate([g.parameter()],w.prototype,"applyColormap",void 0);
h.__decorate([g.parameter()],w.prototype,"requireBilinearWithNN",void 0);b.RasterColorizerTechnique=x;b.RasterColorizerTechniqueConfiguration=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(a,b,h,c,k){class m{constructor(d){this._rctx=d;this._fbos=new Map}get(d){return this._getPool(d)}dispose(){this._fbos.forEach(d=>
d.dispose());this._fbos.clear()}_getPool(d){var f=this._fbos.get(d);if(f)return f;f=new h.FramebufferObject(this._rctx,new k.TextureDescriptor(d),new c.RenderbufferDescriptor(b.RenderbufferFormat.DEPTH24_STENCIL8,d));this._fbos.set(d,f);return f}}a.MultiSizeFramebuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../core/PooledArray"],function(a,b){class h{constructor(){this.sourceLod=[0,0,0];this.offset=
[0,0];this.scale=1;this.layerIndex=0;this.isVTLBackground=!1;this.vtlNeighborInfos=new b({allocator:k=>k||new c})}}class c{constructor(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]}}a.TileRenderInfo=h;a.VTLNeighhborInfo=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/factories/vec3f64",
"../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],function(a,b,h,c,k){function m(v,p,t){let r=0,y=Infinity;for(let E=0;3>E;++E){var D=v[E];if(p[E]<D){if(1E-6>=t[E])return!1;r=Math.max(r,(D-p[E])/t[E])}else-1E-6>=t[E]&&(y=Math.min(y,(D-p[E])/t[E]));if(r>y)return!1;D=v[E+3];if(p[E]>D){if(-1E-6<=t[E])return!1;r=Math.max(r,(D-p[E])/t[E])}else 1E-6<=t[E]&&(y=Math.min(y,(D-p[E])/t[E]));if(r>y)return!1}return!0}function d(v,p,t,r,y,D){let E=r;for(;t<E;){var A=v[t];
p[6*A+y+3]<=D?++t:(--E,v[t]=v[E],v[E]=A)}A=t;for(E=r;A<E;)r=v[E-1],p[6*r+y]>=D?--E:(v[E-1]=v[A],v[A]=r,++A);return{next:t,mid:A}}function f(v,p,t,r){if(r<=t)return c.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*v[t];for(var D=0;3>D;++D)w[D]=p[y+0+D],q[D]=p[y+3+D];for(t+=1;t<r;++t)for(y=6*v[t],D=0;3>D;++D)w[D]=Math.min(w[D],p[y+0+D]),q[D]=Math.max(q[D],p[y+3+D]);return c.fromValues(w[0],w[1],w[2],q[0],q[1],q[2])}function g(v){var p=v[3]-v[0];const t=v[4]-v[1],r=v[5]-v[2];p=p>t?p>r?0:t>r?1:2:t>r?1:r>
p?2:0;return{axis:p,midValue:(v[p]+v[p+3])/2}}function e(v,p,t,r,y){t-=p;const D=new Float32Array(6*t);for(let A=0;A<t;++A){var E=3*(A+p);const B=v[E]*y,F=v[E+1]*y;E=v[E+2]*y;for(let G=0;3>G;++G){const H=r[B+G],L=r[F+G],C=r[E+G];D[6*A+G]=Math.min(H,L,C);D[6*A+3+G]=Math.max(H,L,C)}}return D}function n(v,p,t,r){const y=r-t;var D=0;for(var E=t;E<r;++E)for(var A=0;3>A;++A)D=Math.max(p[3*E+A],D);r=65535>=D?new Uint16Array(3*y):new Uint32Array(3*y);for(D=0;D<y;++D)for(E=3*(v[D]+t),A=0;3>A;++A)r[3*D+A]=
p[E+A];return r}class l{constructor(v,p,t,r,y){this.aabb=v;this.axis=p;this.d=t;this.midStartIndex=r;this.rightStartIndex=y}}class u{constructor(v,p,t,r){this.globalTriangleVertexIndices=v;this.firstTriangleIndex=p;this.positions=r;this._rayDirection=h.create();this.bspNodeTree=[];const y=t-p,D=65535>=y?new Uint16Array(y):new Uint32Array(y);this.indices=D;for(let F=0;F<y;++F)D[F]=F;const E=e(v,p,t,r.data,r.stride),A=b.clamp(Math.log2(y/40),2,10),B=(F,G,H)=>{var L=f(D,E,F,G);const C=G-F;if(40>=C)return F=
new l(L,void 0,0,F,G),this.bspNodeTree.push(F),F;const {axis:z,midValue:J}=g(L),K=d(D,E,F,G,z,J),I=(M,S)=>{if(!(H>A)){var N=S-M;if(!(40>N||N>=.8*C))return B(M,S,H+1)}};L=new l(L,z,J,K.next,K.mid);this.bspNodeTree.push(L);L.leftNode=I(F,K.next);L.rightNode=I(K.mid,G);return L};B(0,y,0);this.triangleVertexIndices=n(D,v,p,t)}intersectRayTriangleRange(v,p){if(!(v>=p)){var t=this.triangleVertexIndices,r=this.positions.data,y=this.positions.stride,D=this._rayOrigin,E=D[0],A=D[1];D=D[2];var B=this._rayDirection,
F=B[0],G=B[1];B=B[2];for(let Q=v,T=3*v;Q<p;++Q){var H=t[T]*y,L=r[H],C=r[H+1],z=r[H+2],J=t[T+1]*y;H=r[J];var K=r[J+1];J=r[J+2];var I=t[T+2]*y,M=r[I],S=r[I+1];I=r[I+2];T+=3;H-=L;K-=C;J-=z;M-=L;S-=C;I-=z;var N=G*I-S*B,V=B*M-I*F;const ia=F*S-M*G,O=H*N+K*V+J*ia;if(!(Math.abs(O)<=Number.EPSILON)){L=E-L;C=A-C;z=D-z;N=L*N+C*V+z*ia;if(0<O){if(0>N||N>O)continue}else if(0<N||N<O)continue;V=C*J-K*z;z=z*H-J*L;C=L*K-H*C;L=F*V+G*z+B*C;if(0<O){if(0>L||N+L>O)continue}else if(0<L||N+L<O)continue;C=(M*V+S*z+I*C)/O;
0<=C&&(z=this.indices[Q]+this.firstTriangleIndex,H=k.computeNormal(H,K,J,M,S,I,x),this._callback(C,H,z,!1))}}u.numFacesTested+=p-v}}intersectRay(v,p,t){u.numFacesTested=0;v=h.fromValues(v[0],v[1],v[2]);var r=h.fromValues(p[0],p[1],p[2]);p=r[0]-v[0];const y=r[1]-v[1];r=r[2]-v[2];1E-6>p*p+y*y+r*r||(this._rayOrigin=v,v=this._rayDirection,v[0]=p,v[1]=y,v[2]=r,v=this.triangleVertexIndices.length/3,this._callback=t,this.intersectRayBSP(this.bspNodeTree[0],0,v))}intersectRayBSP(v,p,t){const r=this._rayOrigin,
y=this._rayDirection;if(m(v.aabb,r,y)){var D=v.axis,E=v.d;if(r[D]<E||0>y[D]){const A=v.midStartIndex;if(p<A){const B=v.leftNode;void 0!==B?this.intersectRayBSP(B,p,A):this.intersectRayTriangleRange(p,A)}}this.intersectRayTriangleRange(v.midStartIndex,v.rightStartIndex);if(r[D]>E||0<y[D])p=v.rightStartIndex,p<t&&(v=v.rightNode,void 0!==v?this.intersectRayBSP(v,p,t):this.intersectRayTriangleRange(p,t))}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}
u.numFacesTested=0;const x=h.create(),w=[Infinity,Infinity,Infinity],q=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=u;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends e.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.overlayMode=d.OverlayMode.Disabled;this.tileBlendInput=f.TileBlendInput.LayerOnly;this.receiveAmbientOcclusion=this.screenSizePerspective=this.visualizeNormals=this.tileBorders=this.invisible=this.hasCloudsReflections=this.hasScreenSpaceReflections=this.renderOccluded=this.textureFadingEnabled=this.backfaceCullingEnabled=this.hasSlicePlane=this.receiveShadows=
this.doublePrecisionRequiresObfuscation=this.spherical=!1;this.pbrMode=m.PBRMode.Simplified}}b.__decorate([g.parameter({count:h.ShaderOutput.COUNT})],n.prototype,"output",void 0);b.__decorate([g.parameter({count:d.OverlayMode.COUNT})],n.prototype,"overlayMode",void 0);b.__decorate([g.parameter({count:f.TileBlendInput.COUNT})],n.prototype,"tileBlendInput",void 0);b.__decorate([g.parameter()],n.prototype,"spherical",void 0);b.__decorate([g.parameter()],n.prototype,"doublePrecisionRequiresObfuscation",
void 0);b.__decorate([g.parameter()],n.prototype,"receiveShadows",void 0);b.__decorate([g.parameter()],n.prototype,"hasSlicePlane",void 0);b.__decorate([g.parameter()],n.prototype,"backfaceCullingEnabled",void 0);b.__decorate([g.parameter()],n.prototype,"textureFadingEnabled",void 0);b.__decorate([g.parameter()],n.prototype,"renderOccluded",void 0);b.__decorate([g.parameter()],n.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([g.parameter()],n.prototype,"hasCloudsReflections",void 0);b.__decorate([g.parameter()],
n.prototype,"invisible",void 0);b.__decorate([g.parameter()],n.prototype,"tileBorders",void 0);b.__decorate([g.parameter()],n.prototype,"visualizeNormals",void 0);b.__decorate([g.parameter()],n.prototype,"screenSizePerspective",void 0);b.__decorate([g.parameter()],n.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([g.parameter({count:m.PBRMode.COUNT})],n.prototype,"pbrMode",void 0);b.__decorate([g.parameter({constValue:c.NormalType.Compressed})],n.prototype,"normalType",void 0);b.__decorate([g.parameter({constValue:k.TextureCoordinateAttributeType.Compressed})],
n.prototype,"textureCoordinateType",void 0);b.__decorate([g.parameter({constValue:!1})],n.prototype,"highStepCount",void 0);b.__decorate([g.parameter({constValue:!1})],n.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([g.parameter({constValue:!1})],n.prototype,"useFillLights",void 0);b.__decorate([g.parameter({constValue:!0})],n.prototype,"hasColorTexture",void 0);a.TerrainTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){class a{constructor(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}}return a})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){a.TilingSchemeLogic=class extends h{constructor(v){super(v)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),c.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]);this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null;this.layers.destroy()}_update(){this._waitTask=null;if(!this.tilingSchemeLocked){var v;this.layers.some(t=>!u.isTiledLayer(t)||t.isRejected()?!1:
t.isFulfilled()&&null==w.getTiledLayerInfo(t,this.viewSpatialReference,this.viewingMode)?!1:(v=t,"vector-tile"!==t?.type&&!w.isProjectableRasterLayer(t)));if(v)if(v.isResolved()){var p=w.getTiledLayerInfo(v,this.viewSpatialReference,this.viewingMode);null!=p&&(p=new q.TilingScheme(p.tileInfo),this._lockTilingScheme(p))}else this._updateWhen(v)}}_updateWhen(v){const p=v.when().catch(()=>{}).then(()=>{p!==this._waitTask||this.destroyed||this._update()});this._waitTask=p}_lockTilingScheme(v){if(this.viewingMode===
x.ViewingMode.Global){const p=v.levels.length-1;v.spatialReference.isWebMercator?v=q.TilingScheme.makeWebMercatorAuxiliarySphere(p):e.canProjectToWGS84ComparableLonLat(v.spatialReference)&&(v=q.TilingScheme.makeGCSWithTileSize(v.spatialReference,v.pixelSize,p))}this.tilingSchemeLocked=!0;this.tilingScheme=v;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this.removeAllHandles();this.addHandles(c.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",
this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===x.ViewingMode.Global){var v=this.extentHelper.viewSpatialReference;const p=e.canProjectToWGS84ComparableLonLat(v)||l.isMars(v)||l.isMoon(v);v.isWebMercator?this.tilingScheme=q.TilingScheme.WebMercatorAuxiliarySphere:p&&(this.tilingScheme=q.TilingScheme.makeGCSWithTileSize(v,256));this._set("extent",this.extentHelper.layerViewsExtent)}else v=this.extentHelper.layerViewsExtent,null==v||n.equals(v,this.extent)||(this.tilingScheme=
q.TilingScheme.fromExtent(v,this.extentHelper.viewSpatialReference),this._set("extent",v))}get test(){return{lockTilingScheme:v=>this._lockTilingScheme(v),done:!this._waitTask}}};b.__decorate([k.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);b.__decorate([k.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([k.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,
"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([g.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports",
"../../../core/libs/gl-matrix-2/factories/vec2f64"],function(a,b){class h{constructor(){this.offset=b.create();this.scale=0;this.tile=null}init(c,k,m,d){this.tile=c;this.offset[0]=k;this.offset[1]=m;this.scale=d}dispose(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0}}a.UpsampleInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.Stage=class extends h{constructor(t){super(t);this._model=new w.Model;this._layers=new c;this._asyncChangeSet=new l.ChangeSet;this._syncChangeSet=new l.ChangeSet;this._layerSyncSet=new Set}initialize(){this._set("renderView",new q.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(v.TaskPriority.STAGE,this);this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||
this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(t){this._model.add(t);x.isWebGLLayer(t)&&this._addLayer(t);this.renderView.requestRender()}remove(t){null!=t&&!this.destroyed&&this._model.remove(t)&&(x.isWebGLLayer(t)&&this._removeLayer(t),this.renderView.requestRender())}addMany(t){null!=t&&(this._model.addMany(t),this.renderView.requestRender())}removeMany(t){null!=t&&(this._model?.removeMany(t),this.renderView?.requestRender())}forEachOfType(t,
r){this._model.forEachOfType(t,r)}handleEvent(t,r){this.destroyed||(this._model.dirtySet[t](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(t){this._frameTask.processQueue(t);this._commit(t);if(!t.hasProgressed)return p.Yield}_commit(t){const r=this._model.dirtySet;this._asyncChangeSet.empty||t.done||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(y=>{if(!t.done){var D=
this._layerSyncSet.has(y.id)||y.updatePolicy===u.UpdatePolicy.SYNC,E=D?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(y.id,E);this._layerSyncSet.delete(y.id);E.empty||(this.renderer.modify(E,D?v.noBudget:t),this.renderView.requestRender(),t.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,v.noBudget),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(y=>{t.done||this._layerSyncSet.has(y.id)||y.updatePolicy!==u.UpdatePolicy.ASYNC||(r.commitLayer(y.id,
this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")}commitSyncLayers(){const t=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===u.UpdatePolicy.SYNC?(t.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):t.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)t.commitLayer(r,
this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,v.noBudget),this.renderView.requestRender())}_commitLayer(t){this._model.dirtySet.commitLayer(t.id,this._syncChangeSet);this._layerSyncSet.delete(t.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,v.noBudget),this.renderView.requestRender())}schedule(t,r){return this._frameTask.schedule(t,r)}reschedule(t,r){return this._frameTask.reschedule(t,r)}syncLayer(t){this._layerSyncSet.add(t);
this.renderView.requestRender()}getObject(t){return this._model.getObject(t)}get layers(){return this._layers}_addLayer(t){this._layers.includes(t)||this._layers.push(t)}_removeLayer(t){this._commitLayer(t);null!=this._layers.removeUnordered(t)&&(this._model.dirtySet.getResidentRenderGeometries(t.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,v.noBudget))}addRenderPlugin(t,r){r=this.renderer.plugins.add(t,r);const y=()=>{n.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};
if(k.isPromiseLike(r))return r.then(y);y()}removeRenderPlugin(t){this.destroyed||(n.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(t),this.renderer.plugins.remove(t))}get performanceInfo(){return this._model.getStats()}get test(){const t=this;return{getCount(r){return t._model.test.content.filter(y=>y.type===r).length},model:t._model}}};a.Stage.DebugSettings={endFrameContentValidation:!1};b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"view",
void 0);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([m.property()],a.Stage.prototype,"renderView",void 0);b.__decorate([m.property({readOnly:!0})],
a.Stage.prototype,"renderer",null);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=b.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/sphere ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){a.Model=class extends h{constructor(){super(...arguments);this.dirtySet=new u({model:this});this._content=new Map;this._originFactory=new l.GridLocalOriginFactory(null)}getObject(p){return this._content.get(p)}add(p){const t=p.id;w.assert(!this._content.has(t),"Model/Stage already contains object to be added");this._content.set(t,p);q.isWebGLLayer(p)&&this.dirtySet.layerAdded(p)}remove(p){if(!this._content.has(p.id))return!1;this._content.delete(p.id);q.isWebGLLayer(p)&&
this.dirtySet.layerRemoved(p);return!0}addMany(p){for(const t of p)t&&(w.assert(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(p){for(const t of p)t&&(w.assert(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(p){return this._content.has(p.id)}forEachOfType(p,t){this._content.forEach(r=>{r.type===p&&t(r)})}getRenderGeometry(p,t){const r=new x.RenderGeometry(t,{castShadow:p.castShadow,
objectShaderTransformation:p.shaderTransformation});r.transformation=p.getCombinedStaticTransformation(t,v);({localOrigin:p}=t);r.localOrigin=null!=p?p:this._originFactory.getOrigin(e.getCenter(r.boundingSphere));return r}updateRenderGeometryTransformation(p,t,r){if(null==p)return!1;r.transformation=p.getCombinedStaticTransformation(t,v);p=this._originFactory.getOrigin(e.getCenter(r.boundingSphere));return r.localOrigin!==p}getStats(){const p={},t=Array.from(this._content.values());for(let r=0;r<
n.ContentObjectType.COUNT;++r)p[r]=t.filter(y=>y.type===r).length;return{contentTypes:p,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};b.__decorate([c.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);const v=g.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l{constructor(u,x,w,q){this.operation=u;this.geometry=x;this.states=w;this.sync=q}}b=class extends b{constructor(u){super(u);this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this.dirty=!1}commitLayer(u,x){const w=this._dirtyGeomRecords.get(u);w&&(w.forEach((q,v)=>{const p=this._ensureGeomRecord(u,v);q.forEach(({geometry:t,operation:r,states:y},D)=>{let E=!1;if(r===e.DirtyOperation.UPDATE){const A=p.get(D);if(A){if(y&e.DirtyState.TRANSFORMATION){const B=
this.model.getObject(v);this.model.updateRenderGeometryTransformation(B,t,A)&&(E=!0)}E||x.updates.push({renderGeometry:A,updateType:y})}else n.assert(!1,"ModelDirtySet.commitLayer: invalid update")}if(r===e.DirtyOperation.REMOVE||E)(y=p.get(D))?(x.removes.push(y),p.delete(D)):r===e.DirtyOperation.REMOVE&&n.assert(!1,"ModelDirtySet.commitLayer: invalid remove");if(r===e.DirtyOperation.ADD||E)r=this.model.getObject(v),null!=r&&(t=this.model.getRenderGeometry(r,t),x.adds.push(t),p.set(D,t))});0===p.size&&
this._residentGeomRecords.get(u).delete(v)}),0===this._residentGeomRecords.get(u).size&&this._residentGeomRecords.delete(u),this._dirtyGeomRecords.delete(u),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(u,x){const w=this._dirtyGeomRecords.get(u);w&&w.forEach((q,v)=>{const p=this._ensureGeomRecord(u,v);q.forEach(({geometry:t,operation:r,states:y,sync:D},E)=>{let A=!1;r===e.DirtyOperation.UPDATE&&D&&((r=p.get(E))?(y&e.DirtyState.TRANSFORMATION&&(D=this.model.getObject(v),this.model.updateRenderGeometryTransformation(D,
t,r)&&(A=!0)),A||x.updates.push({renderGeometry:r,updateType:y})):n.assert(!1,"ModelDirtySet.commitSyncUpdates: invalid update"))})})}getResidentRenderGeometries(u,x){(u=this._residentGeomRecords.get(u))&&u.forEach(w=>w.forEach(q=>x.push(q)))}_objectStateChanged(u,x){for(const w of x.geometries)this._updateOrCreateDirtyRecord(x,w,null,e.DirtyOperation.UPDATE,u)}visibilityChanged(u){this._objectStateChanged(e.DirtyState.VISIBILITY,u)}highlightChanged(u){this._objectStateChanged(e.DirtyState.HIGHLIGHT,
u)}occlusionChanged(u){this._objectStateChanged(e.DirtyState.OCCLUDEE,u)}attributesChanged({object:u,geometry:x,sync:w}){this._updateOrCreateDirtyRecord(u,x,null,e.DirtyOperation.UPDATE,e.DirtyState.GEOMETRY,w)}layerAdded(u){u.objects.forAll(x=>this._layerObjectAdded(u,x))}layerRemoved(u){u.objects.forAll(x=>this._layerObjectRemoved(u,x))}layerObjectAdded(u){this._layerObjectAdded(u.layer,u.object)}_layerObjectAdded(u,x){u=u.id;for(const w of x.geometries)this._geometryAdded(x,w,u)}layerObjectRemoved(u){this._layerObjectRemoved(u.layer,
u.object)}layerObjectsAdded(u){for(const x of u.objects)this._layerObjectAdded(u.layer,x)}layerObjectsRemoved(u){for(const x of u.objects)this._layerObjectRemoved(u.layer,x)}_layerObjectRemoved(u,x){u=u.id;for(const w of x.geometries)this._geometryRemoved(x,w,u)}transformationChanged(u){const x=this._getParentLayerId(u);this._ensureGeomRecord(x,u.id).forEach(w=>{this._updateOrCreateDirtyRecord(u,w.geometry,x,e.DirtyOperation.UPDATE,e.DirtyState.TRANSFORMATION)})}shaderTransformationChanged(u){const x=
this._getParentLayerId(u);this._ensureGeomRecord(x,u.id).forEach(w=>{w.objectShaderTransformationChanged(u.shaderTransformation)})}geometryAdded(u){this._geometryAdded(u.object,u.geometry)}_geometryAdded(u,x,w=null){this._updateOrCreateDirtyRecord(u,x,w,e.DirtyOperation.ADD)}geometryRemoved(u){this._geometryRemoved(u.object,u.geometry)}_geometryRemoved(u,x,w=null){this._updateOrCreateDirtyRecord(u,x,w,e.DirtyOperation.REMOVE)}_updateOrCreateDirtyRecord(u,x,w,q,v=e.DirtyState.NONE,p=!1){w=w??this._getParentLayerId(u);
const t=x.id;u=this._ensureDirtyRecord(w,u.id);(w=u.get(t))?(x=w.operation,x===e.DirtyOperation.REMOVE&&q===e.DirtyOperation.ADD&&w.states!==e.DirtyState.NONE?w.operation=e.DirtyOperation.UPDATE:x===e.DirtyOperation.REMOVE&&q===e.DirtyOperation.ADD||x===e.DirtyOperation.ADD&&q===e.DirtyOperation.REMOVE?u.delete(t):(x!==e.DirtyOperation.UPDATE||q!==e.DirtyOperation.REMOVE&&q!==e.DirtyOperation.UPDATE?n.assert((x===e.DirtyOperation.REMOVE||x===e.DirtyOperation.ADD)&&q===e.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
w.operation=q,w.states|=v),w.sync=w.sync||p):u.set(t,new l(q,x,v,p));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(u,x){let w=this._residentGeomRecords.get(u);w||(w=new Map,this._residentGeomRecords.set(u,w));u=w.get(x);u||(u=new Map,w.set(x,u));return u}get _hasDirtyGeometryRecords(){return h.someMap(this._dirtyGeomRecords,u=>h.someMap(u,x=>x&&0<x.size))}_ensureDirtyRecord(u,x){let w=this._dirtyGeomRecords.get(u);w||(w=new Map,this._dirtyGeomRecords.set(u,w));u=w.get(x);u||(u=new Map,
w.set(x,u));return u}_getParentLayerId(u){return u.parentLayer?u.parentLayer.id:c.nullUid}formatDebugInfo(){const u=["ADD","UPD",void 0,"REM"];let x="";this._dirtyGeomRecords.forEach((w,q)=>{w.forEach((v,p)=>{0<x.length&&(x+="\n");x+=q+"."+p;const t=[];v.forEach(r=>{const y=r.operation;t[y]||(t[y]=[]);t[y].push(r.geometry.id)});for(v=0;v<t.length;v++)if(t[v])for(x+=" "+u[v-1]+": ",p=0;p<t[v].length;p++)x+=t[v][p]+", "})});return x}get test(){const u=this;return{get residentLayerCount(){return u._residentGeomRecords.size},
get residentObjectCount(){return Array.from(u._residentGeomRecords.values()).reduce((x,w)=>x+w.size,0)},commit:x=>u._dirtyGeomRecords.forEach((w,q)=>u.commitLayer(q,x))}}};a.__decorate([k.property({constructOnly:!0})],b.prototype,"model",void 0);a.__decorate([k.property()],b.prototype,"dirty",void 0);return b=a.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/contextUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I){a.RenderView=class extends h{constructor(S){super({});this.events=new c;this.waterTextures=new H.WaterTextureRepository;this._magnifierHelper=new r.MagnifierHelper;this.objectAndLayerIdRenderHelper=k("enable-feature:objectAndLayerId-rendering")?new D.ObjectAndLayerIdRenderHelper:null;this._idleSuspend=this._needsRender=this._needsUpdate=!0;this._needsWaterReflectionUpdate=!1;this._lastAnimationUpdate=0;this._container=S.container;
this._viewingMode=S.viewingMode;this._initializeContext(S);this.addHandles([f.watch(()=>this.waterTextures?.updating,()=>this.requestRender(),f.initial),f.watch(()=>S.view.qualityProfile,V=>this.renderer?.updateRenderFeatures(V),f.syncAndInitial),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const {memoryController:N}=S.view.resourceController;this.stippleTextures=G.createStippleTextureRepository(this._rctx,N);this.markerTextures=F.createMarkerTextureRepository(this._rctx,
N);this._shaderTechniques=new w.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:S.viewingMode,stippleTextureRepository:this.stippleTextures,waterTextureRepository:this.waterTextures,markerTextureRepository:this.markerTextures});this._textures=new B.TextureRepository(S,this._shaderTechniques,this._rctx);this.addHandles(this._textures.events.on("changed",V=>this.requestRender(V)));this._materialRepository=new t.GLMaterialRepository(this._textures,this._shaderTechniques,()=>this.requestRender(),
()=>this.requestRender());this._compositingHelper=new v(this._rctx,this._shaderTechniques);this.renderer=new E.Renderer(S,this._materialRepository,this._textures,this._shaderTechniques,this._rctx,this._compositingHelper,this._magnifierHelper,V=>this.requestRender(V));this._screenshotManager=new z.ScreenshotManager(this._rctx,{renderScene:(V,Q,T,ia)=>this.renderer.render(V,Q,T,ia),requestRenderScene:V=>this.requestRender(V),prepareOverlay:()=>S.options.screenshot.prepareOverlay(),renderOverlay:(V,
Q,T)=>S.options.screenshot.renderOverlay(V,Q,T)},V=>this.events.emit("force-camera-for-screenshot",V));this._registerFrameTask(S)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=d.removeMaybe(this._frameTask);this._shaderTechniques=d.destroyMaybe(this._shaderTechniques);this._componentObjects=d.destroyMaybe(this._componentObjects);this._screenshotManager=d.destroyMaybe(this._screenshotManager);this.renderer.destroy();
this._textures=d.destroyMaybe(this._textures);this._magnifierHelper.destroy();this.waterTextures.destroy();this.markerTextures.destroy();this.stippleTextures.destroy();this._container=this._canvas=null;this._rctx=d.destroyMaybe(this._rctx)}requestRender(S=q.RenderRequestType.UPDATE){this._needsRender=!0;S===q.RenderRequestType.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating||
this._magnifierHelper.updating}get textureRepository(){return this._textures}get compositingHelper(){return this._compositingHelper}set magnifier(S){this._magnifierHelper.magnifier=S}setIdleSuspend(S){this._idleSuspend!==S&&(this._idleSuspend=S,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(S){return this._screenshotManager.takeScreenshot(S).then(N=>N[0])}takeScreenshotWithOID(S){S.objectAndLayerIdColor=
!0;return this._screenshotManager.takeScreenshot(S)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(S,N,V,Q,T,ia=T){ia=Q.constrainWindowSize(N,V,T*Q.pixelRatio,ia*Q.pixelRatio);const O=this._ensureDepthBuffer(ia);this.renderer.readDepthPixels(Q,ia,O);T=Number.MAX_VALUE;for(let U=0;U<ia[2]*ia[3];U++){const P=p.textureToDepth(4*U,O,Q.nearFar);T>P&&P!==Q.nearFar[0]&&P!==Q.nearFar[1]&&(T=P)}S&&(S=S.pickDepth(N*Q.pixelRatio,V*Q.pixelRatio,Q),null!=S&&T>S&&S!==Q.nearFar[0]&&
S!==Q.nearFar[1]&&(T=S));return T===Number.MAX_VALUE?void 0:T}_ensureDepthBuffer(S){S=4*S[2]*S[3];if(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<S)this._tmpDepthBuffer=new Uint8Array(S);return this._tmpDepthBuffer}async reloadShaders(){C.removeLoadedShaderModules();await this._shaderTechniques.reloadAll();this.requestRender()}_registerFrameTask(S){const N=S.view.state;let V=!1,Q=q.RenderRequestType.BACKGROUND,T=!1;this._frameTask=g.addFrameTask({preRender:({time:ia})=>{V=this.updating;
Q=this._needsUpdate?q.RenderRequestType.UPDATE:q.RenderRequestType.BACKGROUND;S.commitSyncLayers();var O=e.Milliseconds(ia-this._lastAnimationUpdate);if(O>this.renderer.animationTimestep||null!=N.forcedAnimationTime||V||this._needsRender)O=e.Milliseconds(O/this.renderer.animationTimeDilation),O=new y.UpdateParameters(N.camera,O,N.forcedAnimationTime),this.renderer.updateAnimation(O)&&this.requestRender(q.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=ia},render:({time:ia})=>{if((this._needsRender||
!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<N.camera.fullWidth&&0<N.camera.fullHeight){const O=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(N,ia);T=!0;O&&this.renderer.hasReflections&&(this.requestRender(q.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:ia})=>{const O=new z.ScreenshotContext(N,this.renderer.hasSlicePlane||
this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,this.renderer.fboCache);this._textures.update();this._screenshotManager.update(O,ia)},finish:()=>{T&&(this.renderer.finish(N.mode===K.RenderState.IDLE?Q:q.RenderRequestType.UPDATE),T=!1)}})}_initializeContext(S){const N=S.options;this._canvas=N.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const V=I.createContext(this._canvas,
{alpha:N.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:N.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:N.preserveDrawingBuffer??!1});null==V?m.getLogger(this).error("A WebGL2 context could not be created."):(this._rctx=this._newRenderingContext(V,S),this._loadShaderOnlyExtensions(),!N.alpha&&this._rctx.contextAttributes.alpha&&m.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&
11<=k("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))}_newRenderingContext(S,N){const V={disabledExtensions:N.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:N.options.debugWebGLExtensions||{},maxAnisotropy:8},Q=(T,ia)=>N.view.resourceController.memoryController.newCache(T,ia);if(J.contextCache.enabled){let T=M.get(S);if(T)return T.configure(V),T.newCache=Q,T.ref(),T;T=new A.RenderingContext(S,V,Q);M.set(S,T);T.ref();return T}return new A.RenderingContext(S,
V,Q)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(S){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(S):null}get componentObjectCollection(){null==this._componentObjects&&(this._componentObjects=new x.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjects}set componentObjectCollection(S){this._componentObjects=S}};b.__decorate([n.property({type:Boolean,
readOnly:!0})],a.RenderView.prototype,"updating",null);b.__decorate([n.property()],a.RenderView.prototype,"_rctx",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_container",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_canvas",void 0);b.__decorate([n.property()],a.RenderView.prototype,"stippleTextures",void 0);b.__decorate([n.property()],a.RenderView.prototype,"markerTextures",void 0);b.__decorate([n.property()],a.RenderView.prototype,"waterTextures",void 0);b.__decorate([n.property()],
a.RenderView.prototype,"_magnifierHelper",void 0);b.__decorate([n.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_textures",void 0);b.__decorate([n.property({readOnly:!0})],a.RenderView.prototype,"renderer",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_screenshotManager",void 0);b.__decorate([n.property()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([n.property()],a.RenderView.prototype,
"_componentObjects",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_needsUpdate",void 0);b.__decorate([n.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=b.__decorate([u.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const M=L.getContextCache();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../core/has ../../../../../core/Logger ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Indices ../../../../../chunks/vec3 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N){function V(U,P){return U===P?B.ComponentParameterSummary.All:0===U?B.ComponentParameterSummary.None:B.ComponentParameterSummary.Some}const Q=()=>h.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class T{constructor(U,P){this._renderManager=U;this._viewingMode=P;this._elevationRangeCacheMax=this._elevationRangeCacheMin=this._elevationRangeCacheVerticalOffset=NaN;this._visible=
new c;this._hidden=new c;this._renderSubmit=new D.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._hasObjectAndLayerId=b("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new I.BufferManager(U.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){L.assert(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();this._visible.forAll(U=>U.destroy());this._hidden.forAll(U=>
U.destroy());this._visible.clear();this._hidden.clear()}createObject(U){var P=U.geometry;const R=new v(this._componentBufferManager,g.compactIndices(P.componentOffsets)),ba=this._createRenderable(U,R);P=new t(this._viewingMode,P.positionData,R);U=new p.ComponentObject(U.transform,U.toMapSpace,U.obb.clone(),R,ba,P);(U.visible?this._visible:this._hidden).push(U);return U}destroyObject(U){(U.visible?this._visible:this._hidden).removeUnordered(U);U.destroy();this._notifyDirty()}setObjectVisibility(U,
P){P!==U.visible&&(P?(this._hidden.removeUnordered(U),this._visible.push(U)):(this._visible.removeUnordered(U),this._hidden.push(U)),U.visible=P,this._notifyDirty())}preSubmit(U){const P=U.camera.eye;this.visibleObjects.forAll(R=>R.renderable.meta.cameraDepthSquared=m.squaredDistance(P,R.obb.center))}getMaterial(U){return U.renderable.material}updateMaterial(U,P){U=U.renderable.material;P(U);U.dirty&&this._notifyDirty()}setAllComponentVisibilities(U,P){U.components.visibility.reset(P);U.components.visibilityDirty();
this._notifyDirty()}forEachVisibleComponent(U,P){return U.components.visibility.forEachComponent(P)}getComponentCount(U){const P=U.components.visibility.componentCount;return{visible:P,invisible:U.components.count-P}}setComponentData(U,P){const R=U.renderable.material,ba=U.components;var X=ba.materialDataBuffer;const da=ba.materialDataIndices,ha=new A.UniformComponentParameters;X=X.textureBuffer;const fa=new Uint8Array(4),aa=new Uint32Array(fa.buffer);let Z=0,ea=0,ca=0,W=ba.verticalOffsets,Y=Infinity,
ja=-Infinity,oa=!1,ra=!1,ta=0;for(let ya=0;ya<ba.count;ya++){P(ya,ha);Z+=+(1>ha.externalColor[3]);ea+=+(ha.externalColorMixMode===u.ColorMixModeEnum.Replace&&1===ha.externalColor[3]);ca+=+ha.castShadows;u.encodeSymbolColor(ha.externalColor,ha.externalColorMixMode,fa);fa[2]=fa[2]&254|+ha.castShadows;X.setData(da[ya],0,fa[0],fa[1],fa[2],fa[3]);oa||=0<ya&&ta!==aa[0];ta=aa[0];ra||=0!==ha.elevationOffset;ra&&null==W&&(W=Array(ya).fill(0));null!=W&&(W[ya]=ha.elevationOffset);Y=Math.min(Y,ha.elevationOffset);
ja=Math.max(ja,ha.elevationOffset);G.encodeElevationOffset(ha.elevationOffset,fa);X.setData(da[ya],1,fa[0],fa[1],fa[2],fa[3]);const Ca=ha.objectAndLayerIdColor;null!=Ca&&X.setData(da[ya],2,Ca[0],Ca[1],Ca[2],Ca[3]);ha.pickable!==H.getVisibility(ba.pickability,ya)&&(ba.pickability=H.updateVisibilityWithCount(ba.pickability,ba.count,ya,ha.pickable))}ba.verticalOffsets=ra?W:null;U.offsetObb=ra?x.computeOffsetObb(U.obb,Y,ja,this._viewingMode,U.offsetObb??U.obb.clone()):null;oa||ra||this._hasObjectAndLayerId?
(R.componentParameters=new B.ComponentParametersVarying,R.componentParameters.castShadows=V(ca,ba.count),R.componentParameters.transparent=V(Z,ba.count),R.componentParameters.opaqueOverride=V(ea,ba.count),R.componentParameters.texture=X,X.updateTexture()):(R.componentParameters=new B.ComponentParametersUniform,R.componentParameters.castShadows=ha.castShadows?B.ComponentParameterSummary.All:B.ComponentParameterSummary.None,R.componentParameters.externalColor=ha.externalColor,R.componentParameters.externalColorMixMode=
ha.externalColorMixMode);this._elevationRangeCacheVerticalOffset=NaN;this._notifyDirty()}getComponentAabb(U,P,R,ba=!1){U.intersectionGeometry.getComponentAabb(P,R);const X=U.components.verticalOffsets;if(ba||null==X)return R;P=X[P];if(this._viewingMode===l.ViewingMode.Local||0===P)return R[2]+=P,R[5]+=P,R;P=z.getVerticalOffsetI3S(P);P.localOrigin=U.transform.position;return P.applyToAabb(R)}getComponentObb(U){return U.obb}getObjectTransform(U){return U.transform}getComponentPositions(U,P,R){return U.intersectionGeometry.getComponentPositions(P,
R)}expandRangeWithComponentObjectElevationRange(U,P,R,ba){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==P||ba.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);var X=U.components;const da=X.count;X=X.verticalOffsets;const ha=this._viewingMode===l.ViewingMode.Local,fa=U.intersectionGeometry.getComponentAabbs(),aa=O;let Z=Infinity,ea=-Infinity;for(let Y=0;Y<da;Y++){var ca=6*Y,W=X?.[Y]??0;let ja=Infinity,oa=-Infinity;
if(ha)ja=fa[ca+2]+W+P,oa=fa[ca+5]+W+P;else{aa[0]=fa[ca];aa[1]=fa[ca+1];aa[2]=fa[ca+2];aa[3]=fa[ca+3];aa[4]=fa[ca+4];aa[5]=fa[ca+5];0!==W&&(ca=z.getVerticalOffsetI3S(W),ca.localOrigin=U.transform.position,ca.applyToAabb(aa));ca=Math.max(Math.abs(aa[3]),Math.abs(aa[0]));W=Math.max(Math.abs(aa[4]),Math.abs(aa[1]));const ra=P+aa[5]+R;ba.expandElevationRangeValues(P+aa[2],Math.sqrt(ca*ca+W*W+ra*ra)-R)}ba.expandElevationRangeValues(ja,oa);Z=Math.min(Z,ja);ea=Math.max(ea,oa)}this._elevationRangeCacheVerticalOffset=
P;this._elevationRangeCacheMin=Z;this._elevationRangeCacheMax=ea}intersect(U,P,R,ba,X,da,ha){const {transform:fa}=U,{position:aa}=fa;null!=X&&(X.localOrigin=aa);return U.intersectionGeometry.intersect(P,R,ba,X,U.components.verticalOffsets,da,fa,ha??!1)}addEdges(U,P,R,ba){const {indices:X,positions:da}=U.intersectionGeometry;return P.addComponentObject(U,da,X,U.components.offsets,R,ba)}async extractEdgeInformation(U,P,R){var ba=U.components.visibility;if(ba.allInvisible())return{buffer:K.extractComponentsEdgeLocationsLayout.createBuffer(0),
origin:[0,0,0]};const {indices:X,positions:da}=U.intersectionGeometry,ha=U.components.offsets,fa=J.EdgeInputBufferLayout.createBuffer(da.length/3);n.copy(fa.position.typedBuffer,da,fa.position.typedBufferStride,3);e.transformMat3View(fa.position,fa.position,U.transform.rotationScale);this._setComponentIndices(fa.componentIndex,X,ha);ba=this._computeVisibilityIndices(X,ba,ha,fa.count);U=d.clone(U.transform.position);P=await P.extractComponentsEdgeLocations({indices:ba,indicesLength:ba.length,skipDeduplicate:!0,
data:fa,writerSettings:{reducedPrecision:!1,variants:0}},R);return{origin:U,buffer:P}}_setComponentIndices(U,P,R){let ba=0;for(let da=0;da<R.length-1;da++){var X=R[da];const ha=R[da+1];for(;X<ha;X++)U.set(P?P[X]:X,ba);ba++}}_computeVisibilityIndices(U,P,R,ba){if(U&&P.allVisible())return U;let X=0;P.forEachComponentRange((fa,aa)=>{X+=R[aa]-R[fa];return!0});const da=k.isArray(U)?Array(X):2===U?.BYTES_PER_ELEMENT||65536>=ba?new Uint16Array(X):new Uint32Array(X);let ha=0;P.forEachComponentRange((fa,aa)=>
{fa=R[fa];for(aa=R[aa];fa<aa;fa++)da[ha++]=U?U[fa]:fa;return!0});return da}addComponentHighlight(U,P){U=U.components;null==U.highlightCounts&&(U.highlightCounts=new Uint32Array(U.count+1));0===U.highlightCounts[P]++&&(U.highlightsDirty(),this._notifyDirty());U.highlightCounts[U.count]++}removeComponentHighlight(U,P){U=U.components;if(null==U.highlightCounts)Q().warn("Removing non-existing highlight.");else{var R=U.highlightCounts[P],ba=U.highlightCounts[U.count];0===R?Q().warn("Removing non-existing highlight."):
1<R?(U.highlightCounts[P]=R-1,U.highlightCounts[U.count]=ba-1):(U.highlightCounts[P]=0,U.highlightsDirty(),this._notifyDirty(),1===ba?U.highlightCounts=null:U.highlightCounts[U.count]=ba-1)}}clearHighlights(U){U=U.components;null!=U.highlightCounts&&(U.highlightCounts=null,U.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(U){return U.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(U,P){var R=this._renderManager.rctx;const ba=U.geometry;
var X=ba.vertices.layoutParameters;const da=M.BufferObject.createVertex(R,S.Usage.STATIC_DRAW,ba.vertices.data),ha=ba.indices?M.BufferObject.createIndex(R,S.Usage.STATIC_DRAW,ba.indices):null,fa=w.glLayout(E.createVertexBufferLayout(X)),aa=new Uint16Array(ba.vertices.count);for(let ea=0;ea<P.count;ea++){var Z=P.offsets[ea];const ca=P.offsets[ea+1],W=P.materialDataIndices[ea];if(null!=ba.indices)for(;Z<ca;Z++)aa[ba.indices[Z]]=W;else for(;Z<ca;Z++)aa[Z]=W}P=M.BufferObject.createVertex(R,S.Usage.STATIC_DRAW,
aa.buffer);U=new B.ComponentMaterial(U.transform,U.toMapSpace);R=new N.VertexArrayObject(R,F.attributeLocations,{data:fa,componentIndices:ia},{data:da,componentIndices:P},ha);X=new y.RenderGeometry(R,S.PrimitiveType.TRIANGLES,X,null!=ha);return new r.Renderable(U,X,{cameraDepthSquared:.5,gpuMemoryEstimate:da.usedMemory+P.usedMemory+(null!=ha?ha.usedMemory:0)})}_notifyDirty(){this._renderManager.notifyDirty()}}const ia=w.glLayout(q.newLayout().u16(C.VertexAttribute.COMPONENTINDEX)),O=f.create();a.ComponentObjectCollection=
T;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(a){function b(c,k,m){const d=[],f=[];let g=m.length,e=m.length;k.forEachComponent(n=>{0<c[n]?(g!==n-1&&(d.length&&d.push(m[g+1]-d[d.length-1]),d.push(m[n])),g=n):(e!==n-1&&(f.length&&f.push(m[e+1]-f[f.length-1]),f.push(m[n])),e=n);return!0});d.length&&d.push(m[g+1]-d[d.length-1]);f.length&&f.push(m[e+
1]-f[f.length-1]);return{highlightRanges:d,defaultRanges:f}}class h{constructor(c,k){this.offsets=k;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;k=this.count;this.visibility=new a.ComponentRangeRunLengthEncoded(k);this.materialDataBuffer=c.getBuffer(k);this.materialDataIndices=new Uint16Array(k);for(c=0;c<k;c++)this.materialDataIndices[c]=this.materialDataBuffer.acquireIndex()}destroy(){for(let c=0;c<
this.count;c++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[c])}get count(){return this.offsets.length-1}get geometryRanges(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}get defaultShadowMapRanges(){if(null==this.highlightCounts)return this.geometryRanges;
this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=this.cachedHighlightRanges=null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const {highlightRanges:c,defaultRanges:k}=b(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=c;this.cachedDefaultRanges=k}}}return h})},
"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){class b{constructor(h){this._totalCount=h;this._componentCountCache=-1;this._indexRanges=[0,h]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(h){if(0>h||h>=this._totalCount)return!1;if(this.allVisible())return!0;const c=this._indexRanges;let k=0,m=c.length/2;if(h<c[2*k]||h>c[2*m]+c[2*m+1])return!1;
for(;0<m-k;){const d=Math.floor(.5*(k+m)),f=c[2*d];if(h<f){if(1===m-k)break;m=d}else{if(h<f+c[2*d+1])return!0;if(1===m-k)break;k=d+1}}return!1}get componentCount(){if(-1===this._componentCountCache){const h=this._indexRanges;let c=0;for(let k=0;k<h.length;k+=2)c+=h[k+1];this._componentCountCache=c}return this._componentCountCache}reset(h){if("all"===h||h.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const m=[];if(0!==h.length){var c=h[0],k=1;for(let d=1;d<h.length;d++){const f=
h[d];c+k===f?k+=1:(m.push(c),m.push(k),c=f,k=1)}m.push(c);m.push(k)}h=m}this._indexRanges=h}this._componentCountCache=-1}forEachComponent(h){const c=this._indexRanges;for(let m=0;m<c.length;m+=2){var k=c[m];const d=k+c[m+1];for(;k<d;k++)if(!h(k))return!1}return!0}forEachComponentRange(h){const c=this._indexRanges;for(let k=0;k<c.length;k+=2){const m=c[k];if(!h(m,m+c[k+1]))return!1}return!0}computeOffsetRanges(h){const c=Array(this._indexRanges.length),k=this._indexRanges;for(let d=0;d<k.length;d+=
2){var m=k[d];const f=h[m];m=h[m+k[d+1]];c[d]=f;c[d+1]=m-f}return c}}a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../core/maybe"],function(a,b){class h{constructor(c,k,m,d,f,g){this.transform=c;this.toMapSpace=k;this.obb=m;this.components=d;this.renderable=f;this.intersectionGeometry=g;this.visible=!1;this.offsetObb=null}destroy(){this.intersectionGeometry=
b.destroyMaybe(this.intersectionGeometry);this.renderable=b.destroyMaybe(this.renderable);this.components=b.destroyMaybe(this.components)}}a.ComponentObject=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ../../../../ViewingMode ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x{constructor(J,K,I){this.viewingMode=J;this.positionData=K;this._components=I;this._planetCenter=c.create();this._planetNorth=c.create();this._componentIndicesForBsp=null;this._componentBspNodes=[];this._aabb=[0,0,0,0,0,0];this._indices=K.indices?f.compactIndices(K.indices):f.getContinuousIndexArray(K.positions.length/3);this._positions=K.positions;this._componentIntersectionData=Array(I.count)}destroy(){this._indices=this._positions=null;this._componentIntersectionData.length=
0;this._perComponentAabbs=null}getComponentAabb(J,K){const I=this._ensureComponentAabbs();for(let M=0;6>M;M++)K[M]=I[6*J+M];return K}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());return this._perComponentAabbs}getComponentPositions(J,K){K.indices=this._indices;K.data=this._positions;K.stride=3;K.startIndex=this._components.offsets[J];K.endIndex=this._components.offsets[J+1]}intersect(J,
K,I,M,S,N,V,Q){var {position:T}=V;const ia=h.sub(t,J,T),O=h.sub(r,K,T);J=a.invert(y,V.rotationScale);h.transformMat3(ia,ia,J);h.transformMat3(O,O,J);const U=a.transpose(D,J),P=new n.Vertices(this._positions,3),R=this._indices,ba=this._components.offsets,X=u.computeInvDir(ia,O,q);this.viewingMode===g.ViewingMode.Global&&(K=this._planetCenter,h.negate(K,T),h.transformMat3(K,K,J),T=this._planetNorth,h.set(T,0,0,1),h.transformMat3(T,T,J),h.normalize(T,T));const da=h.copy(E,ia),ha=h.copy(A,O);T=h.sub(B,
O,ia);h.normalize(T,T);this._intersectComponents(fa=>{var aa=this.getComponentAabb(fa,v);if(null!=S){var Z=S[fa];null==M||Q?(ia[2]=da[2]-Z,O[2]=ha[2]-Z):M.componentOffset=Z}null==M||Q||M.applyToAabb(aa);if(u.intersectAabbInvDir(aa,ia,X,I)){aa=ba[fa]/3;Z=ba[fa+1]/3;var ea=(ca,W,Y)=>N(fa,ca,h.transformMat3(W,W,U),Y);(null==M||Q)&&Z-aa>e.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[fa]&&(this._componentIntersectionData[fa]=new e.ComponentIntersectionData(this._indices,
aa,Z,P)),this._componentIntersectionData[fa].intersectRay(ia,O,ea)):u.intersectTriangles(ia,O,aa,Z,R,P,void 0,M,ea)}},Q,ia,O)}_intersectComponents(J,K,I,M){const S=this._components.pickability,N=this._components.visibility;if(7>this._components.visibility.componentCount)N.forEachComponent(T=>{l.getVisibility(S,T)&&J(T);return!0});else{0===this._componentBspNodes.length&&this._generateComponentBspRoot();var V=this._componentIndicesForBsp,Q=(T,ia)=>{for(let O=T;O<ia;++O)T=V[O],l.getVisibility(S,T)&&
N.isVisible(T)&&J(T)};if(K)for(K=0;0<=K;)if(K=this._componentBspNodes[K],M=K.plane,!M||-1===K.child0&&-1===K.child1){Q(K.minComponentIndexIndex,K.maxComponentIndexIndex);break}else if(Q(K.minMidComponentIndexIndex,K.maxMidComponentIndexIndex),M=h.dot(M,I)-M[3],0>M){if(-1===K.child0){Q(K.minComponentIndexIndex,K.minMidComponentIndexIndex);break}K=K.child0}else if(0<M){if(-1===K.child1){Q(K.maxMidComponentIndexIndex,K.maxComponentIndexIndex);break}K=K.child1}else break;else{const T=z;h.sub(T,M,I);h.normalize(T,
T);const ia=this._componentBspNodes,O=U=>{U=ia[U];var P=U.plane;if(!P||-1===U.child0&&-1===U.child1)Q(U.minComponentIndexIndex,U.maxComponentIndexIndex);else{const R=h.dot(P,I)-P[3];P=h.dot(P,T);U.minComponentIndexIndex<U.minMidComponentIndexIndex&&(0>=R||0>P)&&(-1!==U.child0?O(U.child0):Q(U.minComponentIndexIndex,U.minMidComponentIndexIndex));Q(U.minMidComponentIndexIndex,U.maxMidComponentIndexIndex);U.maxMidComponentIndexIndex<U.maxComponentIndexIndex&&(0<=R||0<P)&&(-1!==U.child1?O(U.child1):Q(U.maxMidComponentIndexIndex,
U.maxComponentIndexIndex))}};O(0)}}}_generateComponentBspRoot(){const J=this._components.count,K=new Uint16Array(J);this._componentIndicesForBsp=K;for(var I=0;I<J;++I)K[I]=I;const M=this._ensureComponentAabbs(),S=this._planetCenter,N=this._planetNorth;I=H;h.negate(I,S);h.normalize(I,I);h.cross(L,N,I);var V=this._aabb;I=V[2];const Q=[];let T=0;const ia=this._componentBspNodes;ia.length=0;const O=(X,da)=>{X*=6;var ha=M[X],fa=M[X+1],aa=M[X+2];const Z=M[X+3],ea=M[X+4],ca=M[X+5];X=h.set(C,.5*(ha+Z),.5*
(fa+ea),.5*(aa+ca));ha=.5*(Z-ha);fa=.5*(ea-fa);aa=.5*(ca-aa);aa=Math.sqrt(ha*ha+fa*fa+aa*aa);fa=da[3];da=h.dot(da,X)-fa;return Math.abs(da)>aa?Math.sign(da):0},U=(X,da,ha)=>{let fa=Infinity,aa=Infinity,Z=Infinity,ea=-Infinity,ca=-Infinity,W=-Infinity;for(;da<ha;++da){const Y=6*K[da];fa=Math.min(fa,M[Y]);ea=Math.max(ea,M[Y+3]);aa=Math.min(aa,M[Y+1]);ca=Math.max(ca,M[Y+4]);Z=Math.min(Z,M[Y+2]);W=Math.max(W,M[Y+5])}X[0]=fa;X[1]=aa;X[2]=Z;X[3]=ea;X[4]=ca;X[5]=W},P=this.viewingMode===g.ViewingMode.Local;
let R=!1;P||(V=h.set(C,.5*(V[0]+V[3]),.5*(V[1]+V[4]),.5*(V[2]+V[5])),V=h.dist(S,V),R=I>.5*V);const ba=(X,da,ha,fa,aa)=>{const Z=ia.length;if(R||10<=ha||5>da-X)var ea=new w(X,da,da,da,null);else{U(p,X,da);var ca=p[0],W=p[1],Y=p[2];const ja=p[3],oa=p[4],ra=ja-ca,ta=oa-W;ea=k.create();if(P)ra>=ta?(h.set(ea,1,0,0),ea[3]=-.5*(ca+ja)):(h.set(ea,0,1,0),ea[3]=-.5*(W+oa));else{const pa=F,wa=G;h.set(pa,.5*(ca+ja),.5*(W+oa),Y);h.sub(pa,pa,S);h.normalize(pa,pa);h.cross(wa,pa,N);h.normalize(wa,wa);ra>=ta?h.copy(ea,
wa):(h.cross(ea,wa,pa),h.normalize(ea,ea));ea[3]=h.dot(ea,S)}let ya,Ca;W=X;for(ca=da;W<ca;)Y=K[W],0>O(Y,ea)?++W:(--ca,K[W]=K[ca],K[ca]=Y);ya=W;for(ca=da;W<ca;)Y=K[ca-1],0<O(Y,ea)?--ca:(K[ca-1]=K[W],K[W]=Y,++W);Ca=ca;ea=new w(X,ya,Ca,da,ea);ya>=X+5&&Q.push(()=>ba(X,ya,ha+1,Z,!0));da>=Ca+5&&Q.push(()=>ba(Ca,da,ha+1,Z,!1))}ia.push(ea);-1!==fa&&(fa=ia[fa],aa?fa.child0=Z:fa.child1=Z)};for(Q.push(()=>ba(0,J,0,-1,!1));T<Q.length;)(0,Q[T])(),++T}_computePerComponentAabbs(){const J=this._components.count,
K=d.newFloatArray(6*J),I=this._indices,M=this._positions,S=this._components.offsets;let N=0,V=Infinity,Q=Infinity,T=Infinity,ia=-Infinity,O=-Infinity,U=-Infinity;for(let ba=0;ba<J;ba++){var P=S[ba];const X=S[ba+1];let da=Infinity,ha=Infinity,fa=Infinity,aa=-Infinity,Z=-Infinity,ea=-Infinity;for(;P<X;P++){var R=3*I[P];const ca=M[R],W=M[R+1];R=M[R+2];da=Math.min(da,ca);ha=Math.min(ha,W);fa=Math.min(fa,R);aa=Math.max(aa,ca);Z=Math.max(Z,W);ea=Math.max(ea,R)}K[N++]=da;K[N++]=ha;K[N++]=fa;K[N++]=aa;K[N++]=
Z;K[N++]=ea;V=Math.min(V,da);Q=Math.min(Q,ha);T=Math.min(T,fa);ia=Math.max(ia,aa);O=Math.max(O,Z);U=Math.max(U,ea)}this._aabb[0]=V;this._aabb[1]=Q;this._aabb[2]=T;this._aabb[3]=ia;this._aabb[4]=O;this._aabb[5]=U;return K}get positions(){return this._positions}get indices(){return this._indices}get aabb(){this._ensureComponentAabbs();return this._aabb}}class w{constructor(J,K,I,M,S){this.minComponentIndexIndex=J;this.minMidComponentIndexIndex=K;this.maxMidComponentIndexIndex=I;this.maxComponentIndexIndex=
M;this.plane=S;this.child1=this.child0=-1}}const q=c.create(),v=m.create(),p=[0,0,0,0,0,0],t=c.create(),r=c.create(),y=b.create(),D=b.create(),E=c.create(),A=c.create(),B=c.create(),F=c.create(),G=c.create(),H=c.create(),L=c.create(),C=c.create(),z=c.create();return x})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(a,b){function h(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=h;a.getVisibility=function(c,
k){if(null==c)return!0;const {isVisibleBit:m,data:d}=c,f=8*d.BYTES_PER_ELEMENT;return k<d.length*f?(c=k/f|0,0!==(d[c]&1<<k-c*f)===m):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,k,m,d){if(m>=k)return c;null==c&&(c=h());let f=c.data;const g=8*f.BYTES_PER_ELEMENT,e=m/g|0,n=m-g*e,l=f;d=d===c.isVisibleBit;m<l.length*g||!d||(m=Math.max(e+1,Math.ceil(l.length*b.reallocGrowthFactor)),m=Math.min(m,((k-1)/g|0)+1),f=new Uint32Array(m),f.set(l));e<f.length&&(f[e]=f[e]&~(1<<n)|(d?1:0)<<n);c.data=f;
return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){class b{constructor(h,c,k){this.material=h;this.geometry=c;this.meta=k}destroy(){this.material.dispose();this.geometry.dispose()}}a.Renderable=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(a){class b{constructor(h,
c,k,m){this.vao=h;this.primitiveType=c;this.parameters=k;this.indexed=m}dispose(){this.vao.dispose()}}a.RenderGeometry=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){class h{constructor(c){this._objects=c}submit(c,k){this._objects.preSubmit(k);this._objects.visibleObjects.forAll(m=>m.renderable.material.submit(c,k,m))}queryShadowCasterDepthRange(c){return this._objects.visibleObjects.length?
b.computeDepthRange(c,this._objects.visibleObjects):null}}a.RenderSubmitSystem=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/quat ../../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../lib/depthRange".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(H,L,C){return d.set(H,L.data[C],L.data[C+1],L.data[C+2])}function l(H,L){H.push(L[0]);H.push(L[1]);H.push(L[2])}function u(H,L,C,z){k.conjugate(D,H.quaternion);d.sub(E,L,H.center);d.transformQuat(E,E,D);L=H.halfSize;const J=8*((E[0]<-L[0]?-1:E[0]>L[0]?1:0)+3*(E[1]<-L[1]?-1:E[1]>L[1]?1:0)+9*(E[2]<-L[2]?-1:E[2]>L[2]?1:0)+13);L=r[J];if(0===L)return L;h.fromQuat(y,H.quaternion);h.scale(y,y,H.halfSize);const K=(I,M)=>{M=r[J+M+1];d.set(I,((M&1)<<1)-1,(M&2)-1,((M&
4)>>1)-1);d.transformMat3(I,I,y);return d.add(I,H.center,I)};C.length=0;l(C,K(A,0));l(C,K(B,1));l(C,K(E,2));l(C,K(F,3));z(C);if(1===L)return L;C.length=0;l(C,A);l(C,F);l(C,K(E,4));l(C,K(G,5));z(C);if(2===L)return L;C.length=0;l(C,A);l(C,G);l(C,K(E,6));l(C,B);z(C);return L}const x=new b({allocator:H=>H||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:H=>{H.object=null;return H}}),w=e.empty(),q=f.create(),v=f.create(),p=new b({deallocator:null}),t=new b({deallocator:null}),r=(()=>{const H=
Array(216);let L=0;const C=z=>{for(let J=0;J<z.length;J++)H[L+J]=z[J];L+=8};C([3,0,6,2,3,1,5,4]);C([2,0,2,3,1,5,4,0]);C([3,1,0,2,3,7,5,4]);C([2,0,1,3,2,6,4,0]);C([1,0,1,3,2,0,0,0]);C([2,1,5,7,3,2,0,0]);C([3,2,0,1,3,7,6,4]);C([2,2,0,1,3,7,6,0]);C([3,3,0,1,5,7,6,2]);C([2,0,1,5,4,6,2,0]);C([1,0,1,5,4,0,0,0]);C([2,1,3,7,5,4,0,0]);C([1,0,2,6,4,0,0,0]);C([0,0,0,0,0,0,0,0]);C([1,1,3,7,5,0,0,0]);C([2,2,3,7,6,4,0,0]);C([1,2,3,7,6,0,0,0]);C([2,3,1,5,7,6,2,0]);C([3,4,0,1,5,7,6,2]);C([2,5,7,6,4,0,1,0]);C([3,
5,0,1,3,7,6,4]);C([2,4,5,7,6,2,0,0]);C([1,4,5,7,6,0,0,0]);C([2,5,1,3,7,6,4,0]);C([3,6,0,2,3,7,5,4]);C([2,6,2,3,7,5,4,0]);C([3,7,6,2,3,1,5,4]);return H})(),y=c.create(),D=m.create(),E=f.create(),A=f.create(),B=f.create(),F=f.create(),G=f.create();a.computeDepthRange=function(H,L){const C=e.empty(),{eye:z,frustum:J,viewForward:K}=H;L.forAll(I=>{var M=null!=I.offsetObb?I.offsetObb:I.obb;const S=d.dot(d.sub(E,M.center,z),K),N=M.projectedRadius(K);if(!e.within(C,S-N)||!e.within(C,S+N)){a:{var V=0;for(let Q=
0;4>Q;Q++){const T=M.intersectPlane(J[Q]);if(0<T){M=-1;break a}0===T&&(V|=1<<Q)}M=V}-1!==M&&(0===M?(w.far=S+N,w.near=S-N,e.union(C,w)):(V=x.pushNew(),V.near=S-N,V.far=S+N,V.mask=M,V.object=I))}});for(H=0;H<x.length;H++){const I=x.data[H];e.within(C,I.near)&&e.within(C,I.far)||(w.far=I.far,w.near=Infinity,0===u(null!=I.object.offsetObb?I.object.offsetObb:I.object.obb,z,p,M=>{var S=t;for(var N=0;4>N&&0<M.length;N++){if(0===(I.mask&1<<N))continue;var V=J[N],Q=M,T=S;T.length=0;const ia=Q.length-3;n(q,
Q,ia);const O=g.signedDistance(V,q);0>=O&&(T.push(q[0]),T.push(q[1]),T.push(q[2]));let U=0,P=O;for(U;U<ia;U+=3){n(v,Q,U);const R=g.signedDistance(V,v);0>P*R&&(d.lerp(q,v,q,R/(R-P)),l(T,q));0>=R&&l(T,v);P=R;d.copy(q,v)}0>P*O&&(n(v,Q,ia),d.lerp(q,v,q,O/(O-P)),l(T,q));V=M;M=S;S=V}for(S=0;S<M.length;S+=3)d.set(q,M.data[S],M.data[S+1],M.data[S+2]),N=d.dot(d.sub(q,q,z),K),w.near=Math.min(w.near,N)})&&(w.near=0),e.union(C,w))}x.length=0;return C};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(k,m){return{near:k,far:m}}function h(k,m,d){k.near=m;k.far=d;return k}class c{constructor(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE}}a.DepthRange=c;a.create=b;a.empty=function(k){return k?h(k,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=h;a.union=function(k,m){null!=m&&(k.near=Math.min(k.near,m.near),k.far=Math.max(k.far,m.far))};a.within=function(k,m){return k.near<=m&&m<=k.far};a.zero=
{near:0,far:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,h,c){a.createVertexBufferLayout=function(k){const m=b.newLayout().vec3f(c.VertexAttribute.POSITION);k.hasNormals&&m.vec2i16(c.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});
k.textureCoordinates===h.TextureCoordinateAttributeType.Default?m.vec2f(c.VertexAttribute.UV0):k.textureCoordinates===h.TextureCoordinateAttributeType.Atlas&&(m.vec2f(c.VertexAttribute.UV0),m.vec4u16(c.VertexAttribute.UVREGION,{glNormalized:!0}));k.colors&&m.vec4u8(c.VertexAttribute.COLOR,{glNormalized:!0});return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec4f64",
"../../../layers/support/symbolColorUtils"],function(a,b,h){class c{constructor(){this.externalColor=b.create();this.externalColorMixMode=h.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0}}a.UniformComponentParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/OverlayContent ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType ../../../materials/pbrUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L){class C extends p.MaterialBase{constructor(M,S){super();this.toMapSpace=S;this.baseColor=n.fromValues(1,1,1,1);this.hasParametersFromSource=this.usePBR=!1;this.mrrFactors=g.fromArray(L.defaultAdvancedMRRFactors);this.emissiveFactor=g.fromValues(0,0,0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null;this.objectOpacity=1;this.commonMaterialParameters=new J;this.componentParameters=
new K;this.textureAlphaCutoff=A.defaultMaskAlphaCutoff;this.alphaDiscardMode=G.AlphaDiscardMode.Opaque;this.polygonOffsetEnabled=this.isIntegratedMesh=!1;this.ellipsoidMode=B.EllipsoidMode.Earth;this.hasOccludees=!1;this._techniqueConfiguration=new w.ComponentTechniqueConfiguration;S=new F.TwoVectorPosition(M.position);const N=m.clone(M.rotationScale);k.invert(N,N);this.transformNormalGlobalFromModel=d.clone(k.transpose(N,N));this.transformWorldFromModelTL=S.low;this.transformWorldFromModelTH=S.high;
this.transformWorldFromModelRS=M.rotationScale}dispose(){this._technique=c.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:
null}get textureOcclusion(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(M,S,N,V){const Q=this._techniqueConfiguration;Q.hasVertexColors=V.colors;Q.hasNormals=V.hasNormals;Q.textureCoordinateType=V.textureCoordinates;Q.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;Q.hasEmissionTexture=null!=this.emissionTexture;Q.hasOcclusionTexture=null!=this.occlusionTexture;
Q.hasNormalTexture=null!=this.normalTexture;Q.transparencyPassType=S.identifier===t.RenderPassIdentifier.Material&&null!=N.transparencyPassType?N.transparencyPassType:H.TransparencyPassType.NONE;Q.multipassEnabled=S.identifier===t.RenderPassIdentifier.Material&&N.multipassEnabled;Q.cullAboveGround=S.identifier===t.RenderPassIdentifier.Material?N.multipassTerrain.cullAboveGround:!1;Q.ellipsoidMode=this.ellipsoidMode;Q.componentData=this.componentParameters.type;Q.cullFace=this.commonMaterialParameters.cullFace;
Q.doubleSidedMode=this.commonMaterialParameters.doubleSided?D.NormalsDoubleSidedMode.View:D.NormalsDoubleSidedMode.None;Q.hasColorTexture=null!=this.baseColorTexture;const T=this._computeWhichMaterialPass();Q.blendingEnabled=T===z.Transparent||T===z.OpaqueAndTransparent;Q.alphaDiscardMode=this.alphaDiscardMode;Q.integratedMeshMode=this.isIntegratedMesh?null!=N.overlay?.getTexture(u.OverlayContent.ColorNoRasterImage)?null!=N.overlay?.getTexture(u.OverlayContent.WaterNormal)?w.IntegratedMeshMode.ColorOverlayWithWater:
w.IntegratedMeshMode.ColorOverlay:w.IntegratedMeshMode.NoOverlay:w.IntegratedMeshMode.None;Q.hasPolygonOffset=this.polygonOffsetEnabled;Q.pbrMode=Q.integratedMeshMode===w.IntegratedMeshMode.ColorOverlayWithWater?E.PBRMode.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?h("enable-feature:im-shading")&&this.isIntegratedMesh?E.PBRMode.Simplified:E.PBRMode.Schematic:E.PBRMode.Normal:E.PBRMode.Disabled;Q.normalType=V.needsNormals?Q.hasNormals?y.NormalType.Compressed:y.NormalType.ScreenDerivative:
y.NormalType.Ground;Q.hasSlicePlane=null!=N.slicePlane&&this.commonMaterialParameters.hasSlicePlane;if(S.identifier===t.RenderPassIdentifier.ShadowMap)Q.output=r.ShaderOutput.Shadow,Q.vertexDiscardMode=v.VertexDiscardMode.None;else if(S.identifier===t.RenderPassIdentifier.Highlight)Q.output=r.ShaderOutput.Highlight,Q.vertexDiscardMode=v.VertexDiscardMode.None;else{Q.vertexDiscardMode=T===z.OpaqueAndTransparent?S.transparent?v.VertexDiscardMode.Opaque:v.VertexDiscardMode.Transparent:v.VertexDiscardMode.None;
Q.output=S.output;Q.receiveAmbientOcclusion=!1;Q.receiveShadows=!1;switch(S.output){case r.ShaderOutput.Color:Q.receiveAmbientOcclusion=null!=N.ssao;Q.hasOccludees=N.hasOccludees;Q.receiveShadows=N.shadowMap.ready;Q.hasScreenSpaceReflections=null!=N.ssr.lastFrameColor;Q.hasCloudsReflections=null!=N.cloudsFade.data;break;case r.ShaderOutput.Alpha:Q.hasOccludees=N.hasOccludees;break;case r.ShaderOutput.ObjectAndLayerIdColor:Q.objectAndLayerIdColor=!0}Q.snowCover=this.hasSnowCover(N)}this._technique=
M.releaseAndAcquire(x.ComponentTechnique,Q,this._technique);this._setClean();return this._technique}hasSnowCover(M){return null!=M.weather&&M.weatherVisible&&"snowy"===M.weather.type&&"enabled"===M.weather.snowCover}submit(M,S,N){if(0!==this.objectOpacity){var V=N.renderable.geometry,Q=N.components;N=N.renderable.meta.cameraDepthSquared;var T=Q.geometryRanges,ia=Q.highlightRanges;Q=Q.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case z.Opaque:M.materialOpaque.submitDraw(this,V,T,
N);break;case z.Transparent:M.materialTransparent.submitDraw(this,V,T,N);break;case z.OpaqueAndTransparent:M.materialOpaque.submitDraw(this,V,T,N);M.materialTransparent.submitDraw(this,V,T,N);break;case z.IntegratedMesh:M.materialIntegratedMesh.submitDraw(this,V,T,N),null!=S.overlay?.getTexture(u.OverlayContent.Highlight)&&M.highlightIntegratedMesh.submitDraw(this,V,T,N)}(S=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&M.shadowMap.submitDraw(this,V,T,N);null!=ia&&(M.highlight.submitDraw(this,
V,ia,N),S&&M.highlightShadowMap.submitDraw(this,V,ia,N));S&&null!=Q&&M.defaultShadowMap.submitDraw(this,V,Q,N)}}_computeWhichMaterialPass(){return this.isIntegratedMesh?z.IntegratedMesh:1>this.objectOpacity?z.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?z.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===G.AlphaDiscardMode.Blend||this.alphaDiscardMode===G.AlphaDiscardMode.MaskBlend?z.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?
z.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?z.Transparent:z.OpaqueAndTransparent}}b.__decorate([p.parameter({vectorOps:e.vec4})],C.prototype,"baseColor",void 0);b.__decorate([p.parameter()],C.prototype,"usePBR",void 0);b.__decorate([p.parameter()],C.prototype,"hasParametersFromSource",void 0);b.__decorate([p.parameter({vectorOps:f.vec3})],C.prototype,"mrrFactors",void 0);b.__decorate([p.parameter({vectorOps:f.vec3})],C.prototype,"emissiveFactor",void 0);b.__decorate([p.parameter({dispose:!0})],
C.prototype,"baseColorTexture",void 0);b.__decorate([p.parameter({dispose:!0})],C.prototype,"metallicRoughnessTexture",void 0);b.__decorate([p.parameter({dispose:!0})],C.prototype,"emissionTexture",void 0);b.__decorate([p.parameter({dispose:!0})],C.prototype,"occlusionTexture",void 0);b.__decorate([p.parameter({dispose:!0})],C.prototype,"normalTexture",void 0);b.__decorate([p.parameter()],C.prototype,"objectOpacity",void 0);b.__decorate([p.parameterBlock()],C.prototype,"commonMaterialParameters",
void 0);b.__decorate([p.parameterBlock()],C.prototype,"componentParameters",void 0);b.__decorate([p.parameter()],C.prototype,"textureAlphaCutoff",void 0);b.__decorate([p.parameter()],C.prototype,"alphaDiscardMode",void 0);b.__decorate([p.parameter()],C.prototype,"isIntegratedMesh",void 0);b.__decorate([p.parameter()],C.prototype,"polygonOffsetEnabled",void 0);b.__decorate([p.parameter()],C.prototype,"ellipsoidMode",void 0);b.__decorate([p.parameter()],C.prototype,"hasOccludees",void 0);var z;(function(M){M[M.Opaque=
0]="Opaque";M[M.Transparent=1]="Transparent";M[M.OpaqueAndTransparent=2]="OpaqueAndTransparent";M[M.IntegratedMesh=3]="IntegratedMesh"})(z||={});class J extends p.MaterialParameterBlock{constructor(){super(...arguments);this.doubleSided=!1;this.cullFace=G.CullFaceOptions.Back;this.hasSlicePlane=!0}}b.__decorate([p.parameter()],J.prototype,"doubleSided",void 0);b.__decorate([p.parameter()],J.prototype,"cullFace",void 0);b.__decorate([p.parameter()],J.prototype,"hasSlicePlane",void 0);class K extends p.MaterialParameterBlock{constructor(){super(...arguments);
this.externalColor=n.fromValues(1,1,1,1);this.externalColorMixMode=l.ColorMixModeEnum.Multiply;this.castShadows=a.ComponentParameterSummary.All}get transparent(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get opaqueOverride(){return this.externalColorMixMode===l.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get visible(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}get type(){return q.ComponentDataType.Uniform}}b.__decorate([p.parameter({vectorOps:e.vec4})],K.prototype,"externalColor",void 0);b.__decorate([p.parameter()],K.prototype,"externalColorMixMode",void 0);b.__decorate([p.parameter()],K.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(M){M[M.All=0]="All";M[M.Some=1]="Some";M[M.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));class I extends p.MaterialParameterBlock{constructor(){super(...arguments);
this.texture=null;this.castShadows=this.opaqueOverride=this.transparent=a.ComponentParameterSummary.None}get type(){return q.ComponentDataType.Varying}}b.__decorate([p.parameter()],I.prototype,"texture",void 0);b.__decorate([p.parameter()],I.prototype,"transparent",void 0);b.__decorate([p.parameter()],I.prototype,"opaqueOverride",void 0);b.__decorate([p.parameter()],I.prototype,"castShadows",void 0);a.CommonMaterialParameters=J;a.ComponentMaterial=C;a.ComponentParametersUniform=K;a.ComponentParametersVarying=
I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){class q extends f.ShaderTechnique{initializeConfiguration(p,t){t.spherical=p.viewingMode===h.ViewingMode.Global;t.doublePrecisionRequiresObfuscation=p.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(p){return new n.Program(p.rctx,q.shader.get().build(this.configuration),v)}_setPipelineState(p){const t=this.configuration,r=t.integratedMeshMode!==c.IntegratedMeshMode.None,y=p===u.TransparencyPassType.NONE,D=p===u.TransparencyPassType.FrontFace;
return w.makePipelineState({blending:t.output!==m.ShaderOutput.Color&&t.output!==m.ShaderOutput.Alpha||!t.blendingEnabled?null:y?e.blendingDefault:e.oitBlending(p),culling:w.cullingParams(t.cullFace),depthTest:{func:e.oitDepthTest(p)},depthWrite:y||D?w.defaultDepthWriteParams:null,colorWrite:w.defaultColorWriteParams,stencilWrite:r||t.hasOccludees?l.stencilWriteMaskOn:null,stencilTest:r?l.replaceBitWhenDepthTestPasses(g.StencilBits.IntegratedMeshMaskExcluded):t.hasOccludees?l.stencilBaseAllZerosParams:
null,polygonOffset:y||D?t.hasPolygonOffset?{factor:2,units:2}:null:e.OITPolygonOffset})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}q.shader=new d.ReloadableShaderModule(k.ComponentShader,()=>new Promise((p,t)=>a(["./shader/ComponentShader.glsl"],p,t)));const v=new Map([[x.VertexAttribute.POSITION,0],[x.VertexAttribute.NORMAL,1],[x.VertexAttribute.NORMALCOMPRESSED,1],[x.VertexAttribute.COLOR,2],[x.VertexAttribute.UV0,3],[x.VertexAttribute.UVREGION,
4],[x.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=q;b.attributeLocations=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){a.IntegratedMeshMode=void 0;(function(q){q[q.None=0]="None";q[q.NoOverlay=1]="NoOverlay";q[q.ColorOverlay=2]="ColorOverlay";q[q.ColorOverlayWithWater=3]="ColorOverlayWithWater";q[q.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));class w extends l.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.textureCoordinateType=d.TextureCoordinateAttributeType.None;this.componentData=h.ComponentDataType.Uniform;
this.cullFace=u.CullFaceOptions.Back;this.vertexDiscardMode=c.VertexDiscardMode.None;this.doubleSidedMode=f.NormalsDoubleSidedMode.WindingOrder;this.alphaDiscardMode=u.AlphaDiscardMode.Opaque;this.integratedMeshMode=a.IntegratedMeshMode.None;this.transparencyPassType=x.TransparencyPassType.NONE;this.ellipsoidMode=e.EllipsoidMode.Earth;this.pbrMode=g.PBRMode.Disabled;this.normalType=m.NormalType.Attribute;this.hasColorTexture=this.hasSlicePlane=this.hasNormals=this.hasVertexColors=this.doublePrecisionRequiresObfuscation=
this.spherical=!1;this.blendingEnabled=this.receiveShadows=this.receiveAmbientOcclusion=!0;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasPolygonOffset=this.hasScreenSpaceReflections=!1;this.hasCloudsReflections=!0;this.objectAndLayerIdColor=this.snowCover=!1}}b.__decorate([l.parameter({count:k.ShaderOutput.COUNT})],w.prototype,"output",void 0);b.__decorate([l.parameter({count:d.TextureCoordinateAttributeType.COUNT})],
w.prototype,"textureCoordinateType",void 0);b.__decorate([l.parameter({count:h.ComponentDataType.COUNT})],w.prototype,"componentData",void 0);b.__decorate([l.parameter({count:u.CullFaceOptions.COUNT})],w.prototype,"cullFace",void 0);b.__decorate([l.parameter({count:c.VertexDiscardMode.COUNT})],w.prototype,"vertexDiscardMode",void 0);b.__decorate([l.parameter({count:f.NormalsDoubleSidedMode.COUNT})],w.prototype,"doubleSidedMode",void 0);b.__decorate([l.parameter({count:u.AlphaDiscardMode.COUNT})],
w.prototype,"alphaDiscardMode",void 0);b.__decorate([l.parameter({count:a.IntegratedMeshMode.COUNT})],w.prototype,"integratedMeshMode",void 0);b.__decorate([l.parameter({count:x.TransparencyPassType.COUNT})],w.prototype,"transparencyPassType",void 0);b.__decorate([l.parameter({count:e.EllipsoidMode.COUNT})],w.prototype,"ellipsoidMode",void 0);b.__decorate([l.parameter({count:g.PBRMode.COUNT})],w.prototype,"pbrMode",void 0);b.__decorate([l.parameter({count:m.NormalType.COUNT})],w.prototype,"normalType",
void 0);b.__decorate([l.parameter()],w.prototype,"spherical",void 0);b.__decorate([l.parameter()],w.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([l.parameter()],w.prototype,"hasVertexColors",void 0);b.__decorate([l.parameter()],w.prototype,"hasNormals",void 0);b.__decorate([l.parameter()],w.prototype,"hasSlicePlane",void 0);b.__decorate([l.parameter()],w.prototype,"hasColorTexture",void 0);b.__decorate([l.parameter()],w.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([l.parameter()],
w.prototype,"receiveShadows",void 0);b.__decorate([l.parameter()],w.prototype,"blendingEnabled",void 0);b.__decorate([l.parameter()],w.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([l.parameter()],w.prototype,"hasPolygonOffset",void 0);b.__decorate([l.parameter()],w.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([l.parameter()],w.prototype,"hasEmissionTexture",void 0);b.__decorate([l.parameter()],w.prototype,"hasOcclusionTexture",void 0);b.__decorate([l.parameter()],w.prototype,
"hasNormalTexture",void 0);b.__decorate([l.parameter()],w.prototype,"hasOccludees",void 0);b.__decorate([l.parameter()],w.prototype,"multipassEnabled",void 0);b.__decorate([l.parameter()],w.prototype,"cullAboveGround",void 0);b.__decorate([l.parameter()],w.prototype,"hasCloudsReflections",void 0);b.__decorate([l.parameter()],w.prototype,"snowCover",void 0);b.__decorate([l.parameter()],w.prototype,"objectAndLayerIdColor",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"occlusionPass",
void 0);b.__decorate([l.parameter({constValue:n.BindType.Draw})],w.prototype,"pbrTextureBindType",void 0);b.__decorate([l.parameter({constValue:!0})],w.prototype,"hasSliceHighlight",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"hasVertexTangents",void 0);b.__decorate([l.parameter({constValue:!0})],
w.prototype,"supportsTextureAtlas",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"highStepCount",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"instancedDoublePrecision",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"hasModelTransformation",void 0);b.__decorate([l.parameter({constValue:!0})],w.prototype,"useFillLights",void 0);b.__decorate([l.parameter({constValue:!1})],w.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=
w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(q,v){const {vertex:p,fragment:t}=q;p.include(d.RgbaFloatEncoding);p.uniforms.add(new n.Texture2DDrawUniform("componentColorTex",r=>r.componentParameters.texture.texture));q.attributes.add(l.VertexAttribute.COMPONENTINDEX,"float");q.varyings.add("vExternalColorMixMode","mediump float");q.varyings.add("vExternalColor","vec4");(v=v.output===m.ShaderOutput.ObjectAndLayerIdColor)&&q.varyings.add("vObjectAndLayerIdColor","vec4");q.include(k.DecodeSymbolColor);
p.constants.add("elevationScale","float",2*w);p.constants.add("stride","float",c("enable-feature:objectAndLayerId-rendering")?3:2);p.code.add(e.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);p.code.add(e.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${v?e.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:e.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);t.code.add(e.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${v?e.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function x(q){const {vertex:v,fragment:p}=q;v.uniforms.add(new f.Float4DrawUniform("externalColor",t=>t.componentParameters.externalColor));p.uniforms.add(new g.IntegerDrawUniform("externalColorMixMode",t=>t.componentParameters.externalColorMixMode));q.varyings.add("vExternalColor","vec4");v.code.add(e.glsl`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);p.code.add(e.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}a.ComponentDataType=void 0;(function(q){q[q.Uniform=0]="Uniform";q[q.Varying=1]="Varying";q[q.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const w=2**32/1E4;a.ComponentData=function(q,v){switch(v.componentData){case a.ComponentDataType.Varying:return u(q,v);case a.ComponentDataType.Uniform:return x(q);case a.ComponentDataType.COUNT:break;default:b.neverReached(v.componentData)}};a.encodeElevationOffset=function(q,v){h.packFloatRGBA(q/w*.5+.5,v)};a.maxElevationOffset=w;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,h){class c extends b.Uniform{constructor(k,m){super(k,"int",h.BindType.Draw,(d,f,g)=>d.setUniform1i(k,m(f,g)))}}a.IntegerDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../../../../core/compilerUtils","../../../../core/shaderModules/interfaces"],function(a,b,h){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,k){c=c.vertex;c.code.add(h.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(k.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(h.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:c.code.add(h.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:c.code.add(h.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.COUNT:break;default:b.neverReached(k.vertexDiscardMode)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(h){h[h.Earth=1]="Earth";h[h.Mars=2]="Mars";h[h.Moon=3]="Moon";h[h.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(h){return h&&b.isMars(h)?a.EllipsoidMode.Mars:h&&b.isMoon(h)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I){function M(N){const V=new J.ShaderBuilder;V.include(x.VertexPosition,N);V.include(u.VertexNormal,N);V.include(l.VertexColor,N);V.include(n.TextureCoordinateAttribute,N);V.include(d.ForwardLinearDepth,N);V.include(k.ComponentData,N);V.include(L.DiscardOrAdjustAlphaDraw,N);V.include(g.SlicePass,N);V.include(B.ReadBaseColorTexture,N);V.include(m.VertexDiscardByOpacity,N);const {vertex:Q,fragment:T}=V;if(N.pbrMode===A.PBRMode.Normal||
N.pbrMode===A.PBRMode.Schematic)V.include(A.PhysicallyBasedRenderingParameters,N),N.hasNormalTexture&&V.include(t.ComputeNormalTexture,N);const ia=N.output===f.ShaderOutput.Shadow||N.output===f.ShaderOutput.ShadowHighlight||N.output===f.ShaderOutput.ShadowExcludeHighlight;ia&&N.componentData===k.ComponentDataType.Varying?Q.code.add(z.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):Q.code.add(z.glsl`#define discardShadows(castShadows) {}`);
const O=N.integratedMeshMode===c.IntegratedMeshMode.ColorOverlay||N.integratedMeshMode===c.IntegratedMeshMode.ColorOverlayWithWater,U=O&&N.output===f.ShaderOutput.Color&&N.pbrMode===A.PBRMode.WaterOnIntegratedMesh;O&&(V.include(y.EvaluateSceneLighting,N),V.include(G.OverlayIM,N),N.spherical?Q.code.add(z.glsl`
      const float invEllipsoidRadius = ${z.glsl.float(1/(N.ellipsoidMode===C.EllipsoidMode.Earth?b.earth.radius:N.ellipsoidMode===C.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):Q.code.add(z.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));U&&(V.varyings.add("tbnTangent","vec3"),V.varyings.add("tbnBiTangent","vec3"),V.varyings.add("groundNormal","vec3"));Q.code.add(z.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${N.output===f.ShaderOutput.ObjectAndLayerIdColor?z.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${z.glsl.float(H.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${N.output===f.ShaderOutput.ObjectAndLayerIdColor?z.glsl`forwardObjectAndLayerIdColor();`:""}
      ${U?N.spherical?z.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:z.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${O?z.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);N.output===f.ShaderOutput.Alpha&&(T.include(v.ReadLinearDepth),V.include(E.multipassTerrainTest,N),V.include(p.ComputeMaterialColor,N),O&&T.uniforms.add(new K.Texture2DPassUniform("ovColorTex",(P,R)=>G.getIMColorTexture(P,R))),T.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${N.multipassEnabled?z.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${O?z.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));N.output===f.ShaderOutput.Color&&(T.include(v.ReadLinearDepth),V.include(E.multipassTerrainTest,N),V.include(p.ComputeMaterialColor,N),V.include(r.ComputeShadingNormal,N),V.include(y.EvaluateSceneLighting,N),N.receiveShadows?(V.include(F.ReadShadowMapPass,N),T.code.add(z.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):T.code.add(z.glsl`float evaluateShadow() { return 0.0; }`),O&&T.uniforms.add(new K.Texture2DPassUniform("ovColorTex",(P,R)=>G.getIMColorTexture(P,R))),T.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${N.multipassEnabled?z.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${O?z.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),N.pbrMode===A.PBRMode.Normal||N.pbrMode===A.PBRMode.Schematic||N.pbrMode===A.PBRMode.Simplified?(D.addMainLightIntensity(T),T.code.add(z.glsl`
        ${N.pbrMode===A.PBRMode.Normal?z.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),N.hasNormalTexture?T.code.add(z.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):T.code.add(z.glsl`vec3 shadingNormal = normalVertex;`),T.code.add(z.glsl`${N.spherical?z.glsl`vec3 normalGround = normalize(positionWorld());`:z.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),T.code.add(z.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        ${N.pbrMode===A.PBRMode.Simplified?z.glsl` float ssao = 1.0 - evaluateAmbientOcclusionInverse();`:z.glsl` float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();`}
        ${N.snowCover?z.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${O?z.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${N.pbrMode===A.PBRMode.Simplified?z.glsl` vec4 shadedColor = vec4(evaluatePBRSimplifiedLighting(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround), materialColor.a);`:"vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);"}
        `)):(N.receiveShadows?T.code.add(z.glsl`float shadow = evaluateShadow();`):N.spherical?(y.addLightingGlobalFactor(T),T.code.add(z.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):T.code.add(z.glsl`float shadow = 0.0;`),U&&T.uniforms.add(new K.Texture2DPassUniform("ovNormalTex",(P,R)=>R.overlay?.getTexture(h.OverlayContent.WaterNormal))),N.snowCover&&T.code.add(z.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),T.code.add(z.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${O?z.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${U?z.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),T.code.add(z.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${N.transparencyPassType===I.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(N.output===f.ShaderOutput.LinearDepth||ia)V.include(w.OutputDepth,N),T.code.add(z.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);N.output===f.ShaderOutput.Normal&&(V.include(r.ComputeShadingNormal,N),T.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${N.normalType===e.NormalType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));N.output===f.ShaderOutput.ObjectAndLayerIdColor&&V.fragment.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${O?z.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);N.output===f.ShaderOutput.Highlight&&(V.include(q.OutputHighlight),T.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${O?z.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return V}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=S;a.build=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(a,b,h,c,k,m){a.ComputeMaterialColor=function(d,
f){d.include(b.VertexColor,f);d.fragment.include(h.MixExternalColor);d=d.fragment;d.uniforms.add(new c.Float4DrawUniform("baseColor",g=>g.baseColor));d.uniforms.add(new k.FloatDrawUniform("objectOpacity",g=>g.objectOpacity));f.hasVertexColors?d.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):d.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);d.code.add(m.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,h,c,k,m,d){a.ComputeShadingNormal=function(f,g){const e=f.fragment;switch(g.doubleSidedMode){case m.NormalsDoubleSidedMode.None:e.code.add(d.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case m.NormalsDoubleSidedMode.View:f.include(k.VertexPosition,g);e.code.add(d.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case m.NormalsDoubleSidedMode.WindingOrder:e.code.add(d.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(g.doubleSidedMode);case m.NormalsDoubleSidedMode.COUNT:}switch(g.normalType){case h.NormalType.Attribute:case h.NormalType.Compressed:f.include(c.VertexNormal,g);e.code.add(d.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case h.NormalType.ScreenDerivative:f.include(k.VertexPosition,g);e.code.add(d.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case h.NormalType.Ground:g.spherical?(f.include(k.VertexPosition,g),e.code.add(d.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):e.code.add(d.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);e.code.add(d.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(g.normalType);case h.NormalType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(a,
b,h,c,k,m,d,f){a.ReadBaseColorTexture=function(g,e){const n=g.fragment;!e.hasColorTexture||e.output!==b.ShaderOutput.Color&&e.alphaDiscardMode===f.AlphaDiscardMode.Opaque?n.code.add(m.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(g.include(c.VertexTextureCoordinates,e),e=e.textureCoordinateType===h.TextureCoordinateAttributeType.Atlas,n.uniforms.add(new d.Texture2DDrawUniform("baseColorTexture",l=>l.texture)),e?(g.include(k.TextureAtlasLookup),n.code.add(m.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):n.code.add(m.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class h extends b.NoParameters{constructor(){super(...arguments);this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1;if(null!=this._parameterBlocks)for(const k of this._parameterBlocks)this[k]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==
this._parameterBlocks)return!1;for(const k of this._parameterBlocks)if(this[k].dirty)return!0;return!1}}class c{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}a.MaterialBase=h;a.MaterialParameterBlock=c;a.parameter=function(k={}){return(m,d)=>{const f=m._parameterCount??0;m._parameterCount=f+1;if(k.vectorOps){const g=k.vectorOps;Object.defineProperty(m,d,{get(){return this[f]},set(e){const n=this[f];if(null==n)this[f]=e;else{if(g.equals(n,
e))return;g.copy(n,e)}this._setDirty()}})}else Object.defineProperty(m,d,{get(){return this[f]},set(g){this[f]!==g&&(k.dispose&&this[f]&&this[f].dispose(),this[f]=g,this._setDirty())}})}};a.parameterBlock=function(){return(k,m)=>{const d=k._parameterCount??0;k._parameterCount=d+1;k._parameterBlocks=k._parameterBlocks||[];k._parameterBlocks.push(d);Object.defineProperty(k,m,{get(){return this[d]},set(f){this[d]!==f&&(this[d]=f,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,h,c){class k{constructor(d){this._low=c.create();this._high=c.create();d&&this.set(d)}get low(){return this._low}get high(){return this._high}set(d){b.copy(this._low,b.copy(m,d));d=b.sub(m,d,this._low);b.copy(this._high,d)}get(d){return b.add(d,this._low,this._high)}getLowScaled(d){return b.scale(d,
this._low,1)}}const m=h.create();a.TwoVectorPosition=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,h,c){const k=h.newLayout().vec3f(c.VertexAttribute.POSITION).u16(c.VertexAttribute.COMPONENTINDEX),m=h.newLayout().vec2u8(c.VertexAttribute.SIDENESS);b=b.glLayout(m);const d=h.newLayout().vec3f(c.VertexAttribute.POSITION0).vec3f(c.VertexAttribute.POSITION1).vec2i16(c.VertexAttribute.NORMALCOMPRESSED).u16(c.VertexAttribute.COMPONENTINDEX).u8(c.VertexAttribute.VARIANTOFFSET,
{glNormalized:!0}).u8(c.VertexAttribute.VARIANTSTROKE).u8(c.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});h=h.newLayout().vec3f(c.VertexAttribute.POSITION0).vec3f(c.VertexAttribute.POSITION1).vec2i16(c.VertexAttribute.NORMALCOMPRESSED).vec2i16(c.VertexAttribute.NORMAL2COMPRESSED).u16(c.VertexAttribute.COMPONENTINDEX).u8(c.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(c.VertexAttribute.VARIANTSTROKE).u8(c.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});c=new Map([[c.VertexAttribute.POSITION0,
0],[c.VertexAttribute.POSITION1,1],[c.VertexAttribute.COMPONENTINDEX,2],[c.VertexAttribute.VARIANTOFFSET,3],[c.VertexAttribute.VARIANTSTROKE,4],[c.VertexAttribute.VARIANTEXTENSION,5],[c.VertexAttribute.NORMALCOMPRESSED,6],[c.VertexAttribute.NORMAL2COMPRESSED,7],[c.VertexAttribute.SIDENESS,8]]);a.EdgeInputBufferLayout=k;a.EdgeShaderAttributeLocations=c;a.RegularEdgeInstancesLayout=d;a.SilhouetteEdgeInstancesLayout=h;a.VertexLayout=m;a.glVertexLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(a,b,h,c,k,m,d,f){function g(u,x,w,q){if(x)return x=h.computeNeighbors(w,q,u.count),new e(w,q,x,u);u=b.deduplicate(u.buffer,u.stride/4,{originalIndices:w,originalIndicesLength:q});q=h.computeNeighbors(u.indices,
q,u.uniqueCount);return{faces:u.indices,facesLength:u.indices.length,neighbors:q,vertices:m.EdgeInputBufferLayout.createView(u.buffer)}}class e{constructor(u,x,w,q){this.faces=u;this.facesLength=x;this.neighbors=w;this.vertices=q}}const n=new d.RegularEdgeBufferWriter,l=new d.SilhouetteEdgeBufferWriter;d=c.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1);c=c.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1).u16(k.VertexAttribute.COMPONENTINDEX);
a.extract=function(u){const x=g(u.data,u.skipDeduplicate,u.indices,u.indicesLength);n.updateSettings(u.writerSettings);l.updateSettings(u.writerSettings);return f.extractEdges(x,n,l)};a.extractComponentsEdgeLocationsLayout=c;a.extractEdgeInformation=g;a.extractEdgeLocationsLayout=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,h,c){h/=3;const k=new Uint32Array(c+1),m=new Uint32Array(c+
1);var d=(q,v)=>{q<v?k[q+1]++:m[v+1]++};for(var f=0;f<h;f++){var g=b[3*f],e=b[3*f+1],n=b[3*f+2];d(g,e);d(e,n);d(n,g)}f=d=0;for(g=0;g<c;g++)e=k[g+1],n=m[g+1],k[g+1]=d,m[g+1]=f,d+=e,f+=n;const l=new Uint32Array(6*h),u=k[c];d=(q,v,p)=>{q<v?(q=k[q+1]++,l[2*q]=v,l[2*q+1]=p):(v=m[v+1]++,l[2*u+2*v]=q,l[2*u+2*v+1]=p)};for(f=0;f<h;f++)g=b[3*f],e=b[3*f+1],n=b[3*f+2],d(g,e,f),d(e,n,f),d(n,g,f);d=(q,v)=>{const p=2*q;q=v-q;for(v=1;v<q;v++){const t=l[p+2*v],r=l[p+2*v+1];let y=v-1;for(y;0<=y&&l[p+2*y]>t;y--)l[p+
2*y+2]=l[p+2*y],l[p+2*y+3]=l[p+2*y+1];l[p+2*y+2]=t;l[p+2*y+3]=r}};for(f=0;f<c;f++)d(k[f],k[f+1]),d(u+m[f],u+m[f+1]);const x=new Int32Array(3*h),w=(q,v)=>q===b[3*v]?0:q===b[3*v+1]?1:q===b[3*v+2]?2:-1;h=(q,v)=>{q=w(q,v);x[3*v+q]=-1};d=(q,v,p,t)=>{q=w(q,v);x[3*v+q]=t;p=w(p,t);x[3*t+p]=v};for(f=0;f<c;f++){g=k[f];e=k[f+1];n=m[f];const q=m[f+1];for(;g<e&&n<q;){const v=l[2*g],p=l[2*u+2*n];v===p?(d(f,l[2*g+1],p,l[2*u+2*n+1]),g++,n++):v<p?(h(f,l[2*g+1]),g++):(h(p,l[2*u+2*n+1]),n++)}for(;g<e;)h(f,l[2*g+1]),
g++;for(;n<q;)h(l[2*u+2*n],l[2*u+2*n+1]),n++}return x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../support/buffer/glUtil ../Normals ./bufferLayouts".split(" "),function(a,b,h,c,k,m,d){function f(t){const r=l;r[0]=t.position0[0];r[1]=t.position0[1];r[2]=t.position0[2];
r[3]=t.position1[0];r[4]=t.position1[1];r[5]=t.position1[2];x[0]=5381;for(t=0;t<u.length;t++)x[0]=31*x[0]+u[t];return x[0]}function g(t){const r=l;r[0]=e(t.position0[0]);r[1]=e(t.position0[1]);r[2]=e(t.position0[2]);r[3]=e(t.position1[0]);r[4]=e(t.position1[1]);r[5]=e(t.position1[2]);x[0]=5381;for(t=0;t<u.length;t++)x[0]=31*x[0]+u[t];return x[0]}function e(t){return Math.round(1E4*t)/1E4}class n{updateSettings(t){this.settings=t;this._edgeHashFunction=t.reducedPrecision?g:f}write(t,r,y){var D=this._edgeHashFunction(y);
p.seed=D;D=p.getIntRange(0,255);const E=p.getIntRange(0,this.settings.variants-1);var A=p.getFloat();A=-(1-Math.min(A/.7,1))+Math.max(0,A-.7)/(1-.7);A=255*(Math.abs(A)**1.2*(0>A?-1:1)*.5+.5);t.position0.setVec(r,y.position0);t.position1.setVec(r,y.position1);t.componentIndex.set(r,y.componentIndex);t.variantOffset.set(r,D);t.variantStroke.set(r,E);t.variantExtension.set(r,A)}trim(t,r){return t.slice(0,r)}}const l=new Float32Array(6),u=new Uint32Array(l.buffer),x=new Uint32Array(1);class w{constructor(){this._commonWriter=
new n}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return d.RegularEdgeInstancesLayout.createBuffer(t)}write(t,r,y){this._commonWriter.write(t,r,y);h.add(v,y.faceNormal0,y.faceNormal1);h.normalize(v,v);const {typedBuffer:D,typedBufferStride:E}=t.normalCompressed;m.compressNormal(D,r,v[0],v[1],v[2],E)}trim(t,r){return this._commonWriter.trim(t,r)}}w.Layout=d.RegularEdgeInstancesLayout;w.glLayout=k.glLayout(d.RegularEdgeInstancesLayout,1);class q{constructor(){this._commonWriter=
new n}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return d.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,r,y){this._commonWriter.write(t,r,y);const {typedBuffer:D,typedBufferStride:E}=t.normalCompressed;m.compressNormal(D,r,y.faceNormal0[0],y.faceNormal0[1],y.faceNormal0[2],E);const {typedBuffer:A,typedBufferStride:B}=t.normal2Compressed;m.compressNormal(A,r,y.faceNormal1[0],y.faceNormal1[1],y.faceNormal1[2],B)}trim(t,r){return this._commonWriter.trim(t,r)}}q.Layout=
d.SilhouetteEdgeInstancesLayout;q.glLayout=k.glLayout(d.SilhouetteEdgeInstancesLayout,1);const v=c.create(),p=new b;a.CommonBufferWriter=n;a.RegularEdgeBufferWriter=w;a.SilhouetteEdgeBufferWriter=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b,h,c,k){function m(l,u){const x=h.acosClamped(l.cosAngle),w=g.fwd,q=g.ortho;c.direction(w,l.position1,l.position0);l=0<c.dot(c.cross(q,l.faceNormal0,l.faceNormal1),w)?-1:1;return x*l>u}function d(l){const u=l.faces.length/3,x=l.faces;l=l.neighbors;var w=0;for(var q=0;q<u;q++){var v=l[3*q+1],p=l[3*q+2],t=x[3*q],r=x[3*q+1],y=x[3*q+2];w+=-1===l[3*q]||t<r?1:0;w+=-1===v||r<y?1:0;w+=-1===p||y<t?1:0}w=new Int32Array(4*w);q=0;for(v=0;v<u;v++){p=l[3*v];t=l[3*v+1];r=l[3*v+2];y=x[3*v];const D=x[3*
v+1],E=x[3*v+2];if(-1===p||y<D)w[q++]=y,w[q++]=D,w[q++]=v,w[q++]=p;if(-1===t||D<E)w[q++]=D,w[q++]=E,w[q++]=v,w[q++]=t;if(-1===r||E<y)w[q++]=E,w[q++]=y,w[q++]=v,w[q++]=r}return w}function f(l){const u=l.faces.length/3,x=l.vertices.position;l=l.faces;const w=e.v0,q=e.v1,v=e.v2,p=new Float32Array(3*u);for(let t=0;t<u;t++){const r=l[3*t+1],y=l[3*t+2];x.getVec(l[3*t],w);x.getVec(r,q);x.getVec(y,v);c.subtract(q,q,w);c.subtract(v,v,w);c.cross(w,q,v);c.normalize(w,w);p[3*t]=w[0];p[3*t+1]=w[1];p[3*t+2]=w[2]}return p}
a.EdgeType=void 0;(function(l){l[l.SOLID=0]="SOLID";l[l.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const g={edge:{position0:k.create(),position1:k.create(),faceNormal0:k.create(),faceNormal1:k.create(),componentIndex:0,cosAngle:0},ortho:k.create(),fwd:k.create()},e={v0:k.create(),v1:k.create(),v2:k.create()},n={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(l,u,x,w=n){const q=l.vertices.position;var v=l.vertices.componentIndex,p=h.deg2rad(w.anglePlanar);w=h.deg2rad(w.angleSignificantEdge);
const t=Math.cos(w),r=Math.cos(p),y=g.edge,D=y.position0,E=y.position1,A=y.faceNormal0,B=y.faceNormal1,F=f(l),G=d(l),H=G.length/4;l=u.allocate(H);w=0;const L=x.allocate(H);let C=0,z=0,J=0;const K=b.range(0,H),I=new Float32Array(H);I.forEach((V,Q,T)=>{q.getVec(G[4*Q],D);q.getVec(G[4*Q+1],E);T[Q]=c.distance(D,E)});K.sort((V,Q)=>I[Q]-I[V]);const M=[],S=[];for(let V=0;V<H;V++){var N=K[V];const Q=I[N],T=G[4*N],ia=G[4*N+1],O=G[4*N+2];N=G[4*N+3];const U=-1===N;q.getVec(T,D);q.getVec(ia,E);if(U)c.set(A,F[3*
O],F[3*O+1],F[3*O+2]),c.copy(B,A),y.componentIndex=v.get(T),y.cosAngle=c.dot(A,B);else{c.set(A,F[3*O],F[3*O+1],F[3*O+2]);c.set(B,F[3*N],F[3*N+1],F[3*N+2]);y.componentIndex=v.get(T);y.cosAngle=c.dot(A,B);if(y.cosAngle>r)continue;-.9999>y.cosAngle&&c.copy(B,A)}z+=Q;J++;U||y.cosAngle<t?(u.write(l,w++,y),M.push(Q)):m(y,p)&&(x.write(L,C++,y),S.push(Q))}v=new Float32Array(M.reverse());p=new Float32Array(S.reverse());return{regular:{instancesData:u.trim(l,w),lodInfo:{lengths:v}},silhouette:{instancesData:x.trim(L,
C),lodInfo:{lengths:p}},averageEdgeLength:z/J}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){class h{constructor(c,k=1){this._rctx=c;this._fieldCount=k;this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(c=>0===c.activeCount?(c.dispose(),!1):!0)}destroy(){this._buffers.forEach(c=>c.dispose());this._buffers=[]}getBuffer(c){for(const k of this._buffers)if(k.availableCount>=
c)return k;if(c>b.maxIndexCount)return null;c=new b.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(c);return c}updateTextures(){for(const c of this._buffers)c.textureBuffer.updateTexture()}}a.BufferManager=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,h){class c{constructor(k,m=1){this.textureBuffer=
new h.TextureBackedBuffer(k,m);this._indexManager=new b.SimpleIndexManager(65536)}dispose(){this.textureBuffer.dispose();this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const k=this._indexManager.acquire();this.textureBuffer.resizeToFit(k);return k}releaseIndex(k){this._indexManager.release(k)}}a.ManagedTextureBackedBuffer=c;a.maxIndexCount=65536;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports"],function(a){class b{constructor(h){this._maxCount=h;this._nextIndex=0;this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++}release(h){this._recycledIndices.push(h)}}
a.SimpleIndexManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(a,b,h,c,k){class m{constructor(d,f=1){this._rctx=d;this._fieldCount=f;this.textureWidth=4096;this._dirty=!0;d=new k.TextureDescriptor(this.textureWidth,1);d.samplingMode=
h.TextureSamplingMode.NEAREST;d.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;this._texture=new c.Texture(this._rctx,d);this._data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose();this._data=this._texture=void 0}setData(d,f,g,e,n,l){d=d*this._fieldCount+f;this._dirty=!0;this._data.set(d,0,g);this._data.set(d,1,e);this._data.set(d,2,n);this._data.set(d,3,l)}setDataElement(d,f,g,e){d=d*this._fieldCount+f;this._dirty=!0;this._data.set(d,g,e)}getDataElement(d,
f,g){d=d*this._fieldCount+f;this._dirty=!0;return this._data.get(d,g)}resizeToFit(d){d=(d+1)*this._fieldCount;d>this._data.count&&(d=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil(d/this.textureWidth)*this.textureWidth*4)),d.typedBuffer.set(this._data.typedBuffer),this._data=d)}updateTexture(){if(this._dirty){var d=this._texture.descriptor.width;this._data.count>d*this._texture.descriptor.height&&this._texture.resize(d,this._data.count/d);this._texture.setData(this._data.typedBuffer);this._dirty=
!1}}get texture(){return this._texture}}a.TextureBackedBuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique".split(" "),function(a,b,h,c,k,m,d){class f{constructor(g,
e){this._rctx=g;this._techniqueRepository=e;this._configuration=new h.CompositingTechniqueConfiguration;this._passParameters=new a.CompositingPassParameters;this._oitParameters=new m.OITCompositingPassParameters;this._hudParameters=new c.HUDCompositingPassParameters}compositeOIT(g,e,n,l){this._oitParameters.colorTexture=e;this._oitParameters.alphaTexture=n;this._oitParameters.frontFaceTexture=l;e=this._techniqueRepository.acquire(d.OITCompositingTechnique);this._rctx.bindTechnique(e,g,this._oitParameters);
this._rctx.screen.draw();e.release()}compositeHUD(g,e){this._hudParameters.texture=e;e=this._techniqueRepository.acquire(k.HUDCompositingTechnique);this._rctx.bindTechnique(e,g,this._hudParameters);this._rctx.screen.draw();e.release()}composite(g,e,n=h.AlphaMode.None,l=1){this._configuration.alphaMode=n;this._configuration.hasOpacityFactor=1!==l;this._passParameters.texture=e;this._passParameters.opacity=l;e=this._techniqueRepository.acquire(b.CompositingTechnique,this._configuration);this._rctx.bindTechnique(e,
g,this._passParameters);this._rctx.screen.draw();e.release()}}return f})},"esri/chunks/Compositing.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m){function d(e){const n=new k.ShaderBuilder;
n.include(b.ScreenSpacePass);n.fragment.uniforms.add(new m.Texture2DPassUniform("tex",l=>l.texture));e.hasOpacityFactor&&n.fragment.uniforms.add(new h.FloatPassUniform("opacity",l=>l.opacity));n.fragment.code.add(c.glsl`
    void main() {
      fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`);return n}class f extends c.NoParameters{constructor(){super(...arguments);this.opacity=1}}const g=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.Compositing=g;a.CompositingPassParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends c.ShaderTechnique{initializeProgram(l){return new m.Program(l.rctx,n.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){switch(this.configuration.alphaMode){case f.AlphaMode.None:return e.makePipelineState({colorWrite:e.defaultColorWriteParams});case f.AlphaMode.Alpha:return e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),
colorWrite:e.defaultColorWriteParams});case f.AlphaMode.PremultipliedAlpha:case f.AlphaMode.COUNT:return e.makePipelineState({blending:e.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})}}}n.shader=new h.ReloadableShaderModule(d.Compositing,()=>new Promise((l,u)=>a(["./Compositing.glsl"],l,u)));b.CompositingTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){a.AlphaMode=void 0;(function(k){k[k.None=0]="None";k[k.Alpha=1]="Alpha";k[k.PremultipliedAlpha=2]="PremultipliedAlpha";k[k.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.alphaMode=a.AlphaMode.None;this.hasOpacityFactor=!1}}b.__decorate([h.parameter({count:a.AlphaMode.COUNT})],c.prototype,"alphaMode",void 0);
b.__decorate([h.parameter()],c.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,h,c,
k){function m(){const g=new c.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new k.Texture2DPassUniform("tex",e=>e.texture));g.fragment.code.add(h.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return g}class d extends h.NoParameters{}const f=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:d,build:m},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=f;a.HUDCompositingPassParameters=d;a.build=m})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}g.shader=new h.ReloadableShaderModule(d.HUDCompositing,()=>new Promise((e,n)=>a(["./HUDCompositing.glsl"],e,n)));b.HUDCompositingTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,h,c,k){function m(){const g=new c.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",e=>e.colorTexture),new k.Texture2DPassUniform("alphaTexture",e=>e.alphaTexture),new k.Texture2DPassUniform("frontFaceTexture",e=>e.frontFaceTexture));g.fragment.code.add(h.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return g}class d extends h.NoParameters{}const f=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:d,build:m},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=f;a.OITCompositingPassParameters=d;a.build=m})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends c.ShaderTechnique{initializeProgram(n){return new m.Program(n.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams})}}e.shader=new h.ReloadableShaderModule(d.OITCompositing,()=>new Promise((n,l)=>a(["./OITCompositing.glsl"],n,l)));b.OITCompositingTechnique=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../core/floatRGBA ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(z,J){if(J.visible){var K=l.empty(),I=J.getSpatialQueryAccelerator();I?q(K,z,I):v(K,z,J.objects);return K}}function q(z,J,K){var I=J.eye;const M=J.viewForward,S=J.frustum,N=Q=>Q.visible;var V=K.objectCount;500>V?(l.set(G,J.near,Math.min(z.near,J.far)),K.forEachInDepthRange(I,M,u.DepthOrder.FRONT_TO_BACK,G,(Q,T)=>{p(z,J,Q);G.far=z.near;T.setRange(G)},S,N),l.set(G,Math.max(z.far,J.near),J.far),K.forEachInDepthRange(I,M,u.DepthOrder.BACK_TO_FRONT,G,(Q,
T)=>{p(z,J,Q);G.near=z.far;T.setRange(G)},S,N)):(V=Math.max(Math.min(V,500),Math.ceil(.1*V)),I=K.findClosest(M,u.DepthOrder.FRONT_TO_BACK,S,N,V),K=K.findClosest(M,u.DepthOrder.BACK_TO_FRONT,S,N,V),I&&K&&(r(z,J,I.boundingVolumeWorldSpace.bounds),r(z,J,K.boundingVolumeWorldSpace.bounds)))}function v(z,J,K){H.clear();K.forAll(I=>{I.visible&&0!==I.geometries.length&&H.add(I)});H.empty||(H.sort(J),l.set(G,J.near,Math.min(z.near,J.far)),H.forEachInDepthRange(G,u.DepthOrder.FRONT_TO_BACK,(I,M)=>{M<z.near&&
p(z,J,I)}),l.set(G,Math.max(z.far,J.near),J.far),H.forEachInDepthRange(G,u.DepthOrder.BACK_TO_FRONT,(I,M,S)=>{z.far=Math.max(z.far,S)}))}function p(z,J,K){if(K.visible&&g.intersectsSphere(J.frustum,K.boundingVolumeWorldSpace.bounds)){var I=K.transformation,M=F;K.geometries.forEach(S=>{c.multiply(M,I,S.transformation);const N=n.maxScale(M);t(z,J,S.boundingInfo,M,N)})}}function t(z,J,K,I,M){if(null!=K){m.transformMat4(e.getCenter(B),K.center,I);var {eye:S,viewForward:N}=J,V=N[0]*(B[0]-S[0])+N[1]*(B[1]-
S[1])+N[2]*(B[2]-S[2]);B[3]=K.radius*M;if(!(V-B[3]>z.near&&V+B[3]<z.far)&&g.intersectsSphere(J.frustum,B))if(100<K.radius&&K.getChildren())for(const Q of K.getChildren())t(z,J,Q,I,M);else C.unionDepthRangeWithAABB(z,J.viewProjectionMatrix,I,K.bbMin,K.bbMax)}}function r(z,J,K){var I=J.eye;J=J.viewForward;I=(K[0]-I[0])*J[0]+(K[1]-I[1])*J[1]+(K[2]-I[2])*J[2];z.near=Math.min(z.near,I-K[3]);z.far=Math.max(z.far,I+K[3])}class y{constructor(){this._items=new h({allocator:z=>z||{object:null,distance:0,near:0,
far:0},deallocator:z=>{z.object=null;z.distance=0;z.near=0;z.far=0;return z}})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(z){this._items.pushNew().object=z}sort(z){const J=z.eye,K=z.viewForward;this._items.forAll(I=>{const M=I.object.boundingVolumeWorldSpace.bounds,S=(M[0]-J[0])*K[0]+(M[1]-J[1])*K[1]+(M[2]-J[2])*K[2];I.distance=S;I.near=S-M[3];I.far=S+M[3]});this._items.sort((I,M)=>I.distance-M.distance)}forEachInDepthRange(z,J,
K){if(J===u.DepthOrder.FRONT_TO_BACK)for(J=0;J<this._items.length;++J){var I=this._items.data[J];I.far<z.near||I.near>z.far||K(I.object,I.near,I.far)}else for(J=this._items.length-1;0<=J;--J)I=this._items.data[J],I.far<z.near||I.near>z.far||K(I.object,I.near,I.far)}}class D{constructor(){this._view=k.create();this._viewProj=k.create();this._frustum=g.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}compute(z,J){this._reset();
c.copy(this._view,z.viewMatrix);c.multiply(this._viewProj,z.projectionMatrix,this._view);g.copy(this._frustum,z.frustum);z=this._view;const K=z[2],I=z[6],M=z[10],S=z[14];J.forAll(Q=>{Q.materialReference&&Q.forEachGeometry&&Q.forEachGeometry(T=>{if(T.visible&&T.castShadow){var ia=T.boundingSphere,O=K*ia[0]+I*ia[1]+M*ia[2]+S,U=O-ia[3];ia=O+ia[3];this._geometries.push(T);this._near.push(-ia);this._far.push(-U)}})});J=new l.DepthRange;if(0===this._geometries.length)return J;for(z=0;z<this._geometries.length;++z)this._near[z]>
J.far&&(J.far=this._near[z]),2<this._near[z]&&this._far[z]<J.near&&(J.near=this._far[z]);z=this._looseRange;z.near=Math.max(.5*J.near,2);z.far=2*J.far;var N=0;let V=0;for(let Q=0;Q<this._geometries.length;++Q)this._near[Q]<J.near&&(this._near[Q]>=z.near?J.near=this._near[Q]:this._nearCandidates[N++]=Q),this._far[Q]>J.far&&(this._far[Q]<=z.far?J.far=this._far[Q]:this._farCandidates[V++]=Q);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return J;this._nearCandidates.sort((Q,T)=>
this._near[Q]<this._near[T]?-1:this._near[Q]>this._near[T]?1:0);this._farCandidates.sort((Q,T)=>this._far[Q]<this._far[T]?1:this._far[Q]>this._far[T]?-1:0);for(z=0;z<this._nearCandidates.length;++z)N=this._nearCandidates[z],this._near[N]<J.near&&(N=this._geometries[N],this._includeNearBoundingInfoRec(N.boundingInfo,N.shaderTransformation,J));for(z=0;z<this._farCandidates.length;++z)N=this._farCandidates[z],this._far[N]>J.far&&(N=this._geometries[N],this._includeFarBoundingInfoRec(N.boundingInfo,N.shaderTransformation,
J));this._reset();return J}_reset(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0}_includeNearBoundingInfoRec(z,J,K){if(null!=z){var I=z.center;m.transformMat4(e.getCenter(B),I,J);I=n.maxScale(J);var M=B[0],S=B[1],N=B[2];I*=z.radius;var V=this._frustum;if(!(V[0][0]*M+V[0][1]*S+V[0][2]*N+V[0][3]>I||V[1][0]*M+V[1][1]*S+V[1][2]*N+V[1][3]>I||V[2][0]*M+V[2][1]*S+V[2][2]*N+V[2][3]>I||V[3][0]*M+V[3][1]*S+V[3][2]*N+V[3][3]>I||(M=
this._view[2]*M+this._view[6]*S+this._view[10]*N+this._view[14],S=M+I,2>-(M-I)||-S>=K.near)))if(-S>this._looseRange.near)K.near=-S;else{if(100<I&&(I=z.getChildren(),void 0!==I)){for(const Q of I)this._includeNearBoundingInfoRec(Q,J,K);return}C.unionDepthRangeWithAABB(K,this._viewProj,J,z.bbMin,z.bbMax)}}}_includeFarBoundingInfoRec(z,J,K){if(null!=z){var I=z.radius,M=z.center;m.transformMat4(e.getCenter(B),M,J);var S=n.maxScale(J);M=B[0];var N=B[1],V=B[2];I*=S;S=this._frustum;if(!(S[0][0]*M+S[0][1]*
N+S[0][2]*V+S[0][3]>I||S[1][0]*M+S[1][1]*N+S[1][2]*V+S[1][3]>I||S[2][0]*M+S[2][1]*N+S[2][2]*V+S[2][3]>I||S[3][0]*M+S[3][1]*N+S[3][2]*V+S[3][3]>I||(M=this._view[2]*M+this._view[6]*N+this._view[10]*V+this._view[14]-I,-M<=K.far)))if(-M<this._looseRange.far)K.far=-M;else{if(100<I&&(I=z.getChildren(),void 0!==I)){for(const Q of I)this._includeFarBoundingInfoRec(Q,J,K);return}C.unionDepthRangeWithAABB(K,this._viewProj,J,z.bbMin,z.bbMax)}}}}class E{constructor(){this._modelViewProj=k.create();this._clipPosition=
[f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]}unionDepthRangeWithAABB(z,J,K,I,M){var S=this._modelViewProj;c.multiply(S,J,K);J=!1;for(K=0;8>K;++K){const N=this._clipPosition[K],V=0===K||3===K||4===K||7===K?I[0]:M[0],Q=0===K||1===K||4===K||5===K?I[1]:M[1],T=4>K?I[2]:M[2];N[0]=S[0]*V+S[4]*Q+S[8]*T+S[12];N[1]=S[1]*V+S[5]*Q+S[9]*T+S[13];N[2]=S[2]*V+S[6]*Q+S[10]*T+S[14];N[3]=S[3]*V+S[7]*Q+S[11]*T+S[15]}for(I=0;12>I;++I){M=this._clipTriangle(this._clipPosition[A[I][0]],
this._clipPosition[A[I][1]],this._clipPosition[A[I][2]]);S=!0;for(K=0;K<M.length;++K)if(2<=M[K][3]){S=!1;break}if(!S)for(J=!0,S=0;S<M.length;++S)K=M[S][3],Number.isFinite(K)&&(z.near=Math.min(K,z.near),z.far=Math.max(K,z.far))}return J}_inside(z,J){if(0===J)return z[0]>=-z[3];if(1===J)return z[1]>=-z[3];if(2===J)return z[0]<=z[3];if(3===J)return z[1]<=z[3];x.assert(!1)}_intersect(z,J,K){let I=0;0===K?I=(-z[3]-z[0])/(J[0]-z[0]+J[3]-z[3]):1===K?I=(-z[3]-z[1])/(J[1]-z[1]+J[3]-z[3]):2===K?I=(z[3]-z[0])/
(J[0]-z[0]-J[3]+z[3]):3===K&&(I=(z[3]-z[1])/(J[1]-z[1]-J[3]+z[3]));return d.lerp(f.create(),z,J,I)}_clipTriangle(z,J,K){z=[z,J,K];for(J=0;4>J;++J){K=z;z=[];for(let I=0;I<K.length;++I){const M=K[I],S=K[(I+1)%K.length];this._inside(S,J)?(this._inside(M,J)||z.push(this._intersect(M,S,J)),z.push(S)):this._inside(M,J)&&z.push(this._intersect(M,S,J))}}return z}}const A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=e.create(),F=k.create(),G=l.empty(),
H=new y,L=new D,C=new E;a.DepthRangeFromRenderGeometries=D;a.depthRangeFromLayer=w;a.depthRangeFromScene=function(z,J,K){let I=0;if(!J.some(S=>{if(!S.materialReference)return!1;I+=S.numGeometries;return 1E4<=I}))return L.compute(z,J);const M=l.empty();K.forAll(S=>l.union(M,w(z,S)));return M};a.textureToDepth=function(z,J,K){return b.unpackFloatRGBA(J,z)*(K[1]-K[0])+K[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B){a.MagnifierHelper=class extends h{constructor(){super(...arguments);this._resources=this._imageLoadTask=this._imageSources=this._magnifier=null;this._passParameters=new r.MagnifierPassParameters;this.events=new k;this.attributeLocations=new Map([[t.VertexAttribute.POSITION,0]]);this._tmpScreenPoint=f.createScreenPointArray();this._tmpRenderPoint=f.createRenderScreenPointArray()}get updating(){return null==this._imageSources&&null!=this._imageLoadTask&&
!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(F){F!==this._magnifier&&(this.removeAllHandles(),this._magnifier=F,F=()=>{this._updateResourceLoading();this.events.emit("request-render")},null!=this._magnifier&&this.addHandles(d.watch(()=>this._magnifier?.version,F)),F())}get enabled(){return null!=this._validMagnifier}get _validMagnifier(){return null!=this._magnifier&&this._magnifier.visible&&null!=this._magnifier.position&&0<this._magnifier.size?this._magnifier:
null}get _factor(){return null!=this._magnifier?this._magnifier.factor||1:1}destroy(){this._magnifier=null;null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()}render(F,G){const H=this._validMagnifier;if(null!=H){var L=Math.ceil(G.camera.pixelRatio*H.size);this._updateResources(F,L);if(null!=this._resources){var C=this._passParameters.textures;L=Math.ceil(1/this._factor*L);C.input.resize(L,L);f.screenPointObjectToArray(H.position,this._tmpScreenPoint);
var z=G.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),J=G.camera.fullHeight,K=.5*L,I=.5*L;z[0]=m.clamp(z[0],K,G.camera.fullWidth-K-1);z[1]=m.clamp(z[1],I,J-I-1);J=Math.floor(z[0]-K);z=Math.floor(z[1]-I);I=this._resources.program;I.bindTexture("textureInput",C.input);F.gl.copyTexImage2D(C.input.descriptor.target,0,C.input.descriptor.pixelFormat,J,z,L,L,0);this._passParameters.magnifier=H;F.useProgram(I);I.bindPass(this._passParameters,G);F.bindVAO(this._resources.vao);F.setPipelineState(this._resources.pipelineState);
F.drawArrays(D.PrimitiveType.TRIANGLE_STRIP,0,4)}}}_updateResourceLoading(){const F=this._validMagnifier;if(null!=F){var G=F.maskUrl,H=F.overlayUrl;null==this._imageLoadTask||this._imageLoadTask.maskUrl===G&&this._imageLoadTask.overlayUrl===H||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);null==this._imageSources&&null==this._imageLoadTask&&(this._imageLoadTask={maskUrl:G,overlayUrl:H,task:c.createTask(async L=>{const C=null==G||null==H?y.loadMagnifierResources(L):
null,z=null!=G?w.requestImage(G,{signal:L}):C.then(J=>J.mask);L=null!=H?w.requestImage(H,{signal:L}):C.then(J=>J.overlay);this._imageSources={mask:await z,overlay:await L};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}}_updateResources(F,G){this.enabled?null!=this._resources?this._passParameters.textures.size!==G&&(F=this._createTextureResources(F,G),null==F?this._disposeResources():
(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=F)):(G=this._createTextureResources(F,G),null!=G&&(this._resources={program:this._createProgram(F),vao:v.createQuadVAO(F,q.Pos2,this.attributeLocations,0,1),pipelineState:E.makePipelineState({blending:E.simpleBlendingParams(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:E.defaultColorWriteParams})},this._passParameters.textures=G)):this._disposeResources()}_disposeResources(){null!=
this._resources&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(F){F.mask.dispose();F.overlay.dispose();F.input.dispose()}_createTextureResources(F,G){if(null==this._imageSources)return null;this._imageSources.overlay.width=G;this._imageSources.overlay.height=G;this._imageSources.mask.width=G;this._imageSources.mask.height=G;const H=new B.TextureDescriptor;H.internalFormat=
D.PixelFormat.RGBA;H.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE;H.flipped=!0;H.preMultiplyAlpha=!g.isSVG(this._imageSources.overlay.src)||!F.driverTest.svgPremultipliesAlpha.result;const L=new A.Texture(F,H,this._imageSources.overlay);H.pixelFormat=H.internalFormat=D.PixelFormat.ALPHA;H.preMultiplyAlpha=!1;const C=new A.Texture(F,H,this._imageSources.mask);H.pixelFormat=H.internalFormat=D.PixelFormat.RGBA;H.flipped=!1;return{input:new A.Texture(F,H),mask:C,overlay:L,size:G}}_createProgram(F){return new p.Program(F,
r.build(),this.attributeLocations)}};b.__decorate([e.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);b.__decorate([e.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([e.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=b.__decorate([x.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{}class l extends d.NoParameters{constructor(){super(...arguments);this.textures=new n}}const u=b.createScreenPointArray(),x=b.createRenderScreenPointArray(),w=c.create();a.MagnifierPassParameters=l;a.TextureResources=n;a.build=function(){const q=new f.ShaderBuilder;q.attributes.add(e.VertexAttribute.POSITION,"vec2");q.vertex.uniforms.add(new m.Float4PassUniform("drawPosition",(v,p)=>{var t=p.camera.pixelRatio;const r=v.magnifier.offset.x*t,y=v.magnifier.offset.y*
t;b.screenPointObjectToArray(v.magnifier.position,u);const D=p.camera.screenToRender(u,x);v=Math.ceil(t*v.magnifier.size);t=p.camera.fullWidth;p=p.camera.fullHeight;return h.set(w,-1+(D[0]+r)/t*2,-1+(D[1]-y)/p*2,v/t*2,v/p*2)}));q.varyings.add("vUV","vec2");q.vertex.code.add(d.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);q.fragment.uniforms.add(new g.Texture2DPassUniform("textureInput",v=>v.textures.input));q.fragment.uniforms.add(new g.Texture2DPassUniform("textureMask",v=>v.textures.mask));q.fragment.uniforms.add(new g.Texture2DPassUniform("textureOverlay",v=>v.textures.overlay));q.fragment.uniforms.add(new k.BooleanPassUniform("maskEnabled",v=>v.magnifier.maskEnabled));q.fragment.uniforms.add(new k.BooleanPassUniform("overlayEnabled",v=>v.magnifier.overlayEnabled));q.fragment.code.add(d.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,h,c){const k=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(m){var d=new Promise((g,e)=>a(["./mask-svg"],n=>g(k(n)),e)),f=new Promise((g,e)=>a(["./overlay-svg"],n=>g(k(n)),e));d=c.requestImage((await d).default,
{signal:m});f=c.requestImage((await f).default,{signal:m});f={mask:await d,overlay:await f};h.throwIfAborted(m);return f};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/Logger","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,h,c){class k{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new c.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(m,d,f,g,e,n=null,l=null,u=null){m&&d&&f&&g&&(this._layerUidToId.set(g,f),this._layerUidToPopupEnabled.set(g,e),e&&(f=this._layerUidToGraphicsUidToObjectId.get(g),f||(f=new Map,this._layerUidToGraphicsUidToObjectId.set(g,f)),f.set(d,{objectId:m,attributeNodeId:n,
attributeIndex:l,subLayerId:u})))}getObjectAndLayerIdColor(m){m=this.getObjectAndLayerIdColorArray(m);return h.fromValues(m.get(0,1),m.get(0,2),m.get(0,3),255)}getObjectAndLayerIdColorArray(m){if(!m.layerUid||!m.graphicUid)return this.colorZero;var d=this._layerUidToPopupEnabled.get(m.layerUid);if(void 0===d)return b.getLogger(this).warn("popupEnabled is undefined for layerUid "+m.layerUid),this.colorZero;if(!1===d)return this.colorZero;let f=this._uidToRenderColor.get(m.layerUid);f||(f=new Map,this._uidToRenderColor.set(m.layerUid,
f));d=f.get(m.graphicUid);if(!d){for(;!d;){const g=Math.floor(16777214*Math.random())+1;this._colorToUID.has(g)||(d=g)}if(16777215<d)throw Error("Object ID Overflow");f.set(m.graphicUid,d);this._colorToUID.set(d,m)}m=new ArrayBuffer(4);(new DataView(m)).setUint32(0,d,!1);return new c.BufferViewVec4u8(m)}getColorToObjectAndLayerIdMapping(){const m=new Map;for(const [f,g]of this._colorToUID.entries()){var d=this._layerUidToGraphicsUidToObjectId.get(g.layerUid);let e=null;d?(e=d.get(g.graphicUid))||
b.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+g.graphicUid):b.getLogger(this).warn("getColorMapping: no entry found for layerUid "+g.layerUid);(d=this._layerUidToId.get(g.layerUid))||b.getLogger(this).warn("no layerId found for uid "+g.layerUid);e&&d&&m.set(f,e.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:e.objectId,lid:d,attrId:e.attributeNodeId,attrIdx:e.attributeIndex,subLayerId:e.subLayerId}:{type:"object-and-layer-id",oid:e.objectId,lid:d})}return m}}a.ObjectAndLayerIdRenderHelper=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/arrayUtils ../../../../core/colorUtils ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/signal ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/interfaces ../../../../core/accessorSupport/tracking/Flags ../../../../core/Warning ../../../../core/Error ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../../webgl/ManagedFBO ../core/FBOCache ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDRenderStyle ../effects/RenderNodes ../effects/RenderPlugin ../effects/RenderPluginManager ../effects/blit/Blit ../effects/highlight/Highlight ../effects/highlight/ShadowHighlight ../effects/smaa/SMAA ../effects/ssao/SSAO ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderSlot ./ShadowAccumulator ./ShadowMap ./SliceHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja){function oa(la){return qa=>la.immediate.schedule(qa)}class ra{constructor(la,qa,ua,va,Ga,La,Na,Wa){this._stage=la;this._techniqueRepository=va;this._rctx=Ga;this._compositingHelper=La;this._magnifierHelper=Na;this._requestRender=Wa;this._needsTransparentPass=!1;this._pluginsHas={hudElements:!1,water:!1};this._hasOverlayWater=!1;this.renderOverlay=Ia=>{};this._isRendering=
!1;this._backgroundColor=t.fromValues(0,0,0,1);this._sliceHelper=new ha;this._state=g.signal(Y.RenderState.IDLE);this._highQualityTransparencyEnabled=!0;this._terrainTransparency=D.TransparencyMode.Opaque;this._hasAnimations=this._ssrEnabled=!1;this._animationTimestep=new S.AnimationTimeStep;this._reprojectionMatrixVersion=g.signal(0);this._renderHiddenTransparentEdges=()=>{};this._pluginInput=new Map;this._releaseGeometryLinearDepth=Ia=>{Ia?.release()};this._geometryLinearDepthFormat=E.DepthFormat.DEPTH16_BUFFER;
this._debugLinearDepth=!1;this.fboCache=new A.FBOCache(Ga);this._renderStateFeatures=g.signal(R.setupFeatureDefaults(!k("disable-feature:high-quality-idle"),la.view.qualityProfile));this._offscreen=new O.OffscreenRendering(this.fboCache,this._compositingHelper);this.performanceInfo=new W.RendererPerformanceInfo(this._rctx);this._shadowMap=new da.ShadowMap(this.fboCache,la.viewingMode);this._highlight=new J.Highlight({view:la.view});this._shadowHighlight=new K.ShadowHighlight({view:la.view,viewingMode:la.viewingMode});
this._shadowAccumulator=new X.ShadowAccumulator(this.fboCache,va,la,Ia=>{const Oa=this.shadowsEnabled;this._shadowMap.enabled=!0;this._prepare(Ia.camera,Ia.contentCamera);this._plugins.prepareRender();this._shadowMap.enabled=Oa},(Ia,Oa,Ua)=>{Ia.shadowMap.start(Ia.camera,Oa,Ua,!0,this._stage.view.qualitySettings.maximumPixelRatio);this._renderShadowCascades(F.ShaderOutput.Shadow,Ia.shadowMap);Ia.shadowMap.finish();Ia.camera.setGLViewport(this._rctx);this._prepare(Ia.camera,Ia.contentCamera)},Wa);this._ssao=
new M.SSAO({view:this._stage.view});this._renderContext=new U.RenderContext(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper);this._nodes=new H.RenderNodes(this._renderContext);this._plugins=new C.RenderPluginManager({renderContext:this._renderContext,techniqueRepository:va,textureRepository:ua,materialRepository:qa,requestRender:Wa,controller:la,fbos:this.fboCache,isFeatureEnabled:Ia=>this.isFeatureEnabled(Ia)});this.renderPassManager=new B.RenderPassManager;this._plugins.add(this.renderPassManager);
this._smaa=new I.SMAA({view:this._stage.view});this._plugins.add(this._smaa);this._blit=new z.Blit({opacity:1,alphaMode:ca.AlphaMode.None});this._plugins.add(this._blit);this._plugins.add(this._ssao);this._plugins.add(this._highlight);this._plugins.add(this._shadowHighlight);this._handles=[f.watch(()=>this._stage.view.state.camera,()=>Wa(),f.syncAndInitial),f.watch(()=>y.debugFlags.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Ia=>{this._renderHiddenTransparentEdges=Ia?()=>this._renderEdges(Z.Transparency.TRANSPARENT):
()=>{};Wa()},f.initial),f.watch(()=>this._stage.view.environment.background?.color,Ia=>{Ia=Ia?c.unitRGBAFromColor(Ia):t.ZEROS;p.set(this._backgroundColor,Ia[0]*Ia[3],Ia[1]*Ia[3],Ia[2]*Ia[3],Ia[3]);Wa()},f.syncAndInitial)]}destroy(){this._handles.forEach(la=>la.remove());this._gpuTimerHandle=m.removeMaybe(this._gpuTimerHandle);this._nodes.destroy();this._offscreen.dispose();this._shadowMap.dispose();this._highlight.dispose();this._shadowAccumulator.dispose();this._edgeView=m.destroyMaybe(this._edgeView);
this.renderPassManager.dispose();this._releaseFBOs();this._disposeOffscreenBuffers();this.fboCache.destroy();this._plugins.destroy();V.BoundingInfo.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(la=null,qa=!k("disable-feature:high-quality-idle")){this._renderStateFeatures.value=R.setupFeatureDefaults(qa,la);this._plugins.renderFeatureChanged();this._requestRender()}isFeatureEnabled(la,qa=this._state.value){return this._renderStateFeatures.value.get(qa,
la)??!1}setFeatureEnabled(la,qa,ua){this._renderStateFeatures.mutate(va=>va.set(qa,la,ua));this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(R.RenderFeature.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(R.RenderFeature.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations}get hasHighlights(){return this._plugins.produces(ba.RenderSlot.OPAQUE_MATERIAL,
F.ShaderOutput.Highlight)||this._plugins.produces(ba.RenderSlot.TRANSPARENT_MATERIAL,F.ShaderOutput.Highlight)||this._plugins.produces(ba.RenderSlot.DRAPED_MATERIAL,F.ShaderOutput.Highlight)}get _magnifierEnabled(){return this._bindParameters.decorations===N.Decorations.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(R.RenderFeature.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=
m.releaseMaybe(this._bindParameters.ssr.lastFrameColor);this._bindParameters.multipassTerrain.linearDepth=m.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth);this._bindParameters.multipassGeometry.linearDepth=m.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose();this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers();this._bindParameters.linearDepth=m.releaseMaybe(this._bindParameters.linearDepth);
this._bindParameters.hudVisibility=m.releaseMaybe(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}ensureEdgeView(){null==this._edgeView&&(this._edgeView=new aa.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),
schedule:oa(this._stage.view.resourceController)}),this._handles.push(f.watch(()=>this._edgeView?.updating,()=>this._requestRender(),f.sync)),this._requestRender());return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return 0<=this._reprojectionMatrixVersion.value&&q.equals(this._bindParameters.ssr.reprojectionMatrix,v.IDENTITY)}set _reprojectionMatrix(la){h.update(this._bindParameters.ssr.reprojectionMatrix,la)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(la){const {_shadowMap:qa,
_bindParameters:ua}=this;void 0!==la.qualitySettings?.reflections&&this._ssrEnabled!==la.qualitySettings.reflections&&(this._ssrEnabled=la.qualitySettings.reflections,this._requestRender());void 0!==la.shadowMap&&this._shadowMap.enabled!==la.shadowMap&&(this._shadowMap.enabled=la.shadowMap,this._requestRender());void 0!==la.shadowMapMaxCascades&&qa.maxCascades!==la.shadowMapMaxCascades&&(qa.maxCascades=la.shadowMapMaxCascades,this._requestRender());if(null!=la.environment){null!=la.environment.weather&&
(this._bindParameters.weather=la.environment.weather,this._bindParameters.weatherVisible=!!la.weatherVisible);const va="virtual"!==la.environment.lighting.type;ua.enableFillLights!==va&&(ua.enableFillLights=va,this._requestRender())}void 0!==la.highQualityTransparency&&this._highQualityTransparencyEnabled!==la.highQualityTransparency&&(this._highQualityTransparencyEnabled=la.highQualityTransparency,this._requestRender());void 0!==la.hasOverlayWater&&this._hasOverlayWater!==la.hasOverlayWater&&(this._hasOverlayWater=
la.hasOverlayWater,this._requestRender());void 0!==la.slicePlane&&this._sliceHelper.plane!==la.slicePlane&&(this._sliceHelper.plane=la.slicePlane,this._requestRender());void 0!==la.terrainTransparency&&this._terrainTransparency!==la.terrainTransparency&&(this._terrainTransparency=la.terrainTransparency,this._requestRender());void 0!==la.shadowCastOptions&&this._shadowAccumulator.setOptions(la.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&
this._hasOITSupport}modify(la,qa){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ua,removes:va,updates:Ga}=la;if(0!==ua.length||0!==va.length||0!==Ga.length){var La=!1;P.splitRenderGeometryChangeSetByMaterial(la).forEach((Na,Wa)=>{if(!qa.done){var Ia=this._plugins.getMaterialRenderer(Wa);null==Ia&&0<Na.adds.length&&(Wa=new ea.MergedRenderer({material:Wa}),Wa.initializeRenderContext(this._plugins._context),Ia=Wa,this._plugins.add(Ia));Ia&&(Ia.modify(Na),0===Ia.numGeometries&&
(La=!0));Na.removes.forEach(Oa=>la.removes.removeUnordered(Oa));Na.adds.forEach(Oa=>la.adds.removeUnordered(Oa));Na.updates.forEach(Oa=>la.updates.removeUnordered(Oa));qa.madeProgress()}});La&&this._plugins.removeEmptyMaterialRenderers();this._updateHasFlags();this._requestRender()}}_updateHasFlags(){const la=this._pluginsHas;la.hudElements=this._plugins.produces(ba.RenderSlot.LINE_CALLOUTS_HUD_DEPTH)||this._plugins.produces(ba.RenderSlot.HUD_MATERIAL)||this._plugins.produces(ba.RenderSlot.LABEL_MATERIAL);
la.water=this._plugins.produces(ba.RenderSlot.DRAPED_WATER,F.ShaderOutput.Normal);this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(la){const qa=this._hasAnimations;this._hasAnimations=this._plugins.updateAnimation(la)||this._hasAnimations;this._hasAnimations!==qa&&(this._gpuTimerHandle=qa?m.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(la,
qa,ua=P.RendererTarget.Default,va=N.Decorations.ON){this._isRendering=!0;this.performanceInfo.startFrame();this.fboCache.frameStart();this._disposeBindBuffers();var Ga=this._offscreen;const {camera:La,contentCamera:Na,mode:Wa,alignPixelEnabled:Ia}=la;this._state.value=Wa;this._bindParameters.overlay=this.renderOverlay(qa);this.performanceInfo.advance(W.PerformanceCategory.OVERLAY);this._renderContext.time=qa;this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE;this._bindParameters.alignPixelEnabled=
Ia;this._bindParameters.decorations=va;this._bindParameters.mainColor=this._bindParameters.mainDepth=null;la=r.create(this._sliceHelper.plane);va===N.Decorations.OFF&&(this._sliceHelper.plane=null);La.setGLViewport(this._rctx);va=Ga.initializeFrame(La,this._backgroundColor,ua);this.hasReflections?this._bindParameters.ssr.lastFrameColor=va:va?.release();this._prepare(La,Na);this._plugins.prepareRender();this.performanceInfo.advance(W.PerformanceCategory.PREPARE);var Oa=this._computeDepthRange(La);
this._renderShadowMap(La,this._bindParameters.lighting.mainLight.direction,Oa);this.performanceInfo.advance(W.PerformanceCategory.SHADOW_MAP);this._ensureBindParameters(La,Na);var Ua=this._plugins.produces(ba.RenderSlot.OPAQUE_TERRAIN)&&(this._terrainTransparency===D.TransparencyMode.Semitransparent||this._terrainTransparency===D.TransparencyMode.TransparentWithDraped);va=this._highQualityTransparency&&Ua;this._prepareShaders(va,this._needsTransparentPass);this._pluginInput.set("normals",this._renderNormals());
this.performanceInfo.advance(W.PerformanceCategory.NORMALS);this._renderSSAO();this.performanceInfo.advance(W.PerformanceCategory.SSAO);this._renderLinearDepth();this.performanceInfo.advance(W.PerformanceCategory.LINEAR_DEPTH);this._renderShadowAccumulation(Oa,La,Na);this.performanceInfo.advance(W.PerformanceCategory.ACCUMULATED_SHADOWS);this._ensureBindParametersSSR(qa);this._renderContext.output=F.ShaderOutput.Color;Ga.bindFbo();this._bindParameters.mainColor=Ga.colorTexture;this._bindParameters.mainDepth=
Ga.depthTexture;this._renderOpaqueGeometry();this._offscreen.updateColor(Va=>this._invokeRenderNodes(Va),"opaque-color");this._plugins.render(ba.RenderSlot.ENVIRONMENT_OPAQUE);this.performanceInfo.advance(W.PerformanceCategory.OPAQUE);this.fboCache.debugCallback&&this.fboCache.debugCallback("opaque-color",this._offscreen.color.fbo);this._renderTerrainLinearDepth(va);this._setMultipassTerrain(va);this._renderEdges(Z.Transparency.OPAQUE);this.performanceInfo.advance(W.PerformanceCategory.OPAQUE_EDGES);
Ga.bindFbo();this._plugins.render(ba.RenderSlot.VOXEL);this.performanceInfo.advance(W.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();this._needsTransparentPass&&(this._oitEnabled?this._renderOITPass(ta.Geometry):this._renderTransparentMaterial());this._offscreen.updateColor(Va=>this._invokeRenderNodes(Va),"transparent-color");this.performanceInfo.advance(W.PerformanceCategory.TRANSPARENT);Oa=this._renderGeometryLinearDepth(va);this._renderHUDVisibility(Oa);va||this._plugins.render(ba.RenderSlot.LINE_CALLOUTS);
this.performanceInfo.advance(W.PerformanceCategory.HUD_VISIBILITY);qa=ua===P.RendererTarget.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this.performanceInfo.advance(W.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(Z.Transparency.TRANSPARENT,Oa);this._releaseGeometryLinearDepth(Oa);this.performanceInfo.advance(W.PerformanceCategory.TRANSPARENT_EDGES);(Ua=Ua?this._renderTransparentTerrain():null)&&this._bindParameters.hudVisibility&&(va?this._renderLineCallouts(G.HUDRenderStyle.Occluded):
Ga.compositeToHUDVisibility(this._bindParameters,Ua.getTexture()),this._renderHUD(G.HUDRenderStyle.Occluded,Ga.color),this.performanceInfo.advance(W.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(W.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);Ua&&(Ga.compositeToFramebuffer(this._bindParameters,Ua.getTexture(),ca.AlphaMode.PremultipliedAlpha,1),Ua.release(),va&&(this._renderEdges(Z.Transparency.OPAQUE),this.performanceInfo.advance(W.PerformanceCategory.OPAQUE_EDGES),
this._needsTransparentPass&&(this._oitEnabled?this._renderOITPass(ta.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(W.PerformanceCategory.TRANSPARENT),this._renderEdges(Z.Transparency.TRANSPARENT),this.performanceInfo.advance(W.PerformanceCategory.TRANSPARENT_EDGES)));this._bindParameters.ssao=m.releaseMaybe(this._bindParameters.ssao);va&&this._renderLineCallouts(G.HUDRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);
Ga.bindFbo();this._plugins.render(ba.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._plugins.render(ba.RenderSlot.ENVIRONMENT_TRANSPARENT);this.performanceInfo.advance(W.PerformanceCategory.ENVIRONMENT);this._renderLaserlines();this.performanceInfo.advance(W.PerformanceCategory.LASER_LINES);this._renderOccluded();this.performanceInfo.advance(W.PerformanceCategory.OCCLUDED);(Ga=this._renderHighlightPrepass())&&this._renderShadowHighlights(Ga,this._bindParameters);va=this._magnifierEnabled&&
ua===P.RendererTarget.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"magnifier"):null;Ua=ua!==P.RendererTarget.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"screenshot"):null;Oa=this._renderComposite(va??Ua,Ga)??Ua;this.performanceInfo.advance(W.PerformanceCategory.ANTIALIASING);this._renderHUD(G.HUDRenderStyle.NotOccluded,Oa);this.performanceInfo.advance(W.PerformanceCategory.HUD);Ga&&(this._renderHighlights(Oa,Ga,this._bindParameters),Ga=
m.releaseMaybe(Ga));this.performanceInfo.advance(W.PerformanceCategory.HIGHLIGHTS);this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters);Oa!==Ua&&(this._rctx.bindFramebuffer(Ua?.fbo),this._compositingHelper.composite(this._bindParameters,va?.getTexture(),ca.AlphaMode.None));ua===P.RendererTarget.Default&&va?.release();if(this.onPostRender)this.onPostRender();this._releaseFBOs();this._offscreen.releaseBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);
this._sliceHelper.plane=la;this._isRendering=!1;this.fboCache.frameEnd();this.performanceInfo.finishFrame();ua!==P.RendererTarget.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers());return{screen:Ua,oid:qa}}_prepareShaders(la,qa){this._renderContext.output=F.ShaderOutput.Color;this._prepareOpaqueGeometry();this._setMultipassTerrain(la);this._plugins.prepare(ba.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);la||this._plugins.prepare(ba.RenderSlot.LINE_CALLOUTS);qa&&this._prepareTransparencySlots();
this._plugins.prepare(ba.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._plugins.prepare(ba.RenderSlot.ENVIRONMENT_TRANSPARENT);this._plugins.prepare(ba.RenderSlot.LASERLINES);this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(k("enable-feature:objectAndLayerId-rendering")){var la=this._renderContext.output,qa=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");qa.acquireDepth(E.DepthFormat.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(qa.fbo);this.fboCache.rctx.clearFramebuffer([0,
0,0,0],!0,!0);this._renderAllGeometry(F.ShaderOutput.ObjectAndLayerIdColor);this._rctx.bindFramebuffer(qa.fbo);this.fboCache.rctx.clearFramebuffer(void 0,!0,!0);this._bindParameters.hudRenderStyle=G.HUDRenderStyle.NotOccluded;this._plugins.render(ba.RenderSlot.HUD_MATERIAL);this._renderContext.output=la;return qa}}finish(la){this._hasAnimations||this._animationTimestep.clear();var qa=this.performanceInfo.gpuSamplingEnabled;if((la=la===N.RenderRequestType.BACKGROUND)||qa){const ua=la?this.performanceInfo.elapsedTime:
0;qa=qa?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(ua,qa),la)}}readDepthPixels(la,qa,ua){var va=this._bindParameters.linearDepth?.fbo;va?.colorTexture?va.readPixels(qa[0],qa[1],qa[2],qa[3],ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,ua):(va=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"depth").acquireDepth(E.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(va.fbo),this._ensureBindParameters(la,la),this._bindParameters.camera.setGLViewport(this._rctx),
this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ja.ClearBufferBit.COLOR_BUFFER_BIT|ja.ClearBufferBit.DEPTH_BUFFER_BIT|ja.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderAllGeometry(F.ShaderOutput.LinearDepth),va.fbo.readPixels(qa[0],qa[1],qa[2],qa[3],ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,ua),va.release())}readHUDVisibility(la,qa,ua,va,Ga){this._bindParameters.hudVisibility?.fbo.readPixels(la,qa,ua,va,ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,Ga)}readAccumulatedShadow(la){return this._shadowAccumulator.readAccumulatedShadow(la[0],
la[1])}_setMultipassTerrain(la){this._setMultipassEnabled(la);this._setTerrainCulling(la)}_setMultipassEnabled(la){this._bindParameters.multipassEnabled=la}_setTerrainCulling(la){this._bindParameters.multipassTerrain.cullAboveGround=la}_renderEdges(la,qa){const ua=this._edgeView;if(ua?.shouldRender()){const {width:va,height:Ga,depth:La}=this._offscreen,Na=this.fboCache.acquire(va,Ga,"edges");this._offscreen.renderToTargets(()=>ua.render(this._bindParameters,la),Na,qa??La,ya);this._offscreen.compositeToFramebuffer(this._bindParameters,
Na.getTexture(),ca.AlphaMode.Alpha,1);Na.release()}}_renderShadowMap(la,qa,ua){const va=this._shadowMap;va.enabled&&(va.start(la,qa,ua,this.isFeatureEnabled(R.RenderFeature.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(la,qa),this._needsShadowHighlight?(this._renderShadowCascades(F.ShaderOutput.ShadowHighlight,this._shadowMap),va.moveSnapshot(da.SnapshotSlot.Highlight),this._renderShadowCascades(F.ShaderOutput.ShadowExcludeHighlight,
this._shadowMap),va.copySnapshot(da.SnapshotSlot.ExcludeHighlight),this._renderShadowCascades(F.ShaderOutput.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(F.ShaderOutput.Shadow),va.finish(),la.setGLViewport(this._rctx))}_renderShadowCascades(la,qa=this._shadowMap){for(const ua of qa.cascades)ua.camera.setGLViewport(this._rctx),this._prepare(ua.camera,ua.camera),this._renderAllGeometry(la)}get _needsLinearDepth(){return this._plugins.consumes(F.ShaderOutput.LinearDepth)||!!this._nodes.require("linear-depth")||
this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugLinearDepth}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,"linear-depth",()=>this._renderAllGeometry(F.ShaderOutput.LinearDepth),[0,0,0,0],E.ColorFormat.RGBA,E.DepthFormat.DEPTH_STENCIL_TEXTURE),this._bindParameters.linearDepth.detachDepth()):this._bindParameters.linearDepth=m.releaseMaybe(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(la){la?
(la=this._renderContext.output,this._renderContext.output=F.ShaderOutput.LinearDepth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,"terrain depth",()=>this._renderTransparentTerrain(),[-1E10,-1E10,-1E10,1]),this._bindParameters.multipassTerrain.linearDepth.detachDepth(),this._renderContext.output=la):this._bindParameters.multipassTerrain.linearDepth=m.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(la){if(la)return la=
this._renderContext.output,this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,"geometry depth",()=>this._renderOpaqueGeometryAndTransparentMaterial(F.ShaderOutput.LinearDepth),[1,1,1,1],E.ColorFormat.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=la,la=this._bindParameters.multipassGeometry.linearDepth.depth,la?.retain(),this._bindParameters.multipassGeometry.linearDepth.detachDepth(),la;this._bindParameters.multipassGeometry.linearDepth=
m.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(la){if(!this._needsDepthRange)return Q.zero;const qa=T.depthRangeFromScene(la,this._plugins.plugins,this._stage.layers);Q.union(qa,this._plugins.queryDepthRange(la));qa.near=Math.max(la.near,qa.near);qa.far=Math.min(la.far,qa.far);return qa}_renderNormals(){let la=(this._plugins.produces(ba.RenderSlot.SSAO)?1:0)+this._nodes.require("normals");
if(0!==la){for(var qa=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(F.ShaderOutput.Normal),[0,0,0,0],E.ColorFormat.RGBA,E.DepthFormat.DEPTH_STENCIL_TEXTURE);0<--la;)qa.retain();return qa}}_renderSSAO(){const la=this._pluginInput.get("normals");this._plugins.produces(ba.RenderSlot.SSAO)&&la&&(this._bindParameters.ssao=this._plugins.render(ba.RenderSlot.SSAO,this._pluginInput),la.detachDepth(),la.release()&&this._pluginInput.delete("normals"))}_renderAllGeometry(la){this._renderContext.output=
la;this._plugins.prepare(ba.RenderSlot.TRANSPARENT_TERRAIN);this._renderOpaqueGeometryAndTransparentMaterial(la);this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(la){this._renderContext.output=la;this._plugins.prepare(ba.RenderSlot.TRANSPARENT_MATERIAL);this._plugins.prepare(ba.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH);this._renderOpaqueGeometry();this._renderTransparentMaterial()}_renderGeometryForSSAO(la){this._renderContext.output=la;this._plugins.render(ba.RenderSlot.INTEGRATED_MESH);
this._plugins.render(ba.RenderSlot.OPAQUE_TERRAIN);this._plugins.render(ba.RenderSlot.OPAQUE_MATERIAL);this._plugins.render(ba.RenderSlot.TRANSPARENT_MATERIAL);this._renderTransparentTerrain()}_prepareOpaqueGeometry(){this._plugins.prepare(ba.RenderSlot.INTEGRATED_MESH);this._plugins.prepare(ba.RenderSlot.OPAQUE_TERRAIN);this._plugins.prepare(ba.RenderSlot.OPAQUE_MATERIAL);this._plugins.prepare(ba.RenderSlot.OPAQUE_NO_SSAO_DEPTH);this._plugins.prepare(ba.RenderSlot.ENVIRONMENT_OPAQUE)}_renderOpaqueGeometry(){this._plugins.render(ba.RenderSlot.INTEGRATED_MESH);
this._plugins.render(ba.RenderSlot.OPAQUE_TERRAIN);this._plugins.render(ba.RenderSlot.OPAQUE_MATERIAL);this._plugins.render(ba.RenderSlot.OPAQUE_NO_SSAO_DEPTH)}_renderTransparentMaterial(){this._plugins.render(ba.RenderSlot.TRANSPARENT_MATERIAL);this._plugins.render(ba.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH)}_renderTransparentTerrain(){if(this._plugins.produces(ba.RenderSlot.TRANSPARENT_TERRAIN)){var la=()=>this._plugins.render(ba.RenderSlot.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==
F.ShaderOutput.Color)la();else{var {width:qa,height:ua,depth:va}=this._offscreen,Ga=this.fboCache.acquire(qa,ua,"transparent terrain");this._offscreen.renderToTargets(la,Ga,va,[0,0,0,0]);return Ga}}}_renderHUDVisibility(la){this._plugins.produces(ba.RenderSlot.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(ba.RenderSlot.OCCLUSION_PIXELS),la),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=
m.releaseMaybe(this._bindParameters.hudVisibility)}_renderLineCallouts(la){this._bindParameters.hudRenderStyle=la;if(la===G.HUDRenderStyle.Occluded){const {width:qa,height:ua,color:va}=this._offscreen;la=this.fboCache.acquireDepth(E.DepthFormat.DEPTH16_BUFFER,qa,ua,"line callouts");this._offscreen.renderToTargets(()=>{this._plugins.render(ba.RenderSlot.LINE_CALLOUTS)},va,la,void 0,!0,!0);la.release()}else this._plugins.render(ba.RenderSlot.LINE_CALLOUTS)}_renderLaserlines(){this._plugins.render(ba.RenderSlot.LASERLINES);
if(this._plugins.produces(ba.RenderSlot.LASERLINES_CONTRAST_CONTROL)){const la=this._offscreen,{width:qa,height:ua,depth:va}=la,Ga=this.fboCache.acquire(qa,ua,"laser lines");la.renderToTargets(()=>this._plugins.render(ba.RenderSlot.LASERLINES_CONTRAST_CONTROL),Ga,va,ya);la.compositeToFramebuffer(this._bindParameters,Ga.getTexture(),ca.AlphaMode.PremultipliedAlpha,1);Ga.release()}}_renderHUD(la,qa){if(this._pluginsHas.hudElements)if(this._oitEnabled){const ua=this._renderOITPass(ta.HUD,la);this._rctx.bindFramebuffer(qa?.fbo);
this._compositingHelper.composite(this._bindParameters,ua.getTexture(),ca.AlphaMode.PremultipliedAlpha);ua.release()}else if(la===G.HUDRenderStyle.Occluded){const {width:ua,height:va,color:Ga}=this._offscreen;qa=this.fboCache.acquireDepth(E.DepthFormat.DEPTH16_BUFFER,ua,va,"hud");this._offscreen.renderToTargets(()=>this._renderHUDElements(la),Ga,qa,void 0,!0,!0);qa.release()}else this._rctx.bindFramebuffer(null),qa?.acquireDepth(E.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(qa?.fbo),this._renderHUDElements(la),
qa?.detachDepth()}_renderHUDElements(la){this._bindParameters.hudRenderStyle=la;this._plugins.prepare(ba.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._plugins.prepare(ba.RenderSlot.HUD_MATERIAL);this._plugins.prepare(ba.RenderSlot.LABEL_MATERIAL);this._plugins.render(ba.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._plugins.render(ba.RenderSlot.HUD_MATERIAL);this._plugins.render(ba.RenderSlot.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(ba.RenderSlot.SHADOW_HIGHLIGHT)&&
this._plugins.produces(ba.RenderSlot.OPAQUE_MATERIAL,F.ShaderOutput.ShadowHighlight)}_renderHighlightPrepass(){if(this.hasHighlights){var la=this._offscreen.renderToCachedFBO(null,"highlight",()=>{this._renderAllGeometry(F.ShaderOutput.Highlight);this._rctx.clearSafe(ja.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(G.HUDRenderStyle.Both)},[0,0,0,0],E.ColorFormat.RGBA4,E.DepthFormat.DEPTH_STENCIL_TEXTURE);la.detachDepth();return la}}_renderShadowHighlights(la,qa){this.hasHighlights&&qa.decorations!==
N.Decorations.OFF&&this._needsShadowHighlight&&this._offscreen.updateColor(ua=>{this._pluginInput.set("highlight",la);this._plugins.render(ba.RenderSlot.SHADOW_HIGHLIGHT,this._pluginInput,ua);return ua},"transparent-color")}_renderHighlights(la,qa,ua){this.hasHighlights&&ua.decorations!==N.Decorations.OFF&&(this._pluginInput.set("highlight",qa),this._plugins.produces(ba.RenderSlot.HIGHLIGHT)&&this._plugins.render(ba.RenderSlot.HIGHLIGHT,this._pluginInput,la))}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(la,
qa,ua){this._needsShadowCast&&this._bindParameters.linearDepth?.getTexture()&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,la,qa,ua)}_prepareTransparencySlots(){this._renderContext.output=F.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Alpha;this._plugins.prepare(ba.RenderSlot.TRANSPARENT_MATERIAL);this._renderContext.output=F.ShaderOutput.Color;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Color;this._plugins.prepare(ba.RenderSlot.TRANSPARENT_MATERIAL);
this._bindParameters.transparencyPassType=fa.TransparencyPassType.FrontFace;this._plugins.prepare(ba.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE}_renderOITPass(la,qa=G.HUDRenderStyle.Both){var ua=la===ta.HUD;la=ua?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null;const va=ua?()=>this._renderHUDElements(qa):()=>this._renderTransparentMaterial(),Ga=this._renderContext.output;this._renderContext.output=
F.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Alpha;const La=this._offscreen.renderOITPass(va,fa.TransparencyPassType.Alpha,ua);this._renderContext.output=F.ShaderOutput.Color;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Color;const Na=this._offscreen.renderOITPass(va,fa.TransparencyPassType.Color,ua);this._bindParameters.transparencyPassType=fa.TransparencyPassType.FrontFace;ua=this._offscreen.renderOITPass(va,fa.TransparencyPassType.FrontFace,
ua);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,Na,La,ua,la);la?.detachDepth();ua.release();Na.release();La.release();this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE;this._renderContext.output=Ga;return la}_renderOccluded(){let la=0;Ca.clear();this._plugins.plugins.forAll(Na=>{Na.materialReference&&Na.queryRenderOccludedState(ia.RenderOccludedFlag.OccludeAndTransparentStencil)&&(la|=ia.RenderOccludedFlag.OccludeAndTransparentStencil,Ca.push(Na))});const qa=
this._offscreen,ua=(Na,Wa,Ia,Oa,Ua)=>{if(0!==(la&Wa)){var {width:Va,height:Ra,depth:bb}=qa;Wa=this.fboCache.acquire(Va,Ra,"tmp color");qa.renderToTargets(Ia,Wa,bb,[0,0,0,0],Oa,Ua);qa.compositeToFramebuffer(this._bindParameters,Wa.getTexture(),ca.AlphaMode.PremultipliedAlpha,Na);Wa.release()}},va=(Na,Wa)=>{this._bindParameters.slot=Na;Wa.forAll(Ia=>{if(L.isPrepareRenderPlugin(Ia)){const Oa=Ia.prepareTechnique(this._renderContext);Oa&&Ia.renderNode(this._renderContext,Oa)}})};0!==Ca.length&&(va(ba.RenderSlot.OCCLUDER_MATERIAL,
Ca),ua(.5,ia.RenderOccludedFlag.OccludeAndTransparentStencil,()=>va(ba.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,Ca),!1,!1));Ca.clear();this._plugins.plugins.forAll(Na=>{if(Na.materialReference){var Wa=Na.queryRenderOccludedState(ia.RenderOccludedFlag.OccludeAndTransparent),Ia=Na.queryRenderOccludedState(ia.RenderOccludedFlag.Transparent),Oa=Na.queryRenderOccludedState(ia.RenderOccludedFlag.Opaque);if(Wa||Ia||Oa)la|=Wa?ia.RenderOccludedFlag.OccludeAndTransparent:Ia?ia.RenderOccludedFlag.Transparent:
ia.RenderOccludedFlag.Opaque,Ca.push(Na)}});const Ga=this._plugins.renderOccludedFlags;if(la|=Ga){var La=Na=>{this._renderContext.renderOccludedMask=Na;Ga>ia.RenderOccludedFlag.Occlude&&this._plugins.render(ba.RenderSlot.OCCLUDED_TERRAIN);va(ba.RenderSlot.OPAQUE_MATERIAL,Ca);va(ba.RenderSlot.TRANSPARENT_MATERIAL,Ca);va(ba.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ca);this._renderContext.renderOccludedMask=U.defaultRenderOccludedMask};this._renderContext.output=F.ShaderOutput.Color;ua(.5,
ia.RenderOccludedFlag.OccludeAndTransparent,()=>La(ia.RenderOccludedFlag.OccludeAndTransparent),!0,N.StencilBits.OutlineVisualElementMask);ua(.5,ia.RenderOccludedFlag.Transparent,()=>La(ia.RenderOccludedFlag.Transparent),!0,N.StencilBits.OutlineVisualElementMask);ua(1,ia.RenderOccludedFlag.Opaque,()=>La(ia.RenderOccludedFlag.Opaque),!0,N.StencilBits.OutlineVisualElementMask);Ca.clear()}}_invokeRenderNodes(la){this._updatePluginInput();const qa=this._nodes.render(la,this._pluginInput);this._releaseAfterRenderNode("normals",
la.name);return qa}_renderComposite(la,qa){this._offscreen.updateColor(va=>{this._pluginInput.set("highlight",qa);this._updatePluginInput();va=this._nodes.render(va,this._pluginInput);this._pluginInput.set(va.name,va);this._pluginInput.delete("highlight");this._releaseAfterRenderNode("normals","composite-color");return va},"composite-color");const ua=this._plugins.produces(ba.RenderSlot.ANTIALIASING);return this._plugins.render(ua?ba.RenderSlot.ANTIALIASING:ba.RenderSlot.BLIT,this._pluginInput,la)}_releaseAfterRenderNode(la,
qa){const ua=this._pluginInput.get(la);if(ua)for(qa=this._nodes.require(ua.name,qa);qa--;)ua.release()&&this._pluginInput.delete(la)}_updatePluginInput(){this._pluginInput.set("linear-depth",this._bindParameters.linearDepth)}_prepare(la,qa){this._needsTransparentPass=this._plugins.produces(ba.RenderSlot.TRANSPARENT_MATERIAL,F.ShaderOutput.Color);this._bindParameters.camera=la;this._bindParameters.contentCamera=qa}_ensureBindParameters(la,qa){this._bindParameters.camera=la;this._bindParameters.contentCamera=
qa}_ensureBindParametersSSR(la){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&(this._ssrEnableTime=la);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=v.IDENTITY:(q.invert(wa,this._bindParameters.camera.viewMatrix),q.invert(pa,this._bindParameters.camera.projectionMatrix),q.multiply(Ba,wa,pa),q.multiply(Ba,this._renderContext.lastFrameCamera.viewMatrix,Ba),q.multiply(Ba,this._renderContext.lastFrameCamera.projectionMatrix,Ba),
this._reprojectionMatrix=Ba);const qa=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=0<qa?Math.min(qa,la-this._ssrEnableTime)/qa:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._reprojectionMatrix=v.IDENTITY,this._ssrEnableTime=null}addRenderNode(la){this._nodes.add(la);this._requestRender()}removeRenderNode(la){this._nodes.remove(la);this._requestRender()}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,
edges:this.edgeView?.usedMemory??0}}get test(){return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,renderPlugins:this._plugins,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{this._renderStateFeatures.value=R.setupFeatureDefaults();this._plugins.renderFeatureChanged();this._requestRender()},getFramebufferTexture:la=>{switch(la){case a.FramebufferId.Color:return this._offscreen.colorTexture;
case a.FramebufferId.LinearDepth:return this._bindParameters.linearDepth?.getTexture();case a.FramebufferId.ShadowMap:return this._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return this._bindParameters.hudVisibility?.getTexture()}},debugLinearDepth:la=>{this._debugLinearDepth=la;this._requestRender()}}}}b.__decorate([e.property({readOnly:!0})],ra.prototype,"fullResolutionAtmosphere",null);b.__decorate([e.property()],ra.prototype,"_smaa",void 0);b.__decorate([e.property()],ra.prototype,
"_blit",void 0);b.__decorate([e.property()],ra.prototype,"_edgeView",void 0);b.__decorate([e.property()],ra.prototype,"updating",null);var ta;(function(la){la[la.Geometry=0]="Geometry";la[la.HUD=1]="HUD"})(ta||={});a.FramebufferId=void 0;(function(la){la[la.Color=0]="Color";la[la.LinearDepth=1]="LinearDepth";la[la.ShadowMap=2]="ShadowMap";la[la.HudVisibility=3]="HudVisibility"})(a.FramebufferId||(a.FramebufferId={}));const ya=[0,0,0,0],Ca=new d,pa=v.create(),wa=v.create(),Ba=v.create();a.Renderer=
ra;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOCache":function(){define("exports ../../webgl/ManagedColorAttachment ../../webgl/ManagedDepthAttachment ../../webgl/ManagedFBO ../../webgl/ManagedFBObject ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l){class u{constructor(E){this.rctx=
E;this._acquired=new Set;this._cache=new m.FBOPool(E.newCache,"FBOCache");this._depthCache=new m.FBOPool(E.newCache,"DepthAttachmentCache");this._colorCache=new m.FBOPool(E.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frameStart(){this._cache.frame();this._colorCache.frame();this._depthCache.frame();this.debugCallback&&this.debugCallback()}frameEnd(){const E=
this.debugCallback;E&&this._acquired.forEach(A=>A.type===k.AttachmentType.FBO&&E(A.name,A.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((E,A)=>E+("getTexture"in A?A.getTexture()?.usedMemory??0:A.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(E){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=E}acquire(E,A,B,F=c.ColorFormat.RGBA){const G=`${F}x${E}x${A}`;let H=this._cache.pop(G);
H?(H.retain(),H.setName(B)):H=new c.ManagedFBO(G,B,new f.FramebufferObject(this.rctx,{...y[F],width:E,height:A}),L=>{L??=c.DepthFormat.DEPTH_STENCIL_TEXTURE;L=this._acquireDepth(L,H.fbo.width,H.fbo.height,`${H.name} depth`);H.attachDepth(L);L.release();return H},(L,C)=>{C??=c.ColorFormat.RGBA;C=this._acquireColor(C,E,A,`${H.name} color ${L}`);H.attachColor(C,L);return H},()=>{this.debugCallback&&this.debugCallback(H.name,H.fbo);this._acquired.delete(H);H.detachAll();this._cache.put(H)});this.rctx.unbindTexture(H.fbo.colorTexture);
this.rctx.bindFramebuffer(H.fbo);return this._trackHandle(H)}acquireDepth(E,A,B,F){return this._acquireDepth(E,A,B,F)}_acquireDepth(E,A,B,F){const G=`${E}x${A}x${B}`,H=this._depthCache.pop(G);if(H)return H.retain(),H.name=F,this._trackHandle(H);const L=E===c.DepthFormat.DEPTH_STENCIL_TEXTURE?new h.ManagedDepthAttachment(G,new n.Texture(this.rctx,{...D[E],width:A,height:B}),()=>{this._acquired.delete(L);this._depthCache.put(L)}):new h.ManagedDepthAttachment(G,new g.Renderbuffer(this.rctx,{...D[E],
width:A,height:B}),()=>{this._acquired.delete(L);this._depthCache.put(L)});L.name=F;return this._trackHandle(L)}_acquireColor(E,A,B,F){const G=`${E}x${A}x${B}`,H=this._colorCache.pop(G);if(H)return H.retain(),H.name=F,this._trackHandle(H);const L=new b.ManagedColorAttachment(G,new n.Texture(this.rctx,{...y[E],width:A,height:B}),()=>{this._acquired.delete(L);this._colorCache.put(L)});L.name=F;return this._trackHandle(L)}_trackHandle(E){this._acquired.add(E);return E}}const x=new l.TextureDescriptor;
x.pixelFormat=d.PixelFormat.RED;x.internalFormat=d.SizedPixelFormat.R8;x.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const w=new l.TextureDescriptor;w.pixelFormat=d.PixelFormat.RG;w.internalFormat=d.SizedPixelFormat.RG8;w.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const q=new l.TextureDescriptor;q.internalFormat=d.SizedPixelFormat.RGBA4;q.dataType=d.PixelType.UNSIGNED_SHORT_4_4_4_4;q.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const v=new l.TextureDescriptor;v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const p=
new l.TextureDescriptor;p.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;p.samplingMode=d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;p.hasMipmap=!0;p.maxAnisotropy=8;const t=new l.TextureDescriptor;t.pixelFormat=d.PixelFormat.RED;t.dataType=d.PixelType.HALF_FLOAT;t.internalFormat=d.SizedPixelFormat.R16F;t.samplingMode=d.TextureSamplingMode.NEAREST;const r=new l.TextureDescriptor;r.dataType=d.PixelType.HALF_FLOAT;r.internalFormat=d.SizedPixelFormat.RGBA16F;r.samplingMode=d.TextureSamplingMode.NEAREST;const y=
{[c.ColorFormat.RED]:x,[c.ColorFormat.RG]:w,[c.ColorFormat.RGBA4]:q,[c.ColorFormat.RGBA]:v,[c.ColorFormat.RGBA_MIPMAP]:p,[c.ColorFormat.R16F]:t,[c.ColorFormat.RGBA16F]:r};l=new l.TextureDescriptor;l.pixelFormat=d.PixelFormat.DEPTH_STENCIL;l.dataType=d.PixelType.UNSIGNED_INT_24_8;l.samplingMode=d.TextureSamplingMode.NEAREST;l.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const D={[c.DepthFormat.DEPTH_STENCIL_TEXTURE]:l,[c.DepthFormat.DEPTH16_BUFFER]:new e.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT16,
4)};a.FBOCache=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedColorAttachment":function(){define(["exports","./ManagedFBOAttachment","./ManagedFBObject"],function(a,b,h){class c extends b.ManagedFBOAttachment{constructor(k,m,d){super(k,m,d);this.attachment=m;this.type=h.AttachmentType.COLOR}}a.ManagedColorAttachment=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBOAttachment":function(){define(["exports",
"./ManagedFBObject"],function(a,b){class h extends b.ManagedFBObject{constructor(c,k,m){super(c,m);this.attachment=k;this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}}a.ManagedFBOAttachment=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedDepthAttachment":function(){define(["exports","./ManagedFBOAttachment","./ManagedFBObject"],function(a,b,h){class c extends b.ManagedFBOAttachment{constructor(){super(...arguments);
this.type=h.AttachmentType.DEPTH}}a.ManagedDepthAttachment=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOPool":function(){define(["exports","../../../../core/MemCachePool","../../../../core/PooledArray"],function(a,b,h){class c{constructor(k,m){this._last=new h;this._incarnation=0;this._cache=new b.MemCachePool(k,m)}destroy(){this._last?.forAll(k=>k.dispose());this._last=null;this._cache.destroy()}set interactive(k){k&&!this._last?this._last=
new h:k||(this._last?.forAll(m=>m.dispose()),this._last=null)}clean(){this._last?.filterInPlace(k=>k.incarnation<this._incarnation?(this._cache.put(k.key,k),!1):!0)}frame(){++this._incarnation}pop(k){if(this._last){const m=this._last.find(d=>d.key===k);if(m)return this._last.removeUnordered(m),m}return this._cache.pop(k)}put(k){k.incarnation=this._incarnation;this._last?this._last.push(k):this._cache.put(k.key,k)}get usedMemory(){return this._last?.reduce((k,m)=>k+m.usedMemory,0)??0}}a.FBOPool=c;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../effects/RenderPlugin ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){a.RenderPassManager=class extends v.SyncPreparesRenderPlugin{constructor(){super({});this._passes=null;this.produces=new Map([[t.RenderSlot.OPAQUE_MATERIAL,E=>this._produces(E)],[t.RenderSlot.TRANSPARENT_MATERIAL,E=>this._passes&&0<this._passes.materialTransparent.count?this._produces(E):!1],[t.RenderSlot.INTEGRATED_MESH,E=>this._produces(E)]]);this._materialPassParameters=new u.MaterialPassParameters;this._shadowPassParameters=new u.ShadowMapPassParameters;
this._highlightPassParameters=new u.HighlightPassParameters;this._systems=new Set}initializeRenderContext(E){this._context=E;const A=E.renderContext.rctx;E=E.techniqueRepository;this._passes={materialOpaque:new x.RenderPass(A,E),materialTransparent:new x.RenderPass(A,E,x.RenderPassSorting.BackToFront),materialIntegratedMesh:new x.RenderPass(A,E),shadowMap:new x.RenderPass(A,E),highlight:new x.RenderPass(A,E),highlightIntegratedMesh:new x.RenderPass(A,E),highlightShadowMap:new x.RenderPass(A,E),defaultShadowMap:new x.RenderPass(A,
E)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null;this._systems.clear()}register(E){this._systems.add(E)}_produces(E){return 0===this._systems.size||null===this._passes?!1:E===w.ShaderOutput.Highlight?0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count:E===w.ShaderOutput.ShadowHighlight?0<this._passes.highlight.count:!0}prepareRender(E){if(0!==this._systems.size&&null!==this._passes){for(const A of Object.values(this._passes))A.prepareSubmit();
this._systems.forEach(A=>A.submit(this._passes,E.bindParameters));for(const A of Object.values(this._passes))A.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(E){if(0===this._systems.size)return null;const A=E.bindParameters;this._updateParameters(A.camera,E.output===w.ShaderOutput.Shadow||E.output===w.ShaderOutput.ShadowHighlight||E.output===w.ShaderOutput.ShadowExcludeHighlight?this._shadowPassParameters:E.output===w.ShaderOutput.Highlight?this._highlightPassParameters:
this._materialPassParameters,A.slot===t.RenderSlot.TRANSPARENT_MATERIAL);this._materialPassParameters.output=E.output;return this._invoke(E,(B,F)=>B.prepare(F,E.bindParameters))}renderNode(E,A){this._invoke(E,(B,F)=>B.dispatch(F,E.bindParameters,A))}_invoke(E,A){if(null===this._passes)return null;switch(E.bindParameters.slot){case t.RenderSlot.OPAQUE_MATERIAL:switch(E.output){case w.ShaderOutput.Color:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialOpaque,
this._materialPassParameters);case w.ShaderOutput.Highlight:return A(this._passes.highlight,this._highlightPassParameters);case w.ShaderOutput.Shadow:return A(this._passes.shadowMap,this._shadowPassParameters);case w.ShaderOutput.ShadowHighlight:return A(this._passes.highlightShadowMap,this._shadowPassParameters);case w.ShaderOutput.ShadowExcludeHighlight:return A(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case t.RenderSlot.TRANSPARENT_MATERIAL:switch(E.output){case w.ShaderOutput.Color:case w.ShaderOutput.Alpha:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialTransparent,
this._materialPassParameters)}break;case t.RenderSlot.INTEGRATED_MESH:switch(E.output){case w.ShaderOutput.Color:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialIntegratedMesh,this._materialPassParameters);case w.ShaderOutput.Highlight:return A(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(E){const A=new p.DepthRange;this._systems.forEach(B=>
p.union(A,B.queryShadowCasterDepthRange(E)));return A}_updateParameters(E,A,B){const F=E.viewInverseTransposeMatrix;n.set(r,F[3],F[7],F[11]);D.set(r);n.copy(A.transformWorldFromViewTH,D.high);n.copy(A.transformWorldFromViewTL,D.low);n.copy(A.slicePlaneLocalOrigin,r);f.fromMat4(A.transformViewFromCameraRelativeRS,E.viewMatrix);e.copy(A.transformProjFromView,E.projectionMatrix);A.identifier===u.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=B,f.transpose(y,A.transformViewFromCameraRelativeRS),
f.invert(A.transformNormalViewFromGlobal,y))}};a.RenderPassManager=b.__decorate([d.subclass("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],a.RenderPassManager);const r=l.create(),y=g.create(),D=new q.TwoVectorPosition;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(a,b,h,c){a.RenderPassSorting=
void 0;(function(d){d[d.FrontToBack=0]="FrontToBack";d[d.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));class k{constructor(d,f,g=a.RenderPassSorting.FrontToBack){this._rctx=d;this._techniqueRepository=f;this._sorting=g;this._draws=new b({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(d,f,g,e){const n=this._draws.pushNew();n.geometry=f;
n.geometryRanges=g;n.material=d;n.depthSquaredHint=e;n.indexType=(f.indexed?f.vao.indexBuffer.indexType:null)??0}prepare(d,f){return this._draws.map(g=>g.material.prepareTechnique(this._techniqueRepository,d,f,g.geometry.parameters))}dispatch(d,f,g){const e=this._rctx;this._previouslyBoundDraw.clear();let n=null;const l=this._draws.length;for(let w=0;w<l;w++){var u=g[w];if(u!==n||u.configuration.transparencyPassType!==h.TransparencyPassType.NONE)e.bindTechnique(u,f,d),n=u;var x=this._draws.data[w];
const q=x.geometry;e.bindVAO(q.vao);this._previouslyBoundDraw.get(u)!==x.material&&(u.program.bindDraw(x.material,f,d),this._previouslyBoundDraw.set(u,x.material));u=x.geometryRanges;const v=u.length;if(0!==x.indexType){const p=m.get(x.indexType);for(let t=0;t<v;t+=2)e.drawElements(q.primitiveType,u[t+1],x.indexType,u[t]*p)}else for(x=0;x<v;x+=2)e.drawArrays(q.primitiveType,u[x],u[x+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const d=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;
this._draws.sort((f,g)=>{const e=d*(f.depthSquaredHint-g.depthSquaredHint);return 0!==e?e:f.geometry.vao.byteSize-g.geometry.vao.byteSize})}get count(){return this._draws.length}}const m=new Map;m.set(c.DataType.UNSIGNED_BYTE,1);m.set(c.DataType.UNSIGNED_SHORT,2);m.set(c.DataType.UNSIGNED_INT,4);a.RenderPass=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderNodes":function(){define(["exports","../../../../core/Logger","../../../../core/PooledArray"],
function(a,b,h){class c{constructor(k){this._context=k;this._nodes=new h}destroy(){this._nodes.forEach(k=>this.remove(k));this._nodes.clear()}add(k){this._nodes.push(k)}remove(k){this._nodes.remove(k)?.destroy()}produces(k){return this._nodes.some(({produces:m})=>m===k)}require(k,m){return null==m?this._nodes.reduce((d,{consumes:f})=>d+(f.required.includes(k)?1:0),0):this._nodes.reduce((d,{consumes:f,produces:g})=>d+(f.required.includes(k)&&g===m?1:0),0)}render(k,m){const d=k.name,f=this._nodes.filter(({produces:g})=>
g===d);if(0===f.length)return k;m.set(d,k);f.forEach(g=>{const e=[];for(const n of g.consumes.required){const l=m.get(n);if(!l)return;e.push(l)}try{const n=g.doRender(e,this._context);n&&n!==k&&(k.release(),k=n,m.set(d,k))}catch(n){b.getLogger(g).errorOnce(n)}});return k}}a.RenderNodes=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginManager":function(){define("exports ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/signal ../core/shaderLibrary/ShaderOutput ./RenderPlugin ../lib/basicInterfaces ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(l){this._context=l;this._renderPlugins=new b;this._slots=[];this._renderVersion=c.signal(0);for(l=0;l<e.RenderSlot.MAX_SLOTS;++l)this._slots[l]=[]}destroy(){this._renderPlugins.forEach(l=>l.destroy());this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(l,u){const x=()=>{if(u?.aborted)throw l.uninitializeRenderContext(),h.createAbortError();this._renderPlugins.push(l);l.produces.forEach((q,v)=>{this._slots[v].push(l)});this._context.requestRender();
this._renderVersion.value++},w=l.initializeRenderContext(this._context,u);if(h.isPromiseLike(w))return w.then(x);x()}remove(l){if(null!=this._renderPlugins.removeUnordered(l)){for(let u=0;u<this._slots.length;++u)this._slots[u]=this._slots[u].filter(x=>x!==l);l.uninitializeRenderContext();this._context.requestRender();this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(l=>{l.prepareRender&&l.prepareRender(this._context.renderContext)})}updateAnimation(l){let u=!1;this._renderPlugins.forAll(x=>
{x.updateAnimation&&(u=x.updateAnimation(l)||u)});return u}renderFeatureChanged(){this._renderPlugins.forAll(l=>{l.renderFeatureChanged&&l.renderFeatureChanged()})}prepare(l){this._context.renderContext.bindParameters.slot=l;this._slots[l].forEach(u=>{const x=u.produces.get(l);x&&x(k.ShaderOutput.Color)&&(m.isPrepareRenderPlugin(u)&&u.prepareTechnique(this._context.renderContext),m.isPreparesRenderPlugin(u)&&u.prepareTechniques(this._context.renderContext))})}_getRenderables(l){this._context.renderContext.bindParameters.slot=
l;const u=this._context.renderContext.output??k.ShaderOutput.Color,x=new Map;this._slots[l].forEach(w=>{var q=w.produces.get(l);!q||!q(u)||w.isDecoration&&this._context.renderContext.bindParameters.decorations===d.Decorations.OFF||(m.isPrepareRenderPlugin(w)?(q=w.prepareTechnique(this._context.renderContext),null!=q&&x.set(w,q)):m.isPreparesRenderPlugin(w)?(q=w.prepareTechniques(this._context.renderContext),null!=q&&x.set(w,q)):x.set(w,null))});return x}render(l,u=null,x=null){this._getRenderables(l).forEach((w,
q)=>x=q.renderNode(this._context.renderContext,w,u,x));return x}queryDepthRange(l){const u=new f.DepthRange;this._renderPlugins.forAll(x=>{x=x.queryDepthRange?.(l);f.union(u,x)});return u}get updating(){return 0<=this._renderVersion.value&&this._renderPlugins.some(l=>l.running)}produces(l,u=k.ShaderOutput.Color){return this._slots[l].some(x=>(x=x.produces.get(l))?x(u):!1)}consumes(l){return this._renderPlugins.some(u=>u.consumes().required.includes(l))}getMaterialRenderer(l){return this._renderPlugins.find(u=>
u.materialReference===l)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(l=>l.materialReference&&0===l.numGeometries?(l.destroy(),!1):!0)}get hasDecorations(){return this._renderPlugins.some(l=>l.isDecoration)}get hasOccludees(){return this._renderPlugins.some(l=>l.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((l,u)=>l|u.renderOccludedFlags,g.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((l,u)=>null!==u.materialReference?l:
l+(u.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}}a.RenderPluginManager=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/blit/Blit":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../RenderPlugin ../../lib/RenderSlot ../../../../../chunks/Compositing.glsl ../../shaders/CompositingTechnique ../../shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){a.Blit=class extends f.SyncRenderPlugin{constructor(u){super(u);this._context=null;this.opacity=1;this.alphaMode=l.AlphaMode.None;this._blitConfiguration=new l.CompositingTechniqueConfiguration;this._blitParameters=new e.CompositingPassParameters;this.produces=new Map([[g.RenderSlot.BLIT,()=>null!=this._context]])}consumes(){return f.ConsumesCompositeColor}initializeRenderContext(u){this._context=u}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(u,
x,w,q){x=w?.get("composite-color")?.getTexture();if(!this._context||!x)return q;w=this._context.techniqueRepository.acquire(n.CompositingTechnique,this._blitConfiguration);if(!w?.compiled)return this._context.requestRender(),q;u.rctx.bindFramebuffer(q?.fbo);this._blitParameters.texture=x;this._blitParameters.opacity=this.opacity;u.rctx.bindTechnique(w,u.bindParameters,this._blitParameters);u.rctx.screen.draw();w.release();return q}};b.__decorate([h.property()],a.Blit.prototype,"_context",void 0);
b.__decorate([h.property()],a.Blit.prototype,"opacity",void 0);b.__decorate([h.property()],a.Blit.prototype,"alphaMode",void 0);a.Blit=b.__decorate([d.subclass("esri.views.3d.webgl-engine.effects.blit.Blit")],a.Blit);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/Highlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../webgl/ManagedFBO ../RenderPlugin ./HighlightApplyTechnique ./HighlightBlurTechnique ./HighlightDefaults ./HighlightDownsampleTechnique ./HighlightPassParameters ../../lib/DefaultVertexAttributeLocations ../../lib/DefaultVertexBufferLayouts ../../lib/RenderSlot ../../lib/VertexArrayObject ../../../../../chunks/HighlightBlur.glsl ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G){a.Highlight=class extends u.SyncRenderPlugin{constructor(H){super(H);this._context=null;this._passParameters=new p.HighlightPassParameters;this._downsampleDrawParameters=new A.HighlightDownsampleDrawParameters;this._blurDrawParameters=new E.HighlightBlurDrawParameters;this._blurColorFormat=c("mac")?l.ColorFormat.RGBA:l.ColorFormat.RGBA4;this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0};
this.produces=new Map([[y.RenderSlot.HIGHLIGHT,()=>!0]])}consumes(){return u.ConsumesHighlight}initializeRenderContext(H){this._context=H;null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(w.HighlightBlurTechnique));null==this._downsampleTechnique&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(v.HighlightDownsampleTechnique));null==this._applyTechnique&&(this._applyTechnique=this._context.techniqueRepository.acquire(x.HighlightApplyTechnique));
this.addHandles([m.watch(()=>this.view.highlightOptions.color,L=>{this._passParameters.color=h.unitRGBAFromColor(L??q.defaultColor);this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color);this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloColor,L=>{this._passParameters.haloColor=null!=L?h.unitRGBAFromColor(L):this._passParameters.color;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloOpacity,
L=>{this._passParameters.haloOpacity=L??q.defaultHaloOpacity;this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.fillOpacity,L=>{this._passParameters.fillOpacity=L??q.defaultFillOpacity;this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity;this._context.requestRender()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=
k.releaseMaybe(this._blurTechnique);this._downsampleTechnique=k.releaseMaybe(this._downsampleTechnique);this._applyTechnique=k.releaseMaybe(this._applyTechnique);this._grid.coverage=k.releaseMaybe(this._grid.coverage);this._grid.vao=k.disposeMaybe(this._grid.vao)}renderNode(H,L,C,z){var J=C?.get("highlight")?.getTexture();if(this._context&&J)if(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled){L=H.bindParameters.camera;var K=L.pixelRatio;C=Math.ceil(L.fullWidth/
K);K=Math.ceil(L.fullHeight/K);var I=this._context.fbos,M=I.rctx;this._gridUpdateResources(J);this._gridComputeCoverage(J,H.bindParameters);this._passParameters.highlightTexture=J;this._passParameters.coverageTexture=this._grid.coverage?.getTexture();var {width:S,height:N}=J.descriptor;n.set(this._passParameters.coverageRounding,S/(Math.ceil(S/A.gridCellPixelSize)*A.gridCellPixelSize),N/(Math.ceil(N/A.gridCellPixelSize)*A.gridCellPixelSize));var V=this._grid.vao;M.bindVAO(V);var Q=I.acquire(C,K,"highlight blur",
this._blurColorFormat);M.setClearColor(0,0,0,0);M.clearSafe(F.ClearBufferBit.COLOR_BUFFER_BIT);M.setViewport(0,0,C,K);this._blurDrawParameters.blurInputTexture=J;n.set(this._blurDrawParameters.blurSize,1/C,0);J=M.bindTechnique(this._blurTechnique,H.bindParameters,this._passParameters,this._blurDrawParameters);M.drawArrays(this._blurTechnique.primitiveType,0,G.vertexCount(V,"geometry"));C=I.acquire(C,K,"highlight blur",this._blurColorFormat);M.setClearColor(0,0,0,0);M.clearSafe(F.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=Q.getTexture();n.set(this._blurDrawParameters.blurSize,0,1/K);J.bindDraw(this._blurDrawParameters,H.bindParameters,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,0,G.vertexCount(V,"geometry"));M.bindFramebuffer(z?.fbo);M.setViewport4fv(L.fullViewport);this._passParameters.blurTexture=C.getTexture();M.bindTechnique(this._applyTechnique,H.bindParameters,this._passParameters);M.drawArrays(this._applyTechnique.primitiveType,0,G.vertexCount(V,
"geometry"));Q.release();C.release()}else this._context.requestRender()}_gridUpdateResources(H){if(this._context){var L=this._context.fbos.rctx,C=this._grid,z=Math.ceil(H.descriptor.height/A.gridCellPixelSize),J=Math.ceil(H.descriptor.width/A.gridCellPixelSize);if(!C.vao||C.verticalCellCount!==z||C.horizontalCellCount!==J){C.verticalCellCount=z;C.horizontalCellCount=J;H=z+1;var K=J+1;z=1/z;J=1/J;var I=new Float32Array(24*H*K),M=0;for(let S=0;S<H;S++)for(let N=0;N<K;N++)I[M++]=(N-.5)*J*2-1,I[M++]=
(S-.5)*z*2-1,I[M++]=N*J,I[M++]=S*z,I[M++]=(N+.5)*J*2-1,I[M++]=(S-.5)*z*2-1,I[M++]=N*J,I[M++]=S*z,I[M++]=(N-.5)*J*2-1,I[M++]=(S+.5)*z*2-1,I[M++]=N*J,I[M++]=S*z,I[M++]=(N-.5)*J*2-1,I[M++]=(S+.5)*z*2-1,I[M++]=N*J,I[M++]=S*z,I[M++]=(N+.5)*J*2-1,I[M++]=(S-.5)*z*2-1,I[M++]=N*J,I[M++]=S*z,I[M++]=(N+.5)*J*2-1,I[M++]=(S+.5)*z*2-1,I[M++]=N*J,I[M++]=S*z;C.vao?.dispose();C.vao=new D.VertexArrayObject(L,t.Default3D,{geometry:r.Pos2Tex},{geometry:B.BufferObject.createVertex(L,F.Usage.STATIC_DRAW,I)})}}}_gridComputeCoverage(H,
L){if(this._context){var C=this._context.fbos.rctx,z=this._grid,J=H.descriptor,K=Math.ceil(J.width/A.gridCellPixelSize);J=Math.ceil(J.height/A.gridCellPixelSize);this._downsampleDrawParameters.input=H;z.coverage?.release();z.coverage=this._context.fbos.acquire(K,J,"highlight coverage",l.ColorFormat.RG);C.bindTechnique(this._downsampleTechnique,L,this._passParameters,this._downsampleDrawParameters);C.setViewport(0,0,K,J);C.screen.draw()}}get test(){return{coverage:this._grid.coverage}}};b.__decorate([d.property()],
a.Highlight.prototype,"_context",void 0);b.__decorate([d.property()],a.Highlight.prototype,"view",void 0);a.Highlight=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.Highlight")],a.Highlight);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightApply.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends c.ShaderTechnique{initializeProgram(n){return new m.Program(n.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams})}}e.shader=new h.ReloadableShaderModule(d.HighlightApply,()=>new Promise((n,l)=>a(["../../shaders/HighlightApply.glsl"],n,
l)));b.HighlightApplyTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ./HighlightDownsample.glsl".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(){const u=new d.ShaderBuilder,{vertex:x,fragment:w}=u,q=x.code,v=w.code;u.attributes.add(g.VertexAttribute.POSITION,"vec2");u.varyings.add("uv","vec2");u.attributes.add(g.VertexAttribute.UV0,"vec2");x.uniforms.add(new f.Texture2DPassUniform("coverageTex",p=>p.coverageTexture),new c.Float2PassUniform("coverageRounding",p=>p.coverageRounding));q.add(m.glsl`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);w.uniforms.add(new f.Texture2DPassUniform("tex",p=>p.blurTexture),new f.Texture2DPassUniform("highlightTexture",p=>p.highlightTexture),new k.Float4PassUniform("uColor",p=>p.color),new k.Float4PassUniform("haloColor",p=>p.haloColor),new k.Float4PassUniform("opacities",p=>b.set(l,p.haloOpacity,p.haloOpacityOccluded,p.fillOpacity,p.fillOpacityOccluded)));w.constants.add("inner","float",1-(e.outlineSize-e.blurSize)/e.outlineSize);v.add(m.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return u}const l=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=h;a.build=n})},"esri/chunks/HighlightDownsample.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform"],function(a,b,h,c,
k){function m(){const g=new c.ShaderBuilder,{outputs:e,fragment:n}=g;g.include(b.ScreenSpacePass);n.uniforms.add(new k.Texture2DDrawUniform("textureInput",l=>l.input));n.constants.add("sampleArea","int",5);e.add("fragGrid","vec2");n.code.add(h.glsl`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${h.glsl.int(32)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`);return g}class d extends h.NoParameters{}const f=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:d,blurSize:.4,build:m,gridCellPixelSize:32,outlineSize:9},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=f;a.HighlightDownsampleDrawParameters=d;a.blurSize=.4;a.build=m;a.gridCellPixelSize=32;a.outlineSize=9})},"esri/views/3d/webgl-engine/effects/highlight/HighlightBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.HighlightBlur,()=>new Promise((e,n)=>a(["../../shaders/HighlightBlur.glsl"],e,n)));b.HighlightBlurTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g){function e(){const u=new m.ShaderBuilder,{attributes:x,varyings:w,vertex:q,fragment:v}=u;x.add(g.VertexAttribute.POSITION,"vec2");x.add(g.VertexAttribute.UV0,"vec2");w.add("blurCoordinate","vec3");q.uniforms.add(new f.Texture2DPassUniform("coverageTex",p=>p.coverageTexture),new c.Float2PassUniform("coverageRounding",p=>p.coverageRounding));q.code.add(k.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`);v.uniforms.add(new h.Float2DrawUniform("blurSize",p=>p.blurSize),new d.Texture2DDrawUniform("tex",p=>p.blurInputTexture));v.code.add(k.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return u}class n extends k.NoParameters{constructor(){super(...arguments);this.blurSize=b.create()}}const l=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:n,build:e},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=l;a.HighlightBlurDrawParameters=n;a.build=e})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.HighlightDownsample,()=>new Promise((e,n)=>a(["../../shaders/HighlightDownsample.glsl"],e,n)));b.HighlightDownsampleTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightPassParameters":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../core/shaderModules/interfaces"],function(a,b,h,c){class k extends c.NoParameters{constructor(){super(...arguments);this.color=h.fromValues(1,0,1,1);this.haloColor=h.fromValues(1,0,1,1);this.haloOpacity=1;this.haloOpacityOccluded=.25;this.fillOpacity=.2;this.fillOpacityOccluded=.05;this.coverageRounding=b.fromValues(1,1)}}a.HighlightPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../ViewingMode ../RenderPlugin ./HighlightDefaults ./ShadowHighlightTechnique ../../lib/RenderSlot".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){a.ShadowHighlight=class extends x.SyncRenderPlugin{constructor(t){super(t);this._maxOpacity=1;this._passParameters=new q.ShadowHighlightPassParameters;this._shadowDifference=.2;this._context=null;this.produces=new Map([[v.RenderSlot.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return x.ConsumesHighlight}initializeRenderContext(t){this._context=t;this.addHandles([k.watch(()=>this.view.highlightOptions.shadowOpacity,r=>{this._passParameters.shadowOpacity=
r??w.defaultShadowOpacity;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowDifference,r=>{this._shadowDifference=r??w.defaultShadowDifference;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowColor,r=>{this._passParameters.shadowColor=h.unitRGBAFromColor(r??w.defaultShadowColor);this._updateMaxOpacity()},k.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=
this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&null==this._technique&&(this._technique=this._context.techniqueRepository.acquire(q.ShadowHighlightTechnique))}renderNode(t,r,y,D){y=y?.get("highlight")?.getTexture();this._context&&y&&this._isVisible&&(this._technique?.compiled?
(r=t.bindParameters,r.shadowMap.enabled&&r.linearDepth&&(this._passParameters.highlight=y,this._passParameters.origin=r.camera.center,t=t.rctx,t.bindFramebuffer(D?.fbo),t.bindTechnique(this._technique,r,this._passParameters),t.screen.draw())):this._context.requestRender())}updateParameters(t,r){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,t.relativeElevation);t=this.viewingMode===u.ViewingMode.Global?n.normalize(p,t.center):n.set(p,0,0,1);r=n.dot(t,r);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*r,0,1));this._isVisible&&this.enable()}get _isVisible(){const {opacityElevation:t,dayNightTerminator:r}=this._passParameters;return.001953125<=this._maxOpacity*t*r}};b.__decorate([m.property()],a.ShadowHighlight.prototype,"_context",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"view",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"viewingMode",void 0);a.ShadowHighlight=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],
a.ShadowHighlight);const p=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique":function(){define("require exports ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../shaders/ShadowConfiguration ../../../../../chunks/ShadowHighlight.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){class u extends c.ReadShadowMapPassParameters{constructor(){super(...arguments);this.shadowColor=h.fromValues(1,0,1,1);this.shadowOpacity=.2;this.occludedShadowOpacity=.1;this.dayNightTerminator=this.opacityElevation=1}}class x extends m.ShaderTechnique{constructor(w){super(w,new g.ShadowConfiguration,()=>this.destroy())}initializeProgram(w){return new f.Program(w.rctx,x.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(n.BlendFactor.SRC_ALPHA,
n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return n.PrimitiveType.TRIANGLE_STRIP}}x.shader=new k.ReloadableShaderModule(e.ShadowHighlight,()=>new Promise((w,q)=>a(["../../shaders/ShadowHighlight.glsl"],w,q)));b.ShadowHighlightPassParameters=u;b.ShadowHighlightTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.receiveShadows=!0}}b.__decorate([h.parameter()],c.prototype,"receiveShadows",void 0);a.ShadowConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){function y(A){const B=new p.ShaderBuilder;B.include(g.ReadShadowMapPass,A);B.include(e.CameraSpace);B.include(m.ScreenSpacePass);A=B.fragment;A.include(n.RgbaFloatEncoding);A.include(f.ReadLinearDepth);A.uniforms.add(new t.Texture2DPassUniform("defaultDepthTex",(F,G)=>G.shadowMap.getSnapshot(r.SnapshotSlot.ExcludeHighlight)),new t.Texture2DPassUniform("highlightDepthTex",(F,G)=>G.shadowMap.getSnapshot(r.SnapshotSlot.Highlight)),new t.Texture2DPassUniform("depthMap",
(F,G)=>G.linearDepth?.getTexture()),new t.Texture2DPassUniform("highlightTexture",F=>F.highlight),new x.Float4PassUniform("uColor",F=>F.shadowColor),new l.Float2PassUniform("nearFar",(F,G)=>G.camera.nearFar),new w.FloatPassUniform("opacity",F=>F.shadowOpacity),new w.FloatPassUniform("occludedOpacity",F=>F.occludedShadowOpacity),new w.FloatPassUniform("terminationFactor",F=>F.opacityElevation*F.dayNightTerminator),new u.Float3PassUniform("lightingMainDirectionView",(F,G)=>c.normalize(E,c.transformMat4(E,
G.lighting.mainLight.direction,G.camera.viewInverseTransposeMatrix))),new v.Matrix4PassUniform("inverseViewMatrix",(F,G)=>b.invert(D,b.translate(D,G.camera.viewMatrix,G.camera.center))));A.constants.add("unoccludedHighlightFlag","vec4",d.unoccludedHighlightFlag);A.code.add(q.glsl`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${q.glsl.float(.99999)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${q.glsl.float(.025)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `);return B}const D=h.create(),E=k.create();h=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=h;a.build=y})},"esri/views/3d/webgl-engine/effects/smaa/SMAA":function(){define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../webgl/ManagedFBO ../RenderPlugin ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/RenderFeature ../../lib/RenderSlot ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(B,F,G,H){const L=new E.TextureDescriptor;L.pixelFormat=G;L.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;L.width=H.width;L.height=H.height;L.samplingMode=F;return new D.Texture(B,L,H)}b.SMAA=class extends x.SyncRenderPlugin{constructor(B){super(B);this._searchTexture=this._areaTexture=this._context=null;this._isEnabled=!1;this._smaaParameters=new p.SMAAPassParameters;this.produces=new Map([[r.RenderSlot.ANTIALIASING,()=>this._isEnabled&&
null!=this._context]])}consumes(){return x.ConsumesCompositeColor}get updating(){return null!=this._abortController}initializeRenderContext(B){this._context=B;this.addHandles([m.watch(()=>this.view.qualitySettings.antialiasingEnabled,()=>this.renderFeatureChanged(),m.syncAndInitial)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(t.RenderFeature.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable();this._context=
null}async enable(){if(!this._isEnabled&&this._context&&!this._abortController)if(this._edgeTechnique??(this._edgeTechnique=this._context.techniqueRepository.acquire(v.SMAAEdgeDetectTechnique)),this._blendTechnique??(this._blendTechnique=this._context.techniqueRepository.acquire(w.SMAABlendWeightsTechnique)),this._blurTechnique??(this._blurTechnique=this._context.techniqueRepository.acquire(q.SMAABlurTechnique)),this._areaTexture&&this._searchTexture)this._isEnabled=!0;else{this._abortController=
new AbortController;var B=this._abortController.signal;try{const F=await new Promise((G,H)=>a(["./SMAAData"],G,H));await this._loadTextures(this._context,F,B);this._context?.requestRender()}catch{}this._abortController=null}}async _loadTextures(B,F,G){k.throwIfAborted(G);if(!B)throw k.createAbortError();const [H,L]=await Promise.allSettled([l.requestImage(F.areaTexture,{signal:G}),l.requestImage(F.searchTexure,{signal:G})]);k.throwIfAborted(G);"fulfilled"===H.status&&"fulfilled"===L.status&&(this._areaTexture=
A(B.fbos.rctx,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB,H.value),this._searchTexture=A(B.fbos.rctx,y.TextureSamplingMode.NEAREST,y.PixelFormat.LUMINANCE,L.value),this._isEnabled=!0)}_disposeTextures(){this._areaTexture=c.disposeMaybe(this._areaTexture);this._searchTexture=c.disposeMaybe(this._searchTexture)}disable(){this._abortController=c.abortMaybe(this._abortController);this._isEnabled=!1}destroy(){this.disable();this._disposeTextures()}renderNode(B,F,G,H){F=G?.get("composite-color")?.getTexture();
if(!(this._isEnabled&&this._context&&G&&F))return H;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),H;G=F.descriptor.width;const L=F.descriptor.height,C=this._context.fbos;B=B.rctx;B.setViewport(0,0,G,L);const z=C.acquire(G,L,"smaa edges",u.ColorFormat.RG);B.setClearColor(0,0,0,1);B.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.color=F;B.bindTechnique(this._edgeTechnique,null,this._smaaParameters);
B.screen.draw();F=C.acquire(G,L,"smaa blend");B.setClearColor(0,0,1,1);B.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=z.getTexture();this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;B.bindTechnique(this._blendTechnique,null,this._smaaParameters);B.screen.draw();B.bindFramebuffer(H?.fbo);z.release();B.setClearColor(0,1,0,1);B.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=F.getTexture();
B.bindTechnique(this._blurTechnique,null,this._smaaParameters);B.screen.draw();F.release();return H}};h.__decorate([d.property()],b.SMAA.prototype,"view",void 0);h.__decorate([d.property()],b.SMAA.prototype,"_context",void 0);h.__decorate([d.property()],b.SMAA.prototype,"_abortController",void 0);h.__decorate([d.property({readOnly:!0})],b.SMAA.prototype,"updating",null);b.SMAA=h.__decorate([n.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],b.SMAA);Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/BlendWeights.glsl ../../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}
g.shader=new h.ReloadableShaderModule(d.BlendWeights,()=>new Promise((e,n)=>a(["../../shaders/BlendWeights.glsl"],e,n)));b.SMAABlendWeightsTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,h,c,k){function m(){const g=new c.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new k.Texture2DPassUniform("edgesTexture",e=>e.inputTexture),new k.Texture2DPassUniform("areaTexture",e=>e.areaTexture),new k.Texture2DPassUniform("searchTexture",e=>e.searchTexture));g.fragment.code.add(h.glsl`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${h.glsl.int(d.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${h.glsl.int(d.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${h.glsl.int(d.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${h.glsl.int(d.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${h.glsl.int(d.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${h.glsl.int(d.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`);return g}const d={maxSearchSteps:8,maxDistanceAreaTex:16},f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=f;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/Blur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.Blur,()=>new Promise((e,n)=>a(["../../shaders/Blur.glsl"],e,n)));b.SMAABlurTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,h,c,k){function m(){const f=new c.ShaderBuilder;f.include(b.ScreenSpacePass);f.fragment.uniforms.add(new k.Texture2DPassUniform("blendWeightsTexture",g=>g.inputTexture),new k.Texture2DPassUniform("colorTexture",g=>g.color));f.fragment.code.add(h.glsl`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return f}const d=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.Blur=d;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/EdgeDetect.glsl ../../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f){class g extends c.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,
g.shader.get().build(),k.Default3D)}initializePipeline(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})}}g.shader=new h.ReloadableShaderModule(d.EdgeDetect,()=>new Promise((e,n)=>a(["../../shaders/EdgeDetect.glsl"],e,n)));b.SMAAEdgeDetectTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,h,c,k){function m(){const g=new c.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",e=>e.color));g.outputs.add("fragEdges","vec2");g.fragment.code.add(h.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${h.glsl.float(d.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${h.glsl.float(d.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `);return g}const d={threshold:.05,localConstrastAdaption:2},f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=f;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAPassParameters":function(){define(["exports","../../core/shaderModules/interfaces"],function(a,b){class h extends b.NoParameters{}a.SMAAPassParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,b,h,c){class k{constructor(){this._step=f;this._dilation=1;this._firstIdleTime=c.Milliseconds(0)}frame(e,n){n?0===this._firstIdleTime&&(this._firstIdleTime=c.Milliseconds(performance.now())):this._firstIdleTime=c.Milliseconds(0);if(b("disable-feature:high-quality-idle"))this._dilation=1;else{n=n?performance.now()-this._firstIdleTime:0;if(n>=m+d){this._step=c.Milliseconds(Infinity);this._dilation=1;return}this._dilation=
n>=m?10:1}e=h.clamp(e/.5,f,g);this._step=Infinity===this._step?c.Milliseconds(e):c.Milliseconds(.9*this._step+e*(1-.9))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=c.Milliseconds(0)}}const m=c.Milliseconds(12E4),d=c.Milliseconds(1E4),f=c.Milliseconds(1E3),g=c.Milliseconds(1E3/30);a.AnimationTimeStep=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../webgl/ManagedFBO ./rendererUtils ./TransparencyPassType ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n{constructor(u,x){this._fbos=u;this.compositingHelper=x;this._height=this._width=4;this._clearColor=k.create()}dispose(){this._color=h.releaseMaybe(this._color);this.releaseBuffers()}get framebuffer(){this.color.attachDepth(this.depth);return this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(u,x,w){this._fbos.interactive=w===d.RendererTarget.Default;w=this._fbos.rctx;this._width=u.fullWidth;
this._height=u.fullHeight;e.ensureAttachmentMaxSize(this,w.parameters.maxTextureSize);u=this._color;this._color=null;this.releaseBuffers();c.copy(this._clearColor,x);return u}releaseBuffers(){this._color?.detachDepth();this._depth=h.releaseMaybe(this._depth)}renderHUDVisibility(u,x,w){if(u?.fbo.width!==this._width||u?.fbo.height!==this._height)u?.release(),u=this._fbos.acquire(this._width,this._height,"hud visibility",m.ColorFormat.RGBA4);u.attachDepth(w||this.depth);this._fbos.rctx.bindFramebuffer(u.fbo);
this._fbos.rctx.clearFramebuffer(l);x();u.detachDepth();return u}compositeToHUDVisibility(u,x){this._fbos.rctx.bindFramebuffer(u.hudVisibility?.fbo);this.compositingHelper.compositeHUD(u,x)}renderOITPass(u,x,w){let q,v;const {_width:p,_height:t}=this;switch(x){case f.TransparencyPassType.Color:q=this._fbos.acquire(p,t,w?"oit hud color":"oit color",m.ColorFormat.RGBA16F);v=[0,0,0,0];break;case f.TransparencyPassType.Alpha:q=this._fbos.acquire(p,t,w?"oit hud alpha":"oit alpha",m.ColorFormat.R16F);v=
[1,1,1,1];break;case f.TransparencyPassType.FrontFace:q=this._fbos.acquire(p,t,w?"oit hud front":"oit front"),v=[0,0,0,0]}w?q.acquireDepth(m.DepthFormat.DEPTH16_BUFFER):q.attachDepth(this.depth);this._fbos.rctx.bindFramebuffer(q.fbo);this._fbos.rctx.clearFramebuffer(v,w,w);u();q.detachDepth();return q}compositeToFramebuffer(u,x,w,q){this.bindFbo();this.compositingHelper.composite(u,x,w,q)}compositeTransparentOntoOpaque(u,x,w,q,v){v?(this._fbos.rctx.bindFramebuffer(v.fbo),this._fbos.rctx.setClearColor(0,
0,0,1E-13),this._fbos.rctx.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFbo();this.compositingHelper.compositeOIT(u,x.getTexture(),w.getTexture(),q.getTexture())}renderDepthDetached(u){this._bindTarget(this.color);u();this._bindTarget(this.color,this.depth)}renderToCachedFBO(u,x,w,q,v=m.ColorFormat.RGBA,p=m.DepthFormat.DEPTH16_BUFFER,t=this._width,r=this._height,y=null){if(u?.fbo.width!==t||u?.fbo.height!==r)u=h.releaseMaybe(u);u=u??this._fbos.acquire(t,r,x,v);y?.forEach(D=>u.acquireColor(D.attachment,
D.format));null!=p&&u.acquireDepth(p);this._fbos.rctx.bindFramebuffer(u.fbo);this._fbos.rctx.clearFramebuffer(q,!0,!0);w();return u}renderToTargets(u,x,w,q,v=!1,p=!1){this._bindTarget(x,w);this._fbos.rctx.clearFramebuffer(q,v,p);u();x.detachDepth()}bindFbo(){var u=null==this._color;this._bindTarget(this.color,this.depth);u&&(u=this._fbos.rctx,u.setClearStencil(0),u.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),u.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT|
g.ClearBufferBit.DEPTH_BUFFER_BIT|g.ClearBufferBit.STENCIL_BUFFER_BIT))}_bindTarget(u,x){u.attachDepth(x);this._fbos.rctx.bindFramebuffer(u.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color"));return this._color}updateColor(u,x){const w=this._ensureColor();w.attachDepth(this.depth);w.setName(x);this._color=u(w)}get depth(){this._depth||(this._depth=
this._fbos.acquireDepth(m.DepthFormat.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth"));return this._depth}}const l=[0,1,0,1];a.OffscreenRendering=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F){a.ShadowAccumulator=class extends h{constructor(H,L,C,z,J,K){super({});this.fbos=H;this._stage=C;this._prepareForShadowMapPass=z;this._renderToShadowMap=J;this._requestRender=K;this._sampleCount=this._progress=0;this._passParameters=new x.ReadShadowMapPassParameters;this._cachedLightDirections=[];this._depthRange=q.zero;this._cameraForcedForScreenshot=this._previewing=!1;this._shadowAccumulatorKey="shadowAccumulator";this._rctx=H.rctx;
this._bindParameters=new w.BindParameters(new t.ShadowMap(H,C.viewingMode),null);this._bindParameters.shadowMap.enabled=!0;this._vao=v.createQuadVAO(this._rctx);this._accumulationRenderer=new p.ShadowCastRenderer(L,this._rctx,this,K);this.addHandles([this._stage.view.resourceController.scheduler.registerTask(D.TaskPriority.SHADOW_ACCUMULATOR,this),d.watch(()=>C.renderView,I=>{this.removeHandles("renderView");null!=I&&this.addHandles(I.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=
!0),"renderView")},d.syncAndInitial),d.watch(()=>this._previewing,()=>this._requestRenderIfEnabled(),d.sync)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable();this.removeHandles(this._shadowAccumulatorKey);this._accumulationRenderer=m.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=m.disposeMaybe(this._fbo);this._vao=m.disposeMaybe(this._vao);this._accumulationTechniqueCached=m.releaseMaybe(this._accumulationTechniqueCached);
this._sampleCount=this._cachedLightDirections.length=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){null==this._accumulationTechniqueCached&&(this._accumulationTechniqueCached=new y.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&
!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&0<this._sampleCount}get canAccumulate(){return null!==this._bindParameters.linearDepth?.getTexture()&&this._depthRange!==q.zero&&this._opacityFromElevation>p.shadowCastDisabledElevationThreshold}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(H){const L=this._cachedLightDirections;if(!c.equals(L,
H,l.equals)){var C=Math.min(r.ShadowCastMaxSamples,H.length);this._sampleCount=L.length=C;for(let z=0;z<C;++z)L[z]=l.copy(L[z]??u.create(),H[z]);this._invalidate()}}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(H){this._accumulationRenderer.opacityFromElevation=H}get running(){return this._isRefining&&this.canAccumulate&&0<this._progress}runTask(H){for(this._prepareForShadowMapPass(this._bindParameters);!H.done&&!this._isDoneAccumulating;)this._accumulateShadow(),
H.madeProgress();this._requestRender()}renderAccumulation(H,L,C,z){this._depthRange=L;this._updateCamera(C);this._bindParameters.contentCamera=z;this._bindParameters.linearDepth=H;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();H=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);
for(L=0;L<H;++L)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}}render(H){this._accumulationRenderer.render(H)}setOptions(H){void 0!==H.enabled&&H.enabled!==(null!=this._fbo)&&(H.enabled?this._enable():this._disable());void 0!==H.previewing&&(this._previewing=H.previewing);void 0!==H.lightDirections&&(this._lightDirections=H.lightDirections);this._accumulationRenderer.setOptions(H)}readAccumulatedShadow(H,L){if(!this._isActive||!this._fbo||1>this._progress||0>H||
H>=this._fbo.width||0>L||L>=this._fbo.height)return 0;this._fbo.readPixels(H,L,1,1,E.PixelFormat.RED,E.PixelType.UNSIGNED_BYTE,G);return G[0]/this._progress}_enable(){this._progress=0;const H=new B.TextureDescriptor;H.pixelFormat=E.PixelFormat.RED;H.internalFormat=E.SizedPixelFormat.R8;H.wrapMode=E.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new A.FramebufferObject(this._rctx,H);this._requestRender()}_disable(){this._fbo=m.disposeMaybe(this._fbo);this._requestRender()}_invalidate(){this._progress=0;this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo);
this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(E.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const H=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(H,this._bindParameters,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(H.primitiveType,0,F.vertexCount(this._vao,"geometry"))}_updateCamera(H){const L=
this._fbo;if(null!=L){var C=this._bindParameters.camera;H.equals(C)||C.copyFrom(H);L.resize(H.fullWidth,H.fullHeight);this._opacityFromElevation=1-k.smoothstep(p.shadowCastDisableElevationMin,p.shadowCastDisableElevationMax,H.relativeElevation)}}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const H=this;return{lightDirections:this._lightDirections,get isDone(){return H._isDoneAccumulating},get isActive(){return H._isActive}}}};b.__decorate([f.property()],a.ShadowAccumulator.prototype,
"_progress",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_fbo",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isRefining",null);
b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isActive",null);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);b.__decorate([f.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=b.__decorate([n.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],
a.ShadowAccumulator);const G=new Uint8Array(1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){const q=1/512;a.ShadowCastRenderer=class extends h{constructor(v,p,t,r){super({});this._techniqueRepository=v;this._rctx=p;this._data=t;this._requestRender=r;this._passParameters=new l.ShadowCastVisualizePassParameters(this._data);this._techniqueConfig=new x.ShadowCastVisualizeTechniqueConfiguration;this._enabled=!1;this._vao=n.createQuadVAO(p)}normalizeCtorArgs(){return{}}dispose(){this._stop();this._vao=c.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);
this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(u.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}render(v){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var p=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(p,v,this._passParameters);this._rctx.drawArrays(p.primitiveType,0,w.vertexCount(this._vao,"geometry"))}}setOptions(v){void 0!==
v.enabled&&this._setEnabled(v.enabled);void 0!==v.color&&this._setColor(v.color);void 0!==v.threshold&&(this._threshold=v.threshold);void 0!==v.visualization&&(this._visualization=v.visualization);void 0!==v.bandSize&&(this._bandSize=v.bandSize);void 0!==v.bandsEnabled&&(this._bandsEnabled=v.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(v){this._passParameters.opacityFromElevation!==v&&(this._passParameters.opacityFromElevation=
v,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>q}get _threshold(){return this._passParameters.threshold}set _threshold(v){this._threshold!==v&&(this._passParameters.threshold=v,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(v){v!==this._visualization&&(this._techniqueConfig.visualization=v,this._techniqueRepository.release(this._technique),
this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(v){v!==this._bandSize&&(this._passParameters.bandSize=v,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(v){v!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=v,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(v){e.exactEquals(v,this._passParameters.color)||
(e.copy(this._passParameters.color,v),this._requestRenderIfRunning())}_setEnabled(v){v!==this._enabled&&(v?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0;this._requestRender()}_stop(){this._enabled=!1;this._requestRender()}};b.__decorate([k.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);
a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(p){const t=new e.ShaderBuilder,r=t.fragment;r.include(m.RgbaFloatEncoding);r.include(c.ReadLinearDepth);t.include(k.CameraSpace);t.include(h.ScreenSpacePass);const {visualization:y,bandsEnabled:D}=p;r.constants.add("inverseSampleValue","float",l.ShadowCastMaxSamples);r.uniforms.add(new n.Texture2DPassUniform("shadowCastMap",A=>A.shadowCastMap),new f.FloatPassUniform("sampleScale",A=>A.sampleScale),new f.FloatPassUniform("opacityFromElevation",A=>A.opacityFromElevation),
new d.Float4PassUniform("uColor",A=>A.color));p=y===u.ShadowCastVisualization.Gradient;const E=y===u.ShadowCastVisualization.Threshold;p&&D?r.uniforms.add(new f.FloatPassUniform("bandSize",A=>A.bandSize)):E&&r.uniforms.add(new f.FloatPassUniform("threshold",A=>A.threshold));r.code.add(g.glsl`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${E?g.glsl`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${p&&D?g.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${p?g.glsl`* strength`:""});
    }
  `);return t}class w extends g.NoParameters{constructor(p){super();this._data=p;this.sampleScale=0;this.opacityFromElevation=1;this.color=b.clone(q);this.bandSize=.1;this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const q=b.fromValues(.01,0,.25,1),v=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:w,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=v;a.ShadowCastVisualizePassParameters=w;a.build=x})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(v){const p=new l.ShaderBuilder,t=p.fragment;t.include(f.RgbaFloatEncoding);t.include(k.ReadLinearDepth);p.include(d.CameraSpace);p.include(c.ScreenSpacePass);p.include(m.ReadShadowMapPass,v);t.uniforms.add(new u.Texture2DPassUniform("shadowMap",(r,y)=>y.shadowMap.depthTexture),new u.Texture2DPassUniform("depthMap",(r,y)=>y.linearDepth?.getTexture()),new n.Matrix4PassUniform("inverseViewMatrix",(r,y)=>b.invert(q,b.translate(q,y.camera.viewMatrix,y.camera.center))),
new g.Float2PassUniform("nearFar",(r,y)=>y.camera.nearFar));t.constants.add("sampleValue","float",w);p.outputs.add("sampleCount","float");t.code.add(e.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`);return p}const w=1/255,q=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:255,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=h;a.ShadowCastMaxSamples=255;a.build=x})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,h){a.ShadowCastVisualization=void 0;(function(k){k[k.Gradient=
0]="Gradient";k[k.Threshold=1]="Threshold";k[k.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));class c extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.visualization=a.ShadowCastVisualization.Gradient;this.bandsEnabled=!1}}b.__decorate([h.parameter({count:a.ShadowCastVisualization.COUNT})],c.prototype,"visualization",void 0);b.__decorate([h.parameter()],c.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends c.ShaderTechnique{constructor(l,u){super(l,
u,()=>this.destroy())}initializeProgram(l){return new d.Program(l.rctx,n.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:m.blendingDefault,colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return g.PrimitiveType.TRIANGLE_STRIP}}n.shader=new h.ReloadableShaderModule(f.ShadowCastVisualize,()=>new Promise((l,u)=>a(["./ShadowCastVisualize.glsl"],l,u)));b.ShadowCastVisualizeTechnique=n;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends c.ShaderTechnique{constructor(l){super(l,new f.ShadowConfiguration,
()=>this.destroy())}initializeProgram(l){return new m.Program(l.rctx,n.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return g.PrimitiveType.TRIANGLE_STRIP}}n.shader=new h.ReloadableShaderModule(d.ShadowCastAccumulate,()=>new Promise((l,u)=>a(["./ShadowCastAccumulate.glsl"],
l,u)));b.ShadowCastAccumulateTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/boundedPlane"],function(a){const b=a.create();class h{constructor(){this._plane=a.create()}get isEnabled(){return!a.equals(this.plane,b)}get plane(){return this._plane}set plane(c){a.copy(c||b,this._plane)}}return h})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../Attribute ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia){function O(W){null!=W&&(W.vao.vertexBuffers.instances.dispose(),W.vao.disposeVAOOnly(),W.vao=null)}function U(W){let Y=null,ja=null;for(let oa=0;oa<W.geometries.length;oa++){const ra=W.geometries[oa];if(ra.material.supportsEdges){if(!Y)Y=ra.transformation;else if(!c.equals(Y,ra.transformation))return!1;if(!ja&&null!=ra.localOrigin)ja=ra;else if(null!=ja?.localOrigin&&null!=ra.localOrigin&&ja.localOrigin.id!==
ra.localOrigin.id)return!1}}return!0}function P(W,Y,ja){Y*=ja;ja=c.binaryIndexOf(W,Y,!0);return-1===ja?Y<W[0]?W.length:0:W.length-ja}a.EdgeView=class extends h{constructor(W){super(W);this._updatingHandles=new q.UpdatingHandles;this._perObjectData=new Map;this._perObjectDataEvictionCache=new Set;this._renderers=new Map;this._gpuMemoryUsage=0;this._workerAbort=new AbortController;this._tmpModelPosition=w.create();this._localOrigins=new B.LocalOriginManager(new E.GridLocalOriginFactory(W.renderSR))}initialize(){this._worker=
new I.EdgeWorkerHandle(this.schedule);this._componentColorManager=new V.BufferManager(this.rctx,3);const W=L.VertexLayout.createBuffer(4);for(let Y=0;4>Y;Y++)W.sideness.set(Y,0,0===Y||3===Y?0:1),W.sideness.set(Y,1,0===Y||1===Y?0:1);this._verticesBufferObject=T.BufferObject.createVertex(this.rctx,ia.Usage.STATIC_DRAW,W.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(W=>this._discardObjectEntry(W)),this._perObjectData.clear(),this._strokesTexture=d.disposeMaybe(this._strokesTexture),
this._componentColorManager=d.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=d.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",ca))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return 0<this._renderers.size}async addComponentObject(W,Y,ja,oa,ra,ta){if(this.hasObject(W))return this.getObjectMemoryUsage(W);
let ya;const Ca=new R(new Promise(pa=>ya=pa),W.obb.center,W.obb.radius);this._perObjectData.set(W,Ca);W=await this._updatingHandles.addPromise(this._addComponentGeometry(W.transform,Ca,Y,ja,oa,ra,ta));this.setNeedsRender();ya();return W}async addOrUpdateObject3D(W,Y,ja,oa){if(this.destroyed)k.getLogger(this).warn("Attempt to add an object to a destroyed instance");else{var ra=this._perObjectData.get(W);0<ra?.renderables.length&&this._perObjectDataEvictionCache.add(ra);var ta,ya=W.boundingVolumeWorldSpace.bounds;
ya=new R(new Promise(pa=>ta=pa),v.getCenter(ya),v.getRadius(ya));this._perObjectData.set(W,ya);var Ca=[];if(ja.mergeGeometries&&1<W.geometries.length&&U(W))Ca.push(this._addObjectMergedGeometries(W,ya,Y,ja,oa));else for(let pa=0;pa<W.geometries.length;pa++){const wa=W.geometries[pa];wa.material.supportsEdges&&Ca.push(this._addGeometry(W,ya,wa,Y[0],ja,oa))}await this._updatingHandles.addPromise(Promise.all(Ca));this._perObjectDataEvictionCache.delete(ya);this._discardObjectEntry(ra);this.setNeedsRender();
ta()}}fastUpdateObject3DEdgesTransform(W){if(this.destroyed)return!1;var Y=this._perObjectData.get(W);if(!Y)return!1;var {geometries:ja}=W;({renderables:Y}=Y);if(0===ja.length||0===Y.length)return!0;if(1<Y.length)return!1;[Y]=Y;var oa=Y.transform;if(!(oa instanceof da))return!1;[ja]=ja;if(ja.localOrigin!==oa.origin.origin)return!1;oa=u.create();W=this._computeModelTransformWithLocalOrigin(W,ja,oa);Y.transform=new da(oa,W);this.setNeedsRender();return!0}_discardObjectEntry(W){W&&(W.renderables.length&&
(W.renderables.forEach(Y=>this._removeRenderable(Y)),this.setNeedsRender()),W.loaded=null)}hasObject(W){return this._perObjectData.has(W)}async updateAllComponentOpacities(W,Y){W=await this._updatingHandles.addPromise(this._getObjectEntry(W));if(null!=W){var ja=Y instanceof Array?oa=>Y[oa]:()=>Y;W.renderables.forEach(oa=>{const ra=oa.components.meta.length;for(let ta=0;ta<ra;ta++){const ya=ja(ta),Ca=oa.components.meta[ta],pa=Ca.index;Ca.material.opacity=ya;oa.components.buffer.textureBuffer.setDataElement(pa,
1,3,255*ya)}this._updateTransparency(oa)});this.setNeedsRender()}}async getObjectMemoryUsage(W){W=await this._getObjectEntry(W);return null!=W?W.renderables.reduce((Y,ja)=>Y+ja.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(W,Y,ja,oa){const ra=W instanceof F.Object3D,ta=!!ja.hasSlicePlane,ya=N.determineRendererType(Y),Ca=J.EdgeRenderer.getKey(ya,ta,ra);W=await this._updatingHandles.addPromise(this._getObjectEntry(W));null!=W&&(W.renderables.forEach(pa=>{if(Ca!==pa.rendererKey){var wa=
this._renderers.get(pa.rendererKey);const Ba=this._acquireRenderer(ya,ta,ra);wa.removeRenderable(pa);--wa.refCount;pa.rendererKey=Ca;Ba.addRenderable(pa)}for(wa=0;wa<Y.length;wa++)pa.components.meta[wa].material=Y[wa];oa&&this._updateComponentBuffer(pa.components);this._updateTransparency(pa)}),this.setNeedsRender())}async updateAllVerticalOffsets(W,Y){W=await this._updatingHandles.addPromise(this._getObjectEntry(W));null!=W&&(W.renderables.forEach(ja=>{const oa=ja.components.meta;for(let ra=0;ra<
oa.length;ra++)ja.components.meta[ra].verticalOffset=Y?.[ra]??0;this._updateComponentBuffer(ja.components)}),this.setNeedsRender())}async updateObjectVisibility(W,Y){W=await this._updatingHandles.addPromise(this._getObjectEntry(W));null!=W&&(W.renderables.forEach(ja=>ja.visible=Y),this.setNeedsRender())}removeObject(W){const Y=this._perObjectData.get(W);Y&&(this._perObjectData.delete(W),this._discardObjectEntry(Y))}async _getObjectEntry(W){W=this._perObjectData.get(W);if(!W)throw Error("no object");
await W.loaded;return null==W.loaded?null:W}render(W,Y){if(null!=this._componentColorManager){this._localOrigins.updateViewMatrices(W.camera.viewMatrix);var ja=W.camera.viewInverseTransposeMatrix,oa=w.create(),ra=new y.TwoVectorPosition,ta=0,ya=0;this._renderers.forEach(pa=>{if(0===pa.refCount)this._renderers.delete(pa.key),pa.dispose();else{var wa=!0,Ba=!0;pa.forEachRenderable(la=>{la.visible&&(ta+=la.statistics.averageEdgeLength,ya++,wa&&la.regular&&(pa.updateTechnique(W,!1),wa=!1),Ba&&la.silhouette&&
(pa.updateTechnique(W,!0),Ba=!1))},Y)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==ya){var Ca=new K.EdgePassParameters(40*ta/ya,Y);x.set(oa,ja[3],ja[7],ja[11]);ra.set(oa);x.copy(Ca.transformWorldFromViewTH,ra.high);x.copy(Ca.transformWorldFromViewTL,ra.low);n.fromMat4(Ca.transformViewFromCameraRelativeRS,W.camera.viewMatrix);n.transpose(ea,Ca.transformViewFromCameraRelativeRS);n.invert(Ca.transformNormalViewFromGlobal,ea);Ca.transformProjFromView=
W.camera.projectionMatrix;this._updateObjectCameraDistances(W);this._renderers.forEach(pa=>{this._renderRegularEdges(pa,W,Ca);this._renderSilhouetteEdges(pa,W,Ca)})}}}_updateTransparency(W){const Y=N.determineEdgeTransparency(W.components.meta),ja=N.determineObjectTransparency(W.components.meta);if(Y!==W.edgeTransparency||ja!==W.objectTransparency)W.edgeTransparency=Y,W.objectTransparency=ja,this._renderers.get(W.rendererKey).setRenderablesDirty()}_computeModelTransformWithLocalOrigin(W,Y,ja){W.getCombinedShaderTransformation(Y,
ja);W=null!=Y.localOrigin?this._localOrigins.register(Y.localOrigin):this._localOrigins.acquire(x.set(this._tmpModelPosition,ja[12],ja[13],ja[14]));Y.localOrigin=W.origin;A.applyToModelMatrix(W.origin.vec3,ja);return W}_updateComponentBuffer(W){const {meta:Y,buffer:ja}=W;W=new Uint8Array(4);for(let ra=0;ra<Y.length;ra++){var oa=Y[ra].material;const ta=Y[ra].index,ya=m.clamp(Math.round(oa.size*J.lineWidthFractionFactor),0,255),Ca=m.clamp(oa.extensionLength,-J.extensionLengthOffset,255-J.extensionLengthOffset)+
J.extensionLengthOffset,pa="solid"===oa.type?z.EdgeType.SOLID:z.EdgeType.SKETCH,wa=255*oa.opacity;oa=oa.color;ja.textureBuffer.setData(ta,0,255*oa[0],255*oa[1],255*oa[2],255*oa[3]);ja.textureBuffer.setData(ta,1,ya,Ca,pa,wa);r.encodeElevationOffset(Y[ra].verticalOffset,W);ja.textureBuffer.setData(ta,2,W[0],W[1],W[2],W[3])}}_createComponentBuffers(W){if(null==this._componentColorManager)return null;const Y=[],ja=this._componentColorManager.getBuffer(W.length);for(let oa=0;oa<W.length;oa++){const ra=
W[oa],ta=ja.acquireIndex();Y.push({index:ta,verticalOffset:0,material:ra})}W=new ba(ja,Y);this._updateComponentBuffer(W);return W}_extractEdges(W,Y,ja,oa,ra,ta=ra.length){return this._worker.process({data:Y,indices:ra,indicesLength:ta,writerSettings:W,skipDeduplicate:ja},this._workerAbort.signal,oa)}_createRenderable(W,Y,ja,oa,ra){var ta=Ca=>null!=this._verticesBufferObject?new X(new G.VertexArrayObject(this.rctx,L.EdgeShaderAttributeLocations,{vertices:L.glVertexLayout,instances:Ca===Q.EdgeSilhouette.REGULAR?
C.RegularEdgeBufferWriter.glLayout:C.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:T.BufferObject.createVertex(this.rctx,ia.Usage.STATIC_DRAW,Ca===Q.EdgeSilhouette.REGULAR?W.regular.instancesData.buffer:W.silhouette.instancesData.buffer)}),Ca===Q.EdgeSilhouette.REGULAR?W.regular.lodInfo:W.silhouette.lodInfo):null;const ya=0<W.regular.lodInfo.lengths.length?ta(Q.EdgeSilhouette.REGULAR):null;ta=0<W.silhouette.lodInfo.lengths.length?ta(Q.EdgeSilhouette.SILHOUETTE):
null;return new ha(ya,ta,{gpuMemoryUsage:(ya?.vao.usedMemory??0)+(ta?.vao.usedMemory??0),externalMemoryUsage:ra,averageEdgeLength:W.averageEdgeLength},ja,N.determineEdgeTransparency(Y.meta),N.determineObjectTransparency(Y.meta),Y,oa)}async _addGeometry(W,Y,ja,oa,ra,ta){if(!(0>=ja.edgeIndicesLength)){var ya=ja.attributes.get(H.VertexAttribute.POSITION),Ca=u.create();W=this._computeModelTransformWithLocalOrigin(W,ja,Ca);ya=new Z(ya,Ca,W);return this._addPositionData(Y,ya,ja.edgeIndicesLength,oa,ra,
ta)}}async _addPositionData(W,Y,ja,oa,ra,ta=!1){if(null!=W.loaded){var ya=this._createComponentBuffers([oa]);if(null!=ya){oa=this._acquireRenderer(oa.type,!!ra.hasSlicePlane,!0);var {modelTransform:Ca,origin:pa}=Y;ra=Y.position.indices;Y=Y.position;var wa=Y.data.length/Y.size,Ba=L.EdgeInputBufferLayout.createBuffer(wa);for(let la=0;la<wa;la++)Ba.position.set(la,0,Y.data[la*Y.size]),Ba.position.set(la,1,Y.data[la*Y.size+1]),Ba.position.set(la,2,Y.data[la*Y.size+2]);N.fillComponenBufferIndices(ya.meta,
[0,Ba.componentIndex.count],Ba.componentIndex);ja=await this._updatingHandles.addPromise(this._extractEdges(oa.writerSettings,Ba,!1,ta,ra,ja));null!=W.loaded&&(ya=this._createRenderable(ja,ya,new da(Ca,pa),oa.key,!1),W.renderables.push(ya),oa.addRenderable(ya),this._gpuMemoryUsage+=ya.statistics.gpuMemoryUsage)}}}async _addComponentGeometry(W,Y,ja,oa,ra,ta,ya){if(null==Y.loaded)return 0;const Ca=this._createComponentBuffers(ta);if(null==Ca)return 0;ta=N.determineRendererType(ta);ya=this._acquireRenderer(ta,
ya.hasSlicePlane||!1,!1);ta=L.EdgeInputBufferLayout.createBuffer(ja.length/3);p.copy(ta.position.typedBuffer,ja,ta.position.typedBufferStride,3);N.fillComponenBufferIndices(Ca.meta,ra,ta.componentIndex,oa);ja=await this._updatingHandles.addPromise(this._extractEdges(ya.writerSettings,ta,!0,!1,oa));if(null==Y.loaded)return 0;W=this._createRenderable(ja,Ca,W,ya.key,!0);Y.renderables.push(W);ya.addRenderable(W);return W.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(W,Y,ja,oa,ra){const ta=
new Map;let ya=0,Ca=null,pa=0;var wa=W.geometries.filter(va=>{if(0>=va.edgeIndicesLength||!va.material.supportsEdges)return!1;!Ca&&va.localOrigin&&(Ca=va);const Ga=va.attributes.get(H.VertexAttribute.POSITION);pa+=Ga.data.length/Ga.size;ya+=va.edgeIndicesLength;return!0});if(0!==wa.length){var Ba=65536<=pa?Uint32Array:Uint16Array,la=ya?new Ba(ya):null,qa=[],ua=0;wa.forEach(va=>{var Ga=va.attributes.get(H.VertexAttribute.POSITION);const La=Ga.indices;let Na=ta.get(Ga.data);if(null==Na){Na=qa.length/
3;for(let Wa=0;Wa<Ga.data.length;Wa+=Ga.size)qa.push(Ga.data[Wa]),qa.push(Ga.data[Wa+1]),qa.push(Ga.data[Wa+2]);ta.set(Ga.data,Na)}for(Ga=0;Ga<va.edgeIndicesLength;Ga++)la[ua++]=Na+La[Ga]});Ba=Ca||W.geometries[0];wa=u.create();Ba=this._computeModelTransformWithLocalOrigin(W,Ba,wa);for(let va=0;va<W.geometries.length;va++)W.geometries[va].localOrigin=Ba.origin;W=new Z(new D.Attribute(qa,la,3),wa,Ba);await this._updatingHandles.addPromise(this._addPositionData(Y,W,la.length,ja[0],oa,ra))}}_acquireRenderer(W,
Y,ja){const oa=J.EdgeRenderer.getKey(W,Y,ja);let ra=this._renderers.get(oa);null==this._strokesTexture&&(this._strokesTexture=S.generateStrokesTexture(this.rctx));ra||(ra=new J.EdgeRenderer(this.rctx,this.techniqueRepository,{type:W,hasSlicePlane:Y,strokesTexture:this._strokesTexture,legacy:ja,spherical:this.viewingMode===t.ViewingMode.Global}),this._renderers.set(oa,ra));++ra.refCount;return ra}_removeRenderable(W){O(W.regular);O(W.silhouette);const Y=this._renderers.get(W.rendererKey);if(Y){Y.removeRenderable(W);
--Y.refCount;"origin"in W.transform&&this._localOrigins.release(W.transform.origin);this._gpuMemoryUsage-=W.statistics.externalMemoryUsage?0:W.statistics.gpuMemoryUsage;for(const ja of W.components.meta)W.components.buffer.releaseIndex(ja.index)}}_updateObjectCameraDistances(W){const Y=W.camera.eye,ja=W.camera.viewForward,oa=w.create();W=ra=>{x.sub(oa,ra.center,Y);const ta=x.dot(oa,ja),ya=ra.radius,Ca=ta<-ya?Infinity:ta<ya?0:ta-ya;ra.renderables.forEach(pa=>pa.distanceToCamera=Ca)};this._perObjectData.forEach(W);
this._perObjectDataEvictionCache.forEach(W)}_renderRegularEdges(W,Y,ja){const oa=W.bindRegularEdges(ja,Y),ra=Y.camera.perScreenPixelRatio;W.forEachRenderable(ta=>{if(null!=ta.regular&&ta.visible){var ya=P(ta.regular.lod.lengths,ta.distanceToCamera,ra);W.renderRegularEdges(oa,ta,ja,Y,ya)}},ja.transparency)}_renderSilhouetteEdges(W,Y,ja){const oa=W.bindSilhouetteEdges(ja,Y),ra=Y.camera.perScreenPixelRatio;W.forEachRenderable(ta=>{if(null!=ta.silhouette&&ta.visible){var ya=P(ta.silhouette.lod.lengths,
ta.distanceToCamera,ra);W.renderSilhouetteEdges(oa,ta,ja,Y,ya)}},ja.transparency)}get test(){return{hasRenderedPrimitives:W=>{let Y=!1;const ja=W.perScreenPixelRatio,oa=(ra,ta)=>ra.forEachRenderable(ya=>{ya.visible&&!Y&&(null!=ya.regular&&(Y=0<P(ya.regular.lod.lengths,ya.distanceToCamera,ja)),Y||null==ya.silhouette||(Y=0<P(ya.silhouette.lod.lengths,ya.distanceToCamera,ja)))},ta);this._renderers.forEach(ra=>{Y||(oa(ra,M.Transparency.OPAQUE),oa(ra,M.Transparency.TRANSPARENT))});return Y},getObjectData:W=>
this._perObjectData.get(W)}}};b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([f.property({constructOnly:!0})],
a.EdgeView.prototype,"schedule",void 0);b.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);b.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);class R{constructor(W,Y,ja){this.radius=ja;this.renderables=[];this.loaded=W;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)});this.center=w.clone(Y)}}class ba{constructor(W,Y){this.buffer=
W;this.meta=Y}}class X{constructor(W,Y){this.vao=W;this.lod=Y}}class da{constructor(W,Y){this.modelMatrix=W;this.origin=Y}}class ha{constructor(W,Y,ja,oa,ra,ta,ya,Ca){this.regular=W;this.silhouette=Y;this.statistics=ja;this.transform=oa;this.edgeTransparency=ra;this.objectTransparency=ta;this.components=ya;this.rendererKey=Ca;this.distanceToCamera=0;this.visible=!0}}class fa extends ha{}class aa extends ha{}class Z{constructor(W,Y,ja){this.position=W;this.modelTransform=Y;this.origin=ja}}const ea=
l.create(),ca=()=>Promise.reject();a.LegacyTransform=da;a.RegularRenderable=fa;a.Renderable=ha;a.SilhouetteRenderable=aa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,h){const c=-b[0],k=-b[1];b=-b[2];const m=h[3],d=h[7],f=h[11],g=h[15];h[0]+=m*c;h[1]+=m*k;h[2]+=m*b;h[4]+=d*c;h[5]+=d*k;h[6]+=d*b;h[8]+=f*c;h[9]+=f*k;h[10]+=f*b;h[12]+=g*c;h[13]+=g*k;h[14]+=g*
b};a.applyToViewMatrix=function(b,h){const c=b[0],k=b[1];b=b[2];h[12]+=c*h[0]+k*h[4]+b*h[8];h[13]+=c*h[1]+k*h[5]+b*h[9];h[14]+=c*h[2]+k*h[6]+b*h[10];h[14]+=c*h[3]+k*h[7]+b*h[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","./localOriginHelper"],function(a,b,h,c){class k{constructor(d){this._factory=
d;this._originData=new Map}acquire(d){return this.register(this._factory.getOrigin(d))}register(d){d=this._originData.get(d.id)||new m(d);d.refCount++;this._originData.has(d.origin.id)||this._originData.set(d.origin.id,d);return d}release(d){d.refCount--;0===d.refCount&&this._originData.delete(d.origin.id)}updateViewMatrices(d){this._originData.forEach(f=>{b.copy(f.viewMatrix,d);c.applyToViewMatrix(f.origin.vec3,f.viewMatrix)})}}class m{constructor(d){this.origin=d;this.refCount=0;this.viewMatrix=
h.create()}}a.LocalOriginManager=k;a.OriginData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../chunks/vec32 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){const w={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},q={solid:u.EdgeUtilMode.SOLID,sketch:u.EdgeUtilMode.SKETCH,uber:u.EdgeUtilMode.MIXED};class v{constructor(t,r,y){this._rctx=t;this._shaderTechniqueRepository=r;this._configuration=new n.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[l.Transparency.TRANSPARENT]:{[l.Transparency.TRANSPARENT]:new h,[l.Transparency.OPAQUE]:new h},
[l.Transparency.OPAQUE]:{[l.Transparency.TRANSPARENT]:new h,[l.Transparency.OPAQUE]:new h}};this._renderablesDirty=!1;this._drawParameters=new g.EdgeDrawParameters;this._settings={...w,...y};this.key=v.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=q[this._settings.type];
this._configuration.silhouette=!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=t.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=y.spherical}dispose(){this._technique=b.releaseMaybe(this._technique)}addRenderable(t){this._renderables.add(t);this._renderablesDirty=!0}removeRenderable(t){this._renderables.delete(t);this._renderablesDirty=
!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){this._renderablesDirty&&this._sortRenderables();r=this._sortedRenderables[r];r[l.Transparency.TRANSPARENT].forAll(t);r[l.Transparency.OPAQUE].forAll(t)}updateTechnique(t,r){this._configuration.multipassEnabled=!!t.multipassEnabled;this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround;this._configuration.silhouette=r;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(e.EdgeShaderTechnique,
this._configuration,this._technique)}bindRegularEdges(t,r){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(r,!1),r,t)}bindSilhouetteEdges(t,r){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(r,!0),r,t)}renderRegularEdges(t,r,y,D,E){this._render(t,r,r.regular.vao,y,D,E)}renderSilhouetteEdges(t,r,y,D,E){this._render(t,r,r.silhouette.vao,y,D,E)}_render(t,r,y,D,E,A){0<A&&(this._bindDraw(t,r,D,E),this._rctx.bindVAO(y),this._rctx.drawArraysInstanced(x.PrimitiveType.TRIANGLE_FAN,
0,4,A))}_bindDraw(t,r,y,D){this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(t.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),t.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const E=
new f.TwoVectorPosition(r.transform.position),A=c.transpose(p,c.invert(p,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=E.low;this._drawParameters.transformWorldFromModelTH=E.high;this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=A;r=D.camera.viewInverseTransposeMatrix;m.set(this._drawParameters.slicePlaneLocalOrigin,r[3],r[7],r[11])}t.bindDraw(this._drawParameters,D,y)}_sortRenderables(){this._renderablesDirty=
!1;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].clear();this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].clear();this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].clear();this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].clear();this._renderables.forEach(r=>{r.objectTransparency!==l.Transparency.INVISIBLE&&r.edgeTransparency!==l.Transparency.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});
const t=(r,y)=>"origin"in r.transform?"origin"in y.transform?r.transform.origin.origin.id<y.transform.origin.origin.id?-1:r.transform.origin.origin.id>y.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.TRANSPARENT].sort(t);this._sortedRenderables[l.Transparency.TRANSPARENT][l.Transparency.OPAQUE].sort(t);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.TRANSPARENT].sort(t);this._sortedRenderables[l.Transparency.OPAQUE][l.Transparency.OPAQUE].sort(t)}static getKey(t,
r,y){return`edges-t:${t}:${r}:${y}`}}const p=k.create();a.EdgeRenderer=v;a.extensionLengthOffset=128;a.lineWidthFractionFactor=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,h,c){class k extends c.VertexPositionPassParameters{constructor(d,
f){super();this.distanceFalloffFactor=d;this.transparency=f;this.transformNormalViewFromGlobal=b.create()}}class m extends c.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=b.create();this.slicePlaneLocalOrigin=h.create();this.transformNormalGlobalFromModel=b.create()}}a.EdgeDrawParameters=m;a.EdgePassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends c.ShaderTechnique{initializeProgram(n){return new k.Program(n.rctx,e.shader.get().build(this.configuration),m.EdgeShaderAttributeLocations)}initializePipeline(n){return n.blendMinMax?g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.ONE,f.BlendOperation.ADD,n.blendMinMax.MAX),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({depthTest:{func:f.CompareFunction.LEQUAL},
depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})}}e.shader=new h.ReloadableShaderModule(d.EdgeShader,()=>new Promise((n,l)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],n,l)));b.EdgeShaderTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){function r(E){const A=new e.ShaderBuilder,{vertex:B,fragment:F}=A;E.legacy&&B.uniforms.add(new D("model"),new D("localView"));A.include(u.AdjustProjectedPosition,E);A.include(q.EdgeUtil,E);A.include(v.LineAmplitude,E);A.include(t.UnpackAttributes,E);A.include(p.LineOffset,E);A.include(c.SliceDraw,E);A.include(w.DiscardNonSilhouetteEdges,E);A.include(x.DiscardByCoverage,E);A.include(k.multipassTerrainTest,E);A.varyings.add("vColor","vec4");A.varyings.add("vRadius",
"float");A.varyings.add("vPosition","vec3");A.varyings.add("vWorldPosition","vec3");E.multipassEnabled&&A.varyings.add("vViewPos","vec3");A.varyings.add("vLineLengthPixels","float");A.varyings.add("vSizeFalloffFactor","float");B.uniforms.add(new m.Float2PassUniform("pixelToNDC",(G,H)=>b.set(y,2/H.camera.fullViewport[2],2/H.camera.fullViewport[3])),new d.Float4PassUniform("viewport",(G,H)=>H.camera.fullViewport),new f.FloatPassUniform("pixelRatio",(G,H)=>H.camera.pixelRatio));A.attributes.add(l.VertexAttribute.POSITION0,
"vec3");A.attributes.add(l.VertexAttribute.POSITION1,"vec3");A.attributes.add(l.VertexAttribute.VARIANTOFFSET,"float");A.attributes.add(l.VertexAttribute.VARIANTSTROKE,"float");A.attributes.add(l.VertexAttribute.VARIANTEXTENSION,"float");B.code.add(g.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${E.multipassEnabled?"vViewPos \x3d viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${E.antialiasing?g.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:g.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${E.mode===q.EdgeUtilMode.SKETCH?g.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:E.mode===q.EdgeUtilMode.MIXED?g.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0, component)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(component), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);F.code.add(g.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${E.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return A}const y=h.create();class D extends n.Uniform{constructor(E){super(E,"mat4")}}h=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=h;a.build=r})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,h,c,k,m,d){const f=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(g,e){g=g.vertex;g.include(h.IsNaN);g.constants.add("depthBias","vec2",f);g.uniforms.add(new c.Float2PassUniform("inverseViewport",(n,l)=>l.inverseViewport));e.legacy?(g.uniforms.add(new d.Matrix4PassUniform("proj",(n,l)=>l.camera.projectionMatrix)),g.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(g.uniforms.add(new m.Matrix3PassUniform("transformNormalViewFromGlobal",n=>n.transformNormalViewFromGlobal),new d.Matrix4PassUniform("transformProjFromView",n=>n.transformProjFromView)),g.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));g.code.add(k.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(h){const c=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;h.code.add(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(h,c){h=h.fragment;h.constants.add("coverageTestThreshold","float",.01);c.antialiasing?h.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):h.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(h,c){h=h.vertex;c.silhouette?(h.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),c.legacy?h.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 viewNormalA = _modelToViewNormal(data.normal);
vec3 viewNormalB = _modelToViewNormal(data.normal2);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):h.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 worldNormalA = _modelToWorldNormal(data.normal);
vec3 worldNormalB = _modelToWorldNormal(data.normal2);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):h.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){a.EdgeUtilMode=void 0;(function(w){w[w.SOLID=0]="SOLID";w[w.SKETCH=1]="SKETCH";w[w.MIXED=2]="MIXED";w[w.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(w){w[w.REGULAR=0]="REGULAR";w[w.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(w,q){const v=w.vertex;v.include(k.RgbaFloatEncoding);w.include(h.NormalAttribute,q);v.uniforms.add(new f.FloatPassUniform("distanceFalloffFactor",p=>
p.distanceFalloffFactor));v.code.add(g.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);v.uniforms.add(new u.Texture2DDrawUniform("componentDataTex",p=>p.componentDataTexture));w.attributes.add(x.VertexAttribute.COMPONENTINDEX,"float");v.constants.add("componentColorFieldOffset","float",0);v.constants.add("componentOtherFieldOffset","float",1);v.constants.add("componentVerticalOffsetFieldOffset","float",2);v.constants.add("componentFieldCount","float",3);v.constants.add("lineWidthFractionFactor","float",8);v.constants.add("extensionLengthOffset","float",128);v.constants.add("verticalOffsetScale",
"float",2*b.maxElevationOffset);v.code.add(g.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${q.silhouette?g.glsl`decompressNormal(normal2Compressed)`:g.glsl`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `);q.legacy?v.code.add(g.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(v.uniforms.add(new e.Matrix3DrawUniform("transformNormalGlobalFromModel",p=>p.transformNormalGlobalFromModel)),v.code.add(g.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));q.silhouette?(w.attributes.add(x.VertexAttribute.NORMAL2COMPRESSED,"vec2"),v.code.add(g.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):v.code.add(g.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`);q.legacy?v.code.add(g.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(v.include(c.DoublePrecision,q),v.uniforms.add(new n.Matrix3PassUniform("transformViewFromCameraRelativeRS",p=>p.transformViewFromCameraRelativeRS),new e.Matrix3DrawUniform("transformWorldFromModelRS",p=>p.transformWorldFromModelRS),new m.Float3DrawUniform("transformWorldFromModelTL",p=>p.transformWorldFromModelTL),new m.Float3DrawUniform("transformWorldFromModelTH",p=>p.transformWorldFromModelTH),new d.Float3PassUniform("transformWorldFromViewTL",p=>p.transformWorldFromViewTL),new d.Float3PassUniform("transformWorldFromViewTH",
p=>p.transformWorldFromViewTH)),v.code.add(g.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${q.spherical?g.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:g.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));v.uniforms.add(new l.Matrix4PassUniform("transformProjFromView",(p,t)=>t.camera.projectionMatrix));v.code.add(g.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);v.code.add(g.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(w){return w.mode===a.EdgeUtilMode.SKETCH||w.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(w){return w.mode===a.EdgeUtilMode.SOLID||w.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,b,h,c,k){a.LineAmplitude=function(m,d){const f=m.vertex;m.include(k.UnpackAttributes,d);switch(d.mode){case c.EdgeUtilMode.SOLID:f.code.add(h.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case c.EdgeUtilMode.SKETCH:f.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",g=>g.strokesTexture.amplitude));f.code.add(h.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case c.EdgeUtilMode.MIXED:f.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",g=>g.strokesTexture.amplitude)),f.code.add(h.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,h,c,k){a.UnpackAttributes=function(m,d){const f=m.vertex;m.attributes.add(c.VertexAttribute.SIDENESS,"vec2");d.mode===k.EdgeUtilMode.MIXED?f.code.add(h.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):f.code.add(h.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(d.mode){case k.EdgeUtilMode.MIXED:f.code.add(h.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case k.EdgeUtilMode.SKETCH:f.code.add(h.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.SOLID:f.code.add(h.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.COUNT:break;default:b.neverReached(d.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(a,b,h,c,k,m,
d){class f extends c.NoParameters{}a.LineOffset=function(g,e){g.include(d.UnpackAttributes,e);const {vertex:n,fragment:l}=g;m.usesSketchLogic(e)&&(n.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",u=>u.strokesTexture.texture)),n.uniforms.add(new h.FloatDrawUniform("strokesLog2Resolution",u=>Math.log2(u.strokesTexture.resolution)),new h.FloatDrawUniform("strokeVariants",u=>u.strokesTexture.variants)),g.varyings.add("vStrokeUV","vec2"),l.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",
u=>u.strokesTexture.texture),new h.FloatDrawUniform("strokesNormalizationScale",u=>u.strokesTexture.normalizationScale)),n.code.add(c.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),g.fragment.include(b.RgbaFloatEncoding),l.code.add(c.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(e.mode){case m.EdgeUtilMode.SOLID:n.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);l.code.add(c.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case m.EdgeUtilMode.SKETCH:n.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);l.code.add(c.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case m.EdgeUtilMode.MIXED:g.varyings.add("vType","float"),n.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),l.code.add(c.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,h,c,k,m){class d extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.mode=m.EdgeUtilMode.SOLID;this.spherical=this.cullAboveGround=this.multipassEnabled=this.doublePrecisionRequiresObfuscation=this.antialiasing=this.legacy=this.silhouette=this.hasSlicePlane=!1}}b.__decorate([c.parameter({count:m.EdgeUtilMode.COUNT})],d.prototype,"mode",void 0);b.__decorate([c.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],d.prototype,"silhouette",void 0);b.__decorate([c.parameter()],d.prototype,"legacy",void 0);b.__decorate([c.parameter()],d.prototype,
"antialiasing",void 0);b.__decorate([c.parameter()],d.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([c.parameter()],d.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter()],d.prototype,"spherical",void 0);b.__decorate([c.parameter({constValue:!1})],d.prototype,"occlusionPass",void 0);b.__decorate([c.parameter({constValue:h.NormalType.Compressed})],d.prototype,"normalType",void 0);a.EdgeShaderTechniqueConfiguration=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["exports","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./edgeProcessing"],function(a,b,h,c,k){class m extends h.WorkerHandle{constructor(f){super("EdgeProcessingWorker","extract",{extract:g=>[g.dataBuffer],extractComponentsEdgeLocations:g=>[g.dataBuffer],extractEdgeLocations:g=>
[g.dataBuffer]},f)}async process(f,g,e){if(e)return k.extract(f);f=await this.invoke(new d(f),g);return this._unpackOutput(f)}async extractEdgeLocations(f,g){f=await this.invokeMethod("extractEdgeLocations",new d(f),g);return c.unpackInterleavedBuffer(f)}async extractComponentsEdgeLocations(f,g){f=await this.invokeMethod("extractComponentsEdgeLocations",new d(f),g);return c.unpackInterleavedBuffer(f)}_unpackOutput(f){return{regular:{instancesData:c.unpackInterleavedBuffer(f.regular.instancesData),
lodInfo:{lengths:new Float32Array(f.regular.lodInfo.lengths)}},silhouette:{instancesData:c.unpackInterleavedBuffer(f.silhouette.instancesData),lodInfo:{lengths:new Float32Array(f.silhouette.lodInfo.lengths)}},averageEdgeLength:f.averageEdgeLength}}}class d{constructor(f){this.dataBuffer=f.data.buffer;this.writerSettings=f.writerSettings;this.skipDeduplicate=f.skipDeduplicate;this.indices=b.isArray(f.indices)?f.indices:f.indices.buffer;this.indicesType=b.isArray(f.indices)?"Array":b.isUint32Array(f.indices)?
"Uint32Array":"Uint16Array";this.indicesLength=f.indicesLength}}a.EdgeWorkerHandle=m;a.PackedInput=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","./InterleavedLayout"],function(a,b){a.packInterleavedBuffer=function(h,c){c.push(h.buffer);return{buffer:h.buffer,layout:new b.PackedLayout(h.layout)}};a.unpackInterleavedBuffer=function(h){return(new b.InterleavedLayout(h.layout)).createView(h.buffer)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports","../../../../../core/floatRGBA","../../../../../core/maybe","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(a,b,h,c,k){function m(e,n){if(!e)return null;var l=e.length/2;const u=.1*l;l=Array(l);let x=0;n=n===d.PRESSURE;for(let w=0;w<e.length;w+=2){const q=(e[w]+e[w+1])/2;n?l[x++]=Math.min(u,1-.5*(1-q)):l[x++]=Math.min(u,.5*q)}return l}var d;(function(e){e[e.DISTANCE=
0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(d||={});class f{constructor(e,n,l,u,x){this.resolution=e;this.normalizationScale=n;this.amplitude=l;this.variants=u;this.texture=x}dispose(){this.texture=h.disposeMaybe(this.texture)}}const g={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,
-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,
.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,
.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,
-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,
.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,
.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,
.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,
-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,
-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,
1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,
-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,
-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,
.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,
.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,
.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,
1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,
4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,
2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,
.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,
.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,
.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,
.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,
2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,
.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,
.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,
1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,
.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,
.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,
.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,
.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,
-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,
1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,
.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,
-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,
.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,
.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,
.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,
5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,
3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,
-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,
.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,
.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,
.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,
.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,
.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=f;a.generateStrokesTexture=function(e){const n=g.resolution;var l=n/2;const u=new Uint8Array(4*n*n),x=4*n*l;l=g.amplitude;const w=2*l,q=4*n,v=Math.log2(n)+1,p=g.strokes.length;let t=(v-1)*p*q;for(const {distance:r,pressure:y}of g.strokes){let D=r,E=y,A=t;for(let B=0;B<v;B++){0!==B&&(D=m(D,d.DISTANCE),E=m(E,d.PRESSURE));for(let F=0;F<g.resolution;F++){const G=
E?E[F%E.length]:1;b.packFloatRGBA((D?D[F%D.length]/w:0)+.5,u,A);b.packFloatRGBA(G,u,A+x);A+=4}A-=q*(p+1)}t+=q}e=new c.Texture(e,new k.TextureDescriptor(n),u);return new f(n,w,l,p,e)};a.strokesDefinition=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","./interfaces"],function(a,b){a.determineEdgeTransparency=function(h){let c=b.Transparency.INVISIBLE;for(const {material:k}of h)if(0<k.size*k.color[3]*
k.opacity){if(1>k.color[3]*k.opacity)return b.Transparency.TRANSPARENT;c=b.Transparency.OPAQUE}return c};a.determineObjectTransparency=function(h){let c=b.Transparency.INVISIBLE;for(const {material:k}of h)if(0<k.size*k.color[3]*k.opacity){switch(k.objectTransparency){case b.Transparency.TRANSPARENT:case b.Transparency.INVISIBLE:return b.Transparency.TRANSPARENT;case b.Transparency.OPAQUE:if(1>k.opacity)return b.Transparency.TRANSPARENT}c=b.Transparency.OPAQUE}return c};a.determineRendererType=function(h){let c=
null;for(const k of h)if(h=k.type,0<k.size*k.color[3])if(null==c)c=h;else if(c!==h)return"uber";return null!=c?c:"uber"};a.fillComponenBufferIndices=function(h,c,k,m){for(let f=0;f<h.length;f++){const g=h[f].index;var d=c[f];const e=c[f+1];if(m)for(;d<e;d++)k.set(m[d],g);else for(;d<e;d++)k.set(d,g)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define(["exports","../../../../core/maybe","../../../../core/PerformanceSampler",
"../../../../core/time","../../../webgl/TimerPool"],function(a,b,h,c,k){a.PerformanceCategory=void 0;(function(d){d.OVERLAY="overlay";d.PREPARE="prepare";d.SHADOW_MAP="shadow map";d.LINEAR_DEPTH="linear depth";d.ACCUMULATED_SHADOWS="accumulated shadows";d.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";d.NORMALS="normals";d.SSAO="SSAO";d.OPAQUE="opaque";d.OPAQUE_EDGES="opaque edges";d.VOXEL="voxel";d.TRANSPARENT="transparent";d.TRANSPARENT_EDGES="transparent edges";d.HUD_VISIBILITY="HUD visibility";
d.TRANSPARENT_TERRAIN="transparent terrain";d.ENVIRONMENT="environment";d.LASER_LINES="laser lines";d.OCCLUDED="occluded";d.ANTIALIASING="antialiasing";d.HIGHLIGHTS="highlights";d.HUD="HUD";d.HUD_OCCLUDED="HUD occluded";d.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));class m{constructor(d){this._rctx=d;this._startTimeStampCPU=c.Milliseconds(0);this._lastTimeStampCPU=c.Milliseconds(0);this._totalCPUTime=new h("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(f=>
[f,new h(f)]));this._enableGPUTimer=0;this._totalGPUTime=new h("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(f=>[f,new h(f)]));this._totalTime=c.Milliseconds(0);this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=
this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return c.Milliseconds(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const f=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=k.createElapsedTimerPool(this._rctx,f)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let d=!1;return{hasGPUTimerSupport:!0,remove:()=>
{d||(d=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=b.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=c.Milliseconds(performance.now());this._gpuTimerPool&&this._gpuTimerPool.start()}advance(d){var f=c.Milliseconds(performance.now());this._cpuTimeSamplers.get(d).record(f-this._lastTimeStampCPU);this._lastTimeStampCPU=f;this._gpuTimerPool&&(f=this._gpuTimerPool.stop(d),this._gpuTimeSamplers.get(d).record(f),this._gpuTimerPool.start())}finishFrame(){if(this._gpuTimerPool){var d=
this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(d);this._rctx.gl.flush()}d=c.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=c.Milliseconds(this._totalTime+d);this._totalCPUTime.record(d);this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((f,g)=>f+(g.last||0),0));++this._totalFrameCount}}a.RendererPerformanceInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports",
"./capabilities/DisjointTimerQuery"],function(a,b){class h{constructor(c,k){this._timer=c;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;k.forEach(m=>{const d=this._timer.createQuery(),f=this._timer.createQuery();this._queryPool.push(d,f);this._queryResults.set(m,null)})}start(){b.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(c){if(this._timer.disjoint()||
null==this._currentQuery||!this._queryResults.has(c))return this.abort(),null;this._timer.endTimeElapsed();const k=this._queryResults.get(c);if(null==k)return this._queryResults.set(c,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(k))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const m=this._timer.getResult(k)/1E6;this._queryPool.unshift(k);this._queryResults.set(c,this._currentQuery);this._currentQuery=null;return m}abort(){null!=this._currentQuery&&
(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(c=>{this._timer.deleteQuery(c)});this._queryResults.forEach(c=>{null!=c&&this._timer.deleteQuery(c)})}}a.createElapsedTimerPool=function(c,k){c=c.capabilities.disjointTimerQuery;return null==c?null:new h(c,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],
function(a){class b{constructor(h,c,k,m,d,f,g,e,n){this.createQuery=h;this.deleteQuery=c;this.resultAvailable=k;this.getResult=m;this.disjoint=d;this.beginTimeElapsed=f;this.endTimeElapsed=g;this.createTimestamp=e;this.timestampBits=n}}a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(h,c){if(c.disjointTimerQuery)return null;let k=h.getExtension("EXT_disjoint_timer_query_webgl2");return k?new b(()=>h.createQuery(),m=>{h.deleteQuery(m);a.hasRunningElapsedTimer=
!1},m=>h.getQueryParameter(m,h.QUERY_RESULT_AVAILABLE),m=>h.getQueryParameter(m,h.QUERY_RESULT),()=>h.getParameter(k.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,h.beginQuery(k.TIME_ELAPSED_EXT,m))},()=>{h.endQuery(k.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>k.queryCounterEXT(m,k.TIMESTAMP_EXT),()=>h.getQuery(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):(k=h.getExtension("EXT_disjoint_timer_query"))?new b(()=>k.createQueryEXT(),m=>{k.deleteQueryEXT(m);a.hasRunningElapsedTimer=
!1},m=>k.getQueryObjectEXT(m,k.QUERY_RESULT_AVAILABLE_EXT),m=>k.getQueryObjectEXT(m,k.QUERY_RESULT_EXT),()=>h.getParameter(k.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,k.beginQueryEXT(k.TIME_ELAPSED_EXT,m))},()=>{k.endQueryEXT(k.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>k.queryCounterEXT(m,k.TIMESTAMP_EXT),()=>k.getQueryEXT(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports",
"../effects/ScreenSpaceGeometry","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],function(a,b,h,c){class k extends c.RenderingContext{constructor(m,d,f){super(m,d);this.gl=m;this.newCache=f;this._appleAmdDriverHelper=null;this._refCount=1;this.screen=new b.ScreenSpaceGeometry(this)}destroy(){0<--this._refCount||this.dispose()}ref(){++this._refCount}dispose(){super.dispose();this._appleAmdDriverHelper?.dispose();this.screen.destroy()}bindTechnique(m,d,f,g,e){this.useProgram(m.program);
this.setPipelineState(m.getPipeline(!!e));m.program.bindPass(f,d);g&&m.program.bindDraw(g,d,f);return m.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new h.AppleAmdDriverHelper(this)),this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}}
a.RenderingContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ScreenSpaceGeometry":function(){define("exports ../../../../core/maybe ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../lib/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),function(a,b,h,c,k,m,d){function f(e,n=c.Pos2,l=h.Default3D){const u=new Float32Array([-1,-1,3,-1,-1,3]);return new k.VertexArrayObject(e,l,{geometry:n},
{geometry:m.BufferObject.createVertex(e,d.Usage.STATIC_DRAW,u)})}class g{constructor(e){this._rctx=e;this._vao=f(e)}destroy(){this._vao=b.disposeMaybe(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(d.PrimitiveType.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:(null!=this._vao?.glName?1:0)+(null!=this._vao?.indexBuffer?.glName?1:0)+(null!=this._vao?.vertexBuffers.geometry?1:0)}}}a.ScreenSpaceGeometry=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","./BufferObject","./enums"],function(a,b,h){class c{constructor(k){this._rctx=k;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const k=
c.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))}_createIndexbuffer(){return b.BufferObject.createIndex(this._rctx,h.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,h.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(h.PrimitiveType.POINTS,1,h.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}a.AppleAmdDriverHelper=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(p,t,r,y){t?y!==t&&p.bindBuffer(r,t.glName):p.bindBuffer(r,null);
return t}function v(p,t){switch(p){case d.PrimitiveType.POINTS:return 2*t;case d.PrimitiveType.TRIANGLES:return t/3;case d.PrimitiveType.TRIANGLE_STRIP:return t-2;case d.PrimitiveType.TRIANGLE_FAN:return t-2;default:return 0}}a.RenderingContext=class{constructor(p,t){this.gl=p;this.instanceCounter=new f.InstanceCounter;this.programCache=new e.ProgramCache(this);this._transformFeedbackRequestInfo=null;this._state=new m.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this._loadExtensions();
this.configure(t)}configure(p){this._capabilities=new w.Capabilities(this.gl,p);this._parameters=new g.Parameters(this.gl,this._capabilities,p);l.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;p=this.gl.getParameter(this.gl.VIEWPORT);this._state=new m.ContextState;this._state.viewport={x:p[0],y:p[1],width:p[2],height:p[3]};this._stateTracker=new n.StateTracker({setBlending:t=>{t?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(t.opRgb,t.opAlpha),this.setBlendFunctionSeparate(t.srcRgb,
t.dstRgb,t.srcAlpha,t.dstAlpha),t=t.color,this.setBlendColor(t.r,t.g,t.b,t.a)):this.setBlendingEnabled(!1)},setCulling:t=>{t?(this.setFaceCullingEnabled(!0),this.setCullFace(t.face),this.setFrontFace(t.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:t=>{t?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(t.factor,t.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:t=>{t?(this.setDepthTestEnabled(!0),this.setDepthFunction(t.func)):this.setDepthTestEnabled(!1)},setStencilTest:t=>
{if(t){this.setStencilTestEnabled(!0);const r=t.function;this.setStencilFunction(r.func,r.ref,r.mask);t=t.operation;this.setStencilOp(t.fail,t.zFail,t.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:t=>{t?(this.setDepthWriteEnabled(!0),this.setDepthRange(t.zNear,t.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:t=>{t?this.setColorMask(t.r,t.g,t.b,t.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:t=>{t?this.setStencilWriteMask(t.mask):this.setStencilWriteMask(0)},setDrawBuffers:t=>
{const {drawBuffers:r}=this._capabilities;t?r?.drawBuffers(t.buffers):({drawFramebuffer:t}=this._state,null===t||0===t.colorAttachments.length?r?.drawBuffers([d.SpecialDrawBuffers.BACK]):r?.drawBuffers([d.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();b.disposeMaybe(this._driverTest);this._driverTest=new x.WebGLDriverTest(this)}dispose(){b.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);
this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;k.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(p){this._stateTracker.setPipeline(p)}setBlendingEnabled(p){this._state.blend!==
p&&(!0===p?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=p,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(p,t){for(let r=0;r<p.length;++r)this._state.textureUnitMap[p[r]]=null;0<=t&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const p=this.capabilities.vao;p&&(p.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=
null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(p,t,r,y){if(p!==this._state.blendColor.r||t!==this._state.blendColor.g||r!==this._state.blendColor.b||y!==this._state.blendColor.a)this.gl.blendColor(p,t,r,y),this._state.blendColor.r=p,this._state.blendColor.g=t,this._state.blendColor.b=r,this._state.blendColor.a=y,this._stateTracker.invalidateBlending()}setBlendFunction(p,t){if(p!==this._state.blendFunction.srcRGB||
t!==this._state.blendFunction.dstRGB)this.gl.blendFunc(p,t),this._state.blendFunction.srcRGB=p,this._state.blendFunction.srcAlpha=p,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(p,t,r,y){if(this._state.blendFunction.srcRGB!==p||this._state.blendFunction.srcAlpha!==r||this._state.blendFunction.dstRGB!==t||this._state.blendFunction.dstAlpha!==y)this.gl.blendFuncSeparate(p,t,r,y),this._state.blendFunction.srcRGB=
p,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendEquation(p){this._state.blendEquation.mode!==p&&(this.gl.blendEquation(p),this._state.blendEquation.mode=p,this._state.blendEquation.modeAlpha=p,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(p,t){if(this._state.blendEquation.mode!==p||this._state.blendEquation.modeAlpha!==t)this.gl.blendEquationSeparate(p,t),this._state.blendEquation.mode=
p,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending()}setColorMask(p,t,r,y){if(this._state.colorMask.r!==p||this._state.colorMask.g!==t||this._state.colorMask.b!==r||this._state.colorMask.a!==y)this.gl.colorMask(p,t,r,y),this._state.colorMask.r=p,this._state.colorMask.g=t,this._state.colorMask.b=r,this._state.colorMask.a=y,this._stateTracker.invalidateColorWrite()}setClearColor(p,t,r,y){if(this._state.clearColor.r!==p||this._state.clearColor.g!==t||this._state.clearColor.b!==
r||this._state.clearColor.a!==y)this.gl.clearColor(p,t,r,y),this._state.clearColor.r=p,this._state.clearColor.g=t,this._state.clearColor.b=r,this._state.clearColor.a=y}setFaceCullingEnabled(p){this._state.faceCulling!==p&&(!0===p?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=p,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(p){this._state.polygonOffsetFill!==p&&(!0===p?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._state.polygonOffsetFill=p,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(p,t){if(this._state.polygonOffset[0]!==p||this._state.polygonOffset[1]!==t)this._state.polygonOffset[0]=p,this._state.polygonOffset[1]=t,this.gl.polygonOffset(p,t),this._stateTracker.invalidatePolygonOffset()}setCullFace(p){this._state.cullFace!==p&&(this.gl.cullFace(p),this._state.cullFace=p,this._stateTracker.invalidateCulling())}setFrontFace(p){this._state.frontFace!==p&&(this.gl.frontFace(p),this._state.frontFace=
p,this._stateTracker.invalidateCulling())}setScissorTestEnabled(p){this._state.scissorTest!==p&&(!0===p?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=p)}setScissorRect(p,t,r,y){if(this._state.scissorRect.x!==p||this._state.scissorRect.y!==t||this._state.scissorRect.width!==r||this._state.scissorRect.height!==y)this.gl.scissor(p,t,r,y),this._state.scissorRect.x=p,this._state.scissorRect.y=t,this._state.scissorRect.width=r,this._state.scissorRect.height=
y}setDepthTestEnabled(p){this._state.depthTest!==p&&(!0===p?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=p,this._stateTracker.invalidateDepthTest())}setClearDepth(p){this._state.clearDepth!==p&&(this.gl.clearDepth(p),this._state.clearDepth=p)}setDepthFunction(p){this._state.depthFunction!==p&&(this.gl.depthFunc(p),this._state.depthFunction=p,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(p){this._state.depthWrite!==p&&(this.gl.depthMask(p),
this._state.depthWrite=p,this._stateTracker.invalidateDepthWrite())}setDepthRange(p,t){if(this._state.depthRange.zNear!==p||this._state.depthRange.zFar!==t)this.gl.depthRange(p,t),this._state.depthRange.zNear=p,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(p){this._state.stencilTest!==p&&(!0===p?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=p,this._stateTracker.invalidateStencilTest())}setClearStencil(p){p!==
this._state.clearStencil&&(this.gl.clearStencil(p),this._state.clearStencil=p)}setStencilFunction(p,t,r){if(this._state.stencilFunction.func!==p||this._state.stencilFunction.ref!==t||this._state.stencilFunction.mask!==r)this.gl.stencilFunc(p,t,r),this._state.stencilFunction.face=d.Face.FRONT_AND_BACK,this._state.stencilFunction.func=p,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(p,t,r,y){if(this._state.stencilFunction.face!==
p||this._state.stencilFunction.func!==t||this._state.stencilFunction.ref!==r||this._state.stencilFunction.mask!==y)this.gl.stencilFuncSeparate(p,t,r,y),this._state.stencilFunction.face=p,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=y,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(p){this._state.stencilWriteMask!==p&&(this.gl.stencilMask(p),this._state.stencilWriteMask=p,this._stateTracker.invalidateStencilWrite())}setStencilOp(p,
t,r){if(this._state.stencilOperation.face!==d.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==p||this._state.stencilOperation.zFail!==t||this._state.stencilOperation.zPass!==r)this.gl.stencilOp(p,t,r),this._state.stencilOperation.face=d.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=p,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(p,t,r,y){if(this._state.stencilOperation.face!==p||this._state.stencilOperation.fail!==
t||this._state.stencilOperation.zFail!==r||this._state.stencilOperation.zPass!==y)this.gl.stencilOpSeparate(p,t,r,y),this._state.stencilOperation.face=p,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=y,this._stateTracker.invalidateStencilTest()}setActiveTexture(p,t=!1){const r=this._state.activeTexture;0<=p&&(t||p!==this._state.activeTexture)&&(this.gl.activeTexture(d.baseTextureUnit+p),this._state.activeTexture=p);return r}clear(p){p&&
this.gl.clear(p)}clearSafe(p,t=255){p&&(p&d.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),p&d.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),p&d.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(p))}clearFramebuffer(p,t=!1,r=!1){let y=0;p&&(this.setClearColor(p[0],p[1],p[2],Math.max(1E-13,p[3])),y|=d.ClearBufferBit.COLOR_BUFFER_BIT);t&&(y|=d.ClearBufferBit.DEPTH_BUFFER_BIT);!1===r?r=0:(!0===r&&(r=255),y|=d.ClearBufferBit.STENCIL_BUFFER_BIT);
y&&this.clearSafe(y,r)}drawArrays(p,t,r){if(this._transformFeedbackRequestInfo){if(p!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(k.webglDebugEnabled()){this._numOfDrawCalls++;
this._numOfTriangles+=v(p,r);const y=this._state.textureUnitMap;for(let D=0;D<y.length;D++){const E=y[D];if(null!=E&&E===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${D}`);}}this.gl.drawArrays(p,t,r);k.checkWebGLError(this.gl)}drawArraysInstanced(p,t,r,y){this.gl.drawArraysInstanced(p,t,r,y);k.checkWebGLError(this.gl)}drawElements(p,t,r,y){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");
k.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(p,t));this.gl.drawElements(p,t,r,y);if(k.webglDebugEnabled()){const D=u.getErrorString(this);if(D){const E=this.getBoundVAO(),A=E?.indexBuffer,B=A?.size??0,F=y+t;console.error(`drawElements: ${D}${B<F?`. Buffer is too small. Attempted to draw index ${F} of ${B}`:""}`,{args:{mode:p,count:t,type:r,offset:y},vao:{indexBuffer:A,vertexBuffers:E?.vertexBuffers}})}}}logInfo(){k.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){k.webglDebugEnabled()&&
(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(p,t,r,y){r=Math.max(Math.round(r),1);y=Math.max(Math.round(y),1);const D=this._state.viewport;if(D.x!==p||D.y!==t||D.width!==r||D.height!==y)D.x=p,D.y=t,D.width=r,D.height=y,this.gl.viewport(p,t,r,y)}setViewport4fv(p){this.setViewport(p[0],p[1],p[2],p[3])}restoreViewport({x:p,y:t,width:r,height:y}){this.setViewport(p,t,r,y)}getViewport(){const p=this._state.viewport;return{x:p.x,y:p.y,width:p.width,
height:p.height}}useProgram(p){this._state.program!==p&&(this._state.program?.stop(),this._state.program=p,this.gl.useProgram(p?.glName??null))}bindTexture(p,t,r=!1){(t>=this.parameters.maxTextureImageUnits||0>t)&&console.error("Input texture unit is out of range of available units!");const y=this._state.textureUnitMap[t];if(null==p?.glName)return null!=y&&(this.setActiveTexture(t,r),this.gl.bindTexture(y.descriptor.target,null)),this._state.textureUnitMap[t]=null,y;if(!r&&y===p)return p.isDirty&&
(this.setActiveTexture(t,r),p.applyChanges()),y;this.setActiveTexture(t,r);this.gl.bindTexture(p.descriptor.target,p.glName);p.applyChanges();this._state.textureUnitMap[t]=p;return y}unbindTexture(p){if(null!=p)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===p&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(p,t=!1){if(t||this._state.readFramebuffer!==p||this._state.drawFramebuffer!==p)this._stateTracker.invalidateDrawBuffers(),
null==p?(this.gl.bindFramebuffer(d.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=null):(p.initializeAndBind(d.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=p,this._state.drawFramebuffer=p)}bindFramebufferSeparate(p,t,r=!1){const y=t===d.FramebufferTarget.READ_FRAMEBUFFER,D=y?this._state.readFramebuffer:this._state.drawFramebuffer;if(r||D!==p)null==p?this.gl.bindFramebuffer(t,null):p.initializeAndBind(t),y?this._state.readFramebuffer=p??null:
this._state.drawFramebuffer=p??null}blitFramebuffer(p,t,r=0,y=0,D=p.width,E=p.height,A=0,B=0,F=t.width,G=t.height,H=d.ClearBufferBit.COLOR_BUFFER_BIT,L=d.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(p,d.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(t,d.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(r,y,D,E,A,B,F,G,H,L)}bindBuffer(p,t){if(p)switch(t??=p.bufferType,t){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=q(this.gl,p,t,this._state.vertexBuffer);
break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=q(this.gl,p,t,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=q(this.gl,p,t,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=q(this.gl,p,t,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=q(this.gl,p,t,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=
q(this.gl,p,t,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=q(this.gl,p,t,this._state.copyWriteBuffer);break;case d.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=q(this.gl,p,t,this._state.transformFeedbackBuffer)}}bindRenderbuffer(p){const t=this.gl;p||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==p&&(t.bindRenderbuffer(t.RENDERBUFFER,p.glName),this._state.renderbuffer=
p)}_getBufferBinding(p,t){if(t>=this.parameters.maxUniformBufferBindings||0>t)return console.error("Uniform buffer binding point is out of range!"),null;p=p===d.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let r=p[t];null==r&&(r={buffer:null,offset:0,size:0},p[t]=r);return r}bindBufferBase(p,t,r){const y=this._getBufferBinding(p,t);null==y||y.buffer===r&&0===y.offset&&0===y.size||(this.gl.bindBufferBase(p,t,r?r.glName:null),y.buffer=r,y.offset=
0,y.size=0)}bindBufferRange(p,t,r,y,D){const E=this._getBufferBinding(p,t);null==E||E.buffer===r&&E.offset===y&&E.size===D||(0!==y%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(p,t,r.glName,y,D),E.buffer=r,E.offset=y,E.size=D))}bindUBO(p,t,r,y){null==t?this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,p,null):(k.webglDebugEnabled()&&(y??t.byteLength)>this._parameters.maxUniformBlockSize&&
console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==r&&void 0!==y?this.bindBufferRange(d.BufferType.UNIFORM_BUFFER,p,t.buffer,r,y):this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,p,t.buffer))}unbindUBO(p){for(let t=0,r=this._state.uniformBufferBindingPoints.length;t<r;t++){const y=this._state.uniformBufferBindingPoints[t];null!=y&&y.buffer===p.buffer&&this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,t,null)}}unbindBuffer(p){switch(p){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=
q(this.gl,null,p,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=q(this.gl,null,p,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=q(this.gl,null,p,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=q(this.gl,null,p,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=q(this.gl,null,p,this._state.pixelUnpackBuffer);
break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=q(this.gl,null,p,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=q(this.gl,null,p,this._state.copyWriteBuffer)}}bindVAO(p=null){null==p?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==p&&(p.bind(),this._state.vertexArrayObject=p)}bindTransformFeedback(p){const {gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,
p.glName)}beginTransformFeedback(p,t){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,p.glName);r.beginTransformFeedback(t);this._transformFeedbackRequestInfo={primitiveType:t}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:p}=this;p.endTransformFeedback();p.bindTransformFeedback(p.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=
null}async clientWaitAsync(p=c.Milliseconds(10)){const {gl:t}=this,r=t.fenceSync(d.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(d.ResourceType.Sync,r);t.flush();let y;do await h.after(p),y=t.clientWaitSync(r,0,0);while(y===d.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(d.ResourceType.Sync,r);t.deleteSync(r);if(y===d.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");
}getBoundFramebufferObject(p=d.FramebufferTarget.FRAMEBUFFER){return p===d.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);
this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);for(let p=0;p<this.parameters.maxTextureImageUnits;++p)this.bindTexture(null,p);this.setBlendingEnabled(!1);this.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ZERO);this.setBlendEquation(d.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(d.Face.BACK);this.setFrontFace(d.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(d.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(d.CompareFunction.ALWAYS,0,0);this.setStencilOp(d.StencilOperation.KEEP,d.StencilOperation.KEEP,d.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,
!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var p=this.capabilities.vao;p&&p.bindVertexArray(null);const {gl:t}=this;for(var r=0;r<this.parameters.maxVertexAttributes;r++)t.disableVertexAttribArray(r);this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(d.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,
this._state.indexBuffer.glName):t.bindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(d.BufferType.UNIFORM_BUFFER,null);for(r=0;r<this._parameters.maxUniformBufferBindings;r++){const y=this._state.uniformBufferBindingPoints[r];if(null!=y){const {buffer:D,offset:E,size:A}=y;null!==D?0===E&&0===A?t.bindBufferBase(d.BufferType.UNIFORM_BUFFER,r,D.glName):t.bindBufferRange(d.BufferType.UNIFORM_BUFFER,
r,D.glName,E,A):t.bindBufferBase(d.BufferType.UNIFORM_BUFFER,r,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(d.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):
t.bindBuffer(d.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(d.BufferType.COPY_WRITE_BUFFER,null);t.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,null);t.readBuffer(t.BACK);this._state.readFramebuffer&&(t.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(d.ColorAttachment.COLOR_ATTACHMENT0));t.bindFramebuffer(d.FramebufferTarget.DRAW_FRAMEBUFFER,
this._state.drawFramebuffer?.glName??null);if(p&&this._state.vertexArrayObject){if(p=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(p)}t.useProgram(this._state.program?.glName??null);t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?t.enable(this.gl.BLEND):
t.disable(this.gl.BLEND);t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);t.clearDepth(this._state.clearDepth);t.clearStencil(this._state.clearStencil);t.colorMask(this._state.colorMask.r,
this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);t.cullFace(this._state.cullFace);t.depthFunc(this._state.depthFunction);t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);t.depthMask(this._state.depthWrite);t.frontFace(this._state.frontFace);t.lineWidth(1);!0===this._state.faceCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);
!0===this._state.polygonOffsetFill?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL);t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST);t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,
this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST);t.stencilMask(this._state.stencilWriteMask);for(p=0;p<this.parameters.maxTextureImageUnits;p++)t.activeTexture(d.baseTextureUnit+p),t.bindTexture(d.TextureType.TEXTURE_2D,null),t.bindTexture(d.TextureType.TEXTURE_CUBE_MAP,null),t.bindTexture(d.TextureType.TEXTURE_3D,null),t.bindTexture(d.TextureType.TEXTURE_2D_ARRAY,null),r=this._state.textureUnitMap[p],
null!=r&&t.bindTexture(r.descriptor.target,r.glName);t.activeTexture(d.baseTextureUnit+this._state.activeTexture);p=this._state.viewport;t.viewport(p.x,p.y,p.width,p.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){class h{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction=
{srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=
null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=
this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}a.ContextState=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","./AllocationTracer","./enums"],function(a,b,h){const c={RECORD_ALLOCATIONS:!1};class k{constructor(){this._current=
[];for(this._allocations=c.RECORD_ALLOCATIONS?new b.AllocationTracer("WebGLObject"):null;this._current.length<h.ResourceType.COUNT;)this._current.push(0)}increment(m,d,f=1){this._current[m]+=f;this._allocations?.add(d)}decrement(m,d,f=1){this._current[m]-=f;this._allocations?.remove(d)}get current(){return this._current}get total(){return this.current.reduce((m,d,f)=>m+(f<h.ResourceType.UNCOUNTED?d:0),0)}get resourceInformation(){let m="";if(0<this.total){m+="Live objects:\n";for(let d=0;d<h.ResourceType.COUNT;++d){const f=
this._current[d];0<f&&(m+=`${h.ResourceType[d]}: ${f}\n`)}}return m+=this._allocations?.resetLog()}}a.InstanceCounter=k;a.test=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(a){class b{constructor(h){this._objectType=h;this._active=new Map}add(h){const c=Error().stack.split("\n");c.shift();c.shift();this._active.set(h,c.join("\n"))}remove(h){this._active.delete(h)}resetLog(){const h=new Map;this._active.forEach((m,
{usedMemory:d})=>{h.has(m)||h.set(m,new Map);m=h.get(m);m.set(d??0,m.get(d??0)??1)});this._active.clear();let c=0;const k=[];h.forEach((m,d)=>{let f=0;m.forEach((g,e)=>f+=g*e);m.set(-1,f);c+=f;k.push([d,m])});h.clear();k.sort((m,d)=>d[1].get(-1)-m[1].get(-1));return k.reduce((m,[d,f])=>{const g=Math.round(f.get(-1)/1024);f.delete(-1);f=Array.from(f.values()).reduce((e,n)=>e+n,0);return m+=`  ${g}KB from ${f} allocations at ${d}\n`},`Total unestimated ${this._objectType} memory: ${Math.round(c/1024)}KB\n`)}}
a.AllocationTracer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(a){class b{constructor(h,c,k){c=c.textureFilterAnisotropic;k=k.maxAnisotropy??Infinity;this.versionString=h.getParameter(h.VERSION);this.maxVertexTextureImageUnits=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxVertexAttributes=h.getParameter(h.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=c?Math.min(h.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY),
k):1;this.maxTextureImageUnits=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=h.getParameter(h.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=h.getParameter(h.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=h.getParameter(h.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=h.getParameter(h.MAX_VERTEX_UNIFORM_BLOCKS);this.maxFragmentUniformBlocks=h.getParameter(h.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=h.getParameter(h.MAX_UNIFORM_BLOCK_SIZE);
this.uniformBufferOffsetAlignment=h.getParameter(h.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=h.getParameter(h.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=h.getParameter(h.MAX_SAMPLES)}}a.Parameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/NestedMap","./Program"],function(a,b,h){class c{constructor(k){this._rctx=k;this._store=new b.NestedMap}dispose(){this._store.forEach(k=>k.forEach(m=>
m.dispose()));this._store.clear()}acquire(k,m,d,f){const g=this._store.get(k,m);if(null!=g)return g.ref(),g;d=new h.Program(this._rctx,k,m,d,f);d.ref();this._store.set(k,m,d);return d}get test(){let k=0;this._store.forEach(m=>m.forEach(d=>k+=d.hasGLName?2:1));return{cachedWebGLProgramObjects:k}}}a.ProgramCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],
function(a,b,h,c,k){function m(n,l,u){n=n.gl;const x=n.createShader(l);n.shaderSource(x,u);n.compileShader(x);h.webglValidateShadersEnabled()&&!n.getShaderParameter(x,n.COMPILE_STATUS)&&(console.error("Compile error in ".concat(l===c.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(n.getShaderInfoLog(x)),console.error(d(u)));return x}function d(n){let l=2;return n.replaceAll("\n",()=>{var u=l++;u=1E3<=u?u.toString():("  "+u).slice(-3);return"\n"+u+":"})}function f(n,l,u){const x=
n.get(l);if(!x)return n.set(l,Array.from(u)),!0;const w=u.length;if(x.length!==w)return n.set(l,Array.from(u)),!0;for(n=0;n<w;++n)if(l=u[n],x[n]!==l){for(x[n]=l;n<w;++n)x[n]=u[n];return!0}return!1}class g{constructor(n,l,u,x,w=new Map,q=[]){this._context=n;this._locations=x;this._uniformBlockBindings=w;this._transformFeedbackVaryings=q;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=
new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;n||console.error("RenderingContext isn't initialized!");0===l.length&&console.error("Shaders source should not be empty!");l=k.transpileShader(l,c.ShaderType.VERTEX_SHADER);u=k.transpileShader(u,c.ShaderType.FRAGMENT_SHADER);this._vShader=m(this._context,c.ShaderType.VERTEX_SHADER,l);this._fShader=m(this._context,c.ShaderType.FRAGMENT_SHADER,u);e.enabled&&(this._linesOfCode=
l.match(/\n/g).length+u.match(/\n/g).length+2,this._context.instanceCounter.increment(c.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(c.ResourceType.Shader,this);h.webglValidateShadersEnabled()&&(this.vertexShader=l,this.fragmentShader=u);this.usedMemory=l.length+u.length;const v=this._context.gl,p=v.createProgram();v.attachShader(p,this._vShader);v.attachShader(p,this._fShader);
this._locations.forEach((t,r)=>v.bindAttribLocation(p,t,r));this._transformFeedbackVaryings?.length&&v.transformFeedbackVaryings(p,this._transformFeedbackVaryings,v.SEPARATE_ATTRIBS);v.linkProgram(p);h.webglValidateShadersEnabled()&&!v.getProgramParameter(p,v.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${v.getProgramParameter(p,v.VALIDATE_STATUS)}`+`, gl error ${v.getError()}`+`, vertex: ${v.getShaderParameter(this._vShader,v.COMPILE_STATUS)}`+`, fragment: ${v.getShaderParameter(this._fShader,
v.COMPILE_STATUS)}`+`, info log: ${v.getProgramInfoLog(p)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);for(const [t,r]of this._uniformBlockBindings)n=v.getUniformBlockIndex(p,t),4294967295>n&&v.uniformBlockBinding(p,n,r);this._glName=p;this._context.instanceCounter.increment(c.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;
const n=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==n||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,n.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var n=this._context.gl,l=this._context.instanceCounter;this._nameToUniformLocation.forEach(u=>u&&l.decrement(c.ResourceType.Uniform,u));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(l.decrement(c.ResourceType.LinesOfCode,this._vShader,
this._linesOfCode),this._linesOfCode=0),n.deleteShader(this._vShader),this._vShader=null,l.decrement(c.ResourceType.Shader,this));this._fShader&&(n.deleteShader(this._fShader),this._fShader=null);this._glName&&(n.deleteProgram(this._glName),this._glName=null,l.decrement(c.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(n){var l=this._nameToUniformLocation.get(n);return void 0!==l?l:this.glName?(l=this._context.gl.getUniformLocation(this.glName,n),this._nameToUniformLocation.set(n,
l),l&&this._context.instanceCounter.increment(c.ResourceType.Uniform,l),l):null}hasUniform(n){return null!=this._getUniformLocation(n)}setUniform1i(n,l){const u=this._nameToUniform1.get(n);if(void 0===u||l!==u)this._context.gl.uniform1i(this._getUniformLocation(n),l),this._nameToUniform1.set(n,l)}setUniform1iv(n,l){f(this._nameToUniform1v,n,l)&&this._context.gl.uniform1iv(this._getUniformLocation(n),l)}setUniform2iv(n,l){f(this._nameToUniform2,n,l)&&this._context.gl.uniform2iv(this._getUniformLocation(n),
l)}setUniform3iv(n,l){f(this._nameToUniform3,n,l)&&this._context.gl.uniform3iv(this._getUniformLocation(n),l)}setUniform4iv(n,l){f(this._nameToUniform4,n,l)&&this._context.gl.uniform4iv(this._getUniformLocation(n),l)}setUniform1f(n,l){const u=this._nameToUniform1.get(n);if(void 0===u||l!==u)this._context.gl.uniform1f(this._getUniformLocation(n),l),this._nameToUniform1.set(n,l)}setUniform1fv(n,l){f(this._nameToUniform1v,n,l)&&this._context.gl.uniform1fv(this._getUniformLocation(n),l)}setUniform2f(n,
l,u){const x=this._nameToUniform2.get(n);if(void 0===x)this._context.gl.uniform2f(this._getUniformLocation(n),l,u),this._nameToUniform2.set(n,[l,u]);else if(l!==x[0]||u!==x[1])this._context.gl.uniform2f(this._getUniformLocation(n),l,u),x[0]=l,x[1]=u}setUniform2fv(n,l){f(this._nameToUniform2,n,l)&&this._context.gl.uniform2fv(this._getUniformLocation(n),l)}setUniform3f(n,l,u,x){const w=this._nameToUniform3.get(n);if(void 0===w)this._context.gl.uniform3f(this._getUniformLocation(n),l,u,x),this._nameToUniform3.set(n,
[l,u,x]);else if(l!==w[0]||u!==w[1]||x!==w[2])this._context.gl.uniform3f(this._getUniformLocation(n),l,u,x),w[0]=l,w[1]=u,w[2]=x}setUniform3fv(n,l){const u=this._getUniformLocation(n);null!=u&&f(this._nameToUniform3,n,l)&&this._context.gl.uniform3fv(u,l)}setUniform4f(n,l,u,x,w){const q=this._nameToUniform4.get(n);if(void 0===q)this._context.gl.uniform4f(this._getUniformLocation(n),l,u,x,w),this._nameToUniform4.set(n,[l,u,x,w]);else if(void 0===q||l!==q[0]||u!==q[1]||x!==q[2]||w!==q[3])this._context.gl.uniform4f(this._getUniformLocation(n),
l,u,x,w),q[0]=l,q[1]=u,q[2]=x,q[3]=w}setUniform4fv(n,l){const u=this._getUniformLocation(n);null!=u&&f(this._nameToUniform4,n,l)&&this._context.gl.uniform4fv(u,l)}setUniformMatrix3fv(n,l,u=!1){const x=this._getUniformLocation(n);null!=x&&f(this._nameToUniformMatrix3,n,l)&&this._context.gl.uniformMatrix3fv(x,u,l)}setUniformMatrix4fv(n,l,u=!1){const x=this._getUniformLocation(n);null!=x&&f(this._nameToUniformMatrix4,n,l)&&this._context.gl.uniformMatrix4fv(x,u,l)}stop(){}}const e={enabled:!1};a.Program=
g;a.test=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,h,c,k,m){function d(){function v(V){V.length&&C.push({type:x[F],data:V,position:K,line:z,column:J})}function p(){L=L.length?[]:L;if("/"===H&&"*"===G)return K=B+A-1,F=0,H=G,A+1;if("/"===H&&"/"===G)return K=B+A-1,F=1,H=G,A+1;if("#"===G)return F=2,K=B+A,A;if(/\s/.test(G))return F=
9,K=B+A,A;I=/\d/.test(G);M=/[^\w_]/.test(G);K=B+A;F=I?4:M?3:9999;return A}function t(){if(("\r"===G||"\n"===G)&&"\\"!==H)return v(L.join("")),F=999,A;L.push(G);H=G;return A+1}function r(){if("."===H&&/\d/.test(G))return F=5,A;if("/"===H&&"*"===G)return F=0,A;if("/"===H&&"/"===G)return F=1,A;if("."===G&&L.length){for(;y(L););F=5;return A}if(";"===G||")"===G||"("===G){if(L.length)for(;y(L););v(G);F=999;return A+1}var V=2===L.length&&"\x3d"!==G;if(/[\w_\d\s]/.test(G)||V){for(;y(L););F=999;return A}L.push(G);
H=G;return A+1}function y(V){var Q=0;do{var T=m.operators.indexOf(V.slice(0,V.length+Q).join(""));var ia=m.operators[T];if(-1===T){if(0<Q--+V.length)continue;ia=V.slice(0,1).join("")}v(ia);K+=ia.length;L=L.slice(ia.length);return L.length}while(1)}function D(){if("."===G||/[eE]/.test(G))return L.push(G),F=5,H=G,A+1;if("x"===G&&1===L.length&&"0"===L[0])return F=11,L.push(G),H=G,A+1;if(/[^\d]/.test(G))return v(L.join("")),F=999,A;L.push(G);H=G;return A+1}function E(){"f"===G&&(L.push(G),H=G,A+=1);if(/[eE]/.test(G)||
"-"===G&&/[eE]/.test(H))return L.push(G),H=G,A+1;if(/[^\d]/.test(G))return v(L.join("")),F=999,A;L.push(G);H=G;return A+1}var A=0,B=0,F=999,G,H,L=[],C=[],z=1,J=0,K=0,I=!1,M=!1,S="",N;return function(V){C=[];if(null!==V){V=V.replace?V.replace(/\r\n/g,"\n"):V;A=0;S+=V;for(N=S.length;G=S[A],A<N;){V=A;switch(F){case 0:"/"===G&&"*"===H?(L.push(G),v(L.join("")),F=999):(L.push(G),H=G);A+=1;break;case 1:A=t();break;case 2:A=t();break;case 3:A=r();break;case 4:A=D();break;case 11:/[^a-fA-F0-9]/.test(G)?(v(L.join("")),
F=999):(L.push(G),H=G,A+=1);break;case 5:A=E();break;case 9999:if(/[^\d\w_]/.test(G)){var Q=L.join("");F=-1<m.literals.indexOf(Q)?8:-1<m.builtins.indexOf(Q)?7:6;v(L.join(""));F=999}else L.push(G),H=G,A+=1;break;case 9:/[^\s]/g.test(G)?(v(L.join("")),F=999):(L.push(G),H=G,A+=1);break;case 999:A=p()}if(V!==A)switch(S[V]){case "\n":J=0;++z;break;default:++J}}B+=A;S=S.slice(A);return C}L.length&&v(L.join(""));F=10;v("(eof)");return C}}function f(v){return v.map(p=>"eof"!==p.type?p.data:"").join("")}function g(v,
p="100",t="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const y of v)if("preprocessor"===y.type){const D=r.exec(y.data);if(D){v=D[1].replaceAll(/\s\s+/g," ");if(v===t)return v;if(v===p)return y.data="#version "+t,p;throw Error("unknown glsl version: "+v);}}v.splice(0,0,{type:"preprocessor",data:"#version "+t},{type:"whitespace",data:"\n"});return null}function e(v,p,t,r){r=r||t;for(const y of v)if("ident"===y.type&&y.data===t)return r in p?p[r]++:p[r]=0,e(v,p,r+"_"+p[r],r);return t}
function n(v,p,t="afterVersion"){const r={data:"\n",type:"whitespace"},y=E=>E<v.length?/[^\r\n]$/.test(v[E].data):!1;let D=function(E){let A=-1,B=0,F=-1;for(let H=0;H<E.length;H++){var G=E[H];"preprocessor"===G.type&&(/#(if|ifdef|ifndef)\s+.+/.test(G.data)?++B:/#endif\s*.*/.test(G.data)&&--B);("afterVersion"===t||"afterPrecision"===t)&&"preprocessor"===G.type&&G.data.startsWith("#version")&&(F=Math.max(F,H));if("afterPrecision"===t&&"keyword"===G.type&&"precision"===G.data){a:{for(G=H;G<E.length;G++){const L=
E[G];if("operator"===L.type&&";"===L.data)break a}G=null}if(null===G)throw Error("precision statement not followed by any semicolons!");F=Math.max(F,G)}A<F&&0===B&&(A=H)}return A+1}(v);y(D-1)&&v.splice(D++,0,r);for(const E of p)v.splice(D++,0,E);y(D-1)&&y(D)&&v.splice(D,0,r)}function l(v,p,t,r="lowp"){n(v,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",data:p},{type:"operator",
data:";"}],"afterPrecision")}function u(v,p,t,r,y="lowp"){n(v,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",
data:p},{type:"operator",data:";"}],"afterPrecision")}var x="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const w=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),q=new Map;a.transpileShader=function(v,p){if(v.startsWith("#version 300"))return v;var t=k.shaderTranspiler.enableCache?q.get(v):null;if(null!=t)return t;t=d();var r=[];r=r.concat(t(v));t=r=r.concat(t(null));
if("300 es"===g(t,"100","300 es"))return v;var y=r=null;const D={},E={};for(let G=0;G<t.length;++G){const H=t[G];switch(H.type){case "keyword":p===h.ShaderType.VERTEX_SHADER&&"attribute"===H.data?H.data="in":"varying"===H.data&&(H.data=p===h.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(H.data.trim())&&(H.data=H.data.replaceAll(/(2D|Cube|EXT)/g,""));p===h.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===H.data&&(r||(r=e(t,D,"fragColor"),l(t,
r,"vec4")),H.data=r);if(p===h.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===H.data){var A=void 0;let L=void 0;var B=t,F=G+1;let C=-1;for(;F<B.length;F++){const z=B[F];if("operator"===z.type&&("["===z.data&&(L=F),"]"===z.data)){A=F;break}"integer"===z.type&&(C=parseInt(z.data,10))}L&&A&&B.splice(L,A-L+1);B=C;A=e(t,D,"fragData");u(t,A,"vec4",B,"mediump");H.data=A}else p===h.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===H.data&&(y||=e(t,D,"gl_FragDepth"),H.data=y);break;case "ident":if(c.includes(H.data)){if(B=
p===h.ShaderType.VERTEX_SHADER)a:{for(B=G-1;0<=B;B--)if(A=t[B],"whitespace"!==A.type&&"block-comment"!==A.type)if("keyword"===A.type){if("attribute"===A.data||"in"===A.data){B=!0;break a}}else break;B=!1}if(B)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");H.data in E||(E[H.data]=e(t,D,H.data));H.data=E[H.data]}}}for(p=t.length-1;0<=p;--p)r=t[p],"preprocessor"===r.type&&((y=r.data.match(/#extension\s+(.*):/))&&y[1]&&w.has(y[1].trim())&&(y=t[p+1],t.splice(p,
y&&"whitespace"===y.type?2:1)),(y=r.data.match(/#ifdef\s+(.*)/))&&y[1]&&w.has(y[1].trim())&&(r.data="#if 1"),(y=r.data.match(/#ifndef\s+(.*)/))&&y[1]&&w.has(y[1].trim())&&(r.data="#if 0"));t=f(t);k.shaderTranspiler.enableCache&&q.set(v,t);return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,b){var h={exports:{}};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(h);
h=b.getDefaultExportFromCjs(h.exports);var c={exports:{}};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(c);c=b.getDefaultExportFromCjs(c.exports);var k={exports:{}};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(k);
b=b.getDefaultExportFromCjs(k.exports);a.builtins=b;a.literals=h;a.operators=c})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,h,c,k,m){class d{constructor(f){this.rctx=f;this.floatBufferBlend=new c.FloatBufferBlend(f);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(f);this.doublePrecisionRequiresObfuscation=new h.DoublePrecisionRequiresObfuscation(f);
this.ignoresSamplerPrecision=new k.IgnoresSamplerPrecision(f);this.drawArraysRequiresIndicesTypeReset=new b.DrawArraysRequiresIndicesTypeReset(f)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}a.WebGLDriverTest=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,h,c,k,m,d,f,g){class e extends g.WebGLDriverTestModule{constructor(n){super();this._rctx=n;this._helperProgram=null;b("mac")&&b("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(n){const l=this._rctx,u=l.getBoundFramebufferObject(),{x,y:w,width:q,height:v}=l.getViewport();l.resetState();var p=new f.TextureDescriptor(1);p.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE;
p.samplingMode=m.TextureSamplingMode.NEAREST;p=new d.FramebufferObject(l,p);const t=k.BufferObject.createIndex(this._rctx,m.Usage.STATIC_DRAW,new Uint8Array([0]));l.bindFramebuffer(p);l.setViewport(0,0,1,1);l.useProgram(this._helperProgram);l.bindBuffer(t,m.BufferType.ELEMENT_ARRAY_BUFFER);l.drawElements(m.PrimitiveType.POINTS,1,m.DataType.UNSIGNED_BYTE,0);l.useProgram(n);l.bindVAO(null);l.drawArrays(m.PrimitiveType.TRIANGLES,0,258);n=new Uint8Array(4);p.readPixels(0,0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,
n);l.setViewport(x,w,q,v);l.bindFramebuffer(u);p.dispose();t.dispose();return 255===n[0]}_prepareProgram(){const n=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${h.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
l=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${h.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(n,l,new Map([]))}_prepareHelperProgram(){const n=c.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(n.vertex,n.fragment,new Map([]))}}a.DrawArraysRequiresIndicesTypeReset=e;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(a,b){class h{constructor(){this._result=!1}dispose(){this._program=b.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}a.WebGLDriverTestModule=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(q,v){return q.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${v?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class w extends u.WebGLDriverTestModule{constructor(q){super();this._rctx=q;this._program=x(this._rctx,!1);this._obfuscated=x(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=c.disposeMaybe(this._obfuscated)}_test(q){if(h("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;q=this._runProgram(q);const v=this._runProgram(this._obfuscated);
return 0!==q&&(0===v||5<q/v)}_runProgram(q){var v=this._rctx;v.resetState();var p=new e.TextureDescriptor(1);p.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;p.samplingMode=f.TextureSamplingMode.NEAREST;p=new g.FramebufferObject(v,p);var t=m.BufferObject.createVertex(v,f.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new n.VertexArrayObject(v,new Map([["position",0]]),{geometry:[new l.VertexElementDescriptor("position",2,f.DataType.UNSIGNED_SHORT,0,4)]},{geometry:t});const r=k.fromValues(5633261.287538229,
2626832.878767164,1434988.0495278358),y=k.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),D=new Float32Array(6);d.encodeDoubleArray(r,D,3);const E=new Float32Array(6);d.encodeDoubleArray(y,E,3);v.useProgram(q);q.setUniform3f("u_highA",D[0],D[2],D[4]);q.setUniform3f("u_lowA",D[1],D[3],D[5]);q.setUniform3f("u_highB",E[0],E[2],E[4]);q.setUniform3f("u_lowB",E[1],E[3],E[5]);v.bindFramebuffer(p);v.setViewport(0,0,1,1);v.bindVAO(t);v.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4);q=new Uint8Array(4);
p.readPixels(0,0,1,1,f.PixelFormat.RGBA,f.PixelType.UNSIGNED_BYTE,q);t.dispose();p.dispose();v=(r[2]-y[2])/25;q=b.unpackFloatRGBA(q);return Math.abs(v-q)}}a.DoublePrecisionRequiresObfuscation=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends e.WebGLDriverTestModule{constructor(l){super();this._rctx=l;l.gl&&l.capabilities.textureFloat?.textureFloat&&l.capabilities.colorBufferFloat?.textureFloat&&l.capabilities.colorBufferFloat?.floatBlend&&(this._program=l.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(l){const u=this._rctx;var x=new d.TextureDescriptor(1);x.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;x.dataType=c.PixelType.FLOAT;x.internalFormat=c.SizedPixelFormat.RGBA32F;x.samplingMode=c.TextureSamplingMode.NEAREST;x=new k.FramebufferObject(u,x);var w=h.BufferObject.createVertex(u,c.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));w=new f.VertexArrayObject(u,new Map([["a_pos",0]]),{geometry:[new g.VertexElementDescriptor("a_pos",2,c.DataType.UNSIGNED_SHORT,0,4)]},
{geometry:w});u.useProgram(l);l=u.getBoundFramebufferObject();const {x:q,y:v,width:p,height:t}=u.getViewport();u.bindFramebuffer(x);u.setViewport(0,0,1,1);u.bindVAO(w);u.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);var r=m.makePipelineState({blending:b.blendingAlpha});u.setPipelineState(r);u.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);r=u.gl.getError();u.setViewport(q,v,p,t);u.bindFramebuffer(l);w.dispose();x.dispose();return 1282===r?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),
!1):!0}}a.FloatBufferBlend=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n extends e.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._program=l.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(l){const u=this._rctx;var x=new d.TextureDescriptor(1);x.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=c.TextureSamplingMode.NEAREST;const w=new k.FramebufferObject(u,x),q=new Uint8Array(4);var v=h.BufferObject.createVertex(u,c.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));v=new f.VertexArrayObject(u,new Map([["a_position",
0]]),{geometry:[new g.VertexElementDescriptor("a_position",2,c.DataType.SHORT,0,4)]},{geometry:v});u.useProgram(l);x=new m.Texture(u,x,new Uint8Array([2,255,0,0]));l.setUniform1i("u_texture",0);u.bindTexture(x,0);x=u.getBoundFramebufferObject();u.bindFramebuffer(w);u.useProgram(l);const {x:p,y:t,width:r,height:y}=u.getViewport();u.setViewport(0,0,1,1);u.bindVAO(v);u.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);u.setViewport(p,t,r,y);w.readPixels(0,0,1,1,c.PixelFormat.RGBA,c.PixelType.UNSIGNED_BYTE,
q);v.dispose();w.dispose();(l=255!==q[0]||255!==q[1]||255!==q[2]||255!==q[3])&&b.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${q[0]}.${q[1]}.${q[2]}.${q[3]}]`);u.bindFramebuffer(x);return l}}
a.IgnoresSamplerPrecision=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,h,c,k,m,d,f,g){class e extends g.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._program=l.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(l){const u=this._rctx;if(!u.gl)return l.dispose(),!0;var x=new d.TextureDescriptor(1);x.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=c.TextureSamplingMode.NEAREST;x=new k.FramebufferObject(u,x);var w=h.BufferObject.createVertex(u,c.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));w=new f.VertexArrayObject(u,new Map([["a_pos",0]]),b.Pos2us,{geometry:w});var q=new d.TextureDescriptor;q.samplingMode=c.TextureSamplingMode.LINEAR;q.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;q=new m.Texture(u,q,n);u.useProgram(l);u.bindTexture(q,0);l.setUniform1i("u_texture",0);l=u.getBoundFramebufferObject();const {x:v,y:p,width:t,height:r}=u.getViewport();u.bindFramebuffer(x);u.setViewport(0,0,1,1);u.setClearColor(0,0,0,0);u.setBlendingEnabled(!1);u.clearSafe(c.ClearBufferBit.COLOR_BUFFER_BIT);
u.bindVAO(w);u.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);x.readPixels(0,0,1,1,c.PixelFormat.RGBA,c.PixelType.UNSIGNED_BYTE,y);w.dispose();x.dispose();q.dispose();u.setViewport(v,p,t,r);u.bindFramebuffer(l);return 255!==y[0]}}const n=new Image;n.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
n.width=5;n.height=5;n.decode();a.SVGPremultipliedAlpha=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,h){const c={geometry:[new h.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},k={geometry:[new h.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new h.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,
2,4)]};b={geometry:[new h.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=c;a.Pos2us=b;a.PosTex2b=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports","./DisjointTimerQuery","./load","./LoseContext"],function(a,b,h,c){class k{constructor(m,d){this._gl=m;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=
this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=null;this._disabledExtensions=d.disabledExtensions||{};this._debugWebGLExtensions=d.debugWebGLExtensions||{}}get drawBuffers(){if(this._disabledExtensions.disjointTimerQuery)return null;this._drawBuffers||(this._drawBuffers={drawBuffers:this._gl.drawBuffers.bind(this._gl),MAX_DRAW_BUFFERS:this._gl.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:this._gl.MAX_COLOR_ATTACHMENTS});return this._drawBuffers}get vao(){if(!this._vertexArrayObject){const m=
this._gl;this._vertexArrayObject={createVertexArray:m.createVertexArray.bind(m),deleteVertexArray:m.deleteVertexArray.bind(m),bindVertexArray:m.bindVertexArray.bind(m)}}return this._vertexArrayObject}get compressedTextureETC(){this._compressedTextureETC||(this._compressedTextureETC=h.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=h.loadCompressedTextureS3TC(this._gl,
this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=h.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||(this._disjointTimerQuery=b.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const {textureFloatLinear:m}=
this._disabledExtensions,{HALF_FLOAT:d,R16F:f,RG16F:g,RGBA16F:e,R32F:n,RG32F:l,RGBA32F:u,R11F_G11F_B10F:x,RGB16F:w}=this._gl;this._textureFloat={textureFloat:!0,textureFloatLinear:!m&&!!this._gl.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:d,R16F:f,RG16F:g,RGBA16F:e,R32F:n,RG32F:l,RGBA32F:u,R11F_G11F_B10F:x,RGB16F:w}}return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||(this._colorBufferFloat=h.loadColorBufferFloat(this._gl,
this._disabledExtensions));return this._colorBufferFloat}get blendMinMax(){if(!this._minMaxBlending){const {MIN:m,MAX:d}=this._gl;this._minMaxBlending={MIN:m,MAX:d}}return this._minMaxBlending}get depthTexture(){null===this._depthTexture&&(this._depthTexture=h.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=c.load(this._gl,
this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16||(this._textureNorm16=h.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=h.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(m){return this[m]}}a.Capabilities=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],function(a){a.loadBooleanExtension=function(b,h,c,k,m){if(k)return!0;if(h[c])return!1;for(const d of m)if(b.getExtension(d))return!0;return!1};a.loadColorBufferFloat=function(b,h){const c=!h.colorBufferHalfFloat&&b.getExtension("EXT_color_buffer_half_float")||!h.colorBufferFloat&&b.getExtension("EXT_color_buffer_float"),k=!h.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");h=!h.floatBlend&&!h.colorBufferFloat&&
b.getExtension("EXT_float_blend");return c||k||h?{textureFloat:!!k,textureHalfFloat:!!c,floatBlend:!!h,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null};a.loadCompressedTextureETC=function(b,h){return h.compressedTextureETC?null:(b=b.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:b.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:b.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:b.COMPRESSED_RG11_EAC,
COMPRESSED_SIGNED_RG11_EAC:b.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:b.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:b.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:b.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(b,h){return h.compressedTextureS3TC?
null:(b=b.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:b.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:b.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:b.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:b.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(b,h){return h.textureFilterAnisotropic?null:(b=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?
{MAX_TEXTURE_MAX_ANISOTROPY:b.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:b.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureNorm16=function(b,h){return h.textureNorm16?null:(b=b.getExtension("EXT_texture_norm16"))?{R16:b.R16_EXT,RG16:b.RG16_EXT,RGB16:b.RGB16_EXT,RGBA16:b.RGBA16_EXT,R16_SNORM:b.R16_SNORM_EXT,RG16_SNORM:b.RG16_SNORM_EXT,RGB16_SNORM:b.RGB16_SNORM_EXT,RGBA16_SNORM:b.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],
function(a){a.load=function(b,h){const c=h.loseContext&&b.getExtension("WEBGL_lose_context");return c?{loseRenderingContext:()=>c.loseContext()}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./ITexture ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){a.TextureRepository=class extends h{constructor(t,r,y){super({});this._stage=t;this._techniqueRepository=r;this._rctx=y;this._textures=new Map;this._loadingCount=0;this._frameUpdates=new Map;this.events=new c;this._frameTask=t.view.resourceController.scheduler.registerTask(v.TaskPriority.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove();this._stage.forEachOfType(l.ContentObjectType.Texture,t=>t.unload())}get updating(){return 0<
this._loadingCount||this._frameTask.updating}get textureTechnique(){null==this._textureTechnique&&(this._textureTechnique=this._techniqueRepository.acquire(x.TextureTechnique,new w.TextureTechniqueConfiguration));return this._textureTechnique}acquire(t){const r=this._textures.get(t);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(t)}update(){let t=!1;this._frameUpdates.forEach(r=>{const y=r.texture.frameUpdate(r.previousToken);0<=y&&y!==r.previousToken&&(r.previousToken=y,t=!0)});t&&this.events.emit("changed",
n.RenderRequestType.BACKGROUND)}_createNewRef(t){const r=this._stage.getObject(t);if(null==r)return q.assert(void 0!==r),null;const y=r.events.on("unloaded",()=>{y.remove();this._onTextureUnloaded(t)}),D=new p(t,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&r.unload()})});this._textures.set(t,D);D.ref();if(r.glTexture)return this._updateGLTexture(D,r.glTexture),u.isFrameUpdateTexture(r)&&this._frameUpdates.set(t,{texture:r,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>
{const E=r.load(this._rctx),A=F=>{this._loadingCount--;D.loadingPromise=null;this._updateGLTexture(D,F);u.isFrameUpdateTexture(r)&&this._frameUpdates.set(t,{texture:r,previousToken:-1});return D},B=F=>{this._loadingCount--;D.loadingPromise=null;m.isAbortError(F)||k.getLogger(this).error(F);return null};return m.isPromiseLike(E)?E.then(A,B):A(E)});return D.loadingPromise}_updateGLTexture(t,r){t.glTexture=r;this.events.emit("changed",n.RenderRequestType.UPDATE)}_onTextureUnloaded(t){this._textures.delete(t);
this._frameUpdates.delete(t)}};b.__decorate([d.property()],a.TextureRepository.prototype,"_loadingCount",void 0);b.__decorate([d.property()],a.TextureRepository.prototype,"_frameTask",void 0);b.__decorate([d.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);class p{constructor(t,r){this.id=t;this._release=r;this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount;
0<this._refCount||(0===this._refCount?this._release():(k.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ITexture":function(){define(["exports"],function(a){a.isFrameUpdateTexture=function(b){return!!b.frameUpdate};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports",
"../../support/engineContent/marker","./ProceduralTextureRepository"],function(a,b,h){a.createMarkerTextureRepository=function(c,k){return new h.ProceduralTextureRepository(m=>b.createMarkerTexture(m,c),m=>m,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.WaterTextureRepository=class extends c{constructor(){super(...arguments);this._passParameters=new t;this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=d.abortMaybe(this._resourcesTask);this._passParameters.waveNormal=d.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePerturbation=d.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&
!this._resourcesTask.finished}ensureResources(r){this._resourcesTask||(this._resourcesTask=k.createTask(async y=>{await Promise.allSettled([this._loadImageResource(r,h.getAssetUrl("esri/images/materials/water/normals.jpg"),D=>this._passParameters.waveNormal=D,y),this._loadImageResource(r,h.getAssetUrl("esri/images/materials/water/perturbation.jpg"),D=>this._passParameters.wavePerturbation=D,y)])}));return this._resourcesTask.finished?w.ResourceState.LOADED:w.ResourceState.LOADING}async _loadImageResource(r,
y,D,E){try{const A=await u.requestImage(y,{signal:E});f.throwIfAborted(E);const B=new p.TextureDescriptor(A.width,A.height);B.pixelFormat=q.PixelFormat.RGB;B.samplingMode=q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;B.hasMipmap=!0;B.maxAnisotropy=8;D(new v.Texture(r,B,A))}catch(A){m.getLogger(this).error("Failed to load water material normal texture.",A)}}};b.__decorate([g.property()],a.WaterTextureRepository.prototype,"_resourcesTask",void 0);b.__decorate([g.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,
"updating",null);a.WaterTextureRepository=b.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);class t extends x.NoParameters{}a.WaterTexturePassParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../lib/basicInterfaces ../lib/rendererUtils ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e){class n{constructor(u,x,w){this.parameters=u;this.frameHasDecorations=x;this.fbos=w}}class l{constructor(u,x,
w){this._rctx=u;this._renderFunctions=x;this._forceCameraHook=w;this.supersample=!0;this._screenshotQueue=[]}destroy(){this._rctx=null}async takeScreenshot(u){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(c.RenderRequestType.BACKGROUND);const x=b.createResolver();this._screenshotQueue.push({settings:u,resolver:x});return x.promise}update(u,x){for(const w of this._screenshotQueue){if(null==this._rctx){w.resolver.reject();continue}const q=this._renderScreenshot(u,
{...w.settings,pixelRatio:w.settings.pixelRatio*u.parameters.camera.pixelRatio},x);w.resolver(q)}this._screenshotQueue.length=0}_renderScreenshotOverlay(u,x,w){u.width=x.width;u.height=x.height;const q=u.getContext("2d"),v=w.pixelRatio;q.save();q.translate(0,x.height);q.scale(1,-1);w.region&&q.translate(-w.region.x,-w.region.y);q.scale(v,v);x=this._renderFunctions.renderOverlay(u,w.disableDecorations?c.Decorations.OFF:c.Decorations.ON,x);q.restore();return x}_readbackScreenshot(u,x){return u.resample?
this._readbackScreenshotResampled({...u,resample:u.resample},x):this._readbackScreenshotImmediate(u,x)}_readbackScreenshotResampled(u,x){const {framebufferWidth:w,framebufferHeight:q,region:v,resample:p}=u,t=this._ensureScreenshotEncodeCanvas();let r=e.createEmptyImageData(w,q,t);this._rctx.gl.readPixels(0,0,w,q,f.PixelFormat.RGBA,f.DataType.UNSIGNED_BYTE,new Uint8Array(r.data.buffer));x();r=this._renderScreenshotOverlay(t,r,{...u,region:void 0});u=e.createEmptyImageData(v.width,v.height,t);return d.resampleHermite(r,
u,!0,p.region.x,q-(p.region.y+p.region.height),p.region.width,p.region.height)}_readbackScreenshotImmediate(u,x){const {framebufferHeight:w,region:q}=u,v=this._ensureScreenshotEncodeCanvas(),p=e.createEmptyImageData(q.width,q.height,v);this._rctx.gl.readPixels(q.x,w-(q.y+q.height),q.width,q.height,f.PixelFormat.RGBA,f.DataType.UNSIGNED_BYTE,new Uint8Array(p.data.buffer));x();return this._renderScreenshotOverlay(v,p,u)}_renderScreenshot(u,x,w){var q=u.parameters.camera,v={width:x.framebufferWidth,
height:x.framebufferHeight};g.ensureAttachmentMaxSize(v,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));var p=!1,t=x.disableDecorations&&u.frameHasDecorations,r=x.ignorePadding&&q.pixelRatio!==x.pixelRatio;t=v.width!==q.fullWidth||v.height!==q.fullHeight||t||r||x.objectAndLayerIdColor;let y=null,D=null;if(t){p=q.clone();if(x.ignorePadding){r=h.clone(p.padding);for(let E=0;4>E;E++)r[E]=Math.round(r[E]/p.pixelRatio*x.pixelRatio);p.padding=r}p.fullWidth=v.width;
p.fullHeight=v.height;p.pixelRatio=x.pixelRatio;v=q.fovX-p.fovX;r=q.fovY-p.fovY;0>v&&v<r?p.fovX=q.fovX:0>r&&r<v&&(p.fovY=q.fovY);q={camera:p,contentCamera:p,mode:m.RenderState.IDLE,alignPixelEnabled:!0,contentPixelRatio:p.pixelRatio};this._forceCameraHook(q);p=!0;w=this._renderFunctions.renderScene(q,w,x.objectAndLayerIdColor?k.RendererTarget.ObjectAndLayerID:k.RendererTarget.Screenshot,x.disableDecorations?c.Decorations.OFF:c.Decorations.ON);D=w.screen;y=w.oid}this._rctx.bindFramebuffer(D?.fbo);
w=this._readbackScreenshot(x,()=>{this._rctx.bindFramebuffer(null);D?.release()});q=null;x.objectAndLayerIdColor&&(this._rctx.bindFramebuffer(y?.fbo),q=this._readbackScreenshot(x,()=>{this._rctx.bindFramebuffer(null);y?.release()}),this._rctx.bindFramebuffer(null));if(t&&!this._rctx.contextAttributes.alpha)for(x=3;x<w.data.length;x+=4)w.data[x]=255;if(q&&!this._rctx.contextAttributes.alpha)for(x=3;x<q.data.length;x+=4)q.data[x]=255;p&&this._forceCameraHook(u.parameters);return[w,q]}_ensureScreenshotEncodeCanvas(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas}}a.ScreenshotContext=n;a.ScreenshotManager=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(a,b,h,c){function k(q,v){const {format:p,quality:t,rotation:r,disableDecorations:y}=q||{};var D=e(q,v.padding);var E=v.width-D.left-D.right;v=v.height-D.top-
D.bottom;D={x:0,y:0,width:E,height:v};if(q?.area){null!=q.area.x&&(D.x=Math.floor(q.area.x));null!=q.area.y&&(D.y=Math.floor(q.area.y));var A=null!=q.area.width?Math.floor(q.area.width):null,B=null!=q.area.height?Math.floor(q.area.height):null;D.width=E-D.x;D.height=v-D.y;null!=A&&null!=B?(D.width=Math.min(D.width,A),D.height=Math.min(D.height,B)):null==A&&null!=B?(A=Math.min(D.width,A),D.height*=A/D.width,D.width=A):null!=A&&null==B&&(A=Math.min(D.height,B),D.width*=A/D.height,D.height=A)}D=g(D,
q);A=Math.floor(Math.max(D.x,0));B=Math.floor(Math.max(D.y,0));E={x:A,y:B,width:Math.floor(Math.min(D.width,E-A)),height:Math.floor(Math.min(D.height,v-B))};v=E.width/E.height;D=D.width/D.height;D!==v&&(D>v?(v=Math.floor(E.width/D),E={x:E.x,y:Math.floor(E.y+(E.height-v)/2),width:E.width,height:v}):(v=Math.floor(E.height*D),E={x:Math.floor(E.x+(E.width-v)/2),y:E.y,width:v,height:E.height}));const {width:F,height:G}=f(q,E);v=n(p);D=x[v];D=h.clamp(null!=t?t:D,0,100);return{format:v,quality:D,area:E,
width:F,height:G,rotation:r,disableDecorations:!!y,ignoreBackground:!!q?.ignoreBackground,ignorePadding:!!q?.ignorePadding}}function m(q,v){null==l&&(l=document.createElement("canvas"));var p=l;if(v.premultipliedAlpha){var t=q.data;const y=t.length;for(let D=0;D<y;D+=4){var r=t[D+3];255!==r&&0<r&&(r=255/r,t[D]*=r,t[D+1]*=r,t[D+2]*=r)}}p.width=q.width;p.height=q.height;t=p.getContext("2d",{willReadFrequently:!0});t.putImageData(q,0,0);v.flipY&&(t.save(),t.globalCompositeOperation="copy",t.scale(1,
-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore());return{ctx:t,canvas:p}}function d(q,v){return q.toDataURL(u[v.format],v.quality/100)}function f(q,v){if(!q)return v;const p=q.width;q=q.height;if(null!=p&&null!=q)return{width:Math.floor(p),height:Math.floor(q)};if(null==p&&null==q)return v;v=v.width/v.height;return null==q?{width:Math.floor(p),height:Math.floor(p/v)}:{width:Math.floor(q*v),height:Math.floor(q)}}function g(q,v){if(null==v?.width||null==v.height)return q;v=
v.width/v.height;const p=q.width/q.height;if(p===v)return q;if(p<v)return v=Math.floor(q.height*v),q.x-=(v-q.width)/2,q.width=v,q;v=Math.floor(q.width/v);q.y-=(v-q.height)/2;q.height=v;return q}function e(q,v){return!v||q&&q.ignorePadding?w:v}function n(q){switch(q){case "png":case "jpg":case "jpeg":return q;case null:case void 0:return"png";default:return"png"}}let l=null;const u={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},x={png:100,jpg:98,jpeg:98},w={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=
c.createEmptyImageData;a.completeUserSettings=k;a.encode=function(q,v,p){const {ctx:t,canvas:r}=m(q,p);q=t.getImageData(0,0,q.width,q.height);v=d(r,v);r.width=0;r.height=0;return{dataUrl:v,data:q}};a.encodeData=function(q,v){const {ctx:p,canvas:t}=m(q,v);q=p.getImageData(0,0,q.width,q.height);t.width=0;t.height=0;return q};a.getFormatAndQuality=function(q,v){q=n(q);const p=x[q];v=h.clamp(null!=v?v:p,0,100);return{format:q,quality:v}};a.getMaximumResolutionScale=function(q,v){return v/Math.max(q[0],
q[1])};a.resampleHermite=function(q,v,p,t=0,r=0,y=q.width-t,D=q.height-r,E=!1){const {data:A}=q,{width:B,height:F,data:G}=v;y/=B;D/=F;const H=Math.ceil(y/2),L=Math.ceil(D/2);q=q.width;for(let J=0;J<F;J++)for(let K=0;K<B;K++){const I=4*(K+(E?F-J-1:J)*B);let M=0,S=0,N=0,V=0,Q=0,T=0;const ia=(J+.5)*D;for(let O=Math.floor(J*D);O<(J+1)*D;O++){var C=Math.abs(ia-(O+.5))/L;const U=(K+.5)*y;C*=C;for(let P=Math.floor(K*y);P<(K+1)*y;P++){var z=Math.abs(U-(P+.5))/H;z=Math.sqrt(C+z*z);if(1<=z)continue;z=2*z*z*
z-3*z*z+1;const R=4*(t+P+(r+O)*q);T+=z*A[R+3];S+=z;!p&&255>A[R+3]&&(z=z*A[R+3]/255);N+=z*A[R];V+=z*A[R+1];Q+=z*A[R+2];M+=z}}G[I]=N/M;G[I+1]=V/M;G[I+2]=Q/M;G[I+3]=T/S}return v};a.screenshotSuperSampleSettings=function(q,v,p){if(!v)return q;const {framebufferWidth:t,framebufferHeight:r,pixelRatio:y,region:D}=q;v=e(q,p);p=v.left+v.right;const E=v.top+v.bottom,A=t-p,B=r-E,F=Math.min(8,Math.min((2048-p)/A,(2048-E)/B));return 1.5>F?q:{...q,framebufferWidth:Math.round(A*F)+p,framebufferHeight:Math.round(B*
F)+E,pixelRatio:y*F,resample:{region:{x:Math.round((D.x-v.left)*F)+v.left,y:Math.round((D.y-v.top)*F)+v.top,width:Math.round(D.width*F),height:Math.round(D.height*F)},width:t,height:r}}};a.toDataUrl=d;a.toRenderSettings=function(q,v){const p=k(q,v),t=p.area,r=p.width/t.width,y=e(p,v.padding),D=y.left+y.right,E=y.top+y.bottom;return{framebufferWidth:Math.floor((v.width-D)*r+D),framebufferHeight:Math.floor((v.height-E)*r+E),region:{x:Math.floor(t.x*r)+y.left,y:Math.floor(t.y*r)+y.top,width:p.width,
height:p.height},format:p.format,quality:p.quality,rotation:p.rotation,pixelRatio:r,layers:q?.layers??[],disableDecorations:p.disableDecorations,ignoreBackground:p.ignoreBackground,ignorePadding:p.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const h=b.getContextCache();h.forEach(c=>
c.dispose());h.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/contextUtils":function(){define(["exports"],function(a){a.createContext=function(b,h={}){return(b=b.getContext("webgl2",h))?b:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports"],function(a){a.extractSafeScaleBounds=function(b){b=b.effectiveScaleRange;return{minScale:b?.minScale??0,maxScale:b?.maxScale??0}};a.highlightsSupported=
function(b){return b&&"function"===typeof b.highlight};a.isScaleRangeActive=function(b,h){return null!=b&&0<b||null!=h&&0<h};a.isSelectableLayerView2D=function(b){return null!=b&&"object"===typeof b&&"createQuery"in b&&"queryFeatures"in b&&"layer"in b&&"view"in b};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};a.scaleBoundsPredicate=function(b,h,c){return null==b||b>c&&(0===h||b<h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports",
"../../core/Error","../webgl/capabilities"],function(a,b,h){a.check=function(c){const k=h.getWebGLCapabilities();return k.available?"3d"===c&&k.majorPerformanceCaveat?new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):k.supportsHighPrecisionFragment?k.supportsVertexShaderSamplers?null:new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):
new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new b("webgl:required","WebGL2 is required but not supported.",Error().stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","./contextUtils"],function(a,b){function h(m){if("undefined"===typeof WebGL2RenderingContext)return null;var d=document.createElement("canvas");if(!d)return null;let f=
b.createContext(d,{failIfMajorPerformanceCaveat:!0});null==f&&(f=b.createContext(d),null!=f&&(m.majorPerformanceCaveat=!0));if(null==f)return f;m.available=!0;m.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE);m.supportsVertexShaderSamplers=0<f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(d=f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT))m.supportsHighPrecisionFragment=0<d.precision;return f}let c;class k{constructor(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=
0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}}a.getWebGLCapabilities=function(){if(!c){{const m=new k,d=h(m);null!=d&&(m.supportsColorBufferFloat=null!==d.getExtension("EXT_color_buffer_float"),m.supportsColorBufferFloatBlend=null!==d.getExtension("EXT_float_blend"),m.supportsColorBufferHalfFloat=m.supportsColorBufferFloat||null!==d.getExtension("EXT_color_buffer_half_float"));
c=m}}return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l,u){b=class extends g{constructor(x){super(x);
this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};this.components=[];this._updateViewAwareWidgets=w=>{this.components.forEach(q=>{q=this._find(q)?.widget;void 0!==q?.view&&(q.view=w)})};this._componentsWatcher=(w,q)=>{this._removeComponents(q);this._addComponents(w);this._adjustPadding(w)}}initialize(){this.addHandles([c.watch(()=>this.components,this._componentsWatcher,c.initial),c.watch(()=>this.view,this._updateViewAwareWidgets,
c.initial)])}_add(x,w,q,v,p){let t=x;if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;t=this._createComponent(x)}super._add(t,w,q,v,p)}_removeComponents(x){x.forEach(w=>{if(w=this._find(w))this.remove(w),w.destroy()})}_adjustPadding(x){x.includes("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)}_addComponents(x){this.constructed&&x.forEach(w=>this.add(this._createComponent(w),this._defaultPositionLookup[w]))}_createComponent(x){const w=
this._createWidget(x);return new f({id:x,node:w})}_createWidget(x){const {view:w}=this;switch(x){case "attribution":return new e({view:w});case "compass":return new n({view:w});case "navigation-toggle":return new l({view:w});case "zoom":return new u({view:w})}}};a.__decorate([k.property()],b.prototype,"components",void 0);return b=a.__decorate([d.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){b=class extends b{constructor(){super(...arguments);this.widget=null}destroy(){this.node=null;this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(g){this._set("id",g)}set node(g){const e=this._get("node");g!==e&&(g&&g.classList.add("esri-component"),e&&e.classList.remove("esri-component"),this._set("node",g))}castNode(g){this.widget?.destroy();if(!g)return this._set("widget",null),null;if("string"===typeof g||g&&"nodeType"in g)return this._set("widget",
null),h.byId(g);g&&"function"===typeof g.render&&!g.domNode&&(g.domNode=document.createElement("div"));this._set("widget",g);return g.domNode}};a.__decorate([c.property()],b.prototype,"id",null);a.__decorate([c.property()],b.prototype,"node",null);a.__decorate([k.cast("node")],b.prototype,"castNode",null);a.__decorate([c.property({readOnly:!0})],b.prototype,"widget",void 0);return b=a.__decorate([f.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/tslib.es6 ../../intl ../../core/arrayUtils ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(r){return 0===r?"0":`${r}px`}function q(r){const y="object"===typeof r&&null!==r&&Object.getPrototypeOf(r);return null!==y&&y!==Object.prototype||!("component"in r||"index"in r||"position"in r)?null:r}function v(r,{top:y,bottom:D,left:E,right:A}){r.style.top=y;r.style.bottom=D;r.style.left=E;r.style.right=A}const p={left:0,top:0,bottom:0,right:0},t={bottom:30,top:15,right:15,left:15};b=class extends k.EventedAccessor{constructor(r){super(r);this._cornerNameToContainerLookup=
{};this._positionNameToContainerLookup={};this._components=[];this._componentMap=new Map;this._locale=x.getLocale();this.view=null;this._applyViewPadding=()=>{const y=this.container;y&&v(y,this._toPixelPosition(this._getViewPadding()))};this._applyUIPadding=()=>{const y=this._innerContainer;y&&v(y,this._toPixelPosition(this.padding))};this._initContainers()}initialize(){this.addHandles([m.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,m.initial),m.watch(()=>this.padding,this._applyUIPadding,
m.initial),m.watch(()=>[this.container,this._locale],([r,y])=>{r&&r.setAttribute("lang",y)},m.initial),x.onLocaleChange(r=>{this._locale=r})])}destroy(){this.container=null;for(const r of this._components)r.destroy();this._components.length=0;this._componentMap.clear()}set container(r){const y=this._get("container");r!==y&&(r&&(r.classList.add("esri-ui"),n.setCalciteThemeClass(r),this._attachContainers(r)),y&&(y.classList.remove("esri-ui"),v(y,{top:"",bottom:"",left:"",right:""}),c.empty(y)),this._set("container",
r))}get height(){const r=this.view?.height??0;if(0===r)return r;const y=this._getViewPadding(),{top:D,bottom:E}=y;return Math.max(r-D-E,0)}get padding(){return this._get("padding")}set padding(r){this._overrideIfSome("padding",r)}castPadding(r){return"number"===typeof r?{bottom:r,top:r,right:r,left:r}:{...t,...r}}get width(){const r=this.view?.width??0;if(0===r)return r;const y=this._getViewPadding(),{left:D,right:E}=y;return Math.max(r-D-E,0)}add(r,y){let D,E,A;if(Array.isArray(r))r.forEach(F=>this.add(F,
y));else{var B=q(r);B&&({index:D,position:y,component:r,key:E}=B);y&&"object"===typeof y&&({index:D,key:E,position:y,internal:A}=y);!r||y&&!this._isValidPosition(y)||this._add(r,y,D,E,A)}}remove(r,y){if(r){if(Array.isArray(r))return r.map(E=>this.remove(E,y));if((r=this._find(r))&&(!this._componentMap.has(r)||this._componentMap.get(r)?.key===y)){var D=this._components.indexOf(r);r.node.parentNode?.removeChild(r.node);this._componentMap.delete(r);return this._components.splice(D,1)[0]}}}empty(r,y=
{removeInternal:!1}){if(Array.isArray(r))for(const D of r)this.empty(D,y);else{r=Array.prototype.slice.call(this._positionNameToContainerLookup[r??"manual"].children).map(D=>this._findByNode(D)).filter(D=>null==D?!1:!(this._componentMap.get(D)?.internal??!1)||y.removeInternal);for(const D of r)this.remove(D)}}move(r,y){Array.isArray(r)&&r.forEach(A=>this.move(A,y));if(r){var D=q(r)||q(y);if(D){var E=D.index;y=D.position;r=D.component||r}(!y||this._isValidPosition(y))&&(r=this.remove(r))&&this.add(r,
{position:y,index:E})}}find(r){return r?(r=this._findById(r))&&(r.widget||r.node):null}getComponents(r,y={includeInternal:!1}){return r?Array.isArray(r)?r.flatMap(D=>this._getComponentsAtPosition(D,y)):this._getComponentsAtPosition(r,y):this._components.filter(D=>y.includeInternal||!(this._componentMap.get(D)?.internal??!1)).map(({widget:D,node:E})=>D??E)}getPosition(r){for(const y in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[y].contains(r))return y;return null}_add(r,
y,D,E,A){r instanceof l||(r=new l({node:r}));this._place({component:r,position:y,index:D});this._components.push(r);this._componentMap.set(r,{key:E,internal:A})}_find(r){return r?r instanceof l?this._findByComponent(r):"string"===typeof r?this._findById(r):this._findByNode(r.domNode||r):null}_getViewPadding(){return this.view?.padding??p}_attachContainers(r){r.appendChild(this._innerContainer);r.appendChild(this._manualContainer)}_initContainers(){var r=document.createElement("div");r.classList.add("esri-ui-inner-container",
"esri-ui-corner-container");const y=document.createElement("div");y.classList.add("esri-ui-inner-container","esri-ui-manual-container");const D=document.createElement("div");D.classList.add("esri-ui-top-left","esri-ui-corner");r.appendChild(D);const E=document.createElement("div");E.classList.add("esri-ui-top-right","esri-ui-corner");r.appendChild(E);const A=document.createElement("div");A.classList.add("esri-ui-bottom-left","esri-ui-corner");r.appendChild(A);const B=document.createElement("div");
B.classList.add("esri-ui-bottom-right","esri-ui-corner");r.appendChild(B);this._innerContainer=r;this._manualContainer=y;r=u.isRTL();this._cornerNameToContainerLookup={"top-left":D,"top-right":E,"bottom-left":A,"bottom-right":B,"top-leading":r?E:D,"top-trailing":r?D:E,"bottom-leading":r?B:A,"bottom-trailing":r?A:B};this._positionNameToContainerLookup={manual:y,...this._cornerNameToContainerLookup}}_isValidPosition(r){return!!this._positionNameToContainerLookup[r]}_place(r){var y=r.position??"manual";
const {component:D,index:E}=r;r=this._positionNameToContainerLookup[y];y=null!=E&&-1<E;var A=D.widget;A&&!A._started&&"function"===typeof A.postMixInProperties&&"function"===typeof A.buildRendering&&"function"===typeof A.postCreate&&"function"===typeof A.startup&&D.widget.startup();y?(y=Array.from(r.children),0===E?r.firstChild?c.insertBefore(D.node,r.firstChild):r.appendChild(D.node):E>=y.length?r.appendChild(D.node):c.insertBefore(D.node,y[E])):r.appendChild(D.node)}_toPixelPosition(r){return{top:w(r.top),
left:w(r.left),right:w(r.right),bottom:w(r.bottom)}}_findByComponent(r){return this._components.find(y=>y===r)??null}_findById(r){return this._components.find(({id:y})=>y===r)??null}_findByNode(r){return this._components.find(({node:y})=>y===r)??null}_getComponentsAtPosition(r,y){return Array.prototype.slice.call(this._positionNameToContainerLookup[r].children).map(D=>this._findByNode(D)).filter(h.isSome).filter(D=>y.includeInternal||!(this._componentMap.get(D)?.internal??!1)).map(({widget:D,node:E})=>
D??E)}};a.__decorate([d.property()],b.prototype,"_locale",void 0);a.__decorate([d.property()],b.prototype,"container",null);a.__decorate([d.property()],b.prototype,"height",null);a.__decorate([d.property({value:t})],b.prototype,"padding",null);a.__decorate([f.cast("padding")],b.prototype,"castPadding",null);a.__decorate([d.property()],b.prototype,"view",void 0);a.__decorate([d.property()],b.prototype,"width",null);return b=a.__decorate([e.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){var q=n.legacyIcon.description;c=class extends f{constructor(v,p){super(v,p);this._attributionTextOverflowed=this._isOpen=!1;this._prevSourceNodeHeight=0;this._resizeObserver=new ResizeObserver(t=>t.forEach(({target:r})=>this._checkSourceTextOverflow(r)));this.iconClass=q;this.icon=null;this.itemDelimiter=" | ";this.messages=null;this.viewModel=new g}initialize(){this.addHandles(b.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||
this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((v,p)=>{v.includes(p.text)||v.push(p.text);return v},[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(v){this._overrideIfSome("label",v)}get view(){return this.viewModel.view}set view(v){this.viewModel.view=v}render(){return x.tsx("div",{bind:this,class:this.classes("esri-attribution",e.globalCss.widget,{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,
onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return x.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",x.tsx("a",{class:"esri-attribution__link",href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const v=this._isOpen,p=this._isInteractive,t=p?0:void 0,{attributionText:r}=this;return x.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",
{["esri-attribution__sources--open"]:v,[e.globalCss.interactive]:p}),innerHTML:r,tabIndex:t})}_afterSourcesNodeCreate(v){this._prevSourceNodeHeight=v.clientWidth;this._resizeObserver.observe(v)}_checkSourceTextOverflow(v){let p=!1;const {clientHeight:t,clientWidth:r,scrollWidth:y}=v;v=y>r;const D=this._attributionTextOverflowed!==v;this._attributionTextOverflowed=v;D&&(p=!0);this._isOpen&&(v=t<this._prevSourceNodeHeight,this._prevSourceNodeHeight=t,v&&(this._isOpen=!1,p=!0));p&&this.scheduleRender()}_toggleState(){this._isInteractive&&
(this._isOpen=!this._isOpen)}};a.__decorate([h.property()],c.prototype,"_isOpen",void 0);a.__decorate([h.property()],c.prototype,"_isInteractive",null);a.__decorate([h.property()],c.prototype,"_attributionTextOverflowed",void 0);a.__decorate([h.property()],c.prototype,"_prevSourceNodeHeight",void 0);a.__decorate([h.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],c.prototype,"attributionText",null);a.__decorate([h.property()],c.prototype,"iconClass",void 0);a.__decorate([h.property()],
c.prototype,"icon",void 0);a.__decorate([h.property()],c.prototype,"itemDelimiter",void 0);a.__decorate([h.property()],c.prototype,"label",null);a.__decorate([h.property(),u.messageBundle("esri/widgets/Attribution/t9n/Attribution")],c.prototype,"messages",void 0);a.__decorate([h.property()],c.prototype,"view",null);a.__decorate([h.property({type:g})],c.prototype,"viewModel",void 0);a.__decorate([l.accessibleHandler()],c.prototype,"_toggleState",null);return c=a.__decorate([d.subclass("esri.widgets.Attribution")],
c)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../views/3d/layers/Lyr3DWasm".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(r,y){return r&&"copyright"in r&&(!y||"function"===typeof r.originOf&&"user"===r.originOf("copyright"))}function v(r,y){return r.length!==y.length||r.some((D,E)=>D.text!==y[E].text)}function p(r,y,D){D&&y&&(r.find(E=>E.layerView===y&&E.text===D)||r.push({text:D,layerView:y}))}const t=[];b=class extends b{constructor(r){super(r);this._clear=()=>{this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.removeHandles("suspension");
this.notifyChange("state")};this._pendingAttributions=new Set;this._fetchedAttributionData=new Map;this.items=new c;this.view=null;this._allLayerViewsChange=y=>{this.removeHandles("suspension");const D=this.view?.allLayerViews;D&&this.addHandles(D.map(E=>k.watch(()=>[E.suspended,E.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension");y?.removed&&y.removed.forEach(E=>{this._pendingAttributions.delete(E);this._fetchedAttributionData.delete(E)});this._updateAttributionItems()};
this.addHandles([k.on(()=>this.view?.allLayerViews,"change",y=>this._allLayerViewsChange(y),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),k.when(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()}get state(){return this.view?.ready?0<this._pendingAttributions.size?"loading":"ready":"disabled"}_updateAttributionItems(){const r=this.view;
var y=r?.allLayerViews;t.length=0;if(r&&y){y.forEach(E=>{if(!E.suspended&&E.layer?.attributionVisible){var A=E.layer;if(q(A,"user"))p(t,E,A.copyright);else if(A.hasAttributionData)if(this._fetchedAttributionData.has(E)){var B=this._fetchedAttributionData.get(E);B?p(t,E,this._getDynamicAttribution(B,r,A)):q(A)&&p(t,E,A.copyright)}else this._fetchAttributionData(E);else(B="portalItem"in A?A.portalItem?.accessInformation:void 0)?p(t,E,B):p(t,E,A.copyright)}});y=y.find(E=>"integrated-mesh-3dtiles"===
E.layer?.type);if(this.view&&y){var D=w.getLyr3DWasm(this.view);if(D){D=D.getAttributionText();for(let E=0;E<D.length;++E)p(t,y,D[E])}}v(this.items,t)&&(this.items.removeAll(),this.items.addMany(t));t.length=0;this.notifyChange("state")}else this._clear()}async _fetchAttributionData(r){if(!this._pendingAttributions.has(r)){this._pendingAttributions.add(r);var y=await h.result(r.layer.fetchAttributionData());this._pendingAttributions.has(r)&&(y=y.ok?this._createContributionIndex(y.value,"bing-maps"===
r.layer.type):null,this._pendingAttributions.delete(r),this._fetchedAttributionData.set(r,y));this._updateAttributionItems()}}_createContributionIndex(r,y){r=r.contributors;const D={};if(!r)return D;for(let F=0;F<r.length;F++){const G=r[F];var E=G.coverageAreas;if(!E)return;for(const H of E){var A=H.bbox,B=H.zoomMin-(y&&H.zoomMin?1:0);E=H.zoomMax-(y&&H.zoomMax?1:0);A=new n({xmin:A[1],ymin:A[0],xmax:A[3],ymax:A[2],spatialReference:l.WGS84});for(A={extent:x.geographicToWebMercator(A),attribution:G.attribution||
"",score:null!=H.score?H.score:100,id:F};B<=E;B++){let L,C;(L=D)[C=B]??(L[C]=[]);D[B].push(A)}}}D.maxKey=Math.max.apply(null,Object.keys(D));return D}_getDynamicAttribution(r,y,D){const {extent:E,scale:A}=y;D=D.tileInfo?.scaleToZoom(A)??0;D=Math.min(r.maxKey??0,Math.round(D));if(!E||null==D||-1>=D)return"";r=r[D];const B=x.project(E.center.clone().normalize(),y.spatialReference),F=new Set;return r?r.filter(G=>{const H=G.id;(G=!F.has(H)&&B&&G.extent&&u.extentContainsPoint(G.extent,B))&&F.add(H);return G}).sort((G,
H)=>H.score-G.score||G.objectId-H.objectId).map(G=>G.attribution).join(", "):""}};a.__decorate([m.property({readOnly:!0,type:c})],b.prototype,"items",void 0);a.__decorate([m.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([m.property()],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.widgets.Attribution.AttributionViewModel")],b)})},"esri/views/3d/layers/Lyr3DWasm":function(){define(["require","exports"],function(a,b){let h,c=null;const k=new Map;b.addLayerViewToWasm=
async function(m){null==c&&(null==h&&(h=new Promise((g,e)=>a(["../../../layers/Lyr3DWasmPerSceneView"],n=>g(Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}))),e))),c=await h);const d=m.view;let f=k.get(d);f||(f=new c.default({view:d}),k.set(d,f));await f.initializeWasm();return f.add3DTilesLayerView(m)};b.getLyr3DWasm=function(m){return k.get(m)};b.removeLayerViewFromWasm=function(m){const d=m.view,f=k.get(d);f&&1>f.remove3DTilesLayerView(m)&&(k.delete(d),
0===k.size&&(c=h=null))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(a){a.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",
disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",
menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){c=class extends f{constructor(q,
v){super(q,v);this.iconClass=e.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new g;this._reset=()=>{this.viewModel.reset()};this._toRotationTransform=p=>({transform:`rotateZ(${p.z}deg)`})}loadDependencies(){return n.loadCalciteComponents({button:()=>new Promise((q,v)=>a(["../chunks/calcite-button"],q,v)),icon:()=>new Promise((q,v)=>a(["../chunks/calcite-icon"],q,v))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(q){this.viewModel.goToOverride=q}get label(){return this.messages?.widgetLabel??
""}set label(q){this._overrideIfSome("label",q)}get view(){return this.viewModel.view}set view(q){this.viewModel.view=q}reset(){return this.viewModel.reset()}render(){const {orientation:q,state:v}=this.viewModel,p=this.icon??("rotation"===v?"arrow-up":"compass-needle"),{messages:t}=this;return w.tsx("div",{class:this.classes(e.css.base,l.globalCss.widget)},w.tsx("calcite-button",{class:l.globalCss.widgetButton,disabled:"disabled"===v,kind:"neutral",label:t.reset,onclick:this._reset,round:!0,scale:"s",
title:t.reset},w.tsx("div",{"aria-hidden":"true",class:e.css.iconContainer,title:t.reset},w.tsx("calcite-icon",{icon:p,scale:"m",styles:this._toRotationTransform(q)}))))}};b.__decorate([h.property()],c.prototype,"goToOverride",null);b.__decorate([h.property()],c.prototype,"iconClass",void 0);b.__decorate([h.property()],c.prototype,"icon",void 0);b.__decorate([h.property()],c.prototype,"label",null);b.__decorate([h.property(),x.messageBundle("esri/widgets/Compass/t9n/Compass")],c.prototype,"messages",
void 0);b.__decorate([h.property()],c.prototype,"view",null);b.__decorate([h.property({type:g})],c.prototype,"viewModel",void 0);return c=b.__decorate([d.subclass("esri.widgets.Compass")],c)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./utils ../support/GoTo".split(" "),
function(a,b,h,c,k,m,d,f,g,e){b=class extends e.GoToMixin(b){constructor(n){super(n);this.orientation={x:0,y:0,z:0};this.view=null;this._updateForCamera=this._updateForCamera.bind(this);this._updateForRotation=this._updateForRotation.bind(this);this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(h.watch(()=>this.view,this._updateRotationWatcher,h.initial))}destroy(){this.view=null}get canShowNorth(){return g.canShowNorth(this.view)}get state(){return!this.view?.ready||
"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(this.view?.ready){var n={};"2d"===this.view?.type?n.rotation=0:n.heading=0;this.callGoTo({target:n})}}_updateForRotation(n){void 0!==n&&null!==n&&(this.orientation={z:n})}_updateForCamera(n){n&&(this.orientation={x:0,y:0,z:-n.heading})}_updateRotationWatcher(n){this.removeAllHandles();n&&this.addHandles("2d"===n.type?h.watch(()=>n?.rotation,this._updateForRotation,h.initial):
h.watch(()=>n?.camera,this._updateForCamera,h.initial))}};a.__decorate([c.property({readOnly:!0})],b.prototype,"canShowNorth",null);a.__decorate([c.property()],b.prototype,"orientation",void 0);a.__decorate([c.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([c.property()],b.prototype,"view",void 0);return b=a.__decorate([f.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/Compass/utils":function(){define(["exports"],function(a){a.canShowNorth=function(b){return b?.spatialReference?.isWebMercator||
b?.spatialReference?.isGeographic||!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d,f){a.GoToMixin=g=>{g=class extends g{constructor(...e){super(...e);this.view=this.goToOverride=null}callGoTo(e){const {view:n}=
this;h.assertIsSome(n);return this.goToOverride?this.goToOverride(n,e):n.goTo(e.target,e.options)}};b.__decorate([c.property()],g.prototype,"goToOverride",void 0);b.__decorate([c.property()],g.prototype,"view",void 0);return g=b.__decorate([f.subclass("esri.widgets.support.GoTo")],g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports","../support/legacyIcon"],function(a,b){a.css={base:"esri-compass",widgetIcon:b.legacyIcon.locateCircled,
iconContainer:"esri-compass__icon-container"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){c=class extends f{constructor(q,v){super(q,v);this.iconClass=g.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new e;this.toggle=()=>this.viewModel.toggle();this._rotateButton=this._panButton=null;this._toggle=()=>{("pan"===this.viewModel?.navigationMode?this._rotateButton:this._panButton)?.setFocus();this.toggle()}}loadDependencies(){return n.loadCalciteComponents({button:()=>new Promise((q,v)=>a(["../chunks/calcite-button"],q,v))})}get label(){return this.messages?.widgetLabel??
""}set label(q){this._overrideIfSome("label",q)}set layout(q){"horizontal"!==q&&(q="vertical");this._set("layout",q)}get view(){return this.viewModel.view}set view(q){this.viewModel.view=q}render(){const q="disabled"===this.viewModel?.state,v="pan"===this.viewModel?.navigationMode,p=this.messages.toggle;return w.tsx("div",{class:this.classes(g.css.base,l.globalCss.widget,{[g.css.isLayoutHorizontal]:"horizontal"===this.layout})},w.tsx("calcite-button",{afterCreate:t=>{this._panButton=t},appearance:v?
"outline-fill":"solid",class:l.globalCss.widgetButton,disabled:q,iconStart:"move",kind:"neutral",label:p,onclick:this._toggle,tabIndex:v?void 0:-1,title:p}),w.tsx("calcite-button",{afterCreate:t=>{this._rotateButton=t},appearance:v?"solid":"outline-fill",class:l.globalCss.widgetButton,disabled:q,iconStart:"rotate",kind:"neutral",label:p,onclick:this._toggle,tabIndex:v?-1:void 0,title:p}))}};b.__decorate([h.property()],c.prototype,"iconClass",void 0);b.__decorate([h.property()],c.prototype,"icon",
void 0);b.__decorate([h.property()],c.prototype,"label",null);b.__decorate([h.property({value:"vertical"})],c.prototype,"layout",null);b.__decorate([h.property(),x.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],c.prototype,"messages",void 0);b.__decorate([h.property()],c.prototype,"view",null);b.__decorate([h.property({type:e})],c.prototype,"viewModel",void 0);return c=b.__decorate([d.subclass("esri.widgets.NavigationToggle")],c)})},"esri/widgets/NavigationToggle/css":function(){define(["exports",
"../support/legacyIcon"],function(a,b){a.css={base:"esri-navigation-toggle",widgetIcon:b.legacyIcon.pan2,isLayoutHorizontal:"esri-navigation-toggle--horizontal"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){b=class extends b{constructor(g){super(g);this.navigationMode="pan";this.view=null}initialize(){this.addHandles(h.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const g=this.view?.inputManager;g&&(g.primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate")}};a.__decorate([c.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([c.property()],b.prototype,"navigationMode",void 0);a.__decorate([c.property()],b.prototype,"view",void 0);return b=a.__decorate([f.subclass("esri.widgets.NavigationToggleViewModel")],b)})},"esri/widgets/Zoom":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ../chunks/componentsUtils ./support/globalCss ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/ZoomViewModel".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){var q=n.legacyIcon.zoomInMagnifyingGlass;c=class extends f{constructor(v,p){super(v,p);this.iconClass=q;this.messages=this.icon=null;this.viewModel=new w;this.zoomIn=()=>this.viewModel.zoomIn();this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return g.loadCalciteComponents({button:()=>new Promise((v,p)=>a(["../chunks/calcite-button"],v,p))})}get label(){return this.messages?.widgetLabel??""}set label(v){this._overrideIfSome("label",v)}set layout(v){"horizontal"!==
v&&(v="vertical");this._set("layout",v)}set view(v){this.viewModel.view=v}get view(){return this.viewModel.view}render(){const v={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:p,canZoomOut:t}=this.viewModel,{zoomIn:r,zoomOut:y}=this.messages;return x.tsx("div",{class:this.classes("esri-zoom",e.globalCss.widget,v)},x.tsx("calcite-button",{class:e.globalCss.widgetButton,disabled:!p,iconStart:"plus",kind:"neutral",label:r,onclick:this.zoomIn,title:r}),x.tsx("calcite-button",{class:e.globalCss.widgetButton,
disabled:!t,iconStart:"minus",kind:"neutral",label:y,onclick:this.zoomOut,title:y}))}};b.__decorate([h.property()],c.prototype,"iconClass",void 0);b.__decorate([h.property()],c.prototype,"icon",void 0);b.__decorate([h.property()],c.prototype,"label",null);b.__decorate([h.property({value:"vertical"})],c.prototype,"layout",null);b.__decorate([h.property(),u.messageBundle("esri/widgets/Zoom/t9n/Zoom")],c.prototype,"messages",void 0);b.__decorate([h.property()],c.prototype,"view",null);b.__decorate([h.property({type:w})],
c.prototype,"viewModel",void 0);return c=b.__decorate([d.subclass("esri.widgets.Zoom")],c)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,h,c,k,m,d,f,g,e){b=class extends b{constructor(n){super(n)}destroy(){this.view=
null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(n){n?"2d"===n.type?this._zoomConditions=new g({view:n}):"3d"===n.type&&(this._zoomConditions=new e({view:n})):this._zoomConditions=null;this._set("view",n)}zoomIn(){if(this.canZoomIn){var n=this.view;"2d"===n.type?n.mapViewNavigation.zoomIn():h.ignoreAbortErrors(n.goTo({zoomFactor:2}))}}zoomOut(){if(this.canZoomOut){var n=
this.view;"2d"===n.type?n.mapViewNavigation.zoomOut():h.ignoreAbortErrors(n.goTo({zoomFactor:.5}))}}};a.__decorate([c.property()],b.prototype,"_zoomConditions",void 0);a.__decorate([c.property()],b.prototype,"canZoomIn",null);a.__decorate([c.property()],b.prototype,"canZoomOut",null);a.__decorate([c.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([c.property()],b.prototype,"view",null);return b=a.__decorate([f.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){b=class extends b{get canZoomIn(){if(!this.view?.ready)return!1;const f=this.view?.constraints?.effectiveMaxScale;return 0===f||this._scale>f}get canZoomOut(){var {view:f}=this;if(!f?.ready)return!1;f=f.constraints?.effectiveMinScale;return 0===f||this._scale<f}get _scale(){const f=this.view?.animation?.target;return(f&&"then"in f?void 0:f?.scale)??this.view?.scale??0}};a.__decorate([h.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([h.property({readOnly:!0})],
b.prototype,"canZoomOut",null);a.__decorate([h.property()],b.prototype,"view",void 0);a.__decorate([h.property()],b.prototype,"_scale",null);return b=a.__decorate([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d){b=
class extends b{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};a.__decorate([h.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"canZoomOut",null);a.__decorate([h.property()],b.prototype,"view",void 0);return b=a.__decorate([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],b)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,h,c,k,m,d){h=class extends d{constructor(f){super(f);this.components=["attribution","zoom","navigation-toggle","compass"]}};a.__decorate([b.property()],h.prototype,"components",void 0);return h=a.__decorate([m.subclass("esri.views.ui.3d.DefaultUI3D")],h)})},"esri/layers/SceneLayer":function(){define("require ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Clonable ../core/Collection ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ../geometry/Mesh ../geometry/Point ./Layer ./graphics/sources/support/uploadAssetErrors ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/CustomParametersMixin ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./mixins/TemporalSceneLayer ./support/arcgisLayerUrl ./support/associatedFeatureServiceUtils ./support/capabilities ./support/commonProperties ./support/featureLayerUtils ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/infoFor3D ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/lazyLayerLoader ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/elevationInfoUtils ../support/featureFlags ../support/popupUtils ../support/zipUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja,oa,ra,ta,ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga){const La=new Set(["3DObject","Point"]);k=aa.defineFieldProperties();q=class extends U.TemporalSceneLayer(V.EditBusLayer(O.SceneService(S.ArcGISService(Q.OperationalLayer(T.PortalLayer(ia.ScaleRangeLayer(r.MultiOriginJSONMixin(N.CustomParametersMixin(M.APIKeyMixin(q.ClonableMixin(K))))))))))){constructor(...Ia){super(...Ia);this.rangeInfos=
this.featureReduction=null;this.operationalLayerType="ArcGISSceneServiceLayer";this.type="scene";this.serviceUpdateTimeStamp=this.geometryDefinitions=this.textureSetDefinitions=this.materialDefinitions=this.nodePages=this.outFields=this.floorInfo=this.fields=null;this.excludeObjectIds=new v;this.path=this.filter=this.definitionExpression=null;this.labelsVisible=!0;this.labelingInfo=null;this.legendEnabled=!0;this.semantic=this.priority=null;this.cachedDrawingInfo={color:!1};this.popupEnabled=!0;this.globalIdField=
this.objectIdField=this.popupTemplate=null;this._fieldUsageInfo={};this.screenSizePerspectiveEnabled=!0;this.serviceItemId=void 0}normalizeCtorArgs(Ia,Oa){return"string"===typeof Ia?{url:Ia,...Oa}:Ia}destroy(){this._set("renderer",null)}getField(Ia){return this.fieldsIndex.get(Ia)}getFieldDomain(Ia,Oa){return(Oa=this.getFeatureType(Oa?.feature)?.domains?.[Ia])&&"inherited"!==Oa.type?Oa:this.getField(Ia)?.domain??null}getFeatureType(Ia){return Ia&&this.associatedLayer?this.associatedLayer.getFeatureType(Ia):
null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new Z(this.fields)}readNodePages(Ia,Oa,Ua){"Point"===Oa.layerType&&(Ia=Oa.pointNodePages);return null==Ia||"object"!==typeof Ia?null:ca.I3SNodePageDefinition.fromJSON(Ia,Ua)}set elevationInfo(Ia){this._set("elevationInfo",Ia);this.loaded&&
this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&da.computeEffectiveEditingEnabled(this.associatedLayer)}get geometryType(){return Wa[this.profile]||"mesh"}set renderer(Ia){ea.fixRendererFields(Ia,this.fieldsIndex);this._set("renderer",Ia)}readCachedDrawingInfo(Ia){if(null==Ia||"object"!==typeof Ia)Ia={};null==Ia.color&&(Ia.color=
!1);return Ia}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(Ia){Ia=null!=Ia?Ia:ba.zeroCapabilities;const {query:Oa,queryRelated:Ua,editing:{supportsGlobalId:Va,supportsRollbackOnFailure:Ra,supportsUploadWithItemId:bb,supportsGeometryUpdate:gb,supportsReturnServiceEditsInSourceSpatialReference:db},data:{supportsZ:ka,supportsM:mb,isVersioned:sb,supportsAttachment:tb},operations:{supportsEditing:xa,supportsAdd:Ha,
supportsUpdate:na,supportsDelete:za,supportsQuery:Da,supportsQueryAttachments:Ma,supportsAsyncConvert3D:Xa}}=Ia;Ia=Ia.operations.supportsChangeTracking;const ab=!!this.associatedLayer?.infoFor3D&&Ba.sceneLayerEditingEnabled();return{query:Oa,queryRelated:Ua,editing:{supportsGlobalId:Va,supportsReturnServiceEditsInSourceSpatialReference:db,supportsRollbackOnFailure:Ra,supportsGeometryUpdate:ab&&gb,supportsUploadWithItemId:bb},data:{supportsAttachment:tb,supportsZ:ka,supportsM:mb,isVersioned:sb},operations:{supportsQuery:Da,
supportsQueryAttachments:Ma,supportsEditing:xa&&Ia,supportsAdd:ab&&Ha&&Ia,supportsDelete:ab&&za&&Ia,supportsUpdate:na&&Ia,supportsAsyncConvert3D:Xa}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(Ia){this._overrideIfSome("editingEnabled",Ia)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||
this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(Ia,Oa){!Ia&&Oa.fields&&Oa.fields.some(Ua=>{"esriFieldTypeOID"===Ua.type&&(Ia=Ua.name);return!!Ia});return Ia||void 0}readGlobalIdField(Ia,Oa){!Ia&&Oa.fields&&Oa.fields.some(Ua=>{"esriFieldTypeGlobalID"===Ua.type&&(Ia=Ua.name);return!!Ia});return Ia||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(Ia,Oa){Ia=Oa.store.profile;if(null!=Ia&&Na[Ia])return Na[Ia];t.getLogger(this).error("Unknown or missing profile",
{profile:Ia,layer:this});return"mesh-pyramids"}load(Ia){this.addResolvingPromise(this._load(Ia));return Promise.resolve(this)}async _load(Ia){const Oa=null!=Ia?Ia.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},Ia).catch(y.throwIfAbortError);await this._fetchService(Oa);await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Oa),this._setAssociatedFeatureLayer(Oa),this._loadFilterGeometries()]);this._validateElevationInfo();this._applyAssociatedLayerOverrides();
this._populateFieldUsageInfo();await Ca.loadStyleRenderer(this,{origin:"service"},Oa);ea.fixRendererFields(this.renderer,this.fieldsIndex);await this.finishLoadEditablePortalLayer(Ia)}async beforeSave(){null!=this.filter&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(Ia){t.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",
{error:Ia}),this.filter=null}}createQuery(){const Ia=new pa;"mesh"!==this.geometryType&&(Ia.returnGeometry=!0,Ia.returnZ=!0);Ia.where=this.definitionExpression||"1\x3d1";Ia.sqlFormat="standard";Ia.outFields=["*"];return Ia}queryExtent(Ia,Oa){return this._getAssociatedLayerForQuery().then(Ua=>Ua.queryExtent(Ia||this.createQuery(),Oa))}queryFeatureCount(Ia,Oa){return this._getAssociatedLayerForQuery().then(Ua=>Ua.queryFeatureCount(Ia||this.createQuery(),Oa))}queryFeatures(Ia,Oa){return this._getAssociatedLayerForQuery().then(Ua=>
Ua.queryFeatures(Ia||this.createQuery(),Oa)).then(Ua=>{if(Ua?.features)for(const Va of Ua.features)Va.layer=this,Va.sourceLayer=this;return Ua})}async queryRelatedFeatures(Ia,Oa){await this.load();if(!this.associatedLayer)throw new p("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(Ia,Oa)}async queryRelatedFeaturesCount(Ia,Oa){await this.load();if(!this.associatedLayer)throw new p("scenelayer:query-not-available",
"SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(Ia,Oa)}async queryCachedAttributes(Ia,Oa){const Ua=ea.unpackFieldNames(this.fieldsIndex,await va.getRequiredFields(this,va.getFetchPopupTemplate(this)));return ua.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo??[],Ia,Oa,Ua,this.apiKey,this.customParameters)}async queryCachedFeature(Ia,Oa){Ia=await this.queryCachedAttributes(Ia,
[Oa]);if(!Ia||0===Ia.length)throw new p("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Oa=new h;Oa.attributes=Ia[0];Oa.layer=this;Oa.sourceLayer=this;return Oa}queryObjectIds(Ia,Oa){return this._getAssociatedLayerForQuery().then(Ua=>Ua.queryObjectIds(Ia||this.createQuery(),Oa))}queryAttachments(Ia,Oa){return this._getAssociatedLayerForQuery().then(Ua=>Ua.queryAttachments(Ia,Oa))}getFieldUsageInfo(Ia){const Oa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Ia]||Oa:(t.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Oa)}createPopupTemplate(Ia){return la.createPopupTemplate(this,Ia)}_getAssociatedLayerForQuery(){const Ia=this.associatedLayer;return Ia?.loaded?Promise.resolve(Ia):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){await this.load();if(!this.associatedLayer)throw new p("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",
{layer:this});try{await this.associatedLayer.load()}catch(Ia){throw new p("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:Ia});}return this.associatedLayer}hasCachedStatistics(Ia){return null!=this.statisticsInfo&&this.statisticsInfo.some(Oa=>Oa.name===Ia)}async queryCachedStatistics(Ia,Oa){await this.load(Oa);if(!this.statisticsInfo)throw new p("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ua=
this.fieldsIndex.get(Ia);if(!Ua)throw new p("scenelayer:field-unexisting",`Field '${Ia}' does not exist on the layer`);for(const Va of this.statisticsInfo)if(Va.name===Ua.name)return Ia=E.join(this.parsedUrl.path,Va.href),w(Ia,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:Oa?Oa.signal:null}).then(Ra=>Ra.data);throw new p("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}async saveAs(Ia,Oa){return this._debouncedSaveOperations(O.SaveOperationType.SAVE_AS,
{...Oa,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Ia)}async save(){return this._debouncedSaveOperations(O.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})}async applyEdits(Ia,Oa){const {applyEdits:Ua}=await new Promise((db,ka)=>a(["./graphics/editingSupport"],db,ka));await this.load();const Va=this.associatedLayer;if(!Va)throw new p(`${this.type}-layer:not-editable`,"Service is not editable");await Va.load();const {globalIdField:Ra}=
Va,bb=!!Va.infoFor3D,gb=Oa?.globalIdUsed??!0;if(bb&&null==Ra)throw new p(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(bb&&!gb)throw new p(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");P.isHostedAgolService(Va.url)&&bb&&null!=Ia.deleteFeatures&&null!=Ra&&(Oa={...Oa,globalIdToObjectId:await da.getGlobalIdToObjectIdMap(Va,Ia.deleteFeatures,Ra)});return Ua(this,Va.source,Ia,Oa)}async uploadAssets(Ia,
Oa){await this.load();if(null==this.associatedLayer)throw new p(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return this.associatedLayer.uploadAssets(Ia,Oa)}on(Ia,Oa){return super.on(Ia,Oa)}async convertMesh(Ia,Oa){var Ua=Ra=>{t.getLogger(this).error(".convertMesh()",Ra.message);throw Ra;};await this.load();this.infoFor3D||Ua(new p("invalid:layer","SceneLayer has no capability for mesh conversion"));Ia=await this.extractAndFilterFiles(Ia);const Va=
Ia.reduce((Ra,bb)=>W.isFileEditFormat(this.infoFor3D,bb)?Ra+1:Ra,0);0===Va&&Ua(new I.NoModelError);1<Va&&Ua(new I.MultipleModelsError);Ua=Oa?.location??new J({x:0,y:0,z:0,spatialReference:this.spatialReference});Ua=z.createWithExternalSource(Ua,Ia);[Oa]=await this.uploadAssets([Ua],Oa);return Oa}async extractAndFilterFiles(Ia){await this.load();const Oa=this.infoFor3D;return Oa?(await qa.extractZipFiles(Ia)).filter(Ua=>W.isFileSupported(Oa,Ua)):Ia}validateLayer(Ia){if(Ia.layerType&&!La.has(Ia.layerType))throw new p("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:Ia.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new p("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new p("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});Ia=this.normalReferenceFrame;var Oa=this.spatialReference;
let Ua=!1,Va=!1;if(null==Ia)Va=Ua=!0;else switch(Oa=Oa&&Oa.isGeographic,Ia){case "east-north-up":case "earth-centered":Ua=!0;Va=Oa;break;case "vertex-reference-frame":Ua=!0;Va=!Oa;break;default:Ua=!1}if(!Ua)throw new p("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Va)throw new p("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}_getTypeKeywords(){const Ia=[];if("points"===this.profile)Ia.push("Point");
else if("mesh-pyramids"===this.profile)Ia.push("3DObject");else throw new p("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return Ia}_populateFieldUsageInfo(){this._fieldUsageInfo={};if(this.fields)for(const Ia of this.fields){const Oa=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Va=>Va.name===Ia.name)),Ua=!!this.associatedLayer?.fields?.some(Va=>Va&&Ia.name===Va.name);this._fieldUsageInfo[Ia.name]={supportsLabelingInfo:Oa,
supportsRenderer:Oa,supportsPopupTemplate:Oa||Ua,supportsLayerQuery:Ua}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides();this._applyAssociatedLayerExtentOverride();this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(this.associatedLayer?.fields){var Ia=null;for(const Oa of this.associatedLayer.fields){const Ua=this.getField(Oa.name);Ua?(!Ua.domain&&Oa.domain&&(Ua.domain=Oa.domain.clone()),Ua.editable=
Oa.editable,Ua.nullable=Oa.nullable,Ua.length=Oa.length):(Ia||=this.fields?this.fields.slice():[],Ia.push(Oa.clone()))}Ia&&this._set("fields",Ia)}}_applyAssociatedLayerPopupOverrides(){if(this.associatedLayer){var Ia=["popupTemplate","popupEnabled"],Oa=G.getProperties(this);for(let Ua=0;Ua<Ia.length;Ua++){const Va=Ia[Ua],Ra=this.originIdOf(Va),bb=this.associatedLayer.originIdOf(Va);Ra<bb&&(bb===C.OriginId.SERVICE||bb===C.OriginId.PORTAL_ITEM)&&Oa.setAtOrigin(Va,this.associatedLayer[Va],bb)}}}_applyAssociatedLayerExtentOverride(){const Ia=
this.associatedLayer?.editingInfo?.lastEditDate,Oa=this.associatedLayer?.serverGens,Ua=this.associatedLayer?.getAtOrigin("fullExtent","service");Ba.sceneLayerEditingEnabled()&&null!=this.associatedLayer?.infoFor3D&&Ua&&P.isHostedAgolService(this.associatedLayer?.url)&&Ia&&this.serviceUpdateTimeStamp?.lastUpdate!==Ia.getTime()&&(this.serviceUpdateTimeStamp||Oa?.minServerGen!==Oa?.serverGen)&&G.getProperties(this).setAtOrigin("fullExtent",Ua.clone(),C.OriginId.SERVICE)}_applyAssociatedLayerPrivileges(){const Ia=
this.associatedLayer;Ia&&(this._set("userHasEditingPrivileges",Ia.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",Ia.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",Ia.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(Ia){if(["mesh-pyramids","points"].includes(this.profile))try{const {serverUrl:Oa,layerId:Ua,portalItem:Va}=await R.findAssociatedFeatureService(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,
apiKey:this.apiKey,signal:Ia});this.associatedLayer=new (await ra.layerLookupMap.FeatureLayer())({url:Oa,customParameters:this.customParameters,layerId:Ua,portalItem:Va});await this.associatedLayer.load()}catch(Oa){y.isAbortError(Oa)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await D.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const Ia=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?t.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Ia}`):
t.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Ia}`)}_validateElevationInfo(){const Ia=this.elevationInfo;"mesh-pyramids"===this.profile&&wa.logInvalidElevationInfoWarning(t.getLogger(this),wa.elevationModeUnsupportedMessage("Mesh scene layers","relative-to-scene",Ia));wa.logInvalidElevationInfoWarning(t.getLogger(this),wa.featureExpressionUnsupportedMessage("Scene layers",Ia))}};b.__decorate([A.property({types:{key:"type",base:ha.FeatureReduction,
typeMap:{selection:fa}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],q.prototype,"featureReduction",void 0);b.__decorate([A.property({type:[ta.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],q.prototype,"rangeInfos",void 0);b.__decorate([A.property({json:{read:!1}})],q.prototype,"associatedLayer",
void 0);b.__decorate([A.property({type:["show","hide"]})],q.prototype,"listMode",void 0);b.__decorate([A.property({type:["ArcGISSceneServiceLayer"]})],q.prototype,"operationalLayerType",void 0);b.__decorate([A.property({json:{read:!1},readOnly:!0})],q.prototype,"type",void 0);b.__decorate([A.property({...k.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],q.prototype,"fields",void 0);b.__decorate([A.property()],q.prototype,"types",null);b.__decorate([A.property()],q.prototype,"typeIdField",
null);b.__decorate([A.property()],q.prototype,"templates",null);b.__decorate([A.property()],q.prototype,"formTemplate",null);b.__decorate([A.property({readOnly:!0,clonable:!1})],q.prototype,"fieldsIndex",null);b.__decorate([A.property({type:oa,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],q.prototype,"floorInfo",void 0);b.__decorate([A.property(k.outFields)],q.prototype,"outFields",void 0);b.__decorate([A.property({type:ca.I3SNodePageDefinition,readOnly:!0,
json:{read:!1}})],q.prototype,"nodePages",void 0);b.__decorate([H.reader("service","nodePages",["nodePages","pointNodePages"])],q.prototype,"readNodePages",null);b.__decorate([A.property({type:[ca.I3SMaterialDefinition],readOnly:!0})],q.prototype,"materialDefinitions",void 0);b.__decorate([A.property({type:[ca.I3STextureSetDefinition],readOnly:!0})],q.prototype,"textureSetDefinitions",void 0);b.__decorate([A.property({type:[ca.I3SGeometryDefinition],readOnly:!0})],q.prototype,"geometryDefinitions",
void 0);b.__decorate([A.property({readOnly:!0})],q.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([A.property({readOnly:!0})],q.prototype,"attributeStorageInfo",void 0);b.__decorate([A.property({readOnly:!0})],q.prototype,"statisticsInfo",void 0);b.__decorate([A.property({type:v.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],q.prototype,"excludeObjectIds",void 0);b.__decorate([A.property({type:String,
json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],q.prototype,"definitionExpression",void 0);b.__decorate([A.property({type:ya,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],q.prototype,"filter",void 0);b.__decorate([A.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],q.prototype,"path",void 0);b.__decorate([A.property(X.elevationInfo)],
q.prototype,"elevationInfo",null);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],q.prototype,"effectiveCapabilities",null);b.__decorate([A.property({readOnly:!0})],q.prototype,"effectiveEditingEnabled",null);b.__decorate([A.property({type:String})],q.prototype,"geometryType",null);b.__decorate([A.property(X.labelsVisible)],q.prototype,"labelsVisible",void 0);b.__decorate([A.property({type:[Y],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ja.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",
read:{reader:ja.reader},write:!0}})],q.prototype,"labelingInfo",void 0);b.__decorate([A.property(X.legendEnabled)],q.prototype,"legendEnabled",void 0);b.__decorate([A.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(Ia,Oa){if("number"===typeof Ia&&0<=Ia&&1>=Ia)return Ia;Ia=Oa.layerDefinition?.drawingInfo?.transparency;
return void 0!==Ia?Ga.transparencyToOpacity(Ia):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],q.prototype,"opacity",void 0);b.__decorate([A.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],q.prototype,"priority",void 0);b.__decorate([A.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],q.prototype,"semantic",void 0);b.__decorate([A.property({types:x.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},
name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],q.prototype,"renderer",null);b.__decorate([A.property({json:{read:!1}})],q.prototype,"cachedDrawingInfo",void 0);b.__decorate([H.reader("service","cachedDrawingInfo")],q.prototype,"readCachedDrawingInfo",null);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],q.prototype,"capabilities",null);b.__decorate([A.property({type:Boolean,json:{read:!1}})],q.prototype,"editingEnabled",null);b.__decorate([A.property({readOnly:!0,json:{write:!1,
read:!1}})],q.prototype,"infoFor3D",null);b.__decorate([A.property({readOnly:!0,json:{write:!1,read:!1}})],q.prototype,"relationships",null);b.__decorate([A.property(X.popupEnabled)],q.prototype,"popupEnabled",void 0);b.__decorate([A.property({type:c,json:{name:"popupInfo",write:!0}})],q.prototype,"popupTemplate",void 0);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],q.prototype,"defaultPopupTemplate",null);b.__decorate([A.property({type:String,json:{read:!1}})],q.prototype,"objectIdField",
void 0);b.__decorate([H.reader("service","objectIdField",["objectIdField","fields"])],q.prototype,"readObjectIdField",null);b.__decorate([A.property({type:String,json:{read:!1}})],q.prototype,"globalIdField",void 0);b.__decorate([H.reader("service","globalIdField",["globalIdField","fields"])],q.prototype,"readGlobalIdField",null);b.__decorate([A.property({readOnly:!0,type:String,json:{read:!1}})],q.prototype,"displayField",null);b.__decorate([A.property({type:String,json:{read:!1}})],q.prototype,
"profile",void 0);b.__decorate([H.reader("service","profile",["store.profile"])],q.prototype,"readProfile",null);b.__decorate([A.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],q.prototype,"normalReferenceFrame",void 0);b.__decorate([A.property(X.screenSizePerspectiveEnabled)],q.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([A.property({json:{read:!1,origins:{service:{read:!0}}}})],q.prototype,"serviceItemId",void 0);
q=b.__decorate([L.subclass("esri.layers.SceneLayer")],q);const Na={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Wa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return q})},"esri/geometry/Mesh":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/libs/gl-matrix-2/factories/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/meshErrors ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/meshVertexSpaceUtils ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/georeference ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M){var S;e={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:y,local:D}};c=S=class extends c.LoadableMixin(m.EsriPromiseMixin(w)){constructor(Q){super(Q);this.components=null;this.vertexSpace=new y;this.transform=null;this.metadata=new z.Metadata;this.hasZ=!0;this.hasM=!1;this.vertexAttributes=new A.MeshVertexAttributes;this.type="mesh"}initialize(){if(0===this.metadata.externalSources.length||
this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.addHandles(f.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(Q=>Q.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}get _transformedExtent(){const {components:Q,spatialReference:T,vertexAttributes:ia,vertexSpace:O}=
this;var U=ia.position;if(0===U.length||Q&&0===Q.length)return new x({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:T});if("local"===O.type){const {_untransformedExtent:P,transform:R}=this;return G.getProjectedExtent(P,R,O,T)}if("georeferenced"===O.type&&B.isRelativeVertexSpace(O)){const {transform:P}=this;U=L.project({positions:U,transform:P,vertexSpace:O,inSpatialReference:T,outSpatialReference:T});return G.getExtentFromPositions(U,T)}return G.getExtentFromPositions(U,T)}get _untransformedExtent(){return G.getExtentFromPositions(this.vertexAttributes.position,
this.spatialReference)}get anchor(){const Q=B.vertexSpaceOriginToPoint(this.vertexSpace,this.spatialReference);if(null!=Q)return Q;const {center:T,zmin:ia}=this._transformedExtent;return new q({x:T.x,y:T.y,z:ia,spatialReference:this.spatialReference})}get origin(){const Q=B.vertexSpaceOriginToPoint(this.vertexSpace,this.spatialReference);return null!=Q?Q:this._transformedExtent.center}get extent(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(Q){if(!this.loaded)return k.getLogger(this).error("addComponent()",
(new r.MeshNotLoadedError).message);this.components||(this.components=[]);this.components.push(t.from(Q));this.notifyChange("components")}removeComponent(Q){if(!this.loaded)return k.getLogger(this).error("removeComponent()",(new r.MeshNotLoadedError).message);if(this.components&&(Q=this.components.indexOf(Q),-1!==Q)){this.components.splice(Q,1);this.notifyChange("components");return}k.getLogger(this).error("removeComponent()",(new r.ComponentNotFoundError).message)}rotate(Q,T,ia,O){p.composeAxes(Q,
T,ia,V);I.rotate(this,V,O);return this}offset(Q,T,ia,O){if(!this.loaded)return k.getLogger(this).error("offset()",(new r.MeshNotLoadedError).message),this;N[0]=Q;N[1]=T;N[2]=ia;J.offset(this,N,O);return this}scale(Q,T){if(!this.loaded)return k.getLogger(this).error("scale()",(new r.MeshNotLoadedError).message),this;M.scale(this,Q,T);return this}centerAt(Q,T){if(!this.loaded)return k.getLogger(this).error("centerAt()",(new r.MeshNotLoadedError).message),this;H.centerAt(this,Q,T);return this}load(Q){const {metadata:{displaySource:T}}=
this;T&&this.addResolvingPromise(C.loadExternal(this,T,Q));return Promise.resolve(this)}addExternalSources(Q){this.metadata.externalSources.addMany(Q)}updateDisplaySource(Q){this.metadata.displaySource=Q}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(Q){let T=null;if(this.components){const ia=new Map,O=new Map;T=this.components.map(U=>U.cloneWithDeduplication(ia,O))}Q={components:T,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),
vertexSpace:Q,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new S(Q)}cloneShallow(){return new S({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(Q){var T=new Promise((O,U)=>a(["./support/meshUtils/exporters/gltf/gltfexport"],O,U));const ia=
this.load();T=await Promise.all([T,ia]);({toBinaryGLTF:T}=T[0]);return T(this,Q)}get memoryUsage(){let Q;Q=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const T of this.components)Q+=T.memoryUsage;return Q}_clearSources(){this.metadata.clearSources()}static createBox(Q,T){if(!(Q instanceof q))return k.getLogger("esri.geometry.Mesh").error(".createBox()",(new r.InvalidLocationError).message),null;Q=new S(K.convertUnitGeometry(K.createUnitSizeBox(),Q,T));return T?.imageFace&&"all"!==
T.imageFace?K.extractSingleFaceOfBox(Q,T.imageFace):Q}static createSphere(Q,T){return Q instanceof q?new S(K.convertUnitGeometry(K.createUnitSizeSphere(T?.densificationFactor||0),Q,T)):(k.getLogger("esri.geometry.Mesh").error(".createSphere()",(new r.InvalidLocationError).message),null)}static createCylinder(Q,T){return Q instanceof q?new S(K.convertUnitGeometry(K.createUnitSizeCylinder(T?.densificationFactor||0),Q,T)):(k.getLogger("esri.geometry.Mesh").error(".createCylinder()",(new r.InvalidLocationError).message),
null)}static createPlane(Q,T){if(!(Q instanceof q))return k.getLogger("esri.geometry.Mesh").error(".createPlane()",(new r.InvalidLocationError).message),null;const ia=T?.facing??"up",O=K.convertPlaneSizeParameter(ia,T?.size);return new S(K.convertUnitGeometry(K.createUnitSizePlane(ia),Q,{...T,size:O}))}static createFromPolygon(Q,T){if(!(Q instanceof v))return k.getLogger("esri.geometry.Mesh").error(".createFromPolygon()",(new r.InvalidPolygonError).message),null;const ia=F.triangulate(Q);return new S({vertexAttributes:new A.MeshVertexAttributes({position:ia.position}),
components:[new t({faces:ia.faces,shading:"flat",material:T?.material??null})],spatialReference:Q.spatialReference,vertexSpace:new y})}static async createFromGLTF(Q,T,ia){if(!(Q instanceof q))throw Q=new r.InvalidLocationError,k.getLogger("esri.geometry.Mesh").error(".createfromGLTF()",Q.message),Q;const {loadGLTFMesh:O}=await d.whenOrAbort(new Promise((U,P)=>a(["./support/meshUtils/loadGLTFMesh"],U,P)),ia);return new S(await O(Q,T,ia))}static async createFromFiles(Q,T,ia){if(!ia?.layer)throw new h("invalid:no-layer",
"SceneLayer required for file to mesh conversion.");return ia.layer.convertMesh(T,{location:Q,...ia})}static createWithExternalSource(Q,T,ia){var O=ia?.extent??null;const {x:U,y:P,z:R,spatialReference:ba}=Q;Q=ia?.transform?.clone()??new E;ia=ia?.vertexSpace??new D({origin:[U,P,R??0]});T={source:T,extent:O};O=new z.Metadata;O.externalSources.push(T);return new S({metadata:O,transform:Q,vertexSpace:ia,spatialReference:ba})}static createIncomplete(Q,T){const {x:ia,y:O,z:U,spatialReference:P}=Q;Q=T?.transform?.clone()??
new E;T=T?.vertexSpace??new D({origin:[ia,O,U??0]});T=new S({transform:Q,vertexSpace:T,spatialReference:P});T.addResolvingPromise(Promise.reject(new h("mesh-incomplete","Mesh resources are not complete")));return T}};b.__decorate([g.property({type:[t],json:{write:!0}})],c.prototype,"components",void 0);b.__decorate([g.property({nonNullable:!0,types:e,constructOnly:!0,json:{write:!0}})],c.prototype,"vertexSpace",void 0);b.__decorate([g.property({type:E,json:{write:!0}})],c.prototype,"transform",void 0);
b.__decorate([g.property({constructOnly:!0})],c.prototype,"metadata",void 0);b.__decorate([g.property()],c.prototype,"hasExtent",null);b.__decorate([g.property()],c.prototype,"_transformedExtent",null);b.__decorate([g.property()],c.prototype,"_untransformedExtent",null);b.__decorate([g.property()],c.prototype,"anchor",null);b.__decorate([g.property()],c.prototype,"origin",null);b.__decorate([g.property({readOnly:!0,json:{read:!1}})],c.prototype,"extent",null);b.__decorate([g.property({readOnly:!0,
json:{read:!1,write:!0,default:!0}})],c.prototype,"hasZ",void 0);b.__decorate([g.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],c.prototype,"hasM",void 0);b.__decorate([g.property({type:A.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],c.prototype,"vertexAttributes",void 0);c=S=b.__decorate([l.subclass("esri.geometry.Mesh")],c);const N=u.create(),V=p.create();return c})},"esri/geometry/support/meshErrors":function(){define(["exports","../../core/Error"],function(a,b){class h extends b{constructor(){super("mesh-not-loaded",
"Mesh must be loaded before applying operations")}}class c extends b{constructor(){super("component-not-found","Provided component is not part of the list of components")}}class k extends b{constructor(){super("invalid-polygon","expected polygon to be a Polygon instance")}}class m extends b{constructor(){super("invalid-input:location","Expected location to be a Point instance")}}a.ComponentNotFoundError=c;a.InvalidLocationError=m;a.InvalidPolygonError=k;a.MeshNotLoadedError=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/bounds":function(){define(["exports","../../Extent","./georeference"],function(a,b,h){function c(m,d){let f=Infinity,g=Infinity,e=Infinity,n=-Infinity,l=-Infinity,u=-Infinity;const x=m.length;let w=0;for(;w<x;){const q=m[w++],v=m[w++],p=m[w++];f=Math.min(f,q);g=Math.min(g,v);e=Math.min(e,p);n=Math.max(n,q);l=Math.max(l,v);u=Math.max(u,p)}return new b({xmin:f,ymin:g,zmin:e,xmax:n,ymax:l,zmax:u,spatialReference:d})}let k=null;
a.getExtentFromPositions=c;a.getProjectedExtent=function({xmin:m,xmax:d,ymin:f,ymax:g,zmin:e,zmax:n},l,u,x){e??=0;n??=0;k??=new Float64Array(24);const w=k;w[0]=m;w[1]=f;w[2]=e;w[3]=m;w[4]=g;w[5]=e;w[6]=d;w[7]=g;w[8]=e;w[9]=d;w[10]=f;w[11]=e;w[12]=m;w[13]=f;w[14]=n;w[15]=m;w[16]=g;w[17]=n;w[18]=d;w[19]=g;w[20]=n;w[21]=d;w[22]=f;w[23]=n;h.project({positions:w,transform:l,vertexSpace:u,inSpatialReference:x,outSpatialReference:x,outPositions:w});return c(w,x)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/meshUtils/centerAt":function(){define("exports ../../../core/Logger ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../projection/projectPointToVector ../meshVertexSpaceUtils ./geographicUtils ./georeference".split(" "),function(a,b,h,c,k,m,d,f){const g=c.create(),e=c.create(),n=c.create();a.centerAt=function(l,u,x){if(l.vertexAttributes?.position){var {vertexSpace:w}=l,q=x?.origin??l.origin;if(m.isRelativeVertexSpace(w))d.validateGeographicFlag(w,
"esri.geometry.support.meshUtils.centerAt",x),{vertexSpace:x}=l,m.isRelativeVertexSpace(x)&&(k.projectPointToVector(u,g,l.spatialReference)?(k.projectPointToVector(q,e,l.spatialReference)||(u=l.origin,e[0]=u.x,e[1]=u.y,e[2]=u.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${q.spatialReference.wkid}) to mesh spatial reference (wkid:${l.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),l=h.subtract(n,
g,e),x.origin=h.add(c.create(),x.origin,l)):b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${u.spatialReference.wkid}) to mesh spatial reference (wkid:${l.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));else if(d.isGlobal(l.spatialReference,x?.geographic)){q=f.ungeoreference(l.vertexAttributes,q,{geographic:!0});const {position:v,normal:p,tangent:t}=f.georeference(q,u,{geographic:!0});l.vertexAttributes.position=
v;l.vertexAttributes.normal=p;l.vertexAttributes.tangent=t;l.vertexAttributesChanged()}else if(k.projectPointToVector(u,g,l.spatialReference)){k.projectPointToVector(q,e,l.spatialReference)||(u=l.origin,e[0]=u.x,e[1]=u.y,e[2]=u.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${q.spatialReference.wkid}) to mesh spatial reference (wkid:${l.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));if(q=l.vertexAttributes.position)for(u=
0;u<q.length;u+=3)for(x=0;3>x;x++)q[u+x]+=g[x]-e[x];l.vertexAttributesChanged()}else b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${u.spatialReference.wkid}) to mesh spatial reference (wkid:${l.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/loadExternal":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),
function(a,b,h,c,k,m){function d(t){const r=k.removeFile(t.url);return y=>{var D=k.makeRelative(y,r,r);return((D=D?D.replace(/^ *\.\//,""):null)?t.files.get(D):null)??y}}async function f(t,r){if(Array.isArray(t)){if(!t.length)throw new h("mesh-load-external:missing-assets","There must be at least one file to load");return t[0]instanceof File?e(t):n(t,r)}return p.fromBlob(t,u(t.name,t.type))}async function g(t,r){const {parts:y,assetMimeType:D,assetName:E}=t;if(1===y.length)return new p(y[0].partUrl);
t=await t.toBlob(r);c.throwIfAborted(r);return p.fromBlob(t,u(E,D))}function e(t){t=t.map(r=>({name:r.name,mimeType:r.type,source:p.fromBlob(r,u(r.name,r.type))}));return l(t)}async function n(t,r){t=await c.allSettledValues(t.map(async y=>{const D=await g(y);c.throwIfAborted(r);return{name:y.assetName,mimeType:y.assetMimeType,source:D}}));if(c.isAborted(r))throw t.forEach(y=>y.source.dispose()),c.createAbortError();return l(t)}function l(t){const r=new Map;let y=null,D=void 0;for(const {name:E,mimeType:A,
source:B}of t){if(null===y)if(x.test(A)||q.test(E))y=B.url,D="gltf";else if(w.test(A)||v.test(E))y=B.url,D="glb";r.set(E,B.url);B.files.forEach((F,G)=>r.set(G,F))}if(null==y)throw new h("mesh-load-external:missing-files","Missing files to load external mesh source");return new p(y,()=>t.forEach(({source:E})=>E.dispose()),r,D)}function u(t,r){return x.test(r)||q.test(t)?"gltf":w.test(r)||q.test(t)?"glb":void 0}const x=/^model\/gltf\+json$/,w=/^model\/gltf-binary$/,q=/\.gltf$/i,v=/\.glb$/i;class p{constructor(t,
r=()=>{},y=new Map,D){this.url=t;this.dispose=r;this.files=y;this.type=D}static fromBlob(t,r){const y=URL.createObjectURL(t);return new p(y,()=>URL.revokeObjectURL(y),void 0,r)}}b.loadExternal=async function(t,r,y){({source:r}=r);const {loadGLTFMesh:D}=await c.whenOrAbort(new Promise((F,G)=>a(["./loadGLTFMesh"],F,G)),y),E=await f(r,y);c.throwIfAborted(y);y=D(new m({x:0,y:0,z:0,spatialReference:t.spatialReference}),E.url,{resolveFile:d(E),useTransform:!0,signal:y?.signal,expectedType:E.type});y.then(()=>
E.dispose(),()=>E.dispose());const {vertexAttributes:A,components:B}=await y;t.vertexAttributes=A;t.components=B};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/Metadata":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./External".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.Metadata=class extends h.Clonable{constructor(){super();this.externalSources=new c;this._explicitDisplaySource=null;this.addHandles(k.on(()=>this.externalSources,"after-remove",({item:l})=>{l===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(l){if(null!=l&&!n.isDisplayExternal(l))throw Error("Cannot use this source for display: it is not in a supported format.");
(this._explicitDisplaySource=l)&&this.externalSources.every(u=>!n.externalSourcesAreEqual(u,l))&&this.externalSources.add(l)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(l){return this.externalSources.items.filter(u=>n.externalIsOnService(u,l))}get _implicitDisplaySource(){return this.externalSources.find(n.isDisplayExternal)}};b.__decorate([m.property()],a.Metadata.prototype,"externalSources",void 0);b.__decorate([m.property()],a.Metadata.prototype,"displaySource",
null);b.__decorate([m.property()],a.Metadata.prototype,"_implicitDisplaySource",null);b.__decorate([m.property()],a.Metadata.prototype,"_explicitDisplaySource",void 0);a.Metadata=b.__decorate([e.subclass("esri.geometry.support.meshUtils.Metadata")],a.Metadata);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/offset":function(){define("exports ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../meshVertexSpaceUtils ./geographicUtils ./projection".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(q,v){if(q)for(let p=0;p<q.length;p+=3)for(let t=0;3>t;t++)q[p+t]+=v[t]}const u=m.create(),x=c.create(),w=h.create();a.offset=function(q,v,p){if(q.vertexAttributes?.position){var {vertexSpace:t}=q;if(g.isRelativeVertexSpace(t))e.validateGeographicFlag(t,"esri.geometry.support.meshUtils.offset",p),t.origin=k.add(m.create(),t.origin,v);else{if(e.isGlobal(q.spatialReference,p?.geographic)){p=q.spatialReference;t=q.vertexAttributes.position;const r=q.vertexAttributes.normal,
y=q.vertexAttributes.tangent,D=new Float64Array(t.length),E=null!=r?new Float32Array(r.length):null,A=null!=y?new Float32Array(y.length):null,B=q.extent.center;f.computeTranslationToOriginAndRotation(p,[B.x,B.y,B.z],x,d.getSphericalPCPF(p));b.fromMat4(w,x);k.transformMat3(u,v,w);n.projectToPCPF(t,p,D);null!=r&&null!=E&&n.projectNormalToPCPF(r,t,D,p,E);null!=y&&null!=A&&n.projectTangentToPCPF(y,t,D,p,A);l(D,u);n.projectFromPCPF(D,t,p);null!=r&&null!=E&&n.projectNormalFromPCPF(E,t,D,p,r);null!=y&&null!=
A&&n.projectTangentFromPCPF(A,t,D,p,y)}else l(q.vertexAttributes.position,v);q.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/primitives":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../MeshComponent ../MeshVertexAttributes ./georeference".split(" "),function(a,b,h,c,k,m,d){var f=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],g=
[0,0,1,0,0,1,0,0,1,0,0,1],e=[0,1,1,1,1,0,0,0],n=[0,1,2,0,2,3],l={east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]};const u={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,
-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},x={south:0,east:1,north:2,west:3,up:4,down:5},w=c.create(),q=b.create();a.boxFaceOrder=x;a.convertPlaneSizeParameter=function(v,p){const t="number"===typeof p?p:null!=p?p.width:1;p="number"===typeof p?p:null!=p?p.height:1;switch(v){case "up":case "down":return{width:t,depth:p};case "north":case "south":return{width:t,height:p};case "east":case "west":return{depth:t,
height:p}}};a.convertUnitGeometry=function(v,p,t){if(!v.isPlane)for(var r=0;r<v.position.length;r+=3)v.position[r+2]+=.5;r=t?.size;if(null!=r){r="number"===typeof r?[r,r,r]:[null!=r.width?r.width:1,null!=r.depth?r.depth:1,null!=r.height?r.height:1];q[0]=r[0];q[4]=r[1];q[8]=r[2];for(var y=0;y<v.position.length;y+=3){for(var D=0;3>D;D++)w[D]=v.position[y+D];h.transformMat3(w,w,q);for(D=0;3>D;D++)v.position[y+D]=w[D]}if(r[0]!==r[1]||r[1]!==r[2])for(q[0]=1/r[0],q[4]=1/r[1],q[8]=1/r[2],r=0;r<v.normal.length;r+=
3){for(y=0;3>y;y++)w[y]=v.normal[r+y];h.transformMat3(w,w,q);h.normalize(w,w);for(y=0;3>y;y++)v.normal[r+y]=w[y]}}const {vertexAttributes:E,vertexSpace:A,transform:B}=d.georeferenceByTransform(v,p,t);return{vertexAttributes:new m.MeshVertexAttributes({...E,uv:v.uv}),vertexSpace:A,transform:B,components:[new k({faces:v.faces,material:t?.material||null})],spatialReference:p.spatialReference}};a.createUnitSizeBox=function(){const {faceDescriptions:v,faceVertexOffsets:p,uvScales:t}=u;var r=4*v.length;
const y=new Float64Array(3*r),D=new Float32Array(3*r);r=new Float32Array(2*r);const E=new Uint32Array(6*v.length);let A=0,B=0,F=0,G=0;for(let L=0;L<v.length;L++){const C=v[L];var H=A/3;for(const z of p)E[G++]=H+z;H=C.corners;for(let z=0;4>z;z++){const J=H[z];let K=0;r[F++]=.25*t[z][0]+C.uvOrigin[0];r[F++]=C.uvOrigin[1]-.25*t[z][1];for(let I=0;3>I;I++)0!==C.axis[I]?(y[A++]=.5*C.axis[I],D[B++]=C.axis[I]):(y[A++]=.5*J[K++],D[B++]=0)}}return{position:y,normal:D,uv:r,faces:E}};a.createUnitSizeCylinder=
function(v=0){v=Math.round(16*2**v);var p=4*(v+1)+2*v;const t=new Float64Array(3*p),r=new Float32Array(3*p);p=new Float32Array(2*p);const y=new Uint32Array(12*v);let D=0,E=0,A=0,B=0,F=0;for(let H=0;5>=H;H++){const L=0===H||5===H,C=1>=H||4<=H,z=2===H||4===H,J=L?v-1:v;for(let K=0;K<=J;K++){var G=K/J*2*Math.PI;const I=L?0:.5;w[0]=I*Math.sin(G);w[1]=I*-Math.cos(G);w[2]=2>=H?.5:-.5;for(G=0;3>G;G++)t[D++]=w[G],C?r[E++]=2===G?1>=H?1:-1:0:r[E++]=2===G?0:w[G]/I;p[A++]=(K+(L?.5:0))/v;1>=H?p[A++]=1*H/3:3>=H?
p[A++]=(H-2)/3+1/3:p[A++]=(H-4)/3+2/3;z||0===H||K===v||(5!==H&&(y[B++]=F,y[B++]=F+1,y[B++]=F-v),1!==H&&(y[B++]=F,y[B++]=F-v,y[B++]=F-v-1));F++}}return{position:t,normal:r,uv:p,faces:y}};a.createUnitSizePlane=function(v){v=l[v];const p=new Float64Array(f.length),t=new Float32Array(g.length);let r=0;for(let D=0;4>D;D++){const E=r;for(let A=0;3>A;A++){var y=v[A];const B=Math.abs(y)-1;y=0<=y?1:-1;p[r]=f[E+B]*y;t[r]=g[E+B]*y;r++}}return{position:p,normal:t,uv:new Float32Array(e),faces:new Uint32Array(n),
isPlane:!0}};a.createUnitSizeSphere=function(v=0){v=Math.round(8*2**v);const p=2*v;var t=(v-1)*(p+1)+2*p;const r=new Float64Array(3*t),y=new Float32Array(3*t);t=new Float32Array(2*t);const D=new Uint32Array((v-1)*p*6);let E=0,A=0,B=0,F=0;for(let L=0;L<=v;L++){var G=L/v*Math.PI+.5*Math.PI;const C=Math.cos(G);w[2]=Math.sin(G);const z=(G=0===L||L===v)?p-1:p;for(let J=0;J<=z;J++){var H=J/z*2*Math.PI;w[0]=-Math.sin(H)*C;w[1]=Math.cos(H)*C;for(H=0;3>H;H++)r[E]=.5*w[H],y[E]=w[H],++E;t[A++]=(J+(G?.5:0))/
p;t[A++]=L/v;0!==L&&J!==p&&(L!==v&&(D[B++]=F,D[B++]=F+1,D[B++]=F-p),1!==L&&(D[B++]=F,D[B++]=F-p,D[B++]=F-p-1));F++}}return{position:r,normal:y,uv:t,faces:D}};a.extractSingleFaceOfBox=function(v,p){const t=v.components[0];var r=t.faces,y=x[p],D=6*y;p=Array(6);const E=Array(r.length-6);var A=0;let B=0;for(let F=0;F<r.length;F++)F>=D&&F<D+6?p[A++]=r[F]:E[B++]=r[F];if(null!=v.vertexAttributes.uv){r=new Float32Array(v.vertexAttributes.uv);y*=8;D=[0,1,1,1,1,0,0,0];for(A=0;A<D.length;A++)r[y+A]=D[A];v.vertexAttributes.uv=
r}v.components=[new k({faces:p,material:t.material}),new k({faces:E})];return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/rotate":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){function v(A,B,F,G=f.ZEROS){if(null!=A)for(k.fromRotation(y,l.angleRad(B),l.axis(B)),B=0;B<A.length;B+=F){for(var H=0;3>H;H++)p[H]=A[B+H]-G[H];d.transformMat4(p,p,y);for(H=0;3>H;H++)A[B+H]=p[H]+G[H]}}const p=f.create(),t=f.create(),r=l.create(),y=m.create(),D=c.create(),E=f.create();a.rotate=function(A,B,F){if(A.vertexAttributes?.position&&0!==B[3]){var {spatialReference:G,vertexSpace:H}=A;if(x.isRelativeVertexSpace(H)){w.validateGeographicFlag(H,"esri.geometry.support.meshUtils.rotate",
F);var L=F?.origin??A.origin;A.transform??(A.transform=new u);A=A.transform;F=H.origin;L=d.set(p,L.x,L.y,L.z??0);F=d.subtract(p,L,F);A.applyLocalInverse(F,t);A.rotation=l.compose(A.rotation,B,l.create());A.applyLocalInverse(F,F);d.subtract(F,F,t);A.translation=d.add(f.create(),A.translation,F)}else{L=F?.origin??A.origin;if(w.isGlobal(G,F?.geographic)){var C=L;F=A.spatialReference;L=g.getSphericalPCPF(F);n.projectPointToVector(C,E,L)||n.projectPointToVector(A.origin,E,L);C=A.vertexAttributes.position;
const z=A.vertexAttributes.normal,J=A.vertexAttributes.tangent,K=new Float64Array(C.length),I=null!=z?new Float32Array(z.length):null,M=null!=J?new Float32Array(J.length):null;e.computeTranslationToOriginAndRotation(L,E,y,L);h.fromMat4(D,y);d.transformMat3(l.axis(r),l.axis(B),D);r[3]=B[3];q.projectToPCPF(C,F,K);null!=z&&null!=I&&q.projectNormalToPCPF(z,C,K,F,I);null!=J&&null!=M&&q.projectTangentToPCPF(J,C,K,F,M);v(K,r,3,E);q.projectFromPCPF(K,C,F);null!=z&&null!=I&&(v(I,r,3),q.projectNormalFromPCPF(I,
C,K,F,z));null!=J&&null!=M&&(v(M,r,4),q.projectTangentFromPCPF(M,C,K,F,J))}else F=L,n.projectPointToVector(F,E,A.spatialReference)||(L=A.origin,E[0]=L.x,E[1]=L.y,E[2]=L.z,b.getLogger("esri.geometry.support.meshUtils.rotate").error(`Failed to project specified origin (wkid:${F.spatialReference.wkid}) to mesh spatial reference (wkid:${A.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),v(A.vertexAttributes.position,B,3,E),v(A.vertexAttributes.normal,B,3),v(A.vertexAttributes.tangent,
B,4);A.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/scale":function(){define("exports ../../../core/Logger ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/projectPointToVector ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection".split(" "),function(a,b,h,c,k,m,d,f,g,e){function n(w,q,v=c.ZEROS){if(w)for(let t=0;t<w.length;t+=
3){for(var p=0;3>p;p++)l[p]=w[t+p]-v[p];h.scale(l,l,q);for(p=0;3>p;p++)w[t+p]=l[p]+v[p]}}const l=c.create(),u=c.create(),x=c.create();a.scale=function(w,q,v){if(w.vertexAttributes?.position){var {spatialReference:p,vertexSpace:t}=w;if(f.isRelativeVertexSpace(t)){g.validateGeographicFlag(t,"esri.geometry.support.meshUtils.scale",v);var r=v?.origin??w.origin;w.transform??(w.transform=new d);w=w.transform;v=t.origin;r=h.set(l,r.x,r.y,r.z);v=h.subtract(l,r,v);w.applyLocalInverse(v,u);q=h.scale(c.create(),
w.scale,q);w.scale=q;w.applyLocalInverse(v,v);h.subtract(v,v,u);w.translation=h.add(c.create(),w.translation,v)}else{r=v?.origin??w.origin;if(g.isGlobal(p,v?.geographic)){v=w.spatialReference;var y=k.getSphericalPCPF(v);m.projectPointToVector(r,x,y)||m.projectPointToVector(w.origin,x,y);r=w.vertexAttributes.position;y=w.vertexAttributes.normal;const D=w.vertexAttributes.tangent,E=new Float64Array(r.length),A=null!=y?new Float32Array(y.length):null,B=null!=D?new Float32Array(D.length):null;e.projectToPCPF(r,
v,E);null!=y&&null!=A&&e.projectNormalToPCPF(y,r,E,v,A);null!=D&&null!=B&&e.projectTangentToPCPF(D,r,E,v,B);n(E,q,x);e.projectFromPCPF(E,r,v);null!=y&&null!=A&&e.projectNormalFromPCPF(A,r,E,v,y);null!=D&&null!=B&&e.projectTangentFromPCPF(B,r,E,v,D)}else v=r,m.projectPointToVector(v,x,w.spatialReference)||(r=w.origin,x[0]=r.x,x[1]=r.y,x[2]=r.z,b.getLogger("esri.geometry.support.meshUtils.scale").error(`Failed to project specified origin (wkid:${v.spatialReference.wkid}) to mesh spatial reference (wkid:${w.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load().")),n(w.vertexAttributes.position,q,x);w.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/uploadAssetErrors":function(){define(["exports","../../../../core/Error"],function(a,b){class h extends b{constructor(){super("upload-assets:unsupported","Layer does not support asset uploads.",Error())}}class c extends b{constructor(){super("upload-assets:no-glb-support",
"Layer does not support glb.",Error())}}class k extends b{constructor(){super("upload-assets:no-supported-source","No supported external source found",Error())}}class m extends b{constructor(){super("upload-assets:not-base-64","Expected gltf data in base64 format after conversion.",Error())}}class d extends b{constructor(){super("upload-assets:unable-to-prepare-options","Unable to prepare uploadAsset request options.",Error())}}class f extends b{constructor(x,w){super("upload-assets:bad-response",
`Bad response. Uploaded ${x} items and received ${w} results.`,Error())}}class g extends b{constructor(x,w){super("upload-assets-layer:upload-failed",`Failed to upload mesh file ${x}. Error code: ${w?.code??"-1"}. Error message: ${w?.messages??"unknown"}`,Error())}}class e extends b{constructor(x){super("upload-assets-layer:unsupported-format",`The service allowed us to upload an asset of FormatID ${x}, but it does not list it in its supported formats.`,Error())}}class n extends b{constructor(){super("upload-assets:convert3D-failed",
"convert3D failed.")}}class l extends b{constructor(){super("invalid-input:no-model","No supported model found")}}class u extends b{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}a.BadResponseError=f;a.Convert3DFailedError=n;a.MultipleModelsError=u;a.NoGlbSupportError=c;a.NoModelError=l;a.NoSupportedSourceError=k;a.NotBase64Error=m;a.UnableToPrepareOptionsError=d;a.UnsupportedError=h;a.UnsupportedFormatUploadedError=e;a.UploadFailedError=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../portal/support/jsonContext ../../webdoc/support/resourceUtils ../../webdoc/support/saveAPIKeyUtils ../../webdoc/support/saveUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G){var H;(function(C){C[C.existingItem=0]="existingItem";C[C.newItem=1]="newItem"})(H||={});const L={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(C){C[C.SAVE=0]="SAVE";C[C.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SceneService=C=>{C=class extends C{constructor(){super(...arguments);this.heightModelInfo=
this.fullExtent=this.spatialReference=null;this.maxScale=this.minScale=0;this.version={major:Number.NaN,minor:Number.NaN,versionString:""};this.copyright=null;this.sublayerTitleMode="item-title";this.indexInfo=this.layerId=this.title=null;this._debouncedSaveOperations=m.debounce(async(z,J,K)=>{switch(z){case a.SaveOperationType.SAVE:return this._save(J);case a.SaveOperationType.SAVE_AS:return this._saveAs(K,J)}})}readSpatialReference(z,J){return this._readSpatialReference(J)}_readSpatialReference(z){if(null!=
z.spatialReference)return v.fromJSON(z.spatialReference);z=z.store;z=(z=z.indexCRS||z.geographicCRS)&&parseInt(z.substring(z.lastIndexOf("/")+1,z.length),10);return null!=z?new v(z):null}readFullExtent(z,J,K){if(null!=z&&"object"===typeof z)return J=null==z.spatialReference?{...z,spatialReference:this._readSpatialReference(J)}:z,w.fromJSON(J,K);K=J.store;J=this._readSpatialReference(J);return null==J||null==K?.extent||!Array.isArray(K.extent)||K.extent.some(I=>-1E38>I)?null:new w({xmin:K.extent[0],
ymin:K.extent[1],xmax:K.extent[2],ymax:K.extent[3],spatialReference:J})}parseVersionString(z){const J={major:Number.NaN,minor:Number.NaN,versionString:z};z=z.split(".");2<=z.length&&(J.major=parseInt(z[0],10),J.minor=parseInt(z[1],10));return J}readVersion(z,J){z=J.store;return this.parseVersionString(null!=z.version?z.version.toString():"")}readTitlePortalItem(z){return"item-title"!==this.sublayerTitleMode?void 0:z}readTitleService(z,J){z=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return p.titleFromUrlAndName(this.url,
J.name);J=J.name;if(!J&&this.url){const K=p.parse(this.url);null!=K&&(J=K.title)}"item-title-and-service-name"===this.sublayerTitleMode&&z&&(J=z+" - "+J);return p.cleanTitle(J)}set url(z){z=p.sanitizeUrlWithLayerId({layer:this,url:z,nonStandardUrlAllowed:!1,logger:k.getLogger(this)});this._set("url",z.url);null!=z.layerId&&this._set("layerId",z.layerId)}writeUrl(z,J,K,I){p.writeUrlWithLayerId(this,z,"layers",J,I)}get parsedUrl(){var z=this._get("url");z=d.urlToObject(z);null!=this.layerId&&(z.path=
`${z.path}/layers/${this.layerId}`);return z}async _fetchIndexAndUpdateExtent(z,J){this.indexInfo=r.fetchIndexInfo(this.parsedUrl.path,this.rootNode,z,this.customParameters,this.apiKey,k.getLogger(this),J);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(z){if("page"===z?.type){var J=z.rootIndex%z.pageSize;J=z.rootPage?.nodes?.[J];if(null==J?.obb?.center||null==J.obb.halfSize)throw new c("sceneservice:invalid-node-page","Invalid node page.");-1E38>
J.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(z=J.obb.halfSize,J=J.obb.center[2],z=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),this.fullExtent.zmin=J-z,this.fullExtent.zmax=J+z)}else if("node"===z?.type&&(J=z.rootNode?.mbs,Array.isArray(J)&&4===J.length&&!(-1E38>J[0]))){z=J[2];J=J[3];var {fullExtent:K}=this;K&&(K.zmin=z-J,K.zmax=z+J)}}async _fetchService(z){if(null==this.url)throw new c("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==
this.layerId&&/SceneServer\/*$/i.test(this.url)){const J=await this._fetchFirstLayerId(z);null!=J&&(this.layerId=J)}return this._fetchServiceLayer(z)}async _fetchFirstLayerId(z){z=await h(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:z});if(z.data&&Array.isArray(z.data.layers)&&0<z.data.layers.length)return z.data.layers[0].id}async _fetchServiceLayer(z){z=await h(this.parsedUrl?.path??"",{query:{f:"json",...this.customParameters,token:this.apiKey},
responseType:"json",signal:z});z.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let J=!1;z.data.layerType&&"Voxel"===z.data.layerType&&(J=!0);if(J)return this._fetchVoxelServiceLayer();z=z.data;this.read(z,this._getServiceContext());this.validateLayer(z)}async _fetchVoxelServiceLayer(z){z=(await h(this.parsedUrl?.path+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:z})).data;this.read(z,this._getServiceContext());this.validateLayer(z)}_getServiceContext(){return{origin:"service",
portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()}validateLayer(z){}_updateTypeKeywords(z,J,K){z.typeKeywords||(z.typeKeywords=[]);J=J.getTypeKeywords();for(const I of J)z.typeKeywords.push(I);z.typeKeywords&&(z.typeKeywords=z.typeKeywords.filter((I,M,S)=>S.indexOf(I)===M),K===H.newItem&&(z.typeKeywords=z.typeKeywords.filter(I=>"Hosted Service"!==
I)))}async _saveAs(z,J){J={...L,...J};z=E.from(z);if(!z)throw new c("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");F.validateSaveAPIKey(z);z.id&&(z=z.clone(),z.id=null);const K=z.portal||D.getDefault();await this._ensureLoadBeforeSave();z.type="Scene Service";z.portal=K;const I=A.createForItemWrite(z,"portal-item",!0),M={layers:[this.write({},I)]};await Promise.all(I.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(M,I,J);z.url=this.url;z.title||
(z.title=this.title);this._updateTypeKeywords(z,J,H.newItem);await K.signIn();await K.user?.addItem({item:z,folder:J?.folder,data:M});await B.saveResources(this.resourceReferences,I);this.portalItem=z;x.updateOrigins(I);return I.portalItem=z}async _save(z){z={...L,...z};if(!this.portalItem)throw new c("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");F.validateSaveAPIKey(this.portalItem);if("Scene Service"!==this.portalItem.type)throw new c("sceneservice:portal-item-wrong-type",
'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const J=A.createForItemWrite(this.portalItem,"portal-item",!0),K={layers:[this.write({},J)]};await Promise.all(J.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(K,J,z);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,z,H.existingItem);await B.updateItemWithResources(this.portalItem,K,this.resourceReferences,J);x.updateOrigins(J);
return this.portalItem}async _validateAgainstJSONSchema(z,J,K){var I=K?.validationOptions;G.evaluateWriteErrors(J,{errorName:"sceneservice:save"},{ignoreUnsupported:I?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});J=I?.enabled;const M=y.getLoader();if(J&&M&&(K=(await M()).validate(z,K.portalItemLayerType),K.length&&(z=`Layer item did not validate:\n${K.join("\n")}`,k.getLogger(this).error(`_validateAgainstJSONSchema(): ${z}`),"throw"===I.failPolicy)))throw I=
K.map(S=>new c("sceneservice:schema-validation",S)),new c("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:I});}};b.__decorate([f.property(t.id)],C.prototype,"id",void 0);b.__decorate([f.property({type:v})],C.prototype,"spatialReference",void 0);b.__decorate([n.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],C.prototype,"readSpatialReference",null);b.__decorate([f.property({type:w})],
C.prototype,"fullExtent",void 0);b.__decorate([n.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],C.prototype,"readFullExtent",null);b.__decorate([f.property({readOnly:!0,type:q})],C.prototype,"heightModelInfo",void 0);b.__decorate([f.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],C.prototype,"minScale",void 0);b.__decorate([f.property({type:Number,json:{name:"layerDefinition.maxScale",
write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],C.prototype,"maxScale",void 0);b.__decorate([f.property({readOnly:!0})],C.prototype,"version",void 0);b.__decorate([n.reader("version",["store.version"])],C.prototype,"readVersion",null);b.__decorate([f.property({type:String,json:{read:{source:"copyrightText"}}})],C.prototype,"copyright",void 0);b.__decorate([f.property({type:String,json:{read:!1}})],C.prototype,"sublayerTitleMode",void 0);b.__decorate([f.property({type:String})],
C.prototype,"title",void 0);b.__decorate([n.reader("portal-item","title")],C.prototype,"readTitlePortalItem",null);b.__decorate([n.reader("service","title",["name"])],C.prototype,"readTitleService",null);b.__decorate([f.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],C.prototype,"layerId",void 0);b.__decorate([f.property(t.url)],C.prototype,"url",null);b.__decorate([u.writer("url")],C.prototype,"writeUrl",
null);b.__decorate([f.property()],C.prototype,"parsedUrl",null);b.__decorate([f.property({readOnly:!0})],C.prototype,"store",void 0);b.__decorate([f.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],C.prototype,"rootNode",void 0);return C=b.__decorate([l.subclass("esri.layers.mixins.SceneService")],C)};a.sceneServiceItemType="Scene Service";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports",
"../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(h){h?.writtenProperties&&h.writtenProperties.forEach(({target:c,propName:k,newOrigin:m})=>{b.isMultiOriginJSONMixin(c)&&m&&c.originOf(k)!==m&&c.updateOrigin(k,m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error"],function(a,b,h){a.fetchIndexInfo=async function(c,k,m,d,f,g,e){var n=null;if(null!=m){n=`${c}/nodepages/`;const l=n+Math.floor(m.rootIndex/m.nodesPerPage);try{return{type:"page",rootPage:(await b(l,{query:{f:"json",...d,token:f},responseType:"json",signal:e})).data,rootIndex:m.rootIndex,pageSize:m.nodesPerPage,lodMetric:m.lodSelectionMetricType,urlPrefix:n}}catch(u){null!=g&&g.warn("#fetchIndexInfo()",
"Failed to load root node page. Falling back to node documents.",l,u),n=u}}if(!k)return null;k=k?.split("/").pop();c=`${c}/nodes/`;k=c+k;try{return{type:"node",rootNode:(await b(k,{query:{f:"json",...d,token:f},responseType:"json",signal:e})).data,urlPrefix:c}}catch(l){throw new h("sceneservice:root-node-missing","Root node missing.",{pageError:n,nodeError:l,url:k});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],
function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(h){b=h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(a,b,h){function c(k,m){return{origin:m,url:b.urlToObject(k.itemUrl),portal:k.portal||h.getDefault(),portalItem:k}}a.createForItemRead=function(k,m){return{...c(k,m),readResourcePaths:[]}};a.createForItemWrite=function(k,m,d){const f=b.urlToObject(k.itemUrl);
return{...c(k,m),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:f?{rootPath:f.path,writtenUrls:[]}:null,resources:d?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/resourceUtils":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(a,b,h,c,k,m){async function d(g,e,n){if(e?.resources){var l=
e.portalItem===g.portalItem?new Set(g.paths):new Set;g.paths.length=0;g.portalItem=e.portalItem;var u=new Set(e.resources.toKeep.map(t=>t.resource.path)),x=new Set,w=[];u.forEach(t=>{l.delete(t);g.paths.push(t)});var q=[],v=[],p=[];for(const t of e.resources.toUpdate)if(l.delete(t.resource.path),u.has(t.resource.path)||x.has(t.resource.path)){const {resource:r,content:y,finish:D}=t,E=m.getSiblingOfSameTypeI(r,k.generateUUID());g.paths.push(E.path);q.push({resource:E,content:await m.contentToBlob(y),
compress:t.compress});D&&p.push(()=>D(E))}else{g.paths.push(t.resource.path);v.push({resource:t.resource,content:await m.contentToBlob(t.content),compress:t.compress});const r=t.finish;r&&p.push(()=>r(t.resource));x.add(t.resource.path)}for(const t of e.resources.toAdd)if(g.paths.push(t.resource.path),l.has(t.resource.path))l.delete(t.resource.path);else{q.push({resource:t.resource,content:await m.contentToBlob(t.content),compress:t.compress});const r=t.finish;r&&p.push(()=>r(t.resource))}if(q.length||
v.length)({addOrUpdateResources:u}=await new Promise((t,r)=>a(["../../portal/support/resourceUtils"],t,r))),await u(e.portalItem,q,"add",n),await u(e.portalItem,v,"update",n);p.forEach(t=>t());if(0===w.length)return l;e=await c.allSettledErrors(w);c.throwIfAborted(n);if(0<e.length)throw new h("save:resources","Failed to save one or more resources",{errors:e});return l}}async function f(g,e,n){if(g&&e.portalItem){var l=[];for(const u of g)g=e.portalItem.resourceFromPath(u),l.push(g.portalItem.removeResource(g,
n));await c.eachAlways(l)}}b.saveResources=async function(g,e,n){g=await d(g,e,n);await f(g,e,n)};b.updateItemWithResources=async function(g,e,n,l,u){n=await d(n,l,u);await g.update({data:e});await f(n,l,u)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(a,b,h,c){function k(d){const f=d.lastIndexOf("/");return-1===f?[".",d]:[d.slice(0,f),d.slice(f+1)]}
function m(d){{const l=c.getPathExtension(d);d=null==l?[d,""]:[d.slice(0,d.length-l.length-1),`.${l}`]}const [f,g]=d,[e,n]=k(f);return[e,n,g]}a.addOrUpdateResources=async function(d,f,g,e){var n=new Map;for(const {resource:l,content:u,compress:x,access:w}of f){if(!l.hasPath())throw new h(`portal-item-resource-${g}:invalid-path`,"Resource does not have a valid path");const [q,v]=k(l.path);f=`${q}/${x??""}/${w??""}`;n.has(f)||n.set(f,{prefix:q,compress:x,access:w,files:[]});n.get(f).files.push({fileName:v,
content:u})}await d.load(e);g=c.join(d.userItemUrl,"add"===g?"addResources":"updateResources");for(const {prefix:l,compress:u,access:x,files:w}of n.values())for(n=0;n<w.length;n+=25){f=w.slice(n,n+25);const q=new FormData;l&&"."!==l&&q.append("resourcesPrefix",l);u&&q.append("compress","true");x&&q.append("access",x);let v=0;for(const {fileName:p,content:t}of f)q.append(`file${++v}`,t,p);q.append("f","json");await d.portal.request(g,{method:"post",body:q,signal:e?.signal})}};a.contentToBlob=async function(d){return"blob"===
d.type?d.blob:"json"===d.type?new Blob([d.jsonString],{type:"application/json"}):(await b(d.url,{responseType:"blob"})).data};a.fetchResources=async function(d,f={},g){await d.load(g);const e=c.join(d.itemUrl,"resources"),{start:n=1,num:l=10,sortOrder:u="asc",sortField:x="created"}=f;f=await d.portal.request(e,{query:{start:n,num:l,sortOrder:u,sortField:x,token:d.apiKey},signal:g?.signal});return{total:f.total,nextStart:f.nextStart,resources:f.resources.map(({created:w,size:q,resource:v})=>({created:new Date(w),
size:q,resource:d.resourceFromPath(v)}))}};a.getSiblingOfSameType=function(d,f){if(!d.hasPath())return null;const [g,,e]=m(d.path);return d.portalItem.resourceFromPath(c.join(g,f+e))};a.getSiblingOfSameTypeI=function(d,f){if(!d.hasPath())return null;const [g,,e]=m(d.path);return d.portalItem.resourceFromPath(c.join(g,f+e))};a.removeAllResources=async function(d,f){await d.load(f);const g=c.join(d.userItemUrl,"removeResources");return d.portal.request(g,{method:"post",query:{deleteAll:!0},signal:f?.signal})};
a.removeResource=async function(d,f,g){if(!f.hasPath())throw new h("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await d.load(g);const e=c.join(d.userItemUrl,"removeResources");await d.portal.request(e,{method:"post",query:{resource:f.path},signal:g?.signal});f.portalItem=null};a.splitPrefixFileNameAndExtension=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveAPIKeyUtils":function(){define(["exports","../../config","../../core/Error",
"../../support/apiKeyUtils"],function(a,b,h,c){a.validateSaveAPIKey=function(k){if(b.apiKey&&c.supportsApiKey(k.portal.url))throw new h("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${k.portal.url} when using an api key`);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define(["exports","../../core/Error"],function(a,b){const h=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported",
"url:unsupported"]);a.beforeSave=async function(c){const k=[];for(const m of c.allLayers)"beforeSave"in m&&"function"===typeof m.beforeSave&&(c=m.beforeSave())&&k.push(c);await Promise.allSettled(k)};a.evaluateWriteErrors=function(c,k,m){let d=(c.messages??[]).filter(({type:f})=>"error"===f).map(({name:f,message:g,details:e})=>new b(f,g,e));c.blockedRelativeUrls&&(d=d.concat(c.blockedRelativeUrls.map(f=>new b("url:unsupported",`Relative url '${f}' is not supported`))));if(m){const {ignoreUnsupported:f,
supplementalUnsupportedErrors:g=[],requiredPropertyChecksDisabled:e}=m;f&&(d=d.filter(({name:n})=>!(h.has(n)||g.includes(n))));e&&(d=d.filter(n=>"web-document-write:property-required"!==n.name))}if(0<d.length)throw new b(k.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:d});};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/TemporalSceneLayer":function(){define("exports ../../chunks/tslib.es6 ../../TimeExtent ../../TimeInterval ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../support/fieldUtils ../support/TimeInfo".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.TemporalSceneLayer=l=>{l=class extends l{get timeInfo(){var u=this.associatedLayer?.timeInfo;if(null==u)return u;u=u.clone();e.fixTimeInfoFields(u,this.fieldsIndex);return u}set timeInfo(u){e.fixTimeInfoFields(u,this.fieldsIndex);this._override("timeInfo",u)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(u){this._override("timeExtent",u)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(u){this._override("timeOffset",
u)}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(u){this._override("useViewTime",u)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(u){this._override("datesInUnknownTimezone",u)}};b.__decorate([k.property({type:n})],l.prototype,"timeInfo",null);b.__decorate([k.property({type:h})],l.prototype,"timeExtent",null);b.__decorate([k.property({type:c})],l.prototype,"timeOffset",null);b.__decorate([k.property({type:Boolean,
nonNullable:!0})],l.prototype,"useViewTime",null);b.__decorate([k.property({type:Boolean,nonNullable:!0})],l.prototype,"datesInUnknownTimezone",null);return l=b.__decorate([g.subclass("esri.layers.mixins.TemporalSceneLayer")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,
supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},
operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},
query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,
supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f,g){a.I3SNodePageDefinition=class extends h.JSONSupport{constructor(){super(...arguments);this.nodesPerPage=null;this.rootIndex=0;this.lodSelectionMetricType=null}};b.__decorate([c.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([c.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([c.property({type:String})],a.I3SNodePageDefinition.prototype,"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=
b.__decorate([g.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=class extends h.JSONSupport{constructor(){super(...arguments);this.factor=1}};b.__decorate([c.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialTexture.prototype,"factor",void 0);a.I3SMaterialTexture=b.__decorate([g.subclass("esri.layer.support.I3SMaterialTexture")],
a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=class extends h.JSONSupport{constructor(){super(...arguments);this.baseColorFactor=[1,1,1,1];this.metallicRoughnessTexture=this.baseColorTexture=null;this.roughnessFactor=this.metallicFactor=1}};b.__decorate([c.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],
a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=b.__decorate([g.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=class extends h.JSONSupport{constructor(){super(...arguments);
this.alphaMode="opaque";this.alphaCutoff=.25;this.doubleSided=!1;this.cullFace="none";this.pbrMetallicRoughness=this.emissiveFactor=this.emissiveTexture=this.occlusionTexture=this.normalTexture=null}};b.__decorate([f.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([c.property({type:Boolean})],a.I3SMaterialDefinition.prototype,
"doubleSided",void 0);b.__decorate([f.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([c.property({type:[Number]})],
a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([c.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([g.subclass("esri.layer.support.I3SMaterialDefinition")],a.I3SMaterialDefinition);a.I3STextureFormat=class extends h.JSONSupport{};b.__decorate([c.property({type:String,json:{read:{source:["name","index"],reader:(e,n)=>null!=e?e:`${n.index}`}}})],a.I3STextureFormat.prototype,
"name",void 0);b.__decorate([f.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([g.subclass("esri.layer.support.I3STextureFormat")],a.I3STextureFormat);a.I3STextureSetDefinition=class extends h.JSONSupport{constructor(){super(...arguments);this.atlas=!1}};b.__decorate([c.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([c.property({type:Boolean})],
a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([g.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);a.I3SGeometryAttribute=class extends h.JSONSupport{};b.__decorate([f.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([c.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=
b.__decorate([g.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);a.I3SGeometryCompressedAttributes=class extends h.JSONSupport{};b.__decorate([f.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([c.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([g.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=class extends h.JSONSupport{constructor(){super(...arguments);this.offset=0}};b.__decorate([c.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([c.property({type:a.I3SGeometryCompressedAttributes})],a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=
b.__decorate([g.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=class extends h.JSONSupport{};b.__decorate([f.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([c.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=b.__decorate([g.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d,f){a.RangeInfo=class extends h.JSONSupport{constructor(){super(...arguments);this.fullRangeExtent=this.currentRangeExtent=this.field=this.name=null;this.type="rangeInfo"}};b.__decorate([c.property({type:String,json:{read:!0,
write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([c.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([c.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);b.__decorate([c.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([c.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);
a.RangeInfo=b.__decorate([f.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/tslib.es6 ../../request ../../core/JSONSupport ../../core/lang ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){var x;h=x=class extends h.JSONSupport{constructor(w){super(w);this.spatialRelationship="disjoint";this.geometries=new l;this._geometriesSource=null}initialize(){this.addHandles(k.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,k.sync))}readGeometries(w,q,v){Array.isArray(w)?this.geometries=l.fromJSON(w,v):this._geometriesSource={url:u.fromJSON(w,v),context:v}}async loadGeometries(w,q){if(null!=this._geometriesSource){var {url:v,context:p}=
this._geometriesSource;q=await b(v,{responseType:"json",signal:q?.signal});var t=w.toJSON();w=q.data.map(r=>({...r,spatialReference:t}));this.geometries=l.fromJSON(w,p);this._geometriesSource=null}}clone(){const w=new x({geometries:c.clone(this.geometries),spatialRelationship:this.spatialRelationship});w._geometriesSource=this._geometriesSource;return w}};a.__decorate([m.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],h.prototype,"spatialRelationship",void 0);a.__decorate([m.property({type:l,
nonNullable:!0,json:{write:!0}}),n.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],h.prototype,"geometries",void 0);a.__decorate([g.reader(["web-scene","portal-item"],"geometries")],h.prototype,"readGeometries",null);return h=x=a.__decorate([e.subclass("esri.layers.support.SceneFilter")],h)})},"esri/core/accessorSupport/decorators/persistable":function(){define("exports ../../Error ../../MD5 ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(v,p,t){const r=d.getPropertyMetadata(p,t);return{type:String,read:(y,D,E)=>{y=n.read(y,D,E);if(r.type===String)return y;if("function"===typeof r.type)return new r.type({url:y})},write:{writer(y,D,E,A){if(A?.resources){var B=null==y?null:"string"===typeof y?y:y.url;B=n.toJSON(B,{...A,verifyItemRelativeUrls:A?.verifyItemRelativeUrls?{writtenUrls:A.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},n.MarkKeep.NO);var F=r.type!==String&&(!c.isMultiOriginJSONMixin(this)||
A?.origin&&this.originIdOf(t)>f.nameToId(A.origin));y={object:this,propertyName:t,value:y,targetUrl:B,dest:D,targetPropertyName:E,context:A,params:v};if(A?.portalItem&&B&&!k.isAbsolute(B))if(F&&v?.contentAddressed)u(y);else if(F){{const {context:G,targetUrl:H,params:L,value:C,dest:z,targetPropertyName:J}=y;G.portalItem&&(D=G.portalItem.resourceFromPath(H),E=q(C,H,G),A=e.getResourceContentExtension(E),B=k.getPathExtension(D.path),F=L?.compress??!1,A!==B?u(y):(G.resources&&w({...y,resource:D,content:E,
compress:F,updates:G.resources.toUpdate}),z[J]=H))}}else x(y);else A?.portalItem&&(null==B||null!=n.itemIdFromResourceUrl(B)||k.isBlobProtocol(B)||F)?u(y):D[E]=B}else D[E]="string"===typeof y?n.toJSON(y,A):y.write({},A)}}}}function u(v){const {targetUrl:p,params:t,value:r,context:y,dest:D,targetPropertyName:E}=v;if(y.portalItem){var A=n.prefixAndFilenameFromResourceUrl(p),B=q(r,p,y);if(t?.contentAddressed&&"json"!==B.type)y.messages?.push(new b("persistable:contentAddressingUnsupported",`Property "${E}" is trying to serializing a resource with content of type ${B.type} with content addressing. Content addressing is only supported for json resources.`,
{content:B}));else{var F=t?.contentAddressed&&"json"===B.type?h.createMD5Hash(B.jsonString):A?.filename??m.generateUUID(),G=k.join(t?.prefix??A?.prefix,F),H=`${G}.${e.getResourceContentExtension(B)}`;if(t?.contentAddressed&&y.resources&&"json"===B.type&&(A=y.resources.toKeep.find(({resource:C})=>C.path===H)??y.resources.toAdd.find(({resource:C})=>C.path===H))){D[E]=A.resource.itemRelativeUrl;return}var L=y.portalItem.resourceFromPath(H);k.isBlobProtocol(p)&&y.resources&&y.resources.pendingOperations.push(k.blobUrlToBlob(p).then(C=>
{L.path=`${G}.${e.getResourceContentExtension({type:"blob",blob:C})}`;D[E]=L.itemRelativeUrl}).catch(()=>{}));y.resources&&w({...v,resource:L,content:B,compress:t?.compress??!1,updates:y.resources.toAdd});D[E]=L.itemRelativeUrl}}}function x({context:v,targetUrl:p,dest:t,targetPropertyName:r}){v.portalItem&&v.resources&&(v.resources.toKeep.push({resource:v.portalItem.resourceFromPath(p),compress:!1}),t[r]=p)}function w({object:v,propertyName:p,updates:t,resource:r,content:y,compress:D}){t.push({resource:r,
content:y,compress:D,finish:E=>{"string"===typeof v[p]?v[p]=E.url:v[p].url=E.url}})}function q(v,p,t){return"string"===typeof v?{type:"url",url:p}:{type:"json",jsonString:JSON.stringify(v.toJSON(t))}}a.persistable=function(v){const p=v?.origins??[void 0];return(t,r)=>{a:if("resource"===v?.type)var y=l(v,t,r);else{switch(v?.type??"other"){case "other":y={read:!0,write:!0};break a;case "url":const {read:D,write:E}=n.persistableUrlUtils;y={read:D,write:E};break a}y=void 0}for(const D of p){const E=g.propertyJSONMeta(t,
D,r);for(const A in y)E[A]=y[A]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,b){const h={},c=h["text/plain"],k={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};
for(const m in k)h[k[m]]=m;a.getResourceContentExtension=function(m){"json"===m.type?m="application/json":"blob"===m.type?m=m.blob.type:(m=b.getPathExtension(m.url),m=k[m]||"text/plain");return h[m]||c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){var l;b=l=class extends h.JSONSupportMixin(b.ofType(e)){constructor(u){super(u)}clone(){return new l(this.items.map(u=>u.clone()))}write(u,x){return this.toJSON(x)}toJSON(u){const x=u?.layer?.spatialReference;return x?this.toArray().map(w=>{if(!x.equals(w.spatialReference)){if(!n.canProjectWithoutEngine(w.spatialReference,x))return u?.messages&&u.messages.push(new c("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,
spatialReference:u.layer.spatialReference,context:u})),null;const q=new e;n.projectPolygon(w,q,x);w=q}w=w.toJSON(u);delete w.spatialReference;return w}).filter(w=>null!=w):(u?.messages&&u.messages.push(new c("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:u.layer.spatialReference,context:u})),this.toArray().map(w=>w.toJSON(u)))}static fromJSON(u,x){const w=new l;u.forEach(q=>w.add(e.fromJSON(q,x)));return w}};return b=l=
a.__decorate([g.subclass("esri.layers.support.PolygonCollection")],b)})},"esri/support/elevationInfoUtils":function(){define(["exports","../symbols/support/unitConversionUtils"],function(a,b){function h(l,u){return u?.mode?u.mode:(l?e:n).mode}function c(l,u){return null!=u?u:l?e:n}function k(l,u){return h(null!=l?l.hasZ:!1,u)}function m(l){const u=d(l);return k(l.geometry,u)}function d(l){return l.layer&&"elevationInfo"in l.layer?l.layer.elevationInfo:null}function f(l,u,x,w,q,v,p=null){if(null!=
v){var t=null!=p?p.mode:"absolute-height";if("on-the-ground"===t)return 0;({absoluteZ:v}=g(u,x,w,q,l,v));a:{p=null!=p?.offset?p.offset:0;switch(t){case "absolute-height":l=v-p;break a;case "relative-to-ground":l=v-((l.elevationProvider.getElevation(u,x,w,q,"ground")??0)+p);break a;case "relative-to-scene":l=v-((l.elevationProvider.getElevation(u,x,w,q,"scene")??0)+p);break a}l=void 0}return l}}function g(l,u,x,w,q,v){const p=null!=v.offset?v.offset:0;switch(v.mode){case "absolute-height":return{absoluteZ:x+
p,elevation:0};case "on-the-ground":return x=q.elevationProvider.getElevation(l,u,0,w,"ground")??0,{absoluteZ:x,elevation:x};case "relative-to-ground":return l=q.elevationProvider.getElevation(l,u,x,w,"ground")??0,{absoluteZ:x+l+p,elevation:l};case "relative-to-scene":return l=q.elevationProvider.getElevation(l,u,x,w,"scene")??0,{absoluteZ:x+l+p,elevation:l}}}const e={mode:"absolute-height",offset:0},n={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=e;a.elevationContextAffectsAlignment=
function(l,u){if(null==u)return!1;({mode:u}=u);return null!=u&&("scene"===l&&"relative-to-scene"===u||"ground"===l&&"absolute-height"!==u)};a.elevationInfoLikeEquals=function(l,u){return l===u||null!=l&&null!=u&&l.mode===u.mode&&l.offset===u.offset};a.elevationModeRequiredMessage=function(l,u,x){return x&&x.mode!==u?`${l} only support ${u} elevation mode`:null};a.elevationModeUnsupportedMessage=function(l,u,x){return x?.mode===u?`${l} do not support ${u} elevation mode`:null};a.featureExpressionUnsupportedMessage=
function(l,u){return null!=u?.featureExpressionInfo&&"0"!==u.featureExpressionInfo.expression?`${l} do not support featureExpressionInfo`:null};a.getConvertedElevation=function(l,u,x,w=null){return f(l,u.x,u.y,u.hasZ?u.z:0,u.spatialReference,x,w)};a.getConvertedElevationFromVector=function(l,u,x,w,q=null){return f(l,u[0],u[1],2<u.length?u[2]:0,x,w,q)};a.getConvertedElevationFromXYZ=f;a.getEffectiveElevationInfo=c;a.getEffectiveElevationMode=h;a.getGeometryEffectiveElevationInfo=function(l,u){return c(null!=
l?!!l.hasZ:!1,u)};a.getGeometryEffectiveElevationMode=k;a.getGraphicEffectiveElevationInfo=function(l){var u=d(l);l=k(l.geometry,u);u=null!=u&&"on-the-ground"!==l?(u.offset??0)*b.getMetersPerUnit(u.unit??"meters"):0;return{mode:l,offset:u}};a.getGraphicEffectiveElevationMode=m;a.getZForElevationMode=function(l,u,x){if(x?.mode){var w=l.hasZ?l.z:0,q=null!=x.offset?x.offset:0;switch(x.mode){case "absolute-height":return w-q;case "on-the-ground":return 0;case "relative-to-ground":return l=(u.elevationProvider.getElevation(l.x,
l.y,w,l.spatialReference,"ground")??0)+q,w-l;case "relative-to-scene":return l=(u.elevationProvider.getElevation(l.x,l.y,w,l.spatialReference,"scene")??0)+q,w-l}}};a.hasGraphicFeatureExpressionInfo=function(l){if("on-the-ground"===m(l))return!1;l=d(l);l=l?.featureExpressionInfo?l.featureExpressionInfo.expression:null;return!(!l||"0"===l)};a.logInvalidElevationInfoWarning=function(l,u){u&&l.warn(".elevationInfo\x3d",u)};a.onTheGroundElevationInfo=n;a.zValueInAbsoluteHeightMode=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/support/zipUtils":function(){define(["require","exports"],function(a,b){async function h(c){const {BlobReader:k,ZipReader:m,BlobWriter:d}=await new Promise((g,e)=>a(["./zipjs-wrapper"],g,e)),f=[];c=new k(c);(await (new m(c)).getEntries()).forEach(g=>{if(!g.directory&&!/^__MACOS/i.test(g.filename)){var e=new d;(e=g.getData?.(e).then(n=>new File([n],g.filename)))&&f.push(e)}});return Promise.all(f)}b.extractZipFile=h;b.extractZipFiles=async function(c){const k=
[];for(const m of c)m.name.toLowerCase().endsWith(".zip")?k.push(h(m)):k.push(Promise.resolve(m));return(await Promise.all(k)).flat()};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../geometry ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../../../geometry/SpatialReference".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(X){return X?parseInt(X.substring(X.lastIndexOf("/")+1,X.length),10):void 0}function B(X,da){var ha=da[0],fa=da[1];da=da[3];const aa=X[0]-ha;ha-=X[2];const Z=X[1]-fa;X=fa-X[3];fa=Math.max(aa,ha,0);const ea=Math.max(Z,X,0);fa=fa*fa+ea*ea;return fa>da*da?a.MbsIntersectResult.OUTSIDE:0<fa?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(aa,ha,Z,X)>da?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}function F(X,
da,ha){const fa=[],aa=ha?.missingFields;ha=ha?.originalFields;for(const Z of X){X=Z.toLowerCase();let ea=!1;for(const ca of da)if(X===ca.name.toLowerCase()){fa.push(ca.name);ea=!0;ha&&ha.push(Z);break}!ea&&aa&&aa.push(Z)}return fa}function G(X,da,ha){const fa=new Map,aa=[];ha=ha();for(const ca of X){var Z=ca.attributes[da];for(var ea=0;ea<ha.length;ea++){X=ha[ea];const W=X.featureIds.indexOf(Z);if(0<=W){Z=fa.get(X.node);Z||(Z={node:X.node,indices:[],graphics:[]},aa.push(Z),fa.set(X.node,Z));Z.indices.push(W);
for(Z.graphics.push(ca);0<ea;ea--)ha[ea]=ha[ea-1];ha[0]=X;break}}}return aa}async function H(X,da,ha,fa,aa){da.sort((ca,W)=>ca.attributes[ha]-W.attributes[ha]);var Z=da.map(ca=>ca.attributes[ha]);const ea=[];fa=F(fa,X.fields,{originalFields:ea});X=await L(X,Z,fa,aa);for(aa=0;aa<da.length;aa++){Z=da[aa];const ca=X[aa],W={};if(Z.attributes)for(const Y in Z.attributes)W[Y]=Z.attributes[Y];for(let Y=0;Y<ea.length;Y++)W[ea[Y]]=ca[fa[Y]];Z.attributes=W}return da}function L(X,da,ha,fa){var aa=X.capabilities.query.maxRecordCount;
if(null!=aa&&da.length>aa)return aa=c.splitIntoChunks(da,aa),Promise.all(aa.map(Z=>L(X,Z,ha,fa))).then(Z=>Z.flat());aa=new v({objectIds:da,outFields:ha,orderByFields:[X.objectIdField]});return X.queryFeatures(aa,fa).then(Z=>{if(Z&&Z.features&&Z.features.length===da.length)return Z.features.map(ea=>ea.attributes);throw new k("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}async function C(X,da,ha,fa,aa,Z,ea,ca){const W=[];for(const Y of da)Y&&aa.includes(Y.name)&&
W.push({url:`${X}/nodes/${ha}/attributes/${Y.key}/0`,storageInfo:Y});X=await Promise.allSettled(W.map(Y=>h(Y.url,{responseType:"array-buffer",query:{...ea,token:Z},signal:ca?.signal}).then(ja=>p.readBinaryAttribute(Y.storageInfo,ja.data))));da=[];for(const Y of fa){fa={};for(ha=0;ha<X.length;ha++)aa=X[ha],"fulfilled"===aa.status&&(fa[W[ha].storageInfo.name]=z(aa.value,Y));da.push(fa)}return da}function z(X,da){if(!X)return null;da=X[da];return d.isInt16Array(X)?-32768===da?null:da:d.isInt32Array(X)?
da===V?null:da:da!==da?null:da}function J(X){var da=X.store,ha=da.indexCRS||da.geographicCRS;if(da=void 0===ha?da.indexWKT:void 0)if(X.spatialReference){if(da!==X.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new k("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",
{});ha=ha?new E(A(ha)):X.spatialReference;return ha.equals(X.spatialReference)?X.spatialReference:ha}function K(X){var da=X.store,ha=da.vertexCRS||da.projectedCRS;if(da=void 0===ha?da.vertexWKT:void 0)if(X.spatialReference){if(da!==X.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new k("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});ha=ha?new E(A(ha)):X.spatialReference;return ha.equals(X.spatialReference)?X.spatialReference:ha}function I(X,da,ha){if(!l.canProjectWithoutEngine(X,da))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===ha&&!M(X,da))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});}function M(X,da){return X.equals(da)||X.isWGS84&&da.isWebMercator||X.isWebMercator&&da.isWGS84}function S(X,da,ha){const fa=J(X);X=K(X);I(fa,da,ha);I(X,da,ha)}const N=w.create();a.MbsIntersectResult=void 0;(function(X){X[X.OUTSIDE=0]="OUTSIDE";X[X.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";X[X.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";X[X.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const V=-(2**31);b=r.createSolidEdgeMaterial({color:[0,0,0,
0],opacity:0});class Q{constructor(){this.material=this.edgeMaterial=null;this.castShadows=!0}}const T=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],ia=w.create(),O=w.create(),U=new D.Obb,P=n.create(),R={data:Array(72),size:3,exclusive:!0,stride:3},ba=g.create();a.SymbolInfo=Q;a.addWraparound=function(X,da){return(X|0)+(da|0)|0};a.checkPointCloudLayerCompatibleWithView=function(X,da){I(X.spatialReference,da.spatialReference,da.viewingMode)};a.checkPointCloudLayerValid=
function(X){var da;(da=null==X.store?.defaultGeometrySchema)||(X=X.store.defaultGeometrySchema,da=!!(null==X.geometryType||"points"!==X.geometryType||null!=X.topology&&"PerAttributeArray"!==X.topology||null!=X.encoding&&""!==X.encoding&&"lepcc-xyz"!==X.encoding||null==X.vertexAttributes?.position));if(da)throw new k("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(X,da,ha){if(X.serviceUpdateTimeStamp?.lastUpdate!==
da.serviceUpdateTimeStamp?.lastUpdate||!ha.isEmpty||X.associatedLayer?.url!==da.associatedLayer?.url)throw new k("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=function(X,da){S(X,da.spatialReference,da.viewingMode)};a.checkSceneLayerValid=function(X){var da;(da=null==X.store?.defaultGeometrySchema)||(da=X.store.defaultGeometrySchema,da=!!(null!=da.geometryType&&"triangles"!==da.geometryType||null!=da.topology&&"PerAttributeArray"!==da.topology||null==da.vertexAttributes?.position));
if(da)throw new k("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:X.parsedUrl.path});};a.checkSpatialReference=I;a.checkSpatialReferences=S;a.computeVisibilityObb=function(X,da,ha,fa,aa,Z,ea){if(!Z||0===Z.length||null==da||!X.serviceMbsInIndexSR)return null;const ca=t.computeGlobalTransformation(X.serviceMbsInIndexSR,aa,ha,da);f.invert(ba,ca);let W=null;const Y=()=>{if(!W)if(W=T,w.empty(O),null!=X.serviceObbInIndexSR){X.serviceObbInIndexSR.transform(U,
ha,da,aa,ea);U.getCorners(W);for(var ta of W)e.transformMat4(ta,ta,ba),w.expandPointInPlace(O,ta)}else{var ya=X.serviceMbsInIndexSR;if(ya)for(ta=ya[3],x.projectVectorToVector(q.getCenter(ya),ha,P,da),e.transformMat4(P,P,ba),P[2]+=aa,ya=0;8>ya;++ya){const Ca=W[ya];e.copy(Ca,[P[0]+(ya&1?ta:-ta),P[1]+(ya&2?ta:-ta),P[2]+(ya&4?ta:-ta)]);w.expandPointInPlace(O,Ca)}}};let ja=Infinity,oa=-Infinity;const ra=ta=>{if("replace"===ta.type&&(ta=ta.geometry,ta?.hasZ)){w.empty(ia);var ya=ta.spatialReference||fa;
ta=ta.rings.reduce((Ca,pa)=>pa.reduce((wa,Ba)=>{e.set(P,Ba[0],Ba[1],Ba[2]);x.projectVectorToVector(P,ya,P,da);e.transformMat4(P,P,ba);w.expandPointInPlace(ia,P);return Math.min(P[2],wa)},Ca),Infinity);Y();w.intersects(O,ia)&&(ja=Math.min(ja,ta),oa=Math.max(oa,ta))}};Z.forEach(ta=>ra(ta));if(Infinity===ja)return null;Z=(ta,ya,Ca)=>{e.transformMat4(P,Ca,ca);ta[ya]=P[0];ta[ya+1]=P[1];ta[ya+2]=P[2];ya+=24;Ca[2]=ja;e.transformMat4(P,Ca,ca);ta[ya]=P[0];ta[ya+1]=P[1];ta[ya+2]=P[2];ya+=24;Ca[2]=oa;e.transformMat4(P,
Ca,ca);ta[ya]=P[0];ta[ya+1]=P[1];ta[ya+2]=P[2]};for(let ta=0;8>ta;++ta)Z(R.data,3*ta,W[ta]);return D.compute(R)};a.containsDraco=function(X){if(m("disable-feature:i3s-draco")||!X)return!1;for(const da of X)for(const ha of da.geometryBuffers)if("draco"===ha.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=A;a.filterInPlace=function(X,da,ha){let fa=0,aa=0;for(let Z=0;Z<da.length&&fa<X.length;Z++)X[fa]===da[Z]&&(ha(Z)&&(X[aa]=X[fa],aa++),fa++);X.length=aa};a.findFieldsCaseInsensitive=
F;a.findIntersectingNodes=function(X,da,ha,fa){ha.traverse(da,aa=>{const Z=aa.serviceMbsInIndexSR;if((null!=Z&&B(X,Z))===a.MbsIntersectResult.OUTSIDE)return!1;fa(aa);return!0})};a.getCacheKeySuffix=function(X,da){return null==da?"@null":da===u.getSphericalPCPF(da)?"@ECEF":X.equals(da)?"":null!=da.wkid?"@"+da.wkid:null};a.getCachedAttributeValue=z;a.getClipRect=function(X,da){if(0===da.rotationScale[1]&&0===da.rotationScale[2]&&0===da.rotationScale[3]&&0===da.rotationScale[5]&&0===da.rotationScale[6]&&
0===da.rotationScale[7])return N[0]=(X[0]-da.position[0])/da.rotationScale[0],N[1]=(X[1]-da.position[1])/da.rotationScale[4],N[2]=(X[2]-da.position[0])/da.rotationScale[0],N[3]=(X[3]-da.position[1])/da.rotationScale[4],N};a.getIndexCrs=J;a.getSymbolInfo=function(X){const da=new Q;var ha=!1;let fa=!1;for(const Z of X.symbolLayers.items)if("fill"===Z.type&&Z.enabled){var aa=Z.material;X=Z.edges;null==aa||ha||(ha=aa.color,aa=y.parseColorMixMode(aa.colorMixMode),da.material=null!=ha?{color:[ha.r/255,
ha.g/255,ha.b/255],alpha:ha.a,colorMixMode:aa}:{color:[1,1,1],alpha:1,colorMixMode:y.ColorMixModeEnum.Multiply},da.castShadows=Z.castShadows,ha=!0);null==X||fa||(da.edgeMaterial=r.createMaterialFromEdges(X,{}),fa=!0)}da.material||(da.material={color:[1,1,1],alpha:1,colorMixMode:y.ColorMixModeEnum.Multiply});return da};a.getVertexCrs=K;a.intersectBoundingRectWithMbs=B;a.invalidateMbs=function(X){null!=X&&(X[3]=-1)};a.invalidateObb=function(X){null!=X&&(X.halfSize=D.INVALID_HALFSIZE)};a.isSupportedLocalModeProjection=
M;a.isValidMbs=function(X){return 0<=X[3]};a.isValidObb=function(X){return null!=X&&0<=X.halfSizeX};a.objectIdFilter=function(X,da,ha){let fa=0,aa=0;for(;fa<ha.length;)0<=c.binaryIndexOf(X,ha[fa])===da&&(ha[aa]=ha[fa],aa++),fa++;ha.length=aa};a.queryAttributesFromCachedAttributesId=C;a.rendererNeedsTextures=function(X){if(null==X||"simple"!==X.type&&"class-breaks"!==X.type&&"unique-value"!==X.type||("unique-value"===X.type||"class-breaks"===X.type)&&null==X.defaultSymbol)return!0;X=X.getSymbols();
if(0===X.length)return!0;for(const da of X){if("mesh-3d"!==da.type||0===da.symbolLayers.length)return!0;for(const ha of da.symbolLayers.items)if("fill"!==ha.type||null==ha.material?.color||"replace"!==ha.material.colorMixMode)return!0}return!1};a.transparentEdgeMaterial=b;a.whenGraphicAttributes=async function(X,da,ha,fa,aa,Z){if(0===da.length)return[];const ea=X.attributeStorageInfo;if(null!=X.associatedLayer)try{return await H(X.associatedLayer,da,ha,fa,Z)}catch(ca){if(X.associatedLayer.loaded)throw ca;
}if(ea){da=G(da,ha,aa);if(null==da)throw new k("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const ca=X.parsedUrl.path;return(await Promise.all(da.map(W=>C(ca,ea,W.node.resources.attributes,W.indices,fa,X.apiKey,X.customParameters,Z).then(Y=>{for(let ja=0;ja<W.graphics.length;ja++){const oa=W.graphics[ja],ra=Y[ja];if(oa.attributes)for(const ta in oa.attributes)ta in ra||(ra[ta]=oa.attributes[ta]);oa.attributes=ra}return W.graphics})))).flat()}throw new k("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,h,c,k,m){function d(E,A){const B={byteOffset:0,byteCount:0,fields:Object.create(null)};let F=0;for(let G=0;G<A.length;G++){const H=A[G],L=H.valueType||H.type;
B.fields[H.property]=(0,D[L])(E,F);F+=y[L].BYTES_PER_ELEMENT}B.byteCount=F;return B}function f(E,A,B){return g(E,A,B).map(F=>(F=F?Date.parse(F):null)&&!Number.isNaN(F)?F:null)}function g(E,A,B){const F=[];let G,H=0,L;for(L=0;L<E;L+=1){G=A[L];if(0<G){var C=F,z=C.push,J=B,K=H,I=G-1;let S="",N=0;for(;N<I;){var M=J[K+N];if(128>M)S+=String.fromCharCode(M),N++;else if(192<=M&&224>M){if(N+1>=I)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");S+=String.fromCharCode((M&
31)<<6|J[K+N+1]&63);N+=2}else if(224<=M&&240>M){if(N+2>=I)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");S+=String.fromCharCode((M&15)<<12|(J[K+N+1]&63)<<6|J[K+N+2]&63);N+=3}else if(240<=M&&248>M){if(N+3>=I)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");M=(M&7)<<18|(J[K+N+1]&63)<<12|(J[K+N+2]&63)<<6|J[K+N+3]&63;S=65536<=M?S+String.fromCharCode((M-65536>>10)+55296,(M&1023)+56320):S+String.fromCharCode(M);N+=4}else throw new b("utf8-decode-error",
"UTF-8 Decode failed. Invalid multi byte sequence.");}z.call(C,S);if(0!==B[H+G-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else F.push(null);H+=G}return F}function e(E,A){return new y[A.valueType](E,A.byteOffset,A.count*A.valuesPerElement)}function n(E,A){return new Uint8Array(E,A.byteOffset,A.byteCount)}function l(E,A,B){E=null!=A.header?d(E,A.header):{byteOffset:0,byteCount:0,fields:{count:B}};B={header:E,byteOffset:E.byteCount,byteCount:0,entries:Object.create(null)};
let F=E.byteCount;for(let G=0;G<A.ordering.length;G++){const H=A.ordering[G],L=h.clone(A[H]);L.count=E.fields.count??0;if("String"===L.valueType){L.byteOffset=F;L.byteCount=E.fields[H+"ByteCount"];if("UTF-8"!==L.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:L.encoding});if(L.timeEncoding&&"ECMA_ISO8601"!==L.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:L.timeEncoding});}else if(v(L.valueType)){const C=p(L.valueType);
F+=0!==F%C?C-F%C:0;L.byteOffset=F;L.byteCount=C*L.valuesPerElement*L.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:L.valueType});F+=L.byteCount??0;B.entries[H]=L}B.byteCount=F-B.byteOffset;return B}function u(E,A,B){A!==E&&t().error(`Invalid ${B} buffer size\n expected: ${E}, actual: ${A})`);if(A<E)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:E,actualSize:A});}function x(E){return{isDraco:!1,isLegacy:!1,color:null!=E.color,normal:null!=
E.normal,uv0:null!=E.uv0,uvRegion:null!=E.uvRegion,featureIndex:null!=E.faceRange&&null!=E.featureId}}function w(E){const A={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of E.ordering)if(E.vertexAttributes[B])switch(B){case "normal":A.normal=!0;break;case "color":A.color=!0;break;case "uv0":A.uv0=!0;break;case "region":A.uvRegion=!0}E.featureAttributes&&E.featureAttributeOrder&&(A.featureIndex=!0);return A}function q(E){const A={isDraco:!0,isLegacy:!1,
color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of E)switch(B){case "normal":A.normal=!0;break;case "uv0":A.uv0=!0;break;case "color":A.color=!0;break;case "uv-region":A.uvRegion=!0;break;case "feature-index":A.featureIndex=!0}return A}function v(E){return y.hasOwnProperty(E)}function p(E){return v(E)?y[E].BYTES_PER_ELEMENT:0}const t=()=>c.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),r={position:m.VertexAttribute.POSITION,normal:m.VertexAttribute.NORMAL,color:m.VertexAttribute.COLOR,
uv0:m.VertexAttribute.UV0,region:m.VertexAttribute.UVREGION},y={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},D={Float32:(E,A)=>(new DataView(E,0)).getFloat32(A,!0),Float64:(E,A)=>(new DataView(E,0)).getFloat64(A,!0),UInt8:(E,A)=>(new DataView(E,0)).getUint8(A),Int8:(E,A)=>(new DataView(E,0)).getInt8(A),UInt16:(E,A)=>(new DataView(E,0)).getUint16(A,!0),Int16:(E,A)=>(new DataView(E,0)).getInt16(A,!0),
UInt32:(E,A)=>(new DataView(E,0)).getUint32(A,!0),Int32:(E,A)=>(new DataView(E,0)).getInt32(A,!0)};a.createAttributeDataIndex=l;a.createGeometryDescriptor=function(E,A){return E&&E.compressedAttributes&&"draco"===E.compressedAttributes.encoding?q(E.compressedAttributes.attributes):E?x(E):w(A)};a.createGeometryDescriptorForDraco=q;a.createGeometryDescriptorFromDefinition=x;a.createGeometryDescriptorFromSchema=w;a.createGeometryIndexFromSchema=function(E,A){var B=d(E,A&&A.header);let F=B.byteCount;
const G={isDraco:!1,header:B,byteOffset:B.byteCount,byteCount:0,vertexAttributes:{}};B=B.fields;var H=null!=B.vertexCount?B.vertexCount:B.count;for(var L of A.ordering){if(!A.vertexAttributes[L])continue;const z={...A.vertexAttributes[L],byteOffset:F,count:H};G.vertexAttributes[r[L]||"_"+L]=z;F+=p(z.valueType)*z.valuesPerElement*H}L=B.faceCount;if(A.faces&&L){G.faces={};for(var C of A.ordering)A.faces[C]&&(H={...A.faces[C],byteOffset:F,count:L},G.faces[C]=H,F+=p(H.valueType)*H.valuesPerElement*L)}C=
B.featureCount;if(A.featureAttributes&&A.featureAttributeOrder&&C){G.featureAttributes={};for(const z of A.featureAttributeOrder)A.featureAttributes[z]&&(B={...A.featureAttributes[z],byteOffset:F,count:C},G.featureAttributes[z]=B,L="UInt64"===B.valueType?8:p(B.valueType),F+=L*B.valuesPerElement*C)}u(F,E.byteLength,"geometry");G.byteCount=F-G.byteOffset;return G};a.createRawView=n;a.createTypedView=e;a.getBytesPerValue=p;a.isValueType=v;a.readBinaryAttribute=function(E,A,B){if("lepcc-rgb"===E.encoding)return k.decodeRGB(A);
if("lepcc-intensity"===E.encoding)return k.decodeIntensity(A);if(null!=E.encoding&&""!==E.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");E["attributeByteCounts "]&&!E.attributeByteCounts&&(t().warn("Warning: Trailing space in 'attributeByteCounts '."),E.attributeByteCounts=E["attributeByteCounts "]);"ObjectIds"===E.ordering[0]&&E.hasOwnProperty("objectIds")&&(t().warn("Warning: Case error in objectIds"),E.ordering[0]="objectIds");B=l(A,E,
B);u(B.byteOffset+B.byteCount,A.byteLength,"attribute");if(E=B.entries.attributeValues||B.entries.objectIds){if("String"===E.valueType){B=B.entries.attributeByteCounts;const F=e(A,B);A=n(A,E);return E.timeEncoding?f(B.count,F,A):g(B.count,F,A)}return e(A,E)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=f;a.readHeader=d;a.readStringArray=g;a.valueType2ArrayBufferReader=D;a.valueType2TypedArrayClassMap=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function h(d,f,g){return{identifier:String.fromCharCode.apply(null,new Uint8Array(d,g+m.identifierOffset,m.identifierLength)),version:f.getUint16(g+m.versionOffset,!0),checksum:f.getUint32(g+m.checksumOffset,!0)}}function c(d,f,g){const e=[];f=k(d,f,e);const n=[];for(let l=0;l<e.length;l++){n.length=0;f=k(d,f,n);for(let u=0;u<n.length;u++)g.push(n[u]+e[l])}return f}function k(d,
f,g){var e=new DataView(d,f),n=e.getUint8(0);const l=n&31;var u=!!(n&32),x=(n&192)>>6;n=0;if(0===x)n=e.getUint32(1,!0),f+=5;else if(1===x)n=e.getUint16(1,!0),f+=3;else if(2===x)n=e.getUint8(1),f+=2;else throw new b("lepcc-decode-error","Bad count type");if(u)throw new b("lepcc-decode-error","LUT not implemented");d=new Uint8Array(d,f,Math.ceil(n*l/8));x=u=e=0;const w=-1>>>32-l;for(let q=0;q<n;q++){for(;u<l;)e|=d[x]<<u,u+=8,x+=1;g[q]=e&w;e>>>=l;u-=l;32<u+l&&(e|=d[x-1]>>8-u)}return f+x}const m={identifierOffset:0,
identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(d){const f=new DataView(d,0);var g=0;const {identifier:e,version:n}=h(d,f,g);g+=m.byteCount;if("Intensity "!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<n)throw new b("lepcc-decode-error","Unknown version");var l=g;var u=f.getUint32(l+0,!0);var x=f.getUint32(l+4,!0);var w=f.getUint32(l+8,!0);var q=f.getUint16(l+12,!0);var v=f.getUint8(l+14);f.getUint8(l+15);g+=16;if(x*2**32+u!==d.byteLength)throw new b("lepcc-decode-error",
"Bad size");u=new Uint16Array(w);if(8===v){if(w+g!==d.byteLength)throw new b("lepcc-decode-error","Bad size");d=new Uint8Array(d,g,w);for(g=0;g<w;g++)u[g]=d[g]*q}else if(16===v){if(2*w+g!==d.byteLength)throw new b("lepcc-decode-error","Bad size");d=new Uint16Array(d,g,w);for(g=0;g<w;g++)u[g]=d[g]*q}else{v=[];if(k(d,g,v)!==d.byteLength)throw new b("lepcc-decode-error","Bad size");for(d=0;d<w;d++)u[d]=v[d]*q}return u};a.decodeRGB=function(d){var f=new DataView(d,0),g=0;const {identifier:e,version:n}=
h(d,f,g);g+=m.byteCount;if("ClusterRGB"!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<n)throw new b("lepcc-decode-error","Unknown version");var l=g;var u=f.getUint32(l+0,!0);var x=f.getUint32(l+4,!0);var w=f.getUint32(l+8,!0);var q=f.getUint16(l+12,!0);var v=f.getUint8(l+14);l=f.getUint8(l+15);g+=16;if(x*2**32+u!==d.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===v||1===v)&&0===l){if(3*q+w+g!==d.byteLength||256<q)throw new b("lepcc-decode-error","Bad count");f=new Uint8Array(d,
g,3*q);g=new Uint8Array(d,g+3*q,w);d=new Uint8Array(3*w);for(q=0;q<w;q++)u=g[q],d[3*q]=f[3*u],d[3*q+1]=f[3*u+1],d[3*q+2]=f[3*u+2];return d}if(0===v&&0===l){if(3*w+g!==d.byteLength||0!==q)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(d,g)).slice()}if(2>=v&&1===l){if(g+3!==d.byteLength||1!==q)throw new b("lepcc-decode-error","Bad count");d=f.getUint8(g);q=f.getUint8(g+1);g=f.getUint8(g+2);f=new Uint8Array(3*w);for(u=0;u<w;u++)f[3*u]=d,f[3*u+1]=q,f[3*u+2]=g;return f}throw new b("lepcc-decode-error",
"Bad method "+v+","+l);};a.decodeXYZ=function(d){var f=new DataView(d,0),g=0;const {identifier:e,version:n}=h(d,f,g);g+=m.byteCount;if("LEPCC     "!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<n)throw new b("lepcc-decode-error","Unknown version");var l=g;var u=f.getUint32(l+0,!0);var x=f.getUint32(l+4,!0);var w=f.getFloat64(l+8,!0);var q=f.getFloat64(l+16,!0);var v=f.getFloat64(l+24,!0);var p=f.getFloat64(l+32,!0);var t=f.getFloat64(l+40,!0);var r=f.getFloat64(l+48,!0);var y=f.getFloat64(l+
56,!0);var D=f.getFloat64(l+64,!0);var E=f.getFloat64(l+72,!0);var A=f.getUint32(l+80,!0);f.getUint32(l+84,!0);g+=88;if(x*2**32+u!==d.byteLength)throw new b("lepcc-decode-error","Bad size");u=new Float64Array(3*A);x=[];A=[];f=[];l=[];g=c(d,g,x);g=c(d,g,A);g=c(d,g,f);g=c(d,g,l);if(g!==d.byteLength)throw new b("lepcc-decode-error","Bad length");g=d=0;for(let B=0;B<x.length;B++){g+=x[B];let F=0;for(let G=0;G<A[B];G++){F+=f[d];const H=l[d];u[3*d]=Math.min(p,w+2*y*F);u[3*d+1]=Math.min(t,q+2*D*g);u[3*d+
2]=Math.min(r,v+2*E*H);d++}}return{errorX:y,errorY:D,errorZ:E,result:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/computeTranslationToOriginAndRotation"],function(a,b,h,c,k){function m(d,f,g){const e=h.create(),n=2**(4*Math.ceil(Math.log(d[3])*
Math.LOG2E/4)+1);if(g.isGeographic){var l=n/c.getReferenceEllipsoid(g).radius*180/Math.PI;g=Math.max(-90,Math.min(90,Math.round(d[1]/l)*l));l/=Math.cos((Math.abs(g)-l/2)/180*Math.PI);e[0]=Math.round(d[0]/l)*l;e[1]=g}else g=Math.round(d[1]/n),e[0]=Math.round(d[0]/n)*n,e[1]=g*n;e[2]=Math.round((d[2]+f)/n)*n;return e}a.computeGlobalTransformation=function(d,f,g,e){d=m(d,f,g);f=b.create();k.computeTranslationToOriginAndRotation(g,d,f,e);return f};a.getLocalOrigin=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(a,b){function h(c,k){return c.popupTemplate?c.popupTemplate:null!=k&&k.defaultPopupTemplateEnabled&&null!=c.defaultPopupTemplate?c.defaultPopupTemplate:null}a.getFetchPopupTemplate=h;a.getRequiredFields=async function(c,k=c.popupTemplate){if(null==k)return[];const m=await k.getRequiredFields(c.fieldsIndex);({lastEditInfoEnabled:k}=k);const {objectIdField:d,typeIdField:f,
globalIdField:g,relationships:e}=c;if(m.includes("*"))return["*"];k=k?b.getFeatureEditFields(c):[];const n=b.fixFields(c.fieldsIndex,[...m,...k]);f&&n.push(f);n&&d&&c.fieldsIndex?.has(d)&&!n.includes(d)&&n.push(d);n&&g&&c.fieldsIndex?.has(g)&&!n.includes(g)&&n.push(g);e&&e.forEach(l=>{({keyField:l}=l);n&&l&&c.fieldsIndex?.has(l)&&!n.includes(l)&&n.push(l)});return n};a.hasPopupTemplate=function(c,k){return null!=h(c,{defaultPopupTemplateEnabled:k})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),function(a,b,h,c,k,m,d,f,g,e){c=class extends g.TiledLayerView3D(f.LayerView3D(e)){constructor(){super(...arguments);this.type="elevation-3d"}get tileInfo(){return this.layer.tileInfo}initialize(){var n=
this.view?.map?.allLayers;n=n&&n.includes(this.layer);var l=this.view?.map?.ground?.layers;l=l&&l.includes(this.layer);n&&!l&&(n=new b("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(n)));this._addTilingSchemeMatchPromise()}};a.__decorate([h.property()],c.prototype,"layer",void 0);a.__decorate([h.property()],c.prototype,"tileInfo",null);return c=a.__decorate([d.subclass("esri.views.3d.layers.ElevationLayerView3D")],
c)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){a.LayerView3D=l=>{l=class extends l{constructor(){super(...arguments);this.supportsHeightUnitConversion=
this.slicePlaneEnabled=!1}postscript(u){super.postscript(u);n.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const u=new AbortController;var x=u.signal;this.addHandles(h.makeHandle(()=>u.abort()));await k.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,x);c.throwIfAborted(x);if(x=n.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw x;}canResume(){const u=this.layer&&
"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!u?.minScale||!u.maxScale||u.minScale>=u.maxScale)}getSuspendInfo(){const u=super.getSuspendInfo(),x=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;x&&x.minScale&&x.maxScale&&x.minScale<x.maxScale&&(u.outsideScaleRange=!0);return u}};b.__decorate([m.property()],l.prototype,"view",void 0);b.__decorate([m.property()],l.prototype,"slicePlaneEnabled",void 0);return l=b.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],
l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./support/LayerViewPerformanceInfo ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e,
n,l){a.TiledLayerView3D=u=>{u=class extends u{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}get dataScaleRange(){var x=this.tileInfo.lods;let w=x[0].scale;x=x[x.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:q,effectiveMaxLOD:v}=this.layer.tilemapCache;w=this.tileInfo.lodAt(q).scale;x=this.tileInfo.lodAt(v).scale}return{minScale:w,maxScale:x}}get dataLevelRange(){const {minScale:x,
maxScale:w}=this.dataScaleRange;return this.levelRangeFromScaleRange(x,w)}get displayLevelRange(){const x=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&x.maxLevel++;return x}get performanceInfo(){return new e.LayerViewPerformanceInfo(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(x,w,q){return this.layer.getTileUrl(x,w,q)}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new h("tilingscheme:extent-not-defined",
"This layer doesn't define a fullExtent.")));var x=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(x)return this.addResolvingPromise(Promise.reject(x));x=c.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const w=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(w)throw w;});this.addResolvingPromise(x)}_getTileInfoSupportError(x,w){if(x=l.checkIfTileInfoSupportedForView(x,w,this.view.spatialReference,this.view.state.viewingMode)){w=
{layer:this.layer,error:x};switch(x.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":x=new h("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",w);break;default:x=new h("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",w)}return x}return null}_getTileInfoCompatibilityError(x,
w){return null!=x&&w.compatibleWith(x)?null:new h("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(x,w){const q={minLevel:0,maxLevel:Infinity};var v=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!v)return q;const p=v.levels[0];v=t=>{t=Math.log(p.scale/t)/Math.LN2;return 1E-9>.5-Math.abs(.5-t%1)?Math.round(t):Math.ceil(t)};null!=x&&0<x&&(q.minLevel=Math.max(0,v(x)));
null!=w&&0<w&&(q.maxLevel=Math.max(0,v(w)));return q}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};b.__decorate([k.property({readOnly:!0})],u.prototype,"imageFormatIsOpaque",null);b.__decorate([k.property({readOnly:!0})],u.prototype,"updating",void 0);b.__decorate([k.property(n.updatingProgress)],u.prototype,"updatingProgress",void 0);b.__decorate([k.property(n.updatingProgressValue)],u.prototype,"updatingProgressValue",void 0);b.__decorate([k.property()],
u.prototype,"fullExtent",null);b.__decorate([k.property({readOnly:!0})],u.prototype,"isOpaque",null);b.__decorate([k.property()],u.prototype,"dataScaleRange",null);b.__decorate([k.property({readOnly:!0})],u.prototype,"dataLevelRange",null);b.__decorate([k.property({readOnly:!0})],u.prototype,"displayLevelRange",null);b.__decorate([k.property()],u.prototype,"layer",void 0);return u=b.__decorate([g.subclass("esri.views.3d.layers.TiledLayerView3D")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){c=class extends n{constructor(){super(...arguments);this.type="feature-3d";
this.direct3DObjectFeatureLayerDisplayEnabled=e.direct3DObjectFeatureLayerDisplayEnabled()}initialize(){const {layer:l,view:u}=this;g.getEffectiveLayerCapabilities(l)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new b("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:l})));null!=l.infoFor3D&&(this.direct3DObjectFeatureLayerDisplayEnabled?this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",
`Unsupported geometry type ${l.geometryType}`))));"mesh"!==l.geometryType||f.canProjectWithoutEngine(l.spatialReference,u.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))}get featureSpatialReference(){return this.view.featureTiles?.tilingScheme?.spatialReference}};a.__decorate([h.property({constructOnly:!0})],c.prototype,"direct3DObjectFeatureLayerDisplayEnabled",
void 0);a.__decorate([h.property()],c.prototype,"layer",void 0);return c=a.__decorate([d.subclass("esri.views.3d.layers.FeatureLayerView3D")],c)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLayerViewPerformanceInfo ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){m=class extends D(x.FeatureLikeLayerView3D(r(w.LayerView3D(y)))){constructor(A){super(A);this._processorTotal=this._controllerTotal=0;this.suspendResumeExtentMode="data"}initialize(){this.addHandles(c.watch(()=>this._updatingRequiredFieldsPromise,A=>this._updatingHandles.addPromise(A),c.syncAndInitial))}destroy(){this._updatingHandles.removeAll();this._fetcherContext=h.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.controller?.maximumNumberOfFeatures??
this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(A){this._set("maximumNumberOfFeatures",A);this.controller&&(this.controller.maximumNumberOfFeatures=A)}get maximumNumberOfFeaturesExceeded(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}get updatingProgressValue(){let A=0;if(this.controller?.updating){var B=this.controller.updatingRemaining,F=Math.max(this.controller.updatingTotal,this._controllerTotal);0<F&&(A=(F-B)/F,this._controllerTotal=
F)}B=0;if(this.processor?.updating){F=this.processor.updatingRemaining;const G=Math.max(F,this._processorTotal);0<G&&(B=(G-F)/G,this._processorTotal=G)}return.5*(A+B)}get updatePolicy(){if(!this.controller)return t.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const A=E.get(this.layer.geometryType);return null==A||this.controller.serviceDataCount>A?t.UpdatePolicy.ASYNC:t.UpdatePolicy.SYNC;case "tiles":return t.UpdatePolicy.ASYNC}}get hasZ(){const A=this.layer,B=A.capabilities&&A.capabilities.data;
return B&&B.supportsZ?"returnZ"in A&&null!=A.returnZ?A.returnZ:B.supportsZ:!1}get hasM(){const A=this.layer,B=A.capabilities&&A.capabilities.data;return B&&B.supportsM?"returnM"in A&&null!=A.returnM?A.returnM:!1:!1}setVisibility(A,B){this.processor?.setObjectIdVisibility(A,B)}createQuery(){return super.createQuery()}queryFeatures(A,B){const F=()=>super.queryFeatures(A,B);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(A),F):F()}beforeSetController(A){A.maximumNumberOfFeatures=
this.maximumNumberOfFeatures}createController(){this._fetcherContext=new q.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const A=new l.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new v.EventedSet,extent:this.clippingExtent});this._updatingHandles.add(()=>A.serviceDataExtent,B=>{this.processor&&(this.processor.dataExtent=B)},c.initial);this.addHandles(c.watch(()=>this.suspended,B=>{B?A.suspend():A.resume()},c.syncAndInitial));
this._updatingHandles.add(()=>this.processor?.displayFeatureLimit,B=>A.displayFeatureLimit=B,c.initial);this.addHandles(c.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return A}async doRefresh(A){A&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()}_popupFeatureHasRequiredFields(A,B){if(!super._popupFeatureHasRequiredFields(A,B))return!1;A=e.getObjectId(A,this.layer.objectIdField);if(null==A)return!0;A=this.controller.getMissingAttributesForFeature(A);
if(null==A)return!0;for(const F of B)if(A.has(F))return!1;return!0}get usedMemory(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}get unloadedMemory(){const A=this.controller?.expectedFeatureDiff??0,B=this.processor?.loadedFeatures??0;return(this.processor?.unprocessedMemoryEstimate??0)+A*(this.processor?.usedMemoryPerFeature??0)*(0<B+A?B/(B+A):1)}get ignoresMemoryFactor(){return this.controller?.hasMaximumNumberOfFeaturesOverride}async _queryFeaturesMesh(A,B){await this._validateQueryFeaturesMesh(A);
B=await B();if(A?.outStatistics||null==this.graphics3DProcessor)return B;A=this.layer.objectIdField;const F=this.graphics3DProcessor.graphics3DGraphicsByObjectID,G=[];for(const H of B.features)if(H.geometry){const L=F.get(H.attributes[A]);L&&(H.geometry=n.hydrateGeometry(L.graphic.geometry),G.push(H))}else G.push(H);B.features=G;return B}async _validateQueryFeaturesMesh(A){if(A){var B=G=>{throw new b("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${G}'`);
},F=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const G of F)null!=A[G]&&B(G);"returnM"in A&&A.returnM&&B("returnM");"returnCentroid"in A&&A.returnCentroid&&B("returnCentroid");null==A.outSpatialReference||A.outSpatialReference.equals(this.view.spatialReference)||B("outSpatialReference")}}get performanceInfo(){var A=this.controller?.displayFeatureLimit;A=null!=A?A.averageSymbolComplexity:void 0;return new u.FeatureLayerViewPerformanceInfo(super.performanceInfo,this.controller?.performanceInfo?.storedFeatures??
0,this.controller?.performanceInfo?.totalVertices??0,this.maximumNumberOfFeaturesExceeded,this.controller?.mode??"n/a",null!=A?`f:${A.verticesPerFeature},v:${A.verticesPerCoordinate}`:"n/a")}get test(){return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:this.controller?.graphics,...this.getTest()}}};a.__decorate([k.property()],m.prototype,"layer",void 0);a.__decorate([k.property()],m.prototype,"controller",void 0);a.__decorate([k.property()],m.prototype,"_controllerTotal",
void 0);a.__decorate([k.property()],m.prototype,"_processorTotal",void 0);a.__decorate([k.property()],m.prototype,"maximumNumberOfFeatures",null);a.__decorate([k.property()],m.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([k.property(p.updatingProgress)],m.prototype,"updatingProgress",void 0);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatePolicy",null);a.__decorate([k.property({readOnly:!0})],
m.prototype,"hasZ",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"hasM",null);a.__decorate([k.property()],m.prototype,"suspendResumeExtentMode",void 0);m=a.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],m);const E=new Map([["point",5E3],["polygon",500],["polyline",1E3]]);return m})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){function A(B,F){if(!F)return!1;for(const G of F)if(!B.has(G))return!0;return!1}a.FeatureTileController3D=class extends n.EsriPromiseMixin(h){get dataUpdating(){return this._tileFetcher?.dataUpdating??!1}set extent(B){if(null==B||B.spatialReference.equals(this.layerView.view.spatialReference)){var F=this._get("extent");F===B||null!=F&&B&&F.equals(B)||(B=null!=B?B.clone():null,this._set("extent",B))}else g.getLogger(this).error("#extent\x3d","extent needs to be in the same spatial reference as the view")}get updating(){return!!(null!=
this._tileFetcher&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._updatingHandles&&this._updatingHandles.updating)}get updatingTotal(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&null!=this._tileFetcher?
this._tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return this.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(B){B!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",B)}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get hasAllFeatures(){return this.serviceDataCount===
a.FeatureTileController3DConstants.noServiceDataCount&&"snapshot"===this.mode&&this.hasAllFeaturesInView||this.serviceDataCount===this.graphics.length}get hasAllFeaturesInView(){return this._tileFetcher?.hasAllFeatures??!1}get hasFullGeometries(){return this._tileFetcher?.hasFullGeometries??!1}get mode(){var B=this.layerView.layer;if("feature"===B.type&&null!=B.infoFor3D)return"snapshot";if(this._forceTilesMode)return"tiles";var F=this.layerView.view;if(!1===F.qualitySettings?.graphics3D?.snapshotAvailable||
this.serviceDataCount===a.FeatureTileController3DConstants.noServiceDataCount||this._snapshotLimitExceeded||this.maximumNumberOfFeaturesExceeded||1>F.quality)return"tiles";F=(F=F&&F.featureTiles)&&F.tilingScheme;return B&&B.minScale&&this.serviceDataExtent&&F&&(B=this._approximateExtentSizeAtScale(B.minScale,F),(this.serviceDataExtent.width/B+this.serviceDataExtent.height/B)/2>a.FeatureTileController3DConstants.maxSnapshotMinScaleFactor)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=
this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const B=this._get("maxTotalSnapshotVertices")||0;return Math.max(B,"snapshot"===this.mode&&this._tileFetcher?.totalVertices||0)}_approximateExtentSizeAtScale(B,F){const G=this.layerView.view,H=F.levels[0];return(H.tileSize[0]/(H.scale/B)+H.tileSize[1]/(H.scale/B))/2*Math.ceil((G.width/F.pixelSize+G.height/F.pixelSize)/2)}get tileDescriptors(){const B=this.layerView.view.featureTiles;return"snapshot"===this.mode?new k([{id:"dummy-tile-full-extent",
lij:[0,0,0]}]):B?B.tiles:new k}get test(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}constructor(B){super(B);this.type="feature-tile-3d";this._updatingHandles=new q.UpdatingHandles;this.serviceDataExtent=null;this.serviceDataCount=a.FeatureTileController3DConstants.noServiceDataCount;this._snapshotLimitExceeded=!1;this.displayFeatureLimit=null;this._suspended=this._forceTilesMode=!1;this._fetchDataInfoAbortController=this._fetchDataInfoPromise=this._tileFetcher=
null;this._lifeCycleAbortController=new AbortController}initialize(){this._updatingHandles.add(()=>this.displayFeatureLimit,B=>this._updatingHandles.addPromise(this._updateSnapshotLimit(B,null,this._lifeCycleAbortController.signal)));this._updatingHandles.add(()=>this.mode,()=>this._modeChanged(),u.initial);this._updatingHandles.add(()=>this.mode,(B,F)=>{"tiles"===B&&"snapshot"===F&&(this._forceTilesMode=!0)},u.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>
this._updatingHandles.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){const B=this.layerView.layer;if("ogc-feature"!==B.type&&!p.getEffectiveLayerCapabilities(B)?.operations.supportsQuery)throw new d("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:B});}destroy(){this._cancelFetchServiceDataInfo();this._tileFetcher=e.destroyMaybe(this._tileFetcher);this._tilesHandle=e.removeMaybe(this._tilesHandle);
this._lifeCycleAbortController=e.abortMaybe(this._lifeCycleAbortController);this._updatingHandles.destroy();this._set("_updatingHandles",null)}suspend(){this._suspended||(this._suspended=!0,null!=this._tileFetcher&&this._tileFetcher.suspend())}resume(){this._suspended&&(this._suspended=!1,null!=this._tileFetcher&&this._tileFetcher.resume())}restart(){const B=()=>{null!=this._tileFetcher&&this._tileFetcher.restart()};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(B,B))}refetch(){this._refetch({resetForceTilesMode:!1})}getMissingAttributesForFeature(B){return this._tileFetcher?.getMissingAttributesForFeature(B)}_refetch(B){const F=
()=>{null!=this._tileFetcher&&(B.resetForceTilesMode&&(this._forceTilesMode=!1),this._tileFetcher.refetch())};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(F,F))}_initializeTileFetcher(){const B=this.layerView.view;if(B){var F=u.whenOnce(()=>B.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._updatingHandles.addPromise(F);F.then(()=>{const {layerView:G,tileDescriptors:H}=this,L=G.layer,C=new y.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,
tileDescriptors:H,features:this.graphics});this._tileFetcher=C;this._suspended?C.suspend():C.resume();const z=this.layerView.view;z&&this.addHandles(u.watch(()=>z.quality,K=>C.memoryFactor=K,u.syncAndInitial));const J="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;J&&this.addHandles(u.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[J],K=>C.lodFactor=K||1,u.initial));"ogc-feature"!==L.type&&this._updatingHandles.add(()=>
L.createQueryVersion,()=>this._dataFilterChanged());this._updatingHandles.add(()=>G.availableFields,(K,I)=>this._availableFieldsChanged(I,K));this._updatingHandles.add(()=>G.requiredFields,(K,I)=>this._requiredFieldsChanged(I,K));"customParameters"in L&&this._updatingHandles.add(()=>L.customParameters,()=>this.restart());this.addHandles([L.on("apply-edits",K=>this._applyEdits(K)),u.watch(()=>this.extent,K=>C.filterExtent=K,u.sync),u.watch(()=>this.tileDescriptors,K=>C.tileDescriptors=K,u.sync),u.watch(()=>
this.maximumNumberOfFeatures,K=>{C.maximumNumberOfFeatures=K;C.useTileCount=this.serviceDataCount>K},u.syncAndInitial),u.watch(()=>this.serviceDataCount,K=>{C.useTileCount=K>this.maximumNumberOfFeatures},u.syncAndInitial),u.watch(()=>E.debugFlags.FEATURE_TILE_FETCH_SHOW_TILES,K=>{K&&C&&!C.debugger?(C.debugger=new D.FeatureTileFetcher3DDebugger(C,z.featureTiles.tilingScheme.toTileInfo(),z),C.debugger.update()):!K&&this._tileFetcher&&C.debugger&&(C.debugger.destroy(),C.debugger=null)},u.syncAndInitial)]);
this._supportsExceedsLimitQuery||this._updatingHandles.add(()=>this.maxTotalSnapshotVertices,()=>this._updatingHandles.addPromise(this._updateSnapshotLimit(this.displayFeatureLimit,null,this._lifeCycleAbortController.signal)))}).catch(()=>{})}}_modeChanged(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:g.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case "snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),
this._tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this._refetch({resetForceTilesMode:!0})}_applyEdits(B){null!=this._tileFetcher&&this._tileFetcher.applyEdits(B).then(F=>{if(F){if(!this._lifeCycleAbortController)throw l.createAbortError();F.exceededTransferLimit?this.layerView.layer.refresh():(F.deletedFeatures.length||F.updatedFeatures.length||F.addedFeatures.length)&&this._updatingHandles.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(F=>
{if(!l.isAbortError(F))throw F;})}_availableFieldsChanged(B,F){null!=this._tileFetcher&&A(this._tileFetcher.availableFields,F)&&this._refetch({resetForceTilesMode:!1})}_requiredFieldsChanged(B,F){null!=this._tileFetcher&&A(this._tileFetcher.availableFields,F)&&this.restart()}_createVertexLimitExceededQuery(B){const F=this.layerView.layer,G=F.createQuery();G.returnGeometry=!1;G.outStatistics=[new r({statisticType:"exceedslimit",maxVertexCount:B,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,
maxRecordCount:1E8})];F.capabilities?.query.supportsCacheHint&&(G.cacheHint=!0);return G}_createDataInfoQuery(){const B=this.layerView.layer,F=B.createQuery();F.returnGeometry=!1;F.outSpatialReference=this.layerView.view.spatialReference;B.capabilities?.query.supportsCacheHint&&(F.cacheHint=!0);return F}_fullExtentIsAccurate(){const B=this.layerView.layer;if("definitionExpression"in B&&B.definitionExpression)return!1;switch(B.type){case "feature":case "oriented-imagery":return v.isHostedAgolService(B.url);
case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}}async _updateServiceDataExtent(B){try{await this._tryUpdateServiceDataExtent(B)}catch(F){l.isAbortError(F)||this._set("serviceDataExtent",f.clone(this.layerView.fullExtentInLocalViewSpatialReference))}}async _tryUpdateServiceDataExtent(B){var F=this.layerView;const G=F.layer,H=G.capabilities?.query.supportsExtent??!1,L=f.clone(F.fullExtentInLocalViewSpatialReference),C=G.fullExtent,z=this._fullExtentIsAccurate(),J=this.serviceDataCount;
H&&J<=a.FeatureTileController3DConstants.maxFeatureCountForExtent&&(!L||!z)&&"queryExtent"in G?(F=this._createDataInfoQuery(),B=await G.queryExtent(F,{timeout:a.FeatureTileController3DConstants.queryExtentTimeout,signal:B}),this._set("serviceDataExtent",B.extent)):L?this._set("serviceDataExtent",L):null!=C?(B=await t.projectGeometry(C,F.view.spatialReference,"portalItem"in G?G.portalItem:null,B),this._set("serviceDataExtent",B)):this._set("serviceDataExtent",null)}async _updateServiceDataCount(B){const F=
this.layerView.layer;if("queryFeatureCount"in F&&m("featurelayer-snapshot-enabled"))if(B=await c.result(F.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:B})),!0===B.ok)this._set("serviceDataCount",B.value);else{if(l.isAbortError(B.error))throw B.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}get _supportsExceedsLimitQuery(){const B=
this.layerView.layer;return null!=B.capabilities&&B.capabilities.operations&&B.capabilities.operations.supportsExceedsLimitStatistics}get _minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}async _updateSnapshotLimit(B,F,G){if(null==B?.averageSymbolComplexity)this._snapshotLimitExceeded=!1;else{var {maximumTotalNumberOfVertices:H,
averageSymbolComplexity:L}=B,{verticesPerFeature:C,verticesPerCoordinate:z}=L;B=1<this._minimumNumberOfVerticesForGeometry;if(0>=C||B){0!==C&&null!=F&&await F;var J=Math.min(H,1E6);F=this.serviceDataCount;var K=F!==a.FeatureTileController3DConstants.noServiceDataCount;J=K?Math.ceil((J-F*C)/(z||1)):Math.ceil(J/(z||1));B&&(J=Math.min(J,5E6));if(K&&this._minimumNumberOfVerticesForGeometry*F>J)this._snapshotLimitExceeded=!0;else if(this._supportsExceedsLimitQuery&&m("featurelayer-snapshot-enabled"))if(G=
await c.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(J),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:G})),!1===G.ok){if(l.isAbortError(G.error))throw G.error;this._snapshotLimitExceeded=!1}else G=G.value.features[0],this._snapshotLimitExceeded=G?.attributes?!!G.attributes.exceedslimit:!1;else this._snapshotLimitExceeded=this.maxTotalSnapshotVertices>J}else this._snapshotLimitExceeded=!1}}async _fetchServiceDataInfo(){this._cancelFetchServiceDataInfo();
let B=new AbortController;const F=B.signal;var G=this._updateServiceDataCount(F);G=Promise.allSettled([G,this._updateSnapshotLimit(this.displayFeatureLimit,G,F)]);const H=G.then(()=>this._updateServiceDataExtent(F)).catch(L=>{l.isAbortError(L)||g.getLogger(this).error("#fetchServiceDataInfo()",L)}).then(()=>{H===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);B=null});B&&(this._fetchDataInfoPromise=H);this._fetchDataInfoAbortController=B;return G.then(()=>
{},()=>{})}_cancelFetchServiceDataInfo(){const B=this._fetchDataInfoAbortController;B&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,B.abort())}get performanceInfo(){return{storedFeatures:this._tileFetcher?.storedFeatures??0,totalFeatures:this._tileFetcher?.totalFeatures??0,totalVertices:this._tileFetcher?.totalVertices??0,missingTiles:this._tileFetcher?.missingTiles??0}}};b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([x.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"dataUpdating",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"extent",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updating",
null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_updatingHandles",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([x.property()],
a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_snapshotLimitExceeded",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([x.property({type:Number})],
a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeaturesInView",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasFullGeometries",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_forceTilesMode",void 0);b.__decorate([x.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"mode",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"tileDescriptors",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);a.FeatureTileController3D=b.__decorate([w.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(B){B.noServiceDataCount=Infinity;B.maxSnapshotMinScaleFactor=5;B.reset=function(){B.maxFeatureCountForExtent=1E4;B.queryStatisticsTimeout=12E3;B.queryExtentTimeout=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(z){return"dummy-tile-full-extent"===z.id}function A(z){let J=0;for(const K of z)K.features&&0<K.features.length&&K.alive&&(J=Math.max(J,K.descriptor.lij[0]));return J}function B(z){z.setFeatures([],0,null,void 0);z.featuresMissing=!1;return r.FetchStatus.DONE}function F(z){return null==z?new Set:new Set(z.map(J=>J.name))}function G(z,J){if(null==z||null==J)return F(J);const K=new Set;for(const {name:I}of J)z.has(I)&&K.add(I);return K}
function H(z,J){if(!J?.length)return z;z??=new Map;const K=()=>new Set;for(const {objectId:I,attribute:M}of J)k.getOrCreateMapValue(z,I,K).add(M);return z}a.FeatureTileFetcher3D=class extends h{set maximumNumberOfFeatures(z){z=z||Infinity;const J=this._get("maximumNumberOfFeatures");z===J||1>z||(this._set("maximumNumberOfFeatures",z),this._maximumFeaturesUpdated(J,z))}set memoryFactor(z){this.memoryFactor!==z&&(this._set("memoryFactor",z),this._setDirty())}set lodFactor(z){this.lodFactor!==z&&(this._set("lodFactor",
z),this._supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&null!=this.context.query.queryFeatureCount}set useTileCount(z){this._useTileCount=z;this.notifyChange("useTileCount")}get updating(){return this._dirty||!!this._pendingEdits||this._isFetching||(this.tileDescriptors?.updating??!1)}get memoryForUnusedFeatures(){let z=0;this._featureTiles.forEach(J=>z+=J.estimatedUnusedSize);return z}get totalVertices(){let z=0;this._featureTiles.forEach(J=>z+=J.numVertices);return z}get totalFeatures(){let z=
0;this._featureTiles.forEach(J=>z+=J.numFeatures);return z}get hasAllFeatures(){if(this._paused||this.dataUpdating)return!1;for(const [,z]of this._featureTiles)if(!this.hasFullGeometries&&0!==z.emptyFeatureRatio||!z.hasAllFeatures)return!1;return!0}get hasFullGeometries(){return this._supportsResolution?!this.tileDescriptors.find(z=>null!=z.resolution)||!this.context.capabilities.supportsQuantization&&"polyline"!==this.context.geometryType:!0}set filterExtent(z){if(null!=z&&this.context.tilingScheme&&
!z.spatialReference.equals(this.context.tilingScheme.spatialReference))c.getLogger(this).error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var J=this._get("filterExtent");J===z||null!=J&&z&&J.equals(z)||(z=null!=z?z.clone():null,this._set("filterExtent",z),this._reclip(z,J))}}constructor(z){super(z);this.running=this.dataUpdating=this._useTileCount=!1;this.expectedFeatureDiff=this.updatingRemaining=this.updatingTotal=0;this.maximumNumberOfFeaturesExceeded=
!1;this._farRatio=this._fullRatio=1;this._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};this._frameTask=D.ImmediateTask;this._dirty=!1;this._featureTiles=new d;this._displayingFeatureReferences=new Map;this._numDisplayingFeatureReferences=0;this._suspended=!0;this._pendingEdits=null;this._isFetching=this._applyEditsTilesUpdated=!1}initialize(){this.addHandles(f.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{sync:!0,onListenerAdd:()=>this._setDirty()}));this._objectIdField=
this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?t.MultiFeatureReference:t.SingleFeatureReference;const z=this.context.scheduler;null!=z&&(this._frameTask=z.registerTask(D.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()}destroy(){this._frameTask.remove();this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._removeTile(z)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();
this._pendingEdits=null}get _paused(){return this._suspended||!!this._pendingEdits}restart(){this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._clearTile(z);this._resetFetchTile(z)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}refetch(){this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._resetFetchTile(z)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}suspend(){this._suspended||(this._suspended=!0,this._pause(),
this._setDirty())}resume(){this._suspended&&(this._suspended=!1,this._unpause())}getMissingAttributesForFeature(z){for(const [,J]of this._featureTiles){const K=J.missingAttributes?.get(z);if(null!=K)return K}}_pause(){this._paused&&(this._featureTiles.forEach(z=>this._cancelFetchTile(z)),this._updated())}_unpause(){this._paused||(this._setDirty(),this._updated())}get availableFields(){let z=null;this._featureTiles.forEach(J=>{null!=J.displayingFeatures&&0!==J.displayingFeatures.length&&(null==z?z=
new Set(J.availableFields):z.forEach(K=>{J.availableFields.has(K)||z.delete(K)}))});return null!=z?z:new Set}applyEdits(z){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const J=this._pendingEdits;J.count++;const K=J.edits.then(()=>z.result.catch(I=>{if(m.isAbortError(I))throw I;return null}).then(I=>{if(!I)return I;this._applyEditsDeleteFeatures(I.deletedFeatures);return this._applyEditsAddUpdateFeatures(I.addedFeatures,I.updatedFeatures,
J.controller.signal).then(()=>I)}).then(I=>{0===--J.count&&(this._pendingEdits===J&&(this._pendingEdits=null),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._applyEditsTilesUpdated=!1,this._unpause());return I}));J.edits=K;this._updated();return K}_applyEditsDeleteFeatures(z){if(0!==z.length){var J=this.context.globalIdField,K=J&&this.availableFields.has(J),I=new Set,M=this._objectIdField;z.forEach(({objectId:S,globalId:N})=>{(!S||0>S)&&J&&N&&(K||c.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${J} to be included the layer's outFields for updates to be reflected in the view`),
S=this._objectIdFromGlobalId(N,M,J));null!=S&&0<=S&&I.add(S)});this._featureTiles.forEach(S=>{if(S.features){var N=S.features.filter(V=>!I.has(w.getObjectId(V,this._objectIdField)));N.length!==S.features.length&&(this._applyEditsTileUpdated(),S.setFeatures(N,0,S.availableFields,S.missingAttributes),this._invalidateCounts())}})}}_objectIdFromGlobalId(z,J,K){if(null==z)return null;const I=this.features.find(M=>M.attributes?.[K]===z);return I?w.getObjectId(I,J):null}async _applyEditsAddUpdateFeatures(z,
J,K){const {objectIdField:I,globalIdField:M}=this.context,S=M&&this.availableFields.has(M),N=new Set,V=new Set;for(const T of z)z=T.objectId,null!=z&&N.add(z);for(const {objectId:T,globalId:ia}of J)J=T,(null==J||0>J)&&M&&(S||c.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${M} to be included the layer's outFields for updates to be reflected in the view`),J=this._objectIdFromGlobalId(ia,I,M)),null!=J&&0<=J&&(N.add(J),V.add(J));if(0!==N.size){var Q=
[];this._featureTiles.forEach(T=>{(T=this._applyEditsAddUpdateTile(T,N,V,K))&&Q.push(T)});this._updated();await Promise.allSettled(Q)}}async _applyEditsAddUpdateTile(z,J,K,I){if(z.features){var M=this._createQuery(z);M.resultType=void 0;M.cacheHint=!1;M.objectIds=Array.from(J);J=await this._queryFeatures(M,I);I=null;0<K.size&&(M=z.features.filter(S=>!K.has(w.getObjectId(S,this._objectIdField))),M.length!==z.features.length&&(I=M));if(0<J.features.length){I||=z.features.slice();for(const S of J.features)I.push(S)}I&&
(z.hasPreciseFeatureCount&&(z.numFeatures=Math.max(z.numFeatures,I.length)),this._applyEditsTileUpdated(),z.setFeatures(I,0,G(z.availableFields,J.fields),H(z.missingAttributes,J.missingAttributes)),this._invalidateCounts())}}_applyEditsTileUpdated(){this._applyEditsTilesUpdated||(this._applyEditsTilesUpdated=!0,this._updated())}_queryFeatures(z,J){return this.context.query.queryFeaturesDehydrated(z,{signal:J,timeout:6E5})}_setDirty(){this._dirty=!0;this._updated()}runTask(z){const J=this._frameTask.processQueue(z);
if(!this._dirty||!this.initialized)return J;this._dirty=!1;const K=this._getListOfTiles();this._markTilesNotAlive(K);if(z.run(()=>this._addTiles(K,z))&&z.run(()=>this._filterExtentTiles(K,z))&&z.run(()=>this._removeTiles(K,z))&&!z.done){var I=this._sortTiles(K);z.run(()=>this._showTiles(I,z))&&z.run(()=>this._fetchTiles(I,z))&&z.run(()=>this._updateMemoryEstimates(I,z))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}_markTilesNotAlive(z){for(const J of z)J.alive=
!1}_addTiles(z,J){if(this._suspended||!this.tileDescriptors)return!1;this.tileDescriptors.forEach(K=>{const I=this._featureTiles.get(K.id);I?I.alive=!0:J.done||(z.push(this._addTile(K)),J.madeProgress())});return J.hasProgressed}_filterExtentTiles(z,J){for(const K of z){if(J.done)break;K.alive&&(K.filtered=!K.intersects(this.filterExtent),K.filtered&&(this._clearTile(K),J.madeProgress()))}return J.hasProgressed}_removeTiles(z,J){for(let K=z.length-1;0<=K&&!J.done;K--){const I=z[K];I.alive||(this._removeTile(I),
K!==z.length-1&&(z[K]=z[z.length-1]),z.pop(),J.madeProgress())}return J.hasProgressed}_sortTiles(z){z.sort((J,K)=>(J.descriptor.loadPriority??0)-(K.descriptor.loadPriority??0));return z}_showTiles(z,J){const K=this._updateRatio(z),I=M=>{const S=1>this._fullRatio?K(M)*this._farRatio:1;M.reduceFeatures(S,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(M)};for(const M of z)if(!J.run(()=>I(M))){this._setDirty();break}return J.hasProgressed}_fetchTiles(z,J){if(this._paused)return!1;
var K=!1;for(const M of z)if(M.needsFetching){var I=null!=this.context.memoryCache?this.context.memoryCache.pop(M.id):null;if(null!=I)M.cache=I,this._setDirty(),this._scheduleUpdated(),J.madeProgress();else if(this._needsNumFeatures(M)&&(K=new AbortController,I=this._fetchTileCount(M,K.signal),this._handleRequest(M,I,K,()=>M.numFeatures=r.failedFeatureCount),K=!0,J.madeProgress()),J.done)return!0}if(K)return J.hasProgressed;for(const M of z)if(M.needsFetching&&(z=new AbortController,K=this._fetchTile(M,
z.signal),this._handleRequest(M,K,z,S=>{M.setFeatures([],0,null,void 0);this._invalidateCounts();M.featuresMissing=!1;M.fetchFailed=!0;this.context.logFetchError(c.getLogger(this),S)}),J.madeProgress()))return!0;return J.hasProgressed}_updateMemoryEstimates(z,J){z.some(K=>J.run(()=>K.updateMemoryEstimates())?!1:(this._setDirty(),!0));return J.hasProgressed}_reclip(z,J){if(this.initialized){var K=[];this._featureTiles.forEach(I=>{null!=I.displayingFeatures&&0!==I.displayingFeatures.length&&(I.intersectionIncludingBorrowed(J,
L),I.intersectionIncludingBorrowed(z,C),x.equals(L,C)||K.push(I))});this._refreshDisplayingFeatures(K);this._updated()}}_refreshDisplayingFeatures(z){const J=new Set,K=this._changes.updates;for(const I of z)if(null!=I.displayingFeatures)for(const M of I.displayingFeatures)z=w.getObjectId(M,this._objectIdField),J.has(z)||(J.add(z),z=this._displayingFeatureReferences.get(z).feature,K.removes.push(z),K.adds.push(z));this._applyChanges()}_updated(){let z=0;this._paused||this._featureTiles.forEach(J=>
J.isFetching?++z:0);this._isFetching=0<z;this._set("running",this._dirty);0<z||this._applyEditsTilesUpdated?this._set("dataUpdating",!0):this._dirty||this._set("dataUpdating",!1);if(this.updating){let J=0,K=0,I=0,M=0,S=0;const N=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(T=>{++K;if(T.isFetching&&T.hasPreciseFeatureCount){const ia=this._maximumFeaturesForTile(T)*(1-T.emptyFeatureRatio);S+=ia-(null!=T.displayingFeatures?T.displayingFeatures.length*
N:0)}T.needsFetching?++M:0<T.numFeatures&&(++I,J+=T.numFeatures)});M+=z;let V=0,Q=0;J?(Q=J,V=Math.min(M*J/I,J)):(Q=K,V=M);S=Math.min(this.maximumNumberOfFeatures-this.features.length,S);this._set("updatingTotal",Q);this._set("updatingRemaining",V);this._set("expectedFeatureDiff",S)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const z=k.someMap(this._featureTiles,
J=>J.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",z)}_updateRatio(z){const J=A(z),K=S=>1/(1<<Math.max(0,J-S.descriptor.lij[0]));let I=0,M=0;for(const S of z)z=S.numFeatures,I+=z,M+=z*K(S);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/I);this._farRatio=this.maximumNumberOfFeatures/M;this._scheduleUpdated();return K}_maximumFeaturesUpdated(z,J){z!==J&&(J>z&&this._featureTiles.forEach(K=>{if(K.featuresMissing){var I=this._maximumFeaturesForTile(K);K.features&&
(K.features.length>=I||K.fetchStatus===r.FetchStatus.FULL)||(this._cancelFetchTile(K),this._resetFetchTile(K))}}),this._setDirty())}_addTile(z){z=new r.FeatureTile(z);this._featureTiles.set(z.id,z);this._resetFetchTile(z);this._referenceDisplayingFeaturesFromRelatedTiles(z);return z}_referenceDisplayingFeaturesFromRelatedTiles(z){const J=z.descriptor.resolution;this._featureTiles.forEach(K=>{if(!(null==K.displayingFeatures||z===K||z.descriptor.lij&&K.descriptor.lij&&!y.tilesAreRelated(z.descriptor.lij,
K.descriptor.lij))){null==z.displayingFeatures&&(z.displayingFeatures=[]);z.descriptor.extent&&K.descriptor.extent&&(null==z.extentIncludingBorrowedFeatures&&(z.extentIncludingBorrowedFeatures=x.clone(z.descriptor.extent)),x.expand(z.extentIncludingBorrowedFeatures,K.descriptor.extent,z.extentIncludingBorrowedFeatures));for(const I of K.displayingFeatures)z.displayingFeatures.push(I),K=this._displayingFeatureReferences.get(w.getObjectId(I,this._objectIdField)),K.ref(K.feature,J),this._numDisplayingFeatureReferences++}});
z.featureLimit=null!=z.displayingFeatures?z.displayingFeatures.length:0}_removeTile(z){this._clearTile(z);this._featureTiles.delete(z.id)}_resetFetchTile(z){z.filtered=!z.intersects(this.filterExtent);z.filtered?z.needsFetching&&(z.fetchStatus=r.FetchStatus.DONE):z.fetchStatus=r.FetchStatus.FETCH_NEEDED}_cancelFetchTile(z){const J=z.requestController;null!=J&&(z.requestController=null,z.resetFetching(),J.abort())}async _fetchTileCount(z,J){z.numFeatures=await this._fetchCount(z,J);this._updateRatio(this._getListOfTiles());
return z.fetchStatus===r.FetchStatus.REFETCHING?r.FetchStatus.REFETCH_NEEDED:r.FetchStatus.FETCH_NEEDED}async _fetchTile(z,J){z.fetchFailed=!1;var K=this._maximumFeaturesForTile(z);if(0>=K)return z.hasPreciseFeatureCount&&0===z.numFeatures||(z.fetchFailed=!0),B(z);const I=this._getMaxRecordCount(z);var M=Math.ceil(K/I);if(E(z)||!this.context.capabilities.supportsMaxRecordCountFactor||z.numFeatures<=K&&M>v.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(z,J);M=this._createQuery(z);M.maxRecordCountFactor=
Math.ceil(K/I);z.isRefetching&&z.features&&0<z.features.length&&(M.maxRecordCountFactor=Math.max(Math.ceil(z.features.length/(1-z.emptyFeatureRatio)/I)+1,M.maxRecordCountFactor));const {features:S,exceededTransferLimit:N,fields:V,missingAttributes:Q}=await this._queryFeatures(M,J);K=N?M.maxRecordCountFactor>=v.MAX_MAX_RECORD_COUNT_FACTOR?r.FetchStatus.FULL:r.FetchStatus.DONE:r.FetchStatus.FULL;await this._frameTask.schedule(()=>{z.featuresMissing=z.hasPreciseFeatureCount&&S.length<z.numFeatures||
!!N;const T=this._removeEmptyFeatures(S);z.setFeatures(S,T,F(V),H(void 0,Q))},J);m.throwIfAborted(J);this._invalidateCounts();return K}async _fetchCount(z,J){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(z),{signal:J})}async _fetchPagedTile(z,J){let K=0,I=0,M,S=0,N=this._maximumFeaturesForTile(z)-S;const V=this._getMaxRecordCount(z);let Q=null,T;for(;;){const ia=this._createQuery(z),O=this._setPagingParameters(ia,K,N,V),{features:U,exceededTransferLimit:P,fields:R,missingAttributes:ba}=
await this._queryFeatures(ia,J);await this._frameTask.schedule(()=>{O&&(K+=ia.num);S+=U.length;I+=this._removeEmptyFeatures(U);z.featuresMissing=O&&z.hasPreciseFeatureCount&&K<z.numFeatures||!!P;M=M?M.concat(U):U;Q=G(Q,R);T=H(T,ba);z.setFeatures(M,I,Q,T)},J);m.throwIfAborted(J);this._invalidateCounts();this._setDirty();N=this._maximumFeaturesForTile(z)-S;if(!O||!P||0>=N)return P?r.FetchStatus.DONE:r.FetchStatus.FULL}}_createFeatureCountQuery(z){z=this._createQuery(z);this.context.capabilities.supportsCacheHint&&
(z.resultType=void 0,z.cacheHint=!0);return z}_createQuery(z){const J=this.context.createQuery(),K=z.descriptor.extent;K&&(J.geometry=x.toExtent(K,this.context.tilingScheme.spatialReference));this._setResolutionParams(J,z);this._useTileQuery(z)?J.resultType="tile":this.context.capabilities.supportsCacheHint&&(J.cacheHint=!0);return J}_setPagingParameters(z,J,K,I){if(!this.context.capabilities.supportsPagination)return!1;z.start=J;0<K&&this.context.capabilities.supportsMaxRecordCountFactor?(z.maxRecordCountFactor=
Math.ceil(K/I),z.num=Math.min(z.maxRecordCountFactor*I,K)):z.num=Math.min(I);return!0}_getEffectiveTileResolution(z){if(null==z.descriptor.resolution)return null;const J=this.context.viewingMode===p.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(z.descriptor.resolution,J)/this.lodFactor}get _supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}_setResolutionParams(z,J){this._supportsResolution&&
(J=this._getEffectiveTileResolution(J),null!=J&&(this.context.capabilities.supportsQuantization?z.quantizationParameters=new q({mode:"view",originPosition:"upper-left",tolerance:J,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(z.maxAllowableOffset=J)))}_removeEmptyFeatures(z){const J=z.length;for(let K=0;K<z.length;)w.hasVertices(z[K].geometry)?++K:(z[K]=z[z.length-1],--z.length);return J-z.length}_needsNumFeatures(z){return this.useTileCount&&z.needsFeatureCount&&!E(z)}_getMaxRecordCount(z){const {tileMaxRecordCount:J,
maxRecordCount:K}=this.context;return this._useTileQuery(z)&&null!=J&&0<J&&this.context.capabilities.supportsResultType?J:null!=K&&0<K?K:2E3}_useTileQuery(z){return E(z)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType}_handleRequest(z,J,K,I){z.fetchStatus=z.needsRefetching?r.FetchStatus.REFETCHING:r.FetchStatus.FETCHING;z.requestController=K;let M=!1;J.then(S=>{z.requestController=null;z.fetchStatus=S}).catch(S=>{z.requestController===K&&(z.requestController=
null,z.fetchStatus=r.FetchStatus.DONE);m.isAbortError(S)?M=!0:I(S)}).then(()=>{M||this._setDirty();this._scheduleUpdated()})}_scheduleUpdated(){this.hasHandles("scheduleUpdated")||this.addHandles(g.schedule(()=>{this.removeHandles("scheduleUpdated");this._updated()}),"scheduleUpdated")}_showTile(z){if(null!=z.displayingFeatures&&!z.needsDisplayUpdate)return!1;var J=z.features;if(0===z.featureLimit||!J)return J=null!=z.displayingFeatures&&0<z.displayingFeatures.length,this._hideTileFeatures(z),z.displayingFeatures=
[],J;const K=z.descriptor.resolution,I=this._changes.updates,M=this._changes.adds,S=Math.min(z.featureLimit,J.length);z.featureLimit=S;for(let V=0;V<S;++V){var N=J[V];const Q=w.getObjectId(N,this._objectIdField),T=this._displayingFeatureReferences.get(Q);T?(N=T.ref(N,K),N.oldVersion!==N.newVersion&&(N.oldVersion&&I.removes.push(N.oldVersion),N.newVersion&&I.adds.push(N.newVersion))):(this._displayingFeatureReferences.set(Q,new this.FeatureReferenceClass(N,K)),M.push(N));this._numDisplayingFeatureReferences++}this._hideTileFeatures(z);
this._applyChanges();z.displayingFeatures=J.slice(0,S);return!0}_hideTile(z){this._cancelFetchTile(z);this._hideTileFeatures(z)}_hideTileFeatures(z){if(null!=z.displayingFeatures){var J=this._changes.updates,K=this._changes.removes;for(const M of z.displayingFeatures){const S=w.getObjectId(M,this._objectIdField);var I=this._displayingFeatureReferences.get(S);I&&((I=I.unref(z.descriptor.resolution),this._numDisplayingFeatureReferences--,I)?I.oldVersion!==I.newVersion&&(null==I.newVersion?(this._displayingFeatureReferences.delete(S),
I.oldVersion&&K.push(I.oldVersion)):(J.adds.push(I.newVersion),I.oldVersion&&J.removes.push(I.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();z.displayingFeatures=null}}_applyChanges(){var z=this._changes.updates;0<z.removes.length&&(this.features.removeMany(z.removes),z.removes.length=0);0<z.adds.length&&(this.features.addMany(z.adds),z.adds.length=0);z=this._changes.adds;const J=this._changes.removes,K=Math.min(z.length,J.length);let I=0;for(;I<K;){const M=Math.min(I+
200,K);this.features.addMany(z.slice(I,M));this.features.removeMany(J.slice(I,M));I=M}z.length>K&&this.features.addMany(0===I?z:z.slice(I));J.length>K&&this.features.removeMany(0===I?J:J.slice(I));z.length=0;J.length=0}_clearTile(z){this._hideTile(z);z.features&&null!=this.context.memoryCache&&this.context.memoryCache.put(z.id,z.cache,16+z.estimatedSize);z.setFeatures(null,0,null,void 0);this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");
this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this._featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((z,J)=>z+(J.features?J.features.length:0),0)}get missingTiles(){return Array.from(this._featureTiles.values()).reduce((z,J)=>z+(J.needsFetching||J.isFetching?1:0),0)}_maximumFeaturesForTile(z){const J=z.hasPreciseFeatureCount?z.numFeatures:Infinity;return Math.min(Math.ceil((z.hasPreciseFeatureCount?J:this.maximumNumberOfFeatures)*
(1>this._fullRatio?this._farRatio:1)/(1-z.emptyFeatureRatio)),J)}get test(){return{process:z=>this.runTask(z),getFeatureTileById:z=>this._featureTiles.get(z),forEachFeatureTile:z=>this._featureTiles.forEach(z)}}};b.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([e.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",
null);b.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"dataUpdating",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"running",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasAllFeatures",null);b.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasFullGeometries",null);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",
null);b.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"_dirty",void 0);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"_pendingEdits",void 0);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"_applyEditsTilesUpdated",void 0);b.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"_isFetching",void 0);a.FeatureTileFetcher3D=b.__decorate([u.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],
a.FeatureTileFetcher3D);const L=x.create(),C=x.create();a.contextCapabilitiesFromLayer=function(z){const J=z.capabilities.query;a:switch(z.geometryType){case "polyline":z=!0;break a;case "polygon":z=z.capabilities&&z.capabilities.query&&z.capabilities.query.supportsQuantization;break a;default:z=!1}return{supportsMultipleResolutions:z,supportsPagination:!(!J||!J.supportsPagination),supportsResultType:!(!J||!J.supportsResultType),supportsCacheHint:!(!J||!J.supportsCacheHint),supportsQuantization:!(!J||
!J.supportsQuantization),supportsQuantizationEditMode:!(!J||!J.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!J||!J.supportsMaxRecordCountFactor),supportsFormatPBF:!(!J||!J.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(p,t){this._highestResolutionVersion=null;this.versions=[];this.ref(p,t)}ref(p,t){const r=this.feature;v.oldVersion=r;this.feature&&Object.defineProperty(p,"uid",{value:this.feature.uid,configurable:!0});for(var y of this.versions)if(y.resolution===t){y.refCount++;if((t=this._highestResolutionVersion===y&&!x.equals(p,
y.feature))||this._highestResolutionVersion!==y)y.feature=p;v.newVersion=t?p:r;return v}y={feature:p,resolution:t,refCount:1};this.versions.push(y);!this._highestResolutionVersion||t<this._highestResolutionVersion.resolution?(v.newVersion=p,this._highestResolutionVersion=y):v.newVersion=r;return v}unref(p){for(let t=0;t<this.versions.length;t++){const r=this.versions[t];if(r.resolution===p)return r.refCount--,v.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-
1],this.versions.length--,this._highestResolutionVersion===r&&(this._recalculateHighestResolutionVersion(),v.oldVersion=r.feature)),v.newVersion=this.feature,v}return null}get feature(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var p=this.versions[0];for(let t=1;t<this.versions.length;t++){const r=this.versions[t];r.resolution<p.resolution&&(p=r)}this._highestResolutionVersion=
p}}}class q{get isReferenced(){return 0!==this._refCount}get isSingle(){return 1===this._refCount}constructor(p){this._feature=p;this._refCount=1}ref(p){++this._refCount;v.oldVersion=this._feature;this.feature&&Object.defineProperty(p,"uid",{value:this.feature.uid,configurable:!0});x.equals(this._feature,p)||(this._feature=p);v.newVersion=this._feature;return v}unref(){v.oldVersion=this._feature;if(0<this._refCount&&(this._refCount--,!this.isReferenced))return v.newVersion=null,v;v.newVersion=this._feature;
return v}get feature(){return this._feature}}const v={oldVersion:null,newVersion:null};a.MultiFeatureReference=w;a.SingleFeatureReference=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define(["exports","../../../../core/arrayUtils","../../../../core/signal","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(a,b,h,c,k){const m=new Set;class d{get featuresMissing(){return this._featuresMissing.value}set featuresMissing(g){this._featuresMissing.value=
g}get missingAttributes(){return this._missingAttributes}get fetchFailed(){return this._fetchFailed.value}set fetchFailed(g){this._fetchFailed.value=g}get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(g){this._displayingFeatures=g;this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){const g=(this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL)&&this.featuresMissing;return!this.filtered&&(g||this.hasFeatureLimit)}get features(){return this._features}get featureLimit(){return this._featureLimit.value}set featureLimit(g){this._featureLimit.value!==
g&&(this._featureLimit.value=g,this._estimatedUnusedSizeDirty=!0)}get hasFeatureLimit(){return this.featureLimit!==this._featuresLength.value}get hasAllFeatures(){return!(this.featuresMissing||this.fetchFailed||this.hasFeatureLimit)}get availableFields(){return this._availableFields}setFeatures(g,e,n,l){this._availableFields=n??m;this._features=g;this._featuresLength.value=g?.length??0;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;this._missingAttributes=l;g&&0<g.length?
(this._emptyFeatureRatio.value=e/(g.length+e),this._numVertices=g.reduce((u,x)=>u+k.numVertices(x.geometry),0)):this._numVertices=this._emptyFeatureRatio.value=0}get emptyFeatureRatio(){return this._emptyFeatureRatio.value}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(g){this._numFeatures=g}get hasPreciseFeatureCount(){return-1<this._numFeatures}get needsFeatureCount(){return-1===this._numFeatures}get numVertices(){return this._numVertices}constructor(g){this.descriptor=
g;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featuresLength=h.signal(0);this._numVertices=0;this._featureLimit=h.signal(0);this._featuresMissing=h.signal(!0);this._fetchFailed=h.signal(!1);this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=h.signal(0);this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=m;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}get id(){return this.descriptor.id}get estimatedSize(){this.updateMemoryEstimates();
return this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var g=0;g<this._features.length;++g){const e=k.estimateSize(this._features[g]);this._estimatedSize+=e;g>=this.featureLimit&&(this._estimatedUnusedSize+=e)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(g=this.featureLimit;g<
this._features.length;++g)this._estimatedUnusedSize+=k.estimateSize(this._features[g]);return!0}return!1}get isFetching(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}get isRefetching(){return this.fetchStatus===a.FetchStatus.REFETCHING}get needsFetching(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===
a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED}get needsDisplayUpdate(){var g;if(g=!!this._features){a:{g=this._features;var e=this.displayingFeatures,n=this.featureLimit;if(null==e||null==g||n!==e.length||n>g.length)g=!1;else{for(let l=0;l<n;++l)if(g[l]!==e[l]){g=!1;break a}g=!0}}g=!g}return g}intersects(g){if(null==g||!this.descriptor.extent)return!0;c.fromExtent(g,
f);return c.intersects(this.descriptor.extent,f)}intersectionIncludingBorrowed(g,e){const n=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!g&&!n)return c.copy(e,c.positiveInfinity),e;null!=g?(c.fromExtent(g,e),c.intersection(e,n,e)):c.copy(e,n);return e}_shuffle(g){this._features&&(this._features.sort((e,n)=>k.getObjectId(e,g)-k.getObjectId(n,g)),b.shuffle(this._features,16438),this._estimatedUnusedSizeDirty=this._shuffled=!0)}reduceFeatures(g,
e,n){if(0>=g)return!1;if(!this._features)return this.featureLimit=0,!1;let l=!1;this.featureLimit=Math.ceil(this.numFeatures*g);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,l=!0));!this._shuffled&&1>g&&this._shuffle(n);g=Math.max(this.featureLimit,Math.ceil(e*this.numFeatures));this._features.length>g&&(this._features.length=g,this._featuresLength.value=
g,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return l}get cache(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio.value,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(g){this.requestController=null;this._availableFields=g.availableFields;this._features=g.features;this._featuresLength.value=g.features?.length??0;this._numFeatures=
g.numFeatures;this._emptyFeatureRatio.value=g.emptyFeatureRatio;this.fetchStatus=g.fetchStatus;this.featuresMissing=g.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}a.FetchStatus=void 0;(function(g){g[g.FETCH_NEEDED=0]="FETCH_NEEDED";g[g.REFETCH_NEEDED=1]="REFETCH_NEEDED";g[g.FETCHING=2]="FETCHING";g[g.REFETCHING=3]="REFETCHING";g[g.DONE=4]="DONE";g[g.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const f=c.create();a.FeatureTile=d;a.failedFeatureCount=-2;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../Graphic ../../../../symbols ../../../../core/Collection ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../../../symbols/support/Symbol3DVerticalOffset ../../terrain/TilingScheme ../../../../symbols/callouts/LineCallout3D".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){const u=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class x{constructor(w,q,v){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=w;this._view=v;this._tilingScheme=new n.TilingScheme(q);
this._loadedSymbols=u.map(p=>new f({symbolLayers:new c([new m({material:{color:[p[0],p[1],p[2],.6]},outline:{color:"black",size:1}})])}));this._loadingSymbols=[new f({symbolLayers:new c([new m({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}})])})];this._pendingSymbols=[new f({symbolLayers:new c([new m({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}})])})];this._dataExtentSymbol=new f({symbolLayers:new c([new m({material:{color:[0,0,0,0]},outline:{color:"green",
size:4}})])})}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(w){this._enabled=w;this.update()}update(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:w=>w.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:w=>!w.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:w=>!w.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(w=>
{this._view.graphics.removeMany(w)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(w=>{this._view.graphics.removeMany(w)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(w=>{this._view.graphics.removeMany(w)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}showDataExtent(w){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);null!=
w&&(w=k.fromExtent(w),this._dataExtentGraphic=new b({geometry:w,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))}_synchronizeMaps(w,q){const v=[];w.forEach((p,t)=>{const r=this._tileFetcher.test.getFeatureTileById(t);r&&q.filter(r)||(this._view.graphics.removeMany(p),v.push(t))});v.forEach(p=>w.delete(p));this._tileFetcher.test.forEachFeatureTile(p=>{if(q.filter(p)&&!w.has(p.id)){const [y,D,E]=p.descriptor.lij;this._tilingScheme.ensureMaxLod(y);var t=this._tilingScheme.getExtentGeometry(y,
D,E),r=new b({geometry:t,symbol:q.symbols[y%q.symbols.length]});t=new b({geometry:t.center,symbol:new d({verticalOffset:new e({screenLength:40/.75}),callout:new l({color:"white",border:{color:"black"}}),symbolLayers:new c([new g({text:`${y}/${D}/${E}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})])})});r=[r,t];w.set(p.id,r);this._view.graphics.addMany(r)}})}}a.FeatureTileFetcher3DDebugger=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerViewPerformanceInfo":function(){define(["exports",
"./support/LayerViewPerformanceInfo"],function(a,b){class h extends b.LayerViewPerformanceInfo{constructor(c,k,m,d,f,g){super(c.usedMemory,c.displayedFeatures,c.totalFeatures,c.maximumFeatures,c.nodes,c.core);this.storedFeatures=k;this.totalVertices=m;this.partial=d;this.mode=f;this.symbolComplexity=g}}a.FeatureLayerViewPerformanceInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/LayerViewPerformanceInfo ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){var A;(function(B){B[B.NONE=0]="NONE";B[B.CONTROLLER=1]="CONTROLLER";B[B.CORE=2]="CORE"})(A||={});a.FeatureLikeLayerView3D=B=>{B=class extends B{constructor(){super(...arguments);this._dataUpdatingState=A.NONE;this.controller=null;this.updatePolicy=D.UpdatePolicy.SYNC;this.suspendResumeExtentMode="computed";this.slicePlaneEnabled=!1;this.suspendResumeExtent=this.fullExtentInLocalViewSpatialReference=null;this._controllerCreated=!1;this.supportsHeightUnitConversion=
!0;this.queryEngine=this._pendingController=null}initialize(){const F=this.layer;if("isTable"in F&&F.isTable)this.addResolvingPromise(Promise.reject(new h("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:F})));else{this.addResolvingPromise(this._validateGeometryType());this._updatingHandles.add(()=>this.layer.renderer,H=>this._recreateProcessor(H),k.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await y.toViewIfLocal(this);
await this._initializeController()})());this._updatingHandles.add(()=>this.updatePolicy,H=>this.processor.preferredUpdatePolicy=H);var G=()=>this.processor.featureStore;this.queryEngine=new v.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return G()},hasZ:this.hasZ,hasM:this.hasM},priority:E.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}}destroy(){this._destroyPendingController();
this.controller=c.destroyMaybe(this.controller);this._set("processor",c.destroyMaybe(this.processor));this.queryEngine=c.destroyMaybe(this.queryEngine);this.loadedGraphics=null}_destroyPendingController(){this._pendingController=c.destroyMaybe(this._pendingController)}get dataUpdating(){return this._dataUpdatingState!==A.NONE}get legendEnabled(){return this.canResume()&&this.processor?.legendEnabled}get graphics3DProcessor(){return"graphics-3d"===this.processor?.type?this.processor:null}get heatmapProcessor(){return"heatmap"===
this.processor?.type?this.processor:null}get symbologySnappingSupported(){return this.layer?.renderer?.getSymbols()?.some(x.symbolHasExtrudeSymbolLayer)??!1}get hasAllFeatures(){return this.controller&&"hasAllFeatures"in this.controller?this.controller.hasAllFeatures:!1}get hasAllFeaturesInView(){return this.controller&&"hasAllFeaturesInView"in this.controller?this.controller.hasAllFeaturesInView:!1}get hasFullGeometries(){return this.controller&&"hasFullGeometries"in this.controller?this.controller.hasFullGeometries:
!1}getHit(F){let G;this.loadedGraphics?.forEach(H=>{H.uid===F&&(G=n.hydrateGraphic(H,this.layer))});return G?{type:"graphic",graphic:G,layer:G.layer}:null}whenGraphicBounds(F,G){return this.processor?.whenGraphicBounds(F,G)}computeAttachmentOrigin(F,G){return this.processor?.computeAttachmentOrigin(F,G)}async elevationAlignPointsInFeatures(F,G){const H=this.graphics3DProcessor;if(null==H)throw new h("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");
return w.elevationAlignPointsInFeatures(this.view,this.layer,L=>H.getGraphics3DGraphicByObjectId(L),F,G)}async queryForSymbologySnapping(F,G){return this.symbologySnappingSupported?p.queryForSymbologySnapping(this.graphics3DProcessor,F,G):{candidates:[],sourceCandidateIndices:[]}}queryFeatures(F,G){return this.queryEngine.executeQuery(this._ensureQuery(F),G?.signal)}queryObjectIds(F,G){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),G?.signal)}queryFeatureCount(F,G){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),
G?.signal)}queryExtent(F,G){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),G?.signal)}_ensureQuery(F){return null==F?this.createQuery():u.from(F)}highlight(F){return this.processor.highlight(F,this.layer.objectIdField)}maskOccludee(F){return this.processor.maskOccludee(F)}canResume(){return super.canResume()&&!this.processor?.scaleVisibilitySuspended}getSuspendInfo(){const F=super.getSuspendInfo();return this.processor?{...F,...this.processor.suspendInfo}:F}isUpdating(){return!this.processor||
this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)}async _initializeController(){const F=this.createController();this._pendingController=F;this._setupDataUpdating(F);await F.when();this._setControllerWhenInitialized(F)}_setupDataUpdating(F){"dataUpdating"in F&&this.addHandles([k.watch(()=>F.dataUpdating,G=>{G&&this._dataUpdatingState===A.NONE?this._dataUpdatingState=A.CONTROLLER:G||this._dataUpdatingState!==
A.CONTROLLER||(this._dataUpdatingState=A.NONE)},k.sync),k.watch(()=>!!this.graphics3DProcessor?.dataUpdating,G=>{G&&this._dataUpdatingState===A.CONTROLLER?this._dataUpdatingState=A.CORE:G||this._dataUpdatingState!==A.CORE||(this._dataUpdatingState=F.dataUpdating?A.CONTROLLER:A.NONE)},k.sync)])}async _setControllerWhenInitialized(F){try{await this.when()}catch(G){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(await k.whenOnce(()=>
this.view?.basemapTerrain?.ready),this.beforeSetController(F),this._pendingController=null,this.controller=F,this.loadedGraphics=F.graphics,this.notifyChange("updating"))}_updateClippingExtent(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}}async _validateGeometryType(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new h("featurelayerview3d:unsupported-geometry-type",
"Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}}_recreateProcessor(F){var G="heatmap"===F?.type;const H="heatmap"===this.processor?.type;F=this.processor;F&&G===H||(G=G?new t.HeatmapFeatureProcessor({owner:this}):new q.Graphics3DFeatureProcessor({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,
updateClippingExtent:L=>this._updateClippingExtent(L)}),this._set("processor",G),F?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(G.initializePromise))}get performanceInfo(){const F=this.controller instanceof l.FeatureTileController3D?this.controller:null;return new r.LayerViewPerformanceInfo(this.processor.usedMemory,this.loadedGraphics?.length,F?.serviceDataCount??-1,F?.maximumNumberOfFeatures??-1,0,this.processor.performanceInfo)}};b.__decorate([m.property()],B.prototype,"loadedGraphics",
void 0);b.__decorate([m.property()],B.prototype,"_dataUpdatingState",void 0);b.__decorate([m.property({readOnly:!0})],B.prototype,"dataUpdating",null);b.__decorate([m.property()],B.prototype,"suspended",void 0);b.__decorate([m.property({readOnly:!0})],B.prototype,"legendEnabled",null);b.__decorate([m.property()],B.prototype,"updating",void 0);b.__decorate([m.property()],B.prototype,"controller",void 0);b.__decorate([m.property()],B.prototype,"processor",void 0);b.__decorate([m.property({readOnly:!0})],
B.prototype,"updatePolicy",void 0);b.__decorate([m.property({readOnly:!0})],B.prototype,"suspendResumeExtentMode",void 0);b.__decorate([m.property({type:Boolean})],B.prototype,"slicePlaneEnabled",void 0);b.__decorate([m.property({readOnly:!0})],B.prototype,"suspendInfo",void 0);b.__decorate([m.property()],B.prototype,"graphics3DProcessor",null);b.__decorate([m.property()],B.prototype,"heatmapProcessor",null);b.__decorate([m.property()],B.prototype,"symbologySnappingSupported",null);b.__decorate([m.property({readOnly:!0})],
B.prototype,"hasAllFeatures",null);b.__decorate([m.property({readOnly:!0})],B.prototype,"hasAllFeaturesInView",null);b.__decorate([m.property({readOnly:!0})],B.prototype,"hasFullGeometries",null);return B=b.__decorate([e.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],B)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../layers/graphics/dehydratedPoint ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.elevationAlignPointsInFeatures=async function(l,u,x,w,q){const {elevationProvider:v,renderCoordsHelper:p}=l,{elevationInfo:t}=u,{pointsInFeatures:r,spatialReference:y}=w;var D=n.fromJSON(y);w=e.extractExpressionInfo(t,!0);w=await e.createContext(w,D,q);h.throwIfAborted(q);const E=[],A=new Set,B=new Set,F=new g.ElevationContext,G=m.makeDehydratedPoint(0,0,0,n.WGS84),H=new f.SampleElevationInfo,L=c.create();G.spatialReference=D;l=l.elevationProvider.spatialReference??
l.spatialReference;for(const {objectId:C,points:z}of r)if(D=x(C),null==D){for(const J of z)E.push(J.z??0);A.add(C)}else{D.isDraped&&B.add(C);F.setFromElevationInfo(d.getGeometryEffectiveElevationInfo(D.graphic.geometry,t));F.updateFeatureExpressionInfoContext(w,D.graphic,u);for(const {x:J,y:K,z:I}of z)G.x=J,G.y=K,G.z=I??0,await k.projectPointToVectorAsync(G,L,l,0,{signal:q}),f.evaluateElevationInfoAtPoint(L,v,F,p,H),E.push(H.z)}return{elevations:E,drapedObjectIds:B,failedObjectIds:A}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../core/support/UpdatingHandles ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./DisplayFeatureLimit ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K){a.Graphics3DFeatureProcessor=class extends k{constructor(I){super(I);this.type="graphics-3d";this._randomRotationRenderers=null;this._updatingHandles=new q.UpdatingHandles;this.timeExtentEnabled=this.elevationAlignmentEnabled=this.frustumVisibilityEnabled=this.filterVisibilityEnabled=this.scaleVisibilityEnabled=this.elevationFeatureExpressionEnabled=!1;this.setUidToIdOnAdd=!0;this.dataExtent=null;this.drapeSourceType=y.DrapeSourceType.Features;
this.preferredUpdatePolicy=K.UpdatePolicy.ASYNC;this._suspendResumeExtent=null}initialize(){const I=this.owner,M=new A.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:I.hasZ,hasM:I.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:S=>I.view.deconflictor.addGraphicsOwner(S),labeler:(S,N)=>I.view.labeler.addGraphicsOwner(S,N),elevationAlignment:this.elevationAlignmentEnabled?
(S,N)=>new B.Graphics3DElevationAlignment({graphicsCoreOwner:this,graphicsCore:S,queryGraphicUIDsInExtent:N,elevationProvider:I.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(S,N)=>new H.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:N,graphicsCore:S,basemapTerrain:I.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==I.layer.geometryType?S=>new z.FeatureVisibilityFilter({context:{layerView:I,
...S}}):null,objectStates:S=>new G.Graphics3DObjectStates(S)}});this._set("graphicsCore",M);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new F.Graphics3DFrustumVisibility({graphicsCoreOwner:this}));this.elevationAlignment&&this._updatingHandles.add(()=>this.layer.elevationInfo,(S,N)=>{w.diff(S,N)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this._updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this._updatingHandles.add(()=>
this.layer.labelingInfo,(S,N)=>{w.diff(S,N)&&this.graphicsCore.updateLabelingInfo()});this._updatingHandles.add(()=>this.preferredUpdatePolicy,S=>this.graphicsCore.preferredUpdatePolicy=S);this._set("initializePromise",this._initializeAsync());this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){await g.logOnError(this.graphicsCore.initializePromise);const I=this.owner;this._updatingHandles.add(()=>this.renderer,M=>this._updatingHandles.addPromise(this.graphicsCore.rendererChange(M)));
this._updatingHandles.add(()=>I.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this._updatingHandles.add(()=>I.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await g.logOnError(this.graphicsCore.updateLabelingInfo())}destroy(){this._updatingHandles.destroy();this._set("frustumVisibility",f.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",f.destroyMaybe(this.graphicsCore));this._set("owner",null)}get layer(){return this.owner.layer}get dataUpdating(){return this.graphicsCore?.dataUpdating??!1}get renderer(){const {renderer:I,objectIdField:M}=this.layer;if(!I||!M||"heatmap"===I.type||!I.visualVariables)return I;const S=I.visualVariables.findIndex(V=>"rotation"===V.type&&null!=V.valueExpression&&p.matchRandomRotationExpression(V.valueExpression)===M&&(null==V.axis||"heading"===V.axis)&&"geographic"===V.rotationType);
if(0>S)return I;const N=I.clone();N.visualVariables.splice(S,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(N,M);return N}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get filterVisibility(){return this.graphicsCore?.filterVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get objectStates(){return this.graphicsCore?.objectStates}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in
this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){return null!=this.scaleVisibility&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}get suspendInfo(){const I={};this.scaleVisibilitySuspended&&(I.outsideScaleRange=!0);null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(I.outsideOfView=!0);return I}get updating(){return!!(this.graphicsCore?.updating||
this.frustumVisibility?.updating||this._updatingHandles.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in
this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const I=this.view.quality,M=this.graphicsCore?.displayFeatureLimit;return 1===I?M:new E.DisplayFeatureLimit(M.maximumTotalNumberOfVertices,Math.ceil(M.maximumNumberOfFeatures*
I),M.averageSymbolComplexity)}get usedMemory(){return this.graphicsCore?.usedMemory??0}get loadedFeatures(){return this.graphicsCore?.numberOfGraphics??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return this.graphicsCore.performanceInfo}maskOccludee(I){const {set:M,handle:S}=this.objectStates.acquireSet(J.Object3DState.MaskOccludee,null);this.objectStates.setUid(M,
I.uid);return S}highlight(I,M){if(I instanceof r){const {set:S,handle:N}=this.objectStates.acquireSet(J.Object3DState.Highlight,M);this.owner.queryObjectIds(I).then(V=>this.objectStates.setObjectIds(S,V));return N}if("number"===typeof I||"string"===typeof I||I instanceof h)return this.highlight([I],M);"toArray"in I&&(I=I.toArray());if(Array.isArray(I)&&0<I.length){if(I[0]instanceof h)if(null!=C.attributeLookup(this.layer.fieldsIndex,I[0].attributes,M))I=I.map(S=>C.attributeLookup(this.layer.fieldsIndex,
S.attributes,M));else{I=I.map(V=>V.uid);const {set:S,handle:N}=this.objectStates.acquireSet(J.Object3DState.Highlight,null);this.objectStates.setUids(S,I);return N}if(Array.isArray(I)&&("number"===typeof I[0]||"string"===typeof I[0])){const {set:S,handle:N}=this.objectStates.acquireSet(J.Object3DState.Highlight,M);this.objectStates.setObjectIds(S,I);return N}}return d.makeHandle()}resetObjectStates(){this.objectStates.reset()}whenGraphicBounds(I,M){return this.graphicsCore?.whenGraphicBounds(I,M)}computeAttachmentOrigin(I,
M){return this.graphicsCore?.computeAttachmentOrigin(I,M)}notifyGraphicGeometryChanged(I){this.graphicsCore.notifyGraphicGeometryChanged(I)}notifyGraphicVisibilityChanged(I){this.graphicsCore.notifyGraphicVisibilityChanged(I)}getRenderingInfo(I,M,S){S=t.getRenderingInfo(I,{renderer:M,arcade:S});if(S?.color){const N=S.color;N[0]/=255;N[1]/=255;N[2]/=255}null!=S&&null!=M&&this._randomRotationRenderers?.has(M)&&(M=this._randomRotationRenderers.get(M),I=I.attributes[M],M=new c.XXH(0),M.updateFloatArray([I]),
M.updateUint8Array([173]),S.heading=8.381E-8*M.digest());return S}getRenderingInfoAsync(I,M,S,N){return t.getRenderingInfoAsync(I,{renderer:M,arcade:S,...N})}getSymbolLayerSize(I,M){return this.graphicsCore?.getSymbolLayerSize(I,M)}setObjectIdVisibility(I,M){this.graphicsCore?.setObjectIdVisibility(I,M)}refreshFilter(){null!=this.filterVisibility&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(I){return this.graphicsCore?.getGraphics3DGraphicByObjectId(I)}_updateClippingExtent(){const I=
this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(I,this.owner.view.spatialReference)&&(this.updateClippingExtent(I)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.addHandles(e.watch(()=>this.suspendResumeExtentMode,()=>{this.removeHandles("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.addHandles([e.watch(()=>this.graphicsCore.computedExtent,I=>this._updateSuspendResumeExtent(I),
e.initial),e.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.addHandles([e.when(()=>this.dataExtent,I=>this._updateSuspendResumeExtent(I),e.initial),e.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:m.neverReached(this.suspendResumeExtentMode)}},e.initial))}_updateSuspendResumeExtent(I){I?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(I,
this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(I,M){const S=this.owner.view.spatialReference;if(!I.spatialReference.equals(S)){if(!v.canProject(I,S))return;I=v.project(I,S)}return L.enlargeExtent(I,M,D.suspendResumeExtentOptimism,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(I){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(I);null!=this.scaleVisibility&&this.scaleVisibility.setExtent(I)}};b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,
"type",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"owner",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"layer",null);b.__decorate([n.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"dataUpdating",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"renderer",null);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"updateClippingExtent",void 0);b.__decorate([n.property({constructOnly:!0})],
a.Graphics3DFeatureProcessor.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"graphicsCore",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"filterVisibilityEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,
"frustumVisibilityEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"timeExtentEnabled",void 0);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"setUidToIdOnAdd",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibility",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,
"filterVisibility",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"elevationAlignment",null);b.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"frustumVisibility",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"objectStates",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"initializePromise",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"suspendResumeExtentMode",
null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"suspended",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,
"updating",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"featureStore",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"view",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"loadedGraphics",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,
"filter",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"slicePlaneEnabled",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([n.property()],a.Graphics3DFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([n.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"displayFeatureLimit",null);a.Graphics3DFeatureProcessor=
b.__decorate([x.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],a.Graphics3DFeatureProcessor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function b(c){const k=[];for(let m=0,d=c.length;m<d;m++){let f=c.charCodeAt(m);128>f?k.push(f):2048>f?k.push(192|f>>6,128|f&63):55296>f||57344<=f?k.push(224|f>>12,128|f>>6&63,128|f&63):(m++,f=65536+((f&1023)<<10|c.charCodeAt(m)&1023),k.push(240|f>>18,
128|f>>12&63,128|f>>6&63,128|f&63))}return new Uint8Array(k)}class h{constructor(c){this._seed=c;this._totallen=0;this._bufs=[];this.init()}init(){this._bufs=[];this._totallen=0;return this}updateFloatArray(c){const k=[];for(const m of c)isNaN(m)?k.push("NaN"):Infinity===m?k.push("Infinity"):-Infinity===m?k.push("-Infinity"):0===m?k.push("0"):k.push(m.toString(16));this.update(b(k.join("")))}updateIntArray(c){c=Int32Array.from(c);this.update(new Uint8Array(c.buffer))}updateUint8Array(c){this.update(Uint8Array.from(c))}updateWithString(c){return this.update(b(c))}update(c){this._bufs.push(c);
this._totallen+=c.length;return this}digest(){const c=new Uint8Array(this._totallen);let k=0;for(const m of this._bufs)c.set(m,k),k+=m.length;this.init();return this._xxHash32(c,this._seed)}_xxHash32(c,k=0){var m=k+374761393&4294967295;let d=0;if(16<=c.length){m=[k+2654435761+2246822519&4294967295,k+2246822519&4294967295,k+0&4294967295,k-2654435761&4294967295];k=c.length-16;var f=0;for(d=0;(d&4294967280)<=k;d+=4){var g=d;g=m[f]+(2246822519*(c[g]+(c[g+1]<<8))+(2246822519*(c[g+2]+(c[g+3]<<8))<<16))&
4294967295;g=g<<13|g>>>19;m[f]=2654435761*(g&65535)+(2654435761*(g>>>16)<<16)&4294967295;f=f+1&3}m=(m[0]<<1|m[0]>>>31)+(m[1]<<7|m[1]>>>25)+(m[2]<<12|m[2]>>>20)+(m[3]<<18|m[3]>>>14)&4294967295}m=m+c.length&4294967295;for(k=c.length-4;d<=k;d+=4)f=d,m=m+(3266489917*(c[f]+(c[f+1]<<8))+(3266489917*(c[f+2]+(c[f+3]<<8))<<16))&4294967295,m=m<<17|m>>>15,m=668265263*(m&65535)+(668265263*(m>>>16)<<16)&4294967295;for(;d<c.length;++d)m+=374761393*c[d],m=m<<11|m>>>21,m=2654435761*(m&65535)+(2654435761*(m>>>16)<<
16)&4294967295;m^=m>>>15;m=(2246822519*(m&65535)&4294967295)+(2246822519*(m>>>16)<<16);m^=m>>>13;m=(3266489917*(m&65535)&4294967295)+(3266489917*(m>>>16)<<16);m^=m>>>16;return 0>m?m+4294967296:m}}a.XXH=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/DisplayFeatureLimit":function(){define(["exports"],function(a){class b{constructor(h,c,k){this.maximumTotalNumberOfVertices=h;this.maximumNumberOfFeatures=c;this.averageSymbolComplexity=k}}a.DisplayFeatureLimit=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../core/Logger ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/handleUtils ../../../../core/MapUtils ../../../../core/maybe ../../../../core/MemCache ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToVector ../../../../geometry/projection/projectXYZToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/PromiseQueue ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../support/basemapUtils ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./defaultSymbolComplexity ./DisplayFeatureLimit ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicsCorePerformanceInfo ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolMemory ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/WebGLLayer ../../../layers/support/popupUtils ../../../support/Scheduler ../../../support/Yield ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja,oa,ra,ta,ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La,Na,Wa,Ia,Oa,Ua,Va,Ra,bb){var gb;const db=z.create(),ka=S.create();a.Graphics3DCore=gb=class extends w{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){this._spatialIndex||(this._spatialIndex=new pa.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,
hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?va.UpdatePolicy.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(this.dataUpdating||
this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}get dataUpdating(){return!!(0<this._graphicsWaitingForSymbol.size||0<this._pendingUpdates.size||this._spatialIndex?.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||0<this._loadingSymbols)}get running(){return 0<this._pendingUpdates.size||
!!this._spatialIndex?.updating||this._dataUpdateQueue.running||this._updateQueue.running}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){var na=this.owner&&this.owner.view&&this.owner.view.qualitySettings,za=na?.graphics3D.maxTotalNumberOfFeatures??0;const Da=
na?.graphics3D.maxNumberOfDrawCalls??0,Ma=na?.graphics3D.maxTotalNumberOfVertices??0,Xa=this.averageSymbolComplexity;na=Math.max(na?.graphics3D.minTotalNumberOfFeatures??0,Math.min(za,Math.ceil(Ma/Math.max(1,Xa?.verticesPerFeature??1)),Xa&&0<Xa.drawCallsPerFeature&&0<Da?Da/Xa.drawCallsPerFeature:za));return(za=this._get("displayFeatureLimit"))&&za.maximumTotalNumberOfVertices===Ma&&za.averageSymbolComplexity===Xa&&za.maximumNumberOfFeatures===na?za:new ha.DisplayFeatureLimit(Ma,na,Xa)}get averageSymbolComplexity(){const na=
da.averageSymbolComplexities(this._symbolComplexities),za=this._get("averageSymbolComplexity");return 0===na.numComplexities||null!=za&&(na.estimated&&(za.verticesPerFeature>=na.verticesPerFeature||za.verticesPerCoordinate>=na.verticesPerCoordinate||za.drawCallsPerFeature>=na.drawCallsPerFeature)||za.verticesPerFeature===na.verticesPerFeature&&za.verticesPerCoordinate===na.verticesPerCoordinate&&za.drawCallsPerFeature===na.drawCallsPerFeature)?za:na}get usedMemory(){const na=null!=this.averageSymbolComplexity&&
this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,za=this._getSymbolComplexitiesUsed().reduce((ab,Ja)=>ab+Ja.memory.resourceBytes,0),Da=this.owner.view._stage.renderer,Ma=this.owner.view.basemapTerrain.overlayManager.renderer,Xa=Array.from(this._symbols.values()).reduce((ab,Ja)=>ab+(Ja?.symbolLayers.reduce((Qa,Sa)=>Qa+(Sa?.materials.reduce((cb,eb)=>eb?cb+(Da.plugins.getMaterialRenderer(eb)?.usedMemory??0)+Ma.getMemoryForMaterial(eb):cb,0)??0),0)??
0),0);return this._usedMemory+na+za+Xa}get usedMemoryPerGraphic(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):null!=this.averageSymbolComplexity?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*
this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(na){if("web-style"===na.type)return na.clone();var za=this._symbolConversionCache.get(na.id);if(null!=za)return za;za=X.to3D(na,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(na)});const Da=za.symbol||null;null==
Da&&za.error&&u.getLogger(this).error(za.error.message);this._symbolConversionCache.set(na.id,Da);return Da}_getSymbolComplexitiesUsedOrRenderer(na){if(null==na)return[];var za=na.getSymbols(),Da="backgroundFillSymbol"in na?na.backgroundFillSymbol:null;if(!Da&&!za?.length)return[];na=[];Da=this._getSymbolComplexityUsedOrRenderer(Da);null!=Da&&na.push(Da);for(const Ma of za)za=this._getSymbolComplexityUsedOrRenderer(Ma),null!=za&&na.push(za);return na}_getSymbolComplexityUsedOrRenderer(na){if(null==
na)return null;const za=this._symbols.get(na.id);if(null!=za)return za.complexity;na=this._getConvertedSymbol(na);return null!=na?da.defaultSymbolComplexity(na):null}_getSymbolComplexitiesUsed(){const na=[];this._symbols.forEach(za=>{null!=za&&na.push(za.complexity)});return na}get _objectIdField(){return this.layer.objectIdField}constructor(na){super(na);this._propertiesPool=new qa.PropertiesPool({computedExtent:Oa},this);this.currentRenderer=this.computedExtent=null;this.rendererHasGeometryOperations=
!1;this._graphicStateTracking=null;this.graphics3DGraphics=new Map;this.stage=this.stageLayer=null;this._graphicsDrapedUids=new Set;this._graphicsBySymbol=new Map;this._symbolConversionCache=new Map;this._symbols=new Map;this._graphicsWithoutSymbol=new Map;this._graphicsWaitingForSymbol=new Map;this._graphicsUpdateId=0;this._frameTaskHandle=Wa.ImmediateTask;this._dataUpdateQueue=new O.PromiseQueue;this._updateQueue=new O.PromiseQueue;this._suspendSymbolCleanup=!1;this._spatialIndex=this._filterVisibility=
this._scaleVisibility=this._initializeAbortController=this._elevationInfoChangeAbortController=this._rendererChangeAbortController=this._arcadeOnDemand=null;this.extentPadding=0;this._sharedSymbolResourcesOwnerHandle=this._stageLayerElevationProvider=this._viewElevationProvider=this._objectStates=this._labeler=this._deconflictor=this._featureStore=this._updatingPendingLoadedGraphicsChange=null;this._whenGraphics3DGraphicRequests={};this._pendingUpdates=new Map;this._pendingRemoves=this._pendingAdds=
this._numberOfGraphicsProvidingElevation=this._numberOfGraphics=0;this._applyPendingRemovesFirst=!1;this._loadingSymbols=0;this._pendingUpdatesPool=new E({allocator:za=>za||new sb,deallocator:za=>{za.clear();return za}});this._geometryWarningLogged=this._symbolWarningLogged=!1;this._objectIdInvisibleSet=new Set;this._whenSymbolRemoved=new E;this.preferredUpdatePolicy=va.UpdatePolicy.SYNC;this._forcedUpdatePolicy=null;this.elevationFeatureExpressionEnabled=!0;this.layer=this.owner=null;this.graphicSymbolSupported=
!0;this.getRenderingInfoWithoutRenderer=!1;this.setUidToIdOnAdd=!0;this.hasM=this.hasZ=null;this._usedMemory=0;this._startCreateGraphics=this._visible=!1;this._unusedSymbolsCache=na.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",za=>za.destroy());this.symbolCreationContext=new W.Graphics3DSymbolCreationContext(na.owner.view.resourceController.scheduler,(za,Da)=>this._updateQueue.push(za,Da))}initialize(){this._featureStore=new ea.Graphics3DFeatureStore({objectIdField:this.owner.layer?.objectIdField,
hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Da=>this.graphics3DGraphics.forEach(Da)});const na=(Da,Ma,Xa)=>this.spatialIndex.queryGraphicUIDsInExtent(Da,Ma,Xa),{componentFactories:za}=this;null!=za.elevationAlignment&&(this._elevationAlignment=za.elevationAlignment(this,na));null!=za.scaleVisibility&&(this._scaleVisibility=za.scaleVisibility(this,na));null!=
za.filterVisibility&&(this._filterVisibility=za.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Da=>this.modifyGraphics3DGraphicVisibilities(Ma=>Ma.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,aa.VisibilityFlag.FILTER,Da(T.getObjectId(Ma.graphic,this._objectIdField)))),setAllFeaturesVisibility:Da=>this.modifyGraphics3DGraphicVisibilities(Ma=>Ma.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,aa.VisibilityFlag.FILTER,Da)),clearFeaturesVisibility:()=>
this.modifyGraphics3DGraphicVisibilities(Da=>Da.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,aa.VisibilityFlag.FILTER,!0))}));null!=za.deconflictor&&(this._deconflictor=za.deconflictor(this));null!=za.labeler&&null!=this._scaleVisibility&&(this._labeler=za.labeler(this,this._scaleVisibility));null!=za.objectStates&&(this._objectStates=za.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()}async _initializeAsync(){const na=this._initializeAbortController?.signal,
za=this.owner.view;this._viewElevationProvider=new fa.ViewElevationProvider(this._viewSpatialReference,za);this._initializeStage(za,this.layer.uid);var Da=za.sharedSymbolResources;this.symbolCreationContext.sharedResources=Da;this._sharedSymbolResourcesOwnerHandle=Da.addGraphicsOwner(this.owner);null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Da.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=
za.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new ua.GridLocalOriginFactory(za.renderSpatialReference);this.symbolCreationContext.elevationProvider=za.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Ma=>this.notifyGraphicGeometryChanged(Ma);this.symbolCreationContext.notifyGraphicVisibilityChanged=Ma=>this.notifyGraphicVisibilityChanged(Ma);Da=Z.extractExpressionInfo(this.layer.elevationInfo,
this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(Da,this._viewSpatialReference,na,u.getLogger(this));A.throwIfAborted(na);this.symbolCreationContext.screenSizePerspectiveEnabled=za.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;
this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Ma}=this;this.symbolCreationContext.drapeSourceRenderer=za.basemapTerrain.overlayManager.registerGeometryDrapeSource(Ma);this.addHandles(t.makeHandle(()=>za.basemapTerrain.overlayManager.unregisterDrapeSource(Ma)))}this.addHandles([B.watch(()=>this.suspendedOrOutsideOfView,()=>this._updateQueue.unshift(()=>this._updateLayerVisibility(),null)),
B.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled],()=>{const Ma=za.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Ma!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Ma,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),B.watch(()=>this.owner.slicePlaneEnabled,Ma=>this._slicePlaneEnabledChange(!!Ma)),B.watch(()=>this.owner.view.state?.rasterPixelRatio,
()=>this._pixelRatioChange()),B.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Ma=>this._physicalBasedRenderingChange(Ma)),B.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Ma=>this._skipHighSymbolLoDsChange(Ma)),B.when(()=>za.basemapTerrain?.tilingScheme,Ma=>{Ma.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==za.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=za.basemapTerrain.spatialReference);
this.hasHandles("loaded-graphics")?this.recreateAllGraphics():this.addHandles([B.on(()=>this.owner?.loadedGraphics,"change",Xa=>{this._graphicsCollectionChanged(Xa);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),B.watch(()=>this.effectiveUpdatePolicy,Ma=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=Ma);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===
va.UpdatePolicy.ASYNC;Ma===va.UpdatePolicy.SYNC&&this.runTask(Wa.noBudget)},B.syncAndInitial)]);this._frameTaskHandle=za.resourceController.scheduler.registerTask(Wa.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this.addHandles(B.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&
(this._initializeAbortController.abort(),this._initializeAbortController=null)}destroy(){this._unusedSymbolsCache.destroy();this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTaskHandle.remove();this._frameTaskHandle=Wa.ImmediateTask;this._dataUpdateQueue.cancelAll();this._updateQueue.cancelAll();this.owner.view?.deconflictor?.removeGraphicsOwner(this);this.owner.view?.labeler?.removeGraphicsOwner(this);this._elevationAlignment=y.destroyMaybe(this._elevationAlignment);
this._scaleVisibility=y.destroyMaybe(this._scaleVisibility);this._filterVisibility=y.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=null;this._objectStates=y.destroyMaybe(this._objectStates);this.clear();this._featureStore=y.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=y.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=y.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stageLayer=y.destroyMaybe(this.stageLayer),
this.stage=null);this._set("owner",null);for(const na in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[na].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=y.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=y.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=
y.destroyMaybe(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted();null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(na=>na.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(y.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();
this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("dataUpdating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")}_initializeStage(na,za){this.stage=na._stage;this.stageLayer=new La.WebGLLayer(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},za);na=this.stageLayer.events;na.on("transformationChanged",
Da=>this.notifyGraphicGeometryChanged(Da.graphicUid));na.on("shaderTransformationChanged",Da=>this.notifyGraphicGeometryChanged(Da.graphicUid));na.on("visibilityChanged",Da=>this.notifyGraphicVisibilityChanged(Da.graphicUid));na.on("geometryAdded",Da=>this.notifyGraphicGeometryChanged(Da.object.graphicUid));na.on("geometryRemoved",Da=>this.notifyGraphicGeometryChanged(Da.object.graphicUid));na.on("attributesChanged",Da=>Ga.affectsGeometry(Da.attribute)&&this.notifyGraphicGeometryChanged(Da.object.graphicUid))}notifyGraphicGeometryChanged(na){null!=
this._graphicStateTracking&&null!=na&&(na=this.graphics3DGraphics.get(na))&&this._graphicStateTracking.updateGraphicGeometry(na)}notifyGraphicVisibilityChanged(na){null!=this._graphicStateTracking&&null!=na&&(na=this.graphics3DGraphics.get(na))&&this._graphicStateTracking.updateGraphicVisibility(na)}_updateLayerVisibility(){var na=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;na=!this.suspendedOrOutsideOfView&&!na;na!==this._visible&&((this._visible=na)?(this.stageLayer.pickable=
!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}_updateStageLayerVisibility(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)}getGraphics3DGraphicById(na){return null!=na?this.graphics3DGraphics.get(na):void 0}getGraphics3DGraphicByObjectId(na){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(na):null}_getGraphicObjectID(na,za=this.owner.layer?.objectIdField){return T.getObjectId(na,
za)}get graphics3DGraphicsByObjectID(){const na=this.owner.layer?.objectIdField;if(na){var za=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var Ma=this._getGraphicObjectID(Da.graphic,na);null!=Ma&&za.set(Ma,Da)}});return za}}get labelsEnabled(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}async updateLabelingInfo(na){const za=this._deconflictor&&this._deconflictor.labelingInfoChange(na);na=this._labeler&&this._labeler.labelingInfoChange(na);await Promise.allSettled([za,na])}updateVisibilityInfo(){this._deconflictor&&
this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()}get symbolUpdateType(){if(0<this._pendingUpdates.size)return"unknown";let na=0,za=0;return r.someMap(this._symbols,(Da,Ma)=>{if(null!=Da){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this._graphicsBySymbol.has(Ma)&&(za+=Da.fast,na+=Da.slow)}return!1})?"unknown":0<=za&&0===na?"fast":0<=na&&0===za?"slow":"mixed"}runTask(na){this._dataUpdateQueue.runTask(na);this._updateQueue.runTask(na);this._applyPendingUpdates(na);
this.notifyChange("running");this.running||this.notifyChange("dataUpdating");this.notifyChange("updatingRemaining");if(!na.hasProgressed)return Ia.Yield}setObjectIdVisibility(na,za){za?this._objectIdInvisibleSet.delete(na):this._objectIdInvisibleSet.add(na);na=this._findGraphics3DGraphicByObjectId(na);null!=na&&this._updateUserVisibility(na)}_findGraphics3DGraphicByObjectId(na){return r.findInMap(this.graphics3DGraphics,za=>this._getGraphicObjectID(za.graphic)===na)}_updateUserVisibility(na){if(null==
na)return!1;var za=na.graphic;const Da=this._getGraphicObjectID(za);za=za.visible&&!this.owner.suspended&&(null==Da||!this._objectIdInvisibleSet.has(Da));return na.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,aa.VisibilityFlag.USER,za)}_whenGraphics3DGraphic(na){var za=this.graphics3DGraphics.get(na.uid);if(za)return Promise.resolve(za);if(za=this._whenGraphics3DGraphicRequests[na.uid])return za.promise;za=A.createResolver();this._whenGraphics3DGraphicRequests[na.uid]=za;return za.promise}async _boundsForGraphics3DGraphic(na,
za){const Da=this._viewSpatialReference,Ma=this.owner.view.renderSpatialReference,Xa=this.owner.view.basemapTerrain.spatialReference;na=await na.getProjectedBoundingBox((Ja,Qa,Sa)=>K.projectBuffer(Ja,Ma,Qa,Ja,Da,Qa,Sa),(Ja,Qa,Sa)=>K.projectBuffer(Ja,Xa,Qa,Ja,Da,Qa,Sa),this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=za?!!za.useViewElevation:!1,minDemResolution:null!=za?za.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,za?.signal);
if(!na)return null;za=na.boundingBox;if(na.requiresDrapedElevation){var ab=this.symbolCreationContext.elevationProvider;ab&&(S.center(za,db),ab=ab.getElevation(db[0],db[1],0,Da,"ground")??0,za[2]=Math.min(za[2],ab),za[5]=Math.max(za[5],ab))}return{boundingBox:za,screenSpaceObjects:na.screenSpaceObjects}}async whenGraphicBounds(na,za){await B.whenOnce(()=>this.owner?.loadedGraphics);const Da=this.owner.layer?.objectIdField;var Ma=this.owner.loadedGraphics.find(Xa=>Xa===na?!0:null!=Da&&null!=Xa.attributes&&
na.attributes&&Xa.attributes[Da]===na.attributes[Da]);if(!Ma)throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");Ma=await this._whenGraphics3DGraphic(Ma);return this._boundsForGraphics3DGraphic(Ma,za)}computeAttachmentOrigin(na,za){na=this.graphics3DGraphics.get(na.uid);if(!na)return null;var Da=na.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;C.set(tb,0,0,0);na=0;if(0<Da.render.num){if(!I.projectVectorToVector(Da.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,
xa,za))return null;C.add(tb,tb,xa);na++}if(0<Da.draped.num){const [Ma,Xa]=Da.draped.origin;Da=this._viewElevationProvider.getElevation(Ma,Xa,"ground")??0;C.set(xa,Ma,Xa,Da);if(!I.projectVectorToVector(xa,this._viewElevationProvider.spatialReference,xa,za))return null;C.add(tb,tb,xa);na++}1<na&&C.scale(tb,tb,1/na);return new Ua({x:tb[0],y:tb[1],z:tb[2],spatialReference:za})}getSymbolLayerSize(na,za){var Da=this._symbols.get(na.id);if(null==Da)throw new p("internal:symbol-not-part-of-view","Symbol is not part of this view");
na=na.symbolLayers.indexOf(za);if(-1===na)throw new p("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(na);if(null==Da)throw new p("internal:missing-size","Symbol layer has no valid size");return Da}_graphicsCollectionChanged(na){this._startCreateGraphics&&(this.add(na.added),this.remove(na.removed))}graphicUpdateHandler(na){const za=na.graphic.uid,Da=this.graphics3DGraphics.get(za);if(null!=Da||null!=this._graphicsWithoutSymbol.get(za))switch(na.property){case "visible":this._graphicUpdateVisibleHandler(Da);
break;case "geometry":this._graphicUpdateGeometryHandler(Da,na);break;case "symbol":this._graphicUpdateSymbolHandler(Da,na);break;case "origin-transform":this._graphicUpdateTransformHandler(Da,na)}}_graphicUpdateGeometryHandler(na,za){this._graphicUpdateGeometryOrTransformHandler(na,za,()=>null!=za.newValue&&null!=na&&na.graphics3DSymbol.updateGeometry(na,za.newValue));const Da=za.graphic.geometry;null!=Da&&this._expandComputedExtent(Da)}_graphicUpdateTransformHandler(na,za){const Da=za.graphic.geometry;
this._graphicUpdateGeometryOrTransformHandler(na,za,()=>null!=za.newValue&&null!=na&&null!=Da&&na.graphics3DSymbol.updateTransform(na,Da.spatialReference,za.newValue,za.action))}_graphicUpdateGeometryOrTransformHandler(na,za,Da){if(null==za.graphic.geometry)this._recreateGraphic(za.graphic);else if(null==na){if(na=za.graphic.symbol?.id)if(na=this._symbols.get(na),null!=na&&na.loadStatus===Ca.LoadStatus.LOADING)return;this._recreateGraphic(za.graphic)}else Da()||this._recreateGraphic(na.graphic)}_graphicUpdateSymbolHandler(na,
za){var Da=za.graphic;const Ma=null!=na?na.graphics3DSymbol:null!=za.oldValue?this._symbols.get(za.oldValue.id):null;if(null==Ma||null==za.newValue)this._recreateGraphic(Da);else{var Xa=Ma.symbol;za=this._getConvertedSymbol(za.newValue);if(null!=za&&(za.type!==Xa.type||"web-style"===za.type)||"web-style"===Xa.type)this._recreateGraphic(Da);else{var ab=this._graphicsBySymbol.get(Xa.id);if(ab&&1!==ab.size)this._recreateGraphic(Da);else if(ab=L.diff(Xa,za),null==ab)this._updateSymbolMapping(Xa.id,za);
else if(ab={diff:ab,graphics3DGraphicPatches:[],symbolStatePatches:[]},Ma.prepareSymbolPatch(ab),L.isEmpty(ab.diff)){var Ja=this._getRenderingInfo(Da);if(null==Ja)this._recreateGraphic(Da);else{Da=Ma.extentPadding;for(const Qa of ab.symbolStatePatches)Qa();Da!==Ma.extentPadding&&this._recomputeExtentPadding();if(null!=na)for(const Qa of ab.graphics3DGraphicPatches)Qa(na,Ja);this._updateSymbolMapping(Xa.id,za)}}else this._recreateGraphic(Da)}}}_graphicUpdateVisibleHandler(na){this._updateUserVisibility(na)&&
(this._labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}recreateGraphics(na){this._suspendSymbolCleanup=!0;this.remove(na);this.add(na);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===va.UpdatePolicy.SYNC&&this._cleanupSymbols()}_recreateGraphic(na){this.recreateGraphics([na])}_beginGraphicUpdate(na){const za=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(na.uid,za);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating");
return za}_endGraphicUpdate(na){na&&(this._graphicsWaitingForSymbol.delete(na.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let na=0;this._symbols.forEach(za=>{null!=za&&(na=Math.max(na,za.extentPadding))});this._set("extentPadding",na)}_expandComputedExtent(na){var za=na.spatialReference;T.computeAABB(na,ka);na=this._viewSpatialReference;var Da=gb.tmpVec;!V.equals(za,na)&&M.projectXYZToVector(ka[0],ka[1],0,za,Da,
na)&&(ka[0]=Da[0],ka[1]=Da[1],M.projectXYZToVector(ka[3],ka[4],0,za,Da,na),ka[3]=Da[0],ka[4]=Da[1]);if(isFinite(ka[0])&&isFinite(ka[3])&&isFinite(ka[1])&&isFinite(ka[4])){za=this.computedExtent;Da=null;var Ma=isFinite(ka[2])&&isFinite(ka[5]),Xa=Ma&&(null==za?.zmin||ka[2]<za.zmin);Ma=Ma&&(null==za?.zmax||ka[5]>za.zmax);if(za){if(ka[0]<za.xmin||ka[1]<za.ymin||ka[3]>za.xmax||ka[4]>za.ymax||Xa||Ma)Da=this._propertiesPool.get("computedExtent"),Da.xmin=Math.min(ka[0],za.xmin),Da.ymin=Math.min(ka[1],za.ymin),
Da.xmax=Math.max(ka[3],za.xmax),Da.ymax=Math.max(ka[4],za.ymax),Da.spatialReference=na}else Da=this._propertiesPool.get("computedExtent"),Da.xmin=ka[0],Da.ymin=ka[1],Da.xmax=ka[3],Da.ymax=ka[4],Da.spatialReference=na;Da&&(Xa&&(Da.zmin=ka[2]),Ma&&(Da.zmax=ka[5]),this._set("computedExtent",Da))}}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();
const na=new AbortController;this._elevationInfoChangeAbortController=na;const za=Z.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(za,this._viewSpatialReference,na.signal,u.getLogger(this));A.throwIfAborted(na.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Da,Ma,Xa)=>{Da.globalPropertyChanged("elevationInfo",
Ma)?Ma.forEach(ab=>{const Ja=ab.graphic;ab=ab.labelLayers;for(const Qa of ab)Qa.graphics3DSymbolLayer.updateGraphicElevationContext(Ja,Qa)}):this._recreateSymbol(Xa)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),
this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new Ba.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear();
null!=this._filterVisibility&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0;this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(na=
!1){if(this._startCreateGraphics){var {loadedGraphics:za,view:Da}=this.owner,Ma=Da.basemapTerrain.tilingScheme&&za?.length?za.toArray():null;!na&&Ma||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Ma&&(na?this.add(Ma):this.recreateGraphics(Ma))}}_recreateSymbol(na){var za=
this._graphicsBySymbol.get(na);const Da=[];za&&(za.forEach((Ma,Xa)=>{const ab=Ma.usedMemory;this._conditionalRemove(Ma,Xa);this._spatialIndex?.remove(Ma);Da.push(Ma.graphic);Ma.destroy();this._removeGraphics3DGraphic(Xa,ab);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(na,new Map));za=this._symbols.get(na);y.destroyMaybe(za);this._symbols.delete(na);this.add(Da)}_recreateGraphicsForSymbol(na){if(na=this._graphicsBySymbol.get(na)){const za=[];
na.forEach(Da=>za.push(Da.graphic));this.recreateGraphics(za)}}_conditionalRemove(na,za){this._graphicsDrapedUids.delete(za);this._objectStates?.removeGraphic(na);this._labeler?.removeGraphic(na);this._deconflictor?.removeGraphic(na);null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(na)}add(na){na&&0!==na.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(na)===va.UpdatePolicy.ASYNC?this._addDelayed(na):this._addImmediate(na),this.notifyChange("dataUpdating")):
u.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(na){if(this.effectiveUpdatePolicy===va.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const za of na)if(null!=za.geometry&&"mesh"===za.geometry.type&&!za.geometry.loaded)return va.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy}_addImmediate(na){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const za of na)this._addGraphic(za,
this._getRenderingInfo(za,u.getLogger(this)),va.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()}_addDelayed(na){for(const za of na){na=za.uid;let Da=this._pendingUpdates.get(na);Da?Da.add?Da.state!==mb.NEW&&Da.abortController?.abort():this._pendingAdds++:(Da=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(na,Da));Da.add=za}this.notifyChange("running");this.notifyChange("updatingRemaining");
this.notifyChange("dataUpdating")}remove(na){this.effectiveUpdatePolicy===va.UpdatePolicy.ASYNC?this._removeDelayed(na):this._removeImmediate(na);this.notifyChange("dataUpdating")}_removeImmediate(na){for(const za of na)this._removeGraphic(za);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_removeDelayed(na){for(const Da of na){na=Da.uid;var za=this._pendingUpdates.get(na);za?za.add&&(za.remove?za.add=null:this._pendingUpdates.delete(na),
za.state===mb.LOADING&&za.abortController?.abort(),this._pendingAdds--):(za=this._pendingUpdatesPool.pushNew(),za.remove=Da,this._pendingUpdates.set(na,za),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining");this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&u.getLogger(this).warn("pendingAdds/Removes in inconsistent state!");
this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1}_applyPendingUpdates(na){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),na.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [za,Da]of this._pendingUpdates){if(na.done){this._applyPendingRemovesFirst=!0;break}if(Da.remove&&!Da.add&&(this._pendingRemoves--,na.madeProgress(),this._removeGraphic(Da.remove),
Da.remove=null,this._pendingUpdates.delete(za),0===this._pendingRemoves))break}}for(const [za,Da]of this._pendingUpdates){if(na.done)break;Da.add&&Da.state===mb.NEW&&this._processPendingUpdateNew(Da);let Ma=this.effectiveUpdatePolicy;!Da.remove||Da.add&&Da.state!==mb.READY||(this._pendingRemoves--,na.madeProgress(),this._removeGraphic(Da.remove),Da.remove=null,Ma=va.UpdatePolicy.SYNC);if(Da.add)switch(Da.state){case mb.READY:this._addGraphic(Da.add,Da.renderingInfo,Ma);Da.add=null;this._pendingAdds--;
na.madeProgress();break;case mb.REJECTED:Da.add=null,this._pendingAdds--}null==Da.remove&&null==Da.add&&this._pendingUpdates.delete(za)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}}_processPendingUpdateNew(na){if(na.add){var za=na.add.geometry;null==za||"mesh"!==za.type||za.loaded?this._processPendingUpdateNewRenderingInfo(na):this._processPendingUpdateNewMesh(na,za)}else na.state=mb.READY}async _processPendingUpdateNewMesh(na,
za){na.state=mb.LOADING;na.abortController=new AbortController;const Da=na.abortController.signal;try{await za.load({signal:Da})}catch(Ma){return this._processPendingUpdateNewError(na,Ma)}na.abortController=null;this._processPendingUpdateNewRenderingInfo(na)}_processPendingUpdateNewError(na,za){na.abortController=null;A.isAbortError(za)?na.state=mb.NEW:na.state=mb.REJECTED}async _processPendingUpdateNewRenderingInfo(na){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)na.renderingInfo=
this._getRenderingInfo(na.add,u.getLogger(this));else{na.state=mb.LOADING;na.abortController=new AbortController;var za=null;try{za=await this._getRenderingInfoAsync(na.add,{signal:na.abortController.signal})}catch(Da){na.abortController=null;A.isAbortError(Da)?na.state=mb.NEW:na.state=mb.REJECTED;return}null==za?.symbol?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,u.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),na.renderingInfo=null):na.renderingInfo=
za}na.state=mb.READY}_addGraphic(na,za,Da){this._graphicsWithoutSymbol.set(na.uid,na);if(null!=za?.symbol&&T.hasGeometry(na)){if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){const eb=R.isBasemapLayer(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(na.objectId,na.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!eb&&Na.hasPopupTemplate(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}var Ma=
this.getOrCreateGraphics3DSymbol(za.symbol,za.renderer);if(null!=Ma){this._expandComputedExtent(na.geometry);var Xa=this._beginGraphicUpdate(na),ab=new ca.Graphics3DGraphicCreationContext(na,za,this.layer),Ja=!1,Qa=eb=>{eb===Ma.symbol.id&&(Ja=!0)};this._whenSymbolRemoved.push(Qa);var Sa=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Qa);if(this._graphicsWaitingForSymbol.get(na.uid)!==Xa||Ja||Ma.destroyed||this.graphicSymbolSupported&&na.symbol&&na.symbol.id!==
Ma.symbol.id)--Ma.referenced,this._cleanupSymbols();else{const eb=this._createGraphics3DGraphic(Ma,ab);this._spatialIndex&&null!=eb&&this._spatialIndex.add(eb);--Ma.referenced;this._endGraphicUpdate(na)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},cb=eb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(Qa),Ja||(A.isAbortError(eb)?this.add([na]):Ma.destroyed||this._endGraphicUpdate(na)))};++this._loadingSymbols;Da===va.UpdatePolicy.ASYNC?
Ma.load(()=>this._dataUpdateQueue.push(Sa,null),eb=>this._dataUpdateQueue.push(()=>cb(eb),null)):Ma.load(Sa,cb)}}}_removeGraphic(na){na=na.uid;const za=this.graphics3DGraphics.get(na);if(za){za.graphics3DSymbol.onRemoveGraphic(za);const Da=za.usedMemory,Ma=za.isElevationSource;this._conditionalRemove(za,na);this._spatialIndex?.remove(za);this._graphicsBySymbol.get(za.graphics3DSymbol.symbol.id)?.delete(na);this._graphicsWithoutSymbol.delete(na);this._removeGraphics3DGraphic(na,Da,Ma);za.destroy();
this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(na),this._graphicsWaitingForSymbol.delete(na),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(na){if(na instanceof Va||na instanceof Ra){const za=this.symbolCreationContext.layer;return za.labelingInfo?za.labelingInfo.some(Da=>Da.symbol===na):!1}return!1}_hasValidSymbolCreationContext(na){return na instanceof Va&&!this._hasLabelingContext(na)?(u.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0}_getRenderingInfo(na,za){const Da=na.geometry;if(null==Da)return za&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,za.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!J.canProjectWithoutEngine(Da.spatialReference,this._viewSpatialReference))return za&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,za.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&
null!=na.symbol)return za&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,za.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;na=this.rendererHasGeometryOperations?ia.hydrateGraphic(na,this.layer):na;na=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(na,this.currentRenderer,this._arcadeOnDemand):{symbol:na.symbol||ba.getDefaultSymbol3D(na.geometry)};return null==
na?.symbol?(za&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,za.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):na}_getRenderingInfoAsync(na,za){if(null==na.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,u.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=na.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,u.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),
null;na=this.rendererHasGeometryOperations?ia.hydrateGraphic(na,this.layer):na;return this.owner.getRenderingInfoAsync(na,this.currentRenderer,this._arcadeOnDemand,za)}_createGraphics3DSymbol(na,za){if(!this._hasValidSymbolCreationContext(na))return null;na=this._getConvertedSymbol(na);if(!na)return null;let Da;null!=za&&"backgroundFillSymbol"in za&&za.backgroundFillSymbol&&(za=X.to3D(za.backgroundFillSymbol,{ignoreDrivers:!0}),null!=za.symbol&&"web-style"!==za.symbol.type&&"cim"!==za.symbol.type&&
(Da=za.symbol.symbolLayers));const Ma=Y.make(na,this.symbolCreationContext,Da);Ma.load(()=>{const Xa=Ma.extentPadding;Xa>this.extentPadding&&this._set("extentPadding",Xa);this.notifyChange("averageSymbolComplexity")},()=>{});return Ma}getOrCreateGraphics3DSymbol(na,za){var Da=this._symbols.get(na.id);void 0===Da&&(Da=this._unusedSymbolsCache.pop(na.id),Da=null!=Da?Da:na instanceof bb?new ja.Graphics3DWebStyleSymbol(na,Ma=>this._dataUpdateQueue.push(Ma,null),Ma=>this._createGraphics3DSymbol(Ma,za)):
this._createGraphics3DSymbol(na,za),this._symbols.set(na.id,Da));null!=Da&&++Da.referenced;return Da}trackGraphicState(na){null==this._graphicStateTracking&&(this._graphicStateTracking=new ra.GraphicStateTracking(this));return this._graphicStateTracking.add(na)}_addGraphics3DGraphic(na){this._usedMemory+=na.usedMemory;this.graphics3DGraphics.set(na.graphic.uid,na);this._numberOfGraphics++;na.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_removeGraphics3DGraphic(na,
za,Da=!1){this._usedMemory-=za;this.graphics3DGraphics.delete(na);this._numberOfGraphics--;Da&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_createGraphics3DGraphic(na,za){const Da=za.graphic;this._graphicsWithoutSymbol.delete(Da.uid);if(!this._symbols.has(na.symbol.id))return this.add([Da]),null;if(this.graphics3DGraphics.has(Da.uid))return null;za=na.createGraphics3DGraphic(za);if(null==za)return null;this._addGraphics3DGraphic(za);
na=na.symbol.id;this._graphicsBySymbol.has(na)||this._graphicsBySymbol.set(na,new Map);this._graphicsBySymbol.get(na).set(Da.uid,za);za.isDraped&&this._graphicsDrapedUids.add(Da.uid);za.centroid=null;null!=Da.geometry&&"point"!==Da.geometry.type&&(za.centroid=ta.computeCentroid(Da.geometry,this._viewSpatialReference));this._updateUserVisibility(za);null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(za);null!=this._filterVisibility&&({defaultVisibility:na}=this._filterVisibility,za.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,
aa.VisibilityFlag.FILTER,na),na||this._filterVisibility.reapply());this._deconflictor?.addGraphic(za);this._labeler?.addGraphic(za);this._objectStates?.addGraphic(za);this._deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,za);za.initialize(this.stageLayer,this.owner);null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(za);if(na=this._whenGraphics3DGraphicRequests[Da.uid])delete this._whenGraphics3DGraphicRequests[Da.uid],na.resolve(za);return za}_abortRendererChange(){this._rendererChangeAbortController&&
(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)}async rendererChange(na){this._abortRendererChange();if(na!==this.currentRenderer)if(this._validateRenderer(na),null==na&&this._currentRendererChange(null,!1),U.isSupportedRenderer3D(na))if(null!=na&&na.arcadeRequired){var za=new AbortController;this._rendererChangeAbortController=za;const {arcadeUtils:Da}=await this._ensureArcade();A.throwIfAborted(za);const Ma=Da.hasGeometryOperations(na);Ma&&(await Da.enableGeometryOperations(),
A.throwIfAborted(za));this.effectiveUpdatePolicy===va.UpdatePolicy.ASYNC?await this._updateQueue.push(()=>this._currentRendererChange(na,Ma),za.signal):this._currentRendererChange(na,Ma);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===va.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=za=new AbortController,await this._updateQueue.push(()=>this._currentRendererChange(na,!1),za.signal),this._rendererChangeAbortController=null):this._currentRendererChange(na,!1);else this._currentRendererChange(na,
!1)}async _ensureArcade(){null==this._arcadeOnDemand&&(this._arcadeOnDemand=await P.loadArcade());return this._arcadeOnDemand}_currentRendererChange(na,za){this.currentRenderer=na;this.rendererHasGeometryOperations=za;this.symbolCreationContext.arcade=this._arcadeOnDemand;za=this.symbolCreationContext.renderer;if(na!==za)if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==na)this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Da=L.diff(za,
na);this._updateUnchangedSymbolMappings(Da,na,za);this.symbolCreationContext.renderer=na;null!=Da&&("complete"===Da.type?this.recreateAllGraphicsAndSymbols():"partial"===Da.type&&(this._applyRendererDiff(Da,na,za)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}}_diffHasSymbolChange(na){for(const za in na.diff)switch(za){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete na.diff[za];
break;default:return!0}return!1}_applySymbolSetDiff(na,za,Da){na=na||[];za=za||[];const Ma=[];for(const Xa of za){const ab=this._graphicsBySymbol.get(Xa.id);ab&&ab.forEach((Ja,Qa)=>{var Sa=Ja.graphic,cb=this.layer instanceof Q?this.layer:null;const eb=this._arcadeOnDemand;if(Xa!==Da.defaultSymbol||Da.getSymbol(ia.hydrateGraphic(Sa,cb),{arcade:eb})!==Da.defaultSymbol)cb=Ja.usedMemory,na.length||Da.defaultSymbol?Ma.push(Sa):this._graphicsWithoutSymbol.set(Qa,Sa),Sa=this.graphics3DGraphics.get(Qa),this._conditionalRemove(Sa,
Qa),Ja.destroy(),ab.delete(Qa),this._removeGraphics3DGraphic(Qa,cb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(Ja=>Ja(Xa.id))}if(na.length||Ma.length)this._graphicsWithoutSymbol.forEach(Xa=>Ma.push(Xa)),this._graphicsWithoutSymbol.clear(),this.add(Ma);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_applyUniqueValueRendererDiff(na,za,Da){const Ma=na.diff.defaultSymbol,Xa=na.diff.uniqueValueInfos;if(Ma||Xa){const ab=
Xa?Xa.added.map(Qa=>Qa.symbol).filter(q.isSome):[],Ja=Xa?Xa.removed.map(Qa=>Qa.symbol).filter(q.isSome):[];if(Xa)for(let Qa=0;Qa<Xa.changed.length;Qa++)ab.push(Xa.changed[Qa].newValue.symbol),Ja.push(Xa.changed[Qa].oldValue.symbol);Ma?(Da.defaultSymbol&&Ja.push(Da.defaultSymbol),za.defaultSymbol&&ab.push(za.defaultSymbol)):Da.defaultSymbol&&ab.length&&Ja.push(za.defaultSymbol);this._applySymbolSetDiff(ab,Ja,za);delete na.diff.defaultSymbol;delete na.diff.uniqueValueInfos;return!0}return!1}_calculateUnchangedSymbolMapping(na,
za,Da){if("unique-value"!==za?.type||"unique-value"!==Da?.type||null!=na&&"partial"!==na.type)return[];const Ma=ab=>null!=ab?ab.id:null;var Xa=na&&na.diff;na=Xa?.defaultSymbol;if(Xa=Xa&&Xa.uniqueValueInfos)Xa=Xa.unchanged.map(ab=>({oldId:Ma(ab.oldValue.symbol),newId:Ma(ab.newValue.symbol)}));else{Xa=[];for(const ab of Da.uniqueValueInfos??[]){const Ja=Ma(ab.symbol),Qa=za.uniqueValueInfos?.find(Sa=>Sa.value===ab.value);Qa&&Ja!==Ma(Qa.symbol)&&Xa.push({oldId:Ja,newId:Ma(Qa.symbol)})}}!na&&Da.defaultSymbol&&
Xa.push({oldId:Ma(Da.defaultSymbol),newId:Ma(za.defaultSymbol)});return Xa}_updateSymbolMapping(na,za){const Da=null!=za&&za?"string"===typeof za?za:za.id:null;if(null!=na&&na!==Da){var Ma=this._graphicsBySymbol.get(na);this._graphicsBySymbol.delete(na);void 0!==Ma&&this._graphicsBySymbol.set(Da,Ma);Ma=this._symbols.get(na);void 0!==Ma&&(this._symbols.delete(na),this._symbols.set(Da,Ma),null!=Ma&&(na="string"===typeof za?null:za,null!=na?Ma.symbol=na:Ma.symbol.id=Da))}}_updateUnchangedSymbolMappings(na,
za,Da){na=this._calculateUnchangedSymbolMapping(na,za,Da);for(const {oldId:Ma,newId:Xa}of na)this._updateSymbolMapping(Ma,Xa)}_applyRendererDiff(na,za,Da){if(this._diffHasSymbolChange(na))return!1;if(za instanceof n&&Da instanceof n&&this._applyUniqueValueRendererDiff(na,za,Da)&&0===Object.keys(na.diff).length)return!0;for(const [Ma]of this._graphicsBySymbol)if(Da=this._symbols.get(Ma),null!=Da)switch(Da.applyRendererDiff(na,za)){case ya.ApplyRendererDiffResult.RecreateSymbol:this._recreateSymbol(Ma);
break;case ya.ApplyRendererDiffResult.RecreateGraphics:this._recreateGraphicsForSymbol(Ma)}return!0}opacityChange(){this.forEachGraphics3DSymbol((na,za)=>na.globalPropertyChanged("opacity",za));this._updateStageLayerVisibility()}_slicePlaneEnabledChange(na){na!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=na,this.stageLayer.sliceable=na,this.forEachGraphics3DSymbol((za,Da)=>za.globalPropertyChanged("slicePlaneEnabled",Da)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),
this._labeler&&this._labeler.slicePlaneEnabledChange())}_physicalBasedRenderingChange(na){this.symbolCreationContext.physicalBasedRenderingEnabled=na;this.forEachGraphics3DSymbol((za,Da,Ma)=>{za.globalPropertyChanged("physicalBasedRenderingEnabled",Da)||this._recreateSymbol(Ma)})}_skipHighSymbolLoDsChange(na){this.symbolCreationContext.skipHighSymbolLods=na;this.forEachGraphics3DSymbol((za,Da,Ma)=>{za.globalPropertyChanged("skipHighSymbolLods",Da)||this._recreateSymbol(Ma)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((na,
za,Da)=>{na.globalPropertyChanged("pixelRatio",za)||this._recreateSymbol(Da)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=F.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(na,za){const Da=this.symbolCreationContext.clippingExtent,Ma=N.create();la.toBoundingRect(na,Ma,za)?this.symbolCreationContext.clippingExtent=S.fromRect(S.create(),
Ma):this.symbolCreationContext.clippingExtent=null;return!S.equals(this.symbolCreationContext.clippingExtent,Da)}modifyGraphics3DGraphicVisibilities(na){if(!this.destroyed){var za=!1;this.graphics3DGraphics.forEach(Da=>{na(Da)&&(za=!0)});za&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor?.setDirty())}}forEachGraphics3DSymbol(na){for(const [za,Da]of this._symbols){if(null==Da)break;const Ma=this._graphicsBySymbol.get(za);na(Da,Ma||Ha,za)}}updateAllGraphicsVisibility(){null!=this._filterVisibility&&
this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(na=>{const za=this._updateUserVisibility(na);na=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(na);return za||na})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(na=>na.setVisibilityFlag(aa.VisibilityGroup.GRAPHIC,aa.VisibilityFlag.USER,!1))}_validateRenderer(na){if(na=U.validateTo3D(na,{geometryType:this.layer?.geometryType})){const za=`Renderer for layer '${this.layer.title?`${this.layer.title}, `:
""}, id:${this.layer.id}' is not supported in a SceneView`;u.getLogger(this).warn(za,na.message)}}_cleanupSymbols(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var na=!1;this._symbols.forEach((za,Da)=>{if(!(null==za||0<za.referenced)){var Ma=this._graphicsBySymbol.get(Da);Ma&&0!==Ma.size||(this._graphicsBySymbol.delete(Da),this._symbols.delete(Da),this._unusedSymbolsCache.put(Da,za,wa.getSymbolMemorySize(za),D.MinPriority),na=!0)}});na&&(this._recomputeExtentPadding(),
this.notifyChange("averageSymbolComplexity"))}}get test(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(na=>({symbolId:na,graphics:[...this._graphicsBySymbol.get(na).keys()].sort()})),graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,
filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:na=>{this._forcedUpdatePolicy=na}}}get performanceInfo(){return new oa.GraphicsCorePerformanceInfo(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}};a.Graphics3DCore.tmpVec=z.create();b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);b.__decorate([G.property()],
a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_frameTaskHandle",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_dataUpdateQueue",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_updateQueue",void 0);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);
b.__decorate([G.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_initializePromise",
void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_labeler",
void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"elevationFeatureExpressionEnabled",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"componentFactories",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"featureStore",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,"initializePromise",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,
"objectStates",null);b.__decorate([G.property()],a.Graphics3DCore.prototype,"filterVisibility",null);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"dataUpdating",null);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([G.property({readOnly:!0,dependsOn:[]})],
a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([G.property({readOnly:!0})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([G.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([G.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);b.__decorate([G.property()],a.Graphics3DCore.prototype,"_objectIdField",
null);a.Graphics3DCore=gb=b.__decorate([H.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var mb;(function(na){na[na.NEW=0]="NEW";na[na.LOADING=1]="LOADING";na[na.READY=2]="READY";na[na.REJECTED=3]="REJECTED"})(mb||={});class sb{constructor(){this.renderingInfo=this.add=null;this.state=mb.NEW;this.remove=this.abortController=null}clear(){this.renderingInfo=this.add=null;this.state=mb.NEW;this.remove=this.abortController=null}}const tb=z.create(),xa=z.create(),Ha=new Map;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(a,b,h,c,k){function m(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function d(e,n){if(!n)return null;n=Array.isArray(n)?n:[n];if(0<n.length){const l=n.map(x=>x.details.symbol.type||
x.details.symbol.declaredClass).filter(x=>!!x);l.sort();const u=[];l.forEach((x,w)=>{0!==w&&x===l[w-1]||u.push(x)});return new c("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${u.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:n})}return null}function f(e,n){const l={...k.defaultTo3DOptions,...n};n=e.uniqueValueInfos?.map(x=>k.to3D(x.symbol,l).error).filter(b.isSome);const u=k.to3D(e.defaultSymbol,l);u.error&&n?.unshift(u.error);return d(e,n)}function g(e){const n=
e.classBreakInfos.map(u=>k.to3D(u.symbol).error).filter(b.isSome),l=k.to3D(e.defaultSymbol);l.error&&n.unshift(l.error);return d(e,n)}a.isSupportedRenderer3D=m;a.validateTo3D=function(e,n){if(null==e)return null;if(!m(e))return new c("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case "simple":return d(e,k.to3D(e.symbol).error);case "unique-value":return f(e,n);case "class-breaks":return g(e)}return null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/Collection ../../core/has ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,h,c,k,m,d,f,g,e,n){const l=d.fromSimpleMarkerSymbol(e.defaultPointSymbol2D),u=k.fromSimpleLineSymbol(e.defaultPolylineSymbol2D),x=f.fromSimpleFillSymbol(e.defaultPolygonSymbol2D),w=new m({symbolLayers:new b([new c({material:{color:n.defaultColor},
edges:new g({size:"1px",color:n.defaultOutlineColor})})])});a.getDefaultSymbol3D=function(q){if(null==q)return null;switch(q.type){case "mesh":return w;case "point":case "multipoint":return l;case "polyline":return u;case "polygon":case "extent":return x}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){const q=n.create();a.Graphics3DFeatureStore=class extends h{constructor(p){super(p);this.events=new c;this.objectIdField=this.hasM=this.hasZ=null;this.featureAdapter={getAttribute(t,r){return"graphic"in t?t.graphic.attributes[r]:w.optimizedFeatureQueryEngineAdapter.getAttribute(t,r)},getAttributes(t){return"graphic"in t?t.graphic.attributes:w.optimizedFeatureQueryEngineAdapter.getAttributes(t)},getObjectId:t=>"graphic"in t?l.getObjectId(t.graphic,this.objectIdField)??
void 0:w.optimizedFeatureQueryEngineAdapter.getObjectId(t),getGeometry:t=>"graphic"in t?t.getAsOptimizedGeometry(this.hasZ,this.hasM):w.optimizedFeatureQueryEngineAdapter.getGeometry(t),getCentroid:(t,r)=>{if("graphic"in t){let y=null;null!=t.centroid?y=t.centroid:"point"===t.graphic.geometry.type&&e.projectPoint(t.graphic.geometry,v,this.viewSpatialReference)&&(y=v);t=Array(2+(r.hasZ?1:0)+(r.hasM?1:0));null==y?(t[0]=0,t[1]=0,t[2]=0,t[3]=0):(t[0]=y.x,t[1]=y.y,r.hasZ&&(t[2]=y.hasZ?y.z:0),r.hasM&&(t[r.hasZ?
3:2]=y.hasM?y.m:0));return new x([],t)}return w.optimizedFeatureQueryEngineAdapter.getCentroid(t,r)},cloneWithGeometry:(t,r)=>"graphic"in t?new u.OptimizedFeature(r,this.featureAdapter.getAttributes(t),null,this.featureAdapter.getObjectId(t)):w.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(t,r)}}forEachInBounds(p,t){this.getSpatialIndex().forEachInBounds(p,t)}forEachBounds(p,t){const r=this.getSpatialIndex();for(const y of p)p=this.featureAdapter.getObjectId(y),null!=r.getBounds(p,q)&&t(q)}};
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const v={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports",
"../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,h,c){a.optimizedFeatureQueryEngineAdapter={getObjectId(k){return k.objectId},getAttributes(k){return k.attributes},getAttribute(k,m){return k.attributes[m]},cloneWithGeometry(k,m){return new h.OptimizedFeature(m,k.attributes,null,k.objectId)},getGeometry(k){return k.geometry},getCentroid(k,m){null==k.centroid&&(k.centroid=b.getCentroidOptimizedGeometry(new c,k.geometry,m.hasZ,m.hasM));return k.centroid}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function b(c,k,m,d,f,g){g=f?g?4:3:g?3:2;let e=m,n=m+g,l=0,u=0,x=m=0,w=0;for(let q=0,v=d-1;q<v;q++,e+=g,n+=g){d=k[e];const p=k[e+1],t=k[e+2],r=k[n],y=k[n+1],D=k[n+2];let E=d*y-r*p;x+=E;l+=(d+r)*E;u+=(p+y)*E;f&&(E=d*D-r*t,m+=(t+D)*E,w+=E);d<c[0]&&(c[0]=d);d>c[1]&&(c[1]=d);p<c[2]&&(c[2]=p);p>c[3]&&(c[3]=p);f&&(t<c[4]&&(c[4]=t),t>c[5]&&(c[5]=t))}0<x&&(x*=-1);0<w&&(w*=-1);if(!x)return null;
c=[l,u,.5*x];f&&(c[3]=m,c[4]=.5*w);return c}function h(c,k,m,d,f){f=d?f?4:3:f?3:2;let g=k,e=k+f,n=0,l=0,u=0,x=0;for(let p=0,t=m-1;p<t;p++,g+=f,e+=f){var w=c[g];const r=c[g+1],y=c[g+2],D=c[e],E=c[e+1],A=c[e+2];if(d){var q=D-w;var v=E-r;const B=A-y;q=Math.sqrt(q*q+v*v+B*B)}else q=D-w,v=E-r,q=Math.sqrt(q*q+v*v);q&&(n+=q,d?(w=[w+.5*(D-w),r+.5*(E-r),y+.5*(A-y)],l+=q*w[0],u+=q*w[1],x+=q*w[2]):(w=[w+.5*(D-w),r+.5*(E-r)],l+=q*w[0],u+=q*w[1]))}return 0<n?d?[l/n,u/n,x/n]:[l/n,u/n]:0<m?d?[c[k],c[k+1],c[k+2]]:
[c[k],c[k+1]]:null}a.getCentroidOptimizedGeometry=function(c,k,m,d){if(!k?.lengths.length)return null;c.lengths.length&&(c.lengths.length=0);c.coords.length&&(c.coords.length=0);const f=c.coords,g=[],e=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:n,coords:l}=k;var u=m?d?4:3:d?3:2;
let x=0;for(const w of n){const q=b(e,l,x,w,m,d);q&&g.push(q);x+=w*u}g.sort((w,q)=>{let v=w[2]-q[2];0===v&&m&&(v=w[4]-q[4]);return v});g.length&&(u=6*g[0][2],f[0]=g[0][0]/u,f[1]=g[0][1]/u,m&&(u=6*g[0][4],f[2]=0!==u?g[0][3]/u:0),f[0]<e[0]||f[0]>e[1]||f[1]<e[2]||f[1]>e[3]||m&&(f[2]<e[4]||f[2]>e[5]))&&(f.length=0);if(!f.length)if(k=k.lengths[0]?h(l,0,n[0],m,d):null)f[0]=k[0],f[1]=k[1],m&&2<k.length&&(f[2]=k[2]);else return null;return c};a.lineCentroid=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,h){a.make=function(c,k,m){switch(c.type){case "point-3d":return new b.Graphics3DPointSymbol(c,k,m);default:return new h.Graphics3DSymbol(c,k,m)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("exports ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,b,h,c,k,m,d){class f extends d.Graphics3DSymbol{constructor(g,e,n){super(g,e,n);this._calloutSymbolLayer=null;this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=k.make(this.symbol,e))}async doLoad(g){const e=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await super.doLoad(g),c.throwIfAborted(g)}catch(n){throw this._calloutSymbolLayer?.abortLoad(),n;}e&&await e}destroy(){super.destroy();this._calloutSymbolLayer=h.destroyMaybe(this._calloutSymbolLayer)}createGraphics3DGraphic(g,
e){e=super.createGraphics3DGraphic(g,e);null!=this._calloutSymbolLayer&&null!=e&&(g=this._createCalloutGraphic(g))&&e.setCalloutGraphic(g);return e}globalPropertyChanged(g,e){return super.globalPropertyChanged(g,e)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(g,e,n=>n.calloutLayer):!0:!1}updateGeometry(g,e){const n=super.updateGeometry(g,e);return n&&this._calloutSymbolLayer&&(g=g.calloutLayer)?this._calloutSymbolLayer.updateGeometry(g,e):n}_createCalloutGraphic(g){const e=
g.renderingInfo;g.renderingInfo=new m.LineCalloutSymbolLayerRenderingInfo(e.renderer,e.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(g)}}a.Graphics3DPointSymbol=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsCorePerformanceInfo":function(){define(["exports"],function(a){class b{constructor(h,c,k){this.visible=h;this.missing=c;this.pending=k}}a.GraphicsCorePerformanceInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,b,h,c){class k{constructor(m){this._graphicsCore=m;this._idToState=new Map;this._states=new Set;const d=m.owner.layer?.objectIdField;d?(this._getGraphicId=f=>c.getObjectId(f,d),this._getGraphics3DGraphicById=f=>this._graphicsCore.getGraphics3DGraphicByObjectId(f)):(this._getGraphicId=f=>f.uid,this._getGraphics3DGraphicById=
f=>this._graphicsCore.getGraphics3DGraphicById(f))}destroy(){this._idToState.clear();this._states.forEach((m,d)=>this.remove(d))}add(m){const d=h.makeHandle(()=>this.remove(m));if(this._states.has(m))return d;const f=this._getGraphicId(m.graphic),g=this._getGraphics3DGraphicById(f);this._states.has(m)||this._states.add(m);this._ensureStateList(f).push(m);m.displaying=null!=g?g.isVisible():!1;m.isDraped=null!=g?g.isDraped:!1;m.tracking=!0;null!=g&&m.emit("changed");return d}remove(m){if(this._states.has(m)){if(this._idToState.size){const d=
this._getGraphicId(m.graphic),f=this._idToState.get(d);f&&(b.remove(f,m),0===f.length&&this._idToState.delete(d))}this._states.delete(m);m.tracking=!1;m.displaying=!1}}addGraphic(m){this._forEachState(m,d=>{d.displaying=m.isVisible();d.isDraped=m.isDraped;d.emit("changed")})}removeGraphic(m){this._forEachState(m,d=>{d.displaying=!1;d.isDraped=!1})}updateGraphicGeometry(m){this._forEachState(m,d=>d.emit("changed"))}updateGraphicVisibility(m){this._forEachState(m,d=>d.displaying=m.isVisible())}allGraphicsDeleted(){this._states.forEach(m=>
m.displaying=!1)}_ensureStateList(m){var d=this._idToState.get(m);if(d)return d;d=[];this._idToState.set(m,d);return d}_forEachState(m,d){0!==this._states.size&&0!==this._idToState.size&&(m=this._getGraphicId(m.graphic),m=this._idToState.get(m),null!=m&&m.forEach(d))}}a.GraphicStateTracking=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){a.SpatialIndex2D=class extends h{constructor(x){super(x);this._index=new e.PooledRBush(9,c("esri-csp-restrictions")?w=>({minX:w.extent[0],minY:w.extent[1],maxX:w.extent[2],maxY:w.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);this._missing=new Set;this._boundsByFeature=new Map;this.objectIdField=this.hasM=this.hasZ=this.spatialReference=null;this.updating=!1}setup(x){this._addMany(x)}destroy(){this._missing.clear();this._index=k.destroyMaybe(this._index);
this._boundsByFeature.clear();this._boundsByFeature=null}update(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(x,w,q){null!=w&&w.equals(this.spatialReference)&&(u.minX=x[0],u.minY=x[1],u.maxX=x[2],u.maxY=x[3],this.update(),this._index.search(u,v=>q(v.graphic.uid)))}add(x){this._missing.add(x);this.updating=!0}remove(x){this._missing.delete(x)?this.updating=
0<this._missing.size:(this._index.remove(x),x=l.getObjectId(x.graphic,this._get("objectIdField")),null!=x&&this._boundsByFeature.delete(x))}_addMany(x){if(0!==x.length){var w=this._get("objectIdField");for(const q of x){q.computeExtent(this.spatialReference);const v=l.getObjectId(q.graphic,w);null!=v&&this._boundsByFeature.set(v,q.extent)}this._index.load(x)}}clear(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();this.updating=!1}forEachInBounds(x,w){u.minX=x[0];u.minY=x[1];
u.maxX=x[2];u.maxY=x[3];this.update();this._index.search(u,q=>{w(q)})}getBounds(x,w){this.update();return(x=this._boundsByFeature.get(x))?n.fromRect(w,x):null}};b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasZ",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"objectIdField",void 0);b.__decorate([m.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([m.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([g.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const u={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../PooledArray",
"../../../chunks/quickselect"],function(a,b,h,c){function k(A,B){m(A,0,A.children.length,B,A)}function m(A,B,F,G,H){H||=new D([]);H.minX=Infinity;H.minY=Infinity;H.maxX=-Infinity;H.maxY=-Infinity;for(let L=B,C;L<F;L++)C=A.children[L],d(H,A.leaf?G(C):C);return H}function d(A,B){A.minX=Math.min(A.minX,B.minX);A.minY=Math.min(A.minY,B.minY);A.maxX=Math.max(A.maxX,B.maxX);A.maxY=Math.max(A.maxY,B.maxY)}function f(A,B){return A.minX-B.minX}function g(A,B){return A.minY-B.minY}function e(A){return(A.maxX-
A.minX)*(A.maxY-A.minY)}function n(A){return A.maxX-A.minX+(A.maxY-A.minY)}function l(A,B){return A.minX<=B.minX&&A.minY<=B.minY&&B.maxX<=A.maxX&&B.maxY<=A.maxY}function u(A,B){return B.minX<=A.maxX&&B.minY<=A.maxY&&B.maxX>=A.minX&&B.maxY>=A.minY}function x(A,B,F,G,H){for(B=[B,F];B.length;){F=B.pop();const L=B.pop();if(F-L<=G)continue;const C=L+Math.ceil((F-L)/G/2)*G;c.quickselect(A,C,L,F,H);B.push(L,C,C,F)}}class w{constructor(A=9,B){this._compareMinX=f;this._compareMinY=g;this._toBBox=F=>F;this._maxEntries=
Math.max(4,A||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));B&&("function"===typeof B?this._toBBox=B:this._initFormat(B));this.clear()}destroy(){this.clear();q.prune();v.prune();p.prune();t.prune()}all(A){this._all(this._data,A)}search(A,B){let F=this._data;const G=this._toBBox;if(u(A,F))for(q.clear();F;){for(let H=0,L=F.children.length;H<L;H++){const C=F.children[H],z=F.leaf?G(C):C;u(A,z)&&(F.leaf?B(C):l(A,z)?this._all(C,B):q.push(C))}F=q.pop()}}collides(A){let B=this._data;const F=
this._toBBox;if(!u(A,B))return!1;for(q.clear();B;){for(let G=0,H=B.children.length;G<H;G++){const L=B.children[G],C=B.leaf?F(L):L;if(u(A,C)){if(B.leaf||l(A,C))return!0;q.push(L)}}B=q.pop()}return!1}load(A){if(!A.length)return this;if(A.length<this._minEntries){for(let B=0,F=A.length;B<F;B++)this.insert(A[B]);return this}A=this._build(A.slice(0,A.length),0,A.length-1,0);if(this._data.children.length)if(this._data.height===A.height)this._splitRoot(this._data,A);else{if(this._data.height<A.height){const B=
this._data;this._data=A;A=B}this._insert(A,this._data.height-A.height-1,!0)}else this._data=A;return this}insert(A){A&&this._insert(A,this._data.height-1);return this}clear(){this._data=new D([]);return this}remove(A){if(!A)return this;let B=this._data,F=null,G=0,H=!1,L;const C=this._toBBox(A);p.clear();for(t.clear();B||0<p.length;){B||(B=p.pop(),F=p.data[p.length-1],G=t.pop()??0,H=!0);if(B.leaf&&(L=b.indexOf(B.children,A,B.children.length,B.indexHint),-1!==L)){B.children.splice(L,1);p.push(B);this._condense(p);
break}H||B.leaf||!l(B,C)?F?(G++,B=F.children[G],H=!1):B=null:(p.push(B),t.push(G),G=0,F=B,B=B.children[0])}return this}toJSON(){return this._data}fromJSON(A){this._data=A;return this}_all(A,B){for(v.clear();A;){if(!0===A.leaf)for(const F of A.children)B(F);else v.pushArray(A.children);A=v.pop()??null}}_build(A,B,F,G){var H=F-B+1,L=this._maxEntries;if(H<=L)return A=new D(A.slice(B,F+1)),k(A,this._toBBox),A;G||(G=Math.ceil(Math.log(H)/Math.log(L)),L=Math.ceil(H/L**(G-1)));const C=new E([]);C.height=
G;H=Math.ceil(H/L);L=H*Math.ceil(Math.sqrt(L));for(x(A,B,F,L,this._compareMinX);B<=F;B+=L){const z=Math.min(B+L-1,F);x(A,B,z,H,this._compareMinY);for(let J=B;J<=z;J+=H)C.children.push(this._build(A,J,Math.min(J+H-1,z),G-1))}k(C,this._toBBox);return C}_chooseSubtree(A,B,F,G){for(;;){G.push(B);if(!0===B.leaf||G.length-1===F)break;let H=Infinity,L=Infinity,C=void 0;for(let z=0,J=B.children.length;z<J;z++){const K=B.children[z],I=e(K),M=(Math.max(K.maxX,A.maxX)-Math.min(K.minX,A.minX))*(Math.max(K.maxY,
A.maxY)-Math.min(K.minY,A.minY))-I;M<L?(L=M,H=I<H?I:H,C=K):M===L&&I<H&&(H=I,C=K)}B=C||B.children[0]}return B}_insert(A,B,F){var G=this._toBBox;F=F?A:G(A);p.clear();G=this._chooseSubtree(F,this._data,B,p);G.children.push(A);for(d(G,F);0<=B;)if(p.data[B].children.length>this._maxEntries)this._split(p,B),B--;else break;this._adjustParentBBoxes(F,p,B)}_split(A,B){const F=A.data[B];var G=F.children.length;const H=this._minEntries;this._chooseSplitAxis(F,H,G);(G=this._chooseSplitIndex(F,H,G))?(G=F.children.splice(G,
F.children.length-G),G=F.leaf?new D(G):new E(G),G.height=F.height,k(F,this._toBBox),k(G,this._toBBox),B?A.data[B-1].children.push(G):this._splitRoot(F,G)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(A,B){this._data=new E([A,B]);this._data.height=A.height+1;k(this._data,this._toBBox)}_chooseSplitIndex(A,B,F){let G,H,L=void 0;G=H=Infinity;for(let z=B;z<=F-B;z++){var C=m(A,0,z,this._toBBox);const J=m(A,z,F,this._toBBox),K=Math.max(0,Math.min(C.maxX,
J.maxX)-Math.max(C.minX,J.minX))*Math.max(0,Math.min(C.maxY,J.maxY)-Math.max(C.minY,J.minY));C=e(C)+e(J);K<G?(G=K,L=z,H=C<H?C:H):K===G&&C<H&&(H=C,L=z)}return L}_chooseSplitAxis(A,B,F){const G=A.leaf?this._compareMinX:f,H=A.leaf?this._compareMinY:g,L=this._allDistMargin(A,B,F,G);B=this._allDistMargin(A,B,F,H);L<B&&A.children.sort(G)}_allDistMargin(A,B,F,G){A.children.sort(G);G=this._toBBox;var H=m(A,0,B,G);const L=m(A,F-B,F,G);let C=n(H)+n(L);for(let z=B;z<F-B;z++){const J=A.children[z];d(H,A.leaf?
G(J):J);C+=n(H)}for(F=F-B-1;F>=B;F--)H=A.children[F],d(L,A.leaf?G(H):H),C+=n(L);return C}_adjustParentBBoxes(A,B,F){for(;0<=F;F--)d(B.data[F],A)}_condense(A){for(let B=A.length-1;0<=B;B--){const F=A.data[B];if(0===F.children.length)if(0<B){const G=A.data[B-1],H=G.children;H.splice(b.indexOf(H,F,H.length,G.indexHint),1)}else this.clear();else k(F,this._toBBox)}}_initFormat(A){const B=["return a"," - b",";"];this._compareMinX=new Function("a","b",B.join(A[0]));this._compareMinY=new Function("a","b",
B.join(A[1]));this._toBBox=new Function("a","return {minX: a"+A[0]+", minY: a"+A[1]+", maxX: a"+A[2]+", maxY: a"+A[3]+"};")}}const q=new h,v=new h,p=new h,t=new h({deallocator:void 0});class r{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class y extends r{constructor(){super(...arguments);this.height=1;this.indexHint=new b.PositionHint}}class D extends y{constructor(A){super();this.children=A;this.leaf=!0}}class E extends y{constructor(A){super();this.children=A;this.leaf=
!1}}a.BBox=r;a.PooledRBush=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,b){var h={exports:{}};(function(c){(function(k){k=k();void 0!==k&&(c.exports=k)})(function(){function k(f,g,e,n,l){for(;n>e;){if(600<n-e){var u=n-e+1,x=g-e+1,w=Math.log(u),q=.5*Math.exp(2*w/3);w=.5*Math.sqrt(w*q*(u-q)/u)*(0>x-u/2?-1:1);k(f,g,Math.max(e,Math.floor(g-x*q/u+w)),Math.min(n,Math.floor(g+(u-x)*q/u+w)),l)}u=f[g];
x=e;q=n;m(f,e,g);for(0<l(f[n],u)&&m(f,e,n);x<q;){m(f,x,q);x++;for(q--;0>l(f[x],u);)x++;for(;0<l(f[q],u);)q--}0===l(f[e],u)?m(f,e,q):(q++,m(f,q,n));q<=g&&(e=q+1);g<=q&&(n=q-1)}}function m(f,g,e){var n=f[g];f[g]=f[e];f[e]=n}function d(f,g){return f<g?-1:f>g?1:0}return function(f,g,e,n,l){k(f,g,e||0,n||f.length-1,l||d)}})})(h);b=b.getDefaultExportFromCjs(h.exports);a.quickselect=b})},"esri/views/3d/layers/graphics/symbolMemory":function(){define(["exports"],function(a){a.getSymbolMemorySize=function(b){return 2216+
4096*b.symbolLayers.length+b.complexity.memory.resourceBytes};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/unitConversionUtils ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.StageLayerElevationProvider=class extends c.EventedMixin(h){get spatialReference(){return this.view?.spatialReference}constructor(A){super(A);this._elevationOffset=0;this._layerHandlesKey="layerHandles"}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=q.newIntersector(this.view.state.viewingMode);this._intersector.options.store=v.StoreResults.MIN;var A=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=A[2];this._zmax=A[5];A=this.stageLayer.events;this.addHandles([A.on("layerObjectAdded",({object:B})=>this._objectChanged(B)),A.on("layerObjectRemoved",({object:B})=>this._objectChanged(B)),A.on("geometryAdded",({object:B})=>this._objectChanged(B)),A.on("geometryRemoved",({object:B})=>this._objectChanged(B)),A.on("attributesChanged",({attribute:B,object:F})=>p.affectsGeometry(B)&&this._objectChanged(F)),A.on("transformationChanged",B=>this._objectChanged(B))],this._layerHandlesKey)}dispose(){this.removeHandles(this._layerHandlesKey)}elevationInfoChanged(){const A=
null!=this.layer?this.layer.elevationInfo:null;if(null!=A&&"on-the-ground"!==A.mode){const B=m.getMetersPerVerticalUnitForSR(this.layer.spatialReference),F=x.getMetersPerUnit(A.unit??"meters");this._elevationOffset=(A.offset??0)*F/B}else this._elevationOffset=0}getElevation(A,B,F,G){y[0]=A;y[1]=B;y[2]=F;if(!this._renderCoordsHelper.toRenderCoords(y,G,y))return k.getLogger(this).error("could not project point for elevation alignment"),null;A=this._elevationOffset;B=this._zmin+A;this._renderCoordsHelper.setAltitude(D,
this._zmax+A,y);this._renderCoordsHelper.setAltitude(E,B,y);this._intersector.reset(D,E,null);this._intersector.intersect(this._intersectLayers,null,1,null,H=>!!H.lastValidElevationBB);return this._intersector.results.min.getIntersectionPoint(y)?this._renderCoordsHelper.getAltitude(y):null}_objectChanged(A){const B=this.spatialReference;if(A.lastValidElevationBB&&B){u.empty(t);var F=A.lastValidElevationBB;F.isEmpty()||this._expandExtent(B,F.min,F.max,t);var {min:G,max:H}=A.boundingVolumeWorldSpace;
this._expandExtent(B,G,H,t);u.toRect(t,r.extent);this._zmin=Math.min(this._zmin,t[2]);this._zmax=Math.max(this._zmax,t[5]);r.spatialReference=B;this.emit("elevation-change",r);n.copy(F.min,G);n.copy(F.max,H)}}_computeLayerExtent(A,B){u.empty(t);null!=A&&B.objects.forAll(F=>this._expandExtent(A,F.boundingVolumeWorldSpace.min,F.boundingVolumeWorldSpace.max,t));return t}_expandExtent(A,B,F,G){for(let H=0;8>H;++H)y[0]=H&1?B[0]:F[0],y[1]=H&2?B[1]:F[1],y[2]=H&4?B[2]:F[2],this._renderCoordsHelper.fromRenderCoords(y,
y,A),u.expandWithVec3(G,y);return G}};b.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);b.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([d.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=b.__decorate([e.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],
a.StageLayerElevationProvider);const t=u.empty(),r=new w.ElevationUpdateEvent,y=l.create(),D=l.create(),E=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(w){return null==w?u.TaskPriority.ELEVATION_ALIGNMENT:"relative-to-scene"===w?u.TaskPriority.ELEVATION_ALIGNMENT_SCENE:u.TaskPriority.ELEVATION_ALIGNMENT}a.Graphics3DElevationAlignment=class extends h{constructor(w){super(w);this._dirtyExtents=new n.ExtentSet;this._globalDirty=!1;this._averageExtentUpdateSize=0;this._dirtyGraphicsSet=new Set;this._updateElevation=!1;this.graphicsCore=this.graphicsCoreOwner=null;this.events=new c}initialize(){const w=this.elevationProvider;
this._task=this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x(this.graphicsCore.layer.elevationInfo?.mode),this);this.addHandles([w.on("elevation-change",q=>this._elevationChanged(q)),k.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,k.watch(()=>x(this.graphicsCore.layer.elevationInfo?.mode),q=>this._task.priority=q)])}destroy(){this._dirtyGraphicsSet.clear();this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=
null}clear(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0;this.notifyChange("updating")}get updating(){return this.running}get running(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+
this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(w){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,w.madeProgress());for(w.run(()=>this._dirtyExtents.merge(w));this.running&&!w.done;)this._updateDirtyGraphics(w),this._updateDirtyExtents(w);this.notifyChange("updating")}_updateDirtyGraphics(w){const q=this.graphicsCoreOwner.view.renderCoordsHelper,v=this.graphicsCore.effectiveUpdatePolicy===l.UpdatePolicy.ASYNC;for(const p of this._dirtyGraphicsSet.keys()){const t=
this.graphicsCore.getGraphics3DGraphicById(p);this._dirtyGraphicsSet.delete(p);null!=t&&(t.alignWithElevation(this.elevationProvider,q,v),this.graphicsCoreOwner.view.deconflictor.setDirty(),w.madeProgress());if(w.done)break}}_updateDirtyExtents(w){for(;!this._dirtyExtents.empty&&!w.done;){const q=this._dirtyExtents.pop(),v=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:q,spatialReference:v});const p=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(q,
v,t=>{const r=this.graphicsCore.getGraphics3DGraphicById(t);null!=r&&r.needsElevationUpdates()&&this._dirtyGraphicsSet.add(t)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-p)+.9*this._averageExtentUpdateSize;w.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear();this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((w,q)=>this._dirtyGraphicsSet.add(q))}_elevationChanged(w){if("scene"!==w.context||this.graphicsCore.layer.elevationInfo&&
"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var q=w.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const v=this.graphicsCore.computedExtent;v&&q[2]>v.xmin&&q[0]<v.xmax&&q[3]>v.ymin&&q[1]<v.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",w)}else-Infinity===q[0]?this._globalDirty=!0:this._dirtyExtents.add(q),this.notifyChange("updating")}}};b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCoreOwner",
void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCore",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"elevationProvider",void 0);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updating",null);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updatingRemaining",
null);a.Graphics3DElevationAlignment=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],a.Graphics3DElevationAlignment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,h,c){class k{constructor(){this._extents=new b({allocator:m=>m||h.create()});this._tmpExtent=
h.create();this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(m){this._contains(m)||(this._removeContained(m),h.copy(this._extents.pushNew(),m),this._dirty=!0)}pop(){this._dirty&&this._mergeTight();return this._extents.pop()}merge(m){this._mergeTight(m);return m.hasProgressed}_mergeTight(m=c.noBudget){const d=this._extents,f=new Set;let g=0;for(;g!==d.length;){d.sort((e,n)=>e[0]-n[0]);g=d.length;f.clear();for(let e=0;e<
d.length;++e){if(m.done)return;const n=d.at(e);if(n){for(let l=e+1;l<d.length;++l){const u=d.at(l);if(null==u||u[0]>=n[2])break;f.add(u)}f.forEach(l=>{if(n!==l)if(l[2]<=n[0])f.delete(l);else{var u=h.area(n),x=h.area(l),w=this._tmpExtent;h.expand(n,l,w);u+=x;.05>(h.area(w)-u)/u&&(h.copy(n,w),f.delete(l),d.remove(l),m.madeProgress())}});f.add(n)}}}this._dirty=!1}_contains(m){return this._extents.some(d=>h.contains(d,m))}_removeContained(m){this._extents.filterInPlace(d=>!h.contains(m,d))}get test(){const m=
this;return{containsPoint:d=>m._extents.some(f=>h.containsPoint(f,d))}}}a.ExtentSet=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){a.Graphics3DFrustumVisibility=class extends h{constructor(x){super(x);this.suspended=!1;this._extent=null;this._extentIntersectionDirty=!0;this._isVisibleBelowSurfaceInternal=!1;this.graphicsCoreOwner=null;this.updating=!0}initialize(){var {graphicsCoreOwner:x}=this;this._extentIntersection=new n.FrustumExtentIntersection({renderCoordsHelper:x.view.renderCoordsHelper});const w=x.view,q=w.basemapTerrain;x=w.resourceController.scheduler;this.addHandles([w.on("resize",
()=>this._viewChange()),c.watch(()=>w.state.camera,()=>this._viewChange(),c.sync),x.registerTask(l.TaskPriority.FRUSTUM_VISIBILITY,this),c.watch(()=>q.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===w.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([c.watch(()=>[q.baseOpacity,q.wireframe,w.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),c.initial)])}destroy(){this._set("graphicsCoreOwner",null);this._extentIntersection=this._extent=
null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(x){this._extent=x;this._extentIntersectionDirty=!0;this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty();this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(x){this._isVisibleBelowSurfaceInternal=x;this._setDirty();this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const x=this.graphicsCoreOwner.view,w=x.basemapTerrain,q="none"===x.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=
"local"===x.viewingMode||!w.opaque||q}_updateExtentIntersection(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var x=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var w=-.3*e.getReferenceEllipsoid(x.spatialReference).radius;else{const {min:q,max:v}=x.basemapTerrain.visibleElevationBounds;w=q-Math.max(1,(v-q)*(1.2-1))}this._extentIntersection.update(this._extent,x.spatialReference,w)}}get running(){return this.updating}runTask(x){this._set("updating",!1);
if(!this._extent)return this._set("suspended",!1),u.Yield;this._updateExtentIntersection();const w=this.graphicsCoreOwner.view.frustum,q=e.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(w,q));x.madeProgress()}};b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"suspended",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"graphicsCoreOwner",
void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"updating",void 0);a.Graphics3DFrustumVisibility=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],a.Graphics3DFrustumVisibility);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,b,h){class c{constructor(k){this._graphicsCore=
k;this._stateSets=[]}destroy(){this.reset();this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(k=>k.objectStateSet.removeAll()),this._stateSets.length=0)}acquireSet(k,m){const d=new h.Graphics3DObjectStateSet(k,m);this._stateSets.push(d);k=b.makeHandle(()=>this.releaseSet(d));return{set:d,handle:k}}releaseSet(k){k.objectStateSet.removeAll();k=this._stateSets?this._stateSets.indexOf(k):-1;-1!==k&&this._stateSets.splice(k,1)}_addObjectStateSet(k,m){k.addObjectStateSet(m.stateType,
m.objectStateSet)}_removeObjectStateSet(k,m){k.removeObjectState(m.objectStateSet)}setUid(k,m){k.ids.add(m);(m=this._graphicsCore.graphics3DGraphics.get(m))&&this._addObjectStateSet(m,k)}setUids(k,m){m.forEach(d=>this.setUid(k,d))}setObjectIds(k,m){m.forEach(d=>k.ids.add(d));this._initializeSet(k)}addGraphic(k){this._stateSets.forEach(m=>{!m.paused&&m.hasGraphic(k)&&this._addObjectStateSet(k,m)})}removeGraphic(k){this._stateSets.forEach(m=>{m.hasGraphic(k)&&this._removeObjectStateSet(k,m)})}allGraphicsDeleted(){this._stateSets&&
this._stateSets.forEach(k=>k.objectStateSet.removeAll())}_initializeSet(k){const m=this._graphicsCore.graphics3DGraphics;k.objectIdField?m.forEach(d=>{d&&k.hasGraphic(d)&&this._addObjectStateSet(d,k)}):k.ids.forEach(d=>{(d=m.get(d))&&this._addObjectStateSet(d,k)})}get test(){return{states:this._stateSets}}}a.Graphics3DObjectStates=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],
function(a,b){class h{constructor(c,k){this.stateType=c;this.objectIdField=k;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}hasGraphic(c){return this.objectIdField?this.ids.has(c.graphic.attributes[this.objectIdField]):this.ids.has(c.graphic.uid)}}a.Graphics3DObjectStateSet=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var h;(function(k){k[k.Object=
0]="Object";k[k.RenderGeometry=1]="RenderGeometry";k[k.External=2]="External";k[k.COUNT=3]="COUNT"})(h||={});class c{constructor(){this._items=[]}addObject(k,m){this._items.push({type:h.Object,objectStateId:m,object:k})}addRenderGeometry(k,m,d){this._items.push({type:h.RenderGeometry,objectStateId:m,renderGeometry:k,owner:d})}addExternal(k,m){this._items.push({type:h.External,objectStateId:m,remove:k})}remove(k){for(let m=this._items.length-1;0<=m;--m){const d=this._items[m];d.objectStateId===k&&
(this._removeObjectStateItem(d),this._items.splice(m,1))}}removeObject(k){for(let m=this._items.length-1;0<=m;--m){const d=this._items[m];d.type===h.Object&&d.object===k&&(this._removeObjectStateItem(d),this._items.splice(m,1))}}removeRenderGeometry(k){for(let m=this._items.length-1;0<=m;--m){const d=this._items[m];d.type===h.RenderGeometry&&d.renderGeometry===k&&(this._removeObjectStateItem(d),this._items.splice(m,1))}}removeAll(){this._items.forEach(k=>{this._removeObjectStateItem(k)});this._items=
[]}_removeObjectStateItem(k){switch(k.type){case h.Object:k.objectStateId.channel===b.Object3DState.Highlight?k.object.removeHighlight(k.objectStateId):k.objectStateId.channel===b.Object3DState.MaskOccludee&&k.object.removeOcclude(k.objectStateId);break;case h.RenderGeometry:k.owner.removeRenderGeometryObjectState(k.renderGeometry,k.objectStateId);break;case h.External:k.remove(k.objectStateId)}}}a.Object3DStateSet=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){a.Graphics3DScaleVisibility=class extends h{constructor(v){super(v);this._layerScaleRangeVisibilityQuery=this._scaleRangeActive=!1;this._extent=null;this._updatingHandles=new g.UpdatingHandles;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=null;this.layerScaleEnabled=!0;this.suspended=!1;this._dirty=!0}initialize(){this.updateScaleRangeActive();this.addHandles(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x.TaskPriority.SCALE_VISIBILITY,
this));this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy();this.removeHandles();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(v){const p=this.graphicsCoreOwner.view.spatialReference,t=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
if(p===t)this._extent=v??null;else{const r=n.create();e.projectBoundingRect(v,p,r,t)?this._extent=r:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){var v=this.layer,p=v.effectiveScaleRange;p=this.layerScaleEnabled&&null!=p&&(0<p.minScale||0<p.maxScale);v.labelingInfo&&!p&&(p=v.labelingInfo.some(t=>t&&(0<(t.minScale??0)||0<(t.maxScale??0))));v=this._scaleRangeActive!==p;(this._scaleRangeActive=p)&&!this.hasHandles("terrain-events")&&this.basemapTerrain?
(this.addHandles(this.basemapTerrain.on("scale-change",t=>this._scaleUpdateHandler(t)),"terrain-events"),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!p&&this.hasHandles("terrain-events")&&this.removeHandles("terrain-events");return v}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(v){const p=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&p&&p.ready&&this._scaleRangeActive&&
this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return w.Yield;this._layerScaleRangeVisibilityQuery=!0;const {minScale:t,maxScale:r}=this.layer.effectiveScaleRange;p.queryVisibleScaleRange(this._extent,t,r,y=>this._finishUpdate(y))}else this._finishUpdate(!0);v.madeProgress()}_finishUpdate(v){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!v);this._dirty=!1}_visibleAtLayerScale(v){const p=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||u.scaleBoundsPredicate(v,
p.minScale||0,p.maxScale||0)}_visibleAtLabelScale(v,p){return u.scaleBoundsPredicate(v,p.minScale||0,p.maxScale||0)}_graphicScale(v){let p;null!=v.centroid?p=v.centroid:null!=v.graphic.geometry&&"point"===v.graphic.geometry.type&&(p=v.graphic.geometry);return p?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(p):1:null}_graphicVisible(v){if(!this.layerScaleEnabled)return!0;v=this._graphicScale(v);return this._visibleAtLayerScale(v)}updateVisibility(v){if(this._scaleRangeActive){const p=
this._graphicVisible(v);return v.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,p)}return!1}updateGraphicLabelScaleVisibility(v){if(!this._scaleRangeActive||!v.labelLayers||0===v.labelLayers.length)return!1;const p=this._graphicScale(v);if(v=this._updateLabelScaleVisibility(v,p))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();return v}_updateLabelScaleVisibility(v,p){if(!v.labelLayers||0===v.labelLayers.length)return!1;const t=
v.labelLayers[0]._labelClass;return null!=t?.minScale&&null!=t.maxScale&&(p=this._visibleAtLabelScale(p,t),v.setVisibilityFlag(l.VisibilityGroup.LABEL,l.VisibilityFlag.SCALE_RANGE,p))?!0:!1}_scaleUpdateHandler(v){this._setDirty();if(this.graphicsCore.visible){var p=v.extent,t=v.scale,r=this._visibleAtLayerScale(t),y=!1,D=this.graphicsCoreOwner.view.spatialReference;v=v.spatialReference;if(null==v)c.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var E=
!v.equals(D);E&&!e.projectBoundingRect(p,v,q,D)?c.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+v+" to wkid "+D):(this.queryGraphicUIDsInExtent(E?q:p,D,A=>{A=this.graphicsCore.getGraphics3DGraphicById(A);if(null!=A){var B=A.centroid;null!=B&&(p[0]>B.x||p[1]>B.y||p[2]<B.x||p[3]<B.y)||(A.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,r)&&(y=!0),this._updateLabelScaleVisibility(A,t)&&(y=!0))}}),y&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),
this.graphicsCoreOwner.view.labeler.setDirty()))}}}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(v=>v.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()}};b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCoreOwner",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,
"layer",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCore",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"basemapTerrain",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DScaleVisibility.prototype,"layerScaleEnabled",void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"suspended",void 0);
b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"updating",null);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"_dirty",void 0);a.Graphics3DScaleVisibility=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],a.Graphics3DScaleVisibility);const q=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=
function(b,h,c){if(!c||null==h)return null;if(!b){a:{b=c.toLowerCase();for(var k in h)if(k.toLowerCase()===b){h=h[k];break a}h=null}return h}return(k=b.get(c))?h[k.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.FeatureVisibilityFilter=class extends h{constructor(t){super(t);this._queryEngine=this._frameTask=this._updateTask=null;this._updateRequested=!0;this._updatingHandles=new u.UpdatingHandles;this._updateVisibility=async r=>{if(null==this._compositedFeatureFilter&&null==this._sceneFilter||0===this.context.getFeatureCount())return this._frameTask.schedule(()=>this.clear(),r);try{const y=await this._queryEngine.executeQueryForIdSet(this._compositedFeatureFilter,
this._sceneFilter,r);return this._frameTask.schedule(()=>{this.context.updateFeatureVisibilities(D=>y.has(D))},r)}catch(y){return d.throwIfAbortError(y),k.getLogger(this).warn(`FeatureFilter query failed: ${y}`,{error:y}),this._frameTask.schedule(()=>{this.context.setAllFeaturesVisibility(!0)},r)}}}initialize(){const t=v.TaskPriority.FILTER_VISIBILITY,{layer:r,view:y}=this._layerView,{featureStore:D}=this.context;this._queryEngine=new q.QueryEngine({context:{spatialReference:y.spatialReference,layer:r,
scheduler:y.resourceController.scheduler,featureStore:D,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:t});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(t,this);this._updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),f.initial)}destroy(){this._updateRequested=!1;this._updatingHandles.destroy();this.clear();this._updateTask=m.abortMaybe(this._updateTask);
this._frameTask=m.removeMaybe(this._frameTask);this._queryEngine=m.destroyMaybe(this._queryEngine);this._set("context",null)}get updating(){return this.running||this._updatingHandles.updating||null!=this._updateTask&&!this._updateTask.finished}get running(){return this._updateRequested||this._frameTask.updating}get defaultVisibility(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}get _featureFilter(){return"filter"in this._layerView?this._layerView.filter:null}get _sceneFilter(){return"layerFilter"in
this._layerView?this._layerView.layerFilter:null}get _floorFilter(){return w.getFloorFilterClause(this._layerView)}get _timeExtent(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}get _compositedFeatureFilter(){const {_featureFilter:t,_timeExtent:r,_floorFilter:y}=this;if(null==r&&null==y)return t;const D=null!=t?t.clone():new x;null!=r&&(D.timeExtent=null!=D.timeExtent?D.timeExtent.intersection(r):r);null!=y&&(D.where=null==D.where||""===D.where?y:`(${D.where}) AND (${y})`);
return D}get _layerView(){return this.context.layerView}reapply(){this._updateRequested=!0}clear(){this._queryEngine.clear();this.context.clearFeaturesVisibility()}runTask(t){this._updateRequested&&(this._updateTask=m.abortMaybe(this._updateTask),this._updateTask=c.createTask(this._updateVisibility),this._updateRequested=!1,t.madeProgress());this._frameTask.processQueue(t);if(!t.hasProgressed)return p.Yield}};b.__decorate([g.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",
void 0);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"updating",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"running",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",
null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_layerView",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=b.__decorate([l.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],
a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(h,c){if(!h?.length)return null;h=h.filter(k=>""!==k).map(k=>`'${k}'`);h.push("''");return`${c} IN (${h.join(",")}) OR ${c} IS NULL`}a.getFloorFilterClause=function(h){const c=h.layer;return"floorInfo"in c&&c.floorInfo?.floorField&&"floors"in h.view?b(h.view.floors,c.floorInfo.floorField):null};a.getLayerFloorFilterClause=
function(h,c){return"floorInfo"in c&&c.floorInfo?.floorField?b(h,c.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){const q=n.QueryEngine;a.QueryEngine=class extends c{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}get defaultQueryJSON(){return(new x({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(v){super(v);
this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1}async executeQueryForIdSet(v,p,t){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(v,p),t)}async executeQueryForCount(v,p){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(v),p)}async executeQueryForExtent(v,p){const {count:t,extent:r}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(v),
p);v=e.fromJSON(r);return{count:t,extent:v}}async executeQueryForIds(v,p){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(v),p)}async executeQueryForLatestObservations(v,p){v=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(v),p);v=u.fromJSON(v);v.features.forEach(t=>{t.layer=this.layer;t.sourceLayer=this.layer});return v}async executeQuery(v,p){v=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(v),p);v=u.fromJSON(v);v.features.forEach(t=>
{t.layer=this.layer;t.sourceLayer=this.layer});return v}_ensureQueryJSON(v,p){let t=this.defaultQueryJSON;null!=v&&("outSpatialReference"in v&&!v.outSpatialReference&&(v.outSpatialReference=this.spatialReference),t=v.toJSON());null!=p&&(v=p.geometries.map(r=>r.toJSON()).reduce((r,y)=>{r.rings=r.rings.concat(y.rings);return r}),t={...t,sceneFilter:{...p,geometry:v}});return t}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const v="timeInfo"in this.layer&&
this.layer.timeInfo?.toJSON()||null,p=this.layer.objectIdField,t=w.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),r=this.layer.fieldsIndex?.toJSON()||new l([]),y=this.priority,D=this.spatialReference.toJSON(),{hasZ:E,hasM:A,featureStore:B,scheduler:F}=this.context;return this._dataQueryEngineInstance=new q({hasZ:E,hasM:A,geometryType:t,fieldsIndex:r,timeInfo:v,spatialReference:D,objectIdField:p,featureStore:B,scheduler:F,priority:y})}};b.__decorate([k.property({constructOnly:!0})],
a.QueryEngine.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([k.property()],a.QueryEngine.prototype,"layer",null);b.__decorate([k.property()],a.QueryEngine.prototype,"spatialReference",null);b.__decorate([k.property()],a.QueryEngine.prototype,"_queryGeometryType",null);b.__decorate([k.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([g.subclass("esri.views.3d.layers.graphics.QueryEngine")],
a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H){class L{constructor(K,I=null,M,S,N){this.attributes=K;this.geometry=M;this.centroid=S;this.filterFlags=N;this.groupId=-1;this.displayId=I}}const C=new d.MemCacheStorage(2E6);let z=0;class J{constructor(K){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:y.queryCapabilities};this.geometryType=K.geometryType;this.hasM=!!K.hasM;this.hasZ=!!K.hasZ;this.objectIdField=K.objectIdField;this.spatialReference=K.spatialReference;
this.definitionExpression=K.definitionExpression;this.featureStore=K.featureStore;this.aggregateAdapter=K.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=K.timeInfo;K.cacheSpatialQueries&&(this._geometryQueryCache=new d.MemCache(z++ +"$$",C));this.fieldsIndex=c.isSerializable(K.fieldsIndex)?K.fieldsIndex:G.fromJSON(K.fieldsIndex);this.availableFields=null==K.availableFields?new Set(this.fieldsIndex.fields.map(I=>I.name)):new Set(K.availableFields.map(I=>
this.fieldsIndex.get(I)?.name).filter(I=>null!=I));K.scheduler&&K.priority&&(this._frameTask=K.scheduler.registerTask(K.priority))}destroy(){this._frameTask=m.removeMaybe(this._frameTask);this.clearCache();m.destroyMaybe(this._geometryQueryCache);this._changeHandle=m.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(K,
I){I=f.signalFromSignalOrOptions(I);try{return(await this._executeQuery(K,{},I)).createQueryResponse()}catch(M){if(M!==E.queryEngineEmptyResult)throw M;return(new D.QueryEngineResult([],K,this)).createQueryResponse()}}async executeQueryForCount(K={},I){I=f.signalFromSignalOrOptions(I);try{return(await this._executeQuery(K,{returnGeometry:!1,returnCentroid:!1,outSR:null},I)).createQueryResponseForCount()}catch(M){if(M!==E.queryEngineEmptyResult)throw M;return 0}}async executeQueryForExtent(K,I){I=
f.signalFromSignalOrOptions(I);const M=K.outSR;try{const S=await this._executeQuery(K,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),N=S.size;if(!N)return{count:0,extent:null};const V=await this._getBounds(S.items,S.spatialReference,M||this.spatialReference);return{count:N,extent:V}}catch(S){if(S===E.queryEngineEmptyResult)return{count:0,extent:null};throw S;}}async executeQueryForIds(K,I){return this.executeQueryForIdSet(K,I).then(M=>Array.from(M))}async executeQueryForIdSet(K,I){I=f.signalFromSignalOrOptions(I);
try{const M=await this._executeQuery(K,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),S=M.items,N=new Set;await this._reschedule(()=>{for(const V of S)N.add(M.featureAdapter.getObjectId(V))},I);return N}catch(M){if(M===E.queryEngineEmptyResult)return new Set;throw M;}}async executeQueryForSnapping(K,I){const M=f.signalFromSignalOrOptions(I),{point:S,distance:N,returnEdge:V,vertexMode:Q}=K;if(!V&&"none"===Q)return{candidates:[]};let T=k.clone(K.query);T=await this._schedule(()=>E.normalizeQueryLike(T,
this.definitionExpression,this.spatialReference),M);T=await this._reschedule(()=>A.validateQuery(T,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);(I=!q.equals(S.spatialReference,this.spatialReference))&&await r.checkProjectionSupport(S.spatialReference,this.spatialReference);var ia="number"===typeof N?N:N.x,O="number"===typeof N?N:N.y;ia={xmin:S.x-ia,xmax:S.x+ia,ymin:S.y-O,ymax:S.y+O,spatialReference:S.spatialReference};
ia=I?r.project(ia,this.spatialReference):ia;if(!ia)return{candidates:[]};O=(await w.normalizeCentralMeridian(x.fromJSON(S),null,{signal:M}))[0];const U=(await w.normalizeCentralMeridian(x.fromJSON(ia),null,{signal:M}))[0];if(null==O||null==U)return{candidates:[]};const P=new D.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(U.toJSON())),M),T,this);await this._reschedule(()=>this._executeObjectIdsQuery(P),M);await this._reschedule(()=>this._executeTimeQuery(P),
M);await this._reschedule(()=>this._executeAttributesQuery(P),M);await this._reschedule(()=>this._executeGeometryQueryForSnapping(P,M),M);O=O.toJSON();O=I?r.project(O,this.spatialReference):O;return P.createSnappingResponse({...K,point:O,distance:I?Math.max(ia.xmax-ia.xmin,ia.ymax-ia.ymin)/2:N},S.spatialReference)}async executeQueryForLatestObservations(K,I){I=f.signalFromSignalOrOptions(I);if(!this.timeInfo?.trackIdField)throw new h("unsupported-query","Missing timeInfo or timeInfo.trackIdField",
{query:K,timeInfo:this.timeInfo});try{const M=await this._executeQuery(K,{},I);await this._reschedule(()=>this._filterLatest(M),I);return M.createQueryResponse()}catch(M){if(M!==E.queryEngineEmptyResult)throw M;return(new D.QueryEngineResult([],K,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(K={},I,M){M=f.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:V}=I;return(await this._executeQueryForStatistics(K,{field:S,normalizationField:N,valueExpression:V},
M)).createSummaryStatisticsResponse(I)}async executeQueryForUniqueValues(K={},I,M){M=f.signalFromSignalOrOptions(M);const {field:S,field2:N,field3:V,valueExpression:Q}=I;return(await this._executeQueryForStatistics(K,{field:S,field2:N,field3:V,valueExpression:Q},M)).createUniqueValuesResponse(I)}async executeQueryForClassBreaks(K={},I,M){M=f.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:V}=I;return(await this._executeQueryForStatistics(K,{field:S,normalizationField:N,
valueExpression:V},M)).createClassBreaksResponse(I)}async executeQueryForHistogram(K={},I,M){M=f.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:V}=I;return(await this._executeQueryForStatistics(K,{field:S,normalizationField:N,valueExpression:V},M)).createHistogramResponse(I)}async fetchRecomputedExtents(K){K=f.signalFromSignalOrOptions(K);this._timeExtentPromise||(this._timeExtentPromise=F.getTimeExtent(this.timeInfo,this.featureStore));const [I,M]=await Promise.all([this._getFullExtent(),
this._timeExtentPromise]);f.throwIfAborted(K);return{fullExtent:I,timeExtent:M}}async _getBounds(K,I,M){const S=n.set(n.create(),n.negativeInfinity);await this.featureStore.forEachBounds(K,N=>n.expandWithAABB(S,N));K={xmin:S[0],ymin:S[1],xmax:S[3],ymax:S[4],spatialReference:t.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(S[2])&&isFinite(S[5])&&(K.zmin=S[2],K.zmax=S[5]);I=r.project(K,I,M);I.spatialReference=t.cleanFromGeometryEngine(M);0===I.xmax-I.xmin&&(M=g.getMetersPerUnitForSR(I.spatialReference),
I.xmin-=M,I.xmax+=M);0===I.ymax-I.ymin&&(M=g.getMetersPerUnitForSR(I.spatialReference),I.ymin-=M,I.ymax+=M);this.hasZ&&null!=I.zmin&&null!=I.zmax&&0===I.zmax-I.zmin&&(M=g.getMetersPerUnitForSR(I.spatialReference),I.zmin-=M,I.zmax+=M);return I}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(K=>this._getBounds(K,this.spatialReference,
this.spatialReference)));return this._fullExtentPromise}async _schedule(K,I){return null!=this._frameTask?this._frameTask.schedule(K,I):K(H.noBudget)}async _reschedule(K,I){return null!=this._frameTask?this._frameTask.reschedule(K,I):K(H.noBudget)}async _getAllFeaturesQueryEngineResult(K){return new D.QueryEngineResult(await this._getAllFeatures(),K,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const M=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(S=>M.push(S))})().then(()=>
M)}const K=this._allFeaturesPromise,I=await K;return K===this._allFeaturesPromise?I.slice():this._getAllFeatures()}async _executeQuery(K,I,M){K=k.clone(K);K=await this._schedule(()=>E.normalizeQuery(K,this.definitionExpression,this.spatialReference),M);K=await this._reschedule(()=>A.validateQuery(K,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);K={...K,...I};const S=await this._reschedule(()=>this._executeSceneFilterQuery(K,
M),M),N=await this._reschedule(()=>this._executeGeometryQuery(K,S,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(N),M);await this._reschedule(()=>this._executeObjectIdsQuery(N),M);await this._reschedule(()=>this._executeTimeQuery(N),M);await this._reschedule(()=>this._executeAttributesQuery(N),M);return N}async _executeSceneFilterQuery(K,I){if(null==K.sceneFilter)return null;const {outSR:M,returnGeometry:S,returnCentroid:N}=K;var V=this.featureStore.featureSpatialReference,Q=K.sceneFilter.geometry;
const T=null==V||q.equals(V,Q.spatialReference)?Q:r.project(Q,V);if(!T)return null;V=S||N;V=q.isValid(M)&&!q.equals(this.spatialReference,M)&&V?async P=>this._project(P,M):P=>P;const ia=this.featureAdapter;Q=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(T)),I);if("disjoint"===K.sceneFilter.spatialRelationship){if(!Q.length)return null;const P=new Set;for(var O of Q)P.add(ia.getObjectId(O));const R=await this._reschedule(()=>this._getAllFeatures(),I);O=await this._reschedule(async()=>
{const ba=await B.getSpatialQueryOperator("esriSpatialRelDisjoint",T,this.geometryType,this.hasZ,this.hasM),X=await this._runSpatialFilter(R,da=>!P.has(ia.getObjectId(da))||ba(ia.getGeometry(da)),I);return new D.QueryEngineResult(X,K,this)},I);return V(O)}if(!Q.length)return new D.QueryEngineResult([],K,this);if(this._canExecuteSinglePass(T,K))return V(new D.QueryEngineResult(Q,K,this));const U=await B.getSpatialQueryOperator("esriSpatialRelContains",T,this.geometryType,this.hasZ,this.hasM);O=await this._runSpatialFilter(Q,
P=>U(ia.getGeometry(P)),I);return V(new D.QueryEngineResult(O,K,this))}async _executeGeometryQuery(K,I,M){if(null!=I&&0===I.items.length)return I;K=null!=I?I.query:K;const {geometry:S,outSR:N,spatialRel:V,returnGeometry:Q,returnCentroid:T}=K;var ia=this.featureStore.featureSpatialReference;const O=!S||null==ia||q.equals(ia,S.spatialReference)?S:r.project(S,ia),U=Q||T,P=q.isValid(N)&&!q.equals(this.spatialReference,N),R=this._geometryQueryCache&&null==I?P&&U?JSON.stringify({originalFilterGeometry:S,
spatialRelationship:V,outSpatialReference:N}):JSON.stringify({originalFilterGeometry:S,spatialRelationship:V}):null;ia=R?this._geometryQueryCache.get(R):null;if(null!=ia)return new D.QueryEngineResult(ia,K,this);ia=async fa=>{P&&U&&await this._project(fa,N);R&&this._geometryQueryCache.put(R,fa.items,fa.items.length+1);return fa};if(!O)return ia(null!=I?I:await this._getAllFeaturesQueryEngineResult(K));const ba=this.featureAdapter;let X=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(S)),
M);if("esriSpatialRelDisjoint"===V){if(!X.length)return ia(null!=I?I:await this._getAllFeaturesQueryEngineResult(K));const fa=new Set;for(var da of X)fa.add(ba.getObjectId(da));const aa=null!=I?I.items:await this._reschedule(()=>this._getAllFeatures(),M);da=await this._reschedule(async()=>{const Z=await B.getSpatialQueryOperator(V,O,this.geometryType,this.hasZ,this.hasM),ea=await this._runSpatialFilter(aa,ca=>!fa.has(ba.getObjectId(ca))||Z(ba.getGeometry(ca)),M);return new D.QueryEngineResult(ea,
K,this)},M);return ia(da)}if(null!=I){const fa=new b.PositionHint;X=X.filter(aa=>0<=b.indexOf(I.items,aa,I.items.length,fa))}if(!X.length)return ia=new D.QueryEngineResult([],K,this),R&&this._geometryQueryCache.put(R,ia.items,1),ia;if(this._canExecuteSinglePass(O,K))return ia(new D.QueryEngineResult(X,K,this));const ha=await B.getSpatialQueryOperator(V,O,this.geometryType,this.hasZ,this.hasM);da=await this._runSpatialFilter(X,fa=>ha(ba.getGeometry(fa)),M);return ia(new D.QueryEngineResult(da,K,this))}async _executeGeometryQueryForSnapping(K,
I){const {query:M}=K,{spatialRel:S}=M;if(K?.items?.length&&M.geometry&&S){var N=await B.getSpatialQueryOperator(S,M.geometry,this.geometryType,this.hasZ,this.hasM);I=await this._runSpatialFilter(K.items,V=>N(V.geometry),I);K.items=I}}_executeAggregateIdsQuery(K){if(0!==K.items.length&&K.query.aggregateIds?.length&&null!=this.aggregateAdapter){var I=new Set;for(const S of K.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(S).forEach(N=>I.add(N));var M=this.featureAdapter.getObjectId;K.items=
K.items.filter(S=>I.has(M(S)))}}_executeObjectIdsQuery(K){if(0!==K.items.length&&K.query.objectIds?.length){var I=new Set(K.query.objectIds),M=this.featureAdapter.getObjectId;K.items=K.items.filter(S=>I.has(M(S)))}}_executeTimeQuery(K){if(0!==K.items.length){var I=F.getTimeOperator(this.timeInfo,K.query.timeExtent,this.featureAdapter);null!=I&&(K.items=K.items.filter(I))}}_executeAttributesQuery(K){if(0!==K.items.length){var I=p.getWhereClause(K.query.where,this.fieldsIndex);if(I){if(!I.isStandardized)throw new TypeError("Where clause is not standardized");
K.items=K.items.filter(M=>I.testFeature(M,this.featureAdapter))}}}async _runSpatialFilter(K,I,M){if(!I)return K;if(null==this._frameTask)return K.filter(Q=>I(Q));let S=0;const N=[],V=async Q=>{for(;S<K.length;){const T=K[S++];I(T)&&(N.push(T),Q.madeProgress());Q.done&&await this._reschedule(ia=>V(ia),M)}};return this._reschedule(Q=>V(Q),M).then(()=>N)}_filterLatest(K){const {trackIdField:I,startTimeField:M,endTimeField:S}=this.timeInfo,N=S||M,V=new Map,Q=this.featureAdapter.getAttribute;for(const T of K.items){const ia=
Q(T,I),O=Q(T,N),U=V.get(ia);(!U||O>Q(U,N))&&V.set(ia,T)}K.items=Array.from(V.values())}_canExecuteSinglePass(K,I){({spatialRel:I}=I);return B.canQueryWithRBush(K)&&("esriSpatialRelEnvelopeIntersects"===I||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===I||"esriSpatialRelContains"===I))}async _project(K,I){if(!I||q.equals(this.spatialReference,I))return K;const M=this.featureAdapter;let S=void 0;try{const N=await this._getFullExtent();S=e.getTransformation(this.spatialReference,
I,N)}catch{}I=await r.projectMany(K.items.map(N=>t.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(N))),this.spatialReference,I,S);K.items=I.map((N,V)=>M.cloneWithGeometry(K.items[V],v.convertFromGeometry(N,this.hasZ,this.hasM)));return K}_getQueryBBoxes(K){if(B.canQueryWithRBush(K)){if(x.isExtent(K))return[l.fromValues(Math.min(K.xmin,K.xmax),Math.min(K.ymin,K.ymax),Math.max(K.xmin,K.xmax),Math.max(K.ymin,K.ymax))];if(x.isPolygon(K))return K.rings.map(I=>l.fromValues(Math.min(I[0][0],
I[2][0]),Math.min(I[0][1],I[2][1]),Math.max(I[0][0],I[2][0]),Math.max(I[0][1],I[2][1])))}return[u.getBoundsXY(l.create(),K)]}async _searchFeatures(K){const I=new Set;await Promise.all(K.map(M=>this.featureStore.forEachInBounds(M,S=>I.add(S))));K=Array.from(I.values());I.clear();return K}async _executeQueryForStatistics(K,I,M){K=k.clone(K);try{K=await this._schedule(()=>E.normalizeQuery(K,this.definitionExpression,this.spatialReference),M);K=await this._reschedule(()=>A.validateStatisticsQuery(K,I,
{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);const S=await this._reschedule(()=>this._executeSceneFilterQuery(K,M),M),N=await this._reschedule(()=>this._executeGeometryQuery(K,S,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(N),M);await this._reschedule(()=>this._executeObjectIdsQuery(N),M);await this._reschedule(()=>this._executeTimeQuery(N),M);await this._reschedule(()=>this._executeAttributesQuery(N),
M);return N}catch(S){if(S!==E.queryEngineEmptyResult)throw S;return new D.QueryEngineResult([],K,this)}}}a.Feature=L;a.QueryEngine=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,b,h,c){function k(x,w,q={}){const v=m(w,x);if(!v)throw q=n.getError(w,x),new b("unsupported-query","invalid SQL expression",{expression:w,
error:q});x=q.expressionName||"expression";if(q.validateStandardized&&!v.isStandardized)throw new b("unsupported-query",`${x} is not standard`,{expression:w});if(q.validateAggregate&&!v.isAggregate)throw new b("unsupported-query",`${x} does not contain a valid aggregate function`,{expression:w});return v.fieldNames}function m(x,w){return x?n.get(x,w):null}function d(x){return/\((.*?)\)/.test(x)?x:x.split(" as ")[0]}function f(x,w,q,v={}){const p=new Map;g(p,x,w,v.allowedFieldTypes??u,q);if(p.size)throw new b("unsupported-query",
`${v.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(p.values()),query:v.query});}function g(x,w,q,v,p){p=p.includes("*")?[...q,...p.filter(t=>"*"!==t)]:p;for(const t of p)if(w.get(t))e(x,w,q,v,t);else try{const r=d(t),y=k(w,r,{validateStandardized:!0});for(const D of y)e(x,w,q,v,D)}catch(r){x.set(t,{type:"expression-error",expression:t,error:r})}}function e(x,w,q,v,p){(w=w.get(p))?q.has(w.name)?"all"!==v&&!1===v?.has(w.type)&&x.set(p,{type:"invalid-type",fieldName:w.name,
fieldType:c.kebabDict.fromJSON(w.type),allowedFieldTypes:Array.from(v,t=>c.kebabDict.fromJSON(t))}):x.set(p,{type:"missing-field",fieldName:w.name}):x.set(p,{type:"invalid-field",fieldName:p})}const n=new h.WhereClauseCache(50,500);h=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),
u=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...h,...l]);a.allDateAndTimeFieldTypes=l;a.getAliasFromFieldName=function(x){return x.split(" as ")[1]};a.getExpressionFromFieldName=d;a.getWhereClause=m;a.numericFieldTypes=h;a.validateFields=f;a.validateHaving=function(x,w,q,v,p){if(!q)return!0;const t=k(x,q,{validateAggregate:!0,expressionName:"having clause"});f(x,w,t,{expressionName:"having clause",query:p});if(!m(q,x)?.getExpressions().every(r=>{const {aggregateType:y,
field:D}=r,E=x.get(D)?.name;return v.some(A=>{const {onStatisticField:B,statisticType:F}=A;return x.get(B)?.name===E&&F.toLowerCase().trim()===y})}))throw new b("unsupported-query","expressions in having clause should also exist in outStatistics",{having:q});return!0};a.validateWhere=function(x,w,q,v){if(!q)return!0;q=k(x,q,{validateStandardized:!0,expressionName:"where clause"});f(x,w,q,{expressionName:"where clause",query:v});return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(a,b,h){class c{constructor(k,m){this._cache=new b.LRUCache(k);this._invalidCache=new b.LRUCache(m)}get(k,m){const d=`${m.uid}:${k}`,f=this._cache.get(d);if(f)return f;if(null!=this._invalidCache.get(d))return null;try{const g=h.WhereClause.create(k,m);this._cache.put(d,g);return g}catch(g){return this._invalidCache.put(d,g),null}}getError(k,m){return this._invalidCache.get(`${m.uid}:${k}`)??null}}
a.WhereClauseCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(H){return Array.isArray(H)?
H:[H]}function v(H){return null!==H?!0!==H:null}function p(H,L){return null!=H&&null!=L?!0===H&&!0===L:!1===H||!1===L?!1:null}function t(H,L){return null!=H&&null!=L?!0===H||!0===L:!0===H||!0===L?!0:null}function r(H,L){if(null==H)return null;let C=!1;for(const z of L)if(null==z)C=null;else if(H===z){C=!0;break}return C}function y(H,L,C){if(null==H)return null;let z="",J=F.Normal;for(let K=0;K<L.length;K++){const I=L.charAt(K);switch(J){case F.Normal:I===C?J=F.Escaped:z="-[]/{}()*+?.\\^$|".includes(I)?
z+("\\"+I):"%"===I?z+".*":"_"===I?z+".":z+I;break;case F.Escaped:z="-[]/{}()*+?.\\^$|".includes(I)?z+("\\"+I):z+I,J=F.Normal}}return(new RegExp("^"+z+"$","m")).test(H)}function D(H,L,C,z){H=z.getAttribute(H,L);L=C?.get(L);return null==H||"esriFieldTypeDate"!==L?.type&&"date"!==L?.type?null==H||"esriFieldTypeDateOnly"!==L?.type&&"date-only"!==L?.type?null==H||"esriFieldTypeTimeOnly"!==L?.type&&"time-only"!==L?.type?null==H||"esriFieldTypeTimestampOffset"!==L?.type&&"timestamp-offset"!==L?.type?H:new n.SqlTimeStampOffset(H):
u.TimeOnly.fromReader(H):m.DateOnly.fromReader(H):g.convertToExecutingTimeZone(new Date(H),C?.getLuxonTimeZone(L.name)??w.FixedOffsetZone.utcInstance)}const E=new Set(["current_timestamp","current_date","current_time"]);class A{static makeBool(H){return!0===H}static featureValue(H,L,C,z){return D(H,L,C,z)}static equalsNull(H){return null===H}static applyLike(H,L,C){return y(H,L,C)}static ensureArray(H){return q(H)}static applyIn(H,L){return r(H,L)}static currentDate(H){return m.DateOnly.fromNow(H)}static makeSqlInterval(H,
L,C){return e.SqlInterval.createFromValueAndQualifier(H,L,C)}static convertInterval(H){return H instanceof e.SqlInterval?H.valueInMilliseconds():H}static currentTimestamp(H){return g.convertToExecutingTimeZone(new Date,H)}static compare(H,L,C,z){return f.sqlCompare(L,C,H)}static calculate(H,L,C,z){return d.sqlCalculateFunction(H,L,C,z)}static evaluateTime(H){return g.parseTime(H)}static evaluateTimestamp(H,L,C){return g.parseTimestamp(H,L,C)}static evaluateDate(H,L){return g.parseDate(H,L)}static evaluateFunction(H,
L,C){return l.evaluateFunction(H,L,C)}static lookup(H,L){H=L[H];return void 0===H?null:H}static between(H,L,C){return null==H||null==L[0]||null==L[1]?null:f.sqlCompare(H,L[0],"\x3e\x3d")&&f.sqlCompare(H,L[1],"\x3c\x3d")}static notbetween(H,L,C){return null==H||null==L[0]||null==L[1]?null:f.sqlCompare(H,L[0],"\x3c")||f.sqlCompare(H,L[1],"\x3e")}static ternaryNot(H){return v(H)}static ternaryAnd(H,L){return p(H,L)}static ternaryOr(H,L){return t(H,L)}}class B{constructor(H,L,C="UTC"){this.fieldsIndex=
L;this.timeZone=C;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=x.WhereGrammar.parse(H);const {isStandardized:z,isAggregate:J,referencedFieldNames:K}=this._extractExpressionInfo(L);this._referencedFieldNames=K;this.isStandardized=z;this.isAggregate=J}static convertValueToStorageFormat(H,L=null){if(null===L)return g.isDate(H)?H.getTime():g.isDateTime(H)?H.toMillis():g.isTimestampOffset(H)?H.toStorageFormat():g.isTimeOnly(H)?H.toStorageString():g.isDateOnly(H)?H.toStorageFormat():
H;switch(L){case "date":if(g.isDate(H))return H.getTime();if(g.isDateTime(H))return H.toMillis();if(g.isTimestampOffset(H))return H.toMilliseconds();if(g.isDateOnly(H))return H.toNumber();break;case "date-only":if(g.isDate(H))return m.DateOnly.fromDateJS(H).toString();if(g.isTimestampOffset(H))return m.DateOnly.fromSqlTimeStampOffset(H).toString();if(g.isDateTime(H))return m.DateOnly.fromDateTime(H).toString();break;case "time-only":if(g.isDate(H))return u.TimeOnly.fromDateJS(H).toStorageString();
if(g.isDateTime(H))return u.TimeOnly.fromDateTime(H).toStorageString();if(g.isTimestampOffset(H))return u.TimeOnly.fromSqlTimeStampOffset(H).toStorageString();if(g.isTimeOnly(H))return H.toStorageString();break;case "timestamp-offset":if(g.isDate(H))return n.SqlTimeStampOffset.fromJSDate(H).toStorageFormat();if(g.isDateTime(H))return n.SqlTimeStampOffset.fromDateTime(H).toStorageFormat();if(g.isTimestampOffset(H))return H.toStorageFormat()}return H}static create(H,L,C="UTC"){return new B(H,L,C)}get fieldNames(){return this._referencedFieldNames}testSet(H,
L=G){return!!this._evaluateNode(this.parseTree,null,L,H)}calculateValue(H,L=G){H=this._evaluateNode(this.parseTree,H,L,null);return H instanceof e.SqlInterval?H.valueInMilliseconds()/864E5:H}calculateValueCompiled(H,L=G){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(H,this.parameters,L,this.fieldsIndex,this.timeZone);if(c("esri-csp-restrictions"))return this.calculateValue(H,L);this._compileMe();return this.parseTree._compiledVersion(H,this.parameters,L,this.fieldsIndex,
this.timeZone)}testFeature(H,L=G){return!!this._evaluateNode(this.parseTree,H,L,null)}testFeatureCompiled(H,L=G){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(H,this.parameters,L,this.fieldsIndex,this.timeZone);if(c("esri-csp-restrictions"))return this.testFeature(H,L);this._compileMe();return!!this.parseTree._compiledVersion(H,this.parameters,L,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=
!1;this._visitAll(this.parseTree,H=>{"current-time"===H.type?this._hasDateFunctions=!0:"function"===H.type&&(this._hasDateFunctions=this._hasDateFunctions||E.has(H.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const H=new Set;this._visitAll(this.parseTree,L=>{"function"===L.type&&H.add(L.name.toLowerCase())});return Array.from(H)}getExpressions(){const H=new Map;this._visitAll(this.parseTree,L=>{if("function"===L.type){const C=L.name.toLowerCase();L=L.args.value[0];if("column-reference"===
L.type){L=L.column;const z=`${C}-${L}`;H.has(z)||H.set(z,{aggregateType:C,field:L})}}});return[...H.values()]}getVariables(){const H=new Set;this._visitAll(this.parseTree,L=>{"parameter"===L.type&&H.add(L.value.toLowerCase())});return Array.from(H)}_compileMe(){const H="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone",H)).bind(A)}_extractExpressionInfo(H){const L=
[],C=new Set;let z=!0,J=!1;this._visitAll(this.parseTree,K=>{switch(K.type){case "column-reference":var I=H?.get(K.column);let M;I?I=M=I.name??"":(M=K.column,I=M.toLowerCase());C.has(I)||(C.add(I),L.push(M));K.column=M;break;case "function":const {name:S,args:N}=K;K=N.value.length;z&&=l.isStandardized(S,K);!1===J&&(J=k.isAggregate(S,K))}});return{referencedFieldNames:Array.from(L),isStandardized:z,isAggregate:J}}_visitAll(H,L){if(null!=H)switch(L(H),H.type){case "when-clause":this._visitAll(H.operand,
L);this._visitAll(H.value,L);break;case "case-expression":for(const C of H.clauses)this._visitAll(C,L);"simple"===H.format&&this._visitAll(H.operand,L);null!==H.else&&this._visitAll(H.else,L);break;case "expression-list":for(const C of H.value)this._visitAll(C,L);break;case "unary-expression":this._visitAll(H.expr,L);break;case "binary-expression":this._visitAll(H.left,L);this._visitAll(H.right,L);break;case "function":this._visitAll(H.args,L)}}evaluateNodeToJavaScript(H){switch(H.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(H.value)+", "+JSON.stringify(H.qualifier)+","+JSON.stringify(H.op)+")";case "case-expression":var L="";if("simple"===H.format){var C=this.evaluateNodeToJavaScript(H.operand);L="( ";for(let z=0;z<H.clauses.length;z++)L+=" (this.compare('\x3d',"+C+","+this.evaluateNodeToJavaScript(H.clauses[z].operand)+") ? ("+this.evaluateNodeToJavaScript(H.clauses[z].value)+") : "}else for(L="( ",C=0;C<H.clauses.length;C++)L+=" this.makeBool("+this.evaluateNodeToJavaScript(H.clauses[C].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(H.clauses[C].value)+") : ";L=null!==H.else?L+this.evaluateNodeToJavaScript(H.else):L+"null";return L+" )";case "parameter":return"this.lookup("+JSON.stringify(H.value.toLowerCase())+",lookups)";case "expression-list":L="[";for(C of H.value)"["!==L&&(L+=","),L+=this.evaluateNodeToJavaScript(C);return L+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(H.expr)+")";case "binary-expression":switch(H.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+" )";case "IS":if("null"!==H.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(H.left)+")";case "ISNOT":if("null"!==H.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(H.left)+
")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(H.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(H.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(H.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(H.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(H.left)+
","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+","+JSON.stringify(H.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+","+JSON.stringify(H.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(H.operator)+
","+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(H.operator)+","+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)"}throw new h.SqlError(h.SqlErrorCodes.UnsupportedOperator,{operator:H.operator});case "null":case "boolean":case "string":case "number":return JSON.stringify(H.value);case "time":return"this.evaluateTime(JSON.stringify(node.value))";
case "date":return"this.evaluateDate(JSON.stringify(node.value), 'unknown')";case "timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), 'unknown')";case "current-time":return"date"===H.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(H.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(H.name)+","+this.evaluateNodeToJavaScript(H.args)+", timeZone)"}throw new h.SqlError(h.SqlErrorCodes.UnsupportedSyntax,
{node:H.type});}_evaluateNode(H,L,C,z){switch(H.type){case "interval":return C=this._evaluateNode(H.value,L,C,z),e.SqlInterval.createFromValueAndQualifier(C,H.qualifier,H.op);case "case-expression":if("simple"===H.format){var J=this._evaluateNode(H.operand,L,C,z);for(var K=0;K<H.clauses.length;K++)if(f.sqlCompare(J,this._evaluateNode(H.clauses[K].operand,L,C,z),"\x3d",this.timeZone))return this._evaluateNode(H.clauses[K].value,L,C,z)}else for(J=0;J<H.clauses.length;J++)if(!0===this._evaluateNode(H.clauses[J].operand,
L,C,z))return this._evaluateNode(H.clauses[J].value,L,C,z);return null!==H.else?this._evaluateNode(H.else,L,C,z):null;case "parameter":return H=this.parameters[H.value.toLowerCase()],g.isDate(H)?w.DateTime.fromJSDate(H):H instanceof b.ArcadeDate?H.toDateTime():H;case "expression-list":J=[];for(var I of H.value)J.push(this._evaluateNode(I,L,C,z));return J;case "unary-expression":return v(this._evaluateNode(H.expr,L,C,z));case "binary-expression":switch(H.operator){case "AND":return p(this._evaluateNode(H.left,
L,C,z),this._evaluateNode(H.right,L,C,z));case "OR":return t(this._evaluateNode(H.left,L,C,z),this._evaluateNode(H.right,L,C,z));case "IS":if("null"!==H.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(H.left,L,C,z);case "ISNOT":if("null"!==H.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(H.left,L,C,z);case "IN":return J=q(this._evaluateNode(H.right,L,C,z)),r(this._evaluateNode(H.left,L,C,z),J);case "NOT IN":return J=
q(this._evaluateNode(H.right,L,C,z)),v(r(this._evaluateNode(H.left,L,C,z),J));case "BETWEEN":return J=this._evaluateNode(H.left,L,C,z),H=this._evaluateNode(H.right,L,C,z),null==J||null==H[0]||null==H[1]?null:f.sqlCompare(J,H[0],"\x3e\x3d",this.timeZone)&&f.sqlCompare(J,H[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return J=this._evaluateNode(H.left,L,C,z),H=this._evaluateNode(H.right,L,C,z),null==J||null==H[0]||null==H[1]?null:f.sqlCompare(J,H[0],"\x3c",this.timeZone)||f.sqlCompare(J,H[1],"\x3e",
this.timeZone);case "LIKE":return y(this._evaluateNode(H.left,L,C,z),this._evaluateNode(H.right,L,C,z),H.escape);case "NOT LIKE":return v(y(this._evaluateNode(H.left,L,C,z),this._evaluateNode(H.right,L,C,z),H.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return f.sqlCompare(this._evaluateNode(H.left,L,C,z),this._evaluateNode(H.right,L,C,z),H.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return d.sqlCalculateFunction(H.operator,
this._evaluateNode(H.left,L,C,z),this._evaluateNode(H.right,L,C,z),this.timeZone)}case "null":case "boolean":case "string":case "number":return H.value;case "date":return H.parsedValue??(H.parsedValue=g.parseDate(H.value,"unknown")),H.parsedValue;case "timestamp":return H.parsedValue??(H.parsedValue=g.parseTimestamp(H.value,"unknown")),H.parsedValue;case "time":return g.parseTime(H.value);case "current-time":return"date"===H.mode?m.DateOnly.fromNow(this.timeZone):g.convertToExecutingTimeZone(new Date,
this.timeZone);case "column-reference":return D(L,H.column,this.fieldsIndex,C);case "data-type":return H.value;case "function":if(this.isAggregate&&k.isAggregate(H.name,H.args.value.length)){L=[];for(J of H.args?.value||[]){I=[];for(K of z||[])I.push(this._evaluateNode(J,K,C,null));L.push(I)}return k.aggregateFunction(H.name,L)}C=this._evaluateNode(H.args,L,C,z);return l.evaluateFunction(H.name,C,this.timeZone)}throw new h.SqlError(h.SqlErrorCodes.UnsupportedSyntax,{node:H.type});}}var F;(function(H){H[H.Normal=
0]="Normal";H[H.Escaped=1]="Escaped"})(F||={});const G={getAttribute(H,L){return(H&&"object"===typeof H.attributes?H.attributes:H)[L]}};a.WhereClause=B;a.defaultAttributeAdapter=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,b,h,c){function k(e,n,l){return e<n?e-n:e>l?e-l:0}function m(e,n=!0){if(e instanceof c.Zone)return e;if("system"===e.toLowerCase())return"system";
if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return h.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const l=c.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(l)return l}e=c.IANAZone.create(e);if(!e.isValid){if(n)throw new f(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return e}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const d={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class f extends Error{constructor(e,n){super(b.replace(d[e],n));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,f)}}class g{constructor(e){this._date=e;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,n=1,l=1,u=0,x=0,w=0,q=0,v){if(isNaN(e)||isNaN(n)||isNaN(l)||isNaN(u)||isNaN(x)||isNaN(w)||isNaN(q))return null;const p=
c.DateTime.local(e,n).daysInMonth;e=c.DateTime.fromObject({day:1>l?1:l>p?p:l,year:e,month:1>n?1:12<n?12:n,hour:0>u?0:23<u?23:u,minute:0>x?0:59<x?59:x,second:0>w?0:59<w?59:w,millisecond:0>q?0:999<q?999:q},{zone:m(v)});e=e.plus({months:k(n,1,12),days:k(l,1,p),hours:k(u,0,23),minutes:k(x,0,59),seconds:k(w,0,59),milliseconds:k(q,0,999)});return new g(e)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,n){n=
m(n);return e.isUnknownTimeZone||n===h.UnknownTimeZone.instance?g.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,n):new g(e._date.setZone(n))}static dateJSToArcadeDate(e){return new g(c.DateTime.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,n="system"){n=m(n);return new g(c.DateTime.fromJSDate(e,{zone:n}))}static unknownEpochToArcadeDate(e){return new g(c.DateTime.fromMillis(e,{zone:h.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(e){return new g(c.DateTime.fromMillis(e.getTime(),
{zone:h.UnknownTimeZone.instance}))}static epochToArcadeDate(e,n="system"){n=m(n);return new g(c.DateTime.fromMillis(e,{zone:n}))}static dateTimeToArcadeDate(e){return new g(e)}clone(){return new g(this._date)}changeTimeZone(e){e=m(e);return g.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(e,n){n=m(n);return e.zone===h.UnknownTimeZone.instance||n===h.UnknownTimeZone.instance?g.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,n):new g(e.setZone(n))}static nowToArcadeDate(e){e=
m(e);return new g(c.DateTime.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new g(c.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===g.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone!==e.isUnknownTimeZone?!1:this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===h.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=
this._date.weekday;6<e&&(e=0);return e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new g(this._date.plus(e))}diff(e,n="milliseconds"){return this._date.diff(e._date,n)[n]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,n){return this._date.toISOTime({suppressMilliseconds:e,
includeOffset:n&&!this.isUnknownTimeZone})}toFormat(e,n){this.isUnknownTimeZone&&(e=e.replaceAll("Z",""));return this._date.toFormat(e,n)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new g(this._date.toUTC())}toLocal(){return new g(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;
e=c.DateTime.fromISO(e,{setZone:!0});return new g(e)}}a.ArcadeDate=g;a.ArcadeDateError=f;a.arcadeDateErrorMessages=d;a.createDateTimeZone=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(a,b){a.SqlErrorCodes=void 0;(function(d){d.InvalidFunctionParameters="InvalidFunctionParameters";d.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";d.UnsupportedSqlFunction=
"UnsupportedSqlFunction";d.UnsupportedOperator="UnsupportedOperator";d.UnsupportedSyntax="UnsupportedSyntax";d.UnsupportedIsRhs="UnsupportedIsRhs";d.UnsupportedIsLhs="UnsupportedIsLhs";d.InvalidDataType="InvalidDataType";d.CannotCastValue="CannotCastValue";d.FunctionNotRecognized="FunctionNotRecognized";d.InvalidTime="InvalidTime";d.InvalidParameterCount="InvalidParameterCount";d.InvalidTimeStamp="InvalidTimeStamp";d.InvalidDate="InvalidDate";d.InvalidOperator="InvalidOperator";d.IllegalInterval=
"IllegalInterval";d.YearMonthIntervals="YearMonthIntervals";d.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";d.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const h={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",
[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",
[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};
class c extends Error{constructor(d,f){super(b.replace(h[d],f));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,c)}}a.FeatureSetErrorCodes=void 0;(function(d){d.NeverReach="NeverReach";d.NotImplemented="NotImplemented";d.Cancelled="Cancelled";d.InvalidStatResponse="InvalidStatResponse";d.InvalidRequest="InvalidRequest";d.RequestFailed="RequestFailed";d.MissingFeatures="MissingFeatures";d.AggregationFieldNotFound="AggregationFieldNotFound";
d.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const k={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",
[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class m extends Error{constructor(d,f){super(b.replace(k[d],f));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,m)}}a.FeatureSetError=m;a.SqlError=c;a.featureSetErrorMessages=k;a.sqlErrorMessages=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,h,c,k,m){function d(n){if(null===n)return null;let l=0,u=0;for(let x=0;x<n.length;x++){const w=n[x];if(null!==w){if("number"!==typeof w)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);u++;l+=w}}return 0===u?null:l/n.length}function f(n,l){if(null===
n)return null;let u=null,x=null;for(const w of n)n=w,n=w instanceof h.DateOnly?w.toNumber():w instanceof k.TimeOnly?w.toNumber():w instanceof m.DateTime?w.toMillis():w instanceof c.SqlTimeStampOffset?w.toMilliseconds():w,null===u?(u=w,x=n):"max"===l&&null!==x&&null!==n&&x<=n?(u=w,x=n):"min"===l&&null!==x&&null!==n&&x>=n&&(u=w,x=n);return u}function g(n){if(null===n)return null;n=n.filter(x=>null!==x);if(0===n.length)return null;const l=d(n);if(null===l)return null;let u=0;for(const x of n){if("number"!==
typeof x)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);u+=(l-x)**2}return u/(n.length-1)}const e={min:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"min")},max:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"max")},avg:{minParams:1,maxParams:1,evaluate:n=>d(n[0])},sum:{minParams:1,maxParams:1,evaluate:n=>{n=n[0];if(null===n)n=null;else{var l=0;for(let u=0;u<n.length;u++){const x=n[u];if(null!==x){if("number"!==typeof x)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);
l+=x}}n=l}return n}},stddev:{minParams:1,maxParams:1,evaluate:n=>{n=n[0];null===n?n=null:(n=g(n),n=null===n?null:Math.sqrt(n));return n}},count:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].length},var:{minParams:1,maxParams:1,evaluate:n=>g(n[0])}};a.aggregateFunction=function(n,l){const u=e[n.toLowerCase()];if(null==u)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(l.length<u.minParams||l.length>u.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:n.toUpperCase()});
return u.evaluate(l)};a.isAggregate=function(n,l){n=e[n.toLowerCase()];return null!=n&&l>=n.minParams&&l<=n.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,b,h,c){function k(d){d=d.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let f="";const g=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const e of d.match(g)||[])switch(e){case "D":f+="d";break;case "DD":f+="dd";break;case "DDD":f+="o";break;case "d":f+="c";break;case "ddd":f+="ccc";break;case "dddd":f+="cccc";break;case "M":f+="L";break;case "MM":f+="LL";break;case "MMM":f+="LLL";break;case "MMMM":f+="LLLL";break;case "YY":f+="yy";break;case "Y":case "YYYY":f+="yyyy";break;case "Q":f+="q";break;case "X":case "x":f+=e;break;default:f=2<=e.length&&"["===e.slice(0,1)&&"]"===e.slice(-1)?f+`'${e.slice(1,-1)}'`:f+`'${e}'`}return f}
class m{constructor(d,f,g){this._year=d;this._month=f;this._day=g;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(d){return d instanceof m&&d.day===this.day&&d.month===this.month&&d.year===this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(d){return c.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:b.createDateTimeZone(d)})}toDateTimeLuxon(d){return c.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:b.createDateTimeZone(d)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(d=null){if(null===d||""===d)return this.toString();d=k(d);if(!d)return"";const f=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(f).toFormat(d,{locale:h.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const d=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(d)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd")}toSQLValue(){return this.toFormat("yyyy-LL-dd")}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd")+"'"}plus(d,f){return m.fromDateTime(this.toUTCDateTime().plus({[d]:f}))}toUTCDateTime(){return c.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(d,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(d.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(d.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(d.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(d.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(d.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(d){d=c.DateTime.fromMillis(d,{zone:c.FixedOffsetZone.utcInstance});
return d.isValid?m.fromParts(d.year,d.month,d.day):null}static fromSeconds(d){d=c.DateTime.fromSeconds(d,{zone:c.FixedOffsetZone.utcInstance});return d.isValid?m.fromParts(d.year,d.month,d.day):null}static fromReader(d){if(!d)return null;d=d.split("-");return 3!==d.length?null:new m(parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10))}static fromParts(d,f,g){d=new m(d,f,g);return!1===d.isValid?null:d}static fromDateJS(d){return m.fromParts(d.getFullYear(),d.getMonth()+1,d.getDay())}static fromDateTime(d){return m.fromParts(d.year,
d.month,d.day)}static fromSqlTimeStampOffset(d){return this.fromDateTime(d.toDateTime())}static fromString(d,f=null){if(""===d||null===d)return null;var g=[];if(f)(f=k(f))&&g.push(f);else if(null===f||""===f)return d=c.DateTime.fromISO(d,{setZone:!0}),d.isValid?m.fromParts(d.year,d.month,d.day):null;for(const e of g)if(g=c.DateTime.fromFormat(d,f??e),g.isValid)return new m(g.year,g.month,g.day);return null}static fromNow(d="system"){d=c.DateTime.fromJSDate(new Date).setZone(b.createDateTimeZone(d));
return new m(d.year,d.month,d.day)}}a.DateOnly=m;a.standardizeDateOnlyFormat=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(a,b){function h(k){return Number.isNaN(k)||0===k?k:Math.trunc(k)}class c{constructor(k){this._timeStampOffset=k;this._date=null}toDateTime(){this._date??(this._date=b.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return h(this.toDateTime().offset/
60)}get timezoneOffsetMinutes(){return h(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return c.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(k){return new c(b.DateTime.fromJSDate(k).toISO({includeOffset:!0}))}static fromDateTime(k){return new c(k.toISO({includeOffset:!0}))}static fromParts(k,
m,d=0,f=0,g=0,e=0,n=0,l=!1,u=0,x=0){k=`${k.toString().padStart(4,"0")}-${m.toString().padStart(2,"0")}-${d.toString().padStart(2,"0")}`;m="";10>e&&(m="0");f=`${f.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${m+e.toString()}`;0!==n&&(f+="."+n.toString().padStart(3,"0"));n=`${l?"-":"+"}${u.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;return new c(k+"T"+f+n)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let k=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});k&&=k.replace(".000","");return k}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(k){k=this.toDateTime().plus(k);return c.fromDateTime(k)}}a.SqlTimeStampOffset=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,b,h,c){function k(d){if(!d)return"";const f=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let g="";for(const e of d.match(f)||
[])switch(e){case "SSS":g+=e;break;case "A":case "a":g+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":g+=e;break;default:g+=`'${e}'`}return g}class m{constructor(d,f,g,e){this._hour=d;this._minute=f;this._second=g;this._millisecond=e;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(d){return d instanceof m&&d.hour===
this.hour&&d.minute===this.minute&&d.second===this.second&&d.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return b.isInteger(this.hour)&&b.isInteger(this.minute)&&b.isInteger(this.second)&&b.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(d=null){return null===d||""===d?this.toString():(d=k(d))?c.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(d,{locale:h.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(d,f,g,e){d=new m(d,f,g,e);return d.isValid()?d:null}static fromReader(d){if(!d)return null;d=d.split(":");return 3!==d.length?null:new m(parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],
10),0)}static fromMilliseconds(d){return 864E5<d||0>d?null:new m(Math.floor(d/36E5%24),Math.floor(d/6E4%60),Math.floor(d/1E3%60),Math.floor(d%1E3))}static fromDateJS(d){return new m(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())}static fromDateTime(d){return new m(d.hour,d.minute,d.second,d.millisecond)}static fromSqlTimeStampOffset(d){return this.fromDateTime(d.toDateTime())}static fromString(d,f=null){if(""===d||null===d)return null;const g=[];if(f)(f=k(f))&&g.push(f);else if(null===
f||""===f)g.push("HH:mm:ss"),g.push("HH:mm:ss.SSS"),g.push("hh:mm:ss a"),g.push("hh:mm:ss.SSS a"),g.push("HH:mm"),g.push("hh:mm a"),g.push("H:mm"),g.push("h:mm a"),g.push("H:mm:ss"),g.push("h:mm:ss a"),g.push("H:mm:ss.SSS"),g.push("h:mm:ss.SSS a");for(const e of g)if(f=c.DateTime.fromFormat(d,e),f.isValid)return new m(f.hour,f.minute,f.second,f.millisecond);return null}plus(d,f){switch(d){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[d]:f}))}return null}toUTCDateTime(){return c.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(d,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(d.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(d.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(d.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(d.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(d.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=m;a.standardizeTimeFormat=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,b){a.cloneGeometry=function(h){if(null==h)return null;const c=h.clone();void 0!==h.cache._geVersion&&(c.cache._geVersion=h.cache._geVersion);return c};a.convertLinearUnitsToCode=function(h){if(null==h)return null;if("number"===typeof h)return h;h=h.toLowerCase();h=h.replaceAll(/\s/g,"");h=h.replaceAll("-","");switch(h){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(h){if(null==h)return null;if("number"===typeof h)return h;h=h.toLowerCase();h=h.replaceAll(/\s/g,"");h=h.replaceAll("-","");switch(h){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(h){return"number"===typeof h&&isFinite(h)&&Math.floor(h)===h};a.sameGeomType=function(h,c){return h===c||"point"===h&&"esriGeometryPoint"===c||"polyline"===h&&"esriGeometryPolyline"===
c||"polygon"===h&&"esriGeometryPolygon"===c||"extent"===h&&"esriGeometryEnvelope"===c||"multipoint"===h&&"esriGeometryMultipoint"===c||"point"===c&&"esriGeometryPoint"===h||"polyline"===c&&"esriGeometryPolyline"===h||"polygon"===c&&"esriGeometryPolygon"===h||"extent"===c&&"esriGeometryEnvelope"===h||"multipoint"===c&&"esriGeometryMultipoint"===h?!0:!1};a.shapeExtent=function(h){if(null==h)return null;switch(h.type){case "polygon":case "multipoint":case "polyline":return h.extent;case "point":return new b({xmin:h.x,
ymin:h.y,xmax:h.x,ymax:h.y,spatialReference:h.spatialReference});case "extent":return h}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,b,h,c,k){function m(W,Y,ja){switch(ja){case "+":return W+Y;case "-":return W-Y;case "*":return W*Y;case "/":return W/Y}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function d(W,Y,ja){switch(ja){case "+":return Y.plus({milliseconds:W.valueInMilliseconds()});case "-":return W.valueInMilliseconds()-Y.toMillis()}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function f(W,Y,ja){switch(ja){case "+":return Y.plus("milliseconds",W.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function g(W,Y,ja){switch(ja){case "+":return Y.plus("milliseconds",W.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function e(W,
Y,ja){switch(ja){case "+":return W.plus("milliseconds",Y.valueInMilliseconds());case "-":return W.plus("milliseconds",-1*Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function n(W,Y,ja){switch(ja){case "+":return Y.addMilliseconds(W.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function l(W,Y,ja){switch(ja){case "+":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()+Y.valueInMilliseconds());case "-":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()-
Y.valueInMilliseconds());case "*":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()*Y.valueInMilliseconds());case "/":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()/Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function u(W,Y,ja){switch(ja){case "+":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()+Y);case "-":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()-Y);case "*":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()*
Y);case "/":return c.SqlInterval.createFromMilliseconds(W.valueInMilliseconds()/Y)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function x(W,Y,ja){switch(ja){case "+":return c.SqlInterval.createFromMilliseconds(W+Y.valueInMilliseconds());case "-":return c.SqlInterval.createFromMilliseconds(W-Y.valueInMilliseconds());case "*":return c.SqlInterval.createFromMilliseconds(W*Y.valueInMilliseconds());case "/":return c.SqlInterval.createFromMilliseconds(W/Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function w(W,Y,ja){switch(ja){case "+":return W.plus("milliseconds",Y.valueInMilliseconds());case "-":return W.plus("milliseconds",-1*Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function q(W,Y,ja){switch(ja){case "+":return W.plus({milliseconds:Y.valueInMilliseconds()});case "-":return W.minus({milliseconds:Y.valueInMilliseconds()})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function v(W,Y,ja){switch(ja){case "+":return W.addMilliseconds(Y.valueInMilliseconds());
case "-":return W.addMilliseconds(-1*Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function p(W,Y,ja){Y*=864E5;switch(ja){case "+":return W.plus({milliseconds:Y});case "-":return W.minus({milliseconds:Y})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function t(W,Y,ja){Y*=864E5;switch(ja){case "+":return W.plus("milliseconds",Y);case "-":return W.plus("milliseconds",-1*Y)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function r(W,Y,ja){Y*=864E5;
switch(ja){case "+":return W.plus("milliseconds",Y);case "-":return W.plus("milliseconds",-1*Y)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function y(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function D(W,Y,ja){Y*=864E5;switch(ja){case "+":return W.addMilliseconds(Y);case "-":return W.addMilliseconds(-1*Y)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function E(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function A(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function B(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function F(W,Y,ja){Y=parseFloat(Y);if(isNaN(Y))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(W,Y,ja)}function G(W,Y,ja){W=parseFloat(W);if(isNaN(W))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(W,Y,ja)}function H(W,Y,ja){switch(ja){case "+":return W+Y}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function L(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function C(W,
Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function z(W,Y,ja){switch(ja){case "-":return W.toDateTimeLuxon(Y.zone).diff(Y).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function J(W,Y,ja){switch(ja){case "-":return W.toDateTimeLuxon(Y.toDateTime().zone).diff(Y.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function K(W,Y,ja){switch(ja){case "-":return W.toDateTimeLuxon("UTC").diff(Y.toDateTimeLuxon("UTC")).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function I(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function M(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function S(W,Y,ja){switch(ja){case "-":return W.toDateTime().diff(Y.toDateTimeLuxon(W.toDateTime().zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function N(W,Y,ja){switch(ja){case "-":return W.toDateTime().diff(Y).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function V(W,Y,ja){switch(ja){case "-":return W.toDateTime().diff(Y.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function Q(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function T(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ia(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function O(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function U(W,Y,ja){switch(ja){case "-":return W.diff(Y).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function P(W,Y,ja){switch(ja){case "-":return W.diff(Y.toDateTimeLuxon(W.zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function R(W,Y,ja){switch(ja){case "-":return W.diff(Y.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ba(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function X(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function da(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ha(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function fa(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function aa(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Z(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ea(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ca(W,Y,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=K;a.calculateDateOnlyAndDateTime=z;a.calculateDateOnlyAndNumber=t;a.calculateDateOnlyAndSqlInterval=w;a.calculateDateOnlyAndString=X;a.calculateDateOnlyAndTimeOnly=I;a.calculateDateOnlyAndTimestamp=
J;a.calculateDateTimeAndDateOnly=P;a.calculateDateTimeAndDateTime=U;a.calculateDateTimeAndNumber=p;a.calculateDateTimeAndSqlInterval=q;a.calculateDateTimeAndString=ha;a.calculateDateTimeAndTimeOnly=ba;a.calculateDateTimeAndTimestamp=R;a.calculateNumberAndDateOnly=B;a.calculateNumberAndDateTime=y;a.calculateNumberAndNumber=m;a.calculateNumberAndSqlInterval=x;a.calculateNumberAndString=F;a.calculateNumberAndTimeOnly=A;a.calculateNumberAndTimestamp=E;a.calculateSqlIntervalAndDateOnly=g;a.calculateSqlIntervalAndDateTime=
d;a.calculateSqlIntervalAndNumber=u;a.calculateSqlIntervalAndSqlInterval=l;a.calculateSqlIntervalAndString=L;a.calculateSqlIntervalAndTimeOnly=f;a.calculateSqlIntervalAndTimestamp=n;a.calculateStringAndDateOnly=Z;a.calculateStringAndDateTime=ea;a.calculateStringAndNumber=G;a.calculateStringAndSqlInterval=C;a.calculateStringAndString=H;a.calculateStringAndTimeOnly=aa;a.calculateStringAndTimestamp=ca;a.calculateTimeOnlyAndDateOnly=T;a.calculateTimeOnlyAndDateTime=Q;a.calculateTimeOnlyAndNumber=r;a.calculateTimeOnlyAndSqlInterval=
e;a.calculateTimeOnlyAndString=da;a.calculateTimeOnlyAndTimeOnly=O;a.calculateTimeOnlyAndTimestamp=ia;a.calculateTimestampAndDateOnly=S;a.calculateTimestampAndDateTime=N;a.calculateTimestampAndNumber=D;a.calculateTimestampAndSqlInterval=v;a.calculateTimestampAndString=fa;a.calculateTimestampAndTimeOnly=M;a.calculateTimestampAndTimestamp=V;a.sqlCalculateFunction=function(W,Y,ja,oa){if("||"===W)return k.evaluateFunction("concat",[Y,ja],oa);if(null===Y||null===ja)return null;if(h.isNumber(Y)){if(h.isNumber(ja))return m(Y,
ja,W);if(h.isSqlInterval(ja))return x(Y,ja,W);if(h.isTimeOnly(ja))return A();if(h.isDateOnly(ja))return B();if(h.isTimestampOffset(ja))return E();if(h.isDateTime(ja))return y();if(h.isString(ja))return F(Y,ja,W)}else if(h.isDateOnly(Y)){if(h.isNumber(ja))return t(Y,ja,W);if(h.isSqlInterval(ja))return w(Y,ja,W);if(h.isTimeOnly(ja))return I();if(h.isDateOnly(ja))return K(Y,ja,W);if(h.isTimestampOffset(ja))return J(Y,ja,W);if(h.isDateTime(ja))return z(Y,ja,W);if(h.isString(ja))return X()}else if(h.isTimeOnly(Y)){if(h.isNumber(ja))return r(Y,
ja,W);if(h.isSqlInterval(ja))return e(Y,ja,W);if(h.isTimeOnly(ja))return O();if(h.isDateOnly(ja))return T();if(h.isTimestampOffset(ja))return ia();if(h.isDateTime(ja))return Q();if(h.isString(ja))return da()}else if(h.isSqlInterval(Y)){if(h.isNumber(ja))return u(Y,ja,W);if(h.isSqlInterval(ja))return l(Y,ja,W);if(h.isTimeOnly(ja))return f(Y,ja,W);if(h.isDateOnly(ja))return g(Y,ja,W);if(h.isTimestampOffset(ja))return n(Y,ja,W);if(h.isDateTime(ja))return d(Y,ja,W);if(h.isString(ja))return L()}else if(h.isDateTime(Y)){if(h.isNumber(ja))return p(Y,
ja,W);if(h.isSqlInterval(ja))return q(Y,ja,W);if(h.isTimeOnly(ja))return ba();if(h.isDateOnly(ja))return P(Y,ja,W);if(h.isTimestampOffset(ja))return R(Y,ja,W);if(h.isDateTime(ja))return U(Y,ja,W);if(h.isString(ja))return ha()}else if(h.isTimestampOffset(Y)){if(h.isNumber(ja))return D(Y,ja,W);if(h.isSqlInterval(ja))return v(Y,ja,W);if(h.isTimeOnly(ja))return M();if(h.isDateOnly(ja))return S(Y,ja,W);if(h.isTimestampOffset(ja))return V(Y,ja,W);if(h.isDateTime(ja))return N(Y,ja,W);if(h.isString(ja))return fa()}else if(h.isString(Y)){if(h.isNumber(ja))return G(Y,
ja,W);if(h.isSqlInterval(ja))return C();if(h.isTimeOnly(ja))return aa();if(h.isDateOnly(ja))return Z();if(h.isTimestampOffset(ja))return ca();if(h.isDateTime(ja))return ea();if(h.isString(ja))return H(Y,ja,W)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,h,c,k,m,d,f){function g(p,t,r){r=x.exec(p);if(null!==r){const [,y,D,E,A,B,F,G]=r;p=f.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(E,10),hour:parseInt(A,10),minute:parseInt(B,10),second:parseInt(F,10),millisecond:G?parseInt(G.replace(".",""),10):0},{zone:d.substituteUnknownTimezone(t)});if(!1===p.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return p}r=w.exec(p);if(null!==r){const [,y,D,E,A,B,F,G,H,L,C]=r;p=k.SqlTimeStampOffset.fromParts(parseInt(y,
10),parseInt(D,10),parseInt(E,10),parseInt(A,10),parseInt(B,10),parseInt(F,10),G?parseInt(G.replace(".",""),10):0,"-"===H,parseInt(L,10),parseInt(C,10));if(!1===p.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return p}r=q.exec(p);if(null!==r){const [,y,D,E,A,B,F,G,H]=r;p=k.SqlTimeStampOffset.fromParts(parseInt(y,10),parseInt(D,10),parseInt(E,10),parseInt(A,10),parseInt(B,10),0,0,"-"===F,parseInt(G,10),parseInt(H,10));if(!1===p.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);
return p}r=v.exec(p);if(null!==r){const [,y,D,E,A,B]=r;p=f.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(E,10),hour:parseInt(A,10),minute:parseInt(B,10),second:0},{zone:d.substituteUnknownTimezone(t)});if(!1===p.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return p}r=u.exec(p);if(null!==r){const [,y,D,E]=r;p=f.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(E,10),hour:0,minute:0,second:0},{zone:d.substituteUnknownTimezone(t)});
if(!1===p.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return p}throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);}const e=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,n=/^(\d{1,2}):(\d{1,2})$/,l=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,q=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,
v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(p,t){if(t instanceof f.Zone)return t===d.UnknownTimeZone.instance?f.DateTime.fromMillis(p.getTime(),{zone:d.UnknownTimeZone.instance}):f.DateTime.fromJSDate(p,{zone:t});switch(t){case "system":case "local":case null:return f.DateTime.fromJSDate(p);default:return"unknown"===t?.toLowerCase()?f.DateTime.fromMillis(p.getTime(),{zone:d.UnknownTimeZone.instance}):f.DateTime.fromJSDate(p,{zone:t})}};a.isDate=function(p){return p instanceof
Date};a.isDateOnly=function(p){return p instanceof h.DateOnly};a.isDateTime=function(p){return p instanceof f.DateTime};a.isNumber=function(p){return"number"===typeof p};a.isSqlInterval=function(p){return p instanceof c.SqlInterval};a.isString=function(p){return"string"===typeof p||p instanceof String};a.isTimeOnly=function(p){return p instanceof m.TimeOnly};a.isTimestampOffset=function(p){return p instanceof k.SqlTimeStampOffset};a.parseDate=function(p,t){const r=u.exec(p);if(null===r)try{return g(p,
t)}catch{throw new b.SqlError(b.SqlErrorCodes.InvalidDate);}const [,y,D,E]=r;p=h.DateOnly.fromParts(parseInt(y,10),parseInt(D,10),parseInt(E,10));if(null===p)throw new b.SqlError(b.SqlErrorCodes.InvalidDate);return p};a.parseTime=function(p){let t=e.exec(p);if(null!==t){const [,r,y,D]=t;p=m.TimeOnly.fromParts(parseInt(r,10),parseInt(y,10),parseInt(D,10),0);if(null!==p)return p;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}t=n.exec(p);if(null!==t){const [,r,y]=t;p=m.TimeOnly.fromParts(parseInt(r,
10),parseInt(y,10),0,0);if(null!==p)return p;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}t=l.exec(p);if(null!==t){const [,r,y,D,E]=t;p=m.TimeOnly.fromParts(parseInt(r,10),parseInt(y,10),parseInt(D,10),parseInt(E,10));if(null!==p)return p}throw new b.SqlError(b.SqlErrorCodes.InvalidTime);};a.parseTimestamp=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(a,b){class h{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(c){if(null!==c.precision||null!==c.secondary)throw new b.SqlError(b.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(c,k){k.includes(".")?(k=k.split("."),c.second=parseFloat(k[0]),c.millis=parseInt(k[1],10)):c.second=parseFloat(k)}static createFromMilliseconds(c){const k=new h;k.second=c/1E3;return k}static createFromValueAndQualifier(c,k,m){let d=null;const f=new h;f.op="-"===
m?"-":"+";if("interval-period"===k.type){h._fixDefaults(k);m=RegExp("^[0-9]{1,}$");if("year"===k.period||"month"===k.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);if("second"===k.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(c))h._parseSecondsComponent(f,c);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);else if(m.test(c))f[k.period]=parseFloat(c);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}else{h._fixDefaults(k.start);h._fixDefaults(k.end);if("year"===
k.start.period||"month"===k.start.period||"year"===k.end.period||"month"===k.end.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);switch(k.start.period){case "day":switch(k.end.period){case "hour":d=RegExp("^[0-9]{1,} [0-9]{1,}$");if(d.test(c))f[k.start.period]=parseFloat(c.split(" ")[0]),f[k.end.period]=parseFloat(c.split(" ")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "minute":d=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(d.test(c))f[k.start.period]=
parseFloat(c.split(" ")[0]),c=c.split(" ")[1].split(":"),f.hour=parseFloat(c[0]),f.minute=parseFloat(c[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":d=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(d.test(c))f[k.start.period]=parseFloat(c.split(" ")[0]),c=c.split(" ")[1].split(":"),f.hour=parseFloat(c[0]),f.minute=parseFloat(c[1]),h._parseSecondsComponent(f,c[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(k.end.period){case "minute":d=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(d.test(c))f.hour=parseFloat(c.split(":")[0]),f.minute=parseFloat(c.split(":")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":d=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(d.test(c))c=c.split(":"),f.hour=parseFloat(c[0]),f.minute=parseFloat(c[1]),h._parseSecondsComponent(f,c[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(k.end.period){case "second":d=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(d.test(c))c=c.split(":"),f.minute=parseFloat(c[0]),h._parseSecondsComponent(f,c[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}}return f}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,h,c,k,m,d,f){function g(q){return"string"===typeof q||q instanceof String}function e(q){return m.isDate(q)||m.isDateOnly(q)||
m.isDateTime(q)||m.isTimeOnly(q)||m.isTimestampOffset(q)?!1:!0}function n(q){return m.isDateOnly(q)||m.isTimeOnly(q)?q.toString():m.isTimestampOffset(q)?q.toSQLValue():m.isDateTime(q)?0===q.millisecond?q.toFormat("yyyy-LL-dd HH:mm:ss"):q.toSQL({includeOffset:!1}):m.isDate(q)?n(f.DateTime.fromJSDate(q)):q.toString()}function l(q){if(m.isDate(q))return c.DateOnly.fromDateJS(q);if(m.isDateTime(q))return c.DateOnly.fromParts(q.year,q.month,q.day);if(m.isDateOnly(q))return q;if(m.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(m.isTimestampOffset(q)&&null===c.DateOnly.fromParts(q.year,q.month,q.day))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(g(q)&&(q=c.DateOnly.fromReader(q),null!==q&&q.isValid))return q;throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function u(q,v,p){if(m.isDate(q))return m.convertToExecutingTimeZone(q,v);if(m.isDateTime(q))return q;if(m.isDateOnly(q))return q.toDateTimeLuxon("unknown");if(m.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimestampOffset(q))return q;
if(g(q))return m.parseTimestamp(q,"unknown",p);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function x(q){if(m.isDate(q))return d.TimeOnly.fromDateJS(q);if(m.isDateTime(q))return d.TimeOnly.fromDateTime(q);if(m.isDateOnly(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimeOnly(q))return q;if(m.isTimestampOffset(q))return d.TimeOnly.fromSqlTimeStampOffset(q);if(g(q))return m.parseTime(q);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}const w={extract:{minParams:2,
maxParams:2,evaluate:([q,v])=>{if(null==v)return null;if(m.isDate(v))switch(q.toUpperCase()){case "SECOND":return v.getSeconds();case "MINUTE":return v.getMinutes();case "HOUR":return v.getHours();case "DAY":return v.getDate();case "MONTH":return v.getMonth()+1;case "YEAR":return v.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(m.isDateTime(v))switch(q.toUpperCase()){case "SECOND":return v.second;case "MINUTE":return v.minute;case "HOUR":return v.hour;case "DAY":return v.day;
case "MONTH":return v.month;case "YEAR":return v.year}else if(m.isDateOnly(v))switch(q.toUpperCase()){case "DAY":return v.day;case "MONTH":return v.month;case "YEAR":return v.year}else if(m.isTimeOnly(v))switch(q.toUpperCase()){case "SECOND":return v.second;case "MINUTE":return v.minute;case "HOUR":return v.hour}else if(m.isTimestampOffset(v))switch(q.toUpperCase()){case "SECOND":return v.second;case "MINUTE":return v.minute;case "HOUR":return v.hour;case "DAY":return v.day;case "MONTH":return v.month;
case "YEAR":return v.year;case "TIMEZONE_HOUR":return v.timezoneOffsetHour;case "TIMEZONE_MINUTE":return v.timezoneOffsetMinutes}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:q=>{if(2===q.length){const [v,p]=q;return null==v||null==p?null:v.toString().substring(p-1)}if(3===q.length){const [v,p,t]=q;return null==v||null==p||null==t?null:0>=t?"":v.toString().substring(p-1,p+t-1)}}},position:{minParams:2,maxParams:2,
evaluate:([q,v])=>null==q||null==v?null:v.indexOf(q)+1},trim:{minParams:2,maxParams:3,evaluate:q=>{var v=3===q.length,p=v?q[1]:" ";v=v?q[2]:q[1];if(null==p||null==v)return null;p=`(${h.escapeRegExpString(p)})`;switch(q[0]){case "BOTH":return v.replaceAll(new RegExp(`^${p}*|${p}*$`,"g"),"");case "LEADING":return v.replaceAll(new RegExp(`^${p}*`,"g"),"");case "TRAILING":return v.replaceAll(new RegExp(`${p}*$`,"g"),"")}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.abs(q[0])},ceiling:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.ceil(q[0])},floor:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.floor(q[0])},log:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.log(q[0])},log10:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.log(q[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.sin(q[0])},cos:{minParams:1,maxParams:1,evaluate:q=>
null==q[0]?null:Math.cos(q[0])},tan:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.tan(q[0])},asin:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.asin(q[0])},acos:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.acos(q[0])},atan:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.atan(q[0])},sign:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:0<q[0]?1:0>q[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:q=>null==q[0]||null==q[1]?null:q[0]**q[1]},mod:{minParams:2,
maxParams:2,evaluate:q=>null==q[0]||null==q[1]?null:q[0]%q[1]},round:{minParams:1,maxParams:2,evaluate:q=>{const v=q[0];q=2===q.length?10**q[1]:1;return null==v?null:Math.round(v*q)/q}},truncate:{minParams:1,maxParams:2,evaluate:q=>null==q[0]?null:1===q.length?parseInt(q[0].toFixed(0),10):parseFloat(q[0].toFixed(q[1]))},char_length:{minParams:1,maxParams:1,evaluate:q=>g(q[0])?q[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:q=>{let v="";for(let p=0;p<q.length;p++){if(null==q[p])return null;
v+=q[p].toString()}return v}},lower:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:q[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:q[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:q=>{for(const v of q)if(null!==v)return v;return null}},cosh:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.cosh(q[0])},sinh:{minParams:1,maxParams:1,evaluate:q=>null==q[0]?null:Math.sinh(q[0])},tanh:{minParams:1,maxParams:1,evaluate:q=>
null==q[0]?null:Math.tanh(q[0])},nullif:{minParams:2,maxParams:2,evaluate:(q,v)=>k.sqlCompare(q[0],q[1],"\x3d")?null:q[0]},cast:{minParams:2,maxParams:2,evaluate:(q,v)=>{const p=q[0];q=q[1];if(null===p)return null;switch(q.type){case "integer":if(!e(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);v=parseInt(p,10);if(isNaN(v))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return v;case "smallint":if(!e(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);v=parseInt(p,10);if(isNaN(v))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(32767<v||-32767>v)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return v;case "float":case "real":if(!e(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);v=parseFloat(p);if(isNaN(v))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return v;case "time":return x(p);case "date":return l(p);case "timestamp":return u(p,v,!0===q.withtimezone);case "varchar":v=n(p);if(v.length>q.size)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return v;default:throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);
}}}};a.evaluateFunction=function(q,v,p){const t=w[q.toLowerCase()];if(null==t)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(v.length<t.minParams||v.length>t.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:q.toUpperCase()});return t.evaluate(v,p)};a.isStandardized=function(q,v){q=w[q.toLowerCase()];return null!=q&&v>=q.minParams&&v<=q.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,h,c,k,m){function d(q){return h.isDateTime(q)||h.isTimestampOffset(q)?!0:!1}function f(q){return h.isDateTime(q)||h.isDateOnly(q)||h.isTimestampOffset(q)||h.isTimeOnly(q)?!0:!1}function g(q){if(h.isDateTime(q))return q.toMillis();if(h.isDateOnly(q))return q.toNumber();if(h.isTimestampOffset(q))return q.toMilliseconds();throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);}function e(q,v,p){switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<
v;case "\x3e\x3d":return q>=v;case "\x3c\x3d":return q<=v}}function n(q,v,p){const t=parseFloat(v);if(!isNaN(t))return e(q,t,p);q=q.toString();switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<v;case "\x3e\x3d":return q>=v;case "\x3c\x3d":return q<=v}}function l(q,v,p){const t=parseFloat(q);if(!isNaN(t))return e(t,v,p);v=v.toString();switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<
v;case "\x3e\x3d":return q>=v;case "\x3c\x3d":return q<=v}}function u(q,v,p){switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<v;case "\x3e\x3d":return q>=v;case "\x3c\x3d":return q<=v}}function x(q,v,p){q instanceof c.SqlTimeStampOffset&&(q=q.toDateTime());v instanceof c.SqlTimeStampOffset&&(v=v.toDateTime());q=w(q);v=w(v);switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<v;case "\x3e\x3d":return q>=
v;case "\x3c\x3d":return q<=v}}function w(q){return 321408E5*q.year+26784E5*q.month+864E5*q.day+36E5*q.hour+6E4*q.minute+1E3*q.second+q.millisecond}a.dateValueInMilliseconds=g;a.isDateOrTimeValue=f;a.isDateTimeComparableValue=d;a.sqlCompare=function(q,v,p,t){if(null==q||null==v)return null;if(h.isNumber(q)){if(h.isNumber(v))return e(q,v,p);if(h.isString(v))return n(q,v,p);if(f(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}else if(h.isString(q)){if(h.isNumber(v))return l(q,v,p);if(h.isString(v))return u(q,v,p);if(h.isDateTime(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isTimeOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isTimestampOffset(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(h.isDateTime(q)){if(d(v)){if(q instanceof m.DateTime&&k.isUnknownTimeZone(q.zone)){if(v instanceof m.DateTime&&
!1===k.isUnknownTimeZone(v.zone)||v instanceof c.SqlTimeStampOffset)return x(q,v,p)}else if(v instanceof m.DateTime&&k.isUnknownTimeZone(v.zone)&&(q instanceof m.DateTime&&!1===k.isUnknownTimeZone(q.zone)||q instanceof c.SqlTimeStampOffset))return x(q,v,p);return e(g(q),g(v),p)}if(h.isString(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))return v=v.toDateTimeLuxon(q.zone),q=q.startOf("day"),e(q.toMillis(),v.toMillis(),p);if(h.isTimeOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(h.isNumber(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(h.isDateOnly(q)){if(h.isTimestampOffset(v))return q=q.toDateTimeLuxon(v.toDateTime().zone),v=v.startOfDay(),e(q.toMillis(),v.toMilliseconds(),p);if(h.isDateTime(v))return q=q.toDateTimeLuxon(v.zone),v=v.startOf("day"),e(q.toMillis(),v.toMillis(),p);if(h.isString(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))return e(q.toNumber(),v.toNumber(),p);if(h.isTimeOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(h.isNumber(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(h.isTimeOnly(q)){if(h.isTimeOnly(v))return e(q.toNumber(),v.toNumber(),p);if(h.isString(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isNumber(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(d(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(h.isTimestampOffset(q)){if(d(v))return v instanceof m.DateTime&&
k.isUnknownTimeZone(v.zone)?x(q,v,p):e(g(q),g(v),p);if(h.isString(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isDateOnly(v))return v=v.toDateTimeLuxon(q.toDateTime().zone),q=q.startOfDay(),e(q.toMilliseconds(),v.toMillis(),p);if(h.isTimeOnly(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(h.isNumber(v))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}switch(p){case "\x3c\x3e":return q!==v;case "\x3d":return q===v;case "\x3e":return q>v;case "\x3c":return q<v;case "\x3e\x3d":return q>=
v;case "\x3c\x3d":return q<=v}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var h={exports:{}};(function(m){(function(d,f){m.exports&&(m.exports=f())})(b.commonjsGlobal,function(){function d(g,e,n,l){g=Error.call(this,g);Object.setPrototypeOf&&Object.setPrototypeOf(g,d.prototype);g.expected=e;g.found=n;g.location=l;g.name="SyntaxError";return g}function f(g,e,n){n=n||" ";if(g.length>
e)return g;e-=g.length;n+=n.repeat(e);return g+n.slice(0,e)}(function(g,e){function n(){this.constructor=g}n.prototype=e.prototype;g.prototype=new n})(d,Error);d.prototype.format=function(g){var e="Error: "+this.message;if(this.location){var n=null,l;for(l=0;l<g.length;l++)if(g[l].source===this.location.source){n=g[l].text.split(/\r\n|\n|\r/g);break}g=this.location.start;l=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(g):g;var u=this.location.source+
":"+l.line+":"+l.column;if(n){var x=this.location.end,w=f("",l.line.toString().length," ");n=n[g.line-1];x=(g.line===x.line?x.column:n.length+1)-g.column||1;e+="\n --\x3e "+u+"\n"+w+" |\n"+l.line+" | "+n+"\n"+w+" | "+f("",g.column-1," ")+f("",x,"^")}else e+="\n at "+u}return e};d.buildMessage=function(g,e){function n(q){return q.charCodeAt(0).toString(16).toUpperCase()}function l(q){return q.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+n(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+n(v)})}function u(q){return q.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+n(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+n(v)})}function x(q){return w[q.type](q)}var w={literal:function(q){return'"'+
l(q.text)+'"'},class:function(q){var v=q.parts.map(function(p){return Array.isArray(p)?u(p[0])+"-"+u(p[1]):u(p)});return"["+(q.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(q){return q.description}};return"Expected "+function(q){q=q.map(x);var v,p;q.sort();if(0<q.length){for(p=v=1;v<q.length;v++)q[v-1]!==q[v]&&(q[p]=q[v],p++);q.length=p}switch(q.length){case 1:return q[0];case 2:return q[0]+" or "+q[1];default:return q.slice(0,
-1).join(", ")+", or "+q[q.length-1]}}(g)+" but "+(e?'"'+l(e)+'"':"end of input")+" found."};return{SyntaxError:d,parse:function(g,e){function n(Aa,Ea){Ea=void 0!==Ea?Ea:w(fb,ma);throw new d(Aa,null,null,Ea);}function l(Aa,Ea){return{type:"literal",text:Aa,ignoreCase:Ea}}function u(Aa,Ea,Ka){return{type:"class",parts:Aa,inverted:Ea,ignoreCase:Ka}}function x(Aa){var Ea=xe[Aa],Ka;if(!Ea){for(Ka=Aa-1;!xe[Ka];)Ka--;Ea=xe[Ka];for(Ea={line:Ea.line,column:Ea.column};Ka<Aa;)10===g.charCodeAt(Ka)?(Ea.line++,
Ea.column=1):Ea.column++,Ka++;xe[Aa]=Ea}return Ea}function w(Aa,Ea,Ka){var Ya=x(Aa),kb=x(Ea);Aa={source:mb,start:{offset:Aa,line:Ya.line,column:Ya.column},end:{offset:Ea,line:kb.line,column:kb.column}};Ka&&mb&&"function"===typeof mb.offset&&(Aa.start=mb.offset(Aa.start),Aa.end=mb.offset(Aa.end));return Aa}function q(Aa){ma<Dc||(ma>Dc&&(Dc=ma,bf=[]),bf.push(Aa))}function v(){var Aa=ma;Ra();var Ea=t();Ea!==ka?(Ra(),fb=Aa,Aa=Ea):(ma=Aa,Aa=ka);return Aa}function p(){var Aa=ma;var Ea=t();if(Ea!==ka){var Ka=
[];var Ya=ma;var kb=Ra();var ub=Oa();if(ub!==ka){var Eb=Ra();var Gb=t();Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)}else ma=Ya,Ya=ka;for(;Ya!==ka;)Ka.push(Ya),Ya=ma,kb=Ra(),ub=Oa(),ub!==ka?(Eb=Ra(),Gb=t(),Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)):(ma=Ya,Ya=ka);fb=Aa;Aa={type:"expression-list"};Ea=[Ea];for(Ya=0;Ya<Ka.length;Ya++)Ea.push(Ka[Ya][3]);Aa.value=Ea}else ma=Aa,Aa=ka;return Aa}function t(){var Aa=ma;var Ea=r();if(Ea!==ka){var Ka=[];var Ya=ma;var kb=Ra();var ub=ja();if(ub!==ka){var Eb=Ra();
var Gb=r();Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)}else ma=Ya,Ya=ka;for(;Ya!==ka;)Ka.push(Ya),Ya=ma,kb=Ra(),ub=ja(),ub!==ka?(Eb=Ra(),Gb=r(),Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)):(ma=Ya,Ya=ka);fb=Aa;Aa=db(Ea,Ka)}else ma=Aa,Aa=ka;return Aa}function r(){var Aa=ma;var Ea=y();if(Ea!==ka){var Ka=[];var Ya=ma;var kb=Ra();var ub=Y();if(ub!==ka){var Eb=Ra();var Gb=y();Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)}else ma=Ya,Ya=ka;for(;Ya!==ka;)Ka.push(Ya),Ya=ma,kb=Ra(),ub=Y(),ub!==ka?(Eb=Ra(),Gb=y(),Gb!==
ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)):(ma=Ya,Ya=ka);fb=Aa;Aa=db(Ea,Ka)}else ma=Aa,Aa=ka;return Aa}function y(){var Aa=ma;var Ea=W();if(Ea===ka){Ea=ma;if(33===g.charCodeAt(ma)){var Ka=xa;ma++}else Ka=ka,0===Za&&q(Rc);if(Ka!==ka){var Ya=ma;Za++;if(61===g.charCodeAt(ma)){var kb=Ha;ma++}else kb=ka,0===Za&&q(Sc);Za--;kb===ka?Ya=void 0:(ma=Ya,Ya=ka);Ya!==ka?Ea=Ka=[Ka,Ya]:(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka}Ea!==ka?(Ka=Ra(),Ya=y(),Ya!==ka?(fb=Aa,Aa={type:"unary-expression",operator:"NOT",expr:Ya}):(ma=Aa,Aa=
ka)):(ma=Aa,Aa=ka);if(Aa===ka){Ea=ma;Aa=B();if(Aa!==ka){Ra();Ka=ma;Ya=[];kb=ma;var ub=Ra();var Eb=D();if(Eb!==ka){var Gb=Ra();var ad=B();ad!==ka?kb=ub=[ub,Eb,Gb,ad]:(ma=kb,kb=ka)}else ma=kb,kb=ka;if(kb!==ka)for(;kb!==ka;)Ya.push(kb),kb=ma,ub=Ra(),Eb=D(),Eb!==ka?(Gb=Ra(),ad=B(),ad!==ka?kb=ub=[ub,Eb,Gb,ad]:(ma=kb,kb=ka)):(ma=kb,kb=ka);else Ya=ka;Ya!==ka&&(fb=Ka,Ya={type:"arithmetic",tail:Ya});Ka=Ya;Ka===ka&&(Ka=ma,Ya=A(),Ya!==ka?(Ra(),kb=Ua(),kb!==ka?(Ra(),kb=p(),kb!==ka?(Ra(),ub=Va(),ub!==ka?(fb=Ka,
Ka={op:Ya,right:kb}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,Ya=A(),Ya!==ka?(Ra(),kb=Ua(),kb!==ka?(Ra(),kb=Va(),kb!==ka?(fb=Ka,Ka={op:Ya,right:{type:"expression-list",value:[]}}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,Ya=A(),Ya!==ka?(Ra(),kb=S(),kb!==ka?(fb=Ka,Ka={op:Ya,right:kb}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka))),Ka===ka&&(Ka=ma,ub=W(),ub!==ka?(Ra(),Ya=oa(),Ya!==ka?(Ra(),kb=B(),kb!==ka?(Ra(),Eb=Y(),Eb!==ka?(Ra(),ub=B(),ub!==ka?(fb=Ka,Ka={op:"NOT"+
Ya,right:{type:"expression-list",value:[kb,ub]}}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,ub=oa(),ub!==ka?(Ra(),Ya=B(),Ya!==ka?(Ra(),kb=Y(),kb!==ka?(Ra(),Eb=B(),Eb!==ka?(fb=Ka,Ka={op:ub,right:{type:"expression-list",value:[Ya,Eb]}}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)),Ka===ka&&(Ka=ma,Ya=ea(),Ya!==ka?(Ra(),kb=W(),kb!==ka?(Ra(),kb=B(),kb!==ka?(fb=Ka,Ka={op:Ya+"NOT",right:kb}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&
(Ka=ma,Ya=ea(),Ya!==ka?(Ra(),kb=B(),kb!==ka?(fb=Ka,Ka={op:Ya,right:kb}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)),Ka===ka&&(Ka=ma,Ya=E(),Ya!==ka?(Ra(),kb=O(),kb!==ka?(Ra(),ub=ma,g.substr(ma,6).toLowerCase()===Tb?(Eb=g.substr(ma,6),ma+=6):(Eb=ka,0===Za&&q(Ze)),Eb!==ka?(Eb=ma,Za++,Gb=J(),Za--,Gb===ka?Eb=void 0:(ma=Eb,Eb=ka),Eb!==ka?(fb=ub,ub="ESCAPE"):(ma=ub,ub=ka)):(ma=ub,ub=ka),ub!==ka?(Ra(),ub=U(),ub!==ka?(fb=Ka,Ka={op:Ya,right:kb,escape:ub.value}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),
Ka===ka&&(Ka=ma,Ya=E(),Ya!==ka?(Ra(),kb=O(),kb!==ka?(fb=Ka,Ka={op:Ya,right:kb,escape:""}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka))))));Ka===ka&&(Ka=null);fb=Ea;Ea=Ka;""==Ea||void 0==Ea||null==Ea?Ea=Aa:(Ka=null,Ea=Ka="arithmetic"==Ea.type?db(Aa,Ea.tail):gb(Ea.op,Aa,Ea.right,Ea.escape))}else ma=Ea,Ea=ka;Aa=Ea}return Aa}function D(){if(g.substr(ma,2)===na){var Aa=na;ma+=2}else Aa=ka,0===Za&&q(zd);Aa===ka&&(62===g.charCodeAt(ma)?(Aa=za,ma++):(Aa=ka,0===Za&&q(Zd)),Aa===ka&&(g.substr(ma,2)===Da?(Aa=Da,ma+=2):(Aa=
ka,0===Za&&q($d)),Aa===ka&&(g.substr(ma,2)===Ma?(Aa=Ma,ma+=2):(Aa=ka,0===Za&&q(ae)),Aa===ka&&(60===g.charCodeAt(ma)?(Aa=Xa,ma++):(Aa=ka,0===Za&&q(Ad)),Aa===ka&&(61===g.charCodeAt(ma)?(Aa=Ha,ma++):(Aa=ka,0===Za&&q(Sc)),Aa===ka&&(g.substr(ma,2)===ab?(Aa=ab,ma+=2):(Aa=ka,0===Za&&q(Bd))))))));return Aa}function E(){var Aa;var Ea=Aa=ma;var Ka=W();if(Ka!==ka){var Ya=Ra();var kb=ca();kb!==ka?Ea=Ka=[Ka,Ya,kb]:(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;Ea!==ka&&(fb=Aa,Ea=Ea[0]+" "+Ea[2]);Aa=Ea;Aa===ka&&(Aa=ca());return Aa}
function A(){var Aa;var Ea=Aa=ma;var Ka=W();if(Ka!==ka){var Ya=Ra();var kb=Z();kb!==ka?Ea=Ka=[Ka,Ya,kb]:(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;Ea!==ka&&(fb=Aa,Ea=Ea[0]+" "+Ea[2]);Aa=Ea;Aa===ka&&(Aa=Z());return Aa}function B(){var Aa=ma;var Ea=G();if(Ea!==ka){var Ka=[];var Ya=ma;var kb=Ra();var ub=F();if(ub!==ka){var Eb=Ra();var Gb=G();Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)}else ma=Ya,Ya=ka;for(;Ya!==ka;)Ka.push(Ya),Ya=ma,kb=Ra(),ub=F(),ub!==ka?(Eb=Ra(),Gb=G(),Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)):
(ma=Ya,Ya=ka);fb=Aa;Aa=db(Ea,Ka)}else ma=Aa,Aa=ka;return Aa}function F(){if(43===g.charCodeAt(ma)){var Aa=Ja;ma++}else Aa=ka,0===Za&&q(Yc);Aa===ka&&(45===g.charCodeAt(ma)?(Aa=Qa,ma++):(Aa=ka,0===Za&&q(vd)),Aa===ka&&(g.substr(ma,2)===Sa?(Aa=Sa,ma+=2):(Aa=ka,0===Za&&q(Cd))));return Aa}function G(){var Aa=ma;var Ea=L();if(Ea!==ka){var Ka=[];var Ya=ma;var kb=Ra();var ub=H();if(ub!==ka){var Eb=Ra();var Gb=L();Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)}else ma=Ya,Ya=ka;for(;Ya!==ka;)Ka.push(Ya),Ya=ma,kb=
Ra(),ub=H(),ub!==ka?(Eb=Ra(),Gb=L(),Gb!==ka?Ya=kb=[kb,ub,Eb,Gb]:(ma=Ya,Ya=ka)):(ma=Ya,Ya=ka);fb=Aa;Aa=db(Ea,Ka)}else ma=Aa,Aa=ka;return Aa}function H(){if(42===g.charCodeAt(ma)){var Aa=cb;ma++}else Aa=ka,0===Za&&q(be);Aa===ka&&(47===g.charCodeAt(ma)?(Aa=eb,ma++):(Aa=ka,0===Za&&q(ce)));return Aa}function L(){var Aa=U();if(Aa===ka){var Ea=ma;var Ka=ma;var Ya=X();if(Ya!==ka){var kb=da();if(kb!==ka){var ub=ha();ub!==ka?(fb=Ka,Ka=parseFloat(Ya+kb+ub)):(ma=Ka,Ka=ka)}else ma=Ka,Ka=ka}else ma=Ka,Ka=ka;Ka===
ka&&(Ka=ma,Ya=X(),Ya!==ka?(kb=da(),kb!==ka?(fb=Ka,Ka=parseFloat(Ya+kb)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,Ya=X(),Ya!==ka?(kb=ha(),kb!==ka?(fb=Ka,Ka=parseFloat(Ya+kb)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,Ya=X(),Ya!==ka&&(fb=Ka,Ya=parseFloat(Ya)),Ka=Ya)));var Eb=Ka;if(Eb!==ka){var Gb=ma;Za++;var ad=z();Za--;ad===ka?Gb=void 0:(ma=Gb,Gb=ka);Gb!==ka?(fb=Ea,Ea={type:"number",value:Eb}):(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;Aa=Ea;if(Aa===ka){var bd=ma;var wd=ma;if(g.substr(ma,4).toLowerCase()===
Rb){var ye=g.substr(ma,4);ma+=4}else ye=ka,0===Za&&q(Ed);if(ye!==ka){var Od=ma;Za++;var Uf=J();Za--;Uf===ka?Od=void 0:(ma=Od,Od=ka);Od!==ka?wd=ye=[ye,Od]:(ma=wd,wd=ka)}else ma=wd,wd=ka;var cd=wd;cd!==ka&&(fb=bd,cd={type:"boolean",value:!0});bd=cd;if(bd===ka){bd=ma;var xd=ma;if(g.substr(ma,5).toLowerCase()===ac){var ze=g.substr(ma,5);ma+=5}else ze=ka,0===Za&&q(Fd);if(ze!==ka){var Pd=ma;Za++;var Vf=J();Za--;Vf===ka?Pd=void 0:(ma=Pd,Pd=ka);Pd!==ka?xd=ze=[ze,Pd]:(ma=xd,xd=ka)}else ma=xd,xd=ka;cd=xd;cd!==
ka&&(fb=bd,cd={type:"boolean",value:!1});bd=cd}Aa=bd;if(Aa===ka){var Wf=ma;var yd=ma;if(g.substr(ma,4).toLowerCase()===Jb){var Ae=g.substr(ma,4);ma+=4}else Ae=ka,0===Za&&q(Dd);if(Ae!==ka){var Qd=ma;Za++;var Xf=J();Za--;Xf===ka?Qd=void 0:(ma=Qd,Qd=ka);Qd!==ka?yd=Ae=[Ae,Qd]:(ma=yd,yd=ka)}else ma=yd,yd=ka;var cf=yd;cf!==ka&&(fb=Wf,cf={type:"null",value:null});Aa=cf;if(Aa===ka){var dd=ma;if(Ca()!==ka){Ra();var Be=O();Be!==ka?(fb=dd,"string"===Be.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Be.value)&&
n("Date literal is invalid"),dd={type:"date",value:Be.value}):(ma=dd,dd=ka)}else ma=dd,dd=ka;Aa=dd;if(Aa===ka){var ed=ma;if(ya()!==ka){Ra();var Ce=O();Ce!==ka?(fb=ed,"string"===Ce.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Ce.value)&&
n("Timestamp literal is invalid"),ed={type:"timestamp",value:Ce.value}):(ma=ed,ed=ka)}else ma=ed,ed=ka;Aa=ed;if(Aa===ka){var ic=ma;var df=wa();if(df!==ka){Ra();if(45===g.charCodeAt(ma)){var Jc=Qa;ma++}else Jc=ka,0===Za&&q(vd);Jc===ka&&(43===g.charCodeAt(ma)?(Jc=Ja,ma++):(Jc=ka,0===Za&&q(Yc)));if(Jc!==ka){Ra();var Rd=O();if(Rd!==ka){Ra();var rf=V();rf!==ka?(fb=ic,ic={type:"interval",value:Rd,qualifier:rf,op:Jc}):(ma=ic,ic=ka)}else ma=ic,ic=ka}else ma=ic,ic=ka}else ma=ic,ic=ka;ic===ka&&(ic=ma,df=wa(),
df!==ka?(Ra(),Jc=O(),Jc!==ka?(Ra(),Rd=V(),Rd!==ka?(fb=ic,ic={type:"interval",value:Jc,qualifier:Rd,op:""}):(ma=ic,ic=ka)):(ma=ic,ic=ka)):(ma=ic,ic=ka));Aa=ic;if(Aa===ka){var fd=ma;if(pa()!==ka){Ra();var De=O();De!==ka?(fb=fd,"string"===De.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(De.value)&&n("Time literal is invalid"),fd={type:"time",value:De.value}):(ma=fd,fd=ka)}else ma=fd,fd=ka;Aa=fd}}}}}}}var Xb=Aa;if(Xb===ka){var oc=ma;var gd=
ma;if(g.substr(ma,7).toLowerCase()===$a){var sf=g.substr(ma,7);ma+=7}else sf=ka,0===Za&&q(Hd);if(sf!==ka){var Ee=ma;Za++;var Yf=J();Za--;Yf===ka?Ee=void 0:(ma=Ee,Ee=ka);Ee!==ka?(fb=gd,gd="EXTRACT"):(ma=gd,gd=ka)}else ma=gd,gd=ka;if(gd!==ka){Ra();var Zf=Ua();if(Zf!==ka){Ra();var pc=Ba();if(pc===ka&&(pc=la(),pc===ka&&(pc=qa(),pc===ka&&(pc=ua(),pc===ka&&(pc=va(),pc===ka&&(pc=Ga(),pc===ka)))))){var hd=ma;if(g.substr(ma,13).toLowerCase()===Mb){var tf=g.substr(ma,13);ma+=13}else tf=ka,0===Za&&q($f);if(tf!==
ka){var Fe=ma;Za++;var ag=J();Za--;ag===ka?Fe=void 0:(ma=Fe,Fe=ka);Fe!==ka?(fb=hd,hd="TIMEZONE_HOUR"):(ma=hd,hd=ka)}else ma=hd,hd=ka;pc=hd;if(pc===ka){var id=ma;if(g.substr(ma,15).toLowerCase()===Vb){var uf=g.substr(ma,15);ma+=15}else uf=ka,0===Za&&q(bg);if(uf!==ka){var Ge=ma;Za++;var cg=J();Za--;cg===ka?Ge=void 0:(ma=Ge,Ge=ka);Ge!==ka?(fb=id,id="TIMEZONE_MINUTE"):(ma=id,id=ka)}else ma=id,id=ka;pc=id}}var vf=pc;if(vf!==ka){Ra();var dg=ra();if(dg!==ka){Ra();var wf=t();if(wf!==ka){Ra();var eg=Va();
eg!==ka?(fb=oc,oc={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:vf},wf]}}):(ma=oc,oc=ka)}else ma=oc,oc=ka}else ma=oc,oc=ka}else ma=oc,oc=ka}else ma=oc,oc=ka}else ma=oc,oc=ka;Xb=oc;if(Xb===ka){var qc=ma;var jd=ma;if(g.substr(ma,9).toLowerCase()===Ta){var xf=g.substr(ma,9);ma+=9}else xf=ka,0===Za&&q(oe);if(xf!==ka){var He=ma;Za++;var fg=J();Za--;fg===ka?He=void 0:(ma=He,He=ka);He!==ka?(fb=jd,jd="SUBSTRING"):(ma=jd,jd=ka)}else ma=jd,jd=ka;if(jd!==ka){Ra();var gg=
Ua();if(gg!==ka){Ra();var ef=t();if(ef!==ka){Ra();var hg=ra();if(hg!==ka){Ra();var ff=t();if(ff!==ka){Ra();var Kc=ma;var kd=ma;if(g.substr(ma,3).toLowerCase()===Pa){var yf=g.substr(ma,3);ma+=3}else yf=ka,0===Za&&q(ne);if(yf!==ka){var Ie=ma;Za++;var ig=J();Za--;ig===ka?Ie=void 0:(ma=Ie,Ie=ka);Ie!==ka?(fb=kd,kd="FOR"):(ma=kd,kd=ka)}else ma=kd,kd=ka;var Sd=kd;if(Sd!==ka){var jg=Ra();var zf=t();if(zf!==ka){var kg=Ra();Kc=Sd=[Sd,jg,zf,kg]}else ma=Kc,Kc=ka}else ma=Kc,Kc=ka;Kc===ka&&(Kc=null);Sd=Va();Sd!==
ka?(fb=qc,qc={type:"function",name:"substring",args:{type:"expression-list",value:Kc?[ef,ff,Kc[2]]:[ef,ff]}}):(ma=qc,qc=ka)}else ma=qc,qc=ka}else ma=qc,qc=ka}else ma=qc,qc=ka}else ma=qc,qc=ka}else ma=qc,qc=ka;Xb=qc;if(Xb===ka){var bc=ma;var gf=ta();if(gf!==ka){Ra();var hf=Ua();if(hf!==ka){Ra();var Lc=N();Lc===ka&&(Lc=null);Ra();var Td=t();if(Td!==ka){Ra();var jf=ra();if(jf!==ka){Ra();var Af=t();if(Af!==ka){Ra();var lg=Va();lg!==ka?(fb=bc,bc={type:"function",name:"trim",args:{type:"expression-list",
value:[{type:"string",value:null==Lc?"BOTH":Lc},Td,Af]}}):(ma=bc,bc=ka)}else ma=bc,bc=ka}else ma=bc,bc=ka}else ma=bc,bc=ka}else ma=bc,bc=ka}else ma=bc,bc=ka;bc===ka&&(bc=ma,gf=ta(),gf!==ka?(Ra(),hf=Ua(),hf!==ka?(Ra(),Lc=N(),Lc===ka&&(Lc=null),Ra(),Td=t(),Td!==ka?(Ra(),jf=Va(),jf!==ka?(fb=bc,bc={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Lc?"BOTH":Lc},Td]}}):(ma=bc,bc=ka)):(ma=bc,bc=ka)):(ma=bc,bc=ka)):(ma=bc,bc=ka));Xb=bc;if(Xb===ka){var rc=ma;var ld=
ma;if(g.substr(ma,8).toLowerCase()===ib){var Bf=g.substr(ma,8);ma+=8}else Bf=ka,0===Za&&q(Jd);if(Bf!==ka){var Je=ma;Za++;var mg=J();Za--;mg===ka?Je=void 0:(ma=Je,Je=ka);Je!==ka?(fb=ld,ld="POSITION"):(ma=ld,ld=ka)}else ma=ld,ld=ka;if(ld!==ka){Ra();var ng=Ua();if(ng!==ka){Ra();var Cf=t();if(Cf!==ka){Ra();var og=Z();if(og!==ka){Ra();var Df=t();if(Df!==ka){Ra();var pg=Va();pg!==ka?(fb=rc,rc={type:"function",name:"position",args:{type:"expression-list",value:[Cf,Df]}}):(ma=rc,rc=ka)}else ma=rc,rc=ka}else ma=
rc,rc=ka}else ma=rc,rc=ka}else ma=rc,rc=ka}else ma=rc,rc=ka;Xb=rc;if(Xb===ka){var sc=ma;var md=ma;if(g.substr(ma,4).toLowerCase()===Sb){var Ef=g.substr(ma,4);ma+=4}else Ef=ka,0===Za&&q(ue);if(Ef!==ka){var Ke=ma;Za++;var qg=J();Za--;qg===ka?Ke=void 0:(ma=Ke,Ke=ka);Ke!==ka?(fb=md,md="CAST"):(ma=md,md=ka)}else ma=md,md=ka;if(md!==ka){Ra();var rg=Ua();if(rg!==ka){Ra();var Ff=t();if(Ff!==ka){Ra();var nd=ma;if(g.substr(ma,2).toLowerCase()===nb){var Gf=g.substr(ma,2);ma+=2}else Gf=ka,0===Za&&q(ve);if(Gf!==
ka){var Le=ma;Za++;var sg=J();Za--;sg===ka?Le=void 0:(ma=Le,Le=ka);Le!==ka?(fb=nd,nd="AS"):(ma=nd,nd=ka)}else ma=nd,nd=ka;var tg=nd;if(tg!==ka){Ra();var Ib=ma;var od=ma;if(g.substr(ma,7).toLowerCase()===xb){var Hf=g.substr(ma,7);ma+=7}else Hf=ka,0===Za&&q(we);if(Hf!==ka){var Me=ma;Za++;var ug=J();Za--;ug===ka?Me=void 0:(ma=Me,Me=ka);Me!==ka?(fb=od,od="INTEGER"):(ma=od,od=ka)}else ma=od,od=ka;var Yb=od;Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"integer"}});Ib=Yb;if(Ib===ka){Ib=ma;var pd=ma;
if(g.substr(ma,8).toLowerCase()===Ab){var If=g.substr(ma,8);ma+=8}else If=ka,0===Za&&q(Nd);if(If!==ka){var Ne=ma;Za++;var vg=J();Za--;vg===ka?Ne=void 0:(ma=Ne,Ne=ka);Ne!==ka?(fb=pd,pd="SMALLINT"):(ma=pd,pd=ka)}else ma=pd,pd=ka;Yb=pd;Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"smallint"}});Ib=Yb;if(Ib===ka){Ib=ma;var qd=ma;if(g.substr(ma,5).toLowerCase()===Nb){var Jf=g.substr(ma,5);ma+=5}else Jf=ka,0===Za&&q(Kd);if(Jf!==ka){var Oe=ma;Za++;var wg=J();Za--;wg===ka?Oe=void 0:(ma=Oe,Oe=ka);Oe!==
ka?(fb=qd,qd="FLOAT"):(ma=qd,qd=ka)}else ma=qd,qd=ka;Yb=qd;Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"float"}});Ib=Yb;if(Ib===ka){Ib=ma;var rd=ma;if(g.substr(ma,4).toLowerCase()===cc){var Kf=g.substr(ma,4);ma+=4}else Kf=ka,0===Za&&q($e);if(Kf!==ka){var Pe=ma;Za++;var xg=J();Za--;xg===ka?Pe=void 0:(ma=Pe,Pe=ka);Pe!==ka?(fb=rd,rd="REAL"):(ma=rd,rd=ka)}else ma=rd,rd=ka;Yb=rd;Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"real"}});Ib=Yb;if(Ib===ka&&(Ib=ma,Yb=Ca(),Yb!==ka&&(fb=Ib,Yb={type:"data-type",
value:{type:"date"}}),Ib=Yb,Ib===ka&&(Ib=ma,Yb=ya(),Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"timestamp"}}),Ib=Yb,Ib===ka&&(Ib=ma,Yb=pa(),Yb!==ka&&(fb=Ib,Yb={type:"data-type",value:{type:"time"}}),Ib=Yb,Ib===ka)))){Ib=ma;var sd=ma;if(g.substr(ma,7).toLowerCase()===hc){var Lf=g.substr(ma,7);ma+=7}else Lf=ka,0===Za&&q(af);if(Lf!==ka){var Qe=ma;Za++;var yg=J();Za--;yg===ka?Qe=void 0:(ma=Qe,Qe=ka);Qe!==ka?(fb=sd,sd="VARCHAR"):(ma=sd,sd=ka)}else ma=sd,sd=ka;Yb=sd;if(Yb!==ka){Ra();var zg=Ua();if(zg!==
ka){Ra();var Mf=fa();if(Mf!==ka){Ra();var Ag=Va();Ag!==ka?(fb=Ib,Ib={type:"data-type",value:{type:"varchar",size:parseInt(Mf)}}):(ma=Ib,Ib=ka)}else ma=Ib,Ib=ka}else ma=Ib,Ib=ka}else ma=Ib,Ib=ka}}}}var Nf=Ib;if(Nf!==ka){Ra();var Bg=Va();Bg!==ka?(fb=sc,sc={type:"function",name:"cast",args:{type:"expression-list",value:[Ff,Nf]}}):(ma=sc,sc=ka)}else ma=sc,sc=ka}else ma=sc,sc=ka}else ma=sc,sc=ka}else ma=sc,sc=ka}else ma=sc,sc=ka;Xb=sc;if(Xb===ka){var Mc=ma;var wc=ma;var Ud=C();Ud!==ka&&(fb=wc);wc=Ud;if(wc===
ka)if(wc=ma,96===g.charCodeAt(ma)?(Ud=tc,ma++):(Ud=ka,0===Za&&q(Of)),Ud!==ka){var Re=[];if(Cc.test(g.charAt(ma))){var Nc=g.charAt(ma);ma++}else Nc=ka,0===Za&&q(Pf);if(Nc!==ka)for(;Nc!==ka;)Re.push(Nc),Cc.test(g.charAt(ma))?(Nc=g.charAt(ma),ma++):(Nc=ka,0===Za&&q(Pf));else Re=ka;Re!==ka?(96===g.charCodeAt(ma)?(Nc=tc,ma++):(Nc=ka,0===Za&&q(Of)),Nc!==ka?(fb=wc,wc=Re.join("")):(ma=wc,wc=ka)):(ma=wc,wc=ka)}else ma=wc,wc=ka;var Qf=wc;if(Qf!==ka){Ra();var Cg=Ua();if(Cg!==ka){Ra();var Se=p();Se===ka&&(Se=
null);Ra();var Dg=Va();Dg!==ka?(fb=Mc,Mc={type:"function",name:Qf,args:Se?Se:{type:"expression-list",value:[]}}):(ma=Mc,Mc=ka)}else ma=Mc,Mc=ka}else ma=Mc,Mc=ka;Xb=Mc;if(Xb===ka){var Ec;var jc=ma;var kf=La();if(kf!==ka){Ra();var Vd=t();if(Vd!==ka){Ra();var Wd=[];for(Ec=R();Ec!==ka;)Wd.push(Ec),Ec=R();Ec=Ra();var Te=Na();Te!==ka?(fb=jc,jc={type:"case-expression",format:"simple",operand:Vd,clauses:Wd,else:null}):(ma=jc,jc=ka)}else ma=jc,jc=ka}else ma=jc,jc=ka;if(jc===ka)if(jc=ma,kf=La(),kf!==ka)if(Ra(),
Vd=t(),Vd!==ka){Ra();Wd=[];for(Ec=R();Ec!==ka;)Wd.push(Ec),Ec=R();Ec=Ra();Te=ba();if(Te!==ka){Ra();var Eg=Na();Eg!==ka?(fb=jc,jc={type:"case-expression",format:"simple",operand:Vd,clauses:Wd,else:Te.value}):(ma=jc,jc=ka)}else ma=jc,jc=ka}else ma=jc,jc=ka;else ma=jc,jc=ka;var lf=jc;if(lf===ka){var Fc;var mc=ma;var mf=La();if(mf!==ka){Ra();var Xd=[];for(Fc=P();Fc!==ka;)Xd.push(Fc),Fc=P();Fc=Ra();var Ue=Na();Ue!==ka?(fb=mc,mc={type:"case-expression",format:"searched",clauses:Xd,else:null}):(ma=mc,mc=
ka)}else ma=mc,mc=ka;if(mc===ka)if(mc=ma,mf=La(),mf!==ka){Ra();Xd=[];for(Fc=P();Fc!==ka;)Xd.push(Fc),Fc=P();Fc=Ra();Ue=ba();if(Ue!==ka){Ra();var Fg=Na();Fg!==ka?(fb=mc,mc={type:"case-expression",format:"searched",clauses:Xd,else:Ue.value}):(ma=mc,mc=ka)}else ma=mc,mc=ka}else ma=mc,mc=ka;lf=mc}Xb=lf;if(Xb===ka){var td=ma;var Gg=ma;var Ve;var Yd=ma;var Rf=z();if(Rf!==ka){var Sf=[];for(Ve=K();Ve!==ka;)Sf.push(Ve),Ve=K();fb=Yd;Yd=Rf+Sf.join("")}else ma=Yd,Yd=ka;var Tf=Yd;Tf!==ka&&(fb=Gg);var Oc=Tf;if(Oc!==
ka){fb=td;var nf=Oc;Oc=/^CURRENT_DATE$/i.test(nf)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(nf)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:nf}}td=Oc;if(td===ka){td=ma;var ud=ma;if(M()!==ka){var We;var Hg=ma;var of=[];for(We=I();We!==ka;)of.push(We),We=I();fb=Hg;var Ig=of=of.join("");var Jg=M();Jg!==ka?(fb=ud,ud=Ig):(ma=ud,ud=ka)}else ma=ud,ud=ka;Oc=ud;Oc!==ka&&(fb=td,Oc={type:"column-reference",table:"",column:Oc,delimited:!0});td=Oc}Xb=td;
if(Xb===ka&&(Xb=S(),Xb===ka)){Xb=ma;var Kg=Ua();if(Kg!==ka){Ra();var pf=t();if(pf!==ka){Ra();var Lg=Va();Lg!==ka?(fb=Xb,pf.paren=!0,Xb=pf):(ma=Xb,Xb=ka)}else ma=Xb,Xb=ka}else ma=Xb,Xb=ka}}}}}}}}}return Xb}function C(){var Aa;var Ea=ma;var Ka=z();if(Ka!==ka){var Ya=[];for(Aa=J();Aa!==ka;)Ya.push(Aa),Aa=J();fb=Ea;Ea=Ka+Ya.join("")}else ma=Ea,Ea=ka;return Ea}function z(){if(yc.test(g.charAt(ma))){var Aa=g.charAt(ma);ma++}else Aa=ka,0===Za&&q(de);return Aa}function J(){if(Ac.test(g.charAt(ma))){var Aa=
g.charAt(ma);ma++}else Aa=ka,0===Za&&q(ee);return Aa}function K(){if(uc.test(g.charAt(ma))){var Aa=g.charAt(ma);ma++}else Aa=ka,0===Za&&q(fe);return Aa}function I(){if(uc.test(g.charAt(ma))){var Aa=g.charAt(ma);ma++}else Aa=ka,0===Za&&q(fe);if(Aa===ka)if(Aa=ma,M()!==ka){var Ea=M();Ea!==ka?(fb=Aa,Aa='"'):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function M(){if(Pc.test(g.charAt(ma))){var Aa=g.charAt(ma);ma++}else Aa=ka,0===Za&&q(Xe);return Aa}function S(){var Aa;var Ea=Aa=ma;if(64===g.charCodeAt(ma)){var Ka=
lb;ma++}else Ka=ka,0===Za&&q(Ye);if(Ka!==ka){var Ya=C();Ya!==ka?Ea=Ka=[Ka,Ya]:(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;Ea!==ka&&(fb=Aa,Ea={type:"parameter",value:Ea[1]});return Ea}function N(){var Aa=ma;if(g.substr(ma,7).toLowerCase()===wb){var Ea=g.substr(ma,7);ma+=7}else Ea=ka,0===Za&&q(se);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="LEADING"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;Aa===ka&&(Aa=ma,g.substr(ma,8).toLowerCase()===Bb?(Ea=g.substr(ma,8),ma+=8):(Ea=ka,0===
Za&&q(te)),Ea!==ka?(Ea=ma,Za++,Ka=J(),Za--,Ka===ka?Ea=void 0:(ma=Ea,Ea=ka),Ea!==ka?(fb=Aa,Aa="TRAILING"):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka),Aa===ka&&(Aa=ma,g.substr(ma,4).toLowerCase()===zb?(Ea=g.substr(ma,4),ma+=4):(Ea=ka,0===Za&&q(Md)),Ea!==ka?(Ea=ma,Za++,Ka=J(),Za--,Ka===ka?Ea=void 0:(ma=Ea,Ea=ka),Ea!==ka?(fb=Aa,Aa="BOTH"):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)));return Aa}function V(){var Aa=ma;var Ea=ma;var Ka=Q();if(Ka!==ka){Ra();var Ya=Ua();if(Ya!==ka)if(Ra(),Ya=ia(),Ya!==ka){Ra();var kb=Va();kb!==ka?(fb=
Ea,Ea={type:"interval-period",period:Ka.value,precision:Ya,secondary:null}):(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;else ma=Ea,Ea=ka}else ma=Ea,Ea=ka;Ea===ka&&(Ea=ma,Ka=Q(),Ka!==ka&&(fb=Ea,Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Ea=Ka);if(Ea!==ka)if(Ra(),Ka=ma,g.substr(ma,2).toLowerCase()===ec?(Ya=g.substr(ma,2),ma+=2):(Ya=ka,0===Za&&q(pe)),Ya!==ka?(Ya=ma,Za++,kb=J(),Za--,kb===ka?Ya=void 0:(ma=Ya,Ya=ka),Ya!==ka?(fb=Ka,Ka="TO"):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka!==ka){Ra();Ka=
ma;Ya=Q();Ya!==ka&&(fb=Ka,Ya={type:"interval-period",period:Ya.value,precision:null,secondary:null});Ka=Ya;if(Ka===ka){Ka=ma;Ya=Ga();if(Ya!==ka)if(Ra(),Ya=Ua(),Ya!==ka)if(Ra(),Ya=ia(),Ya!==ka)if(Ra(),kb=Oa(),kb!==ka)if(Ra(),kb=T(),kb!==ka){Ra();var ub=Va();ub!==ka?(fb=Ka,Ka={type:"interval-period",period:"second",precision:Ya,secondary:kb}):(ma=Ka,Ka=ka)}else ma=Ka,Ka=ka;else ma=Ka,Ka=ka;else ma=Ka,Ka=ka;else ma=Ka,Ka=ka;else ma=Ka,Ka=ka;Ka===ka&&(Ka=ma,Ya=Ga(),Ya!==ka?(Ra(),Ya=Ua(),Ya!==ka?(Ra(),
Ya=ia(),Ya!==ka?(Ra(),kb=Va(),kb!==ka?(fb=Ka,Ka={type:"interval-period",period:"second",precision:Ya,secondary:null}):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka)):(ma=Ka,Ka=ka),Ka===ka&&(Ka=ma,Ya=Ga(),Ya!==ka&&(fb=Ka,Ya={type:"interval-period",period:"second",precision:null,secondary:null}),Ka=Ya))}Ka!==ka?(fb=Aa,Aa={type:"interval-qualifier",start:Ea,end:Ka}):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;else ma=Aa,Aa=ka;Aa===ka&&(Aa=ma,Ka=Q(),Ka!==ka?(Ra(),Ea=Ua(),Ea!==ka?(Ra(),Ea=T(),Ea!==ka?(Ra(),Ya=Va(),Ya!==
ka?(fb=Aa,Aa={type:"interval-period",period:Ka.value,precision:Ea,secondary:null}):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka),Aa===ka&&(Aa=ma,Ka=Q(),Ka!==ka&&(fb=Aa,Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Aa=Ka,Aa===ka&&(Aa=ma,Ka=Ga(),Ka!==ka?(Ra(),Ea=Ua(),Ea!==ka?(Ra(),Ea=ia(),Ea!==ka?(Ra(),Ya=Oa(),Ya!==ka?(Ra(),Ka=T(),Ka!==ka?(Ra(),Ya=Va(),Ya!==ka?(fb=Aa,Aa={type:"interval-period",period:"second",precision:Ea,secondary:Ka}):(ma=Aa,Aa=ka)):(ma=Aa,
Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka),Aa===ka&&(Aa=ma,Ka=Ga(),Ka!==ka?(Ra(),Ea=Ua(),Ea!==ka?(Ra(),Ea=T(),Ea!==ka?(Ra(),Ya=Va(),Ya!==ka?(fb=Aa,Aa={type:"interval-period",period:"second",precision:Ea,secondary:null}):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka),Aa===ka&&(Aa=ma,Ka=Ga(),Ka!==ka&&(fb=Aa,Ka={type:"interval-period",period:"second",precision:null,secondary:null}),Aa=Ka)))));return Aa}function Q(){var Aa=ma;var Ea=qa();Ea!==ka&&(fb=Aa,Ea={type:"string",
value:"day"});Aa=Ea;Aa===ka&&(Aa=ma,Ea=ua(),Ea!==ka&&(fb=Aa,Ea={type:"string",value:"hour"}),Aa=Ea,Aa===ka&&(Aa=ma,Ea=va(),Ea!==ka&&(fb=Aa,Ea={type:"string",value:"minute"}),Aa=Ea,Aa===ka&&(Aa=ma,Ea=la(),Ea!==ka&&(fb=Aa,Ea={type:"string",value:"month"}),Aa=Ea,Aa===ka&&(Aa=ma,Ea=Ba(),Ea!==ka&&(fb=Aa,Ea={type:"string",value:"year"}),Aa=Ea))));return Aa}function T(){var Aa=ma;var Ea=fa();Ea!==ka&&(fb=Aa,Ea=parseFloat(Ea));return Ea}function ia(){var Aa=ma;var Ea=fa();Ea!==ka&&(fb=Aa,Ea=parseFloat(Ea));
return Ea}function O(){var Aa=U();Aa===ka&&(Aa=S());return Aa}function U(){var Aa=ma;if(39===g.charCodeAt(ma)){var Ea=rb;ma++}else Ea=ka,0===Za&&q(Tc);Ea===ka&&(g.substr(ma,2)===vb?(Ea=vb,ma+=2):(Ea=ka,0===Za&&q(Zc)));if(Ea!==ka){Ea=[];var Ka=ma;if(g.substr(ma,2)===pb){var Ya=pb;ma+=2}else Ya=ka,0===Za&&q(Hc);Ya!==ka&&(fb=Ka,Ya="'");Ka=Ya;Ka===ka&&(Xc.test(g.charAt(ma))?(Ka=g.charAt(ma),ma++):(Ka=ka,0===Za&&q($c)));for(;Ka!==ka;)Ea.push(Ka),Ka=ma,g.substr(ma,2)===pb?(Ya=pb,ma+=2):(Ya=ka,0===Za&&q(Hc)),
Ya!==ka&&(fb=Ka,Ya="'"),Ka=Ya,Ka===ka&&(Xc.test(g.charAt(ma))?(Ka=g.charAt(ma),ma++):(Ka=ka,0===Za&&q($c)));39===g.charCodeAt(ma)?(Ka=rb,ma++):(Ka=ka,0===Za&&q(Tc));Ka!==ka?(fb=Aa,Aa={type:"string",value:Ea.join("")}):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function P(){var Aa=ma;if(Wa()!==ka){Ra();var Ea=t();if(Ea!==ka){Ra();var Ka=Ia();Ka!==ka?(Ra(),Ka=t(),Ka!==ka?(fb=Aa,Aa={type:"when-clause",operand:Ea,value:Ka}):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka}else ma=Aa,Aa=ka;return Aa}function R(){var Aa=
ma;if(Wa()!==ka){Ra();var Ea=t();if(Ea!==ka){Ra();var Ka=Ia();Ka!==ka?(Ra(),Ka=t(),Ka!==ka?(fb=Aa,Aa={type:"when-clause",operand:Ea,value:Ka}):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka}else ma=Aa,Aa=ka;return Aa}function ba(){var Aa=ma;var Ea=ma;if(g.substr(ma,4).toLowerCase()===dc){var Ka=g.substr(ma,4);ma+=4}else Ka=ka,0===Za&&q(Mg);if(Ka!==ka){Ka=ma;Za++;var Ya=J();Za--;Ya===ka?Ka=void 0:(ma=Ka,Ka=ka);Ka!==ka?(fb=Ea,Ea="ELSE"):(ma=Ea,Ea=ka)}else ma=Ea,Ea=ka;Ea!==ka?(Ra(),Ea=t(),Ea!==ka?(fb=
Aa,Aa={type:"else-clause",value:Ea}):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka);return Aa}function X(){var Aa=fa();if(Aa===ka){Aa=ma;if(45===g.charCodeAt(ma)){var Ea=Qa;ma++}else Ea=ka,0===Za&&q(vd);Ea===ka&&(43===g.charCodeAt(ma)?(Ea=Ja,ma++):(Ea=ka,0===Za&&q(Yc)));if(Ea!==ka){var Ka=fa();Ka!==ka?(fb=Aa,Aa=Ea[0]+Ka):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka}return Aa}function da(){var Aa=ma;if(46===g.charCodeAt(ma)){var Ea=Db;ma++}else Ea=ka,0===Za&&q(ge);Ea!==ka?(Ea=fa(),Ea===ka&&(Ea=null),fb=Aa,Aa="."+(null!=Ea?Ea:"")):
(ma=Aa,Aa=ka);return Aa}function ha(){var Aa;var Ea=Aa=ma;if(Bc.test(g.charAt(ma))){var Ka=g.charAt(ma);ma++}else Ka=ka,0===Za&&q(Vc);Ka!==ka?(Qc.test(g.charAt(ma))?(Ka=g.charAt(ma),ma++):(Ka=ka,0===Za&&q(Wc)),Ka===ka&&(Ka=null),fb=Ea,Ea="e"+(null===Ka?"":Ka)):(ma=Ea,Ea=ka);Ea!==ka?(Ka=fa(),Ka!==ka?(fb=Aa,Aa=Ea+Ka):(ma=Aa,Aa=ka)):(ma=Aa,Aa=ka);return Aa}function fa(){var Aa=ma;var Ea=[];var Ka=aa();if(Ka!==ka)for(;Ka!==ka;)Ea.push(Ka),Ka=aa();else Ea=ka;Ea!==ka&&(fb=Aa,Ea=Ea.join(""));return Ea}function aa(){if(zc.test(g.charAt(ma))){var Aa=
g.charAt(ma);ma++}else Aa=ka,0===Za&&q(Uc);return Aa}function Z(){var Aa=ma;if(g.substr(ma,2).toLowerCase()===kc){var Ea=g.substr(ma,2);ma+=2}else Ea=ka,0===Za&&q(Gd);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="IN"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ea(){var Aa=ma;if(g.substr(ma,2).toLowerCase()===gc){var Ea=g.substr(ma,2);ma+=2}else Ea=ka,0===Za&&q(Ic);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=
Aa,Aa="IS"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ca(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Fb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(he);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="LIKE"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function W(){var Aa=ma;if(g.substr(ma,3).toLowerCase()===Ob){var Ea=g.substr(ma,3);ma+=3}else Ea=ka,0===Za&&q(ie);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=
Aa,Aa="NOT"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Y(){var Aa=ma;if(g.substr(ma,3).toLowerCase()===Ub){var Ea=g.substr(ma,3);ma+=3}else Ea=ka,0===Za&&q(je);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="AND"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ja(){var Aa=ma;if(g.substr(ma,2).toLowerCase()===jb){var Ea=g.substr(ma,2);ma+=2}else Ea=ka,0===Za&&q(ke);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=
Aa,Aa="OR"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function oa(){var Aa=ma;if(g.substr(ma,7).toLowerCase()===sa){var Ea=g.substr(ma,7);ma+=7}else Ea=ka,0===Za&&q(le);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="BETWEEN"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ra(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Fa){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(me);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?
(fb=Aa,Aa="FROM"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ta(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===hb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Id);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="TRIM"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ya(){var Aa=ma;if(g.substr(ma,9).toLowerCase()===ob){var Ea=g.substr(ma,9);ma+=9}else Ea=ka,0===Za&&q(Ld);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==
ka?(fb=Aa,Aa="TIMESTAMP"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Ca(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===qb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(qe);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="DATE"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function pa(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===yb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(re);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=
ka);Ea!==ka?(fb=Aa,Aa="TIME"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function wa(){var Aa=ma;if(g.substr(ma,8).toLowerCase()===fc){var Ea=g.substr(ma,8);ma+=8}else Ea=ka,0===Za&&q(Ng);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="INTERVAL"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Ba(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Lb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Og);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=
Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="YEAR"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function la(){var Aa=ma;if(g.substr(ma,5).toLowerCase()===Wb){var Ea=g.substr(ma,5);ma+=5}else Ea=ka,0===Za&&q(Pg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="MONTH"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function qa(){var Aa=ma;if(g.substr(ma,3).toLowerCase()===Kb){var Ea=g.substr(ma,3);ma+=3}else Ea=ka,0===Za&&q(Qg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:
(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="DAY"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function ua(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Zb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Rg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="HOUR"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function va(){var Aa=ma;if(g.substr(ma,6).toLowerCase()===$b){var Ea=g.substr(ma,6);ma+=6}else Ea=ka,0===Za&&q(Sg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:
(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="MINUTE"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Ga(){var Aa=ma;if(g.substr(ma,6).toLowerCase()===Cb){var Ea=g.substr(ma,6);ma+=6}else Ea=ka,0===Za&&q(Tg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="SECOND"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function La(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Pb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Ug);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=
void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="CASE"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Na(){var Aa=ma;if(g.substr(ma,3).toLowerCase()===Hb){var Ea=g.substr(ma,3);ma+=3}else Ea=ka,0===Za&&q(Vg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="END"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Wa(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===xc){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Wg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?
Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="WHEN"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Ia(){var Aa=ma;if(g.substr(ma,4).toLowerCase()===Qb){var Ea=g.substr(ma,4);ma+=4}else Ea=ka,0===Za&&q(Xg);if(Ea!==ka){Ea=ma;Za++;var Ka=J();Za--;Ka===ka?Ea=void 0:(ma=Ea,Ea=ka);Ea!==ka?(fb=Aa,Aa="THEN"):(ma=Aa,Aa=ka)}else ma=Aa,Aa=ka;return Aa}function Oa(){if(44===g.charCodeAt(ma)){var Aa=vc;ma++}else Aa=ka,0===Za&&q(Yg);return Aa}function Ua(){if(40===g.charCodeAt(ma)){var Aa=nc;ma++}else Aa=ka,0===
Za&&q(Zg);return Aa}function Va(){if(41===g.charCodeAt(ma)){var Aa=lc;ma++}else Aa=ka,0===Za&&q($g);return Aa}function Ra(){var Aa;var Ea=[];for(Aa=bb();Aa!==ka;)Ea.push(Aa),Aa=bb();return Ea}function bb(){if(Gc.test(g.charAt(ma))){var Aa=g.charAt(ma);ma++}else Aa=ka,0===Za&&q(ah);return Aa}function gb(Aa,Ea,Ka,Ya){Aa={type:"binary-expression",operator:Aa,left:Ea,right:Ka};void 0!==Ya&&(Aa.escape=Ya);return Aa}function db(Aa,Ea){for(var Ka=0;Ka<Ea.length;Ka++)Aa=gb(Ea[Ka][1],Aa,Ea[Ka][3]);return Aa}
e=void 0!==e?e:{};var ka={},mb=e.grammarSource,sb={start:v},tb=v,xa="!",Ha="\x3d",na="\x3e\x3d",za="\x3e",Da="\x3c\x3d",Ma="\x3c\x3e",Xa="\x3c",ab="!\x3d",Ja="+",Qa="-",Sa="||",cb="*",eb="/",lb="@",rb="'",vb="N'",pb="''",Db=".",Jb="null",Rb="true",ac="false",kc="in",gc="is",Fb="like",Tb="escape",Ob="not",Ub="and",jb="or",sa="between",Fa="from",Pa="for",Ta="substring",$a="extract",hb="trim",ib="position",ob="timestamp",qb="date",yb="time",wb="leading",Bb="trailing",zb="both",Sb="cast",nb="as",xb="integer",
Ab="smallint",Nb="float",cc="real",hc="varchar",ec="to",fc="interval",Lb="year",Mb="timezone_hour",Vb="timezone_minute",Wb="month",Kb="day",Zb="hour",$b="minute",Cb="second",Pb="case",Hb="end",xc="when",Qb="then",dc="else",vc=",",nc="(",lc=")",tc="`",yc=/^[A-Za-z_\x80-\uFFFF]/,Ac=/^[A-Za-z0-9_]/,uc=/^[A-Za-z0-9_.\x80-\uFFFF]/,Pc=/^["]/,Xc=/^[^']/,zc=/^[0-9]/,Bc=/^[eE]/,Qc=/^[+\-]/,Gc=/^[ \t\n\r]/,Cc=/^[^`]/,Rc=l("!",!1),Sc=l("\x3d",!1),zd=l("\x3e\x3d",!1),Zd=l("\x3e",!1),$d=l("\x3c\x3d",!1),ae=l("\x3c\x3e",
!1),Ad=l("\x3c",!1),Bd=l("!\x3d",!1),Yc=l("+",!1),vd=l("-",!1),Cd=l("||",!1),be=l("*",!1),ce=l("/",!1),de=u([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),ee=u([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),fe=u([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Xe=u(['"'],!1,!1),Ye=l("@",!1),Tc=l("'",!1),Zc=l("N'",!1),Hc=l("''",!1),$c=u(["'"],!0,!1),ge=l(".",!1),Uc=u([["0","9"]],!1,!1),Vc=u(["e","E"],!1,!1),Wc=u(["+","-"],!1,!1),Dd=l("NULL",!0),Ed=l("TRUE",!0),Fd=l("FALSE",!0),
Gd=l("IN",!0),Ic=l("IS",!0),he=l("LIKE",!0),Ze=l("ESCAPE",!0),ie=l("NOT",!0),je=l("AND",!0),ke=l("OR",!0),le=l("BETWEEN",!0),me=l("FROM",!0),ne=l("FOR",!0),oe=l("SUBSTRING",!0),Hd=l("EXTRACT",!0),Id=l("TRIM",!0),Jd=l("POSITION",!0),Ld=l("TIMESTAMP",!0),qe=l("DATE",!0),re=l("TIME",!0),se=l("LEADING",!0),te=l("TRAILING",!0),Md=l("BOTH",!0),ue=l("CAST",!0),ve=l("AS",!0),we=l("INTEGER",!0),Nd=l("SMALLINT",!0),Kd=l("FLOAT",!0),$e=l("REAL",!0),af=l("VARCHAR",!0),pe=l("TO",!0),Ng=l("INTERVAL",!0),Og=l("YEAR",
!0),$f=l("TIMEZONE_HOUR",!0),bg=l("TIMEZONE_MINUTE",!0),Pg=l("MONTH",!0),Qg=l("DAY",!0),Rg=l("HOUR",!0),Sg=l("MINUTE",!0),Tg=l("SECOND",!0),Ug=l("CASE",!0),Vg=l("END",!0),Wg=l("WHEN",!0),Xg=l("THEN",!0),Mg=l("ELSE",!0),Yg=l(",",!1),Zg=l("(",!1),$g=l(")",!1),ah=u([" ","\t","\n","\r"],!1,!1),Of=l("`",!1),Pf=u(["`"],!0,!1),ma=0,fb=0,xe=[{line:1,column:1}],Dc=0,bf=[],Za=0;if("startRule"in e){if(!(e.startRule in sb))throw Error("Can't start parsing from rule \""+e.startRule+'".');tb=sb[e.startRule]}var qf=
tb();if(qf!==ka&&ma===g.length)return qf;qf!==ka&&ma<g.length&&q({type:"end"});throw function(Aa,Ea,Ka){return new d(d.buildMessage(Aa,Ea),Aa,Ea,Ka)}(bf,Dc<g.length?g.charAt(Dc):null,Dc<g.length?w(Dc,Dc+1):w(Dc,Dc));}}})})(h);var c=h.exports;class k{static parse(m){return c.parse(m)}}a.WhereGrammar=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,b,
h){const c=new h,k=new h,m=new h,d={esriGeometryPoint:b.convertToPoint,esriGeometryPolyline:b.convertToPolyline,esriGeometryPolygon:b.convertToPolygon,esriGeometryMultipoint:b.convertToMultipoint},f=(g,e)=>"_geVersion"!==g?e:void 0;a.cleanFromGeometryEngine=function(g){return g&&"_geVersion"in g?JSON.parse(JSON.stringify(g,f)):g};a.getGeometry=function(g,e,n,l,u,x,w=e,q=n){const v=e&&w,p=n&&q;l=null!=l?"coords"in l?l:l.geometry:null;if(null==l)return null;if(u)return e=b.generalizeOptimizedGeometry(k,
l,e,n,g,u,w,q),x&&(e=b.quantizeOptimizedGeometry(m,e,v,p,g,x)),d[g]?.(e,v,p)??null;if(x)return x=b.quantizeOptimizedGeometry(m,l,e,n,g,x,w,q),d[g]?.(x,v,p)??null;b.removeZMValues(c,l,e,n,w,q);return d[g]?.(c,v,p)??null};a.transformCentroid=function(g,e,n,l=g.hasZ,u=g.hasM){if(null==e)return null;const x=g.hasZ&&l,w=g.hasM&&u;return n?(g=b.quantizeOptimizedGeometry(m,e,g.hasZ,g.hasM,"esriGeometryPoint",n,l,u),b.convertToPoint(g,x,w)):b.convertToPoint(e,x,w)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,b,h,c,k,m,d){function f(q,v){if(!v)return null;if("x"in v){var p={x:0,y:0};[p.x,p.y]=q(v.x,v.y,n);null!=v.z&&(p.z=v.z);null!=v.m&&(p.m=v.m);return p}return"xmin"in v?(p={xmin:0,
ymin:0,xmax:0,ymax:0},[p.xmin,p.ymin]=q(v.xmin,v.ymin,n),[p.xmax,p.ymax]=q(v.xmax,v.ymax,n),v.hasZ&&(p.zmin=v.zmin,p.zmax=v.zmax,p.hasZ=!0),v.hasM&&(p.mmin=v.mmin,p.mmax=v.mmax,p.hasM=!0),p):"rings"in v?{rings:g(v.rings,q),hasM:v.hasM,hasZ:v.hasZ}:"paths"in v?{paths:g(v.paths,q),hasM:v.hasM,hasZ:v.hasZ}:"points"in v?{points:e(v.points,q),hasM:v.hasM,hasZ:v.hasZ}:null}function g(q,v){const p=[];for(const t of q)p.push(e(t,v));return p}function e(q,v){const p=[];for(const t of q)q=v(t[0],t[1],[0,0]),
p.push(q),2<t.length&&q.push(t[2]),3<t.length&&q.push(t[3]);return p}const n=[0,0],l=f.bind(null,d.lngLatToXY),u=f.bind(null,d.xyToLngLat);class x{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(q,v,p,t){if(!q?.length||!v||!p||m.equals(v,p))return q;q={geometries:q,inSpatialReference:v,outSpatialReference:p,geographicTransformation:t,resolve:h.createResolver()};this._jobs.push(q);this._timer??(this._timer=setTimeout(this._process,10));return q.resolve.promise}_process(){this._timer=
null;const q=this._jobs.shift();if(q){var {geometries:v,inSpatialReference:p,outSpatialReference:t,resolve:r,geographicTransformation:y}=q;d.canProject(p,t)?m.isWebMercator(t)?r(v.map(l)):r(v.map(u)):r(c.projectMany(k.jsonAdapter,v,p,t,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const w=new x;a.checkProjectionSupport=async function(q,v){q&&v&&(q=Array.isArray(q)?q.map(p=>null!=p.geometry?p.geometry.spatialReference:null).filter(b.isSome):[q],await c.initializeProjection(q.map(p=>
({source:p,dest:v}))))};a.project=function(q,v,p,t){if(!q)return q;p||(p=v,v=q.spatialReference);return m.isValid(v)&&m.isValid(p)&&!m.equals(v,p)?d.canProject(v,p)?(q=m.isWebMercator(p)?l(q):u(q),q.spatialReference=p,q):c.projectMany(k.jsonAdapter,[q],v,p,null,t)[0]:q};a.projectMany=function(q,v,p,t){return w.push(q,v,p,t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class b{constructor(d,f,g){this.x=
d;this.y=f;this.spatialReference=g;this.m=this.z=void 0}}class h{constructor(d,f,g,e){this.rings=d;this.spatialReference=f;this.hasM=this.hasZ=void 0;g&&(this.hasZ=g);e&&(this.hasM=e)}}class c{constructor(d,f,g,e){this.paths=d;this.spatialReference=f;this.hasM=this.hasZ=void 0;g&&(this.hasZ=g);e&&(this.hasM=e)}}class k{constructor(d,f,g,e){this.points=d;this.spatialReference=f;this.hasM=this.hasZ=void 0;g&&(this.hasZ=g);e&&(this.hasM=e)}}class m{constructor(d,f,g,e,n){this.xmin=d;this.ymin=f;this.xmax=
g;this.ymax=e;this.spatialReference=n;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(d,f){return null==f?null:d.convertJSONToGeometry(f)},exportPoint:function(d,f,g){g=new b(d.getPointX(f),d.getPointY(f),g);const e=d.hasZ(f),n=d.hasM(f);e&&(g.z=d.getPointZ(f));n&&(g.m=d.getPointM(f));return g},exportPolygon:function(d,f,g){return new h(d.exportPaths(f),g,d.hasZ(f),d.hasM(f))},exportPolyline:function(d,f,g){return new c(d.exportPaths(f),g,d.hasZ(f),d.hasM(f))},
exportMultipoint:function(d,f,g){return new k(d.exportPoints(f),g,d.hasZ(f),d.hasM(f))},exportExtent:function(d,f,g){var e=d.hasZ(f);const n=d.hasM(f);g=new m(d.getXMin(f),d.getYMin(f),d.getXMax(f),d.getYMax(f),g);e&&(e=d.getZExtent(f),g.zmin=e.vmin,g.zmax=e.vmax);n&&(d=d.getMExtent(f),g.mmin=d.vmin,g.mmax=d.vmax);return g}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){function x(p,t,r,y){const D=y.x-r.x;y=y.y-r.y;t=Math.min(1,Math.max(0,((t.x-r.x)*D+(t.y-r.y)*y)/(D*D+y*y)));p.x=r.x+D*t;p.y=r.y+y*t}function w(p,t){return p?t?4:3:t?3:2}class q{constructor(p,t,r){this.items=p;this.query=t;this.geometryType=r.geometryType;this.hasM=r.hasM;this.hasZ=r.hasZ;this.fieldsIndex=r.fieldsIndex;this.objectIdField=r.objectIdField;this.spatialReference=r.spatialReference;this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const p=
new f(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return p.countDistinctValues(this.items);const {groupByFieldsForStatistics:t,having:r,outStatistics:y}=this.query;if(!t?.length)return 1;const D=new Map,E=new Map,A=new Set;for(const G of y){var {statisticType:B}=G;B="exceedslimit"!==B?G.onStatisticField:void 0;if(!E.has(B)){var F=[];for(const H of t){const L=this._getAttributeValues(p,H,D);F.push(L)}E.set(B,this._calculateUniqueValues(F,p.returnDistinctValues))}B=
E.get(B);for(const H in B){const {data:L,items:C}=B[H];F=L.join(",");r&&!p.validateItems(C,r)||A.add(F)}}return A.size}async createQueryResponse(){let p;p=this.query.outStatistics?this.query.outStatistics.some(t=>"exceedslimit"===t.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const t=this.query.geometry;d.isValid(this.query.outSR)&&!d.equals(t.spatialReference,
this.query.outSR)?p.queryGeometry=g.cleanFromGeometryEngine({spatialReference:this.query.outSR,...e.project(t,t.spatialReference,this.query.outSR)}):p.queryGeometry=g.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return p}createSnappingResponse(p,t){const r=this.featureAdapter,y=w(this.hasZ,this.hasM),{point:D,mode:E}=p,A="number"===typeof p.distance?p.distance:p.distance.x,B="number"===typeof p.distance?p.distance:p.distance.y,F={candidates:[]},G="esriGeometryPolygon"===this.geometryType;
t=this._getPointCreator(E,this.spatialReference,t);const H=new v(null,0),L=new v(null,0),C={x:0,y:0,z:0};for(const N of this.items){var z=r.getGeometry(N);if(null==z)continue;const {coords:V,lengths:Q}=z;H.coords=V;L.coords=V;if(p.returnEdge){z=0;for(var J=0;J<Q.length;J++){var K=Q[J];for(var I=0;I<K;I++,z+=y){var M=H;M.coordsIndex=z;if(I!==K-1){const T=L;T.coordsIndex=z+y;const ia=C;x(C,D,M,T);var S=(D.x-ia.x)/A;const O=(D.y-ia.y)/B;S=S*S+O*O;1>=S&&F.candidates.push(n.makeEdgeCandidate(r.getObjectId(N),
t(ia),Math.sqrt(S),t(M),t(T)))}}}}if("none"!==p.vertexMode)if(z=G?V.length-y:V.length,"all"===p.vertexMode)for(J=0;J<z;J+=y)K=H,K.coordsIndex=J,I=(D.x-K.x)/A,M=(D.y-K.y)/B,I=I*I+M*M,1>=I&&F.candidates.push(n.makeVertexCandidate(r.getObjectId(N),t(K),Math.sqrt(I)));else if("ends"===p.vertexMode){z=[0];G||z.push(V.length-y);for(const T of z)z=H,z.coordsIndex=T,J=(D.x-z.x)/A,K=(D.y-z.y)/B,J=J*J+K*K,1>=J&&F.candidates.push(n.makeVertexCandidate(r.getObjectId(N),t(z),Math.sqrt(J)))}}F.candidates.sort((N,
V)=>N.distance-V.distance);return F}_getPointCreator(p,t,r){const y=null==r||d.equals(t,r)?E=>E:E=>e.project(E,t,r),{hasZ:D}=this;return"3d"===p?D?({x:E,y:A,z:B})=>y({x:E,y:A,z:B}):({x:E,y:A})=>y({x:E,y:A,z:0}):({x:E,y:A})=>y({x:E,y:A})}async createSummaryStatisticsResponse(p){const {field:t,valueExpression:r,normalizationField:y,normalizationType:D,normalizationTotal:E,minValue:A,maxValue:B,scale:F,timeZone:G}=p;var H=this.fieldsIndex.get(t);p=l.isDateField(H)||l.isDateOnlyField(H)||l.isTimestampOffsetField(H);
const L=await this._getDataValues({field:t,valueExpression:r,normalizationField:y,normalizationType:D,normalizationTotal:E,scale:F,timeZone:G}),C=u.isNullCountSupported({normalizationType:D,normalizationField:y,minValue:A,maxValue:B}),z={value:.5,fieldType:H?.type};H=l.isStringField(H)?u.calculateStringStatistics({values:L,supportsNullCount:C,percentileParams:z}):u.calculateStatistics({values:L,minValue:A,maxValue:B,useSampleStdDev:!D,supportsNullCount:C,percentileParams:z});return u.processSummaryStatisticsResult(H,
p)}async createUniqueValuesResponse(p){const {field:t,valueExpression:r,domains:y,returnAllCodedValues:D,scale:E,timeZone:A}=p;var B=await this._getDataValues({field:t,field2:p.field2,field3:p.field3,fieldDelimiter:p.fieldDelimiter,valueExpression:r,scale:E,timeZone:A},!1);B=u.calculateUniqueValuesCount(B);return u.createUVResult(B,y,D,p.fieldDelimiter)}async createClassBreaksResponse(p){const {field:t,valueExpression:r,normalizationField:y,normalizationType:D,normalizationTotal:E,classificationMethod:A,
standardDeviationInterval:B,minValue:F,maxValue:G,numClasses:H,scale:L,timeZone:C}=p;p=await this._getDataValues({field:t,valueExpression:r,normalizationField:y,normalizationType:D,normalizationTotal:E,scale:L,timeZone:C});p=u.calculateClassBreaks(p,{field:t,normalizationField:y,normalizationType:D,normalizationTotal:E,classificationMethod:A,standardDeviationInterval:B,minValue:F,maxValue:G,numClasses:H});return u.resolveCBResult(p,A)}async createHistogramResponse(p){const {field:t,valueExpression:r,
normalizationField:y,normalizationType:D,normalizationTotal:E,classificationMethod:A,standardDeviationInterval:B,minValue:F,maxValue:G,numBins:H,scale:L,timeZone:C}=p;p=await this._getDataValues({field:t,valueExpression:r,normalizationField:y,normalizationType:D,normalizationTotal:E,scale:L,timeZone:C});return u.calculateHistogram(p,{field:t,normalizationField:y,normalizationType:D,normalizationTotal:E,classificationMethod:A,standardDeviationInterval:B,minValue:F,maxValue:G,numBins:H})}_sortFeatures(p,
t,r){if(1<p.length&&t?.length)for(const y of t.reverse()){t=y.split(" ");const D=t[0],E=this.fieldsIndex.get(D);t=t[1]?"desc"===t[1].toLowerCase():!1;const A=u.getAttributeComparator(E?.type,t);p.sort((B,F)=>{B=r(B,D,E);F=r(F,D,E);return A(B,F)})}}_createFeatureQueryResponse(p){const t=this.items,{geometryType:r,hasM:y,hasZ:D,objectIdField:E,spatialReference:A}=this,{outFields:B,outSR:F,quantizationParameters:G,resultRecordCount:H,resultOffset:L,returnZ:C,returnM:z}=p,J=null!=H?t.length>(L||0)+H:
!1,K=B&&(B.includes("*")?[...this.fieldsIndex.fields]:B.map(I=>this.fieldsIndex.get(I)));return{exceededTransferLimit:J,features:this._createFeatures(p,t),fields:K,geometryType:r,hasM:y&&z,hasZ:D&&C,objectIdFieldName:E,spatialReference:g.cleanFromGeometryEngine(F||A),transform:G&&m.toQuantizationTransform(G)||null}}_createFeatures(p,t){const r=new f(p,this.featureAdapter,this.fieldsIndex),{hasM:y,hasZ:D}=this,{orderByFields:E,quantizationParameters:A,returnGeometry:B,returnCentroid:F,maxAllowableOffset:G,
resultOffset:H,resultRecordCount:L,returnZ:C=!1,returnM:z=!1}=p,J=D&&C,K=y&&z;p=[];var I=0;const M=[...t];this._sortFeatures(M,E,(T,ia,O)=>r.getFieldValue(T,ia,O));if(this.geometryType&&(B||F)){var S=m.toQuantizationTransform(A)??void 0;t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(B&&!F)for(var N of M){var V=this.featureAdapter.getGeometry(N),Q={attributes:r.getAttributes(N),geometry:g.getGeometry(this.geometryType,this.hasZ,this.hasM,V,G,S,J,K)};t&&V&&
!Q.geometry&&(Q.centroid=g.transformCentroid(this,this.featureAdapter.getCentroid(N,this),S));p[I++]=Q}else if(!B&&F)for(V of M)p[I++]={attributes:r.getAttributes(V),centroid:g.transformCentroid(this,this.featureAdapter.getCentroid(V,this),S)};else for(Q of M)p[I++]={attributes:r.getAttributes(Q),centroid:g.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),S),geometry:g.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),G,S,J,K)}}else for(S of M)(N=r.getAttributes(S))&&
(p[I++]={attributes:N});I=H||0;null!=L&&(p=p.slice(I,Math.min(p.length,I+L)));return p}_createExceedsLimitQueryResponse(p){var t=!1;let r=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;t=Number.POSITIVE_INFINITY;for(const D of p.outStatistics??[])if("exceedslimit"===D.statisticType){r=null!=D.maxPointCount?D.maxPointCount:Number.POSITIVE_INFINITY;y=null!=D.maxRecordCount?D.maxRecordCount:Number.POSITIVE_INFINITY;t=null!=D.maxVertexCount?D.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===
this.geometryType)t=this.items.length>r;else if(this.items.length>y)t=!0;else{p=w(this.hasZ,this.hasM);const D=this.featureAdapter;t=this.items.reduce((E,A)=>{A=D.getGeometry(A);return E+(null!=A&&A.coords.length||0)},0)/p>t}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}async _createStatisticsQueryResponse(p){var t={attributes:{}};const r=[],y=new Map,D=
new Map,E=new Map,A=new Map,B=new f(p,this.featureAdapter,this.fieldsIndex);var F=p.outStatistics;const {groupByFieldsForStatistics:G,having:H,orderByFields:L,resultRecordCount:C}=p;p=G?.length;const z=!!p,J=z?G[0]:null,K=z&&!this.fieldsIndex.get(J);for(const V of F??[]){const {outStatisticFieldName:Q,statisticType:T}=V;F=V;const ia="exceedslimit"!==T?V.onStatisticField:void 0,O="percentile_disc"===T||"percentile_cont"===T;var I="EnvelopeAggregate"===T||"CentroidAggregate"===T||"ConvexHullAggregate"===
T;const U=z&&1===p&&(ia===J||K)&&"count"===T;if(z){if(!E.has(ia)){var M=[];for(const P of G){var S=this._getAttributeValues(B,P,y);M.push(S)}E.set(ia,this._calculateUniqueValues(M,I?!1:B.returnDistinctValues))}M=E.get(ia);if(!M)continue;S=Object.keys(M);for(const P of S){const {count:R,data:ba,items:X,itemPositions:da}=M[P];S=ba.join(",");if(!H||B.validateItems(X,H)){const ha=A.get(S)||{attributes:{}};if(I){ha.aggregateGeometries||(ha.aggregateGeometries={});const {aggregateGeometries:aa,outStatisticFieldName:Z}=
await this._getAggregateGeometry(F,X);ha.aggregateGeometries[Z]=aa}else{var N=null;if(U)N=R;else{const aa=this._getAttributeValues(B,ia,y);N=da.map(Z=>aa[Z]);N=O&&"statisticParameters"in F?this._getPercentileValue(F,N):this._getStatisticValue(F,N,null,B.returnDistinctValues)}ha.attributes[Q]=N}let fa=0;G.forEach((aa,Z)=>ha.attributes[this.fieldsIndex.get(aa)?aa:`EXPR_${++fa}`]=ba[Z]);A.set(S,ha)}}}else if(I){t.aggregateGeometries||(t.aggregateGeometries={});const {aggregateGeometries:P,outStatisticFieldName:R}=
await this._getAggregateGeometry(F,this.items);t.aggregateGeometries[R]=P}else I=this._getAttributeValues(B,ia,y),t.attributes[Q]=O&&"statisticParameters"in F?this._getPercentileValue(F,I):this._getStatisticValue(F,I,D,B.returnDistinctValues);F="min"!==T&&"max"!==T||!l.isStringField(this.fieldsIndex.get(ia))&&!this._isAnyDateField(ia)?null:this.fieldsIndex.get(ia)?.type;r.push({name:Q,alias:Q,type:F||"esriFieldTypeDouble"})}t=z?Array.from(A.values()):[t];this._sortFeatures(t,L,(V,Q)=>V.attributes[Q]);
C&&(t.length=Math.min(C,t.length));return{fields:r,features:t}}_isAnyDateField(p){p=this.fieldsIndex.get(p);return l.isDateField(p)||l.isDateOnlyField(p)||l.isTimestampOffsetField(p)||l.isTimeOnlyField(p)}async _getAggregateGeometry(p,t){const {convexHull:r,union:y}=await new Promise((C,z)=>a(["../../../geometry/geometryEngineJSON"],C,z)),{statisticType:D,outStatisticFieldName:E}=p,{featureAdapter:A,spatialReference:B,geometryType:F,hasZ:G,hasM:H}=this;t=t.map(C=>g.getGeometry(F,G,H,A.getGeometry(C)));
const L=r(B,t,!0)[0];p={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===D?(t=L?k.getPolygonExtent(L):k.getGeometryExtent(y(B,t)),p.aggregateGeometries={...t,spatialReference:B},p.outStatisticFieldName=E||"extent"):"CentroidAggregate"===D?(t=L?c.polygonCentroid(L):c.extentCentroid(k.getGeometryExtent(y(B,t))),p.aggregateGeometries={x:t[0],y:t[1],spatialReference:B},p.outStatisticFieldName=E||"centroid"):"ConvexHullAggregate"===D&&(p.aggregateGeometries=L,p.outStatisticFieldName=
E||"convexHull");return p}_getStatisticValue(p,t,r,y){const {onStatisticField:D,statisticType:E}=p;p=null;p=r?.has(D)?r.get(D):l.isStringField(this.fieldsIndex.get(D))||this._isAnyDateField(D)?u.calculateStringStatistics({values:t,returnDistinct:y}):u.calculateStatistics({values:y?[...(new Set(t))]:t,minValue:null,maxValue:null,useSampleStdDev:!0});r&&r.set(D,p);return p["var"===E?"variance":E]}_getPercentileValue(p,t){const {onStatisticField:r,statisticParameters:y,statisticType:D}=p,{value:E,orderBy:A}=
y;p=this.fieldsIndex.get(r);return u.calculatePercentile(t,{value:E,orderBy:A,fieldType:p?.type,isDiscrete:"percentile_disc"===D})}_getAttributeValues(p,t,r){if(r.has(t))return r.get(t);const y=this.fieldsIndex.get(t),D=this.items.map(E=>p.getFieldValue(E,t,y));r.set(t,D);return D}_calculateUniqueValues(p,t){const r={},y=this.items,D=y.length;for(let E=0;E<D;E++){const A=y[E],B=[];for(const G of p)B.push(G[E]);const F=B.join(",");null==r[F]?r[F]={count:1,data:B,items:[A],itemPositions:[E]}:(t||r[F].count++,
r[F].items.push(A),r[F].itemPositions.push(E))}return r}async _getDataValues(p,t=!0){const r=new f(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:y,scale:D,timeZone:E}=p;return y?r.getExpressionValues(this.items,y,{viewingMode:"map",scale:D,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},E):r.getDataValues(this.items,h.clone(p),t)}}class v{constructor(p,t){this.coords=p;this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+
1]}get z(){return this.coords[this.coordsIndex+2]}}b.QueryEngineResult=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),function(a,b,h,c,k,m){class d{constructor(f,g,e){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=
f.returnDistinctValues??!1;this.fieldsIndex=e;this.featureAdapter=g;if((g=f.outFields)&&!g.includes("*")){this.outFields=g;f=0;for(const l of g){var n=a.getExpressionFromFieldName(l);n=(g=this.fieldsIndex.get(n))?null:a.getWhereClause(n,e);g=g?g.name:a.getAliasFromFieldName(l)||`FIELD_EXP_${f++}`;this._fieldDataCache.set(l,{alias:g,clause:n})}}}countDistinctValues(f){if(!this.returnDistinctValues)return f.length;f.forEach(g=>this.getAttributes(g));return this._returnDistinctMap.size}getAttributes(f){f=
this._processAttributesForOutFields(f);return this._processAttributesForDistinctValues(f)}getFieldValue(f,g,e){const n=e?e.name:g;let l=null;this._fieldDataCache.has(n)?l=this._fieldDataCache.get(n)?.clause:e||(l=a.getWhereClause(g,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:l}));return e?this.featureAdapter.getAttribute(f,n):l?.calculateValue(f,this.featureAdapter)}getDataValues(f,g,e=!0){const n=g.normalizationType,l=g.normalizationTotal,u=this.fieldsIndex.get(g.field),x=h.isDateOnlyField(u)||
h.isTimestampOffsetField(u),w=h.isTimeOnlyField(u);return f.map(q=>{let v=g.field&&this.getFieldValue(q,g.field,this.fieldsIndex.get(g.field));g.field2?(v=`${k.processNullValue(v)}${g.fieldDelimiter}${k.processNullValue(this.getFieldValue(q,g.field2,this.fieldsIndex.get(g.field2)))}`,g.field3&&(v=`${v}${g.fieldDelimiter}${k.processNullValue(this.getFieldValue(q,g.field3,this.fieldsIndex.get(g.field3)))}`)):"string"===typeof v&&e&&(x?v=v?(new Date(v)).getTime():null:w&&(v=v?c.timeOnlyToMilliseconds(v):
null));n&&Number.isFinite(v)&&(q="field"===n&&g.normalizationField?this.getFieldValue(q,g.normalizationField,this.fieldsIndex.get(g.normalizationField)):null,v=k.getNormalizedValue(v,n,q,l));return v})}async getExpressionValues(f,g,e,n,l){const {arcadeUtils:u}=await m.loadArcade(),x=u.hasGeometryOperations(g);x&&await u.enableGeometryOperations();const w=u.createFunction(g),q=u.getViewInfo(e),v={fields:this.fieldsIndex.fields};return f.map(p=>{p={attributes:this.featureAdapter.getAttributes(p),layer:v,
geometry:x?{...b.getGeometry(n.geometryType,n.hasZ,n.hasM,this.featureAdapter.getGeometry(p)),spatialReference:e?.spatialReference}:null};p=u.createExecContext(p,q,l);return u.executeFunction(w,p)})}validateItem(f,g){this._fieldDataCache.has(g)||this._fieldDataCache.set(g,{alias:g,clause:a.getWhereClause(g,this.fieldsIndex)});return this._fieldDataCache.get(g)?.clause?.testFeature(f,this.featureAdapter)??!1}validateItems(f,g){this._fieldDataCache.has(g)||this._fieldDataCache.set(g,{alias:g,clause:a.getWhereClause(g,
this.fieldsIndex)});return this._fieldDataCache.get(g)?.clause?.testSet(f,this.featureAdapter)??!1}_processAttributesForOutFields(f){const g=this.outFields;if(!g?.length)return this.featureAdapter.getAttributes(f);const e={};for(const n of g){const {alias:l,clause:u}=this._fieldDataCache.get(n);e[l]=u?u.calculateValue(f,this.featureAdapter):this.featureAdapter.getAttribute(f,l)}return e}_processAttributesForDistinctValues(f){if(null==f||!this.returnDistinctValues)return f;var g=this.outFields,e=[];
if(g)for(const l of g){var {alias:n}=this._fieldDataCache.get(l);e.push(f[n])}else for(n in f)e.push(f[n]);g=`${(g||["*"]).join(",")}=${e.join(",")}`;e=this._returnDistinctMap.get(g)||0;this._returnDistinctMap.set(g,++e);return 1<e?null:f}}return d})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(y){y=r.exec(y);if(!y)return null;const {hh:D,mm:E,ss:A,ms:B}=y.groups;return Number(D)*k.millisecondsPerTimeUnit.hours+Number(E)*k.millisecondsPerTimeUnit.minutes+Number(A)*k.millisecondsPerTimeUnit.seconds+Number(B||0)}function q(y,D){y=null!=y?y:"";null!=D&&D&&(y=y?"("+y+") AND ("+D+")":D);return y}function v(y){const D=y.layer;return y.fields.filter(E=>!D.getField(E))}function p(y){const D=y.layer;return y.fields.filter(E=>{E=D.getFieldUsageInfo(E);
return!E||!E.supportsStatistics})}let t=null;const r=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(y,D=18,E,A,B){const F=new Float64Array(A*B);D=Math.round(c.pt2px(D));let G=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY;E=e.createValueFunction(E);for(const {geometry:z,attributes:J}of y){const {x:K,y:I}=z;y=Math.max(0,K-D);var L=Math.max(0,I-D);const M=Math.min(B,I+D),S=Math.min(A,K+D),N=+E(J);for(;L<M;L++)for(let V=
y;V<S;V++){var C=L*A+V;const Q=e.evaluateDensityKernel(V-K,L-I,D)*N;C=F[C]+=Q;G=Math.min(G,C);H=Math.max(H,C)}}return{min:G,max:H}};a.getDataValues=async function(y,D,E=!0){if(!D)return[];const {field:A,field2:B,field3:F,fieldDelimiter:G,fieldInfos:H,timeZone:L}=y;var C=A&&H?.find(ia=>ia.name.toLowerCase()===A.toLowerCase());const z=C?g.isTimeOnlyField(C):!1,J=C?n.isAnyDateField(C):!1,K=y.valueExpression,I=y.normalizationType,M=y.normalizationField,S=y.normalizationTotal,N=[];C=y.viewInfoParams;let V=
null,Q=null;if(K){if(!t){const {arcadeUtils:ia}=await u.loadArcade();t=ia}t.hasGeometryOperations(K)&&await t.enableGeometryOperations();V=t.createFunction(K);Q=C?t.getViewInfo({viewingMode:C.viewingMode,scale:C.scale,spatialReference:new m(C.spatialReference)}):null}y=y.fieldInfos;const T=D[0]&&"declaredClass"in D[0]&&"esri.Graphic"===D[0].declaredClass||!y?null:{fields:y};D.forEach(ia=>{var O=ia.attributes;if(K){var U=t.createExecContext(T?{...ia,layer:T}:ia,Q,L);U=t.executeFunction(V,U)}else O&&
(U=O[A],B?(U=`${l.processNullValue(U)}${G}${l.processNullValue(O[B])}`,F&&(U=`${U}${G}${l.processNullValue(O[F])}`)):"string"===typeof U&&E&&(J?U=U?(new Date(U)).getTime():null:z&&(U=U?w(U):null)));I&&"number"===typeof U&&isFinite(U)&&(O=O&&parseFloat(O[M]),U=l.getNormalizedValue(U,I,O,S));N.push(U)});return N};a.getRangeExpr=function(y,D,E){D=null!=D?y+" \x3e\x3d "+D:"";y=null!=E?y+" \x3c\x3d "+E:"";E="";return(E=D&&y?q(D,y):D||y)?"("+E+")":""};a.getSQLFilterForNormalization=function(y){const D=
y.field,E=y.normalizationType;y=y.normalizationField;let A;if("field"===E)A="(NOT "+y+" \x3d 0)";else if("log"===E||"natural-log"===E||"square-root"===E)A=`(${D} > 0)`;return A};a.getSumOfAttributesExpr=function(y,D,E){const A=[],B=[],F=[],G=[],H=[];y.forEach((z,J)=>{const K=z.field?"field":"expression",I=z.field||z.valueExpression;z.field?(H.push(I),B.push(`var ${K}${J} = Number($feature["${I}"]);`)):(A.push(`function getValueForExpr${J}() {\n  ${I} \n}`),B.push(`var ${K}${J} = Number(getValueForExpr${J}());`));
E||F.push(`${K}${J} = IIf(${K}${J} < 0, 0, ${K}${J});`);G.push(`${K}${J}`)});y="return sum;";const L=A.length?null:H.reduce((z,J)=>`${z} + ${J}`);let C=null;D||E?D?E||(y="return IIf(sum \x3e\x3d 0, sum, null);",L&&(C=`(( ${L} ) >= 0)`)):(y="return IIf(sum !\x3d 0, sum, null);",L&&(C=`(( ${L} ) <> 0)`)):(y="return IIf(sum \x3e 0, sum, null);",L&&(C=`(( ${L} ) > 0)`));return{valueExpression:[A.length?A.join("\n"):"",B.join("\n"),F.join("\n"),`var sum = ${G.join(" + ")};`,y].filter(Boolean).join("\n\n"),
sqlExpression:L,sqlWhere:C}};a.mergeWhereClauses=q;a.quantizeFeatures=function(y,D,E,A){const B=f.isWrappable(E)?f.getInfo(E):null,F=B?Math.round((B.valid[1]-B.valid[0])/D.scale[0]):null;return y.map(G=>{const H=new x(G.geometry);d.quantizePoint(D,H,H,H.hasZ,H.hasM);if(B){var L=F??0,C=A[0];0>H.x?H.x+=L:H.x>C&&(H.x-=L)}G.geometry=H;return G})};a.timeOnlyToMilliseconds=w;a.verifyBasicFieldValidity=function(y,D,E){const A=v({layer:y,fields:D});if(A.length)return new h(E,"Unknown fields: "+A.join(", ")+
". You can only use fields defined in the layer schema");y=p({layer:y,fields:D});if(y.length)return new h(E,"Unsupported fields: "+y.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(y,D,E,A){let B;D?D.name!==y.objectIdField&&A.includes(D.type)||(B=new h(E,"'field' should be one of these types: "+A.join(","))):B=new h(E,"'field' is not defined in the layer schema");return B};a.verifyFilterValidty=function(y,
D){if(y&&"intersects"!==y.spatialRelationship)return new h(D,"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=function(y,D,E){let A;D?D.name!==y.objectIdField&&g.isNumericField(D)||(A=new h(E,"'field' should be one of these numeric types: "+g.numericTypes.join(","))):A=new h(E,"'field' is not defined in the layer schema");return A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),
function(a,b,h,c,k,m){function d(x){return String(x).padStart(2,"0")}function f(x,w,q){if("date"===w||"number"===w){"number"===w&&(x=new Date(x));w=q?x.getFullYear():x.getUTCFullYear();const v=d((q?x.getMonth():x.getUTCMonth())+1),p=d(q?x.getDate():x.getUTCDate()),t=d(q?x.getHours():x.getUTCHours()),r=d(q?x.getMinutes():x.getUTCMinutes());x=d(q?x.getSeconds():x.getUTCSeconds());x=`TIMESTAMP'${w}-${v}-${p} ${t}:${r}:${x}'`}return x}function g(x,w){if(w instanceof Date)return"date";if("number"===typeof w)return"number";
if("string"===typeof w&&(x=x.getField(w),"\x3cnow\x3e"!==w.toLowerCase()&&h.isDateField(x)))return"field"}const e={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},n={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},l=new Set(["integer","small-integer"]);let u=null;a.castIntegerFieldToFloat=function(x){return`cast(${x} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=e;a.fieldDelimiter=",";a.formatAnyDate=function(x,w){const {format:q,timeZoneOptions:v,fieldType:p}=w??{};let t;v&&({timeZone:r,timeZoneName:t}=m.getTimeZoneFormattingOptions(v.layerTimeZone,v.datesInUnknownTimezone,v.viewTimeZone,b.convertDateFormatToIntlOptions(q||"short-date-short-time"),p));if("string"===typeof x&&isNaN(Date.parse("time-only"===p?`1970-01-01T${x}Z`:x)))return x;switch(p){case "date-only":var r=b.convertDateFormatToIntlOptions(q||
"short-date");return"string"===typeof x?b.formatDateOnly(x,{...r}):b.formatDate(x,{...r,timeZone:m.utc});case "time-only":return r=b.convertDateFormatToIntlOptions(q||"short-time"),"string"===typeof x?b.formatTimeOnly(x,r):b.formatDate(x,{...r,timeZone:m.utc});case "timestamp-offset":if(!r&&"string"===typeof x&&(new Date(x)).toISOString()!==x)return x;r=(w=q||v?b.convertDateFormatToIntlOptions(q||"short-date-short-time"):void 0)?{...w,timeZone:r,timeZoneName:t}:void 0;return"string"===typeof x?b.formatTimestamp(x,
r):b.formatDate(x,r);default:return w=q||v?b.convertDateFormatToIntlOptions(q||"short-date-short-time"):void 0,b.formatDate("string"===typeof x?new Date(x):x,w?{...w,timeZone:r,timeZoneName:t}:void 0)}};a.getBasemapGroup=function(x,w=e){for(const q in w)if(w[q].includes(x))return q};a.getBasemapId=function(x,w,q=!0){let v=null;x&&("string"===typeof x?w.includes(x)&&(v=x):v=k.getWellKnownBasemapId(x));return q?v||"gray":v};a.getDateDiffSQL=function(x,w,q,v){const {hasQueryEngine:p}=x;q=f(q,g(x,q),
p);x=f(w,g(x,w),p);x=`(${q} - ${x})`;v=n[v];w="/";1>v&&(v=1/v,w="*");return{sqlExpression:1===v?x:`(${x} ${w} ${v})`,sqlWhere:null}};a.getDateType=g;a.getFieldsList=async function(x){const {field:w,field2:q,field3:v,normalizationField:p,valueExpression:t}=x;x=[];t&&(u||({arcadeUtils:x}=await c.loadArcade(),u=x),x=u.extractFieldNames(t));w&&x.push(w);q&&x.push(q);v&&x.push(v);p&&x.push(p);return x};a.getNormalizationType=function(x){let w=x.normalizationType;w||(x.normalizationField?w="field":null!=
x.normalizationTotal&&(w="percent-of-total"));return w??void 0};a.isAnyDateField=function(x){return h.isDateField(x)||h.isDateOnlyField(x)||h.isTimestampOffsetField(x)};a.isIntegerField=function(x,w){x=w&&x.getField(w);return!!x&&l.has(x.type)};a.unitValueInDays=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,h){function c(C){return null==
C||"string"===typeof C&&!C?"\x3cNull\x3e":C}function k(C){const z=null!=C.minValue||null!=C.maxValue,J=!!C.sqlExpression&&C.supportsSQLExpression;return!(null!=C.normalizationField||null!=C.normalizationType)&&!z&&!J}function m(C){const {values:z,useSampleStdDev:J,supportsNullCount:K}=C;var I=Number.POSITIVE_INFINITY;let M=Number.NEGATIVE_INFINITY,S=null,N=null;var V=null;let Q=null,T=0;const ia=null==C.minValue?-Infinity:C.minValue,O=null==C.maxValue?Infinity:C.maxValue;for(const U of z)Number.isFinite(U)?
U>=ia&&U<=O&&(S=null===S?U:S+U,I=Math.min(I,U),M=Math.max(M,U),T++):"string"===typeof U&&T++;if(T&&null!=S){N=S/T;V=0;for(const U of z)Number.isFinite(U)&&U>=ia&&U<=O&&(V+=(U-N)**2);Q=J?1<T?V/(T-1):0:0<T?V/T:0;V=Math.sqrt(Q)}else M=I=null;I={avg:N,count:T,max:M,min:I,stddev:V,sum:S,variance:Q};K&&(I.nullcount=z.length-T);C.percentileParams&&(I.median=d(z,C.percentileParams));return I}function d(C,z){const {fieldType:J,value:K,orderBy:I,isDiscrete:M}=z,S=f(J,"desc"===I);C=[...C].filter(T=>null!=T).sort((T,
ia)=>S(T,ia));if(0===C.length)return null;if(0>=K)return C[0];if(1<=K)return C[C.length-1];var N=(C.length-1)*K,V=Math.floor(N);z=V+1;N%=1;V=C[V];const Q=C[z];return z>=C.length||M||"string"===typeof V||"string"===typeof Q?V:V*(1-N)+Q*N}function f(C,z){if(C){if(t.has(C))return z?H:L;if(r.has(C))return g(z,!1);if("esriFieldTypeTimestampOffset"===C)return z?B:A;const M=g(z,!0);if("esriFieldTypeString"===C)return M;if("esriFieldTypeGUID"===C||"esriFieldTypeGlobalID"===C)return(S,N)=>M(e(S),e(N))}const J=
z?1:-1,K=z?H:L,I=g(z,!0);return(M,S)=>"number"===typeof M&&"number"===typeof S?K(M,S):"string"===typeof M&&"string"===typeof S?I(M,S):J}function g(C,z){if(!z)return C?G:F;const J=C?D:E;return C?(K,I)=>{const M=J(K,I);if(null!=M)return M;K=K.toUpperCase();I=I.toUpperCase();return K>I?-1:K<I?1:0}:(K,I)=>{const M=J(K,I);if(null!=M)return M;K=K.toUpperCase();I=I.toUpperCase();return K<I?-1:K>I?1:0}}function e(C){return C.substr(24,12)+C.substr(19,4)+C.substr(16,2)+C.substr(14,2)+C.substr(11,2)+C.substr(9,
2)+C.substr(6,2)+C.substr(4,2)+C.substr(2,2)+C.substr(0,2)}function n(C){return"coded-value"!==C?.type?[]:C.codedValues.map(z=>z.code)}function l(C,z){const J=x({field:z.field,normalizationType:z.normalizationType,normalizationField:z.normalizationField,classificationMethod:z.classificationMethod,standardDeviationInterval:z.standardDeviationInterval,breakCount:z.numClasses||5});C=u(C,z.minValue,z.maxValue);return h.createGenerateRendererClassBreaks({definition:J,values:C,normalizationTotal:z.normalizationTotal})}
function u(C,z,J){const K=null==z?-Infinity:z,I=null==J?Infinity:J;return C.filter(M=>Number.isFinite(M)&&M>=K&&M<=I)}function x(C){const {breakCount:z,field:J,normalizationField:K,normalizationType:I}=C,M=C.classificationMethod||"equal-interval";return new b({breakCount:z,classificationField:J,classificationMethod:M,normalizationField:"field"===I?K:void 0,normalizationType:I,standardDeviationInterval:"standard-deviation"===M?C.standardDeviationInterval||1:void 0})}function w(C,z){const {field:J,
classificationMethod:K,standardDeviationInterval:I,normalizationType:M,normalizationField:S,normalizationTotal:N,minValue:V,maxValue:Q}=z,T=z.numBins||10;let ia=z=null,O=null;K&&"equal-interval"!==K||M?({classBreaks:C}=l(C,{field:J,normalizationType:M,normalizationField:S,normalizationTotal:N,classificationMethod:K,standardDeviationInterval:I,minValue:V,maxValue:Q,numClasses:T}),z=C[0].minValue,ia=C[C.length-1].maxValue,O=C.map(U=>[U.minValue,U.maxValue])):(null!=V&&null!=Q?(z=V,ia=Q):(C=m({values:C,
minValue:V,maxValue:Q,useSampleStdDev:!M,supportsNullCount:k({normalizationType:M,normalizationField:S,minValue:V,maxValue:Q})}),z=C.min??null,ia=C.max??null),O=v(z??0,ia??0,T));return{min:z,max:ia,intervals:O}}function q(C,z){let J=-1;for(let K=C.length-1;0<=K;K--)if(z>=C[K][0]){J=K;break}return J}function v(C,z,J){const K=(z-C)/J,I=[];let M;for(let S=1;S<=J;S++)M=C+K,M=Number(M.toFixed(16)),I.push([C,S===J?z:M]),C=M;return I}const p=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,t=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
r=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),y="min max avg stddev count sum variance nullcount median".split(" "),D=(C,z)=>null==C?null==z?0:1:null==z?-1:null,E=(C,z)=>null==C?null==z?0:-1:null==z?1:null,A=(C,z)=>E(C,z)??(C===z?0:(new Date(C)).getTime()-(new Date(z)).getTime()),B=(C,z)=>D(C,z)??(C===z?0:(new Date(z)).getTime()-(new Date(C)).getTime()),F=(C,z)=>E(C,z)??(C===z?0:C<z?-1:1),G=(C,z)=>D(C,z)??(C===z?0:C<z?1:-1),H=(C,z)=>D(C,z)??z-C,L=(C,z)=>E(C,z)??C-z;a.calculateClassBreaks=
l;a.calculateHistogram=function(C,z){var J=w(C,z);if(null==J.min&&null==J.max)return{bins:[],minValue:J.min,maxValue:J.max,normalizationTotal:z.normalizationTotal};const K=J.intervals,I=J.min??0;J=J.max??0;const M=K.map((S,N)=>({minValue:K[N][0],maxValue:K[N][1],count:0}));for(const S of C)null!=S&&S>=I&&S<=J&&(C=q(K,S),-1<C&&M[C].count++);return{bins:M,minValue:I,maxValue:J,normalizationTotal:z.normalizationTotal}};a.calculatePercentile=d;a.calculateStatistics=m;a.calculateStringStatistics=function(C){const z=
C.returnDistinct?[...(new Set(C.values))]:C.values;var J=z.filter(I=>null!=I).sort();const K=J.length;J={count:K,min:J[0],max:J[K-1]};C.supportsNullCount&&(J.nullcount=z.length-K);C.percentileParams&&(J.median=d(z,C.percentileParams));return J};a.calculateUniqueValuesCount=function(C){const z={};for(let J of C){if(null==J||"string"===typeof J&&""===J.trim())J=null;null==z[J]?z[J]={count:1,data:J}:z[J].count++}return{count:z}};a.createClassBreaksDefinition=x;a.createUVResult=function(C,z,J,K){C=C.count;
const I=[];if(J&&z){J=[];var M=n(z[0]);for(const S of M)if(z[1]){M=n(z[1]);for(const N of M)if(z[2]){M=n(z[2]);for(const V of M)J.push(`${c(S)}${K}${c(N)}${K}${c(V)}`)}else J.push(`${c(S)}${K}${c(N)}`)}else J.push(S);for(const S of J)C.hasOwnProperty(S)||(C[S]={data:S,count:0})}for(const S in C)z=C[S],I.push({value:z.data,count:z.count,label:z.label});return{uniqueValueInfos:I}};a.getAttributeComparator=f;a.getEqualIntervalBins=v;a.getNormalizedValue=function(C,z,J,K){let I=null;switch(z){case "log":0!==
C&&(I=Math.log(C)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(K)&&0!==K&&(I=C/K*100);break;case "field":Number.isFinite(J)&&0!==J&&(I=C/J);break;case "natural-log":0<C&&(I=Math.log(C));break;case "square-root":0<C&&(I=C**.5)}return I};a.isNullCountSupported=k;a.processNullValue=c;a.processSummaryStatisticsResult=function(C,z){let J;for(J in C)y.includes(J)&&(Number.isFinite(C[J])||(C[J]=null));if(!z)return C;["avg","stddev","variance"].forEach(K=>{null!=C[K]&&(C[K]=Math.ceil(C[K]??
0))});return C};a.resolveCBResult=function(C,z){let J=C.classBreaks;const K=J[0]?.minValue,I=J[J.length-1]?.maxValue,M="standard-deviation"===z;J=J.map(S=>{const N=S.label;S={minValue:S.minValue,maxValue:S.maxValue,label:N};if(M&&N){const V=N.match(p)?.map(Q=>+Q.trim())??[];2===V.length?(S.minStdDev=V[0],S.maxStdDev=V[1],0>V[0]&&0<V[1]&&(S.hasAvg=!0)):1===V.length&&(N.includes("\x3c")?(S.minStdDev=null,S.maxStdDev=V[0]):N.includes("\x3e")&&(S.minStdDev=V[0],S.maxStdDev=null))}return S});return{minValue:K,
maxValue:I,classBreakInfos:J,normalizationTotal:C.normalizationTotal}};a.statisticTypes=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,h,c,k,m,d,f,g){k=new b.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});b=new b.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});h=class extends h.JSONSupport{constructor(e){super(e);this.type="class-breaks-definition";this.normalizationType=
this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};a.__decorate([f.enumeration({classBreaksDef:"class-breaks-definition"})],h.prototype,"type",void 0);a.__decorate([c.property({json:{write:!0}})],h.prototype,"breakCount",void 0);
a.__decorate([c.property({json:{write:!0}})],h.prototype,"classificationField",void 0);a.__decorate([c.property({type:String,json:{read:k.read,write:k.write}})],h.prototype,"classificationMethod",void 0);a.__decorate([c.property({json:{write:!0}})],h.prototype,"normalizationField",void 0);a.__decorate([c.property({json:{read:b.read,write:b.write}})],h.prototype,"normalizationType",void 0);a.__decorate([c.property({value:null,json:{write:!0}})],h.prototype,"standardDeviationInterval",null);a.__decorate([c.property({value:null,
json:{write:!0}})],h.prototype,"definedInterval",null);return h=a.__decorate([g.subclass("esri.rest.support.ClassBreaksDefinition")],h)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function h(l){var u=l.definition;const {classificationMethod:x,normalizationType:w,definedInterval:q}=u;u=u.breakCount??1;const v=[];var p=l.values;if(0===p.length)return[];p=p.sort((A,B)=>A-B);var t=p[0],r=p[p.length-1];if("equal-interval"===x)if(p.length>=
u){p=(r-t)/u;l=t;for(var y=1;y<u;y++){var D=Number((t+y*p).toFixed(6));v.push({minValue:l,maxValue:D,label:c(l,D,w)});l=D}v.push({minValue:l,maxValue:r,label:c(l,r,w)})}else p.forEach(A=>{v.push({minValue:A,maxValue:A,label:c(A,A,w)})});else if("natural-breaks"===x){p=k(p);l=m(p.uniqueValues,l.valueFrequency||p.valueFrequency,u);for(y=1;y<u;y++)p.uniqueValues.length>y&&(D=Number(p.uniqueValues[l[y]].toFixed(6)),v.push({minValue:t,maxValue:D,label:c(t,D,w)}),t=D);v.push({minValue:t,maxValue:r,label:c(t,
r,w)})}else if("quantile"===x)if(p.length>=u&&t!==r){l=Math.ceil(p.length/u);y=0;for(D=1;D<u;D++){var E=l+y-1;E>p.length&&(E=p.length-1);0>E&&(E=0);v.push({minValue:t,maxValue:p[E],label:c(t,p[E],w)});t=p[E];y+=l;l=Math.ceil((p.length-y)/(u-D))}v.push({minValue:t,maxValue:r,label:c(t,r,w)})}else for(u=-1,r=0;r<p.length;r++)t=p[r],t!==u&&(u=t,v.push({minValue:u,maxValue:t,label:c(u,t,w)}),u=t);else if("standard-deviation"===x)if(l=g(p),y=e(p,l),0===y)v.push({minValue:p[0],maxValue:p[0],label:c(p[0],
p[0],w)});else{p=f(t,r,u,l,y)*y;y=0;for(D=u;1<=D;D--)E=Number((l-(D-.5)*p).toFixed(6)),v.push({minValue:t,maxValue:E,label:c(t,E,w)}),t=E,y++;D=Number((l+.5*p).toFixed(6));v.push({minValue:t,maxValue:D,label:c(t,D,w)});t=D;y++;for(E=1;E<=u;E++)D=y===2*u?r:Number((l+(E+.5)*p).toFixed(6)),v.push({minValue:t,maxValue:D,label:c(t,D,w)}),t=D,y++}else if("defined-interval"===x){if(!q)return v;u=p[0];r=p[p.length-1];p=Math.ceil((r-u)/q);t=u;for(l=1;l<p;l++)y=Number((u+l*q).toFixed(6)),v.push({minValue:t,
maxValue:y,label:c(t,y,w)}),t=y;v.push({minValue:t,maxValue:r,label:c(t,r,w)})}return v}function c(l,u,x){let w=null;return w=l===u?x&&"percent-of-total"===x?l+"%":l.toString():x&&"percent-of-total"===x?l+"% - "+u+"%":l+" - "+u}function k(l){const u=[],x=[];let w=Number.MIN_VALUE,q=1,v=-1;for(let p=0;p<l.length;p++){const t=l[p];t===w?(q++,x[v]=q):null!==t&&(u.push(t),w=t,q=1,x.push(q),v++)}return{uniqueValues:u,valueFrequency:x}}function m(l,u,x){var w=l.length;const q=[];x>w&&(x=w);for(var v=0;v<
x;v++)q.push(Math.round(v*w/x-1));q.push(w-1);v=d(q,l,u,x);w=v.mean;v=v.sdcm;var p=x,t=0,r=0;let y=0,D=0,E=!0;for(let B=0;2>B&&E;B++){0===B&&(E=!1);for(var A=0;A<p-1;A++)for(;q[A+1]+1!==q[A+2];)if(q[A+1]+=1,t=n(A,q,l,u),y=t.sbMean,t=t.sbSdcm,r=n(A+1,q,l,u),D=r.sbMean,r=r.sbSdcm,t+r<v[A]+v[A+1])v[A]=t,v[A+1]=r,w[A]=y,w[A+1]=D,E=!0;else{--q[A+1];break}for(A=p-1;0<A;A--)for(;q[A]!==q[A-1]+1;)if(--q[A],t=n(A-1,q,l,u),y=t.sbMean,t=t.sbSdcm,r=n(A,q,l,u),D=r.sbMean,r=r.sbSdcm,t+r<v[A-1]+v[A])v[A-1]=t,v[A]=
r,w[A-1]=y,w[A]=D,E=!0;else{q[A]+=1;break}}E&&(v=d(q,l,u,x));return q}function d(l,u,x,w){let q=[];var v=[],p=[];let t=0;const r=[],y=[];for(var D=0;D<w;D++){var E=n(D,l,u,x);r.push(E.sbMean);y.push(E.sbSdcm);t+=y[D]}E=t;for(D=!0;D||t<E;){D=!1;q=[];for(v=0;v<w;v++)q.push(l[v]);for(p=0;p<w;p++)for(E=l[p]+1;E<=l[p+1];E++)if(v=u[E],0<p&&E!==l[p+1]&&Math.abs(v-r[p])>Math.abs(v-r[p-1]))l[p]=E;else if(p<w-1&&l[p]!==E-1&&Math.abs(v-r[p])>Math.abs(v-r[p+1])){l[p+1]=E-1;break}E=t;t=0;v=[];p=[];for(let A=0;A<
w;A++){v.push(r[A]);p.push(y[A]);const B=n(A,l,u,x);r[A]=B.sbMean;y[A]=B.sbSdcm;t+=y[A]}}if(t>E){for(u=0;u<w;u++)l[u]=q[u],r[u]=v[u],y[u]=p[u];t=E}return{mean:r,sdcm:y}}function f(l,u,x,w,q){l=Math.max(w-l,u-w)/q/x;return 1<=l?1:.5<=l?.5:.25}function g(l){let u=0;for(let x=0;x<l.length;x++)u+=l[x];return u/=l.length}function e(l,u){let x=0;for(let w=0;w<l.length;w++){const q=l[w];x+=(q-u)*(q-u)}x/=l.length;return Math.sqrt(x)}function n(l,u,x,w){var q=0,v=0;for(var p=u[l]+1;p<=u[l+1];p++){const t=
w[p];q+=x[p]*t;v+=t}0>=v&&b.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");q/=v;v=0;for(p=u[l]+1;p<=u[l+1];p++)v+=w[p]*(x[p]-q)**2;return{sbMean:q,sbSdcm:v}}a.createGenerateRendererClassBreaks=function(l){const {normalizationTotal:u}=l;return{classBreaks:h(l),normalizationTotal:u}};a.createGenerateRendererUniqueValues=function(l){l=k(l);const u=[],x=l.uniqueValues.length;for(let w=0;w<x;w++){const q=l.uniqueValues[w];u.push({value:q,count:l.valueFrequency[w],
label:q.toString()})}return{uniqueValues:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),function(a,b,h,c,k,m,d,f,g,e){async function n(v,
p,t){if(!v)return null;var {where:r}=v;v.where=r=r?.trim();if(!r||/^1 *= *1$/.test(r)||p&&p===r)v.where=null;if(!v.geometry)return v;p=await u(v);v.distance=0;v.units=null;"esriSpatialRelEnvelopeIntersects"===v.spatialRel&&({spatialReference:r}=v.geometry,p=m.getGeometryExtent(p),p.spatialReference=r);if(p){await e.checkProjectionSupport(p.spatialReference,t);r=p.spatialReference;p=l(p,t)&&d.isExtent(p)?{spatialReference:r,rings:[[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,
p.ymin]]]}:p;r=(await f.normalizeCentralMeridian(d.fromJSON(p)))[0];if(null==r)throw q;const y="quantizationParameters"in v&&v.quantizationParameters?.tolerance||"maxAllowableOffset"in v&&v.maxAllowableOffset||0;p=y&&l(p,t)?{densificationStep:8*y}:void 0;r=r.toJSON();p=e.project(r,r.spatialReference,t,p);if(!p)throw q;p.spatialReference=t;v.geometry=p}return v}function l(v,p){if(!v)return!1;const t=v.spatialReference;return(d.isExtent(v)||d.isPolygon(v)||d.isPolyline(v))&&!g.equals(t,p)&&!k.canProjectWithoutEngine(t,
p)}async function u(v){const {distance:p,units:t}=v,r=v.geometry;if(null==p||"vertexAttributes"in r)return r;var y=r.spatialReference;v=t?w.fromJSON(t):c.getUnitString(y);y=y&&(g.isGeographic(y)||g.isWebMercator(y))?r:await e.checkProjectionSupport(y,g.wgs84).then(()=>e.project(r,g.wgs84));return(await x())(y.spatialReference,y,p,v)}async function x(){return(await new Promise((v,p)=>a(["../../../geometry/geometryEngineJSON"],v,p))).geodesicBuffer}const w=new h.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),q=Object.freeze({});b.normalizeQuery=async function(v,p,t){const {outFields:r,orderByFields:y,groupByFieldsForStatistics:D,outStatistics:E}=v;if(r)for(var A=0;A<r.length;A++)r[A]=r[A].trim();if(y)for(A=0;A<y.length;A++)y[A]=y[A].trim();if(D)for(A=0;A<D.length;A++)D[A]=D[A].trim();if(E)for(A=0;A<E.length;A++)E[A].onStatisticField&&(E[A].onStatisticField=E[A].onStatisticField.trim());
v.geometry&&!v.outSR&&(v.outSR=v.geometry.spatialReference);return n(v,p,t)};b.normalizeQueryLike=n;b.queryEngineEmptyResult=q;b.unitsKebabDict=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),function(a,b,h,c,k,m){function d(l,u,x){const {outFields:w,orderByFields:q,returnDistinctValues:v,
outStatistics:p}=x,t=p?p.map(r=>r.outStatisticFieldName&&r.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(q&&0<q.length){const r=q.map(y=>{const D=y.toLowerCase();return D.includes(" asc")?D.split(" asc")[0]:D.includes(" desc")?D.split(" desc")[0]:y}).filter(y=>!t.includes(y));h.validateFields(l,u,r,{expressionName:"orderByFields",query:x})}if(w&&0<w.length)h.validateFields(l,u,w,{expressionName:"outFields",query:x,allowedFieldTypes:"all"});else if(v)throw new b("unsupported-query","outFields should be specified for returnDistinctValues",
{query:x});h.validateWhere(l,u,x.where,x)}function f(l,u,x){const {outStatistics:w,groupByFieldsForStatistics:q,having:v}=x;var p=q?.length,t=w?.length;if(v){if(!p||!t)throw new b("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:x});h.validateHaving(l,u,v,w,x)}if(t&&e(w)){t=w.map(r=>r.onStatisticField).filter(Boolean);h.validateFields(l,u,t,{expressionName:"onStatisticFields",query:x});p&&h.validateFields(l,u,q,{expressionName:"groupByFieldsForStatistics",
query:x});for(const r of w){const {onStatisticField:y,statisticType:D}=r;if(("percentile_disc"===D||"percentile_cont"===D)&&"statisticParameters"in r){if({statisticParameters:p}=r,!p)throw new b("unsupported-query","statisticParameters should be set for percentile type",{definition:r,query:x});}else l.get(y)&&"count"!==D&&"min"!==D&&"max"!==D&&h.validateFields(l,u,[y],{expressionName:`outStatistics with '${D}' statistic type`,allowedFieldTypes:n,query:x})}}}async function g(l,u,x,w){var q=[];x.valueExpression&&
({arcadeUtils:q}=await m.loadArcade(),q=q.extractFieldNames(x.valueExpression));x.field&&q.push(x.field);x.field2&&q.push(x.field2);x.field3&&q.push(x.field3);x.normalizationField&&q.push(x.normalizationField);if(!q.length&&!x.valueExpression)throw new b("unsupported-query","field or valueExpression is required",{params:x});h.validateFields(l,u,q,{expressionName:"statistics",query:w})}function e(l){return null!=l&&l.every(u=>"exceedslimit"!==u.statisticType)}const n=new Set([...h.numericFieldTypes,
...h.allDateAndTimeFieldTypes]);a.validateQuery=async function(l,{fieldsIndex:u,geometryType:x,spatialReference:w,availableFields:q}){if(0>(l.distance??0)||null!=l.geometryPrecision||l.multipatchOption&&"xyFootprint"!==l.multipatchOption||l.pixelSize||l.relationParam||l.text)throw new b("unsupported-query","Unsupported query options",{query:l});d(u,q,l);f(u,q,l);return Promise.all([k.checkSpatialQuerySupport(l,x,w),c.checkProjectionSupport(w,l.outSR)]).then(()=>l)};a.validateStatisticsQuery=async function(l,
u,{fieldsIndex:x,geometryType:w,spatialReference:q,availableFields:v}){if(0>(l.distance??0)||null!=l.geometryPrecision||l.multipatchOption||l.pixelSize||l.relationParam||l.text||l.outStatistics||l.groupByFieldsForStatistics||l.having||l.orderByFields)throw new b("unsupported-query","Unsupported query options",{query:l});d(x,v,l);return Promise.all([g(x,v,u,l),k.checkSpatialQuerySupport(l,w,q),c.checkProjectionSupport(q,l.outSR)]).then(()=>l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,b,h,c,k,m,d,f,g,e,n,l){function u(){return new Promise((p,t)=>a(["../../../geometry/geometryEngineJSON"],p,t))}const x={esriSpatialRelIntersects:"intersects",
esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var w={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,
esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},q={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},v={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=function(p){if(m.isExtent(p))return!0;if(m.isPolygon(p)){for(const t of p.rings)if(5!==t.length||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==
t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(p,t,r){const {spatialRel:y,geometry:D}=p;if(D){if(null==y||!0!==w[y])throw new h("unsupported-query","Unsupported query spatial relationship",{query:p});if(d.isValid(D.spatialReference)&&d.isValid(r)){if(null==D||!0!==q[m.getJsonType(D)])throw new h("unsupported-query","Unsupported query geometry type",{query:p});if(null==t||!0!==v[t])throw new h("unsupported-query","Unsupported layer geometry type",{query:p});
if(p.outSR)return l.checkProjectionSupport(p.geometry?.spatialReference,p.outSR)}}};b.getSpatialQueryOperator=function(p,t,r,y,D){if(m.isPolygon(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===p||"esriSpatialRelContains"===p)){const E=g.convertFromPolygon(new e,t,!1,!1);return Promise.resolve(A=>f.polygonContainsPoint(E,!1,!1,A))}if(m.isPolygon(t)&&"esriGeometryMultipoint"===r){const E=g.convertFromPolygon(new e,t,!1,!1);if("esriSpatialRelContains"===p)return Promise.resolve(A=>f.polygonContainsMultipoint(E,
!1,!1,A,y,D))}if(m.isExtent(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===p||"esriSpatialRelContains"===p))return Promise.resolve(E=>c.extentContainsPoint(t,n.getGeometry(r,y,D,E)));if(m.isExtent(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===p)return Promise.resolve(E=>c.extentContainsMultipoint(t,n.getGeometry(r,y,D,E)));if(m.isExtent(t)&&"esriSpatialRelIntersects"===p){const E=k.getExtentIntersector(r);return Promise.resolve(A=>E(t,n.getGeometry(r,y,D,A)))}return u().then(E=>
{const A=E[x[p]].bind(null,t.spatialReference,t);return B=>A(n.getGeometry(r,y,D,B))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;
a.extentIntersectsRings=b.extentIntersectsRings;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(h){return"mesh"===h?b.extentIntersectsExtent:b.getFeatureExtentIntersector(h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(h,c,k,m,d){if(!h)return!1;c=c?k?4:3:k?3:2;const {coords:f,
lengths:g}=h;k=!1;h=0;for(const n of g){var e=h;for(let l=h,u=h+n*c;l<u;l+=c){e=l+c;e===u&&(e=h);const x=f[l],w=f[l+1],q=f[e];e=f[e+1];(w<d&&e>=d||e<d&&w>=d)&&x+(d-w)/(e-w)*(q-x)<m&&(k=!k)}h+=n*c}return k}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(h,c,k,m,d,f){d=d?f?4:3:f?3:2;const {coords:g,lengths:e}=m;if(!e)return!1;for(let n=0,l=0;n<e.length;n++,l+=d)if(!b(h,c,k,g[l],g[l+1]))return!1;return!0};a.polygonContainsPoint=function(h,c,k,m){return b(h,c,k,m.coords[0],m.coords[1])};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(k,m,d,f,g){if(null!=f&&null!=g)return e=>{const n=k(e,m);e=k(e,d);return(null==n||n<=g)&&(null==e||e>=f)};if(null!=f)return e=>{e=k(e,d);return null==e||e>=f};if(null!=g)return e=>{e=k(e,m);return null==e||e<=g}}function h(k,m,d,f){if(null!=d&&null!=f&&d===f)return g=>k(g,m)===d;if(null!=d&&null!=f)return g=>{g=k(g,m);return null!=g&&g>=d&&g<=
f};if(null!=d)return g=>{g=k(g,m);return null!=g&&g>=d};if(null!=f)return g=>{g=k(g,m);return null!=g&&g<=f}}function c(){return()=>!1}a.getTimeExtent=async function(k,m){if(!k)return null;const d=m.featureAdapter,{startTimeField:f,endTimeField:g}=k;let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(f&&g)await m.forEach(l=>{const u=d.getAttribute(l,f);l=d.getAttribute(l,g);null==u||isNaN(u)||(e=Math.min(e,u));null==l||isNaN(l)||(n=Math.max(n,l))});else{const l=f||g;await m.forEach(u=>{u=
d.getAttribute(u,l);null==u||isNaN(u)||(e=Math.min(e,u),n=Math.max(n,u))})}return{start:e,end:n}};a.getTimeOperator=function(k,m,d){if(!m||!k)return null;const {startTimeField:f,endTimeField:g}=k;if(!f&&!g)return null;const {start:e,end:n}=m;if(null===e&&null===n)return null;if(void 0===e&&void 0===n)return c();k=d.getAttributeAsTimestamp?.bind(d)??d.getAttribute.bind(d);return f&&g?b(k,f,g,e,n):h(k,f||g,e,n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports",
"../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,b,h){const c={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(k,m,d){if(null==k||0===m.candidates.length)return c;var f=k.graphics3DGraphicsByObjectID??k.graphics3DGraphics,g=[];const e=[],{renderer:n}=k,l=null!=n&&"arcadeRequired"in n&&n.arcadeRequired?h.loadArcade():null;var u=async(p,{graphic:t,graphics3DSymbol:r})=>{const y=await l;t=await k.getRenderingInfoAsync(t,n,y,{signal:d});
return null==t?[]:r.queryForSnapping(p,w,t,d)};const {candidates:x,spatialReference:w}=m;for(m=0;m<x.length;++m){var q=x[m],{objectId:v}=q;v="number"===typeof v?f?.get(v):void 0;if(null==v)continue;const {graphics3DSymbol:p}=v;p.symbologySnappingSupported&&(g.push(u(q,v)),e.push(m))}if(0===g.length)return c;f=await Promise.all(g);b.throwIfAborted(d);g=[];u=[];for(m=0;m<f.length;++m){q=f[m];v=e[m];for(const p of q)g.push(p),u.push(v)}return{candidates:g,sourceCandidateIndices:u}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/byteSizeEstimations ../../../../core/handleUtils ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/Indices ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ../graphics/DisplayFeatureLimit ../graphics/GraphicsCorePerformanceInfo ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia){a.HeatmapFeatureProcessor=class extends h{constructor(O){super(O);this.type="heatmap";this.preferredUpdatePolicy=S.UpdatePolicy.ASYNC;this.dataExtent=null;this.drapeSourceType=B.DrapeSourceType.Features;this._renderGeometries=new Map;this._fieldTotal=0;this._drapeSourceRenderer=null;this._dataType=T.PixelType.HALF_FLOAT;this._pixelFormat=T.PixelFormat.RGBA;this._updatingHandles=new x.UpdatingHandles;this.initializePromise=
Promise.resolve()}initialize(){this._featureStore=new D({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:O,samplingMode:U,pixelFormat:P,internalFormat:R}=ia.loadHeatmapTextureConfiguration(this._renderView.renderingContext,d.getLogger(this));this._dataType=O;this._pixelFormat=P;const ba=O!==T.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,J.DrapedHeatmapRenderer,{...this._rendererParameters,dataType:O,samplingMode:U,
pixelFormat:P,internalFormat:R});this._material=new V.HeatmapDensityMaterial({usesHalfFloats:ba});this._materialWithField=new V.HeatmapDensityMaterial({usesHalfFloats:ba,isAttributeDriven:!0});this._filterVisibility=new H.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:X=>this._setAllFeaturesVisibility(X),clearFeaturesVisibility:()=>this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:X=>
this._updateFeatureVisibilities(X)}});this._updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,X=>this._onLoadedFeaturesChange(X),f.initial);this._updatingHandles.addWhen(()=>this._materialParameters,X=>this._forEachMaterial(da=>da.setParameters(X)),f.initial);this._updatingHandles.add(()=>this._rendererParameters,X=>this._drapeSourceRenderer.set(X));this._updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},f.sync);this._updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,
numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:X,numeric:da})=>{if(null!=X&&da){let ha=0;this._featureStore.forEach(fa=>ha+=fa.attributes[X]??0);this._fieldTotal=ha}else this._fieldTotal=this._featureStore.numFeatures},f.initial);this.addHandles([f.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:X,field:da})=>{X&&!da&&d.getLogger(this).warn(`Heatmap renderer field '${X}' for layer '${this.layer.title??this.layer.id}' not found`)}),f.watch(()=>
({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:X,numeric:da})=>{null==X||da||d.getLogger(this).warn(`Heatmap renderer field '${X.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),m.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])}destroy(){this._renderGeometries.clear();this._materialWithField=this._material=null;this._featureStore.clear();
this._featureStore=null;this._updatingHandles.destroy()}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this._updatingHandles.updating||this.filterVisibility.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get filterVisibility(){return this._filterVisibility}get displayFeatureLimit(){var O=this.owner?.view?.quality??1;const U=this.owner?.view?.qualitySettings;O=U?Math.ceil(U.heatmap.maxTotalNumberOfFeatures*
O):0;return new F.DisplayFeatureLimit(6*O,O)}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get view(){return this.owner.view}get fullOpacity(){return this.owner.fullOpacity}get updatePolicy(){return this.owner.updatePolicy}get scaleVisibilitySuspended(){if(!this._isScaleRangeActive)return!1;const {minScale:O,maxScale:U}=this.layer.effectiveScaleRange,{scale:P}=this.view;return!Q.scaleBoundsPredicate(P,O??0,U??0)}get usedMemory(){const O=
Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return O*O*(this._pixelFormat===T.PixelFormat.RED?1:4)*(this._dataType===T.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}get usedMemoryPerFeature(){var O=this._loadedPointGraphics.find(()=>!0);if(null==O)return 0;O=k.estimateAttributesObjectSize(O);const U=k.estimateNumberByteSize(),P=6*k.estimateFixedArraySize([0,0,0],U),R=6*k.estimateFixedArraySize([0,0],U);return P+R+(this._heatmapRendererFieldIsNumeric?
6*U:0)+O}get loadedFeatures(){return this._featureStore.numFeatures}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return new G.GraphicsCorePerformanceInfo(this._visibleFeatures,0,0)}get renderer(){return this._heatmapRenderer}get _overlayRenderer(){return this.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return this._overlayRenderer.spatialReference}get _rendererParameters(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,
...this._pixelRatioParameter}}get _materialParameters(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}get _densityParameters(){const O=this._heatmapRenderer;if(null==O)return null;const {minDensity:U,maxDensity:P}=O;return{minDensity:U,maxDensity:P,fieldTotal:this._fieldTotal}}get _radiusParameter(){const O=this._heatmapRenderer;return O?{searchRadius:g.pt2px(this._clampSearchRadius(O.radius))}:null}get _resolutionForScaleParameter(){var O=this._heatmapRenderer;if(!O)return null;
({referenceScale:O}=O);return{resolutionForScale:0===O?0:v.getResolutionForScale(O,this.view.spatialReference)}}get _colorRampParameter(){const O=this._heatmapRenderer;return O?{colorRampData:A.generateGradient(O.colorStops)}:null}get _pixelRatioParameter(){return{pixelRatio:this._densityMapPixelRatio}}get _densityMapPixelRatio(){return this.owner?.view?.qualitySettings.heatmap.pixelRatio??1}get _renderView(){return this.view._stage.renderView}get _featuresArePoints(){return"point"===this.layer.geometryType}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const O=
this.layer.renderer;return"heatmap"===O?.type?O:null}get _heatmapRendererFieldName(){return this._heatmapRenderer?.field}get _heatmapRendererField(){const O=this._heatmapRendererFieldName;return null!=O?this.layer.fieldsIndex.get(O):null}get _heatmapRendererFieldIsNumeric(){const O=this._heatmapRendererField;return null==O?!1:E.isNumericField(O)}get _isScaleRangeActive(){const {layer:O}=this;if(!("effectiveScaleRange"in O))return!1;const {minScale:U,maxScale:P}=O.effectiveScaleRange;return Q.isScaleRangeActive(U,
P)}get _visibleFeatures(){let O=0;this._renderGeometries.forEach(U=>{U.visible&&++O});return O}async whenGraphicBounds(){return null}computeAttachmentOrigin(){return null}highlight(){return m.makeHandle()}maskOccludee(){return m.makeHandle()}setObjectIdVisibility(){}refreshFilter(){this.filterVisibility.reapply()}_onLoadedFeaturesChange(O){if(this._featuresArePoints){var {objectIdField:U}=this.layer;this._featureStore.removeManyById(O.removed.map(R=>p.getObjectId(R,U)));this._featureStore.addMany(O.added.map(R=>
{const {attributes:ba,centroid:X,geometry:da}=R,ha=new r.OptimizedFeature(t.convertFromPoint(new y,da),ba,X?t.convertFromPoint(new y,X):null,p.getObjectId(R,U));ha.displayId=R.uid;return ha}));var P=O.added;O=O.removed;this._fieldTotal+=this._computeFieldTotalChange(P,O);O=O.map(({uid:R})=>{const ba=this._renderGeometries.get(R);this._renderGeometries.delete(R);return ba}).filter(c.isSome);P=P.map(R=>{const ba=this._pointGraphicToRenderGeometry(R);this._renderGeometries.set(R.uid,ba);return ba});
0<O.length&&this._drapeSourceRenderer.removeGeometries(O,I.DirtyOperation.REMOVE);0<P.length&&this._drapeSourceRenderer.addGeometries(P,I.DirtyOperation.ADD);if(0<P.length||0<O.length)this.filterVisibility.reapply(),this._renderView.requestRender()}}_recreate(){if(this._loadedPointGraphics){var O=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:O,removed:O})}}_pointGraphicToRenderGeometry(O){const U=this._heatmapRendererFieldName,P=null!=U?this._materialWithField:this._material;
var R=u.create();w.projectPointToVector(O.geometry,R,this._overlaySpatialReference);R[2]=L.drapedZ;const ba=q.getContinuousIndexArray(1);R=[[N.VertexAttribute.POSITION,new C.Attribute(R,ba,R.length)]];const X=this._heatmapRendererFieldIsNumeric;null!=U&&R.push([N.VertexAttribute.FEATUREATTRIBUTE,new C.Attribute([X?O.attributes[U]??0:0],ba,1)]);O=new M.RenderGeometry(new K.Geometry(P,R,null,z.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:O.uid});O.visible=this.filterVisibility.defaultVisibility;
return O}_forEachMaterial(O){O(this._material);O(this._materialWithField)}_computeFieldTotalChange(O,U){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return O.length-U.length;const P=this._heatmapRendererFieldName,R=(ba,X)=>ba+(X.attributes[P]??0);return O.reduce(R,0)-U.reduce(R,0)}_clampSearchRadius(O){112<O&&d.getLogger(this).warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(O,112)}_updateFeatureVisibilities(O){const U=
[];this._featureStore.forEach(({objectId:P,displayId:R})=>{P=O(P);(R=this._renderGeometries.get(R))&&R.visible!==P&&(U.push(R),R.visible=P)});this._drapeSourceRenderer.modifyGeometries(U,I.DirtyState.VISIBILITY)}_setAllFeaturesVisibility(O){const U=[];for(const P of this._renderGeometries.values())P.visible!==O&&(U.push(P),P.visible=O);this._drapeSourceRenderer.modifyGeometries(U,I.DirtyState.VISIBILITY)}get test(){return{visibleFeatureCount:this._visibleFeatures}}};b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"type",void 0);b.__decorate([e.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"suspendInfo",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"hasM",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"view",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",
null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_rendererParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);b.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",
null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_heatmapRendererFieldIsNumeric",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=b.__decorate([l.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);a.maxRadiusPt=112;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../core/arrayUtils ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./geometryUtils ./optimizedFeatureQueryEngineAdapter".split(" "),function(a,b,h,c,k,m,d,f,g,e){const n=k.create();class l{constructor(u){this.geometryInfo=u;this._boundsStore=new f.BoundsStore;this._featuresById=
new Map;this._markedIds=new Set;this.events=new h;this.featureAdapter=e.optimizedFeatureQueryEngineAdapter}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let u=0;this._featuresById.forEach(x=>{null!=x.geometry&&x.geometry.coords&&(u+=x.geometry.coords.length)});return{featureCount:this._featuresById.size,
vertexCount:u/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(u){if(null==this.fullBounds)return null;const [x,w,q,v]=this.fullBounds;return{xmin:x,ymin:w,xmax:q,ymax:v,spatialReference:g.cleanFromGeometryEngine(u)}}add(u){this._add(u);this._emitChanged()}addMany(u){for(const x of u)this._add(x);this._emitChanged()}upsertMany(u){u=u.map(x=>this._upsert(x));this._emitChanged();return u.filter(a.isSome)}clear(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()}removeById(u){u=
this._featuresById.get(u);if(!u)return null;this._remove(u);this._emitChanged();return u}removeManyById(u){this._boundsStore.invalidateIndex();for(const x of u)(u=this._featuresById.get(x))&&this._remove(u);this._emitChanged()}forEachBounds(u,x){for(const w of u)(u=this._boundsStore.get(w.objectId))&&x(k.fromRect(n,u))}getFeature(u){return this._featuresById.get(u)}has(u){return this._featuresById.has(u)}forEach(u){this._featuresById.forEach(x=>u(x))}forEachInBounds(u,x){this._boundsStore.forEachInBounds(u,
w=>{x(this._featuresById.get(w))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex();this._markedIds.clear()}sweep(){let u=!1;this._featuresById.forEach((x,w)=>{this._markedIds.has(w)||(u=!0,this._remove(x))});this._markedIds.clear();u&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(u){if(u){var x=u.objectId;if(null==x)c.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:u}));else{var w=
this._featuresById.get(x);this._markedIds.add(x);if(w){u.displayId=w.displayId;var q=this._boundsStore.get(x);this._boundsStore.delete(x)}else if(null!=this.onFeatureAdd)this.onFeatureAdd(u);u.geometry?.coords?.length?(q=d.getBoundsOptimizedGeometry(null!=q?q:m.create(),u.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=q&&this._boundsStore.set(x,q)):this._boundsStore.set(x,null);this._featuresById.set(x,u)}}}_upsert(u){const x=u?.objectId;if(null==x)return c.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature",
"feature id is missing",{feature:u})),null;const w=this._featuresById.get(x);if(!w)return this._add(u),u;this._markedIds.add(x);const {geometry:q,attributes:v}=u;for(const p in v)w.attributes[p]=v[p];q&&(w.geometry=q,this._boundsStore.set(x,d.getBoundsOptimizedGeometry(m.create(),q,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null));return w}_remove(u){if(null!=this.onFeatureRemove)this.onFeatureRemove(u);const x=u.objectId;this._markedIds.delete(x);this._boundsStore.delete(x);this._featuresById.delete(x);
return u}}return l})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,h,c){function k(f,g,e){m.minX=g[0];m.minY=g[1];m.maxX=g[2];m.maxY=g[3];f.search(m,e)}const m={minX:0,minY:0,maxX:0,maxY:0};class d{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new h.PooledRBush(9,b("esri-csp-restrictions")?
f=>({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const f=Array(this._idByBounds.size);let g=0;this._idByBounds.forEach((e,n)=>{f[g++]=n});this._indexInvalid=!1;this._index.clear();this._index.load(f)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(f=>this._idByBounds.has(f))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const f=c.empty();for(const g of this._boundsById.values())g&&
(f[0]=Math.min(g[0],f[0]),f[1]=Math.min(g[1],f[1]),f[2]=Math.max(g[2],f[2]),f[3]=Math.max(g[3],f[3]));return f}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(f){const g=this._boundsById.get(f);this._boundsById.delete(f);g&&(this._idByBounds.delete(g),this._indexInvalid||this._index.remove(g))}forEachInBounds(f,g){this._loadIndex();k(this._index,f,e=>g(this._idByBounds.get(e)))}get(f){return this._boundsById.get(f)}has(f){return this._boundsById.has(f)}invalidateIndex(){this._indexInvalid||
(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(f,g){if(!this._indexInvalid){const e=this._boundsById.get(f);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(f,g);g&&(this._idByBounds.set(g,f),this._indexInvalid||(this._boundsToLoad.push(g),5E4<this._boundsToLoad.length&&this._loadIndex()))}}a.BoundsStore=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p){a.DrapedHeatmapRenderer=class extends l.SortedRenderGeometryRenderer{constructor(t){super(t);this.pixelRatio=1;this._colorRampData=new Uint8ClampedArray(4);this.type="draped-heatmap";this._heatmapParameters=new u.HeatmapPassParameters;var r=new v.TextureDescriptor;r.pixelFormat=t.pixelFormat;r.internalFormat=t.internalFormat;r.dataType=t.dataType;r.samplingMode=t.samplingMode;r.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;const y=t.rendererContext.rctx;this._densityMap=
new w.FramebufferObject(y,r);this._quad=n.createQuadVAO(y);r=new u.HeatmapTechniqueConfiguration;r.usesHalfFloat=t.dataType!==x.PixelType.FLOAT;this._technique=new u.HeatmapTechnique({rctx:y,viewingMode:e.ViewingMode.Local},r)}initialize(){const t=this._colorRampData,r=new v.TextureDescriptor(t.length/4,1);r.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new q.Texture(this.rctx,r,t);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(c.watch(()=>[this.colorRampData,
this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))}destroy(){this._technique=h.releaseMaybe(this._technique);this._densityMap=h.disposeMaybe(this._densityMap);this._quad=h.disposeMaybe(this._quad);this._colorRamp=h.disposeMaybe(this._colorRamp)}get searchRadius(){return this._heatmapParameters.searchRadius}set searchRadius(t){t!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=t,this.notifyChange("searchRadius"))}get minDensity(){return this._heatmapParameters.minDensity}set minDensity(t){t!==
this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=t,this.notifyChange("minDensity"))}get maxDensity(){return this._heatmapParameters.maxDensity}set maxDensity(t){t!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=t,this.notifyChange("maxDensity"))}get fieldTotal(){return this._heatmapParameters.fieldTotal}set fieldTotal(t){this._heatmapParameters.fieldTotal=t;this.notifyChange("fieldTotal")}get colorRampData(){return this._colorRampData}set colorRampData(t){const {colorRamp:r}=
this._heatmapParameters;if(null!=r&&t!==this._colorRampData){const y=t.length/4;y!==r.descriptor.width&&r.resize(y,1);r.setData(t)}this._colorRampData=t}get _colorRamp(){return this._heatmapParameters.colorRamp}set _colorRamp(t){this._heatmapParameters.colorRamp=t}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccludedDraped(){return!1}render(t){const r=this._sortedMaterialRenderers;if(0!==r.length){var y=this.rctx.getBoundFramebufferObject(),D=this.rctx.getViewport(),{pixelRatio:E}=
this,A=Math.ceil(D.width*E);E=Math.ceil(D.height*E);this._densityMap.resize(A,E);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,A,E);this.rctx.clear(x.ClearBufferBit.COLOR_BUFFER_BIT);var B=!1;r.forAll(F=>{const G=F.prepareTechnique(t);null!=G&&(F.renderNode(t,G),B=!0)});this.rctx.bindFramebuffer(y);this.rctx.setViewport(D.x,D.y,D.width,D.height);B&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,t.bindParameters,this._heatmapParameters),this.rctx.drawArrays(this._technique.primitiveType,
0,p.vertexCount(this._quad,"geometry")))}}};b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,
"colorRampData",null);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",
void 0);a.DrapedHeatmapRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){class w extends c.NoParameters{constructor(){super(...arguments);this.densityMap=this.colorRamp=null;this.searchRadius=1;this.minDensity=this.fieldTotal=0;this.maxDensity=100}}class q extends m.ShaderTechnique{constructor(p,t){super(p,t,()=>this.destroy())}initializeProgram(p){return new e.Program(p.rctx,q.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return x.makePipelineState({blending:g.blendingDefault,colorWrite:x.defaultColorWriteParams,
depthTest:null,depthWrite:null})}get primitiveType(){return u.PrimitiveType.TRIANGLE_STRIP}}q.shader=new k.ReloadableShaderModule(l.HeatmapShader,()=>new Promise((p,t)=>a(["./Heatmap.glsl"],p,t)));class v extends n.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=!1}}h.__decorate([d.parameter()],v.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=w;b.HeatmapTechnique=q;b.HeatmapTechniqueConfiguration=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,h,c,k,m,d){function f(e){const n=new m.ShaderBuilder;
n.include(b.ScreenSpacePass);n.include(h.DiscardOrAdjustAlphaBlend);({usesHalfFloat:e}=e);n.fragment.uniforms.add(new d.Texture2DPassUniform("densityMap",l=>l.densityMap),new d.Texture2DPassUniform("tex",l=>l.colorRamp),new c.FloatPassUniform("densityNormalizer",l=>1/(l.maxDensity-l.minDensity)),new c.FloatPassUniform("minDensity",l=>l.minDensity),new c.FloatPassUniform("densityMultiplier",l=>3/(l.searchRadius*l.searchRadius*Math.PI)));e&&n.constants.add("compressionFactor","float",4);n.fragment.code.add(k.glsl`
    void main() {
      float density = texture(densityMap, uv).r * densityMultiplier${e?k.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      fragColor = color;
    }
  `);return n}const g=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=g;a.build=f})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l extends n.HeatmapDensityPassParameters{constructor(){super(...arguments);this.usesHalfFloats=this.isAttributeDriven=!1}}class u extends d.Material{constructor(t){super(t,new l);this.produces=new Map([[f.RenderSlot.DRAPED_MATERIAL,r=>r===k.ShaderOutput.Color]]);this._configuration=new n.HeatmapDensityTechniqueConfiguration}getConfiguration(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;
return this._configuration}createGLMaterial(t){return new x(t)}intersect(){}intersectDraped(t,r,y,D,E,A){r=t.attributes.get(g.VertexAttribute.POSITION);({parameters:y}=this);({searchRadius:y}=y);({screenToWorldRatio:t}=t);t=y*t+2*t;t*=t;y=r.data.length/r.size;for(let F=0;F<y;F++){var B=F*r.size;B=b.set(p,r.data[B],r.data[B+1]);b.squaredDistance(B,D)<t&&E(A.dist,A.normal,-1,!1)}}createBufferWriter(){return new w(this.parameters.isAttributeDriven?v:q)}}class x extends m{beginSlot(t){return this.ensureTechnique(n.HeatmapDensityTechnique,
t)}}class w{constructor(t){this.vertexBufferLayout=t}elementCount(t){return 6*t.attributes.get(g.VertexAttribute.POSITION).indices.length}write(t,r,y,D,E){e.writePosition(y.attributes.get(g.VertexAttribute.POSITION),t,D.position,E,6);t=y.attributes.get(g.VertexAttribute.POSITION).indices.length;r=D.uv0;let A=E;for(let B=0;B<t;++B)r.setValues(A++,-1,-1),r.setValues(A++,1,-1),r.setValues(A++,1,1),r.setValues(A++,1,1),r.setValues(A++,-1,1),r.setValues(A++,-1,-1);(D=g.VertexAttribute.FEATUREATTRIBUTE in
D?D.featureAttribute:null)&&e.writeBufferFloat(y.attributes.get(g.VertexAttribute.FEATUREATTRIBUTE),D,E,6)}}const q=c.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0),v=q.clone().f32(g.VertexAttribute.FEATUREATTRIBUTE),p=h.create();a.HeatmapDensityMaterial=u;a.HeatmapDensityMaterialParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){class x extends f.MaterialParameters{constructor(){super(...arguments);this.searchRadius=128;this.resolutionForScale=0}}class w extends k.ShaderTechnique{initializeProgram(v){return new g.Program(v.rctx,w.shader.get().build(this.configuration),d.Default3D)}initializePipeline(){return u.makePipelineState({blending:u.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendOperation.ADD),colorWrite:u.defaultColorWriteParams,depthTest:null,depthWrite:null})}destroy(){super.destroy()}}
w.shader=new c.ReloadableShaderModule(n.HeatmapDensity,()=>new Promise((v,p)=>a(["./HeatmapDensity.glsl"],v,p)));class q extends e.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=this.isAttributeDriven=!1}}h.__decorate([m.parameter()],q.prototype,"isAttributeDriven",void 0);h.__decorate([m.parameter()],q.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=x;b.HeatmapDensityTechnique=w;b.HeatmapDensityTechniqueConfiguration=q;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,h,c,k,m){function d(g){const e=new k.ShaderBuilder,{vertex:n,fragment:l,attributes:u,varyings:x}=
e;b.addProjViewLocalOrigin(n,g);const {isAttributeDriven:w,usesHalfFloat:q}=g;u.add(m.VertexAttribute.POSITION,"vec3");u.add(m.VertexAttribute.UV0,"vec2");w&&(u.add(m.VertexAttribute.FEATUREATTRIBUTE,"float"),x.add("attributeValue","float"));q&&e.constants.add("compressionFactor","float",.25);x.add("unitCirclePos","vec2");n.uniforms.add(new h.FloatPassUniform("radius",({resolutionForScale:v,searchRadius:p},{camera:t,screenToWorldRatio:r,overlayStretch:y})=>2*p*(0===v?1:v/r)*t.pixelRatio/t.fullViewport[2]/
y));n.code.add(c.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${m.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${w?c.glsl`attributeValue = ${m.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);l.code.add(c.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${w?c.glsl` * attributeValue`:""} ${q?c.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return e}const f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=f;a.build=d})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(a,b,h){class c{constructor(k,m,d,f){this.dataType=k;this.samplingMode=m;this.pixelFormat=d;this.internalFormat=f}}a.HeatmapTextureConfiguration=c;a.loadHeatmapTextureConfiguration=function(k,m){const {textureFloat:d,colorBufferFloat:f}=k.capabilities,
g=d?.textureFloat,e=d?.textureFloatLinear;var n=d?.textureHalfFloat;const l=d?.textureHalfFloatLinear,u=f?.textureFloat;var x=f?.textureHalfFloat;const w=f?.floatBlend;k=k.driverTest.floatBufferBlend.result;if(!g&&!n)throw new b("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!u&&!x)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");
if(!(w&&k||x))throw new b("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${k?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);n=n&&x;x=!!f?.R32F;const q=!!f?.R16F;if(g&&u&&w&&k&&(e||!l))return e||m.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new c(h.PixelType.FLOAT,e?h.TextureSamplingMode.LINEAR:h.TextureSamplingMode.NEAREST,x?h.PixelFormat.RED:
h.PixelFormat.RGBA,x?h.SizedPixelFormat.R32F:h.PixelFormat.RGBA);if(n)return l||m.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),new c(h.PixelType.HALF_FLOAT,l?h.TextureSamplingMode.LINEAR:h.TextureSamplingMode.NEAREST,q?h.PixelFormat.RED:h.PixelFormat.RGBA,q?h.SizedPixelFormat.R16F:h.PixelFormat.RGBA);throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,h){a.toViewIfLocal=function(c){const k=c.view.spatialReference,m=c.layer.fullExtent;var d=null!=m&&m.spatialReference;if(null==m||!d)return Promise.resolve(null);if(d.equals(k))return Promise.resolve(m.clone());d=b.project(m,k);return null!=d?Promise.resolve(d):
c.view.state.isLocal?h.projectGeometry(m,k,c.layer.portalItem).then(f=>!c.destroyed&&f?f:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,h,c){class k{constructor(m){this._capabilities=this._memoryCache=null;const d=m.layerView.layer;this._layerView=m.layerView;
this.objectIdField=d.objectIdField;this.globalIdField="globalIdField"in d?d.globalIdField:null;this._returnZ=m.returnZ;this._returnM=m.returnM;m=this._layerView.view.resourceController;this.query=c.createFeatureTileQuery3D(this._layerView,m.normal);m&&this._memoryCacheEnabled&&(this._memoryCache=m.memoryController.newCache(`fl-${d.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}destroy(){this._memoryCache=
b.destroyMaybe(this._memoryCache);this.query.destroy()}createQuery(){const m=this._layerView.layer.createQuery();m.outFields=this._layerView.availableFields;m.returnZ=this._returnZ;m.returnM=this._returnM;m.outSpatialReference=this.tilingScheme.spatialReference;return m}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){const m=this._layerView.view.resourceController;
return m?m.scheduler:null}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return null!=this._capabilities?this._capabilities:this._capabilities=h.contextCapabilitiesFromLayer(this._layerView.layer)}logFetchError(m,d){m.error("#fetchTile()",
this._layerView.layer,d?.message??d)}}a.FeatureTileFetcher3DLayerViewContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){let w=class extends h{constructor(t){super(t)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;const t=new Set(this.layerView.requiredFields),r=new Set(this.layerView.availableFields);return m.difference(r,t)}get queryFeaturesDehydrated(){const {layer:t}=this;var r=t.capabilities;r=r&&r.query;const y=t.parsedUrl;if(r&&r.supportsFormatPBF){null==this._decoder&&(this._decoder=new x.PBFDecoder(this.controller));const D={sourceSpatialReference:t.spatialReference?.toJSON()??
null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024};return(E,A)=>u.runQuery(y,E,"pbf",this._createRequestOptions(A)).then(B=>{k.throwIfAborted(A);return null!=this._decoder?this._decoder.invoke({buffer:B.data,options:D},A.signal):Promise.reject(k.createAbortError())})}return(D,E)=>u.executeQuery(y,D,t.spatialReference,this._createRequestOptions(E)).then(A=>l.fromFeatureSetJSON(A.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024}))}queryFeatureCount(t,
r){return this.layer.queryFeatureCount(t,r)}destroy(){this._decoder=c.destroyMaybe(this._decoder)}_createRequestOptions(t){return{...t,query:{...this.layer.customParameters,token:this.layer.apiKey,...t?.query}}}};b.__decorate([d.property({constructOnly:!0})],w.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],w.prototype,"layerView",void 0);b.__decorate([d.property({constructOnly:!0})],w.prototype,"controller",void 0);b.__decorate([d.property({readOnly:!0})],w.prototype,"implicitFields",
null);b.__decorate([d.property({readOnly:!0})],w.prototype,"queryFeaturesDehydrated",null);w=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],w);let q=class extends h{constructor(t){super(t)}queryFeaturesDehydrated(t,r){return this.layer.queryFeatures(t,r)}queryFeatureCount(t,r){return this.layer.queryFeatureCount(t,r)}};b.__decorate([d.property({constructOnly:!0})],q.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0})],q.prototype,
"queryFeaturesDehydrated",null);q=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],q);let v=class extends h{constructor(t){super(t)}queryFeaturesDehydrated(t,r){return this.layer.queryFeatures(t,r)}};b.__decorate([d.property({constructOnly:!0})],v.prototype,"layer",void 0);v=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],v);let p=class extends h{constructor(t){super(t)}queryFeaturesDehydrated(t,
r){return this.source.queryFeaturesJSON(t,r).then(l.fromFeatureSetJSON,y=>{if(y&&"query-features-json:unsupported"===y.name)return this.layer.queryFeatures(t,r);throw y;})}queryFeatureCount(t,r){return this.layer.queryFeatureCount(t,r)}};b.__decorate([d.property({constructOnly:!0})],p.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],p.prototype,"source",void 0);p=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],p);a.createFeatureTileQuery3D=
function(t,r){const {layer:y}=t;return"feature"===y.type&&"feature-layer"===y.source.type?null!=y.infoFor3D?new q({layer:y}):new w({layer:y,layerView:t,controller:r}):"feature"===y.type&&"memory"===y.source.type||"csv"===y.type||"geojson"===y.type||"oriented-imagery"===y.type||"wfs"===y.type?new p({layer:y,source:y.source}):"ogc-feature"===y.type?new v({layer:y}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,h,c,k,m){function d(e){switch(e.type){case "polyline":e.paths.reduce((n,l)=>n+l.length,0)<h.nativeArrayMaxSize&&(e.paths=e.hasZ||e.hasM?e.paths.map(n=>n.map(l=>[l[0],l[1],l[2]])):e.paths.map(n=>n.map(l=>[l[0],l[1]])));break;case "polygon":e.rings.reduce((n,l)=>n+l.length,0)<h.nativeArrayMaxSize&&(e.rings=e.hasZ||e.hasM?e.rings.map(n=>n.map(l=>[l[0],l[1],l[2]])):e.rings.map(n=>n.map(l=>[l[0],l[1]])))}}class f{constructor(e){this._controller=e;this._handle=new g(n=>e.schedule(n))}destroy(){this._handle.destroy()}invoke(e,
n){if(!e.buffer||0===e.buffer.byteLength)return Promise.resolve(null);e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof k&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()});return this._handle.invoke(e,n).then(l=>{let u=0,x=0;const w=k.fromJSON(l.spatialReference);l.spatialReference=w;const q=async v=>{var p=l.fields;if(p)for(;u<p.length;)if(p[u]=m.fromJSON(p[u]),u++,v.madeProgress())return this._controller.reschedule(r=>q(r));
for(p=l.features;x<p.length;){var t=p[x];++x;t.uid=b.generateUID();t=t.geometry;if(null!=t&&(t.spatialReference=w,d(t),v.madeProgress()))return this._controller.reschedule(r=>q(r))}return l};return this._controller.schedule(v=>q(v))})}}class g extends c.WorkerHandle{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:n=>[n.buffer]},e)}}a.PBFDecoder=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils","../../../core/signal"],function(a,b,h,c,k){class m extends b{constructor(){super(...arguments);this._set=new Set;this._length=k.signal(0)}clear(){if(0<this._set.size){const d=this.toArray();this._set.clear();this.emit("after-changes",{type:h.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:d})}}get length(){return this._length.value}addMany(d){if(0!==d.length){for(const f of d)this._set.add(f);
this._length.value=this._set.size;this.emit("after-changes",{type:h.ObservableChangesType.ADD});this.emit("change",{added:d,removed:[]})}}remove(d){this._set.delete(d)&&(this._length.value=this._set.size,this.emit("after-changes",{type:h.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[d]}))}removeMany(d){const f=[];for(const g of d)this._set.delete(g)&&f.push(g);0<f.length&&(this._length.value=this._set.size,this.emit("after-changes",{type:h.ObservableChangesType.REMOVE}),this.emit("change",
{added:[],removed:f}))}toArray(){return[...this._set]}find(d){let f;c.someSet(this._set,g=>d(g)?(f=g,!0):!1);return f}forEach(d){this._set.forEach(f=>d(f))}}a.EventedSet=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v){return p=>{p=class extends p{constructor(...t){super(...t);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([k.watch(()=>{const t=this.layer;return[t&&"elevationInfo"in t?t.elevationInfo?.featureExpressionInfo:null,t&&"displayField"in t?t.displayField:null,t&&"timeInfo"in t&&t.timeInfo,t&&"renderer"in t&&t.renderer,t&&"labelingInfo"in
t&&t.labelingInfo,t&&"floorInfo"in t&&t.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),k.syncAndInitial),k.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),k.on(()=>{const t=this.layer;return t&&"sublayers"in t?t.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:t,layer:{fieldsIndex:r},requiredFields:y}=this;return"outFields"in t&&t.outFields?u.fixFields(r,
[...u.unpackFieldNames(r,t.outFields),...y]):u.fixFields(r,y)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(t){this._override("featureEffect",t)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(t){h.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(t){throw Error("missing implementation");}createQuery(){var t=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};t=null!=this.filter?this.filter.createQuery(t):new w(t);if("feature"===this.layer.type){const r=x.getFloorFilterClause(this);null!=r&&(t.where=t.where?`(${t.where}) AND (${r})`:r)}null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return t}createAggregateQuery(){return new w({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(t,
r){throw Error("missing implementation");}queryObjectIds(t,r){throw Error("missing implementation");}queryFeatureCount(t,r){throw Error("missing implementation");}queryExtent(t,r){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(t,r){this._validateFetchPopupFeatures(t,r);return this._fetchPopupFeatures(t,r)}_loadArcadeModules(t){return t.expressionInfos?.length||Array.isArray(t.content)&&t.content.some(r=>"expression"===r.type)?q.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const t=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t);t.then(()=>{this._updatingRequiredFieldsPromise===t&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var t="3d"===this.view.type,{layer:r,layer:{fieldsIndex:y,objectIdField:D}}=this,E="renderer"in r&&r.renderer,A="orderBy"in r&&r.orderBy,B="featureReduction"in r?r.featureReduction:null,F=new Set;E=await Promise.allSettled([E?E.collectRequiredFields(F,y):null,u.collectLabelingFields(F,
r),t&&"elevationInfo"in r?u.collectElevationFields(F,r):null,null!=this.filter?u.collectFilterFields(F,r,this.filter):null,t||null==this.featureEffect?null:u.collectFilterFields(F,r,this.featureEffect.filter),!t&&B?u.collectFeatureReductionFields(F,r,B):null,!t&&A?u.collectOrderByInfos(F,r,A):null]);"timeInfo"in r&&r.timeInfo&&this.timeExtent&&u.collectFields(F,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]);"feature"===r.type&&(r.floorInfo&&u.collectFields(F,r.fieldsIndex,[r.floorInfo.floorField]),
t&&null!=r.infoFor3D&&(null==r.globalIdField&&h.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),u.collectFields(F,r.fieldsIndex,[r.globalIdField])));"subtype-group"===r.type&&(u.collectField(F,y,r.subtypeField),A=r.sublayers.map(G=>Promise.all([G.renderer?.collectRequiredFields(F,y),u.collectLabelingFields(F,G)])),await Promise.allSettled(A));"catalog-footprint"===r.type&&u.collectFields(F,y,[r.parent.itemSourceField,r.parent.itemTypeField]);for(const G of E)"rejected"===G.status&&
h.getLogger(this).error(G.reason);u.collectField(F,y,D);t&&"displayField"in r&&r.displayField&&u.collectField(F,y,r.displayField);t=Array.from(F).sort();this._set("requiredFields",t)}}_validateFetchPopupFeatures(t,r){if(null!=r)for(const y of t){t=y.origin&&"layer"in y.origin?y.origin.layer:y.layer;if("popupEnabled"in t&&!t.popupEnabled)throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t});if(y.isAggregate){const D="featureReduction"in t?t.featureReduction:null;if(!(D&&
"popupTemplate"in D&&D.popupEnabled&&D.popupTemplate))throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t});}else if("popupTemplate"in t&&!v.getFetchPopupTemplate(t,r))throw new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t});}}_popupFeatureHasRequiredFields(t,r){return u.featureHasFields(r,t)}async _fetchPopupFeatures(t,r){const y=Array(t.length),D=new Map,E=await this._createPopupQuery(t.map(B=>B.origin?.layer??B.layer),r);
for(let B=0;B<t.length;B++){const F=t[B];if(F.isAggregate){y[B]=F;continue}var A=F.origin?.layer??F.layer;if(!(A&&"popupEnabled"in A))continue;const G=u.unpackFieldNames(this.layer.fieldsIndex,E.outFields);A=v.getFetchPopupTemplate(A,r);if(null==A)continue;const H=await this._loadArcadeModules(A);c.throwIfAborted(r);H&&H.arcadeUtils.hasGeometryOperations(A)||!this._popupFeatureHasRequiredFields(F,G)?D.set(F.getObjectId(),{graphic:F,index:B}):y[B]=F}if("stream"===this.layer.type||0===D.size)return y.filter(Boolean);
E.objectIds=Array.from(D.keys());try{const B=await this.layer.queryFeatures(E,r);for(const F of B.features){const {graphic:{geometry:G,origin:H},index:L}=D.get(F.getObjectId());let C;(C=F).geometry||(C.geometry=G);F.origin=H;y[L]=F}}catch{}return y.filter(Boolean)}async _createPopupQuery(t,r){const y=this.layer.createQuery(),D=new Set;var E=!1;t=t??[this.layer];for(const A of t)if("popupEnabled"in A&&(t=v.getFetchPopupTemplate(A,r),null!=t)){E=await this._loadArcadeModules(t);c.throwIfAborted(r);
E=E&&E.arcadeUtils.hasGeometryOperations(t);E=!("point"!==this.layer.geometryType&&!E);t=await v.getRequiredFields(this.layer,t);c.throwIfAborted(r);for(const B of t)D.add(B)}y.returnGeometry=E;y.returnZ=E;y.returnM=E;y.outFields=Array.from(D);y.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(r=x.getFloorFilterClause(this),null!=r&&(y.where=y.where?`(${y.where}) AND (${r})`:r));return y}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?
!1:!0}getTest(){return{createPopupQuery:t=>this._createPopupQuery(void 0,t)}}get test(){return this.getTest()}};a.__decorate([m.property()],p.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([m.property({readOnly:!0})],p.prototype,"availableFields",null);a.__decorate([m.property({readOnly:!0})],p.prototype,"dataUpdating",void 0);a.__decorate([m.property({type:n})],p.prototype,"featureEffect",null);a.__decorate([m.property({type:l})],p.prototype,"filter",void 0);a.__decorate([m.property(e.combinedViewLayerTimeExtentProperty)],
p.prototype,"timeExtent",void 0);a.__decorate([m.property()],p.prototype,"layer",void 0);a.__decorate([m.property({type:Number})],p.prototype,"maximumNumberOfFeatures",null);a.__decorate([m.property({readOnly:!0,type:Boolean})],p.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([m.property({readOnly:!0})],p.prototype,"requiredFields",void 0);a.__decorate([m.property()],p.prototype,"suspended",void 0);a.__decorate([m.property()],p.prototype,"view",void 0);return p=a.__decorate([g.subclass("esri.views.layers.FeatureLayerView")],
p)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d,f){return g=>{g=class extends g{initialize(){this.addHandles(c.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(n=>{h.isAbortError(n)||b.getLogger(this).error(n)})}),"RefreshableLayerView")}};
return g=a.__decorate([f.subclass("esri.layers.mixins.RefreshableLayerView")],g)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedPoint ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudLayerViewPerformanceInfo ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/hitTest ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha){function fa(ea){return ca=>ea.immediate.schedule(ca)}const aa=y.create();x=class extends ia.PopupSceneLayerView(z.LayerView3D(X)){constructor(){super(...arguments);this.type="point-cloud-3d";this.maximumPointCount=4E6;this.slicePlaneEnabled=!1;this._renderer=null;this._rendererAdded=!1;this._renderedNodes=new Set;this._nodeScales=new Map;this._updateViewNeeded=!0;this._lodFactor=1;this._maxLoggedBoxWarnings=
5;this._pageMultiplier=1;this._nodeLoadEpoch=0;this._indexQueue=[];this._workQueue=[];this._idleQueue=new L.PromiseQueue;this._indexPagesLoading=new Map;this._loadingNodes=new Map;this._recalcWork=!0;this._layerIsVisible=!1;this._codedDomainPopulationAbortController=this._codedDomainPopulationPromise=null;this._totalWork=0;this._index=null;this._loadingInitNodePage=!1;this._nodeIdArray=[];this.ignoresMemoryFactor=!1}get baseUrl(){return this.layer.parsedUrl.path}get pointScale(){const ea=N.getSplatSizeAlgorithm(this.layer?.renderer);
return null!=ea?.scaleFactor?ea.scaleFactor:1}get useRealWorldSymbolSizes(){const ea=N.getFixedSizeAlgorithm(this.layer?.renderer);return null!=ea?.useRealWorldSymbolSizes?ea.useRealWorldSymbolSizes:!1}get pointSize(){const ea=N.getFixedSizeAlgorithm(this.layer?.renderer);return null!=ea?.size?ea.size:0}get inverseDensity(){return this.layer?.renderer?96/this.layer.renderer.pointsPerInch:5}get availableFields(){var ea=N.getRendererInfo(this.layer);const ca=new Set;ea.primaryAttribute&&ca.add(ea.primaryAttribute.name);
ea.modulationAttribute&&ca.add(ea.modulationAttribute.name);if(ea=N.getFilterInfo(this.layer))for(const W of ea)W.attributeInfo&&ca.add(W.attributeInfo.name);if(this.layer.outFields)for(const W of H.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ca.add(W);return Array.from(ca)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const ea=t.create();return O.projectToBoundingBox(this.view.clippingArea,ea,this.view.renderSpatialReference)?ea:null}get _elevationOffset(){const ea=
this.layer&&this.layer.elevationInfo;if(ea&&"absolute-height"===ea.mode){const ca=l.getMetersPerVerticalUnitForSR(this.layer.spatialReference),W=C.getMetersPerUnit(ea.unit);return(ea.offset??0)*W/ca}return 0}initialize(){const ea=this.view.resourceController;var ca=fa(ea);this._worker=new K.PointCloudWorkerHandle(ca);this.addResolvingPromise(this._worker.promise);this._tmpPoint=D.makeDehydratedPoint(0,0,0,this.layer.spatialReference);I.checkPointCloudLayerValid(this.layer);I.checkPointCloudLayerCompatibleWithView(this.layer,
this.view);this._indexRequester=ea.createStreamDataRequester(P.ClientType.I3S_INDEX);this._dataRequester=ea.createStreamDataRequester(P.ClientType.I3S_DATA);this._initRenderer();ca=this._initNodePages();this._memCache=this.view.resourceController.memoryController.newCache(`pcl-${this.layer.uid}`);this._updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),g.initial);this._updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),g.initial);this._updatingHandles.add(()=>
this.layer.renderer,()=>this._rendererChanged(),g.initial);this._updatingHandles.add(()=>this.layer.filters,()=>this._reload(),g.initial);this._updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),g.initial);this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this._updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.addHandles([this.view.basemapTerrain.on("scale-change",W=>this._scaleUpdateHandler(W)),g.watch(()=>
this.view.quality,()=>this._setUpdateViewNeeded(),g.sync)]);this.addResolvingPromise(ca);this.when(()=>{this.addHandles([ea.scheduler.registerTask(ha.TaskPriority.POINT_CLOUD_LAYER,this),ea.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this._updatingHandles.add(()=>this.suspended,W=>{W?this._clearNodeState():this._setUpdateViewNeeded()},g.initial)])},()=>{this._updatingHandles.removeAll();this.removeAllHandles()})}_setUpdateViewNeeded(){this._updateViewNeeded=!0;
this._updateLoading()}destroy(){this.cancelLoading();this._worker=d.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=d.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=d.abortMaybe(this._codedDomainPopulationAbortController);this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new T.PointRenderer({createGraphic:(ea,ca,W)=>this._createGraphic(ea,ca,W)});this._renderer.layerUid=this.layer.uid;this._updatingHandles.add(()=>this._clippingBox,ea=>
this._renderer.clippingBox=ea,g.initial);this._updatingHandles.add(()=>this.suspended,ea=>this._setPointsVisible(!ea),g.initial);this._updatingHandles.add(()=>this.pointScale,ea=>this._renderer.scaleFactor=ea,g.initial);this._renderer.minSizePx=Math.sqrt(2);this._updatingHandles.add(()=>this.useRealWorldSymbolSizes,ea=>this._renderer.useRealWorldSymbolSizes=ea,g.initial);this._updatingHandles.add(()=>this.pointSize,ea=>{const ca=e.pt2px(ea);this._renderer.size=ea;this._renderer.sizePx=ca},g.initial);
this._updatingHandles.add(()=>this.slicePlaneEnabled,ea=>this._renderer.slicePlaneEnabled=ea,g.initial);this._updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),g.initial);this._updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),g.initial);this._updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,ea=>{this._lodFactor=ea;this._setUpdateViewNeeded()},g.initial)}_destroyRenderer(){this._renderer.removeAll();this._setPointsVisible(!1)}_createGraphic(ea,
ca,W){const Y=null!=ea.pointIdFilterMap?ea.pointIdFilterMap[ca]:ca;W=U.computeMapPointFromVec3d(this.view,W);const ja=this._createGraphicAttributes(ea,Y);return new Q.PointGraphic({pointCloudMetadata:{nodeId:ea.id,pointIndexInNode:ca,attributePointIndexInNode:Y,epoch:this._nodeLoadEpoch},geometry:W,attributes:ja,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(ea,ca){const W={};for(const Y of ea.attributes)this._encodeGraphicAttribute(Y.attributeInfo,Y.values,ca,W);return W}_encodeGraphicAttribute(ea,
ca,W,Y){var ja=ea.storageInfo?.attributeValues;const oa=ja?.valuesPerElement??1;if(1===oa)Y[ea.name]=ca[W];else if("UInt8"===ja?.valueType&&4>=oa){ja=0;W*=oa;for(let ra=W;ra<W+oa;ra++)ja=(ja<<8)+ca[ra];Y[ea.name]=ja}else Y[ea.name]=void 0}_setPointsVisible(ea){ea&&!this._rendererAdded?(this.view._stage.addRenderPlugin(this._renderer),this._rendererAdded=!0):!ea&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=
N.rendererUsesFixedSizes(this.layer.renderer);this._reload()}_reload(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState();this._memCache.clear();this._initNodePages()}_scaleUpdateHandler(ea){const ca=this.layer.effectiveScaleRange;da.isScaleRangeActive(ca.minScale,ca.maxScale)?p.projectBoundingRect(ea.extent,ea.spatialReference,Z,this.layer.spatialReference)&&(this._nodeScales.forEach((W,Y)=>{this._renderedNodes.has(Y)?(W=this._index.getNode(Y),
r.containsPoint(Z,W.obb.center)&&this._nodeScales.set(Y,ea.scale)):this._nodeScales.delete(Y)}),this._setUpdateViewNeeded()):this._nodeScales.clear()}_displayNodes(ea){this._workQueue=M.nodeDiff([...this._renderedNodes],ea,this._index);M.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);M.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<ea.length||this._loadingInitNodePage;
this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading();this._cancelIndexLoading()}_cancelNodeLoading(){const ea=[];this._loadingNodes.forEach(({abortController:ca})=>ea.push(ca));this._loadingNodes.clear();for(const ca of ea)ca.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()}_updateQueues(){const ea=new Set;this._workQueue.forEach(Y=>Y.load.forEach(ja=>ea.add(ja)));const ca=[],W=new Map;this._loadingNodes.forEach((Y,
ja)=>{ea.has(ja)?W.set(ja,Y):ca.push(Y)});this._loadingNodes=W;for(const {abortController:Y}of ca)Y.abort();this._workQueue=this._workQueue.filter(Y=>{for(const ja of Y.load)if(this._loadingNodes.has(ja))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:ea})=>ea.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++;
this._renderedNodes.forEach(ea=>this._removeFromRenderer(ea));this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}runTask(ea){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,ea=this._isRootNodeVisible(),ea!==this._layerIsVisible&&(this._layerIsVisible=ea,this.notifyChange("suspended")),
this._updateLoading());else{for(ea.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&ea.run(()=>this._processIndexQueue()););this._processWorkQueue(ea);this._idleQueue.runTask(ea)}}_processIndexQueue(){const ea=this._indexQueue.shift(),ca=this._loadNodePage(ea);this._indexPagesLoading.set(ea,ca);ca.promise.then(W=>{this._index.addPage(ea,W,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(ea)},()=>{this._indexPagesLoading.delete(ea)});return!0}_processWorkQueue(ea){for(;!ea.done;){const ca=
this._scheduleWorkEntry();if(null==ca){ea.madeProgress();break}this._processWorkEntry(ca);ea.madeProgress()}}_scheduleWorkEntry(){let ea=this._workQueue.length;for(;ea--;){const ca=this._workQueue.shift();if(ca.remove.find(W=>!this._renderedNodes.has(W)))this._workQueue.push(ca);else return ca}return null}_processWorkEntry(ea){if(0===ea.load.length)for(const ca of ea.remove)this._removeFromRenderer(ca);else Promise.all(ea.load.map(ca=>{const W=new AbortController,Y=this._memCache.pop(ca.toString());
null!=Y?this._loadingNodes.set(ca,{abortController:W,promise:Promise.resolve(Y)}):this._loadingNodes.has(ca)||this._loadingNodes.set(ca,{abortController:W,promise:this._loadNode(ca,W.signal)});return this._loadingNodes.get(ca).promise})).then(ca=>{for(let W=0;W<ea.load.length;W++)if(ca[W]){const Y=this._setupRendererData(ea.load[W],ca[W]);this._addToRenderer(Y)}for(const W of ea.remove)this._removeFromRenderer(W)}).catch(()=>{}).then(()=>{for(const ca of ea.load)this._loadingNodes.delete(ca);this._updateLoading();
this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()}async _populateClassCodeCodedDomain(ea,ca){const W=this.layer.fieldsIndex.get("CLASS_CODE");W&&!W.domain&&ea.includes(W.name)&&(ea=await h.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ca})),!1!==ea.ok&&(ea=ea.value?.stats?.labels?.labels)&&Array.isArray(ea)&&(W.domain=new A({name:"CLASS_CODE",codedValues:ea.map(Y=>
new E.CodedValue({code:Y.value,name:Y.label}))})))}async prepareFetchPopupFeatures(ea){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(ea,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise}async whenGraphicAttributes(ea,ca){const W=this._splitGraphicsPerNode(ea),Y=this.layer.attributeStorageInfo,
ja=ca.map(ta=>N.getAttributeInfo(Y,ta)).filter(b.isSome),oa=async(ta,ya)=>{const Ca=this._index.getNode(ya);await h.forEach(ja,async pa=>{const wa=pa.useElevation?await this._loadElevationAttributeFromGeometry(Ca.resourceId):await this._loadAndParseAttribute(Ca,pa);if(wa)for(const Ba of ta)this._isValidPointGraphic(Ba)&&this._encodeGraphicAttribute(pa,wa,Ba.pointCloudMetadata.attributePointIndexInNode,Ba.attributes)})},ra=[];W.forEach((ta,ya)=>{ra.push(oa(ta,ya))});await Promise.allSettled(ra);return ea}_isValidPointGraphic(ea){return ea instanceof
Q.PointGraphic&&ea.pointCloudMetadata?.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(ea){const ca=new Map;for(const W of ea){if(!this._isValidPointGraphic(W))continue;ea=W.pointCloudMetadata;const Y=ca.get(ea.nodeId);Y?Y.push(W):ca.set(ea.nodeId,[W])}return ca}async _loadAndParseAttribute(ea,ca){const W=await this._loadAttribute(ea.resourceId,ca,null);return null!=W?V.getAttributeValues({attributeInfo:ca,buffer:W},null,ea.vertexCount):null}async _loadElevationAttributeFromGeometry(ea){ea=V.readGeometry(this.layer.store.defaultGeometrySchema,
await this._loadGeometry(ea,null));return V.elevationFromPositions(ea,ea.length/3)}highlight(ea){if(!ea)return k.makeHandle();ea=c.isCollection(ea)?ea.toArray():Array.isArray(ea)?ea:[ea];return this._renderer.highlight(ea.map(ca=>this._graphicToPointDefinition(ca)))}_graphicToPointDefinition(ea){if(!this._isValidPointGraphic(ea))return null;const {nodeId:ca,pointIndexInNode:W}=ea.pointCloudMetadata;return null!=ca&&null!=W?{nodeId:ca,pointId:W}:null}_computeWork(){let ea=0;for(const ca of this._workQueue)ea+=
ca.load.length+ca.remove.length;ea+=this._loadingNodes.size;ea+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;ea+=this._loadingInitNodePage?100:0;return ea+=this._updateViewNeeded?100:0}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const ea=this._computeWork();return 1-Math.min(this._totalWork,ea)/this._totalWork}_updateLoading(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&
this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:0<this._computeWork()}_initNodePages(){const ea=this.layer.store.index;this._index=new S.PagedNodeIndex(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,ea.nodesPerPage||ea.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=
null!=ea.nodesPerPage?1:ea.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ca=>{this._index.addPage(0,ca,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})}_loadNodePage(ea){const ca=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${ea*this._pageMultiplier}`,ca.signal).then(W=>W.nodes.map((Y,ja)=>({resourceId:null!=Y.resourceId?Y.resourceId:ea*this._index.pageSize+ja,obb:R.Obb.fromJSON(Y.obb),obbInRenderSR:new R.Obb,firstChild:Y.firstChild,
childCount:Y.childCount,vertexCount:Y.vertexCount??Y.pointCount,lodThreshold:Y.lodThreshold??Y.effectiveArea}))),abortController:ca}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;var ea=this.view.quality;let ca=this.inverseDensity/this._lodFactor*ea;ea*=this.maximumPointCount*this._lodFactor;let W=this._computeNodesForMinimumDensity(ca),Y=this._computePointCount(W),ja=Math.sqrt(Y/(.75*ea));for(;Y>ea;)ca*=ja,W=this._computeNodesForMinimumDensity(ca),Y=this._computePointCount(W),ja=Math.sqrt(2);
this._displayNodes(W);this._updateViewNeeded=!1;this._updateLoading();return!0}_computePointCount(ea){let ca=0;for(let W=0;W<ea.length;W++){const Y=this._index.getNode(ea[W]);Y&&(ca+=Y.vertexCount)}return ca}_isRootNodeVisible(){let ea=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ca,W,Y)=>{ea=Y;return!1},pageMiss:()=>{}});return ea}_computeNodesForMinimumDensity(ea){const ca=this.view.state.contentCamera,W=ca.frustum,Y=this._clippingBox,
ja=ca.viewForward,oa=q.dot(ja,ca.eye),ra=y.fromNormalAndOffset(ja,-oa,aa),ta=ca.perScreenPixelRatio/2,ya=ea*ea,Ca=this._nodeIdArray;Ca.length=0;const {minScale:pa,maxScale:wa}=da.extractSafeScaleBounds(this.layer),Ba=0===pa&&0===wa?la=>Ca.push(la):la=>{const qa=this._getScale(la);da.scaleBoundsPredicate(qa,pa,wa)&&Ca.push(la)};this._traverseVisible({frustum:W,clippingBox:Y},{predicate:(la,qa,ua)=>{if(!ua)return!1;if(0===qa.childCount)return Ba(la),!1;ua=this._index.getRenderObb(la);return this._computeAveragePixelArea(ua,
qa.lodThreshold,qa.vertexCount,ra,ta)<=ya?(Ba(la),!1):!0},pageMiss:(la,qa)=>{Ba(la);this._indexQueue.includes(qa)||this._indexQueue.push(qa)}});return Ca}_getScale(ea){var ca=this._nodeScales.get(ea);null==ca&&(ca=this._index.getNode(ea).obb.center,this._tmpPoint.x=ca[0],this._tmpPoint.y=ca[1],this._tmpPoint.z=ca[2],ca=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(ea,ca));return ca}_computeAveragePixelArea(ea,ca,W,Y,ja){ea=Math.max(1E-7,ea.minimumDistancePlane(Y));return ca/
(ea*ea)/(4*ja*ja)/W}_loadNode(ea,ca){try{return this._loadNodeAsync(ea,ca)}catch(W){throw f.isAbortError(W)||m.getLogger(this).error(W),W;}}async _loadAdditionalUserAttributes(ea,ca,W){var Y=this.layer.outFields;if(!Y)return[];Y=H.unpackFieldNames(this.layer.fieldsIndex,Y);ea=new Set(ea.map(ra=>null!=ra?ra.name:null));const ja=this.layer.attributeStorageInfo,oa=[];for(const ra of Y)ea.has(ra)||(Y=N.getAttributeInfo(ja,ra))&&oa.push(ca(Y));ca=await f.allSettledValues(oa);f.throwIfAborted(W);return ca.filter(b.isSome)}async _loadNodeAsync(ea,
ca){const W=this._index.getNode(ea),Y=N.getRendererInfo(this.layer),ja=N.getFilterInfo(this.layer),oa=W.resourceId,ra=async ta=>{if(!ta)return null;if(ta.useElevation)return{attributeInfo:ta,buffer:null};const ya=await this._loadAttribute(oa,ta,ca);return null!=ya?{attributeInfo:ta,buffer:ya}:null};return this._idleQueue.push(async()=>{var ta=this._loadGeometry(oa,ca);const {primaryAttribute:ya,modulationAttribute:Ca}=Y,pa=ra(ya),wa=ra(Ca);var Ba=ja.map(Na=>Na.attributeInfo);const la=Ba.map(Na=>ra(Na));
Ba=this._loadAdditionalUserAttributes([ya,Ca,...Ba],ra,ca);const [qa,ua,va,Ga,La]=await Promise.all([ta,pa,wa,Promise.all(la),Ba]);f.throwIfAborted(ca);ta={geometryBuffer:qa,primaryAttributeData:ua,modulationAttributeData:va,filterAttributesData:Ga,userAttributesData:La,schema:this.layer.store.defaultGeometrySchema,rendererInfo:Y,filterInfo:ja,obbData:this._index.getRenderObb(ea).data,elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};
return this._worker.invoke(ta,ca)},ca)}async _loadGeometry(ea,ca){return this._requestData(`${this.baseUrl}/nodes/${ea}/geometries/0`,ca)}async _loadAttribute(ea,ca,W){return ca?.storageInfo?this._requestData(`${this.baseUrl}/nodes/${ea}/attributes/${ca.storageInfo.key}`,W):null}_requestNodePage(ea,ca){return this._indexRequester.request(ea,"json",{query:{f:"json",...this.layer.customParameters,token:this.layer.apiKey},signal:ca})}_requestData(ea,ca){return this._dataRequester.request(ea,"binary",
{query:{...this.layer.customParameters,token:this.layer.apiKey},signal:ca})}_removeFromRenderer(ea){if(this._renderedNodes.has(ea)){const ca=this._renderer.removeNode(ea);this._renderedNodes.delete(ea);this._nodeScales.delete(ea);this._memCache.put(ca.id.toString(),ca,5*ca.coordinates.length+128)}}_addToRenderer(ea){this._renderedNodes.has(ea.id)||(this._renderedNodes.add(ea.id),this._renderer.addNode(ea))}_setupRendererData(ea,ca){const W=this._index.getNode(ea),Y=Math.sqrt(W.lodThreshold/W.vertexCount),
ja=this._index.getRenderObb(ea);if(T.isPointRendererNode(ca))return ca.splatSize=Y,ca.obb=ja,q.copy(ca.origin,ca.obb.center),ca;const oa=R.Obb.fromData(ca.obbData),ra=oa.halfSize,ta=ja.halfSize,ya=.01*Math.max(ta[0],ta[1],ta[2]);if(ra[0]>ta[0]+ya||ra[1]>ta[1]+ya||ra[2]>ta[2]+ya)0<this._maxLoggedBoxWarnings&&(m.getLogger(this).warn(`Node ${ea} reported bounding box too small. got ${`[${ja.halfSize[0]}, ${ja.halfSize[1]}, ${ja.halfSize[2]}]`} but points cover ${`[${oa.halfSize[0]}, ${oa.halfSize[1]}, ${oa.halfSize[2]}]`}`),
0===--this._maxLoggedBoxWarnings&&m.getLogger(this).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(ea,oa);return new T.PointRendererNode(ea,Y,v.clone(ja.center),ja,0===W.childCount,ca.points,ca.rgb,ca.attributes,ca.pointIdFilterMap)}get usedMemory(){let ea=0;this._renderer.forEachNode(ca=>{ea+=160;ea+=n.estimateSize(ca.coordinates);for(const W of ca.attributes)ca=W.values,n.isArrayBuffer(ca.buffer)&&(ea+=n.estimateSize(ca))});return ea}get unloadedMemory(){const ea=
this._renderedNodes.size;if(4>ea)return 0;const ca=[...this._renderedNodes].reduce((Y,ja)=>Y+this._index.getNode(ja).vertexCount);let W=this._loadingNodes.size;for(let Y=0;Y<this._workQueue.length;Y++)W+=this._workQueue[Y].load.length,W-=this._workQueue[Y].remove.length;return 0>W?0:W*ca/ea*((this.usedMemory-160*ea)/ca)+160*W}get performanceInfo(){return new J.PointCloudLayerViewPerformanceInfo(this.usedMemory,this._renderedNodes.size,[...this._renderedNodes].reduce((ea,ca)=>ea+this._index.getNode(ca).vertexCount,
0),this.maximumPointCount,new J.QueuePerformanceInfo(this._loadingNodes.size,this._indexQueue.length,this._workQueue.length,this._idleQueue.length))}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};a.__decorate([u.property()],x.prototype,"layer",void 0);a.__decorate([u.property()],x.prototype,"baseUrl",null);a.__decorate([u.property()],x.prototype,"pointScale",null);a.__decorate([u.property()],x.prototype,"useRealWorldSymbolSizes",null);a.__decorate([u.property()],x.prototype,
"pointSize",null);a.__decorate([u.property()],x.prototype,"inverseDensity",null);a.__decorate([u.property()],x.prototype,"maximumPointCount",void 0);a.__decorate([u.property({readOnly:!0})],x.prototype,"availableFields",null);a.__decorate([u.property({readOnly:!0})],x.prototype,"_clippingBox",null);a.__decorate([u.property({readOnly:!0})],x.prototype,"_elevationOffset",null);a.__decorate([u.property({type:Boolean})],x.prototype,"slicePlaneEnabled",void 0);a.__decorate([u.property()],x.prototype,"updating",
void 0);a.__decorate([u.property(ba.updatingProgress)],x.prototype,"updatingProgress",void 0);a.__decorate([u.property({readOnly:!0})],x.prototype,"updatingProgressValue",null);a=x=a.__decorate([w.subclass("esri.views.3d.layers.PointCloudLayerView3D")],x);const Z=r.create();return a})},"esri/views/3d/layers/PointCloudLayerViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class h extends b.LayerViewPerformanceInfo{constructor(k,m,d,f,g){super(k,m,
-1,d,f);this.queue=g}}class c{constructor(k,m,d,f){this.loading=k;this.indexLoading=m;this.processing=d;this.idleProcessing=f}}a.PointCloudLayerViewPerformanceInfo=h;a.QueuePerformanceInfo=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class h extends b.WorkerHandle{constructor(c){super("PointCloudWorker","transform",{transform:k=>this._getTransferList(k)},
c)}_getTransferList(c){const k=[c.geometryBuffer];null!=c.primaryAttributeData&&c.primaryAttributeData.buffer&&k.push(c.primaryAttributeData.buffer);null!=c.modulationAttributeData&&c.modulationAttributeData.buffer&&k.push(c.modulationAttributeData.buffer);if(null!=c.filterAttributesData)for(const m of c.filterAttributesData)null!=m&&m.buffer&&k.push(m.buffer);for(const m of c.userAttributesData)m.buffer&&k.push(m.buffer);return k}}a.PointCloudWorkerHandle=h;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec32"],function(a,b){function h(g,e,n){for(;0<g;){const l=e.indexOf(g);if(0<=l)return l;g=n.getParentId(g)}return e.indexOf(g)}function c(g,e,n){const l=[e.remove[0]],u=[];for(;1===l.length;){const w=l.pop();u.length=0;for(let q=0;q<e.load.length;q++){let v=e.load[q];for(var x=n.getParentId(v);x!==w;)v=x,x=n.getParentId(v);x=l.indexOf(v);0>x&&(x=l.length,l.push(v),u.push([]));u[x].push(e.load[q])}}e.load=
l;for(e=0;e<l.length;e++)1<u[e].length?g.push({remove:[l[e]],load:u[e]}):l[e]=u[e][0]}const k=[!1],m=[null],d=[!1],f=[null];a.nodeDiff=function(g,e,n){for(var l=0;l<e.length;l++)d[l]=!1,f[l]=null;for(l=0;l<g.length;l++)k[l]=!1,m[l]=null;for(l=0;l<e.length;l++){var u=h(e[l],g,n);0<=u&&(d[l]=!0,null!=m[u]?m[u].push(e[l]):m[u]=[e[l]])}for(l=0;l<g.length;l++)u=h(g[l],e,n),0<=u&&(k[l]=!0,null!=f[u]?f[u].push(g[l]):f[u]=[g[l]]);n=[];for(l=0;l<g.length;l++)null!=m[l]||k[l]||n.push({load:[],remove:[g[l]]});
for(l=0;l<e.length;l++)null!=f[l]||d[l]||n.push({load:[e[l]],remove:[]});for(l=0;l<e.length;l++)null!=f[l]&&(1<f[l].length||f[l][0]!==e[l])&&n.push({load:[e[l]],remove:f[l]});for(e=0;e<g.length;e++)null!=m[e]&&(1<m[e].length||m[e][0]!==g[e])&&n.push({load:m[e],remove:[g[e]]});return n};a.sortFrontToBack=function(g,e,n){return g.sort((l,u)=>{if(0===l.load.length&&0===u.load.length)return 0;if(0===l.load.length)return-1;if(0===u.load.length)return 1;if(0===l.remove.length&&0===u.remove.length)return l=
n.getRenderObb(l.load[0]).center,u=n.getRenderObb(u.load[0]).center,b.dot(l,e)-b.dot(u,e);if(0===l.remove.length)return-1;if(0===u.remove.length)return 1;if(1===l.load.length&&1===u.load.length)return l=n.getRenderObb(l.load[0]).center,u=n.getRenderObb(u.load[0]).center,b.dot(l,e)-b.dot(u,e);if(1===l.load.length)return-1;if(1===u.load.length)return 1;l=n.getRenderObb(l.remove[0]).center;u=n.getRenderObb(u.remove[0]).center;return b.dot(l,e)-b.dot(u,e)})};a.splitWorkEntries=function(g,e,n){for(let l=
0;l<g.length;++l){const u=g[l];u.load.length>e&&1===u.remove.length&&c(g,u,n)}};a.splitWorkEntry=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["exports","../../../../geometry/spatialReferenceEllipsoidUtils","../../../../geometry/support/aaBoundingBox"],function(a,b,h){class c{constructor(k,m,d){this._pages=[];this.pageSize=0;this._nodeSR=k;this._renderSR=m;this._renderSRSphericalPCPF=b.getSphericalPCPF(m);this.pageSize=
d}addPage(k,m,d=0){for(;this._pages.length<k;)this._pages.push(null);var f=this._nodeSR,g=this._renderSR,e=this._renderSRSphericalPCPF;for(var n=0;n<m.length;n++){const l=m[n];l.obb.transform(l.obbInRenderSR,f,g,d,e)}this._pages[k]={nodes:m,parents:new Uint32Array(this.pageSize)};k=this._pages;m=this.pageSize;for(d=[0];d.length;)for(f=d.pop(),g=k[f/m|0].nodes[f%m],e=0;e<g.childCount;e++)n=g.firstChild+e,null!=k[n/m|0]&&(k[n/m|0].parents[n%m]=f,d.push(n))}hasPage(k){return!!this._pages[k]}getNode(k){const m=
this.pageSize;return this._pages[k/m|0].nodes[k%m]}getRenderObb(k){const m=this.pageSize;return this._pages[k/m|0].nodes[k%m].obbInRenderSR}setRenderObb(k,m){const d=this.pageSize;this._pages[k/d|0].nodes[k%d].obbInRenderSR.copy(m)}getParentId(k){const m=this.pageSize;return this._pages[k/m|0].parents[k%m]}hasNodes(k,m){var d=k/this.pageSize|0;for(k=(k+m-1)/this.pageSize|0;d<=k;d++)if(null==this._pages[d])return!1;return!0}forEachNodeId(k){for(let m=0;m<this._pages.length;m++){const d=this._pages[m];
if(d)for(let f=0;f<d.nodes.length;f++)k(m*this.pageSize+f)}}createVisibilityTraverse(){var k=this,m=[],d=[],f=h.create();return(g,e)=>{if(k.hasNodes(0,1))for(m.length=0,m.push(0),d.length=0,d.push(0);0<m.length;){var n=m.pop();let v=d.pop();var l=k.getNode(n),u=k.getRenderObb(n),x=!0;if(null!=g.clippingBox){var w=1<<g.frustum.length;0===(v&w)&&(u.toAaBoundingBox(f),h.contains(g.clippingBox,f)?v|=w:h.intersects(g.clippingBox,f)||(x=!1))}for(w=0;w<g.frustum.length&&x;w++){var q=1<<w;if(0===(v&q)){const p=
u.intersectPlane(g.frustum[w]);0<p?x=!1:0>p&&(v|=q)}}if(e.predicate(n,l,x)){u=l.firstChild;l=l.childCount;x=!1;q=u/k.pageSize|0;for(w=(u+l-1)/k.pageSize|0;q<=w;q++)if(!k.hasPage(q)){e.pageMiss(n,q);x=!0;break}if(!x)for(n=0;n<l;n++)m.push(u+n),d.push(v)}}}}}a.PagedNodeIndex=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(c,k){for(const m of c??[])if(m.name===k&&null!=m.attributeValues&&
"UInt8"===m.attributeValues.valueType&&3===m.attributeValues.valuesPerElement)return{name:k,storageInfo:m,useElevation:!1};return null}function h(c,k){for(const m of c??[])if(m.name===k)return(c="embedded-elevation"===m.encoding)?{name:k,storageInfo:null,useElevation:c}:{name:k,storageInfo:m,useElevation:c};return"elevation"===k?.toLowerCase()?{name:k,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=h;a.getFilterInfo=function(c){const k=c.filters;return k?k.map(m=>({filterJSON:m.toJSON(),
attributeInfo:h(c.attributeStorageInfo,m.field)})):[]};a.getFixedSizeAlgorithm=function(c){return(c=c?.pointSizeAlgorithm)&&"fixed-size"===c.type?c:null};a.getRendererInfo=function(c){const k=c.renderer;var m=k?.type;const d=k?.toJSON()??null;let f=null,g=!1;c=c.attributeStorageInfo;"point-cloud-unique-value"===m?f=h(c,k.field):"point-cloud-stretch"===m?f=h(c,k.field):"point-cloud-class-breaks"===m?f=h(c,k.field):(f="point-cloud-rgb"===m?b(c,k.field):b(c,"RGB"),g=null!=f);m=null;k?.colorModulation&&
(m=h(c,k.colorModulation.field));return{rendererJSON:d,isRGBRenderer:g,primaryAttribute:f,modulationAttribute:m}};a.getSplatSizeAlgorithm=function(c){return(c=c?.pointSizeAlgorithm)&&"splat"===c.type?c:null};a.rendererUsesFixedSizes=function(c){c=c?.pointSizeAlgorithm;return c?.type?"fixed-size"===c.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/has ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,h,c,k,m,d){function f(n,l){const u=new Float64Array(l);for(let x=0;x<l;x++)u[x]=n[3*x+2];return u}function g(n){switch(n){default:case null:case "none":return l=>l;case "low-four-bit":return l=>l&15;case "high-four-bit":return l=>(l&240)>>4;case "absolute-value":return l=>Math.abs(l);case "modulo-ten":return l=>l%10}}function e(n){let l=0;for(const u of n||[])l|=1<<u;return l}a.elevationFromPositions=f;a.evaluateRenderer=function(n,l,u,x){const {rendererJSON:w,isRGBRenderer:q}=n;var v=
n=null;if(l&&q)n=l;else if(l&&"pointCloudUniqueValueRenderer"===w?.type){v=k.fromJSON(w);var p=v.colorUniqueValueInfos;n=new Uint8Array(3*x);var t=g(v.fieldTransformType);for(var r=0;r<x;r++){var y=(t?t(l[r]):l[r])+"";for(var D=0;D<p.length;D++)if(p[D].values.includes(y)){n[3*r]=p[D].color.r;n[3*r+1]=p[D].color.g;n[3*r+2]=p[D].color.b;break}}}else if(l&&"pointCloudStretchRenderer"===w?.type)for(v=c.fromJSON(w),p=v.stops,n=new Uint8Array(3*x),t=g(v.fieldTransformType),r=0;r<x;r++)if(y=t?t(l[r]):l[r],
D=p.length-1,y<p[0].value)n[3*r]=p[0].color.r,n[3*r+1]=p[0].color.g,n[3*r+2]=p[0].color.b;else if(y>=p[D].value)n[3*r]=p[D].color.r,n[3*r+1]=p[D].color.g,n[3*r+2]=p[D].color.b;else for(D=1;D<p.length;D++){if(y<p[D].value){y=(y-p[D-1].value)/(p[D].value-p[D-1].value);n[3*r]=p[D].color.r*y+p[D-1].color.r*(1-y);n[3*r+1]=p[D].color.g*y+p[D-1].color.g*(1-y);n[3*r+2]=p[D].color.b*y+p[D-1].color.b*(1-y);break}}else if(l&&"pointCloudClassBreaksRenderer"===w?.type)for(v=h.fromJSON(w),p=v.colorClassBreakInfos,
n=new Uint8Array(3*x),t=g(v.fieldTransformType),r=0;r<x;r++)for(y=t?t(l[r]):l[r],D=0;D<p.length;D++){if(y>=p[D].minValue&&y<=p[D].maxValue){n[3*r]=p[D].color.r;n[3*r+1]=p[D].color.g;n[3*r+2]=p[D].color.b;break}}else n=(new Uint8Array(3*x)).fill(255);if(u&&v?.colorModulation)for(l=v.colorModulation.minValue,v=v.colorModulation.maxValue,p=0;p<x;p++)t=u[p],t=t>=v?1:t<=l?.3:.3+.7*(t-l)/(v-l),n[3*p]*=t,n[3*p+1]*=t,n[3*p+2]*=t;return n};a.filterInPlace=function(n,l,u,x,w){const q=n.length/3;let v=0;for(let E=
0;E<q;E++){let A=!0;for(let B=0;B<x.length&&A;B++){var {filterJSON:p}=x[B],t=w[B].values[E];switch(p.type){case "pointCloudValueFilter":var r="exclude"===p.mode;p.values.includes(t)===r&&(A=!1);break;case "pointCloudBitfieldFilter":r=e(p.requiredSetBits);p=e(p.requiredClearBits);if((t&r)!==r||0!==(t&p))A=!1;break;case "pointCloudReturnFilter":var y=t&15,D=t>>>4&15;t=1<D;r=1===y;y=y===D;D=!1;for(const F of p.includedReturns)if("last"===F&&y||"firstOfMany"===F&&r&&t||"lastOfMany"===F&&y&&t||"single"===
F&&!t){D=!0;break}D||(A=!1)}}A&&(u[v]=E,n[3*v]=n[3*E],n[3*v+1]=n[3*E+1],n[3*v+2]=n[3*E+2],l[3*v]=l[3*E],l[3*v+1]=l[3*E+1],l[3*v+2]=l[3*E+2],v++)}return v};a.getAttributeValues=function(n,l,u){return n?.attributeInfo.useElevation?l?f(l,u):null:n?.attributeInfo.storageInfo?m.readBinaryAttribute(n.attributeInfo.storageInfo,n.buffer,u):null};a.readGeometry=function(n,l){if(null==n.encoding||""===n.encoding){n=m.createGeometryIndexFromSchema(l,n);if(null==n.vertexAttributes.position)return;l=m.createTypedView(l,
n.vertexAttributes.position);var u=n.header.fields;n=[u.offsetX,u.offsetY,u.offsetZ];u=[u.scaleX,u.scaleY,u.scaleZ];const x=l.length/3,w=new Float64Array(3*x);for(let q=0;q<x;q++)w[3*q]=l[3*q]*u[0]+n[0],w[3*q+1]=l[3*q+1]*u[1]+n[1],w[3*q+2]=l[3*q+2]*u[2]+n[2];return w}if("lepcc-xyz"===n.encoding)return d.decodeXYZ(l).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,h,c,k,m,d,f,g,e){var n;c=n=class extends f{constructor(l){super(l);this.type="point-cloud-class-breaks";this.colorClassBreakInfos=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new n({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
c.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},type:String})],c.prototype,"field",void 0);a.__decorate([h.property({type:g.LegendOptions,json:{write:!0}})],c.prototype,"legendOptions",void 0);a.__decorate([h.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[e],json:{write:!0}})],
c.prototype,"colorClassBreakInfos",void 0);return c=n=a.__decorate([d.subclass("esri.renderers.PointCloudClassBreaksRenderer")],c)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(a,b,h,c,k,m,d,f,g,e){m=
b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});h=class extends h.JSONSupport{constructor(n){super(n);this.type=void 0;this.colorModulation=this.pointSizeAlgorithm=null;this.pointsPerInch=10}clone(){console.warn(".clone() is not implemented for "+this.declaredClass);return null}cloneProperties(){return{pointSizeAlgorithm:c.clone(this.pointSizeAlgorithm),
colorModulation:c.clone(this.colorModulation),pointsPerInch:c.clone(this.pointsPerInch)}}};a.__decorate([k.property({type:m.apiValues,readOnly:!0,nonNullable:!0,json:{type:m.jsonValues,read:!1,write:m.write}})],h.prototype,"type",void 0);a.__decorate([k.property({types:e.pointSizeAlgorithmTypes,json:{write:!0}})],h.prototype,"pointSizeAlgorithm",void 0);a.__decorate([k.property({type:g,json:{write:!0}})],h.prototype,"colorModulation",void 0);a.__decorate([k.property({json:{write:!0},nonNullable:!0,
type:Number})],h.prototype,"pointsPerInch",void 0);h=a.__decorate([f.subclass("esri.renderers.PointCloudRenderer")],h);(h||={}).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return h})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){var f;b=f=class extends b.JSONSupport{constructor(){super(...arguments);this.field=null;this.minValue=0;this.maxValue=255}clone(){return new f({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};a.__decorate([h.property({type:String,json:{write:!0}})],b.prototype,"field",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"minValue",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,
"maxValue",void 0);return b=f=a.__decorate([d.subclass("esri.renderers.support.pointCloud.ColorModulation")],b)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,h,c){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":h,splat:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){b=new b.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});h=class extends h.JSONSupport{};a.__decorate([c.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],h.prototype,"type",void 0);return h=a.__decorate([f.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],h)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,h,c,k,m,d,f){var g;h=g=class extends f{constructor(){super(...arguments);this.type="fixed-size";this.size=0;this.useRealWorldSymbolSizes=null}clone(){return new g({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};a.__decorate([m.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],h.prototype,"type",void 0);a.__decorate([b.property({type:Number,nonNullable:!0,json:{write:!0}})],h.prototype,"size",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],
h.prototype,"useRealWorldSymbolSizes",void 0);return h=g=a.__decorate([d.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],h)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,h,c,k,m,d,f){var g;h=g=class extends f{constructor(){super(...arguments);this.type="splat";this.scaleFactor=1}clone(){return new g({scaleFactor:this.scaleFactor})}};a.__decorate([m.enumeration({pointCloudSplatAlgorithm:"splat"})],h.prototype,"type",void 0);a.__decorate([b.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],h.prototype,"scaleFactor",void 0);return h=g=a.__decorate([d.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],h)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){var f;h=f=class extends h.JSONSupport{constructor(){super(...arguments);this.label=this.description=null;this.maxValue=this.minValue=0;this.color=null}clone(){return new f({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:c.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],h.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],h.prototype,"label",void 0);a.__decorate([k.property({type:Number,
json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],h.prototype,"minValue",void 0);a.__decorate([k.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],h.prototype,"maxValue",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],h.prototype,"color",void 0);return h=f=a.__decorate([d.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],h)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,h,c,k,m,d,f,g,e){var n;c=n=class extends f{constructor(l){super(l);this.type="point-cloud-stretch";this.stops=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new n({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],c.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},
type:String})],c.prototype,"field",void 0);a.__decorate([h.property({type:g.LegendOptions,json:{write:!0}})],c.prototype,"legendOptions",void 0);a.__decorate([h.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[e],json:{write:!0}})],c.prototype,"stops",void 0);return c=n=a.__decorate([d.subclass("esri.renderers.PointCloudStretchRenderer")],
c)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(a,b,h,c,k,m,d,f,g,e){var n;c=n=class extends f{constructor(l){super(l);this.type="point-cloud-unique-value";this.legendOptions=
this.colorUniqueValueInfos=this.fieldTransformType=this.field=null}clone(){return new n({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],c.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},type:String})],c.prototype,"field",void 0);a.__decorate([h.property({type:f.fieldTransformTypeKebabDict.apiValues,
json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[e],json:{write:!0}})],c.prototype,"colorUniqueValueInfos",void 0);a.__decorate([h.property({type:g.LegendOptions,json:{write:!0}})],c.prototype,"legendOptions",void 0);return c=n=a.__decorate([d.subclass("esri.renderers.PointCloudUniqueValueRenderer")],c)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d){var f;h=f=class extends h.JSONSupport{constructor(){super(...arguments);this.color=this.values=this.label=this.description=null}clone(){return new f({description:this.description,label:this.label,values:c.clone(this.values),color:c.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],h.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],h.prototype,"label",void 0);a.__decorate([k.property({type:[String],json:{write:!0}})],
h.prototype,"values",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],h.prototype,"color",void 0);return h=f=a.__decorate([d.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],h)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,h,c,k,m,d,f){a.PointGraphic=class extends h{constructor(g){super(g);this.pointCloudMetadata=null}};b.__decorate([c.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=b.__decorate([f.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/effects/RenderPlugin ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderSlot ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){function J(T,ia,O,U,P){if(O.drawScreenSpace)return O.fixedSize*ia*U;P=F.getMaxPointSizeScreenspace(P)*ia*U;return O.useFixedSizes?Math.min(O.fixedSize/2,P):0<O.screenMinSize?Math.min(Math.max(O.screenMinSize*ia*U,T/2),P):Math.min(T/2,P)}function K(T,ia,O,U,P){return O.drawScreenSpace?0:J(T,ia,O,U,P)}function I(T){return null!=T.component?T.component:-1}function M(T,ia){if(null==T)return T;T=T.filter(O=>O.id!==ia);return 0===T.length?
null:T}function S(T){return null!=T.dist&&null!=T.point&&null!=T.pointId&&null!=T.node}const N={positions:[new z.VertexElementDescriptor(B.VertexAttribute.POSITION,3,C.DataType.FLOAT,0,12)],colors:[new z.VertexElementDescriptor(B.VertexAttribute.COLOR,3,C.DataType.UNSIGNED_BYTE,0,3,!0)]};a.PointRenderer=class extends t.SyncPrepareRenderPlugin{constructor(T){super(T);this.type=D.IntersectorType.PCL;this.isGround=!1;this._passParameters=new F.PointRendererPassParameters;this._highlights=new v.PointHighlights({forEachNode:ia=>
this.forEachNode(ia),addHighlight:(ia,O,U)=>this._addHighlight(ia,O,U),removeHighlight:(ia,O)=>this._removeHighlight(ia,O)});this.produces=new Map([[E.RenderSlot.OPAQUE_MATERIAL,ia=>ia!==p.ShaderOutput.LinearDepth&&(ia!==p.ShaderOutput.Highlight||!this._highlights.empty)],[E.RenderSlot.OPAQUE_NO_SSAO_DEPTH,ia=>ia===p.ShaderOutput.LinearDepth]]);this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new H.PointRendererTechniqueConfiguration;this._nodes=new c}initializeRenderContext(T){this._context=
T;T.requestRender()}uninitializeRenderContext(){}intersect(T,ia,O,U){const P=n.create(),R=n.create(),ba=n.create(),X=n.create(),da=x.create(),ha=T.camera.perScreenPixelRatio/2,fa=T.camera.near;e.subtract(R,U,O);const aa=1/e.length(R);e.scale(R,R,aa);e.negate(ba,R);l.set(da,R[0],R[1],R[2],-e.dot(R,O));const Z=new Q,ea=new Q,ca=[],W=u.create(),Y=u.create(this._passParameters.clipBox);u.offset(Y,-O[0],-O[1],-O[2],Y);this._nodes.forAll(ta=>{const ya=ta.splatSize*this._passParameters.scaleFactor;var Ca=
ta.obb.minimumDistancePlane(da),pa=ta.obb.maximumDistancePlane(da);Ca-=K(ya,Ca+fa,this._passParameters,ha,ta.isLeaf);pa-=K(ya,pa+fa,this._passParameters,ha,ta.isLeaf);Ca=null!=Z.dist&&null!=ea.dist&&Z.dist<Ca*aa&&ea.dist>pa*aa;if(!(0>pa||Ca)&&(pa=J(ya,pa+fa,this._passParameters,ha,ta.isLeaf),ta.obb.intersectRay(O,R,pa))){pa*=pa;ta.obb.toAaBoundingBox(W);u.offset(W,-O[0],-O[1],-O[2],W);Ca=!u.contains(Y,W);e.subtract(X,ta.origin,O);var wa=ta.coordinates.length/3;for(let ua=0;ua<wa;ua++){P[0]=X[0]+ta.coordinates[3*
ua];P[1]=X[1]+ta.coordinates[3*ua+1];P[2]=X[2]+ta.coordinates[3*ua+2];if(Ca&&!u.containsPoint(Y,P))continue;var Ba=e.dot(P,R),la=e.squaredLength(P)-Ba*Ba;if(la>pa)continue;var qa=Ba+fa;const va=K(ya,qa,this._passParameters,ha,ta.isLeaf);if(0>Ba-va)continue;qa-=va;qa=J(ya,qa,this._passParameters,ha,ta.isLeaf);if(la>qa*qa)continue;const Ga=(Ba-va)*aa;Ba=La=>{var Na=ua,Wa=La.point;null==Wa&&(Wa=n.create());Wa[0]=ta.origin[0]+ta.coordinates[3*Na];Wa[1]=ta.origin[1]+ta.coordinates[3*Na+1];Wa[2]=ta.origin[2]+
ta.coordinates[3*Na+2];La.point=Wa;La.dist=Ga;La.normal=ba;La.node=ta;La.pointId=ua;La.layerUid=this.layerUid;return La};(null==Z.dist||Ga<Z.dist)&&(null==ia||ia(O,U,Ga))&&Ba(Z);T.options.store!==D.StoreResults.MIN&&(null==ea.dist||Ga>ea.dist)&&(null==ia||ia(O,U,Ga))&&Ba(ea);T.options.store!==D.StoreResults.ALL||null!=ia&&!ia(O,U,Ga)||(la=new Q,ca.push(Ba(la)))}}});const ja=ta=>{const {layerUid:ya,node:Ca,pointId:pa}=ta;return new q.PclTarget(ta.point,ya,pa,()=>this.createGraphic(Ca,pa,ta.point))},
oa=(ta,ya)=>{const Ca=ja(ya);ta.set(this.type,Ca,ya.dist,ya.normal)};if(S(Z)){var ra=T.results.min;(null==ra.dist||Z.dist<ra.dist)&&oa(ra,Z)}S(ea)&&T.options.store!==D.StoreResults.MIN&&(ra=T.results.max,(null==ra.dist||ea.dist>ra.dist)&&oa(ra,ea));if(T.options.store===D.StoreResults.ALL){ra=w.fromPoints(O,U);for(const ta of ca){const ya=y.newIntersectorResult(ra);oa(ya,ta);T.results.all.push(ya)}}}prepareTechnique(T){if(0===this._nodes.length||T.output!==p.ShaderOutput.Color&&(T.output!==p.ShaderOutput.LinearDepth||
T.bindParameters.slot!==E.RenderSlot.OPAQUE_NO_SSAO_DEPTH)&&T.output!==p.ShaderOutput.Highlight)return null;this._nodes.forAll(ia=>{null==ia.vao&&this._initNode(T,ia)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=T.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=
T.output;return this._context.techniqueRepository.releaseAndAcquire(G.PointRendererTechnique,this._techniqueConfig,this._technique)}renderNode(T,ia){const O=T.rctx,U=O.bindTechnique(ia,T.bindParameters,this._passParameters),P=T.output===p.ShaderOutput.Highlight;this._nodes.forAll(R=>{0===R.coordinates.length||P&&!R.highlights||(U.bindDraw(R,T.bindParameters,this._passParameters),O.bindVAO(R.vao),P?this._renderHighlightFragments(O,R):O.drawArrays(C.PrimitiveType.POINTS,0,R.coordinates.length/3))})}_renderHighlightFragments(T,
ia){var O=ia.highlights;if(null!=O){ia=O[0].component;var U=ia+1;for(let P=1;P<O.length;P++){const R=O[P].component;R!==U&&(U-=ia,0<U&&T.drawArrays(C.PrimitiveType.POINTS,ia,U),ia=R);U=R+1}O=U-ia;0<O&&T.drawArrays(C.PrimitiveType.POINTS,ia,O)}}set useFixedSizes(T){this._passParameters.useFixedSizes!==T&&(this._passParameters.useFixedSizes=T,this._requestRender())}get useFixedSizes(){return this._passParameters.useFixedSizes}set scaleFactor(T){this._passParameters.scaleFactor!==T&&(this._passParameters.scaleFactor=
T,this._requestRender())}get scaleFactor(){return this._passParameters.scaleFactor}set minSizePx(T){this._passParameters.minSizePx!==T&&(this._passParameters.minSizePx=T,this._requestRender())}get minSizePx(){return this._passParameters.minSizePx}set useRealWorldSymbolSizes(T){this._passParameters.useRealWorldSymbolSizes!==T&&(this._passParameters.useRealWorldSymbolSizes=T,this._requestRender())}get useRealWorldSymbolSizes(){return this._passParameters.useRealWorldSymbolSizes}set size(T){this._passParameters.size!==
T&&(this._passParameters.size=T,this._requestRender())}get size(){return this._passParameters.size}set sizePx(T){this._passParameters.sizePx!==T&&(this._passParameters.sizePx=T,this._requestRender())}get sizePx(){return this._passParameters.sizePx}set clippingBox(T){u.set(this._passParameters.clipBox,T||u.positiveInfinity)}get _clippingEnabled(){return!u.equals(this._passParameters.clipBox,u.positiveInfinity,(T,ia)=>T===ia)}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(T){this._slicePlaneEnabled!==
T&&(this._slicePlaneEnabled=T,this._requestRender())}addNode(T){this._nodes.push(T);this._highlights.nodeAdded(T);this._requestRender()}removeNode(T){let ia=null;this._nodes.filterInPlace(O=>O.id===T?(ia=O,O.vao=h.disposeMaybe(O.vao),this._highlights.nodeRemoved(O),!1):!0);this._requestRender();return ia}forEachNode(T){this._nodes.forAll(T)}removeAll(){this._nodes.forAll(T=>T.vao=h.disposeMaybe(T.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()}highlight(T){return this._highlights.add(T)}_addHighlight(T,
ia,O){var U=T.highlights;null==U&&(U=[]);ia={component:ia,id:O};U.push(ia);ia=I(ia);for(O=U.length-1;0<O&&ia<I(U[O-1]);)[U[O-1],U[O]]=[U[O],U[O-1]],--O;T.highlights=U;this._requestRender()}_removeHighlight(T,ia){T.highlights=M(T.highlights,ia);this._requestRender()}_initNode(T,ia){T=T.rctx;ia.vao=new A.VertexArrayObject(T,r.Default3D,N,{positions:L.BufferObject.createVertex(T,C.Usage.STATIC_DRAW,ia.coordinates),colors:L.BufferObject.createVertex(T,C.Usage.STATIC_DRAW,ia.rgb)})}_requestRender(){this._context&&
this._context.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.PointRenderer.prototype,"createGraphic",void 0);a.PointRenderer=b.__decorate([g.subclass("esri.views.3d.layers.i3s.PointRenderer")],a.PointRenderer);class V extends F.PointRendererDrawParameters{constructor(T,ia,O,U,P,R,ba,X,da=null,ha=null){super(O,P,ia);this.id=T;this.obb=U;this.coordinates=R;this.rgb=ba;this.attributes=X;this.pointIdFilterMap=da;this.highlights=ha}}class Q{constructor(){this.normal=this.dist=this.point=
this.pointId=this.node=null;this.layerUid=""}}a.PointRendererNode=V;a.isPointRendererNode=function(T){return T.hasOwnProperty("splatSize")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../core/handleUtils","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Object3DStateID"],function(a,b,h,c){class k{constructor(d){this._context=d;this._highlights=new Set}get empty(){return 0===this._highlights.size}destroy(){this._highlights=
null}add(d){const f=new m(d);this._highlights.add(f);this._enableSet(f);return b.makeHandle(()=>this._removeSet(f))}_removeSet(d){this._disableSet(d);this._highlights.delete(d)}_enableSet(d){d.enabled||(d.enabled=!0,this._context.forEachNode(f=>this._enableSetForNode(d,f)))}_enableSetForNode(d,f){if(d.enabled){var g=d.ids.get(f.id);g&&g.forEach(e=>this._context.addHighlight(f,e,d.id))}}_disableSet(d){d.enabled&&(d.enabled=!1,this._context.forEachNode(f=>this._disableSetForNode(d,f)))}_disableSetForNode(d,
f){d.enabled||this._context.removeHighlight(f,d.id)}nodeAdded(d){this._highlights.forEach(f=>this._enableSetForNode(f,d))}nodeRemoved(d){this._highlights.forEach(f=>this._disableSetForNode(f,d))}removeAll(){this._highlights.forEach(d=>this._disableSet(d))}}class m{constructor(d){this.id=new c.Object3DStateID(h.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const f of d)null!=f&&this._add(f.nodeId,f.pointId)}_add(d,f){const g=this.ids.get(d);g?g.add(f):this.ids.set(d,new Set([f]))}}
a.PointHighlights=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D){function E(C){const z=new y.ShaderBuilder,J=C.output===n.ShaderOutput.Color,K=C.output===n.ShaderOutput.LinearDepth,I=C.output===n.ShaderOutput.Highlight,{vertex:M,fragment:S}=z;z.include(l.SliceDraw,C);z.attributes.add(D.VertexAttribute.POSITION,"vec3");z.attributes.add(D.VertexAttribute.COLOR,"vec3");M.uniforms.add(new t.Matrix4DrawUniform("modelView",(N,V)=>h.multiply(G,V.camera.viewMatrix,h.fromTranslation(G,N.origin))),new r.Matrix4PassUniform("proj",
(N,V)=>V.camera.projectionMatrix),new w.Float2DrawUniform("screenMinMaxSize",(N,V,Q)=>k.set(L,Q.useFixedSizes?0:Q.minSizePx*V.camera.pixelRatio,(N.isLeaf?256:64)*V.camera.pixelRatio)),C.useFixedSizes?new q.Float2PassUniform("pointScale",(N,V)=>k.set(L,N.fixedSize*V.camera.pixelRatio,V.camera.fullHeight)):new w.Float2DrawUniform("pointScale",(N,V,Q)=>k.set(L,N.splatSize*Q.scaleFactor*V.camera.pixelRatio,V.camera.fullHeight/V.camera.pixelRatio)));C.clippingEnabled?M.uniforms.add(new v.Float3DrawUniform("clipMin",
(N,V,Q)=>d.set(H,Q.clipBox[0]-N.origin[0],Q.clipBox[1]-N.origin[1],Q.clipBox[2]-N.origin[2])),new v.Float3DrawUniform("clipMax",(N,V,Q)=>d.set(H,Q.clipBox[3]-N.origin[0],Q.clipBox[4]-N.origin[1],Q.clipBox[5]-N.origin[2]))):(M.constants.add("clipMin","vec3",[-b.numberMaxFloat32,-b.numberMaxFloat32,-b.numberMaxFloat32]),M.constants.add("clipMax","vec3",[b.numberMaxFloat32,b.numberMaxFloat32,b.numberMaxFloat32]));K?(e.addNearFar(z),e.addCalculateLinearDepth(z),z.varyings.add("depth","float")):C.output!==
n.ShaderOutput.Highlight&&z.varyings.add("vColor","vec3");M.code.add(p.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${C.drawScreenSize?p.glsl`
      float clampedScreenSize = pointSize;`:p.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${K?p.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${J?p.glsl`vColor = color;`:""}
    }
  `);S.include(x.RgbaFloatEncoding,C);I&&z.include(u.OutputHighlight,C);S.code.add(p.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${K?p.glsl`fragColor = float2rgba(depth);`:""}
      ${I?p.glsl`outputHighlight();`:""}
      ${J?p.glsl`fragColor = vec4(vColor, 1.0);`:""}
    }
  `);return z}function A(C){return C?256:64}class B extends p.NoParameters{constructor(){super(...arguments);this.clipBox=g.create(g.positiveInfinity);this.useRealWorldSymbolSizes=this.useFixedSizes=!1;this.scaleFactor=1;this.sizePx=this.size=this.minSizePx=0}get fixedSize(){return this.drawScreenSpace?this.sizePx:this.size}get screenMinSize(){return this.useFixedSizes?0:this.minSizePx}get drawScreenSpace(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}class F extends l.SlicePlaneParameters{constructor(C,
z,J){super(C);this.origin=C;this.isLeaf=z;this.splatSize=J}}const G=c.create(),H=f.create(),L=m.create();c=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:F,PointRendererPassParameters:B,build:E,getMaxPointSizeScreenspace:A},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=F;a.PointRendererPassParameters=B;a.PointRendererShader=c;a.build=E;a.getMaxPointSizeScreenspace=A})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,h,c,k,m,d,f,g,e){class n extends c.ShaderTechnique{constructor(l,u,x){super(l,u,x)}initializeProgram(l){return new m.Program(l.rctx,n.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({depthTest:{func:g.CompareFunction.LESS},depthWrite:e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?d.stencilBaseAllZerosParams:
null})}}n.shader=new h.ReloadableShaderModule(f.PointRendererShader,()=>new Promise((l,u)=>a(["./PointRenderer.glsl"],l,u)));b.PointRendererTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,h,
c,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=h.ShaderOutput.Color;this.clippingEnabled=this.hasOccludees=this.useFixedSizes=this.drawScreenSize=this.hasSlicePlane=!1}}b.__decorate([c.parameter({count:h.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([c.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],m.prototype,"drawScreenSize",void 0);b.__decorate([c.parameter()],m.prototype,"useFixedSizes",void 0);
b.__decorate([c.parameter()],m.prototype,"hasOccludees",void 0);b.__decorate([c.parameter()],m.prototype,"clippingEnabled",void 0);b.__decorate([c.parameter({constValue:!0})],m.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,h,c,k,m,d,f,g){a.PopupSceneLayerView=e=>{e=class extends e{_validateFetchPopupFeatures(n){const {layer:l}=this,{popupEnabled:u}=l;if(!u)throw new h("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:l});if(!g.getFetchPopupTemplate(l,n))throw new h("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:l});}async prepareFetchPopupFeatures(n){}async fetchPopupFeaturesFromGraphics(n,l){this._validateFetchPopupFeatures(l);if(0===n.length)return[];
const u="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;var x=[];"fieldsIndex"in this.layer&&(x=f.unpackFieldNames(this.layer.fieldsIndex,await g.getRequiredFields(u,g.getFetchPopupTemplate(this.layer,l))));await this.prepareFetchPopupFeatures(x);l=new Set;const w=[],q=[];for(const p of n)f.populateMissingFields(x,p,l)?q.push(p):w.push(p);if(0===q.length)return w;const v=new Map;for(x=0;x<n.length;x++)v.set(n[x].getObjectId()??0,x);n=await this.whenGraphicAttributes(q,
[...l]).catch(()=>q).then(p=>w.concat(p));n.sort((p,t)=>{p=p.getObjectId()??0;p=v.get(p)??0;t=t.getObjectId()??0;t=v.get(t)??0;return p-t});return n}};return e=b.__decorate([d.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/ReactiveSet ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/featureEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S){f=L.defineFieldProperties();q=class extends q.I3SMeshView3D(J.TemporalSceneLayerView(H.DefinitionExpressionSceneLayerView(C.PopupSceneLayerView(p.LayerView3D(I))))){constructor(){super(...arguments);this.type="scene-layer-3d";this._setVisibilityHiddenObjectIds=new k;this.progressiveLoadFactor=1;this._elevationContext="scene";this._isIntegratedMesh=!1;this._supportsLabeling=!0;this._pendingEditsQueue=Promise.resolve();
this._interactiveEditingSessions=new Map;this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(N,V){return N.url===this.layer.url&&this.i3sOverrides.isEmpty?N.load(V).then(()=>{G.checkRecyclable(this.layer,N,this.i3sOverrides);this.layer=N;this.i3sOverrides.destroy();this.i3sOverrides=new E.I3SOverrides({view:this.view,layer:N,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&
M.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(N){this._set("filter",y.I3SMeshViewFilter.checkSupport(N)?N:null)}get viewFilter(){const N=this.mergedFilter,V=this.layerFilter;if(null==N&&null==V)return null;const Q=this._get("viewFilter");if(null==Q)return new y.I3SMeshViewFilter({layerFilter:V,viewFilter:N,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:T=>this._loadAsyncModule(T),addSqlFilter:(T,ia)=>this.addSqlFilter(T,
ia,this.logError),addTimeFilter:(T,ia)=>this.addTimeFilter(T,ia)});Q.viewFilter=N;Q.layerFilter=V;return Q}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const N=u.getFloorFilterClause(this);return null!=N?n.WhereClause.create(N,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){const N=this.layer.excludeObjectIds.toArray();return N.length?N.sort((V,Q)=>V-Q):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?
Array.from(this._setVisibilityHiddenObjectIds).sort((N,V)=>N-V):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}initialize(){this._fieldsHelper=new z.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,V=>this._rangeInfosChanged(V),m.initial);this._updatingHandles.add(()=>
this.layer.renderer,V=>this._updatingHandles.addPromise(this._rendererChange(V)),m.initial);const N=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,N);this._updatingHandles.add(()=>this.mergedFilter,N);this._updatingHandles.add(()=>this._floorFilterClause,N);this._updatingHandles.add(()=>this._excludeObjectIdsSorted,N);this._updatingHandles.add(()=>this._setVisibilityHiddenObjectIdsSorted,N);this._updatingHandles.add(()=>this.viewFilter?.sortedObjectIds,N);this._updatingHandles.add(()=>
this.viewFilter?.parsedWhereClause,N);this._updatingHandles.add(()=>this.getTimeFilterDependencies(),N);this._updatingHandles.add(()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship],()=>this._geometryFilterChange());w.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&this._updatingHandles.add(()=>this.i3sOverrides.sortedGeometryChangedObjectIds,N);this.addHandles(this.layer.on("apply-edits",V=>this._updatingHandles.addPromise(V.result)));
this.addHandles(this.layer.on("edits",V=>{const Q=this._pendingEditsQueue.then(()=>this._handleEdits(V)).then();this._pendingEditsQueue=Q;this._updatingHandles.addPromise(Q)}))}destroy(){this._fieldsHelper=c.destroyMaybe(this._fieldsHelper)}_rangeInfosChanged(N){null!=N&&0<N.length&&h.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const N={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};
return this.mergedFilter?.createQuery(N)??new x(N)}queryExtent(N,V){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(N),V?.signal)}queryFeatureCount(N,V){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(N),V?.signal)}queryFeatures(N,V){return this._ensureQueryEngine().executeQuery(this._ensureQuery(N),V?.signal).then(Q=>{if(!Q?.features)return Q;const T=this.layer;for(const ia of Q.features)ia.layer=T,ia.sourceLayer=T;return Q})}queryObjectIds(N,V){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(N),
V?.signal)}_ensureQueryEngine(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine}_createQueryEngine(){const N=r.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new A.I3SQueryEngine({layerView:this,priority:S.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new F.I3SQueryFeatureStore({featureAdapter:new B.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??
[],getFeatureExtent:N}),forAllFeatures:(V,Q)=>this._forAllFeatures((T,ia,O)=>V({id:T,index:ia,meta:O}),Q,v.ForAllFeaturesMode.QUERYABLE),getFeatureExtent:N,sourceSpatialReference:G.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(N){const V=this._highlights;if(N instanceof x){const {set:Q,handle:T}=V.acquireSet();this.queryObjectIds(N).then(ia=>V.setFeatureIds(Q,ia));return T}return super.highlight(N)}createInteractiveEditSession(N){return t.createInteractiveEditSession(this._attributeEditingContext,
N)}_createLayerGraphic(N){N=new b(null,null,N);N.layer=this.layer;N.sourceLayer=this.layer;return N}getFilters(){const N=super.getFilters();w.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.sortedGeometryChangedObjectIds.length&&N.push((T,ia)=>{0<=ia.node.index&&G.objectIdFilter(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,T)});const V=this._setVisibilityHiddenObjectIdsSorted;null!=V&&N.push(T=>G.objectIdFilter(V,!1,T));const Q=this._excludeObjectIdsSorted;null!=
Q&&N.push(T=>G.objectIdFilter(Q,!1,T));this._floorFilterClause&&this.addSqlFilter(N,this._floorFilterClause,this.logError);this.addSqlFilter(N,this.parsedDefinitionExpression,this.logError);null!=this.viewFilter&&this.viewFilter.addFilters(N,this.view,this._controller.crsIndex,this._collection);return N}setVisibility(N,V){V?this._setVisibilityHiddenObjectIds.delete(N):this._setVisibilityHiddenObjectIds.add(N)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&
this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(N){return this._addDefinitionExpressionToQuery(null==N?this.createQuery():x.from(N))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:N=>this._forAllNodes(V=>null!=V?N(V.node,V.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],
i3sOverrides:this.i3sOverrides,getAttributeData:N=>this.getAttributeData(N),setAttributeData:(N,V)=>this.setAttributeData(N,V),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(N){const V=w.sceneLayerEditingEnabled(),Q=this._attributeEditingContext;N=await t.normalizeEditResultsEvent(Q,N);V&&t.processGeometryEdits(Q,N);t.processAttributeEdits(Q,N)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(N){const V=this.viewFilter;return null==V||!this.view.spatialReference||
V.isMBSGeometryVisible(N,this.view.spatialReference,this._controller.crsIndex)?D.NodeFilterImpact.Unmodified:D.NodeFilterImpact.Culled}};a.__decorate([d.property()],q.prototype,"i3slayer",null);a.__decorate([d.property(K.updatingProgress)],q.prototype,"updatingProgress",void 0);a.__decorate([d.property({type:l})],q.prototype,"filter",null);a.__decorate([d.property({readOnly:!0})],q.prototype,"viewFilter",null);a.__decorate([d.property(f.requiredFields)],q.prototype,"requiredFields",null);a.__decorate([d.property(f.availableFields)],
q.prototype,"availableFields",void 0);a.__decorate([d.property()],q.prototype,"_fieldsHelper",void 0);a.__decorate([d.property()],q.prototype,"_floorFilterClause",null);a.__decorate([d.property()],q.prototype,"_excludeObjectIdsSorted",null);a.__decorate([d.property()],q.prototype,"_setVisibilityHiddenObjectIds",void 0);a.__decorate([d.property()],q.prototype,"_setVisibilityHiddenObjectIdsSorted",null);a.__decorate([d.property()],q.prototype,"lodFactor",null);a.__decorate([d.property()],q.prototype,
"updatingProgressValue",null);return q=a.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],q)})},"esri/core/ReactiveSet":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b){class h{constructor(c){this._observable=new b.SimpleObservable;this._set=new Set(c)}get size(){a.trackAccess(this._observable);return this._set.size}add(c){const k=this._set.size;this._set.add(c);this._set.size!==k&&this._observable.notify();return this}clear(){0<
this._set.size&&(this._set.clear(),this._observable.notify())}delete(c){(c=this._set.delete(c))&&this._observable.notify();return c}entries(){a.trackAccess(this._observable);return this._set.entries()}forEach(c,k){a.trackAccess(this._observable);this._set.forEach((m,d)=>c.call(k,m,d,this),k)}has(c){a.trackAccess(this._observable);return this._set.has(c)}keys(){a.trackAccess(this._observable);return this._set.keys()}values(){a.trackAccess(this._observable);return this._set.values()}[Symbol.iterator](){a.trackAccess(this._observable);
return this._set[Symbol.iterator]()}get [Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}return h})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/Collection ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/projection/localLinearScaleFactors ../../../geometry/projection/projectBoundingSphere ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshViewPerformanceInfo ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./i3s/LayerElevationProvider ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/ElevationRange ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja,oa,ra,ta,ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La,Na,Wa,Ia,Oa,Ua,Va,Ra,bb,gb,db,ka,mb,sb,tb){function xa(jb,sa){w.isAbortError(jb)||n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while processing edges. Edges on this layer might not display correctly",sa,jb)}function Ha(jb){if(null==jb)return!1;const sa=jb.metallicRoughness;return sa&&0<=sa.baseColorTextureId||
sa&&0<=sa.metallicRoughnessTextureId||0<=jb.normalTextureId||0<=jb.emissiveTextureId||0<=jb.occlusionTextureId}function na(jb){return null!=jb&&p.isArrayBuffer(jb.data)}function za(jb,sa){jb=1024+jb.interleavedVertexData.byteLength+(jb.indices?jb.indices.byteLength:0)+jb.positionData.data.byteLength+jb.positionData.indices.byteLength;if(null!=sa)for(const Fa of sa)null!=Fa&&p.isArrayBuffer(Fa.data)&&(jb+=Fa.data.byteLength);return jb}function Da(jb,sa){return sa.byteSize>lb?(n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Node is too big to store in IndexedDB cache: ${jb.id} (${sa.byteSize} bytes)`),
!1):0<sa.byteSize}function Ma(jb){if(0!==jb.length){var sa=new Float64Array(10*jb.length),Fa=0;jb.forAll(Pa=>{let Ta=Pa.serviceObbInIndexSR;null==Ta&&(Ta=Jb,Ta.center=O.getCenter(Pa.serviceMbsInIndexSR),Ta.halfSize=[Pa.serviceMbsInIndexSR[3],Pa.serviceMbsInIndexSR[3],Pa.serviceMbsInIndexSR[3]]);Pa=Ta.data;sa[Fa++]=Pa[0];sa[Fa++]=Pa[1];sa[Fa++]=Pa[2];sa[Fa++]=Pa[3];sa[Fa++]=Pa[4];sa[Fa++]=Pa[5];sa[Fa++]=Pa[6];sa[Fa++]=Pa[7];sa[Fa++]=Pa[8];sa[Fa++]=Pa[9]});return sa}}function Xa(jb,sa){jb.forEach(Fa=>
Fa.opacity=sa)}function ab(jb){return sa=>{if(jb.immediate)return jb.immediate.schedule(sa);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}function Ja(jb,sa,Fa){let Pa=jb.elevationRangeMin,Ta=jb.elevationRangeMax;if(0<Fa){sa.getCorners(Ob);for(const hb of Ob){var $a=G.len(hb)-Fa;Pa=Math.min(Pa,$a);Ta=Math.max(Ta,$a)}}else{sa.getCorners(Ob);for($a of Ob)Fa=$a[2],Pa=Math.min(Pa,Fa),Ta=Math.max(Ta,Fa)}jb.expandElevationRangeValues(Pa,Ta)}function Qa(jb,sa,
Fa){const Pa=O.getCenter(sa);Fa=0<Fa?G.len(Pa)-Fa:Pa[2];sa=O.getRadius(sa);jb.expandElevationRangeValues(Fa-sa,Fa+sa)}const Sa=[1,1,1,1];class cb extends pa.NodeCrossfadeMetaData{constructor(jb,sa,Fa,Pa,Ta,$a,hb,ib,ob){super();this.node=jb;this.featureIds=sa;this.objectHandle=Fa;this.cachedRendererVersion=Pa;this.attributeInfo=Ta;this.material=$a;this.textures=hb;this.anchorIds=ib;this.anchors=ob;this.cachedElevationAnchors=null;this.cachedEdgeMaterials=[];this.edgeMemoryUsage=0}}var eb;(function(jb){jb[jb.CastShadows=
4]="CastShadows";jb[jb.Pickable=5]="Pickable"})(eb||={});const lb=100*d.ByteSizeUnit.MEGABYTES;var rb;(function(jb){jb[jb.ADD=0]="ADD";jb[jb.REMOVE=1]="REMOVE";jb[jb.UPDATE=2]="UPDATE"})(rb||={});const vb=N.create(),pb=V.create(),Db=V.create(),Jb=new bb.Obb,Rb=[0,0,0,0],ac=new c([0,0,0,0]),kc=O.fromValues(0,0,0,0);class gc{constructor(jb,sa){this.mode=jb;this.offset=sa}}const Fb=H.create(),Tb=N.create(),Ob=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ub=new Va.ElevationRange;
b.I3SMeshView3D=jb=>{jb=class extends jb{constructor(...sa){super(sa);this._needsNormals=!0;this._updatingHandles=new z.UpdatingHandles;this._nodeId2Meta=new Map;this._nodeId2MetaReloading=new Map;this._i3sWasmLoaded=!1;this._snappingSourcesTrackers=[];this._hasLoadedPBRTextures=!1;this._asyncModuleLoading=0;this._addTasks=new Map;this._currentRenderer=null;this._rendererVersion=0;this._symbologyOverrideFields=this._symbologyOverride=this._symbologyFields=this._rendererFields=this._opacityVariable=
this._colorVariable=null;this._symbolInfos=new Map;this._visibleGeometryChangedSchedulerHandle=null;this._hasVertexColors=this._hasComponentData=!1;this._nodeColorOverride=null;this.updating=!0;this.holeFilling="auto";this.slicePlaneEnabled=this._hasData=this._hasTextures=this._hasColors=!1;this._modifications=[];this.ignoresMemoryFactor=!1;this._layerUrl="";this._cacheKeySuffix=null;this._planetRadiusInGlobalMode=0;this._elevationTask=null;this._filters=[];this._arcade=null;this._tmpAttributeOnlyGraphic=
new k(null,null,{});this._crossfadeHelper=new pa.I3SCrossfadeHelper(this)}get lodCrossfadeoutDuration(){return 0}get lodCrossfadeinDuration(){return 0}get lodCrossfadeUncoveredDuration(){return 0}get layerUid(){return this.i3slayer&&this.i3slayer.uid}get sublayerUid(){return null}get layerId(){return this.i3slayer&&this.i3slayer.id}get sublayerId(){return null}get contentVisible(){return!this.suspended&&this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}get updatingProgressValue(){return this._controller?.updatingProgress??
0}get hasTexturesOrVertexColors(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}get rendererTextureUsage(){return Ga.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?ta.TextureUsage.AllTexturesPBR:ta.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?ta.TextureUsage.GeometryTexturesPBR:ta.TextureUsage.GeometryTextures}get elevationOffset(){const sa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=
sa&&"absolute-height"===sa.mode){const Fa=t.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Pa=Z.getMetersPerUnit(sa.unit);return(sa.offset??0)*Pa/Fa}return 0}get elevationInfo(){const sa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==sa)return new gc(Y.ElevationMode.Absolute,0);var Fa=t.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Pa=Z.getMetersPerUnit(sa.unit);Fa=(sa.offset??0)*Pa/Fa;switch(sa.mode){case "absolute-height":return new gc(Y.ElevationMode.Absolute,
Fa);case "relative-to-ground":return new gc(Y.ElevationMode.RelativeToGround,Fa);case "on-the-ground":return new gc(Y.ElevationMode.OnTheGround,0);default:return new gc(Y.ElevationMode.Absolute,0)}}get supportedTextureEncodings(){return la.getSupportedEncodings(this.view._stage.renderView.capabilities)}get uncompressedTextureDownsamplingEnabled(){const sa=0===(this.supportedTextureEncodings&ta.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&
sa}get clientGeometry(){return this.i3sOverrides.geometryOverrides}get elevationRange(){var sa=this._nodeId2Meta;const Fa=new Va.ElevationRange;for(const Pa of sa.values()){if(null==Pa)continue;({node:{serviceMbsInIndexSR:sa}}=Pa);const [,Ta,$a]=sa;Fa.expandElevationRangeValues(Ta-$a,Ta+$a)}return Fa.elevationRangeValid?Fa:null}get fullExtent(){return this.i3slayer.fullExtent}initialize(){var sa=e("enable-feature:idb-mock-cache");this._idbCache=sa?new Na.IDBMockCache(this.view,sa):new La.IDBCache("esri-scenelayer-cache",
"geometries");this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);sa=this.view.resourceController;this.i3sOverrides=new ua.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:sa.memoryController});this._worker=new W.I3SMeshWorkerHandle(ab(sa));this.addResolvingPromise(this._worker.promise);sa=this.i3slayer.store;this._worker.setLegacySchema(this.uid,sa.defaultGeometrySchema);Ga.checkSceneLayerValid(this.i3slayer);Ga.checkSceneLayerCompatibleWithView(this.i3slayer,
this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new R({layerView:this,worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();sa=sa.defaultGeometrySchema;if(this._isIntegratedMesh||!sa)this._hasComponentData=!1;else{const ib=sa.featureAttributes;this._hasComponentData=!!(ib&&ib.faceRange&&ib.id)}this._hasVertexColors=
null!=(sa?.vertexAttributes.color??null)&&!this.i3slayer.cachedDrawingInfo?.color;this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,ib=>this._deleteComponentObject(ib));const Fa=this._controller,Pa=this._nodeId2Meta,Ta=this._nodeId2MetaReloading;this._intersectionHandler=new Ba.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,
isGround:this._isIntegratedMesh,traverseNodeHierarchy:ib=>{const ob=Fa.index;if(ob){var qb=ob.rootNode;qb&&ob.traverse(qb,yb=>{var wb=yb.index;wb=Pa.get(wb)||Ta.get(wb);return ib(yb,wb?.objectHandle??null)})}}});this._updatingHandles.add(()=>this.layerUid,ib=>this._intersectionHandler.layerUid=ib);this._updatingHandles.add(()=>this.sublayerUid,ib=>this._intersectionHandler.sublayerUid=ib);this._elevationProvider=new Wa.LayerElevationProvider({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler});
this._hasLoadedPBRTextures=this._usePBR;this._updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),q.initial);this._updatingHandles.add(()=>this.fullOpacity,ib=>this._opacityChange(ib));this._updatingHandles.add(()=>this.slicePlaneEnabled,ib=>this._slicePlaneEnabledChange(ib));this._updatingHandles.add(()=>this.elevationOffset,(ib,ob)=>{this._reloadAll(ob);this._controller.invalidateVisibilityObbs()});this._updatingHandles.add(()=>this.elevationInfo,(ib,ob)=>this._elevationInfoChanged(ib,
ob),q.initial);this._updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==Y.ElevationMode.Absolute,(ib,ob)=>{ib?this.addHandles(this.view.basemapTerrain.on("elevation-change",({extent:qb})=>this._ensureElevationTask().addExtent(qb)),"elevation-change"):ob&&this.removeHandles("elevation-change")},q.initial);this._updatingHandles.add(()=>this._usePBR,ib=>this._updatePBR(ib));sa=()=>{this._reloadAll();this.clearMemCache()};this._updatingHandles.add(()=>this.rendererTextureUsage,sa);this._updatingHandles.add(()=>
this.uncompressedTextureDownsamplingEnabled,sa);this._updatingHandles.add(()=>this.contentVisible,ib=>this._contentVisibleChanged(ib),q.initial);this._updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),q.initial);this._updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),q.initial);this._updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),q.initial);this.addHandles([q.watch(()=>Ua.debugFlags.I3S_TREE_SHOW_TILES,ib=>{if(ib&&
!this._treeDebugger){const ob=this._controller.crsIndex;(new Promise((qb,yb)=>a(["./support/I3STreeDebugger"],qb,yb))).then(({I3STreeDebugger:qb})=>{!this._treeDebugger&&Ua.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new qb({lv:this,view:this.view,nodeSR:ob}))})}else ib||Ua.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger=u.destroyMaybe(this._treeDebugger))},q.initial),q.watch(()=>Ua.debugFlags.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),q.initial)]);this._cacheKeySuffix=Ga.getCacheKeySuffix(this.i3slayer.spatialReference,
this.view.renderSpatialReference);this._idbCache.init().catch(ib=>n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to initialize IndexedDB cache: ${ib}`));({view:sa}=this);const {viewingMode:$a,renderCoordsHelper:hb}=sa;this._planetRadiusInGlobalMode="local"===$a?0:hb.referenceEllipsoid.radius}destroy(){this._clearAddTasks();this._elevationTask=u.destroyMaybe(this._elevationTask);this.i3sOverrides=u.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.objectsChanged(this.getVisibleObbs()),
this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const sa=this._worker;sa&&(sa.destroyContext(this.uid).then(()=>sa.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=u.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=u.destroyMaybe(this._labeler);
this._treeDebugger=u.destroyMaybe(this._treeDebugger);this._controller=u.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=u.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null);this._updatingHandles=u.destroyMaybe(this._updatingHandles)}_memEstimateTextureAdded(sa){sa=
sa.memoryEstimate;this._gpuMemoryEstimate+=sa;this._texMemoryEstimate+=sa;return sa}_memEstimateTextureRemoved(sa){null!=sa&&(sa=sa.memoryEstimate,this._gpuMemoryEstimate-=sa,this._texMemoryEstimate-=sa)}_memEstimateGeometryAdded(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);this._gpuMemoryEstimate+=sa;this._geoMemoryEstimate+=sa;return sa}_memEstimateGeometryRemoved(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);this._gpuMemoryEstimate-=sa;this._geoMemoryEstimate-=sa}isNodeLoaded(sa){return this._nodeId2Meta.has(sa)}isNodeReloading(sa){return this._nodeId2MetaReloading.has(sa)}get usedMemory(){let sa=
null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Fa=>sa+=null!=Fa?Fa.node.memory:0);this._nodeId2MetaReloading.forEach(Fa=>sa+=null!=Fa?Fa.node.memory:0);return sa}get unloadedMemory(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}_labelingChanged(){if(!ra.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==
this._labeler){var sa=new ea({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(Fa=>null!=Fa&&this._addMetaToLabeler(sa,Fa));this._labeler=sa}}_loadAsyncModule(sa){++this._asyncModuleLoading;return sa.then(Fa=>{--this._asyncModuleLoading;return Fa},Fa=>{--this._asyncModuleLoading;throw Fa;})}_modificationsChanged(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=ja.initialize().then(()=>{this._i3sWasmLoaded=!0;
this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var sa=this.uid,Fa=this.i3slayer.spatialReference;this._worker.setModifications(sa,this._layerClippingArea,this._modifications,Fa);var Pa=W.toWasmModification(this._layerClippingArea,this._modifications,Fa);ja.setModificationsSync({context:sa,modifications:Pa,isGeodetic:Fa.isGeographic});this._controller.modificationsChanged();var Ta=this.hasModifications?new x:null;this._nodeId2Meta.forEach(($a,
hb)=>{null==$a?(this._nodeId2Meta.delete(hb),this._controller.updateLoadStatus(hb,!1)):$a.node.hasModifications?(this._nodeId2Meta.delete(hb),this._nodeId2MetaReloading.set(hb,$a)):null!=Ta&&Ta.push($a.node)});this.notifyChange("elevationRange");null!=Ta&&this._nodeId2MetaReloading.forEach($a=>Ta.push($a.node));null!=Ta&&0<Ta.length&&(this.updateNodeModificationStatus(Ta),Ta.forAll($a=>{if($a.imModificationImpact!==qa.NodeIMModificationImpact.Culled){const hb=this._nodeId2Meta.get($a.index);this._controller.invalidateGeometryVisibility($a.index);
null!=hb?(this._nodeId2Meta.delete($a.index),this._nodeId2MetaReloading.set($a.index,hb),this.notifyChange("elevationRange")):this._nodeId2Meta.has($a.index)&&(this._nodeId2Meta.delete($a.index),this._controller.updateLoadStatus($a.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}}_showModifications(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(Ua.debugFlags.I3S_SHOW_MODIFICATIONS&&
0!==this._modifications.length){var sa={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Fa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Pa of this._modifications){const Ta=Pa.geometry;Ta.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new k({geometry:Ta,symbol:{...Fa,color:sa[Pa.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}}_addMetaToLabeler(sa,Fa){sa.addNodeMeta(Fa,(Pa,Ta)=>
this._createAttributes(Pa,Ta))}_contentVisibleChanged(sa){sa?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))}getLoadedAttributes(sa){sa=this._nodeId2Meta.get(sa);
if(null!=sa?.attributeInfo)return sa.attributeInfo.loadedAttributes}getAttributeData(sa){sa=this._nodeId2Meta.get(sa);if(null!=sa?.attributeInfo)return sa.attributeInfo.attributeData}setAttributeData(sa,Fa){sa=this._nodeId2Meta.get(sa);null!=sa?.attributeInfo&&(sa.attributeInfo.attributeData=Fa,this._attributeValuesChanged(sa))}async updateAttributes(sa,Fa,Pa){const Ta=this._nodeId2Meta.get(sa);null!=Ta&&(await this.i3sOverrides.applyAttributeOverrides(Ta.featureIds,Fa,Pa,this._controller.requiredAttributes),
Ta.attributeInfo=Fa,this._controller.reschedule(()=>this._attributeValuesChanged(Ta),Pa).catch($a=>{w.isAbortError($a)||n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while updating attribute values. Layer might not display correctly.",$a)}))}_attributeValuesChanged(sa){sa.cachedRendererVersion=this._getInvalidRendererVersion();sa.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(sa,(Fa,Pa)=>this._createAttributes(Fa,Pa));this._updateEngineObject(sa)}clearMemCache(){null!=
this._memCache&&this._memCache.clear()}getVisibleNodes(){const sa=[];this._nodeId2Meta.forEach(Fa=>null!=Fa&&sa.push(Fa.node));return sa}getVisibleObbs(){const sa=[];this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(Fa=this.getNodeComponentObb(Fa.node),null!=Fa&&sa.push(Fa))});return sa}getNodeComponentObb(sa){sa=this._nodeId2Meta.get(sa.index)??this._nodeId2MetaReloading.get(sa.index);return null!=sa?this._collection.getComponentObb(sa.objectHandle):null}getLoadedNodeIndices(sa){this._nodeId2Meta.forEach((Fa,
Pa)=>sa.push(Pa));this._nodeId2MetaReloading.forEach((Fa,Pa)=>sa.push(Pa))}_preLoadBasis(){!e("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ta.TextureEncoding.Basis)&&this.i3slayer.textureSetDefinitions?.some(sa=>sa.formats.some(Fa=>"basis"===Fa.format||"ktx2"===Fa.format))&&sb.loadBasis()}_getVertexBufferLayout(sa,Fa){sa={hasTexture:Ha(sa.params.material),hasNormals:Fa.normal,hasRegions:Fa.uvRegion};return db.glLayout(ka.createVertexBufferLayout(this._getGeometryParameters(sa)))}_getObjectIdField(){return this.i3slayer.objectIdField||
P.fallbackObjectIDAttribute}_getGlobalIdField(){return this.i3slayer.associatedLayer?.globalIdField}_findGraphicNodeAndIndex(sa){const Fa=Ia.attributeLookup(this.i3slayer.fieldsIndex,sa.attributes,this._getObjectIdField());let Pa=null;l.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;const $a=Ta.featureIds.indexOf(Fa);if(-1===$a)return!1;Pa={node:Ta.node,index:$a};return!0});return Pa}_getGraphicIndices(sa,Fa){sa=this._nodeId2Meta.get(sa.index);if(null==sa)return[];const Pa=[],Ta=this._getObjectIdField(),
$a=this.i3slayer.fieldsIndex;for(const hb of Fa)Fa=Ia.attributeLookup($a,hb.attributes,Ta),Fa=sa.featureIds.indexOf(Fa),-1!==Fa&&Pa.push(Fa);return Pa}whenGraphicBounds(sa){sa=this._findGraphicNodeAndIndex(sa);if(!sa)return Promise.reject();sa=this._getAABB(sa.node.index,sa.index);return null==sa?Promise.reject():Promise.resolve({boundingBox:sa,screenSpaceObjects:[]})}getAABBFromIntersectorTarget(sa){return null==sa.nodeIndex||null==sa.componentIndex?null:this._getAABB(sa.nodeIndex,sa.componentIndex)}_getAABB(sa,
Fa){sa=this._nodeId2Meta.get(sa);if(null==sa?.featureIds||Fa>=sa.featureIds.length)return null;Fa=wa.boundingBoxCornerPoints(Fa,this._collection,sa.objectHandle,Q.newDoubleArray(24),0);if(!I.projectBuffer(Fa,this.view.renderSpatialReference,0,Fa,this.view.spatialReference,0,8))return null;sa=N.empty();N.expandWithBuffer(sa,Fa,0,8);return sa}whenGraphicAttributes(sa,Fa){return Ga.whenGraphicAttributes(this.i3slayer,sa,this._getObjectIdField(),Fa,()=>[...this._nodeId2Meta.values()].filter(m.isSome))}getGraphicFromIntersectorTarget(sa){if(null==
sa.nodeIndex||null==sa.componentIndex)return null;const Fa=this._nodeId2Meta.get(sa.nodeIndex);return null==Fa?.featureIds||sa.componentIndex>=Fa.featureIds.length?null:this._createGraphic(sa.componentIndex,Fa)}_getCacheKey(sa){return`${this._layerUrl}/v${23}/${sa}${this._cacheKeySuffix}`}_getMemCacheKey(sa,Fa=this.elevationOffset){return sa+"#"+Fa}get _idbCacheEnabled(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}loadCachedGPUData(sa){return null!=
this._memCache?this._memCache.pop(this._getMemCacheKey(sa)):null}deleteCachedGPUData(sa){null!=sa&&this._deleteComponentObject(sa)}_cacheGPUData(sa,Fa=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(sa);else{var Pa=this._controller.indexDepth-sa.node.level;this._memCache.put(this._getMemCacheKey(sa.node.index,Fa),sa,sa.node.memory,Pa)}}loadMissingTextures(sa,Fa,Pa,Ta){const $a=sa?.filter((hb,ib)=>{if(0===(hb.usage&this.rendererTextureUsage))return!1;if(null==Fa)return!0;
hb=la.selectEncoding(hb.encodings,this.supportedTextureEncodings);ib=Fa[ib];return null==ib?.data||hb&&ib.encoding!==hb.encoding?!0:!1})??[];return 0===$a.length?Promise.resolve(!1):Pa($a,Ta).then(hb=>{let ib=0;for(let ob=0;ob<sa.length;ob++)ib<hb.length&&hb[ib].id===sa[ob].id&&(Fa[ob]=hb[ib],ib++);return!0})}loadCachedNodeData(sa,Fa,Pa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(sa.id),Fa).then(Ta=>{if(null==Ta)return null;if(Ta.nodeVersion!==sa.version)return this._idbCache.remove(this._getCacheKey(sa.id)),
null;this.elevationInfo.mode===Y.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=bb.Obb.fromData(Ta.geometryObbData));return this.loadMissingTextures(Ta.requiredTextures,Ta.textureData,Pa,Fa).then($a=>{$a&&this._idbCache.initialized&&null!=Ta.textureData&&(Ta.byteSize=za(Ta.transformedGeometry,Ta.textureData),Ta.textureData.every(na)&&Da(sa,Ta)&&this._idbCache.put(this._getCacheKey(sa.id),Ta).catch(hb=>n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to update node with textures in IndexedDB cache: ${sa.id}: ${hb}`)));
w.throwIfAborted(Fa);return Ta})}):Promise.resolve(null)}addNode(sa,Fa,Pa){return"geometryData"in Fa?null==Fa.geometryBuffer?(this._addNodeMeta(sa.index,null),Promise.resolve()):this._addData(sa,Fa.attributeDataInfo,()=>this._transformNode(sa,Fa,Pa).then(Ta=>this._safeReschedule(()=>{if(null==Ta)return sa.hasModifications=!1,this._addCachedNodeData(sa,null,Pa);sa.hasModifications=Ta.transformedGeometry.hasModifications;const {obb:$a,componentOffsets:hb,featureIds:ib,anchorIds:ob,anchors:qb,transformedGeometry:yb}=
Ta;var wb=va.computeGlobalTransformation(sa.serviceMbsInIndexSR,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),Bb=G.set(Fb,$a.center.x,$a.center.y,$a.center.z);G.transformMat4(Bb,Bb,wb);Bb=new bb.Obb(Bb,[$a.extents.x,$a.extents.y,$a.extents.z],F.fromValues($a.orientation.x,$a.orientation.y,$a.orientation.z,$a.orientation.w));this.elevationInfo.mode===Y.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=Bb);Fa.geometryData.componentOffsets=hb;ib&&(Fa.geometryData.featureIds=
Array.from(ib));Fa.geometryData.anchorIds=ob;Fa.geometryData.anchors=qb;wb={nodeVersion:sa.version,geometryData:Fa.geometryData,requiredTextures:Fa.requiredTextures,textureData:Fa.textureData,transformedGeometry:yb,globalTrafo:wb,geometryObbData:Bb.data,byteSize:za(yb,Fa.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&Da(sa,wb)&&(Bb=null!=wb.textureData?wb.textureData.map(zb=>na(zb)?zb:null):null,this._idbCache.put(this._getCacheKey(sa.id),{...wb,textureData:Bb}).catch(zb=>n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to store node in IndexedDB cache: ${sa.id}: ${zb}`)));
return this._addCachedNodeData(sa,wb,Pa)},Pa))):Promise.reject()}getElevationRange(sa){const Fa=new Va.ElevationRange;var {view:Pa}=this;const {renderCoordsHelper:Ta}=Pa,$a=Ta.referenceEllipsoid.radius,hb=this._collection;Pa=this._controller;const {index:ib}=Pa;if(!ib)return Fa;const {rootNode:ob}=ib;if(!ob)return Fa;const qb=this._nodeId2Meta,yb=sa[3],wb=Pa.viewportQueries,Bb=this._planetRadiusInGlobalMode;ib.traverse(ob,zb=>{const {childrenLoaded:Sb}=zb;if(0===Sb)return!1;var nb=wb.getAndUpdateVisibilityObbInRenderSR(zb),
xb=null;let Ab=-1;if(nb){if(Ab=nb.radius,!nb.intersectSphereWithMBS(sa,Ab))return!1}else(xb=wb.getServiceMbsInRenderSR(zb))&&(Ab=xb[3]);if(0<=Ab&&yb>=1*Ab)return null!=nb?Ja(Fa,nb,Bb):null!=xb&&0<=xb[3]&&Qa(Fa,xb,Bb),!1;Ub.elevationRangeMin=Infinity;Ub.elevationRangeMax=-Infinity;if(null!=nb||null!=xb)if(null!=nb?Ja(Ub,nb,Bb):null!=xb&&Qa(Ub,xb,Bb),Ub.elevationRangeMin>=Fa.elevationRangeMin&&Ub.elevationRangeMax<=Fa.elevationRangeMax)return!1;if(nb=qb.get(zb.index))if({geometryObbInRenderSR:zb}=zb,
!zb||zb.intersectSphereWithMBS(sa)){if(zb&&yb>0*zb.radius)return Ja(Fa,zb,Bb),!1;({objectHandle:zb}=nb);xb=hb.getObjectTransform(zb);xb=Ta.getAltitude(xb.position);hb.expandRangeWithComponentObjectElevationRange(zb,xb,$a,Fa)}return 0<Sb-(nb?1:0)});return Fa}computeVisibilityObb(sa){return Ga.computeVisibilityObb(sa,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications,this.view.renderCoordsHelper.sphericalPCPF)}_transformNode(sa,
Fa,Pa){var Ta=Fa.geometryData.geometries??[];const $a=Array(Ta.length);for(var hb=0;hb<Ta.length;++hb)$a[hb]=this._getVertexBufferLayout(Ta[hb],Fa.geometryDescriptor);Ta=sa.serviceMbsInIndexSR;hb=this.elevationOffset;var ib=this._controller.crsIndex,ob=this._controller.crsVertex,qb=this.view.renderSpatialReference;const yb=va.getLocalOrigin(Ta,hb,ib),wb=va.computeGlobalTransformation(Ta,hb,ib,qb);ib=M.getProjectorName(ib,ob);ob=M.getProjectorName(ob,qb);if(null==ib||null==ob)return Promise.resolve(null);
qb=this.i3slayer.normalReferenceFrame;return this._worker.invoke({context:this.uid,geometryBuffer:Fa.geometryBuffer,geometryData:Fa.geometryData,geometryDescriptor:Fa.geometryDescriptor,layouts:$a,localOrigin:yb,globalTrafo:wb,mbs:Ta,obbData:sa.serviceObbInIndexSR?.data,elevationOffset:hb,needNormals:this._needsNormals&&this._controller.isMeshPyramid,normalReferenceFrame:Fa.normalReferenceFrame??qb??"none",indexToVertexProjector:ib,vertexToRenderProjector:ob},Pa)}get _supportsNodeCrossFading(){return!this.view?._stage?.renderer.shadowsEnabled}get nodeCrossfadingEnabled(){return this._supportsNodeCrossFading&&
(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}get nodeFadeoutEnabled(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}_setNewNodeOpacity(sa){this._setNodeOpacity(sa,this.nodeCrossfadingEnabled?0:this.fullOpacity)}addCachedGPUData(sa,Fa,Pa){this.elevationInfo.mode===Y.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=this._collection.getComponentObb(Fa.objectHandle).clone());this._controller.isGeometryVisible(sa)?(null!=
this._labeler&&this._addMetaToLabeler(this._labeler,Fa),sa=sa.index,this._addNodeMeta(sa,Fa),this.updateNodeState(sa,Pa),this._collection.setObjectVisibility(Fa.objectHandle,!0),this._updateMaterial(Fa),this._setNewNodeOpacity(Fa),this.elevationInfo.mode!==Y.ElevationMode.Absolute&&this._ensureElevationTask().schedule(sa),this._updateEngineObject(Fa),this._highlights.objectCreated(Fa),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(Fa)}addCachedNodeData(sa,Fa,Pa,Ta){return this._addData(sa,
Pa,()=>this._addCachedNodeData(sa,Fa,Ta))}async deleteCachedNodeData(sa){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(sa))}async _addCachedNodeData(sa,Fa,Pa){if(this.contentVisible&&this._controller.isGeometryVisible(sa))if(null==Fa)this._addNodeMeta(sa.index,null);else{var Ta=this._addTasks.get(sa.index),{geometryData:$a,transformedGeometry:hb,globalTrafo:ib}=Fa;await this.i3sOverrides.applyAttributeOverrides($a.featureIds,Ta.attributeInfo,Pa,this._controller.requiredAttributes);
var ob=null!=Fa.textureData?Fa.textureData.filter(Qb=>null!=Qb&&0!==(Qb.usage&this.rendererTextureUsage)):[];!e("disable-feature:i3s-basis")&&ob.some(Qb=>null!=Qb&&(Qb.encoding===ta.TextureEncoding.Basis||Qb.encoding===ta.TextureEncoding.KTX2))&&await sb.loadBasis();sa.memory=0;var {componentOffsets:qb,geometries:yb,featureIds:wb,anchorIds:Bb,anchors:zb}=$a,Sb=this._collection,nb=yb[0],{layout:xb,indices:Ab,interleavedVertexData:Nb,positionData:cc,hasColors:hc}=hb,{material:ec,geometryParameters:fc}=
this._materialParameters(nb,xb),Lb=qb||new Uint32Array([0,Ab?Ab.length:Nb.byteLength/xb[0].stride]);Lb={vertices:{data:Nb,count:Nb.byteLength/xb[0].stride,layoutParameters:fc},positionData:{positions:T.compactFloatArray(cc.data),indices:ia.compactIndices(cc.indices)},indices:Ab,componentOffsets:Lb};var Mb=nb.transformation?B.clone(nb.transformation):B.create();A.multiply(Mb,ib,Mb);nb=A.getTranslation(H.create(),Mb);Mb=D.fromMat4(E.create(),Mb);var Vb=this.view.renderSpatialReference,Wb=this.view.basemapTerrain.spatialReference,
Kb=H.create(),Zb=[1,1,1];J.localLinearScaleFactors(nb,Vb,Zb,Wb)||n.getLogger("esri.views.3d.layers.I3SMeshView3D").errorOnce("Unsupported coordinate system for IM overlay");S.projectVectorToVector(nb,Vb,Kb,Wb);var $b=Sb.createObject({toMapSpace:C.fromValues(Kb[0],Kb[1],Zb[0],Zb[1]),geometry:Lb,obb:bb.Obb.fromData(Fa.geometryObbData),transform:{position:nb,rotationScale:Mb}}),{textures:Cb,texturePromise:Pb}=this._initMaterialAndTextures($b,ec,ob,fc.textureCoordinates===mb.TextureCoordinateAttributeType.Atlas);
sa.memory+=this._memEstimateGeometryAdded($b);sa.memory+=Cb.reduce((Qb,dc)=>Qb+(null!=dc?this._memEstimateTextureAdded(dc):0),0);ob=!!ec.hasParametersFromSource;Lb="blend"!==ec.alphaMode&&1<=ec.metallicRoughness.baseColorFactor[3];var Hb=new cb(sa,wb,$b,this._getInvalidRendererVersion(),Ta.attributeInfo,{hasParametersFromSource:ob,isOpaque:Lb},Cb,Bb,zb);Ta.meta=Hb;!this._hasTextures&&Fa.requiredTextures?.some(({usage:Qb})=>0!==(Qb&ta.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=
!0;this._hasColors=this._hasColors||hc;this._hasTextures=this._hasTextures||!!sa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var xc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(Hb),Pb]).then(([Qb])=>{null!=Qb&&Qb.updateObjectVisibility(Hb.objectHandle,!1).catch(dc=>xa(dc,this.i3slayer.title));return this._safeReschedule(()=>{var dc=this._addTasks.get(sa.index);if(dc)if(this._addNodeMeta(sa.index,Hb),dc.meta=null,this.contentVisible){Sb.setObjectVisibility($b,
!0);null!=Qb&&Qb.updateObjectVisibility(Hb.objectHandle,!0).catch(tc=>xa(tc,this.i3slayer.title));Hb.attributeInfo=dc.attributeInfo;dc=Hb.cachedRendererVersion!==this._rendererVersion;var vc=xc!==this.slicePlaneEnabled;this._updateElevationOffsets(Hb);var nc=Hb.elevationOffsets;this._updateComponentData(Hb);var lc=this._applyFiltersToNode(Hb);(dc||null!=Qb&&(vc||lc||nc))&&this._addOrUpdateEdgeRendering(Hb);null!=this._labeler&&this._addMetaToLabeler(this._labeler,Hb);this._visibleGeometryChanged(Hb,
rb.ADD);this._highlights.objectCreated(Hb);this._updateMaterial(Hb);this._setNewNodeOpacity(Hb);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(sa.index,this.elevationOffset)},Pa)}).catch(Qb=>{null!=Ta.meta&&(this._cacheGPUData(Ta.meta),Ta.meta=null);throw Qb;})}else this._removeNodeStageData(sa.index,this.elevationOffset,this._nodeId2MetaReloading)}_addNodeMeta(sa,Fa){this._removeNodeStageData(sa,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(sa)){n.getLogger("esri.views.3d.layers.I3SMeshView3D").error("Removing duplicated node");
const Pa=this._nodeId2Meta.get(sa);null!=Pa&&this._deleteComponentObject(Pa)}else this._controller.updateLoadStatus(sa,!0);null!=Fa&&(Fa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Xa(Fa.cachedEdgeMaterials,0));this._nodeId2Meta.set(sa,Fa);this.notifyChange("elevationRange")}_updateElevationOffsets(sa){const Fa=this.view.renderSpatialReference,Pa=this._controller.crsIndex,Ta=this.elevationInfo,$a=this.view.basemapTerrain,hb=$a.spatialReference,ib=Ta.mode;if(null==Fa||null==hb||ib===Y.ElevationMode.Absolute)sa.elevationOffsets=
null;else{var ob=this._collection.getObjectTransform(sa.objectHandle);sa.elevationOffsets=sa.elevationOffsets??[];var qb=ib===Y.ElevationMode.OnTheGround,yb=this.view.renderCoordsHelper,wb=sa.featureIds.length,Bb=(()=>{if(sa.cachedElevationAnchors)return sa.cachedElevationAnchors;const nb=Q.newDoubleArray(3*wb);sa.cachedElevationAnchors=nb;for(let xb=0;xb<wb;xb++){const Ab=3*xb,Nb=sa.anchorIds?.indexOf(xb)??-1;sa.anchors&&0<=Nb?(G.set(Fb,sa.anchors[3*Nb],sa.anchors[3*Nb+1],sa.anchors[3*Nb+2]),G.add(Fb,
Fb,O.getCenter(sa.node.serviceMbsInIndexSR)),S.projectVectorToVector(Fb,Pa,Fb,hb),nb[Ab]=Fb[0],nb[Ab+1]=Fb[1],nb[Ab+2]=yb.getAltitude(Fb)):(this._collection.getComponentAabb(sa.objectHandle,xb,Tb,!0),G.set(Fb,(Tb[0]+Tb[3])/2,(Tb[1]+Tb[4])/2,Tb[2]),G.transformMat3(Fb,Fb,ob.rotationScale),G.add(Fb,Fb,ob.position),nb[Ab+2]=yb.getAltitude(Fb),S.projectVectorToVector(Fb,Fa,Fb,hb),nb[Ab]=Fb[0],nb[Ab+1]=Fb[1])}return nb})(),zb=Ta.offset,Sb=sa.elevationOffsets;$a.getElevations(Bb,wb,(nb,xb)=>{const Ab=qb?
Bb[3*nb+2]:0;Sb[nb]=zb+(null!=xb?xb-Ab:0)})}}_ensureElevationTask(){return null!=this._elevationTask?this._elevationTask:this._elevationTask=new Ca.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,sa=>{sa=this._controller.updateElevationChanged(sa,this.view.basemapTerrain.spatialReference);return null!=sa?sa.filterInPlace(Fa=>null!=this._nodeId2Meta.get(Fa)):null},sa=>{sa=this._nodeId2Meta.get(sa);this._nodeElevationAlignmentChanged(sa)},()=>this.elevationInfo?.mode)}_elevationInfoChanged(sa,
Fa){const Pa=sa.mode!==Y.ElevationMode.Absolute;sa=!!Fa&&Fa!==sa&&Fa.mode!==Y.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Pa,this.view.state.viewingMode);Pa&&!sa&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Ta=>this._nodeElevationAlignmentChanged(Ta))}_nodeElevationAlignmentChanged(sa){null!=sa&&(this._updateElevationOffsets(sa),this._updateComponentData(sa),this._updateEdgeRendering(sa),null!=this._labeler&&this._labeler.updateLabelPositions(sa),
this._updateSnappingSources(sa,rb.UPDATE))}_safeReschedule(sa,Fa){w.throwIfAborted(Fa);return this._controller.reschedule(sa,Fa)}_materialParameters(sa,Fa){sa=null!=sa.params.material?sa.params.material:la.defaultMaterial();const Pa=Fa.some($a=>"uvRegion"===$a.name);Fa=Fa.some($a=>"normalCompressed"===$a.name);const Ta=Ha(sa);return{geometryParameters:this._getGeometryParameters({hasTexture:Ta,hasNormals:Fa,hasRegions:Pa}),material:sa}}_initMaterialAndTextures(sa,Fa,Pa,Ta){const $a=this._stage.renderView,
hb=Pa.map(ob=>la.createTexture(ob,Fa,Ta,$a));this._stage.addMany(hb);let ib=null;this._collection.updateMaterial(sa,ob=>{ib=la.configureMaterial(ob,Fa,hb,Pa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(ob)});return{textures:hb,texturePromise:ib}}_getGeometryParameters(sa){return{textureCoordinates:sa.hasTexture?
sa.hasRegions?mb.TextureCoordinateAttributeType.Atlas:mb.TextureCoordinateAttributeType.Default:mb.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,hasNormals:sa.hasNormals&&this._needsNormals,needsNormals:this._needsNormals}}_addData(sa,Fa,Pa){let Ta=this._addTasks.get(sa.index);Ta?Ta.attributeInfo=Fa:(Ta={...w.createResolver(),attributeInfo:Fa,meta:null},this._addTasks.set(sa.index,Ta),Pa().then(Ta.resolve,Ta.reject).then(()=>this._addTasks.delete(sa.index)).catch($a=>{this._addTasks.delete(sa.index);
throw $a;}));return Ta.promise}_clearAddTasks(){this._addTasks.forEach(sa=>{null!=sa.meta&&(this._cacheGPUData(sa.meta),sa.meta=null)});this._addTasks.clear()}_clippingAreaChanged(){var sa=this.view.renderSpatialReference;const Fa=this.i3slayer.spatialReference,Pa=V.create();this._renderClippingArea=Ra.toBoundingRect(this.view.clippingArea,Pa,sa)?Pa:null;sa=V.create();this._layerClippingArea=Ra.toBoundingRect(this.view.clippingArea,sa,Fa)?sa:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);
this._isIntegratedMesh&&this._modificationsChanged()}get hasGeometryFilter(){return!1}_geometryFilterChange(){const sa=this.hasGeometryFilter;this._controller.geometryFilterChanged(sa);this._applyFilters(sa)}_filterChange(){this._applyFilters(this.hasGeometryFilter)}_applyFilters(sa){this._filters=this.getFilters();sa?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._applyFiltersToNode(Fa)&&(this._addOrUpdateEdgeRendering(Fa),this._visibleGeometryChanged(Fa,
rb.UPDATE))})}getFilters(){const sa=[],Fa=this._renderClippingArea;null!=Fa&&sa.push((Pa,Ta)=>this._boundingRectFilter(Pa,Ta,Fa));return sa}addSqlFilter(sa,Fa,Pa){if(null!=Fa){const Ta=Fa.fieldNames;sa.push(($a,hb)=>this._sqlFilter($a,hb,Fa,Ta,Pa))}}_sqlFilter(sa,Fa,Pa,Ta,$a){const hb={},ib=this._createLayerGraphic(hb),ob=this.i3slayer.objectIdField,qb=Fa.featureIds,yb=Fa.attributeInfo?.attributeData;Ta.every(wb=>wb===ob||null!=yb?.[wb])&&Ga.filterInPlace(sa,qb,wb=>{hb[ob]=qb[wb];for(const Bb of Ta)Bb!==
ob&&(hb[Bb]=yb?Ga.getCachedAttributeValue(yb[Bb],wb):null);try{return Pa.testFeature(ib)}catch(Bb){return $a(Bb),!1}})}_boundingRectNodeTest(sa,Fa){K.projectBoundingSphere(sa.node.serviceMbsInIndexSR,this._controller.crsIndex,kc,this.view.renderSpatialReference);return Ga.intersectBoundingRectWithMbs(Fa,kc)}_boundingRectFeatureTest(sa,Fa,Pa){this._collection.getComponentAabb(sa.objectHandle,Fa,vb);N.toRect(vb,pb);return V.intersects(Pa,pb)}_boundingRectFilter(sa,Fa,Pa){var Ta=this._collection;const $a=
this._boundingRectNodeTest(Fa,Pa);if($a!==Ga.MbsIntersectResult.INSIDE)if($a===Ga.MbsIntersectResult.OUTSIDE)sa.length=0;else if(Ta=Ta.getComponentCount(Fa.objectHandle),Ta.invisible+Ta.visible===Fa.featureIds.length){var hb=this._transformClippingArea(Db,Pa,Fa.objectHandle);Ga.filterInPlace(sa,Fa.featureIds,ib=>this._boundingRectFeatureTest(Fa,ib,hb))}}_transformClippingArea(sa,Fa,Pa){var Ta=this._collection.getObjectTransform(Pa);Pa=Ta.position;Ta=Ta.rotationScale;sa[0]=(Fa[0]-Pa[0])/Ta[0];sa[1]=
(Fa[1]-Pa[1])/Ta[4];sa[2]=(Fa[2]-Pa[0])/Ta[0];sa[3]=(Fa[3]-Pa[1])/Ta[4];return sa}_addOrUpdateEdgeRendering(sa,Fa=!0){const Pa=this._edgeView;if(null==Pa)return Promise.resolve(null);const Ta=sa.objectHandle;var $a=Pa.hasObject(Ta);const {hasEdges:hb,perFeatureEdgeMaterials:ib}=this._getFilteredEdgeMaterials(sa),ob={hasSlicePlane:this.slicePlaneEnabled};if(hb&&$a)return this.nodeCrossfadingEnabled&&($a=this.getNodeOpacity(sa),Xa(ib,$a)),Pa.updateAllComponentMaterials(Ta,ib,ob,Fa).catch(qb=>xa(qb,
this.i3slayer.title)),Pa.updateObjectVisibility(Ta,!0).catch(qb=>xa(qb,this.i3slayer.title)),Pa.updateAllVerticalOffsets(Ta,sa.elevationOffsets).catch(qb=>xa(qb,this.i3slayer.title)),Promise.resolve(Pa);if(hb&&!$a)return this._collection.addEdges(Ta,Pa,ib,ob).then(qb=>{sa.edgeMemoryUsage=qb;sa.node.memory+=qb;Pa.updateAllVerticalOffsets(Ta,sa.elevationOffsets).catch(yb=>xa(yb,this.i3slayer.title));return Pa});!hb&&$a&&(sa.node.memory-=sa.edgeMemoryUsage,sa.edgeMemoryUsage=0,Pa.removeObject(Ta));return Promise.resolve(null)}_applyFiltersToNode(sa){return this._applyFiltersToNodeComponents(sa)?
(null!=this._labeler&&this._labeler.applyFilterChange(sa),!0):!1}_applyFiltersToNodeComponents(sa){const Fa=this._collection;var Pa=Fa.getComponentCount(sa.objectHandle),Ta=null!=sa.filteredIds;Pa=0===Pa.invisible;Fa.setAllComponentVisibilities(sa.objectHandle,"all");if(0===this._filters.length)return sa.filteredIds=null,!Pa;this._updateCachedFilteredIds(sa);if(Ta&&sa.filteredIds===sa.featureIds)return!Pa;Ta=this._computeFilteredComponentIndices(sa);Fa.setAllComponentVisibilities(sa.objectHandle,
Ta);return!0}_updateCachedFilteredIds(sa){if(null==sa.filteredIds||sa.appliedFilters!==this._filters)sa.filteredIds=this._computeFilteredIds(sa),sa.appliedFilters=this._filters}_computeFilteredIds(sa){const Fa=sa.featureIds.slice();for(const Pa of this._filters)if(Pa(Fa,sa),0===Fa.length)break;return Fa.length===sa.featureIds.length?sa.featureIds:Fa}_computeFilteredComponentIndices(sa){const Fa=[],Pa=sa.filteredIds;null!=Pa&&sa.featureIds.forEach((Ta,$a)=>{Pa[Fa.length]===Ta&&Fa.push($a)});return Fa}_removeAllNodeDataFromStage(sa=
this.elevationOffset){this._nodeId2Meta.forEach((Fa,Pa)=>this._removeNodeStageData(Pa,sa));this._nodeId2MetaReloading.forEach((Fa,Pa)=>this._removeNodeStageData(Pa,sa,this._nodeId2MetaReloading));this._elevationTask=u.destroyMaybe(this._elevationTask)}removeNode(sa){const Fa=this.elevationOffset;this._removeNodeStageData(sa,Fa);this._removeNodeStageData(sa,Fa,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(sa)}_removeNodeStageData(sa,Fa,Pa=this._nodeId2Meta){Pa.has(sa)&&
this._controller.updateLoadStatus(sa,!1);const Ta=Pa.get(sa);null==Ta?Pa.delete(sa):(this._collection.setObjectVisibility(Ta.objectHandle,!1),null!=this._edgeView&&this._edgeView.hasObject(Ta.objectHandle)&&this._edgeView.updateObjectVisibility(Ta.objectHandle,!1).catch($a=>xa($a,this.i3slayer.title)),this._visibleGeometryChanged(Ta,rb.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(Ta),Pa.delete(sa),this._highlights.objectDeleted(Ta),Pa===this._nodeId2Meta?(this._cacheGPUData(Ta,Fa),this.nodeCrossfadingEnabled&&
this._crossfadeHelper.stopNodeFading(Ta)):this._deleteComponentObject(Ta),null!=this._treeDebugger&&this._treeDebugger.update())}_deleteComponentObject(sa){null!=this._edgeView&&this._edgeView.removeObject(sa.objectHandle);this._memEstimateGeometryRemoved(sa.objectHandle);this._collection.destroyObject(sa.objectHandle);if(sa.textures)for(const Fa of sa.textures)this._memEstimateTextureRemoved(Fa),this._stage.remove(Fa)}updateNodeState(sa,Fa){sa=this._nodeId2Meta.get(sa);null!=sa&&this._collection.updateMaterial(sa.objectHandle,
Pa=>Pa.polygonOffsetEnabled=Fa===qa.NodeState.Hole)}updateNodeIndex(sa,Fa){if(this._nodeId2Meta.has(sa)){var Pa=this._nodeId2Meta.get(sa);this._nodeId2Meta.delete(sa);this._nodeId2Meta.set(Fa,Pa);this.notifyChange("elevationRange")}if(Pa=this._nodeId2MetaReloading.get(sa))this._nodeId2MetaReloading.delete(sa),this._nodeId2MetaReloading.set(Fa,Pa)}_invalidateAllSymbols(){this._rendererVersion=Ga.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()}_getInvalidRendererVersion(){return Ga.addWraparound(this._rendererVersion,
-1)}async _rendererChange(sa){this._currentRenderer=sa;this.notifyChange("rendererTextureUsage");this._rendererVersion=Ga.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();sa&&(this._rendererFields=await sa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&sa&&"arcadeRequired"in sa&&sa.arcadeRequired&&(this._arcade=await ha.loadArcade());if(sa&&"visualVariables"in sa&&sa.visualVariables)for(const Fa of sa.visualVariables)"color"===
Fa.type?this._colorVariable=Fa:"opacity"===Fa.type?this._opacityVariable=Fa:n.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Unsupported visual variable type for 3D Object Scene Services: ${Fa.type}`);if(sa)for(const Fa of sa.getSymbols())"mesh-3d"!==Fa.type&&n.getLogger("esri.views.3d.layers.I3SMeshView3D").error(`Symbols of type '${Fa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()}_getCachedEdgeMaterials(sa){this._hasComponentData&&
sa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(sa);return sa.cachedEdgeMaterials}_getComponentParameters(sa){this._hasComponentData&&sa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(sa);const Fa=sa.cachedSymbology;return(Pa,Ta)=>{const $a=5*Pa;L.set(Ta.externalColor,Fa[$a]/255,Fa[$a+1]/255,Fa[$a+2]/255,Fa[$a+3]/255);if(null!=this._stage.renderView.objectAndLayerIdRenderHelper){const hb=sa.featureIds[Pa],ib=fa.isBasemapLayer(this.view.map,
this.layerUid);this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(hb,hb,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&!ib,sa.node.resources.attributes,Pa,this.sublayerId);Ta.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:hb,layerUid:this.layerUid+"_"+this.sublayerId})}Ta.externalColorMixMode=Fa[$a+4]&(1<<eb.CastShadows)-1;Ta.castShadows=0!==(Fa[$a+4]&1<<eb.CastShadows);Ta.pickable=0!==(Fa[$a+4]&1<<
eb.Pickable);Ta.elevationOffset=sa.elevationOffsets?.[Pa]??0}}_getSymbolInfo(sa,Fa){Fa=sa?.getSymbol(Fa,{arcade:this._arcade});if(!(Fa instanceof aa))return null;sa=Fa.id;if(this._symbolInfos.has(sa))return this._symbolInfos.get(sa);Fa=Ga.getSymbolInfo(Fa);this._symbolInfos.set(sa,Fa);return Fa}_setSymbologyOverride(sa,Fa){this._symbologyOverride!==sa&&(this._symbologyOverride=sa,this._symbologyOverrideFields=Fa,this._invalidateAllSymbols(),this._updateSymbologyFields())}_updateSymbologyFields(){this._symbologyFields=
null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=this._rendererFields&&0<this._rendererFields.length?ba.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields}_updateCachedRendererData(sa){sa.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Fa=this._tmpAttributeOnlyGraphic,Pa={};Fa.attributes=Pa;var Ta=this._currentRenderer,$a=sa.attributeInfo?.attributeData,
hb=null!=sa.featureIds?this.i3slayer.objectIdField:null,ib=null!=$a&&null!=this._symbologyFields&&0<this._symbologyFields.length,ob=null,qb=null;if(ib&&null!=this._symbologyFields){ob=[];qb=[];for(var yb of this._symbologyFields){var wb=$a[yb];wb&&(ob.push(yb),qb.push(wb))}}sa.cachedSymbology||(sa.cachedSymbology=U.newUByteArray(5*sa.featureIds.length));$a={color:Rb,castShadows:!0,pickable:!0,colorMixMode:Oa.ColorMixModeEnum.Multiply,edgeMaterial:null};yb=this.fullOpacity;yb=this.nodeCrossfadingEnabled?
this.getNodeOpacity(sa):yb;wb=null;var Bb=tb.Transparency.OPAQUE,zb=Ga.transparentEdgeMaterial,Sb=0;for(let Nb=0;Nb<sa.featureIds.length;Nb++){null!=hb&&(Pa[hb]=sa.featureIds[Nb]);if(ib&&ob)for(var nb=0;nb<ob.length;nb++)Pa[ob[nb]]=Ga.getCachedAttributeValue(qb[nb],Nb);var xb=Ta?this._getSymbolInfo(Ta,Fa):null;let cc=nb=null;if(Ta&&"visualVariables"in Ta){if(this._colorVariable){var Ab=da.getColor(this._colorVariable,Fa,{color:ac,arcade:this._arcade});Ab&&(nb=Rb,nb[0]=Ab.r/255,nb[1]=Ab.g/255,nb[2]=
Ab.b/255,this._opacityVariable||null===Ab.a||(cc=Ab.a))}this._opacityVariable&&(cc=da.getOpacity(this._opacityVariable,Fa,{arcade:this._arcade}))}xb?.material&&(Ab=xb.material,nb=null==nb||null==cc?oa.overrideColor(nb,cc,Ab.color,Ab.alpha,Sa,Rb):oa.overrideColor(nb,cc,null,null,Sa,Rb));null==nb&&(nb=Rb,nb[0]=1,nb[1]=1,nb[2]=1,nb[3]=1);$a.pickable=!0;$a.castShadows=xb?xb.castShadows:!0;$a.colorMixMode=xb?.material?xb.material.colorMixMode:Oa.ColorMixModeEnum.Multiply;$a.edgeMaterial=xb?xb.edgeMaterial:
null;null!=this._symbologyOverride&&($a.color=nb,this._symbologyOverride(Fa,$a),nb=$a.color);null!=this._nodeColorOverride&&(this._nodeColorOverride(sa.node,nb),$a.colorMixMode=Oa.ColorMixModeEnum.Replace);if(null!=$a.edgeMaterial){xb=0>=nb[3]?tb.Transparency.INVISIBLE:1<=nb[3]&&(sa.material.isOpaque||$a.colorMixMode===Oa.ColorMixModeEnum.Replace)?tb.Transparency.OPAQUE:tb.Transparency.TRANSPARENT;if($a.edgeMaterial!==wb||xb!==Bb)zb={...$a.edgeMaterial,opacity:yb,objectTransparency:xb},wb=$a.edgeMaterial,
Bb=xb;sa.cachedEdgeMaterials[Nb]=zb}else sa.cachedEdgeMaterials[Nb]=Ga.transparentEdgeMaterial;sa.cachedSymbology[Sb++]=Math.round(255*nb[0]);sa.cachedSymbology[Sb++]=Math.round(255*nb[1]);sa.cachedSymbology[Sb++]=Math.round(255*nb[2]);sa.cachedSymbology[Sb++]=Math.round(255*nb[3]);sa.cachedSymbology[Sb++]=$a.colorMixMode|+$a.castShadows<<eb.CastShadows|+$a.pickable<<eb.Pickable}}}_getFilteredEdgeMaterials(sa){var Fa=this._getCachedEdgeMaterials(sa);this.nodeCrossfadingEnabled||Xa(Fa,this.fullOpacity);
const Pa=sa.filteredIds;if(null==Pa)return{hasEdges:Fa.some(hb=>hb!==Ga.transparentEdgeMaterial),perFeatureEdgeMaterials:Fa};let Ta=0,$a=!1;Fa=Fa.map((hb,ib)=>{if(sa.featureIds[ib]!==Pa[Ta])return Ga.transparentEdgeMaterial;$a=$a||hb!==Ga.transparentEdgeMaterial;Ta++;return hb});return{hasEdges:$a,perFeatureEdgeMaterials:Fa}}_updateComponentData(sa){if(this._hasComponentData){var Fa=sa.objectHandle;sa=this._getComponentParameters(sa);this._collection.setComponentData(Fa,sa);this._stage.renderView.requestRender()}}_reloadAll(sa=
this.elevationOffset){this._removeAllNodeDataFromStage(sa);null!=this._controller&&this._controller.restartNodeLoading()}_opacityChange(sa){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,Pa=>Pa.objectOpacity=sa),Xa(Fa.cachedEdgeMaterials,sa),this._updateEdgeRendering(Fa))})}_updateMaterial(sa){this._collection.updateMaterial(sa.objectHandle,Fa=>{Fa.commonMaterialParameters.hasSlicePlane=
this.slicePlaneEnabled;Fa.usePBR=this._usePBR;this._updateMaterialOverlay(Fa)})}_updateMaterialOverlay(sa){}_updateEngineObject(sa){this._updateComponentData(sa);this._applyFiltersToNode(sa);this._addOrUpdateEdgeRendering(sa);this._visibleGeometryChanged(sa,rb.UPDATE)}_slicePlaneEnabledChange(sa){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=sa);null!=this._labeler&&(this._labeler.slicePlaneEnabled=sa);this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,
Pa=>Pa.commonMaterialParameters.hasSlicePlane=sa),this._updateEdgeRendering(Fa,!1))})}_updatePBR(sa){this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._collection.updateMaterial(Fa.objectHandle,Pa=>Pa.usePBR=sa)});this._hasLoadedPBRTextures=!0}get _usePBR(){return this._needsNormals&&this.view.qualitySettings.physicallyBasedRenderingEnabled}_updateEdgeRendering(sa,Fa=!0){null!=this._edgeView&&this._edgeView.hasObject(sa.objectHandle)&&this._addOrUpdateEdgeRendering(sa,Fa)}_forAllNodes(sa){this._nodeId2Meta.forEach(sa)}_ignoreClientNodeOverriddenFeatures(sa){return this.i3sOverrides.hasGeometryChanges?
(Fa,Pa,Ta)=>0<=Ta.node.index&&this.i3sOverrides.featureHasGeometryChanges(Fa)?Y.ForAllFeaturesReturnType.CONTINUE:sa(Fa,Pa,Ta):sa}_forAllFeatures(sa,Fa,Pa){l.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;if(null!=Fa)switch(Fa(Ta)){case Y.ForAllFeaturesReturnType.EXIT:return!0;case Y.ForAllFeaturesReturnType.SKIP:return!1}let $a=Y.ForAllFeaturesReturnType.CONTINUE;switch(Pa){case Y.ForAllFeaturesMode.ALL:$a=this._forAllFeaturesOfNode(Ta,sa);break;case Y.ForAllFeaturesMode.VISIBLE_ONLY:$a=this._forAllVisibleFeaturesOfNode(Ta,
sa);break;case Y.ForAllFeaturesMode.QUERYABLE:$a=this._forAllQueryableFeaturesOfNode(Ta,sa)}return $a===Y.ForAllFeaturesReturnType.EXIT})}_forAllFeaturesOfNode(sa,Fa){let Pa=Y.ForAllFeaturesReturnType.CONTINUE;const Ta=sa.featureIds;for(let $a=0;$a<Ta.length&&(Pa=Fa(Ta[$a],$a,sa),Pa!==Y.ForAllFeaturesReturnType.EXIT);$a++);return Pa}_forAllVisibleFeaturesOfNode(sa,Fa){let Pa=Y.ForAllFeaturesReturnType.CONTINUE;const Ta=sa.featureIds;this._collection.forEachVisibleComponent(sa.objectHandle,$a=>{Pa=
Fa(Ta[$a],$a,sa);return Pa===Y.ForAllFeaturesReturnType.CONTINUE});return Pa}_forAllQueryableFeaturesOfNode(sa,Fa){Fa=this._ignoreClientNodeOverriddenFeatures(Fa);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(sa,Fa);var Pa=this._boundingRectNodeTest(sa,this._renderClippingArea);if(Pa===Ga.MbsIntersectResult.OUTSIDE)return Y.ForAllFeaturesReturnType.CONTINUE;if(Pa===Ga.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(sa,Fa);Pa=Y.ForAllFeaturesReturnType.CONTINUE;const Ta=
sa.featureIds,$a=Ga.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(sa.objectHandle));for(let hb=0;hb<Ta.length;hb++){if(!this._boundingRectFeatureTest(sa,hb,$a))continue;const ib=Fa(Ta[hb],hb,sa);if(ib===Y.ForAllFeaturesReturnType.EXIT)return ib}return Pa}_createAttributes(sa,Fa){const Pa={};null!=Fa.featureIds&&(Pa[this._getObjectIdField()]=Fa.featureIds[sa]);Fa=Fa.attributeInfo?.attributeData;if(null!=Fa)for(const Ta of Object.keys(Fa))Pa[Ta]=Ga.getCachedAttributeValue(Fa[Ta],
sa);return Pa}_createGraphic(sa,Fa){return this._createLayerGraphic(this._createAttributes(sa,Fa))}highlight(sa){"number"===typeof sa?sa=[sa]:sa instanceof k?sa=[sa]:sa instanceof f&&(sa=sa.toArray());if(Array.isArray(sa)&&0<sa.length){if(sa[0]instanceof k){const Fa=this.i3slayer.fieldsIndex,Pa=this._getObjectIdField();sa=sa.map(hb=>Ia.attributeLookup(Fa,hb.attributes,Pa));const {set:Ta,handle:$a}=this._highlights.acquireSet();this._highlights.setFeatureIds(Ta,sa);return $a}if("number"===typeof sa[0]){const {set:Fa,
handle:Pa}=this._highlights.acquireSet();this._highlights.setFeatureIds(Fa,sa);return Pa}}return g.makeHandle()}resetHighlights(){u.destroyMaybe(this._highlights);this._highlights=new ya({collection:this._collection,forAllFeatures:sa=>this._forAllFeatures(sa,null,Y.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(sa,Fa)=>this._forAllFeaturesOfNode(sa,Fa)})}_visibleGeometryChanged(sa,Fa){if(this._elevationProvider){var Pa=this.getNodeComponentObb(sa.node);Pa&&this._elevationProvider.objectChanged(Pa);
null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=v.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null}));this._updateSnappingSources(sa,Fa)}}get performanceInfo(){return new ca.I3SMeshViewPerformanceInfo(this.usedMemory,this._nodeId2Meta.size,Math.round(this._gpuMemoryEstimate/1048576),Math.round(this._geoMemoryEstimate/1048576),Math.round(this._texMemoryEstimate/1048576),Math.round(this.unloadedMemory/
1048576),this._idbCacheEnabled?Math.round(100*this._idbCache.getHitRate()):0)}get test(){const sa=this,Fa=Pa=>{this._nodeColorOverride=Pa;this._invalidateAllSymbols()};return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Pa=[];sa._forAllFeatures(Ta=>{Pa.push(Ta);return Y.ForAllFeaturesReturnType.CONTINUE},null,Y.ForAllFeaturesMode.VISIBLE_ONLY);Pa.sort((Ta,$a)=>Ta-$a);return Pa},get numNodes(){return sa._nodeId2Meta.size},get loadedNodes(){return Array.from(sa._nodeId2Meta.keys()).sort((Pa,
Ta)=>Pa-Ta)},setNodeColorOverride:Fa,setNodeColoring:Pa=>{switch(Pa){case "client-nodes":Fa((Ta,$a)=>{0>Ta.index?($a[0]=1,$a[1]=0,$a[2]=0):($a[0]=1,$a[1]=1,$a[2]=1)});break;default:Fa(null)}}}}getNodeOpacityByIndex(sa){sa=this._nodeId2Meta.get(sa);return this.getNodeOpacity(sa)}getNodeOpacity(sa){return null!=sa?this._collection.getMaterial(sa.objectHandle).objectOpacity:0}isNodeFullyFadedIn(sa){return this._crossfadeHelper.isNodeFullyFadedIn(sa)}getNodeCrossfadeMetaData(sa){return this._nodeId2Meta.get(sa)}markNodeToRemove(sa){this._controller&&
this._controller.markNodeToRemove(sa)}removeMarkedNodes(){this._controller&&this._controller.removeMarkedNodes()}foreachCrossfadeNode(sa){this._nodeId2Meta.forEach(sa)}fadeNode(sa,Fa,Pa){if(this.nodeCrossfadingEnabled){var Ta=this._nodeId2Meta.get(sa);null!=Ta&&this._crossfadeHelper.fadeNode(sa,Ta,Fa,Pa)}}setNodeOpacityByIndex(sa,Fa){sa=this._nodeId2Meta.get(sa);null!=sa&&this._setNodeOpacity(sa,Fa)}_setNodeOpacity(sa,Fa){this._collection.updateMaterial(sa.objectHandle,Pa=>Pa.objectOpacity=Fa);this._setNodeEdgeOpacity(sa,
Fa)}_setNodeEdgeOpacity(sa,Fa){null!=this._edgeView&&sa.cachedEdgeMaterials&&(Xa(sa.cachedEdgeMaterials,Fa),sa=sa.objectHandle,this._edgeView.hasObject(sa)&&this._edgeView.updateAllComponentOpacities(sa,Fa).catch(Pa=>xa(Pa,this.i3slayer.title)))}get hasModifications(){return this._isIntegratedMesh&&null!=this._layerClippingArea||this._modifications&&0<this._modifications.length}updateNodeModificationStatus(sa){var Fa=sa.length;if(this.hasModifications&&!(0>=Fa)&&!0===this._i3sWasmLoaded){Fa=this.uid;
var Pa=Ma(sa);if(Pa){ja.filterObbsForModificationsSync({context:Fa,buffer:Pa.buffer});const Ta=new Float64Array(Pa.buffer);sa.forAll(($a,hb)=>{hb=ja.interpretObbModificationResults(Ta[hb]);$a.imModificationImpact=hb;hb!==qa.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility($a.index)})}}}notifyUpdate(){this.notifyChange("updating")}notifyLODUpdate(){this._controller.notifyLODUpdate()}isUpdating(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||
null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||null!=this._elevationTask&&this._elevationTask.running}trackSnappingSources(sa){const Fa={events:sa,fetchEdgeLocations:async(Pa,Ta,$a)=>{Pa=this._nodeId2Meta.get(Pa);if(null==Pa)throw Error("invalid-node");const {origin:hb,buffer:ib}=await this._collection.extractEdgeInformation(Pa.objectHandle,Ta,$a);this._snappingLocationsApplyElevation(Pa,ib,hb);return{type:"components",
objectIds:Pa.featureIds,locations:ib,origin:hb}},remove:()=>m.removeUnordered(this._snappingSourcesTrackers,Fa)};this._snappingSourcesTrackers.push(Fa);this._nodeId2Meta.forEach((Pa,Ta)=>{null!=Pa&&(Pa=this._controller.getRenderMbs(Pa.node))&&sa.add(Ta,Pa)});return Fa}_snappingLocationsApplyElevation(sa,Fa,Pa){if(sa.elevationOffsets&&this.elevationInfo.mode!==Y.ElevationMode.Absolute){var Ta=Fa.position0,$a=Fa.position1;Fa=Fa.componentIndex;var hb=H.create(),ib=H.create(),ob=(qb,yb)=>{G.add(qb,qb,
Pa);this.view.renderCoordsHelper.worldUpAtPosition(qb,ib);G.add(qb,qb,G.scale(ib,ib,yb));G.subtract(qb,qb,Pa)};for(let qb=0;qb<Ta.count;qb++){const yb=sa.elevationOffsets[Fa.get(qb)];Ta.getVec(qb,hb);ob(hb,yb);Ta.setVec(qb,hb);$a.getVec(qb,hb);ob(hb,yb);$a.setVec(qb,hb)}}}_updateSnappingSources(sa,Fa){const {index:Pa}=sa.node;sa=this._controller.getRenderMbs(sa.node);if(null!=sa)for(const Ta of this._snappingSourcesTrackers)Fa!==rb.REMOVE&&Fa!==rb.UPDATE||Ta.events.remove(Pa),Fa!==rb.ADD&&Fa!==rb.UPDATE||
Ta.events.add(Pa,sa)}};h.__decorate([r.property()],jb.prototype,"_hasLoadedPBRTextures",void 0);h.__decorate([r.property()],jb.prototype,"_asyncModuleLoading",void 0);h.__decorate([r.property()],jb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);h.__decorate([r.property()],jb.prototype,"view",void 0);h.__decorate([r.property()],jb.prototype,"i3slayer",void 0);h.__decorate([r.property()],jb.prototype,"_controller",void 0);h.__decorate([r.property()],jb.prototype,"_labeler",void 0);h.__decorate([r.property()],
jb.prototype,"updating",void 0);h.__decorate([r.property()],jb.prototype,"suspended",void 0);h.__decorate([r.property()],jb.prototype,"contentVisible",null);h.__decorate([r.property({readOnly:!0})],jb.prototype,"legendEnabled",null);h.__decorate([r.property()],jb.prototype,"holeFilling",void 0);h.__decorate([r.property(gb.updatingProgress)],jb.prototype,"updatingProgress",void 0);h.__decorate([r.property()],jb.prototype,"updatingProgressValue",null);h.__decorate([r.property()],jb.prototype,"hasTexturesOrVertexColors",
null);h.__decorate([r.property()],jb.prototype,"rendererTextureUsage",null);h.__decorate([r.property()],jb.prototype,"elevationOffset",null);h.__decorate([r.property()],jb.prototype,"elevationInfo",null);h.__decorate([r.property({type:Boolean})],jb.prototype,"slicePlaneEnabled",void 0);h.__decorate([r.property()],jb.prototype,"supportedTextureEncodings",null);h.__decorate([r.property()],jb.prototype,"uncompressedTextureDownsamplingEnabled",null);h.__decorate([r.property({type:[X]})],jb.prototype,
"_modifications",void 0);h.__decorate([r.property({readOnly:!0})],jb.prototype,"clientGeometry",null);h.__decorate([r.property()],jb.prototype,"elevationRange",null);h.__decorate([r.property()],jb.prototype,"fullExtent",null);h.__decorate([r.property()],jb.prototype,"_elevationTask",void 0);h.__decorate([r.property({readOnly:!0})],jb.prototype,"_usePBR",null);return jb=h.__decorate([y.subclass("esri.views.3d.layers.I3SMeshView3D")],jb)};b.makeScheduleFunction=ab;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/projection/localLinearScaleFactors":function(){define(["exports","../../chunks/vec32","./projectors","../support/Ellipsoid","../support/spatialReferenceUtils"],function(a,b,h,c,k){a.localLinearScaleFactors=function(m,d,f,g){if(null==d||null==g)return!1;const e=h.classifySpatialReference(d,h.sourceClassificationCache);var n=h.classifySpatialReference(g,h.destClassificationCache);if(e===n&&e!==h.ProjectionID.UNKNOWN||k.equals(d,g))return f[0]=1,f[1]=1,f[2]=1,!0;if(e===
h.ProjectionID.SPHERICAL_ECEF){d=b.length(m);m=d/Math.sqrt(m[0]*m[0]+m[1]*m[1]);d/=c.earth.radius;if(n===h.ProjectionID.WEB_MERCATOR)return f[0]=m*d,f[1]=m*d,f[2]=1,!0;if(n===h.ProjectionID.WGS84||n===h.ProjectionID.CGCS2000)return n=h.invPlateCarreeScale,f[0]=n*m*d,f[1]=n*d,f[2]=1,!0}else if(e===h.ProjectionID.PLATE_CARREE){if(n===h.ProjectionID.WGS84||n===h.ProjectionID.CGCS2000)return f[0]=h.invPlateCarreeScale,f[1]=h.invPlateCarreeScale,f[2]=1,!0;if(n===h.ProjectionID.WEB_MERCATOR)return n=m[1]/
c.earth.radius,f[0]=1,f[1]=1/Math.cos(n),f[2]=1,!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingSphere":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/factories/vec3f64","./projectors","../support/Ellipsoid"],function(a,b,h,c,k){function m(e,n,l,u){n=u+n;if(n<u/2||l>n)return Number.MAX_VALUE;e=Math.abs(g*e)+Math.asin(l/n);return e>=Math.PI/2?Number.MAX_VALUE:l/Math.cos(e)}const d=h.create(),f=c.createEmptyProjectorCache(),
g=b.deg2rad(1);a.projectBoundingSphere=function(e,n,l,u){if(null==n||null==u)return!1;n=c.populateProjectorCache(n,u,f);if(n.projector===c.copy3)return l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],!0;if(null==n.projector)return!1;const {source:x,dest:w}=n;if(w.spatialReferenceId===c.ProjectionID.WEB_MERCATOR){n=c.projectionTable[x.spatialReferenceId][c.ProjectionID.WGS84];if(null==n)return!1;n(e,0,d,0);c.wgs84ToWebMercator(d,0,l,0);l[3]=m(d[1],e[2],e[3],k.earth.radius);return!0}if(x.spatialReferenceId!==
c.ProjectionID.WGS84&&x.spatialReferenceId!==c.ProjectionID.CGCS2000||w.spatialReferenceId!==c.ProjectionID.PLATE_CARREE)n.projector(e,0,l,0),l[3]=e[3]*(x.metersPerUnit??1)/(w.metersPerUnit??1);else{u=c.projectionTable[c.ProjectionID.SPHERICAL_ECEF][c.ProjectionID.PLATE_CARREE];let q=e[3];null!=c.projectionTable[x.spatialReferenceId][c.ProjectionID.SPHERICAL_ECEF]&&null!=u&&(q=m(e[1],e[2],e[3],k.earth.radius));n.projector(e,0,l,0);l[3]=q}return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/UByteArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.newUByteArray=function(h,c=!1){return h<=b.nativeArrayMaxSize?c?Array(h).fill(0):Array(h):new Uint8Array(h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingRect ../dehydratedPoint ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SClientNodeLoader ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/3d/support/MemoryController ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){function J(Q,T){return null!=Q&&Q.length===T.length&&Q.every(ia=>0<=K(T,ia.name))}function K(Q,T){T=T.toLowerCase();for(let ia=0;ia<Q.length;ia++)if(Q[ia].name.toLowerCase()===T)return ia;return-1}b=class extends m.EsriPromiseMixin(b){get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}get isGraphics3D(){return"points"===this.layer.profile}get useMaximumNumberOfFeatures(){return!this.isMeshPyramid&&
(null==this.layer.priority||"High"===this.layer.priority)}get indexStreamController(){const Q=this.layerView.view.resourceController.createStreamDataRequester(H.ClientType.I3S_INDEX);return new E.I3SStreamDataController(Q,this.layer.customParameters,this.layer.apiKey)}get dataStreamController(){const Q=this.layerView.view.resourceController.createStreamDataRequester(H.ClientType.I3S_DATA);return new E.I3SStreamDataController(Q,this.layer.customParameters,this.layer.apiKey)}get crsVertex(){return A.getVertexCrs(this.layer)}get crsIndex(){return A.getIndexCrs(this.layer)}get layer(){return this.layerView.i3slayer}get running(){return this.updating}get rootNodeVisible(){if(this._index){const Q=
this._index.rootNode;if(Q)return this._updateViewData(),this._index.isNodeVisible(Q.index)}return!0}get index(){return this._index}get requiredAttributes(){return this._requiredAttributes}constructor(Q){super(Q);this.screenSizeFactor=0;this.featureTarget=5E4;this.fixedFeatureTarget=!1;this.updating=!0;this.updatingProgress=1;this.leavesReached=!1;this.scaleVisibilityEnabled=!0;this.worker=null;this._featureLOD=1;this._isIdle=this._stableFeatureLOD=!1;this._cameraDirty=!0;this._invisibleDirty=!1;this._idleStateCallbacks=
null;this._newLoadingNodes=new k({deallocator:null});this._loadedNodeScales=new Map;this._modificationsNodeFilteringArray=new k;this._downloadingCount=0;this._loadingNodes=new Map;this._updatingNodes=new Map;this._progressMaxNumNodes=1;this._requiredAttributes=[];this._requiredAttributesDirty=!0;this._restartNodeLoading=this._disableMemCache=this.disableIDBCache=this._updatesDisabled=!1;this._attributeStorageInfo=this._fields=null;this._idleQueue=new w.PromiseQueue;this._elevationUpdateNodes=new k({deallocator:null});
this._errorCount=0}initialize(){const {layerView:Q,layer:T}=this;this._disableMemCache=!Q.loadCachedGPUData||!Q.addCachedGPUData;this._lodHandling=new r(Q);this._defaultGeometrySchema=T.store.defaultGeometrySchema;this.disableIDBCache=h("disable-feature:idb-cache");"fields"in T&&(this._fields=T.fields,this._attributeStorageInfo=T.attributeStorageInfo);this.addResolvingPromise(Promise.all([T.indexInfo,T.when(),Q.when()]).then(([ia])=>{if(!this.destroyed&&Q&&!Q.destroyed&&ia){var {view:O,clientGeometry:U}=
Q,{resourceController:P}=O;this._setClippingArea(O.clippingArea);this.addHandles([f.watch(()=>O?.pointsOfInterest?.focus?.renderLocation,R=>this._pointOfInterestChanged(R),f.initial),f.watch(()=>O.quality,()=>this._setCameraDirty(),f.sync),f.watch(()=>Q.contentVisible,R=>{const ba=R?()=>this._updateIdleState(!0):()=>this._updateViewData(),X=R?()=>this._updateIdleState(!1):()=>{};R&&null!=this._index&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(R||this.cancelNodeLoading(),
this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ba,this._idleStateCallbacks.idleEnd=X):this._idleStateCallbacks=P.scheduler.registerIdleStateCallbacks(ba,X)},f.initial),p.addCallback(Q.view.resourceController.scheduler,this),f.watch(()=>Q.uncompressedTextureDownsamplingEnabled,()=>this.restartNodeLoading()),f.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),f.watch(()=>O.state?.contentCamera,()=>this._setCameraDirty()),f.watch(()=>
T.elevationInfo,R=>this._elevationInfoChanged(R)),f.watch(()=>T.effectiveScaleRange,()=>this._scaleBoundsChanged()),f.watch(()=>Q.lodFactor,()=>this._setCameraDirty()),f.watch(()=>Q.availableFields,()=>this._requiredFieldsChange()),f.watch(()=>Q.holeFilling,R=>null!=this._index&&(this._index.holeFilling=R))]);this._updateScaleHandles();this._viewportQueries=new B(this.crsIndex,O.renderCoordsHelper,O.state.contentCamera,!O.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?
O.basemapTerrain:O.elevationProvider,q.viewingModeFromString(O.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._clientNodeLoader=new v.I3SClientNodeLoader(this.layer.uid,{indexSR:this.crsIndex,vertexSR:this.crsVertex,renderSR:O.renderCoordsHelper.spatialReference,localMode:"local"===O.viewingMode},O.resourceController.memoryController,this.worker);this._index=new t.I3SIndex(q.viewingModeFromString(O.viewingMode),
T,ia,this.indexStreamController,this._clientNodeLoader,this._viewportQueries,c.getLogger(this),Q.holeFilling,R=>Q.isNodeLoaded(R),R=>Q.isNodeReloading(R),R=>this._shouldLoadNode(R),R=>this._enableFromGPUCache(R,y.NodeState.Leaf),R=>this._needsUpdate(R),()=>!this.indexStreamController.busy,R=>Q.computeVisibilityObb?.(R)??null,Q?.computeNodeFiltering?R=>Q.computeNodeFiltering(R):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!Q.hasModifications);
this._index.layerFilterChanged(!!Q.hasGeometryFilter);if(null!=U){for(const R of U)this._addMesh(R.mesh,R.oid);this.addHandles(U.on("change",R=>{for(const ba of R.removed)this._removeMesh(ba.oid);for(const ba of R.added)this._addMesh(ba.mesh,ba.oid)}))}this._startNodeLoading()}}));this._tmpPoint=x.makeDehydratedPoint(0,0,0,this.crsIndex)}updateNodeModificationStatus(Q){const T=this._index,ia=this.layerView;null!=T&&ia?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),Q.forAll(O=>
{O=T.getNode(O);null!=O&&this._modificationsNodeFilteringArray.push(O)}),ia.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)}destroy(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._nodeLoader=null;I.prune();null!=M&&(M.hide(),M=null)}get viewportQueries(){return this._viewportQueries}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];
const Q=this._attributeStorageInfo,T=this._fields,ia=this.layer.objectIdField;return this.layerView.availableFields.map(O=>{const U=K(Q,O);O=K(T,O);return 0<=U&&0<=O?{index:U,name:T[O].name,field:T[O],attributeStorageInfo:Q[U]}:null}).filter(O=>null!=O&&O.name!==ia)}_requiredFieldsChange(){const Q=this._getRequiredAttributes();J(this._requiredAttributes,Q)||(this._requiredAttributes=Q,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0;this.restartNodeLoading()}_setClippingArea(Q){const T=
u.create();G.toBoundingRect(Q,T,this.layerView.view.renderSpatialReference)?this._clippingArea=T:this._clippingArea=null}_pointOfInterestChanged(Q){null!=this._viewportQueries&&(this._viewportQueries.setPointOfInterest(Q),null!=this._index&&(this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(Q){this._setClippingArea(Q);null!=this._viewportQueries&&null!=this._index&&(this._viewportQueries.updateClippingArea(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}_addMesh(Q,T){null!=this._index&&(Q=this._clientNodeLoader.createMeshNodeInfo(Q,T),T=this._index.addClientNodeToIndex(Q.id,Q.mbs),this._clientNodeLoader.addMeshNode(T,Q),this._evaluateUpdating(),this.notifyChange("rootNodeVisible"))}_removeMesh(Q){Q=this._clientNodeLoader.getMeshNodeIndex(Q);if(null!=Q)if(null!=this._index)this._index.removeClientNodeFromIndex(Q,
(T,ia)=>{this.layerView.removeNode(ia);this._loadedNodeScales.delete(ia);this._clientNodeLoader.removeNode(T);this.layerView.deleteCachedNodeData&&null!=T&&this.layerView.deleteCachedNodeData(T);this.layerView.deleteCachedGPUData?.(this.layerView.loadCachedGPUData?.(ia))},(T,ia,O)=>{this._clientNodeLoader.updateNodeIndex(T,ia,O);this.layerView.updateNodeIndex&&this.layerView.updateNodeIndex(ia,O)}),this.notifyChange("rootNodeVisible");else throw Error("delayed removal of client side i3s node geometry not supported yet.");
}updateElevationChanged(Q,T){const ia=this._index;if(null==ia?.rootNode||null==T)return null;this.crsIndex.equals(T)||(l.projectBoundingRect(Q,T,N,this.crsIndex),Q=N);const O=this._elevationUpdateNodes;O.clear();A.findIntersectingNodes(Q,ia.rootNode,ia,U=>O.push(U.index));O.length&&(O.forAll(U=>ia.updateElevationChanged(U)),this._setCameraDirty());return O}removeAllGeometryObbs(){null!=this._index&&this._index.removeAllGeometryObbs()}getRenderMbs(Q){return null!=this._viewportQueries?this._viewportQueries.getServiceMbsInRenderSR(Q):
null}_elevationInfoChanged(Q){null!=this._index&&(this._index.updateElevationInfo(Q,this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())}_updateScaleHandles(){this.removeHandles("scale-bounds");this._areScaleBoundsActive&&this.addHandles(this.layerView.view.basemapTerrain.on("scale-change",Q=>this._scaleUpdateHandler(Q)),"scale-bounds")}_scaleBoundsChanged(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()}_scaleUpdateHandler(Q){this._updateScaleInBoundingRect(Q.extent,
Q.spatialReference);this._setCameraDirty()}_updateScaleInBoundingRect(Q,T){const ia=this._index;null!=ia&&null!=ia.rootNode&&l.projectBoundingRect(Q,T,N,this.crsIndex)&&this._loadedNodeScales.forEach((O,U)=>{O=ia.getNode(U);null!=O&&u.intersectsSphere(N,O.serviceMbsInIndexSR)&&this._loadedNodeScales.set(U,this._computeScale(O))})}restartNodeLoading(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()}schedule(Q,T){return this._idleQueue.push(Q,T)}reschedule(Q,T){return this._idleQueue.unshift(Q,
T)}get _isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get _areScaleBoundsActive(){const {minScale:Q,maxScale:T}=C.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<Q||0<T)}get unloadedMemoryEstimate(){return null!=this._index&&this.layerView.contentVisible?this._index.unloadedMemoryEstimate*this._lodDropFactor:0}async _loadNodeData(Q,T){return 0>Q.index?this._clientNodeLoader.loadNodeData(Q.id,T):this._nodeLoader.loadNodeData(Q,T)}async _loadAttributes(Q,T,ia){return(0>
Q.index?this._clientNodeLoader:this._nodeLoader).loadAttributes(Q,T,ia)}get indexDepth(){return null!=this._index?this._index.maxLevel:0}set disableMemCache(Q){this._disableMemCache=this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData?Q:!0}runTask(Q,T){if(!this.layerView.contentVisible)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||null==this._index)return-Infinity;this._processWithErrorLogging(Q,T);return this._index.maxPriority}_processWithErrorLogging(Q,
T){try{this._process(Q,T)}catch(ia){50>this._errorCount?c.getLogger(this).error(`Error during processing: ${ia} at ${ia.stack}`):50===this._errorCount&&c.getLogger(this).error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(Q,T){this._restartNodeLoading&&this._startNodeLoading();null!=this._nodeLoader&&null!=this._index&&(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(Q)&&(this._invisibleDirty=!1),this._isIntegratedMesh&&
(Q.enabled=!1),Q.run(()=>this._processIndex(Q)),this._updateFeatureLOD(),Q.run(()=>this._processCache(Q)),this._isIntegratedMesh&&(Q.enabled=!0),Q.run(()=>this._processNodes(Q,T)),this._idleQueue.runTask(Q),Q.run(()=>this._prefetchIndex()),T.numIndexLoading+=this._index.indexLoading,T.numNodesLoading+=this._downloadingCount,Q.run(()=>this._lodHandling.lodGlobalHandling(Q)),this._evaluateUpdating())}_processIndex(Q){if(null==this._index)return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),
Q,T=>this.updateNodeModificationStatus(T)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),Q=this._index.featureEstimate.leavesReached,this._index.isLoading||Q===this._get("leavesReached")||this._set("leavesReached",Q));return this._index.load()}_prefetchIndex(){return null==this._index||0<this._loadingNodes.size||0<this._index.updates.add.length?
!1:this._index.prefetch()}_updateFeatureLOD(){if(this.useMaximumNumberOfFeatures&&null!=this._index&&null!=this._viewportQueries){var Q=!this._index.isLoading,T=this.featureTarget*this._baseLOD,ia=this._index.featureEstimate;ia.estimate=ia.estimate||T/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(Q&&ia.estimate<T){if(ia.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(T/
ia.estimate,1.001));Q=this._lod;T=this._index.checkFeatureTarget(T,Q);T!==Q&&(this._featureLOD=T/this._baseLOD,this._stableFeatureLOD=!0)}else if(ia.estimate>1.2*T||Q&&ia.estimate>T){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(ia.estimate/T-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.requestUpdate()}}_processCache(Q){const T=this._index;if(null==T)return!1;
for(;0<this._newLoadingNodes.length&&!Q.done;){var ia=this._newLoadingNodes.pop();for(ia=T.getParent(ia);null!=ia&&!this.layerView.isNodeLoaded(ia.index)&&this._isNodeInScaleBounds(ia);ia=T.getParent(ia.index))if(this._enableFromGPUCache(ia,y.NodeState.Hole)){Q.madeProgress();break}}return Q.hasProgressed}_processNodes(Q,T){if(null==this._index)return!1;let ia=(this._isIdle?100:2)-this._loadingNodes.size;const O=this._index.updates;O.cancel.forEach(this._cancelNode,this);for(O.cancel=[];0<O.remove.length&&
!Q.done;)this.layerView.removeNode(O.remove.pop()),Q.madeProgress();for(;0<O.update.length&&!Q.done;){var U=this._index.getNode(O.update.pop());null!=U&&(this._updateLoadedNode(U),Q.madeProgress())}for(;0<O.add.length&&!Q.done&&0<ia;){--ia;U=this._index.getNode(O.add.back());if(null==U||U.cacheState!==y.CacheState.Cached&&!this._hasNodeLoadToken(T))break;O.add.pop();this._loadNode(U);Q.madeProgress()}return Q.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach(Q=>Q.abort());this._loadingNodes.clear();
this._updatingNodes.forEach(Q=>Q.abort());this._updatingNodes.clear()}_cancelNode(Q){const T=this._loadingNodes.get(Q);T&&(T.abort(),this._loadingNodes.delete(Q))}_hasNodeLoadToken(Q){return!this._isIdle&&2<=Q.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<H.maxDownloadSlots&&!this.dataStreamController.busy}_evaluateUpdating(){let Q=!1;var T=0;this.layerView&&(this.layerView.contentVisible?(T=(null!=this._index?this._index.indexMissing:0)+3*(null!=this._index?this._index.updates.add.length:
0)+2*this._loadingNodes.size,Q=!!(0<T||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||null!=this._index&&this._index.isPrefetching),0===T&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(T,this._progressMaxNumNodes),T=1-T/this._progressMaxNumNodes):T=(Q=this._cameraDirty)?0:1,this.updating=Q,this.updatingProgress=T)}_updateViewData(){if(this._cameraDirty&&null!=this._index&&
null!=this._viewportQueries){var Q=this.layerView.view,{contentCamera:T,fixedContentCamera:ia}=Q.state;this.screenSizeFactor=1/(T.perScreenPixelRatio/2);this._viewportQueries.updateCamera(T,!ia||this.isGraphics3D);this._viewportQueries.setPointOfInterest(Q.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();
this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}}_getProgressiveLoadFactor(){return 1>this.layerView.view.quality?1:this.layerView.progressiveLoadFactor}get _lod(){return this._featureLOD*this._baseLOD}get _baseLOD(){const Q=this.layerView.lodFactor;return this.fixedFeatureTarget?1:(0<Q?Q:1)*this.layerView.view.quality}get _lodDropFactor(){return this.fixedFeatureTarget?1:(Math.min(this.layerView.view.quality,.5)-L.minQuality)/(.5-L.minQuality)}isGeometryVisible(Q){return!!this._index?.isGeometryVisible(Q.index)}updateVisibility(Q){this._index?.invalidateNodeVisibilityCache(Q)}invalidateGeometryVisibility(Q){this._index?.invalidateGeometryVisibility(Q)}invalidateVisibilityObbs(){this._index?.invalidateVisibilityObbs()}modificationsChanged(){this._index?.imModificationsChanged(!!this.layerView.hasModifications);
this._invisibleDirty=!0}_shouldLoadNode(Q){return this._lodHandling.shouldLoadNode(Q)&&!this._shouldDropNode(Q)&&null!=this._index&&this._index.isGeometryVisible(Q.index)?this._isNodeInScaleBounds(Q):!1}_shouldDropNode(Q){if(null==this._viewportQueries)return!1;const T=this._lodDropFactor;return 1<=T||!this._lodHandling.hasNoVisibleChildren(Q)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(Q))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*
T}_startNodeLoading(){this._restartNodeLoading=!1;const Q=this._index;if(!this._updatesDisabled&&null!=Q&&null!=this._viewportQueries){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var T={textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures};
this._nodeLoader=new D(this.layer,this.dataStreamController,c.getLogger(this),this._defaultGeometrySchema,this._requiredAttributes,T);Q.requestUpdate();this._lodHandling.startNodeLoading(ia=>this._isNodeInScaleBounds(ia),(ia,O)=>this._removeNodes(ia,O,V.fadeout),Q,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(Q){const T=this._index;if(null==T||null==this._viewportQueries)return!1;I.clear();this.layerView.getLoadedNodeIndices(I);const ia=0===this._viewportQueries.maxDistance,O=ia?()=>!1:U=>this._shouldDropNode(U);I.filterInPlace(U=>{const P=T.getNode(U);return null==P||!T.isGeometryVisible(U)||O(P)||!this._isNodeInScaleBounds(P)});0<I.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(I,
Q,V.pop);if(ia&&1>this._lodDropFactor)return!1;if(0===I.length)return!0;I.clear();return!1}markNodeToRemove(Q){I.push(Q)}removeMarkedNodes(){this._removeNodes(I,z.noBudget,V.pop)}_removeNodes(Q,T,ia){const O=Q.length;if(0!==O&&!T.done){for(null!=this._index&&this._index.requestUpdate();0<Q.length&&!T.done;){const U=Q.pop(),P=this._index;ia===V.fadeout&&this.layerView.nodeFadeoutEnabled&&null!=P&&P.isGeometryVisible(U)?this.layerView.fadeNode(U,F.FadeDirection.FadeOut,!0):this.layerView.removeNode(U);
T.madeProgress()}if(0<this._loadedNodeScales.size)for(T=Q.length;T<O;T++)this._loadedNodeScales.delete(Q.data[T])}}_needsUpdate(Q){if(Q.resources.isEmpty||this._updatingNodes.has(Q.index))return!1;Q=this.layerView.getLoadedAttributes(Q.index);return null!=Q&&Q!==this._requiredAttributes}async _updateLoadedNode(Q){const T=new AbortController;this._updatingNodes.set(Q.index,T);this._evaluateUpdating();try{const ia=this.layerView.getLoadedAttributes(Q.index);let O=null;O=J(ia,this._requiredAttributes)?
this.layerView.getAttributeData(Q.index):await this._loadAttributes(Q,this._requiredAttributes,T.signal);await this.schedule(()=>this.layerView.updateAttributes(Q.index,{loadedAttributes:this._requiredAttributes,attributeData:O},T.signal),T.signal)}catch(ia){if(!d.isAbortError(ia))return this.layerView.updateAttributes(Q.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},T.signal)}this._updatingNodes.delete(Q.index);this._evaluateUpdating()}_loadNode(Q){if(this._loadingNodes.has(Q.index))c.getLogger(this).error("already loading node "+
Q.index);else{var T=new AbortController;this._loadingNodes.set(Q.index,T);this._evaluateUpdating();this._loadAndAddNode(Q,T.signal).then(ia=>{ia&&null!=this._index&&this._loadingNodes.get(Q.index)===T&&(this._loadingNodes.delete(Q.index),this._index.requestUpdate())}).catch(ia=>{if(!d.isAbortError(ia))throw ia;}).finally(()=>{this._loadingNodes.get(Q.index)===T&&this._loadingNodes.delete(Q.index);this._evaluateUpdating()})}}_loadAndAddNode(Q,T){return Q.cacheState===y.CacheState.Uncached?this._loadUncached(Q,
T).then(()=>!1):this._loadCached(Q,T).then(ia=>{if(ia)return!1;Q.cacheState=y.CacheState.Uncached;return!0}).catch(ia=>d.isAbortError(ia)?!1:(Q.cacheState=y.CacheState.Uncached,!0))}_enableFromGPUCache(Q,T){if(this._disableMemCache||null==this._index)return!1;if(T===y.NodeState.Hole&&!this._index.useNodeAsHole(Q.index))return!0;const ia=this._loadCachedGPUData(Q);if(!ia)return!1;this.layerView.addCachedGPUData(Q,ia,T);this._nodeAdded();return!0}_loadCachedGPUData(Q){Q=this.layerView.loadCachedGPUData(Q.index);
if(null!=Q?.attributeInfo&&J(Q.attributeInfo.loadedAttributes,this._requiredAttributes))return Q;this.layerView.deleteCachedGPUData(Q);return null}_nodeAdded(){null!=this._index&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}updateLoadStatus(Q,T){const ia=this._index;null!=ia&&ia.updateChildrenLoaded(Q,T?1:-1)}async _loadCached(Q,T){if(this._enableFromGPUCache(Q,y.NodeState.Leaf))return!0;const ia=this.layerView;if(this.disableIDBCache||!ia.loadCachedNodeData||
!ia.addCachedNodeData)return!1;const O=(da,ha)=>this._nodeLoader.loadTextures(Q,da,ha),U=(da,ha)=>this._clientNodeLoader.loadTextures(Q,da,ha),P=0<=Q.index?O:U,R=await this.schedule(()=>ia.loadCachedNodeData(Q,T,P),T);if(null==R)return!1;const ba=this._requiredAttributes,X=await this.reschedule(()=>this._loadAttributes(Q,ba,T),T);await this.reschedule(()=>ia.addCachedNodeData(Q,R,{loadedAttributes:ba,attributeData:X},T),T);this._nodeAdded();return!0}_loadUncached(Q,T){this._downloadingCount++;return this._loadNodeData(Q,
T).catch(ia=>{this._downloadingCount--;throw ia;}).then(ia=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(Q,ia,T),T)}).then(()=>{this._nodeAdded();Q.cacheState=y.CacheState.Cached}).catch(ia=>{if(!d.isAbortError(ia))throw c.getLogger(this).error("#loadNodeData()",this.layer,`Failed to load node '${Q.id}'`,ia),Q.failed=!0,null!=this._index&&this._index.requestUpdate(),ia;})}_updateIdleState(Q){Q!==this._isIdle&&(this._isIdle=Q,this._evaluateUpdating(),Q&&this._index&&null!=
this._index&&this._index.resetFailedNodes())}_getScale(Q){if(this._loadedNodeScales.has(Q.index))return this._loadedNodeScales.get(Q.index);const T=this._computeScale(Q);this.layerView.isNodeLoaded(Q.index)&&this._loadedNodeScales.set(Q.index,T);return T}_computeScale(Q){this._tmpPoint.x=Q.serviceMbsInIndexSR[0];this._tmpPoint.y=Q.serviceMbsInIndexSR[1];this._tmpPoint.z=Q.serviceMbsInIndexSR[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,Q.serviceMbsInIndexSR[3])}_isNodeInScaleBounds(Q){if(!this._areScaleBoundsActive)return!0;
Q=this._getScale(Q);const {minScale:T,maxScale:ia}=C.extractSafeScaleBounds(this.layer);return C.scaleBoundsPredicate(Q,T,ia)}get test(){const Q=this;return{index:this._index,set disableUpdates(T){(Q._updatesDisabled=T)?Q.cancelNodeLoading():Q.requestUpdate()},set disableIDBCache(T){Q.disableIDBCache=T},set ignoreServiceObb(T){null!=Q._index&&(Q._index.ignoreServiceObb=T)},shouldLoadNode:T=>Q._shouldLoadNode(T)}}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();null!=
this._index&&this._index.requestUpdate()}geometryFilterChanged(Q){const T=this._index;null!=T&&T.layerFilterChanged(Q);this._setCameraDirty()}};a.__decorate([g.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"isGraphics3D",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"useMaximumNumberOfFeatures",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"indexStreamController",null);a.__decorate([g.property({readOnly:!0})],
b.prototype,"dataStreamController",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"crsVertex",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"crsIndex",null);a.__decorate([g.property()],b.prototype,"screenSizeFactor",void 0);a.__decorate([g.property()],b.prototype,"featureTarget",void 0);a.__decorate([g.property()],b.prototype,"fixedFeatureTarget",void 0);a.__decorate([g.property()],b.prototype,"layerView",void 0);a.__decorate([g.property()],b.prototype,"layer",null);a.__decorate([g.property()],
b.prototype,"updating",void 0);a.__decorate([g.property({readOnly:!0})],b.prototype,"running",null);a.__decorate([g.property()],b.prototype,"updatingProgress",void 0);a.__decorate([g.property({readOnly:!0})],b.prototype,"leavesReached",void 0);a.__decorate([g.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);a.__decorate([g.property({constructOnly:!0})],b.prototype,"worker",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",null);b=
a.__decorate([n.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b);const I=new k({deallocator:null});let M;const S={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=u.create();var V;(function(Q){Q[Q.pop=0]="pop";Q[Q.fadeout=1]="fadeout"})(V||={});return b})},"esri/views/3d/layers/i3s/I3SClientNodeLoader":function(){define("exports ../../../../core/Error ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/uuid ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/meshVertexSpaceUtils ../../../../chunks/sphere ./I3SClientMaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){function w(t,r){var {spatialReference:y}=t;const D=[1,-1],E=[.5*t.width,.5*t.height,t.hasZ?.5*(t.zmax-t.zmin):0];y=y.isGeographic?y.metersPerUnit:1;const A=t.center;let B=0;if(t.hasZ)for(t=0;2>t;++t)for(var F=0;2>F;++F)for(var G=0;2>G;++G){var H=(A.x+D[t]*E[0]-r.x)*y;const L=(A.y+D[F]*E[1]-r.y)*y,C=A.z+D[G]*E[2]-r.z;B=Math.max(H*H+L*L+C*C,B)}else for(t=0;2>t;++t)for(F=0;2>F;++F)G=(A.x+D[t]*E[0]-r.x)*y,H=(A.y+D[F]*E[1]-r.y)*y,B=Math.max(G*G+H*H,B);return u.fromCenterAndRadius([r.x,
r.y,r.z],Math.sqrt(B))}async function q(t,r,y,D){const {transform:E,vertexAttributes:A}=r.loadedMesh;t="source"===t.shading?A.normal:null;if(null==t||null==E||0===E.rotationAngle&&g.exactEquals(E.scale,e.ONES))return{transformed:t,original:A.normal};if(!r.normalsTransformPromise){h.assertIsSome(y,"SceneLayerWorker is needed to transform mesh normals");const B=f.create();d.normalFromMat4(B,E.localMatrix);r.normalsTransformPromise=y.transformNormals({normalMatrix:B,normals:t},D)}return r.normalsTransformPromise}
function v(t,r,y){t[r]=255&y;t[r+1]=255&y>>8;t[r+2]=255&y>>16;t[r+3]=255&y>>24}class p{constructor(t,r,y,D){this._uid=t;this._worker=D;this._id2Meta=new Map;this._oid2Meta=new Map;this._indexSR=r.indexSR;this._vertexSR=r.vertexSR;this._renderSR=r.renderSR;this._localMode=r.localMode;this._memCache=y.newCache(`sl-client-mesh-data-${this._uid}`)}get uid(){return this._uid}get worker(){return this._worker}get indexSR(){return this._indexSR}get renderSR(){return this._renderSR}createMeshNodeInfo(t,r){const y=
`mesh${r}`;var D=t.extent,E=D.spatialReference,A=this._indexSR;D=w(D,t.origin);n.projectBoundingSphere(D,E,D,A);A=t.metadata.displaySource?.source;if(null==A||!Array.isArray(A)||!A.length||A[0]instanceof File)var B=m.generateUUID();else{E="";for(B of A)E+=B.makeHash();B=JSON.stringify(null!=t.transform?t.transform.toJSON():"");A=l.isRelativeVertexSpace(t.vertexSpace)?JSON.stringify(t.vertexSpace.origin):"";B=E+B+A}return{type:"mesh",id:y,version:B,oid:r,mbs:D,componentNodeIds:[],unloadedMesh:t,nodeIndex:null,
loadMeshPromise:null}}addMeshNode(t,r){if(null!=this.getMeshNodeIndex(r.oid))throw new b(`I3SClientNodeLoader: client side mesh for feature oid=${r.oid} already exists`);r.nodeIndex=t;this._id2Meta.set(r.id,r);this._oid2Meta.set(r.oid,r)}getMeshNodeIndex(t){t=this._oid2Meta.get(t);return null==t||"mesh"!==t.type?null:t.nodeIndex}removeNode(t){const r=this._id2Meta.get(t);null!=r&&(this._id2Meta.delete(t),"mesh"===r.type&&this._oid2Meta.delete(r.oid))}async loadNodeJSON(t){const r=this._id2Meta.get(t);
if(null==r)throw new b(`I3SClientNodeLoader::loadNodeJSON unable to find node ${t}`);switch(r.type){case "mesh":return this._loadMeshNodeJSON(r);case "mesh-component":return this._loadMeshComponentNodeJSON(r);default:throw new b(`I3SClientNodeLoader::loadNodeJSON unable to handle node ${t}`);}}async _loadMeshNodeJSON(t){const r=t.id;var y=(await this._getMeshData(t)).loadedMesh;if(null==y.components||0===y.components.length)return{id:r,version:null,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,
attributeData:null,featureData:null,children:null};const D=[];y=y.components;for(let E=0;E<y.length;++E){const A=`${r}-component${E}`,B={type:"mesh-component",id:A,mbs:t.mbs,componentIndex:E,meshNodeInfo:t,textureData:new Map};this._id2Meta.set(B.id,B);t.componentNodeIds.push(A);D.push({id:B.id,href:null,mbs:B.mbs,obb:null})}return{id:r,version:null,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:D}}updateNodeIndex(t,r,y){(t=this._id2Meta.get(t))&&
"mesh"===t.type&&(t.nodeIndex=y)}async _loadMeshComponentNodeJSON(t){return{id:t.id,version:t.meshNodeInfo.version,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null,isEmpty:!1}}async loadNodeData(t,r){var y=this._id2Meta.get(t);if(null==y||"mesh-component"!==y.type)throw new b(`Failed to load client node data for node ${t} (unexpected node info)`);var D=y.meshNodeInfo,E=await this._getMeshData(D),A=E.loadedMesh;D=D.oid;if(null==A.components)throw new b(`Failed to load client node data for node ${t} (unexpected null reference)`);
t=A.components[y.componentIndex];const {material:B,requiredTextures:F,textureData:G}=await x.convertMeshMaterialToPBRMaterial(t.material);if(null!=G)for(var H of G)null!=H&&y.textureData.set(H.id,H);y={params:{material:B},type:"ArrayBufferView"};const {vertexSpace:L,origin:C,transform:z}=A;H=[C.x,C.y,C.z??0];y={featureDataPosition:H,featureIds:[],geometries:[y]};E.projectionPromise||(h.assertIsSome(this._worker,"SceneLayerWorker is needed to project mesh"),E.projectionPromise=this._worker.project({positions:A.vertexAttributes.position,
localMatrix:z?.localMatrix,vertexSpace:L.toJSON(),origin:H,inSpatialReference:A.spatialReference.toJSON(),outSpatialReference:this._vertexSR.toJSON(),localMode:this._localMode},r));const {projected:J,original:K}=await E.projectionPromise;A.vertexAttributes.position=K;const {transformed:I,original:M}=await q(t,E,this._worker,r);A.vertexAttributes.normal=M;k.throwIfAborted(r);r=t.faces;E=A.vertexAttributes.uv;A=A.vertexAttributes.color;t=r.length/3;var S=3*t,N,V=0;H=!1;var Q=0;let T=!1;var ia=0;let O=
!1;var U=0;let P=0,R=0;V=N=8;N+=12*S;null!=I&&(H=!0,Q=N,N+=12*S);null!=E&&(T=!0,ia=N,N+=8*S);null!=A&&(O=!0,U=N,N+=4*S);P=N;R=N+=8;N=new ArrayBuffer(N+8);const ba=new Uint8Array(N);v(ba,0,S);v(ba,4,1);S=new Float32Array(N,V);Q=null!=I?new Float32Array(N,Q):null;ia=null!=E?new Float32Array(N,ia):null;U=null!=A?new Uint8Array(N,U):null;for(V=0;V<t;++V){const Z=3*V;for(let ea=0;3>ea;++ea){var X=r[Z+ea],da=3*X,ha=9*V+3*ea;S[ha]=J[da];S[ha+1]=J[da+1];S[ha+2]=J[da+2];null!=Q&&(Q[ha]=I[da],Q[ha+1]=I[da+
1],Q[ha+2]=I[da+2]);null!=ia&&(da=2*X,ha=6*V+2*ea,ia[ha]=E[da],ia[ha+1]=E[da+1]);null!=U&&(X*=4,da=12*V+4*ea,U[da]=A[X],U[da+1]=A[X+1],U[da+2]=A[X+2],U[da+3]=A[X+3])}}v(ba,P,D);v(ba,P+4,D/2**32);v(ba,R,0);v(ba,R+4,t-1);const {geometryBuffer:fa,geometryDescriptor:aa}={geometryBuffer:N,geometryDescriptor:{isDraco:!1,isLegacy:!0,color:O,normal:H,uv0:T,uvRegion:!1,featureIndex:!0}};return{geometryData:y,attributeDataInfo:{attributeData:{},loadedAttributes:[]},geometryBuffer:fa,geometryDescriptor:aa,requiredTextures:F,
textureData:G,normalReferenceFrame:this._vertexSR.isGeographic?"east-north-up":"vertex-reference-frame"}}async loadAttributes(t,r,y){t=t.numFeatures;y={};for(const {field:{name:D}}of r)y[D]=Array(t);return y}async loadTextures(t,r,y){y=this._id2Meta.get(t.id);if(null==y||"mesh-component"!==y.type)throw Error(`Failed to load textures for node ${t.id} (unexpected node info)`);t=[];for(const D of r)t.push(y.textureData.get(D.id)||null);return t}async _getMeshData(t){const r=t.version,y=this._memCache.get(r);
if(null==y){if(null!=t.loadMeshPromise)return t.loadMeshPromise;const D=async(E,A)=>{var B=t.unloadedMesh.clone();try{await B.load()}catch(F){A(F)}A=B.memoryUsage;B={loadedMesh:B,projectionPromise:null,normalsTransformPromise:null,usedMemoryInBytes:A};this._memCache.put(r,B,A,c.MinPriority);t.loadMeshPromise=null;E(B)};t.loadMeshPromise=new Promise((E,A)=>D(E,A));return t.loadMeshPromise}return y}}a.I3SClientNodeLoader=p;a.createSphereFromExtent=w;a.sizeOfFloat32=4;a.sizeOfInt32=4;a.sizeOfUInt64=
8;a.sizeOfUInt8=1;a.transformNormals=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SClientMaterialUtil":function(){define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/textureUtils ../../webgl-engine/materials/pbrUtils".split(" "),function(a,b,h,c,k,m,d,f,g){async function e(n,l,u,x){if(null==n)return-1;const w=
u.length;var q=n.data;n=n.url;if(null!=q){if(q instanceof HTMLImageElement||q instanceof HTMLCanvasElement)return q=f.downsampleImage(q),u.push({id:w,usage:x,data:q,encoding:m.TextureEncoding.PNG,downsampled:!1}),l.push({id:w,usage:x,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),w;if(!(q instanceof HTMLVideoElement)){if(q instanceof ImageData)throw new h("ImageData textures not supported yet for client side I3S nodes");if(q instanceof k.EncodedMeshTexture)throw new h("EncodedMeshTexture textures not supported yet for client side I3S nodes");
}}else if(null!=n)return q=new Image,q.src=n,q=await c.loadImageAsync(q,q.src,!1,void 0),q=f.downsampleImage(q),u.push({id:w,usage:x,data:q,encoding:m.TextureEncoding.PNG,downsampled:!1}),l.push({id:w,usage:x,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),w;return-1}a.convertMeshMaterialToPBRMaterial=async function(n){const l=[],u=[];if(null==n)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,
0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:l,textureData:u};const x=n.hasOwnProperty("metallicRoughnessTexture");"auto"===n.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const w=g.useSchematicPBR({normalTexture:n.normalTexture,emissiveTexture:x?n.emissiveTexture:null,emissiveFactor:x?
b.toUnitRGB(n.emissiveColor):null,occlusionTexture:x?n.occlusionTexture:null,metallicRoughnessTexture:x?n.metallicRoughnessTexture:null,metallicFactor:x?n.metallic:null,roughnessFactor:x?n.roughness:null}),q=w?g.defaultSchematicMRRFactors[0]:x?n.metallic:0,v=w?g.defaultSchematicMRRFactors[1]:x?n.roughness:0;return{material:{alphaMode:"auto"===n.alphaMode?"blend":n.alphaMode,alphaCutoff:n.alphaCutoff,doubleSided:n.doubleSided,cullFace:n.doubleSided?d.CullFaceOptions.None:d.CullFaceOptions.Back,normalTextureId:await e(n.normalTexture,
l,u,m.TextureUsage.Normal),emissiveTextureId:x?await e(n.emissiveTexture,l,u,m.TextureUsage.Emissive):-1,occlusionTextureId:x?await e(n.occlusionTexture,l,u,m.TextureUsage.Occlusion):-1,emissiveFactor:x&&null!=n.emissiveColor?b.toUnitRGB(n.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=n.color?b.toUnitRGBA(n.color):[1,1,1,1],baseColorTextureId:await e(n.colorTexture,l,u,m.TextureUsage.Color),metallicRoughnessTextureId:x?await e(n.metallicRoughnessTexture,l,u,m.TextureUsage.MetallicRoughness):
-1,metallicFactor:q,roughnessFactor:v},wrapTextures:!0,hasParametersFromSource:w},requiredTextures:l,textureData:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=
0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/handleUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e){let n=class extends h{constructor(){super();this.referenceCount=0;this.callbacks=[];this.runIndex=0}get running(){return this.callbacks.some(x=>x.running)}runTask(x){this._sort();const w=this.callbacks,q={numIndexLoading:0,numNodesLoading:0};for(let v=0;v<w.length&&!x.done;++v)w[v].priority=w[v].runTask(x,q),this.runIndex=v}_sort(){const x=this.callbacks;let w=x.length;for(let q=this.runIndex;0<q;q--){const v=x[q-1];let p=q;for(;p<x.length&&v.priority<=x[p].priority&&
(p!==w||v.priority<x[p].priority);)x[p-1]=x[p],p++;x[p-1]=v;w=p-1}this.runIndex=0}add(x){this._sort();x.priority=Infinity;this.callbacks.unshift(x);this.notifyChange("running")}remove(x){c.removeUnordered(this.callbacks,x);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")}};b.__decorate([m.property({readOnly:!0})],n.prototype,"running",null);n=b.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],n);class l{constructor(x,w){this.task=x;this.handle=w}}const u=
new Map;a.addCallback=function(x,w){let q=u.get(x);if(null==q){const v=new n,p=x.registerTask(e.TaskPriority.I3S_CONTROLLER,v);q=new l(v,p);u.set(x,q)}q.task.add(w);return k.makeHandle(()=>{null!=q&&(q.task.remove(w),0<q.task.callbacks.length||(u.delete(x),q.handle.remove(),q.task.destroy()),q=null)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../core/has ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../geometry/projection/projectBoundingSphere ../../../../chunks/sphere ../../../../support/featureFlags ./I3SNode ./I3SUtil ./ValidatedNode ../../support/ElevationRange ../../support/orientedBoundingBox".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l){function u(C,z){return 0>C?-1:0<z?C/z|0:0}function x(C,z){return 0>C?-C-1:0===z?C:C%z}function w(C,z,J){return-1===z?-(C+1):0===J?C:z*J+C}function q(C){if(C)for(let z=0;z<C.length;z++)for(const J of E)if(J[0]===C[z].metricType)return{lodMetric:J[1],maxError:C[z].maxError};return{lodMetric:f.LodMetric.None,maxError:0}}function v(C){return Math.sqrt(4/Math.PI*C)}class p{constructor(C,z,J,K,I){this.childOffset=C;this.childCount=z;this.visibilityCache=J;this.ref=K;this.node=
I;this.useAsHole=0;this.filterImpact=f.NodeFilterImpact.NotChecked;this.traversalState=null;this.parent=-1}}class t{constructor(C=[],z=[]){this.nodes=C;this.children=z;this.numNodesWithLoadedChildren=this.lastTraversed=0}}class r{get _useNodePages(){return 0<this._pageSize}constructor(C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R){this.viewingMode=C;this._layer=z;this._streamDataController=K;this._clientNodeLoader=I;this._viewportQueries=M;this._logger=S;this.holeFilling=N;this._isLoaded=V;this._isReloading=Q;
this._isSelected=T;this._enable=ia;this._needsUpdate=O;this._canRequest=U;this._computeVisibilityObb=P;this._computeNodeFiltering=R;this._dirty=!0;this._nodePages=new Map;this._clientNodePage=null;this._rootIndex=this._pageSize=0;this._lodMetric=f.LodMetric.None;this._lodConversion=ba=>ba;this._isEditable=!1;this._urlPrefix="";this._loadingNodes=new Set;this._loadingPages=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;
this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._version=g.addWraparound(0,2);this._visibilityCacheVersion=g.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missingPagesAndNodes=new h({deallocator:null});this._prefetchNodes=new h({deallocator:null});this._updates=new D(this._missingPagesAndNodes);this._imModificationUncategorized=new h({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=
[];this._newPages=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._frameNumber=0;this._traverseDescendantsQueue=[0];this._traverseDescendantsNestingLevel=0;this._isEditable=d.i3sPatchingEnabled()&&null!=z.associatedLayer?.infoFor3D;z.serviceUpdateTimeStamp?.lastUpdate&&(this._lastUpdate=`${z.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(J)}_init(C){if("page"===C.type){var z=C.rootPage;
this._urlPrefix=C.urlPrefix;this._pageSize=C.pageSize;switch(C.lodMetric){case "maxScreenThreshold":this._lodMetric=f.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=f.LodMetric.MaxScreenThreshold,this._lodConversion=v}if(this._isEditable){this._rootIndex=-1;var J=x(C.rootIndex,C.pageSize);J=z.nodes[J];J={nodes:[{index:this._rootIndex,children:[C.rootIndex],mesh:void 0,obb:J.obb,lodThreshold:J.lodThreshold}]};this._addPage(u(this._rootIndex,this._pageSize),J);this.getNode(-1).serviceObbInIndexSR=
void 0}else this._rootIndex=C.rootIndex;this._addPage(u(C.rootIndex,this._pageSize),z);this._updateParentsAndLevel()}else"node"===C.type&&(this._urlPrefix=C.urlPrefix,z=new t,this._nodePages.set(0,z),this._isEditable?(this._clientNodePage=new t,z={id:"-1",version:null,mbs:C.rootNode.mbs,obb:C.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",href:"../root",mbs:C.rootNode.mbs,obb:C.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new f.NodeBase(z.id,
null),-1),(z=this._validateNode(z.id,z))&&this._addNode(z,this._rootIndex)):this._rootIndex=this._makeRefNode(new f.NodeBase(C.rootNode.id,null),-1),(C=this._validateNode(C.rootNode.id,C.rootNode))&&this._addNode(C,0))}addClientNodeToIndex(C,z){C=new f.NodeBase(C,z);C=this._makeClientRefNode(C,-1);this._linkChildToParentNode(-1,C);this.requestUpdate();return C}removeClientNodeFromIndex(C,z,J){this._destroyClientRefNode(C,z,J);this.requestUpdate()}_loadPage(C){this._loadingPages.add(C);this._streamDataController.request(this._urlPrefix+
C,"json").then(z=>{this._pageQueue.push({pageIndex:C,page:z})}).catch(z=>{this._loadingPages.delete(C);c.isAbortError(z)||(this._failedPages.add(C),this._logger.error("#loadPage()",this._layer,`Error when loading page ${C}`,z))})}_addQueuedPages(C){for(;0<this._pageQueue.length&&!C.done;){const {pageIndex:z,page:J}=this._pageQueue.shift();this._addPage(z,J);this._loadingPages.delete(z);C.madeProgress();this.needNodeElevationRange&&this._newPages.push(z)}this._updateParentsAndLevel()}_invalidateElevationRangeForNewPages(C){if(this.needNodeElevationRange)for(;0<
this._newPages.length&&!C.done;)this._nodePages.get(this._newPages.shift())?.nodes.forEach(z=>{for(z=z.parent;null!=z&&z!==this._rootIndex;){const J=this.getNode(z);J&&!Number.isNaN(J?.elevationRangeMin)&&(J.invalidateElevationRange(),this.invalidateBoundingVolumeCache(z));z=this.getParentIndex(z)}})}_addPage(C,z){const J=[],K=[];z=z.nodes.map((I,M)=>{const S=J.length,N=I.children?I.children.length:0;K.push(this._rootIndex);for(var V=0;V<N;V++)J.push(I.children[V]);const Q=`${I.index}`;V=l.Obb.fromJSON(I.obb);
const T=m.fromCenterAndRadius(V.center,V.radius);var ia=I.mesh?.attribute;const O=I.mesh?.geometry,U=I.mesh?.material;ia={hasSharedResource:!1,isEmpty:null==O,attributes:null!=ia?.resource?`${ia.resource}`:void 0,geometry:null!=O?.resource?`${O.resource}`:void 0,texture:null!=U?.resource?`${U.resource}`:void 0,geometryDefinition:O?O.definition:-1,materialDefinition:U?U.definition:-1};I=new f.Node(Q,w(M,C,this._pageSize),T,N,0,ia,this._lastUpdate,this._lodMetric,this._lodConversion(I.lodThreshold),
O?O.featureCount:null);I.serviceObbInIndexSR=V;I.visibilityObbInRenderSR=this._computeVisibilityObb(I);I.vertexCount=O?O.vertexCount:0;return new p(S,N,g.addWraparound(this._visibilityCacheVersion,-2),null,I)});z=new t(z,J);-1===C?this._clientNodePage=z:this._nodePages.set(C,z)}_updateParentsAndLevel(){const C=[],z=(J,K,I)=>{var M=this._getPage(J);if(null!=M){const S=x(J,this._pageSize);M=M.nodes[S];M.parent=null!=K?K:-1;K=M.node;null!=K&&(K.level=I,C.push(J))}};for(z(this._rootIndex,null,0);C.length;){const J=
C.pop(),K=this.getNode(J);if(null!=K)for(let I=0;I<K.childCount;I++){const M=this.getChildIndex(K.index,I);z(M,J,K.level+1);this._maxLevel=Math.max(this._maxLevel,K.level+1)}}}_getPage(C){C=u(C,this._pageSize);return this._getPageFromPageIndex(C)}_getPageFromPageIndex(C){return 0>C?this._clientNodePage:this._nodePages.get(C)}_getNodeInternal(C){const z=this._getPage(C);if(null==z)return null;z.lastTraversed=this._frameNumber;return z.nodes[x(C,this._pageSize)]}_addNode(C,z){C.children&&this.populateChildren(z,
C.children);var J=this.getParent(z);const K=null!=J?J.level+1:0;this._maxLevel=Math.max(this._maxLevel,C.children?K+1:K);const {lodMetric:I,maxError:M}=q(C.lodSelection);J=this._getNodeInternal(z);z=new f.Node(C.id,z,C.mbs,J.childCount,K,C.resources,C.version,I,M,C.numFeatures);J.node=z;C.obb&&(z.serviceObbInIndexSR=l.Obb.fromJSON(C.obb));z.visibilityObbInRenderSR=this._computeVisibilityObb(z);J=J.ref;null!=J&&(null==J.serviceMbsInIndexSR&&(J.serviceMbsInIndexSR=C.mbs),z.serviceMbsInRenderSR=J.serviceMbsInRenderSR,
z.serviceObbInRenderSR=J.serviceObbInRenderSR,J.visibilityObbInRenderSR=z.visibilityObbInRenderSR);return z}_makeRefNode(C,z){const J=this._nodePages.get(0);if(-1>z)return this._makeClientRefNode(C,z);if(null==J)return-1;const K=J.nodes.length,I=new p(0,0,g.addWraparound(this._visibilityCacheVersion,-2),C,null);J.nodes.push(I);I.parent=z;C.invalidateServiceBVsInRenderSR();return K}_makeClientRefNode(C,z){const J=this._clientNodePage;if(null==J)return-1;if(0<=z)throw Error("I3SIndex::client side nodes can not be made children of service side nodes.");
const K=-(J.nodes.length+1),I=new p(0,0,g.addWraparound(this._visibilityCacheVersion,-2),C,null);J.nodes.push(I);I.parent=z;C.invalidateServiceBVsInRenderSR();return K}_linkChildToParentNode(C,z){const J=this._clientNodePage;if(!(null==J||0<=C)){var K=x(C,this._pageSize),I=x(z,this._pageSize);K=J.nodes[K];var M=K.childOffset;J.children.splice(K.childOffset+K.childCount,0,z);K.childCount+=1;null!=K.node&&(K.node.childCount+=1);for(const S of J.nodes)S.childOffset>M&&(S.childOffset+=1);J.nodes[I].parent=
C;this._updateParentBoundingInformation(C)}}_destroyClientRefNode(C,z,J){const K=this._clientNodePage;if(null!=K){var I=this.getParentIndex(C);if(null!=I){var M=new Set,S=new Map,N=ba=>{var X=x(ba,this._pageSize);X=K.nodes[X];if(0<X.childCount)for(var da=X.childOffset;da<X.childOffset+X.childCount;++da)N(K.children[da]);da=X.node?.id??X.ref?.id;if(null==da)throw Error("Node has no id");z(da,ba);M.add(X)};N(C);C=K.nodes;var V=K.children,Q=K.nodes.map(()=>-1),T=[],ia=[];for(var O=0;O<C.length;++O){var U=
C[O];if(!M.has(U)){var P=T.length,R=w(O,-1,this._pageSize);P=w(P,-1,this._pageSize);U.node&&(U.node.index=P);Q[O]=P;T.push(U);if(R!==P){U=U.node?.id??U.ref?.id;if(null==U)throw Error("Node has no id");J(U,R,P);S.set(R,P)}}}for(J=0;J<T.length;++J){S=w(J,-1,this._pageSize);O=T[J];R=ia.length;for(U=O.childOffset;U<O.childOffset+O.childCount;++U)if(P=V[U],0<=P)ia.push(P);else{P=x(P,this._pageSize);const ba=C[P];M.has(ba)||(ia.push(Q[P]),ba.parent=S)}O.childOffset=R;O.childCount=ia.length-R;O.node&&(O.node.childCount=
O.childCount)}K.nodes=T;K.children=ia;this._updateParentBoundingInformation(Q[x(I,this._pageSize)])}}}_updateParentBoundingInformation(C){do{let K=null;var z=this._clientNodeLoader.indexSR;const I=this._clientNodeLoader.renderSR,M=this._getNodeInternal(C);if(null==M)break;for(let S=0;S<M.childCount;S++){var J=this.getChildIndex(C,S);J=this._getNodeInternal(J);J=null!=J?J.ref||J.node:null;if(null!=J&&0<J.serviceMbsInIndexSR[3])if(null==K)K=m.copy(J.serviceMbsInIndexSR,B);else{const N=F,V=G,Q=H;k.projectBoundingSphere(J.serviceMbsInIndexSR,
z,N,I);k.projectBoundingSphere(K,z,V,I);m.union(N,V,Q);k.projectBoundingSphere(Q,I,K,z)}}z=M.ref||M.node;if(null!=z){if(null!=K){let S;(S=z).serviceMbsInIndexSR??(S.serviceMbsInIndexSR=m.create());m.copy(K,z.serviceMbsInIndexSR)}else g.invalidateMbs(z.serviceMbsInIndexSR);z.invalidateServiceBVsInRenderSR();z.geometryObbInRenderSR=null}this.invalidateNodeVisibilityCacheInternal(M);C=this.getParentIndex(C)}while(null!=C)}populateChildren(C,z){var J=this._getNodeInternal(C);const K=this._getPage(C);
J.childOffset=K.children.length;J.childCount=z.length;for(J=0;J<z.length;J++){const I=this._makeRefNode(z[J],C);K.children.push(I)}}getNode(C){C=this._getNodeInternal(C);return null!=C?C.node:null}getIndexById(C){let z;this._forAllNodes((J,K)=>{null!=J.node&&J.node.id===C?z=K:null!=J.ref&&J.ref.id===C&&(z=K)});return z}getNodeById(C){C=this.getIndexById(C);return null!=C&&0<=C?this.getNode(C):null}getChildIndex(C,z){const J=this._getPage(C);if(null==J)return-1;C=J.nodes[x(C,this._pageSize)];return J.children[C.childOffset+
z]}getParentIndex(C){const z=this._getPage(C);return null!=z&&C!==this._rootIndex?z.nodes[x(C,this._pageSize)].parent:null}getParent(C){C=this.getParentIndex(C);return null!=C?this.getNode(C):null}isLeaf(C){C=this._getNodeInternal(C);return null!=C&&0===C.childCount}get rootNode(){return this.getNode(this._rootIndex)}get isEditable(){return this._isEditable}removeAllGeometryObbs(){this._forAllNodes(C=>{null!=C.node&&(C.node.geometryObbInRenderSR=null)})}invalidateVisibilityCache(){this._visibilityCacheVersion=
g.addWraparound(this._visibilityCacheVersion,2)}invalidateNodeVisibilityCache(C){C=this._getNodeInternal(C);null!=C&&this.invalidateNodeVisibilityCacheInternal(C)}invalidateNodeVisibilityCacheInternal(C){C.visibilityCache=g.addWraparound(this._visibilityCacheVersion,-2)}invalidateBoundingVolumeCache(C){C=this._getNodeInternal(C);null!=C&&(C.node?.invalidateServiceBVsInRenderSR(),C.ref?.invalidateServiceBVsInRenderSR(),this.invalidateNodeVisibilityCacheInternal(C))}updateElevationChanged(C){const z=
this._getNodeInternal(C);null!=z&&(this.needNodeElevationRange?(C=null!=z.node?z.node:z.ref,null!=C&&C.invalidateElevationRange()):this.invalidateBoundingVolumeCache(C))}invalidateGeometryVisibility(C){if(C=this._getNodeInternal(C)?.node)C.geometryObbInRenderSR=null,C.invalidateServiceBVsInRenderSR()}invalidateVisibilityObbs(){null!=this.rootNode&&this.traverse(this.rootNode,C=>{C.visibilityObbInRenderSR=this._computeVisibilityObb(C);C.geometryObbInRenderSR=null;return!0})}_updateElevationRange(C){this._updateElevationRangeInternal(C,
null)}_updateElevationRangeInternal(C,z){const J=this._getNodeInternal(C);if(!J)return!1;const K=J?.node??J?.ref;if(!K)return!1;if(K.elevationRangeValid)return z?.expandElevationRange(K),!0;const I=new n.ElevationRange;var M=!1;for(let S=0;S<J.childCount;S++){const N=this.getChildIndex(C,S);this._updateElevationRangeInternal(N,I)||(M=!0)}(0===J.childCount||M)&&this._viewportQueries.expandElevationRange(K,!J.node?.resources.isEmpty,I);M=K.elevationRangeMax;if(K.elevationRangeMin===I.elevationRangeMin&&
M===I.elevationRangeMax)return z?.expandElevationRange(K),!0;J.node?.setElevationRange(I);J.ref?.setElevationRange(I);this.invalidateBoundingVolumeCache(C);z?.expandElevationRange(K);return!0}isNodeVisible(C){const z=this._getNodeInternal(C);if(null==z)return!0;var J=z.ref;if(null!=J&&!J.serviceMbsInIndexSR)return!0;if(!this.needNodeElevationRange&&(z.visibilityCache&-2)===this._visibilityCacheVersion)return 1===(z.visibilityCache&1);var K=z.node;const I=this._viewportQueries;if(K&&0<K.level&&(I.ensureElevationAgnosticBoundingVolume(K,
this.viewingMode),!I.isElevationAgnosticBoundingVolumeVisible(this.viewingMode,K.elevationAgnosticBoundingVolume)))return z.visibilityCache=this._visibilityCacheVersion+0,!1;this.needNodeElevationRange&&this._updateElevationRange(C);return(z.visibilityCache&-2)!==this._visibilityCacheVersion?(this._layerHasFilter&&this._computeNodeFiltering&&(null!=K||null!=J)&&z.filterImpact===f.NodeFilterImpact.NotChecked&&(C=null!=K?K.serviceMbsInIndexSR:null!=J?J.serviceMbsInIndexSR:null,z.filterImpact=null!=
C?this._computeNodeFiltering(C):f.NodeFilterImpact.Unmodified),C=null!=K&&z.filterImpact===f.NodeFilterImpact.Culled,J=!K||J&&!K.visibilityObbInRenderSR?J??null:K,K=!(null!=K&&K.imModificationImpact===f.NodeIMModificationImpact.Culled)&&(!J||I.isNodeVisible(J))&&!C,z.visibilityCache=this._visibilityCacheVersion+(K?1:0),K):1===(z.visibilityCache&1)}isGeometryVisible(C){if(!this.isNodeVisible(C))return!1;C=this._getNodeInternal(C);return null==C?.node?.geometryObbInRenderSR||this.layerHasModifications&&
C.node.imModificationImpact===f.NodeIMModificationImpact.NotChecked?!0:this._viewportQueries.isGeometryVisible(C.node)}_traverseCoverage(C,z,J,K,I){C=this._getPage(C);if(null!=C&&0!==z.childCount){var M=z.childOffset+z.childCount,S=[];for(z=z.childOffset;z<M;++z){const N=C.children[z],V=this._getNodeInternal(N);null!=V?.node&&this.isGeometryVisible(N)&&S.push(V)}K/=S.length;for(const N of S)C=N.node.index,this._isLoaded(C)||this._isReloading(C)?(I.delta=Math.max(I.delta,J),I.coverage+=K):this._traverseCoverage(C,
N,J+1,K,I)}}useNodeAsHole(C){if("off"===this.holeFilling)return!1;const z=this._getNodeInternal(C);if(null==z)return!1;if("always"===this.holeFilling)return!0;if((z.useAsHole&-2)===this._version)return 1===(z.useAsHole&1);const J={delta:0,coverage:0};this._traverseCoverage(C,z,0,1,J);C=.5>=J.delta*J.coverage;z.useAsHole=this._version+(C?1:0);return C}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune();this._updates.update.prune()}requestUpdate(){this._dirty=
!0;this._indexMissing=1;this._version=g.addWraparound(this._version,2)}imModificationsChanged(C){this.layerHasModifications=C;this._forAllNodes(({node:z})=>{null!=z&&(z.imModificationImpact=f.NodeIMModificationImpact.NotChecked,z.visibilityObbInRenderSR=this._computeVisibilityObb(z),z.hasModifications&&this.invalidateGeometryVisibility(z.index))});this.invalidateVisibilityCache()}layerFilterChanged(C){this._layerHasFilter=C;this._forAllNodes(z=>{null!=z&&(z.filterImpact=f.NodeFilterImpact.NotChecked,
z=z.node,null!=z&&this.invalidateNodeVisibilityCache(z.index))});this.invalidateVisibilityCache()}update(C,z,J){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(z);this._invalidateElevationRangeForNewPages(z);this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missingPagesAndNodes.clear();this._prefetchNodes.clear();this._updates.reset(C);y.clear();var K=!0,I=new A,M=new A,S=this._imModificationUncategorized;S.clear();var N=new Set,V=0;this.traverseVisible((Q,
T,ia)=>{var O=u(Q,this._pageSize);if(null==T)Q=this._entryPriority(Q),Infinity===Q&&(Q=this._entryPriority(ia)),y.set(O,Math.max(Q,y.get(O)||0)),this._loadingPages.has(O)||this._failedPages.has(O)||(this._missingPagesAndNodes.push(O),++V),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,Q);else{var U=T.node;this._updateNodeFeatureEstimate(U,M);if(null==U)T=this._entryPriority(Q),this._loadingNodes.has(Q)||this._failedNodes.has(Q)||(this._missingPagesAndNodes.push(Q),y.set(Q,T)),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,T);else{ia=this._getPage(Q);if(0===this._missingPagesAndNodes.length&&!this._useNodePages)for(O=0;O<T.childCount;O++){const P=ia.children[T.childOffset+O],R=this._getNodeInternal(P);null==R||R.node||this._loadingNodes.has(P)||this._failedNodes.has(P)||(y.set(P,this._entryPriority(P)),this._prefetchNodes.push(P))}U.failed||U.resources.isEmpty?K&&0<T.childCount&&this._isSelected(U)&&(K=!1):this._isLoaded(Q)?(I.known+=U.memory,++I.knownNodes,this._isSelected(U)?0<T.childCount&&
(K=!1):(I.unremoved+=U.memory,K=!1),this._needsUpdate(U)&&(T=this._entryPriority(Q),y.set(Q,T),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,T),this._updates.update.push(Q))):(U.memory&&(I.known+=U.memory,++I.knownNodes),this._isSelected(U)?(0<T.childCount&&(K=!1),U.memory?(I.missing+=U.memory,I.known+=U.memory,++I.knownNodes):++I.missingNodes,C.includes(U.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(Q)),this._updates.cancel=this._updates.cancel.filter(P=>
P!==U.index)):!z.done&&this._enable(U)?z.madeProgress():(T=this._entryPriority(Q),y.set(Q,T),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,T),this._updates.add.push(Q),this.layerHasModifications&&J&&null!=U&&U.imModificationImpact===f.NodeIMModificationImpact.NotChecked&&S.push(Q))):this._isReloading(Q)&&this._updates.remove.push(Q))}}},N);this._frameNumber++;this._missingPagesAndNodes.sort((Q,T)=>Q-T);this._missingPagesAndNodes.filterInPlace((Q,T)=>1>T||this._missingPagesAndNodes.data[T-
1]!==Q);this._missingPagesAndNodes.sort((Q,T)=>y.get(Q)-y.get(T));0<this._missingPagesAndNodes.length&&(this._maxUnloadedPrio=y.get(this._missingPagesAndNodes.back()),this._prefetchNodes.clear());this._removeUnusedNodePages(N,V);N=this._updates.add;0<N.length&&this.layerHasModifications&&(0<S.length&&J?.(S),N.filterInPlace(Q=>{var T=this._getNodeInternal(Q);(T=null==T?.node||T.node.imModificationImpact!==f.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(Q);return T}));this._unloadedMemoryEstimate=
I.missing-I.unremoved;3<I.knownNodes&&0<I.missingNodes&&(this._unloadedMemoryEstimate+=I.known/I.knownNodes*I.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(M);this._featureEstimate.leavesReached=K;this._updates.add.filterInPlace(Q=>y.get(Q)>=this._maxUnloadedPrio).sort((Q,T)=>y.get(Q)-y.get(T));this._updates.update.sort((Q,T)=>y.get(Q)-y.get(T));this._indexMissing=this._loadingPages.size+this._loadingNodes.size+
this._missingPagesAndNodes.length;this._dirty=0<this._indexMissing;y.clear()}}checkFeatureTarget(C,z){const J=this._viewportQueries.updateScreenSpaceErrorBias(z);let K=z,I=z,M=J,S=10;for(;S--;){const N=new A;this._updateFeatureEstimate(K,N);if(this._computeFeatureEstimate(N)<=C){if(K>=z||0<N.missingNodes||0===S)break;M=K;K=.5*(K+I)}else I=K,K=.5*(K+M)}this._version=g.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(J);return Math.min(z,K)}_removeUnusedNodePages(C,z){if(this._useNodePages){var J=
C.size,K=this._nodePages;z=K.size+this._loadingPages.size+z;if(z>L&&z>J){J=[];for(const [I,M]of K)0!==M.numNodesWithLoadedChildren||C.has(I)||J.push([M.lastTraversed,I]);J.sort((I,M)=>I[0]-M[0]).some(I=>{this._deleteNodePage(I[1]);return K.size<=L})}}}_updateFeatureEstimate(C,z){this._version=g.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(C);this.traverseVisible((J,K)=>this._updateNodeFeatureEstimate(null!=K?K.node:void 0,z))}_updateNodeFeatureEstimate(C,z){null!=
C&&!C.failed&&null!=C.numFeatures&&this._isSelected(C)&&(null!=C.numFeatures?(z.missing+=C.numFeatures,z.known+=C.numFeatures,++z.knownNodes):++z.missingNodes)}_computeFeatureEstimate(C){let z=C.known-C.unremoved;3<C.knownNodes&&0<C.missingNodes&&(z+=C.known/C.knownNodes*C.missingNodes);return Math.max(0,z)}load(){return this._load(this._missingPagesAndNodes)}prefetch(){this._prefetchNodes.sort((C,z)=>y.get(C)-y.get(z));return this._load(this._prefetchNodes)}_load(C){if(0===C.length||!this._canRequest())return!1;
for(;0<C.length&&this._canRequest();){const z=C.pop();this._useNodePages?0<=z?this._loadPage(z):this._loadNode(z):this._loadNode(z)}return!0}get isLoading(){return 0<this._indexMissing}get isPrefetching(){return 0<this._prefetchNodes.length}get indexLoading(){return this._loadingPages.size+this._loadingNodes.size}get indexMissing(){return this._indexMissing}get unloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}get maxPriority(){return Math.max(this._maxProcessingPrio,
this._maxUnloadedPrio)}nodeTraversalState(C){if(null==C)return null;const z=C.index,J=this._getNodeInternal(z);if(!J)return null;let K=J?.traversalState;if(K&&(K.version&-2)===this._version)return K;const I=this._viewportQueries.getLodLevel(C),M=this._viewportQueries.hasLOD(C);let S=!0;M?(C=this.getParentIndex(z),null!=C?(C=this._getNodeInternal(C)?.traversalState,S=!!C&&I>C.lodLevel):S=0<I):S=0===C.childCount;if(K)return K.lodLevel=I,K.isChosen=S,K.version=this._version+1,K;K=new f.NodeTraversalState(M,
S,I,this._version+1);return J.traversalState=K}async _loadNode(C){this._loadingNodes.add(C);var z=this._getNodeInternal(C).ref;if(null==z)this._failedNodes.add(C);else{z=z.id;var J=this._urlPrefix+z,K=()=>{this._loadingNodes.delete(C);0===this._missingPagesAndNodes.length&&0===this._loadingNodes.size&&this.requestUpdate()},I=null;try{I=0<=C?await this._streamDataController.request(J,"json"):await this._clientNodeLoader.loadNodeJSON(z)}catch(M){K();c.isAbortError(M)||(this._logger.error("#loadNode()",
this._layer,"Error loading node: "+J),this._failedNodes.add(C));return}K();z=this._validateNode(z,I);null!=z&&(z.obb&&this.invalidateNodeVisibilityCache(C),z=this._addNode(z,C),this.nodeTraversalState(z))}}_validateNode(C,z){if(null==z||"object"!==typeof z||z.id!==C)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${C}"`),null;if(!Array.isArray(z.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${C}.`),null;
z.sharedResource&&"./shared"!==z.sharedResource.href&&"./shared/"!==z.sharedResource.href&&this._logger.warn("#validateNode()",this._layer,`Invalid shared resource href on node "${C}"`);var J=z.geometryData;null==J||Array.isArray(J)&&0===J.length||Array.isArray(J)&&1===J.length&&"./geometries/0"===J[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${C}"`);J=z.attributeData;const K=this._layer.attributeStorageInfo;null==J||Array.isArray(J)&&!J.some((N,V)=>N.href!==
`./attributes/${K?.[V]?.key??`f_${V}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${C}"`);z.featureData&&1<z.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${C} has ${z.featureData.length} bundles. Only the first bundle will be loaded.`);J=z.hasOwnProperty("obb")&&!this.ignoreServiceObb?z.obb:void 0;const I=z.featureData&&1===z.featureData.length&&z.featureData[0].featureRange?z.featureData[0].featureRange[1]-z.featureData[0].featureRange[0]+
1:void 0;var M=N=>{if(null==N)return null;var V=Q=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${C}: ${Q}`);if("number"===typeof N.id)V(`id ${N.id} is a number instead of a string.`);else if("string"!==typeof N.id||!Array.isArray(N.mbs))return V("Missing or invalid id."),null;if(!Array.isArray(N.mbs))return V(`Invalid bounding volume on reference ${N.id}.`),null;N.href&&N.href!=="../"+N.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${C}"`);
V=new f.NodeBase(`${N.id}`,N.mbs);V.serviceObbInIndexSR=!this.ignoreServiceObb&&N.hasOwnProperty("obb")&&N.obb?l.Obb.fromJSON(N.obb):null;V.visibilityObbInRenderSR=this._computeVisibilityObb(V);return V};M=Array.isArray(z.children)?z.children.map(M).filter(N=>null!=N):null;const S=!0===z.isEmpty;return new e.ValidatedNode(C,z.mbs,J,"string"===typeof z.version?z.version:null,{isEmpty:!(z.featureData?.length??!1)&&S,hasSharedResource:null!=z.sharedResource,attributes:z.attributeData?C:void 0,texture:z.textureData&&
0<z.textureData.length?C:void 0,geometry:null!=z.geometryData?C:void 0},M,Array.isArray(z.lodSelection)?z.lodSelection:null,I)}resetFailedNodes(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(C=>{null!=C.node&&(C.node.failed=!1)})}_entryPriority(C){var z=this._getNodeInternal(C),J=this.getParentIndex(C);if(null==z||null==J&&null==z.node)return null==J?Infinity:this._entryPriority(J);let K=0;z.node&&null!=J&&(J=this._getNodeInternal(J).traversalState,null!=J&&(K=J.lodLevel));
for(J=this.progressiveLoadPenalty;null!=C;C=this.getParentIndex(C))if(this._isLoaded(C)){J=0;break}z=null!=z.ref?this._viewportQueries.distToPOI(z.ref):null!=z.node?this._viewportQueries.distToPOI(z.node):0;return-z-K*(z+this.progressiveLoadPenalty)+J}traverseVisible(C,z){const J=this._getNodeInternal(this._rootIndex);null==J?C(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,J,C,z)}_traverseVisible(C,z,J,K,I){var M=u(C,this._pageSize);I&&I.add(M);if(J.node&&0===J.childCount)this.isGeometryVisible(C)&&
K(C,J,z);else if(this.isNodeVisible(C)&&(K(C,J,z),null!=J.node&&(z=this.nodeTraversalState(J.node),!z?.nodeHasLOD||z.lodLevel!==this._maxLodLevel)))for(M=this._getPageFromPageIndex(M),z=0;z<J.childCount;z++){const N=M.children[J.childOffset+z];var S=this._getNodeInternal(N);S?this._traverseVisible(N,C,S,K,I):(I&&(S=u(N,this._pageSize),I.add(S)),K(N,null,C))}}traverse(C,z){z(C)&&this.traverseDescendants(C,z)}traverseDescendants(C,z){++this._traverseDescendantsNestingLevel;var J=C.index;C=this._pageSize;
var K=u(J,C),I=this._getPageFromPageIndex(K);if(null!=I){var M=this._frameNumber,S=this._clientNodePage,N=this._nodePages;I.lastTraversed=M;var V=x(J,C),Q=I.nodes[V];({childCount:V}=Q);if(0!==V){V=1===this._traverseDescendantsNestingLevel?this._traverseDescendantsQueue:[0];var T=0,ia=0,{childOffset:O,childCount:U}=Q;for({children:Q}=I;V.length<ia+U;)V.length+=V.length;for(var P=O;P<O+U;++P)V[ia]=Q[P],++ia;if(0<=J&&0<C)for(S=K*C,J=I.nodes;T<ia;){Q=V[T];++T;if(S<=Q&&Q<S+C)K=I;else{P=Q/C|0;K=N.get(P);
if(void 0===K)continue;K.lastTraversed=M;I=K;J=I.nodes;S=C*P}Q=J[Q-S];P=Q.node;if(null!=P&&!1!==z(P)&&({childCount:P}=Q,0!==P)){for(;V.length<ia+P;)V.length+=V.length;K=K.children;({childOffset:Q}=Q);for(P=Q+P;Q<P;++Q)V[ia]=K[Q],++ia}}else for(;T<ia;)if(J=V[T],++T,K=0>J?-1:0<C?J/C|0:0,I=0>K?S:N.get(K))if(I.lastTraversed=M,J=I.nodes[0>J?-J-1:0===C?J:J-K*C],(K=J.node)&&z(K)&&({childCount:K}=J,0!==K)){for(;V.length<ia+K;)V.length+=V.length;I=I.children;({childOffset:J}=J);for(K=J+K;J<K;++J)V[ia]=I[J],
++ia}--this._traverseDescendantsNestingLevel}}}updateChildrenLoaded(C,z){for(C=this.getNode(C);null!=C;){var J=C.childrenLoaded;const K=J+z;C.childrenLoaded=K;J=0===J?1:0===K?-1:0;C=C.index;0!==J&&(this._getPage(C).numNodesWithLoadedChildren+=J);C=this.getParent(C)}}checkChildrenLoadedInvariant(){if(null==this.rootNode)return!0;const C=[],z=J=>{let K=this._isLoaded(J.index)||this._isReloading(J.index)?1:0;this.traverseDescendants(J,I=>{K+=z(I);return!1});J.childrenLoaded!==K&&C.push(J.index);return K};
z(this.rootNode);C.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+C.join(","));return 0<C.length}updateElevationInfo(C,z){this.needNodeElevationRange=z&&!!C&&("relative-to-ground"===C.mode||"on-the-ground"===C.mode);this._viewportQueries.updateElevationInfo(C);this.invalidateAllElevationRanges()}invalidateAllElevationRanges(){this._forAllNodes(C=>{C.node?.invalidateServiceBVsInRenderSR();C.ref?.invalidateServiceBVsInRenderSR();null!=C.node&&C.node.invalidateElevationRange();
null!=C.ref&&C.ref.invalidateElevationRange()})}_forAllNodes(C){if(null!=this._clientNodePage){var z=this._clientNodePage;for(var J=0;J<z.nodes.length;J++)C(z.nodes[J],-(J+1))}for(const [K,I]of this._nodePages)for(z=K*this._pageSize,J=0;J<I.nodes.length;J++)C(I.nodes[J],z+J)}clearCaches(){if(this._useNodePages){const C=this._nodePages,z=new Set;this.traverseVisible(J=>z.add(u(J,this._pageSize)));for(const [J,K]of C)if(0!==K.numNodesWithLoadedChildren||z.has(J))for(const I of K.nodes)I.traversalState=
null;else this._deleteNodePage(J)}}_deleteNodePage(C){this._nodePages.delete(C)}get test(){return{addNode:(C,z)=>this._addNode(C,z),getNodeInternal:C=>this._getNodeInternal(C),getPageIndex:C=>u(C,this._pageSize),getIndexWithinPage:C=>x(C,this._pageSize),getNodePage:C=>0>C?this._clientNodePage:this._nodePages.get(C),getChildIndices:C=>{const z=this._getNodeInternal(C);C=this._getPage(C);if(null==z||null==C)return[];const J=[];for(let K=z.childOffset;K<z.childOffset+z.childCount;++K)J.push(C.children[K]);
return J},rootIndex:this._rootIndex,clientNodePage:this._clientNodePage,nodePages:this._nodePages}}}const y=new Map;class D{constructor(C){this.missing=C;this.update=new h({deallocator:null});this.add=new h({deallocator:null});this.remove=new h({deallocator:null});this.cancel=[]}reset(C){this.add.clear();this.update.clear();this.cancel=C}}const E=[["maxScreenThreshold",f.LodMetric.MaxScreenThreshold],["screenSpaceRelative",f.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",f.LodMetric.RemovedFeatureDiameter],
["distanceRangeFromDefaultCamera",f.LodMetric.DistanceRangeFromDefaultCamera]];class A{constructor(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}const B=m.create(),F=m.create(),G=m.create(),H=m.create(),L=b("esri-mobile")?100:300;a.I3SIndex=r;a.selectErrorMetric=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../chunks/sphere",
"./I3SUtil","../../support/ElevationRange"],function(a,b,h,c,k){class m extends k.ElevationRange{constructor(g,e){super(NaN,NaN);this.id=g;this.serviceMbsInIndexSR=e;this.serviceMbsInRenderSR=h.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){c.invalidateMbs(this.serviceMbsInRenderSR);c.invalidateObb(this.serviceObbInRenderSR)}}a.NodeFilterImpact=void 0;(function(g){g[g.Unmodified=0]="Unmodified";g[g.Culled=1]="Culled";g[g.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact=
{}));a.NodeIMModificationImpact=void 0;(function(g){g[g.Unmodified=0]="Unmodified";g[g.PotentiallyModified=1]="PotentiallyModified";g[g.Culled=2]="Culled";g[g.Unknown=3]="Unknown";g[g.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));class d extends m{constructor(g,e,n,l,u,x,w,q,v,p){super(g,n);this.index=e;this.childCount=l;this.level=u;this.resources=x;this.version=w;this.lodMetric=q;this.maxError=v;this.numFeatures=p;this.failed=!1;this.cacheState=a.CacheState.Unknown;
this.childrenLoaded=this.memory=this.vertexCount=0;this.hasModifications=!1;this.imModificationImpact=a.NodeIMModificationImpact.NotChecked;this.elevationAgnosticBoundingVolume=b.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR();this.elevationAgnosticBoundingVolume[3]=-1}}a.CacheState=void 0;(function(g){g[g.Unknown=0]="Unknown";g[g.Uncached=1]="Uncached";g[g.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(g){g[g.None=0]=
"None";g[g.MaxScreenThreshold=1]="MaxScreenThreshold";g[g.ScreenSpaceRelative=2]="ScreenSpaceRelative";g[g.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";g[g.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(g){g[g.Hole=0]="Hole";g[g.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));class f{constructor(g,e,n,l){this.nodeHasLOD=g;this.isChosen=e;this.lodLevel=n;this.version=l}}a.Node=d;a.NodeBase=m;a.NodeTraversalState=
f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/ValidatedNode":function(){define(["exports"],function(a){class b{constructor(h,c,k,m,d,f,g,e){this.id=h;this.mbs=c;this.obb=k;this.version=m;this.resources=d;this.children=f;this.lodSelection=g;this.numFeatures=e}}a.ValidatedNode=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],
function(a,b,h){class c{constructor(m){this._layerView=m;this._lodGlobalDirty=!1}startNodeLoading(m,d,f,g){this._maxLodLevel=g.maxLodLevel;this._index=f;this._isNodeInScaleBounds=m;this._removeNodes=d}shouldLoadNode(m){if(null==m)return!1;const d=this._index.nodeTraversalState(m);return this._isChosenMaxLOD(d)?!0:d.isChosen?this._childrenRequireLoading(m):!1}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(m){if(!this.requiresLODGlobalHandling)return!1;
this._lodGlobalDirty=!1;var d=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));k.clear();this._lodGlobalHandling(this._index.rootNode,d,!1,!!this._layerView.nodeCrossfadingEnabled);d=k.length;this._removeNodes(k,m);m=k.length<d;0!==k.length&&(this._lodGlobalDirty=!0);k.clear();return m}_lodGlobalHandling(m,d,f,g){if(null==m)return!1;const e=m.index,n=this._index,l=this._layerView;var u=n.nodeTraversalState(m);u=this._isChosenMaxLOD(u);var x=m.resources.isEmpty;
if(u&&x)return 0<m.childrenLoaded&&this._removeChildrenRecursive(m),!0;x=l.isNodeLoaded(e);if(g&&x&&u){var w=!f&&this.hasNoVisibleChildren(m);l.fadeNode(e,h.FadeDirection.FadeIn,!w)}w=x&&(!l.isNodeFullyFadedIn||l.isNodeFullyFadedIn(e));if(x&&(l.updateNodeState(e,u?b.NodeState.Leaf:b.NodeState.Hole),u))return w&&this._removeChildrenRecursive(m),w;var q=0<m.childCount;let v=q;if(q)for(q=0;q<m.childCount;q++){const p=n.getChildIndex(e,q),t=n.getNode(p);null!=t?n.isGeometryVisible(p)&&!this._lodGlobalHandling(t,
d,f||w,g)&&this._isNodeInScaleBounds(t)&&(v=!1):n.isNodeVisible(p)&&(v=!1)}(d=x&&!u&&(v||k.length<d))&&k.push(e);!g||d||!x||f||v||l.fadeNode(e,h.FadeDirection.FadeIn,!1);m=m.resources.isEmpty;return v||w&&!d||m}_removeChildrenRecursive(m){this._index.traverseDescendants(m,d=>{(this._layerView.isNodeLoaded(d.index)||this._layerView.isNodeReloading(d.index))&&k.push(d.index);return 0<d.childrenLoaded})}hasNoVisibleChildren(m){let d=!0;this._index.traverseDescendants(m,f=>d&&this._index.isNodeVisible(f.index)?
this._layerView.isNodeLoaded(f.index)?d=!1:0<f.childrenLoaded:!1);return d}_childrenRequireLoading(m){let d=!1,f=!0;this._index.traverseDescendants(m,g=>{if(!f||!this._index.isNodeVisible(g.index))return!1;const e=this._index.nodeTraversalState(g);this._isChosenMaxLOD(e)&&this._index.isGeometryVisible(g.index)&&(d=!0);return this._layerView.isNodeLoaded(g.index)?f=!1:0<g.childrenLoaded});return f&&d}_isChosenMaxLOD(m){return m.isChosen&&(!m.nodeHasLOD||m.lodLevel===this._maxLodLevel)}}const k=new a({deallocator:null});
return c})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,b,h,c,k,m,d,f){class g{constructor(e,n,l,u,x,w){this._streamDataController=n;this._logger=l;this._defaultGeometrySchema=u;this._requiredAttributes=x;this._options=w;this._logLayer=e;this._layerUrl=e.parsedUrl.path;this._geometryDefinitions=e.geometryDefinitions;if(e.materialDefinitions){const q=e.textureSetDefinitions;this._materialAndTextures=e.materialDefinitions.map(v=>f.getMaterialAndTextures(q,v,"integrated-mesh"===e.type))}}_load(e,n,l){return this._streamDataController.request(e,
n,l)}_loadAttribute(e,n,l){return this._load(`${this._layerUrl}/nodes/${e.resources.attributes}/attributes/${n.key}/0`,"binary",l).then(u=>d.readBinaryAttribute(n,u))}async loadAttributes(e,n,l){const u=await Promise.allSettled(n.map(q=>this._loadAttribute(e,q.attributeStorageInfo,l))),x={};for(let q=0;q<n.length;++q){var w=u[q];const v=n[q];"fulfilled"===w.status?x[v.name]=w.value:(w=w.reason,c.throwIfAbortError(w),this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${v.name}' on node '${e.id}'`,
w))}return x}async loadNodeData(e,n){var l=null!=this._requiredAttributes&&e.resources.attributes?a.result(this.loadAttributes(e,this._requiredAttributes,n)):null;var u=this._geometryDefinitions;var x={bufferDefinition:null,bufferIndex:0};var w=e.resources.geometryDefinition;if(!(null==u||null==w||0>w)&&(u=0<=w?u[w].geometryBuffers:null,null!=u))for(w=0;w<u.length;w++){var q=u[w];if(null!=q.compressedAttributes){if("draco"===q.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){x.bufferIndex=
w;x.bufferDefinition=q;break}}else x.bufferIndex=w,x.bufferDefinition=u[w]}const {bufferDefinition:v,bufferIndex:p}=x;w=(q=!!e.resources.geometry)?a.result(this._loadGeometry(e.resources.geometry,p,n)):null;u=e.resources.hasSharedResource?await this._loadShared(e,n):null;x=e.resources.materialDefinition;x=this._materialAndTextures&&null!=x&&0<=x?this._materialAndTextures[x]:null!=u?f.getMaterialAndTexturesFromShared(u):null;var t=x?.material;x=x?.textures??[];const r=`${e.id}`,y=!q&&this._options.loadFeatureData;
q=y?await this._loadFeatureData(r,n):null;if(y)a:{if(q)for(E of q.featureData)if(t=E.geometries,null!=t)for(var D of t){var E={featureIds:[E.id],featureDataPosition:E.position,geometries:[D]};break a}E=null}else E={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:t}}],featureDataPosition:[0,0,0]};if(null==E)if(q){D=[];for(A of q.featureData)null!=A.position&&D.push({featureIds:[A.id],featureDataPosition:A.position,geometries:[]});var A=D}else A=null;else A=null;D=0<x.length?a.result(this.loadTextures(e,
x,n)):null;n=e=null;w&&(e=a.assertResult(await w),(n=this._defaultGeometrySchema)&&u?.materialDefinitions&&(w=Object.keys(u.materialDefinitions)[0],!u.materialDefinitions[w].params.vertexRegions&&n.vertexAttributes.region&&(n=h.clone(n),delete n.vertexAttributes.region)),n=d.createGeometryDescriptor(v,n));u=D?a.assertResult(await D):null;l=(l=l?a.assertResult(await l):{})?{attributeData:l,loadedAttributes:this._requiredAttributes}:null;if(null!=E)return{geometryData:E,attributeDataInfo:l,geometryBuffer:e,
geometryDescriptor:n,requiredTextures:x,textureData:u};if(null!=A)return{pointData:A,attributeDataInfo:l,geometryBuffer:e,geometryDescriptor:n,requiredTextures:x,textureData:u};throw Error();}static _addAbsoluteHrefTexture(e,n){e=e.textureDefinitions;if(null!=e)for(const l of Object.keys(e))for(const u of e[l].images)Array.isArray(u.href)?u.hrefConcat=u.href.map(x=>k.makeAbsolute(x,n)):u.hrefConcat=k.makeAbsolute(u.href,n)}static _fixTextureEncodings(e){e=e.textureDefinitions;if(null!=e)for(const l in e){const u=
e[l];if(Array.isArray(u.encoding))for(var n=0;n<u.encoding.length;n++){const x=u.encoding[n];"data:"===x.substring(0,5)&&(u.encoding[n]=x.substring(5))}else n=u.encoding,"data:"===n.substring(0,5)&&(u.encoding=n.substring(5))}}async _loadShared(e,n){if(null==e.resources.geometry)return{};e=`${this._layerUrl}/nodes/${e.resources.geometry}/shared`;n=await this._load(e,"json",n);g._fixTextureEncodings(n);g._addAbsoluteHrefTexture(n,e);return n}_loadTexture(e,n,l,u,x,w){let q=!1;return x===m.TextureEncoding.DDS_S3TC||
x===m.TextureEncoding.KTX2||x===m.TextureEncoding.Basis?this._load(e,"binary",w).then(v=>({id:n,usage:l,data:v,encoding:x,downsampled:q})):this._load(e,"image",w).then(v=>{var p=v;if(u&&4096<=v.width*v.height){p=Math.ceil(v.width/2);const t=Math.ceil(v.height/2),r=document.createElement("canvas");r.width=p;r.height=t;r.getContext("2d").drawImage(v,0,0,p,t);p=r;q=!0}return{id:n,usage:l,data:p,encoding:x,downsampled:q}})}loadTextures(e,n,l){const u=!!this._options.uncompressedTextureDownsamplingEnabled,
x=this._options.textureUsageMask;return Promise.all(n.map(w=>{if(0===(w.usage&x))return null;const q=f.selectEncoding(w.encodings,this._options.textureEncodings);return null==q?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${e.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${e.resources.texture||e.id}/textures/${q.name}`,w.id,w.usage,u,q.encoding,l)}))}_loadFeatureData(e,n){return this._load(`${this._layerUrl}/nodes/${e}/features/0`,
"json",n)}_loadGeometry(e,n,l){return this._load(`${this._layerUrl}/nodes/${e}/geometries/${n}`,"binary",l)}}return g})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){function l(r){return r.sort((y,D)=>y.encoding-D.encoding)}function u(r,y,D){if(null==r||D===c.TextureUsage.None)return null;for(let E=0;E<r.length;E++){const A=r[E];if(null!=A&&0!==(A.usage&D))return r=y[E],null!=r?r.id:null}return null}function x(r){switch(r){case c.TextureEncoding.KTX2:return f.TextureEncodingMimeType.KTX2_ENCODING;case c.TextureEncoding.Basis:return f.TextureEncodingMimeType.BASIS_ENCODING;case c.TextureEncoding.DDS_S3TC:return f.TextureEncodingMimeType.DDS_ENCODING;
case c.TextureEncoding.PNG:return"image/png";case c.TextureEncoding.JPG:return"image/jpeg";case c.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const w={ktx2:c.TextureEncoding.KTX2,basis:c.TextureEncoding.Basis,dds:c.TextureEncoding.DDS_S3TC,png:c.TextureEncoding.PNG,jpg:c.TextureEncoding.JPG,"ktx-etc2":c.TextureEncoding.KTX_ETC2},q={[f.TextureEncodingMimeType.KTX2_ENCODING]:c.TextureEncoding.Basis,[f.TextureEncodingMimeType.BASIS_ENCODING]:c.TextureEncoding.Basis,[f.TextureEncodingMimeType.DDS_ENCODING]:c.TextureEncoding.DDS_S3TC,
"image/png":c.TextureEncoding.PNG,"image/jpg":c.TextureEncoding.JPG,"image/jpeg":c.TextureEncoding.JPG,"image/ktx":c.TextureEncoding.KTX_ETC2},v=()=>({alphaMode:"opaque",alphaCutoff:m.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:f.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
p={s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},t={s:n.TextureWrapMode.REPEAT,t:n.TextureWrapMode.REPEAT};a.configureMaterial=function(r,y,D,E,A,B){const F=B.rendererTextureUsage;var G=y.metallicRoughness.baseColorFactor,H=h.clamp(y.metallicRoughness.baseColorFactor[3],0,1);r.baseColor=[G[0],G[1],G[2],H];r.hasParametersFromSource=!!y.hasParametersFromSource;r.usePBR=B.usePBR;r.mrrFactors=[y.metallicRoughness.metallicFactor,y.metallicRoughness.roughnessFactor,y.hasParametersFromSource?
e.defaultSchematicMRRFactors[2]:e.defaultAdvancedMRRFactors[2]];r.emissiveFactor=y.emissiveFactor;r.isIntegratedMesh=B.isIntegratedMesh;r.textureAlphaCutoff="mask"===y.alphaMode?y.alphaCutoff:m.defaultMaskAlphaCutoff;r.alphaDiscardMode="opaque"===y.alphaMode?f.AlphaDiscardMode.Opaque:"mask"===y.alphaMode?f.AlphaDiscardMode.Mask:f.AlphaDiscardMode.MaskBlend;G=[];H=u(E,D,(c.TextureUsage.Color|c.TextureUsage.AlphaMask)&F);null!=H&&(r.baseColorTexture=new k.RenderTexture(A,H),G.push(r.baseColorTexture.loadPromise));
H=u(E,D,c.TextureUsage.MetallicRoughness&F);null!=H&&(r.metallicRoughnessTexture=new k.RenderTexture(A,H),G.push(r.metallicRoughnessTexture.loadPromise));H=u(E,D,c.TextureUsage.Emissive&F);null!=H&&(r.emissionTexture=new k.RenderTexture(A,H),G.push(r.emissionTexture.loadPromise));H=u(E,D,c.TextureUsage.Occlusion&F);null!=H&&(r.occlusionTexture=new k.RenderTexture(A,H),G.push(r.occlusionTexture.loadPromise));D=u(E,D,c.TextureUsage.Normal&F);null!=D&&(r.normalTexture=new k.RenderTexture(A,D),G.push(r.normalTexture.loadPromise));
r.commonMaterialParameters.hasSlicePlane=B.slicePlaneEnabled;r.commonMaterialParameters.doubleSided=y.doubleSided;r.commonMaterialParameters.cullFace=y.cullFace;r.ellipsoidMode=d.getEllipsoidMode(B.viewSpatialReference);return Promise.all(G)};a.createTexture=function(r,y,D,E){if(null==r?.data)return null;const A=r.data;E=E.renderingContext.parameters.maxMaxAnisotropy;const B=1<E;D=D||!y.wrapTextures?p:t;const F=x(r.encoding);return new g.Texture(A,{mipmap:B,maxAnisotropy:E,encoding:F,wrap:D,components:r.usage&
c.TextureUsage.Color?"opaque"===y.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=v;a.getMaterialAndTextures=function(r,y,D){const E=new Map,A=(z,J)=>{if(null==z)return-1;var K=E.get(z.id);if(K)return K.usage|=J,K.id;K=E.size;E.set(z.id,{id:K,usage:J});return K};var B=y.pbrMetallicRoughness;const F=B?.baseColorFactor,G=y.emissiveFactor,H=(D=b("disable-feature:diffuse-rendering-i3s")||D?e.useSchematicPBRI3S({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,
occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:B?.metallicRoughnessTexture,metallicFactor:B?.metallicFactor,roughnessFactor:B?.roughnessFactor}):e.useSchematicPBR({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:B?.metallicRoughnessTexture,metallicFactor:B?.metallicFactor,roughnessFactor:B?.roughnessFactor}))?e.defaultSchematicMRRFactors[0]:B?.metallicFactor??e.defaultAdvancedMRRFactors[0],
L=D?e.defaultSchematicMRRFactors[1]:B?.roughnessFactor??e.defaultAdvancedMRRFactors[1];B={baseColorFactor:F?[F[0],F[1],F[2],F[3]]:[1,1,1,1],baseColorTextureId:A(B?.baseColorTexture,"mask"===y.alphaMode?c.TextureUsage.Color|c.TextureUsage.AlphaMask:c.TextureUsage.Color),metallicRoughnessTextureId:A(B?.metallicRoughnessTexture,c.TextureUsage.MetallicRoughness),metallicFactor:H,roughnessFactor:L};y={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,doubleSided:y.doubleSided,cullFace:"none"===y.cullFace?
f.CullFaceOptions.None:"back"===y.cullFace?f.CullFaceOptions.Back:"front"===y.cullFace?f.CullFaceOptions.Front:f.CullFaceOptions.None,normalTextureId:A(y.normalTexture,c.TextureUsage.Normal),emissiveTextureId:A(y.emissiveTexture,c.TextureUsage.Emissive),occlusionTextureId:A(y.occlusionTexture,c.TextureUsage.Occlusion),emissiveFactor:G?[G[0],G[1],G[2]]:[0,0,0],metallicRoughness:B,wrapTextures:!1,hasParametersFromSource:D};const C=[];E.forEach(({usage:z},J)=>{var K=null!=r&&r[J]&&r[J].formats;K=K?l(K.map(({name:I,
format:M})=>({name:I,encoding:w[M]}))):[];C.push({id:J,usage:z,encodings:K})});return{material:y,textures:C}};a.getMaterialAndTexturesFromShared=function(r){var y=r?.materialDefinitions?Object.keys(r.materialDefinitions)[0]:null,D=r?.textureDefinitions?Object.keys(r.textureDefinitions)[0]:null;y=y?r.materialDefinitions?.[y]:null;D=D?r.textureDefinitions?.[D]:null;r=v();if(null!=y){y=y.params;y.diffuse&&(r.metallicRoughness.baseColorFactor=[y.diffuse[0],y.diffuse[1],y.diffuse[2],1]);null!=y.doubleSided&&
(r.doubleSided=y.doubleSided,r.cullFace=y.doubleSided?f.CullFaceOptions.None:f.CullFaceOptions.Back);if("none"===y.cullFace||"front"===y.cullFace||"back"===y.cullFace)r.cullFace="none"===y.cullFace?f.CullFaceOptions.None:"back"===y.cullFace?f.CullFaceOptions.Back:f.CullFaceOptions.Front;y.transparency&&(r.metallicRoughness.baseColorFactor[3]=h.clamp(1-y.transparency,0,1));if(y.useVertexColorAlpha||1>r.metallicRoughness.baseColorFactor[3])r.alphaMode="blend"}y=[];if(null!=D){!D.wrap||"repeat"!==D.wrap[0]&&
"repeat"!==D.wrap[1]||(r.wrapTextures=!0);let E=c.TextureUsage.Color;"rgba"===D.channels&&(r.alphaMode="blend",E|=c.TextureUsage.AlphaMask);const A=D.images[D.images.length-1];D=Array.isArray(D.encoding)?l(D.encoding.map((B,F)=>({name:A.href[F]?.split("/").pop(),encoding:q[B]||0}))):[{name:A.href?.split("/").pop(),encoding:q[D.encoding]||0}];y.push({id:0,usage:E,encodings:D});r.metallicRoughness.baseColorTextureId=0}return{material:r,textures:y}};a.getSupportedEncodings=function(r){const y=!!r.compressedTextureS3TC;
r=!!r.compressedTextureETC;const D=b("disable-feature:i3s-basis")?0:c.TextureEncoding.Basis|c.TextureEncoding.KTX2,E=D|c.TextureEncoding.DDS_S3TC;return c.TextureEncoding.JPG|c.TextureEncoding.PNG|(y?E:0)|(r?D:0)};a.selectEncoding=function(r,y){if(null!=y)return r.find(D=>0!==(D.encoding&y))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe","../../../../../core/promiseUtils"],
function(a,b,h){class c{constructor(k,m){this._textureRep=k;this.loadPromise=null;this._disposed=!1;k=this._textureRep.acquire(m);h.isPromiseLike(k)?(k.then(d=>{this._disposed?b.releaseMaybe(d):this._textureRef=d}),this.loadPromise=k):this._textureRef=k}dispose(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}a.RenderTexture=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports",
"../../../../core/promiseUtils"],function(a,b){class h{constructor(c,k,m){this._requester=c;this._customParameters=k;this._apiKey=m;this._activeRequests=new Set}get busy(){return this._requester.busy}request(c,k,m){const d=new AbortController;m=b.onAbortOrThrow(m,()=>d.abort());c=this._requester.request(c,k,{signal:d.signal,query:{...this._customParameters,token:this._apiKey}});const f={response:c,abortController:d,abortHandle:m};this._activeRequests.add(f);b.always(c,()=>{f.abortController=null;
f.abortHandle?.remove();f.abortHandle=null;this._activeRequests.delete(f)});return c}cancelAll(){this._activeRequests.forEach(c=>{c.abortController?.abort();c.abortController=null;c.abortHandle?.remove()});this._activeRequests.clear()}}a.I3SStreamDataController=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectors ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedPoint ../../../ViewingMode ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t){class r{constructor(L,C,z,J,K,I,M,S,N={}){this._indexSR=L;this._renderCoordsHelper=C;this._clippingArea=K;this._elevationProvider=I;this._viewingMode=M;this._options=N;this._frustum=g.create();this._frustumMbs=c.create();this._useFrustumCulling=!1;this._poi=b.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=new t.Obb;this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=
b.create();this._screenspaceErrorBias=N.screenspaceErrorBias||1;this._progressiveLoadFactor=N.progressiveLoadFactor||1;this.updateCamera(z,J);this._renderSR=C=this._renderCoordsHelper.spatialReference;this._renderSRSphericalPCPF=m.getSphericalPCPF(C);this._isGlobalMode=C===this._renderSRSphericalPCPF;this.updateElevationInfo(S);this._tmpPoint=l.makeDehydratedPoint(0,0,0,L);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(C.isWebMercator||e.isPlateCarree(C));this._indexSREllipsoidRadius=k.getReferenceEllipsoid(this._indexSR).radius;
this._indexSRSphericalPCPF=m.getSphericalPCPF(L);this._projectorIndexSRToIndexSRSphericalPCPF=f.getProjector(this._indexSR,this._indexSRSphericalPCPF)}updateElevationInfo(L){null==L?this._elevationContext=null:(this._elevationContext=w.ElevationContext.fromElevationInfo(L),this._elevationContext.updateFeatureExpressionInfoContext(q.createContextWithoutExpressionSupport(q.extractExpressionInfo(L,!1))))}updateCamera(L,C){if(this._useFrustumCulling=C){g.fromMatrix(L.viewMatrix,L.projectionMatrix,this._frustum,
D);C=L.eye;const K=y;a.normalize(K,L.viewForward);var z=E;a.sub(z,D[4],C);var J=a.dot(z,z);z=a.dot(K,z);J=.5*J/z;z=this._frustumMbs;a.scaleAndAdd(z,C,K,J);z[3]=1+J}this._screenSizeFactor=1/(L.perScreenPixelRatio/2);this._camPos=L.eye;this.minDistance=Infinity;this.maxDistance=0}setPointOfInterest(L){this._poi=L}updateScreenSpaceErrorBias(L){const C=this._screenspaceErrorBias;this._screenspaceErrorBias=L;return C}updateClippingArea(L){this._clippingArea=L}expandElevationRange(L,C,z){null!=this._elevationContext&&
(L=L.serviceMbsInIndexSR)&&(this._elevationProvider.getSphereElevationBounds?(C=this._elevationProvider.getSphereElevationBounds(L,this._indexSR))&&z.expandElevationRange(C):((L=this._elevationProvider.getElevation(L[0],L[1],L[2],this._indexSR,"relative-to-scene"===this._elevationContext.mode?"scene":"ground"))&&z.expandElevationRangeValues(L,L),(C=C?null:this._elevationProvider.getRootElevationBounds?.())&&z.expandElevationRange(C)))}getServiceMbsInRenderSR(L){const C=L.serviceMbsInRenderSR;if(p.isValidMbs(C))return C;
L.serviceMbsInIndexSR&&h.copy(C,L.serviceMbsInIndexSR);const z=L.elevationRangeMin;if(this._elevationContext&&Number.isFinite(z)){let J=0,K=0;L=L.elevationRangeMax;switch(this._elevationContext.mode){case "relative-to-ground":J=this._elevationContext.geometryZWithOffset(C[2],this._renderCoordsHelper)+z-C[2];K=L-z;break;case "on-the-ground":J=z-C[2],K=L-z}C[2]+=J+.5*K;C[3]+=.5*K}else this._elevationContext&&1E5>C[3]&&(this._tmpPoint.x=C[0],this._tmpPoint.y=C[1],this._tmpPoint.z=C[2],C[2]=x.evaluateElevationAlignmentAtPoint(this._tmpPoint,
this._elevationProvider,this._elevationContext,this._renderCoordsHelper));d.projectBoundingSphere(C,this._indexSR,C,this._renderSR);return C}getAndUpdateVisibilityObbInRenderSR(L){if(L.visibilityObbInRenderSR)return L.visibilityObbInRenderSR;const C=L.serviceObbInIndexSR;var z=.01*this._indexSREllipsoidRadius,{serviceMbsInIndexSR:J}=L;if(null==C||!J||!p.isValidObb(C)||this._isECEFOBBInLocalMode&&(C.halfSizeX>z||C.halfSizeY>z||C.halfSizeZ>z))return null;z=L.serviceObbInRenderSR;if(null==z)z=new t.Obb;
else if(p.isValidObb(z))return z;var K=L.elevationRangeMin;L=L.elevationRangeMax;const I=J[3];let M=0;J=0;const S=C.centerZ,N=this._renderCoordsHelper,V=this._elevationContext;if(V&&Number.isFinite(K))switch(V.mode){case "relative-to-ground":M=V.geometryZWithOffset(S,N)+K-S;J=L-K;break;case "on-the-ground":M=K-S,J=L-K}else V&&1E5>I&&(K=this._tmpPoint,K.x=C.centerX,K.y=C.centerY,K.z=S,M=x.evaluateElevationAlignmentAtPoint(K,this._elevationProvider,V,N)-S);K=0<J?this._tmpObb:z;C.transform(K,this._indexSR,
this._renderSR,M,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,this._projectorIndexSRToIndexSRSphericalPCPF);0<J&&t.computeOffsetObb(K,0,J,this._viewingMode,z);return z}getNodeObbInRenderSRIndependentOfElevationOffset(L){const C=L.visibilityObbInRenderSR??L.serviceObbInRenderSR??null;if(p.isValidObb(C))return C;L=L.serviceObbInIndexSR;if(!L)return null;L.transform(B,this._indexSR,this._renderSR,void 0,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,this._projectorIndexSRToIndexSRSphericalPCPF);
return B}ensureElevationAgnosticBoundingVolume(L,C){-1===L.elevationAgnosticBoundingVolume[3]&&(C===u.ViewingMode.Global?this._updateElevationAgnosticBoundingVolumeGlobal(L):this._updateElevationAgnosticBoundingVolumeLocal(L))}_updateElevationAgnosticBoundingVolumeGlobal(L){const C=this.getNodeObbInRenderSRIndependentOfElevationOffset(L),z=L.elevationAgnosticBoundingVolume,J=F;var K=-1;if(C){C.getCenter(J);a.normalize(J,J);C.getCorners(G);for(var I of G){a.normalize(I,I);L=a.dot(I,J);if(0>=L){z[3]=
-1;return}K=Math.max(K,Math.sqrt(1-L*L))}}else if(K=L.serviceMbsInRenderSR,p.isValidMbs(K))I=a.copy(F,n.getCenter(K)),K=K[3],L=a.len(I),K=0===K?0:L<K?-1:K/L,a.normalize(I,I);else{z[3]=-1;return}h.copyVec3(z,J);z[3]=K+.001}_updateElevationAgnosticBoundingVolumeLocal(L){const C=L.elevationAgnosticBoundingVolume;var z=this.getNodeObbInRenderSRIndependentOfElevationOffset(L);if(z){L=z.getCenter(F);L[2]=0;h.copyVec3(C,L);L=0;const K=H;z.getCorners(G);for(var J of G)J[2]=0,z=a.sqrDist(K,J),L=Math.max(L,
z);C[3]=Math.sqrt(L)}else J=L.serviceMbsInRenderSR,p.isValidMbs(J)&&(z=a.copy(F,n.getCenter(J)),z[2]=0,h.copyVec3(C,z),C[3]=J[3])}isNodeVisible(L){const C=this.getServiceMbsInRenderSR(L);return this._isMBSinClippingArea(C)?this._useFrustumCulling?(L=this.getAndUpdateVisibilityObbInRenderSR(L))?L.isVisible(this._frustum):g.intersectsSphere(this._frustum,n.wrap(C)):!0:!1}isElevationAgnosticBoundingVolumeVisible(L,C){return this._useFrustumCulling&&-1!==C[3]?L===u.ViewingMode.Global?this._isConeVisibleInFrustum(C):
this._isCylinderVisibleInFrustum(C):!0}_isConeVisibleInFrustum(L){var C=this._frustumMbs,z=a.len(C);const J=C[3];var K=a.dot(L,C);const I=L[3];if(.9<I||z<=J)return!0;L=a.scale(A,L,K);if(a.dist(L,C)<J)return!0;C=K/z;if(0>=K)return-C<J;K=Math.sqrt(1-C*C);if(K<I)return!0;z=J/z;return K*Math.sqrt(1-z*z)-z*C<I}_isCylinderVisibleInFrustum(L){var C=this._frustumMbs;const z=C[3];C=a.copy(A,C);C[2]=0;const J=L[3];return a.dist(C,L)<=J+z}isGeometryVisible(L){return this._useFrustumCulling?L.geometryObbInRenderSR?.isVisible(this._frustum)??
this.isNodeVisible(L):!0}_isMBSinClippingArea(L){return null==this._clippingArea?!0:p.intersectBoundingRectWithMbs(this._clippingArea,L)!==p.MbsIntersectResult.OUTSIDE}_screenSpaceDiameterMbs(L,C){var z=this.getServiceMbsInRenderSR(L);L=Math.sqrt(a.squaredDistance(n.getCenter(z),this._camPos));z=L-z[3];this._updateMinMaxDistance(L);return 0>z?.5*Number.MAX_VALUE:C/z*this._screenSizeFactor}calcCameraDistance(L){return this.calcCameraDistanceToCenter(L)-this.getServiceMbsInRenderSR(L)[3]}calcCameraDistanceToCenter(L){L=
this.getServiceMbsInRenderSR(L);L=a.distance(n.getCenter(L),this._camPos);this._updateMinMaxDistance(L);return L}calcAngleDependentLoD(L){L=this.getServiceMbsInRenderSR(L);const C=L[3];L=(Math.abs(L[0]*(L[0]-this._camPos[0])+L[1]*(L[1]-this._camPos[1])+L[2]*(L[2]-this._camPos[2]))/a.length(n.getCenter(L))+C)/a.distance(n.getCenter(L),this._camPos);return Math.min(1,L)}hasLOD(L){return L.lodMetric!==v.LodMetric.None}_getDistancePlanarMode(L,C){var z=L[0]-C[0];const J=L[1]-C[1];L=L[2]-C[2];z=z*z+J*
J;C=C[3];if(z<=C*C)return Math.abs(L);C=Math.sqrt(z)-C;return Math.sqrt(L*L+C*C)}_getDistanceGlobeMode(L,C){var z=a.length(n.getCenter(C));const J=a.length(L)-z;a.scale(this._tmp0,L,a.dot(L,n.getCenter(C))/a.squaredLength(L));var K=a.squaredDistance(n.getCenter(C),this._tmp0),I=C[3];if(K<=I*I)return Math.abs(J);C=a.scale(this._tmp0,n.getCenter(C),1/z);z=a.scale(this._tmp1,C,z-I*I/2/z);K=a.subtract(this._tmp2,L,z);K=a.subtract(this._tmp2,K,a.scale(this._tmp3,C,a.dot(C,K)));z=a.add(this._tmp2,z,a.scale(this._tmp2,
K,I/a.length(K)));I=a.distance(L,z);2E5<=J&&(L=a.subtract(this._tmp1,L,z),L=a.dot(L,C)/a.length(L),.08>L&&(L=1E-4),I/=L);return I}_getDistance(L,C){return this._isGlobalMode?this._getDistanceGlobeMode(L,C):this._getDistancePlanarMode(L,C)}_updateMinMaxDistance(L){0<L?(this.minDistance=Math.min(this.minDistance,L),this.maxDistance=Math.max(this.maxDistance,L)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-L))}getLodLevel(L){if(L.lodMetric===v.LodMetric.None)return 0;if(0===L.childCount)return this.maxLodLevel;
if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const C=this._screenspaceErrorBias;return this.evaluateLODmetric(L,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(L,C)?2:1:0}return this.evaluateLODmetric(L,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(L,C){switch(L.lodMetric){case v.LodMetric.ScreenSpaceRelative:const z=this.getServiceMbsInRenderSR(L),J=this._getDistance(this._camPos,z),K=2*J/this._screenSizeFactor;this._updateMinMaxDistance(J+
z[3]);return L.maxError*C<=K;case v.LodMetric.MaxScreenThreshold:return C=this._screenSpaceDiameterMbs(L,L.serviceMbsInIndexSR[3]*C),this._options.angleDependentLoD&&(C*=this.calcAngleDependentLoD(L)),C<L.maxError;case v.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(L,L.maxError)*C;case v.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(L)>L.maxError*C}return!1}distToPOI(L){L=this.getServiceMbsInRenderSR(L);return a.distance(n.getCenter(L),this._poi)-
L[3]}distCameraToPOI(){return a.distance(this._camPos,this._poi)}}const y=b.create(),D=g.createPoints(),E=b.create(),A=b.create(),B=new t.Obb,F=b.create(),G=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create()],H=b.create();return r})},"esri/layers/support/SceneModification":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){var x;b=x=class extends h.JSONSupport{constructor(w){super(w);this.geometry=null;this.type="clip"}writeGeometry(w,q,v,p){if(p.layer?.spatialReference&&!p.layer.spatialReference.equals(this.geometry.spatialReference)){if(!l.canProjectWithoutEngine(w.spatialReference,p.layer.spatialReference)){p?.messages&&p.messages.push(new k("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:p.layer.spatialReference,
context:p}));return}const t=new u;l.projectPolygon(w,t,p.layer.spatialReference);q[v]=t.toJSON(p)}else q[v]=w.toJSON(p);delete q[v].spatialReference}clone(){return new x({geometry:c.clone(this.geometry),type:this.type})}};a.__decorate([m.property({type:u}),n.persistable()],b.prototype,"geometry",void 0);a.__decorate([e.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);a.__decorate([m.property({type:["clip","mask","replace"],nonNullable:!0}),n.persistable()],b.prototype,
"type",void 0);return b=x=a.__decorate([g.subclass("esri.layers.support.SceneModification")],b)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/tslib.es6 ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/lang ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/projection/projectBuffer ../../../geometry/support/aaBoundingBox ../../../geometry/support/DoubleArray ../../../layers/graphics/dehydratedPoint ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A){class B{constructor(C,z){this.meta=C;this.index=z}}class F{constructor(C,z){this.graphic=C;this.geometry=z;this.components=[];this.overridesDirty=!1}}b=class extends h{get updating(){return this._graphicsCore?.updating??!1}constructor(C){super(C);this.loadedGraphics=new D.LimitGraphicsMap(5E4);this.slicePlaneEnabled=!1;this._renderingInfo={symbol:new A};this._featuresMap=new Map}initialize(){const C=this.view.basemapTerrain;this._graphicsCore=
new t.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:E.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:z=>this.view.deconflictor.addGraphicsOwner(z),labeler:(z,J)=>this.view.labeler.addGraphicsOwner(z,J,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
scaleVisibility:(z,J)=>new r.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:J,graphicsCore:z,basemapTerrain:C,layerScaleEnabled:!1})}});this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this.addHandles(f.watch(()=>this.layer.labelingInfo,(z,J)=>{x.diff(z,J)&&this._graphicsCore.updateLabelingInfo()}))}destroy(){this._graphicsCore=d.destroyMaybe(this._graphicsCore);this.loadedGraphics=d.destroyMaybe(this.loadedGraphics);
this.view=null}addNodeMeta(C,z){let J=0;const K=C.filteredIds,I=this.view.spatialReference,M=[];for(let V=0;V<C.featureIds.length;V++){const Q=C.featureIds[V];var S=null==K;K&&J<K.length&&Q===K[J]&&(S=!0,J++);if(!this._enabledForFeatureInNode(C,V))continue;var N=this._featuresMap.get(Q);if(N){N.components.push(new B(C,V));this._updateLabelPosition(Q);continue}const T=z(V,C);N=p.makeDehydratedPoint(0,0,0,I);S={objectId:Q,uid:g.generateUID(),attributes:T,visible:S,geometry:N};N=new F(S,N);N.components.push(new B(C,
V));this._featuresMap.set(Q,N);this._updateLabelGeometry(Q);M.push(S)}this.loadedGraphics.addMany(M)}updateLabelPositions(C){const z=this.view.renderCoordsHelper;this._forEachGraphic(C,(J,K,I)=>{K=this._graphicsCore.getGraphics3DGraphicById(K.uid);null!=K&&this._updateLabelGeometry(C.featureIds[J])&&K.alignWithAbsoluteElevation(I.z??0,z,!1)})}setNodeMetaAttributes(C,z){const J=[];this._forEachGraphic(C,(K,I)=>{K=z(K,C);k.equalsShallow(I.attributes,K)||(I.attributes=K,J.push(I.uid))});this._graphicsCore.updateLabelingInfo(J)}applyFilterChange(C){this._forEachFeature(C,
(z,J,K)=>{if(this._enabledForFeatureInNode(C,z))z=J.graphic,J=z.visible,J!==K&&(z.visible=K,G.graphic=z,G.property="visible",G.oldValue=J,G.newValue=K,this._graphicsCore.graphicUpdateHandler(G));else switch(K=C.featureIds[z],this._removeFeature(J,C,z)){case H.REMOVED:this.loadedGraphics.removeManyByObjectId([K]);break;case H.MODIFIED:this._updateLabelPosition(K)}})}removeNodeMeta(C){const z=[];this._forEachGraphic(C,J=>{const K=C.featureIds[J],I=this._featuresMap.get(K);if(I)switch(this._removeFeature(I,
C,J)){case H.MODIFIED:this._updateLabelPosition(K);break;case H.REMOVED:z.push(K)}});this.loadedGraphics.removeManyByObjectId(z)}_removeFeature(C,z,J){const K=C.components.length;c.filterInPlace(C.components,I=>!(I.meta===z&&I.index===J));return 0===C.components.length?(this._featuresMap.delete(z.featureIds[J]),H.REMOVED):K!==C.components.length?H.MODIFIED:H.UNMODIFIED}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}_updateLabelPosition(C){const z=
this._featuresMap.get(C);z&&this._updateLabelGeometry(C)&&(this.loadedGraphics.removeManyByObjectId([C]),this.loadedGraphics.addMany([z.graphic]))}_updateLabelGeometry(C){C=this._featuresMap.get(C);if(!C)return!1;const z=C.geometry,J=this.view.spatialReference,K=this.view.renderCoordsHelper,I=z.x,M=z.y,S=z.z??0,N=v.newDoubleArray(C.components.length*y.boundingBoxCornersPointsStride);let V=0;for(const {meta:Q,index:T}of C.components)y.boundingBoxCornerPoints(T,this.collection,Q.objectHandle,N,V),V+=
y.boundingBoxCornersPointsStride;w.projectBuffer(N,K.spatialReference,0,N,J,0,N.length/3);q.set(L,q.negativeInfinity);q.expandWithBuffer(L,N);z.x=(L[0]+L[3])/2;z.y=(L[1]+L[4])/2;z.z=L[5];return!m.floatEqualUlp(z.x,I)||!m.floatEqualUlp(z.y,M)||!m.floatEqualUlp(z.z,S)}_forEachGraphic(C,z){this._forEachFeature(C,(J,{graphic:K,geometry:I},M)=>{this._enabledForFeatureInNode(C,J)&&z(J,K,I,M)})}_forEachFeature(C,z){let J=0;for(let K=0;K<C.featureIds.length;K++){const I=this._featuresMap.get(C.featureIds[K]);
let M=null==C.filteredIds;C.filteredIds&&C.filteredIds[J]===C.featureIds[K]&&(M=!0,J++);I&&z(K,I,M)}}_enabledForFeatureInNode(C,z){return 0>C.node.index||!this.overrides?.featureHasGeometryChanges(C.featureIds[z])}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){return{graphicsCore:this._graphicsCore}}};a.__decorate([e.property()],b.prototype,
"view",void 0);a.__decorate([e.property()],b.prototype,"layer",void 0);a.__decorate([e.property()],b.prototype,"collection",void 0);a.__decorate([e.property()],b.prototype,"loadedGraphics",void 0);a.__decorate([e.property()],b.prototype,"overrides",void 0);a.__decorate([e.property()],b.prototype,"updating",null);a.__decorate([e.property()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([e.property()],b.prototype,"_graphicsCore",void 0);b=a.__decorate([u.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],
b);const G={graphic:null,property:null,oldValue:null,newValue:null};var H;(function(C){C[C.UNMODIFIED=0]="UNMODIFIED";C[C.MODIFIED=1]="MODIFIED";C[C.REMOVED=2]="REMOVED"})(H||={});const L=q.create();return b})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),function(a,
b,h,c,k,m){function d(e,n,l,u,x){e=n.getComponentAabb(l,e,f);n=n.getObjectTransform(l);for(l=0;8>l;++l)g[0]=l&1?e[0]:e[3],g[1]=l&2?e[1]:e[4],g[2]=l&4?e[2]:e[5],b.transformMat3(g,g,n.rotationScale),b.add(g,g,n.position),u[x++]=g[0],u[x++]=g[1],u[x++]=g[2];return u}const f=k.create(),g=h.create();a.boundingBoxCornerPoints=d;a.boundingBoxCornersPointsStride=24;a.createGetFeatureExtent=function(e,n,l){const u=m.newDoubleArray(24);return x=>{var w=x.meta.featureExtents;if(null==w){w=new Float64Array(6*
x.meta.featureIds.length);x.meta.featureExtents=w;for(let q=0;q<w.length;q+=6)w[q]=Number.POSITIVE_INFINITY}w=new Float64Array(w.buffer,6*x.index*Float64Array.BYTES_PER_ELEMENT,6);w[0]===Number.POSITIVE_INFINITY&&(d(x.index,l,x.meta.objectHandle,u,0),c.projectBuffer(u,n,0,u,e,0,8)?(k.set(w,k.negativeInfinity),k.expandWithBuffer(w,u,0,8)):k.set(w,k.zero));return w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports",
"../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,h,c){class k extends b{constructor(g){super();this._limit=g;this._all=new c.GraphicsMap;this._active=new f(this);this._pending=new Map;this._handle=this._all.on("change",e=>this._handleChanges(e))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(g){return this._active.find(g)}forEach(g){this._active.forEach(g)}addMany(g){this._all.addMany(g)}removeManyByObjectId(g){this._all.removeManyByObjectId(g)}_handleChanges(g){let e=
g.removed;if(0<this._pending.size){e=[];for(var n of g.removed)this._pending.delete(n.objectId)||e.push(n)}n=this._limit-this._active.length+e.length;n<g.added.length&&(this._active.removeMany(e),e=[],d.reset(1-this._limit/(this._active.length+g.added.length)),this._active.forEach(u=>{d.sample()&&(e.push(u),this._pending.set(u.objectId,u))}),n=this._limit-this._active.length+e.length);let l=g.added;if(n<g.added.length){l=[];d.reset(n/g.added.length);for(const u of g.added)d.sample()?l.push(u):this._pending.set(u.objectId,
u)}g=n-l.length;0<g&&0<this._pending.size&&(d.reset(g/this._pending.size),this._pending.forEach(u=>{d.sample()&&(l.push(u),this._pending.delete(u.objectId))}));this._active.addAndRemove(l,e)}}class m{constructor(){this._percentage=1;this._last=-1;this._index=0}reset(g){this._percentage=g;this._last=-1}sample(){const g=Math.floor(this._index*this._percentage);++this._index;if(g===this._last)return!1;this._last=g;return!0}}const d=new m;class f{constructor(g){this._parent=g;this._map=new Map}get length(){return this._map.size}forEach(g){this._map.forEach(e=>
g(e))}find(g){let e=void 0;h.someMap(this._map,n=>g(n)?(e=n,!0):!1);return e}toArray(){return[...this._map.values()]}addAndRemove(g,e){for(const n of g)this._map.set(n.objectId,n);for(const n of e)this._map.delete(n.objectId);(0<g.length||0<e.length)&&this._parent.emit("change",{added:g,removed:e})}removeMany(g){for(const e of g)this._map.delete(e.objectId);0<g.length&&this._parent.emit("change",{added:[],removed:g})}}a.LimitGraphicsMap=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../core/Evented","../../../core/MapUtils"],function(a,b,h){class c extends b{constructor(){super(...arguments);this._map=new Map}clear(){if(0<this._map.size){const k=this.toArray();this._map.clear();this.emit("change",{added:[],removed:k})}}get length(){return this._map.size}get(k){return this._map.get(k)}addMany(k){if(0!==k.length){var m=new Set;for(let d=0;d<k.length;d++){const f=k[d],g=f.objectId,e=this._map.get(g);e?(m.add(g),
f!==e&&(k[d]=e),e.refCount||(e.refCount=0),++e.refCount):(f.refCount=1,this._map.set(g,f))}k=0<m.size?k.filter(d=>!m.has(d.objectId)):k;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeMany(k){const m=[];for(const d of k){k=d.objectId;const f=this._map.get(k);null!=f&&(!f.refCount||0>=--f.refCount)&&(this._map.delete(k),m.push(d))}0<m.length&&this.emit("change",{added:[],removed:m})}removeManyByObjectId(k){const m=[];for(const d of k)k=this._map.get(d),null!=k&&(!k.refCount||0>=--k.refCount)&&
(this._map.delete(d),m.push(k));0<m.length&&this.emit("change",{added:[],removed:m})}toArray(){return[...this._map.values()]}find(k){let m;h.someMap(this._map,d=>k(d)?(m=d,!0):!1);return m}forEach(k){this._map.forEach(m=>k(m))}}a.GraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class h extends b.LayerViewPerformanceInfo{constructor(c,k,m,d,
f,g,e){super(c,0,0,0,k);this.gpuMB=m;this.geometryMB=d;this.textureMB=f;this.unloadedMB=g;this.idbHitRate=e}}a.I3SMeshViewPerformanceInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../core/Logger ../../../core/PooledArray ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../geometry/projection/projectVectorToVector ../../../libs/i3s/enums".split(" "),
function(a,b,h,c,k,m,d,f){function g(u,x,w){n.clear();var q=Infinity;let v=Infinity,p=-Infinity,t=-Infinity,r=!1;for(const D of x){var y="clip"===D.type?f.ModificationType.Inside:"mask"===D.type?f.ModificationType.Outside:f.ModificationType.Replace;const E=D.geometry;x=A=>A;if(E.spatialReference){if(!m.canProjectWithoutEngine(E.spatialReference,w)){b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}x=A=>{d.projectVectorToVector(A,E.spatialReference,l,w);return l}}else E.hasZ||(l[2]=0,x=A=>{l[0]=A[0];l[1]=A[1];return l});r=r||y===f.ModificationType.Outside;n.push(y);n.push(E.rings.length);for(const A of E.rings){n.push(A.length);for(const B of A)y=x(B),n.push(y[0]),n.push(y[1]),n.push(y[2]),q=Math.min(q,y[0]),v=Math.min(v,y[1]),p=Math.max(p,y[0]),t=Math.max(t,y[1])}}null!=u&&(r?(n.push(f.ModificationType.Inside),n.push(2),n.push(4),n.push(q-1E-4),n.push(v-1E-4),n.push(0),n.push(p+1E-4),
n.push(v-1E-4),n.push(0),n.push(p+1E-4),n.push(t+1E-4),n.push(0),n.push(q-1E-4),n.push(t+1E-4),n.push(0)):(n.push(f.ModificationType.Outside),n.push(1)),n.push(4),n.push(u[0]),n.push(u[1]),n.push(0),n.push(u[2]),n.push(u[1]),n.push(0),n.push(u[2]),n.push(u[3]),n.push(0),n.push(u[0]),n.push(u[3]),n.push(0));n.push(f.ModificationType.Finished);u=new Float64Array(n.length);for(q=0;q<n.length;++q)u[q]=n.at(q);return u}class e extends k.WorkerHandle{constructor(u){super("SceneLayerWorker","process",{process:x=>
[x.geometryBuffer],project:x=>[x.positions.buffer],transformNormals:x=>[x.normals.buffer]},u,{hasInitialize:!0})}setModifications(u,x,w,q){u={context:u,modifications:g(x,w,q),isGeodetic:q.isGeographic};this.broadcast(u,"setModifications")}setLegacySchema(u,x){x=JSON.stringify(x);return this.broadcast({context:u,jsonSchema:x},"setLegacySchema")}destroyContext(u){return this.broadcast(u,"destroyContext")}project(u,x){return this.invokeMethod("project",u,x)}transformNormals(u,x){return this.invokeMethod("transformNormals",
u,x)}}const n=new h({deallocator:null}),l=c.create();a.I3SMeshWorkerHandle=e;a.toWasmModification=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||
(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.QUERYABLE=2]="QUERYABLE"})(a.ForAllFeaturesMode||(a.ForAllFeaturesMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));a.ElevationMode=void 0;(function(b){b[b.Absolute=0]="Absolute";b[b.RelativeToGround=1]="RelativeToGround";b[b.OnTheGround=2]="OnTheGround"})(a.ElevationMode||(a.ElevationMode={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/support/DoubleArray ../../../geometry/support/MeshGeoreferencedVertexSpace ../../../geometry/support/MeshLocalVertexSpace ../../../chunks/vec3 ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),
function(a,b,h,c,k,m,d,f,g,e){function n(r){if(p){var y=r.modifications,D=p._malloc(8*y.length),E=new Float64Array(p.HEAPU8.buffer,D,y.length);for(let A=0;A<y.length;++A)E[A]=y[A];p.setModifications(r.context,D,y.length,r.isGeodetic);p._free(D)}}function l(r,y,D){const {context:E,localOrigin:A,globalTrafo:B,mbs:F,obbData:G,elevationOffset:H,geometryBuffer:L,geometryDescriptor:C,indexToVertexProjector:z,vertexToRenderProjector:J}=y;var K=r._malloc(L.byteLength),I=r._malloc(33*Float64Array.BYTES_PER_ELEMENT),
M=new Uint8Array(r.HEAPU8.buffer,K,L.byteLength);M.set(new Uint8Array(L));var S=new Float64Array(r.HEAPU8.buffer,I,33);w(S,A);var N=S.byteOffset+3*S.BYTES_PER_ELEMENT,V=new Float64Array(S.buffer,N);w(V,B);N+=16*S.BYTES_PER_ELEMENT;V=new Float64Array(S.buffer,N);w(V,F);N+=4*S.BYTES_PER_ELEMENT;G&&(V=new Float64Array(S.buffer,N),w(V,G));S={isDraco:!1,isLegacy:!1,color:y.layouts.some(ia=>ia.some(O=>"color"===O.name)),normal:y.needNormals&&y.layouts.some(ia=>ia.some(O=>"normalCompressed"===O.name)),uv0:y.layouts.some(ia=>
ia.some(O=>"uv0"===O.name)),uvRegion:y.layouts.some(ia=>ia.some(O=>"uvRegion"===O.name)),featureIndex:C.featureIndex};M=r.process(E,!!y.obbData,K,M.byteLength,C,S,I,H,z,J,y.normalReferenceFrame);r._free(I);r._free(K);if(0<M.error.length)throw Error(`i3s.wasm: ${M.error}`);if(M.discarded)return null;r=0<M.componentOffsets.length?M.componentOffsets.slice():null;K=0<M.featureIds.length?M.featureIds.slice():null;I=0<M.anchorIds.length?Array.from(M.anchorIds):null;S=0<M.anchors.length?Array.from(M.anchors):
null;N=M.interleavedVertedData.slice().buffer;V=M.indicesType===f.IndexType.Int16?(new Uint16Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/2)).slice():(new Uint32Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/4)).slice();const Q=M.positions.slice(),T=M.positionIndicesType===f.IndexType.Int16?(new Uint16Array(M.positionIndices.buffer,M.positionIndices.byteOffset,M.positionIndices.byteLength/2)).slice():(new Uint32Array(M.positionIndices.buffer,M.positionIndices.byteOffset,
M.positionIndices.byteLength/4)).slice();y={layout:y.layouts[0],interleavedVertexData:N,indices:V,hasColors:M.hasColors,hasModifications:M.hasModifications,positionData:{data:Q,indices:T}};K&&D.push(K.buffer);r&&D.push(r.buffer);D.push(N);D.push(V.buffer);D.push(Q.buffer);D.push(T.buffer);return{componentOffsets:r,featureIds:K,anchorIds:I,anchors:S,transformedGeometry:y,obb:M.obb}}function u(r){if(p){var {context:y,buffer:D}=r;r=p._malloc(D.byteLength);var E=D.byteLength/Float64Array.BYTES_PER_ELEMENT,
A=new Float64Array(p.HEAPU8.buffer,r,E),B=new Float64Array(D);A.set(B);p.filterOBBs(y,r,E);B.set(A);p._free(r)}}function x(r){p&&0===p.destroy(r)&&(p=null)}function w(r,y){for(let D=0;D<y.length;++D)r[D]=y[D]}function q(){if(p)return Promise.resolve(p);v||=g.get().then(r=>{p=r;v=null;return p});return v}let v,p;const t={transform:(r,y)=>p&&l(p,r,y),destroy:x};b.destroyContext=function(r){x(r)};b.dracoDecompressPointCloudData=async function(r){p=await q();const y=[r.geometryBuffer];var {geometryBuffer:D}=
r,E=D.byteLength;r=p._malloc(E);E=new Uint8Array(p.HEAPU8.buffer,r,E);E.set(new Uint8Array(D));D=p.dracoDecompressPointCloudData(r,E.byteLength);p._free(r);if(0<D.error.length)throw Error(`i3s.wasm: ${D.error}`);r=0<D.featureIds?.length?D.featureIds.slice():null;D=D.positions.slice();r&&y.push(r.buffer);y.push(D.buffer);return{result:{positions:D,featureIds:r},transferList:y}};b.filterObbsForModifications=async function(r){await q();u(r);r={buffer:r.buffer};return{result:r,transferList:[r.buffer]}};
b.filterObbsForModificationsSync=u;b.initialize=async function(){p||await q()};b.interpretObbModificationResults=function(r){return 0===r?e.NodeIMModificationImpact.Unmodified:1===r?e.NodeIMModificationImpact.PotentiallyModified:2===r?e.NodeIMModificationImpact.Culled:e.NodeIMModificationImpact.Unknown};b.process=async function(r){p=await q();const y=[r.geometryBuffer];return{result:l(p,r,y),transferList:y}};b.project=async function(r){const {localMatrix:y,origin:D,positions:E,vertexSpace:A,localMode:B}=
r;var F=h.fromJSON(r.inSpatialReference);r=h.fromJSON(r.outSpatialReference);if("georeferenced"===A.type&&null==A.origin){const [{projectBuffer:z},{initializeProjection:J}]=await Promise.all([new Promise((K,I)=>a(["../../../geometry/projection/projectBuffer"],K,I)),new Promise((K,I)=>a(["../../../geometry/projection"],K,I))]);await J(F,r);var G=new Float64Array(E.length);z(E,F,0,G,r,0,G.length/3)}else{G="georeferenced"===A.type?k.fromJSON(A):m.fromJSON(A);const {project:z}=await new Promise((J,K)=>
a(["../../../geometry/support/meshUtils/georeference"],J,K));G=c.toFloat64Array(z({positions:E,transform:y?{localMatrix:y}:void 0,vertexSpace:G,inSpatialReference:F,outSpatialReference:r,localMode:B}))}F=G.length;const [H,L,C]=D;for(r=0;r<F;r+=3)G[r]-=H,G[r+1]-=L,G[r+2]-=C;return{result:{projected:G,original:E},transferList:[G.buffer,E.buffer]}};b.setLegacySchema=async function(r){p=await q();p.setLegacySchema(r.context,r.jsonSchema)};b.setModifications=async function(r){await q();n(r)};b.setModificationsSync=
n;b.test=t;b.transformNormals=async function({normalMatrix:r,normals:y}){const D=new Float32Array(y.length);d.transformMat3(D,y,r);d.normalize(D,D);return{result:{transformed:D,original:y},transferList:[D.buffer,y.buffer]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,h){function c(m){return h.getAssetUrl(`esri/libs/i3s/${m}`)}let k;b.get=function(){k||=(new Promise(m=>(new Promise((d,
f)=>a(["../../chunks/i3s"],d,f))).then(d=>d.i3s).then(({default:d})=>{const f=d({locateFile:c,onRuntimeInitialized:()=>m(f)});delete f.then}))).catch(m=>{throw m;});return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../../../../core/handleUtils","../II3SMeshView3D"],function(a,b,h){class c{constructor(){this.ids=new Set}}class k{constructor({collection:m,forAllFeatures:d,forAllFeaturesOfNode:f}){this._highlights=
[];this._collection=m;this._forAllFeatures=d;this._forAllFeaturesOfNode=f}destroy(){this._highlights.forEach(m=>this._releaseSet(m));this._highlights=null}acquireSet(){const m=new c;this._highlights.push(m);const d=b.makeHandle(()=>{this._highlights&&(this._releaseSet(m),a.removeUnordered(this._highlights,m))});return{set:m,handle:d}}setFeatureIds(m,d){d.forEach(f=>m.ids.add(f));this._initializeSet(m)}_initializeSet(m){this._forAllFeatures((d,f,g)=>{m.ids.has(d)&&this._collection.addComponentHighlight(g.objectHandle,
f);return h.ForAllFeaturesReturnType.CONTINUE})}_releaseSet(m){this._forAllFeatures((d,f,g)=>{m.ids.has(d)&&this._collection.removeComponentHighlight(g.objectHandle,f);return h.ForAllFeaturesReturnType.CONTINUE})}objectCreated(m){this._highlights.forEach(d=>{this._forAllFeaturesOfNode(m,(f,g)=>{d.ids.has(f)&&this._collection.addComponentHighlight(m.objectHandle,g);return h.ForAllFeaturesReturnType.CONTINUE})})}objectDeleted(m){this._collection.clearHighlights(m.objectHandle)}}return k})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../II3SMeshView3D ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){a.I3SAsyncElevationUpdater=class extends h{constructor(l,u,x,w){super({});this._updateExtent=u;this._updateNode=x;this._getElevationMode=w;this.running=!1;this._extentSet=new e.ExtentSet;this._nodeSet=new Set;u=this._taskPriority;l=l.registerTask(this._taskPriority,this);this.addHandles(l);this._task=l;this._lastTaskPriority=u}get _taskPriority(){const l=this._getElevationMode();return l?l===g.ElevationMode.RelativeToGround?n.TaskPriority.ELEVATION_ALIGNMENT_SCENE:
n.TaskPriority.ELEVATION_ALIGNMENT:n.TaskPriority.ELEVATION_ALIGNMENT}_updateTaskPriority(){const l=this._taskPriority;l!==this._lastTaskPriority&&(this._lastTaskPriority=this._task.priority=l)}normalizeCtorArgs(){return{}}addExtent(l){this._extentSet.add(l);this._updateTaskPriority();this.running=!0}schedule(l){this._nodeSet.add(l);this._updateTaskPriority();this.running=!0}remove(l){this._nodeSet.delete(l);this._updateRunning()}runTask(l){const u=this._extentSet;for(l.run(()=>u.merge(l));!u.empty&&
!l.done;){var x=this._updateExtent(u.pop());null!=x&&x.forAll(w=>this.schedule(w));l.madeProgress()}if(!l.done){x=this._nodeSet;for(const w of x)if(x.delete(w),this._updateNode(w),l.madeProgress(),l.done)break;this._updateRunning()}}_updateRunning(){this.running=0<this._nodeSet.size||0<this._extentSet.size}};b.__decorate([c.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=b.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],
a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,h,c){class k{constructor(){this.lodCrossfadeSignedDuration=0}}class m{constructor(d){this._view=d;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}destroy(){this._preRenderFrameTaskHandle?.remove();this._view=
this._preRenderFrameTaskHandle=null}get updating(){return 0<this._numFadingNodes}stopNodeFading(d){null!=d.lodCrossfadeProgress&&(this._numFadingNodes--,d.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))}_startNodeFading(d,f,g){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=h.addFrameTask({preRender:e=>this._updateAllNodeFading(e)}),
this._view.notifyLODUpdate());null==d.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());d.lodCrossfadeSignedDuration=g;d.lodCrossfadeProgress=f}_updateAllNodeFading(d){const f=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((g,e)=>{if(null!=g?.lodCrossfadeProgress){const n=g.lodCrossfadeSignedDuration,l=g.lodCrossfadeProgress+Math.abs(d.deltaTime/n),u=!f||1<=l||0===n,x=(0<n?this._view.fullOpacity:0)-(u?0:0<n?1:-1)*(1-l);u?(this.stopNodeFading(g),0>n&&this._view.markNodeToRemove(e)):
g.lodCrossfadeProgress=l;this._view.setNodeOpacityByIndex(e,x)}});this._view.removeMarkedNodes()}stopAllNodeFading(){this._view.foreachCrossfadeNode((d,f)=>{null!=d?.lodCrossfadeProgress&&(this.stopNodeFading(d),d=d.lodCrossfadeSignedDuration,0>d&&this._view.markNodeToRemove(f),this._view.setNodeOpacityByIndex(f,0<d?this._view.fullOpacity:0))});this._view.removeMarkedNodes()}fadeNode(d,f,g,e){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var n=this._view;const l=n.nodeCrossfadingEnabled,
u=g===c.FadeDirection.FadeIn?n.fullOpacity:0;e=l?e?g===c.FadeDirection.FadeIn?n.lodCrossfadeinDuration:n.lodCrossfadeoutDuration:n.lodCrossfadeUncoveredDuration:0;n=this._view.getNodeOpacityByIndex(d);l&&n!==u&&0<e?this._startNodeFading(f,1-Math.abs(u-n),(g===c.FadeDirection.FadeIn?1:-1)*e):(this.stopNodeFading(f),this._view.setNodeOpacityByIndex(d,u),g===c.FadeDirection.FadeOut&&this._view.removeNode(d))}isNodeFullyFadedIn(d){const f=this._view.getNodeCrossfadeMetaData(d);return null==f||null==f.lodCrossfadeProgress&&
this._view.getNodeOpacityByIndex(d)===this._view.fullOpacity}}a.I3SCrossfadeHelper=m;a.NodeCrossfadeMetaData=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../ViewingMode ./I3SUtil ./Intersector ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(a,b,h,c,k,m,d){function f(e,n,l,u=0){u=e[3]+u;const x=n[0]-e[0],
w=n[1]-e[1];e=n[2]-e[2];n=l[0];const q=l[1];l=l[2];const v=n*x+q*w+l*e;return 0<=v*v-(n*n+q*q+l*l)*(x*x+w*w+e*e-u*u)}class g{constructor(e){this.type=m.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=e.layerUid;this.sublayerUid=e.sublayerUid;this._collection=e.collection;this._traverseNodeHierarchy=e.traverseNodeHierarchy;this.slicePlaneEnabled=e.slicePlaneEnabled;this.isGround=e.isGround}updateElevationAlignState(e,n){this._needVerticalOffset=e&&n===b.ViewingMode.Global}intersect(e,
n,l,u,x,w){const q=w??!1,v=e.results,p=e.options.store===m.StoreResults.ALL,t=e.ray.direction,r=e.tolerance;let y=A=>A,D=A=>A;const E=d.getVerticalOffsetI3S(e.verticalOffset??(this._needVerticalOffset?0:null));null!=e.verticalOffset&&null!=E&&(y=A=>E.applyToMbs(A),D=A=>E.applyToObb(A));this._traverseNodeHierarchy((A,B)=>{if(0===A.childrenLoaded)return!1;const F=h.isValidObb(A.serviceObbInRenderSR)?A.serviceObbInRenderSR:null;if(F&&!D(F).intersectRay(l,t,r))return!1;!B||!F&&h.isValidMbs(A.serviceMbsInRenderSR)&&
!f(y(A.serviceMbsInRenderSR),l,t,r)||null!=A.geometryObbInRenderSR&&!D(A.geometryObbInRenderSR).intersectRay(l,t,r)||this._collection.intersect(B,l,u,r,E,(G,H,L,C)=>{if(!(0>H||null!=n&&!n(l,u,H))){var z=J=>{const K=new c.I3sTarget(this.layerUid,this.sublayerUid,A.index,G,C);J.set(this.type,K,H,L)};this.isGround&&(null==v.ground.dist||H<v.ground.dist)&&z(v.ground);if(!e.options.isFiltered&&((null==v.min.dist||H<v.min.dist)&&z(v.min),(null==v.max.dist||H>v.max.dist)&&z(v.max),p)){const J=k.newIntersectorResult(e.ray);
z(J);e.results.all.push(J)}}},q);return!0})}}a.I3SIntersectionHandler=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/ReactiveSet ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../rest/support/meshFeatureSet ../../../../support/featureFlags ../../../../support/requestUtils ../FeatureLayerView3D".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E){a.I3SOverrides=class extends c{constructor(B){super(B);this._warnMaximumChangedObjectsExceeded=!1;this._maximumNumberOfEditOVerrides=5E4;this._original3DOFLDefinitionExpression=null;this._interactiveEditingSessions=new f;this.geometryOverrides=new f;this._clientGeometryCache=new Map;this._associatedLayerView=null;this._attributeChangedObjectIds=new u;this._geometryChangedObjectIds=new u;this._pendingFetchChangedObjectIds=null;this._pendingFetchAbortController=
new AbortController;this._featureIdLocks=new Map}initialize(){this._memCache=this.memoryController.newCache(`i3s-attribute-overrides-${this.layer.uid}`);this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.finally(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&null!=this._associatedLayer&&(y.direct3DObjectFeatureLayerDisplayEnabled()?this._associatedLayer.load().then(B=>
{this.destroyed||(this._original3DOFLDefinitionExpression=B.definitionExpression,this.addHandles(x.watch(()=>this._definitionExpression,F=>B.definitionExpression=F,x.initial)),this._associatedLayerView=new E({layer:this._associatedLayer,view:this.view}))}):y.i3sPatchingEnabled())}destroy(){this.is3DOFL&&null!=this._associatedLayer&&(y.direct3DObjectFeatureLayerDisplayEnabled()?null!=this._associatedLayerView&&(this._associatedLayer.definitionExpression=this._original3DOFLDefinitionExpression):y.i3sPatchingEnabled());
this._set("layer",null);this._memCache=n.destroyMaybe(this._memCache);this._pendingFetchAbortController=n.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null;this._featureIdLocks.clear()}get is3DOFL(){return y.sceneLayerEditingEnabled()&&null!=this._associatedLayer?.infoFor3D}get sortedGeometryChangedObjectIds(){return this.is3DOFL?[...this._geometryChangedObjectIds].sort((B,F)=>B-F):[]}get _associatedLayer(){return null==this.layer?null:this.layer.associatedLayer}get hasGeometryChanges(){return 0<
this._geometryChangedObjectIds.size}get _definitionExpression(){const B=this.sortedGeometryChangedObjectIds;return 0===B.length?"1 \x3d 0":`OBJECTID IN (${B.join(",")})`}get updating(){return this.is3DOFL?this._pendingFetchChangedObjectIds?!0:y.direct3DObjectFeatureLayerDisplayEnabled()?null==this._associatedLayerView||null!=this._associatedLayerView&&this._associatedLayerView.updating:!1:!1}get isEmpty(){return null==this._pendingFetchChangedObjectIds&&0===this._attributeChangedObjectIds.size&&0===
this._geometryChangedObjectIds.size}featureHasGeometryChanges(B){return this._geometryChangedObjectIds.has(B)}featureHasAttributeChanges(B){return this._attributeChangedObjectIds.has(B)}createInteractiveEditSession(B){this._attributeChangedObjectIds.add(B);const F=this._interactiveEditingSessions,G=new A(B,()=>{F.remove(G)});F.unshift(G);return G}async applyAttributeOverrides(B,F,G,H=[]){this._pendingFetchChangedObjectIds&&await l.whenOrAbort(this._pendingFetchChangedObjectIds,G);if(null!=F){var {attributeData:L,
loadedAttributes:C}=F;if(null!=C&&null!=L&&0!==this._attributeChangedObjectIds.size){F=new Set;for(var z of C)F.add(z.index);for(const K of H)F.has(K.index)||(C.push(K),L[K.name]=Array(B.length));H=await this._lockFeatureIds(B);try{z={attributeData:L,loadedAttributes:C};const K=this._getOverridesFromCache(B,z,this._attributeChangedObjectIds),{objectIds:I,fieldNames:M}=K;if(0!==I.length&&0!==M.length){var J=await this._queryAttributeOverridesFromAssociatedLayer(I,M,G);null!=J&&this._processOverridesFromAssociatedLayer(B,
J,M,z)}}finally{H.remove()}}}}updateGeometry(B,F){this._geometryChangedObjectIds.add(B);const G=this._clientGeometryCache.get(B);null!=G&&(this.geometryOverrides.remove(G),this._clientGeometryCache.delete(B));null!=F&&(F={oid:B,mesh:F},this.geometryOverrides.add(F),this._clientGeometryCache.set(B,F))}updateAttributeValue(B,F,G){this._attributeChangedObjectIds.add(B);this._cacheAttributeValue(B,F,G)}featureAdded(B){this.is3DOFL&&y.i3sPatchingEnabled()&&this._geometryChangedObjectIds.add(B);this._attributeChangedObjectIds.add(B)}_cacheAttributeValue(B,
F,G){this._memCache.put(this._getAttributeCacheKey(B,F),G,this._memCacheAttributeValueSize(G))}_getOverridesFromCache(B,{loadedAttributes:F,attributeData:G},H){const L=new Set,C=[];for(var z of F)C[z.index]=G[z.name];G=new Set;for(z=0;z<B.length;z++){const J=B[z];if(H.has(J))for(const K of F){const I=this._attributeFromCache(J,K.index);void 0!==I?C[K.index][z]=I:(L.add(J),G.add(K.name))}}return{objectIds:Array.from(L),fieldNames:Array.from(G)}}_attributeFromCache(B,F){const G=this._fromInteractiveEditingSession(B,
F);if(void 0!==G)return G;B=this._getAttributeCacheKey(B,F);return this._memCache.get(B)}_fromInteractiveEditingSession(B,F){if(null!=this._interactiveEditingSessions)for(const G of this._interactiveEditingSessions){if(G.objectId!==B)continue;const H=G.getAttribute(F);if(void 0!==H)return H}}_getAttributeCacheKey(B,F){return`${B}-${F}`}async _queryAttributeOverridesFromAssociatedLayer(B,F,G){if(0===B.length)return null;this._logWarningIfMaximumObjectsExceeded();const {associatedLayer:H}=this.layer;
if(null==H)return null;const L=H.createQuery(),{objectIdField:C}=H;F=[C,...F];L.where="1\x3d1";L.returnGeometry=!1;L.outFields=F;L.cacheHint=!0;B=await this._executeBatchQuery(H,B,L,G);G=[];for(const z of B)if(z.ok)for(const J of z.value.features)G.push(J);return G}async _queryGeometryOverridesFromAssociatedLayer(B,F){if(0===B.length||!this.is3DOFL||!y.i3sPatchingEnabled())return null;this._logWarningIfMaximumObjectsExceeded();var G=this.layer.associatedLayer;const {objectIdField:H,globalIdField:L}=
G;var C=[H,...(null!=L?[L]:[])],z=G.createQuery();z.where="1\x3d1";z.returnGeometry=!0;z.outFields=C;z.cacheHint=!0;z.returnZ=G.hasZ;z.returnM=G.hasM;C=await this._executeBatchQuery(G,B,z,F);B=G.infoFor3D;({spatialReference:G}=G);F=[];for(const J of C){if(!J.ok)continue;const {assetMaps:K,features:I,globalIdFieldName:M}=J.value;if(null!=K){C=r.assetMapFromAssetMapsJSON(B,K);for(const S of I){z=r.extractMesh(S,M,G,B,C);const N=S;null!=z?(N.geometry=z,F.push(N)):N.geometry=null}}}return F}_logWarningIfMaximumObjectsExceeded(){if(this._warnMaximumChangedObjectsExceeded){this._warnMaximumChangedObjectsExceeded=
!1;var B=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${p.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`,F=this.layer.portalItem;B=F&&F.loaded?B+` (${F.portal.url}/home/item.html?id=${F.id}#settings)`:B+` (${this.layer.parsedUrl.path})`;e.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,
`${B}.`)}}async _executeBatchQuery(B,F,G,H){if(0===F.length)return[];const L=t.getMaximumQuerySize(B);F=[...F].sort((C,z)=>C-z);F=k.splitIntoChunks(F,L).map(C=>{const z=G.clone();z.objectIds=C;return m.resultOrAbort(t.queryAllJSON(B,z,{signal:H}))});return Promise.all(F)}_processOverridesFromAssociatedLayer(B,F,G,{loadedAttributes:H,attributeData:L}){var C=this._associatedLayer;if(null!=C){C=C.objectIdField;var z=G.map(I=>{I in L||(L[I]=Array(B.length));return L[I]}),J=new Map(H.map(I=>[I.name,I.index]));
H=G.map(I=>J.get(I));var K=new Map(Array.from(B,(I,M)=>[I,M]));for(const I of F){F=I.attributes[C];for(let M=0;M<G.length;M++){const S=H[M],N=K.get(F),V=I.attributes[G[M]];z[M][N]=V;this._cacheAttributeValue(F,S,V)}}}}_memCacheAttributeValueSize(B){return"string"===typeof B?d.estimateStringByteSize(B):d.estimateNumberByteSize()}async _fetchChangedObjectIds(B){var F=this.layer;await F.load({signal:B});this._geometryChangedObjectIds.clear();this._attributeChangedObjectIds.clear();({associatedLayer:F}=
F);if(null!=F&&F.capabilities?.operations?.supportsChangeTracking){var G=this._getFetchChangedObjectIdsServerGen();if(null!=G){var H=F.layerId,L=this.is3DOFL;G={f:"json",returnIdsOnly:!0,layers:`[${H}]`,returnUpdates:!0,returnDeletes:L,returnInserts:L,layerServerGens:JSON.stringify([{id:H,serverGen:G}])};L&&(H=F.infoFor3D,G.fieldsToCompare=JSON.stringify({fields:[...Object.values(H.transformFieldRoles),H.sourceHashField]}));G=await m.result(h(`${F.url}/extractChanges`,{method:"post",query:G,timeout:1E4,
signal:B}));!G.ok&&D.isTimeoutError(G.error)&&(H=this.layer.title,e.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("extractChanges:timeout",H,`${H} could not obtain edited features that are not cached in the scene service. Display of features may not be up to date with the latest edits. Consider re-caching the scene service.`));if(G.ok&&1===G.value.data?.edits?.length){H=G.value.data.edits[0];G=H?.objectIds;var C=G?.adds??[];const z=G?.updates??[],J=G?.deletes??[];G=[...C,...z,...J];L=L?
[...C,...(H?.fieldUpdates??z),...J]:[];H=Math.min(this._maximumNumberOfEditOVerrides,G.length);H<G.length&&(this._warnMaximumChangedObjectsExceeded=!0);G=G.sort((K,I)=>K-I);for(C=0;C<H;++C)this._attributeChangedObjectIds.add(G[C]);for(const K of L)this._geometryChangedObjectIds.add(K);if(this.is3DOFL&&y.i3sPatchingEnabled()&&0<this._geometryChangedObjectIds.size&&(B=await this._queryGeometryOverridesFromAssociatedLayer(Array.from(this._geometryChangedObjectIds),B),null!=B))for(const K of B)null!=
K.geometry&&this.updateGeometry(K.attributes[F.objectIdField],K.geometry)}}}}_getFetchChangedObjectIdsServerGen(){var B=this.layer;if(null!=B.serviceUpdateTimeStamp?.lastUpdate)return B.serviceUpdateTimeStamp.lastUpdate;B=B.associatedLayer;return null!=B?.serverGens?.minServerGen?B.serverGens.minServerGen:null}async _lockFeatureIds(B){const F=this._featureIdLocks;for(var G=!0;G;){const L=[];for(const C of B){const z=F.get(C);z&&L.push(z)}0===L.length?G=!1:await Promise.all(L)}const H=l.createResolver();
G=H.promise;for(const L of B)F.set(L,G);return g.makeHandle(()=>{for(const L of B)F.delete(L);H.resolve()})}get test(){const B=this;return{changedObjectIds:Array.from(this._attributeChangedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return B._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(F){B._maximumNumberOfEditOVerrides=F}}}};b.__decorate([w.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);b.__decorate([w.property({constructOnly:!0})],
a.I3SOverrides.prototype,"layer",void 0);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"_interactiveEditingSessions",void 0);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,"sortedGeometryChangedObjectIds",null);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryOverrides",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_clientGeometryCache",void 0);b.__decorate([w.property()],
a.I3SOverrides.prototype,"_associatedLayer",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);b.__decorate([w.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_attributeChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_geometryChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"hasGeometryChanges",null);b.__decorate([w.property()],
a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_pendingFetchAbortController",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_definitionExpression",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"updating",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=b.__decorate([v.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);class A{constructor(B,F){this.objectId=
B;this._remove=F;this._updates=new Map;this._isActive=!0}getAttribute(B){return this._updates.get(B)}setAttribute(B,F){this.isActive&&this._updates.set(B,F)}remove(){this.isActive&&(this._isActive=!1,this._remove())}get isActive(){return this._isActive}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureSet":function(){define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../geometry/Extent ../../geometry/Mesh ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/MeshGeoreferencedVertexSpace ../../geometry/support/MeshLocalVertexSpace ../../geometry/support/MeshTransform ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w){function q(E){return({attributes:A})=>{if(!A)return{};if(!E)return A;for(const B in A)E.has(B)||delete A[B];return A}}function v(E,A,B,F,G){G=G.get(E.attributes[A]);if(null==G)return y().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",E),null;if(!E.geometry)return y().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",E),null;const {originPoint:H,originVector:L}=p(E,B,
F);A=m.fromJSON(E.geometry);A.spatialReference=B;E=t(E.attributes,F);B=G.projectVertices?new e({origin:L}):new n({origin:L});a:{G=Array.from(G.files.values());F=[];for(C of G){if(C.status!==D.COMPLETED){var C=null;break a}G=[];for(const z of C.parts){if(!z){C=null;break a}G.push(new u.ServiceAssetPart(z.url,z.hash))}F.push(new u.ServiceAsset(C.name,C.mimeType,G))}C=F}return C?d.createWithExternalSource(H,C,{extent:A,transform:E,vertexSpace:B}):d.createIncomplete(H,{extent:A,transform:E,vertexSpace:B})}
function p({attributes:E},A,{transformFieldRoles:B}){const F=E[B.originX],G=E[B.originY];E=E[B.originZ];return{originPoint:new f({x:F,y:G,z:E,spatialReference:A}),originVector:k.fromValues(F,G,E)}}function t(E,{transformFieldRoles:A}){return new l({translation:[E[A.translationX],-E[A.translationZ],E[A.translationY]],rotationAxis:[E[A.rotationX],-E[A.rotationZ],E[A.rotationY]],rotationAngle:E[A.rotationDeg],scale:[E[A.scaleX],E[A.scaleZ],E[A.scaleY]]})}function r(E,A){const B=new Map;for(const G of A){var F=
G.parentGlobalId;if(null==F)continue;const H=G.assetName,L=G.assetType;A=G.assetHash;const C=G.assetURL,z=G.conversionStatus,J=G.seqNo,K=x.getFormatIdMimeType(L,E.supportedFormats);K?(F=c.getOrCreateMapValue(B,F,()=>({projectVertices:G.flags.includes("PROJECT_VERTICES"),files:new Map})),c.getOrCreateMapValue(F.files,H,()=>{a:switch(z){case "COMPLETED":case "SUBMITTED":var I=D.COMPLETED;break a;case "INPROGRESS":I=D.PENDING;break a;default:I=D.FAILED}return{name:H,type:L,mimeType:K,status:I,parts:[]}}).parts[J]=
{hash:A,url:C}):y().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${L}, but it does not list it as a supported type`)}return B}const y=()=>h.getLogger("esri.rest.support.meshFeatureSet");var D;(function(E){E[E.FAILED=0]="FAILED";E[E.PENDING=1]="PENDING";E[E.COMPLETED=2]="COMPLETED"})(D||={});a.assetMapFromAssetMapsJSON=r;a.extractMesh=v;a.meshFeatureSetFromJSON=function(E,A,B){var F=B.features;B.features=[];delete B.geometryType;const G=w.fromJSON(B);G.geometryType="mesh";
if(!B.assetMaps)return G;const H=r(A,B.assetMaps),L=E.sourceSpatialReference??g.WGS84;B=B.globalIdFieldName;({outFields:E}=E);E=null!=E&&0<E.length?q(E.includes("*")?null:new Set(E)):()=>({});for(const C of F)F=v(C,B,L,A,H),null!=F&&G.features.push(new b({geometry:F,attributes:E(C)}));return G};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../core/ByteSizeUnit","../../../../core/Error","../../../../core/promiseUtils"],
function(a,b,h,c){function k(f){return new Promise((g,e)=>{f.oncomplete=()=>g();f.onerror=()=>e(f.error);f.onabort=()=>e(f.error)})}function m(f){return new Promise((g,e)=>{"done"===f.readyState?null!=f.error?e(f.error):g(f.result):(f.onsuccess=()=>g(f.result),f.onerror=()=>e(f.error))})}class d{constructor(f,g,e=14){this._version=e;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=b.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=
.2;this._dbName=f;this._storeName=g}init(){return Promise.resolve().then(()=>{const f=indexedDB.open(this._dbName,this._version);f.onupgradeneeded=g=>{var e=f.result;const n=f.transaction,l=e.objectStoreNames.contains(this._storeName)?n.objectStore(this._storeName):e.createObjectStore(this._storeName);e=e.objectStoreNames.contains("last_access")?n.objectStore("last_access"):e.createObjectStore("last_access");e.indexNames.contains("date")||e.createIndex("date","date",{unique:!1});e.indexNames.contains("byteSize")||
e.createIndex("byteSize","byteSize",{unique:!1});g.oldVersion<this._version&&(l.clear(),e.clear())};return m(f)}).then(f=>{this._destroyed?f.close():this._db=f})}destroy(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0}get initialized(){return null!=this._db}getHitRate(){return this._hit/(this._hit+this._miss)}put(f,g){return null==this._db?Promise.reject(new h("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:
Promise.resolve()).then(()=>this._put(f,g)).catch(e=>{if(e&&"QuotaExceededError"===e.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(n=>this._removeLeastRecentlyAccessed(g.byteSize+Math.ceil(n*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(f,g));throw e;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=
this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(e=>this._removeLeastRecentlyAccessed(e-this.maxByteSize)))})}get(f,g){const e=this._db;if(null==e)return Promise.resolve(void 0);let n=null;return Promise.resolve().then(()=>{const l=e.transaction(this._storeName,"readonly");n=c.onAbort(g,()=>{l.abort()});const u=l.objectStore(this._storeName).get(f);return m(u)}).then(l=>{null==l?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:l.byteSize},f));null!=n&&n.remove();return l}).catch(()=>{++this._miss;c.throwIfAborted(g);null!=n&&n.remove()})}remove(f){const g=this._db;return null==g?Promise.resolve():Promise.resolve().then(async()=>{const e=g.transaction([this._storeName,"last_access"],"readwrite");var n=e.objectStore(this._storeName),l=e.objectStore("last_access");n=n.delete(f);l=l.delete(f);await Promise.all([m(n),m(l),k(e)])})}_put(f,g){var e=this._db;if(null==e)return Promise.resolve();e=e.transaction([this._storeName,
"last_access"],"readwrite");var n=e.objectStore(this._storeName);const l=e.objectStore("last_access");n=n.put(g,f);f=l.put({date:Date.now(),byteSize:g.byteSize},f);return Promise.all([m(n),m(f),k(e)])}_removeLeastRecentlyAccessed(f){if(0>=f||!this._db)return Promise.resolve();const g=this._db.transaction([this._storeName,"last_access"],"readwrite"),e=g.objectStore(this._storeName),n=g.objectStore("last_access");let l=0;const u=n.index("date").openCursor(null,"next");u.onsuccess=()=>{const x=u.result;
null!=x&&(null!=x.value.byteSize&&(l+=x.value.byteSize),e.delete(x.primaryKey),n.delete(x.primaryKey),l<f&&x.continue())};return k(g)}_getCacheSize(){var f=this._db;if(null==f)return Promise.resolve(0);f=f.transaction("last_access");let g=0;const e=f.objectStore("last_access").index("byteSize").openKeyCursor();e.onsuccess=()=>{const n=e.result;if(n){var l=n.key;null!=l&&(g+=l);n.continue()}};return k(f).then(()=>g)}}a.IDBCache=d;a.whenRequest=m;a.whenTransaction=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports"],function(a){const b=new WeakMap;class h{constructor(c,k){this._hit=this._miss=0;this.initialized=!0;switch(k){case "layer":this._data=new Map;break;case "view":(k=b.get(c))?this._data=k:(this._data=k=new Map,b.set(c,k))}}init(){return Promise.resolve()}async get(c,k){if(this._data.has(c))return this._hit++,this._data.get(c)??void 0;this._miss++}destroy(){}put(c,k){this._data.set(c,k);return Promise.resolve()}remove(c){this._data.delete(c);
return Promise.resolve()}getHitRate(){return this._hit/(this._hit+this._miss)}}a.IDBMockCache=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../support/ElevationRange ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r){a.LayerElevationProvider=class extends c.EventedMixin(h){constructor(F){super(F);this._tmpEvent=new p.ElevationUpdateEvent;this._renderCoordsHelper=F.view.renderCoordsHelper;this._renderSR=this._renderCoordsHelper.spatialReference;this._layerElevationSource=F.layerElevationSource}initialize(){this._intersector=t.newIntersector(this.view.state.viewingMode);this._intersector.options.store=r.StoreResults.MIN;this._tmpEvent.context=this.intersectionHandler.isGround?
"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(F,G,H,L){const C=this._renderCoordsHelper;F=l.set(E,F,G,H);if(!C.toRenderCoords(F,L,F))return k.getLogger(this).error("could not project point to compute elevation"),null;const {layerElevationSource:z,_intersector:J,intersectionHandler:K}=this;L=z.fullExtent;G=null!=L&&Number.isFinite(L.xmin)&&Number.isFinite(L.xmax)&&Number.isFinite(L.ymin)&&Number.isFinite(L.ymax)&&Number.isFinite(L.zmin)&&
Number.isFinite(L.zmax)?new v.ElevationRange(L.zmin,L.zmax):z.elevationRange;if(null==G)return null;H=z.elevationOffset;L=G.elevationRangeMin+H;G=C.setAltitude(A,G.elevationRangeMax+H,F);L=C.setAltitude(B,L,F);J.reset(G,L,null);K.intersect(J,null,G,L,null,!0);return J.results.min.getIntersectionPoint(F)?C.getAltitude(F):null}getSphereElevationBounds(F,G){x.projectBoundingSphere(F,G,D,this._renderSR);return this._layerElevationSource.getElevationRange(D)}getRootElevationBounds(){const F=this.layerElevationSource.fullExtent;
return F?.hasZ?new v.ElevationRange(F.zmin,F.zmax):null}objectsChanged(F){this.spatialReference&&(this._computeLayerExtent(F,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(F){this.spatialReference&&(this._computeObjectExtent(F,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(F,G){w.empty(G);this._expandExtent(F,G)}_computeLayerExtent(F,
G){w.empty(G);for(const H of F)this._expandExtent(H,G)}_expandExtent(F,G){const H=this.spatialReference;if(null!=H&&null!=F){e.fromQuat(y,F.quaternion);y[12]=F.center[0];y[13]=F.center[1];y[14]=F.center[2];F=F.halfSize;for(let L=0;8>L;++L)E[0]=L&1?F[0]:-F[0],E[1]=L&2?F[1]:-F[1],E[2]=L&4?F[2]:-F[2],l.transformMat4(E,E,y),this._renderCoordsHelper.fromRenderCoords(E,E,H),w.expand(G,E,G)}}};b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"layerElevationSource",void 0);
b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"intersectionHandler",void 0);b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"view",void 0);b.__decorate([m.property()],a.LayerElevationProvider.prototype,"spatialReference",null);a.LayerElevationProvider=b.__decorate([g.subclass("esri.views.3d.layers.i3s.LayerElevationProvider")],a.LayerElevationProvider);const y=n.create(),D=q.fromValues(0,0,0,0),E=u.create(),A=u.create(),B=u.create();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/featureEditing":function(){define(["exports","../../../../core/asyncUtils","../../../../core/lang","../../../../layers/support/featureQueryAll"],function(a,b,h,c){function k(u,x,w,q,v=null,p=!0){const t=[];u={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==w,fieldsIndex:u.fieldsIndex,objectIdField:u.objectIdField,globalIdField:u.globalIdField,featureOrIdentifierList:w};for(const E of x)if(null==
E.error){x=E.objectId??-1;w=E.globalId;if(-1===x||p){var r=x;var y=w,D=u;const {gidToFeatureInfo:A,oidToFeatureInfo:B,fieldsIndex:F,objectIdField:G,globalIdField:H,featureOrIdentifierList:L}=D;if(!D.featuresResolved&&null!=L){for(const C of L){const z={feature:null,oid:-1,gid:null};if("attributes"in C){z.feature=C;const J=C.attributes;if(null!=J)for(const K in J){if(-1!==z.oid&&null!=z.gid)break;const I=F.normalizeFieldName(K);I===G&&(z.oid=J[K]??-1);I===H&&(z.gid=J[K])}}else z.oid=C.objectId??-1,
z.gid=C.globalId;null!=z.gid&&A.set(z.gid,z);-1!==z.oid&&B.set(z.oid,z)}D.featuresResolved=!0}r=(-1!==r?B.get(r):null)??(null!=y?A.get(y):null)}else r=null;r=r??{feature:null,oid:x,gid:w};x={oid:-1===x?r.oid:x,gid:w??r.gid,feature:r.feature,result:E};t.push(x);-1===x.oid&&null!=x.gid&&null!=v&&(x.oid=v.get(x.gid)??-1);-1===x.oid&&null!=x.gid&&(w=q.get(x.gid),null==w&&(w=[],q.set(x.gid,w)),w.push(x))}return t}async function m(u,x){u=u.i3sOverrides.layer.associatedLayer;if(null!=u?.globalIdField){var w=
u.createQuery(),{objectIdField:q,globalIdField:v}=u;w.where=Array.from(x.keys()).map(p=>`${v}='${p}'`).join(" OR ");w.returnGeometry=!1;w.outFields=[q,v];w.cacheHint=!1;u=await b.resultOrAbort(c.queryAllJSON(u,w));if(u.ok){u=u.value.features;for(const p of u)if(w=p.attributes[v],u=p.attributes[q],null!=w&&null!=u&&-1!==u&&(w=x.get(w),null!=w))for(const t of w)t.oid=u}}}function d(u,x){const w=new Map;x=x.adds;if(!x||0===x.length||null==u.globalIdField)return w;for(const q of x)u=q.oid,x=q.feature,
"mesh"===x?.geometry?.type&&w.set(u,x);return w}function f(u,x){const w=x.updates;if(!w||0===w.length)return new l;const q=new l;x=new Map;for(let v=0;v<u.attributeStorageInfo.length;v++)x.set(u.attributeStorageInfo[v].name,v);u.forEachNode((v,p)=>{for(const E of w){if(null==E.feature)continue;const A=E.feature,B=E.oid,F=p.indexOf(B);for(const G in A.attributes){var t=u.fieldsIndex.normalizeFieldName(G);var r=q;var y=v.index,D=r.get(y);D?r=D:(D=new n,r.set(y,D),r=D);(y=null!=t&&r.get(t))?t=y:(y=[],
r.set(t,y),t=y);t.push({featureIndex:F,featureId:B,value:A.attributes[G]})}}});return q}const g={setAttribute(){},rollback(){},commit(){}};var e;(function(u){u[u.EDITING=0]="EDITING";u[u.ROLLED_BACK=1]="ROLLED_BACK";u[u.COMMITTED=2]="COMMITTED"})(e||={});const n=Map,l=Map;a.createInteractiveEditSession=function(u,x){const w=x.attributes[u.objectIdField];if(null==w)return g;var q=u.sessions.get(w);if(q)return q;const v=h.clone(x.attributes),p=new Set,t=u.i3sOverrides.createInteractiveEditSession(w),
r=new Map;let y=e.EDITING;q={setAttribute(D,E){if(y===e.EDITING){var A=u.fieldsIndex.get(D);if(A){var B=u.attributeStorageInfo.findIndex(H=>H.name===A.name);if(!(0>B)){if(!(D in v))throw Error(`Attribute "${D}" is not an attribute of the edited feature.`);t.setAttribute(B,E);var F=u.attributeStorageInfo[B],G=!1;p.add(D);u.forEachNode((H,L)=>{var C=r.get(H);null==C?(L=L.indexOf(w),r.set(H,L)):L=C;if(-1!==L&&(C=u.getAttributeData(H.index))){const z=C[F.name];z&&(z[L]=E,u.setAttributeData(H.index,C,
x),G=!0)}});G&&u.clearMemCache()}}}},rollback(){if(y===e.EDITING){for(const D of p)this.setAttribute(D,v[D]);t.remove();y=e.ROLLED_BACK;u.sessions.delete(w)}},commit(){y===e.EDITING&&(t.remove(),y=e.COMMITTED,u.sessions.delete(w))}};u.sessions.set(w,q);return q};a.normalizeEditResultsEvent=async function(u,x){const w=new Map,q=k(u,x.addedFeatures,x.edits?.addFeatures,w),v=k(u,x.updatedFeatures,x.edits?.updateFeatures,w);x=k(u,x.deletedFeatures,x.edits?.deleteFeatures,w,x.globalIdToObjectId,!1);0<
w.size&&await m(u,w);return{adds:q.filter(p=>-1!==p.oid),updates:v.filter(p=>-1!==p.oid),deletes:x.filter(p=>-1!==p.oid)}};a.processAttributeEdits=function(u,x){var w=f(u,x);x=d(u,x);if(0!==w.size||0!==x.size){var q=new Map;for(var v=0;v<u.attributeStorageInfo.length;v++)q.set(u.attributeStorageInfo[v].name,v);var p=!1;w.forEach((E,A)=>{const B=u.getAttributeData(A);let F=!1;E.forEach((G,H)=>{const L=null!=B?B[H]:null;H=q.get(H);for(const {featureIndex:C,value:z,featureId:J}of G)L&&(L[C]=z,p=F=!0),
u.i3sOverrides.updateAttributeValue(J,H,z)});F&&u.setAttributeData(A,B,null)});p&&u.clearMemCache();var {fieldsIndex:t,i3sOverrides:r,objectIdField:y,globalIdField:D}=u;w=r.layer.associatedLayer?.infoFor3D;w=new Set(w?[...Object.values(w.assetMapFieldRoles),...Object.values(w.transformFieldRoles)]:[]);for(const [E,A]of x){r.featureAdded(E);({attributes:x}=A);for(const B in x)B!==y&&B!==D&&w.has(B)||(v=t.normalizeFieldName(B),v=null!=v?q.get(v):null,null!=v&&r.updateAttributeValue(E,v,x[B]))}}};a.processGeometryEdits=
function(u,x){const w=new Map;var q=x.adds,v=x.updates;x=x.deletes;if(0<q.length)for(var p of q){q=p.oid;const t=p.feature;"mesh"===t?.geometry?.type&&w.set(q,t.geometry)}if(0<v.length)for(const t of v)v=t.oid,p=t.feature,"mesh"===p?.geometry?.type&&w.set(v,p.geometry);if(0<x.length)for(const t of x)w.set(t.oid,null);for(const [t,r]of w)u.i3sOverrides.updateGeometry(t,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/sql/WhereClause ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z){function J(R,ba,X){if(null==ba)return null;if("disjoint"===X&&"polygon"===ba.type){X=ba.rings.length;const da=ba.spatialReference,ha=Array(X);for(let Z=0;Z<X;++Z){const ea=E.fromValues(Infinity,Infinity,-Infinity,-Infinity);E.expandWithNestedArray(ea,ba.rings[Z]);ha[Z]={type:"polygon",rings:[ba.rings[Z]],spatialReference:da,cache:{},aabr:ea}}ha.sort((Z,ea)=>Z.aabr[0]-ea.aabr[0]);const fa=new Set,aa=new m.PositionHint;for(ba=0;ba<
ha.length;++ba){const Z=ha[ba],ea=Z.aabr[0];fa.forEach(ca=>{ea>=ca.aabr[2]?fa.delete(ca):Z.aabr[1]>ca.aabr[3]||Z.aabr[3]<ca.aabr[1]||!R.intersects(Z,ca)||(Z.rings=Z.rings.concat(ca.rings),E.expand(Z.aabr,ca.aabr,Z.aabr),Z.cache={},fa.delete(ca),ca=m.indexOf(ha,ca,ha.length,aa),ha.splice(ca,1))});fa.add(Z)}for(const Z of ha)Z.aabr=void 0;return ha}return[ba]}function K(R,ba,X,da,ha){if(ba[3]>=.5*(ba[2]+p.getReferenceEllipsoid(da).radius))return!0;const fa=S(R,ba,da);return X.every(aa=>N(R,aa,fa,ha)!==
O.DISCARD)}function I(R,ba,X,da,ha,fa,aa,Z){const ea=aa[0].spatialReference||ha.spatialReference;if(r.projectBoundingSphere(X.node.serviceMbsInIndexSR,fa,U,ea)){fa=S(R,U,ea);var ca=M(Z,ha,ea,da,X.objectHandle);for(const W of aa){if(0===ba.length)break;switch(N(R,W,fa,Z)){case O.DISCARD:ba.length=0;return;case O.KEEP:continue}C.filterInPlace(ba,X.featureIds,Y=>T(R,W,Y,ca))}}else d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}
function M(R,ba,X,da,ha){ba=ba.renderSpatialReference;const fa=new Map,aa={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:X};aa.rings[0][3]=aa.rings[0][0];let Z,ea;switch(R){case "intersects":Z=(ca,W,Y)=>ca.intersects(W,Y)?O.KEEP:O.TEST;ea=V;break;case "contains":Z=(ca,W,Y)=>ca.contains(W,Y)?O.TEST:O.DISCARD;ea=V;break;default:Z=(ca,W,Y)=>ca.disjoint(W,Y)?O.TEST:O.DISCARD,ea=Q}return{collection:da,object:ha,type:R,maskSR:X,renderSR:ba,aabbCache:fa,triangle:aa,positions:{indices:null,
data:null,stride:0,startIndex:0,endIndex:0},triangleTest:Z,geometryTest:ea}}function S(R,ba,X){const da={type:"point",x:ba[0],y:ba[1],hasZ:!1,hasM:!1,spatialReference:X};X=!F.isWGS84(X)&&!F.isWebMercator(X);ba=Number.isNaN(ba[3])?0:f.clamp(ba[3],0,2*B.earth.radius);R=X?R.buffer(da,ba,1):R.geodesicBuffer(da,ba,1);R.type="polygon";return R}function N(R,ba,X,da){switch(da){case "intersects":case "contains":return V(R,ba,X);case "disjoint":return Q(R,ba,X)}}function V(R,ba,X){return R.intersects(ba,X)?
R.contains(ba,X)?O.KEEP:O.TEST:O.DISCARD}function Q(R,ba,X){return R.intersects(ba,X)?R.contains(ba,X)?O.DISCARD:O.TEST:O.KEEP}function T(R,ba,X,da){const {collection:ha,object:fa,renderSR:aa,maskSR:Z,geometryTest:ea,aabbCache:ca}=da;var W=ca.get(X);if(!W){W=ha.getObjectTransform(fa);ha.getComponentAabb(fa,X,P);var Y=[q.fromValues(P[0],P[1],0),q.fromValues(P[0],P[4],0),q.fromValues(P[3],P[4],0),q.fromValues(P[3],P[1],0)];for(var ja=0;4>ja;++ja)w.transformMat3(Y[ja],Y[ja],W.rotationScale),w.add(Y[ja],
Y[ja],W.position),y.projectVectorToVector(Y[ja],aa,Y[ja],Z);W={type:"polygon",rings:[Y],spatialReference:Z,cache:{}};W.rings[0][4]=W.rings[0][0];ca.set(X,W)}switch(ea(R,ba,W)){case O.DISCARD:return!1;case O.KEEP:return!0}const {triangle:oa,triangleTest:ra,positions:ta}=da;W=oa.rings[0][0];Y=oa.rings[0][1];ja=oa.rings[0][2];const ya=ha.getObjectTransform(fa);ha.getComponentPositions(fa,X,ta);const {indices:Ca,data:pa,stride:wa,startIndex:Ba,endIndex:la}=ta;for(X=Ba;X<la;X+=3){const qa=wa*Ca[X],ua=
wa*Ca[X+1],va=wa*Ca[X+2];w.set(W,pa[qa],pa[qa+1],pa[qa+2]);w.set(Y,pa[ua],pa[ua+1],pa[ua+2]);w.set(ja,pa[va],pa[va+1],pa[va+2]);w.transformMat3(W,W,ya.rotationScale);w.transformMat3(Y,Y,ya.rotationScale);w.transformMat3(ja,ja,ya.rotationScale);w.add(W,W,ya.position);w.add(Y,Y,ya.position);w.add(ja,ja,ya.position);y.projectVectorToVector(W,aa,W,Z);y.projectVectorToVector(Y,aa,Y,Z);y.projectVectorToVector(ja,aa,ja,Z);switch(ra(R,ba,oa)){case O.DISCARD:return!1;case O.KEEP:return!0}}switch(da.type){case "intersects":return!1;
default:return!0}}b.I3SMeshViewFilter=class extends k{constructor(R){super(R);this._projectionEngineLoaded=!1}initialize(){e.whenOnce(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule((new Promise((R,ba)=>a(["../../../../geometry/geometryEngine"],R,ba))).then(R=>{this.destroyed||(this._geometryEngine=R)})))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const R=A.doubleArrayFrom(this.viewFilter.objectIds);R.sort();return R}get parsedWhereClause(){const R=
this.viewFilter?.where;if(null==R||!R)return null;try{return v.WhereClause.create(R,this.layerFieldsIndex)}catch(ba){d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Failed to parse filter where clause: ${ba}`)}return null}addFilters(R,ba,X,da){const ha=this.sortedObjectIds;null!=ha&&R.push(ea=>C.objectIdFilter(ha,!0,ea));this.addSqlFilter(R,this.parsedWhereClause);this.addTimeFilter(R,this.viewFilter?.timeExtent);const fa=g.unwrapUpdating(this._layerMaskGeometries),aa=this._geometryEngine;
if(null!=fa&&null!=this.layerFilter&&null!=aa){const ea=this.layerFilter.spatialRelationship;R.push((ca,W)=>I(aa,ca,W,da,ba,X,fa,ea))}const Z=g.unwrapUpdating(this._viewMaskGeometries);if(null!=Z&&null!=this.viewFilter&&null!=aa){const ea=this.viewFilter.spatialRelationship;R.push((ca,W)=>I(aa,ca,W,da,ba,X,Z,ea))}}isMBSGeometryVisible(R,ba,X){var da=g.unwrapUpdating(this._layerMaskGeometries);const ha=this._geometryEngine;if(null!=da&&null!=this.layerFilter&&null!=ha){var fa=this.layerFilter.spatialRelationship;
ba=da[0].spatialReference||ba;return r.projectBoundingSphere(R,X,U,ba)?K(ha,U,da,ba,fa):(d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}da=g.unwrapUpdating(this._viewMaskGeometries);return null!=da&&null!=this.viewFilter&&null!=ha?(fa=this.viewFilter.spatialRelationship,ba=da[0].spatialReference||ba,r.projectBoundingSphere(R,X,U,ba)?K(ha,U,da,ba,fa):(d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),
!0)):!0}get parsedGeometry(){const R=g.unwrapUpdating(this._viewMaskGeometries),ba=g.unwrapUpdating(this._layerMaskGeometries);return null==R||null==ba?R||ba:ba.concat(R)}get _layerMaskGeometries(){const R=this.layerFilter;return null==R?null:null==this._geometryEngine?g.updating:"disjoint"===R.spatialRelationship?R.geometries.map(ba=>({type:"polygon",rings:ba.rings,spatialReference:ba.spatialReference,cache:{}})):[R.geometries.reduce((ba,X)=>{ba.rings=[...ba.rings,...X.rings];return ba},{type:"polygon",
rings:[],spatialReference:R.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;var {geometry:R}=this.viewFilter;if(null==R)return null;if(null==this.viewFilter||null==this._geometryEngine)return g.updating;const {distance:ba,units:X}=this.viewFilter,da=this.viewFilter.spatialRelationship;R="mesh"===R.type?R.extent:R;if(null==ba||0===ba)return J(this._geometryEngine,R,da);const ha=X||n.getUnitString(R.spatialReference);if(R.spatialReference.isWGS84)return R=
this._geometryEngine.geodesicBuffer(R,ba,ha),J(this._geometryEngine,R,da);var fa=H.project(R,z.WGS84);if(null!=fa)return R=H.project(this._geometryEngine.geodesicBuffer(fa,ba,ha),R.spatialReference),J(this._geometryEngine,R,da);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(t.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;fa=null;try{fa=t.project(R,z.WGS84)}catch(aa){}if(fa)try{fa=t.project(this._geometryEngine.geodesicBuffer(fa,ba,ha),R.spatialReference)}catch(aa){fa=
null}fa||d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${R.spatialReference.wkid}) to WGS84.`);return J(this._geometryEngine,fa,da)}get updating(){return g.isUpdating(this._layerMaskGeometries)||g.isUpdating(this._viewMaskGeometries)}static checkSupport(R){if(null==R)return!1;R=R.spatialRelationship;return null!=R&&ia.includes(R)?!0:(d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warn(`Filters with spatialRelationship other than ${ia.join(", ")} are not supported for mesh scene layers`),
!1)}};h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);h.__decorate([l.property({type:L})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"addTimeFilter",void 0);
h.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);h.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);h.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);h.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);h.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);h.__decorate([l.property()],
b.I3SMeshViewFilter.prototype,"updating",null);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);h.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=h.__decorate([x.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const ia=["contains","intersects","disjoint"];var O;(function(R){R[R.KEEP=0]="KEEP";R[R.DISCARD=1]="DISCARD";R[R.TEST=2]="TEST"})(O||={});const U=G.fromValues(0,0,0,
0),P=D.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q){const v=u.QueryEngine;a.I3SQueryEngine=class extends h{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return(new q({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(p){super(p)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=
k.destroyMaybe(this._dataQueryEngineInstance);this._set("layerView",null)}async executeQueryForCount(p,t){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(p),t)}async executeQueryForExtent(p,t){const {count:r,extent:y}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(p),t);p=n.fromJSON(y);return{count:r,extent:p}}async executeQueryForIds(p,t){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(p),t)}async executeQuery(p,t){p=this._ensureQueryJSON(p);
if(p.returnGeometry)throw new c("unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(p.returnCentroid)throw new c("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");t=await this._dataQueryEngine.executeQuery(p,t);t=w.fromJSON(t);t.features.forEach(r=>{r.geometry=null});return t}_ensureQueryJSON(p){return null==p?this.defaultQueryJSON:p.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const p=this.layer.objectIdField||l.fallbackObjectIDAttribute,t=this.layer.fieldsIndex?.toJSON()||new x([]),r=this.layerView.view.resourceController.scheduler,y=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new v({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:t,timeInfo:null,spatialReference:y,objectIdField:p,featureStore:this.spatialIndex,scheduler:r,priority:this.priority})}};b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",
void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"spatialReference",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"layer",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define(["exports","../../../../geometry/support/aaBoundingBox","../../../../layers/graphics/centroid","../../../../layers/graphics/OptimizedGeometry","./I3SUtil"],function(a,b,h,c,k){class m{constructor(f){this._objectIdField=f.objectIdField;this._getFeatureExtent=f.getFeatureExtent}getObjectId(f){return f.id}getAttributes(f){const {meta:g,index:e}=f,n={};
this._objectIdField&&(n[this._objectIdField]=f.id);f=g.attributeInfo?.attributeData;if(null!=f)for(const l of Object.keys(f))n[l]=k.getCachedAttributeValue(f[l],e);return n}getAttribute(f,g){if(g===this._objectIdField)return f.id;const {meta:e,index:n}=f;f=e.attributeInfo?.attributeData;return null!=f?k.getCachedAttributeValue(f[g],n):null}getGeometry(f){if(f.geometry)return f.geometry;const [g,e,n,l,u]=this._getFeatureExtent(f,d);return new c([5],[g,e,n,l,e,n,l,u,n,g,u,n,g,e,n])}getCentroid(f,g){if(f.geometry)return h.getCentroidOptimizedGeometry(new c,
f.geometry,g.hasZ,g.hasM);const [e,n,l,u,x,w]=this._getFeatureExtent(f,d);return new c([0],[(e+u)/2,(n+x)/2,(l+w)/2])}cloneWithGeometry(f,g){const {id:e,index:n,meta:l}=f;return{id:e,index:n,meta:l,geometry:g}}}const d=b.create();a.I3SQueryFeatureAdapter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x){const w=n.create();a.I3SQueryFeatureStore=class extends h{constructor(t){super(t);this.events=new c}forEach(t){this.forAllFeatures(r=>{t(r);return x.ForAllFeaturesReturnType.CONTINUE})}forEachBounds(t,r){const y=this.getFeatureExtent;for(const D of t)r(y(D,w))}forEachInBounds(t,r){this.forAllFeatures(y=>{const D=this.getFeatureExtent(y,v);l.intersects(t,n.toRect(D,p))&&r(y);return x.ForAllFeaturesReturnType.CONTINUE},y=>{e.projectBoundingSphere(y.node.serviceMbsInIndexSR,
this.sourceSpatialReference,q,this.viewSpatialReference);if(q[0]>=t[0]&&q[2]<=t[2]&&q[1]>=t[1]&&q[3]<=t[3])return x.ForAllFeaturesReturnType.CONTINUE;y=q[0]-Math.max(t[0],Math.min(q[0],t[2]));const D=q[1]-Math.max(t[1],Math.min(q[1],t[3]));return y*y+D*D<=q[3]*q[3]?x.ForAllFeaturesReturnType.CONTINUE:x.ForAllFeaturesReturnType.SKIP})}};b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,
"forAllFeatures",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const q=u.fromValues(0,0,0,
0),v=n.create(),p=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,b,h,c,k,m,d,f,g){a.DefinitionExpressionSceneLayerView=
e=>{e=class extends e{constructor(){super(...arguments);this._definitionExpressionErrors=0;this._maxDefinitionExpressionErrors=20;this.logError=n=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&h.getLogger(this).error("Error while evaluating definitionExpression: "+n);this._definitionExpressionErrors++;this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&h.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;
try{const n=f.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!n.isStandardized)return h.getLogger(this).error("definitionExpression is using non standard function"),null;const l=[];g.findFieldsCaseInsensitive(n.fieldNames,this.i3slayer.fields,{missingFields:l});if(0<l.length)return h.getLogger(this).error(`definitionExpression references unknown fields: ${l.join(", ")}`),null;this._definitionExpressionErrors=0;return n}catch(n){return h.getLogger(this).error("Failed to parse definitionExpression: "+
n),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(n,l){try{return n.testFeature(l)}catch(u){return this.logError(u),!1}}_addDefinitionExpressionToQuery(n){if(!this.parsedDefinitionExpression)return n;const l=this.i3slayer.definitionExpression;n=n.clone();n.where=n.where?`(${l}) AND (${n.where})`:l;return n}};b.__decorate([c.property({readOnly:!0})],e.prototype,"parsedDefinitionExpression",null);b.__decorate([c.property({readOnly:!0})],
e.prototype,"definitionExpressionFields",null);return e=b.__decorate([d.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:h,
layer:{fieldsIndex:c},requiredFields:k}=this;return h.outFields?b.fixFields(c,[...b.unpackFieldNames(c,h.outFields),...k]):b.fixFields(c,k)}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/AsyncUpdate ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,h,c,k,m,d,f,g,e){async function n(l){const u=new Set;try{return await l(u),Array.from(u).sort()}catch(x){return k.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(x),null}}a.SceneLayerViewRequiredFields=class extends c.AsyncUpdateMixin(h){get layer(){return this.layerView.layer}get requiredFields(){const {layerView:{layer:{fieldsIndex:l},definitionExpressionFields:u},rendererFields:x,labelingFields:w,viewFilterFields:q}=this;return e.fixFields(l,[...(u??[]),
...(x??[]),...(w??[]),...(q??[])])}constructor(l){super(l)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:l,renderer:u}=this.layer;return u?n(x=>u.collectRequiredFields(x,l)):null}),this.autoUpdateAsync("labelingFields",async()=>{const {layer:l}=this;return l.labelsVisible?n(u=>e.collectLabelingFields(u,l)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:l,mergedFilter:u}=this.layerView;return n(x=>e.collectFilterFields(x,l,u))})])}};
b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,
"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([g.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/tslib.es6 ./Accessor ./Logger ./promiseUtils ./reactiveUtils ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(a,b,h,c,k,m,d,f){const g=e=>{e=class extends e{constructor(){super(...arguments);
this._numUpdating=0}get updating(){return 0<this._numUpdating}autoUpdateAsync(n,l){const u=k.debounce(async x=>{++this._numUpdating;try{const w=await x;this.destroyed||this._set(n,w)}catch(w){c.getLogger(this).warn(`Async update of "${String(n)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating});return m.watch(l,u,m.initial)}};b.__decorate([d.property({readOnly:!0})],e.prototype,"updating",null);b.__decorate([d.property()],e.prototype,"_numUpdating",void 0);return e=
b.__decorate([f.subclass("esri.core.AsyncUpdate")],e)};a.AsyncUpdate=class extends g(h){};a.AsyncUpdate=b.__decorate([f.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/TemporalSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/data/timeSupport ../../../../layers/support/commonProperties ../../../../layers/support/FeatureFilter ../i3s/I3SUtil".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n){class l{constructor(u){this.attributeData=u}getAttribute(u,x){return n.getCachedAttributeValue(this.attributeData[x],u)}getAttributeAsTimestamp(u,x){u=this.getAttribute(u,x);return"string"===typeof u?(new Date(u)).getTime():"number"===typeof u||null==u?u:null}}a.TemporalSceneLayerView=u=>{u=class extends u{constructor(){super(...arguments);this.timeExtent=null}get mergedFilter(){const {filter:x,timeExtent:w}=this;if(null==w)return x;const q=x?.clone()??new e;null!=
w&&(q.timeExtent=q.timeExtent?.intersection(w)??w);return q}getTimeFilterDependencies(){const {timeInfo:x}=this.i3slayer;if(null==x)return[];const {startField:w,endField:q}=x;return[w,q]}addTimeFilter(x,w){if(null!=w){var {timeInfo:q}=this.i3slayer;if(null!=q){var {startField:v,endField:p,useTime:t}=q;if(t&&(null!=v||null!=p)){var r=q.toJSON(),y=w.toJSON();x.push((D,E)=>this._timeFilter(D,E,r,y))}}}}_timeFilter(x,w,q,v){const p=w.attributeInfo?.attributeData;if(null!=p){var {startTimeField:t,endTimeField:r}=
q;null!=t&&null==p[t]||null!=r&&null==p[r]||(q=f.getTimeOperator(q,v,new l(p)),null!=q&&({featureIds:w}=w,n.filterInPlace(x,w,q)))}}};b.__decorate([h.property(g.combinedViewLayerTimeExtentProperty)],u.prototype,"timeExtent",void 0);b.__decorate([h.property()],u.prototype,"mergedFilter",null);return u=b.__decorate([d.subclass("esri.views.3d.layers.support.TemporalSceneLayerView")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u){e=class extends u{constructor(){super(...arguments);this._geometryEngine=this.filter=this.layer=null;this._projectionEngineLoaded=!1;this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(x){throw Error("Not implemented");}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return m.unwrapUpdating(this._layerFilter)}get _layerFilter(){const x=this.layer?.filter;if(null==
x||1>x.geometries.length)return null;const w=this._geometryEngine;if(null==w||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return m.updating;const q=x.geometries.at(0).spatialReference,v=x.geometries.toArray().map(y=>{try{y=w.simplify(y)}catch(D){return c.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==y)return null;if(y.spatialReference.equals(q))return y;try{return l.project(y,q)}catch(D){return c.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(h.isSome).sort((y,D)=>y.extent.xmin-D.extent.xmin),p=new Set,t=[],r=[];for(let y of v){const D=y.extent.xmin;t.length=0;p.forEach(E=>{D>=E.extent.xmax?(r.push(E),p.delete(E)):y.extent.ymin<=E.extent.ymax&&y.extent.ymax>=E.extent.ymin&&w.intersects(y,E)&&t.push(E)});if(0<t.length){t.push(y);try{y=w.union(t)}catch(E){c.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}t.pop();t.forEach(E=>p.delete(E))}p.add(y)}p.forEach(y=>r.push(y));
return 0<r.length?{spatialRelationship:x.spatialRelationship,geometries:r}:null}get _filterNeedsProjectionEngine(){const x=this.layer.filter;if(null==x||1>=x.geometries.length)return!1;const w=x.geometries.at(0).spatialReference;return x.geometries.some(({spatialReference:q})=>!q.equals(w)&&!l.canProjectWithoutEngine(q,w))}get layerFilterUpdating(){return m.isUpdating(this._layerFilter)}initialize(){const {signal:x}=this._abortController;f.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,
x).then(async()=>{d.throwIfAbortError(x);this._geometryEngine=await new Promise((w,q)=>a(["../../geometry/geometryEngine"],w,q))}).catch(d.throwIfNotAbortError);this._projectionEngineLoaded=l.isLoaded();f.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,x).then(async()=>{d.throwIfAbortError(x);await l.load();this._projectionEngineLoaded=!0}).catch(d.throwIfNotAbortError)}destroy(){this._abortController=k.abortMaybe(this._abortController)}highlight(x){throw Error("Not implemented");
}queryFeatures(x,w){throw Error("Not implemented");}queryObjectIds(x,w){throw Error("Not implemented");}queryFeatureCount(x,w){throw Error("Not implemented");}createQuery(){throw Error("Not implemented");}queryExtent(x,w){throw Error("Not implemented");}};b.__decorate([g.property()],e.prototype,"layer",void 0);b.__decorate([g.property()],e.prototype,"availableFields",null);b.__decorate([g.property()],e.prototype,"maximumNumberOfFeatures",null);b.__decorate([g.property({readOnly:!0})],e.prototype,
"maximumNumberOfFeaturesExceeded",null);b.__decorate([g.property()],e.prototype,"filter",void 0);b.__decorate([g.property({readOnly:!0})],e.prototype,"layerFilter",null);b.__decorate([g.property({readOnly:!0})],e.prototype,"_layerFilter",null);b.__decorate([g.property()],e.prototype,"_geometryEngine",void 0);b.__decorate([g.property()],e.prototype,"_projectionEngineLoaded",void 0);b.__decorate([g.property()],e.prototype,"_filterNeedsProjectionEngine",null);b.__decorate([g.property()],e.prototype,
"layerFilterUpdating",null);return e=b.__decorate([n.subclass("esri.views.layers.SceneLayerView")],e)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectVectorToVector ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/dehydratedPoint ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ../../../support/basemapUtils ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/featureEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/LayerViewPerformanceInfo ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da){function ha(W){return"geometryBuffer"in W&&null!==W.geometryBuffer}function fa(W){const Y=W.attributeInfo,ja=W.node.index;if(null!=Y?.loadedAttributes&&null!=Y.attributeData)for(let oa=0;oa<W.graphics.length;oa++){const ra=W.graphics[oa];if(ra.nodeIndex===ja){ra.attributes||(ra.attributes={});for(const {name:ta}of Y.loadedAttributes)Y.attributeData[ta]&&(ra.attributes[ta]=I.getCachedAttributeValue(Y.attributeData[ta],
oa))}}}e=S.defineFieldProperties();class aa{constructor(W,Y,ja,oa){this.graphics=W;this.featureIds=Y;this.attributeInfo=ja;this.node=oa}}H=class extends T.TemporalSceneLayerView(M.DefinitionExpressionSceneLayerView(V.PopupSceneLayerView(H.LayerView3D(ba)))){constructor(){super(...arguments);this.type="scene-layer-graphics-3d";this._memCache=this._queryEngine=null;this._interactiveEditingSessions=new Map;this._pendingEditsQueue=Promise.resolve();this.loadedGraphics=new J.I3SGraphicsMap((W,Y,ja)=>{{const oa=
Y.attributeInfo;if(null==oa?.loadedAttributes||null==oa.attributeData)W=!1;else{Y=!1;for(const {name:ra}of oa.loadedAttributes)if(oa.attributeData[ra]){const ta=I.getCachedAttributeValue(oa.attributeData[ra],ja);ta!==W.attributes[ra]&&(W.attributes[ra]=ta,Y=!0)}W=Y}}return W},W=>this.processor.graphicsCore.recreateGraphics(W));this.holeFilling="always";this.progressiveLoadFactor=1;this.supportsHeightUnitConversion=!0;this._coordinatesOutsideExtentErrors=0;this._maxCoordinatesOutsideExtentErrors=20}tryRecycleWith(W,
Y){return W.url===this.layer.url&&this._i3sOverrides.isEmpty?W.load(Y).then(()=>{I.checkRecyclable(this.layer,W,this._i3sOverrides);this.layer=W;this._i3sOverrides.destroy();this._i3sOverrides=new K.I3SOverrides({view:this.view,layer:W,memoryController:this.view.resourceController?.memoryController});m.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new K.I3SOverrides({view:this.view,
layer:this.layer,memoryController:this.view.resourceController?.memoryController});I.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new Q.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,W=>this._rangeInfosChanged(W),d.initial);this._updatingHandles.add(()=>this.layer.renderer,(W,Y)=>this._rendererChange(W,Y));this._updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],
()=>this._filterChange());this.addHandles(d.watch(()=>ia.debugFlags.I3S_TREE_SHOW_TILES,W=>{if(W&&!this._treeDebugger){const Y=this._controller.crsIndex;(new Promise((ja,oa)=>a(["./support/I3STreeDebugger"],ja,oa))).then(({I3STreeDebugger:ja})=>{!this._treeDebugger&&ia.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ja({lv:this,view:this.view,nodeSR:Y}))})}else W||!this._treeDebugger||ia.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},d.initial));this._set("processor",
new L.Graphics3DFeatureProcessor({owner:this,preferredUpdatePolicy:R.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:W=>this._updateClippingExtent(W)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",({extent:W,spatialReference:Y})=>this._controller.updateElevationChanged(W,
Y));this.supportsHeightUnitConversion&&(this._verticalScale=p.getGeometryZScaler("point",this.layer.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`);this._controller=new E({layerView:this,scaleVisibilityEnabled:!1});I.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new G.I3SPointsWorkerHandle(W=>this.view.resourceController.immediate.schedule(W)));
this.addHandles(this.layer.on("apply-edits",W=>this._updatingHandles.addPromise(W.result)));this.addHandles(this.layer.on("edits",W=>{const Y=this._pendingEditsQueue.then(()=>this._handleEdits(W)).then();this._pendingEditsQueue=Y;this._updatingHandles.addPromise(Y)}));this.when(()=>{this._setupQueryEngine();this._updatingHandles.add(()=>this.maximumNumberOfFeatures,W=>this._controller.featureTarget=W,d.initial);this._updatingHandles.add(()=>this.suspended,W=>{W&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=
m.destroyMaybe(this._treeDebugger);this._i3sOverrides=m.destroyMaybe(this._i3sOverrides);this._set("processor",m.destroyMaybe(this.processor));this._controller=m.destroyMaybe(this._controller);this._queryEngine=m.destroyMaybe(this._queryEngine);this._worker=m.destroyMaybe(this._worker);this._memCache=m.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??
1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(W){null!=W?(this._override("maximumNumberOfFeatures",W),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&
!this._controller.leavesReached}get _excludeObjectIdsSorted(){const W=this.layer.excludeObjectIds;return W.length?W.toArray().sort((Y,ja)=>Y-ja):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}async whenGraphicAttributes(W,Y){return I.whenGraphicAttributes(this.layer,
W,this._getObjectIdField(),Y,()=>[...this.loadedGraphics.nodes()])}getHit(W){if(!this.loadedGraphics)return null;const Y=D.hydrateGraphic(this.loadedGraphics.find(oa=>oa.uid===W),this.layer),ja=this._getObjectIdField();if(!Y?.attributes?.[ja])return null;Y.layer=this.layer;Y.sourceLayer=this.layer;return{type:"graphic",graphic:Y,layer:Y.layer}}whenGraphicBounds(W,Y){return this.processor.whenGraphicBounds(W,Y)}computeAttachmentOrigin(W,Y){return this.processor.computeAttachmentOrigin(W,Y)}isUpdating(){return!!(this._controller?.updating||
this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(W){return this.processor.highlight(W,this.layer.objectIdField)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(W){return z.createInteractiveEditSession(this._attributeEditingContext,W)}async _decompressBinaryPointData(W,Y){W={geometryBuffer:W.geometryBuffer};null==this._worker&&(this._worker=new G.I3SPointsWorkerHandle(ja=>this.view.resourceController.immediate.schedule(ja)));
Y=await this._worker.invoke(W,Y);if(null==Y)throw Error("Failed to decompress Draco point data");return{positionData:Y.positions,featureIds:Y.featureIds}}async addNode(W,Y,ja){if(!(ha(Y)||"pointData"in Y))throw Error();if(this.loadedGraphics.hasNode(W.index))k.getLogger(this).error("I3S node "+W.id+" already added");else{if(null!=this.layer.fullExtent){var oa=this.layer.fullExtent.clone();oa.xmin-=.5;oa.ymin-=.5;oa.xmax+=.5;oa.ymax+=.5;null!=oa.zmin&&null!=oa.zmax&&(oa.zmin-=.5,oa.zmax+=.5);null!=
oa.mmin&&null!=oa.mmax&&(oa.mmin-=.5,oa.mmax+=.5)}else oa=null;var ra=oa,{featureIds:ta,pointPositions:ya}=ha(Y)?await this._extractBinaryPointPositions(W,Y,ja):this._extractLegacyPointPositions(Y);oa=[];this._validatePositions(W,ta,ya,ra,oa);var Ca=this._controller.crsVertex;x.projectBuffer(ya,Ca,0,ya,this.view.spatialReference,0,ta.length);ra=ha(Y)?W.level:0;ra=this._createGraphics(ta,ya,W.index,ra);ra=new aa(ra,ta,Y.attributeDataInfo,W);await this._i3sOverrides.applyAttributeOverrides(ra.featureIds,
Y.attributeDataInfo,ja);W.numFeatures=ra.graphics.length;this._updateNodeMemory(W);fa(ra);0<oa.length&&(this._computeObb(W,oa,Ca),this._controller.updateVisibility(W.index));if(this._controller.isGeometryVisible(W)){if(null!=this._verticalScale)for(var pa of ra.graphics)this._verticalScale(pa.geometry);Y=this.view._stage.renderView.objectAndLayerIdRenderHelper;if(null!=Y)for(ja=F.isBasemapLayer(this.view.map,this.layer.uid),pa=0;pa<ra.featureIds.length;pa++)Y.setUidToObjectAndLayerId(ra.featureIds[pa],
ra.graphics[pa].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!ja&&X.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled),ra.node.resources.attributes,pa);this.loadedGraphics.addNode(W.index,ra);this._controller.updateLoadStatus(W.index,!0);this._filterNode(ra);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(ra)}}_computeObb(W,Y,ja){const oa=this._controller.crsIndex,ra=oa.isGeographic?this.view.renderSpatialReference:oa;x.projectBuffer(Y,
ja,0,Y,ra,0,Y.length/3);W.serviceObbInIndexSR=O.compute(new P.Vertices(Y,3));oa.isGeographic&&(w.projectVectorToVector(W.serviceObbInIndexSR.center,ra,ea,oa),W.serviceObbInIndexSR.center=ea)}isNodeLoaded(W){return this.loadedGraphics.hasNode(W)}isNodeReloading(){return!1}updateNodeState(){}async _extractBinaryPointPositions(W,Y,ja){Y=await this._decompressBinaryPointData(Y,ja);ja=Y.positionData;const oa=ja.length/3,ra=v.newDoubleArray(3*oa);W=null!=W.serviceObbInIndexSR?W.serviceObbInIndexSR.center:
u.ZEROS;const ta=Math.abs(W[2])*2**-20;for(let ya=0;ya<oa;ya++){const Ca=3*ya;ra[Ca]=ja[Ca]+W[0];ra[Ca+1]=ja[Ca+1]+W[1];ra[Ca+2]=ja[Ca+2]+W[2];Math.abs(ra[Ca+2])<ta&&(ra[Ca+2]=0)}return{featureIds:Y.featureIds?v.doubleArrayFrom(Y.featureIds):[],pointPositions:ra}}_extractLegacyPointPositions(W){const Y=W.pointData.length,ja=v.newDoubleArray(3*Y),oa=[];for(let ya=0;ya<Y;ya++){var ra=W.pointData[ya];const Ca=ra.featureDataPosition,pa=Ca.length;var ta=ra.geometries?.[0]??Z[pa];ra=ra.featureIds[0];if("Embedded"!==
ta.type||"points"!==ta.params.type||2>pa||3<pa)continue;ta=ta.params.vertexAttributes?.position??[0,0,0];const wa=3*oa.length;ja[wa]=Ca[0]+ta[0];ja[wa+1]=Ca[1]+ta[1];ja[wa+2]=3===pa?Ca[2]+ta[2]:NaN;oa.push(ra)}return{featureIds:oa,pointPositions:ja}}_validatePositions(W,Y,ja,oa,ra){if(null!=oa||!W.serviceObbInIndexSR){Y=Y.length;for(let ya=0;ya<Y;ya++){var ta=3*ya;l.set(ea,ja[ta],ja[ta+1],ja[ta+2]);ta=!Number.isNaN(ja[2]);null==oa||(ta?q.extentContainsCoords3D(oa,ea):q.extentContainsCoords2D(oa,ea))||
(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);W.serviceObbInIndexSR||ra.push(ea[0],ea[1],ea[2])}}}_createGraphics(W,Y,ja,oa){const ra=W.length,ta=this._getObjectIdField(),ya=this.processor.graphicsCore,
Ca=[],pa=this.view.spatialReference;for(let qa=0;qa<ra;qa++){var wa=W[qa];const ua={};null!=wa&&(ua[ta]=wa);wa=null==wa?h.generateUID():wa;var Ba=3*qa,la=isNaN(Y[Ba+2])?void 0:Y[Ba+2];Ba=y.makeDehydratedPoint(Y[Ba],Y[Ba+1],la,pa);la=this.loadedGraphics.get(wa);if(null!=la){if(null==la.level||la.level<oa)ca.property="geometry",ca.graphic=la,ca.oldValue=la.geometry,ca.newValue=Ba,la.geometry=Ba,la.level=oa,ya.graphicUpdateHandler(ca);Ca.push(la)}else la=h.generateUID(),Ca.push({objectId:wa,uid:la,geometry:Ba,
attributes:ua,visible:!0,nodeIndex:ja,level:oa})}return Ca}_updateNodeMemory(W){W.memory=4096+(null!=W.numFeatures?W.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(W){const Y=W.graphics.reduce((ja,oa)=>r.estimateSize(oa)+ja,f.estimateSize(W.featureIds)+1024);this._memCache.put(this._getMemCacheKey(W.node),W,Y)}_getMemCacheKey(W){return`${W.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((W,Y)=>{W&&(this._updateNodeMemory(W.node),this._cacheNodeData(W));
this._controller.updateLoadStatus(Y,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()}removeNode(W){if(W=this._removeNodeStageData(W))this._updateNodeMemory(W.node),this._cacheNodeData(W)}_removeNodeStageData(W){const Y=this.loadedGraphics.getNode(W);if(null==Y)return null;this._controller.updateLoadStatus(W,!1);this.loadedGraphics.removeNode(W);this._treeDebugger&&this._treeDebugger.update();return Y}async loadCachedNodeData(W){return this._memCache?.pop(this._getMemCacheKey(W))}async addCachedNodeData(W,
Y,ja,oa){this.loadedGraphics.hasNode(W.index)?k.getLogger(this).error("I3S node "+W.id+" already added"):(await this._i3sOverrides.applyAttributeOverrides(Y.featureIds,ja,oa),this.loadedGraphics.addNode(W.index,Y),this._controller.updateLoadStatus(W.index,!0),this._updateNodeMemory(W),Y.attributeInfo=ja,this._attributeValuesChanged(Y),this._filterNode(Y),this._treeDebugger&&this._treeDebugger.update())}getLoadedNodeIds(){const W=[];this.loadedGraphics.forEachNode(Y=>W.push(Y.node.id));return W.sort()}getVisibleNodes(){const W=
[];this.loadedGraphics.forEachNode(Y=>W.push(Y.node));return W}getLoadedNodeIndices(W){this.loadedGraphics.forEachNode((Y,ja)=>W.push(ja))}getLoadedAttributes(W){W=this.loadedGraphics.getNode(W);if(null!=W?.attributeInfo)return W.attributeInfo.loadedAttributes}getAttributeData(W){W=this.loadedGraphics.getNode(W);if(null!=W?.attributeInfo)return W.attributeInfo.attributeData}_setAttributeData(W,Y){W=this.loadedGraphics.getNode(W);null!=W?.attributeInfo&&(W.attributeInfo.attributeData=Y,this._attributeValuesChanged(W))}async updateAttributes(W,
Y,ja){W=this.loadedGraphics.getNode(W);null!=W&&(await this._i3sOverrides.applyAttributeOverrides(W.featureIds,Y,ja),W.attributeInfo=Y,this._attributeValuesChanged(W))}_attributeValuesChanged(W){fa(W);this._filterNode(W);this.processor.graphicsCore.labelsEnabled&&(W=W.graphics.map(Y=>Y.uid),this.processor.graphicsCore.updateLabelingInfo(W))}_updateClippingExtent(W){this._controller&&this._controller.updateClippingArea(W);return!1}_getObjectIdField(){return this.layer.objectIdField||t.fallbackObjectIDAttribute}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}async _rendererChange(W,
Y){const {layer:{fieldsIndex:ja}}=this,oa=new Set;let ra;W?(await W.collectRequiredFields(oa,ja),ra=Array.from(oa).sort()):ra=[];oa.clear();let ta;Y?(await Y.collectRequiredFields(oa,ja),ta=Array.from(oa).sort()):ta=[];ra.length===ta.length&&ra.every((ya,Ca)=>ra[Ca]===ta[Ca])||this._reloadAllNodes()}_rangeInfosChanged(W){null!=W&&0<W.length&&k.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(W=>
this._filterNode(W))}_reloadAllNodes(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()}_filterNode(W){const Y=this.parsedDefinitionExpression,ja=this._excludeObjectIdsSorted,oa=this._getObjectIdField();for(const ra of W.graphics){W=ra.visible;const ta=!Y||this._evaluateClause(Y,ra),ya=null==ja||0>c.binaryIndexOf(ja,ra.attributes[oa]);ra.visible=ta&&ya;W!==ra.visible&&(ca.graphic=ra,ca.property="visible",ca.oldValue=W,ca.newValue=ra.visible,this.processor.graphicsCore.graphicUpdateHandler(ca))}}createQuery(){const W=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(W):new B(W)}queryFeatures(W,Y){return this._queryEngine.executeQuery(this._ensureQuery(W),Y?.signal)}queryObjectIds(W,Y){return this._queryEngine.executeQueryForIds(this._ensureQuery(W),Y?.signal)}queryFeatureCount(W,Y){return this._queryEngine.executeQueryForCount(this._ensureQuery(W),Y?.signal)}queryExtent(W,Y){return this._queryEngine.executeQueryForExtent(this._ensureQuery(W),
Y?.signal)}_ensureQuery(W){return this._addDefinitionExpressionToQuery(null==W?this.createQuery():B.from(W))}_setupQueryEngine(){const W=()=>this.processor.featureStore;this._queryEngine=new C.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return W()},hasZ:this.hasZ,hasM:this.hasM},priority:da.TaskPriority.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??
0}get unloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}async _handleEdits(W){const Y=this._attributeEditingContext;W=await z.normalizeEditResultsEvent(Y,W);z.processAttributeEdits(Y,W)}get _attributeEditingContext(){const W=this._getObjectIdField(),Y=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,
objectIdField:W,globalIdField:Y,forEachNode:ja=>this.loadedGraphics.forEachNode(oa=>ja(oa.node,oa.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:ja=>this.getAttributeData(ja),setAttributeData:(ja,oa,ra)=>{this._setAttributeData(ja,oa);ja=this.loadedGraphics.getNode(ja);null!=ra?(ra=this.loadedGraphics.get(ra.attributes[W]),null!=ra&&this.processor.graphicsCore.recreateGraphics([ra])):null!=ja&&this.processor.graphicsCore.recreateGraphics(ja.graphics)},
clearMemCache:()=>{}}}get performanceInfo(){return new N.LayerViewPerformanceInfo(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}get test(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}};b.__decorate([g.property()],H.prototype,"processor",void 0);b.__decorate([g.property({type:A})],H.prototype,"filter",void 0);b.__decorate([g.property()],
H.prototype,"loadedGraphics",void 0);b.__decorate([g.property()],H.prototype,"i3slayer",null);b.__decorate([g.property()],H.prototype,"_controller",void 0);b.__decorate([g.property()],H.prototype,"updating",void 0);b.__decorate([g.property()],H.prototype,"suspended",void 0);b.__decorate([g.property()],H.prototype,"holeFilling",void 0);b.__decorate([g.property(U.updatingProgress)],H.prototype,"updatingProgress",void 0);b.__decorate([g.property()],H.prototype,"updatingProgressValue",null);b.__decorate([g.property(e.requiredFields)],
H.prototype,"requiredFields",null);b.__decorate([g.property(e.availableFields)],H.prototype,"availableFields",void 0);b.__decorate([g.property()],H.prototype,"_fieldsHelper",void 0);b.__decorate([g.property({type:Number})],H.prototype,"maximumNumberOfFeatures",null);b.__decorate([g.property({readOnly:!0})],H.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([g.property()],H.prototype,"_excludeObjectIdsSorted",null);b.__decorate([g.property({readOnly:!0})],H.prototype,"lodFactor",null);
b.__decorate([g.property({readOnly:!0})],H.prototype,"hasM",null);b.__decorate([g.property({readOnly:!0})],H.prototype,"hasZ",null);b.__decorate([g.property()],H.prototype,"contentVisible",null);b.__decorate([g.property({readOnly:!0})],H.prototype,"legendEnabled",null);b=H=b.__decorate([n.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],H);const Z={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,
0,0]}}}},ea=u.create(),ca={graphic:null,property:null,oldValue:null,newValue:null};return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class h extends b.WorkerHandle{constructor(c){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:k=>[k.geometryBuffer]},c,{hasInitialize:!0})}}a.I3SPointsWorkerHandle=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports",
"../../../../core/Evented","../../../../core/MapUtils"],function(a,b,h){class c extends b{constructor(k,m){super();this._updateAndCompare=k;this._notifyUpdated=m;this._nodes=new Map;this._graphics=new Map;this._duplicates=new Map}clear(){if(0<this._graphics.size){const k=this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:k})}this._nodes.clear()}get length(){return this._graphics.size}get(k){return this._graphics.get(k)}getNode(k){return this._nodes.get(k)}hasNode(k){return this._nodes.has(k)}nodes(){return this._nodes.values()}addNode(k,
m){this._nodes.set(k,m);const d=m.graphics;if(0!==d.length){var f=new Set;for(let e=0;e<d.length;e++){var g=d[e];const n=g.objectId,l=this._graphics.get(n);l?(f.add(n),g!==l&&(d[e]=l),(g=this._duplicates.get(n))?g.push(k):this._duplicates.set(n,[l.nodeIndex,k])):(g.nodeIndex=k,this._graphics.set(n,g))}f.size&&this._updateForeignGraphics(m);k=0<f.size?d.filter(e=>!f.has(e.objectId)):d;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeNode(k){var m=this._nodes.get(k);if(m){this._nodes.delete(k);
var d=new Set,f=[];for(const n of m.graphics){m=n.objectId;var g=this._graphics.get(m);if(!g)continue;const l=this._duplicates.get(m);if(l){var e=l.indexOf(k);if(-1===e)console.error("error: removing graphic from node that should not reference it.");else{l.splice(e,1);if(g.nodeIndex===k){g=this.getNode(l[0]);for(e=1;e<l.length;e++){const u=this.getNode(l[e]);if(null==g||null!=u&&u.node.level>g.node.level)g=u}null!=g&&d.add(g)}1===l.length&&this._duplicates.delete(m)}}else this._graphics.delete(m),
f.push(n)}0<f.length&&this.emit("change",{added:[],removed:f});d.forEach(n=>this._updateForeignGraphics(n))}else console.error("Removing unknown node")}_updateForeignGraphics(k){const m=[],d=k.node.index,f=k.node.level;let g=0;for(;g<k.graphics.length;){var e=k.graphics[g].nodeIndex;if(e===d){g++;continue}let n=1;for(;g+n<k.graphics.length&&k.graphics[g+n].nodeIndex===e;)n++;e=this.getNode(e);if(!(null!=e&&e.node.level>f))for(e=g;e<g+n;e++){const l=k.graphics[e];l.nodeIndex=d;this._updateAndCompare(l,
k,e)&&m.push(l)}g+=n}this._notifyUpdated(m)}toArray(){return Array.from(this._graphics.values())}find(k){let m=void 0;h.someMap(this._graphics,d=>k(d)?(m=d,!0):!1);return m}forEach(k){this._graphics.forEach(m=>k(m))}forEachNode(k){this._nodes.forEach((m,d)=>k(m,d))}get nodeCount(){return this._nodes.size}_checkInvariants(){const k=new Map;this._nodes.forEach((d,f)=>{f!==d.node.index&&console.error("Mismatched node index");d.graphics.forEach(g=>{k.set(g.objectId,1+(k.get(g.objectId)??0));const e=this._duplicates.get(g.objectId);
e&&!e.includes(f)&&console.error("Node not listed in duplicate list");e||g.nodeIndex===f||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==k.size&&console.error("Mismatch between actual and expected number of graphics");let m=0;k.forEach((d,f)=>{m+=1<d?1:0;const g=this._graphics.get(f);if(g){var e=this._nodes.get(g.nodeIndex);e?(f=this._duplicates.get(f))?(f.length!==d&&console.error("Wrong number of entries in duplicate list"),f.forEach(n=>{(n=this._nodes.get(n))?
n.node.level>e.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<d&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});this._duplicates.size!==m&&console.error("Mismatch between expected and actual number of duplicate entries")}}a.I3SGraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/tslib.es6 ../Camera ../geometry ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../core/accessorSupport/overrideDefaultsFrom ../core/libs/gl-matrix-2/factories/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/projection/projectBoundingRect ../geometry/projection/projectPointToVector ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/hitTest ./3d/support/MapCoordsHelper ./3d/support/popupHitTest ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/TextureCollection ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/basicInterfaces ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/verticalOffsetUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/Extent ../geometry/SpatialReference ../geometry/Point".split(" "),function(a,
b,h,c,k,m,d,f,g,e,n,l,u,x,w,q,v,p,t,r,y,D,E,A,B,F,G,H,L,C,z,J,K,I,M,S,N,V,Q,T,ia,O,U,P,R,ba,X,da,ha,fa,aa,Z,ea,ca,W,Y,ja,oa,ra,ta,ya,Ca,pa,wa,Ba,la,qa,ua,va,Ga,La,Na,Wa,Ia,Oa,Ua,Va,Ra,bb,gb,db,ka,mb,sb,tb,xa,Ha,na,za){function Da(Ja,Qa){return null!=Ja&&L.canProjectWithoutEngine(Ja.spatialReference,Qa)?L.project(Ja,Qa):null}c=class extends V.BreakpointsOwner(ia.PopupView(Q.DOMContainer(O))){constructor(Ja){super(Ja);this._createGraphicsViewController=this._initialDefaultSpatialReference=this._clippingArea=
this._userClippingArea=null;this._resolveWhenReady=[];this._propertiesPool=new Ba.PropertiesPool({slicePlane:K.BoundedPlaneClass},this);this._resourceController=ua.newResourceController(this);this._defaultToMapOptions={include:new Set};this._defaultHitTestOptions={exclude:new Set};this.deconflictor=new aa.GraphicsDeconflictor({view:this});this.labeler=new Z.Labeler({view:this,deconflictor:this.deconflictor.labels});this.sharedSymbolResources=null;this.analyses=new N.AnalysesCollection;this.canvas=
this.elevationProvider=this.basemapTerrain=null;this.constraints=new X.Constraints;this.environment=new da;this.environmentManager=new ha.SceneViewEnvironmentManager;this.floors=new m;this.fullOpacity=1;this.graphicsView=null;this.analysisViewManager=new ba({view:this});this.map=this.groundView=null;this.screenSizePerspectiveEnabled=!0;this.state=new ca;this.spatialReference=null;this.preserveDrawingBufferEnabled=this.alphaCompositingEnabled=!1;this.supersampleScreenshotsEnabled=!0;this.type="3d";
this.ui=new tb;this._lastUpdateTime=this._numUpdating=0;this.updatingProgress=.5;this.highlightOptions=new ya;t.initialize();const Qa=(Sa=null)=>{if(null==Sa||Sa.type!==x.ObservableChangesType.MOVE)this._updatingChanged(),this.map&&this.map.allLayers.forEach(async cb=>{try{await cb.when()}catch{}this._updatingChanged()})};this.addHandles([q.on(()=>this.map?.allLayers,"after-changes",Sa=>Qa(Sa),{onListenerAdd:()=>Qa(),onListenerRemove:()=>Qa(),sync:!0}),this.allLayerViews.on("after-changes",Sa=>this._updateUpdatingMonitors(Sa)),
q.watch(()=>this.map,Sa=>{Sa&&"load"in Sa&&Sa.load&&Sa.load().catch(()=>{})})]);this.inputManager=new fa({view:this});this.stateManager=new W.ViewStateManager({view:this})}initialize(){this.groundView=new T({view:this});this._updateUpdatingMonitors();const Ja=()=>this._updateDefaultToMapOptions();this.addHandles(q.on(()=>this.map?.allLayers,"after-changes",Ja,{onListenerAdd:Ja,onListenerRemove:Ja}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Qa=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=
Qa)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Qa=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Qa)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Qa=>v.setFrameDuration(0<Qa?1E3/Math.ceil(Qa):0),q.initial);this.updatingHandles.add(()=>this.map?.ground,Ja,q.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),q.syncAndInitial);
this.addHandles(q.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),q.sync))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=u.destroyMaybe(this.sharedSymbolResources),this._set("labeler",u.destroyMaybe(this.labeler)),this._set("deconflictor",u.destroyMaybe(this.deconflictor)),this._resourceController=u.destroyMaybe(this._resourceController),
this._set("stateManager",u.destroyMaybe(this.stateManager)),this._set("inputManager",u.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",u.destroyMaybe(this.environmentManager)),this._set("environment",u.destroyMaybe(this.environment)),this.groundView=u.destroyMaybe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&
this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(Ja){this.stateManager&&(this.stateManager.camera=Ja)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(Ja){this.stateManager&&(this.stateManager.contentCamera=Ja)}installContentCameraReset(Ja={sticky:!1}){return this.stateManager.installContentCameraReset(Ja)}get center(){return this.stateManager?.center}set center(Ja){this.stateManager&&
(this.stateManager.center=Ja)}get clippingArea(){if("global"===this.viewingMode)return null;const Ja=this.map;let Qa=this._userClippingArea||u.maybeProperty(Ja,"clippingArea");if(!this._userClippingArea&&!u.maybeProperty(Ja,"clippingEnabled")||null==Qa)return this._clippingArea=null;if(!(Qa instanceof Ha))return l.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Qa=Da(Qa,this.spatialReference),null==Qa))return l.getLogger(this).error("#clippingArea",
"setting clippingArea with incompatible SpatialReference"),this._clippingArea;Qa=Qa.clone();null==Qa.intersection(this._groundAndLayersExtent)&&(Qa.xmin=Qa.xmax,Qa.ymin=Qa.ymax);Qa.zmin=void 0;Qa.zmax=void 0;Qa.equals(this._clippingArea)||(this._clippingArea=Qa);return this._clippingArea}set clippingArea(Ja){this.ready&&"global"===this.viewingMode&&null!=Ja?l.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Ja}get renderDataExtent(){if(this.state.viewingMode===
P.ViewingMode.Global)return null;const Ja=this.renderSpatialReference,Qa=this.dataExtent;return null==Qa||null==Ja||Qa.spatialReference.equals(Ja)?Qa:Da(Qa,Ja)}get dataExtent(){let Ja=this._groundAndLayersExtent;var Qa=Da(this.clippingArea,this.spatialReference||na.WGS84);null!=Qa&&(Ja=null!=Ja?Ja.intersection(Qa):Qa);Qa=this._get("dataExtent");return null!=Ja&&Ja.equals(Qa)?Qa:Ja}get _groundAndLayersExtent(){const Ja=this.spatialReference||na.WGS84;let Qa;const Sa=eb=>{eb=Da(eb,Ja);null!=eb&&(null!=
Qa?Qa.union(eb):Qa=eb.clone())};var cb=this.basemapTerrain;if(cb?.spatialReference){const eb=cb.groundExtent;Sa(new Ha({xmin:eb[0],ymin:eb[1],zmin:0,xmax:eb[2],ymax:eb[3],zmax:0,spatialReference:cb.spatialReference}))}this.map&&this.map.allLayers.forEach(eb=>{null==eb.fullExtent||"graphics"===eb.type&&eb.internal||Sa(eb.fullExtent)});if(null==Qa)return null;Qa.hasZ?(Qa.zmin=Math.min(0,Qa.zmin??0),Qa.zmax=Math.max(0,Qa.zmax??0)):(Qa.zmin=0,Qa.zmax=0);cb=this._get("_groundAndLayersExtent");return Qa.equals(cb)?
cb:Qa}castEnvironment(Ja){return Ja?Ja instanceof da?Ja:Ja instanceof xa?this.environment?.cloneWithWebsceneEnvironment(Ja)??da.fromWebsceneEnvironment(Ja):A.ensureType(da,Ja):new da}get extent(){return this.stateManager?.extent}set extent(Ja){this.stateManager&&(this.stateManager.extent=Ja)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,
heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(Ja){this.stateManager&&(this.stateManager.padding=Ja)}set qualityProfile(Ja){ra.isValidProfile(Ja)&&(ra.apply(Ja,this.qualitySettings),this._set("qualityProfile",Ja))}get qualityProfile(){return this._get("qualityProfile")||
ra.getDefaultProfile()}set slicePlane(Ja){null!=this._stage&&this._stage.renderer.setParameters({slicePlane:Ja});if(null==Ja)this._set("slicePlane",null);else{var Qa=this._propertiesPool.get("slicePlane");K.copy(Ja,Qa);this._set("slicePlane",Qa)}}get typeSpecificPreconditionsReady(){return this.viewingMode?this.stateManager.preinit(this.spatialReference):!1}get resolution(){return null!=this.spatialReference?M.getResolutionForScale(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(Ja){this.stateManager&&
(this.stateManager.scale=Ja)}get heightModelInfo(){const Ja=this.getDefaultHeightModelInfo();return null!=Ja?H.deriveUnitFromSR(Ja,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let Ja=0,Qa=this.layerViewManager.updating,Sa=Qa?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(lb=>{lb.isFulfilled()?lb.updating&&(Qa=!0,lb.suspended||Ia.isSurfaceLayerView(lb)||(++Sa,Ja+=lb.updatingProgress)):++Sa});for(var cb of this._updatingObjects)null!=cb&&cb.updating&&(Sa+=
.1,Ja+=.05);for(var eb of this._updatingObjectsWithProgress)null!=eb&&eb.updating&&(++Sa,Ja+=eb.updatingProgress);cb=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;(Qa=!!(Qa||0<Sa||this.updatingHandles.updating||!this.ready||!this.stationary||cb||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(lb=>!lb.isFulfilled())||this.textures?.updating))?(this._numUpdating=Math.max(Sa,this._numUpdating),Ja+=this._numUpdating-Sa):this._numUpdating=
0;Ja=0<this._numUpdating?Ja/this._numUpdating:Qa?0:1;this._get("updatingProgress")!==Ja&&(cb=performance.now(),1>Ja&&(eb=Math.min((cb-this._lastUpdateTime)/2E3,1),Ja=this.updatingProgress*(1-eb)+Ja*eb),this._set("updatingProgress",Ja),this._lastUpdateTime=Qa&&1>Ja?cb:0);return Qa}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,
this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var Ja=this._predeterminedViewingMode;return null!=Ja?P.stringFromViewingMode(Ja):(Ja=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&Ja.equals(this.defaultsFromMap.spatialReference)?P.stringFromViewingMode(this.defaultsFromMap.viewingMode):ka.isSpatialReferenceSupported(Ja,P.ViewingMode.Global)?"global":"local":"global"}set viewingMode(Ja){this.ready?
l.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Ja)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(Ja){this.stateManager&&(this.stateManager.viewpoint=Ja)}get zoom(){return this.stateManager.zoom}set zoom(Ja){this.stateManager&&(this.stateManager.zoom=Ja)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,
this.quality/.75))}get performanceInfo(){return new va(this)}on(Ja,Qa,Sa,cb){return(Sa=this.viewEvents.on(Ja,Qa,Sa,cb))?Sa:super.on(Ja,Qa)}hasEventListener(Ja){return super.hasEventListener(Ja)||this.viewEvents.hasHandler(Ja)}toMap(Ja,Qa){if(!this.ready)return l.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Ja=db.isSupportedScreenPointEvent(Ja)?db.createScreenPointFromSupportedEvent(this,Ja):Ja;return Ca.toMap(this,Ja,Qa,this._defaultToMapOptions)}toScreen(Ja){if(!this.ready)return l.getLogger(this).error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Qa=(null==Ja.z?ta.getElevationAtPoint(this.elevationProvider,Ja):null)??0;z.projectPointToVector(Ja,Ma,this.renderSpatialReference,Qa);this.state.camera.projectToScreen(Ma,Xa);return p.createScreenPoint(Xa[0],Xa[1])}pixelSizeAt(Ja){if(!this.ready)return l.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ja)return 0;z.projectPointToVector(Ja,Ma,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Ma)}overlayPixelSizeInMapUnits(Ja){const Qa=
this.basemapTerrain.overlayManager;return Qa?Qa.overlayPixelSizeInMapUnits(Ja,()=>this.pixelSizeAt(Ja)):1}hitTest(Ja,Qa){if(!this.ready)return l.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;Ja=db.isSupportedScreenPointEvent(Ja)?db.createScreenPointFromSupportedEvent(this,Ja):Ja;return Ca.hitTest(this,Ja,Qa,this._defaultHitTestOptions)}async popupHitTest(Ja){return wa.popupHitTest(this,Ja)}goTo(Ja,Qa){return this.updatingHandles.addPromise(this.stateManager.goTo(Ja,
Qa))}async whenAnalysisView(Ja){if(null==Ja.parent)throw new f("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ja});switch(Ja.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(Ja.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Ja)}}whenLayerView(Ja){return super.whenLayerView(Ja)}async takeScreenshot(Ja){Ja=this._completeSettings(Ja);await this.whenReady();const Qa=await this._stage.renderView.takeScreenshot(Ja);
return gb.encode(Qa,Ja,this._pixelFormat())}async _takeScreenshot(Ja){Ja=this._completeSettings(Ja);await this.whenReady();Ja=await this._stage.renderView.takeScreenshot(Ja);return gb.encodeData(Ja,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(Ja){Ja=this._completeSettings(Ja);await this.whenReady();Ja=await this._stage.renderView.takeScreenshotWithOID(Ja);return[gb.encodeData(Ja[0],this._pixelFormat()),gb.encodeData(Ja[1],this._pixelFormat())]}_completeSettings(Ja){Ja=gb.toRenderSettings(Ja,
this);Ja.pixelRatio/=this.state.pixelRatio;return gb.screenshotSuperSampleSettings(Ja,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:Ja=>this._takeScreenshot(Ja),takeScreenshotWithObjectAndLayerId:Ja=>this._takeScreenshotWithObjectAndLayerId(Ja)}}async takeScreenshotWithObjectAndLayerId(Ja){if(!n("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");
var Qa=this._completeSettings(Ja);await this.whenReady();var Sa=await this._stage.renderView.takeScreenshotWithOID(Qa);Qa=gb.encode(Sa[0],Qa,this._pixelFormat());Ja=this._completeSettings(Ja);Ja.format="png";Sa=gb.encode(Sa[1],Ja,this._pixelFormat());return[Qa,Sa]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(Ja){return this.updatingHandles.addPromise(Ja)}importLayerView(Ja){return R.layerView3DImporter.importLayerView(Ja)}hasLayerViewModule(Ja){return R.layerView3DImporter.hasLayerViewModule(Ja)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&
"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let Ja=mb.check(this.type);const Qa=n("safari");Qa&&9>Qa&&(Ja=new f("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Qa}));if(null!=Ja)throw l.getLogger(this).warn("#validate()",Ja.message),Ja;
}get _predeterminedViewingMode(){const Ja=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=Ja?P.viewingModeFromString(Ja):null}getSpatialReferenceSupport({spatialReference:Ja,layer:Qa}){var Sa=this._predeterminedViewingMode;if(null!=Sa)return this._validateSpatialReferenceForViewingMode(Ja,Qa,Sa)?{constraints:this._makeSpatialReferenceConstraints(Ja,Qa,Sa)}:null;Sa=this._validateSpatialReferenceForViewingMode(Ja,
Qa,P.ViewingMode.Local);const cb=this._validateSpatialReferenceForViewingMode(Ja,Qa,P.ViewingMode.Global);return Sa||cb?Sa&&cb?{constraints:this._makeSpatialReferenceConstraints(Ja,Qa,null)}:Sa?{constraints:this._makeSpatialReferenceConstraints(Ja,Qa,P.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ja,Qa,P.ViewingMode.Global)}:null}_validateSpatialReferenceForViewingMode(Ja,Qa,Sa){return ka.isSpatialReferenceSupported(Ja,Sa)?null==Qa||S.isImageryTileLayer(Qa)?!0:S.isTiledLayer(Qa)&&
null==Ia.getTiledLayerInfo(Qa,Ja,Sa)||S.isVoxelLayer(Qa)&&Sa===P.ViewingMode.Global?!1:!0:!1}_makeSpatialReferenceConstraints(Ja,Qa,Sa){if(null==Qa)return[{spatialReference:Ja,viewingMode:Sa}];const cb=Ja.isWebMercator,eb=Ja.isWGS84;return S.isImageryTileLayer(Qa)&&(cb||eb)?(eb&&Sa!==P.ViewingMode.Local?null===Ia.checkIfTileInfoSupportedForView(Qa.tileInfo,Qa.fullExtent,Ja,P.ViewingMode.Global):1)?[{spatialReference:Ja,viewingMode:Sa},{spatialReference:na.WebMercator,viewingMode:Sa}]:[{spatialReference:cb?
na.WGS84:na.WebMercator,viewingMode:Sa}]:S.isTiledLayer(Qa)||S.isVoxelLayer(Qa)||!cb&&!eb?S.isTiledLayer(Qa)&&cb&&Sa!==P.ViewingMode.Global?[{spatialReference:Ja,viewingMode:Sa},{spatialReference:na.WGS84,viewingMode:P.ViewingMode.Local}]:[{spatialReference:Ja,viewingMode:Sa}]:[{spatialReference:Ja,viewingMode:Sa},{spatialReference:cb?na.WGS84:na.WebMercator,viewingMode:Sa}]}_validateSpatialReference(Ja){const Qa=null!=this.getSpatialReferenceSupport({spatialReference:Ja}),Sa=this._predeterminedViewingMode;
Qa||(null!=Sa?l.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${P.stringFromViewingMode(Sa)} viewing mode.`):Ja.isGeographic&&l.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Qa}whenReady(){return new Promise(Ja=>{this.ready?Ja(this):this._resolveWhenReady.push(Ja)})}trackGraphicState(Ja){if(!Ja.graphic)return l.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;
const Qa=this.getViewForGraphic(Ja.graphic);let Sa=null,cb=!1;const eb=lb=>{!cb&&null!=lb&&"processor"in lb&&"graphics-3d"===lb.processor?.type&&lb.processor.graphicsCore&&(Sa=lb.processor.graphicsCore.trackGraphicState(Ja))};null!=Qa?eb(Qa):this.whenViewForGraphic(Ja.graphic,{waitForLayer:!0}).then(lb=>eb(lb),()=>{}).catch(()=>{});return e.makeHandle(()=>{cb=!0;null!=Sa&&(Sa.remove(),Sa=null)})}highlight(Ja){if(Array.isArray(Ja))return e.handlesGroup(Ja.map(Sa=>this.highlight(Sa)));if(m.isCollection(Ja))return e.handlesGroup(Ja.toArray().map(Sa=>
this.highlight(Sa)));const Qa=this.getViewForGraphic(Ja);return Qa&&"highlight"in Qa?Qa.highlight(Ja):e.makeHandle()}maskOccludee(Ja){if(!Ja)return l.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Qa=this.getViewForGraphic(Ja);let Sa=null,cb=!1;const eb=lb=>{!cb&&null!=lb&&bb.occludeesSupported(lb)&&(Sa=lb.maskOccludee(Ja))};null!=Qa?eb(Qa):this.whenViewForGraphic(Ja,{waitForLayer:!0}).then(lb=>eb(lb),()=>{}).catch(()=>{});
return e.makeHandle(()=>{cb=!0;null!=Sa&&(Sa.remove(),Sa=null)})}getViewForGraphic(Ja){return Ja.layer===this.graphics?this.graphicsView:Ja.layer?this.allLayerViews.find(Qa=>Qa.layer===Ja.layer):null}graphicChanged(Ja){null!=this.graphicsView&&this.graphicsView.graphicChanged(Ja)}async whenViewForGraphic(Ja,Qa){if(Ja.layer===this)return await q.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ja.layer||!this.map)throw new f("no-view-for-graphic");return Qa&&Qa.waitForLayer&&!this.map.allLayers.includes(Ja.layer)?
new Promise((Sa,cb)=>{const eb=this.map.allLayers.on("change",lb=>{lb.added.includes(Ja.layer)&&(eb.remove(),this.whenLayerView(Ja.layer).then(Sa,cb))})}):this.whenLayerView(Ja.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new Wa({view:this}));this._set("elevationProvider",new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),
this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Na.PointsOfInterest({view:this}));this._set("featureTiles",new ea.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,
scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ja=()=>{var Qa=this.basemapTerrain?.extent;this.clippingArea||Qa?Qa&&this.basemapTerrain.spatialReference?(Qa=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?L.project(J.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Qa):Qa):this.featureTiles.filterExtent=
this.clippingArea:this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES,Qa=>{Qa&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Sa,cb)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Sa,cb))).then(({FeatureTileTree3DDebugger:Sa})=>{!this._featureTreeDebugger&&oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Sa({view:this}))}):Qa||!this._featureTreeDebugger||
oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},q.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ja,q.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ja,q.syncAndInitial)],"feature-tiles");this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",
null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){var Ja=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ja)||this._set("mapCoordsHelper",new pa.MapCoordsHelper(this.map,Ja));const Qa=this.state.isGlobal;Ja=I.renderSRFromViewSR(Qa,Ja);Ja!==this.renderSpatialReference&&(this._set("renderCoordsHelper",qa.RenderCoordsHelper.create(this.state.viewingMode,
Ja)),Qa||this.addHandles(q.watch(()=>this.basemapTerrain?.extent,Sa=>{const cb=this.renderCoordsHelper.spatialReference;null==Sa||0===Sa[0]&&0===Sa[1]&&0===Sa[2]&&0===Sa[3]||!C.projectBoundingRect(Sa,this.basemapTerrain.spatialReference,ab,cb)||(this.renderCoordsHelper.extent=ab)},q.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Va.defaultTolerance/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",
null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(Ja=null){if(null==Ja||Ja.type!==x.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Qa=>{Qa.destroyed||(this.addHandles(q.watch(()=>[Qa.updating,Qa.updatingProgress],()=>this._updatingChanged(),q.sync),"updatingMonitors"),
Qa.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged()}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(Ja,Qa,Sa){if(!this.overlay||!this.overlay.hasVisibleItems)return Sa;const cb=Ja.getContext("2d");cb.putImageData(Sa,0,0);this.overlay.renderCanvas(Ja,{disableDecorations:Qa===Ua.Decorations.OFF});return cb.getImageData(0,0,Sa.width,Sa.height)}_initStage(){const Ja={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,
debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Sa,cb,eb)=>this._renderScreenshotOverlay(Sa,cb,eb)}};var Qa=new Y.SceneIntersectionHelper(this.state.viewingMode,Sa=>this._stage.layers.forAll(Sa),this);this._set("sceneIntersectionHelper",Qa);Qa=d.byId(this.surface);this._stage=new Oa.Stage({view:this,options:Ja,
container:Qa});this._stage.renderer.setParameters({slicePlane:this.slicePlane});this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Sa=>this._stage.renderer.setParameters({highQualityTransparency:Sa}),q.initial),q.watch(()=>this.magnifier,Sa=>this._stage.renderView.magnifier=Sa,q.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),g.on(this._stage.renderView.canvas,"webglcontextlost",Sa=>this.fatalError=new f("webgl-context-lost",
Sa.statusMessage))],"stage");this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Va.defaultTolerance/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null);this._stage=u.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)}_initSurface(Ja){this._exitSurface();this.state.init(Ja,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ga.SharedSymbolResources({view:this,
viewingMode:Ja,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=
new AbortController;var Ja=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ja,Ja);this._updatingChanged()}}async _createGraphicsViewAsync(Ja){const Qa=(await new Promise((Sa,cb)=>a(["./3d/layers/GraphicsView3D"],eb=>Sa(Object.freeze(Object.defineProperty({__proto__:null,default:eb},Symbol.toStringTag,{value:"Module"}))),cb))).default;w.throwIfAborted(Ja);await q.whenOnce(()=>this.basemapTerrain?.ready,
Ja);this._set("graphicsView",new Qa({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var Ja=P.viewingModeFromString(this.viewingMode);Ja===P.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ja);
this._set("ready",!0);this.addHandles(q.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();(Ja=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.environment:void 0)&&B.overrideDefaultsFrom(this.environment,Ja);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();this._set("textures",new La.TextureCollection(this._stage,this.resourceController.scheduler));Ja=
this._resolveWhenReady;this._resolveWhenReady=[];Ja.forEach(Qa=>Qa(this))}_teardown(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._set("textures",u.destroyMaybe(this.textures));this._exitSurface();this._set("ready",!1)}_updateDefaultToMapOptions(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ra.terrainId);
for(const Ja of this.map.allLayers.items)S.isIntegratedMeshLayer(Ja.type)&&this._defaultToMapOptions.include.add(Ja.uid)}}_updateDefaultHitTestOptions(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ra.terrainId);for(const Ja of this.map.allLayers.items)S.isIntegratedMeshLayer(Ja.type)&&1>Ja.opacity&&this._defaultHitTestOptions.exclude.add(Ja.uid)}}};c.type="3d";b.__decorate([r.property()],c.prototype,"_userClippingArea",
void 0);b.__decorate([r.property()],c.prototype,"_resourceController",void 0);b.__decorate([r.property()],c.prototype,"_stage",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"deconflictor",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"labeler",void 0);b.__decorate([r.property(G.owningCollectionProperty(N.AnalysesCollection,"analyses"))],c.prototype,"analyses",void 0);b.__decorate([r.property({type:U,readOnly:!0})],c.prototype,"animation",null);b.__decorate([r.property({readOnly:!0})],
c.prototype,"basemapTerrain",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"elevationProvider",void 0);b.__decorate([r.property()],c.prototype,"camera",null);b.__decorate([r.property({type:h})],c.prototype,"contentCamera",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"canvas",void 0);b.__decorate([r.property({type:za})],c.prototype,"center",null);b.__decorate([r.property({type:Ha})],c.prototype,"clippingArea",null);b.__decorate([r.property({type:X.Constraints})],c.prototype,
"constraints",void 0);b.__decorate([r.property({type:Ha,readOnly:!0})],c.prototype,"renderDataExtent",null);b.__decorate([r.property({type:Ha,readOnly:!0})],c.prototype,"dataExtent",null);b.__decorate([r.property({type:Ha,readOnly:!0})],c.prototype,"_groundAndLayersExtent",null);b.__decorate([r.property({type:da})],c.prototype,"environment",void 0);b.__decorate([y.cast("environment")],c.prototype,"castEnvironment",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"environmentManager",void 0);
b.__decorate([r.property({type:Ha})],c.prototype,"extent",null);b.__decorate([r.property()],c.prototype,"floors",void 0);b.__decorate([r.property()],c.prototype,"screenCenter",null);b.__decorate([r.property()],c.prototype,"frustum",null);b.__decorate([r.property({type:Number,readOnly:!0})],c.prototype,"fullOpacity",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"graphicsView",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"analysisViewManager",void 0);b.__decorate([r.property()],
c.prototype,"groundView",void 0);b.__decorate([r.property({type:Boolean})],c.prototype,"initialExtentRequired",null);b.__decorate([r.property()],c.prototype,"_defaultsFromMapSettings",null);b.__decorate([r.property()],c.prototype,"interacting",null);b.__decorate([r.property()],c.prototype,"stationary",null);b.__decorate([r.property()],c.prototype,"navigating",null);b.__decorate([r.property()],c.prototype,"map",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"mapCoordsHelper",void 0);
b.__decorate([r.property()],c.prototype,"padding",null);b.__decorate([r.property({type:Na.PointsOfInterest,readOnly:!0})],c.prototype,"pointsOfInterest",void 0);b.__decorate([r.property({type:ea.FeatureTileTree3D,readOnly:!0})],c.prototype,"featureTiles",void 0);b.__decorate([r.property()],c.prototype,"_featureTreeDebugger",void 0);b.__decorate([r.property({type:Boolean})],c.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"deactivatedWebGLExtensions",
void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"debugWebGLExtensions",void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"renderCanvas",void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"state",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"inputManager",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"stateManager",void 0);b.__decorate([r.property({type:["low","medium","high"]})],c.prototype,"qualityProfile",null);b.__decorate([r.property({type:la,
get(){let Ja=this._get("qualitySettings");Ja||(Ja=new la,ra.apply(this.qualityProfile,Ja));return Ja}})],c.prototype,"qualitySettings",void 0);b.__decorate([r.property()],c.prototype,"slicePlane",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"typeSpecificPreconditionsReady",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"renderCoordsHelper",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"sceneIntersectionHelper",void 0);b.__decorate([r.property({type:Number,
dependsOn:["scale","spatialReference"],readOnly:!0})],c.prototype,"resolution",null);b.__decorate([r.property({type:Number})],c.prototype,"scale",null);b.__decorate([r.property()],c.prototype,"heightModelInfo",null);b.__decorate([r.property()],c.prototype,"spatialReference",void 0);b.__decorate([r.property({type:Boolean,constructOnly:!0})],c.prototype,"alphaCompositingEnabled",void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"preserveDrawingBufferEnabled",void 0);b.__decorate([r.property({type:Boolean})],
c.prototype,"supersampleScreenshotsEnabled",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"type",void 0);b.__decorate([r.property(),y.cast(Ja=>Ja instanceof sb?Ja:A.ensureClass(tb,Ja))],c.prototype,"ui",void 0);b.__decorate([r.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating textures.updating".split(" ")})],
c.prototype,"updating",null);b.__decorate([r.property()],c.prototype,"_updatingObjects",null);b.__decorate([r.property()],c.prototype,"_updatingObjectsWithProgress",null);b.__decorate([r.property({type:Number,readOnly:!0,dependsOn:["updating"]})],c.prototype,"updatingProgress",void 0);b.__decorate([r.property({type:["global","local"]})],c.prototype,"viewingMode",null);b.__decorate([r.property({type:k})],c.prototype,"viewpoint",null);b.__decorate([r.property({type:Number})],c.prototype,"zoom",null);
b.__decorate([r.property({type:ya})],c.prototype,"highlightOptions",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"quality",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"resolutionScale",null);b.__decorate([r.property()],c.prototype,"textures",void 0);c=b.__decorate([E.subclass("esri.views.SceneView")],c);const Ma=F.create(),Xa=p.createScreenPointArray(),ab=J.create();return c});