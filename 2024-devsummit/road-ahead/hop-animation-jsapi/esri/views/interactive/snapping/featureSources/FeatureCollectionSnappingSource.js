// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/memoize ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../support/elevationInfoUtils ../snappingUtils ./queryEngineUtils ./snappingCandidateElevationAlignment ./snappingCandidateElevationFilter ./symbologySnappingCandidates".split(" "),
function(e,f,r,t,k,l,g,z,A,B,u,v,m,n,p,w,q){e.FeatureCollectionSnappingSource=class extends r{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const {view:a}=this,{layer:b}=this.layerSource,c=null!=a&&"3d"===a.type;return c&&"subtype-group"!==b.type?p.getSnappingCandidateElevationAligner(c,{elevationInfo:b.elevationInfo,alignPointsInFeatures:async(d,h)=>(await k.whenOrAbort(a.whenLayerView(b),h)).elevationAlignPointsInFeatures(d,h)}):p.getSnappingCandidateElevationAligner()}get _snappingElevationFilter(){const {view:a}=
this;return w.getSnappingCandidateElevationFilter(null!=a&&"3d"===a.type&&"subtype-group"!==this.layerSource.layer.type)}get _symbologySnappingFetcher(){const {view:a}=this,{layer:b}=this.layerSource;return null==a||"3d"!==a.type||"subtype-group"===b.type?q.getSymbologySnappingCandidatesFetcher():q.getSymbologySnappingCandidatesFetcher(this._symbologySnappingSupported,async(c,d)=>{const h=await a.whenLayerView(b);k.throwIfAborted(d);return h.queryForSymbologySnapping({candidates:c,spatialReference:a.spatialReference},
d)})}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const {view:a}=this,{layer:b}=this.layerSource;null!=a&&"3d"===a.type&&"subtype-group"!==b.type&&(a.whenLayerView(b).then(c=>this._layerView3D=c),this.addHandles([a.elevationProvider.on("elevation-change",({context:c})=>{const {elevationInfo:d}=b;v.elevationContextAffectsAlignment(c,d)&&this._snappingElevationAligner.notifyElevationSourceChange()}),l.watch(()=>b.elevationInfo,
()=>this._snappingElevationAligner.notifyElevationSourceChange(),l.initial),l.watch(()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),l.initial),l.on(()=>this._layerView3D?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())]))}constructor(a){super(a);this._layerView3D=this.view=null;this._memoizedMakeGetGroundElevation=t.memoize(n.makeGetGroundElevation)}refresh(){}async fetchCandidates(a,
b){var {layer:c}=this.layerSource,d=c.source;if(!d?.querySnapping)return[];c=m.makeFilter(c);c=m.makeSnappingQuery(a,this.view?.type??"2d",c);d=await d.querySnapping(c,{signal:b});k.throwIfAborted(b);a=a.coordinateHelper.spatialReference;d=await this._snappingElevationAligner.alignCandidates(d.candidates,a,b);k.throwIfAborted(b);const h=await this._symbologySnappingFetcher.fetch(d,b);k.throwIfAborted(b);b=0===h.length?d:[...d,...h];b=this._snappingElevationFilter.filter(c,b);const x=this._memoizedMakeGetGroundElevation(this.view,
a);return b.map(y=>n.convertSnappingCandidate(y,x))}};f.__decorate([g.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"layerSource",void 0);f.__decorate([g.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"view",void 0);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationAligner",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationFilter",null);f.__decorate([g.property()],
e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingFetcher",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_layerView3D",void 0);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingSupported",null);e.FeatureCollectionSnappingSource=f.__decorate([u.subclass("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],e.FeatureCollectionSnappingSource);Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})});