// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../keybindings ../css ../../../../widgets/Widget ../../../../chunks/componentsUtils ../../../../widgets/support/widgetUtils ../../../../widgets/support/jsxFactory".split(" "),function(l,d,h,n,p,k,F,G,H,q,m,r,
t,u,I,e){const f=`${r.base}-editable-field`;var v=`${f}--input`,w=`${f}--locked`,x=`${f}__title`,y=`${f}__title__content`,z=`${f}__value`,A=`${f}__value__content`,B=`${f}__value__content--read-only`,C=`${f}__input`,D=`${f}__input-suffix`,E=`${f}__button`;d.TooltipEditableField=class extends t{constructor(){super(...arguments);this._input=null;this._selectText=()=>{const a=()=>{this._input===document.activeElement&&this._input?.selectText()};a();p.waitAnimationFrame().then(a)};this._onKeyDown=a=>{a.key===
m.tooltipKeys.discard&&this._discard()};this._onInputKeyDown=a=>{switch(a.key){case m.tooltipKeys.commit:return this._commit({type:"commit-and-exit",allowLockingCurrentValue:!0});case m.tooltipKeys.next:return a.preventDefault(),a.stopPropagation(),this._commit({type:a.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}};this._onInput=a=>{this.field.inputValue=a.target.value};this._onLockClick=()=>{const {field:a}=this;a.locked?a.unlock():this._lock()}}initialize(){this.addHandles(n.watch(()=>
this._rawDisplayValue,()=>{const {committed:a,inputValue:b}=this.field;a||b||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return u.loadCalciteComponents({action:()=>new Promise((a,b)=>l(["../../../../chunks/calcite-action"],a,b)),icon:()=>new Promise((a,b)=>l(["../../../../chunks/calcite-icon"],a,b)),input:()=>new Promise((a,b)=>l(["../../../../chunks/calcite-input"],a,b))})}render(){const {mode:a,field:b}=this,c="input"===a,{locked:g}=b;return e.tsx("div",{class:this.classes({[f]:!0,
[v]:"input"===a,[w]:g})},e.tsx("div",{class:x,key:"title"},e.tsx("div",{class:y,key:"title-content"},this._title,g&&!c?e.tsx("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),e.tsx("div",{class:z,key:"value"},c?this._renderInputModeValue():this._renderFeedbackModeValue()))}get _initialValue(){const {field:a}=this;return null!=a.actual?a.toInputUnits(a.actual,this.context).value:null}get _formattedValue(){const {context:a,field:b}=this,{actual:c,format:g}=b;return null!=c?g(c,a):"\u2014"}get _rawDisplayValue(){const {field:a}=
this,{inputValue:b,committed:c}=a;return null!=b?b:null!=c?this._toString(a.toInputUnits(c,this.context).value):this._toString(this._initialValue)}get _suffix(){const {suffix:a}=this.field;return"string"===typeof a?a:a(this.context)}get _title(){const {title:a}=this.field;return"string"===typeof a?a:a(this.context)}_renderFeedbackModeValue(){return e.tsx("span",{key:"value-feedback"},this._formattedValue)}_renderInputModeValue(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return e.tsx("span",
{class:B,key:"value-readonly"},this._formattedValue)}_renderValueWritable(){const {locked:a,name:b}=this.field;var c=this.context?.messages.sketch??{};c=a?c.unlockConstraint:c.lockConstraint;return e.tsx("div",{class:A,key:"value-writable",onkeydown:this._onKeyDown},e.tsx("calcite-input",{afterCreate:g=>{this._input=g},class:C,"data-field-name":b,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",type:"text",value:this._rawDisplayValue,onCalciteInputInput:this._onInput}),e.tsx("div",
{class:D,key:"suffix"},this._suffix),e.tsx("calcite-action",{alignment:"center",appearance:"transparent",class:E,compact:!0,icon:a?"lock":"unlock",label:c,onclick:this._onLockClick,scale:"s",tabIndex:-1,text:"",title:c}))}_commit({type:a,allowLockingCurrentValue:b}){const {_input:c,field:g}=this;c&&(g.locked&&""===g.inputValue?g.unlock():(b||null!=g.inputValue)&&this._lock(),this.context.onCommit(c,a))}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const {field:a}=
this;var b=this._parseNumber(a.inputValue);b=null!=b?a.createQuantity(b,this.context):null;a.lock(b)}_parseNumber(a){if(null==a)return null;a=parseFloat(a);return isNaN(a)||!isFinite(a)?null:a}_toString(a){return null!=a?a.toFixed(2):"\u2014"}};h.__decorate([k.property()],d.TooltipEditableField.prototype,"field",void 0);h.__decorate([k.property()],d.TooltipEditableField.prototype,"context",void 0);h.__decorate([k.property()],d.TooltipEditableField.prototype,"mode",void 0);h.__decorate([k.property()],
d.TooltipEditableField.prototype,"_initialValue",null);h.__decorate([k.property()],d.TooltipEditableField.prototype,"_formattedValue",null);h.__decorate([k.property()],d.TooltipEditableField.prototype,"_input",void 0);h.__decorate([k.property()],d.TooltipEditableField.prototype,"_rawDisplayValue",null);h.__decorate([k.property()],d.TooltipEditableField.prototype,"_suffix",null);h.__decorate([k.property()],d.TooltipEditableField.prototype,"_title",null);d.TooltipEditableField=h.__decorate([q.subclass("esri.views.interactive.tooltip.components.TooltipEditableField")],
d.TooltipEditableField);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});