// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/tslib.es6 ../../../../intl ../../../../core/a11yUtils ../../../../core/memoize ../../../../core/promiseUtils ../../../../core/quantityFormatUtils ../../../../core/scheduling ../../../../core/unitFormatUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../support/getDefaultUnitForView ../../keybindings ../css ../../../support/angularMeasurementUtils ../../../../widgets/Widget ../../../../chunks/componentsUtils ../../../../widgets/support/widgetUtils ../../../../widgets/support/decorators/messageBundle ../../../../widgets/support/jsxFactory ../../../../intl/number".split(" "),
function(r,e,f,I,y,z,p,k,A,B,t,g,J,K,L,C,u,D,l,E,F,G,H,v,h,q){function w(a){return(Array.isArray(a)?a:[a]).flat(10).filter(c=>!!c)}e.TooltipContent=class extends F{constructor(){super(...arguments);this._focusAbortController=new AbortController;this._transition=null;this._mode="feedback";this._getFormatters=z.memoize((a,c)=>({angleRelative:b=>q.formatNumber(b,{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:"exceptZero"}),direction:b=>k.formatAngle(b,b.rotationType,1),directionRelative:b=>
{b=E.getDegreesGeographic(b);return q.formatNumber(b,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:1,minimumFractionDigits:1,signDisplay:0<b?"never":"exceptZero"})},directionRelativeBilateral:b=>k.formatAngle(b,b.rotationType,1),area:(b,d)=>k.formatArea(a,b,d??c.area),length:(b,d,m)=>k.formatLength(a,b,d??c.length,m),lengthRelative:(b,d)=>k.formatRelativeLength(a,b,d??c.length),totalLength:(b,d)=>k.formatLength(a,b,d??c.length),verticalLength:(b,d)=>k.formatVerticalLength(a,
b,d??c.length),verticalLengthRelative:(b,d)=>k.formatRelativeVerticalLength(a,b,d??c.verticalLength),percentage:b=>q.formatNumber(b.value,{style:"percent"}),scale:b=>q.formatNumber(b,{style:"percent",maximumFractionDigits:0})}));this._onDiscard=()=>{this.exitInputMode()};this._onCommit=(a,c)=>{if("commit-and-exit"===c)this.exitInputMode();else{var b=this._getFocusableElements(),d=b.length;a=b.indexOf(a);-1===a?this.exitInputMode():b.at(((a+("commit-and-next"===c?1:-1))%d+d)%d)?.setFocus()}};this._handleTab=
a=>{if(a.code===D.tooltipKeys.next){var c=this._getFocusableElements(),b=c.at(0);c=c.at(-1);b&&c&&(a.shiftKey?document.activeElement===b&&(a.preventDefault(),c?.setFocus()):document.activeElement===c&&(a.preventDefault(),b?.setFocus()))}}}get mode(){return this._mode}get _displayUnits(){const a=u.getDefaultUnitForView(this.tooltip.view);return{length:a,verticalLength:a,area:a,angle:"degrees"}}get _inputUnitInfos(){const a=this._messagesUnits;var c=n=>({unit:n,abbreviation:B.unitName(a,n,"abbr")}),
b=u.getDefaultUnitForView(this.tooltip.view);const d=c(t.defaultLengthUnit(b)),m=c(t.defaultVerticalLengthUnit(b));b=c(t.defaultAreaUnit(b));c=c("degrees");return{length:d,lengthRelative:d,verticalLength:m,verticalLengthRelative:m,area:b,direction:c,orientation:c,rotation:c}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,
onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const a=w(this._renderContent()),{visibleElements:c}=this.info.sketchOptions.tooltips,b=c.helpMessage?this._getHelpMessage():null,d=0<a.length,m=d||!!b,n="input"===this.mode,x=w(this._renderActions());return h.tsx("div",{class:H.classes(l.content,n&&l.contentInputMode),onkeydown:this._handleTab},n&&m&&c.header?h.tsx("div",{class:l.contentHeader,key:"header"},h.tsx("calcite-button",{appearance:"transparent",iconFlipRtl:"both",iconStart:"chevron-left",
key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),0<x.length?h.tsx(h.tsxFragment,null,h.tsx("div",{class:l.contentHeaderSpacer,key:"spacer"}),h.tsx("div",{class:l.contentHeaderActions,key:"actions"},x)):null):null,d?h.tsx("div",{class:l.table,key:"content"},...a):null,b?h.tsx("div",{class:l.helpMessage,key:"help-message"},b):null)}_renderActions(){return null}loadDependencies(){return G.loadCalciteComponents({button:()=>new Promise((a,c)=>r(["../../../../chunks/calcite-button"],
a,c)),icon:()=>new Promise((a,c)=>r(["../../../../chunks/calcite-icon"],a,c)),input:()=>new Promise((a,c)=>r(["../../../../chunks/calcite-input"],a,c))})}async enterInputMode(a){try{await this._transitionTo("input"),await this._focusField(a)}catch(c){p.throwIfNotAbortError(c)}}async exitInputMode(){try{await this._transitionTo("feedback"),document.querySelector(".esri-view-surface").focus()}catch(a){p.throwIfNotAbortError(a)}}_getHelpMessage(a){const {info:c}=this,{helpMessage:b,viewType:d}=c;return(a=
a??b)?this._messagesTooltip?.sketch?.["3d"===d?"helpMessages3d":"helpMessages2d"]?.[a]:void 0}async _focusField(a){this._focusAbortController?.abort();this._focusAbortController=new AbortController;var {signal:c}=this._focusAbortController;await this._waitForInputs();p.throwIfAborted(c);c=this._getFocusableInputs();(a?c.find(b=>b.getAttribute("data-field-name")===a):c.at(0))?.setFocus()}async _transitionTo(a){if(this._mode!==a){var c=()=>{this._mode=a;this.tooltip.positionMode="input"===a?"fixed":
"follow-cursor"};if(this.domNode?.firstChild&&document.startViewTransition&&!y.prefersReducedMotion()){this.autoRenderingEnabled=!1;this._transition?.skipTransition();var b=this._transition=document.startViewTransition(()=>{if(!this.destroyed)return this.autoRenderingEnabled=!0,c(),this.renderNow(),A.waitTick()});try{await this._transition.finished}finally{b===this._transition&&(this._transition=null)}}else c()}}async _waitForInputs(){const a=Date.now(),c=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??
[]);for(;0===c().length&&!(await p.after(50),1E3<Date.now()-a););}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const a=this.domNode?.querySelector(`.${l.drawContentHeaderActions}`);return[...Array.from(a?.querySelectorAll("calcite-action:not([disabled])")??[]),...this._getFocusableInputs()]}};f.__decorate([v.messageBundle("esri/core/t9n/Units"),g.property()],e.TooltipContent.prototype,"_messagesUnits",
void 0);f.__decorate([v.messageBundle("esri/views/interactive/tooltip/t9n/Tooltip"),g.property()],e.TooltipContent.prototype,"_messagesTooltip",void 0);f.__decorate([g.property()],e.TooltipContent.prototype,"info",void 0);f.__decorate([g.property()],e.TooltipContent.prototype,"tooltip",void 0);f.__decorate([g.property()],e.TooltipContent.prototype,"_mode",void 0);f.__decorate([g.property()],e.TooltipContent.prototype,"mode",null);f.__decorate([g.property()],e.TooltipContent.prototype,"_displayUnits",
null);f.__decorate([g.property()],e.TooltipContent.prototype,"_inputUnitInfos",null);f.__decorate([g.property()],e.TooltipContent.prototype,"_formatters",null);f.__decorate([g.property()],e.TooltipContent.prototype,"fieldContext",null);e.TooltipContent=f.__decorate([C.subclass("esri.views.interactive.tooltip.content.TooltipContent")],e.TooltipContent);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});