// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(g,n,p,q,h,k){const e=()=>n.getLogger("esri.views.webgl.VertexArrayObject");g.VertexArrayObject=class{constructor(a,b,c,d,f=null){this._context=a;this._locations=b;this._layout=c;this._buffers=d;this._indexBuffer=f;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((a,
b)=>a+this._buffers[b].usedMemory,null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*q.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const a in this._buffers)this._buffers[a]?.dispose(),delete this._buffers[a];this._indexBuffer=p.disposeMaybe(this._indexBuffer);
this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&e().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(h.ResourceType.VertexArrayObject,this));this._context=null}initialize(){if(!this._initialized){var a=this._context?.capabilities?.vao;if(a){const b=a.createVertexArray();a.bindVertexArray(b);this._bindLayout();a.bindVertexArray(null);
this._glName=b;this._context.instanceCounter.increment(h.ResourceType.VertexArrayObject,this)}this._initialized=!0}}bind(){this.initialize();const a=this._context?.capabilities?.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const {_buffers:a,_layout:b,_indexBuffer:c}=this;a||e().error("Vertex buffer dictionary is empty!");const d=this._context.gl;for(const f in a){const l=a[f];l||e().error("Vertex buffer is uninitialized!");const m=b[f];m||e().error("Vertex element descriptor is empty!");
k.bindVertexBufferLayout(this._context,this._locations,l,m)}null!=c&&(this._context.capabilities.vao?d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c.glName):this._context.bindBuffer(c))}unbind(){this.initialize();const a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const {_buffers:a,_layout:b}=this;a||e().error("Vertex buffer dictionary is empty!");for(const c in a){const d=a[c];d||e().error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,
this._locations,d,b[c])}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});