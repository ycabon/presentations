// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../chunks/tslib.es6 ../core/Logger ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./CoordinateConversion/CoordinateConversionViewModel ./CoordinateConversion/support/Conversion ./support/globalCss ./support/Heading ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(h,w,D,p,E,g,J,F,G,x,y,l,z,q,t,A,c,B){function u(a){return a["data-format"]}const C={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0};g=class extends G{constructor(a,b){super(a,b);this._popupMessage=null;this._clipboardPopupTimeoutId=this._popupTimeoutId=void 0;this._coordinateInput=null;this._goToEnabled=this._badInput=!1;this._previewConversion=this._settingsFormat=this._conversionFormat=null;this._inputVisible=this._settingsVisible=this._popupVisible=this._clipboardPopupVisible=
this._expanded=!1;this.headingLevel=4;this.messagesCommon=this.messages=null;this.orientation="auto";this.viewModel=new x;this.visibleElements={...C}}get conversions(){return this.viewModel.conversions}set conversions(a){this.viewModel.conversions=a}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(a){this.viewModel.currentLocation=a}get formats(){return this.viewModel.formats}set formats(a){this.viewModel.formats=a}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(a){this.viewModel.goToOverride=
a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get mode(){return this.viewModel.mode}set mode(a){this.viewModel.mode=a}set multipleConversions(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",a)}get multipleConversions(){const a=this._get("multipleConversions");return"boolean"===typeof a?a:!0}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(a){this.viewModel.locationSymbol=
a}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(a){this.viewModel.storageEnabled=a}get storageType(){return this.viewModel.storageType}set storageType(a){this.viewModel.storageType=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}castVisibleElements(a){return{...C,...a}}reverseConvert(a,b){return this.viewModel.reverseConvert(a,b)}render(){const a=this.viewModel?.state,b="disabled"===a?c.tsx("div",{key:"esri-coordinate__no-basemap"},this.messages?.noBasemap):
null,d=!b&&this._inputVisible?this._renderInputForm():null,f=!b&&this._settingsVisible?this._renderSettings():null,k=b||d||f?null:this._renderConversionsView(),e=this._popupVisible?this._renderPopup():null;return c.tsx("div",{class:this.classes("esri-coordinate-conversion",l.globalCss.widget,{["esri-coordinate-conversion--capture-mode"]:"capture"===this.mode,[l.globalCss.disabled]:"loading"===a,["esri-coordinate-conversion--no-basemap"]:"disabled"===a})},e,b,k,f,d)}_addConversion(a){a=a.target;var b=
u(a.options[a.options.selectedIndex]);const d=a["data-index"];null!=b&&null!=d&&(b=new y({format:b}),a.options.selectedIndex=0,0<=d?(this.conversions.removeAt(d),this.conversions.add(b,d)):this.conversions.add(b))}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((a,b)=>{b=b.format;return b?.hasDisplayProperties?b:a},null)||this.formats.find(a=>a.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0);
this._popupVisible=!1;this._popupMessage=null;this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0);this._clipboardPopupVisible=!1;this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1;this._coordinateInput.value=""}_onCopy(a){const b=a.currentTarget["data-conversion"]?.displayCoordinate;null!=b&&(a.clipboardData?.setData("text/plain",b),this._showClipboardPopup(),a.preventDefault())}_processUserInput(a){a=
D.maybeProperty(a,"key");const b=this.viewModel;"Enter"!==a&&a?this._badInput&&(this._badInput=!1):(a=u(this._coordinateInput))&&this._reverseConvert(this._coordinateInput.value,a).then(d=>{"capture"===this.mode?b.resume():this.mode="capture";this.currentLocation=d;b.setLocation(d);this._onConvertComplete()}).catch(d=>{w.getLogger(this).error(d);this._showPopup(this.messages?.invalidCoordinate);this._badInput=!0})}async _reverseConvert(a,b){const d=this.viewModel;a=await b.reverseConvert(a);this._goToEnabled&&
a&&d.goToLocation(a).catch(f=>{w.getLogger(this).warn(f);this._showPopup(this.messages?.locationOffBasemap)});return a}_setInputFormat(a){a=a.target;a=u(a[a.options.selectedIndex]);null!=a&&(this._conversionFormat=a)}_setPreviewConversion(){const a=this._findSettingsFormat(),b=this.viewModel;if(a){const d=this.conversions.find(f=>f.format===a);this._previewConversion=new y({format:a,position:{location:this.currentLocation,coordinate:d?.position?.coordinate}});this._previewConversion.position?.coordinate||
b.previewConversion(this._previewConversion)}}_setSettingsFormat(a){a=a.target;a=u(a[a.options.selectedIndex]);null!=a&&(this._settingsFormat=a,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hideClipboardPopup()},750)}_showPopup(a,b=2500){this._popupMessage=a;this._popupVisible?clearTimeout(this._popupTimeoutId):
this._popupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hidePopup()},b)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(a){a.stopPropagation();a=a.target;const b=this._findSettingsFormat();b&&(b.currentPattern=a.value)}_renderConversion(a,b){const {messages:d}=this;if(!d)return c.tsx("li",null);const {format:f}=a,k=f?.label??"",e=`${this.id}__list-item-${b}`,n=`${k} ${d.conversionOutputSuffix}`;var m=0===b;const r=
m||this._expanded,v=m?this._renderFirstConversion(a):this._renderTools(b,a,e);m=m&&!a.displayCoordinate?d.noLocation:a.displayCoordinate;m=c.tsx("div",{"aria-label":m,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabIndex:0,title:m??""},m);const I=this._renderOptions(this.formats.filter(H=>H!==f));return r?c.tsx("li",{"aria-label":n,class:"esri-coordinate-conversion__row",id:e,key:a,role:"group",tabIndex:0,title:n},c.tsx("select",{"aria-controls":e,"aria-label":d.selectFormat,
bind:this,class:this.classes(l.globalCss.select,"esri-coordinate-conversion__select-row"),"data-index":b,onchange:this._addConversion,title:d.selectFormat},c.tsx("option",{"aria-label":k,selected:!0,title:k},k.toUpperCase()),I),m,v):null}_renderCopyButton(a){const b=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:d}=this;return d?c.tsx("li",{"aria-label":d.copy,bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__row-button"),"data-conversion":a,
onclick:this._copyCoordinateOutput,oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:d.copy},b,c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.duplicate})):c.tsx("li",null)}_renderFirstConversion(a){var b=this.id;const d={[q.legacyIcon.down]:!this._expanded,[q.legacyIcon.up]:this._expanded},{messages:f,messagesCommon:k,multipleConversions:e,visibleElements:n}=this;if(!k||!f)return c.tsx("ul",null);var m="live"===this.mode?f.captureMode:f.liveMode;const r=
this._expanded?k.collapse:k.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):null;b=e&&n.expandButton&&c.tsx("li",{"aria-controls":`${b}__${"esri-coordinate-conversion__conversion-list"}`,"aria-label":r,bind:this,class:l.globalCss.widgetButton,key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabIndex:0,title:r},c.tsx("span",{"aria-hidden":"true",class:this.classes(d)}));m=!e&&n.captureButton&&c.tsx("li",
{"aria-label":m,bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__mode-toggle"),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabIndex:0,title:m},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.mapPin}));return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},a,b,m)}_renderInputForm(){const a=this._conversionFormat||this.conversions.at(0).format;var b=this.formats.findIndex(r=>r.name===a?.name),
d=this.id;const f=`${d}__${"esri-coordinate-conversion__input-coordinate"}`;d=`${d}__${"esri-coordinate-conversion__input-coordinate"}__header`;b=this._renderOptions(this.formats,!0,b);const k={["esri-coordinate-conversion__input-coordinate--rejected"]:this._badInput},{messages:e,messagesCommon:n,headingLevel:m}=this;return n&&e?c.tsx("div",{"aria-labelledby":d,class:"esri-coordinate-conversion__input-form",key:"esri-coordinate-conversion__input-form",role:"search"},c.tsx("div",{class:"esri-coordinate-conversion__heading"},
c.tsx("div",{"aria-label":n.back,bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__back-button"),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabIndex:0,title:n.back},this._renderBackIcon()),c.tsx(z.Heading,{class:l.globalCss.heading,id:d,level:m},e.inputCoordTitle)),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},c.tsx("select",{"aria-controls":f,"aria-label":e.selectFormat,bind:this,class:this.classes(l.globalCss.select,
"esri-coordinate-conversion__select-row"),onchange:this._setInputFormat,title:e.selectFormat},b),c.tsx("input",{afterCreate:B.storeNode,"aria-labelledby":d,"aria-required":"true",bind:this,class:this.classes("esri-coordinate-conversion__input-coordinate",l.globalCss.input,k),"data-format":a,"data-node-ref":"_coordinateInput",id:f,onkeydown:this._processUserInput,placeholder:e.inputCoordTitle,role:"textbox",spellcheck:!1,title:e.inputCoordTitle,type:"text"})),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},
c.tsx("label",{"aria-label":e.goTo},c.tsx("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:e.goTo,type:"checkbox"}),e.goTo),c.tsx("button",{"aria-label":e.convert,bind:this,class:this.classes("esri-coordinate-conversion__button",l.globalCss.button),onclick:this._processUserInput,title:e.convert,type:"button"},c.tsx("span",{class:"esri-coordinate-conversion__convert-button-span"},e.convert)))):c.tsx("div",null)}_renderConversionsView(){var {messages:a}=this;if(!a)return c.tsx("div",
null);const b=`${this.id}__${"esri-coordinate-conversion__conversion-list"}`,d=this._renderPrimaryTools(),f=this._renderOptions(this.formats),k=this.conversions.map((e,n)=>this._renderConversion(e,n)).toArray();a=this._expanded?c.tsx("div",{class:"esri-coordinate-conversion__row"},c.tsx("select",{"aria-controls":b,"aria-label":a.addConversion,bind:this,class:this.classes(l.globalCss.select,"esri-coordinate-conversion__select-primary"),"data-index":-1,onchange:this._addConversion,title:a.addConversion},
c.tsx("option",{disabled:!0,selected:!0,value:""},a.addConversion),f),d):null;return c.tsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",{["esri-coordinate-conversion__conversions-view--expanded"]:this._expanded,["esri-coordinate-conversion__conversions-view--expand-up"]:"expand-up"===this.orientation,["esri-coordinate-conversion__conversions-view--expand-down"]:"expand-down"===this.orientation}),key:"esri-coordinate-conversion__main-view"},c.tsx("ul",{"aria-expanded":this._expanded?
"true":"false",class:"esri-coordinate-conversion__conversion-list",id:b},k),a)}_renderOptions(a,b,d){const f=this.conversions.at(0),k=f.format?.name;return a.map((e,n)=>{const m=b||!f?!1:k===e.name||this.conversions.map(r=>r.format?.name).includes(e.name);return c.tsx("option",{"aria-label":e.label,"data-format":e,disabled:m,key:e.name??"unnamed-format",selected:n===d,value:e.label},e.label.toUpperCase())}).toArray()}_renderPopup(){return c.tsx("div",{class:"esri-coordinate-conversion__popup",role:"alert"},
this._popupMessage)}_renderClipboardPopup(){const {messages:a}=this;return a?c.tsx("div",{class:this.classes("esri-coordinate-conversion__popup","esri-coordinate-conversion__clipboard-popup"),role:"alert"},a.copySuccessMessage):c.tsx("div",null)}_renderPrimaryTools(){const {messages:a,visibleElements:b}=this;if(!a)return c.tsx("ul",null);var d="live"===this.mode?a.captureMode:a.liveMode;const f=b.inputButton&&c.tsx("li",{bind:this,class:l.globalCss.widgetButton,onclick:this._toggleInputVisibility,
onkeydown:this._toggleInputVisibility,role:"button",tabIndex:0,title:a.inputCoordTitle},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.edit}));d=b.captureButton&&c.tsx("li",{bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__mode-toggle"),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabIndex:0,title:d},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.mapPin}));const k=b.settingsButton&&c.tsx("li",{bind:this,class:l.globalCss.widgetButton,
onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabIndex:0,title:a.settingsTitle},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.settings2}));return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},f,d,k)}_renderSettings(){var a=this.id;const b=`${a}__${"esri-coordinate-conversion__pattern-input"}`,d=`${a}__${"esri-coordinate-conversion__pattern-input"}__header`;a=`${a}__${"esri-coordinate-conversion__preview-coordinate"}`;var f=this.formats.filter(v=>
v.hasDisplayProperties),k=this._findSettingsFormat();const e=k?f.indexOf(k):-1;f=this._renderOptions(f,!0,e);k=k?.currentPattern;const {messages:n,messagesCommon:m,headingLevel:r}=this;return m&&n?c.tsx("div",{"aria-labelledby":d,class:"esri-coordinate-conversion__settings",key:"esri-coordinate-conversion__settings"},c.tsx("div",{class:"esri-coordinate-conversion__heading"},c.tsx("div",{bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__back-button"),onclick:this._toggleSettingsVisibility,
onkeydown:this._toggleSettingsVisibility,role:"button",tabIndex:0,title:m.back},this._renderBackIcon()),c.tsx(z.Heading,{class:l.globalCss.heading,id:d,level:r},n.settingsTitle)),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},c.tsx("label",{for:b},n.changeCoordinateDisplay),c.tsx("select",{"aria-label":n.selectFormat,bind:this,class:l.globalCss.select,onchange:this._setSettingsFormat,title:n.selectFormat},f),c.tsx("div",{class:"esri-coordinate-conversion__settings-group-horizontal"},
c.tsx("input",{"aria-controls":a,bind:this,class:this.classes("esri-coordinate-conversion__pattern-input",l.globalCss.input),id:b,oninput:this._updateCurrentPattern,spellcheck:!1,title:n.changeCoordinateDisplay,type:"text",value:k}),c.tsx("div",{"aria-controls":b,bind:this,class:l.globalCss.widgetButton,onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabIndex:0,title:n.defaultPattern},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.refresh})))),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},
c.tsx("label",null,m.preview,c.tsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabIndex:0},this._previewConversion?.displayCoordinate)))):c.tsx("div",null)}_renderBackIcon(){return c.tsx("span",{"aria-hidden":"true",class:B.isRTL(this.container)?q.legacyIcon.rightArrow:q.legacyIcon.leftArrows})}_renderTools(a,b,d){b=b.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(b):null;const {messages:f}=this;return f?c.tsx("ul",{class:"esri-coordinate-conversion__tools",
role:"listitem"},b,c.tsx("li",{"aria-controls":d,"aria-label":f.removeConversion,bind:this,class:this.classes(l.globalCss.widgetButton,"esri-coordinate-conversion__row-button"),"data-index":a,key:`${d}__${l.globalCss.widgetButton}`,onclick:this._removeConversion,onkeydown:this._removeConversion,role:"button",tabIndex:0,title:f.removeConversion},c.tsx("span",{"aria-hidden":"true",class:q.legacyIcon.close}))):c.tsx("ul",null)}_copyCoordinateOutput(a){a=a.target;if(!("createTextRange"in document.body)){const b=
window.getSelection(),d=document.createRange();d.selectNodeContents(a);b?.removeAllRanges();b?.addRange(d)}document.execCommand("copy")}_removeConversion(a){a=a.currentTarget["data-index"];null!=a&&this.conversions.removeAt(a)}_setDefaultPattern(a){a.stopPropagation();if(a=this._findSettingsFormat())a.currentPattern=a.defaultPattern}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible;this._popupVisible&&this._hidePopup();this._inputVisible?
this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode="live"===this.mode?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};h.__decorate([p.property()],g.prototype,"conversions",null);h.__decorate([p.property()],g.prototype,"currentLocation",null);h.__decorate([p.property()],g.prototype,"formats",null);h.__decorate([p.property()],
g.prototype,"goToOverride",null);h.__decorate([p.property()],g.prototype,"headingLevel",void 0);h.__decorate([p.property()],g.prototype,"label",null);h.__decorate([p.property(),A.messageBundle("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],g.prototype,"messages",void 0);h.__decorate([p.property(),A.messageBundle("esri/t9n/common")],g.prototype,"messagesCommon",void 0);h.__decorate([p.property()],g.prototype,"mode",null);h.__decorate([p.property()],g.prototype,"orientation",void 0);
h.__decorate([p.property()],g.prototype,"multipleConversions",null);h.__decorate([p.property()],g.prototype,"locationSymbol",null);h.__decorate([p.property()],g.prototype,"storageEnabled",null);h.__decorate([p.property()],g.prototype,"storageType",null);h.__decorate([p.property()],g.prototype,"view",null);h.__decorate([p.property({type:x})],g.prototype,"viewModel",void 0);h.__decorate([p.property()],g.prototype,"visibleElements",void 0);h.__decorate([E.cast("visibleElements")],g.prototype,"castVisibleElements",
null);h.__decorate([t.accessibleHandler()],g.prototype,"_copyCoordinateOutput",null);h.__decorate([t.accessibleHandler()],g.prototype,"_removeConversion",null);h.__decorate([t.accessibleHandler()],g.prototype,"_setDefaultPattern",null);h.__decorate([t.accessibleHandler()],g.prototype,"_toggleExpand",null);h.__decorate([t.accessibleHandler()],g.prototype,"_toggleInputVisibility",null);h.__decorate([t.accessibleHandler()],g.prototype,"_toggleMode",null);h.__decorate([t.accessibleHandler()],g.prototype,
"_toggleSettingsVisibility",null);return g=h.__decorate([F.subclass("esri.widgets.CoordinateConversion")],g)});