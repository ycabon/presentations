// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/events ../core/handleUtils ../core/maybe ../core/reactiveUtils ../core/string ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ../properties/defaultUnit ../rest/support/Stop ../symbols/SimpleMarkerSymbol ./Search ./Widget ./Directions/css ./Directions/DirectionsViewModel ./Directions/components/SaveLayer ./Directions/support/directionsUtils ./Search/support/locatorUtils ../chunks/componentsUtils ./support/globalCss ./support/Heading ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../chunks/sortable.esm ../intl/number".split(" "),
function(C,m,k,D,P,I,x,Q,n,R,fa,ha,S,T,U,V,W,X,d,J,Y,u,K,Z,r,A,y,B,F,e,ia,aa,ba){function ca(a){const {branchName:b,displayText:c,exitName:f,intersectingName:g,name:h,objectId:l,towardName:v}=a;if(null==c)return null;a=[b,f,g,h,v].filter(Boolean).sort((t,q)=>q.length-t.length).map(t=>Q.escapeRegExpString(t));if(!a.length)return c;a=new RegExp(a.join("|"),"g");a=c.matchAll(a);let p=0;const w=[];for(const {0:t,index:q}of a)w.push(c.slice(p,q),e.tsx("span",{class:d.css.maneuverPlaceName},t)),p=q+t.length;
w.push(c.slice(p));return e.tsx("span",{id:`${d.css.maneuver}-${l}`},w)}function L(a){return!!a.composedPath?.().find(b=>b.classList?.contains("esri-search__suggestions-list"))}function da(a){a=new Date(a);return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())}function G(a){return a?.["data-stop-index"]}const M={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};k=class extends X{constructor(a,b){super(a,b);this._activeManeuver=this._activeStop=
null;this._autoStopRemovalDelay=100;this._autoStopRemovalTimeoutId=void 0;this._saveAsButtonNode=this._renderSavePopoverFunction=this._pointerPressedSearchSuggestionStop=this._pointerDownUpHandle=this._newPlaceholderStop=this._focusedManeuver=null;this._saveLayer=new Y.SaveLayer;this._sortable=this._sections=null;this._stopsToSearches=new Map;this._viewClickHandle=null;this.headingLevel=2;this.iconClass=d.css.widgetIcon;this.searchProperties=this.messagesUnits=this.messagesCommon=this.messages=this.icon=
null;this.viewModel=new J;this.visibleElements={...M};this._setUpDragAndDropStops=c=>{this._sortable=aa.Sortable.create(c,{draggable:`.${d.css.validStopRow}`,ghostClass:d.css.stopRowGhost,handle:`.${d.css.stopHandle}`,onEnd:this._handleStopInputDragEnd})};this._handleDragHandlePointerDown=()=>this.viewModel.layer?.stops.forEach(c=>this.acquireSearch(c).activeMenu="none");this._handleStopInputDragEnd=({oldIndex:c,newIndex:f,target:g})=>{if(c!==f&&null!=f&&null!=c){var {children:h}=g,l=h[c];g.insertBefore(h[f],
0>f-c?l.nextElementSibling:l);({stops:g}=this.viewModel.layer);g.reorder(g.at(c),f);for(const v of g)v.sequence=null;this._solveRoute()}}}initialize(){this.addHandles([x.watch(()=>this.viewModel.layer?.routeInfo,()=>{this._focusedManeuver=this._activeManeuver=null;this._sections=this._getSections();this.scheduleRender()},x.initial),x.when(()=>this.view,(a,b)=>{b&&(this._viewClickHandle=null,null!=b&&this.removeHandles(b));if(a){b=this._prepPointerDownUpClick();const c=this._prepViewClick();b.pause();
c.pause();const f=a.surface;this.addHandles([D.on(f,"mousedown",()=>this._autoStopRemovalDelay=500),D.on(f,"mouseup",()=>this._autoStopRemovalDelay=100),b,c],a);this._pointerDownUpHandle=b;this._viewClickHandle=c}},x.initial),x.when(()=>null==this.viewModel.serviceDescription,()=>{try{this.viewModel.load()}catch{}},x.initial),x.watch(()=>this._saveLayer.state,()=>{this.scheduleRender()})]);this.when(()=>{!this.destroyed&&this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),
this._projector.append(document.body,this._renderSavePopoverFunction))})}loadDependencies(){return Z.loadCalciteComponents({button:()=>new Promise((a,b)=>C(["../chunks/calcite-button"],a,b)),icon:()=>new Promise((a,b)=>C(["../chunks/calcite-icon"],a,b)),"input-date-picker":()=>new Promise((a,b)=>C(["../chunks/calcite-input-date-picker"],a,b)),"input-time-picker":()=>new Promise((a,b)=>C(["../chunks/calcite-input-time-picker"],a,b)),link:()=>new Promise((a,b)=>C(["../chunks/calcite-link"],a,b)),popover:()=>
new Promise((a,b)=>C(["../chunks/calcite-popover"],a,b))})}destroy(){for(const a of this._stopsToSearches.values())a.destroy();this._sortable?.destroy();null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(a){this.viewModel.apiKey=a}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(a){this.viewModel.goToOverride=a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",
a)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(a){this.viewModel.layer=a}get maxStops(){return this.viewModel.maxStops}set maxStops(a){this.viewModel.maxStops=a}get unit(){return this.defaultUnit}set unit(a){this._overrideIfSome("unit",a)}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}castVisibleElements(a){return{...M,...a}}acquireSearch(a){const {view:b}=this.viewModel;if(this._stopsToSearches.has(a)){const f=this._stopsToSearches.get(a);
f.view=b;this._overrideDefaultSources(f);return f}const c=new W({view:b,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});this._normalizeSearchSources(c);this.addHandles([x.on(()=>c.allSources,"change",()=>this._normalizeSearchSources(c)),c.on("select-result",()=>{a.geometry=c.selectedResult?.feature.geometry;a.name=c.selectedResult?.name;this._solveRoute()}),c.on("search-focus",()=>this._handleStopInputFocus(c,a)),c.on("search-blur",()=>this._handleStopInputBlur(c,a)),c.on("search-clear",
()=>{a.geometry=null;a.name=null;this._activeStop=a;this.viewModel.layer?.removeResult()}),x.watch(()=>c.searchTerm,f=>{a.name=f})],c);this._stopsToSearches.set(a,c);return c}getDirections(){return this.viewModel.getDirections()}render(){return e.tsx("div",{class:this.classes(d.css.base,r.globalCss.widget,r.globalCss.panel,d.css.scroller)},this._renderPanelContent())}save(){return this.viewModel.save()}saveAs(a,b={}){return this.viewModel.saveAs(a,b)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const {layer:a,
serviceDescription:b,state:c}=this.viewModel;var f="initializing"===c;const g="error"===c&&!b,h="unauthenticated"===c,l={[d.css.panelContentLoading]:f,[d.css.panelContentError]:g||!a,[d.css.panelContentSignIn]:h},v=f?"presentation":"group";f=a?h?this._renderSignIn():g?this._renderMessage(this._getErrorMessage()):f?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return e.tsx("div",{class:this.classes(d.css.panelContent,l),role:v},f)}_renderReadyContent(){return[this._renderStopsContainer(),
this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return e.tsx("div",{class:d.css.signInContent,key:"sign-in"},e.tsx(A.Heading,{class:d.css.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),e.tsx(A.Heading,{level:A.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),e.tsx("button",{bind:this,class:this.classes(r.globalCss.button,
r.globalCss.buttonSecondary,d.css.signInButton),onclick:this._handleSignInClick,tabIndex:0,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch(()=>{})}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const {selectedTravelMode:a,travelModes:b}=this.viewModel;if(0===b.length)return null;const c=null!=a?a.name:this.messages.travelMode;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.css.travelMode,
this._saveLayer.opened&&r.globalCss.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},e.tsx("select",{"aria-label":c,bind:this,class:this.classes(d.css.travelModeSelect,r.globalCss.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:c},b.map((f,g)=>e.tsx("option",{"data-mode":f,key:`esri-directions__travel-mode-${g}`,selected:a===f,value:`${g}`},f.name))))}_handleTravelModeChange(a){var b=a.currentTarget;a=this.viewModel;b=b.item(b.selectedIndex)?.["data-mode"];
a.selectedTravelMode=b;this._solveRoute()}_renderStopsContainer(){return this.visibleElements.stops?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.css.section,this._saveLayer.opened&&r.globalCss.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const {messages:{departAt:a,departureTime:b,leaveNow:c,timeUnspecified:f},viewModel:{departureOption:g}}=
this;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.css.departureTime,this._saveLayer.opened&&r.globalCss.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},e.tsx("select",{"aria-label":b,bind:this,class:this.classes(d.css.departureTimeSelect,r.globalCss.select),onchange:this._handleDepartureOptionChange,title:b},e.tsx("option",{selected:g===u.DepartureTimeOption.NOW,value:u.DepartureTimeOption.NOW},c),e.tsx("option",{selected:g===
u.DepartureTimeOption.DEPART_AT,value:u.DepartureTimeOption.DEPART_AT},a),e.tsx("option",{selected:g===u.DepartureTimeOption.UNSPECIFIED,value:u.DepartureTimeOption.UNSPECIFIED},f)),g===u.DepartureTimeOption.DEPART_AT?this._renderTimeControls():null)}_renderStops(){const {stops:a}=this.viewModel.layer;let b=0;for(var c of this._stopsToSearches.keys())a.includes(c)||this._disposeSearch(c);for(var f of a)c=this.acquireSearch(f),"none"!==c.activeMenu&&(b+=1),null!=f.name&&(c.searchTerm=f.name);f=a.toArray().map((g,
h)=>{var l=a.length;const v={[y.legacyIcon.radioUnchecked]:0<=h&&h<l-1,[y.legacyIcon.radioChecked]:h===l-1},p={[d.css.lastStopIconContainer]:h===l-1},w={[d.css.validStopRow]:!(1<h&&null==g.geometry)};var t=a.at(h+1),q=h===l-1,z=h===l-2;t=2===l&&0===h||2<l&&!q&&!z||2<l&&z&&null!=t?.geometry||2<l&&q&&null==g.geometry;l=3>l;q=this.acquireSearch(g);({messages:z}=this);const {removeStop:N,reverseStops:O,unlocated:ea}=z;var E=null!=g.geometry&&null!=g.name?g.name:ea,H=ba.formatNumber(h+1);z=`${z.stopLabel} ${H} (${E})`;
E=`${this.id}__stop--${h}`;g=!!q.searchTerm&&!!q.selectedResult&&null!=g.geometry&&q.selectedResult.name===g.name;H={zIndex:"none"!==q.activeMenu?`${b--}`:""};return e.tsx("li",{afterCreate:this._handleStopFieldCreation,"aria-label":z,bind:this,class:this.classes(d.css.stopRow,w),"data-stop-index":h,id:E,key:h,styles:H},e.tsx("div",{class:d.css.stopHandle},e.tsx("span",{"aria-hidden":"true",class:this.classes(d.css.stopIcon,y.legacyIcon.handleVertical,d.css.stopHandleIcon,d.css.interactiveStopIcon),
onpointerdown:this._handleDragHandlePointerDown}),e.tsx("div",{"aria-labelledby":E,bind:this,class:this.classes(d.css.stopIconContainer,p),"data-stop-index":h,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},e.tsx("span",{class:this.classes(d.css.stopIcon,v),tabIndex:g?0:void 0}))),e.tsx("div",{class:d.css.stopInput},q.render()),e.tsx("div",{class:d.css.stopOptions,role:"group"},e.tsx("div",{"aria-label":N,bind:this,class:d.css.removeStopButton,"data-stop-index":h,
hidden:l,onclick:this._handleRemoveStop,onkeydown:this._handleRemoveStop,role:"button",tabIndex:0,title:N},e.tsx("span",{"aria-hidden":"true",class:this.classes(d.css.stopIcon,d.css.removeStop,y.legacyIcon.trash,d.css.interactiveStopIcon)}),e.tsx("span",{class:y.legacyIcon.fontFallbackText},"removeStopTitle")),e.tsx("div",{"aria-label":O,bind:this,class:d.css.reverseStops,hidden:t,onclick:this._handleReverseStops,onkeydown:this._handleReverseStops,role:"button",tabIndex:0,title:O},e.tsx("span",{"aria-hidden":"true",
class:this.classes(d.css.stopIcon,y.legacyIcon.upDownArrows,d.css.interactiveStopIcon)}),e.tsx("span",{class:y.legacyIcon.fontFallbackText},"removeStopTitle"))))});c=this._renderAddStop();return e.tsx("div",null,e.tsx("ol",{afterCreate:this._setUpDragAndDropStops,class:d.css.stops,role:"group"},f),c)}_renderAddStop(){var a=this.viewModel.layer?.stops;if(!a)return null;const b=a.filter(({geometry:c})=>null!=c);a=a.at(-1);return 1<b.length&&b.length<this.maxStops&&null!=a?.geometry?e.tsx("div",{class:d.css.toolbarSection},
e.tsx("div",{class:d.css.toolbarButtons},e.tsx("calcite-button",{appearance:"outline",class:d.css.addStopButton,iconStart:"plus",key:d.css.addStopButton,kind:"neutral",label:this.messages.addStop,onclick:()=>{this._addNewPlaceholder()},round:!0,scale:"s",width:"full"},this.messages.addStop))):null}_handleStopIconClick(a){a=G(a.currentTarget);a=null!=a?this.viewModel.layer?.stops.at(a):void 0;a?.geometry&&this._centerAtStop(a)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(a){this.viewModel.centerAt(a)}_handleStopFieldCreation(a){const b=
this._newPlaceholderStop;if(b){a=G(a);a=null!=a?this.viewModel.layer?.stops.at(a):void 0;if(b===a){const c=this.acquireSearch(a);c.when(()=>{this.renderNow();c.focus()})}this._newPlaceholderStop=null}}_handleStopInputBlur(a,b){if(!this._saveLayer.opened)if(this.removeHandles("search-term"),a.selectedResult&&null!=b.geometry&&null!=a.selectedResult?.feature.geometry&&b.geometry===a.selectedResult?.feature.geometry)this._pointerDownUpHandle?.pause();else{var c=null!=b.geometry&&null!=a.selectedResult?.feature.geometry&&
b.geometry!==a.selectedResult?.feature.geometry;(null==b.geometry&&null==a.selectedResult?.feature.geometry||c)&&"none"===a.activeMenu&&a.searchTerm?(a.search(),this._pointerDownUpHandle?.pause()):a.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"===a.viewModel.state?this._pointerDownUpHandle?.pause():this._pointerPressedSearchSuggestionStop||(null!=b.geometry&&
(b.geometry=null,this._solveRoute()),this.scheduleRender()))},this._autoStopRemovalDelay))}}_handleStopInputFocus(a,b){this._pointerDownUpHandle?.resume();const {view:c}=this;if(!this.hasHandles("search-term")&&c){var f=c.cursor;this.addHandles([P.makeHandle(()=>{c.cursor=f}),x.watch(()=>a.searchTerm,g=>{a.destroyed||(c.cursor=g.length?f:"copy")},x.initial)],"search-term");this._activeStop=b}}_prepViewClick(){const {view:a}=this.viewModel;I.assertIsSome(a);I.assertIsSome(a.surface);const b=D.pausable(a,
"click",this._handleViewClick.bind(this)),c=D.pausable(a.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId);c.pause()});return{remove(){c.remove();b.remove()},pause(){c.pause();b.pause()},resume(){c.resume();b.resume()}}}_prepPointerDownUpClick(){const a=D.pausable(document,"pointerdown",c=>{this._pointerPressedSearchSuggestionStop=L(c)?this._activeStop:null}),b=D.pausable(document,"pointerup",c=>{this._pointerDownUpHandle?.pause();c=L(c);const f=this._activeStop;c||f!==this._pointerPressedSearchSuggestionStop||
this._removeStop(f);this.scheduleRender();this._pointerPressedSearchSuggestionStop=c?f:null});return{remove(){b.remove();a.remove()},pause(){b.pause();a.pause()},resume(){a.resume()}}}_handleViewClick(a){a.stopPropagation();const b=this._activeStop,c=b?this._stopsToSearches.get(b):null;b&&c&&!c.searchTerm&&(c.search(a.mapPoint).then(f=>{if(f=f?.results[0].results){var {feature:g,name:h}=f[0];b.geometry=g.geometry;b.name=h;c.searchTerm=h}}),this.scheduleRender());this._viewClickHandle?.pause();clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){this._pointerDownUpHandle?.pause();
if(!this._newPlaceholderStop){var a=new U({symbol:new V});this.viewModel.layer?.stops.add(a);this._newPlaceholderStop=a}}_handleReverseStops(){this._reverseStops()}_reverseStops(){const a=this.viewModel.layer?.stops??[];a.reverse();for(const b of a)b.sequence=null;this._solveRoute()}_handleRemoveStop(a){var {layer:b}=this.viewModel;if(b&&(a=G(a.currentTarget),null!=a)){var {stops:c,routeInfo:f}=b;b=c.at(a);this._removeStop(b);null==b.geometry&&null!=f||this._solveRoute()}}_removeStop(a){const {stops:b}=
this.viewModel.layer;!a||2>=b.length||(this._disposeSearch(a),b.remove(a))}_handleDepartureOptionChange(a){a=a.currentTarget;a=a.item(a.selectedIndex);this.viewModel.departureOption=a.value;this._solveRoute()}_renderTimeControls(){return this.viewModel.departureIsoDate&&this.viewModel.departureIsoTime?e.tsx("div",{class:d.css.departureTimeControls,key:d.css.departureTimeControls,role:"group"},e.tsx("div",{class:d.css.departureDateTimePickers},e.tsx("calcite-input-date-picker",{valueAsDate:da(this.viewModel.departureIsoDate),
onCalciteInputDatePickerChange:({target:a})=>{this.viewModel.departureIsoDate=a.value;this._solveRoute()}}),e.tsx("calcite-input-time-picker",{value:this.viewModel.departureIsoTime,onCalciteInputTimePickerChange:({target:a})=>{this.viewModel.departureIsoTime=a.value;this._solveRoute()}}))):null}_renderSectionSplitter(){return e.tsx("div",{class:d.css.sectionSplitter})}_renderSaveContainer(){const {saveButton:a,saveAsButton:b,printButton:c,layerDetails:f}=this.visibleElements;return a||b||c||f?e.tsx("div",
{class:d.css.saveSection,key:d.css.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const {saveButton:a,saveAsButton:b,printButton:c}=this.visibleElements;return a||b||c?e.tsx("div",{class:d.css.saveButtons,key:d.css.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const {portalItem:a,routeInfo:b}=this.viewModel.layer,c=a?.itemControl;
return e.tsx("calcite-button",{appearance:"outline",class:d.css.saveButton,disabled:!(null!=b&&("admin"===c||"update"===c)),iconStart:"save",key:d.css.saveButton,label:this.messagesCommon.save,onclick:()=>{this._handleSaveButtonClick()},width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){return this.visibleElements.saveAsButton?e.tsx("div",{class:d.css.saveAsButtonPopover,key:d.css.saveAsButtonPopover},e.tsx("calcite-button",{afterCreate:a=>{this._saveAsButtonNode=a},appearance:"outline",
class:d.css.saveAsButton,disabled:null==this.viewModel.layer.routeInfo,iconStart:"duplicate",key:d.css.saveAsButton,label:this.messagesCommon.saveAs,onclick:()=>this._handleSaveAsButtonClick(),width:"full"},this.messagesCommon.saveAs)):null}_renderSavePopover(){return e.tsx("calcite-popover",{class:d.css.savePopover,label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode,triggerDisabled:!0},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?
this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?e.tsx("calcite-button",{appearance:"outline",class:d.css.printButton,iconStart:"print",key:d.css.printButton,label:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const {portalItem:a}=this.viewModel.layer;if(!a)return null;const {id:b,portal:{url:c}}=a;return e.tsx("calcite-link",{class:d.css.layerDetailsLink,
href:`${c}/home/item.html?id=${b}`,key:d.css.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return e.tsx("div",{class:this.classes(d.css.directionsSection,d.css.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return e.tsx("div",{class:d.css.loader,key:"loader"})}_renderWarningCard(){return e.tsx("div",{class:d.css.warningCard,role:"alert"},e.tsx("div",
{class:d.css.warningHeader},e.tsx("span",{"aria-hidden":"true",class:y.legacyIcon.noticeTriangle}),e.tsx(A.Heading,{class:d.css.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),e.tsx("div",{class:d.css.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const {layer:a,state:b}=this.viewModel,c="routing"===b;return"error"===b?this._renderWarningCard():c?this._renderLoader():null!=a.directionLines?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),
class:this.classes(d.css.summary,this._saveLayer.opened&&r.globalCss.buttonDisabled),key:d.css.summary,role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):e.tsx("div",{class:r.globalCss.empty,key:"esri-directions__placeholder"},this._renderPlaceholder(),e.tsx(A.Heading,{class:d.css.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return e.tsx("svg",{class:r.globalCss.emptyIllustration,viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},
e.tsx("path",{d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z",
fill:"currentcolor"}))}_renderMessage(a){return e.tsx(A.Heading,{class:d.css.messageHeading,level:this.headingLevel},a)}_renderRouteActions(){return e.tsx("div",{class:d.css.routeActions},e.tsx("button",{"aria-label":this.messages.clearRoute,bind:this,class:this.classes(d.css.clearRouteButton,r.globalCss.button,r.globalCss.buttonTertiary),onclick:this._handleClearRouteClick,tabIndex:0,type:"button"},this.messages.clearRoute))}_getSections(){var {layer:a}=this.viewModel;if(!a)return null;const {directionPoints:b,
directionLines:c,stops:f}=a;if(null==b||null==c)return null;a=[];let g=null;for(const l of b){const {objectId:v,stopId:p}=l;if(null!=p){var h=f.find(({objectId:t})=>t===p);const w=0===a.length;if(null==g||g.stop!==h)g={stop:h,directions:[],open:w},a.push(g)}else null!=g&&(h=c.find(({directionPointId:w})=>w===v),null!=h&&g.directions.push({directionPoint:l,directionLine:h}))}return a}_renderManeuverSections(){return null==this._sections?null:e.tsx("div",{class:d.css.maneuvers,role:"group"},this._sections.map((a,
b)=>{const {open:c}=a;let f;0<a.directions.length&&c&&(f=e.tsx("ol",{class:d.css.maneuverList},a.directions.map(p=>this._renderManeuver(p))));var g=2<this._sections.length;const h=b===this._sections.length-1,l={[d.css.collapsibleSection]:g},v={[y.legacyIcon.down]:!c,[y.legacyIcon.up]:c};g&&!h?(g=c?this.messagesCommon.close:this.messagesCommon.open,a=e.tsx("header",{class:this.classes(d.css.maneuverSectionHeader,d.css.maneuverSectionToggle),key:d.css.maneuverSectionHeader},e.tsx("div",{"aria-expanded":c.toString(),
"aria-label":g,bind:this,class:d.css.maneuverSectionHeaderButton,"data-maneuver-section":a,onclick:this._handleSectionToggle,onkeydown:this._handleSectionToggle,role:"button",tabIndex:0,title:g},e.tsx(A.Heading,{class:d.css.maneuverSectionTitle,level:this.headingLevel},a.stop.name),e.tsx("span",{"aria-hidden":"true",class:this.classes(v)})))):a=e.tsx("header",{class:d.css.maneuverSectionHeader,key:d.css.maneuverSectionHeader},e.tsx(A.Heading,{class:d.css.maneuverSectionTitle,level:this.headingLevel},
a.stop.name));return e.tsx("section",{class:this.classes(d.css.maneuverSection,l),key:b},a,f)}))}_handleSectionToggle(a){if(a=a.currentTarget?.["data-maneuver-section"])a.open=!a.open}_renderCosts(){var a=this._getCostSummary();const {directionPoints:b}=this.viewModel.layer;if(null==b||null==a)return null;const {distance:c,duration:f}=a,{primaryCosts:g,secondaryCosts:h,zoomToRoute:l}=this.messages;a=this._renderEta();return e.tsx("div",{"aria-label":l,bind:this,class:d.css.directionCosts,onclick:this._handleSummaryInteraction,
onkeydown:this._handleSummaryInteraction,role:"button",tabIndex:0,title:l},e.tsx("div",{class:d.css.costsDetails,role:"group"},e.tsx("div",{class:d.css.primaryCosts,title:g},f),e.tsx("div",{class:d.css.verticalSplitter}),e.tsx("div",{class:d.css.secondaryCosts,title:h},c)),a)}_renderEta(){return this.viewModel.departureOption===u.DepartureTimeOption.UNSPECIFIED?null:e.tsx("div",{class:d.css.arrivalTimeContainer,title:this.messages.eta},e.tsx("span",{class:d.css.arrivalTime},this.viewModel.formattedEta))}_handleSummaryInteraction(){this._focusedManeuver=
this._activeManeuver=null;this.viewModel.clearHighlights();this.zoomToRoute()}_getErrorMessage(){switch(this.viewModel.lastError?.name){case "directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case "directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_normalizeSearchSources(a){this._overrideDefaultSources(a);this._applyLocatorSourceOverrides(a)}_overrideDefaultSources(a){a.viewModel.defaultSources.forEach(b=>
{b.autoNavigate=!1})}_applyLocatorSourceOverrides({allSources:a}){for(const b of a)if("url"in b&&b.url){let c;(c=b).locationType??(c.locationType="street");K.isArcGISWorldGeocoder(b.url)&&this.apiKey&&null==b.apiKey&&(b.apiKey=this.apiKey,b.url=K.meteredArcGISLocatorUrl)}}_disposeSearch(a){if(a&&this._stopsToSearches.has(a)){var b=this._stopsToSearches.get(a);this.removeHandles(b);b.destroy();this._stopsToSearches.delete(a)}}_renderManeuver(a){const {directionPoint:b,directionLine:c}=a,{distance:f,
duration:g}=c,{messages:h,messagesUnits:l,unit:v}=this;a=u.formatDistance(l,f??0,v);var p=u.formatDuration(g??0);a=a&&p?`${a}&nbsp;&middot;&nbsp;${p}`:`${a}${p}`;p=ca(b);const {objectId:w,directionPointType:t}=b,q=u.getIconName(t),z=`${d.css.intermediateCost}-${w}`;return e.tsx("li",{"aria-labelledby":`${`${d.css.maneuver}-${w}`} ${z}`,bind:this,class:this.classes(d.css.maneuver,{[d.css.maneuverActive]:this._activeManeuver===c}),"data-maneuver":c,key:c,onblur:this._handleManeuverBlur,onclick:this._handleManeuverClick,
onfocus:this._handleManeuverFocus,onkeydown:this._handleManeuverClick,onmouseout:this._handleManeuverMouseOut,onmouseover:this._handleManeuverMouseOver,tabIndex:0},e.tsx("calcite-icon",{alt:"",class:d.css.maneuverIcon,icon:q}),e.tsx("div",{class:d.css.maneuverCostsContainer},p,e.tsx("div",{class:d.css.maneuverCosts},e.tsx("div",{class:d.css.horizontalSplitter}),e.tsx("div",{"aria-hidden":"true",class:d.css.intermediateCost,id:z,innerHTML:a,title:h.intermediateCosts}))))}_handleManeuverClick(a){if(a=
a.currentTarget?.["data-maneuver"])if(this._activeManeuver===a)this._activeManeuver=null,this.zoomToRoute();else{this._activeManeuver=a;var {geometry:b}=a;this.viewModel.centerAt(b);this.viewModel.highlight(a)}}_handleManeuverMouseOver(a){this._activeManeuver||this._focusedManeuver||(a=a.currentTarget?.["data-maneuver"])&&this.viewModel.highlight(a)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=
null,this.viewModel.clearHighlights())}_handleManeuverFocus(a){!this._activeManeuver&&(a=a.currentTarget?.["data-maneuver"])&&(this._focusedManeuver=a,this.viewModel.highlight(a))}_getCostSummary(){const {messagesUnits:a,unit:b,viewModel:c}=this;var {routeInfo:f}=c.layer;if(null==f)return null;var g=f.totalDuration??0;f=u.formatDistance(a,f.totalDistance??0,b);g=u.formatDuration(g);return{distance:f,duration:g}}async _solveRoute(){this.viewModel.updateDepartureTime();const a=this.viewModel.layer?.stops.filter(({geometry:b})=>
null!=b);if(a&&!(2>a.length))try{await this.viewModel.getDirections()}catch{}}};m.__decorate([n.property()],k.prototype,"apiKey",null);m.__decorate([n.property(T.defaultUnitPropertyMetadata)],k.prototype,"defaultUnit",void 0);m.__decorate([n.property()],k.prototype,"goToOverride",null);m.__decorate([n.property()],k.prototype,"headingLevel",void 0);m.__decorate([n.property()],k.prototype,"iconClass",void 0);m.__decorate([n.property()],k.prototype,"icon",void 0);m.__decorate([n.property()],k.prototype,
"label",null);m.__decorate([n.property({readOnly:!0})],k.prototype,"lastRoute",null);m.__decorate([n.property()],k.prototype,"layer",null);m.__decorate([n.property()],k.prototype,"maxStops",null);m.__decorate([n.property(),F.messageBundle("esri/widgets/Directions/t9n/Directions")],k.prototype,"messages",void 0);m.__decorate([n.property(),F.messageBundle("esri/t9n/common")],k.prototype,"messagesCommon",void 0);m.__decorate([n.property(),F.messageBundle("esri/core/t9n/Units")],k.prototype,"messagesUnits",
void 0);m.__decorate([n.property()],k.prototype,"searchProperties",void 0);m.__decorate([n.property()],k.prototype,"unit",null);m.__decorate([n.property()],k.prototype,"view",null);m.__decorate([n.property({type:J})],k.prototype,"viewModel",void 0);m.__decorate([n.property()],k.prototype,"visibleElements",void 0);m.__decorate([R.cast("visibleElements")],k.prototype,"castVisibleElements",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleStopIconClick",null);m.__decorate([B.accessibleHandler()],
k.prototype,"_handleClearRouteClick",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleReverseStops",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleRemoveStop",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleSectionToggle",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleSummaryInteraction",null);m.__decorate([B.accessibleHandler()],k.prototype,"_handleManeuverClick",null);return k=m.__decorate([S.subclass("esri.widgets.Directions")],k)});