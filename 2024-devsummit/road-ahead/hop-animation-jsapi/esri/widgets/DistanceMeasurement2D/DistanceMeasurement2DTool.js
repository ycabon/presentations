// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../intl ../../symbols ../../core/colorUtils ../../core/maybe ../../core/reactiveUtils ../../core/unitFormatUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/geometryEngine ../../geometry/projection ../../geometry/support/geodesicUtils ../../layers/GraphicsLayer ../../views/ViewingMode ../../views/draw/Draw ../../views/interactive/dragEventPipeline ../../views/interactive/GraphicManipulator ../../views/interactive/InteractiveToolBase ../../intl/messages ../../intl/locale ../../geometry/Point ../../symbols/CIMSymbol ../../symbols/TextSymbol ../../symbols/Font ../../symbols/SimpleMarkerSymbol ../../geometry/Polyline ../../geometry/SpatialReference".split(" "),
function(e,l,W,t,X,Y,p,u,v,w,J,m,Z,aa,ba,K,x,q,n,z,L,M,y,N,O,A,P,B,Q,R,S,C,T,D){function U(a,c,b){var d=p.multiplyOpacity(c.effectiveTheme.accentColor,.5);const f={type:"simple-line",width:0},h=new C({style:"circle",color:d,size:8,outline:f});d=new C({style:"circle",color:d,size:12,outline:f});a=new t({geometry:a,symbol:h});return new N.GraphicManipulator({view:c,layer:b,graphic:a,focusedSymbol:d})}function E(a,c,b){a=new T({paths:[a],spatialReference:c});if(c.isGeographic)if(n.isSupported(c))b=n.geodesicLengths([a],
"meters")[0],c=n.geodesicDensify(a,1E5);else{b=q.project(a,D.WGS84);var d=n.geodesicDensify(b,1E5);b=n.geodesicLengths([b],"meters")[0];c=q.project(d,c)}else c.isWebMercator?(b=x.geodesicLength(a,"meters"),c=x.geodesicDensify(a,1E5,"meters")):(d=x.planarLength(a,"meters"),null!=b&&d>=b?(b=q.project(a,D.WGS84),d=n.geodesicDensify(b,1E5),b=n.geodesicLengths([b],"meters")[0],c=q.project(d,c)):(b=d,c=a));return{measurement:{geometry:c,length:b},original:a,drawing:c}}function F(a,c,b){if(!c||!a)return"";
switch(b){case "metric":return w.formatMetricLength(a,c.length,"meters");case "imperial":return w.formatImperialLength(a,c.length,"meters");default:return w.formatDecimal(a,J.convertUnit(c.length,"meters",b),b)}}e.DistanceMeasurement2DTool=class extends O.InteractiveToolBase{constructor(a){super(a);this._drawActive=!1;this._measurementLayer=new z({internal:!0,listMode:"hide",visible:!1});this._manipulatorLayer=new z({internal:!0,listMode:"hide",visible:!1});this._vertices=[];this.measurementLabel=
this.measurement=this.geodesicDistanceThreshold=null}initialize(){A.fetchMessageBundle("esri/core/t9n/Units").then(c=>{this.messages=c});this.addHandles(P.onLocaleChange(async()=>{this.messages=await A.fetchMessageBundle("esri/core/t9n/Units")}));const a=this.view;this._draw=new M({view:a});a.map.addMany([this._measurementLayer,this._manipulatorLayer]);a.focus();this.addHandles([v.watch(()=>[this.unit,this.geodesicDistanceThreshold,this.messages],()=>{this._updatePolylines()},v.initial),v.watch(()=>
[this.view.effectiveTheme.accentColor,this.view.effectiveTheme.textColor],()=>{if(this._vertices.length){var c=this._vertices.map(({coord:b})=>b);for(const {handle:b}of this._vertices)b.remove();this._vertices=[];this._measurementLayer.removeAll();this._manipulatorLayer.removeAll();this.manipulators.removeAll();this._updateSketch(c)}})])}destroy(){const {map:a}=this.view;this._draw.view=null;this._draw=u.destroyMaybe(this._draw);a.removeMany([this._measurementLayer,this._manipulatorLayer]);this._measurementLayer.removeAll();
this._manipulatorLayer.removeAll();this._set("measurement",null);this._set("measurementLabel",null);this._measurementLayer=u.destroyMaybe(this._measurementLayer);this._manipulatorLayer=u.destroyMaybe(this._manipulatorLayer);this._resetVertices()}get cursor(){return this._drawActive?"crosshair":null}set editable(a){this._set("editable",a);a||this._draw.reset()}onActivate(){this._drawActive||0!==this._vertices.length||this._startSketch()}onShow(){this._measurementLayer.visible=!0;this._manipulatorLayer.visible=
!0}onHide(){this._measurementLayer.visible=!1;this._manipulatorLayer.visible=!1}_resetVertices(){for(const {handle:a}of this._vertices)a.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;const a=this._draw.create("polyline",{mode:"click"});a.on("vertex-add vertex-update vertex-remove cursor-update undo redo".split(" "),c=>this._updateSketch(c.vertices));a.on("draw-complete",()=>{this._stopSketch()})}_stopSketch(){this.manipulators.forEach(({manipulator:a})=>{a.interactive=!0});this._drawActive=
!1;this.finishToolCreation()}_updateSketch(a){const {spatialReference:c}=this.view;for(;this._vertices.length>a.length;){const {handle:k,manipulator:r}=this._vertices.pop();k.remove();this.manipulators.remove(r)}for(let k=this._vertices.length;k<a.length;k++){const [r,G]=a[k];var b=new B({x:r,y:G,spatialReference:c});b=U(b,this.view,this._manipulatorLayer);this.manipulators.add(b);var d=y.createManipulatorDragEventPipeline(b,(H,V)=>{V.next(y.screenToMap(this.view)).next(y.dragGraphic(H.graphic,L.ViewingMode.Local)).next(()=>
{const I=H.graphic.geometry;this._vertices[k].coord=[I.x,I.y];this._updatePolylines()})});this._vertices.push({manipulator:b,coord:[r,G],handle:d})}b=this._vertices.length-1;d=this._vertices[b];const [f,h]=a[b];if(d.coord[0]!==f||d.coord[1]!==h)d.coord=[f,h],d.manipulator.graphic.geometry=new B({x:f,y:h,spatialReference:c});const g=this._drawActive?this._vertices[b].manipulator:null;this.manipulators.forEach(({manipulator:k})=>{k.interactive=null==g||k!==g});this._updatePolylines()}_updatePolylines(){if(2>
this._vertices.length)this._measurementLayer.removeAll();else{var a=this._vertices.map(({coord:k})=>k),{measurement:c,drawing:b,original:d}=E(a,this.view.spatialReference,this.geodesicDistanceThreshold);this._set("measurement",c);a=F(this.messages,c,this.unit);this._set("measurementLabel",a);var {graphics:f}=this._measurementLayer;var h=2===f.length;({effectiveTheme:g}=this.view);if(h){h=f.at(0);var g=f.at(1)}else h=new t({symbol:new Q({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",
symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[14,12],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:3.5,color:p.getContrast(g.accentColor).toArray()},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:5,color:g.accentColor.toArray()}]}}})}),g=new t({symbol:new R({color:g.textColor,haloColor:p.multiplyOpacity(p.getContrast(g.textColor,p.BrightnessThreshold.Low),.5),haloSize:2,
font:new S({size:14,family:"sans-serif"})})}),f.removeAll(),f.addMany([h,g]);h.geometry=b;g.geometry=d.extent?.center;g.symbol.text=a}}};l.__decorate([m.property()],e.DistanceMeasurement2DTool.prototype,"_drawActive",void 0);l.__decorate([m.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"cursor",null);l.__decorate([m.property({value:!0})],e.DistanceMeasurement2DTool.prototype,"editable",null);l.__decorate([m.property({type:Number})],e.DistanceMeasurement2DTool.prototype,"geodesicDistanceThreshold",
void 0);l.__decorate([m.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"measurement",void 0);l.__decorate([m.property({readOnly:!0})],e.DistanceMeasurement2DTool.prototype,"measurementLabel",void 0);l.__decorate([m.property()],e.DistanceMeasurement2DTool.prototype,"messages",void 0);l.__decorate([m.property()],e.DistanceMeasurement2DTool.prototype,"unit",void 0);l.__decorate([m.property({constructOnly:!0})],e.DistanceMeasurement2DTool.prototype,"view",void 0);e.DistanceMeasurement2DTool=
l.__decorate([K.subclass("esri.widgets.DistanceMeasurement2D.DistanceMeasurement2DTool")],e.DistanceMeasurement2DTool);e.createDistanceMeasurementInfo2D=E;e.createDistanceMeasurementLabel=F;e.isProjectionEngineRequired=function(a){if(!a)return!1;const {isGeographic:c,isWebMercator:b,isWGS84:d}=a;return c&&!d&&!n.isSupported(a)||!c&&!b};e.isSupported=function(a){return null!=a};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});