// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles".split(" "),function(c,k,b,h,d,n,p,q,l,m){b=class extends b.EventedAccessor{constructor(a){super(a);this._indexHistory=[];this._stepIndex=this._lastStepIndex=-1;this._updatingHandles=new m.UpdatingHandles;this._handleKeys={afterCommit:"after-commit",
beforeCommit:"before-commit"};this.data=void 0;this.started=!1;this.steps=[];this._pendingOperation=this.type=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const {steps:a}=this;return!!(a&&this._stepIndex<a.filter(e=>!e.parent).length-1)}get hasPreviousStep(){return 0<this._stepIndex}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get hasUnsupportedFields(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){var {steps:a}=
this;return(a=a&&a[this._stepIndex])&&a.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(a=()=>Promise.resolve(!0)){if(!this.hasPendingEdits||await a())this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0})}async cancel(a={force:!0}){return!1!==a.force?this._cancel(a):new Promise((e,f)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...a,
force:!0}).then(e)},deny:()=>f(new k("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit);this.onCommit&&await this.onCommit(this.data);this.removeHandles(this._handleKeys.afterCommit);this.emit("commit")}async go(a){var {steps:e}=this;e=e.findIndex(f=>f.id===a);this._indexHistory.push(this._stepIndex);await this._go(e)}async next(){this._indexHistory.push(this._stepIndex);await this._go(this._stepIndex+1)}async previous(a=
{cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),a.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1});await this.start()}async save(){await this.commit();await this.reset()}async start(){this._set("started",!0);await this._go(-1===this._stepIndex?0:this._stepIndex)}async _cancel({emitCancelEvent:a=!0,error:e}={}){this.started&&(this._set("started",!1),await this._transaction(()=>this.steps[this._stepIndex]?.tearDown({canceled:!0})));this.removeHandles([this._handleKeys.afterCommit,
this._handleKeys.beforeCommit]);this._resetIndexing(a);a&&this.emit("cancel",{error:e})}_go(a=-1,e=!1){return this._transaction(async()=>{const {steps:f}=this;if(!(-1>=a||a>=f.length)){if(this.started){-1<this._lastStepIndex&&await f[this._lastStepIndex].tearDown({canceled:e});try{await f[a].setUp()}catch(g){h.throwIfNotAbortError(g)}this._lastStepIndex=a}this._stepIndex=a;this._notifyStepProps()}})}async _transaction(a){const e=this._pendingOperation,f=h.createResolver(),g=(e??Promise.resolve()).then(()=>
f.promise);this._pendingOperation=g;this._updatingHandles.addPromise(g);try{e&&await e,await a()}finally{f.resolve(),g===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(a=!0){this._lastStepIndex=this._stepIndex=-1;this._indexHistory.length=0;a&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId");this.notifyChange("hasPreviousStep");this.notifyChange("hasNextStep")}};c.__decorate([d.property()],b.prototype,"data",void 0);c.__decorate([d.property()],b.prototype,
"hasNextStep",null);c.__decorate([d.property()],b.prototype,"hasPreviousStep",null);c.__decorate([d.property()],b.prototype,"onCommit",void 0);c.__decorate([d.property()],b.prototype,"reliesOnOwnerAdminPrivileges",null);c.__decorate([d.property()],b.prototype,"hasInvalidFormTemplate",null);c.__decorate([d.property()],b.prototype,"hasUnsupportedFields",null);c.__decorate([d.property()],b.prototype,"shouldShowAttachments",null);c.__decorate([d.property()],b.prototype,"shouldAllowAttachmentEditing",
null);c.__decorate([d.property()],b.prototype,"started",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"stepId",null);c.__decorate([d.property()],b.prototype,"steps",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"helpMessage",null);c.__decorate([d.property()],b.prototype,"hasPendingEdits",null);c.__decorate([d.property()],b.prototype,"keyboardCancellationEnabled",null);c.__decorate([d.property()],b.prototype,"updating",
null);return b=c.__decorate([l.subclass("esri.widgets.Editor.Workflow")],b)});